(function(){const A=document.createElement("link").relList;if(A&&A.supports&&A.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))b(P);new MutationObserver(P=>{for(const x of P)if(x.type==="childList")for(const H of x.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&b(H)}).observe(document,{childList:!0,subtree:!0});function w(P){const x={};return P.integrity&&(x.integrity=P.integrity),P.referrerPolicy&&(x.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?x.credentials="include":P.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function b(P){if(P.ep)return;P.ep=!0;const x=w(P);fetch(P.href,x)}})();var mw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xw(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var _w={exports:{}},tS={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cV;function R8(){if(cV)return tS;cV=1;var S=Symbol.for("react.transitional.element"),A=Symbol.for("react.fragment");function w(b,P,x){var H=null;if(x!==void 0&&(H=""+x),P.key!==void 0&&(H=""+P.key),"key"in P){x={};for(var J in P)J!=="key"&&(x[J]=P[J])}else x=P;return P=x.ref,{$$typeof:S,type:b,key:H,ref:P!==void 0?P:null,props:x}}return tS.Fragment=A,tS.jsx=w,tS.jsxs=w,tS}var lV;function v8(){return lV||(lV=1,_w.exports=R8()),_w.exports}var $n=v8(),Ew={exports:{}},Ge={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uV;function y8(){if(uV)return Ge;uV=1;var S=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),H=Symbol.for("react.context"),J=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),G=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),ot=Symbol.iterator;function mt(tt){return tt===null||typeof tt!="object"?null:(tt=ot&&tt[ot]||tt["@@iterator"],typeof tt=="function"?tt:null)}var Vt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},it=Object.assign,xt={};function yt(tt,Ut,Zt){this.props=tt,this.context=Ut,this.refs=xt,this.updater=Zt||Vt}yt.prototype.isReactComponent={},yt.prototype.setState=function(tt,Ut){if(typeof tt!="object"&&typeof tt!="function"&&tt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,tt,Ut,"setState")},yt.prototype.forceUpdate=function(tt){this.updater.enqueueForceUpdate(this,tt,"forceUpdate")};function kt(){}kt.prototype=yt.prototype;function zt(tt,Ut,Zt){this.props=tt,this.context=Ut,this.refs=xt,this.updater=Zt||Vt}var Bt=zt.prototype=new kt;Bt.constructor=zt,it(Bt,yt.prototype),Bt.isPureReactComponent=!0;var ie=Array.isArray,te={H:null,A:null,T:null,S:null,V:null},fn=Object.prototype.hasOwnProperty;function Le(tt,Ut,Zt,qt,ne,Ze){return Zt=Ze.ref,{$$typeof:S,type:tt,key:Ut,ref:Zt!==void 0?Zt:null,props:Ze}}function Cn(tt,Ut){return Le(tt.type,Ut,void 0,void 0,void 0,tt.props)}function Tn(tt){return typeof tt=="object"&&tt!==null&&tt.$$typeof===S}function oi(tt){var Ut={"=":"=0",":":"=2"};return"$"+tt.replace(/[=:]/g,function(Zt){return Ut[Zt]})}var er=/\/+/g;function pi(tt,Ut){return typeof tt=="object"&&tt!==null&&tt.key!=null?oi(""+tt.key):Ut.toString(36)}function An(){}function Qe(tt){switch(tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason;default:switch(typeof tt.status=="string"?tt.then(An,An):(tt.status="pending",tt.then(function(Ut){tt.status==="pending"&&(tt.status="fulfilled",tt.value=Ut)},function(Ut){tt.status==="pending"&&(tt.status="rejected",tt.reason=Ut)})),tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason}}throw tt}function In(tt,Ut,Zt,qt,ne){var Ze=typeof tt;(Ze==="undefined"||Ze==="boolean")&&(tt=null);var fe=!1;if(tt===null)fe=!0;else switch(Ze){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(tt.$$typeof){case S:case A:fe=!0;break;case Z:return fe=tt._init,In(fe(tt._payload),Ut,Zt,qt,ne)}}if(fe)return ne=ne(tt),fe=qt===""?"."+pi(tt,0):qt,ie(ne)?(Zt="",fe!=null&&(Zt=fe.replace(er,"$&/")+"/"),In(ne,Ut,Zt,"",function(Ka){return Ka})):ne!=null&&(Tn(ne)&&(ne=Cn(ne,Zt+(ne.key==null||tt&&tt.key===ne.key?"":(""+ne.key).replace(er,"$&/")+"/")+fe)),Ut.push(ne)),1;fe=0;var Hr=qt===""?".":qt+":";if(ie(tt))for(var Jn=0;Jn<tt.length;Jn++)qt=tt[Jn],Ze=Hr+pi(qt,Jn),fe+=In(qt,Ut,Zt,Ze,ne);else if(Jn=mt(tt),typeof Jn=="function")for(tt=Jn.call(tt),Jn=0;!(qt=tt.next()).done;)qt=qt.value,Ze=Hr+pi(qt,Jn++),fe+=In(qt,Ut,Zt,Ze,ne);else if(Ze==="object"){if(typeof tt.then=="function")return In(Qe(tt),Ut,Zt,qt,ne);throw Ut=String(tt),Error("Objects are not valid as a React child (found: "+(Ut==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":Ut)+"). If you meant to render a collection of children, use an array instead.")}return fe}function gt(tt,Ut,Zt){if(tt==null)return tt;var qt=[],ne=0;return In(tt,qt,"","",function(Ze){return Ut.call(Zt,Ze,ne++)}),qt}function Jt(tt){if(tt._status===-1){var Ut=tt._result;Ut=Ut(),Ut.then(function(Zt){(tt._status===0||tt._status===-1)&&(tt._status=1,tt._result=Zt)},function(Zt){(tt._status===0||tt._status===-1)&&(tt._status=2,tt._result=Zt)}),tt._status===-1&&(tt._status=0,tt._result=Ut)}if(tt._status===1)return tt._result.default;throw tt._result}var he=typeof reportError=="function"?reportError:function(tt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ut=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof tt=="object"&&tt!==null&&typeof tt.message=="string"?String(tt.message):String(tt),error:tt});if(!window.dispatchEvent(Ut))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",tt);return}console.error(tt)};function ve(){}return Ge.Children={map:gt,forEach:function(tt,Ut,Zt){gt(tt,function(){Ut.apply(this,arguments)},Zt)},count:function(tt){var Ut=0;return gt(tt,function(){Ut++}),Ut},toArray:function(tt){return gt(tt,function(Ut){return Ut})||[]},only:function(tt){if(!Tn(tt))throw Error("React.Children.only expected to receive a single React element child.");return tt}},Ge.Component=yt,Ge.Fragment=w,Ge.Profiler=P,Ge.PureComponent=zt,Ge.StrictMode=b,Ge.Suspense=X,Ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=te,Ge.__COMPILER_RUNTIME={__proto__:null,c:function(tt){return te.H.useMemoCache(tt)}},Ge.cache=function(tt){return function(){return tt.apply(null,arguments)}},Ge.cloneElement=function(tt,Ut,Zt){if(tt==null)throw Error("The argument must be a React element, but you passed "+tt+".");var qt=it({},tt.props),ne=tt.key,Ze=void 0;if(Ut!=null)for(fe in Ut.ref!==void 0&&(Ze=void 0),Ut.key!==void 0&&(ne=""+Ut.key),Ut)!fn.call(Ut,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&Ut.ref===void 0||(qt[fe]=Ut[fe]);var fe=arguments.length-2;if(fe===1)qt.children=Zt;else if(1<fe){for(var Hr=Array(fe),Jn=0;Jn<fe;Jn++)Hr[Jn]=arguments[Jn+2];qt.children=Hr}return Le(tt.type,ne,void 0,void 0,Ze,qt)},Ge.createContext=function(tt){return tt={$$typeof:H,_currentValue:tt,_currentValue2:tt,_threadCount:0,Provider:null,Consumer:null},tt.Provider=tt,tt.Consumer={$$typeof:x,_context:tt},tt},Ge.createElement=function(tt,Ut,Zt){var qt,ne={},Ze=null;if(Ut!=null)for(qt in Ut.key!==void 0&&(Ze=""+Ut.key),Ut)fn.call(Ut,qt)&&qt!=="key"&&qt!=="__self"&&qt!=="__source"&&(ne[qt]=Ut[qt]);var fe=arguments.length-2;if(fe===1)ne.children=Zt;else if(1<fe){for(var Hr=Array(fe),Jn=0;Jn<fe;Jn++)Hr[Jn]=arguments[Jn+2];ne.children=Hr}if(tt&&tt.defaultProps)for(qt in fe=tt.defaultProps,fe)ne[qt]===void 0&&(ne[qt]=fe[qt]);return Le(tt,Ze,void 0,void 0,null,ne)},Ge.createRef=function(){return{current:null}},Ge.forwardRef=function(tt){return{$$typeof:J,render:tt}},Ge.isValidElement=Tn,Ge.lazy=function(tt){return{$$typeof:Z,_payload:{_status:-1,_result:tt},_init:Jt}},Ge.memo=function(tt,Ut){return{$$typeof:G,type:tt,compare:Ut===void 0?null:Ut}},Ge.startTransition=function(tt){var Ut=te.T,Zt={};te.T=Zt;try{var qt=tt(),ne=te.S;ne!==null&&ne(Zt,qt),typeof qt=="object"&&qt!==null&&typeof qt.then=="function"&&qt.then(ve,he)}catch(Ze){he(Ze)}finally{te.T=Ut}},Ge.unstable_useCacheRefresh=function(){return te.H.useCacheRefresh()},Ge.use=function(tt){return te.H.use(tt)},Ge.useActionState=function(tt,Ut,Zt){return te.H.useActionState(tt,Ut,Zt)},Ge.useCallback=function(tt,Ut){return te.H.useCallback(tt,Ut)},Ge.useContext=function(tt){return te.H.useContext(tt)},Ge.useDebugValue=function(){},Ge.useDeferredValue=function(tt,Ut){return te.H.useDeferredValue(tt,Ut)},Ge.useEffect=function(tt,Ut,Zt){var qt=te.H;if(typeof Zt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return qt.useEffect(tt,Ut)},Ge.useId=function(){return te.H.useId()},Ge.useImperativeHandle=function(tt,Ut,Zt){return te.H.useImperativeHandle(tt,Ut,Zt)},Ge.useInsertionEffect=function(tt,Ut){return te.H.useInsertionEffect(tt,Ut)},Ge.useLayoutEffect=function(tt,Ut){return te.H.useLayoutEffect(tt,Ut)},Ge.useMemo=function(tt,Ut){return te.H.useMemo(tt,Ut)},Ge.useOptimistic=function(tt,Ut){return te.H.useOptimistic(tt,Ut)},Ge.useReducer=function(tt,Ut,Zt){return te.H.useReducer(tt,Ut,Zt)},Ge.useRef=function(tt){return te.H.useRef(tt)},Ge.useState=function(tt){return te.H.useState(tt)},Ge.useSyncExternalStore=function(tt,Ut,Zt){return te.H.useSyncExternalStore(tt,Ut,Zt)},Ge.useTransition=function(){return te.H.useTransition()},Ge.version="19.1.0",Ge}var dV;function Vw(){return dV||(dV=1,Ew.exports=y8()),Ew.exports}var Ot=Vw();const C8=xw(Ot);var eS={},hV;function A8(){if(hV)return eS;hV=1,Object.defineProperty(eS,"__esModule",{value:!0}),eS.parse=H,eS.serialize=G;const S=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,A=/^[\u0021-\u003A\u003C-\u007E]*$/,w=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,b=/^[\u0020-\u003A\u003D-\u007E]*$/,P=Object.prototype.toString,x=(()=>{const mt=function(){};return mt.prototype=Object.create(null),mt})();function H(mt,Vt){const it=new x,xt=mt.length;if(xt<2)return it;const yt=(Vt==null?void 0:Vt.decode)||Z;let kt=0;do{const zt=mt.indexOf("=",kt);if(zt===-1)break;const Bt=mt.indexOf(";",kt),ie=Bt===-1?xt:Bt;if(zt>ie){kt=mt.lastIndexOf(";",zt-1)+1;continue}const te=J(mt,kt,zt),fn=X(mt,zt,te),Le=mt.slice(te,fn);if(it[Le]===void 0){let Cn=J(mt,zt+1,ie),Tn=X(mt,ie,Cn);const oi=yt(mt.slice(Cn,Tn));it[Le]=oi}kt=ie+1}while(kt<xt);return it}function J(mt,Vt,it){do{const xt=mt.charCodeAt(Vt);if(xt!==32&&xt!==9)return Vt}while(++Vt<it);return it}function X(mt,Vt,it){for(;Vt>it;){const xt=mt.charCodeAt(--Vt);if(xt!==32&&xt!==9)return Vt+1}return it}function G(mt,Vt,it){const xt=(it==null?void 0:it.encode)||encodeURIComponent;if(!S.test(mt))throw new TypeError(`argument name is invalid: ${mt}`);const yt=xt(Vt);if(!A.test(yt))throw new TypeError(`argument val is invalid: ${Vt}`);let kt=mt+"="+yt;if(!it)return kt;if(it.maxAge!==void 0){if(!Number.isInteger(it.maxAge))throw new TypeError(`option maxAge is invalid: ${it.maxAge}`);kt+="; Max-Age="+it.maxAge}if(it.domain){if(!w.test(it.domain))throw new TypeError(`option domain is invalid: ${it.domain}`);kt+="; Domain="+it.domain}if(it.path){if(!b.test(it.path))throw new TypeError(`option path is invalid: ${it.path}`);kt+="; Path="+it.path}if(it.expires){if(!ot(it.expires)||!Number.isFinite(it.expires.valueOf()))throw new TypeError(`option expires is invalid: ${it.expires}`);kt+="; Expires="+it.expires.toUTCString()}if(it.httpOnly&&(kt+="; HttpOnly"),it.secure&&(kt+="; Secure"),it.partitioned&&(kt+="; Partitioned"),it.priority)switch(typeof it.priority=="string"?it.priority.toLowerCase():void 0){case"low":kt+="; Priority=Low";break;case"medium":kt+="; Priority=Medium";break;case"high":kt+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${it.priority}`)}if(it.sameSite)switch(typeof it.sameSite=="string"?it.sameSite.toLowerCase():it.sameSite){case!0:case"strict":kt+="; SameSite=Strict";break;case"lax":kt+="; SameSite=Lax";break;case"none":kt+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${it.sameSite}`)}return kt}function Z(mt){if(mt.indexOf("%")===-1)return mt;try{return decodeURIComponent(mt)}catch{return mt}}function ot(mt){return P.call(mt)==="[object Date]"}return eS}A8();var pV="popstate";function b8(S={}){function A(b,P){let{pathname:x,search:H,hash:J}=b.location;return Ow("",{pathname:x,search:H,hash:J},P.state&&P.state.usr||null,P.state&&P.state.key||"default")}function w(b,P){return typeof P=="string"?P:sS(P)}return O8(A,w,null,S)}function Ri(S,A){if(S===!1||S===null||typeof S>"u")throw new Error(A)}function mc(S,A){if(!S){typeof console<"u"&&console.warn(A);try{throw new Error(A)}catch{}}}function I8(){return Math.random().toString(36).substring(2,10)}function fV(S,A){return{usr:S.state,key:S.key,idx:A}}function Ow(S,A,w=null,b){return{pathname:typeof S=="string"?S:S.pathname,search:"",hash:"",...typeof A=="string"?Cm(A):A,state:w,key:A&&A.key||b||I8()}}function sS({pathname:S="/",search:A="",hash:w=""}){return A&&A!=="?"&&(S+=A.charAt(0)==="?"?A:"?"+A),w&&w!=="#"&&(S+=w.charAt(0)==="#"?w:"#"+w),S}function Cm(S){let A={};if(S){let w=S.indexOf("#");w>=0&&(A.hash=S.substring(w),S=S.substring(0,w));let b=S.indexOf("?");b>=0&&(A.search=S.substring(b),S=S.substring(0,b)),S&&(A.pathname=S)}return A}function O8(S,A,w,b={}){let{window:P=document.defaultView,v5Compat:x=!1}=b,H=P.history,J="POP",X=null,G=Z();G==null&&(G=0,H.replaceState({...H.state,idx:G},""));function Z(){return(H.state||{idx:null}).idx}function ot(){J="POP";let yt=Z(),kt=yt==null?null:yt-G;G=yt,X&&X({action:J,location:xt.location,delta:kt})}function mt(yt,kt){J="PUSH";let zt=Ow(xt.location,yt,kt);G=Z()+1;let Bt=fV(zt,G),ie=xt.createHref(zt);try{H.pushState(Bt,"",ie)}catch(te){if(te instanceof DOMException&&te.name==="DataCloneError")throw te;P.location.assign(ie)}x&&X&&X({action:J,location:xt.location,delta:1})}function Vt(yt,kt){J="REPLACE";let zt=Ow(xt.location,yt,kt);G=Z();let Bt=fV(zt,G),ie=xt.createHref(zt);H.replaceState(Bt,"",ie),x&&X&&X({action:J,location:xt.location,delta:0})}function it(yt){let kt=P.location.origin!=="null"?P.location.origin:P.location.href,zt=typeof yt=="string"?yt:sS(yt);return zt=zt.replace(/ $/,"%20"),Ri(kt,`No window.location.(origin|href) available to create URL for href: ${zt}`),new URL(zt,kt)}let xt={get action(){return J},get location(){return S(P,H)},listen(yt){if(X)throw new Error("A history only accepts one active listener");return P.addEventListener(pV,ot),X=yt,()=>{P.removeEventListener(pV,ot),X=null}},createHref(yt){return A(P,yt)},createURL:it,encodeLocation(yt){let kt=it(yt);return{pathname:kt.pathname,search:kt.search,hash:kt.hash}},push:mt,replace:Vt,go(yt){return H.go(yt)}};return xt}function BV(S,A,w="/"){return w8(S,A,w,!1)}function w8(S,A,w,b){let P=typeof A=="string"?Cm(A):A,x=hl(P.pathname||"/",w);if(x==null)return null;let H=FV(S);N8(H);let J=null;for(let X=0;J==null&&X<H.length;++X){let G=j8(x);J=B8(H[X],G,b)}return J}function FV(S,A=[],w=[],b=""){let P=(x,H,J)=>{let X={relativePath:J===void 0?x.path||"":J,caseSensitive:x.caseSensitive===!0,childrenIndex:H,route:x};X.relativePath.startsWith("/")&&(Ri(X.relativePath.startsWith(b),`Absolute route path "${X.relativePath}" nested under path "${b}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),X.relativePath=X.relativePath.slice(b.length));let G=dl([b,X.relativePath]),Z=w.concat(X);x.children&&x.children.length>0&&(Ri(x.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${G}".`),FV(x.children,A,Z,G)),!(x.path==null&&!x.index)&&A.push({path:G,score:x8(G,x.index),routesMeta:Z})};return S.forEach((x,H)=>{var J;if(x.path===""||!((J=x.path)!=null&&J.includes("?")))P(x,H);else for(let X of jV(x.path))P(x,H,X)}),A}function jV(S){let A=S.split("/");if(A.length===0)return[];let[w,...b]=A,P=w.endsWith("?"),x=w.replace(/\?$/,"");if(b.length===0)return P?[x,""]:[x];let H=jV(b.join("/")),J=[];return J.push(...H.map(X=>X===""?x:[x,X].join("/"))),P&&J.push(...H),J.map(X=>S.startsWith("/")&&X===""?"/":X)}function N8(S){S.sort((A,w)=>A.score!==w.score?w.score-A.score:V8(A.routesMeta.map(b=>b.childrenIndex),w.routesMeta.map(b=>b.childrenIndex)))}var D8=/^:[\w-]+$/,L8=3,P8=2,k8=1,M8=10,U8=-2,mV=S=>S==="*";function x8(S,A){let w=S.split("/"),b=w.length;return w.some(mV)&&(b+=U8),A&&(b+=P8),w.filter(P=>!mV(P)).reduce((P,x)=>P+(D8.test(x)?L8:x===""?k8:M8),b)}function V8(S,A){return S.length===A.length&&S.slice(0,-1).every((b,P)=>b===A[P])?S[S.length-1]-A[A.length-1]:0}function B8(S,A,w=!1){let{routesMeta:b}=S,P={},x="/",H=[];for(let J=0;J<b.length;++J){let X=b[J],G=J===b.length-1,Z=x==="/"?A:A.slice(x.length)||"/",ot=hC({path:X.relativePath,caseSensitive:X.caseSensitive,end:G},Z),mt=X.route;if(!ot&&G&&w&&!b[b.length-1].route.index&&(ot=hC({path:X.relativePath,caseSensitive:X.caseSensitive,end:!1},Z)),!ot)return null;Object.assign(P,ot.params),H.push({params:P,pathname:dl([x,ot.pathname]),pathnameBase:K8(dl([x,ot.pathnameBase])),route:mt}),ot.pathnameBase!=="/"&&(x=dl([x,ot.pathnameBase]))}return H}function hC(S,A){typeof S=="string"&&(S={path:S,caseSensitive:!1,end:!0});let[w,b]=F8(S.path,S.caseSensitive,S.end),P=A.match(w);if(!P)return null;let x=P[0],H=x.replace(/(.)\/+$/,"$1"),J=P.slice(1);return{params:b.reduce((G,{paramName:Z,isOptional:ot},mt)=>{if(Z==="*"){let it=J[mt]||"";H=x.slice(0,x.length-it.length).replace(/(.)\/+$/,"$1")}const Vt=J[mt];return ot&&!Vt?G[Z]=void 0:G[Z]=(Vt||"").replace(/%2F/g,"/"),G},{}),pathname:x,pathnameBase:H,pattern:S}}function F8(S,A=!1,w=!0){mc(S==="*"||!S.endsWith("*")||S.endsWith("/*"),`Route path "${S}" will be treated as if it were "${S.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${S.replace(/\*$/,"/*")}".`);let b=[],P="^"+S.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(H,J,X)=>(b.push({paramName:J,isOptional:X!=null}),X?"/?([^\\/]+)?":"/([^\\/]+)"));return S.endsWith("*")?(b.push({paramName:"*"}),P+=S==="*"||S==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):w?P+="\\/*$":S!==""&&S!=="/"&&(P+="(?:(?=\\/|$))"),[new RegExp(P,A?void 0:"i"),b]}function j8(S){try{return S.split("/").map(A=>decodeURIComponent(A).replace(/\//g,"%2F")).join("/")}catch(A){return mc(!1,`The URL path "${S}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${A}).`),S}}function hl(S,A){if(A==="/")return S;if(!S.toLowerCase().startsWith(A.toLowerCase()))return null;let w=A.endsWith("/")?A.length-1:A.length,b=S.charAt(w);return b&&b!=="/"?null:S.slice(w)||"/"}function G8(S,A="/"){let{pathname:w,search:b="",hash:P=""}=typeof S=="string"?Cm(S):S;return{pathname:w?w.startsWith("/")?w:H8(w,A):A,search:Y8(b),hash:z8(P)}}function H8(S,A){let w=A.replace(/\/+$/,"").split("/");return S.split("/").forEach(P=>{P===".."?w.length>1&&w.pop():P!=="."&&w.push(P)}),w.length>1?w.join("/"):"/"}function gw(S,A,w,b){return`Cannot include a '${S}' character in a manually specified \`to.${A}\` field [${JSON.stringify(b)}].  Please separate it out to the \`to.${w}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function W8(S){return S.filter((A,w)=>w===0||A.route.path&&A.route.path.length>0)}function GV(S){let A=W8(S);return A.map((w,b)=>b===A.length-1?w.pathname:w.pathnameBase)}function HV(S,A,w,b=!1){let P;typeof S=="string"?P=Cm(S):(P={...S},Ri(!P.pathname||!P.pathname.includes("?"),gw("?","pathname","search",P)),Ri(!P.pathname||!P.pathname.includes("#"),gw("#","pathname","hash",P)),Ri(!P.search||!P.search.includes("#"),gw("#","search","hash",P)));let x=S===""||P.pathname==="",H=x?"/":P.pathname,J;if(H==null)J=w;else{let ot=A.length-1;if(!b&&H.startsWith("..")){let mt=H.split("/");for(;mt[0]==="..";)mt.shift(),ot-=1;P.pathname=mt.join("/")}J=ot>=0?A[ot]:"/"}let X=G8(P,J),G=H&&H!=="/"&&H.endsWith("/"),Z=(x||H===".")&&w.endsWith("/");return!X.pathname.endsWith("/")&&(G||Z)&&(X.pathname+="/"),X}var dl=S=>S.join("/").replace(/\/\/+/g,"/"),K8=S=>S.replace(/\/+$/,"").replace(/^\/*/,"/"),Y8=S=>!S||S==="?"?"":S.startsWith("?")?S:"?"+S,z8=S=>!S||S==="#"?"":S.startsWith("#")?S:"#"+S;function q8(S){return S!=null&&typeof S.status=="number"&&typeof S.statusText=="string"&&typeof S.internal=="boolean"&&"data"in S}var WV=["POST","PUT","PATCH","DELETE"];new Set(WV);var X8=["GET",...WV];new Set(X8);var Am=Ot.createContext(null);Am.displayName="DataRouter";var mC=Ot.createContext(null);mC.displayName="DataRouterState";var KV=Ot.createContext({isTransitioning:!1});KV.displayName="ViewTransition";var J8=Ot.createContext(new Map);J8.displayName="Fetchers";var Q8=Ot.createContext(null);Q8.displayName="Await";var _c=Ot.createContext(null);_c.displayName="Navigation";var cS=Ot.createContext(null);cS.displayName="Location";var pl=Ot.createContext({outlet:null,matches:[],isDataRoute:!1});pl.displayName="Route";var Bw=Ot.createContext(null);Bw.displayName="RouteError";function Z8(S,{relative:A}={}){Ri(lS(),"useHref() may be used only in the context of a <Router> component.");let{basename:w,navigator:b}=Ot.useContext(_c),{hash:P,pathname:x,search:H}=uS(S,{relative:A}),J=x;return w!=="/"&&(J=x==="/"?w:dl([w,x])),b.createHref({pathname:J,search:H,hash:P})}function lS(){return Ot.useContext(cS)!=null}function xu(){return Ri(lS(),"useLocation() may be used only in the context of a <Router> component."),Ot.useContext(cS).location}var YV="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function zV(S){Ot.useContext(_c).static||Ot.useLayoutEffect(S)}function $8(){let{isDataRoute:S}=Ot.useContext(pl);return S?hK():tK()}function tK(){Ri(lS(),"useNavigate() may be used only in the context of a <Router> component.");let S=Ot.useContext(Am),{basename:A,navigator:w}=Ot.useContext(_c),{matches:b}=Ot.useContext(pl),{pathname:P}=xu(),x=JSON.stringify(GV(b)),H=Ot.useRef(!1);return zV(()=>{H.current=!0}),Ot.useCallback((X,G={})=>{if(mc(H.current,YV),!H.current)return;if(typeof X=="number"){w.go(X);return}let Z=HV(X,JSON.parse(x),P,G.relative==="path");S==null&&A!=="/"&&(Z.pathname=Z.pathname==="/"?A:dl([A,Z.pathname])),(G.replace?w.replace:w.push)(Z,G.state,G)},[A,w,x,P,S])}Ot.createContext(null);function uS(S,{relative:A}={}){let{matches:w}=Ot.useContext(pl),{pathname:b}=xu(),P=JSON.stringify(GV(w));return Ot.useMemo(()=>HV(S,JSON.parse(P),b,A==="path"),[S,P,b,A])}function eK(S,A){return qV(S,A)}function qV(S,A,w,b){var zt;Ri(lS(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:P,static:x}=Ot.useContext(_c),{matches:H}=Ot.useContext(pl),J=H[H.length-1],X=J?J.params:{},G=J?J.pathname:"/",Z=J?J.pathnameBase:"/",ot=J&&J.route;{let Bt=ot&&ot.path||"";XV(G,!ot||Bt.endsWith("*")||Bt.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${G}" (under <Route path="${Bt}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Bt}"> to <Route path="${Bt==="/"?"*":`${Bt}/*`}">.`)}let mt=xu(),Vt;if(A){let Bt=typeof A=="string"?Cm(A):A;Ri(Z==="/"||((zt=Bt.pathname)==null?void 0:zt.startsWith(Z)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${Z}" but pathname "${Bt.pathname}" was given in the \`location\` prop.`),Vt=Bt}else Vt=mt;let it=Vt.pathname||"/",xt=it;if(Z!=="/"){let Bt=Z.replace(/^\//,"").split("/");xt="/"+it.replace(/^\//,"").split("/").slice(Bt.length).join("/")}let yt=!x&&w&&w.matches&&w.matches.length>0?w.matches:BV(S,{pathname:xt});mc(ot||yt!=null,`No routes matched location "${Vt.pathname}${Vt.search}${Vt.hash}" `),mc(yt==null||yt[yt.length-1].route.element!==void 0||yt[yt.length-1].route.Component!==void 0||yt[yt.length-1].route.lazy!==void 0,`Matched leaf route at location "${Vt.pathname}${Vt.search}${Vt.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let kt=sK(yt&&yt.map(Bt=>Object.assign({},Bt,{params:Object.assign({},X,Bt.params),pathname:dl([Z,P.encodeLocation?P.encodeLocation(Bt.pathname).pathname:Bt.pathname]),pathnameBase:Bt.pathnameBase==="/"?Z:dl([Z,P.encodeLocation?P.encodeLocation(Bt.pathnameBase).pathname:Bt.pathnameBase])})),H,w,b);return A&&kt?Ot.createElement(cS.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Vt},navigationType:"POP"}},kt):kt}function nK(){let S=dK(),A=q8(S)?`${S.status} ${S.statusText}`:S instanceof Error?S.message:JSON.stringify(S),w=S instanceof Error?S.stack:null,b="rgba(200,200,200, 0.5)",P={padding:"0.5rem",backgroundColor:b},x={padding:"2px 4px",backgroundColor:b},H=null;return console.error("Error handled by React Router default ErrorBoundary:",S),H=Ot.createElement(Ot.Fragment,null,Ot.createElement("p",null,"💿 Hey developer 👋"),Ot.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ot.createElement("code",{style:x},"ErrorBoundary")," or"," ",Ot.createElement("code",{style:x},"errorElement")," prop on your route.")),Ot.createElement(Ot.Fragment,null,Ot.createElement("h2",null,"Unexpected Application Error!"),Ot.createElement("h3",{style:{fontStyle:"italic"}},A),w?Ot.createElement("pre",{style:P},w):null,H)}var iK=Ot.createElement(nK,null),rK=class extends Ot.Component{constructor(S){super(S),this.state={location:S.location,revalidation:S.revalidation,error:S.error}}static getDerivedStateFromError(S){return{error:S}}static getDerivedStateFromProps(S,A){return A.location!==S.location||A.revalidation!=="idle"&&S.revalidation==="idle"?{error:S.error,location:S.location,revalidation:S.revalidation}:{error:S.error!==void 0?S.error:A.error,location:A.location,revalidation:S.revalidation||A.revalidation}}componentDidCatch(S,A){console.error("React Router caught the following error during render",S,A)}render(){return this.state.error!==void 0?Ot.createElement(pl.Provider,{value:this.props.routeContext},Ot.createElement(Bw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function aK({routeContext:S,match:A,children:w}){let b=Ot.useContext(Am);return b&&b.static&&b.staticContext&&(A.route.errorElement||A.route.ErrorBoundary)&&(b.staticContext._deepestRenderedBoundaryId=A.route.id),Ot.createElement(pl.Provider,{value:S},w)}function sK(S,A=[],w=null,b=null){if(S==null){if(!w)return null;if(w.errors)S=w.matches;else if(A.length===0&&!w.initialized&&w.matches.length>0)S=w.matches;else return null}let P=S,x=w==null?void 0:w.errors;if(x!=null){let X=P.findIndex(G=>G.route.id&&(x==null?void 0:x[G.route.id])!==void 0);Ri(X>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(x).join(",")}`),P=P.slice(0,Math.min(P.length,X+1))}let H=!1,J=-1;if(w)for(let X=0;X<P.length;X++){let G=P[X];if((G.route.HydrateFallback||G.route.hydrateFallbackElement)&&(J=X),G.route.id){let{loaderData:Z,errors:ot}=w,mt=G.route.loader&&!Z.hasOwnProperty(G.route.id)&&(!ot||ot[G.route.id]===void 0);if(G.route.lazy||mt){H=!0,J>=0?P=P.slice(0,J+1):P=[P[0]];break}}}return P.reduceRight((X,G,Z)=>{let ot,mt=!1,Vt=null,it=null;w&&(ot=x&&G.route.id?x[G.route.id]:void 0,Vt=G.route.errorElement||iK,H&&(J<0&&Z===0?(XV("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),mt=!0,it=null):J===Z&&(mt=!0,it=G.route.hydrateFallbackElement||null)));let xt=A.concat(P.slice(0,Z+1)),yt=()=>{let kt;return ot?kt=Vt:mt?kt=it:G.route.Component?kt=Ot.createElement(G.route.Component,null):G.route.element?kt=G.route.element:kt=X,Ot.createElement(aK,{match:G,routeContext:{outlet:X,matches:xt,isDataRoute:w!=null},children:kt})};return w&&(G.route.ErrorBoundary||G.route.errorElement||Z===0)?Ot.createElement(rK,{location:w.location,revalidation:w.revalidation,component:Vt,error:ot,children:yt(),routeContext:{outlet:null,matches:xt,isDataRoute:!0}}):yt()},null)}function Fw(S){return`${S} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function oK(S){let A=Ot.useContext(Am);return Ri(A,Fw(S)),A}function cK(S){let A=Ot.useContext(mC);return Ri(A,Fw(S)),A}function lK(S){let A=Ot.useContext(pl);return Ri(A,Fw(S)),A}function jw(S){let A=lK(S),w=A.matches[A.matches.length-1];return Ri(w.route.id,`${S} can only be used on routes that contain a unique "id"`),w.route.id}function uK(){return jw("useRouteId")}function dK(){var b;let S=Ot.useContext(Bw),A=cK("useRouteError"),w=jw("useRouteError");return S!==void 0?S:(b=A.errors)==null?void 0:b[w]}function hK(){let{router:S}=oK("useNavigate"),A=jw("useNavigate"),w=Ot.useRef(!1);return zV(()=>{w.current=!0}),Ot.useCallback(async(P,x={})=>{mc(w.current,YV),w.current&&(typeof P=="number"?S.navigate(P):await S.navigate(P,{fromRouteId:A,...x}))},[S,A])}var _V={};function XV(S,A,w){!A&&!_V[S]&&(_V[S]=!0,mc(!1,w))}Ot.memo(pK);function pK({routes:S,future:A,state:w}){return qV(S,void 0,w,A)}function ww(S){Ri(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function fK({basename:S="/",children:A=null,location:w,navigationType:b="POP",navigator:P,static:x=!1}){Ri(!lS(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let H=S.replace(/^\/*/,"/"),J=Ot.useMemo(()=>({basename:H,navigator:P,static:x,future:{}}),[H,P,x]);typeof w=="string"&&(w=Cm(w));let{pathname:X="/",search:G="",hash:Z="",state:ot=null,key:mt="default"}=w,Vt=Ot.useMemo(()=>{let it=hl(X,H);return it==null?null:{location:{pathname:it,search:G,hash:Z,state:ot,key:mt},navigationType:b}},[H,X,G,Z,ot,mt,b]);return mc(Vt!=null,`<Router basename="${H}"> is not able to match the URL "${X}${G}${Z}" because it does not start with the basename, so the <Router> won't render anything.`),Vt==null?null:Ot.createElement(_c.Provider,{value:J},Ot.createElement(cS.Provider,{children:A,value:Vt}))}function mK({children:S,location:A}){return eK(Nw(S),A)}function Nw(S,A=[]){let w=[];return Ot.Children.forEach(S,(b,P)=>{if(!Ot.isValidElement(b))return;let x=[...A,P];if(b.type===Ot.Fragment){w.push.apply(w,Nw(b.props.children,x));return}Ri(b.type===ww,`[${typeof b.type=="string"?b.type:b.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ri(!b.props.index||!b.props.children,"An index route cannot have child routes.");let H={id:b.props.id||x.join("-"),caseSensitive:b.props.caseSensitive,element:b.props.element,Component:b.props.Component,index:b.props.index,path:b.props.path,loader:b.props.loader,action:b.props.action,hydrateFallbackElement:b.props.hydrateFallbackElement,HydrateFallback:b.props.HydrateFallback,errorElement:b.props.errorElement,ErrorBoundary:b.props.ErrorBoundary,hasErrorBoundary:b.props.hasErrorBoundary===!0||b.props.ErrorBoundary!=null||b.props.errorElement!=null,shouldRevalidate:b.props.shouldRevalidate,handle:b.props.handle,lazy:b.props.lazy};b.props.children&&(H.children=Nw(b.props.children,x)),w.push(H)}),w}var sC="get",oC="application/x-www-form-urlencoded";function _C(S){return S!=null&&typeof S.tagName=="string"}function _K(S){return _C(S)&&S.tagName.toLowerCase()==="button"}function EK(S){return _C(S)&&S.tagName.toLowerCase()==="form"}function gK(S){return _C(S)&&S.tagName.toLowerCase()==="input"}function SK(S){return!!(S.metaKey||S.altKey||S.ctrlKey||S.shiftKey)}function TK(S,A){return S.button===0&&(!A||A==="_self")&&!SK(S)}var aC=null;function RK(){if(aC===null)try{new FormData(document.createElement("form"),0),aC=!1}catch{aC=!0}return aC}var vK=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Sw(S){return S!=null&&!vK.has(S)?(mc(!1,`"${S}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${oC}"`),null):S}function yK(S,A){let w,b,P,x,H;if(EK(S)){let J=S.getAttribute("action");b=J?hl(J,A):null,w=S.getAttribute("method")||sC,P=Sw(S.getAttribute("enctype"))||oC,x=new FormData(S)}else if(_K(S)||gK(S)&&(S.type==="submit"||S.type==="image")){let J=S.form;if(J==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let X=S.getAttribute("formaction")||J.getAttribute("action");if(b=X?hl(X,A):null,w=S.getAttribute("formmethod")||J.getAttribute("method")||sC,P=Sw(S.getAttribute("formenctype"))||Sw(J.getAttribute("enctype"))||oC,x=new FormData(J,S),!RK()){let{name:G,type:Z,value:ot}=S;if(Z==="image"){let mt=G?`${G}.`:"";x.append(`${mt}x`,"0"),x.append(`${mt}y`,"0")}else G&&x.append(G,ot)}}else{if(_C(S))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');w=sC,b=null,P=oC,H=S}return x&&P==="text/plain"&&(H=x,x=void 0),{action:b,method:w.toLowerCase(),encType:P,formData:x,body:H}}function Gw(S,A){if(S===!1||S===null||typeof S>"u")throw new Error(A)}async function CK(S,A){if(S.id in A)return A[S.id];try{let w=await import(S.module);return A[S.id]=w,w}catch(w){return console.error(`Error loading route module \`${S.module}\`, reloading page...`),console.error(w),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function AK(S){return S==null?!1:S.href==null?S.rel==="preload"&&typeof S.imageSrcSet=="string"&&typeof S.imageSizes=="string":typeof S.rel=="string"&&typeof S.href=="string"}async function bK(S,A,w){let b=await Promise.all(S.map(async P=>{let x=A.routes[P.route.id];if(x){let H=await CK(x,w);return H.links?H.links():[]}return[]}));return NK(b.flat(1).filter(AK).filter(P=>P.rel==="stylesheet"||P.rel==="preload").map(P=>P.rel==="stylesheet"?{...P,rel:"prefetch",as:"style"}:{...P,rel:"prefetch"}))}function EV(S,A,w,b,P,x){let H=(X,G)=>w[G]?X.route.id!==w[G].route.id:!0,J=(X,G)=>{var Z;return w[G].pathname!==X.pathname||((Z=w[G].route.path)==null?void 0:Z.endsWith("*"))&&w[G].params["*"]!==X.params["*"]};return x==="assets"?A.filter((X,G)=>H(X,G)||J(X,G)):x==="data"?A.filter((X,G)=>{var ot;let Z=b.routes[X.route.id];if(!Z||!Z.hasLoader)return!1;if(H(X,G)||J(X,G))return!0;if(X.route.shouldRevalidate){let mt=X.route.shouldRevalidate({currentUrl:new URL(P.pathname+P.search+P.hash,window.origin),currentParams:((ot=w[0])==null?void 0:ot.params)||{},nextUrl:new URL(S,window.origin),nextParams:X.params,defaultShouldRevalidate:!0});if(typeof mt=="boolean")return mt}return!0}):[]}function IK(S,A,{includeHydrateFallback:w}={}){return OK(S.map(b=>{let P=A.routes[b.route.id];if(!P)return[];let x=[P.module];return P.clientActionModule&&(x=x.concat(P.clientActionModule)),P.clientLoaderModule&&(x=x.concat(P.clientLoaderModule)),w&&P.hydrateFallbackModule&&(x=x.concat(P.hydrateFallbackModule)),P.imports&&(x=x.concat(P.imports)),x}).flat(1))}function OK(S){return[...new Set(S)]}function wK(S){let A={},w=Object.keys(S).sort();for(let b of w)A[b]=S[b];return A}function NK(S,A){let w=new Set;return new Set(A),S.reduce((b,P)=>{let x=JSON.stringify(wK(P));return w.has(x)||(w.add(x),b.push({key:x,link:P})),b},[])}var DK=new Set([100,101,204,205]);function LK(S,A){let w=typeof S=="string"?new URL(S,typeof window>"u"?"server://singlefetch/":window.location.origin):S;return w.pathname==="/"?w.pathname="_root.data":A&&hl(w.pathname,A)==="/"?w.pathname=`${A.replace(/\/$/,"")}/_root.data`:w.pathname=`${w.pathname.replace(/\/$/,"")}.data`,w}function JV(){let S=Ot.useContext(Am);return Gw(S,"You must render this element inside a <DataRouterContext.Provider> element"),S}function PK(){let S=Ot.useContext(mC);return Gw(S,"You must render this element inside a <DataRouterStateContext.Provider> element"),S}var Hw=Ot.createContext(void 0);Hw.displayName="FrameworkContext";function QV(){let S=Ot.useContext(Hw);return Gw(S,"You must render this element inside a <HydratedRouter> element"),S}function kK(S,A){let w=Ot.useContext(Hw),[b,P]=Ot.useState(!1),[x,H]=Ot.useState(!1),{onFocus:J,onBlur:X,onMouseEnter:G,onMouseLeave:Z,onTouchStart:ot}=A,mt=Ot.useRef(null);Ot.useEffect(()=>{if(S==="render"&&H(!0),S==="viewport"){let xt=kt=>{kt.forEach(zt=>{H(zt.isIntersecting)})},yt=new IntersectionObserver(xt,{threshold:.5});return mt.current&&yt.observe(mt.current),()=>{yt.disconnect()}}},[S]),Ot.useEffect(()=>{if(b){let xt=setTimeout(()=>{H(!0)},100);return()=>{clearTimeout(xt)}}},[b]);let Vt=()=>{P(!0)},it=()=>{P(!1),H(!1)};return w?S!=="intent"?[x,mt,{}]:[x,mt,{onFocus:nS(J,Vt),onBlur:nS(X,it),onMouseEnter:nS(G,Vt),onMouseLeave:nS(Z,it),onTouchStart:nS(ot,Vt)}]:[!1,mt,{}]}function nS(S,A){return w=>{S&&S(w),w.defaultPrevented||A(w)}}function MK({page:S,...A}){let{router:w}=JV(),b=Ot.useMemo(()=>BV(w.routes,S,w.basename),[w.routes,S,w.basename]);return b?Ot.createElement(xK,{page:S,matches:b,...A}):null}function UK(S){let{manifest:A,routeModules:w}=QV(),[b,P]=Ot.useState([]);return Ot.useEffect(()=>{let x=!1;return bK(S,A,w).then(H=>{x||P(H)}),()=>{x=!0}},[S,A,w]),b}function xK({page:S,matches:A,...w}){let b=xu(),{manifest:P,routeModules:x}=QV(),{basename:H}=JV(),{loaderData:J,matches:X}=PK(),G=Ot.useMemo(()=>EV(S,A,X,P,b,"data"),[S,A,X,P,b]),Z=Ot.useMemo(()=>EV(S,A,X,P,b,"assets"),[S,A,X,P,b]),ot=Ot.useMemo(()=>{if(S===b.pathname+b.search+b.hash)return[];let it=new Set,xt=!1;if(A.forEach(kt=>{var Bt;let zt=P.routes[kt.route.id];!zt||!zt.hasLoader||(!G.some(ie=>ie.route.id===kt.route.id)&&kt.route.id in J&&((Bt=x[kt.route.id])!=null&&Bt.shouldRevalidate)||zt.hasClientLoader?xt=!0:it.add(kt.route.id))}),it.size===0)return[];let yt=LK(S,H);return xt&&it.size>0&&yt.searchParams.set("_routes",A.filter(kt=>it.has(kt.route.id)).map(kt=>kt.route.id).join(",")),[yt.pathname+yt.search]},[H,J,b,P,G,A,S,x]),mt=Ot.useMemo(()=>IK(Z,P),[Z,P]),Vt=UK(Z);return Ot.createElement(Ot.Fragment,null,ot.map(it=>Ot.createElement("link",{key:it,rel:"prefetch",as:"fetch",href:it,...w})),mt.map(it=>Ot.createElement("link",{key:it,rel:"modulepreload",href:it,...w})),Vt.map(({key:it,link:xt})=>Ot.createElement("link",{key:it,...xt})))}function VK(...S){return A=>{S.forEach(w=>{typeof w=="function"?w(A):w!=null&&(w.current=A)})}}var ZV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ZV&&(window.__reactRouterVersion="7.5.2")}catch{}function BK({basename:S,children:A,window:w}){let b=Ot.useRef();b.current==null&&(b.current=b8({window:w,v5Compat:!0}));let P=b.current,[x,H]=Ot.useState({action:P.action,location:P.location}),J=Ot.useCallback(X=>{Ot.startTransition(()=>H(X))},[H]);return Ot.useLayoutEffect(()=>P.listen(J),[P,J]),Ot.createElement(fK,{basename:S,children:A,location:x.location,navigationType:x.action,navigator:P})}var $V=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,tB=Ot.forwardRef(function({onClick:A,discover:w="render",prefetch:b="none",relative:P,reloadDocument:x,replace:H,state:J,target:X,to:G,preventScrollReset:Z,viewTransition:ot,...mt},Vt){let{basename:it}=Ot.useContext(_c),xt=typeof G=="string"&&$V.test(G),yt,kt=!1;if(typeof G=="string"&&xt&&(yt=G,ZV))try{let Tn=new URL(window.location.href),oi=G.startsWith("//")?new URL(Tn.protocol+G):new URL(G),er=hl(oi.pathname,it);oi.origin===Tn.origin&&er!=null?G=er+oi.search+oi.hash:kt=!0}catch{mc(!1,`<Link to="${G}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let zt=Z8(G,{relative:P}),[Bt,ie,te]=kK(b,mt),fn=HK(G,{replace:H,state:J,target:X,preventScrollReset:Z,relative:P,viewTransition:ot});function Le(Tn){A&&A(Tn),Tn.defaultPrevented||fn(Tn)}let Cn=Ot.createElement("a",{...mt,...te,href:yt||zt,onClick:kt||x?A:Le,ref:VK(Vt,ie),target:X,"data-discover":!xt&&w==="render"?"true":void 0});return Bt&&!xt?Ot.createElement(Ot.Fragment,null,Cn,Ot.createElement(MK,{page:zt})):Cn});tB.displayName="Link";var FK=Ot.forwardRef(function({"aria-current":A="page",caseSensitive:w=!1,className:b="",end:P=!1,style:x,to:H,viewTransition:J,children:X,...G},Z){let ot=uS(H,{relative:G.relative}),mt=xu(),Vt=Ot.useContext(mC),{navigator:it,basename:xt}=Ot.useContext(_c),yt=Vt!=null&&qK(ot)&&J===!0,kt=it.encodeLocation?it.encodeLocation(ot).pathname:ot.pathname,zt=mt.pathname,Bt=Vt&&Vt.navigation&&Vt.navigation.location?Vt.navigation.location.pathname:null;w||(zt=zt.toLowerCase(),Bt=Bt?Bt.toLowerCase():null,kt=kt.toLowerCase()),Bt&&xt&&(Bt=hl(Bt,xt)||Bt);const ie=kt!=="/"&&kt.endsWith("/")?kt.length-1:kt.length;let te=zt===kt||!P&&zt.startsWith(kt)&&zt.charAt(ie)==="/",fn=Bt!=null&&(Bt===kt||!P&&Bt.startsWith(kt)&&Bt.charAt(kt.length)==="/"),Le={isActive:te,isPending:fn,isTransitioning:yt},Cn=te?A:void 0,Tn;typeof b=="function"?Tn=b(Le):Tn=[b,te?"active":null,fn?"pending":null,yt?"transitioning":null].filter(Boolean).join(" ");let oi=typeof x=="function"?x(Le):x;return Ot.createElement(tB,{...G,"aria-current":Cn,className:Tn,ref:Z,style:oi,to:H,viewTransition:J},typeof X=="function"?X(Le):X)});FK.displayName="NavLink";var jK=Ot.forwardRef(({discover:S="render",fetcherKey:A,navigate:w,reloadDocument:b,replace:P,state:x,method:H=sC,action:J,onSubmit:X,relative:G,preventScrollReset:Z,viewTransition:ot,...mt},Vt)=>{let it=YK(),xt=zK(J,{relative:G}),yt=H.toLowerCase()==="get"?"get":"post",kt=typeof J=="string"&&$V.test(J),zt=Bt=>{if(X&&X(Bt),Bt.defaultPrevented)return;Bt.preventDefault();let ie=Bt.nativeEvent.submitter,te=(ie==null?void 0:ie.getAttribute("formmethod"))||H;it(ie||Bt.currentTarget,{fetcherKey:A,method:te,navigate:w,replace:P,state:x,relative:G,preventScrollReset:Z,viewTransition:ot})};return Ot.createElement("form",{ref:Vt,method:yt,action:xt,onSubmit:b?X:zt,...mt,"data-discover":!kt&&S==="render"?"true":void 0})});jK.displayName="Form";function GK(S){return`${S} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function eB(S){let A=Ot.useContext(Am);return Ri(A,GK(S)),A}function HK(S,{target:A,replace:w,state:b,preventScrollReset:P,relative:x,viewTransition:H}={}){let J=$8(),X=xu(),G=uS(S,{relative:x});return Ot.useCallback(Z=>{if(TK(Z,A)){Z.preventDefault();let ot=w!==void 0?w:sS(X)===sS(G);J(S,{replace:ot,state:b,preventScrollReset:P,relative:x,viewTransition:H})}},[X,J,G,w,b,A,S,P,x,H])}var WK=0,KK=()=>`__${String(++WK)}__`;function YK(){let{router:S}=eB("useSubmit"),{basename:A}=Ot.useContext(_c),w=uK();return Ot.useCallback(async(b,P={})=>{let{action:x,method:H,encType:J,formData:X,body:G}=yK(b,A);if(P.navigate===!1){let Z=P.fetcherKey||KK();await S.fetch(Z,w,P.action||x,{preventScrollReset:P.preventScrollReset,formData:X,body:G,formMethod:P.method||H,formEncType:P.encType||J,flushSync:P.flushSync})}else await S.navigate(P.action||x,{preventScrollReset:P.preventScrollReset,formData:X,body:G,formMethod:P.method||H,formEncType:P.encType||J,replace:P.replace,state:P.state,fromRouteId:w,flushSync:P.flushSync,viewTransition:P.viewTransition})},[S,A,w])}function zK(S,{relative:A}={}){let{basename:w}=Ot.useContext(_c),b=Ot.useContext(pl);Ri(b,"useFormAction must be used inside a RouteContext");let[P]=b.matches.slice(-1),x={...uS(S||".",{relative:A})},H=xu();if(S==null){x.search=H.search;let J=new URLSearchParams(x.search),X=J.getAll("index");if(X.some(Z=>Z==="")){J.delete("index"),X.filter(ot=>ot).forEach(ot=>J.append("index",ot));let Z=J.toString();x.search=Z?`?${Z}`:""}}return(!S||S===".")&&P.route.index&&(x.search=x.search?x.search.replace(/^\?/,"?index&"):"?index"),w!=="/"&&(x.pathname=x.pathname==="/"?w:dl([w,x.pathname])),sS(x)}function qK(S,A={}){let w=Ot.useContext(KV);Ri(w!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:b}=eB("useViewTransitionState"),P=uS(S,{relative:A.relative});if(!w.isTransitioning)return!1;let x=hl(w.currentLocation.pathname,b)||w.currentLocation.pathname,H=hl(w.nextLocation.pathname,b)||w.nextLocation.pathname;return hC(P.pathname,H)!=null||hC(P.pathname,x)!=null}new TextEncoder;[...DK];var Tw={exports:{}},jr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gV;function XK(){if(gV)return jr;gV=1;var S=Vw();function A(X){var G="https://react.dev/errors/"+X;if(1<arguments.length){G+="?args[]="+encodeURIComponent(arguments[1]);for(var Z=2;Z<arguments.length;Z++)G+="&args[]="+encodeURIComponent(arguments[Z])}return"Minified React error #"+X+"; visit "+G+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function w(){}var b={d:{f:w,r:function(){throw Error(A(522))},D:w,C:w,L:w,m:w,X:w,S:w,M:w},p:0,findDOMNode:null},P=Symbol.for("react.portal");function x(X,G,Z){var ot=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:ot==null?null:""+ot,children:X,containerInfo:G,implementation:Z}}var H=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function J(X,G){if(X==="font")return"";if(typeof G=="string")return G==="use-credentials"?G:""}return jr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=b,jr.createPortal=function(X,G){var Z=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!G||G.nodeType!==1&&G.nodeType!==9&&G.nodeType!==11)throw Error(A(299));return x(X,G,null,Z)},jr.flushSync=function(X){var G=H.T,Z=b.p;try{if(H.T=null,b.p=2,X)return X()}finally{H.T=G,b.p=Z,b.d.f()}},jr.preconnect=function(X,G){typeof X=="string"&&(G?(G=G.crossOrigin,G=typeof G=="string"?G==="use-credentials"?G:"":void 0):G=null,b.d.C(X,G))},jr.prefetchDNS=function(X){typeof X=="string"&&b.d.D(X)},jr.preinit=function(X,G){if(typeof X=="string"&&G&&typeof G.as=="string"){var Z=G.as,ot=J(Z,G.crossOrigin),mt=typeof G.integrity=="string"?G.integrity:void 0,Vt=typeof G.fetchPriority=="string"?G.fetchPriority:void 0;Z==="style"?b.d.S(X,typeof G.precedence=="string"?G.precedence:void 0,{crossOrigin:ot,integrity:mt,fetchPriority:Vt}):Z==="script"&&b.d.X(X,{crossOrigin:ot,integrity:mt,fetchPriority:Vt,nonce:typeof G.nonce=="string"?G.nonce:void 0})}},jr.preinitModule=function(X,G){if(typeof X=="string")if(typeof G=="object"&&G!==null){if(G.as==null||G.as==="script"){var Z=J(G.as,G.crossOrigin);b.d.M(X,{crossOrigin:Z,integrity:typeof G.integrity=="string"?G.integrity:void 0,nonce:typeof G.nonce=="string"?G.nonce:void 0})}}else G==null&&b.d.M(X)},jr.preload=function(X,G){if(typeof X=="string"&&typeof G=="object"&&G!==null&&typeof G.as=="string"){var Z=G.as,ot=J(Z,G.crossOrigin);b.d.L(X,Z,{crossOrigin:ot,integrity:typeof G.integrity=="string"?G.integrity:void 0,nonce:typeof G.nonce=="string"?G.nonce:void 0,type:typeof G.type=="string"?G.type:void 0,fetchPriority:typeof G.fetchPriority=="string"?G.fetchPriority:void 0,referrerPolicy:typeof G.referrerPolicy=="string"?G.referrerPolicy:void 0,imageSrcSet:typeof G.imageSrcSet=="string"?G.imageSrcSet:void 0,imageSizes:typeof G.imageSizes=="string"?G.imageSizes:void 0,media:typeof G.media=="string"?G.media:void 0})}},jr.preloadModule=function(X,G){if(typeof X=="string")if(G){var Z=J(G.as,G.crossOrigin);b.d.m(X,{as:typeof G.as=="string"&&G.as!=="script"?G.as:void 0,crossOrigin:Z,integrity:typeof G.integrity=="string"?G.integrity:void 0})}else b.d.m(X)},jr.requestFormReset=function(X){b.d.r(X)},jr.unstable_batchedUpdates=function(X,G){return X(G)},jr.useFormState=function(X,G,Z){return H.H.useFormState(X,G,Z)},jr.useFormStatus=function(){return H.H.useHostTransitionStatus()},jr.version="19.1.0",jr}var SV;function JK(){if(SV)return Tw.exports;SV=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(A){console.error(A)}}return S(),Tw.exports=XK(),Tw.exports}var Rw={exports:{}},iS={},vw={exports:{}},yw={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TV;function QK(){return TV||(TV=1,function(S){function A(gt,Jt){var he=gt.length;gt.push(Jt);t:for(;0<he;){var ve=he-1>>>1,tt=gt[ve];if(0<P(tt,Jt))gt[ve]=Jt,gt[he]=tt,he=ve;else break t}}function w(gt){return gt.length===0?null:gt[0]}function b(gt){if(gt.length===0)return null;var Jt=gt[0],he=gt.pop();if(he!==Jt){gt[0]=he;t:for(var ve=0,tt=gt.length,Ut=tt>>>1;ve<Ut;){var Zt=2*(ve+1)-1,qt=gt[Zt],ne=Zt+1,Ze=gt[ne];if(0>P(qt,he))ne<tt&&0>P(Ze,qt)?(gt[ve]=Ze,gt[ne]=he,ve=ne):(gt[ve]=qt,gt[Zt]=he,ve=Zt);else if(ne<tt&&0>P(Ze,he))gt[ve]=Ze,gt[ne]=he,ve=ne;else break t}}return Jt}function P(gt,Jt){var he=gt.sortIndex-Jt.sortIndex;return he!==0?he:gt.id-Jt.id}if(S.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var x=performance;S.unstable_now=function(){return x.now()}}else{var H=Date,J=H.now();S.unstable_now=function(){return H.now()-J}}var X=[],G=[],Z=1,ot=null,mt=3,Vt=!1,it=!1,xt=!1,yt=!1,kt=typeof setTimeout=="function"?setTimeout:null,zt=typeof clearTimeout=="function"?clearTimeout:null,Bt=typeof setImmediate<"u"?setImmediate:null;function ie(gt){for(var Jt=w(G);Jt!==null;){if(Jt.callback===null)b(G);else if(Jt.startTime<=gt)b(G),Jt.sortIndex=Jt.expirationTime,A(X,Jt);else break;Jt=w(G)}}function te(gt){if(xt=!1,ie(gt),!it)if(w(X)!==null)it=!0,fn||(fn=!0,pi());else{var Jt=w(G);Jt!==null&&In(te,Jt.startTime-gt)}}var fn=!1,Le=-1,Cn=5,Tn=-1;function oi(){return yt?!0:!(S.unstable_now()-Tn<Cn)}function er(){if(yt=!1,fn){var gt=S.unstable_now();Tn=gt;var Jt=!0;try{t:{it=!1,xt&&(xt=!1,zt(Le),Le=-1),Vt=!0;var he=mt;try{e:{for(ie(gt),ot=w(X);ot!==null&&!(ot.expirationTime>gt&&oi());){var ve=ot.callback;if(typeof ve=="function"){ot.callback=null,mt=ot.priorityLevel;var tt=ve(ot.expirationTime<=gt);if(gt=S.unstable_now(),typeof tt=="function"){ot.callback=tt,ie(gt),Jt=!0;break e}ot===w(X)&&b(X),ie(gt)}else b(X);ot=w(X)}if(ot!==null)Jt=!0;else{var Ut=w(G);Ut!==null&&In(te,Ut.startTime-gt),Jt=!1}}break t}finally{ot=null,mt=he,Vt=!1}Jt=void 0}}finally{Jt?pi():fn=!1}}}var pi;if(typeof Bt=="function")pi=function(){Bt(er)};else if(typeof MessageChannel<"u"){var An=new MessageChannel,Qe=An.port2;An.port1.onmessage=er,pi=function(){Qe.postMessage(null)}}else pi=function(){kt(er,0)};function In(gt,Jt){Le=kt(function(){gt(S.unstable_now())},Jt)}S.unstable_IdlePriority=5,S.unstable_ImmediatePriority=1,S.unstable_LowPriority=4,S.unstable_NormalPriority=3,S.unstable_Profiling=null,S.unstable_UserBlockingPriority=2,S.unstable_cancelCallback=function(gt){gt.callback=null},S.unstable_forceFrameRate=function(gt){0>gt||125<gt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Cn=0<gt?Math.floor(1e3/gt):5},S.unstable_getCurrentPriorityLevel=function(){return mt},S.unstable_next=function(gt){switch(mt){case 1:case 2:case 3:var Jt=3;break;default:Jt=mt}var he=mt;mt=Jt;try{return gt()}finally{mt=he}},S.unstable_requestPaint=function(){yt=!0},S.unstable_runWithPriority=function(gt,Jt){switch(gt){case 1:case 2:case 3:case 4:case 5:break;default:gt=3}var he=mt;mt=gt;try{return Jt()}finally{mt=he}},S.unstable_scheduleCallback=function(gt,Jt,he){var ve=S.unstable_now();switch(typeof he=="object"&&he!==null?(he=he.delay,he=typeof he=="number"&&0<he?ve+he:ve):he=ve,gt){case 1:var tt=-1;break;case 2:tt=250;break;case 5:tt=1073741823;break;case 4:tt=1e4;break;default:tt=5e3}return tt=he+tt,gt={id:Z++,callback:Jt,priorityLevel:gt,startTime:he,expirationTime:tt,sortIndex:-1},he>ve?(gt.sortIndex=he,A(G,gt),w(X)===null&&gt===w(G)&&(xt?(zt(Le),Le=-1):xt=!0,In(te,he-ve))):(gt.sortIndex=tt,A(X,gt),it||Vt||(it=!0,fn||(fn=!0,pi()))),gt},S.unstable_shouldYield=oi,S.unstable_wrapCallback=function(gt){var Jt=mt;return function(){var he=mt;mt=Jt;try{return gt.apply(this,arguments)}finally{mt=he}}}}(yw)),yw}var RV;function ZK(){return RV||(RV=1,vw.exports=QK()),vw.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vV;function $K(){if(vV)return iS;vV=1;var S=ZK(),A=Vw(),w=JK();function b(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function P(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function x(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function H(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function J(a){if(x(a)!==a)throw Error(b(188))}function X(a){var o=a.alternate;if(!o){if(o=x(a),o===null)throw Error(b(188));return o!==a?null:a}for(var u=a,f=o;;){var E=u.return;if(E===null)break;var R=E.alternate;if(R===null){if(f=E.return,f!==null){u=f;continue}break}if(E.child===R.child){for(R=E.child;R;){if(R===u)return J(E),a;if(R===f)return J(E),o;R=R.sibling}throw Error(b(188))}if(u.return!==f.return)u=E,f=R;else{for(var k=!1,B=E.child;B;){if(B===u){k=!0,u=E,f=R;break}if(B===f){k=!0,f=E,u=R;break}B=B.sibling}if(!k){for(B=R.child;B;){if(B===u){k=!0,u=R,f=E;break}if(B===f){k=!0,f=R,u=E;break}B=B.sibling}if(!k)throw Error(b(189))}}if(u.alternate!==f)throw Error(b(190))}if(u.tag!==3)throw Error(b(188));return u.stateNode.current===u?a:o}function G(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=G(a),o!==null)return o;a=a.sibling}return null}var Z=Object.assign,ot=Symbol.for("react.element"),mt=Symbol.for("react.transitional.element"),Vt=Symbol.for("react.portal"),it=Symbol.for("react.fragment"),xt=Symbol.for("react.strict_mode"),yt=Symbol.for("react.profiler"),kt=Symbol.for("react.provider"),zt=Symbol.for("react.consumer"),Bt=Symbol.for("react.context"),ie=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),fn=Symbol.for("react.suspense_list"),Le=Symbol.for("react.memo"),Cn=Symbol.for("react.lazy"),Tn=Symbol.for("react.activity"),oi=Symbol.for("react.memo_cache_sentinel"),er=Symbol.iterator;function pi(a){return a===null||typeof a!="object"?null:(a=er&&a[er]||a["@@iterator"],typeof a=="function"?a:null)}var An=Symbol.for("react.client.reference");function Qe(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===An?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case it:return"Fragment";case yt:return"Profiler";case xt:return"StrictMode";case te:return"Suspense";case fn:return"SuspenseList";case Tn:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case Vt:return"Portal";case Bt:return(a.displayName||"Context")+".Provider";case zt:return(a._context.displayName||"Context")+".Consumer";case ie:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Le:return o=a.displayName||null,o!==null?o:Qe(a.type)||"Memo";case Cn:o=a._payload,a=a._init;try{return Qe(a(o))}catch{}}return null}var In=Array.isArray,gt=A.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Jt=w.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,he={pending:!1,data:null,method:null,action:null},ve=[],tt=-1;function Ut(a){return{current:a}}function Zt(a){0>tt||(a.current=ve[tt],ve[tt]=null,tt--)}function qt(a,o){tt++,ve[tt]=a.current,a.current=o}var ne=Ut(null),Ze=Ut(null),fe=Ut(null),Hr=Ut(null);function Jn(a,o){switch(qt(fe,o),qt(Ze,a),qt(ne,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?RR(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=RR(o),a=vR(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Zt(ne),qt(ne,a)}function Ka(){Zt(ne),Zt(Ze),Zt(fe)}function Om(a){a.memoizedState!==null&&qt(Hr,a);var o=ne.current,u=vR(o,a.type);o!==u&&(qt(Ze,a),qt(ne,u))}function Ec(a){Ze.current===a&&(Zt(ne),Zt(Ze)),Hr.current===a&&(Zt(Hr),cu._currentValue=he)}var ho=Object.prototype.hasOwnProperty,wm=S.unstable_scheduleCallback,Nm=S.unstable_cancelCallback,fl=S.unstable_shouldYield,CC=S.unstable_requestPaint,Ya=S.unstable_now,po=S.unstable_getCurrentPriorityLevel,Dm=S.unstable_ImmediatePriority,pS=S.unstable_UserBlockingPriority,Wi=S.unstable_NormalPriority,Wr=S.unstable_LowPriority,Mh=S.unstable_IdlePriority,Lm=S.log,AC=S.unstable_setDisableYieldValue,ml=null,Mn=null;function ur(a){if(typeof Lm=="function"&&AC(a),Mn&&typeof Mn.setStrictMode=="function")try{Mn.setStrictMode(ml,a)}catch{}}var yr=Math.clz32?Math.clz32:mS,Pm=Math.log,fS=Math.LN2;function mS(a){return a>>>=0,a===0?32:31-(Pm(a)/fS|0)|0}var Vu=256,Bu=4194304;function Kr(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Fu(a,o,u){var f=a.pendingLanes;if(f===0)return 0;var E=0,R=a.suspendedLanes,k=a.pingedLanes;a=a.warmLanes;var B=f&134217727;return B!==0?(f=B&~R,f!==0?E=Kr(f):(k&=B,k!==0?E=Kr(k):u||(u=B&~a,u!==0&&(E=Kr(u))))):(B=f&~R,B!==0?E=Kr(B):k!==0?E=Kr(k):u||(u=f&~a,u!==0&&(E=Kr(u)))),E===0?0:o!==0&&o!==E&&(o&R)===0&&(R=E&-E,u=o&-o,R>=u||R===32&&(u&4194048)!==0)?o:E}function ju(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function bC(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gc(){var a=Vu;return Vu<<=1,(Vu&4194048)===0&&(Vu=256),a}function km(){var a=Bu;return Bu<<=1,(Bu&62914560)===0&&(Bu=4194304),a}function Mm(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Gu(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function IC(a,o,u,f,E,R){var k=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var B=a.entanglements,q=a.expirationTimes,ut=a.hiddenUpdates;for(u=k&~u;0<u;){var Et=31-yr(u),Dt=1<<Et;B[Et]=0,q[Et]=-1;var ht=ut[Et];if(ht!==null)for(ut[Et]=null,Et=0;Et<ht.length;Et++){var pt=ht[Et];pt!==null&&(pt.lane&=-536870913)}u&=~Dt}f!==0&&_S(a,f,0),R!==0&&E===0&&a.tag!==0&&(a.suspendedLanes|=R&~(k&~o))}function _S(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var f=31-yr(o);a.entangledLanes|=o,a.entanglements[f]=a.entanglements[f]|1073741824|u&4194090}function _l(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var f=31-yr(u),E=1<<f;E&o|a[f]&o&&(a[f]|=o),u&=~E}}function Um(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function fo(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function ES(){var a=Jt.p;return a!==0?a:(a=window.event,a===void 0?32:GR(a.type))}function OC(a,o){var u=Jt.p;try{return Jt.p=a,o()}finally{Jt.p=u}}var mo=Math.random().toString(36).slice(2),On="__reactFiber$"+mo,Cr="__reactProps$"+mo,El="__reactContainer$"+mo,gl="__reactEvents$"+mo,gS="__reactListeners$"+mo,SS="__reactHandles$"+mo,xm="__reactResources$"+mo,Hu="__reactMarker$"+mo;function Uh(a){delete a[On],delete a[Cr],delete a[gl],delete a[gS],delete a[SS]}function Sc(a){var o=a[On];if(o)return o;for(var u=a.parentNode;u;){if(o=u[El]||u[On]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=AR(a);a!==null;){if(u=a[On])return u;a=AR(a)}return o}a=u,u=a.parentNode}return null}function Sl(a){if(a=a[On]||a[El]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function Wu(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(b(33))}function Tc(a){var o=a[xm];return o||(o=a[xm]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function vi(a){a[Hu]=!0}var Vm=new Set,Rc={};function vc(a,o){Tl(a,o),Tl(a+"Capture",o)}function Tl(a,o){for(Rc[a]=o,a=0;a<o.length;a++)Vm.add(o[a])}var za=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),TS={},RS={};function fi(a){return ho.call(RS,a)?!0:ho.call(TS,a)?!1:za.test(a)?RS[a]=!0:(TS[a]=!0,!1)}function xh(a,o,u){if(fi(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function Vh(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function Cs(a,o,u,f){if(f===null)a.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+f)}}var Bm,Bh;function Rl(a){if(Bm===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Bm=o&&o[1]||"",Bh=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Bm+a+Bh}var Fh=!1;function Fm(a,o){if(!a||Fh)return"";Fh=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var Dt=function(){throw Error()};if(Object.defineProperty(Dt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Dt,[])}catch(pt){var ht=pt}Reflect.construct(a,[],Dt)}else{try{Dt.call()}catch(pt){ht=pt}a.call(Dt.prototype)}}else{try{throw Error()}catch(pt){ht=pt}(Dt=a())&&typeof Dt.catch=="function"&&Dt.catch(function(){})}}catch(pt){if(pt&&ht&&typeof pt.stack=="string")return[pt.stack,ht.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=f.DetermineComponentFrameRoot(),k=R[0],B=R[1];if(k&&B){var q=k.split(`
`),ut=B.split(`
`);for(E=f=0;f<q.length&&!q[f].includes("DetermineComponentFrameRoot");)f++;for(;E<ut.length&&!ut[E].includes("DetermineComponentFrameRoot");)E++;if(f===q.length||E===ut.length)for(f=q.length-1,E=ut.length-1;1<=f&&0<=E&&q[f]!==ut[E];)E--;for(;1<=f&&0<=E;f--,E--)if(q[f]!==ut[E]){if(f!==1||E!==1)do if(f--,E--,0>E||q[f]!==ut[E]){var Et=`
`+q[f].replace(" at new "," at ");return a.displayName&&Et.includes("<anonymous>")&&(Et=Et.replace("<anonymous>",a.displayName)),Et}while(1<=f&&0<=E);break}}}finally{Fh=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?Rl(u):""}function wC(a){switch(a.tag){case 26:case 27:case 5:return Rl(a.type);case 16:return Rl("Lazy");case 13:return Rl("Suspense");case 19:return Rl("SuspenseList");case 0:case 15:return Fm(a.type,!1);case 11:return Fm(a.type.render,!1);case 1:return Fm(a.type,!0);case 31:return Rl("Activity");default:return""}}function vS(a){try{var o="";do o+=wC(a),a=a.return;while(a);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Ki(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function jh(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function NC(a){var o=jh(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var E=u.get,R=u.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return E.call(this)},set:function(k){f=""+k,R.call(this,k)}}),Object.defineProperty(a,o,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(k){f=""+k},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function dn(a){a._valueTracker||(a._valueTracker=NC(a))}function yS(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),f="";return a&&(f=jh(a)?a.checked?"true":"false":a.value),a=f,a!==u?(o.setValue(a),!0):!1}function Ku(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var CS=/[\n"\\]/g;function ea(a){return a.replace(CS,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function jm(a,o,u,f,E,R,k,B){a.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?a.type=k:a.removeAttribute("type"),o!=null?k==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+Ki(o)):a.value!==""+Ki(o)&&(a.value=""+Ki(o)):k!=="submit"&&k!=="reset"||a.removeAttribute("value"),o!=null?Gm(a,k,Ki(o)):u!=null?Gm(a,k,Ki(u)):f!=null&&a.removeAttribute("value"),E==null&&R!=null&&(a.defaultChecked=!!R),E!=null&&(a.checked=E&&typeof E!="function"&&typeof E!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?a.name=""+Ki(B):a.removeAttribute("name")}function AS(a,o,u,f,E,R,k,B){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.type=R),o!=null||u!=null){if(!(R!=="submit"&&R!=="reset"||o!=null))return;u=u!=null?""+Ki(u):"",o=o!=null?""+Ki(o):u,B||o===a.value||(a.value=o),a.defaultValue=o}f=f??E,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=B?a.checked:!!f,a.defaultChecked=!!f,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(a.name=k)}function Gm(a,o,u){o==="number"&&Ku(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function vl(a,o,u,f){if(a=a.options,o){o={};for(var E=0;E<u.length;E++)o["$"+u[E]]=!0;for(u=0;u<a.length;u++)E=o.hasOwnProperty("$"+a[u].value),a[u].selected!==E&&(a[u].selected=E),E&&f&&(a[u].defaultSelected=!0)}else{for(u=""+Ki(u),o=null,E=0;E<a.length;E++){if(a[E].value===u){a[E].selected=!0,f&&(a[E].defaultSelected=!0);return}o!==null||a[E].disabled||(o=a[E])}o!==null&&(o.selected=!0)}}function bS(a,o,u){if(o!=null&&(o=""+Ki(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+Ki(u):""}function Yu(a,o,u,f){if(o==null){if(f!=null){if(u!=null)throw Error(b(92));if(In(f)){if(1<f.length)throw Error(b(93));f=f[0]}u=f}u==null&&(u=""),o=u}u=Ki(o),a.defaultValue=u,f=a.textContent,f===u&&f!==""&&f!==null&&(a.value=f)}function yc(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var Hm=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function IS(a,o,u){var f=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":f?a.setProperty(o,u):typeof u!="number"||u===0||Hm.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function Gh(a,o,u){if(o!=null&&typeof o!="object")throw Error(b(62));if(a=a.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var E in o)f=o[E],o.hasOwnProperty(E)&&u[E]!==f&&IS(a,E,f)}else for(var R in o)o.hasOwnProperty(R)&&IS(a,R,o[R])}function Wm(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var OS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),DC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Hh(a){return DC.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Km=null;function Ym(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var yl=null,Cl=null;function wS(a){var o=Sl(a);if(o&&(a=o.stateNode)){var u=a[Cr]||null;t:switch(a=o.stateNode,o.type){case"input":if(jm(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ea(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var f=u[o];if(f!==a&&f.form===a.form){var E=f[Cr]||null;if(!E)throw Error(b(90));jm(f,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(o=0;o<u.length;o++)f=u[o],f.form===a.form&&yS(f)}break t;case"textarea":bS(a,u.value,u.defaultValue);break t;case"select":o=u.value,o!=null&&vl(a,!!u.multiple,o,!1)}}}var zm=!1;function qm(a,o,u){if(zm)return a(o,u);zm=!0;try{var f=a(o);return f}finally{if(zm=!1,(yl!==null||Cl!==null)&&(Zp(),yl&&(o=yl,a=Cl,Cl=yl=null,wS(o),a)))for(o=0;o<a.length;o++)wS(a[o])}}function zu(a,o){var u=a.stateNode;if(u===null)return null;var f=u[Cr]||null;if(f===null)return null;u=f[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break t;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(b(231,o,typeof u));return u}var As=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xm=!1;if(As)try{var bs={};Object.defineProperty(bs,"passive",{get:function(){Xm=!0}}),window.addEventListener("test",bs,bs),window.removeEventListener("test",bs,bs)}catch{Xm=!1}var _o=null,Jm=null,Wh=null;function NS(){if(Wh)return Wh;var a,o=Jm,u=o.length,f,E="value"in _o?_o.value:_o.textContent,R=E.length;for(a=0;a<u&&o[a]===E[a];a++);var k=u-a;for(f=1;f<=k&&o[u-f]===E[R-f];f++);return Wh=E.slice(a,1<f?1-f:void 0)}function qu(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Kh(){return!0}function DS(){return!1}function Ar(a){function o(u,f,E,R,k){this._reactName=u,this._targetInst=E,this.type=f,this.nativeEvent=R,this.target=k,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(u=a[B],this[B]=u?u(R):R[B]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?Kh:DS,this.isPropagationStopped=DS,this}return Z(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Kh)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Kh)},persist:function(){},isPersistent:Kh}),o}var br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dr=Ar(br),Al=Z({},br,{view:0,detail:0}),LC=Ar(Al),Qm,Zm,yi,Yh=Z({},Al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:r_,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==yi&&(yi&&a.type==="mousemove"?(Qm=a.screenX-yi.screenX,Zm=a.screenY-yi.screenY):Zm=Qm=0,yi=a),Qm)},movementY:function(a){return"movementY"in a?a.movementY:Zm}}),LS=Ar(Yh),PC=Z({},Yh,{dataTransfer:0}),zh=Ar(PC),PS=Z({},Al,{relatedTarget:0}),$m=Ar(PS),t_=Z({},br,{animationName:0,elapsedTime:0,pseudoElement:0}),kC=Ar(t_),e_=Z({},br,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),n_=Ar(e_),i_=Z({},br,{data:0}),kS=Ar(i_),MC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Eo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function UC(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=qh[a])?!!o[a]:!1}function r_(){return UC}var xC=Z({},Al,{key:function(a){if(a.key){var o=MC[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=qu(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Eo[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:r_,charCode:function(a){return a.type==="keypress"?qu(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?qu(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),VC=Ar(xC),BC=Z({},Yh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cc=Ar(BC),FC=Z({},Al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:r_}),bl=Ar(FC),MS=Z({},br,{propertyName:0,elapsedTime:0,pseudoElement:0}),jC=Ar(MS),Ne=Z({},Yh,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),GC=Ar(Ne),HC=Z({},br,{newState:0,oldState:0}),WC=Ar(HC),KC=[9,13,27,32],Xu=As&&"CompositionEvent"in window,Ju=null;As&&"documentMode"in document&&(Ju=document.documentMode);var YC=As&&"TextEvent"in window&&!Ju,US=As&&(!Xu||Ju&&8<Ju&&11>=Ju),Xh=" ",xS=!1;function VS(a,o){switch(a){case"keyup":return KC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function a_(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Il=!1;function Is(a,o){switch(a){case"compositionend":return a_(o);case"keypress":return o.which!==32?null:(xS=!0,Xh);case"textInput":return a=o.data,a===Xh&&xS?null:a;default:return null}}function zC(a,o){if(Il)return a==="compositionend"||!Xu&&VS(a,o)?(a=NS(),Wh=Jm=_o=null,Il=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return US&&o.locale!=="ko"?null:o.data;default:return null}}var qC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function BS(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!qC[a.type]:o==="textarea"}function s_(a,o,u,f){yl?Cl?Cl.push(f):Cl=[f]:yl=f,o=hf(o,"onChange"),0<o.length&&(u=new dr("onChange","change",null,u,f),a.push({event:u,listeners:o}))}var Ac=null,Qu=null;function XC(a){ER(a,0)}function hr(a){var o=Wu(a);if(yS(o))return a}function FS(a,o){if(a==="change")return o}var jS=!1;if(As){var o_;if(As){var c_="oninput"in document;if(!c_){var l_=document.createElement("div");l_.setAttribute("oninput","return;"),c_=typeof l_.oninput=="function"}o_=c_}else o_=!1;jS=o_&&(!document.documentMode||9<document.documentMode)}function GS(){Ac&&(Ac.detachEvent("onpropertychange",HS),Qu=Ac=null)}function HS(a){if(a.propertyName==="value"&&hr(Qu)){var o=[];s_(o,Qu,a,Ym(a)),qm(XC,o)}}function WS(a,o,u){a==="focusin"?(GS(),Ac=o,Qu=u,Ac.attachEvent("onpropertychange",HS)):a==="focusout"&&GS()}function u_(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return hr(Qu)}function JC(a,o){if(a==="click")return hr(o)}function QC(a,o){if(a==="input"||a==="change")return hr(o)}function Jh(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Yr=typeof Object.is=="function"?Object.is:Jh;function Zu(a,o){if(Yr(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),f=Object.keys(o);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var E=u[f];if(!ho.call(o,E)||!Yr(a[E],o[E]))return!1}return!0}function KS(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Ra(a,o){var u=KS(a);a=0;for(var f;u;){if(u.nodeType===3){if(f=a+u.textContent.length,a<=o&&f>=o)return{node:u,offset:o-a};a=f}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=KS(u)}}function YS(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?YS(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function zS(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Ku(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Ku(a.document)}return o}function pr(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var ZC=As&&"documentMode"in document&&11>=document.documentMode,Ol=null,d_=null,$u=null,Qh=!1;function qS(a,o,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Qh||Ol==null||Ol!==Ku(f)||(f=Ol,"selectionStart"in f&&pr(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),$u&&Zu($u,f)||($u=f,f=hf(d_,"onSelect"),0<f.length&&(o=new dr("onSelect","select",null,o,u),a.push({event:o,listeners:f}),o.target=Ol)))}function bc(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var wl={animationend:bc("Animation","AnimationEnd"),animationiteration:bc("Animation","AnimationIteration"),animationstart:bc("Animation","AnimationStart"),transitionrun:bc("Transition","TransitionRun"),transitionstart:bc("Transition","TransitionStart"),transitioncancel:bc("Transition","TransitionCancel"),transitionend:bc("Transition","TransitionEnd")},Zh={},XS={};As&&(XS=document.createElement("div").style,"AnimationEvent"in window||(delete wl.animationend.animation,delete wl.animationiteration.animation,delete wl.animationstart.animation),"TransitionEvent"in window||delete wl.transitionend.transition);function Ic(a){if(Zh[a])return Zh[a];if(!wl[a])return a;var o=wl[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in XS)return Zh[a]=o[u];return a}var $h=Ic("animationend"),tp=Ic("animationiteration"),JS=Ic("animationstart"),_t=Ic("transitionrun"),$C=Ic("transitionstart"),tA=Ic("transitioncancel"),QS=Ic("transitionend"),ZS=new Map,h_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");h_.push("scrollEnd");function va(a,o){ZS.set(a,o),vc(o,[a])}var $S=new WeakMap;function na(a,o){if(typeof a=="object"&&a!==null){var u=$S.get(a);return u!==void 0?u:(o={value:a,source:o,stack:vS(o)},$S.set(a,o),o)}return{value:a,source:o,stack:vS(o)}}var fr=[],ya=0,p_=0;function ep(){for(var a=ya,o=p_=ya=0;o<a;){var u=fr[o];fr[o++]=null;var f=fr[o];fr[o++]=null;var E=fr[o];fr[o++]=null;var R=fr[o];if(fr[o++]=null,f!==null&&E!==null){var k=f.pending;k===null?E.next=E:(E.next=k.next,k.next=E),f.pending=E}R!==0&&tT(u,E,R)}}function np(a,o,u,f){fr[ya++]=a,fr[ya++]=o,fr[ya++]=u,fr[ya++]=f,p_|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function f_(a,o,u,f){return np(a,o,u,f),td(a)}function go(a,o){return np(a,null,null,o),td(a)}function tT(a,o,u){a.lanes|=u;var f=a.alternate;f!==null&&(f.lanes|=u);for(var E=!1,R=a.return;R!==null;)R.childLanes|=u,f=R.alternate,f!==null&&(f.childLanes|=u),R.tag===22&&(a=R.stateNode,a===null||a._visibility&1||(E=!0)),a=R,R=R.return;return a.tag===3?(R=a.stateNode,E&&o!==null&&(E=31-yr(u),a=R.hiddenUpdates,f=a[E],f===null?a[E]=[o]:f.push(o),o.lane=u|536870912),R):null}function td(a){if(50<is)throw is=0,Hs=null,Error(b(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var nr={};function eA(a,o,u,f){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yi(a,o,u,f){return new eA(a,o,u,f)}function m_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Os(a,o){var u=a.alternate;return u===null?(u=Yi(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function eT(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function ed(a,o,u,f,E,R){var k=0;if(f=a,typeof a=="function")m_(a)&&(k=1);else if(typeof a=="string")k=MA(a,u,ne.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case Tn:return a=Yi(31,u,o,E),a.elementType=Tn,a.lanes=R,a;case it:return Oc(u.children,E,R,o);case xt:k=8,E|=24;break;case yt:return a=Yi(12,u,o,E|2),a.elementType=yt,a.lanes=R,a;case te:return a=Yi(13,u,o,E),a.elementType=te,a.lanes=R,a;case fn:return a=Yi(19,u,o,E),a.elementType=fn,a.lanes=R,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case kt:case Bt:k=10;break t;case zt:k=9;break t;case ie:k=11;break t;case Le:k=14;break t;case Cn:k=16,f=null;break t}k=29,u=Error(b(130,a===null?"null":typeof a,"")),f=null}return o=Yi(k,u,o,E),o.elementType=a,o.type=f,o.lanes=R,o}function Oc(a,o,u,f){return a=Yi(7,a,f,o),a.lanes=u,a}function __(a,o,u){return a=Yi(6,a,null,o),a.lanes=u,a}function E_(a,o,u){return o=Yi(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var So=[],Nl=0,nd=null,id=0,ia=[],zr=0,qa=null,ws=1,Ns="";function wc(a,o){So[Nl++]=id,So[Nl++]=nd,nd=a,id=o}function nT(a,o,u){ia[zr++]=ws,ia[zr++]=Ns,ia[zr++]=qa,qa=a;var f=ws;a=Ns;var E=32-yr(f)-1;f&=~(1<<E),u+=1;var R=32-yr(o)+E;if(30<R){var k=E-E%5;R=(f&(1<<k)-1).toString(32),f>>=k,E-=k,ws=1<<32-yr(o)+E|u<<E|f,Ns=R+a}else ws=1<<R|u<<E|f,Ns=a}function g_(a){a.return!==null&&(wc(a,1),nT(a,1,0))}function ip(a){for(;a===nd;)nd=So[--Nl],So[Nl]=null,id=So[--Nl],So[Nl]=null;for(;a===qa;)qa=ia[--zr],ia[zr]=null,Ns=ia[--zr],ia[zr]=null,ws=ia[--zr],ia[zr]=null}var zi=null,ci=null,on=!1,Nc=null,Xa=!1,S_=Error(b(519));function Dc(a){var o=Error(b(418,""));throw To(na(o,a)),S_}function iT(a){var o=a.stateNode,u=a.type,f=a.memoizedProps;switch(o[On]=a,o[Cr]=f,u){case"dialog":He("cancel",o),He("close",o);break;case"iframe":case"object":case"embed":He("load",o);break;case"video":case"audio":for(u=0;u<nu.length;u++)He(nu[u],o);break;case"source":He("error",o);break;case"img":case"image":case"link":He("error",o),He("load",o);break;case"details":He("toggle",o);break;case"input":He("invalid",o),AS(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),dn(o);break;case"select":He("invalid",o);break;case"textarea":He("invalid",o),Yu(o,f.value,f.defaultValue,f.children),dn(o)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||f.suppressHydrationWarning===!0||TR(o.textContent,u)?(f.popover!=null&&(He("beforetoggle",o),He("toggle",o)),f.onScroll!=null&&He("scroll",o),f.onScrollEnd!=null&&He("scrollend",o),f.onClick!=null&&(o.onclick=ff),o=!0):o=!1,o||Dc(a)}function rT(a){for(zi=a.return;zi;)switch(zi.tag){case 5:case 13:Xa=!1;return;case 27:case 3:Xa=!0;return;default:zi=zi.return}}function rd(a){if(a!==zi)return!1;if(!on)return rT(a),on=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||OE(a.type,a.memoizedProps)),u=!u),u&&ci&&Dc(a),rT(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(b(317));t:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(o===0){ci=La(a.nextSibling);break t}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;a=a.nextSibling}ci=null}}else o===27?(o=ci,Ho(a.type)?(a=PE,PE=null,ci=a):ci=o):ci=zi?La(a.stateNode.nextSibling):null;return!0}function ad(){ci=zi=null,on=!1}function aT(){var a=Nc;return a!==null&&(Nr===null?Nr=a:Nr.push.apply(Nr,a),Nc=null),a}function To(a){Nc===null?Nc=[a]:Nc.push(a)}var Dl=Ut(null),Ds=null,Ls=null;function Ro(a,o,u){qt(Dl,o._currentValue),o._currentValue=u}function Ps(a){a._currentValue=Dl.current,Zt(Dl)}function rp(a,o,u){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===u)break;a=a.return}}function ap(a,o,u,f){var E=a.child;for(E!==null&&(E.return=a);E!==null;){var R=E.dependencies;if(R!==null){var k=E.child;R=R.firstContext;t:for(;R!==null;){var B=R;R=E;for(var q=0;q<o.length;q++)if(B.context===o[q]){R.lanes|=u,B=R.alternate,B!==null&&(B.lanes|=u),rp(R.return,u,a),f||(k=null);break t}R=B.next}}else if(E.tag===18){if(k=E.return,k===null)throw Error(b(341));k.lanes|=u,R=k.alternate,R!==null&&(R.lanes|=u),rp(k,u,a),k=null}else k=E.child;if(k!==null)k.return=E;else for(k=E;k!==null;){if(k===a){k=null;break}if(E=k.sibling,E!==null){E.return=k.return,k=E;break}k=k.return}E=k}}function Lc(a,o,u,f){a=null;for(var E=o,R=!1;E!==null;){if(!R){if((E.flags&524288)!==0)R=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var k=E.alternate;if(k===null)throw Error(b(387));if(k=k.memoizedProps,k!==null){var B=E.type;Yr(E.pendingProps.value,k.value)||(a!==null?a.push(B):a=[B])}}else if(E===Hr.current){if(k=E.alternate,k===null)throw Error(b(387));k.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(a!==null?a.push(cu):a=[cu])}E=E.return}a!==null&&ap(o,a,u,f),o.flags|=262144}function sp(a){for(a=a.firstContext;a!==null;){if(!Yr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Pc(a){Ds=a,Ls=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Ci(a){return sT(Ds,a)}function op(a,o){return Ds===null&&Pc(a),sT(a,o)}function sT(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},Ls===null){if(a===null)throw Error(b(308));Ls=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else Ls=Ls.next=o;return u}var nA=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,f){a.push(f)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},iA=S.unstable_scheduleCallback,rA=S.unstable_NormalPriority,Li={$$typeof:Bt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function cp(){return{controller:new nA,data:new Map,refCount:0}}function sd(a){a.refCount--,a.refCount===0&&iA(rA,function(){a.controller.abort()})}var od=null,T_=0,vo=0,Ll=null;function aA(a,o){if(od===null){var u=od=[];T_=0,vo=xd(),Ll={status:"pending",value:void 0,then:function(f){u.push(f)}}}return T_++,o.then(cd,cd),o}function cd(){if(--T_===0&&od!==null){Ll!==null&&(Ll.status="fulfilled");var a=od;od=null,vo=0,Ll=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function sA(a,o){var u=[],f={status:"pending",value:null,reason:null,then:function(E){u.push(E)}};return a.then(function(){f.status="fulfilled",f.value=o;for(var E=0;E<u.length;E++)(0,u[E])(o)},function(E){for(f.status="rejected",f.reason=E,E=0;E<u.length;E++)(0,u[E])(void 0)}),f}var oT=gt.S;gt.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&aA(a,o),oT!==null&&oT(a,o)};var kc=Ut(null);function R_(){var a=kc.current;return a!==null?a:Un.pooledCache}function lp(a,o){o===null?qt(kc,kc.current):qt(kc,o.pool)}function cT(){var a=R_();return a===null?null:{parent:Li._currentValue,pool:a}}var yo=Error(b(460)),v_=Error(b(474)),up=Error(b(542)),y_={then:function(){}};function C_(a){return a=a.status,a==="fulfilled"||a==="rejected"}function dp(){}function lT(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(dp,dp),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,pp(a),a;default:if(typeof o.status=="string")o.then(dp,dp);else{if(a=Un,a!==null&&100<a.shellSuspendCounter)throw Error(b(482));a=o,a.status="pending",a.then(function(f){if(o.status==="pending"){var E=o;E.status="fulfilled",E.value=f}},function(f){if(o.status==="pending"){var E=o;E.status="rejected",E.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,pp(a),a}throw ld=o,yo}}var ld=null;function hp(){if(ld===null)throw Error(b(459));var a=ld;return ld=null,a}function pp(a){if(a===yo||a===up)throw Error(b(483))}var ks=!1;function ud(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fp(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Ms(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ca(a,o,u){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,(Rn&2)!==0){var E=f.pending;return E===null?o.next=o:(o.next=E.next,E.next=o),f.pending=o,o=td(a),tT(a,null,u),o}return np(a,f,o,u),td(a)}function Us(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,_l(a,u)}}function A_(a,o){var u=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var E=null,R=null;if(u=u.firstBaseUpdate,u!==null){do{var k={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};R===null?E=R=k:R=R.next=k,u=u.next}while(u!==null);R===null?E=R=o:R=R.next=o}else E=R=o;u={baseState:f.baseState,firstBaseUpdate:E,lastBaseUpdate:R,shared:f.shared,callbacks:f.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var b_=!1;function Pl(){if(b_){var a=Ll;if(a!==null)throw a}}function dd(a,o,u,f){b_=!1;var E=a.updateQueue;ks=!1;var R=E.firstBaseUpdate,k=E.lastBaseUpdate,B=E.shared.pending;if(B!==null){E.shared.pending=null;var q=B,ut=q.next;q.next=null,k===null?R=ut:k.next=ut,k=q;var Et=a.alternate;Et!==null&&(Et=Et.updateQueue,B=Et.lastBaseUpdate,B!==k&&(B===null?Et.firstBaseUpdate=ut:B.next=ut,Et.lastBaseUpdate=q))}if(R!==null){var Dt=E.baseState;k=0,Et=ut=q=null,B=R;do{var ht=B.lane&-536870913,pt=ht!==B.lane;if(pt?($e&ht)===ht:(f&ht)===ht){ht!==0&&ht===vo&&(b_=!0),Et!==null&&(Et=Et.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});t:{var ye=a,se=B;ht=o;var Nn=u;switch(se.tag){case 1:if(ye=se.payload,typeof ye=="function"){Dt=ye.call(Nn,Dt,ht);break t}Dt=ye;break t;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=se.payload,ht=typeof ye=="function"?ye.call(Nn,Dt,ht):ye,ht==null)break t;Dt=Z({},Dt,ht);break t;case 2:ks=!0}}ht=B.callback,ht!==null&&(a.flags|=64,pt&&(a.flags|=8192),pt=E.callbacks,pt===null?E.callbacks=[ht]:pt.push(ht))}else pt={lane:ht,tag:B.tag,payload:B.payload,callback:B.callback,next:null},Et===null?(ut=Et=pt,q=Dt):Et=Et.next=pt,k|=ht;if(B=B.next,B===null){if(B=E.shared.pending,B===null)break;pt=B,B=pt.next,pt.next=null,E.lastBaseUpdate=pt,E.shared.pending=null}}while(!0);Et===null&&(q=Dt),E.baseState=q,E.firstBaseUpdate=ut,E.lastBaseUpdate=Et,R===null&&(E.shared.lanes=0),xo|=k,a.lanes=k,a.memoizedState=Dt}}function uT(a,o){if(typeof a!="function")throw Error(b(191,a));a.call(o)}function I_(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)uT(u[a],o)}var kl=Ut(null),mp=Ut(0);function dT(a,o){a=ns,qt(mp,a),qt(kl,o),ns=a|o.baseLanes}function O_(){qt(mp,ns),qt(kl,kl.current)}function w_(){ns=mp.current,Zt(kl),Zt(mp)}var Co=0,Me=null,rn=null,Ai=null,_p=!1,Ml=!1,Ao=!1,Ep=0,Ul=0,xl=null,oA=0;function mi(){throw Error(b(321))}function Vl(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!Yr(a[u],o[u]))return!1;return!0}function N_(a,o,u,f,E,R){return Co=R,Me=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,gt.H=a===null||a.memoizedState===null?X_:IT,Ao=!1,R=u(f,E),Ao=!1,Ml&&(R=pT(o,u,f,E)),hT(a),R}function hT(a){gt.H=gd;var o=rn!==null&&rn.next!==null;if(Co=0,Ai=rn=Me=null,_p=!1,Ul=0,xl=null,o)throw Error(b(300));a===null||ki||(a=a.dependencies,a!==null&&sp(a)&&(ki=!0))}function pT(a,o,u,f){Me=a;var E=0;do{if(Ml&&(xl=null),Ul=0,Ml=!1,25<=E)throw Error(b(301));if(E+=1,Ai=rn=null,a.updateQueue!=null){var R=a.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}gt.H=bo,R=o(u,f)}while(Ml);return R}function cA(){var a=gt.H,o=a.useState()[0];return o=typeof o.then=="function"?Bl(o):o,a=a.useState()[0],(rn!==null?rn.memoizedState:null)!==a&&(Me.flags|=1024),o}function D_(){var a=Ep!==0;return Ep=0,a}function L_(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function hd(a){if(_p){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}_p=!1}Co=0,Ai=rn=Me=null,Ml=!1,Ul=Ep=0,xl=null}function Ir(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ai===null?Me.memoizedState=Ai=a:Ai=Ai.next=a,Ai}function _i(){if(rn===null){var a=Me.alternate;a=a!==null?a.memoizedState:null}else a=rn.next;var o=Ai===null?Me.memoizedState:Ai.next;if(o!==null)Ai=o,rn=a;else{if(a===null)throw Me.alternate===null?Error(b(467)):Error(b(310));rn=a,a={memoizedState:rn.memoizedState,baseState:rn.baseState,baseQueue:rn.baseQueue,queue:rn.queue,next:null},Ai===null?Me.memoizedState=Ai=a:Ai=Ai.next=a}return Ai}function P_(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Bl(a){var o=Ul;return Ul+=1,xl===null&&(xl=[]),a=lT(xl,a,o),o=Me,(Ai===null?o.memoizedState:Ai.next)===null&&(o=o.alternate,gt.H=o===null||o.memoizedState===null?X_:IT),a}function gp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Bl(a);if(a.$$typeof===Bt)return Ci(a)}throw Error(b(438,String(a)))}function k_(a){var o=null,u=Me.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var f=Me.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(E){return E.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=P_(),Me.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),f=0;f<a;f++)u[f]=oi;return o.index++,u}function xs(a,o){return typeof o=="function"?o(a):o}function Sp(a){var o=_i();return M_(o,rn,a)}function M_(a,o,u){var f=a.queue;if(f===null)throw Error(b(311));f.lastRenderedReducer=u;var E=a.baseQueue,R=f.pending;if(R!==null){if(E!==null){var k=E.next;E.next=R.next,R.next=k}o.baseQueue=E=R,f.pending=null}if(R=a.baseState,E===null)a.memoizedState=R;else{o=E.next;var B=k=null,q=null,ut=o,Et=!1;do{var Dt=ut.lane&-536870913;if(Dt!==ut.lane?($e&Dt)===Dt:(Co&Dt)===Dt){var ht=ut.revertLane;if(ht===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),Dt===vo&&(Et=!0);else if((Co&ht)===ht){ut=ut.next,ht===vo&&(Et=!0);continue}else Dt={lane:0,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},q===null?(B=q=Dt,k=R):q=q.next=Dt,Me.lanes|=ht,xo|=ht;Dt=ut.action,Ao&&u(R,Dt),R=ut.hasEagerState?ut.eagerState:u(R,Dt)}else ht={lane:Dt,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},q===null?(B=q=ht,k=R):q=q.next=ht,Me.lanes|=Dt,xo|=Dt;ut=ut.next}while(ut!==null&&ut!==o);if(q===null?k=R:q.next=B,!Yr(R,a.memoizedState)&&(ki=!0,Et&&(u=Ll,u!==null)))throw u;a.memoizedState=R,a.baseState=k,a.baseQueue=q,f.lastRenderedState=R}return E===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function U_(a){var o=_i(),u=o.queue;if(u===null)throw Error(b(311));u.lastRenderedReducer=a;var f=u.dispatch,E=u.pending,R=o.memoizedState;if(E!==null){u.pending=null;var k=E=E.next;do R=a(R,k.action),k=k.next;while(k!==E);Yr(R,o.memoizedState)||(ki=!0),o.memoizedState=R,o.baseQueue===null&&(o.baseState=R),u.lastRenderedState=R}return[R,f]}function x_(a,o,u){var f=Me,E=_i(),R=on;if(R){if(u===void 0)throw Error(b(407));u=u()}else u=o();var k=!Yr((rn||E).memoizedState,u);k&&(E.memoizedState=u,ki=!0),E=E.queue;var B=V_.bind(null,f,E,a);if(Ja(2048,8,B,[a]),E.getSnapshot!==o||k||Ai!==null&&Ai.memoizedState.tag&1){if(f.flags|=2048,Gl(9,yp(),mT.bind(null,f,E,u,o),null),Un===null)throw Error(b(349));R||(Co&124)!==0||fT(f,o,u)}return u}function fT(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=Me.updateQueue,o===null?(o=P_(),Me.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function mT(a,o,u,f){o.value=u,o.getSnapshot=f,_T(o)&&pd(a)}function V_(a,o,u){return u(function(){_T(o)&&pd(a)})}function _T(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!Yr(a,u)}catch{return!0}}function pd(a){var o=go(a,2);o!==null&&Jr(o,a,2)}function Tp(a){var o=Ir();if(typeof a=="function"){var u=a;if(a=u(),Ao){ur(!0);try{u()}finally{ur(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:a},o}function Fl(a,o,u,f){return a.baseState=u,M_(a,rn,typeof f=="function"?f:xs)}function lA(a,o,u,f,E){if(wp(a))throw Error(b(485));if(a=o.action,a!==null){var R={payload:E,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){R.listeners.push(k)}};gt.T!==null?u(!0):R.isTransition=!1,f(R),u=o.pending,u===null?(R.next=o.pending=R,ET(o,R)):(R.next=u.next,o.pending=u.next=R)}}function ET(a,o){var u=o.action,f=o.payload,E=a.state;if(o.isTransition){var R=gt.T,k={};gt.T=k;try{var B=u(E,f),q=gt.S;q!==null&&q(k,B),gT(a,o,B)}catch(ut){jl(a,o,ut)}finally{gt.T=R}}else try{R=u(E,f),gT(a,o,R)}catch(ut){jl(a,o,ut)}}function gT(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){ST(a,o,f)},function(f){return jl(a,o,f)}):ST(a,o,u)}function ST(a,o,u){o.status="fulfilled",o.value=u,TT(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,ET(a,u)))}function jl(a,o,u){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=u,TT(o),o=o.next;while(o!==f)}a.action=null}function TT(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function B_(a,o){return o}function Rp(a,o){if(on){var u=Un.formState;if(u!==null){t:{var f=Me;if(on){if(ci){e:{for(var E=ci,R=Xa;E.nodeType!==8;){if(!R){E=null;break e}if(E=La(E.nextSibling),E===null){E=null;break e}}R=E.data,E=R==="F!"||R==="F"?E:null}if(E){ci=La(E.nextSibling),f=E.data==="F!";break t}}Dc(f)}f=!1}f&&(o=u[0])}}return u=Ir(),u.memoizedState=u.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:B_,lastRenderedState:o},u.queue=f,u=z_.bind(null,Me,f),f.dispatch=u,f=Tp(!1),R=Ed.bind(null,Me,!1,f.queue),f=Ir(),E={state:o,dispatch:null,action:a,pending:null},f.queue=E,u=lA.bind(null,Me,E,R,u),E.dispatch=u,f.memoizedState=a,[o,u,!1]}function vp(a){var o=_i();return RT(o,rn,a)}function RT(a,o,u){if(o=M_(a,o,B_)[0],a=Sp(xs)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Bl(o)}catch(k){throw k===yo?up:k}else f=o;o=_i();var E=o.queue,R=E.dispatch;return u!==o.memoizedState&&(Me.flags|=2048,Gl(9,yp(),uA.bind(null,E,u),null)),[f,R,a]}function uA(a,o){a.action=o}function vT(a){var o=_i(),u=rn;if(u!==null)return RT(o,u,a);_i(),o=o.memoizedState,u=_i();var f=u.queue.dispatch;return u.memoizedState=a,[o,f,!1]}function Gl(a,o,u,f){return a={tag:a,create:u,deps:f,inst:o,next:null},o=Me.updateQueue,o===null&&(o=P_(),Me.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(f=u.next,u.next=a,a.next=f,o.lastEffect=a),a}function yp(){return{destroy:void 0,resource:void 0}}function fd(){return _i().memoizedState}function Cp(a,o,u,f){var E=Ir();f=f===void 0?null:f,Me.flags|=a,E.memoizedState=Gl(1|o,yp(),u,f)}function Ja(a,o,u,f){var E=_i();f=f===void 0?null:f;var R=E.memoizedState.inst;rn!==null&&f!==null&&Vl(f,rn.memoizedState.deps)?E.memoizedState=Gl(o,R,u,f):(Me.flags|=a,E.memoizedState=Gl(1|o,R,u,f))}function Ap(a,o){Cp(8390656,8,a,o)}function md(a,o){Ja(2048,8,a,o)}function Hl(a,o){return Ja(4,2,a,o)}function _d(a,o){return Ja(4,4,a,o)}function yT(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function F_(a,o,u){u=u!=null?u.concat([a]):null,Ja(4,4,yT.bind(null,o,a),u)}function j_(){}function G_(a,o){var u=_i();o=o===void 0?null:o;var f=u.memoizedState;return o!==null&&Vl(o,f[1])?f[0]:(u.memoizedState=[a,o],a)}function CT(a,o){var u=_i();o=o===void 0?null:o;var f=u.memoizedState;if(o!==null&&Vl(o,f[1]))return f[0];if(f=a(),Ao){ur(!0);try{a()}finally{ur(!1)}}return u.memoizedState=[f,o],f}function H_(a,o,u){return u===void 0||(Co&1073741824)!==0?a.memoizedState=o:(a.memoizedState=u,a=eR(),Me.lanes|=a,xo|=a,u)}function bp(a,o,u,f){return Yr(u,o)?u:kl.current!==null?(a=H_(a,u,f),Yr(a,o)||(ki=!0),a):(Co&42)===0?(ki=!0,a.memoizedState=u):(a=eR(),Me.lanes|=a,xo|=a,o)}function Ip(a,o,u,f,E){var R=Jt.p;Jt.p=R!==0&&8>R?R:8;var k=gt.T,B={};gt.T=B,Ed(a,!1,o,u);try{var q=E(),ut=gt.S;if(ut!==null&&ut(B,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var Et=sA(q,f);ba(a,o,Et,Dr(a))}else ba(a,o,f,Dr(a))}catch(Dt){ba(a,o,{then:function(){},status:"rejected",reason:Dt},Dr())}finally{Jt.p=R,gt.T=k}}function dA(){}function W_(a,o,u,f){if(a.tag!==5)throw Error(b(476));var E=K_(a).queue;Ip(a,E,o,he,u===null?dA:function(){return Op(a),u(f)})}function K_(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:he,baseState:he,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:he},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function Op(a){var o=K_(a).next.queue;ba(a,o,{},Dr())}function Y_(){return Ci(cu)}function Aa(){return _i().memoizedState}function Mc(){return _i().memoizedState}function Uc(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=Dr();a=Ms(u);var f=Ca(o,a,u);f!==null&&(Jr(f,o,u),Us(f,o,u)),o={cache:cp()},a.payload=o;return}o=o.return}}function AT(a,o,u){var f=Dr();u={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},wp(a)?q_(o,u):(u=f_(a,o,u,f),u!==null&&(Jr(u,a,f),bT(u,o,f)))}function z_(a,o,u){var f=Dr();ba(a,o,u,f)}function ba(a,o,u,f){var E={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(wp(a))q_(o,E);else{var R=a.alternate;if(a.lanes===0&&(R===null||R.lanes===0)&&(R=o.lastRenderedReducer,R!==null))try{var k=o.lastRenderedState,B=R(k,u);if(E.hasEagerState=!0,E.eagerState=B,Yr(B,k))return np(a,o,E,0),Un===null&&ep(),!1}catch{}finally{}if(u=f_(a,o,E,f),u!==null)return Jr(u,a,f),bT(u,o,f),!0}return!1}function Ed(a,o,u,f){if(f={lane:2,revertLane:xd(),action:f,hasEagerState:!1,eagerState:null,next:null},wp(a)){if(o)throw Error(b(479))}else o=f_(a,u,f,2),o!==null&&Jr(o,a,2)}function wp(a){var o=a.alternate;return a===Me||o!==null&&o===Me}function q_(a,o){Ml=_p=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function bT(a,o,u){if((u&4194048)!==0){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,_l(a,u)}}var gd={readContext:Ci,use:gp,useCallback:mi,useContext:mi,useEffect:mi,useImperativeHandle:mi,useLayoutEffect:mi,useInsertionEffect:mi,useMemo:mi,useReducer:mi,useRef:mi,useState:mi,useDebugValue:mi,useDeferredValue:mi,useTransition:mi,useSyncExternalStore:mi,useId:mi,useHostTransitionStatus:mi,useFormState:mi,useActionState:mi,useOptimistic:mi,useMemoCache:mi,useCacheRefresh:mi},X_={readContext:Ci,use:gp,useCallback:function(a,o){return Ir().memoizedState=[a,o===void 0?null:o],a},useContext:Ci,useEffect:Ap,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,Cp(4194308,4,yT.bind(null,o,a),u)},useLayoutEffect:function(a,o){return Cp(4194308,4,a,o)},useInsertionEffect:function(a,o){Cp(4,2,a,o)},useMemo:function(a,o){var u=Ir();o=o===void 0?null:o;var f=a();if(Ao){ur(!0);try{a()}finally{ur(!1)}}return u.memoizedState=[f,o],f},useReducer:function(a,o,u){var f=Ir();if(u!==void 0){var E=u(o);if(Ao){ur(!0);try{u(o)}finally{ur(!1)}}}else E=o;return f.memoizedState=f.baseState=E,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:E},f.queue=a,a=a.dispatch=AT.bind(null,Me,a),[f.memoizedState,a]},useRef:function(a){var o=Ir();return a={current:a},o.memoizedState=a},useState:function(a){a=Tp(a);var o=a.queue,u=z_.bind(null,Me,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:j_,useDeferredValue:function(a,o){var u=Ir();return H_(u,a,o)},useTransition:function(){var a=Tp(!1);return a=Ip.bind(null,Me,a.queue,!0,!1),Ir().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var f=Me,E=Ir();if(on){if(u===void 0)throw Error(b(407));u=u()}else{if(u=o(),Un===null)throw Error(b(349));($e&124)!==0||fT(f,o,u)}E.memoizedState=u;var R={value:u,getSnapshot:o};return E.queue=R,Ap(V_.bind(null,f,R,a),[a]),f.flags|=2048,Gl(9,yp(),mT.bind(null,f,R,u,o),null),u},useId:function(){var a=Ir(),o=Un.identifierPrefix;if(on){var u=Ns,f=ws;u=(f&~(1<<32-yr(f)-1)).toString(32)+u,o="«"+o+"R"+u,u=Ep++,0<u&&(o+="H"+u.toString(32)),o+="»"}else u=oA++,o="«"+o+"r"+u.toString(32)+"»";return a.memoizedState=o},useHostTransitionStatus:Y_,useFormState:Rp,useActionState:Rp,useOptimistic:function(a){var o=Ir();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Ed.bind(null,Me,!0,u),u.dispatch=o,[a,o]},useMemoCache:k_,useCacheRefresh:function(){return Ir().memoizedState=Uc.bind(null,Me)}},IT={readContext:Ci,use:gp,useCallback:G_,useContext:Ci,useEffect:md,useImperativeHandle:F_,useInsertionEffect:Hl,useLayoutEffect:_d,useMemo:CT,useReducer:Sp,useRef:fd,useState:function(){return Sp(xs)},useDebugValue:j_,useDeferredValue:function(a,o){var u=_i();return bp(u,rn.memoizedState,a,o)},useTransition:function(){var a=Sp(xs)[0],o=_i().memoizedState;return[typeof a=="boolean"?a:Bl(a),o]},useSyncExternalStore:x_,useId:Aa,useHostTransitionStatus:Y_,useFormState:vp,useActionState:vp,useOptimistic:function(a,o){var u=_i();return Fl(u,rn,a,o)},useMemoCache:k_,useCacheRefresh:Mc},bo={readContext:Ci,use:gp,useCallback:G_,useContext:Ci,useEffect:md,useImperativeHandle:F_,useInsertionEffect:Hl,useLayoutEffect:_d,useMemo:CT,useReducer:U_,useRef:fd,useState:function(){return U_(xs)},useDebugValue:j_,useDeferredValue:function(a,o){var u=_i();return rn===null?H_(u,a,o):bp(u,rn.memoizedState,a,o)},useTransition:function(){var a=U_(xs)[0],o=_i().memoizedState;return[typeof a=="boolean"?a:Bl(a),o]},useSyncExternalStore:x_,useId:Aa,useHostTransitionStatus:Y_,useFormState:vT,useActionState:vT,useOptimistic:function(a,o){var u=_i();return rn!==null?Fl(u,rn,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:k_,useCacheRefresh:Mc},Wl=null,Sd=0;function Np(a){var o=Sd;return Sd+=1,Wl===null&&(Wl=[]),lT(Wl,a,o)}function Td(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Rd(a,o){throw o.$$typeof===ot?Error(b(525)):(a=Object.prototype.toString.call(o),Error(b(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function OT(a){var o=a._init;return o(a._payload)}function Dp(a){function o(rt,et){if(a){var lt=rt.deletions;lt===null?(rt.deletions=[et],rt.flags|=16):lt.push(et)}}function u(rt,et){if(!a)return null;for(;et!==null;)o(rt,et),et=et.sibling;return null}function f(rt){for(var et=new Map;rt!==null;)rt.key!==null?et.set(rt.key,rt):et.set(rt.index,rt),rt=rt.sibling;return et}function E(rt,et){return rt=Os(rt,et),rt.index=0,rt.sibling=null,rt}function R(rt,et,lt){return rt.index=lt,a?(lt=rt.alternate,lt!==null?(lt=lt.index,lt<et?(rt.flags|=67108866,et):lt):(rt.flags|=67108866,et)):(rt.flags|=1048576,et)}function k(rt){return a&&rt.alternate===null&&(rt.flags|=67108866),rt}function B(rt,et,lt,wt){return et===null||et.tag!==6?(et=__(lt,rt.mode,wt),et.return=rt,et):(et=E(et,lt),et.return=rt,et)}function q(rt,et,lt,wt){var Kt=lt.type;return Kt===it?Et(rt,et,lt.props.children,wt,lt.key):et!==null&&(et.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===Cn&&OT(Kt)===et.type)?(et=E(et,lt.props),Td(et,lt),et.return=rt,et):(et=ed(lt.type,lt.key,lt.props,null,rt.mode,wt),Td(et,lt),et.return=rt,et)}function ut(rt,et,lt,wt){return et===null||et.tag!==4||et.stateNode.containerInfo!==lt.containerInfo||et.stateNode.implementation!==lt.implementation?(et=E_(lt,rt.mode,wt),et.return=rt,et):(et=E(et,lt.children||[]),et.return=rt,et)}function Et(rt,et,lt,wt,Kt){return et===null||et.tag!==7?(et=Oc(lt,rt.mode,wt,Kt),et.return=rt,et):(et=E(et,lt),et.return=rt,et)}function Dt(rt,et,lt){if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return et=__(""+et,rt.mode,lt),et.return=rt,et;if(typeof et=="object"&&et!==null){switch(et.$$typeof){case mt:return lt=ed(et.type,et.key,et.props,null,rt.mode,lt),Td(lt,et),lt.return=rt,lt;case Vt:return et=E_(et,rt.mode,lt),et.return=rt,et;case Cn:var wt=et._init;return et=wt(et._payload),Dt(rt,et,lt)}if(In(et)||pi(et))return et=Oc(et,rt.mode,lt,null),et.return=rt,et;if(typeof et.then=="function")return Dt(rt,Np(et),lt);if(et.$$typeof===Bt)return Dt(rt,op(rt,et),lt);Rd(rt,et)}return null}function ht(rt,et,lt,wt){var Kt=et!==null?et.key:null;if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return Kt!==null?null:B(rt,et,""+lt,wt);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case mt:return lt.key===Kt?q(rt,et,lt,wt):null;case Vt:return lt.key===Kt?ut(rt,et,lt,wt):null;case Cn:return Kt=lt._init,lt=Kt(lt._payload),ht(rt,et,lt,wt)}if(In(lt)||pi(lt))return Kt!==null?null:Et(rt,et,lt,wt,null);if(typeof lt.then=="function")return ht(rt,et,Np(lt),wt);if(lt.$$typeof===Bt)return ht(rt,et,op(rt,lt),wt);Rd(rt,lt)}return null}function pt(rt,et,lt,wt,Kt){if(typeof wt=="string"&&wt!==""||typeof wt=="number"||typeof wt=="bigint")return rt=rt.get(lt)||null,B(et,rt,""+wt,Kt);if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case mt:return rt=rt.get(wt.key===null?lt:wt.key)||null,q(et,rt,wt,Kt);case Vt:return rt=rt.get(wt.key===null?lt:wt.key)||null,ut(et,rt,wt,Kt);case Cn:var We=wt._init;return wt=We(wt._payload),pt(rt,et,lt,wt,Kt)}if(In(wt)||pi(wt))return rt=rt.get(lt)||null,Et(et,rt,wt,Kt,null);if(typeof wt.then=="function")return pt(rt,et,lt,Np(wt),Kt);if(wt.$$typeof===Bt)return pt(rt,et,lt,op(et,wt),Kt);Rd(et,wt)}return null}function ye(rt,et,lt,wt){for(var Kt=null,We=null,re=et,pe=et=0,Mi=null;re!==null&&pe<lt.length;pe++){re.index>pe?(Mi=re,re=null):Mi=re.sibling;var tn=ht(rt,re,lt[pe],wt);if(tn===null){re===null&&(re=Mi);break}a&&re&&tn.alternate===null&&o(rt,re),et=R(tn,et,pe),We===null?Kt=tn:We.sibling=tn,We=tn,re=Mi}if(pe===lt.length)return u(rt,re),on&&wc(rt,pe),Kt;if(re===null){for(;pe<lt.length;pe++)re=Dt(rt,lt[pe],wt),re!==null&&(et=R(re,et,pe),We===null?Kt=re:We.sibling=re,We=re);return on&&wc(rt,pe),Kt}for(re=f(re);pe<lt.length;pe++)Mi=pt(re,rt,pe,lt[pe],wt),Mi!==null&&(a&&Mi.alternate!==null&&re.delete(Mi.key===null?pe:Mi.key),et=R(Mi,et,pe),We===null?Kt=Mi:We.sibling=Mi,We=Mi);return a&&re.forEach(function(sa){return o(rt,sa)}),on&&wc(rt,pe),Kt}function se(rt,et,lt,wt){if(lt==null)throw Error(b(151));for(var Kt=null,We=null,re=et,pe=et=0,Mi=null,tn=lt.next();re!==null&&!tn.done;pe++,tn=lt.next()){re.index>pe?(Mi=re,re=null):Mi=re.sibling;var sa=ht(rt,re,tn.value,wt);if(sa===null){re===null&&(re=Mi);break}a&&re&&sa.alternate===null&&o(rt,re),et=R(sa,et,pe),We===null?Kt=sa:We.sibling=sa,We=sa,re=Mi}if(tn.done)return u(rt,re),on&&wc(rt,pe),Kt;if(re===null){for(;!tn.done;pe++,tn=lt.next())tn=Dt(rt,tn.value,wt),tn!==null&&(et=R(tn,et,pe),We===null?Kt=tn:We.sibling=tn,We=tn);return on&&wc(rt,pe),Kt}for(re=f(re);!tn.done;pe++,tn=lt.next())tn=pt(re,rt,pe,tn.value,wt),tn!==null&&(a&&tn.alternate!==null&&re.delete(tn.key===null?pe:tn.key),et=R(tn,et,pe),We===null?Kt=tn:We.sibling=tn,We=tn);return a&&re.forEach(function(WE){return o(rt,WE)}),on&&wc(rt,pe),Kt}function Nn(rt,et,lt,wt){if(typeof lt=="object"&&lt!==null&&lt.type===it&&lt.key===null&&(lt=lt.props.children),typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case mt:t:{for(var Kt=lt.key;et!==null;){if(et.key===Kt){if(Kt=lt.type,Kt===it){if(et.tag===7){u(rt,et.sibling),wt=E(et,lt.props.children),wt.return=rt,rt=wt;break t}}else if(et.elementType===Kt||typeof Kt=="object"&&Kt!==null&&Kt.$$typeof===Cn&&OT(Kt)===et.type){u(rt,et.sibling),wt=E(et,lt.props),Td(wt,lt),wt.return=rt,rt=wt;break t}u(rt,et);break}else o(rt,et);et=et.sibling}lt.type===it?(wt=Oc(lt.props.children,rt.mode,wt,lt.key),wt.return=rt,rt=wt):(wt=ed(lt.type,lt.key,lt.props,null,rt.mode,wt),Td(wt,lt),wt.return=rt,rt=wt)}return k(rt);case Vt:t:{for(Kt=lt.key;et!==null;){if(et.key===Kt)if(et.tag===4&&et.stateNode.containerInfo===lt.containerInfo&&et.stateNode.implementation===lt.implementation){u(rt,et.sibling),wt=E(et,lt.children||[]),wt.return=rt,rt=wt;break t}else{u(rt,et);break}else o(rt,et);et=et.sibling}wt=E_(lt,rt.mode,wt),wt.return=rt,rt=wt}return k(rt);case Cn:return Kt=lt._init,lt=Kt(lt._payload),Nn(rt,et,lt,wt)}if(In(lt))return ye(rt,et,lt,wt);if(pi(lt)){if(Kt=pi(lt),typeof Kt!="function")throw Error(b(150));return lt=Kt.call(lt),se(rt,et,lt,wt)}if(typeof lt.then=="function")return Nn(rt,et,Np(lt),wt);if(lt.$$typeof===Bt)return Nn(rt,et,op(rt,lt),wt);Rd(rt,lt)}return typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint"?(lt=""+lt,et!==null&&et.tag===6?(u(rt,et.sibling),wt=E(et,lt),wt.return=rt,rt=wt):(u(rt,et),wt=__(lt,rt.mode,wt),wt.return=rt,rt=wt),k(rt)):u(rt,et)}return function(rt,et,lt,wt){try{Sd=0;var Kt=Nn(rt,et,lt,wt);return Wl=null,Kt}catch(re){if(re===yo||re===up)throw re;var We=Yi(29,re,null,rt.mode);return We.lanes=wt,We.return=rt,We}finally{}}}var xc=Dp(!0),wT=Dp(!1),qr=Ut(null),Qa=null;function Io(a){var o=a.alternate;qt(Pi,Pi.current&1),qt(qr,a),Qa===null&&(o===null||kl.current!==null||o.memoizedState!==null)&&(Qa=a)}function NT(a){if(a.tag===22){if(qt(Pi,Pi.current),qt(qr,a),Qa===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(Qa=a)}}else Oo()}function Oo(){qt(Pi,Pi.current),qt(qr,qr.current)}function Vs(a){Zt(qr),Qa===a&&(Qa=null),Zt(Pi)}var Pi=Ut(0);function Lp(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||LE(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Pp(a,o,u,f){o=a.memoizedState,u=u(f,o),u=u==null?o:Z({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Za={enqueueSetState:function(a,o,u){a=a._reactInternals;var f=Dr(),E=Ms(f);E.payload=o,u!=null&&(E.callback=u),o=Ca(a,E,f),o!==null&&(Jr(o,a,f),Us(o,a,f))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var f=Dr(),E=Ms(f);E.tag=1,E.payload=o,u!=null&&(E.callback=u),o=Ca(a,E,f),o!==null&&(Jr(o,a,f),Us(o,a,f))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=Dr(),f=Ms(u);f.tag=2,o!=null&&(f.callback=o),o=Ca(a,f,u),o!==null&&(Jr(o,a,u),Us(o,a,u))}};function DT(a,o,u,f,E,R,k){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,R,k):o.prototype&&o.prototype.isPureReactComponent?!Zu(u,f)||!Zu(E,R):!0}function LT(a,o,u,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,f),o.state!==a&&Za.enqueueReplaceState(o,o.state,null)}function Vc(a,o){var u=o;if("ref"in o){u={};for(var f in o)f!=="ref"&&(u[f]=o[f])}if(a=a.defaultProps){u===o&&(u=Z({},u));for(var E in a)u[E]===void 0&&(u[E]=a[E])}return u}var kp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function PT(a){kp(a)}function kT(a){console.error(a)}function Mp(a){kp(a)}function Up(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function MT(a,o,u){try{var f=a.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function J_(a,o,u){return u=Ms(u),u.tag=3,u.payload={element:null},u.callback=function(){Up(a,o)},u}function UT(a){return a=Ms(a),a.tag=3,a}function xT(a,o,u,f){var E=u.type.getDerivedStateFromError;if(typeof E=="function"){var R=f.value;a.payload=function(){return E(R)},a.callback=function(){MT(o,u,f)}}var k=u.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(a.callback=function(){MT(o,u,f),typeof E!="function"&&(Gs===null?Gs=new Set([this]):Gs.add(this));var B=f.stack;this.componentDidCatch(f.value,{componentStack:B!==null?B:""})})}function hA(a,o,u,f,E){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=u.alternate,o!==null&&Lc(o,u,E,!0),u=qr.current,u!==null){switch(u.tag){case 13:return Qa===null?tf():u.alternate===null&&li===0&&(li=3),u.flags&=-257,u.flags|=65536,u.lanes=E,f===y_?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([f]):o.add(f),SE(a,f,E)),!1;case 22:return u.flags|=65536,f===y_?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([f]):u.add(f)),SE(a,f,E)),!1}throw Error(b(435,u.tag))}return SE(a,f,E),tf(),!1}if(on)return o=qr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=E,f!==S_&&(a=Error(b(422),{cause:f}),To(na(a,u)))):(f!==S_&&(o=Error(b(423),{cause:f}),To(na(o,u))),a=a.current.alternate,a.flags|=65536,E&=-E,a.lanes|=E,f=na(f,u),E=J_(a.stateNode,f,E),A_(a,E),li!==4&&(li=2)),!1;var R=Error(b(520),{cause:f});if(R=na(R,u),wd===null?wd=[R]:wd.push(R),li!==4&&(li=2),o===null)return!0;f=na(f,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=E&-E,u.lanes|=a,a=J_(u.stateNode,f,a),A_(u,a),!1;case 1:if(o=u.type,R=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(Gs===null||!Gs.has(R))))return u.flags|=65536,E&=-E,u.lanes|=E,E=UT(E),xT(E,a,u,f),A_(u,E),!1}u=u.return}while(u!==null);return!1}var Q_=Error(b(461)),ki=!1;function qi(a,o,u,f){o.child=a===null?wT(o,null,u,f):xc(o,a.child,u,f)}function VT(a,o,u,f,E){u=u.render;var R=o.ref;if("ref"in f){var k={};for(var B in f)B!=="ref"&&(k[B]=f[B])}else k=f;return Pc(o),f=N_(a,o,u,k,R,E),B=D_(),a!==null&&!ki?(L_(a,o,E),Bs(a,o,E)):(on&&B&&g_(o),o.flags|=1,qi(a,o,f,E),o.child)}function vd(a,o,u,f,E){if(a===null){var R=u.type;return typeof R=="function"&&!m_(R)&&R.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=R,xp(a,o,R,f,E)):(a=ed(u.type,null,f,o,o.mode,E),a.ref=o.ref,a.return=o,o.child=a)}if(R=a.child,!rE(a,E)){var k=R.memoizedProps;if(u=u.compare,u=u!==null?u:Zu,u(k,f)&&a.ref===o.ref)return Bs(a,o,E)}return o.flags|=1,a=Os(R,f),a.ref=o.ref,a.return=o,o.child=a}function xp(a,o,u,f,E){if(a!==null){var R=a.memoizedProps;if(Zu(R,f)&&a.ref===o.ref)if(ki=!1,o.pendingProps=f=R,rE(a,E))(a.flags&131072)!==0&&(ki=!0);else return o.lanes=a.lanes,Bs(a,o,E)}return $_(a,o,u,f,E)}function Z_(a,o,u){var f=o.pendingProps,E=f.children,R=a!==null?a.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=R!==null?R.baseLanes|u:u,a!==null){for(E=o.child=a.child,R=0;E!==null;)R=R|E.lanes|E.childLanes,E=E.sibling;o.childLanes=R&~f}else o.childLanes=0,o.child=null;return yd(a,o,f,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&lp(o,R!==null?R.cachePool:null),R!==null?dT(o,R):O_(),NT(o);else return o.lanes=o.childLanes=536870912,yd(a,o,R!==null?R.baseLanes|u:u,u)}else R!==null?(lp(o,R.cachePool),dT(o,R),Oo(),o.memoizedState=null):(a!==null&&lp(o,null),O_(),Oo());return qi(a,o,E,u),o.child}function yd(a,o,u,f){var E=R_();return E=E===null?null:{parent:Li._currentValue,pool:E},o.memoizedState={baseLanes:u,cachePool:E},a!==null&&lp(o,null),O_(),NT(o),a!==null&&Lc(a,o,f,!0),null}function Cd(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(b(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function $_(a,o,u,f,E){return Pc(o),u=N_(a,o,u,f,void 0,E),f=D_(),a!==null&&!ki?(L_(a,o,E),Bs(a,o,E)):(on&&f&&g_(o),o.flags|=1,qi(a,o,u,E),o.child)}function tE(a,o,u,f,E,R){return Pc(o),o.updateQueue=null,u=pT(o,f,u,E),hT(a),f=D_(),a!==null&&!ki?(L_(a,o,R),Bs(a,o,R)):(on&&f&&g_(o),o.flags|=1,qi(a,o,u,R),o.child)}function Vp(a,o,u,f,E){if(Pc(o),o.stateNode===null){var R=nr,k=u.contextType;typeof k=="object"&&k!==null&&(R=Ci(k)),R=new u(f,R),o.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=Za,o.stateNode=R,R._reactInternals=o,R=o.stateNode,R.props=f,R.state=o.memoizedState,R.refs={},ud(o),k=u.contextType,R.context=typeof k=="object"&&k!==null?Ci(k):nr,R.state=o.memoizedState,k=u.getDerivedStateFromProps,typeof k=="function"&&(Pp(o,u,k,f),R.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(k=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),k!==R.state&&Za.enqueueReplaceState(R,R.state,null),dd(o,f,R,E),Pl(),R.state=o.memoizedState),typeof R.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(a===null){R=o.stateNode;var B=o.memoizedProps,q=Vc(u,B);R.props=q;var ut=R.context,Et=u.contextType;k=nr,typeof Et=="object"&&Et!==null&&(k=Ci(Et));var Dt=u.getDerivedStateFromProps;Et=typeof Dt=="function"||typeof R.getSnapshotBeforeUpdate=="function",B=o.pendingProps!==B,Et||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(B||ut!==k)&&LT(o,R,f,k),ks=!1;var ht=o.memoizedState;R.state=ht,dd(o,f,R,E),Pl(),ut=o.memoizedState,B||ht!==ut||ks?(typeof Dt=="function"&&(Pp(o,u,Dt,f),ut=o.memoizedState),(q=ks||DT(o,u,q,f,ht,ut,k))?(Et||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(o.flags|=4194308)):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=ut),R.props=f,R.state=ut,R.context=k,f=q):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{R=o.stateNode,fp(a,o),k=o.memoizedProps,Et=Vc(u,k),R.props=Et,Dt=o.pendingProps,ht=R.context,ut=u.contextType,q=nr,typeof ut=="object"&&ut!==null&&(q=Ci(ut)),B=u.getDerivedStateFromProps,(ut=typeof B=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(k!==Dt||ht!==q)&&LT(o,R,f,q),ks=!1,ht=o.memoizedState,R.state=ht,dd(o,f,R,E),Pl();var pt=o.memoizedState;k!==Dt||ht!==pt||ks||a!==null&&a.dependencies!==null&&sp(a.dependencies)?(typeof B=="function"&&(Pp(o,u,B,f),pt=o.memoizedState),(Et=ks||DT(o,u,Et,f,ht,pt,q)||a!==null&&a.dependencies!==null&&sp(a.dependencies))?(ut||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(f,pt,q),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(f,pt,q)),typeof R.componentDidUpdate=="function"&&(o.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof R.componentDidUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=pt),R.props=f,R.state=pt,R.context=q,f=Et):(typeof R.componentDidUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=1024),f=!1)}return R=f,Cd(a,o),f=(o.flags&128)!==0,R||f?(R=o.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:R.render(),o.flags|=1,a!==null&&f?(o.child=xc(o,a.child,null,E),o.child=xc(o,null,u,E)):qi(a,o,u,E),o.memoizedState=R.state,a=o.child):a=Bs(a,o,E),a}function BT(a,o,u,f){return ad(),o.flags|=256,qi(a,o,u,f),o.child}var Bp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Fp(a){return{baseLanes:a,cachePool:cT()}}function eE(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=ra),a}function nE(a,o,u){var f=o.pendingProps,E=!1,R=(o.flags&128)!==0,k;if((k=R)||(k=a!==null&&a.memoizedState===null?!1:(Pi.current&2)!==0),k&&(E=!0,o.flags&=-129),k=(o.flags&32)!==0,o.flags&=-33,a===null){if(on){if(E?Io(o):Oo(),on){var B=ci,q;if(q=B){t:{for(q=B,B=Xa;q.nodeType!==8;){if(!B){B=null;break t}if(q=La(q.nextSibling),q===null){B=null;break t}}B=q}B!==null?(o.memoizedState={dehydrated:B,treeContext:qa!==null?{id:ws,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},q=Yi(18,null,null,0),q.stateNode=B,q.return=o,o.child=q,zi=o,ci=null,q=!0):q=!1}q||Dc(o)}if(B=o.memoizedState,B!==null&&(B=B.dehydrated,B!==null))return LE(B)?o.lanes=32:o.lanes=536870912,null;Vs(o)}return B=f.children,f=f.fallback,E?(Oo(),E=o.mode,B=Gp({mode:"hidden",children:B},E),f=Oc(f,E,u,null),B.return=o,f.return=o,B.sibling=f,o.child=B,E=o.child,E.memoizedState=Fp(u),E.childLanes=eE(a,k,u),o.memoizedState=Bp,f):(Io(o),jp(o,B))}if(q=a.memoizedState,q!==null&&(B=q.dehydrated,B!==null)){if(R)o.flags&256?(Io(o),o.flags&=-257,o=iE(a,o,u)):o.memoizedState!==null?(Oo(),o.child=a.child,o.flags|=128,o=null):(Oo(),E=f.fallback,B=o.mode,f=Gp({mode:"visible",children:f.children},B),E=Oc(E,B,u,null),E.flags|=2,f.return=o,E.return=o,f.sibling=E,o.child=f,xc(o,a.child,null,u),f=o.child,f.memoizedState=Fp(u),f.childLanes=eE(a,k,u),o.memoizedState=Bp,o=E);else if(Io(o),LE(B)){if(k=B.nextSibling&&B.nextSibling.dataset,k)var ut=k.dgst;k=ut,f=Error(b(419)),f.stack="",f.digest=k,To({value:f,source:null,stack:null}),o=iE(a,o,u)}else if(ki||Lc(a,o,u,!1),k=(u&a.childLanes)!==0,ki||k){if(k=Un,k!==null&&(f=u&-u,f=(f&42)!==0?1:Um(f),f=(f&(k.suspendedLanes|u))!==0?0:f,f!==0&&f!==q.retryLane))throw q.retryLane=f,go(a,f),Jr(k,a,f),Q_;B.data==="$?"||tf(),o=iE(a,o,u)}else B.data==="$?"?(o.flags|=192,o.child=a.child,o=null):(a=q.treeContext,ci=La(B.nextSibling),zi=o,on=!0,Nc=null,Xa=!1,a!==null&&(ia[zr++]=ws,ia[zr++]=Ns,ia[zr++]=qa,ws=a.id,Ns=a.overflow,qa=o),o=jp(o,f.children),o.flags|=4096);return o}return E?(Oo(),E=f.fallback,B=o.mode,q=a.child,ut=q.sibling,f=Os(q,{mode:"hidden",children:f.children}),f.subtreeFlags=q.subtreeFlags&65011712,ut!==null?E=Os(ut,E):(E=Oc(E,B,u,null),E.flags|=2),E.return=o,f.return=o,f.sibling=E,o.child=f,f=E,E=o.child,B=a.child.memoizedState,B===null?B=Fp(u):(q=B.cachePool,q!==null?(ut=Li._currentValue,q=q.parent!==ut?{parent:ut,pool:ut}:q):q=cT(),B={baseLanes:B.baseLanes|u,cachePool:q}),E.memoizedState=B,E.childLanes=eE(a,k,u),o.memoizedState=Bp,f):(Io(o),u=a.child,a=u.sibling,u=Os(u,{mode:"visible",children:f.children}),u.return=o,u.sibling=null,a!==null&&(k=o.deletions,k===null?(o.deletions=[a],o.flags|=16):k.push(a)),o.child=u,o.memoizedState=null,u)}function jp(a,o){return o=Gp({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Gp(a,o){return a=Yi(22,a,null,o),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function iE(a,o,u){return xc(o,a.child,null,u),a=jp(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function FT(a,o,u){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),rp(a.return,o,u)}function Kl(a,o,u,f,E){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:E}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=f,R.tail=u,R.tailMode=E)}function jT(a,o,u){var f=o.pendingProps,E=f.revealOrder,R=f.tail;if(qi(a,o,f.children,u),f=Pi.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)t:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&FT(a,u,o);else if(a.tag===19)FT(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break t;for(;a.sibling===null;){if(a.return===null||a.return===o)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}switch(qt(Pi,f),E){case"forwards":for(u=o.child,E=null;u!==null;)a=u.alternate,a!==null&&Lp(a)===null&&(E=u),u=u.sibling;u=E,u===null?(E=o.child,o.child=null):(E=u.sibling,u.sibling=null),Kl(o,!1,E,u,R);break;case"backwards":for(u=null,E=o.child,o.child=null;E!==null;){if(a=E.alternate,a!==null&&Lp(a)===null){o.child=E;break}a=E.sibling,E.sibling=u,u=E,E=a}Kl(o,!0,u,null,R);break;case"together":Kl(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Bs(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),xo|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(Lc(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(b(153));if(o.child!==null){for(a=o.child,u=Os(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=Os(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function rE(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&sp(a)))}function GT(a,o,u){switch(o.tag){case 3:Jn(o,o.stateNode.containerInfo),Ro(o,Li,a.memoizedState.cache),ad();break;case 27:case 5:Om(o);break;case 4:Jn(o,o.stateNode.containerInfo);break;case 10:Ro(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(Io(o),o.flags|=128,null):(u&o.child.childLanes)!==0?nE(a,o,u):(Io(o),a=Bs(a,o,u),a!==null?a.sibling:null);Io(o);break;case 19:var E=(a.flags&128)!==0;if(f=(u&o.childLanes)!==0,f||(Lc(a,o,u,!1),f=(u&o.childLanes)!==0),E){if(f)return jT(a,o,u);o.flags|=128}if(E=o.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),qt(Pi,Pi.current),f)break;return null;case 22:case 23:return o.lanes=0,Z_(a,o,u);case 24:Ro(o,Li,a.memoizedState.cache)}return Bs(a,o,u)}function HT(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)ki=!0;else{if(!rE(a,u)&&(o.flags&128)===0)return ki=!1,GT(a,o,u);ki=(a.flags&131072)!==0}else ki=!1,on&&(o.flags&1048576)!==0&&nT(o,id,o.index);switch(o.lanes=0,o.tag){case 16:t:{a=o.pendingProps;var f=o.elementType,E=f._init;if(f=E(f._payload),o.type=f,typeof f=="function")m_(f)?(a=Vc(f,a),o.tag=1,o=Vp(null,o,f,a,u)):(o.tag=0,o=$_(null,o,f,a,u));else{if(f!=null){if(E=f.$$typeof,E===ie){o.tag=11,o=VT(null,o,f,a,u);break t}else if(E===Le){o.tag=14,o=vd(null,o,f,a,u);break t}}throw o=Qe(f)||f,Error(b(306,o,""))}}return o;case 0:return $_(a,o,o.type,o.pendingProps,u);case 1:return f=o.type,E=Vc(f,o.pendingProps),Vp(a,o,f,E,u);case 3:t:{if(Jn(o,o.stateNode.containerInfo),a===null)throw Error(b(387));f=o.pendingProps;var R=o.memoizedState;E=R.element,fp(a,o),dd(o,f,null,u);var k=o.memoizedState;if(f=k.cache,Ro(o,Li,f),f!==R.cache&&ap(o,[Li],u,!0),Pl(),f=k.element,R.isDehydrated)if(R={element:f,isDehydrated:!1,cache:k.cache},o.updateQueue.baseState=R,o.memoizedState=R,o.flags&256){o=BT(a,o,f,u);break t}else if(f!==E){E=na(Error(b(424)),o),To(E),o=BT(a,o,f,u);break t}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(ci=La(a.firstChild),zi=o,on=!0,Nc=null,Xa=!0,u=wT(o,null,f,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(ad(),f===E){o=Bs(a,o,u);break t}qi(a,o,f,u)}o=o.child}return o;case 26:return Cd(a,o),a===null?(u=NR(o.type,null,o.pendingProps,null))?o.memoizedState=u:on||(u=o.type,a=o.pendingProps,f=mf(fe.current).createElement(u),f[On]=o,f[Cr]=a,Xi(f,u,a),vi(f),o.stateNode=f):o.memoizedState=NR(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Om(o),a===null&&on&&(f=o.stateNode=bR(o.type,o.pendingProps,fe.current),zi=o,Xa=!0,E=ci,Ho(o.type)?(PE=E,ci=La(f.firstChild)):ci=E),qi(a,o,o.pendingProps.children,u),Cd(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&on&&((E=f=ci)&&(f=bA(f,o.type,o.pendingProps,Xa),f!==null?(o.stateNode=f,zi=o,ci=La(f.firstChild),Xa=!1,E=!0):E=!1),E||Dc(o)),Om(o),E=o.type,R=o.pendingProps,k=a!==null?a.memoizedProps:null,f=R.children,OE(E,R)?f=null:k!==null&&OE(E,k)&&(o.flags|=32),o.memoizedState!==null&&(E=N_(a,o,cA,null,null,u),cu._currentValue=E),Cd(a,o),qi(a,o,f,u),o.child;case 6:return a===null&&on&&((a=u=ci)&&(u=IA(u,o.pendingProps,Xa),u!==null?(o.stateNode=u,zi=o,ci=null,a=!0):a=!1),a||Dc(o)),null;case 13:return nE(a,o,u);case 4:return Jn(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=xc(o,null,f,u):qi(a,o,f,u),o.child;case 11:return VT(a,o,o.type,o.pendingProps,u);case 7:return qi(a,o,o.pendingProps,u),o.child;case 8:return qi(a,o,o.pendingProps.children,u),o.child;case 12:return qi(a,o,o.pendingProps.children,u),o.child;case 10:return f=o.pendingProps,Ro(o,o.type,f.value),qi(a,o,f.children,u),o.child;case 9:return E=o.type._context,f=o.pendingProps.children,Pc(o),E=Ci(E),f=f(E),o.flags|=1,qi(a,o,f,u),o.child;case 14:return vd(a,o,o.type,o.pendingProps,u);case 15:return xp(a,o,o.type,o.pendingProps,u);case 19:return jT(a,o,u);case 31:return f=o.pendingProps,u=o.mode,f={mode:f.mode,children:f.children},a===null?(u=Gp(f,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=Os(a.child,f),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return Z_(a,o,u);case 24:return Pc(o),f=Ci(Li),a===null?(E=R_(),E===null&&(E=Un,R=cp(),E.pooledCache=R,R.refCount++,R!==null&&(E.pooledCacheLanes|=u),E=R),o.memoizedState={parent:f,cache:E},ud(o),Ro(o,Li,E)):((a.lanes&u)!==0&&(fp(a,o),dd(o,null,null,u),Pl()),E=a.memoizedState,R=o.memoizedState,E.parent!==f?(E={parent:f,cache:f},o.memoizedState=E,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=E),Ro(o,Li,f)):(f=R.cache,Ro(o,Li,f),f!==E.cache&&ap(o,[Li],u,!0))),qi(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(b(156,o.tag))}function Fs(a){a.flags|=4}function Hp(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!UR(o)){if(o=qr.current,o!==null&&(($e&4194048)===$e?Qa!==null:($e&62914560)!==$e&&($e&536870912)===0||o!==Qa))throw ld=y_,v_;a.flags|=8192}}function Wp(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?km():536870912,a.lanes|=o,Vo|=o)}function Bc(a,o){if(!on)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function ti(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,f=0;if(o)for(var E=a.child;E!==null;)u|=E.lanes|E.childLanes,f|=E.subtreeFlags&65011712,f|=E.flags&65011712,E.return=a,E=E.sibling;else for(E=a.child;E!==null;)u|=E.lanes|E.childLanes,f|=E.subtreeFlags,f|=E.flags,E.return=a,E=E.sibling;return a.subtreeFlags|=f,a.childLanes=u,o}function WT(a,o,u){var f=o.pendingProps;switch(ip(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ti(o),null;case 1:return ti(o),null;case 3:return u=o.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Ps(Li),Ka(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(rd(o)?Fs(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,aT())),ti(o),null;case 26:return u=o.memoizedState,a===null?(Fs(o),u!==null?(ti(o),Hp(o,u)):(ti(o),o.flags&=-16777217)):u?u!==a.memoizedState?(Fs(o),ti(o),Hp(o,u)):(ti(o),o.flags&=-16777217):(a.memoizedProps!==f&&Fs(o),ti(o),o.flags&=-16777217),null;case 27:Ec(o),u=fe.current;var E=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Fs(o);else{if(!f){if(o.stateNode===null)throw Error(b(166));return ti(o),null}a=ne.current,rd(o)?iT(o):(a=bR(E,f,u),o.stateNode=a,Fs(o))}return ti(o),null;case 5:if(Ec(o),u=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Fs(o);else{if(!f){if(o.stateNode===null)throw Error(b(166));return ti(o),null}if(a=ne.current,rd(o))iT(o);else{switch(E=mf(fe.current),a){case 1:a=E.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=E.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=E.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=E.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=E.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof f.is=="string"?E.createElement("select",{is:f.is}):E.createElement("select"),f.multiple?a.multiple=!0:f.size&&(a.size=f.size);break;default:a=typeof f.is=="string"?E.createElement(u,{is:f.is}):E.createElement(u)}}a[On]=o,a[Cr]=f;t:for(E=o.child;E!==null;){if(E.tag===5||E.tag===6)a.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===o)break t;for(;E.sibling===null;){if(E.return===null||E.return===o)break t;E=E.return}E.sibling.return=E.return,E=E.sibling}o.stateNode=a;t:switch(Xi(a,u,f),u){case"button":case"input":case"select":case"textarea":a=!!f.autoFocus;break t;case"img":a=!0;break t;default:a=!1}a&&Fs(o)}}return ti(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==f&&Fs(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(b(166));if(a=fe.current,rd(o)){if(a=o.stateNode,u=o.memoizedProps,f=null,E=zi,E!==null)switch(E.tag){case 27:case 5:f=E.memoizedProps}a[On]=o,a=!!(a.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||TR(a.nodeValue,u)),a||Dc(o)}else a=mf(a).createTextNode(f),a[On]=o,o.stateNode=a}return ti(o),null;case 13:if(f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(E=rd(o),f!==null&&f.dehydrated!==null){if(a===null){if(!E)throw Error(b(318));if(E=o.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(b(317));E[On]=o}else ad(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ti(o),E=!1}else E=aT(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=E),E=!0;if(!E)return o.flags&256?(Vs(o),o):(Vs(o),null)}if(Vs(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=f!==null,a=a!==null&&a.memoizedState!==null,u){f=o.child,E=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(E=f.alternate.memoizedState.cachePool.pool);var R=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(R=f.memoizedState.cachePool.pool),R!==E&&(f.flags|=2048)}return u!==a&&u&&(o.child.flags|=8192),Wp(o,o.updateQueue),ti(o),null;case 4:return Ka(),a===null&&Go(o.stateNode.containerInfo),ti(o),null;case 10:return Ps(o.type),ti(o),null;case 19:if(Zt(Pi),E=o.memoizedState,E===null)return ti(o),null;if(f=(o.flags&128)!==0,R=E.rendering,R===null)if(f)Bc(E,!1);else{if(li!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(R=Lp(a),R!==null){for(o.flags|=128,Bc(E,!1),a=R.updateQueue,o.updateQueue=a,Wp(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)eT(u,a),u=u.sibling;return qt(Pi,Pi.current&1|2),o.child}a=a.sibling}E.tail!==null&&Ya()>Xl&&(o.flags|=128,f=!0,Bc(E,!1),o.lanes=4194304)}else{if(!f)if(a=Lp(R),a!==null){if(o.flags|=128,f=!0,a=a.updateQueue,o.updateQueue=a,Wp(o,a),Bc(E,!0),E.tail===null&&E.tailMode==="hidden"&&!R.alternate&&!on)return ti(o),null}else 2*Ya()-E.renderingStartTime>Xl&&u!==536870912&&(o.flags|=128,f=!0,Bc(E,!1),o.lanes=4194304);E.isBackwards?(R.sibling=o.child,o.child=R):(a=E.last,a!==null?a.sibling=R:o.child=R,E.last=R)}return E.tail!==null?(o=E.tail,E.rendering=o,E.tail=o.sibling,E.renderingStartTime=Ya(),o.sibling=null,a=Pi.current,qt(Pi,f?a&1|2:a&1),o):(ti(o),null);case 22:case 23:return Vs(o),w_(),f=o.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(u&536870912)!==0&&(o.flags&128)===0&&(ti(o),o.subtreeFlags&6&&(o.flags|=8192)):ti(o),u=o.updateQueue,u!==null&&Wp(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==u&&(o.flags|=2048),a!==null&&Zt(kc),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),Ps(Li),ti(o),null;case 25:return null;case 30:return null}throw Error(b(156,o.tag))}function pA(a,o){switch(ip(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return Ps(Li),Ka(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return Ec(o),null;case 13:if(Vs(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(b(340));ad()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Zt(Pi),null;case 4:return Ka(),null;case 10:return Ps(o.type),null;case 22:case 23:return Vs(o),w_(),a!==null&&Zt(kc),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return Ps(Li),null;case 25:return null;default:return null}}function KT(a,o){switch(ip(o),o.tag){case 3:Ps(Li),Ka();break;case 26:case 27:case 5:Ec(o);break;case 4:Ka();break;case 13:Vs(o);break;case 19:Zt(Pi);break;case 10:Ps(o.type);break;case 22:case 23:Vs(o),w_(),a!==null&&Zt(kc);break;case 24:Ps(Li)}}function Yl(a,o){try{var u=o.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var E=f.next;u=E;do{if((u.tag&a)===a){f=void 0;var R=u.create,k=u.inst;f=R(),k.destroy=f}u=u.next}while(u!==E)}}catch(B){xn(o,o.return,B)}}function wo(a,o,u){try{var f=o.updateQueue,E=f!==null?f.lastEffect:null;if(E!==null){var R=E.next;f=R;do{if((f.tag&a)===a){var k=f.inst,B=k.destroy;if(B!==void 0){k.destroy=void 0,E=o;var q=u,ut=B;try{ut()}catch(Et){xn(E,q,Et)}}}f=f.next}while(f!==R)}}catch(Et){xn(o,o.return,Et)}}function YT(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{I_(o,u)}catch(f){xn(a,a.return,f)}}}function aE(a,o,u){u.props=Vc(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(f){xn(a,o,f)}}function Ad(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var f=a.stateNode;break;case 30:f=a.stateNode;break;default:f=a.stateNode}typeof u=="function"?a.refCleanup=u(f):u.current=f}}catch(E){xn(a,o,E)}}function Ia(a,o){var u=a.ref,f=a.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(E){xn(a,o,E)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(E){xn(a,o,E)}else u.current=null}function Kp(a){var o=a.type,u=a.memoizedProps,f=a.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break t;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(E){xn(a,a.return,E)}}function sE(a,o,u){try{var f=a.stateNode;RA(f,a.type,u,o),f[Cr]=o}catch(E){xn(a,a.return,E)}}function zT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ho(a.type)||a.tag===4}function Fc(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||zT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ho(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Yp(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=ff));else if(f!==4&&(f===27&&Ho(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(Yp(a,o,u),a=a.sibling;a!==null;)Yp(a,o,u),a=a.sibling}function No(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(f!==4&&(f===27&&Ho(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(No(a,o,u),a=a.sibling;a!==null;)No(a,o,u),a=a.sibling}function jc(a){var o=a.stateNode,u=a.memoizedProps;try{for(var f=a.type,E=o.attributes;E.length;)o.removeAttributeNode(E[0]);Xi(o,f,u),o[On]=a,o[Cr]=u}catch(R){xn(a,a.return,R)}}var $a=!1,ei=!1,zl=!1,qT=typeof WeakSet=="function"?WeakSet:Set,ji=null;function fA(a,o){if(a=a.containerInfo,bE=Tf,a=zS(a),pr(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else t:{u=(u=a.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var E=f.anchorOffset,R=f.focusNode;f=f.focusOffset;try{u.nodeType,R.nodeType}catch{u=null;break t}var k=0,B=-1,q=-1,ut=0,Et=0,Dt=a,ht=null;e:for(;;){for(var pt;Dt!==u||E!==0&&Dt.nodeType!==3||(B=k+E),Dt!==R||f!==0&&Dt.nodeType!==3||(q=k+f),Dt.nodeType===3&&(k+=Dt.nodeValue.length),(pt=Dt.firstChild)!==null;)ht=Dt,Dt=pt;for(;;){if(Dt===a)break e;if(ht===u&&++ut===E&&(B=k),ht===R&&++Et===f&&(q=k),(pt=Dt.nextSibling)!==null)break;Dt=ht,ht=Dt.parentNode}Dt=pt}u=B===-1||q===-1?null:{start:B,end:q}}else u=null}u=u||{start:0,end:0}}else u=null;for(IE={focusedElem:a,selectionRange:u},Tf=!1,ji=o;ji!==null;)if(o=ji,a=o.child,(o.subtreeFlags&1024)!==0&&a!==null)a.return=o,ji=a;else for(;ji!==null;){switch(o=ji,R=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&R!==null){a=void 0,u=o,E=R.memoizedProps,R=R.memoizedState,f=u.stateNode;try{var ye=Vc(u.type,E,u.elementType===u.type);a=f.getSnapshotBeforeUpdate(ye,R),f.__reactInternalSnapshotBeforeUpdate=a}catch(se){xn(u,u.return,se)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)DE(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":DE(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(b(163))}if(a=o.sibling,a!==null){a.return=o.return,ji=a;break}ji=o.return}}function oE(a,o,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:js(a,u),f&4&&Yl(5,u);break;case 1:if(js(a,u),f&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(k){xn(u,u.return,k)}else{var E=Vc(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(E,o,a.__reactInternalSnapshotBeforeUpdate)}catch(k){xn(u,u.return,k)}}f&64&&YT(u),f&512&&Ad(u,u.return);break;case 3:if(js(a,u),f&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{I_(a,o)}catch(k){xn(u,u.return,k)}}break;case 27:o===null&&f&4&&jc(u);case 26:case 5:js(a,u),o===null&&f&4&&Kp(u),f&512&&Ad(u,u.return);break;case 12:js(a,u);break;case 13:js(a,u),f&4&&JT(a,u),f&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=RE.bind(null,u),OA(a,u))));break;case 22:if(f=u.memoizedState!==null||$a,!f){o=o!==null&&o.memoizedState!==null||ei,E=$a;var R=ei;$a=f,(ei=o)&&!R?Lo(a,u,(u.subtreeFlags&8772)!==0):js(a,u),$a=E,ei=R}break;case 30:break;default:js(a,u)}}function XT(a){var o=a.alternate;o!==null&&(a.alternate=null,XT(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Uh(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Qn=null,Or=!1;function Oa(a,o,u){for(u=u.child;u!==null;)bd(a,o,u),u=u.sibling}function bd(a,o,u){if(Mn&&typeof Mn.onCommitFiberUnmount=="function")try{Mn.onCommitFiberUnmount(ml,u)}catch{}switch(u.tag){case 26:ei||Ia(u,o),Oa(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ei||Ia(u,o);var f=Qn,E=Or;Ho(u.type)&&(Qn=u.stateNode,Or=!1),Oa(a,o,u),Vd(u.stateNode),Qn=f,Or=E;break;case 5:ei||Ia(u,o);case 6:if(f=Qn,E=Or,Qn=null,Oa(a,o,u),Qn=f,Or=E,Qn!==null)if(Or)try{(Qn.nodeType===9?Qn.body:Qn.nodeName==="HTML"?Qn.ownerDocument.body:Qn).removeChild(u.stateNode)}catch(R){xn(u,o,R)}else try{Qn.removeChild(u.stateNode)}catch(R){xn(u,o,R)}break;case 18:Qn!==null&&(Or?(a=Qn,CR(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),Pr(a)):CR(Qn,u.stateNode));break;case 4:f=Qn,E=Or,Qn=u.stateNode.containerInfo,Or=!0,Oa(a,o,u),Qn=f,Or=E;break;case 0:case 11:case 14:case 15:ei||wo(2,u,o),ei||wo(4,u,o),Oa(a,o,u);break;case 1:ei||(Ia(u,o),f=u.stateNode,typeof f.componentWillUnmount=="function"&&aE(u,o,f)),Oa(a,o,u);break;case 21:Oa(a,o,u);break;case 22:ei=(f=ei)||u.memoizedState!==null,Oa(a,o,u),ei=f;break;default:Oa(a,o,u)}}function JT(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Pr(a)}catch(u){xn(o,o.return,u)}}function ql(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new qT),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new qT),o;default:throw Error(b(435,a.tag))}}function zp(a,o){var u=ql(a);o.forEach(function(f){var E=EA.bind(null,a,f);u.has(f)||(u.add(f),f.then(E,E))})}function zn(a,o){var u=o.deletions;if(u!==null)for(var f=0;f<u.length;f++){var E=u[f],R=a,k=o,B=k;t:for(;B!==null;){switch(B.tag){case 27:if(Ho(B.type)){Qn=B.stateNode,Or=!1;break t}break;case 5:Qn=B.stateNode,Or=!1;break t;case 3:case 4:Qn=B.stateNode.containerInfo,Or=!0;break t}B=B.return}if(Qn===null)throw Error(b(160));bd(R,k,E),Qn=null,Or=!1,R=E.alternate,R!==null&&(R.return=null),E.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)QT(o,a),o=o.sibling}var wa=null;function QT(a,o){var u=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:zn(o,a),wr(a),f&4&&(wo(3,a,a.return),Yl(3,a),wo(5,a,a.return));break;case 1:zn(o,a),wr(a),f&512&&(ei||u===null||Ia(u,u.return)),f&64&&$a&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var E=wa;if(zn(o,a),wr(a),f&512&&(ei||u===null||Ia(u,u.return)),f&4){var R=u!==null?u.memoizedState:null;if(f=a.memoizedState,u===null)if(f===null)if(a.stateNode===null){t:{f=a.type,u=a.memoizedProps,E=E.ownerDocument||E;e:switch(f){case"title":R=E.getElementsByTagName("title")[0],(!R||R[Hu]||R[On]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=E.createElement(f),E.head.insertBefore(R,E.querySelector("head > title"))),Xi(R,f,u),R[On]=a,vi(R),f=R;break t;case"link":var k=kR("link","href",E).get(f+(u.href||""));if(k){for(var B=0;B<k.length;B++)if(R=k[B],R.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&R.getAttribute("rel")===(u.rel==null?null:u.rel)&&R.getAttribute("title")===(u.title==null?null:u.title)&&R.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){k.splice(B,1);break e}}R=E.createElement(f),Xi(R,f,u),E.head.appendChild(R);break;case"meta":if(k=kR("meta","content",E).get(f+(u.content||""))){for(B=0;B<k.length;B++)if(R=k[B],R.getAttribute("content")===(u.content==null?null:""+u.content)&&R.getAttribute("name")===(u.name==null?null:u.name)&&R.getAttribute("property")===(u.property==null?null:u.property)&&R.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&R.getAttribute("charset")===(u.charSet==null?null:u.charSet)){k.splice(B,1);break e}}R=E.createElement(f),Xi(R,f,u),E.head.appendChild(R);break;default:throw Error(b(468,f))}R[On]=a,vi(R),f=R}a.stateNode=f}else MR(E,a.type,a.stateNode);else a.stateNode=PR(E,f,a.memoizedProps);else R!==f?(R===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):R.count--,f===null?MR(E,a.type,a.stateNode):PR(E,f,a.memoizedProps)):f===null&&a.stateNode!==null&&sE(a,a.memoizedProps,u.memoizedProps)}break;case 27:zn(o,a),wr(a),f&512&&(ei||u===null||Ia(u,u.return)),u!==null&&f&4&&sE(a,a.memoizedProps,u.memoizedProps);break;case 5:if(zn(o,a),wr(a),f&512&&(ei||u===null||Ia(u,u.return)),a.flags&32){E=a.stateNode;try{yc(E,"")}catch(pt){xn(a,a.return,pt)}}f&4&&a.stateNode!=null&&(E=a.memoizedProps,sE(a,E,u!==null?u.memoizedProps:E)),f&1024&&(zl=!0);break;case 6:if(zn(o,a),wr(a),f&4){if(a.stateNode===null)throw Error(b(162));f=a.memoizedProps,u=a.stateNode;try{u.nodeValue=f}catch(pt){xn(a,a.return,pt)}}break;case 3:if(jd=null,E=wa,wa=_f(o.containerInfo),zn(o,a),wa=E,wr(a),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Pr(o.containerInfo)}catch(pt){xn(a,a.return,pt)}zl&&(zl=!1,ZT(a));break;case 4:f=wa,wa=_f(a.stateNode.containerInfo),zn(o,a),wr(a),wa=f;break;case 12:zn(o,a),wr(a);break;case 13:zn(o,a),wr(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(fE=Ya()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,zp(a,f)));break;case 22:E=a.memoizedState!==null;var q=u!==null&&u.memoizedState!==null,ut=$a,Et=ei;if($a=ut||E,ei=Et||q,zn(o,a),ei=Et,$a=ut,wr(a),f&8192)t:for(o=a.stateNode,o._visibility=E?o._visibility&-2:o._visibility|1,E&&(u===null||q||$a||ei||Do(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){q=u=o;try{if(R=q.stateNode,E)k=R.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{B=q.stateNode;var Dt=q.memoizedProps.style,ht=Dt!=null&&Dt.hasOwnProperty("display")?Dt.display:null;B.style.display=ht==null||typeof ht=="boolean"?"":(""+ht).trim()}}catch(pt){xn(q,q.return,pt)}}}else if(o.tag===6){if(u===null){q=o;try{q.stateNode.nodeValue=E?"":q.memoizedProps}catch(pt){xn(q,q.return,pt)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break t;for(;o.sibling===null;){if(o.return===null||o.return===a)break t;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=a.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,zp(a,u))));break;case 19:zn(o,a),wr(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,zp(a,f)));break;case 30:break;case 21:break;default:zn(o,a),wr(a)}}function wr(a){var o=a.flags;if(o&2){try{for(var u,f=a.return;f!==null;){if(zT(f)){u=f;break}f=f.return}if(u==null)throw Error(b(160));switch(u.tag){case 27:var E=u.stateNode,R=Fc(a);No(a,R,E);break;case 5:var k=u.stateNode;u.flags&32&&(yc(k,""),u.flags&=-33);var B=Fc(a);No(a,B,k);break;case 3:case 4:var q=u.stateNode.containerInfo,ut=Fc(a);Yp(a,ut,q);break;default:throw Error(b(161))}}catch(Et){xn(a,a.return,Et)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function ZT(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;ZT(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function js(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)oE(a,o.alternate,o),o=o.sibling}function Do(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:wo(4,o,o.return),Do(o);break;case 1:Ia(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&aE(o,o.return,u),Do(o);break;case 27:Vd(o.stateNode);case 26:case 5:Ia(o,o.return),Do(o);break;case 22:o.memoizedState===null&&Do(o);break;case 30:Do(o);break;default:Do(o)}a=a.sibling}}function Lo(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,E=a,R=o,k=R.flags;switch(R.tag){case 0:case 11:case 15:Lo(E,R,u),Yl(4,R);break;case 1:if(Lo(E,R,u),f=R,E=f.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(ut){xn(f,f.return,ut)}if(f=R,E=f.updateQueue,E!==null){var B=f.stateNode;try{var q=E.shared.hiddenCallbacks;if(q!==null)for(E.shared.hiddenCallbacks=null,E=0;E<q.length;E++)uT(q[E],B)}catch(ut){xn(f,f.return,ut)}}u&&k&64&&YT(R),Ad(R,R.return);break;case 27:jc(R);case 26:case 5:Lo(E,R,u),u&&f===null&&k&4&&Kp(R),Ad(R,R.return);break;case 12:Lo(E,R,u);break;case 13:Lo(E,R,u),u&&k&4&&JT(E,R);break;case 22:R.memoizedState===null&&Lo(E,R,u),Ad(R,R.return);break;case 30:break;default:Lo(E,R,u)}o=o.sibling}}function qp(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&sd(u))}function cE(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&sd(a))}function ts(a,o,u,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)$T(a,o,u,f),o=o.sibling}function $T(a,o,u,f){var E=o.flags;switch(o.tag){case 0:case 11:case 15:ts(a,o,u,f),E&2048&&Yl(9,o);break;case 1:ts(a,o,u,f);break;case 3:ts(a,o,u,f),E&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&sd(a)));break;case 12:if(E&2048){ts(a,o,u,f),a=o.stateNode;try{var R=o.memoizedProps,k=R.id,B=R.onPostCommit;typeof B=="function"&&B(k,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(q){xn(o,o.return,q)}}else ts(a,o,u,f);break;case 13:ts(a,o,u,f);break;case 23:break;case 22:R=o.stateNode,k=o.alternate,o.memoizedState!==null?R._visibility&2?ts(a,o,u,f):Gc(a,o):R._visibility&2?ts(a,o,u,f):(R._visibility|=2,Po(a,o,u,f,(o.subtreeFlags&10256)!==0)),E&2048&&qp(k,o);break;case 24:ts(a,o,u,f),E&2048&&cE(o.alternate,o);break;default:ts(a,o,u,f)}}function Po(a,o,u,f,E){for(E=E&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var R=a,k=o,B=u,q=f,ut=k.flags;switch(k.tag){case 0:case 11:case 15:Po(R,k,B,q,E),Yl(8,k);break;case 23:break;case 22:var Et=k.stateNode;k.memoizedState!==null?Et._visibility&2?Po(R,k,B,q,E):Gc(R,k):(Et._visibility|=2,Po(R,k,B,q,E)),E&&ut&2048&&qp(k.alternate,k);break;case 24:Po(R,k,B,q,E),E&&ut&2048&&cE(k.alternate,k);break;default:Po(R,k,B,q,E)}o=o.sibling}}function Gc(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,f=o,E=f.flags;switch(f.tag){case 22:Gc(u,f),E&2048&&qp(f.alternate,f);break;case 24:Gc(u,f),E&2048&&cE(f.alternate,f);break;default:Gc(u,f)}o=o.sibling}}var Id=8192;function ko(a){if(a.subtreeFlags&Id)for(a=a.child;a!==null;)tR(a),a=a.sibling}function tR(a){switch(a.tag){case 26:ko(a),a.flags&Id&&a.memoizedState!==null&&xA(wa,a.memoizedState,a.memoizedProps);break;case 5:ko(a);break;case 3:case 4:var o=wa;wa=_f(a.stateNode.containerInfo),ko(a),wa=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=Id,Id=16777216,ko(a),Id=o):ko(a));break;default:ko(a)}}function lE(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Od(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];ji=f,uE(f,a)}lE(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Xp(a),a=a.sibling}function Xp(a){switch(a.tag){case 0:case 11:case 15:Od(a),a.flags&2048&&wo(9,a,a.return);break;case 3:Od(a);break;case 12:Od(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,Mo(a)):Od(a);break;default:Od(a)}}function Mo(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];ji=f,uE(f,a)}lE(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:wo(8,o,o.return),Mo(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Mo(o));break;default:Mo(o)}a=a.sibling}}function uE(a,o){for(;ji!==null;){var u=ji;switch(u.tag){case 0:case 11:case 15:wo(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:sd(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,ji=f;else t:for(u=a;ji!==null;){f=ji;var E=f.sibling,R=f.return;if(XT(f),f===u){ji=null;break t}if(E!==null){E.return=R,ji=E;break t}ji=R}}}var dE={getCacheForType:function(a){var o=Ci(Li),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u}},hE=typeof WeakMap=="function"?WeakMap:Map,Rn=0,Un=null,Ue=null,$e=0,an=0,mr=null,es=!1,Uo=!1,Jp=!1,ns=0,li=0,xo=0,Xr=0,Qp=0,ra=0,Vo=0,wd=null,Nr=null,pE=!1,fE=0,Xl=1/0,Nd=null,Gs=null,Gi=0,Na=null,Hc=null,Bo=0,Jl=0,Ql=null,mE=null,is=0,Hs=null;function Dr(){if((Rn&2)!==0&&$e!==0)return $e&-$e;if(gt.T!==null){var a=vo;return a!==0?a:xd()}return ES()}function eR(){ra===0&&(ra=($e&536870912)===0||on?gc():536870912);var a=qr.current;return a!==null&&(a.flags|=32),ra}function Jr(a,o,u){(a===Un&&(an===2||an===9)||a.cancelPendingCommit!==null)&&($l(a,0),Fo(a,$e,ra,!1)),Gu(a,u),((Rn&2)===0||a!==Un)&&(a===Un&&((Rn&2)===0&&(Xr|=u),li===4&&Fo(a,$e,ra,!1)),Da(a))}function Zl(a,o,u){if((Rn&6)!==0)throw Error(b(327));var f=!u&&(o&124)===0&&(o&a.expiredLanes)===0||ju(a,o),E=f?rs(a,o):gE(a,o,!0),R=f;do{if(E===0){Uo&&!f&&Fo(a,o,0,!1);break}else{if(u=a.current.alternate,R&&!mA(u)){E=gE(a,o,!1),R=!1;continue}if(E===2){if(R=o,a.errorRecoveryDisabledLanes&R)var k=0;else k=a.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){o=k;t:{var B=a;E=wd;var q=B.current.memoizedState.isDehydrated;if(q&&($l(B,k).flags|=256),k=gE(B,k,!1),k!==2){if(Jp&&!q){B.errorRecoveryDisabledLanes|=R,Xr|=R,E=4;break t}R=Nr,Nr=E,R!==null&&(Nr===null?Nr=R:Nr.push.apply(Nr,R))}E=k}if(R=!1,E!==2)continue}}if(E===1){$l(a,0),Fo(a,o,0,!0);break}t:{switch(f=a,R=E,R){case 0:case 1:throw Error(b(345));case 4:if((o&4194048)!==o)break;case 6:Fo(f,o,ra,!es);break t;case 2:Nr=null;break;case 3:case 5:break;default:throw Error(b(329))}if((o&62914560)===o&&(E=fE+300-Ya(),10<E)){if(Fo(f,o,ra,!es),Fu(f,0,!0)!==0)break t;f.timeoutHandle=yR(nR.bind(null,f,u,Nr,Nd,pE,o,ra,Xr,Vo,es,R,2,-0,0),E);break t}nR(f,u,Nr,Nd,pE,o,ra,Xr,Vo,es,R,0,-0,0)}}break}while(!0);Da(a)}function nR(a,o,u,f,E,R,k,B,q,ut,Et,Dt,ht,pt){if(a.timeoutHandle=-1,Dt=o.subtreeFlags,(Dt&8192||(Dt&16785408)===16785408)&&(Gd={stylesheets:null,count:0,unsuspend:UA},tR(o),Dt=xR(),Dt!==null)){a.cancelPendingCommit=Dt(Pd.bind(null,a,o,R,u,f,E,k,B,q,Et,1,ht,pt)),Fo(a,R,k,!ut);return}Pd(a,o,R,u,f,E,k,B,q)}function mA(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var E=u[f],R=E.getSnapshot;E=E.value;try{if(!Yr(R(),E))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Fo(a,o,u,f){o&=~Qp,o&=~Xr,a.suspendedLanes|=o,a.pingedLanes&=~o,f&&(a.warmLanes|=o),f=a.expirationTimes;for(var E=o;0<E;){var R=31-yr(E),k=1<<R;f[R]=-1,E&=~k}u!==0&&_S(a,u,o)}function Zp(){return(Rn&6)===0?(Ud(0),!1):!0}function _E(){if(Ue!==null){if(an===0)var a=Ue.return;else a=Ue,Ls=Ds=null,hd(a),Wl=null,Sd=0,a=Ue;for(;a!==null;)KT(a.alternate,a),a=a.return;Ue=null}}function $l(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,yA(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),_E(),Un=a,Ue=u=Os(a.current,null),$e=o,an=0,mr=null,es=!1,Uo=ju(a,o),Jp=!1,Vo=ra=Qp=Xr=xo=li=0,Nr=wd=null,pE=!1,(o&8)!==0&&(o|=o&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=o;0<f;){var E=31-yr(f),R=1<<E;o|=a[E],f&=~R}return ns=o,ep(),u}function $p(a,o){Me=null,gt.H=gd,o===yo||o===up?(o=hp(),an=3):o===v_?(o=hp(),an=4):an=o===Q_?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,mr=o,Ue===null&&(li=1,Up(a,na(o,a.current)))}function EE(){var a=gt.H;return gt.H=gd,a===null?gd:a}function iR(){var a=gt.A;return gt.A=dE,a}function tf(){li=4,es||($e&4194048)!==$e&&qr.current!==null||(Uo=!0),(xo&134217727)===0&&(Xr&134217727)===0||Un===null||Fo(Un,$e,ra,!1)}function gE(a,o,u){var f=Rn;Rn|=2;var E=EE(),R=iR();(Un!==a||$e!==o)&&(Nd=null,$l(a,o)),o=!1;var k=li;t:do try{if(an!==0&&Ue!==null){var B=Ue,q=mr;switch(an){case 8:_E(),k=6;break t;case 3:case 2:case 9:case 6:qr.current===null&&(o=!0);var ut=an;if(an=0,mr=null,jo(a,B,q,ut),u&&Uo){k=0;break t}break;default:ut=an,an=0,mr=null,jo(a,B,q,ut)}}Dd(),k=li;break}catch(Et){$p(a,Et)}while(!0);return o&&a.shellSuspendCounter++,Ls=Ds=null,Rn=f,gt.H=E,gt.A=R,Ue===null&&(Un=null,$e=0,ep()),k}function Dd(){for(;Ue!==null;)aR(Ue)}function rs(a,o){var u=Rn;Rn|=2;var f=EE(),E=iR();Un!==a||$e!==o?(Nd=null,Xl=Ya()+500,$l(a,o)):Uo=ju(a,o);t:do try{if(an!==0&&Ue!==null){o=Ue;var R=mr;e:switch(an){case 1:an=0,mr=null,jo(a,o,R,1);break;case 2:case 9:if(C_(R)){an=0,mr=null,sR(o);break}o=function(){an!==2&&an!==9||Un!==a||(an=7),Da(a)},R.then(o,o);break t;case 3:an=7;break t;case 4:an=5;break t;case 7:C_(R)?(an=0,mr=null,sR(o)):(an=0,mr=null,jo(a,o,R,7));break;case 5:var k=null;switch(Ue.tag){case 26:k=Ue.memoizedState;case 5:case 27:var B=Ue;if(!k||UR(k)){an=0,mr=null;var q=B.sibling;if(q!==null)Ue=q;else{var ut=B.return;ut!==null?(Ue=ut,Ld(ut)):Ue=null}break e}}an=0,mr=null,jo(a,o,R,5);break;case 6:an=0,mr=null,jo(a,o,R,6);break;case 8:_E(),li=6;break t;default:throw Error(b(462))}}rR();break}catch(Et){$p(a,Et)}while(!0);return Ls=Ds=null,gt.H=f,gt.A=E,Rn=u,Ue!==null?0:(Un=null,$e=0,ep(),li)}function rR(){for(;Ue!==null&&!fl();)aR(Ue)}function aR(a){var o=HT(a.alternate,a,ns);a.memoizedProps=a.pendingProps,o===null?Ld(a):Ue=o}function sR(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=tE(u,o,o.pendingProps,o.type,void 0,$e);break;case 11:o=tE(u,o,o.pendingProps,o.type.render,o.ref,$e);break;case 5:hd(o);default:KT(u,o),o=Ue=eT(o,ns),o=HT(u,o,ns)}a.memoizedProps=a.pendingProps,o===null?Ld(a):Ue=o}function jo(a,o,u,f){Ls=Ds=null,hd(o),Wl=null,Sd=0;var E=o.return;try{if(hA(a,E,o,u,$e)){li=1,Up(a,na(u,a.current)),Ue=null;return}}catch(R){if(E!==null)throw Ue=E,R;li=1,Up(a,na(u,a.current)),Ue=null;return}o.flags&32768?(on||f===1?a=!0:Uo||($e&536870912)!==0?a=!1:(es=a=!0,(f===2||f===9||f===3||f===6)&&(f=qr.current,f!==null&&f.tag===13&&(f.flags|=16384))),oR(o,a)):Ld(o)}function Ld(a){var o=a;do{if((o.flags&32768)!==0){oR(o,es);return}a=o.return;var u=WT(o.alternate,o,ns);if(u!==null){Ue=u;return}if(o=o.sibling,o!==null){Ue=o;return}Ue=o=a}while(o!==null);li===0&&(li=5)}function oR(a,o){do{var u=pA(a.alternate,a);if(u!==null){u.flags&=32767,Ue=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){Ue=a;return}Ue=a=u}while(a!==null);li=6,Ue=null}function Pd(a,o,u,f,E,R,k,B,q){a.cancelPendingCommit=null;do ef();while(Gi!==0);if((Rn&6)!==0)throw Error(b(327));if(o!==null){if(o===a.current)throw Error(b(177));if(R=o.lanes|o.childLanes,R|=p_,IC(a,u,R,k,B,q),a===Un&&(Ue=Un=null,$e=0),Hc=o,Na=a,Bo=u,Jl=R,Ql=E,mE=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,gA(Wi,function(){return uR(),null})):(a.callbackNode=null,a.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=gt.T,gt.T=null,E=Jt.p,Jt.p=2,k=Rn,Rn|=4;try{fA(a,o,u)}finally{Rn=k,Jt.p=E,gt.T=f}}Gi=1,Ws(),tu(),cR()}}function Ws(){if(Gi===1){Gi=0;var a=Na,o=Hc,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=gt.T,gt.T=null;var f=Jt.p;Jt.p=2;var E=Rn;Rn|=4;try{QT(o,a);var R=IE,k=zS(a.containerInfo),B=R.focusedElem,q=R.selectionRange;if(k!==B&&B&&B.ownerDocument&&YS(B.ownerDocument.documentElement,B)){if(q!==null&&pr(B)){var ut=q.start,Et=q.end;if(Et===void 0&&(Et=ut),"selectionStart"in B)B.selectionStart=ut,B.selectionEnd=Math.min(Et,B.value.length);else{var Dt=B.ownerDocument||document,ht=Dt&&Dt.defaultView||window;if(ht.getSelection){var pt=ht.getSelection(),ye=B.textContent.length,se=Math.min(q.start,ye),Nn=q.end===void 0?se:Math.min(q.end,ye);!pt.extend&&se>Nn&&(k=Nn,Nn=se,se=k);var rt=Ra(B,se),et=Ra(B,Nn);if(rt&&et&&(pt.rangeCount!==1||pt.anchorNode!==rt.node||pt.anchorOffset!==rt.offset||pt.focusNode!==et.node||pt.focusOffset!==et.offset)){var lt=Dt.createRange();lt.setStart(rt.node,rt.offset),pt.removeAllRanges(),se>Nn?(pt.addRange(lt),pt.extend(et.node,et.offset)):(lt.setEnd(et.node,et.offset),pt.addRange(lt))}}}}for(Dt=[],pt=B;pt=pt.parentNode;)pt.nodeType===1&&Dt.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<Dt.length;B++){var wt=Dt[B];wt.element.scrollLeft=wt.left,wt.element.scrollTop=wt.top}}Tf=!!bE,IE=bE=null}finally{Rn=E,Jt.p=f,gt.T=u}}a.current=o,Gi=2}}function tu(){if(Gi===2){Gi=0;var a=Na,o=Hc,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=gt.T,gt.T=null;var f=Jt.p;Jt.p=2;var E=Rn;Rn|=4;try{oE(a,o.alternate,o)}finally{Rn=E,Jt.p=f,gt.T=u}}Gi=3}}function cR(){if(Gi===4||Gi===3){Gi=0,CC();var a=Na,o=Hc,u=Bo,f=mE;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Gi=5:(Gi=0,Hc=Na=null,lR(a,a.pendingLanes));var E=a.pendingLanes;if(E===0&&(Gs=null),fo(u),o=o.stateNode,Mn&&typeof Mn.onCommitFiberRoot=="function")try{Mn.onCommitFiberRoot(ml,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=gt.T,E=Jt.p,Jt.p=2,gt.T=null;try{for(var R=a.onRecoverableError,k=0;k<f.length;k++){var B=f[k];R(B.value,{componentStack:B.stack})}}finally{gt.T=o,Jt.p=E}}(Bo&3)!==0&&ef(),Da(a),E=a.pendingLanes,(u&4194090)!==0&&(E&42)!==0?a===Hs?is++:(is=0,Hs=a):is=0,Ud(0)}}function lR(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,sd(o)))}function ef(a){return Ws(),tu(),cR(),uR()}function uR(){if(Gi!==5)return!1;var a=Na,o=Jl;Jl=0;var u=fo(Bo),f=gt.T,E=Jt.p;try{Jt.p=32>u?32:u,gt.T=null,u=Ql,Ql=null;var R=Na,k=Bo;if(Gi=0,Hc=Na=null,Bo=0,(Rn&6)!==0)throw Error(b(331));var B=Rn;if(Rn|=4,Xp(R.current),$T(R,R.current,k,u),Rn=B,Ud(0,!1),Mn&&typeof Mn.onPostCommitFiberRoot=="function")try{Mn.onPostCommitFiberRoot(ml,R)}catch{}return!0}finally{Jt.p=E,gt.T=f,lR(a,o)}}function nf(a,o,u){o=na(u,o),o=J_(a.stateNode,o,2),a=Ca(a,o,2),a!==null&&(Gu(a,2),Da(a))}function xn(a,o,u){if(a.tag===3)nf(a,a,u);else for(;o!==null;){if(o.tag===3){nf(o,a,u);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Gs===null||!Gs.has(f))){a=na(u,a),u=UT(2),f=Ca(o,u,2),f!==null&&(xT(u,f,o,a),Gu(f,2),Da(f));break}}o=o.return}}function SE(a,o,u){var f=a.pingCache;if(f===null){f=a.pingCache=new hE;var E=new Set;f.set(o,E)}else E=f.get(o),E===void 0&&(E=new Set,f.set(o,E));E.has(u)||(Jp=!0,E.add(u),a=_A.bind(null,a,o,u),o.then(a,a))}function _A(a,o,u){var f=a.pingCache;f!==null&&f.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Un===a&&($e&u)===u&&(li===4||li===3&&($e&62914560)===$e&&300>Ya()-fE?(Rn&2)===0&&$l(a,0):Qp|=u,Vo===$e&&(Vo=0)),Da(a)}function TE(a,o){o===0&&(o=km()),a=go(a,o),a!==null&&(Gu(a,o),Da(a))}function RE(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),TE(a,u)}function EA(a,o){var u=0;switch(a.tag){case 13:var f=a.stateNode,E=a.memoizedState;E!==null&&(u=E.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(b(314))}f!==null&&f.delete(o),TE(a,u)}function gA(a,o){return wm(a,o)}var rf=null,Wc=null,kd=!1,Md=!1,af=!1,as=0;function Da(a){a!==Wc&&a.next===null&&(Wc===null?rf=Wc=a:Wc=Wc.next=a),Md=!0,kd||(kd=!0,pR())}function Ud(a,o){if(!af&&Md){af=!0;do for(var u=!1,f=rf;f!==null;){if(a!==0){var E=f.pendingLanes;if(E===0)var R=0;else{var k=f.suspendedLanes,B=f.pingedLanes;R=(1<<31-yr(42|a)+1)-1,R&=E&~(k&~B),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(u=!0,sf(f,R))}else R=$e,R=Fu(f,f===Un?R:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(R&3)===0||ju(f,R)||(u=!0,sf(f,R));f=f.next}while(u);af=!1}}function vE(){dR()}function dR(){Md=kd=!1;var a=0;as!==0&&(vA()&&(a=as),as=0);for(var o=Ya(),u=null,f=rf;f!==null;){var E=f.next,R=hR(f,o);R===0?(f.next=null,u===null?rf=E:u.next=E,E===null&&(Wc=u)):(u=f,(a!==0||(R&3)!==0)&&(Md=!0)),f=E}Ud(a)}function hR(a,o){for(var u=a.suspendedLanes,f=a.pingedLanes,E=a.expirationTimes,R=a.pendingLanes&-62914561;0<R;){var k=31-yr(R),B=1<<k,q=E[k];q===-1?((B&u)===0||(B&f)!==0)&&(E[k]=bC(B,o)):q<=o&&(a.expiredLanes|=B),R&=~B}if(o=Un,u=$e,u=Fu(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f=a.callbackNode,u===0||a===o&&(an===2||an===9)||a.cancelPendingCommit!==null)return f!==null&&f!==null&&Nm(f),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||ju(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(f!==null&&Nm(f),fo(u)){case 2:case 8:u=pS;break;case 32:u=Wi;break;case 268435456:u=Mh;break;default:u=Wi}return f=eu.bind(null,a),u=wm(u,f),a.callbackPriority=o,a.callbackNode=u,o}return f!==null&&f!==null&&Nm(f),a.callbackPriority=2,a.callbackNode=null,2}function eu(a,o){if(Gi!==0&&Gi!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(ef()&&a.callbackNode!==u)return null;var f=$e;return f=Fu(a,a===Un?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f===0?null:(Zl(a,f,o),hR(a,Ya()),a.callbackNode!=null&&a.callbackNode===u?eu.bind(null,a):null)}function sf(a,o){if(ef())return null;Zl(a,o,!0)}function pR(){CA(function(){(Rn&6)!==0?wm(Dm,vE):dR()})}function xd(){return as===0&&(as=gc()),as}function of(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Hh(""+a)}function cf(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function SA(a,o,u,f,E){if(o==="submit"&&u&&u.stateNode===E){var R=of((E[Cr]||null).action),k=f.submitter;k&&(o=(o=k[Cr]||null)?of(o.formAction):k.getAttribute("formAction"),o!==null&&(R=o,k=null));var B=new dr("action","action",null,f,E);a.push({event:B,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(as!==0){var q=k?cf(E,k):new FormData(E);W_(u,{pending:!0,data:q,method:E.method,action:R},null,q)}}else typeof R=="function"&&(B.preventDefault(),q=k?cf(E,k):new FormData(E),W_(u,{pending:!0,data:q,method:E.method,action:R},R,q))},currentTarget:E}]})}}for(var yE=0;yE<h_.length;yE++){var lf=h_[yE],fR=lf.toLowerCase(),mR=lf[0].toUpperCase()+lf.slice(1);va(fR,"on"+mR)}va($h,"onAnimationEnd"),va(tp,"onAnimationIteration"),va(JS,"onAnimationStart"),va("dblclick","onDoubleClick"),va("focusin","onFocus"),va("focusout","onBlur"),va(_t,"onTransitionRun"),va($C,"onTransitionStart"),va(tA,"onTransitionCancel"),va(QS,"onTransitionEnd"),Tl("onMouseEnter",["mouseout","mouseover"]),Tl("onMouseLeave",["mouseout","mouseover"]),Tl("onPointerEnter",["pointerout","pointerover"]),Tl("onPointerLeave",["pointerout","pointerover"]),vc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vc("onBeforeInput",["compositionend","keypress","textInput","paste"]),vc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_R=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(nu));function ER(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var f=a[u],E=f.event;f=f.listeners;t:{var R=void 0;if(o)for(var k=f.length-1;0<=k;k--){var B=f[k],q=B.instance,ut=B.currentTarget;if(B=B.listener,q!==R&&E.isPropagationStopped())break t;R=B,E.currentTarget=ut;try{R(E)}catch(Et){kp(Et)}E.currentTarget=null,R=q}else for(k=0;k<f.length;k++){if(B=f[k],q=B.instance,ut=B.currentTarget,B=B.listener,q!==R&&E.isPropagationStopped())break t;R=B,E.currentTarget=ut;try{R(E)}catch(Et){kp(Et)}E.currentTarget=null,R=q}}}}function He(a,o){var u=o[gl];u===void 0&&(u=o[gl]=new Set);var f=a+"__bubble";u.has(f)||(uf(o,a,2,!1),u.add(f))}function CE(a,o,u){var f=0;o&&(f|=4),uf(u,a,f,o)}var Ks="_reactListening"+Math.random().toString(36).slice(2);function Go(a){if(!a[Ks]){a[Ks]=!0,Vm.forEach(function(u){u!=="selectionchange"&&(_R.has(u)||CE(u,!1,a),CE(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Ks]||(o[Ks]=!0,CE("selectionchange",!1,o))}}function uf(a,o,u,f){switch(GR(o)){case 2:var E=VA;break;case 8:E=Lr;break;default:E=BE}u=E.bind(null,o,u,a),E=void 0,!Xm||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(E=!0),f?E!==void 0?a.addEventListener(o,u,{capture:!0,passive:E}):a.addEventListener(o,u,!0):E!==void 0?a.addEventListener(o,u,{passive:E}):a.addEventListener(o,u,!1)}function df(a,o,u,f,E){var R=f;if((o&1)===0&&(o&2)===0&&f!==null)t:for(;;){if(f===null)return;var k=f.tag;if(k===3||k===4){var B=f.stateNode.containerInfo;if(B===E)break;if(k===4)for(k=f.return;k!==null;){var q=k.tag;if((q===3||q===4)&&k.stateNode.containerInfo===E)return;k=k.return}for(;B!==null;){if(k=Sc(B),k===null)return;if(q=k.tag,q===5||q===6||q===26||q===27){f=R=k;continue t}B=B.parentNode}}f=f.return}qm(function(){var ut=R,Et=Ym(u),Dt=[];t:{var ht=ZS.get(a);if(ht!==void 0){var pt=dr,ye=a;switch(a){case"keypress":if(qu(u)===0)break t;case"keydown":case"keyup":pt=VC;break;case"focusin":ye="focus",pt=$m;break;case"focusout":ye="blur",pt=$m;break;case"beforeblur":case"afterblur":pt=$m;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=LS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=zh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=bl;break;case $h:case tp:case JS:pt=kC;break;case QS:pt=jC;break;case"scroll":case"scrollend":pt=LC;break;case"wheel":pt=GC;break;case"copy":case"cut":case"paste":pt=n_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=Cc;break;case"toggle":case"beforetoggle":pt=WC}var se=(o&4)!==0,Nn=!se&&(a==="scroll"||a==="scrollend"),rt=se?ht!==null?ht+"Capture":null:ht;se=[];for(var et=ut,lt;et!==null;){var wt=et;if(lt=wt.stateNode,wt=wt.tag,wt!==5&&wt!==26&&wt!==27||lt===null||rt===null||(wt=zu(et,rt),wt!=null&&se.push(iu(et,wt,lt))),Nn)break;et=et.return}0<se.length&&(ht=new pt(ht,ye,null,u,Et),Dt.push({event:ht,listeners:se}))}}if((o&7)===0){t:{if(ht=a==="mouseover"||a==="pointerover",pt=a==="mouseout"||a==="pointerout",ht&&u!==Km&&(ye=u.relatedTarget||u.fromElement)&&(Sc(ye)||ye[El]))break t;if((pt||ht)&&(ht=Et.window===Et?Et:(ht=Et.ownerDocument)?ht.defaultView||ht.parentWindow:window,pt?(ye=u.relatedTarget||u.toElement,pt=ut,ye=ye?Sc(ye):null,ye!==null&&(Nn=x(ye),se=ye.tag,ye!==Nn||se!==5&&se!==27&&se!==6)&&(ye=null)):(pt=null,ye=ut),pt!==ye)){if(se=LS,wt="onMouseLeave",rt="onMouseEnter",et="mouse",(a==="pointerout"||a==="pointerover")&&(se=Cc,wt="onPointerLeave",rt="onPointerEnter",et="pointer"),Nn=pt==null?ht:Wu(pt),lt=ye==null?ht:Wu(ye),ht=new se(wt,et+"leave",pt,u,Et),ht.target=Nn,ht.relatedTarget=lt,wt=null,Sc(Et)===ut&&(se=new se(rt,et+"enter",ye,u,Et),se.target=lt,se.relatedTarget=Nn,wt=se),Nn=wt,pt&&ye)e:{for(se=pt,rt=ye,et=0,lt=se;lt;lt=Kc(lt))et++;for(lt=0,wt=rt;wt;wt=Kc(wt))lt++;for(;0<et-lt;)se=Kc(se),et--;for(;0<lt-et;)rt=Kc(rt),lt--;for(;et--;){if(se===rt||rt!==null&&se===rt.alternate)break e;se=Kc(se),rt=Kc(rt)}se=null}else se=null;pt!==null&&gR(Dt,ht,pt,se,!1),ye!==null&&Nn!==null&&gR(Dt,Nn,ye,se,!0)}}t:{if(ht=ut?Wu(ut):window,pt=ht.nodeName&&ht.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ht.type==="file")var Kt=FS;else if(BS(ht))if(jS)Kt=QC;else{Kt=u_;var We=WS}else pt=ht.nodeName,!pt||pt.toLowerCase()!=="input"||ht.type!=="checkbox"&&ht.type!=="radio"?ut&&Wm(ut.elementType)&&(Kt=FS):Kt=JC;if(Kt&&(Kt=Kt(a,ut))){s_(Dt,Kt,u,Et);break t}We&&We(a,ht,ut),a==="focusout"&&ut&&ht.type==="number"&&ut.memoizedProps.value!=null&&Gm(ht,"number",ht.value)}switch(We=ut?Wu(ut):window,a){case"focusin":(BS(We)||We.contentEditable==="true")&&(Ol=We,d_=ut,$u=null);break;case"focusout":$u=d_=Ol=null;break;case"mousedown":Qh=!0;break;case"contextmenu":case"mouseup":case"dragend":Qh=!1,qS(Dt,u,Et);break;case"selectionchange":if(ZC)break;case"keydown":case"keyup":qS(Dt,u,Et)}var re;if(Xu)t:{switch(a){case"compositionstart":var pe="onCompositionStart";break t;case"compositionend":pe="onCompositionEnd";break t;case"compositionupdate":pe="onCompositionUpdate";break t}pe=void 0}else Il?VS(a,u)&&(pe="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(pe="onCompositionStart");pe&&(US&&u.locale!=="ko"&&(Il||pe!=="onCompositionStart"?pe==="onCompositionEnd"&&Il&&(re=NS()):(_o=Et,Jm="value"in _o?_o.value:_o.textContent,Il=!0)),We=hf(ut,pe),0<We.length&&(pe=new kS(pe,a,null,u,Et),Dt.push({event:pe,listeners:We}),re?pe.data=re:(re=a_(u),re!==null&&(pe.data=re)))),(re=YC?Is(a,u):zC(a,u))&&(pe=hf(ut,"onBeforeInput"),0<pe.length&&(We=new kS("onBeforeInput","beforeinput",null,u,Et),Dt.push({event:We,listeners:pe}),We.data=re)),SA(Dt,a,ut,u,Et)}ER(Dt,o)})}function iu(a,o,u){return{instance:a,listener:o,currentTarget:u}}function hf(a,o){for(var u=o+"Capture",f=[];a!==null;){var E=a,R=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||R===null||(E=zu(a,u),E!=null&&f.unshift(iu(a,E,R)),E=zu(a,o),E!=null&&f.push(iu(a,E,R))),a.tag===3)return f;a=a.return}return[]}function Kc(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function gR(a,o,u,f,E){for(var R=o._reactName,k=[];u!==null&&u!==f;){var B=u,q=B.alternate,ut=B.stateNode;if(B=B.tag,q!==null&&q===f)break;B!==5&&B!==26&&B!==27||ut===null||(q=ut,E?(ut=zu(u,R),ut!=null&&k.unshift(iu(u,ut,q))):E||(ut=zu(u,R),ut!=null&&k.push(iu(u,ut,q)))),u=u.return}k.length!==0&&a.push({event:o,listeners:k})}var TA=/\r\n?/g,pf=/\u0000|\uFFFD/g;function SR(a){return(typeof a=="string"?a:""+a).replace(TA,`
`).replace(pf,"")}function TR(a,o){return o=SR(o),SR(a)===o}function ff(){}function wn(a,o,u,f,E,R){switch(u){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||yc(a,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&yc(a,""+f);break;case"className":Vh(a,"class",f);break;case"tabIndex":Vh(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Vh(a,u,f);break;case"style":Gh(a,f,R);break;case"data":if(o!=="object"){Vh(a,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=Hh(""+f),a.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(u==="formAction"?(o!=="input"&&wn(a,o,"name",E.name,E,null),wn(a,o,"formEncType",E.formEncType,E,null),wn(a,o,"formMethod",E.formMethod,E,null),wn(a,o,"formTarget",E.formTarget,E,null)):(wn(a,o,"encType",E.encType,E,null),wn(a,o,"method",E.method,E,null),wn(a,o,"target",E.target,E,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=Hh(""+f),a.setAttribute(u,f);break;case"onClick":f!=null&&(a.onclick=ff);break;case"onScroll":f!=null&&He("scroll",a);break;case"onScrollEnd":f!=null&&He("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(b(61));if(u=f.__html,u!=null){if(E.children!=null)throw Error(b(60));a.innerHTML=u}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}u=Hh(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""+f):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":f===!0?a.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,f):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(u,f):a.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(u):a.setAttribute(u,f);break;case"popover":He("beforetoggle",a),He("toggle",a),xh(a,"popover",f);break;case"xlinkActuate":Cs(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Cs(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Cs(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Cs(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Cs(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Cs(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":xh(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=OS.get(u)||u,xh(a,u,f))}}function AE(a,o,u,f,E,R){switch(u){case"style":Gh(a,f,R);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(b(61));if(u=f.__html,u!=null){if(E.children!=null)throw Error(b(60));a.innerHTML=u}}break;case"children":typeof f=="string"?yc(a,f):(typeof f=="number"||typeof f=="bigint")&&yc(a,""+f);break;case"onScroll":f!=null&&He("scroll",a);break;case"onScrollEnd":f!=null&&He("scrollend",a);break;case"onClick":f!=null&&(a.onclick=ff);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Rc.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(E=u.endsWith("Capture"),o=u.slice(2,E?u.length-7:void 0),R=a[Cr]||null,R=R!=null?R[u]:null,typeof R=="function"&&a.removeEventListener(o,R,E),typeof f=="function")){typeof R!="function"&&R!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,f,E);break t}u in a?a[u]=f:f===!0?a.setAttribute(u,""):xh(a,u,f)}}}function Xi(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":He("error",a),He("load",a);var f=!1,E=!1,R;for(R in u)if(u.hasOwnProperty(R)){var k=u[R];if(k!=null)switch(R){case"src":f=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(b(137,o));default:wn(a,o,R,k,u,null)}}E&&wn(a,o,"srcSet",u.srcSet,u,null),f&&wn(a,o,"src",u.src,u,null);return;case"input":He("invalid",a);var B=R=k=E=null,q=null,ut=null;for(f in u)if(u.hasOwnProperty(f)){var Et=u[f];if(Et!=null)switch(f){case"name":E=Et;break;case"type":k=Et;break;case"checked":q=Et;break;case"defaultChecked":ut=Et;break;case"value":R=Et;break;case"defaultValue":B=Et;break;case"children":case"dangerouslySetInnerHTML":if(Et!=null)throw Error(b(137,o));break;default:wn(a,o,f,Et,u,null)}}AS(a,R,B,q,ut,k,E,!1),dn(a);return;case"select":He("invalid",a),f=k=R=null;for(E in u)if(u.hasOwnProperty(E)&&(B=u[E],B!=null))switch(E){case"value":R=B;break;case"defaultValue":k=B;break;case"multiple":f=B;default:wn(a,o,E,B,u,null)}o=R,u=k,a.multiple=!!f,o!=null?vl(a,!!f,o,!1):u!=null&&vl(a,!!f,u,!0);return;case"textarea":He("invalid",a),R=E=f=null;for(k in u)if(u.hasOwnProperty(k)&&(B=u[k],B!=null))switch(k){case"value":f=B;break;case"defaultValue":E=B;break;case"children":R=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(b(91));break;default:wn(a,o,k,B,u,null)}Yu(a,f,E,R),dn(a);return;case"option":for(q in u)if(u.hasOwnProperty(q)&&(f=u[q],f!=null))switch(q){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:wn(a,o,q,f,u,null)}return;case"dialog":He("beforetoggle",a),He("toggle",a),He("cancel",a),He("close",a);break;case"iframe":case"object":He("load",a);break;case"video":case"audio":for(f=0;f<nu.length;f++)He(nu[f],a);break;case"image":He("error",a),He("load",a);break;case"details":He("toggle",a);break;case"embed":case"source":case"link":He("error",a),He("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ut in u)if(u.hasOwnProperty(ut)&&(f=u[ut],f!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":throw Error(b(137,o));default:wn(a,o,ut,f,u,null)}return;default:if(Wm(o)){for(Et in u)u.hasOwnProperty(Et)&&(f=u[Et],f!==void 0&&AE(a,o,Et,f,u,void 0));return}}for(B in u)u.hasOwnProperty(B)&&(f=u[B],f!=null&&wn(a,o,B,f,u,null))}function RA(a,o,u,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,R=null,k=null,B=null,q=null,ut=null,Et=null;for(pt in u){var Dt=u[pt];if(u.hasOwnProperty(pt)&&Dt!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":q=Dt;default:f.hasOwnProperty(pt)||wn(a,o,pt,null,f,Dt)}}for(var ht in f){var pt=f[ht];if(Dt=u[ht],f.hasOwnProperty(ht)&&(pt!=null||Dt!=null))switch(ht){case"type":R=pt;break;case"name":E=pt;break;case"checked":ut=pt;break;case"defaultChecked":Et=pt;break;case"value":k=pt;break;case"defaultValue":B=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(b(137,o));break;default:pt!==Dt&&wn(a,o,ht,pt,f,Dt)}}jm(a,k,B,q,ut,Et,R,E);return;case"select":pt=k=B=ht=null;for(R in u)if(q=u[R],u.hasOwnProperty(R)&&q!=null)switch(R){case"value":break;case"multiple":pt=q;default:f.hasOwnProperty(R)||wn(a,o,R,null,f,q)}for(E in f)if(R=f[E],q=u[E],f.hasOwnProperty(E)&&(R!=null||q!=null))switch(E){case"value":ht=R;break;case"defaultValue":B=R;break;case"multiple":k=R;default:R!==q&&wn(a,o,E,R,f,q)}o=B,u=k,f=pt,ht!=null?vl(a,!!u,ht,!1):!!f!=!!u&&(o!=null?vl(a,!!u,o,!0):vl(a,!!u,u?[]:"",!1));return;case"textarea":pt=ht=null;for(B in u)if(E=u[B],u.hasOwnProperty(B)&&E!=null&&!f.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:wn(a,o,B,null,f,E)}for(k in f)if(E=f[k],R=u[k],f.hasOwnProperty(k)&&(E!=null||R!=null))switch(k){case"value":ht=E;break;case"defaultValue":pt=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(b(91));break;default:E!==R&&wn(a,o,k,E,f,R)}bS(a,ht,pt);return;case"option":for(var ye in u)if(ht=u[ye],u.hasOwnProperty(ye)&&ht!=null&&!f.hasOwnProperty(ye))switch(ye){case"selected":a.selected=!1;break;default:wn(a,o,ye,null,f,ht)}for(q in f)if(ht=f[q],pt=u[q],f.hasOwnProperty(q)&&ht!==pt&&(ht!=null||pt!=null))switch(q){case"selected":a.selected=ht&&typeof ht!="function"&&typeof ht!="symbol";break;default:wn(a,o,q,ht,f,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var se in u)ht=u[se],u.hasOwnProperty(se)&&ht!=null&&!f.hasOwnProperty(se)&&wn(a,o,se,null,f,ht);for(ut in f)if(ht=f[ut],pt=u[ut],f.hasOwnProperty(ut)&&ht!==pt&&(ht!=null||pt!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(b(137,o));break;default:wn(a,o,ut,ht,f,pt)}return;default:if(Wm(o)){for(var Nn in u)ht=u[Nn],u.hasOwnProperty(Nn)&&ht!==void 0&&!f.hasOwnProperty(Nn)&&AE(a,o,Nn,void 0,f,ht);for(Et in f)ht=f[Et],pt=u[Et],!f.hasOwnProperty(Et)||ht===pt||ht===void 0&&pt===void 0||AE(a,o,Et,ht,f,pt);return}}for(var rt in u)ht=u[rt],u.hasOwnProperty(rt)&&ht!=null&&!f.hasOwnProperty(rt)&&wn(a,o,rt,null,f,ht);for(Dt in f)ht=f[Dt],pt=u[Dt],!f.hasOwnProperty(Dt)||ht===pt||ht==null&&pt==null||wn(a,o,Dt,ht,f,pt)}var bE=null,IE=null;function mf(a){return a.nodeType===9?a:a.ownerDocument}function RR(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function vR(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function OE(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var wE=null;function vA(){var a=window.event;return a&&a.type==="popstate"?a===wE?!1:(wE=a,!0):(wE=null,!1)}var yR=typeof setTimeout=="function"?setTimeout:void 0,yA=typeof clearTimeout=="function"?clearTimeout:void 0,NE=typeof Promise=="function"?Promise:void 0,CA=typeof queueMicrotask=="function"?queueMicrotask:typeof NE<"u"?function(a){return NE.resolve(null).then(a).catch(AA)}:yR;function AA(a){setTimeout(function(){throw a})}function Ho(a){return a==="head"}function CR(a,o){var u=o,f=0,E=0;do{var R=u.nextSibling;if(a.removeChild(u),R&&R.nodeType===8)if(u=R.data,u==="/$"){if(0<f&&8>f){u=f;var k=a.ownerDocument;if(u&1&&Vd(k.documentElement),u&2&&Vd(k.body),u&4)for(u=k.head,Vd(u),k=u.firstChild;k;){var B=k.nextSibling,q=k.nodeName;k[Hu]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&k.rel.toLowerCase()==="stylesheet"||u.removeChild(k),k=B}}if(E===0){a.removeChild(R),Pr(o);return}E--}else u==="$"||u==="$?"||u==="$!"?E++:f=u.charCodeAt(0)-48;else f=0;u=R}while(u);Pr(o)}function DE(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":DE(u),Uh(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function bA(a,o,u,f){for(;a.nodeType===1;){var E=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[Hu])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(R=a.getAttribute("rel"),R==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(R!==E.rel||a.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||a.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||a.getAttribute("title")!==(E.title==null?null:E.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(R=a.getAttribute("src"),(R!==(E.src==null?null:E.src)||a.getAttribute("type")!==(E.type==null?null:E.type)||a.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&R&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var R=E.name==null?null:""+E.name;if(E.type==="hidden"&&a.getAttribute("name")===R)return a}else return a;if(a=La(a.nextSibling),a===null)break}return null}function IA(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=La(a.nextSibling),a===null))return null;return a}function LE(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function OA(a,o){var u=a.ownerDocument;if(a.data!=="$?"||u.readyState==="complete")o();else{var f=function(){o(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),a._reactRetry=f}}function La(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}var PE=null;function AR(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return a;o--}else u==="/$"&&o++}a=a.previousSibling}return null}function bR(a,o,u){switch(o=mf(u),a){case"html":if(a=o.documentElement,!a)throw Error(b(452));return a;case"head":if(a=o.head,!a)throw Error(b(453));return a;case"body":if(a=o.body,!a)throw Error(b(454));return a;default:throw Error(b(451))}}function Vd(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Uh(a)}var aa=new Map,IR=new Set;function _f(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var ss=Jt.d;Jt.d={f:wA,r:kE,D:NA,C:DA,L:wR,m:LA,X:PA,S:ME,M:kA};function wA(){var a=ss.f(),o=Zp();return a||o}function kE(a){var o=Sl(a);o!==null&&o.tag===5&&o.type==="form"?Op(o):ss.r(a)}var ru=typeof document>"u"?null:document;function OR(a,o,u){var f=ru;if(f&&typeof o=="string"&&o){var E=ea(o);E='link[rel="'+a+'"][href="'+E+'"]',typeof u=="string"&&(E+='[crossorigin="'+u+'"]'),IR.has(E)||(IR.add(E),a={rel:a,crossOrigin:u,href:o},f.querySelector(E)===null&&(o=f.createElement("link"),Xi(o,"link",a),vi(o),f.head.appendChild(o)))}}function NA(a){ss.D(a),OR("dns-prefetch",a,null)}function DA(a,o){ss.C(a,o),OR("preconnect",a,o)}function wR(a,o,u){ss.L(a,o,u);var f=ru;if(f&&a&&o){var E='link[rel="preload"][as="'+ea(o)+'"]';o==="image"&&u&&u.imageSrcSet?(E+='[imagesrcset="'+ea(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(E+='[imagesizes="'+ea(u.imageSizes)+'"]')):E+='[href="'+ea(a)+'"]';var R=E;switch(o){case"style":R=au(a);break;case"script":R=Wo(a)}aa.has(R)||(a=Z({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),aa.set(R,a),f.querySelector(E)!==null||o==="style"&&f.querySelector(su(R))||o==="script"&&f.querySelector(Bd(R))||(o=f.createElement("link"),Xi(o,"link",a),vi(o),f.head.appendChild(o)))}}function LA(a,o){ss.m(a,o);var u=ru;if(u&&a){var f=o&&typeof o.as=="string"?o.as:"script",E='link[rel="modulepreload"][as="'+ea(f)+'"][href="'+ea(a)+'"]',R=E;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=Wo(a)}if(!aa.has(R)&&(a=Z({rel:"modulepreload",href:a},o),aa.set(R,a),u.querySelector(E)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Bd(R)))return}f=u.createElement("link"),Xi(f,"link",a),vi(f),u.head.appendChild(f)}}}function ME(a,o,u){ss.S(a,o,u);var f=ru;if(f&&a){var E=Tc(f).hoistableStyles,R=au(a);o=o||"default";var k=E.get(R);if(!k){var B={loading:0,preload:null};if(k=f.querySelector(su(R)))B.loading=5;else{a=Z({rel:"stylesheet",href:a,"data-precedence":o},u),(u=aa.get(R))&&UE(a,u);var q=k=f.createElement("link");vi(q),Xi(q,"link",a),q._p=new Promise(function(ut,Et){q.onload=ut,q.onerror=Et}),q.addEventListener("load",function(){B.loading|=1}),q.addEventListener("error",function(){B.loading|=2}),B.loading|=4,Fd(k,o,f)}k={type:"stylesheet",instance:k,count:1,state:B},E.set(R,k)}}}function PA(a,o){ss.X(a,o);var u=ru;if(u&&a){var f=Tc(u).hoistableScripts,E=Wo(a),R=f.get(E);R||(R=u.querySelector(Bd(E)),R||(a=Z({src:a,async:!0},o),(o=aa.get(E))&&Ef(a,o),R=u.createElement("script"),vi(R),Xi(R,"link",a),u.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},f.set(E,R))}}function kA(a,o){ss.M(a,o);var u=ru;if(u&&a){var f=Tc(u).hoistableScripts,E=Wo(a),R=f.get(E);R||(R=u.querySelector(Bd(E)),R||(a=Z({src:a,async:!0,type:"module"},o),(o=aa.get(E))&&Ef(a,o),R=u.createElement("script"),vi(R),Xi(R,"link",a),u.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},f.set(E,R))}}function NR(a,o,u,f){var E=(E=fe.current)?_f(E):null;if(!E)throw Error(b(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=au(u.href),u=Tc(E).hoistableStyles,f=u.get(o),f||(f={type:"style",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=au(u.href);var R=Tc(E).hoistableStyles,k=R.get(a);if(k||(E=E.ownerDocument||E,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(a,k),(R=E.querySelector(su(a)))&&!R._p&&(k.instance=R,k.state.loading=5),aa.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},aa.set(a,u),R||LR(E,a,u,k.state))),o&&f===null)throw Error(b(528,""));return k}if(o&&f!==null)throw Error(b(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Wo(u),u=Tc(E).hoistableScripts,f=u.get(o),f||(f={type:"script",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(b(444,a))}}function au(a){return'href="'+ea(a)+'"'}function su(a){return'link[rel="stylesheet"]['+a+"]"}function DR(a){return Z({},a,{"data-precedence":a.precedence,precedence:null})}function LR(a,o,u,f){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=a.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Xi(o,"link",u),vi(o),a.head.appendChild(o))}function Wo(a){return'[src="'+ea(a)+'"]'}function Bd(a){return"script[async]"+a}function PR(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var f=a.querySelector('style[data-href~="'+ea(u.href)+'"]');if(f)return o.instance=f,vi(f),f;var E=Z({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),vi(f),Xi(f,"style",E),Fd(f,u.precedence,a),o.instance=f;case"stylesheet":E=au(u.href);var R=a.querySelector(su(E));if(R)return o.state.loading|=4,o.instance=R,vi(R),R;f=DR(u),(E=aa.get(E))&&UE(f,E),R=(a.ownerDocument||a).createElement("link"),vi(R);var k=R;return k._p=new Promise(function(B,q){k.onload=B,k.onerror=q}),Xi(R,"link",f),o.state.loading|=4,Fd(R,u.precedence,a),o.instance=R;case"script":return R=Wo(u.src),(E=a.querySelector(Bd(R)))?(o.instance=E,vi(E),E):(f=u,(E=aa.get(R))&&(f=Z({},u),Ef(f,E)),a=a.ownerDocument||a,E=a.createElement("script"),vi(E),Xi(E,"link",f),a.head.appendChild(E),o.instance=E);case"void":return null;default:throw Error(b(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,Fd(f,u.precedence,a));return o.instance}function Fd(a,o,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=f.length?f[f.length-1]:null,R=E,k=0;k<f.length;k++){var B=f[k];if(B.dataset.precedence===o)R=B;else if(R!==E)break}R?R.parentNode.insertBefore(a,R.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function UE(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Ef(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var jd=null;function kR(a,o,u){if(jd===null){var f=new Map,E=jd=new Map;E.set(u,f)}else E=jd,f=E.get(u),f||(f=new Map,E.set(u,f));if(f.has(a))return f;for(f.set(a,null),u=u.getElementsByTagName(a),E=0;E<u.length;E++){var R=u[E];if(!(R[Hu]||R[On]||a==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var k=R.getAttribute(o)||"";k=a+k;var B=f.get(k);B?B.push(R):f.set(k,[R])}}return f}function MR(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function MA(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function UR(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Gd=null;function UA(){}function xA(a,o,u){if(Gd===null)throw Error(b(475));var f=Gd;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var E=au(u.href),R=a.querySelector(su(E));if(R){a=R._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(f.count++,f=Hd.bind(f),a.then(f,f)),o.state.loading|=4,o.instance=R,vi(R);return}R=a.ownerDocument||a,u=DR(u),(E=aa.get(E))&&UE(u,E),R=R.createElement("link"),vi(R);var k=R;k._p=new Promise(function(B,q){k.onload=B,k.onerror=q}),Xi(R,"link",u),o.instance=R}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Hd.bind(f),a.addEventListener("load",o),a.addEventListener("error",o))}}function xR(){if(Gd===null)throw Error(b(475));var a=Gd;return a.stylesheets&&a.count===0&&gf(a,a.stylesheets),0<a.count?function(o){var u=setTimeout(function(){if(a.stylesheets&&gf(a,a.stylesheets),a.unsuspend){var f=a.unsuspend;a.unsuspend=null,f()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(u)}}:null}function Hd(){if(this.count--,this.count===0){if(this.stylesheets)gf(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var ou=null;function gf(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,ou=new Map,o.forEach(xE,a),ou=null,Hd.call(a))}function xE(a,o){if(!(o.state.loading&4)){var u=ou.get(a);if(u)var f=u.get(null);else{u=new Map,ou.set(a,u);for(var E=a.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<E.length;R++){var k=E[R];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(u.set(k.dataset.precedence,k),f=k)}f&&u.set(null,f)}E=o.instance,k=E.getAttribute("data-precedence"),R=u.get(k)||f,R===f&&u.set(null,E),u.set(k,E),this.count++,f=Hd.bind(this),E.addEventListener("load",f),E.addEventListener("error",f),R?R.parentNode.insertBefore(E,R.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(E,a.firstChild)),o.state.loading|=4}}var cu={$$typeof:Bt,Provider:null,Consumer:null,_currentValue:he,_currentValue2:he,_threadCount:0};function Tt(a,o,u,f,E,R,k,B){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Mm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mm(0),this.hiddenUpdates=Mm(null),this.identifierPrefix=f,this.onUncaughtError=E,this.onCaughtError=R,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function VR(a,o,u,f,E,R,k,B,q,ut,Et,Dt){return a=new Tt(a,o,u,k,B,q,ut,Dt),o=1,R===!0&&(o|=24),R=Yi(3,null,null,o),a.current=R,R.stateNode=a,o=cp(),o.refCount++,a.pooledCache=o,o.refCount++,R.memoizedState={element:f,isDehydrated:u,cache:o},ud(R),a}function BR(a){return a?(a=nr,a):nr}function FR(a,o,u,f,E,R){E=BR(E),f.context===null?f.context=E:f.pendingContext=E,f=Ms(o),f.payload={element:u},R=R===void 0?null:R,R!==null&&(f.callback=R),u=Ca(a,f,o),u!==null&&(Jr(u,a,o),Us(u,a,o))}function jR(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function VE(a,o){jR(a,o),(a=a.alternate)&&jR(a,o)}function Sf(a){if(a.tag===13){var o=go(a,67108864);o!==null&&Jr(o,a,67108864),VE(a,67108864)}}var Tf=!0;function VA(a,o,u,f){var E=gt.T;gt.T=null;var R=Jt.p;try{Jt.p=2,BE(a,o,u,f)}finally{Jt.p=R,gt.T=E}}function Lr(a,o,u,f){var E=gt.T;gt.T=null;var R=Jt.p;try{Jt.p=8,BE(a,o,u,f)}finally{Jt.p=R,gt.T=E}}function BE(a,o,u,f){if(Tf){var E=FE(f);if(E===null)df(a,o,f,lu,u),Rf(a,f);else if(FA(E,a,o,u,f))f.stopPropagation();else if(Rf(a,f),o&4&&-1<BA.indexOf(a)){for(;E!==null;){var R=Sl(E);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var k=Kr(R.pendingLanes);if(k!==0){var B=R;for(B.pendingLanes|=2,B.entangledLanes|=2;k;){var q=1<<31-yr(k);B.entanglements[1]|=q,k&=~q}Da(R),(Rn&6)===0&&(Xl=Ya()+500,Ud(0))}}break;case 13:B=go(R,2),B!==null&&Jr(B,R,2),Zp(),VE(R,2)}if(R=FE(f),R===null&&df(a,o,f,lu,u),R===E)break;E=R}E!==null&&f.stopPropagation()}else df(a,o,f,null,u)}}function FE(a){return a=Ym(a),jE(a)}var lu=null;function jE(a){if(lu=null,a=Sc(a),a!==null){var o=x(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=H(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return lu=a,null}function GR(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(po()){case Dm:return 2;case pS:return 8;case Wi:case Wr:return 32;case Mh:return 268435456;default:return 32}default:return 32}}var GE=!1,Ko=null,Pa=null,Ys=null,Wd=new Map,Kd=new Map,Yo=[],BA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rf(a,o){switch(a){case"focusin":case"focusout":Ko=null;break;case"dragenter":case"dragleave":Pa=null;break;case"mouseover":case"mouseout":Ys=null;break;case"pointerover":case"pointerout":Wd.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kd.delete(o.pointerId)}}function uu(a,o,u,f,E,R){return a===null||a.nativeEvent!==R?(a={blockedOn:o,domEventName:u,eventSystemFlags:f,nativeEvent:R,targetContainers:[E]},o!==null&&(o=Sl(o),o!==null&&Sf(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,E!==null&&o.indexOf(E)===-1&&o.push(E),a)}function FA(a,o,u,f,E){switch(o){case"focusin":return Ko=uu(Ko,a,o,u,f,E),!0;case"dragenter":return Pa=uu(Pa,a,o,u,f,E),!0;case"mouseover":return Ys=uu(Ys,a,o,u,f,E),!0;case"pointerover":var R=E.pointerId;return Wd.set(R,uu(Wd.get(R)||null,a,o,u,f,E)),!0;case"gotpointercapture":return R=E.pointerId,Kd.set(R,uu(Kd.get(R)||null,a,o,u,f,E)),!0}return!1}function vf(a){var o=Sc(a.target);if(o!==null){var u=x(o);if(u!==null){if(o=u.tag,o===13){if(o=H(u),o!==null){a.blockedOn=o,OC(a.priority,function(){if(u.tag===13){var f=Dr();f=Um(f);var E=go(u,f);E!==null&&Jr(E,u,f),VE(u,f)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function yf(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=FE(a.nativeEvent);if(u===null){u=a.nativeEvent;var f=new u.constructor(u.type,u);Km=f,u.target.dispatchEvent(f),Km=null}else return o=Sl(u),o!==null&&Sf(o),a.blockedOn=u,!1;o.shift()}return!0}function HR(a,o,u){yf(a)&&u.delete(o)}function WR(){GE=!1,Ko!==null&&yf(Ko)&&(Ko=null),Pa!==null&&yf(Pa)&&(Pa=null),Ys!==null&&yf(Ys)&&(Ys=null),Wd.forEach(HR),Kd.forEach(HR)}function du(a,o){a.blockedOn===o&&(a.blockedOn=null,GE||(GE=!0,S.unstable_scheduleCallback(S.unstable_NormalPriority,WR)))}var zs=null;function Yd(a){zs!==a&&(zs=a,S.unstable_scheduleCallback(S.unstable_NormalPriority,function(){zs===a&&(zs=null);for(var o=0;o<a.length;o+=3){var u=a[o],f=a[o+1],E=a[o+2];if(typeof f!="function"){if(jE(f||u)===null)continue;break}var R=Sl(u);R!==null&&(a.splice(o,3),o-=3,W_(R,{pending:!0,data:E,method:u.method,action:f},f,E))}}))}function Pr(a){function o(q){return du(q,a)}Ko!==null&&du(Ko,a),Pa!==null&&du(Pa,a),Ys!==null&&du(Ys,a),Wd.forEach(o),Kd.forEach(o);for(var u=0;u<Yo.length;u++){var f=Yo[u];f.blockedOn===a&&(f.blockedOn=null)}for(;0<Yo.length&&(u=Yo[0],u.blockedOn===null);)vf(u),u.blockedOn===null&&Yo.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var E=u[f],R=u[f+1],k=E[Cr]||null;if(typeof R=="function")k||Yd(u);else if(k){var B=null;if(R&&R.hasAttribute("formAction")){if(E=R,k=R[Cr]||null)B=k.formAction;else if(jE(E)!==null)continue}else B=k.action;typeof B=="function"?u[f+1]=B:(u.splice(f,3),f-=3),Yd(u)}}}function zo(a){this._internalRoot=a}zd.prototype.render=zo.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(b(409));var u=o.current,f=Dr();FR(u,f,a,o,null,null)},zd.prototype.unmount=zo.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;FR(a.current,2,null,a,null,null),Zp(),o[El]=null}};function zd(a){this._internalRoot=a}zd.prototype.unstable_scheduleHydration=function(a){if(a){var o=ES();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Yo.length&&o!==0&&o<Yo[u].priority;u++);Yo.splice(u,0,a),u===0&&vf(a)}};var HE=A.version;if(HE!=="19.1.0")throw Error(b(527,HE,"19.1.0"));Jt.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(b(188)):(a=Object.keys(a).join(","),Error(b(268,a)));return a=X(o),a=a!==null?G(a):null,a=a===null?null:a.stateNode,a};var jA={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:gt,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cf.isDisabled&&Cf.supportsFiber)try{ml=Cf.inject(jA),Mn=Cf}catch{}}return iS.createRoot=function(a,o){if(!P(a))throw Error(b(299));var u=!1,f="",E=PT,R=kT,k=Mp,B=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(E=o.onUncaughtError),o.onCaughtError!==void 0&&(R=o.onCaughtError),o.onRecoverableError!==void 0&&(k=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(B=o.unstable_transitionCallbacks)),o=VR(a,1,!1,null,null,u,f,E,R,k,B,null),a[El]=o.current,Go(a),new zo(o)},iS.hydrateRoot=function(a,o,u){if(!P(a))throw Error(b(299));var f=!1,E="",R=PT,k=kT,B=Mp,q=null,ut=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(E=u.identifierPrefix),u.onUncaughtError!==void 0&&(R=u.onUncaughtError),u.onCaughtError!==void 0&&(k=u.onCaughtError),u.onRecoverableError!==void 0&&(B=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(q=u.unstable_transitionCallbacks),u.formState!==void 0&&(ut=u.formState)),o=VR(a,1,!0,o,u??null,f,E,R,k,B,q,ut),o.context=BR(null),u=o.current,f=Dr(),f=Um(f),E=Ms(f),E.callback=null,Ca(u,E,f),u=f,o.current.lanes=u,Gu(o,u),Da(o),a[El]=o.current,Go(a),new zd(o)},iS.version="19.1.0",iS}var yV;function tY(){if(yV)return Rw.exports;yV=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(A){console.error(A)}}return S(),Rw.exports=$K(),Rw.exports}var eY=tY();const nY=xw(eY);var cC={exports:{}},iY=cC.exports,CV;function rY(){return CV||(CV=1,function(S,A){(function(w,b){S.exports=b()})(iY,function(){function w(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof mw<"u"?mw:typeof self<"u"?self:{};function P(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var x=function(t){try{return!!t()}catch{return!0}},H=!x(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),J=H,X=Function.prototype,G=X.call,Z=J&&X.bind.bind(G,G),ot=J?Z:function(t){return function(){return G.apply(t,arguments)}},mt=ot({}.isPrototypeOf),Vt=function(t){return t&&t.Math==Math&&t},it=Vt(typeof globalThis=="object"&&globalThis)||Vt(typeof window=="object"&&window)||Vt(typeof self=="object"&&self)||Vt(typeof b=="object"&&b)||function(){return this}()||b||Function("return this")(),xt=H,yt=Function.prototype,kt=yt.apply,zt=yt.call,Bt=typeof Reflect=="object"&&Reflect.apply||(xt?zt.bind(kt):function(){return zt.apply(kt,arguments)}),ie=ot,te=ie({}.toString),fn=ie("".slice),Le=function(t){return fn(te(t),8,-1)},Cn=Le,Tn=ot,oi=function(t){if(Cn(t)==="Function")return Tn(t)},er=typeof document=="object"&&document.all,pi={all:er,IS_HTMLDDA:er===void 0&&er!==void 0},An=pi.all,Qe=pi.IS_HTMLDDA?function(t){return typeof t=="function"||t===An}:function(t){return typeof t=="function"},In={},gt=!x(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Jt=H,he=Function.prototype.call,ve=Jt?he.bind(he):function(){return he.apply(he,arguments)},tt={},Ut={}.propertyIsEnumerable,Zt=Object.getOwnPropertyDescriptor,qt=Zt&&!Ut.call({1:2},1);tt.f=qt?function(t){var e=Zt(this,t);return!!e&&e.enumerable}:Ut;var ne,Ze,fe=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Hr=x,Jn=Le,Ka=Object,Om=ot("".split),Ec=Hr(function(){return!Ka("z").propertyIsEnumerable(0)})?function(t){return Jn(t)=="String"?Om(t,""):Ka(t)}:Ka,ho=function(t){return t==null},wm=ho,Nm=TypeError,fl=function(t){if(wm(t))throw Nm("Can't call method on "+t);return t},CC=Ec,Ya=fl,po=function(t){return CC(Ya(t))},Dm=Qe,pS=pi.all,Wi=pi.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Dm(t)||t===pS}:function(t){return typeof t=="object"?t!==null:Dm(t)},Wr={},Mh=Wr,Lm=it,AC=Qe,ml=function(t){return AC(t)?t:void 0},Mn=function(t,e){return arguments.length<2?ml(Mh[t])||ml(Lm[t]):Mh[t]&&Mh[t][e]||Lm[t]&&Lm[t][e]},ur=typeof navigator<"u"&&String(navigator.userAgent)||"",yr=it,Pm=ur,fS=yr.process,mS=yr.Deno,Vu=fS&&fS.versions||mS&&mS.version,Bu=Vu&&Vu.v8;Bu&&(Ze=(ne=Bu.split("."))[0]>0&&ne[0]<4?1:+(ne[0]+ne[1])),!Ze&&Pm&&(!(ne=Pm.match(/Edge\/(\d+)/))||ne[1]>=74)&&(ne=Pm.match(/Chrome\/(\d+)/))&&(Ze=+ne[1]);var Kr=Ze,Fu=Kr,ju=x,bC=it.String,gc=!!Object.getOwnPropertySymbols&&!ju(function(){var t=Symbol();return!bC(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Fu&&Fu<41}),km=gc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Mm=Mn,Gu=Qe,IC=mt,_S=Object,_l=km?function(t){return typeof t=="symbol"}:function(t){var e=Mm("Symbol");return Gu(e)&&IC(e.prototype,_S(t))},Um=String,fo=function(t){try{return Um(t)}catch{return"Object"}},ES=Qe,OC=fo,mo=TypeError,On=function(t){if(ES(t))return t;throw mo(OC(t)+" is not a function")},Cr=On,El=ho,gl=function(t,e){var n=t[e];return El(n)?void 0:Cr(n)},gS=ve,SS=Qe,xm=Wi,Hu=TypeError,Uh={exports:{}},Sc=it,Sl=Object.defineProperty,Wu=function(t,e){try{Sl(Sc,t,{value:e,configurable:!0,writable:!0})}catch{Sc[t]=e}return e},Tc="__core-js_shared__",vi=it[Tc]||Wu(Tc,{}),Vm=vi;(Uh.exports=function(t,e){return Vm[t]||(Vm[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Rc=Uh.exports,vc=fl,Tl=Object,za=function(t){return Tl(vc(t))},TS=za,RS=ot({}.hasOwnProperty),fi=Object.hasOwn||function(t,e){return RS(TS(t),e)},xh=ot,Vh=0,Cs=Math.random(),Bm=xh(1 .toString),Bh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Bm(++Vh+Cs,36)},Rl=Rc,Fh=fi,Fm=Bh,wC=gc,vS=km,Ki=it.Symbol,jh=Rl("wks"),NC=vS?Ki.for||Ki:Ki&&Ki.withoutSetter||Fm,dn=function(t){return Fh(jh,t)||(jh[t]=wC&&Fh(Ki,t)?Ki[t]:NC("Symbol."+t)),jh[t]},yS=ve,Ku=Wi,CS=_l,ea=gl,jm=function(t,e){var n,i;if(SS(n=t.toString)&&!xm(i=gS(n,t))||SS(n=t.valueOf)&&!xm(i=gS(n,t)))return i;throw Hu("Can't convert object to primitive value")},AS=TypeError,Gm=dn("toPrimitive"),vl=function(t,e){if(!Ku(t)||CS(t))return t;var n,i=ea(t,Gm);if(i){if(n=yS(i,t,e),!Ku(n)||CS(n))return n;throw AS("Can't convert object to primitive value")}return jm(t)},bS=_l,Yu=function(t){var e=vl(t,"string");return bS(e)?e:e+""},yc=Wi,Hm=it.document,IS=yc(Hm)&&yc(Hm.createElement),Gh=function(t){return IS?Hm.createElement(t):{}},Wm=Gh,OS=!gt&&!x(function(){return Object.defineProperty(Wm("div"),"a",{get:function(){return 7}}).a!=7}),DC=gt,Hh=ve,Km=tt,Ym=fe,yl=po,Cl=Yu,wS=fi,zm=OS,qm=Object.getOwnPropertyDescriptor;In.f=DC?qm:function(t,e){if(t=yl(t),e=Cl(e),zm)try{return qm(t,e)}catch{}if(wS(t,e))return Ym(!Hh(Km.f,t,e),t[e])};var zu=x,As=Qe,Xm=/#|\.prototype\./,bs=function(t,e){var n=Jm[_o(t)];return n==NS||n!=Wh&&(As(e)?zu(e):!!e)},_o=bs.normalize=function(t){return String(t).replace(Xm,".").toLowerCase()},Jm=bs.data={},Wh=bs.NATIVE="N",NS=bs.POLYFILL="P",qu=bs,Kh=On,DS=H,Ar=oi(oi.bind),br=function(t,e){return Kh(t),e===void 0?t:DS?Ar(t,e):function(){return t.apply(e,arguments)}},dr={},Al=gt&&x(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),LC=Wi,Qm=String,Zm=TypeError,yi=function(t){if(LC(t))return t;throw Zm(Qm(t)+" is not an object")},Yh=gt,LS=OS,PC=Al,zh=yi,PS=Yu,$m=TypeError,t_=Object.defineProperty,kC=Object.getOwnPropertyDescriptor,e_="enumerable",n_="configurable",i_="writable";dr.f=Yh?PC?function(t,e,n){if(zh(t),e=PS(e),zh(n),typeof t=="function"&&e==="prototype"&&"value"in n&&i_ in n&&!n[i_]){var i=kC(t,e);i&&i[i_]&&(t[e]=n.value,n={configurable:n_ in n?n[n_]:i[n_],enumerable:e_ in n?n[e_]:i[e_],writable:!1})}return t_(t,e,n)}:t_:function(t,e,n){if(zh(t),e=PS(e),zh(n),LS)try{return t_(t,e,n)}catch{}if("get"in n||"set"in n)throw $m("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var kS=dr,MC=fe,Eo=gt?function(t,e,n){return kS.f(t,e,MC(1,n))}:function(t,e,n){return t[e]=n,t},qh=it,UC=Bt,r_=oi,xC=Qe,VC=In.f,BC=qu,Cc=Wr,FC=br,bl=Eo,MS=fi,jC=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return UC(t,this,arguments)};return e.prototype=t.prototype,e},Ne=function(t,e){var n,i,r,s,c,l,d,h,p,m=t.target,_=t.global,g=t.stat,I=t.proto,y=_?qh:g?qh[m]:(qh[m]||{}).prototype,C=_?Cc:Cc[m]||bl(Cc,m,{})[m],N=C.prototype;for(s in e)i=!(n=BC(_?s:m+(g?".":"#")+s,t.forced))&&y&&MS(y,s),l=C[s],i&&(d=t.dontCallGetSet?(p=VC(y,s))&&p.value:y[s]),c=i&&d?d:e[s],i&&typeof l==typeof c||(h=t.bind&&i?FC(c,qh):t.wrap&&i?jC(c):I&&xC(c)?r_(c):c,(t.sham||c&&c.sham||l&&l.sham)&&bl(h,"sham",!0),bl(C,s,h),I&&(MS(Cc,r=m+"Prototype")||bl(Cc,r,{}),bl(Cc[r],s,c),t.real&&N&&(n||!N[s])&&bl(N,s,c)))},GC=Math.ceil,HC=Math.floor,WC=Math.trunc||function(t){var e=+t;return(e>0?HC:GC)(e)},KC=WC,Xu=function(t){var e=+t;return e!=e||e===0?0:KC(e)},Ju=Xu,YC=Math.max,US=Math.min,Xh=function(t,e){var n=Ju(t);return n<0?YC(n+e,0):US(n,e)},xS=Xu,VS=Math.min,a_=function(t){return t>0?VS(xS(t),9007199254740991):0},Il=a_,Is=function(t){return Il(t.length)},zC=po,qC=Xh,BS=Is,s_=function(t){return function(e,n,i){var r,s=zC(e),c=BS(s),l=qC(i,c);if(t&&n!=n){for(;c>l;)if((r=s[l++])!=r)return!0}else for(;c>l;l++)if((t||l in s)&&s[l]===n)return t||l||0;return!t&&-1}},Ac={includes:s_(!0),indexOf:s_(!1)},Qu=Ac.includes;Ne({target:"Array",proto:!0,forced:x(function(){return!Array(1).includes()})},{includes:function(t){return Qu(this,t,arguments.length>1?arguments[1]:void 0)}});var XC=Wr,hr=function(t){return XC[t+"Prototype"]},FS=hr("Array").includes,jS=Wi,o_=Le,c_=dn("match"),l_=function(t){var e;return jS(t)&&((e=t[c_])!==void 0?!!e:o_(t)=="RegExp")},GS=l_,HS=TypeError,WS={};WS[dn("toStringTag")]="z";var u_=String(WS)==="[object z]",JC=u_,QC=Qe,Jh=Le,Yr=dn("toStringTag"),Zu=Object,KS=Jh(function(){return arguments}())=="Arguments",Ra=JC?Jh:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,s){try{return r[s]}catch{}}(e=Zu(t),Yr))=="string"?n:KS?Jh(e):(i=Jh(e))=="Object"&&QC(e.callee)?"Arguments":i},YS=Ra,zS=String,pr=function(t){if(YS(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return zS(t)},ZC=dn("match"),Ol=Ne,d_=function(t){if(GS(t))throw HS("The method doesn't accept regular expressions");return t},$u=fl,Qh=pr,qS=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[ZC]=!1,"/./"[t](e)}catch{}}return!1},bc=ot("".indexOf);Ol({target:"String",proto:!0,forced:!qS("includes")},{includes:function(t){return!!~bc(Qh($u(this)),Qh(d_(t)),arguments.length>1?arguments[1]:void 0)}});var wl=hr("String").includes,Zh=mt,XS=FS,Ic=wl,$h=Array.prototype,tp=String.prototype,JS=function(t){var e=t.includes;return t===$h||Zh($h,t)&&e===$h.includes?XS:typeof t=="string"||t===tp||Zh(tp,t)&&e===tp.includes?Ic:e},_t=P(JS),$C=On,tA=za,QS=Ec,ZS=Is,h_=TypeError,va=function(t){return function(e,n,i,r){$C(n);var s=tA(e),c=QS(s),l=ZS(s),d=t?l-1:0,h=t?-1:1;if(i<2)for(;;){if(d in c){r=c[d],d+=h;break}if(d+=h,t?d<0:l<=d)throw h_("Reduce of empty array with no initial value")}for(;t?d>=0:l>d;d+=h)d in c&&(r=n(r,c[d],d,s));return r}},$S={left:va(!1)},na=x,fr=function(t,e){var n=[][t];return!!n&&na(function(){n.call(null,e||function(){return 1},1)})},ya=typeof process<"u"&&Le(process)=="process",p_=$S.left;Ne({target:"Array",proto:!0,forced:!ya&&Kr>79&&Kr<83||!fr("reduce")},{reduce:function(t){var e=arguments.length;return p_(this,t,e,e>1?arguments[1]:void 0)}});var ep=hr("Array").reduce,np=mt,f_=ep,go=Array.prototype,tT=function(t){var e=t.reduce;return t===go||np(go,t)&&e===go.reduce?f_:e},td=tT,nr=P(td),eA=Le,Yi=Array.isArray||function(t){return eA(t)=="Array"},m_=Ne,Os=Yi,eT=ot([].reverse),ed=[1,2];m_({target:"Array",proto:!0,forced:String(ed)===String(ed.reverse())},{reverse:function(){return Os(this)&&(this.length=this.length),eT(this)}});var Oc=hr("Array").reverse,__=mt,E_=Oc,So=Array.prototype,Nl=function(t){var e=t.reverse;return t===So||__(So,t)&&e===So.reverse?E_:e},nd=Nl,id=P(nd),ia=Bh,zr=Rc("keys"),qa=function(t){return zr[t]||(zr[t]=ia(t))},ws=!x(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ns=fi,wc=Qe,nT=za,g_=ws,ip=qa("IE_PROTO"),zi=Object,ci=zi.prototype,on=g_?zi.getPrototypeOf:function(t){var e=nT(t);if(Ns(e,ip))return e[ip];var n=e.constructor;return wc(n)&&e instanceof n?n.prototype:e instanceof zi?ci:null},Nc=ot,Xa=On,S_=Qe,Dc=String,iT=TypeError,rT=function(t,e,n){try{return Nc(Xa(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},rd=yi,ad=function(t){if(typeof t=="object"||S_(t))return t;throw iT("Can't set "+Dc(t)+" as a prototype")},aT=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=rT(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return rd(i),ad(r),e?t(i,r):i.__proto__=r,i}}():void 0),To={},Dl={},Ds=fi,Ls=po,Ro=Ac.indexOf,Ps=Dl,rp=ot([].push),ap=function(t,e){var n,i=Ls(t),r=0,s=[];for(n in i)!Ds(Ps,n)&&Ds(i,n)&&rp(s,n);for(;e.length>r;)Ds(i,n=e[r++])&&(~Ro(s,n)||rp(s,n));return s},Lc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],sp=ap,Pc=Lc.concat("length","prototype");To.f=Object.getOwnPropertyNames||function(t){return sp(t,Pc)};var Ci={};Ci.f=Object.getOwnPropertySymbols;var op=Mn,sT=To,nA=Ci,iA=yi,rA=ot([].concat),Li=op("Reflect","ownKeys")||function(t){var e=sT.f(iA(t)),n=nA.f;return n?rA(e,n(t)):e},cp=fi,sd=Li,od=In,T_=dr,vo={},Ll=ap,aA=Lc,cd=Object.keys||function(t){return Ll(t,aA)},sA=gt,oT=Al,kc=dr,R_=yi,lp=po,cT=cd;vo.f=sA&&!oT?Object.defineProperties:function(t,e){R_(t);for(var n,i=lp(e),r=cT(e),s=r.length,c=0;s>c;)kc.f(t,n=r[c++],i[n]);return t};var yo,v_=Mn("document","documentElement"),up=yi,y_=vo,C_=Lc,dp=Dl,lT=v_,ld=Gh,hp="prototype",pp="script",ks=qa("IE_PROTO"),ud=function(){},fp=function(t){return"<"+pp+">"+t+"</"+pp+">"},Ms=function(t){t.write(fp("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ca=function(){try{yo=new ActiveXObject("htmlfile")}catch{}var t,e,n;Ca=typeof document<"u"?document.domain&&yo?Ms(yo):(e=ld("iframe"),n="java"+pp+":",e.style.display="none",lT.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(fp("document.F=Object")),t.close(),t.F):Ms(yo);for(var i=C_.length;i--;)delete Ca[hp][C_[i]];return Ca()};dp[ks]=!0;var Us=Object.create||function(t,e){var n;return t!==null?(ud[hp]=up(t),n=new ud,ud[hp]=null,n[ks]=t):n=Ca(),e===void 0?n:y_.f(n,e)},A_=Wi,b_=Eo,Pl=Error,dd=ot("".replace),uT=String(Pl("zxcasd").stack),I_=/\n\s*at [^:]*:[^\n]*/,kl=I_.test(uT),mp=fe,dT=!x(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",mp(1,7)),t.stack!==7)}),O_=Eo,w_=function(t,e){if(kl&&typeof t=="string"&&!Pl.prepareStackTrace)for(;e--;)t=dd(t,I_,"");return t},Co=dT,Me=Error.captureStackTrace,rn={},Ai=rn,_p=dn("iterator"),Ml=Array.prototype,Ao=function(t){return t!==void 0&&(Ai.Array===t||Ml[_p]===t)},Ep=Ra,Ul=gl,xl=ho,oA=rn,mi=dn("iterator"),Vl=function(t){if(!xl(t))return Ul(t,mi)||Ul(t,"@@iterator")||oA[Ep(t)]},N_=ve,hT=On,pT=yi,cA=fo,D_=Vl,L_=TypeError,hd=function(t,e){var n=arguments.length<2?D_(t):e;if(hT(n))return pT(N_(n,t));throw L_(cA(t)+" is not iterable")},Ir=ve,_i=yi,P_=gl,Bl=function(t,e,n){var i,r;_i(t);try{if(!(i=P_(t,"return"))){if(e==="throw")throw n;return n}i=Ir(i,t)}catch(s){r=!0,i=s}if(e==="throw")throw n;if(r)throw i;return _i(i),n},gp=br,k_=ve,xs=yi,Sp=fo,M_=Ao,U_=Is,x_=mt,fT=hd,mT=Vl,V_=Bl,_T=TypeError,pd=function(t,e){this.stopped=t,this.result=e},Tp=pd.prototype,Fl=function(t,e,n){var i,r,s,c,l,d,h,p=n&&n.that,m=!(!n||!n.AS_ENTRIES),_=!(!n||!n.IS_RECORD),g=!(!n||!n.IS_ITERATOR),I=!(!n||!n.INTERRUPTED),y=gp(e,p),C=function(D){return i&&V_(i,"normal",D),new pd(!0,D)},N=function(D){return m?(xs(D),I?y(D[0],D[1],C):y(D[0],D[1])):I?y(D,C):y(D)};if(_)i=t.iterator;else if(g)i=t;else{if(!(r=mT(t)))throw _T(Sp(t)+" is not iterable");if(M_(r)){for(s=0,c=U_(t);c>s;s++)if((l=N(t[s]))&&x_(Tp,l))return l;return new pd(!1)}i=fT(t,r)}for(d=_?t.next:i.next;!(h=k_(d,i)).done;){try{l=N(h.value)}catch(D){V_(i,"throw",D)}if(typeof l=="object"&&l&&x_(Tp,l))return l}return new pd(!1)},lA=pr,ET=Ne,gT=mt,ST=on,jl=aT,TT=function(t,e,n){for(var i=sd(e),r=T_.f,s=od.f,c=0;c<i.length;c++){var l=i[c];cp(t,l)||n&&cp(n,l)||r(t,l,s(e,l))}},B_=Us,Rp=Eo,vp=fe,RT=function(t,e){A_(e)&&"cause"in e&&b_(t,"cause",e.cause)},uA=function(t,e,n,i){Co&&(Me?Me(t,e):O_(t,"stack",w_(n,i)))},vT=Fl,Gl=function(t,e){return t===void 0?arguments.length<2?"":e:lA(t)},yp=dn("toStringTag"),fd=Error,Cp=[].push,Ja=function(t,e){var n,i=gT(Ap,this);jl?n=jl(fd(),i?ST(this):Ap):(n=i?this:B_(Ap),Rp(n,yp,"Error")),e!==void 0&&Rp(n,"message",Gl(e)),uA(n,Ja,n.stack,1),arguments.length>2&&RT(n,arguments[2]);var r=[];return vT(t,Cp,{that:r}),Rp(n,"errors",r),n};jl?jl(Ja,fd):TT(Ja,fd,{name:!0});var Ap=Ja.prototype=B_(fd.prototype,{constructor:vp(1,Ja),message:vp(1,""),name:vp(1,"AggregateError")});ET({global:!0},{AggregateError:Ja});var md,Hl,_d,yT=Qe,F_=it.WeakMap,j_=yT(F_)&&/native code/.test(String(F_)),G_=it,CT=Wi,H_=Eo,bp=fi,Ip=vi,dA=qa,W_=Dl,K_="Object already initialized",Op=G_.TypeError,Y_=G_.WeakMap;if(j_||Ip.state){var Aa=Ip.state||(Ip.state=new Y_);Aa.get=Aa.get,Aa.has=Aa.has,Aa.set=Aa.set,md=function(t,e){if(Aa.has(t))throw Op(K_);return e.facade=t,Aa.set(t,e),e},Hl=function(t){return Aa.get(t)||{}},_d=function(t){return Aa.has(t)}}else{var Mc=dA("state");W_[Mc]=!0,md=function(t,e){if(bp(t,Mc))throw Op(K_);return e.facade=t,H_(t,Mc,e),e},Hl=function(t){return bp(t,Mc)?t[Mc]:{}},_d=function(t){return bp(t,Mc)}}var Uc,AT,z_,ba={set:md,get:Hl,has:_d,enforce:function(t){return _d(t)?Hl(t):md(t,{})},getterFor:function(t){return function(e){var n;if(!CT(e)||(n=Hl(e)).type!==t)throw Op("Incompatible receiver, "+t+" required");return n}}},Ed=gt,wp=fi,q_=Function.prototype,bT=Ed&&Object.getOwnPropertyDescriptor,gd=wp(q_,"name"),X_={PROPER:gd&&(function(){}).name==="something",CONFIGURABLE:gd&&(!Ed||Ed&&bT(q_,"name").configurable)},IT=Eo,bo=function(t,e,n,i){return i&&i.enumerable?t[e]=n:IT(t,e,n),t},Wl=x,Sd=Qe,Np=Wi,Td=Us,Rd=on,OT=bo,Dp=dn("iterator"),xc=!1;[].keys&&("next"in(z_=[].keys())?(AT=Rd(Rd(z_)))!==Object.prototype&&(Uc=AT):xc=!0);var wT=!Np(Uc)||Wl(function(){var t={};return Uc[Dp].call(t)!==t});Sd((Uc=wT?{}:Td(Uc))[Dp])||OT(Uc,Dp,function(){return this});var qr={IteratorPrototype:Uc,BUGGY_SAFARI_ITERATORS:xc},Qa=Ra,Io=u_?{}.toString:function(){return"[object "+Qa(this)+"]"},NT=u_,Oo=dr.f,Vs=Eo,Pi=fi,Lp=Io,Pp=dn("toStringTag"),Za=function(t,e,n,i){if(t){var r=n?t:t.prototype;Pi(r,Pp)||Oo(r,Pp,{configurable:!0,value:e}),i&&!NT&&Vs(r,"toString",Lp)}},DT=qr.IteratorPrototype,LT=Us,Vc=fe,kp=Za,PT=rn,kT=function(){return this},Mp=function(t,e,n,i){var r=e+" Iterator";return t.prototype=LT(DT,{next:Vc(+!i,n)}),kp(t,r,!1,!0),PT[r]=kT,t},Up=Ne,MT=ve,J_=X_,UT=Mp,xT=on,hA=Za,Q_=bo,ki=rn,qi=qr,VT=J_.PROPER,vd=qi.BUGGY_SAFARI_ITERATORS,xp=dn("iterator"),Z_="keys",yd="values",Cd="entries",$_=function(){return this},tE=function(t,e,n,i,r,s,c){UT(n,e,i);var l,d,h,p=function(N){if(N===r&&y)return y;if(!vd&&N in g)return g[N];switch(N){case Z_:case yd:case Cd:return function(){return new n(this,N)}}return function(){return new n(this)}},m=e+" Iterator",_=!1,g=t.prototype,I=g[xp]||g["@@iterator"]||r&&g[r],y=!vd&&I||p(r),C=e=="Array"&&g.entries||I;if(C&&(l=xT(C.call(new t)))!==Object.prototype&&l.next&&(hA(l,m,!0,!0),ki[m]=$_),VT&&r==yd&&I&&I.name!==yd&&(_=!0,y=function(){return MT(I,this)}),r)if(d={values:p(yd),keys:s?y:p(Z_),entries:p(Cd)},c)for(h in d)(vd||_||!(h in g))&&Q_(g,h,d[h]);else Up({target:e,proto:!0,forced:vd||_},d);return c&&g[xp]!==y&&Q_(g,xp,y,{}),ki[e]=y,d},Vp=function(t,e){return{value:t,done:e}},BT=po,Bp=rn,Fp=ba;dr.f;var eE=tE,nE=Vp,jp="Array Iterator",Gp=Fp.set,iE=Fp.getterFor(jp);eE(Array,"Array",function(t,e){Gp(this,{type:jp,target:BT(t),index:0,kind:e})},function(){var t=iE(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,nE(void 0,!0)):nE(n=="keys"?i:n=="values"?e[i]:[i,e[i]],!1)},"values"),Bp.Arguments=Bp.Array;var FT=dr,Kl=function(t,e,n){return FT.f(t,e,n)},jT=Mn,Bs=Kl,rE=gt,GT=dn("species"),HT=mt,Fs=TypeError,Hp=function(t,e){if(HT(e,t))return t;throw Fs("Incorrect invocation")},Wp=Qe,Bc=vi,ti=ot(Function.toString);Wp(Bc.inspectSource)||(Bc.inspectSource=function(t){return ti(t)});var WT=Bc.inspectSource,pA=ot,KT=x,Yl=Qe,wo=Ra,YT=WT,aE=function(){},Ad=[],Ia=Mn("Reflect","construct"),Kp=/^\s*(?:class|function)\b/,sE=pA(Kp.exec),zT=!Kp.exec(aE),Fc=function(t){if(!Yl(t))return!1;try{return Ia(aE,Ad,t),!0}catch{return!1}},Yp=function(t){if(!Yl(t))return!1;switch(wo(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return zT||!!sE(Kp,YT(t))}catch{return!0}};Yp.sham=!0;var No,jc,$a,ei,zl=!Ia||KT(function(){var t;return Fc(Fc.call)||!Fc(Object)||!Fc(function(){t=!0})||t})?Yp:Fc,qT=zl,ji=fo,fA=TypeError,oE=yi,XT=function(t){if(qT(t))return t;throw fA(ji(t)+" is not a constructor")},Qn=ho,Or=dn("species"),Oa=function(t,e){var n,i=oE(t).constructor;return i===void 0||Qn(n=oE(i)[Or])?e:XT(n)},bd=ot([].slice),JT=TypeError,ql=function(t,e){if(t<e)throw JT("Not enough arguments");return t},zp=/(?:ipad|iphone|ipod).*applewebkit/i.test(ur),zn=it,wa=Bt,QT=br,wr=Qe,ZT=fi,js=x,Do=v_,Lo=bd,qp=Gh,cE=ql,ts=zp,$T=ya,Po=zn.setImmediate,Gc=zn.clearImmediate,Id=zn.process,ko=zn.Dispatch,tR=zn.Function,lE=zn.MessageChannel,Od=zn.String,Xp=0,Mo={},uE="onreadystatechange";js(function(){No=zn.location});var dE=function(t){if(ZT(Mo,t)){var e=Mo[t];delete Mo[t],e()}},hE=function(t){return function(){dE(t)}},Rn=function(t){dE(t.data)},Un=function(t){zn.postMessage(Od(t),No.protocol+"//"+No.host)};Po&&Gc||(Po=function(t){cE(arguments.length,1);var e=wr(t)?t:tR(t),n=Lo(arguments,1);return Mo[++Xp]=function(){wa(e,void 0,n)},jc(Xp),Xp},Gc=function(t){delete Mo[t]},$T?jc=function(t){Id.nextTick(hE(t))}:ko&&ko.now?jc=function(t){ko.now(hE(t))}:lE&&!ts?(ei=($a=new lE).port2,$a.port1.onmessage=Rn,jc=QT(ei.postMessage,ei)):zn.addEventListener&&wr(zn.postMessage)&&!zn.importScripts&&No&&No.protocol!=="file:"&&!js(Un)?(jc=Un,zn.addEventListener("message",Rn,!1)):jc=uE in qp("script")?function(t){Do.appendChild(qp("script"))[uE]=function(){Do.removeChild(this),dE(t)}}:function(t){setTimeout(hE(t),0)});var Ue={set:Po,clear:Gc},$e=function(){this.head=null,this.tail=null};$e.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var an,mr,es,Uo,Jp,ns=$e,li=/ipad|iphone|ipod/i.test(ur)&&typeof Pebble<"u",xo=/web0s(?!.*chrome)/i.test(ur),Xr=it,Qp=br,ra=In.f,Vo=Ue.set,wd=ns,Nr=zp,pE=li,fE=xo,Xl=ya,Nd=Xr.MutationObserver||Xr.WebKitMutationObserver,Gs=Xr.document,Gi=Xr.process,Na=Xr.Promise,Hc=ra(Xr,"queueMicrotask"),Bo=Hc&&Hc.value;if(!Bo){var Jl=new wd,Ql=function(){var t,e;for(Xl&&(t=Gi.domain)&&t.exit();e=Jl.get();)try{e()}catch(n){throw Jl.head&&an(),n}t&&t.enter()};Nr||Xl||fE||!Nd||!Gs?!pE&&Na&&Na.resolve?((Uo=Na.resolve(void 0)).constructor=Na,Jp=Qp(Uo.then,Uo),an=function(){Jp(Ql)}):Xl?an=function(){Gi.nextTick(Ql)}:(Vo=Qp(Vo,Xr),an=function(){Vo(Ql)}):(mr=!0,es=Gs.createTextNode(""),new Nd(Ql).observe(es,{characterData:!0}),an=function(){es.data=mr=!mr}),Bo=function(t){Jl.head||an(),Jl.add(t)}}var mE=Bo,is=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},Hs=it.Promise,Dr=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",eR=!Dr&&!ya&&typeof window=="object"&&typeof document=="object",Jr=it,Zl=Hs,nR=Qe,mA=qu,Fo=WT,Zp=dn,_E=eR,$l=Dr,$p=Kr,EE=Zl&&Zl.prototype,iR=Zp("species"),tf=nR(Jr.PromiseRejectionEvent),gE=mA("Promise",function(){var t=Fo(Zl),e=t!==String(Zl);if(!e&&$p===66||!EE.catch||!EE.finally)return!0;if(!$p||$p<51||!/native code/.test(t)){var n=new Zl(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[iR]=i,!(n.then(function(){})instanceof i))return!0}return!e&&(_E||$l)&&!tf}),Dd={CONSTRUCTOR:gE,REJECTION_EVENT:tf},rs={},rR=On,aR=TypeError,sR=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw aR("Bad Promise constructor");e=i,n=r}),this.resolve=rR(e),this.reject=rR(n)};rs.f=function(t){return new sR(t)};var jo,Ld,oR=Ne,Pd=ya,Ws=it,tu=ve,cR=bo,lR=Za,ef=function(t){var e=jT(t);rE&&e&&!e[GT]&&Bs(e,GT,{configurable:!0,get:function(){return this}})},uR=On,nf=Qe,xn=Wi,SE=Hp,_A=Oa,TE=Ue.set,RE=mE,EA=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},gA=is,rf=ns,Wc=ba,kd=Hs,Md=Dd,af=rs,as="Promise",Da=Md.CONSTRUCTOR,Ud=Md.REJECTION_EVENT,vE=Wc.getterFor(as),dR=Wc.set,hR=kd&&kd.prototype,eu=kd,sf=hR,pR=Ws.TypeError,xd=Ws.document,of=Ws.process,cf=af.f,SA=cf,yE=!!(xd&&xd.createEvent&&Ws.dispatchEvent),lf="unhandledrejection",fR=function(t){var e;return!(!xn(t)||!nf(e=t.then))&&e},mR=function(t,e){var n,i,r,s=e.value,c=e.state==1,l=c?t.ok:t.fail,d=t.resolve,h=t.reject,p=t.domain;try{l?(c||(e.rejection===2&&CE(e),e.rejection=1),l===!0?n=s:(p&&p.enter(),n=l(s),p&&(p.exit(),r=!0)),n===t.promise?h(pR("Promise-chain cycle")):(i=fR(n))?tu(i,n,d,h):d(n)):h(s)}catch(m){p&&!r&&p.exit(),h(m)}},nu=function(t,e){t.notified||(t.notified=!0,RE(function(){for(var n,i=t.reactions;n=i.get();)mR(n,t);t.notified=!1,e&&!t.rejection&&ER(t)}))},_R=function(t,e,n){var i,r;yE?((i=xd.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),Ws.dispatchEvent(i)):i={promise:e,reason:n},!Ud&&(r=Ws["on"+t])?r(i):t===lf&&EA("Unhandled promise rejection",n)},ER=function(t){tu(TE,Ws,function(){var e,n=t.facade,i=t.value;if(He(t)&&(e=gA(function(){Pd?of.emit("unhandledRejection",i,n):_R(lf,n,i)}),t.rejection=Pd||He(t)?2:1,e.error))throw e.value})},He=function(t){return t.rejection!==1&&!t.parent},CE=function(t){tu(TE,Ws,function(){var e=t.facade;Pd?of.emit("rejectionHandled",e):_R("rejectionhandled",e,t.value)})},Ks=function(t,e,n){return function(i){t(e,i,n)}},Go=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,nu(t,!0))},uf=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw pR("Promise can't be resolved itself");var i=fR(e);i?RE(function(){var r={done:!1};try{tu(i,e,Ks(uf,r,t),Ks(Go,r,t))}catch(s){Go(r,s,t)}}):(t.value=e,t.state=1,nu(t,!1))}catch(r){Go({done:!1},r,t)}}};Da&&(sf=(eu=function(t){SE(this,sf),uR(t),tu(jo,this);var e=vE(this);try{t(Ks(uf,e),Ks(Go,e))}catch(n){Go(e,n)}}).prototype,(jo=function(t){dR(this,{type:as,done:!1,notified:!1,parent:!1,reactions:new rf,rejection:!1,state:0,value:void 0})}).prototype=cR(sf,"then",function(t,e){var n=vE(this),i=cf(_A(this,eu));return n.parent=!0,i.ok=!nf(t)||t,i.fail=nf(e)&&e,i.domain=Pd?of.domain:void 0,n.state==0?n.reactions.add(i):RE(function(){mR(i,n)}),i.promise}),Ld=function(){var t=new jo,e=vE(t);this.promise=t,this.resolve=Ks(uf,e),this.reject=Ks(Go,e)},af.f=cf=function(t){return t===eu||t===void 0?new Ld(t):SA(t)}),oR({global:!0,wrap:!0,forced:Da},{Promise:eu}),lR(eu,as,!1,!0),ef(as);var df=dn("iterator"),iu=!1;try{var hf=0,Kc={next:function(){return{done:!!hf++}},return:function(){iu=!0}};Kc[df]=function(){return this},Array.from(Kc,function(){throw 2})}catch{}var gR=Hs,TA=function(t,e){if(!iu)return!1;var n=!1;try{var i={};i[df]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},pf=Dd.CONSTRUCTOR||!TA(function(t){gR.all(t).then(void 0,function(){})}),SR=ve,TR=On,ff=rs,wn=is,AE=Fl;Ne({target:"Promise",stat:!0,forced:pf},{all:function(t){var e=this,n=ff.f(e),i=n.resolve,r=n.reject,s=wn(function(){var c=TR(e.resolve),l=[],d=0,h=1;AE(t,function(p){var m=d++,_=!1;h++,SR(c,e,p).then(function(g){_||(_=!0,l[m]=g,--h||i(l))},r)}),--h||i(l)});return s.error&&r(s.value),n.promise}});var Xi=Ne,RA=Dd.CONSTRUCTOR;Hs&&Hs.prototype,Xi({target:"Promise",proto:!0,forced:RA,real:!0},{catch:function(t){return this.then(void 0,t)}});var bE=ve,IE=On,mf=rs,RR=is,vR=Fl;Ne({target:"Promise",stat:!0,forced:pf},{race:function(t){var e=this,n=mf.f(e),i=n.reject,r=RR(function(){var s=IE(e.resolve);vR(t,function(c){bE(s,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var OE=ve,wE=rs;Ne({target:"Promise",stat:!0,forced:Dd.CONSTRUCTOR},{reject:function(t){var e=wE.f(this);return OE(e.reject,void 0,t),e.promise}});var vA=yi,yR=Wi,yA=rs,NE=function(t,e){if(vA(t),yR(e)&&e.constructor===t)return e;var n=yA.f(t);return(0,n.resolve)(e),n.promise},CA=Ne,AA=Hs,Ho=Dd.CONSTRUCTOR,CR=NE,DE=Mn("Promise"),bA=!Ho;CA({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return CR(bA&&this===DE?AA:this,t)}});var IA=ve,LE=On,OA=rs,La=is,PE=Fl;Ne({target:"Promise",stat:!0,forced:pf},{allSettled:function(t){var e=this,n=OA.f(e),i=n.resolve,r=n.reject,s=La(function(){var c=LE(e.resolve),l=[],d=0,h=1;PE(t,function(p){var m=d++,_=!1;h++,IA(c,e,p).then(function(g){_||(_=!0,l[m]={status:"fulfilled",value:g},--h||i(l))},function(g){_||(_=!0,l[m]={status:"rejected",reason:g},--h||i(l))})}),--h||i(l)});return s.error&&r(s.value),n.promise}});var AR=ve,bR=On,Vd=Mn,aa=rs,IR=is,_f=Fl,ss="No one promise resolved";Ne({target:"Promise",stat:!0,forced:pf},{any:function(t){var e=this,n=Vd("AggregateError"),i=aa.f(e),r=i.resolve,s=i.reject,c=IR(function(){var l=bR(e.resolve),d=[],h=0,p=1,m=!1;_f(t,function(_){var g=h++,I=!1;p++,AR(l,e,_).then(function(y){I||m||(m=!0,r(y))},function(y){I||m||(I=!0,d[g]=y,--p||s(new n(d,ss)))})}),--p||s(new n(d,ss))});return c.error&&s(c.value),i.promise}});var wA=Ne,kE=Hs,ru=x,OR=Mn,NA=Qe,DA=Oa,wR=NE,LA=kE&&kE.prototype;wA({target:"Promise",proto:!0,real:!0,forced:!!kE&&ru(function(){LA.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=DA(this,OR("Promise")),n=NA(t);return this.then(n?function(i){return wR(e,t()).then(function(){return i})}:t,n?function(i){return wR(e,t()).then(function(){throw i})}:t)}});var ME=ot,PA=Xu,kA=pr,NR=fl,au=ME("".charAt),su=ME("".charCodeAt),DR=ME("".slice),LR=function(t){return function(e,n){var i,r,s=kA(NR(e)),c=PA(n),l=s.length;return c<0||c>=l?t?"":void 0:(i=su(s,c))<55296||i>56319||c+1===l||(r=su(s,c+1))<56320||r>57343?t?au(s,c):i:t?DR(s,c,c+2):r-56320+(i-55296<<10)+65536}},Wo={codeAt:LR(!1),charAt:LR(!0)},Bd=Wo.charAt,PR=pr,Fd=ba,UE=tE,Ef=Vp,jd="String Iterator",kR=Fd.set,MR=Fd.getterFor(jd);UE(String,"String",function(t){kR(this,{type:jd,string:PR(t),index:0})},function(){var t,e=MR(this),n=e.string,i=e.index;return i>=n.length?Ef(void 0,!0):(t=Bd(n,i),e.index+=t.length,Ef(t,!1))});var MA=Wr.Promise,UR={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Gd=it,UA=Ra,xA=Eo,xR=rn,Hd=dn("toStringTag");for(var ou in UR){var gf=Gd[ou],xE=gf&&gf.prototype;xE&&UA(xE)!==Hd&&xA(xE,Hd,ou),xR[ou]=xR.Array}var cu=MA,Tt=P(cu),VR=hr("Array").values,BR=Ra,FR=fi,jR=mt,VE=VR,Sf=Array.prototype,Tf={DOMTokenList:!0,NodeList:!0},VA=function(t){var e=t.values;return t===Sf||jR(Sf,t)&&e===Sf.values||FR(Tf,BR(t))?VE:e},Lr=P(VA),BE=x,FE=dn("iterator"),lu=!BE(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),i="";return t.pathname="c%20d",e.forEach(function(r,s){e.delete("b"),i+=s+r}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[FE]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),jE=bo,GR=Yu,GE=dr,Ko=fe,Pa=function(t,e,n){var i=GR(e);i in t?GE.f(t,i,Ko(0,n)):t[i]=n},Ys=Xh,Wd=Is,Kd=Pa,Yo=Array,BA=Math.max,Rf=function(t,e,n){for(var i=Wd(t),r=Ys(e,i),s=Ys(n===void 0?i:n,i),c=Yo(BA(s-r,0)),l=0;r<s;r++,l++)Kd(c,l,t[r]);return c.length=l,c},uu=Rf,FA=Math.floor,vf=function(t,e){var n=t.length,i=FA(n/2);return n<8?yf(t,e):HR(t,vf(uu(t,0,i),e),vf(uu(t,i),e),e)},yf=function(t,e){for(var n,i,r=t.length,s=1;s<r;){for(i=s,n=t[s];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==s++&&(t[i]=n)}return t},HR=function(t,e,n,i){for(var r=e.length,s=n.length,c=0,l=0;c<r||l<s;)t[c+l]=c<r&&l<s?i(e[c],n[l])<=0?e[c++]:n[l++]:c<r?e[c++]:n[l++];return t},WR=vf,du=Ne,zs=it,Yd=ve,Pr=ot,zo=gt,zd=lu,HE=bo,jA=Kl,Cf=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:jE(t,i,e[i],n);return t},a=Za,o=Mp,u=ba,f=Hp,E=Qe,R=fi,k=br,B=Ra,q=yi,ut=Wi,Et=pr,Dt=Us,ht=fe,pt=hd,ye=Vl,se=ql,Nn=WR,rt=dn("iterator"),et="URLSearchParams",lt=et+"Iterator",wt=u.set,Kt=u.getterFor(et),We=u.getterFor(lt),re=Object.getOwnPropertyDescriptor,pe=function(t){if(!zo)return zs[t];var e=re(zs,t);return e&&e.value},Mi=pe("fetch"),tn=pe("Request"),sa=pe("Headers"),WE=tn&&tn.prototype,zw=sa&&sa.prototype,wB=zs.RegExp,NB=zs.TypeError,qw=zs.decodeURIComponent,DB=zs.encodeURIComponent,LB=Pr("".charAt),Xw=Pr([].join),qd=Pr([].push),GA=Pr("".replace),PB=Pr([].shift),Jw=Pr([].splice),Qw=Pr("".split),kB=Pr("".slice),MB=/\+/g,Zw=Array(4),UB=function(t){return Zw[t-1]||(Zw[t-1]=wB("((?:%[\\da-f]{2}){"+t+"})","gi"))},xB=function(t){try{return qw(t)}catch{return t}},$w=function(t){var e=GA(t,MB," "),n=4;try{return qw(e)}catch{for(;n;)e=GA(e,UB(n--),xB);return e}},VB=/[!'()~]|%20/g,BB={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},FB=function(t){return BB[t]},t0=function(t){return GA(DB(t),VB,FB)},HA=o(function(t,e){wt(this,{type:lt,iterator:pt(Kt(t).entries),kind:e})},"Iterator",function(){var t=We(this),e=t.kind,n=t.iterator.next(),i=n.value;return n.done||(n.value=e==="keys"?i.key:e==="values"?i.value:[i.key,i.value]),n},!0),e0=function(t){this.entries=[],this.url=null,t!==void 0&&(ut(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?LB(t,0)==="?"?kB(t,1):t:Et(t)))};e0.prototype={type:et,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,s,c,l,d=ye(t);if(d)for(n=(e=pt(t,d)).next;!(i=Yd(n,e)).done;){if(s=(r=pt(q(i.value))).next,(c=Yd(s,r)).done||(l=Yd(s,r)).done||!Yd(s,r).done)throw NB("Expected sequence with length 2");qd(this.entries,{key:Et(c.value),value:Et(l.value)})}else for(var h in t)R(t,h)&&qd(this.entries,{key:h,value:Et(t[h])})},parseQuery:function(t){if(t)for(var e,n,i=Qw(t,"&"),r=0;r<i.length;)(e=i[r++]).length&&(n=Qw(e,"="),qd(this.entries,{key:$w(PB(n)),value:$w(Xw(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],qd(n,t0(t.key)+"="+t0(t.value));return Xw(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var KR=function(){f(this,Af);var t=wt(this,new e0(arguments.length>0?arguments[0]:void 0));zo||(this.size=t.entries.length)},Af=KR.prototype;if(Cf(Af,{append:function(t,e){var n=Kt(this);se(arguments.length,2),qd(n.entries,{key:Et(t),value:Et(e)}),zo||this.length++,n.updateURL()},delete:function(t){for(var e=Kt(this),n=se(arguments.length,1),i=e.entries,r=Et(t),s=n<2?void 0:arguments[1],c=s===void 0?s:Et(s),l=0;l<i.length;){var d=i[l];if(d.key!==r||c!==void 0&&d.value!==c)l++;else if(Jw(i,l,1),c!==void 0)break}zo||(this.size=i.length),e.updateURL()},get:function(t){var e=Kt(this).entries;se(arguments.length,1);for(var n=Et(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=Kt(this).entries;se(arguments.length,1);for(var n=Et(t),i=[],r=0;r<e.length;r++)e[r].key===n&&qd(i,e[r].value);return i},has:function(t){for(var e=Kt(this).entries,n=se(arguments.length,1),i=Et(t),r=n<2?void 0:arguments[1],s=r===void 0?r:Et(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(s===void 0||l.value===s))return!0}return!1},set:function(t,e){var n=Kt(this);se(arguments.length,1);for(var i,r=n.entries,s=!1,c=Et(t),l=Et(e),d=0;d<r.length;d++)(i=r[d]).key===c&&(s?Jw(r,d--,1):(s=!0,i.value=l));s||qd(r,{key:c,value:l}),zo||(this.size=r.length),n.updateURL()},sort:function(){var t=Kt(this);Nn(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=Kt(this).entries,i=k(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new HA(this,"keys")},values:function(){return new HA(this,"values")},entries:function(){return new HA(this,"entries")}},{enumerable:!0}),HE(Af,rt,Af.entries,{}),HE(Af,"toString",function(){return Kt(this).serialize()},{enumerable:!0}),zo&&jA(Af,"size",{get:function(){return Kt(this).entries.length},configurable:!0,enumerable:!0}),a(KR,et),du({global:!0,forced:!zd},{URLSearchParams:KR}),!zd&&E(sa)){var jB=Pr(zw.has),GB=Pr(zw.set),n0=function(t){if(ut(t)){var e,n=t.body;if(B(n)===et)return e=t.headers?new sa(t.headers):new sa,jB(e,"content-type")||GB(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Dt(t,{body:ht(0,Et(n)),headers:ht(0,e)})}return t};if(E(Mi)&&du({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return Mi(t,arguments.length>1?n0(arguments[1]):{})}}),E(tn)){var WA=function(t){return f(this,WE),new tn(t,arguments.length>1?n0(arguments[1]):{})};WE.constructor=WA,WA.prototype=WE,du({global:!0,dontCallGetSet:!0,forced:!0},{Request:WA})}}var os,HB={URLSearchParams:KR,getState:Kt},WB=Wr.URLSearchParams,i0=gt,KB=ot,YB=ve,zB=x,KA=cd,qB=Ci,XB=tt,JB=za,QB=Ec,bf=Object.assign,r0=Object.defineProperty,ZB=KB([].concat),$B=!bf||zB(function(){if(i0&&bf({b:1},bf(r0({},"a",{enumerable:!0,get:function(){r0(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),bf({},t)[n]!=7||KA(bf({},e)).join("")!=i})?function(t,e){for(var n=JB(t),i=arguments.length,r=1,s=qB.f,c=XB.f;i>r;)for(var l,d=QB(arguments[r++]),h=s?ZB(KA(d),s(d)):KA(d),p=h.length,m=0;p>m;)l=h[m++],i0&&!YB(c,d,l)||(n[l]=d[l]);return n}:bf,tF=yi,eF=Bl,nF=br,iF=ve,rF=za,aF=function(t,e,n,i){try{return i?e(tF(n)[0],n[1]):e(n)}catch(r){eF(t,"throw",r)}},sF=Ao,oF=zl,cF=Is,a0=Pa,lF=hd,uF=Vl,s0=Array,Xd=ot,YA=2147483647,dF=/[^\0-\u007E]/,o0=/[.\u3002\uFF0E\uFF61]/g,c0="Overflow: input needs wider integers to process",l0=RangeError,hF=Xd(o0.exec),If=Math.floor,zA=String.fromCharCode,u0=Xd("".charCodeAt),d0=Xd([].join),hu=Xd([].push),pF=Xd("".replace),fF=Xd("".split),mF=Xd("".toLowerCase),h0=function(t){return t+22+75*(t<26)},_F=function(t,e,n){var i=0;for(t=n?If(t/700):t>>1,t+=If(t/e);t>455;)t=If(t/35),i+=36;return If(i+36*t/(t+38))},EF=function(t){var e=[];t=function(N){for(var D=[],V=0,W=N.length;V<W;){var K=u0(N,V++);if(K>=55296&&K<=56319&&V<W){var j=u0(N,V++);(64512&j)==56320?hu(D,((1023&K)<<10)+(1023&j)+65536):(hu(D,K),V--)}else hu(D,K)}return D}(t);var n,i,r=t.length,s=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&hu(e,zA(i));var d=e.length,h=d;for(d&&hu(e,"-");h<r;){var p=YA;for(n=0;n<t.length;n++)(i=t[n])>=s&&i<p&&(p=i);var m=h+1;if(p-s>If((YA-c)/m))throw l0(c0);for(c+=(p-s)*m,s=p,n=0;n<t.length;n++){if((i=t[n])<s&&++c>YA)throw l0(c0);if(i==s){for(var _=c,g=36;;){var I=g<=l?1:g>=l+26?26:g-l;if(_<I)break;var y=_-I,C=36-I;hu(e,zA(h0(I+y%C))),_=If(y/C),g+=36}hu(e,zA(h0(_))),l=_F(c,m,h==d),c=0,h++}}c++,s++}return d0(e,"")},gF=Ne,qA=gt,SF=lu,XA=it,p0=br,cs=ot,YR=bo,ls=Kl,TF=Hp,JA=fi,QA=$B,Of=function(t){var e=rF(t),n=oF(this),i=arguments.length,r=i>1?arguments[1]:void 0,s=r!==void 0;s&&(r=nF(r,i>2?arguments[2]:void 0));var c,l,d,h,p,m,_=uF(e),g=0;if(!_||this===s0&&sF(_))for(c=cF(e),l=n?new this(c):s0(c);c>g;g++)m=s?r(e[g],g):e[g],a0(l,g,m);else for(p=(h=lF(e,_)).next,l=n?new this:[];!(d=iF(p,h)).done;g++)m=s?aF(h,r,[d.value,g],!0):d.value,a0(l,g,m);return l.length=g,l},qs=Rf,RF=Wo.codeAt,vF=function(t){var e,n,i=[],r=fF(pF(mF(t),o0,"."),".");for(e=0;e<r.length;e++)n=r[e],hu(i,hF(dF,n)?"xn--"+EF(n):n);return d0(i,".")},Yc=pr,yF=Za,CF=ql,f0=HB,m0=ba,AF=m0.set,zR=m0.getterFor("URL"),bF=f0.URLSearchParams,IF=f0.getState,KE=XA.URL,ZA=XA.TypeError,qR=XA.parseInt,OF=Math.floor,_0=Math.pow,us=cs("".charAt),Xs=cs(/./.exec),YE=cs([].join),wF=cs(1 .toString),NF=cs([].pop),wf=cs([].push),$A=cs("".replace),DF=cs([].shift),LF=cs("".split),zE=cs("".slice),XR=cs("".toLowerCase),PF=cs([].unshift),tb="Invalid scheme",Jd="Invalid host",E0="Invalid port",g0=/[a-z]/i,kF=/[\d+-.a-z]/i,eb=/\d/,MF=/^0x/i,UF=/^[0-7]+$/,xF=/^\d+$/,S0=/^[\da-f]+$/i,VF=/[\0\t\n\r #%/:<>?@[\\\]^|]/,BF=/[\0\t\n\r #/:<>?@[\\\]^|]/,FF=/^[\u0000-\u0020]+/,jF=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,GF=/[\t\n\r]/g,qE=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)PF(e,t%256),t=OF(t/256);return YE(e,".")}if(typeof t=="object"){for(e="",i=function(s){for(var c=null,l=1,d=null,h=0,p=0;p<8;p++)s[p]!==0?(h>l&&(c=d,l=h),d=null,h=0):(d===null&&(d=p),++h);return h>l&&(c=d,l=h),c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=wF(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},JR={},T0=QA({},JR,{" ":1,'"':1,"<":1,">":1,"`":1}),R0=QA({},T0,{"#":1,"?":1,"{":1,"}":1}),nb=QA({},R0,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),pu=function(t,e){var n=RF(t,0);return n>32&&n<127&&!JA(e,t)?t:encodeURIComponent(t)},QR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},XE=function(t,e){var n;return t.length==2&&Xs(g0,us(t,0))&&((n=us(t,1))==":"||!e&&n=="|")},v0=function(t){var e;return t.length>1&&XE(zE(t,0,2))&&(t.length==2||(e=us(t,2))==="/"||e==="\\"||e==="?"||e==="#")},HF=function(t){return t==="."||XR(t)==="%2e"},ib={},y0={},rb={},C0={},A0={},ab={},b0={},I0={},ZR={},$R={},sb={},ob={},cb={},lb={},O0={},ub={},Nf={},qo={},w0={},Qd={},zc={},db=function(t,e,n){var i,r,s,c=Yc(t);if(e){if(r=this.parse(c))throw ZA(r);this.searchParams=null}else{if(n!==void 0&&(i=new db(n,!0)),r=this.parse(c,null,i))throw ZA(r);(s=IF(new bF)).bindURL(this),this.searchParams=s}};db.prototype={type:"URL",parse:function(t,e,n){var i,r,s,c,l,d=this,h=e||ib,p=0,m="",_=!1,g=!1,I=!1;for(t=Yc(t),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,t=$A(t,FF,""),t=$A(t,jF,"$1")),t=$A(t,GF,""),i=Of(t);p<=i.length;){switch(r=i[p],h){case ib:if(!r||!Xs(g0,r)){if(e)return tb;h=rb;continue}m+=XR(r),h=y0;break;case y0:if(r&&(Xs(kF,r)||r=="+"||r=="-"||r=="."))m+=XR(r);else{if(r!=":"){if(e)return tb;m="",h=rb,p=0;continue}if(e&&(d.isSpecial()!=JA(QR,m)||m=="file"&&(d.includesCredentials()||d.port!==null)||d.scheme=="file"&&!d.host))return;if(d.scheme=m,e)return void(d.isSpecial()&&QR[d.scheme]==d.port&&(d.port=null));m="",d.scheme=="file"?h=lb:d.isSpecial()&&n&&n.scheme==d.scheme?h=C0:d.isSpecial()?h=I0:i[p+1]=="/"?(h=A0,p++):(d.cannotBeABaseURL=!0,wf(d.path,""),h=w0)}break;case rb:if(!n||n.cannotBeABaseURL&&r!="#")return tb;if(n.cannotBeABaseURL&&r=="#"){d.scheme=n.scheme,d.path=qs(n.path),d.query=n.query,d.fragment="",d.cannotBeABaseURL=!0,h=zc;break}h=n.scheme=="file"?lb:ab;continue;case C0:if(r!="/"||i[p+1]!="/"){h=ab;continue}h=ZR,p++;break;case A0:if(r=="/"){h=$R;break}h=qo;continue;case ab:if(d.scheme=n.scheme,r==os)d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.query=n.query;else if(r=="/"||r=="\\"&&d.isSpecial())h=b0;else if(r=="?")d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.query="",h=Qd;else{if(r!="#"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.path.length--,h=qo;continue}d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.query=n.query,d.fragment="",h=zc}break;case b0:if(!d.isSpecial()||r!="/"&&r!="\\"){if(r!="/"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,h=qo;continue}h=$R}else h=ZR;break;case I0:if(h=ZR,r!="/"||us(m,p+1)!="/")continue;p++;break;case ZR:if(r!="/"&&r!="\\"){h=$R;continue}break;case $R:if(r=="@"){_&&(m="%40"+m),_=!0,s=Of(m);for(var y=0;y<s.length;y++){var C=s[y];if(C!=":"||I){var N=pu(C,nb);I?d.password+=N:d.username+=N}else I=!0}m=""}else if(r==os||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()){if(_&&m=="")return"Invalid authority";p-=Of(m).length+1,m="",h=sb}else m+=r;break;case sb:case ob:if(e&&d.scheme=="file"){h=ub;continue}if(r!=":"||g){if(r==os||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()){if(d.isSpecial()&&m=="")return Jd;if(e&&m==""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(m))return c;if(m="",h=Nf,e)return;continue}r=="["?g=!0:r=="]"&&(g=!1),m+=r}else{if(m=="")return Jd;if(c=d.parseHost(m))return c;if(m="",h=cb,e==ob)return}break;case cb:if(!Xs(eb,r)){if(r==os||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()||e){if(m!=""){var D=qR(m,10);if(D>65535)return E0;d.port=d.isSpecial()&&D===QR[d.scheme]?null:D,m=""}if(e)return;h=Nf;continue}return E0}m+=r;break;case lb:if(d.scheme="file",r=="/"||r=="\\")h=O0;else{if(!n||n.scheme!="file"){h=qo;continue}if(r==os)d.host=n.host,d.path=qs(n.path),d.query=n.query;else if(r=="?")d.host=n.host,d.path=qs(n.path),d.query="",h=Qd;else{if(r!="#"){v0(YE(qs(i,p),""))||(d.host=n.host,d.path=qs(n.path),d.shortenPath()),h=qo;continue}d.host=n.host,d.path=qs(n.path),d.query=n.query,d.fragment="",h=zc}}break;case O0:if(r=="/"||r=="\\"){h=ub;break}n&&n.scheme=="file"&&!v0(YE(qs(i,p),""))&&(XE(n.path[0],!0)?wf(d.path,n.path[0]):d.host=n.host),h=qo;continue;case ub:if(r==os||r=="/"||r=="\\"||r=="?"||r=="#"){if(!e&&XE(m))h=qo;else if(m==""){if(d.host="",e)return;h=Nf}else{if(c=d.parseHost(m))return c;if(d.host=="localhost"&&(d.host=""),e)return;m="",h=Nf}continue}m+=r;break;case Nf:if(d.isSpecial()){if(h=qo,r!="/"&&r!="\\")continue}else if(e||r!="?")if(e||r!="#"){if(r!=os&&(h=qo,r!="/"))continue}else d.fragment="",h=zc;else d.query="",h=Qd;break;case qo:if(r==os||r=="/"||r=="\\"&&d.isSpecial()||!e&&(r=="?"||r=="#")){if((l=XR(l=m))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),r=="/"||r=="\\"&&d.isSpecial()||wf(d.path,"")):HF(m)?r=="/"||r=="\\"&&d.isSpecial()||wf(d.path,""):(d.scheme=="file"&&!d.path.length&&XE(m)&&(d.host&&(d.host=""),m=us(m,0)+":"),wf(d.path,m)),m="",d.scheme=="file"&&(r==os||r=="?"||r=="#"))for(;d.path.length>1&&d.path[0]==="";)DF(d.path);r=="?"?(d.query="",h=Qd):r=="#"&&(d.fragment="",h=zc)}else m+=pu(r,R0);break;case w0:r=="?"?(d.query="",h=Qd):r=="#"?(d.fragment="",h=zc):r!=os&&(d.path[0]+=pu(r,JR));break;case Qd:e||r!="#"?r!=os&&(r=="'"&&d.isSpecial()?d.query+="%27":d.query+=r=="#"?"%23":pu(r,JR)):(d.fragment="",h=zc);break;case zc:r!=os&&(d.fragment+=pu(r,T0))}p++}},parseHost:function(t){var e,n,i;if(us(t,0)=="["){if(us(t,t.length-1)!="]"||(e=function(r){var s,c,l,d,h,p,m,_=[0,0,0,0,0,0,0,0],g=0,I=null,y=0,C=function(){return us(r,y)};if(C()==":"){if(us(r,1)!=":")return;y+=2,I=++g}for(;C();){if(g==8)return;if(C()!=":"){for(s=c=0;c<4&&Xs(S0,C());)s=16*s+qR(C(),16),y++,c++;if(C()=="."){if(c==0||(y-=c,g>6))return;for(l=0;C();){if(d=null,l>0){if(!(C()=="."&&l<4))return;y++}if(!Xs(eb,C()))return;for(;Xs(eb,C());){if(h=qR(C(),10),d===null)d=h;else{if(d==0)return;d=10*d+h}if(d>255)return;y++}_[g]=256*_[g]+d,++l!=2&&l!=4||g++}if(l!=4)return;break}if(C()==":"){if(y++,!C())return}else if(C())return;_[g++]=s}else{if(I!==null)return;y++,I=++g}}if(I!==null)for(p=g-I,g=7;g!=0&&p>0;)m=_[g],_[g--]=_[I+p-1],_[I+--p]=m;else if(g!=8)return;return _}(zE(t,1,-1)),!e))return Jd;this.host=e}else if(this.isSpecial()){if(t=vF(t),Xs(VF,t)||(e=function(r){var s,c,l,d,h,p,m,_=LF(r,".");if(_.length&&_[_.length-1]==""&&_.length--,(s=_.length)>4)return r;for(c=[],l=0;l<s;l++){if((d=_[l])=="")return r;if(h=10,d.length>1&&us(d,0)=="0"&&(h=Xs(MF,d)?16:8,d=zE(d,h==8?1:2)),d==="")p=0;else{if(!Xs(h==10?xF:h==8?UF:S0,d))return r;p=qR(d,h)}wf(c,p)}for(l=0;l<s;l++)if(p=c[l],l==s-1){if(p>=_0(256,5-s))return null}else if(p>255)return null;for(m=NF(c),l=0;l<c.length;l++)m+=c[l]*_0(256,3-l);return m}(t),e===null))return Jd;this.host=e}else{if(Xs(BF,t))return Jd;for(e="",n=Of(t),i=0;i<n.length;i++)e+=pu(n[i],JR);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return JA(QR,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&XE(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,s=t.port,c=t.path,l=t.query,d=t.fragment,h=e+":";return r!==null?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=qE(r),s!==null&&(h+=":"+s)):e=="file"&&(h+="//"),h+=t.cannotBeABaseURL?c[0]:c.length?"/"+YE(c,"/"):"",l!==null&&(h+="?"+l),d!==null&&(h+="#"+d),h},setHref:function(t){var e=this.parse(t);if(e)throw ZA(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new Df(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+qE(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Yc(t)+":",ib)},getUsername:function(){return this.username},setUsername:function(t){var e=Of(Yc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=pu(e[n],nb)}},getPassword:function(){return this.password},setPassword:function(t){var e=Of(Yc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=pu(e[n],nb)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?qE(t):qE(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,sb)},getHostname:function(){var t=this.host;return t===null?"":qE(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,ob)},getPort:function(){var t=this.port;return t===null?"":Yc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Yc(t))==""?this.port=null:this.parse(t,cb))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+YE(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Nf))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Yc(t))==""?this.query=null:(us(t,0)=="?"&&(t=zE(t,1)),this.query="",this.parse(t,Qd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Yc(t))!=""?(us(t,0)=="#"&&(t=zE(t,1)),this.fragment="",this.parse(t,zc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Df=function(t){var e=TF(this,Qr),n=CF(arguments.length,1)>1?arguments[1]:void 0,i=AF(e,new db(t,!1,n));qA||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Qr=Df.prototype,ds=function(t,e){return{get:function(){return zR(this)[t]()},set:e&&function(n){return zR(this)[e](n)},configurable:!0,enumerable:!0}};if(qA&&(ls(Qr,"href",ds("serialize","setHref")),ls(Qr,"origin",ds("getOrigin")),ls(Qr,"protocol",ds("getProtocol","setProtocol")),ls(Qr,"username",ds("getUsername","setUsername")),ls(Qr,"password",ds("getPassword","setPassword")),ls(Qr,"host",ds("getHost","setHost")),ls(Qr,"hostname",ds("getHostname","setHostname")),ls(Qr,"port",ds("getPort","setPort")),ls(Qr,"pathname",ds("getPathname","setPathname")),ls(Qr,"search",ds("getSearch","setSearch")),ls(Qr,"searchParams",ds("getSearchParams")),ls(Qr,"hash",ds("getHash","setHash"))),YR(Qr,"toJSON",function(){return zR(this).serialize()},{enumerable:!0}),YR(Qr,"toString",function(){return zR(this).serialize()},{enumerable:!0}),KE){var N0=KE.createObjectURL,D0=KE.revokeObjectURL;N0&&YR(Df,"createObjectURL",p0(N0,KE)),D0&&YR(Df,"revokeObjectURL",p0(D0,KE))}yF(Df,"URL"),gF({global:!0,forced:!SF,sham:!qA},{URL:Df});var WF=Ne,KF=x,YF=ql,L0=pr,zF=lu,P0=Mn("URL");WF({target:"URL",stat:!0,forced:!(zF&&KF(function(){P0.canParse()}))},{canParse:function(t){var e=YF(arguments.length,1),n=L0(t),i=e<2||arguments[1]===void 0?void 0:L0(arguments[1]);try{return!!new P0(n,i)}catch{return!1}}});var tv=P(Wr.URL);let k0=!0,M0=!0;function ev(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function Zd(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const d=h=>{const p=n(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),r.apply(this,[c,d])};const s=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function qF(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(k0=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function XF(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(M0=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function U0(){if(typeof window=="object"){if(k0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function hb(t,e){M0&&console.warn(t+" is deprecated, please use "+e+" instead.")}function x0(t){return Object.prototype.toString.call(t)==="[object Object]"}function V0(t){var e;return x0(t)?nr(e=Object.keys(t)).call(e,function(n,i){const r=x0(t[i]),s=r?V0(t[i]):t[i],c=r&&!Object.keys(s).length;return s===void 0||c?n:Object.assign(n,{[i]:s})},{}):t}function pb(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?pb(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{pb(t,t.get(r),n)})}))}function B0(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&pb(t,l,r)})}),r}const F0=U0;function j0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const h=typeof c[d]=="object"?c[d]:{ideal:c[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(m,_){return m?m+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(h.ideal!==void 0){l.optional=l.optional||[];let m={};typeof h.ideal=="number"?(m[p("min",d)]=h.ideal,l.optional.push(m),m={},m[p("max",d)]=h.ideal,l.optional.push(m)):(m[p("",d)]=h.ideal,l.optional.push(m))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",d)]=h.exact):["min","max"].forEach(m=>{h[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(m,d)]=h[m])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const d=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const h=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(m=>{let _=(m=m.filter(g=>g.kind==="videoinput")).find(g=>p.some(I=>{var y;return _t(y=g.label.toLowerCase()).call(y,I)}));return!_&&m.length&&_t(p).call(p,"back")&&(_=m[m.length-1]),_&&(c.video.deviceId=d.exact?{exact:_.deviceId}:{ideal:_.deviceId}),c.video=i(c.video),F0("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return F0("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,d){r(c,h=>{n.webkitGetUserMedia(h,l,p=>{d&&d(s(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>Tt.reject(s(h))))}}}function G0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function H0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Zd(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function W0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{const c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function K0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const s=function(l){const d={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(m=>{p[m]=h.stat(m)}),d[p.id]=p}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){const l=function(d){i(c(s(d)))};return e.apply(this,[l,n])}return new Tt((l,d)=>{e.apply(this,[function(h){l(c(s(h)))},d])}).then(i,r)}}function Y0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>B0(s,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Zd(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>B0(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,s;return this.getSenders().forEach(c=>{c.track===n&&(i?s=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?s=!0:r=c),c.track===n)),s||i&&r?Tt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():Tt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function z0(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function q0(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return z0(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;function s(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const _=d._reverseStreams[m],g=d._streams[_.id];p=p.replace(new RegExp(g.id,"g"),_.id)}),new RTCSessionDescription({type:h.type,sdp:p})}t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[h.id];if(_)_.addTrack(d),Tt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([d]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===d)},["createOffer","createAnswer"].forEach(function(d){const h=t.RTCPeerConnection.prototype[d],p={[d](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[_=>{const g=s(this,_);m[0].apply(null,[g])},_=>{m[1]&&m[1].apply(null,_)},arguments[2]]):h.apply(this,arguments).then(_=>s(this,_))}};t.RTCPeerConnection.prototype[d]=p[d]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const _=d._reverseStreams[m],g=d._streams[_.id];p=p.replace(new RegExp(_.id,"g"),g.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=l.get.apply(this);return d.type===""?d:s(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>d.track===m)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function fb(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function X0(t,e){Zd(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var J0=Object.freeze({__proto__:null,fixNegotiationNeeded:X0,shimAddTrackRemoveTrack:q0,shimAddTrackRemoveTrackWithNative:z0,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,s=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),s&&(n.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:W0,shimGetStats:K0,shimGetUserMedia:j0,shimMediaStream:G0,shimOnTrack:H0,shimPeerConnection:fb,shimSenderReceiverGetStats:Y0});function Q0(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,c){hb("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function Z0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mb(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,s,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!s)try{l.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(s,c)}}function $0(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Tt.resolve(new Map)}}function tN(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Zd(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function eN(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){hb("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&_t(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function nN(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function iN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:s}=r,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function rN(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function aN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Tt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function sN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Tt.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var oN=Object.freeze({__proto__:null,shimAddTransceiver:iN,shimCreateAnswer:sN,shimCreateOffer:aN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Tt.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:rN,shimGetUserMedia:Q0,shimOnTrack:Z0,shimPeerConnection:mb,shimRTCDataChannel:nN,shimReceiverGetStats:tN,shimRemoveStream:eN,shimSenderGetStats:$0});function cN(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),_t(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r&&r.forEach(c=>{var l;this._localStreams?_t(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{_t(i).call(i,r.track)&&this.removeTrack(r)})})}}function lN(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),_t(s=this._remoteStreams).call(s,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,n.dispatchEvent(s)})}),e.apply(n,arguments)}}}function uN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[p]);return h?(m.then(d,h),Tt.resolve()):m},e.createAnswer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[p]);return h?(m.then(d,h),Tt.resolve()):m};let l=function(d,h,p){const m=r.apply(this,[d]);return p?(m.then(h,p),Tt.resolve()):m};e.setLocalDescription=l,l=function(d,h,p){const m=s.apply(this,[d]);return p?(m.then(h,p),Tt.resolve()):m},e.setRemoteDescription=l,l=function(d,h,p){const m=c.apply(this,[d]);return p?(m.then(h,p),Tt.resolve()):m},e.addIceCandidate=l}function dN(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(hN(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function hN(t){return t&&t.video!==void 0?Object.assign({},t,{video:V0(t.video)}):t}function pN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let s=0;s<n.iceServers.length;s++){let c=n.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(hb("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[s])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function fN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function mN(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function _N(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var EN=Object.freeze({__proto__:null,shimAudioContext:_N,shimCallbacksAPI:uN,shimConstraints:hN,shimCreateOfferLegacy:mN,shimGetUserMedia:dN,shimLocalStreamsAPI:cN,shimRTCIceServerUrls:pN,shimRemoteStreamsAPI:lN,shimTrackEventTransceiver:fN}),gN=`	
\v\f\r                　\u2028\u2029\uFEFF`,JF=fl,QF=pr,_b=gN,SN=ot("".replace),ZF=RegExp("^["+_b+"]+"),$F=RegExp("(^|[^"+_b+"])["+_b+"]+$"),tj=function(t){return function(e){var n=QF(JF(e));return 1&t&&(n=SN(n,ZF,"")),2&t&&(n=SN(n,$F,"$1")),n}},ej={trim:tj(3)},nj=X_.PROPER,ij=x,TN=gN,rj=ej.trim;Ne({target:"String",proto:!0,forced:function(t){return ij(function(){return!!TN[t]()||"​᠎"[t]()!=="​᠎"||nj&&TN[t].name!==t})}("trim")},{trim:function(){return rj(this)}});var aj=hr("String").trim,sj=mt,oj=aj,Eb=String.prototype,cj=function(t){var e=t.trim;return typeof t=="string"||t===Eb||sj(Eb,t)&&e===Eb.trim?oj:e},Ji=P(cj),RN={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)r=s[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?s.push(c+"="+n.parameters[c]):s.push(c)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],d=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(d){const h=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=p.length?e.parseFmtp(p[0]):{},h.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let s=0;return i.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(_=>e.parseSsrcMedia(_)).filter(_=>_.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(_=>_.substring(17).split(" ").map(g=>parseInt(g,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(h=p[0][1]),r.codecs.forEach(_=>{if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){let g={ssrc:d,codecPayloadType:parseInt(_.parameters.apt,10)};d&&h&&(g.rtx={ssrc:h}),i.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},i.push(g))}}),i.length===0&&d&&i.push({ssrc:d});let m=e.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,i.forEach(_=>{_.maxBitrate=m})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(i=s[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const c=i!==void 0?i:2;return s=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(RN);var vN=RN.exports,Lf=P(vN),lj=w({__proto__:null,default:Lf},[vN]);function nv(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=Lf.parseCandidate(n.candidate),s=Object.assign(i,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Zd(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function gb(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Zd(t,"icecandidate",e=>{if(e.candidate){const n=Lf.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function iv(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const d=Lf.splitSections(l.sdp);return d.shift(),d.some(h=>{const p=Lf.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!=h?-1:h},r=function(l){let d=65536;return e.browser==="firefox"&&(d=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d},s=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=Lf.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),d=r(l),h=s(arguments[0],l);let p;p=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>p}),this._sctp=m}return c.apply(this,arguments)}}function rv(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Zd(t,"datachannel",i=>(e(i.channel,i.target),i))}function Sb(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",r);s.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Tb(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(s=>Ji(s).call(s)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function av(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Tt.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Tt.resolve())})}function sv(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var uj=Object.freeze({__proto__:null,removeExtmapAllowMixed:Tb,shimAddIceCandidateNullOrEmpty:av,shimConnectionState:Sb,shimMaxMessageSize:iv,shimParameterlessSetLocalDescription:sv,shimRTCIceCandidate:nv,shimRTCIceCandidateRelayProtocol:gb,shimSendThrowTypeError:rv});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=U0,i=function(s){const c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;const{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=ev(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=ev(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=ev(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:uj,extractVersion:ev,disableLog:qF,disableWarnings:XF,sdp:lj};switch(i.browser){case"chrome":if(!J0||!fb||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=J0,av(t,i),sv(t),j0(t,i),G0(t),fb(t,i),H0(t),q0(t,i),W0(t),K0(t),Y0(t),X0(t,i),nv(t),gb(t),Sb(t),iv(t,i),rv(t),Tb(t,i);break;case"firefox":if(!oN||!mb||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=oN,av(t,i),sv(t),Q0(t,i),mb(t,i),Z0(t),eN(t),$0(t),tN(t),nN(t),iN(t),rN(t),aN(t),sN(t),nv(t),Sb(t),iv(t,i),rv(t);break;case"safari":if(!EN||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=EN,av(t,i),sv(t),pN(t),mN(t),uN(t),cN(t),lN(t),fN(t),dN(t),_N(t),nv(t),gb(t),iv(t,i),rv(t),Tb(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var yN=fo,dj=TypeError,CN=ur.match(/firefox\/(\d+)/i),hj=!!CN&&+CN[1],pj=/MSIE|Trident/.test(ur),AN=ur.match(/AppleWebKit\/(\d+)\./),fj=!!AN&&+AN[1],mj=Ne,bN=ot,_j=On,Ej=za,IN=Is,gj=function(t,e){if(!delete t[e])throw dj("Cannot delete property "+yN(e)+" of "+yN(t))},ON=pr,Rb=x,Sj=WR,Tj=fr,wN=hj,Rj=pj,NN=Kr,DN=fj,fu=[],LN=bN(fu.sort),vj=bN(fu.push),yj=Rb(function(){fu.sort(void 0)}),Cj=Rb(function(){fu.sort(null)}),Aj=Tj("sort"),PN=!Rb(function(){if(NN)return NN<70;if(!(wN&&wN>3)){if(Rj)return!0;if(DN)return DN<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)fu.push({k:e+i,v:n})}for(fu.sort(function(s,c){return c.v-s.v}),i=0;i<fu.length;i++)e=fu[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});mj({target:"Array",proto:!0,forced:yj||!Cj||!Aj||!PN},{sort:function(t){t!==void 0&&_j(t);var e=Ej(this);if(PN)return t===void 0?LN(e):LN(e,t);var n,i,r=[],s=IN(e);for(i=0;i<s;i++)i in e&&vj(r,e[i]);for(Sj(r,function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:ON(l)>ON(d)?1:-1}}(t)),n=IN(r),i=0;i<n;)e[i]=r[i++];for(;i<s;)gj(e,i++);return e}});var bj=hr("Array").sort,Ij=mt,Oj=bj,vb=Array.prototype,wj=function(t){var e=t.sort;return t===vb||Ij(vb,t)&&e===vb.sort?Oj:e},JE=P(wj),yb=it;Ne({global:!0,forced:yb.globalThis!==yb},{globalThis:yb});var kN=P(it),Cb={exports:{}};(function(t,e){(function(n,i){var r="function",s="undefined",c="object",l="string",d="major",h="model",p="name",m="type",_="vendor",g="version",I="architecture",y="console",C="mobile",N="tablet",D="smarttv",V="wearable",W="embedded",K="Amazon",j="Apple",Q="ASUS",ct="BlackBerry",vt="Browser",At="Chrome",ue="Firefox",de="Google",qe="Huawei",Pn="LG",yn="Microsoft",vr="Motorola",nt="Opera",ft="Samsung",Pt="Sharp",at="Sony",v="Xiaomi",U="Zebra",F="Facebook",dt="Chromium OS",Qt="Mac OS",Be=function(Yn){for(var si={},sn=0;sn<Yn.length;sn++)si[Yn[sn].toUpperCase()]=Yn[sn];return si},ai=function(Yn,si){return typeof Yn===l&&Br(si).indexOf(Br(Yn))!==-1},Br=function(Yn){return Yn.toLowerCase()},ul=function(Yn,si){if(typeof Yn===l)return Yn=Yn.replace(/^\s\s*/,""),typeof si===s?Yn:Yn.substring(0,350)},wh=function(Yn,si){for(var sn,ta,pc,kn,be,Fr,Uu=0;Uu<si.length&&!be;){var lo=si[Uu],oV=si[Uu+1];for(sn=ta=0;sn<lo.length&&!be&&lo[sn];)if(be=lo[sn++].exec(Yn))for(pc=0;pc<oV.length;pc++)Fr=be[++ta],typeof(kn=oV[pc])===c&&kn.length>0?kn.length===2?typeof kn[1]==r?this[kn[0]]=kn[1].call(this,Fr):this[kn[0]]=kn[1]:kn.length===3?typeof kn[1]!==r||kn[1].exec&&kn[1].test?this[kn[0]]=Fr?Fr.replace(kn[1],kn[2]):i:this[kn[0]]=Fr?kn[1].call(this,Fr,kn[2]):i:kn.length===4&&(this[kn[0]]=Fr?kn[3].call(this,Fr.replace(kn[1],kn[2])):i):this[kn]=Fr||i;Uu+=2}},$g=function(Yn,si){for(var sn in si)if(typeof si[sn]===c&&si[sn].length>0){for(var ta=0;ta<si[sn].length;ta++)if(ai(si[sn][ta],Yn))return sn==="?"?i:sn}else if(ai(si[sn],Yn))return sn==="?"?i:sn;return Yn},iC={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},rC={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,nt+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[p,nt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+vt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[g,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+vt],g],[/\bfocus\/([\w\.]+)/i],[g,[p,ue+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,nt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,nt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI "+vt]],[/fxios\/([-\w\.]+)/i],[g,[p,ue]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+vt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+vt],g],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,F],g],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,At+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,At+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+vt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,$g,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,ue+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,g],[/(cobalt)\/([\w\.]+)/i],[p,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,Br]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",Br]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,Br]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[_,ft],[m,N]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[_,ft],[m,C]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[_,j],[m,C]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[_,j],[m,N]],[/(macintosh);/i],[h,[_,j]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[_,Pt],[m,C]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[_,qe],[m,N]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[_,qe],[m,C]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[_,v],[m,C]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[_,v],[m,N]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[_,"OPPO"],[m,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[_,"Vivo"],[m,C]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[_,"Realme"],[m,C]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[_,vr],[m,C]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[_,vr],[m,N]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[_,Pn],[m,N]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[_,Pn],[m,C]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[_,"Lenovo"],[m,N]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[_,"Nokia"],[m,C]],[/(pixel c)\b/i],[h,[_,de],[m,N]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[_,de],[m,C]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[_,at],[m,C]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[_,at],[m,N]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[_,"OnePlus"],[m,C]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[_,K],[m,N]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[_,K],[m,C]],[/(playbook);[-\w\),; ]+(rim)/i],[h,_,[m,N]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[_,ct],[m,C]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[_,Q],[m,N]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[_,Q],[m,C]],[/(nexus 9)/i],[h,[_,"HTC"],[m,N]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[h,/_/g," "],[m,C]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[_,"Acer"],[m,N]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[_,"Meizu"],[m,C]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,h,[m,C]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,h,[m,N]],[/(surface duo)/i],[h,[_,yn],[m,N]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[_,"Fairphone"],[m,C]],[/(u304aa)/i],[h,[_,"AT&T"],[m,C]],[/\bsie-(\w*)/i],[h,[_,"Siemens"],[m,C]],[/\b(rct\w+) b/i],[h,[_,"RCA"],[m,N]],[/\b(venue[\d ]{2,7}) b/i],[h,[_,"Dell"],[m,N]],[/\b(q(?:mv|ta)\w+) b/i],[h,[_,"Verizon"],[m,N]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[_,"Barnes & Noble"],[m,N]],[/\b(tm\d{3}\w+) b/i],[h,[_,"NuVision"],[m,N]],[/\b(k88) b/i],[h,[_,"ZTE"],[m,N]],[/\b(nx\d{3}j) b/i],[h,[_,"ZTE"],[m,C]],[/\b(gen\d{3}) b.+49h/i],[h,[_,"Swiss"],[m,C]],[/\b(zur\d{3}) b/i],[h,[_,"Swiss"],[m,N]],[/\b((zeki)?tb.*\b) b/i],[h,[_,"Zeki"],[m,N]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],h,[m,N]],[/\b(ns-?\w{0,9}) b/i],[h,[_,"Insignia"],[m,N]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[_,"NextBook"],[m,N]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],h,[m,C]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],h,[m,C]],[/\b(ph-1) /i],[h,[_,"Essential"],[m,C]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[_,"Envizen"],[m,N]],[/\b(trio[-\w\. ]+) b/i],[h,[_,"MachSpeed"],[m,N]],[/\btu_(1491) b/i],[h,[_,"Rotor"],[m,N]],[/(shield[\w ]+) b/i],[h,[_,"Nvidia"],[m,N]],[/(sprint) (\w+)/i],[_,h,[m,C]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[_,yn],[m,C]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[_,U],[m,N]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[_,U],[m,C]],[/smart-tv.+(samsung)/i],[_,[m,D]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[_,ft],[m,D]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,Pn],[m,D]],[/(apple) ?tv/i],[_,[h,j+" TV"],[m,D]],[/crkey/i],[[h,At+"cast"],[_,de],[m,D]],[/droid.+aft(\w)( bui|\))/i],[h,[_,K],[m,D]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[_,Pt],[m,D]],[/(bravia[\w ]+)( bui|\))/i],[h,[_,at],[m,D]],[/(mitv-\w{5}) bui/i],[h,[_,v],[m,D]],[/Hbbtv.*(technisat) (.*);/i],[_,h,[m,D]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,ul],[h,ul],[m,D]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,D]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,h,[m,y]],[/droid.+; (shield) bui/i],[h,[_,"Nvidia"],[m,y]],[/(playstation [345portablevi]+)/i],[h,[_,at],[m,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[_,yn],[m,y]],[/((pebble))app/i],[_,h,[m,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[_,j],[m,V]],[/droid.+; (glass) \d/i],[h,[_,de],[m,V]],[/droid.+; (wt63?0{2,3})\)/i],[h,[_,U],[m,V]],[/(quest( 2| pro)?)/i],[h,[_,F],[m,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[m,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[m,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[m,N]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,N]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,C]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[g,$g,iC]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[g,$g,iC]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Qt],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,g],[/\(bb(10);/i],[g,[p,ct]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,ue+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[p,At+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,dt],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,g]]},Wa=function(Yn,si){if(typeof Yn===c&&(si=Yn,Yn=i),!(this instanceof Wa))return new Wa(Yn,si).getResult();var sn=typeof n!==s&&n.navigator?n.navigator:i,ta=Yn||(sn&&sn.userAgent?sn.userAgent:""),pc=sn&&sn.userAgentData?sn.userAgentData:i,kn=si?function(be,Fr){var Uu={};for(var lo in be)Fr[lo]&&Fr[lo].length%2==0?Uu[lo]=Fr[lo].concat(be[lo]):Uu[lo]=be[lo];return Uu}(rC,si):rC;return this.getBrowser=function(){var be={};return be[p]=i,be[g]=i,wh.call(be,ta,kn.browser),be[d]=function(Fr){return typeof Fr===l?Fr.replace(/[^\d\.]/g,"").split(".")[0]:i}(be[g]),sn&&sn.brave&&typeof sn.brave.isBrave==r&&(be[p]="Brave"),be},this.getCPU=function(){var be={};return be[I]=i,wh.call(be,ta,kn.cpu),be},this.getDevice=function(){var be={};return be[_]=i,be[h]=i,be[m]=i,wh.call(be,ta,kn.device),!be[m]&&pc&&pc.mobile&&(be[m]=C),be[h]=="Macintosh"&&sn&&typeof sn.standalone!==s&&sn.maxTouchPoints&&sn.maxTouchPoints>2&&(be[h]="iPad",be[m]=N),be},this.getEngine=function(){var be={};return be[p]=i,be[g]=i,wh.call(be,ta,kn.engine),be},this.getOS=function(){var be={};return be[p]=i,be[g]=i,wh.call(be,ta,kn.os),!be[p]&&pc&&pc.platform!="Unknown"&&(be[p]=pc.platform.replace(/chrome os/i,dt).replace(/macos/i,Qt)),be},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ta},this.setUA=function(be){return ta=typeof be===l&&be.length>350?ul(be,350):be,this},this.setUA(ta),this};Wa.VERSION="0.7.34",Wa.BROWSER=Be([p,g,d]),Wa.CPU=Be([I]),Wa.DEVICE=Be([h,_,m,y,C,D,N,V,W]),Wa.ENGINE=Wa.OS=Be([p,g]),t.exports&&(e=t.exports=Wa),e.UAParser=Wa;var Mu=typeof n!==s&&(n.jQuery||n.Zepto);if(Mu&&!Mu.ua){var Nh=new Wa;Mu.ua=Nh.getResult(),Mu.ua.get=function(){return Nh.getUA()},Mu.ua.set=function(Yn){Nh.setUA(Yn);var si=Nh.getResult();for(var sn in si)Mu.ua[sn]=si[sn]}}})(typeof window=="object"?window:b)})(Cb,Cb.exports);var Nj=P(Cb.exports),Dj=Ra,Lj=fi,Pj=ho,kj=rn,Mj=dn("iterator"),Uj=Object,xj=function(t){if(Pj(t))return!1;var e=Uj(t);return e[Mj]!==void 0||"@@iterator"in e||Lj(kj,Dj(e))},Vj=P(xj),MN=Ue.clear;Ne({global:!0,bind:!0,forced:it.clearImmediate!==MN},{clearImmediate:MN});var Bj=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",UN=it,Fj=Bt,jj=Qe,Gj=Bj,Hj=ur,Wj=bd,Kj=ql,Yj=UN.Function,zj=/MSIE .\./.test(Hj)||Gj&&function(){var t=UN.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),qj=Ne,xN=it,VN=Ue.set,Xj=function(t,e){var n=1;return zj?function(i,r){var s=Kj(arguments.length,1)>n,c=jj(i)?i:Yj(i),l=s?Wj(arguments,n):[],d=s?function(){Fj(c,this,l)}:c;return t(d)}:t},BN=xN.setImmediate?Xj(VN):VN;qj({global:!0,bind:!0,forced:xN.setImmediate!==BN},{setImmediate:BN});var FN=P(Wr.setImmediate),Jj=Ne,Qj=mE,Zj=On,$j=ql,t3=ya,e3=it.process;Jj({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){$j(arguments.length,1),Zj(t);var e=t3&&e3.domain;Qj(e?e.bind(t):t)}});var jN=P(Wr.queueMicrotask);function GN(t,e){return function(){return t.apply(e,arguments)}}const{toString:n3}=Object.prototype,{getPrototypeOf:Ab}=Object,ov=(bb=Object.create(null),t=>{const e=n3.call(t);return bb[e]||(bb[e]=e.slice(8,-1).toLowerCase())});var bb;const Js=t=>(t=t.toLowerCase(),e=>ov(e)===t),cv=t=>e=>typeof e===t,{isArray:Pf}=Array,QE=cv("undefined"),HN=Js("ArrayBuffer"),i3=cv("string"),ka=cv("function"),WN=cv("number"),lv=t=>t!==null&&typeof t=="object",uv=t=>{if(ov(t)!=="object")return!1;const e=Ab(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||Vj(t))},r3=Js("Date"),a3=Js("File"),s3=Js("Blob"),o3=Js("FileList"),c3=Js("URLSearchParams"),[l3,u3,d3,h3]=["ReadableStream","Request","Response","Headers"].map(Js);function ZE(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Pf(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const s=r?Object.getOwnPropertyNames(t):Object.keys(t),c=s.length;let l;for(n=0;n<c;n++)l=s[n],e.call(null,t[l],l,t)}}function KN(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const $d=kN!==void 0?kN:typeof self<"u"?self:typeof window<"u"?window:mw,YN=t=>!QE(t)&&t!==$d,p3=(Ib=typeof Uint8Array<"u"&&Ab(Uint8Array),t=>Ib&&t instanceof Ib);var Ib;const f3=Js("HTMLFormElement"),zN=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),m3=Js("RegExp"),qN=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};ZE(n,(r,s)=>{let c;(c=e(r,s,t))!==!1&&(i[s]=c||r)}),Object.defineProperties(t,i)},Ob="abcdefghijklmnopqrstuvwxyz",XN="0123456789",JN={DIGIT:XN,ALPHA:Ob,ALPHA_DIGIT:Ob+Ob.toUpperCase()+XN},_3=Js("AsyncFunction"),QN=(ZN=typeof FN=="function",$N=ka($d.postMessage),ZN?FN:$N?(wb="axios@".concat(Math.random()),dv=[],$d.addEventListener("message",t=>{let{source:e,data:n}=t;e===$d&&n===wb&&dv.length&&dv.shift()()},!1),t=>{dv.push(t),$d.postMessage(wb,"*")}):t=>setTimeout(t));var ZN,$N,wb,dv;const E3=jN!==void 0?jN.bind($d):typeof process<"u"&&process.nextTick||QN;var Rt={isArray:Pf,isArrayBuffer:HN,isBuffer:function(t){return t!==null&&!QE(t)&&t.constructor!==null&&!QE(t.constructor)&&ka(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ka(t.append)&&((e=ov(t))==="formdata"||e==="object"&&ka(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&HN(t.buffer),e},isString:i3,isNumber:WN,isBoolean:t=>t===!0||t===!1,isObject:lv,isPlainObject:uv,isReadableStream:l3,isRequest:u3,isResponse:d3,isHeaders:h3,isUndefined:QE,isDate:r3,isFile:a3,isBlob:s3,isRegExp:m3,isFunction:ka,isStream:t=>lv(t)&&ka(t.pipe),isURLSearchParams:c3,isTypedArray:p3,isFileList:o3,forEach:ZE,merge:function t(){const{caseless:e}=YN(this)&&this||{},n={},i=(r,s)=>{const c=e&&KN(n,s)||s;uv(n[c])&&uv(r)?n[c]=t(n[c],r):uv(r)?n[c]=t({},r):Pf(r)?n[c]=r.slice():n[c]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&ZE(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return ZE(e,(r,s)=>{n&&ka(r)?t[s]=GN(r,n):t[s]=r},{allOwnKeys:i}),t},trim:t=>Ji(t)?Ji(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,s,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)c=r[s],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&Ab(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:ov,kindOfTest:Js,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(Pf(t))return t;let e=t.length;if(!WN(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:f3,hasOwnProperty:zN,hasOwnProp:zN,reduceDescriptors:qN,freezeMethods:t=>{qN(t,(e,n)=>{if(ka(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];ka(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(s=>{n[s]=!0})};return Pf(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:KN,global:$d,isContextDefined:YN,ALPHABET:JN,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:JN.ALPHA_DIGIT,n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&ka(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(lv(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=Pf(i)?[]:{};return ZE(i,(c,l)=>{const d=n(c,r+1);!QE(d)&&(s[l]=d)}),e[r]=void 0,s}}return i};return n(t,0)},isAsyncFn:_3,isThenable:t=>t&&(lv(t)||ka(t))&&ka(t.then)&&ka(t.catch),setImmediate:QN,asap:E3};function xe(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}Rt.inherits(xe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Rt.toJSONObject(this.config),code:this.code,status:this.status}}});const tD=xe.prototype,eD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{eD[t]={value:t}}),Object.defineProperties(xe,eD),Object.defineProperty(tD,"isAxiosError",{value:!0}),xe.from=(t,e,n,i,r,s)=>{const c=Object.create(tD);return Rt.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),xe.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,s&&Object.assign(c,s),c};function Nb(t){return Rt.isPlainObject(t)||Rt.isArray(t)}function nD(t){return Rt.endsWith(t,"[]")?t.slice(0,-2):t}function iD(t,e,n){return t?t.concat(e).map(function(i,r){return i=nD(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const g3=Rt.toFlatObject(Rt,{},null,function(t){return/^is[A-Z]/.test(t)});function hv(t,e,n){if(!Rt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=Rt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,g){return!Rt.isUndefined(g[_])})).metaTokens,r=n.visitor||h,s=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&Rt.isSpecCompliantForm(e);if(!Rt.isFunction(r))throw new TypeError("visitor must be a function");function d(_){if(_===null)return"";if(Rt.isDate(_))return _.toISOString();if(!l&&Rt.isBlob(_))throw new xe("Blob is not supported. Use a Buffer instead.");return Rt.isArrayBuffer(_)||Rt.isTypedArray(_)?l&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function h(_,g,I){let y=_;if(_&&!I&&typeof _=="object"){if(Rt.endsWith(g,"{}"))g=i?g:g.slice(0,-2),_=JSON.stringify(_);else if(Rt.isArray(_)&&function(C){return Rt.isArray(C)&&!C.some(Nb)}(_)||(Rt.isFileList(_)||Rt.endsWith(g,"[]"))&&(y=Rt.toArray(_)))return g=nD(g),y.forEach(function(C,N){!Rt.isUndefined(C)&&C!==null&&e.append(c===!0?iD([g],N,s):c===null?g:g+"[]",d(C))}),!1}return!!Nb(_)||(e.append(iD(I,g,s),d(_)),!1)}const p=[],m=Object.assign(g3,{defaultVisitor:h,convertValue:d,isVisitable:Nb});if(!Rt.isObject(t))throw new TypeError("data must be an object");return function _(g,I){if(!Rt.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+I.join("."));p.push(g),Rt.forEach(g,function(y,C){(!(Rt.isUndefined(y)||y===null)&&r.call(e,y,Rt.isString(C)?Ji(C).call(C):C,I,m))===!0&&_(y,I?I.concat(C):[C])}),p.pop()}}(t),e}function rD(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Db(t,e){this._pairs=[],t&&hv(t,this,e)}const aD=Db.prototype;function S3(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function sD(t,e,n){if(!e)return t;const i=n&&n.encode||S3;Rt.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let s;if(s=r?r(e,n):Rt.isURLSearchParams(e)?e.toString():new Db(e,n).toString(i),s){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}aD.append=function(t,e){this._pairs.push([t,e])},aD.toString=function(t){const e=t?function(n){return t.call(this,n,rD)}:rD;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var oD=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Rt.forEach(this.handlers,function(e){e!==null&&t(e)})}},cD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lD={exports:{}},T3=Ne,R3=gt,uD=dr.f;T3({target:"Object",stat:!0,forced:Object.defineProperty!==uD,sham:!R3},{defineProperty:uD});var dD=Wr.Object,v3=lD.exports=function(t,e,n){return dD.defineProperty(t,e,n)};dD.defineProperty.sham&&(v3.sham=!0);var hD=P(lD.exports),y3=TypeError,pD=Yi,C3=zl,A3=Wi,b3=dn("species"),fD=Array,I3=function(t){var e;return pD(t)&&(e=t.constructor,(C3(e)&&(e===fD||pD(e.prototype))||A3(e)&&(e=e[b3])===null)&&(e=void 0)),e===void 0?fD:e},mD=function(t,e){return new(I3(t))(e===0?0:e)},O3=x,w3=Kr,N3=dn("species"),_D=function(t){return w3>=51||!O3(function(){var e=[];return(e.constructor={})[N3]=function(){return{foo:1}},e[t](Boolean).foo!==1})},D3=Ne,L3=x,P3=Yi,k3=Wi,M3=za,U3=Is,ED=function(t){if(t>9007199254740991)throw y3("Maximum allowed index exceeded");return t},gD=Pa,x3=mD,V3=_D,B3=Kr,SD=dn("isConcatSpreadable"),F3=B3>=51||!L3(function(){var t=[];return t[SD]=!1,t.concat()[0]!==t}),j3=function(t){if(!k3(t))return!1;var e=t[SD];return e!==void 0?!!e:P3(t)};D3({target:"Array",proto:!0,forced:!F3||!V3("concat")},{concat:function(t){var e,n,i,r,s,c=M3(this),l=x3(c,0),d=0;for(e=-1,i=arguments.length;e<i;e++)if(j3(s=e===-1?c:arguments[e]))for(r=U3(s),ED(d+r),n=0;n<r;n++,d++)n in s&&gD(l,d,s[n]);else ED(d+1),gD(l,d++,s);return l.length=d,l}});var TD={},G3=Le,H3=po,RD=To.f,W3=Rf,vD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];TD.f=function(t){return vD&&G3(t)=="Window"?function(e){try{return RD(e)}catch{return W3(vD)}}(t):RD(H3(t))};var kf={},K3=dn;kf.f=K3;var yD=Wr,Y3=fi,z3=kf,q3=dr.f,bi=function(t){var e=yD.Symbol||(yD.Symbol={});Y3(e,t)||q3(e,t,{value:z3.f(t)})},X3=ve,J3=Mn,Q3=dn,Z3=bo,CD=function(){var t=J3("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=Q3("toPrimitive");e&&!e[i]&&Z3(e,i,function(r){return X3(n,this)},{})},$3=br,tG=Ec,eG=za,nG=Is,iG=mD,AD=ot([].push),rG=function(t){var e=t==1,n=t==2,i=t==3,r=t==4,s=t==6,c=t==7,l=t==5||s;return function(d,h,p,m){for(var _,g,I=eG(d),y=tG(I),C=$3(h,p),N=nG(y),D=0,V=m||iG,W=e?V(d,N):n||c?V(d,0):void 0;N>D;D++)if((l||D in y)&&(g=C(_=y[D],D,I),t))if(e)W[D]=g;else if(g)switch(t){case 3:return!0;case 5:return _;case 6:return D;case 2:AD(W,_)}else switch(t){case 4:return!1;case 7:AD(W,_)}return s?-1:i||r?r:W}},bD={forEach:rG(0)},pv=Ne,Lb=it,Pb=ve,aG=ot,Mf=gt,Uf=gc,sG=x,ir=fi,oG=mt,kb=yi,fv=po,Mb=Yu,cG=pr,Ub=fe,$E=Us,ID=cd,lG=To,OD=TD,uG=Ci,wD=In,ND=dr,dG=vo,DD=tt,LD=bo,hG=Kl,xb=Rc,PD=Dl,kD=Bh,pG=dn,fG=kf,mG=bi,_G=CD,EG=Za,MD=ba,mv=bD.forEach,oa=qa("hidden"),_v="Symbol",tg="prototype",gG=MD.set,UD=MD.getterFor(_v),Qs=Object[tg],th=Lb.Symbol,Ev=th&&th[tg],SG=Lb.TypeError,Vb=Lb.QObject,xD=wD.f,eh=ND.f,VD=OD.f,TG=DD.f,BD=aG([].push),qc=xb("symbols"),eg=xb("op-symbols"),RG=xb("wks"),Bb=!Vb||!Vb[tg]||!Vb[tg].findChild,Fb=Mf&&sG(function(){return $E(eh({},"a",{get:function(){return eh(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var i=xD(Qs,e);i&&delete Qs[e],eh(t,e,n),i&&t!==Qs&&eh(Qs,e,i)}:eh,jb=function(t,e){var n=qc[t]=$E(Ev);return gG(n,{type:_v,tag:t,description:e}),Mf||(n.description=e),n},gv=function(t,e,n){t===Qs&&gv(eg,e,n),kb(t);var i=Mb(e);return kb(n),ir(qc,i)?(n.enumerable?(ir(t,oa)&&t[oa][i]&&(t[oa][i]=!1),n=$E(n,{enumerable:Ub(0,!1)})):(ir(t,oa)||eh(t,oa,Ub(1,{})),t[oa][i]=!0),Fb(t,i,n)):eh(t,i,n)},Gb=function(t,e){kb(t);var n=fv(e),i=ID(n).concat(HD(n));return mv(i,function(r){Mf&&!Pb(FD,n,r)||gv(t,r,n[r])}),t},FD=function(t){var e=Mb(t),n=Pb(TG,this,e);return!(this===Qs&&ir(qc,e)&&!ir(eg,e))&&(!(n||!ir(this,e)||!ir(qc,e)||ir(this,oa)&&this[oa][e])||n)},jD=function(t,e){var n=fv(t),i=Mb(e);if(n!==Qs||!ir(qc,i)||ir(eg,i)){var r=xD(n,i);return!r||!ir(qc,i)||ir(n,oa)&&n[oa][i]||(r.enumerable=!0),r}},GD=function(t){var e=VD(fv(t)),n=[];return mv(e,function(i){ir(qc,i)||ir(PD,i)||BD(n,i)}),n},HD=function(t){var e=t===Qs,n=VD(e?eg:fv(t)),i=[];return mv(n,function(r){!ir(qc,r)||e&&!ir(Qs,r)||BD(i,qc[r])}),i};Uf||(th=function(){if(oG(Ev,this))throw SG("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?cG(arguments[0]):void 0,e=kD(t),n=function(i){this===Qs&&Pb(n,eg,i),ir(this,oa)&&ir(this[oa],e)&&(this[oa][e]=!1),Fb(this,e,Ub(1,i))};return Mf&&Bb&&Fb(Qs,e,{configurable:!0,set:n}),jb(e,t)},LD(Ev=th[tg],"toString",function(){return UD(this).tag}),LD(th,"withoutSetter",function(t){return jb(kD(t),t)}),DD.f=FD,ND.f=gv,dG.f=Gb,wD.f=jD,lG.f=OD.f=GD,uG.f=HD,fG.f=function(t){return jb(pG(t),t)},Mf&&hG(Ev,"description",{configurable:!0,get:function(){return UD(this).description}})),pv({global:!0,wrap:!0,forced:!Uf,sham:!Uf},{Symbol:th}),mv(ID(RG),function(t){mG(t)}),pv({target:_v,stat:!0,forced:!Uf},{useSetter:function(){Bb=!0},useSimple:function(){Bb=!1}}),pv({target:"Object",stat:!0,forced:!Uf,sham:!Mf},{create:function(t,e){return e===void 0?$E(t):Gb($E(t),e)},defineProperty:gv,defineProperties:Gb,getOwnPropertyDescriptor:jD}),pv({target:"Object",stat:!0,forced:!Uf},{getOwnPropertyNames:GD}),_G(),EG(th,_v),PD[oa]=!0;var WD=gc&&!!Symbol.for&&!!Symbol.keyFor,vG=Ne,yG=Mn,CG=fi,AG=pr,KD=Rc,bG=WD,Hb=KD("string-to-symbol-registry"),IG=KD("symbol-to-string-registry");vG({target:"Symbol",stat:!0,forced:!bG},{for:function(t){var e=AG(t);if(CG(Hb,e))return Hb[e];var n=yG("Symbol")(e);return Hb[e]=n,IG[n]=e,n}});var OG=Ne,wG=fi,NG=_l,DG=fo,LG=WD,YD=Rc("symbol-to-string-registry");OG({target:"Symbol",stat:!0,forced:!LG},{keyFor:function(t){if(!NG(t))throw TypeError(DG(t)+" is not a symbol");if(wG(YD,t))return YD[t]}});var zD=Yi,PG=Qe,qD=Le,kG=pr,XD=ot([].push),MG=Ne,JD=Mn,QD=Bt,UG=ve,ng=ot,ZD=x,$D=Qe,tL=_l,eL=bd,xG=function(t){if(PG(t))return t;if(zD(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?XD(n,r):typeof r!="number"&&qD(r)!="Number"&&qD(r)!="String"||XD(n,kG(r))}var s=n.length,c=!0;return function(l,d){if(c)return c=!1,d;if(zD(this))return d;for(var h=0;h<s;h++)if(n[h]===l)return d}}},VG=gc,BG=String,mu=JD("JSON","stringify"),Sv=ng(/./.exec),nL=ng("".charAt),FG=ng("".charCodeAt),jG=ng("".replace),GG=ng(1 .toString),HG=/[\uD800-\uDFFF]/g,iL=/^[\uD800-\uDBFF]$/,rL=/^[\uDC00-\uDFFF]$/,aL=!VG||ZD(function(){var t=JD("Symbol")();return mu([t])!="[null]"||mu({a:t})!="{}"||mu(Object(t))!="{}"}),sL=ZD(function(){return mu("\uDF06\uD834")!=='"\\udf06\\ud834"'||mu("\uDEAD")!=='"\\udead"'}),WG=function(t,e){var n=eL(arguments),i=xG(e);if($D(i)||t!==void 0&&!tL(t))return n[1]=function(r,s){if($D(i)&&(s=UG(i,this,BG(r),s)),!tL(s))return s},QD(mu,null,n)},KG=function(t,e,n){var i=nL(n,e-1),r=nL(n,e+1);return Sv(iL,t)&&!Sv(rL,r)||Sv(rL,t)&&!Sv(iL,i)?"\\u"+GG(FG(t,0),16):t};mu&&MG({target:"JSON",stat:!0,forced:aL||sL},{stringify:function(t,e,n){var i=eL(arguments),r=QD(aL?WG:mu,null,i);return sL&&typeof r=="string"?jG(r,HG,KG):r}});var oL=Ci,YG=za;Ne({target:"Object",stat:!0,forced:!gc||x(function(){oL.f(1)})},{getOwnPropertySymbols:function(t){var e=oL.f;return e?e(YG(t)):[]}}),bi("asyncIterator"),bi("hasInstance"),bi("isConcatSpreadable"),bi("iterator"),bi("match"),bi("matchAll"),bi("replace"),bi("search"),bi("species"),bi("split");var zG=CD;bi("toPrimitive"),zG();var qG=Mn,XG=Za;bi("toStringTag"),XG(qG("Symbol"),"Symbol"),bi("unscopables"),Za(it.JSON,"JSON",!0);var JG=Wr.Symbol,QG=dn,ZG=dr.f,cL=QG("metadata"),lL=Function.prototype;lL[cL]===void 0&&ZG(lL,cL,{value:null}),bi("dispose"),bi("metadata");var $G=JG;bi("asyncDispose");var t4=ot,Wb=Mn("Symbol"),e4=Wb.keyFor,n4=t4(Wb.prototype.valueOf),uL=Wb.isRegisteredSymbol||function(t){try{return e4(n4(t))!==void 0}catch{return!1}};Ne({target:"Symbol",stat:!0},{isRegisteredSymbol:uL});for(var i4=Rc,dL=Mn,r4=ot,a4=_l,s4=dn,Tv=dL("Symbol"),hL=Tv.isWellKnownSymbol,pL=dL("Object","getOwnPropertyNames"),o4=r4(Tv.prototype.valueOf),fL=i4("wks"),Kb=0,mL=pL(Tv),c4=mL.length;Kb<c4;Kb++)try{var _L=mL[Kb];a4(Tv[_L])&&s4(_L)}catch{}var EL=function(t){if(hL&&hL(t))return!0;try{for(var e=o4(t),n=0,i=pL(fL),r=i.length;n<r;n++)if(fL[i[n]]==e)return!0}catch{}return!1};Ne({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:EL}),bi("matcher"),bi("observable"),Ne({target:"Symbol",stat:!0},{isRegistered:uL}),Ne({target:"Symbol",stat:!0,forced:!0},{isWellKnown:EL}),bi("metadataKey"),bi("patternMatch"),bi("replaceAll");var xf=P($G),gL=P(kf.f("iterator"));function ig(t){return ig=typeof xf=="function"&&typeof gL=="symbol"?function(e){return typeof e}:function(e){return e&&typeof xf=="function"&&e.constructor===xf&&e!==xf.prototype?"symbol":typeof e},ig(t)}var l4=P(kf.f("toPrimitive"));function u4(t){var e=function(n,i){if(ig(n)!=="object"||n===null)return n;var r=n[l4];if(r!==void 0){var s=r.call(n,i);if(ig(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return ig(e)==="symbol"?e:String(e)}function O(t,e,n){return(e=u4(e))in t?hD(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var SL=P(WB),d4={isBrowser:!0,classes:{URLSearchParams:SL!==void 0?SL:Db,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Yb=typeof window<"u"&&typeof document<"u",zb=typeof navigator=="object"&&navigator||void 0,h4=Yb&&(!zb||["ReactNative","NativeScript","NS"].indexOf(zb.product)<0),p4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",f4=Yb&&window.location.href||"http://localhost";function TL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function RL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TL(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var kr=RL(RL({},Object.freeze({__proto__:null,hasBrowserEnv:Yb,hasStandardBrowserEnv:h4,hasStandardBrowserWebWorkerEnv:p4,navigator:zb,origin:f4})),d4),m4=yi,_4=ve,E4=fi,g4=mt,S4=function(){var t=m4(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},vL=RegExp.prototype,yL=function(t){var e=t.flags;return e!==void 0||"flags"in vL||E4(t,"flags")||!g4(vL,t)?e:_4(S4,t)},T4=Wo.charAt,CL=ve,R4=yi,v4=Qe,y4=Le,C4=/./.exec,A4=TypeError,b4=Ne,AL=ve,bL=oi,I4=Mp,Rv=Vp,IL=fl,OL=a_,rg=pr,O4=yi,w4=ho,N4=Le,D4=l_,wL=yL,L4=gl,P4=x,k4=Oa,M4=function(t,e,n){return e+(n?T4(t,e).length:1)},U4=function(t,e){var n=t.exec;if(v4(n)){var i=CL(n,t,e);return i!==null&&R4(i),i}if(y4(t)==="RegExp")return CL(C4,t,e);throw A4("RegExp#exec called on incompatible receiver")},NL=ba,x4=dn("matchAll"),DL="RegExp String",LL=DL+" Iterator",V4=NL.set,B4=NL.getterFor(LL),F4=TypeError,qb=bL("".indexOf),vv=bL("".matchAll),Xb=!!vv&&!P4(function(){vv("a",/./)}),j4=I4(function(t,e,n,i){V4(this,{type:LL,regexp:t,string:e,global:n,unicode:i,done:!1})},DL,function(){var t=B4(this);if(t.done)return Rv(void 0,!0);var e=t.regexp,n=t.string,i=U4(e,n);return i===null?(t.done=!0,Rv(void 0,!0)):t.global?(rg(i[0])===""&&(e.lastIndex=M4(n,OL(e.lastIndex),t.unicode)),Rv(i,!1)):(t.done=!0,Rv(i,!1))}),PL=function(t){var e,n,i,r=O4(this),s=rg(t),c=k4(r,RegExp),l=rg(wL(r));return e=new c(c===RegExp?r.source:r,l),n=!!~qb(l,"g"),i=!!~qb(l,"u"),e.lastIndex=OL(r.lastIndex),new j4(e,s,n,i)};b4({target:"String",proto:!0,forced:Xb},{matchAll:function(t){var e,n,i,r,s=IL(this);if(w4(t)){if(Xb)return vv(s,t)}else{if(D4(t)&&(e=rg(IL(wL(t))),!~qb(e,"g")))throw F4("`.matchAll` does not allow non-global regexes");if(Xb)return vv(s,t);if((i=L4(t,x4))===void 0&&N4(t)=="RegExp"&&(i=PL),i)return AL(i,t,s)}return n=rg(s),r=new RegExp(t,"g"),AL(PL,r,n)}});var G4=hr("String").matchAll,H4=mt,W4=G4,Jb=String.prototype,K4=function(t){var e=t.matchAll;return typeof t=="string"||t===Jb||H4(Jb,t)&&e===Jb.matchAll?W4:e},Y4=P(K4);function kL(t){function e(n,i,r,s){let c=n[s++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),d=s>=n.length;return c=!c&&Rt.isArray(r)?r.length:c,d?(Rt.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&Rt.isObject(r[c])||(r[c]=[]),e(n,i,r[c],s)&&Rt.isArray(r[c])&&(r[c]=function(h){const p={},m=Object.keys(h);let _;const g=m.length;let I;for(_=0;_<g;_++)I=m[_],p[I]=h[I];return p}(r[c])),!l)}if(Rt.isFormData(t)&&Rt.isFunction(t.entries)){const n={};return Rt.forEachEntry(t,(i,r)=>{e(function(s){return Y4(Rt).call(Rt,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const Qb={transitional:cD,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=Rt.isObject(t);if(r&&Rt.isHTMLForm(t)&&(t=new FormData(t)),Rt.isFormData(t))return i?JSON.stringify(kL(t)):t;if(Rt.isArrayBuffer(t)||Rt.isBuffer(t)||Rt.isStream(t)||Rt.isFile(t)||Rt.isBlob(t)||Rt.isReadableStream(t))return t;if(Rt.isArrayBufferView(t))return t.buffer;if(Rt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return hv(c,new kr.classes.URLSearchParams,Object.assign({visitor:function(d,h,p,m){return kr.isNode&&Rt.isBuffer(d)?(this.append(h,d.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((s=Rt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return hv(s?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,d){if(Rt.isString(c))try{return(l||JSON.parse)(c),Ji(Rt).call(Rt,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||Qb.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(Rt.isResponse(t)||Rt.isReadableStream(t))return t;if(t&&Rt.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(s){if(r)throw s.name==="SyntaxError"?xe.from(s,xe.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kr.classes.FormData,Blob:kr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Rt.forEach(["delete","get","head","post","put","patch"],t=>{Qb.headers[t]={}});var Zb=Qb;const z4=Rt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ML=Symbol("internals");function ag(t){var e;return t&&Ji(e=String(t)).call(e).toLowerCase()}function yv(t){return t===!1||t==null?t:Rt.isArray(t)?t.map(yv):String(t)}function $b(t,e,n,i,r){return Rt.isFunction(i)?i.call(this,e,n):(r&&(e=n),Rt.isString(e)?Rt.isString(i)?e.indexOf(i)!==-1:Rt.isRegExp(i)?i.test(e):void 0:void 0)}class Cv{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function s(d,h,p){const m=ag(h);if(!m)throw new Error("header name must be a non-empty string");const _=Rt.findKey(r,m);(!_||r[_]===void 0||p===!0||p===void 0&&r[_]!==!1)&&(r[_||h]=yv(d))}const c=(d,h)=>Rt.forEach(d,(p,m)=>s(p,m,h));if(Rt.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(Rt.isString(e)&&(e=Ji(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ji(l=e).call(l)))c((d=>{const h={};let p,m,_;return d&&d.split(`
`).forEach(function(g){var I,y;_=g.indexOf(":"),p=Ji(I=g.substring(0,_)).call(I).toLowerCase(),m=Ji(y=g.substring(_+1)).call(y),!p||h[p]&&z4[p]||(p==="set-cookie"?h[p]?h[p].push(m):h[p]=[m]:h[p]=h[p]?h[p]+", "+m:m)}),h})(e),n);else if(Rt.isHeaders(e))for(const[d,h]of e.entries())s(h,d,i);else e!=null&&s(n,e,i);var l;return this}get(e,n){if(e=ag(e)){const i=Rt.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(s){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=l.exec(s);)c[d[1]]=d[2];return c}(r);if(Rt.isFunction(n))return n.call(this,r,i);if(Rt.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=ag(e)){const i=Rt.findKey(this,e);return!(!i||this[i]===void 0||n&&!$b(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function s(c){if(c=ag(c)){const l=Rt.findKey(i,c);!l||n&&!$b(0,i[l],l,n)||(delete i[l],r=!0)}}return Rt.isArray(e)?e.forEach(s):s(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const s=n[i];e&&!$b(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const n=this,i={};return Rt.forEach(this,(r,s)=>{var c;const l=Rt.findKey(i,s);if(l)return n[l]=yv(r),void delete n[s];const d=e?function(h){return Ji(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,m,_)=>m.toUpperCase()+_)}(s):Ji(c=String(s)).call(c);d!==s&&delete n[s],n[d]=yv(r),i[d]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return Rt.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&Rt.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[ML]=this[ML]={accessors:{}}).accessors,i=this.prototype;function r(s){const c=ag(s);n[c]||(function(l,d){const h=Rt.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(m,_,g){return this[p].call(this,d,m,_,g)},configurable:!0})})}(i,s),n[c]=!0)}return Rt.isArray(e)?e.forEach(r):r(e),this}}Cv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Rt.reduceDescriptors(Cv.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),Rt.freezeMethods(Cv);var Zs=Cv;function tI(t,e){const n=this||Zb,i=e||n,r=Zs.from(i.headers);let s=i.data;return Rt.forEach(t,function(c){s=c.call(n,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function UL(t){return!(!t||!t.__CANCEL__)}function Vf(t,e,n){xe.call(this,t??"canceled",xe.ERR_CANCELED,e,n),this.name="CanceledError"}function xL(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new xe("Request failed with status code "+n.status,[xe.ERR_BAD_REQUEST,xe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}Rt.inherits(Vf,xe,{__CANCEL__:!0});const Av=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(s,c){s=s||10;const l=new Array(s),d=new Array(s);let h,p=0,m=0;return c=c!==void 0?c:1e3,function(_){const g=Date.now(),I=d[m];h||(h=g),l[p]=_,d[p]=g;let y=m,C=0;for(;y!==p;)C+=l[y++],y%=s;if(p=(p+1)%s,p===m&&(m=(m+1)%s),g-h<c)return;const N=I&&g-I;return N?Math.round(1e3*C/N):void 0}}(50,250);return function(s,c){let l,d,h=0,p=1e3/c;const m=function(_){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),s.apply(null,_)};return[function(){const _=Date.now(),g=_-h;for(var I=arguments.length,y=new Array(I),C=0;C<I;C++)y[C]=arguments[C];g>=p?m(y,_):(l=y,d||(d=setTimeout(()=>{d=null,m(l)},p-g)))},()=>l&&m(l)]}(s=>{const c=s.loaded,l=s.lengthComputable?s.total:void 0,d=c-i,h=r(d);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},VL=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},BL=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Rt.asap(()=>t(...n))};var q4=kr.hasStandardBrowserEnv?((t,e)=>n=>(n=new tv(n,kr.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new tv(kr.origin),kr.navigator&&/(msie|trident)/i.test(kr.navigator.userAgent)):()=>!0,X4=kr.hasStandardBrowserEnv?{write(t,e,n,i,r,s){const c=[t+"="+encodeURIComponent(e)];Rt.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Rt.isString(i)&&c.push("path="+i),Rt.isString(r)&&c.push("domain="+r),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function FL(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(t,e):e}function jL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const GL=t=>t instanceof Zs?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?jL(Object(i),!0).forEach(function(r){O(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function nh(t,e){e=e||{};const n={};function i(h,p,m,_){return Rt.isPlainObject(h)&&Rt.isPlainObject(p)?Rt.merge.call({caseless:_},h,p):Rt.isPlainObject(p)?Rt.merge({},p):Rt.isArray(p)?p.slice():p}function r(h,p,m,_){return Rt.isUndefined(p)?Rt.isUndefined(h)?void 0:i(void 0,h,0,_):i(h,p,0,_)}function s(h,p){if(!Rt.isUndefined(p))return i(void 0,p)}function c(h,p){return Rt.isUndefined(p)?Rt.isUndefined(h)?void 0:i(void 0,h):i(void 0,p)}function l(h,p,m){return m in e?i(h,p):m in t?i(void 0,h):void 0}const d={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,m)=>r(GL(h),GL(p),0,!0)};return Rt.forEach(Object.keys(Object.assign({},t,e)),function(h){const p=d[h]||r,m=p(t[h],e[h],h);Rt.isUndefined(m)&&p!==l||(n[h]=m)}),n}var HL=t=>{const e=nh({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:c,headers:l,auth:d}=e;if(e.headers=l=Zs.from(l),e.url=sD(FL(e.baseURL,e.url),t.params,t.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),Rt.isFormData(i)){if(kr.hasStandardBrowserEnv||kr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[h,...p]=n?n.split(";").map(m=>Ji(m).call(m)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(kr.hasStandardBrowserEnv&&(r&&Rt.isFunction(r)&&(r=r(e)),r||r!==!1&&q4(e.url))){const h=s&&c&&X4.read(c);h&&l.set(s,h)}return e},J4=typeof XMLHttpRequest<"u"&&function(t){return new Tt(function(e,n){const i=HL(t);let r=i.data;const s=Zs.from(i.headers).normalize();let c,l,d,h,p,{responseType:m,onUploadProgress:_,onDownloadProgress:g}=i;function I(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let y=new XMLHttpRequest;function C(){if(!y)return;const D=Zs.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders());xL(function(V){e(V),I()},function(V){n(V),I()},{data:m&&m!=="text"&&m!=="json"?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:D,config:t,request:y}),y=null}y.open(i.method.toUpperCase(),i.url,!0),y.timeout=i.timeout,"onloadend"in y?y.onloadend=C:y.onreadystatechange=function(){y&&y.readyState===4&&(y.status!==0||y.responseURL&&y.responseURL.indexOf("file:")===0)&&setTimeout(C)},y.onabort=function(){y&&(n(new xe("Request aborted",xe.ECONNABORTED,t,y)),y=null)},y.onerror=function(){n(new xe("Network Error",xe.ERR_NETWORK,t,y)),y=null},y.ontimeout=function(){let D=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const V=i.transitional||cD;i.timeoutErrorMessage&&(D=i.timeoutErrorMessage),n(new xe(D,V.clarifyTimeoutError?xe.ETIMEDOUT:xe.ECONNABORTED,t,y)),y=null},r===void 0&&s.setContentType(null),"setRequestHeader"in y&&Rt.forEach(s.toJSON(),function(D,V){y.setRequestHeader(V,D)}),Rt.isUndefined(i.withCredentials)||(y.withCredentials=!!i.withCredentials),m&&m!=="json"&&(y.responseType=i.responseType),g&&([d,p]=Av(g,!0),y.addEventListener("progress",d)),_&&y.upload&&([l,h]=Av(_),y.upload.addEventListener("progress",l),y.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=D=>{y&&(n(!D||D.type?new Vf(null,t,y):D),y.abort(),y=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const N=function(D){const V=/^([-+\w]{1,25})(:?\/\/|:)/.exec(D);return V&&V[1]||""}(i.url);N&&kr.protocols.indexOf(N)===-1?n(new xe("Unsupported protocol "+N+":",xe.ERR_BAD_REQUEST,t)):y.send(r||null)})},Q4=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const s=function(h){if(!i){i=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof xe?p:new Vf(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,s(new xe("timeout ".concat(e," of ms exceeded"),xe.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),t=null)};t.forEach(h=>h.addEventListener("abort",s));const{signal:d}=r;return d.unsubscribe=()=>Rt.asap(l),d}},Z4=cu,$4=rs;Ne({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=$4.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var t5=rs,e5=is;Ne({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=t5.f(this),n=e5(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var eI=P(Z4),WL=kf.f("asyncIterator"),n5=P(WL);function nI(t,e){this.v=t,this.k=e}function sg(t){var e,n;function i(s,c){try{var l=t[s](c),d=l.value,h=d instanceof nI;eI.resolve(h?d.v:d).then(function(p){if(h){var m=s==="return"?"return":"next";if(!d.k||p.done)return i(m,p);p=t[m](p).value}r(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){r("throw",p)}}function r(s,c){switch(s){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(s,c){return new eI(function(l,d){var h={key:s,arg:c,resolve:l,reject:d,next:null};n?n=n.next=h:(e=n=h,i(s,c))})},typeof t.return!="function"&&(this.return=void 0)}function Ma(t){return function(){return new sg(t.apply(this,arguments))}}function Ee(t){return new nI(t,0)}function bv(t){var e={},n=!1;function i(r,s){return n=!0,{done:!1,value:new nI(s=new eI(function(c){c(t[r](s))}),1)}}return e[xf!==void 0&&gL||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}sg.prototype[typeof xf=="function"&&n5||"@@asyncIterator"]=function(){return this},sg.prototype.next=function(t){return this._invoke("next",t)},sg.prototype.throw=function(t){return this._invoke("throw",t)},sg.prototype.return=function(t){return this._invoke("return",t)};var iI=P(WL);function rI(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=iI,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new Iv(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Iv(t){function e(n){if(Object(n)!==n)return Tt.reject(new TypeError(n+" is not an object."));var i=n.done;return Tt.resolve(n.value).then(function(r){return{value:r,done:i}})}return Iv=function(n){this.s=n,this.n=n.next},Iv.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Tt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Tt.reject(n):e(i.apply(this.s,arguments))}},new Iv(t)}const i5=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},r5=function(){var t=Ma(function*(e,n){var i,r=!1,s=!1;try{for(var c,l=rI(a5(e));r=!(c=yield Ee(l.next())).done;r=!1){const d=c.value;yield*bv(rI(i5(d,n)))}}catch(d){s=!0,i=d}finally{try{r&&l.return!=null&&(yield Ee(l.return()))}finally{if(s)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),a5=function(){var t=Ma(function*(e){if(e[iI])return void(yield*bv(rI(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield Ee(n.read());if(i)break;yield r}}finally{yield Ee(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),KL=(t,e,n,i)=>{const r=r5(t,e);let s,c=0,l=d=>{s||(s=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:h,value:p}=await r.next();if(h)return l(),void d.close();let m=p.byteLength;if(n){let _=c+=m;n(_)}d.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:d=>(l(d),r.return())},{highWaterMark:2})};function YL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function zL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YL(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Ov=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",qL=Ov&&typeof ReadableStream=="function",s5=Ov&&(typeof TextEncoder=="function"?(XL=new TextEncoder,t=>XL.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var XL;const JL=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},o5=qL&&JL(()=>{let t=!1;const e=new Request(kr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),aI=qL&&JL(()=>Rt.isReadableStream(new Response("").body)),wv={stream:aI&&(t=>t.body)};var QL;Ov&&(QL=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!wv[t]&&(wv[t]=Rt.isFunction(QL[t])?e=>e[t]():(e,n)=>{throw new xe("Response type '".concat(t,"' is not supported"),xe.ERR_NOT_SUPPORT,n)})}));const c5=async(t,e)=>{const n=Rt.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:Rt.isBlob(i)?i.size:Rt.isSpecCompliantForm(i)?(await new Request(kr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:Rt.isArrayBufferView(i)||Rt.isArrayBuffer(i)?i.byteLength:(Rt.isURLSearchParams(i)&&(i+=""),Rt.isString(i)?(await s5(i)).byteLength:void 0))(e)};var l5=Ov&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:s,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:h,headers:p,withCredentials:m="same-origin",fetchOptions:_}=HL(t);h=h?(h+"").toLowerCase():"text";let g,I=Q4([r,s&&s.toAbortSignal()],c);const y=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let C;try{if(d&&o5&&n!=="get"&&n!=="head"&&(C=await c5(p,i))!==0){let K,j=new Request(e,{method:"POST",body:i,duplex:"half"});if(Rt.isFormData(i)&&(K=j.headers.get("content-type"))&&p.setContentType(K),j.body){const[Q,ct]=VL(C,Av(BL(d)));i=KL(j.body,65536,Q,ct)}}Rt.isString(m)||(m=m?"include":"omit");const N="credentials"in Request.prototype;g=new Request(e,zL(zL({},_),{},{signal:I,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:N?m:void 0}));let D=await fetch(g);const V=aI&&(h==="stream"||h==="response");if(aI&&(l||V&&y)){const K={};["status","statusText","headers"].forEach(vt=>{K[vt]=D[vt]});const j=Rt.toFiniteNumber(D.headers.get("content-length")),[Q,ct]=l&&VL(j,Av(BL(l),!0))||[];D=new Response(KL(D.body,65536,Q,()=>{ct&&ct(),y&&y()}),K)}h=h||"text";let W=await wv[Rt.findKey(wv,h)||"text"](D,t);return!V&&y&&y(),await new Tt((K,j)=>{xL(K,j,{data:W,headers:Zs.from(D.headers),status:D.status,statusText:D.statusText,config:t,request:g})})}catch(N){throw y&&y(),N&&N.name==="TypeError"&&/fetch/i.test(N.message)?Object.assign(new xe("Network Error",xe.ERR_NETWORK,t,g),{cause:N.cause||N}):xe.from(N,N&&N.code,t,g)}});const sI={http:null,xhr:J4,fetch:l5};Rt.forEach(sI,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const ZL=t=>"- ".concat(t),u5=t=>Rt.isFunction(t)||t===null||t===!1;var $L={getAdapter:t=>{t=Rt.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let s=0;s<e;s++){let c;if(n=t[s],i=n,!u5(n)&&(i=sI[(c=String(n)).toLowerCase()],i===void 0))throw new xe("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+s]=i}if(!i){const s=Object.entries(r).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new xe("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(ZL).join(`
`):" "+ZL(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:sI};function oI(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Vf(null,t)}function tP(t){return oI(t),t.headers=Zs.from(t.headers),t.data=tI.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),$L.getAdapter(t.adapter||Zb.adapter)(t).then(function(e){return oI(t),e.data=tI.call(t,t.transformResponse,e),e.headers=Zs.from(e.headers),e},function(e){return UL(e)||(oI(t),e&&e.response&&(e.response.data=tI.call(t,t.transformResponse,e.response),e.response.headers=Zs.from(e.response.headers))),Tt.reject(e)})}const eP="1.7.9",Nv={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Nv[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const nP={};Nv.transitional=function(t,e,n){function i(r,s){return"[Axios v"+eP+"] Transitional option '"+r+"'"+s+(n?". "+n:"")}return(r,s,c)=>{if(t===!1)throw new xe(i(s," has been removed"+(e?" in "+e:"")),xe.ERR_DEPRECATED);return e&&!nP[s]&&(nP[s]=!0,console.warn(i(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,s,c)}},Nv.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var Dv={assertOptions:function(t,e,n){if(typeof t!="object")throw new xe("options must be an object",xe.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const s=i[r],c=e[s];if(c){const l=t[s],d=l===void 0||c(l,s,t);if(d!==!0)throw new xe("option "+s+" must be "+d,xe.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new xe("Unknown option "+s,xe.ERR_BAD_OPTION)}},validators:Nv};const Xo=Dv.validators;let Lv=class{constructor(t){this.defaults=t,this.interceptors={request:new oD,response:new oD}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=nh(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&Dv.assertOptions(n,{silentJSONParsing:Xo.transitional(Xo.boolean),forcedJSONParsing:Xo.transitional(Xo.boolean),clarifyTimeoutError:Xo.transitional(Xo.boolean)},!1),i!=null&&(Rt.isFunction(i)?e.paramsSerializer={serialize:i}:Dv.assertOptions(i,{encode:Xo.function,serialize:Xo.function},!0)),Dv.assertOptions(e,{baseUrl:Xo.spelling("baseURL"),withXsrfToken:Xo.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=r&&Rt.merge(r.common,r[e.method]);r&&Rt.forEach(["delete","get","head","post","put","patch","common"],g=>{delete r[g]}),e.headers=Zs.concat(s,r);const c=[];let l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(l=l&&g.synchronous,c.unshift(g.fulfilled,g.rejected))});const d=[];let h;this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let p,m=0;if(!l){const g=[tP.bind(this),void 0];for(g.unshift.apply(g,c),g.push.apply(g,d),p=g.length,h=Tt.resolve(e);m<p;)h=h.then(g[m++],g[m++]);return h}p=c.length;let _=e;for(m=0;m<p;){const g=c[m++],I=c[m++];try{_=g(_)}catch(y){I.call(this,y);break}}try{h=tP.call(this,_)}catch(g){return Tt.reject(g)}for(m=0,p=d.length;m<p;)h=h.then(d[m++],d[m++]);return h}getUri(t){return sD(FL((t=nh(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};Rt.forEach(["delete","get","head","options"],function(t){Lv.prototype[t]=function(e,n){return this.request(nh(n||{},{method:t,url:e,data:(n||{}).data}))}}),Rt.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,s){return this.request(nh(s||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Lv.prototype[t]=e(),Lv.prototype[t+"Form"]=e(!0)});var Pv=Lv;class cI{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Tt(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const c=new Tt(l=>{i.subscribe(l),s=l}).then(r);return c.cancel=function(){i.unsubscribe(s)},c},e(function(r,s,c){i.reason||(i.reason=new Vf(r,s,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new cI(function(i){e=i}),cancel:e}}}var d5=cI;const lI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lI).forEach(t=>{let[e,n]=t;lI[n]=e});var h5=lI;const Hi=function t(e){const n=new Pv(e),i=GN(Pv.prototype.request,n);return Rt.extend(i,Pv.prototype,n,{allOwnKeys:!0}),Rt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(nh(e,r))},i}(Zb);Hi.Axios=Pv,Hi.CanceledError=Vf,Hi.CancelToken=d5,Hi.isCancel=UL,Hi.VERSION=eP,Hi.toFormData=hv,Hi.AxiosError=xe,Hi.Cancel=Hi.CanceledError,Hi.all=function(t){return Tt.all(t)},Hi.spread=function(t){return function(e){return t.apply(null,e)}},Hi.isAxiosError=function(t){return Rt.isObject(t)&&t.isAxiosError===!0},Hi.mergeConfig=nh,Hi.AxiosHeaders=Zs,Hi.formToJSON=t=>kL(Rt.isHTMLForm(t)?new FormData(t):t),Hi.getAdapter=$L.getAdapter,Hi.HttpStatusCode=h5,Hi.default=Hi;var _r=Hi;const p5=()=>{};function og(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:p5};return t.promise=new Tt((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const kv=new Map,Mv=new Map,Jo=new Map;let ni=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ce=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const iP=new Nj;let $s=iP.getResult(),uI=null;function ge(t){if(!uI){$s=iP.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Ce.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ce.CHROME;case"Safari":case"Mobile Safari":return Ce.SAFARI;case"Edge":return Ce.EDGE;case"Firefox":return Ce.FIREFOX;case"QQ":case"QQBrowser":return Ce.QQ;case"Opera":return Ce.OPERA;case"WeChat":return Ce.WECHAT;default:return l.browser.name||""}}($s),n=rP($s),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}($s),r=$s.os.version,s=rP($s,!1),c=$s.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c};uI={name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c}}return uI}function rP(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function Uv(){return ge().os}function aP(){const t=ge();return"".concat(t.os," ").concat(t.osVersion)}function xv(){const t=ge();return!!($s.engine.name==="WebKit"&&t.os===ni.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ce.SAFARI||rr()&&t.name!==Ce.SAFARI)}function Xc(){return ge().name===Ce.CHROME}function Ii(){return ge().name===Ce.SAFARI}function sP(){return ge().name===Ce.EDGE}function mn(){return ge().name===Ce.FIREFOX}function rr(){return ge().os===ni.IOS}function cg(t){const e=ge();return!(e.name!==Ce.CHROME||!e.osVersion)&&Number(e.version)>=t}function oP(t){const e=ge();return!(e.name!==Ce.CHROME||!e.osVersion)&&Number(e.version)<t}function dI(t,e,n){const i=ge();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function hI(t){const e=ge();return!(e.name!==Ce.EDGE||!e.osVersion)&&Number(e.version)>=t}function cP(t){const e=ge();return!(e.name!==Ce.SAFARI||!e.osVersion)&&Number(e.version)>=t}function lP(t,e,n){const i=ge();if(i.os!==ni.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function uP(t,e,n){const i=ge();if(i.name!==Ce.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function pI(t){const e=ge();return!(e.name!==Ce.OPERA||!e.osVersion)&&Number(e.version)>=t}function dP(){const t=ge();if(t.os!==ni.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Bf(){const t=ge();if(t.os!==ni.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function fI(){const t=ge();if(t.os!==ni.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function hP(){const t=ge();if(t.os!==ni.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function hs(){return Ii()&&navigator.maxTouchPoints>0}function pP(){return ge().name===Ce.WECHAT}function fP(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function mI(){const t=Uv();return function(){const{deviceType:e}=ge();return e==="mobile"||e==="tablet"}()||t===ni.ANDROID||t===ni.IOS||t===ni.HARMONY_OS}function Jc(){const t=ge();return t.name!==Ce.EDGE&&t.name!==Ce.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Vv(){return Uv()===ni.ANDROID}function lg(){const t=ge();return Vv()&&(t.name===Ce.CHROME||t.name===Ce.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function mP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mP(Object(n),!0).forEach(function(i){Xt(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Xt(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let L=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),$=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),Xt(this,"code",void 0),Xt(this,"message",void 0),Xt(this,"data",void 0),Xt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Qc(t,e){if(typeof t!="boolean")throw new $(L.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Zn(t,e,n){if(!_t(n).call(n,t))throw new $(L.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function Ve(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new $(L.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function _I(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new $(L.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&Ve(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&Ve(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&Ve(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&Ve(t.ideal,"".concat(e,".ideal"),1,1/0)}else Ve(t,e,1,1/0)}function Ei(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new $(L.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!_P(t,n,i,r))throw new $(L.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function Zc(t,e){if(!Array.isArray(t))throw new $(L.INVALID_PARAMS,"".concat(e," should be an array"))}function _n(t){return t==null}function _P(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let s=0;s<r.length;s+=1){const c=r.charCodeAt(s);if(c<0||c>255)return!1}return!0}(t))}var ug=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(ug||{}),EI=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(EI||{});const EP=new class{constructor(){Xt(this,"_clientSize",null),Xt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Xt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Xt(this,"getStyle",t=>window.getComputedStyle(t,null)),Xt(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:s,opacity:c,filter:l}=i;return(r==="none"||_t(e=["hidden","collapse"]).call(e,s)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(d=>{var h;const p=d.split("(")[0];return _t(h=["brightness","blur","opacity"]).call(h,p)}).map(d=>{const[h,p]=d.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{const[h,p]=d;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),Xt(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let s=t;for(;s&&i;)r(s)||(n=!1,i=!1),s=s.parentElement,s||(i=!1);return n}),Xt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Xt(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:s,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:s,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),Xt(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),Xt(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),Xt(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),Xt(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,s=e/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){const p=(n*l+(d===0?.1:d===4?(r*d*l-1e5)/l:r*d)*l)/l,m=(i*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:p,y:m})}return[...c]}),Xt(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),Xt(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),Xt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:s,clientMin:c}=this._clientSize;let l,d,h,p;if(t<0)l=0;else{if(!(t<s))return!1;l=t}if(e<0)return!1;if(d=e<s?e:s,n<0)h=0;else{if(!(n<r))return!1;h=n}if(i<0)return!1;p=i<r?i:r;const m=d-l,_=p-h;return this.checkSizeIsVisible(m,_,c)}),Xt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Xt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(ug.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(ug.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ug.SIZE)}}return this.returnHiddenResult(ug.STYLE)}return this.returnHiddenResult(EI.UNMOUNTED)}return this.returnHiddenResult(EI.INVALID_HTML_ELEMENT)}),Xt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function gI(t){return new TextEncoder().encode(t)}const gP=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},SI=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",gI(t)),16);let hn=class{constructor(){Xt(this,"_events",{}),Xt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(s=>s);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let s=0;s<e.length;s+=1){const c=e[s];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(t," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},dg=null;function SP(){if(dg)return dg;if(window.electron)return dg=window.electron;if(!window.require)return null;try{return dg=window.require("electron"),dg}catch{return null}}let Hn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),En=function(t){return t.TRACER="tracer",t}({});function TP(t){return Ve(t.timeout,"config.timeout",0,1e5),Ve(t.timeoutFactor,"config.timeoutFactor",0,100,!1),Ve(t.maxRetryCount,"config.maxRetryConfig",0,1/0),Ve(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let f5=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Ie=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function hg(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function RP(t){return Ei(t.turnServerURL,"turnServerURL"),Ei(t.username,"username"),Ei(t.password,"password"),t.udpport&&Ve(t.udpport,"udpport",1,99999,!0),t.forceturn&&Qc(t.forceturn,"forceturn"),t.security&&Qc(t.security,"security"),t.tcpport&&Ve(t.tcpport,"tcpport",1,99999,!0),!0}function TI(t){return t.level!==void 0&&Zn(t.level,"level",[1,2,3]),t.delay!==void 0&&Ve(t.delay,"delay",0,3e3,!0),!0}let oe=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Oi=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Zr=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Ff=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function wi(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?Tt.reject(new $(L.UNEXPECTED_ERROR,"can not emit promise")):new Tt((s,c)=>{t.emit(e,...i,s,c)})}function Ke(t,e){if(t.getListeners(e).length===0)return Tt.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return wi(t,e,...i)}function ca(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return pg(t,e,...i)}function pg(t,e){let n=null,i=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];if(t.emit(e,...s,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new $(L.UNEXPECTED_ERROR,"handler is not sync");return n}const Vn=new class extends hn{set networkState(t){this.emit(Ff.NETWORK_STATE_CHANGE,t,this._networkState),t===Zr.ONLINE?this.emit(Ff.ONLINE):t===Zr.OFFLINE&&(this.onlineWaiter=new Tt(e=>{this.once(Ff.ONLINE,()=>{this.onlineWaiter=void 0,e(Zr.ONLINE)})}),this.emit(Ff.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Zr.ONLINE}constructor(){super(),Xt(this,"_moduleName","network-indicator"),Xt(this,"_networkState",Zr.ONLINE),Xt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Zr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Zr.OFFLINE})}};function Bv(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function jf(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function Fv(t){Tt!==void 0?Tt.resolve().then(t):setTimeout(t,0)}function gn(t){return JSON.parse(JSON.stringify(t))}function ih(t){try{return gn(t)}catch{return t}}const vP={};function _u(t,e){vP[e]||(vP[e]=!0,t())}function rh(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function Eu(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function yP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function CP(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=nr(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let s=0;return e.forEach(c=>{r.set(c,s),s+=c.length}),r}function Qo(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function AP(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?Qo(n):n.size}),e+138}function m5(t){const e=new $(L.TIMEOUT,"timeout");return new Tt((n,i)=>{window.setTimeout(()=>i(e),t)})}function gi(t){return new Tt(e=>{window.setTimeout(e,t)})}function Ye(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+Ye(t-n.length,"")}function ah(){return Ye(32,"").toUpperCase()}const jv=()=>{},bP=new class{constructor(){Xt(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,s=new Array(r>4?r-4:0),c=4;c<r;c++)s[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const d=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:d,args:s,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,bt(bt({},l),{},{fn:t,args:s,skipFn:i}))}else{const l=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:s,skipFn:i})}}},IP=bP.throttleByKey.bind(bP);function OP(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function RI(t,e){if(!OP(t)||!OP(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=RI(t[i],e[i]);return n}{const n=bt({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=RI(t[i],e[i]):n[i]=e[i]);return n}}function wP(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function vI(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function NP(t){const e="0123456789abcdef";function n(V){let W,K="";for(W=0;W<=3;W++)K+=e.charAt(V>>8*W+4&15)+e.charAt(V>>8*W&15);return K}function i(V,W){const K=(65535&V)+(65535&W);return(V>>16)+(W>>16)+(K>>16)<<16|65535&K}function r(V,W,K,j,Q,ct){return i(function(vt,At){return vt<<At|vt>>>32-At}(i(i(W,V),i(j,ct)),Q),K)}function s(V,W,K,j,Q,ct,vt){return r(W&K|~W&j,V,W,Q,ct,vt)}function c(V,W,K,j,Q,ct,vt){return r(W&j|K&~j,V,W,Q,ct,vt)}function l(V,W,K,j,Q,ct,vt){return r(W^K^j,V,W,Q,ct,vt)}function d(V,W,K,j,Q,ct,vt){return r(K^(W|~j),V,W,Q,ct,vt)}const h=function(V){let W;const K=1+(V.length+8>>6),j=new Array(16*K);for(W=0;W<16*K;W++)j[W]=0;for(W=0;W<V.length;W++)j[W>>2]|=V.charCodeAt(W)<<W%4*8;return j[W>>2]|=128<<W%4*8,j[16*K-2]=8*V.length,j}(t);let p,m,_,g,I,y=1732584193,C=-271733879,N=-1732584194,D=271733878;for(p=0;p<h.length;p+=16)m=y,_=C,g=N,I=D,y=s(y,C,N,D,h[p+0],7,-680876936),D=s(D,y,C,N,h[p+1],12,-389564586),N=s(N,D,y,C,h[p+2],17,606105819),C=s(C,N,D,y,h[p+3],22,-1044525330),y=s(y,C,N,D,h[p+4],7,-176418897),D=s(D,y,C,N,h[p+5],12,1200080426),N=s(N,D,y,C,h[p+6],17,-1473231341),C=s(C,N,D,y,h[p+7],22,-45705983),y=s(y,C,N,D,h[p+8],7,1770035416),D=s(D,y,C,N,h[p+9],12,-1958414417),N=s(N,D,y,C,h[p+10],17,-42063),C=s(C,N,D,y,h[p+11],22,-1990404162),y=s(y,C,N,D,h[p+12],7,1804603682),D=s(D,y,C,N,h[p+13],12,-40341101),N=s(N,D,y,C,h[p+14],17,-1502002290),C=s(C,N,D,y,h[p+15],22,1236535329),y=c(y,C,N,D,h[p+1],5,-165796510),D=c(D,y,C,N,h[p+6],9,-1069501632),N=c(N,D,y,C,h[p+11],14,643717713),C=c(C,N,D,y,h[p+0],20,-373897302),y=c(y,C,N,D,h[p+5],5,-701558691),D=c(D,y,C,N,h[p+10],9,38016083),N=c(N,D,y,C,h[p+15],14,-660478335),C=c(C,N,D,y,h[p+4],20,-405537848),y=c(y,C,N,D,h[p+9],5,568446438),D=c(D,y,C,N,h[p+14],9,-1019803690),N=c(N,D,y,C,h[p+3],14,-187363961),C=c(C,N,D,y,h[p+8],20,1163531501),y=c(y,C,N,D,h[p+13],5,-1444681467),D=c(D,y,C,N,h[p+2],9,-51403784),N=c(N,D,y,C,h[p+7],14,1735328473),C=c(C,N,D,y,h[p+12],20,-1926607734),y=l(y,C,N,D,h[p+5],4,-378558),D=l(D,y,C,N,h[p+8],11,-2022574463),N=l(N,D,y,C,h[p+11],16,1839030562),C=l(C,N,D,y,h[p+14],23,-35309556),y=l(y,C,N,D,h[p+1],4,-1530992060),D=l(D,y,C,N,h[p+4],11,1272893353),N=l(N,D,y,C,h[p+7],16,-155497632),C=l(C,N,D,y,h[p+10],23,-1094730640),y=l(y,C,N,D,h[p+13],4,681279174),D=l(D,y,C,N,h[p+0],11,-358537222),N=l(N,D,y,C,h[p+3],16,-722521979),C=l(C,N,D,y,h[p+6],23,76029189),y=l(y,C,N,D,h[p+9],4,-640364487),D=l(D,y,C,N,h[p+12],11,-421815835),N=l(N,D,y,C,h[p+15],16,530742520),C=l(C,N,D,y,h[p+2],23,-995338651),y=d(y,C,N,D,h[p+0],6,-198630844),D=d(D,y,C,N,h[p+7],10,1126891415),N=d(N,D,y,C,h[p+14],15,-1416354905),C=d(C,N,D,y,h[p+5],21,-57434055),y=d(y,C,N,D,h[p+12],6,1700485571),D=d(D,y,C,N,h[p+3],10,-1894986606),N=d(N,D,y,C,h[p+10],15,-1051523),C=d(C,N,D,y,h[p+1],21,-2054922799),y=d(y,C,N,D,h[p+8],6,1873313359),D=d(D,y,C,N,h[p+15],10,-30611744),N=d(N,D,y,C,h[p+6],15,-1560198380),C=d(C,N,D,y,h[p+13],21,1309151649),y=d(y,C,N,D,h[p+4],6,-145523070),D=d(D,y,C,N,h[p+11],10,-1120210379),N=d(N,D,y,C,h[p+2],15,718787259),C=d(C,N,D,y,h[p+9],21,-343485551),y=i(y,m),C=i(C,_),N=i(N,g),D=i(D,I);return n(y)+n(C)+n(N)+n(D)}let _5=1,DP=console,Ui=class{static setLogger(t){DP=t}constructor(t,e){Xt(this,"id",void 0),Xt(this,"lockingPromise",Tt.resolve()),Xt(this,"locks",0),Xt(this,"name",""),Xt(this,"lockId",void 0),this.lockId=_5++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");DP.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new Tt(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Gf(t,e){return function(n,i,r){const s=r.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{l()}},r}}const Wn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function yI(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function to(t,e,n,i){const r=Object.assign({},Wn,i);let s=r.timeout;const c=async()=>{await function(h){return new Tt(p=>{window.setTimeout(p,h)})}(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)};let l=!1;const d=new Tt(async(h,p)=>{e=e||(()=>!1),n=n||(()=>!0);for(let m=0;m<r.maxRetryCount;m+=1){if(l)return p(new $(L.OPERATION_ABORTED));try{const _=await t();if(!e(_,m)||m+1===r.maxRetryCount)return h(_);await c()}catch(_){if(!n(_,m)||m+1===r.maxRetryCount)return p(_);await c()}}});return d.cancel=()=>l=!0,d}let Gv,LP=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:nr(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},Hv=0,CI=0;function AI(t,e,n,i){return new Tt((r,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Hv+=Qo(e.data)):n&&(e.data.size?Hv+=e.data.size:e.data instanceof FormData?Hv+=AP(e.data):Hv+=Qo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,_r.request(e).then(c=>{typeof c.data=="string"?CI+=Qo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?CI+=c.data.byteLength:CI+=Qo(JSON.stringify(c.data)),r(c.data)}).catch(c=>{_r.isCancel(c)?s(new $(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new $(L.NETWORK_TIMEOUT,c.message)):c.response?s(new $(L.NETWORK_RESPONSE_ERROR,c.response.status)):s(new $(L.NETWORK_ERROR,c.message))})})}async function E5(t,e){const n=new Blob([e.data],{type:"buffer"});return await AI(t,bt(bt({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const PP=()=>window.isSecureContext!==void 0;function ps(t){if(Array.isArray(t))return t.map(n=>n);if(!kP(t))return t;const e={};for(const n in t){const i=t[n];kP(i)||Array.isArray(i)?e[n]=ps(i):e[n]=i}return e}function kP(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let bI=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Zo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},fg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Zo,remoteCandidate:Zo},updateInterval:0},MP={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},UP={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},xP={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},VP={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let II=class{constructor(t,e){Xt(this,"onFirstVideoReceived",void 0),Xt(this,"onFirstVideoDecoded",void 0),Xt(this,"onFirstAudioReceived",void 0),Xt(this,"onFirstVideoDecodedTimeout",void 0),Xt(this,"onFirstAudioDecoded",void 0),Xt(this,"onSelectedLocalCandidateChanged",void 0),Xt(this,"onSelectedRemoteCandidateChanged",void 0),Xt(this,"videoIsReady",!1),Xt(this,"videoIsReady2",{}),Xt(this,"pc",void 0),Xt(this,"options",void 0),Xt(this,"intervalTimer",void 0),Xt(this,"stats",ps(fg)),Xt(this,"isFirstVideoReceived",{}),Xt(this,"isFirstVideoDecoded",{}),Xt(this,"isFirstAudioReceived",{}),Xt(this,"isFirstAudioDecoded",{}),Xt(this,"isFirstVideoDecodedTimeout",{}),Xt(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Tt(t=>{t({local:bt({},Zo),remote:bt({},Zo)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,s=0,c=0;for(const l of n)t[l].forEach((d,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const p=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,m=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(i+=p,s+=m):(r+=p,c+=m),Number.isNaN(p)||Number.isNaN(p)?d.packetLostRate=0:d.packetLostRate=p<=0||m<=0?0:m/(p+m)});t.sendPacketLossRate=i<=0||s<=0?0:s/(i+s),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},g5=class extends II{constructor(){super(...arguments),Xt(this,"_stats",fg),Xt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=ps(fg);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=_t(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=ps(UP);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=ps(MP),s=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),s){const c=s.stats,l=Date.now()-s.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<s.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:bt({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=ps(VP);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=ps(xP);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new Tt((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},mg=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),Wv=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),OI=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),la=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Hf=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Hf||{});function _g(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hf.kNone;if(!e)return;const s=Number(e[n]);if(typeof s!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?s/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const d=Number(t[i]);if(typeof d!="number")return;const h=c-d;return h?(s-l)/h*r:void 0}let BP=class extends II{constructor(){super(...arguments),Xt(this,"_stats",fg),Xt(this,"report",void 0),Xt(this,"lastDecodeVideoReceiverStats",new Map),Xt(this,"lastVideoFramesRecv",new Map),Xt(this,"lastVideoFramesSent",new Map),Xt(this,"lastVideoFramesDecode",new Map),Xt(this,"lastVideoFramesOutput",new Map),Xt(this,"lastVideoJBDelay",new Map),Xt(this,"lastAudioJBDelay",new Map),Xt(this,"mediaBytesSent",new Map),Xt(this,"mediaBytesRetransmit",new Map),Xt(this,"mediaBytesTargetEncode",new Map),Xt(this,"lastDecodeAudioReceiverStats",new Map),Xt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ps(fg),this.report.forEach(t=>{switch(t.type){case la.OUTBOUND:case la.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===la.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===la.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case la.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case la.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:bt({},Zo),remote:bt({},Zo)};return t.forEach(n=>{let i;if(n.type===la.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===la.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const s=t.get(i.localCandidateId);s&&r(e.local,s)}if(i.remoteCandidateId){const s=t.get(i.remoteCandidateId);s&&r(e.remote,s)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===la.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===la.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===la.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(bt({},e),bt({},this.stats.selectedCandidatePair.localCandidate)),t.type===la.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(bt({},e),bt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=ps(VP),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=_g(n,e,"totalProcessingDelay","jitterBufferEmittedCount",Hf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,bt({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=ps(MP),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),s=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=s-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=_g(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=_g(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",Hf.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=_g(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",Hf.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=_g(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",Hf.kMillisecondsFromSeconds),i&&s-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&s-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:bt({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=ps(UP),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new bI(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new bI(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new bI(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,s=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*s/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,la.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=ps(xP),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,la.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(Lr(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof d!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,p=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:t.frameHeight,m=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),m==null){const _=Date.now(),g=this.lastVideoFramesSent.get(n.ssrc);g&&_-g.lts>=800?(m=Math.round((d-g.count)/((_-g.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:_,rate:m})):g?m=g.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:_,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(t,e,n){var i,r,s,c,l;const d=e?this.report.get(e):void 0,h=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:t.framesReceived,p=(r=d==null?void 0:d.frameWidth)!==null&&r!==void 0?r:t.frameWidth,m=(s=d==null?void 0:d.frameHeight)!==null&&s!==void 0?s:t.frameHeight,_=(c=d==null?void 0:d.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,g=(l=d==null?void 0:d.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const I=this.lastVideoFramesRecv.get(n.ssrc),y=Date.now();n.framesReceivedCount=h;let C=0;I&&y-I.lts>=800?(C=Math.round((h-I.count)/((y-I.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:y,rate:C})):I?C=I.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:y,rate:0}),n.receivedFrame={width:p||0,height:m||0,frameRate:C||0},n.decodedFrame={width:p||0,height:m||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:m||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(_&&g){const I=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let y=I.jitterBufferMs;const C=g-I.jitterBufferEmittedCount;C>0&&(y=1e3*(_-I.jitterBufferDelay)/C),n.jitterBufferMs=y,n.currentDelayMs=Math.round(y),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:g,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,h=(s=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,n){var i,r,s,c,l,d,h;const p=e?this.report.get(e):void 0,m=(i=p==null?void 0:p.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,_=(r=p==null?void 0:p.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,g=(s=p==null?void 0:p.jitterBufferDelay)!==null&&s!==void 0?s:t.jitterBufferDelay,I=(c=p==null?void 0:p.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,y=(l=p==null?void 0:p.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,C=(d=p==null?void 0:p.totalSamplesDuration)!==null&&d!==void 0?d:t==null?void 0:t.totalSamplesDuration,N=(h=p==null?void 0:p.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples;if(typeof _=="number"&&(n.totalSamplesReceived=_),m&&_&&(n.accelerateRate=m/_),g&&I){const V=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let W=V.jitterBufferMs;const K=I-V.jitterBufferEmittedCount;K>0&&(W=1e3*(g-V.jitterBufferDelay)/K),n.jitterBufferMs=Math.round(W),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:I,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=y;let D=1920;C&&_&&(D=_/C/50,n.receivedFrames=Math.round(_/D)),N&&(n.droppedFrames=Math.round(N/D))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},S5=class extends II{updateStats(){return Tt.resolve()}};function wI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return s?s<76?new g5(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new BP(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof Tt||function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"}(l))}(t)?new BP(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new S5(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const FP="websdk_ng_install_id";function NI(){try{if(M("INSTALL_ID"))return M("INSTALL_ID");let t=window.localStorage.getItem(FP);return t||(t=ah(),window.localStorage.setItem(FP,t)),Pe("INSTALL_ID",t),t}catch{return}}const Ua=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.2"),DI=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let sh=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Ni=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const s=r.join(""),c={};return c[t]=i,c[e]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ni;const Kv={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},LI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},PI="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",kI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},en=bt(bt(bt({},kI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:LI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Kv),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Pe(t,e,n){var i,r,s;_t(i=Object.keys(en)).call(i,t)&&(!n&&_t(r=Object.keys(eo)).call(r,t)||(en[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||e!==!0||(en.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(en.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,en.USE_NEW_NETWORK_CONFIG=s,s&&(en.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],en.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],en.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],en.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],en.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",en.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(en.ENABLE_INSTANT_VIDEO=!0,en.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(en.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(en.NEW_TURN_MODE||(en.NEW_TURN_MODE=4))))}function M(t){return en[t]}DI||(en.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],en.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],en.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],en.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],en.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],en.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],en.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",en.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",en.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",en.AREAS=["NORTH_AMERICA","OVERSEA"]);let jP=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const eo={};var ce=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(ce||{});let Yv=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const GP=128,T5=96,HP=1e3,Wf=10;let R5=0;var WP=(()=>{var t={8:(i,r,s)=>{s.r(r),s.d(r,{Parser:()=>vt,Printer:()=>Pn,parse:()=>ft,print:()=>Pt});const c=`
`,l="".concat("\r").concat(c),d=" ";let h;function p(at){return at>="0"&&at<="9"}function m(at){return at>="!"&&at<="~"}function _(at){return m(at)||at>=""&&at<="ÿ"}function g(at){return at==="!"||at>="#"&&at<="'"||at>="*"&&at<="+"||at>="-"&&at<="."||at>="0"&&at<="9"||at>="A"&&at<="Z"||at>="^"&&at<="~"}function I(at){return at>="1"&&at<="9"}function y(at){return at>="A"&&at<="Z"||at>="a"&&at<="z"}function C(at){return at==="d"||at==="h"||at==="m"||at==="s"}function N(at){return at>""&&at<"	"||at>"\v"&&at<"\f"||at>""&&at<"ÿ"}function D(at){return y(at)||p(at)||at==="+"||at==="/"}function V(at){return p(at)||y(at)||at==="+"||at==="/"||at==="-"||at==="_"}function W(at){return y(at)||p(at)||at==="+"||at==="/"}function K(at,v){var U=Object.keys(at);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(at);v&&(F=F.filter(function(dt){return Object.getOwnPropertyDescriptor(at,dt).enumerable})),U.push.apply(U,F)}return U}function j(at){for(var v=1;v<arguments.length;v++){var U=arguments[v]!=null?arguments[v]:{};v%2?K(Object(U),!0).forEach(function(F){Q(at,F,U[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(at,Object.getOwnPropertyDescriptors(U)):K(Object(U)).forEach(function(F){Object.defineProperty(at,F,Object.getOwnPropertyDescriptor(U,F))})}return at}function Q(at,v,U){return v in at?Object.defineProperty(at,v,{value:U,enumerable:!0,configurable:!0,writable:!0}):at[v]=U,at}(function(at){at.VERSION="v",at.ORIGIN="o",at.SESSION_NAME="s",at.INFORMATION="i",at.URI="u",at.EMAIL="e",at.PHONE="p",at.CONNECTION="c",at.BANDWIDTH="b",at.TIME="t",at.REPEAT="r",at.ZONE_ADJUSTMENTS="z",at.KEY="k",at.ATTRIBUTE="a",at.MEDIA="m"})(h||(h={}));class ct{consumeText(v,U){let F=U;for(;F<v.length;){const dt=v[F];if(dt==="\0"||dt==="\r"||dt===c)break;F+=1}if(F-U==0)throw new Error("Invalid text, at ".concat(v));return F}consumeUnicastAddress(v,U,F){return this.consumeTill(v,U,d)}consumeOneOrMore(v,U,F){let dt=U;for(;F(v[dt]);)dt++;if(dt-U==0)throw new Error("Invalid rule at ".concat(U,"."));return dt}consumeSpace(v,U){if(v[U]===d)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(v,U){let F=U;for(let dt=0;dt<4;dt++)if(F=this.consumeDecimalUChar(v,F),dt!==3){if(v[F]!==".")throw new Error("Invalid IP4 address.");F++}return F}consumeDecimalUChar(v,U){let F=U;for(let Qt=0;Qt<3&&p(v[F]);Qt++,F++);if(F-U==0)throw new Error("Invalid decimal uchar.");const dt=parseInt(v.slice(U,F));if(dt>=0&&dt<=255)return F;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,U){let F=this.consumeHexpart(v,U);return v[F]===":"&&(F+=1,F=this.consumeIP4Address(v,F)),F}consumeHexpart(v,U){let F=U;if(v[F]===":"&&v[F+1]===":"){F+=2;try{F=this.consumeHexseq(v,F)}catch{}return F}if(F=this.consumeHexseq(v,F),v[F]===":"&&v[F+1]===":"){F+=2;try{F=this.consumeHexseq(v,F)}catch{}return F}return F}consumeHexseq(v,U){let F=U;for(;F=this.consumeHex4(v,F),v[F]===":"&&v[F+1]!==":";)F+=1;return F}consumeHex4(v,U){let F=0;for(;F<4;F++)if(!((dt=v[U+F])>="0"&&dt<="9"||dt>="a"&&dt<="f"||dt>="A"&&dt<="F")){if(F===0)throw new Error("Invalid hex 4");break}var dt;return U+F}consumeFQDN(v,U){let F=U;for(;p(v[F])||y(v[F])||v[F]==="-"||v[F]===".";)F+=1;if(F-U<4)throw new Error("Invalid FQDN");return F}consumeExtnAddr(v,U){return this.consumeOneOrMore(v,U,_)}consumeMulticastAddress(v,U,F){switch(F){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,U);default:try{return this.consumeFQDN(v,U)}catch{return this.consumeExtnAddr(v,U)}}}consumeIP6MulticastAddress(v,U){const F=this.consumeHexpart(v,U);return v[F]==="/"?this.consumeInteger(v,F+1):F}consumeIP4MulticastAddress(v,U){let F=U+3;const dt=v.slice(U,F),Qt=parseInt(dt);if(Qt<224||Qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Be=0;Be<3;Be++){if(v[F]!==".")throw new Error("Invalid IP4 multicast address.");F+=1,F=this.consumeDecimalUChar(v,F)}return v[F]==="/"&&(F+=1),F=this.consumeTTL(v,F),v[F]==="/"&&(F=this.consumeInteger(v,F)),F}consumeInteger(v,U){if(!I(v[U]))throw new Error("Invalid integer.");for(U+=1;p(v[U]);)U+=1;return U}consumeTTL(v,U){if(v[U]==="0")return U+1;if(!I(v[U]))throw new Error("Invalid TTL.");U+=1;for(let F=0;F<2&&p(v[U]);F++)U+=1;return U}consumeToken(v,U){return this.consumeOneOrMore(v,U,g)}consumeTime(v,U){let F=U;if(v[F]==="0")return F+1;for(I(v[F])&&(F+=1);p(v[F]);)F++;if(F-U<10)throw new Error("Invalid time");return F}consumeAddress(v,U){return this.consumeTill(v,U,d)}consumeTypedTime(v,U){let F=U;return F=this.consumeOneOrMore(v,F,p),C(v[F])?F+1:F}consumeRepeatInterval(v,U){if(!I(v[U]))throw new Error("Invalid repeat interval");for(U+=1;p(v[U]);)U+=1;return C(v[U])&&(U+=1),U}consumePort(v,U){return this.consumeOneOrMore(v,U,p)}consume(v,U,F){for(let dt=0;dt<F.length;dt++){if(U+dt>=v.length)throw new Error("consume exceeding value length");if(v[U+dt]!==F[dt])throw new Error("consume ".concat(F," failed at ").concat(dt))}return U+F.length}consumeTill(v,U,F){let dt=U;for(;dt<v.length&&(typeof F!="string"||v[dt]!==F)&&(typeof F!="function"||!F(v[dt]));)dt++;return dt}}class vt extends ct{constructor(){super(),Q(this,"records",[]),Q(this,"currentLine",0)}parse(v){const U=this.probeEOL(v);this.records=v.split(U).filter(Nh=>!!Ji(Nh).call(Nh)).map(this.parseLine),this.currentLine=0;const F=this.parseVersion(),dt=this.parseOrigin(),Qt=this.parseSessionName(),Be=this.parseInformation(),ai=this.parseUri(),Br=this.parseEmail(),ul=this.parsePhone(),wh=this.parseConnection(),$g=this.parseBandWidth(),iC=this.parseTimeFields(),rC=this.parseKey(),Wa=this.parseSessionAttribute(),Mu=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:F,origin:dt,sessionName:Qt,information:Be,uri:ai,emails:Br,phones:ul,connection:wh,bandwidths:$g,timeFields:iC,key:rC,attributes:Wa,mediaDescriptions:Mu}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let U=0;U<v.length;U++)if(v[U]===c)return v[U-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(v,U){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const F=v[0];if(v[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:F,value:v.slice(2),line:U,cur:0}}parseSessionAttribute(){const v=new ue;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==h.ATTRIBUTE)break;const F={attField:this.extractOneOrMore(U,dt=>g(dt)&&dt!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,F.attValue=this.extractOneOrMore(U,N)),v.parse(F),this.currentLine++}return v.digest()}parseMediaAttributes(v){const U=new de(v);for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==h.ATTRIBUTE)break;const dt={attField:this.extractOneOrMore(F,Qt=>g(Qt)&&Qt!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,dt.attValue=this.extractOneOrMore(F,N)),U.parse(dt),this.currentLine++}return U.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===h.KEY){if(v.value==="prompt"||v.value==="clear:"||v.value==="base64:"||v.value==="uri:")return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===h.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const F=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let dt=!1;v.value[v.cur]==="-"&&(dt=!0,v.cur+=1);const Qt=this.extract(v,this.consumeTypedTime);U.push({time:F,typedTime:Qt,back:dt})}catch{break}if(U.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const v=[];for(;;){const U=this.getCurrentRecord();if(U.type!==h.REPEAT)break;{const F=this.extract(U,this.consumeRepeatInterval),dt=this.parseTypedTime(U);v.push({repeatInterval:F,typedTimes:dt}),this.currentLine++}}return v}parseTypedTime(v){const U=[];for(;;)try{this.consumeSpaceForRecord(v),U.push(this.extract(v,this.consumeTypedTime))}catch{break}if(U.length===0)throw new Error("Invalid typed time.");return U}parseTime(){const v=this.getCurrentRecord(),U=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const F=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:F}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==h.BANDWIDTH)break;{const F=this.extractOneOrMore(U,g);if(U.value[U.cur]!==":")throw new Error("Invalid bandwidth field.");U.cur++;const dt=this.extractOneOrMore(U,p);v.push({bwtype:F,bandwidth:dt}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==h.VERSION)throw new Error("first sdp record must be version");const U=v.value.slice(0,this.consumeOneOrMore(v.value,0,p));if(U.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,U}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(v,_);this.consumeSpaceForRecord(v);const F=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const dt=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const Qt=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const Be=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const ai=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:F,sessVersion:dt,nettype:Qt,addrtype:Be,unicastAddress:ai}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===h.SESSION_NAME){const U=this.extract(v,this.consumeText);return this.currentLine++,U}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==h.INFORMATION)return;const U=this.extract(v,this.consumeText);return this.currentLine++,U}parseUri(){const v=this.getCurrentRecord();if(v.type===h.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const U=this.getCurrentRecord();if(U.type!==h.EMAIL)break;v.push(U.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const U=this.getCurrentRecord();if(U.type!==h.PHONE)break;v.push(U.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===h.CONNECTION){const U=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const F=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const dt=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:F,address:dt}}}parseMedia(){const v=this.getCurrentRecord(),U=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let F=this.extract(v,this.consumePort);v.value[v.cur]==="/"&&(v.cur+=1,F+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const dt=[];for(dt.push(this.extract(v,this.consumeToken));v.value[v.cur]==="/";)v.cur+=1,dt.push(this.extract(v,this.consumeToken));if(dt.length===0)throw new Error("Invalid proto");const Qt=this.parseFmt(v);return this.currentLine++,{mediaType:U,port:F,protos:dt,fmts:Qt}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===h.TIME;){const U=this.parseTime(),F=this.parseRepeat(),dt=this.parseZone();v.push({time:U,repeats:F,zones:dt})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const U=this.parseMedia(),F=this.parseInformation(),dt=this.parseConnections(),Qt=this.parseBandWidth(),Be=this.parseKey(),ai=this.parseMediaAttributes(U);v.push({media:U,information:F,connections:dt,bandwidths:Qt,key:Be,attributes:ai})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const U=[];for(;;)try{this.consumeSpaceForRecord(v),U.push(this.extract(v,this.consumeToken))}catch{break}if(U.length===0)throw new Error("Invalid fmts");return U}extract(v,U){for(var F=arguments.length,dt=new Array(F>2?F-2:0),Qt=2;Qt<F;Qt++)dt[Qt-2]=arguments[Qt];const Be=U.call(this,v.value,v.cur,...dt),ai=v.value.slice(v.cur,Be);return v.cur=Be,ai}extractOneOrMore(v,U){const F=this.consumeOneOrMore(v.value,v.cur,U),dt=v.value.slice(v.cur,F);return v.cur=F,dt}consumeSpaceForRecord(v){if(v.value[v.cur]!==d)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class At extends ct{constructor(){super(...arguments),Q(this,"attributes",void 0),Q(this,"digested",!1)}extractOneOrMore(v,U,F){const dt=this.consumeOneOrMore(v.attValue,v._cur,U),Qt=v.attValue.slice(v._cur,dt),[Be,ai]=F||[];if(typeof Be=="number"&&Qt.length<Be)throw new Error("error in length, should be more or equal than ".concat(Be," characters."));if(typeof ai=="number"&&Qt.length>ai)throw new Error("error in length, should be less or equal than ".concat(ai," characters."));return v._cur=dt,Qt}consumeAttributeSpace(v){if(v.attValue[v._cur]!==d)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,U){if(!v.attValue)throw new Error("Nothing to extract from attValue.");for(var F=arguments.length,dt=new Array(F>2?F-2:0),Qt=2;Qt<F;Qt++)dt[Qt-2]=arguments[Qt];const Be=U.call(this,v.attValue,v._cur,...dt),ai=v.attValue.slice(v._cur,Be);return v._cur=Be,ai}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,U){if(!v.attValue)throw new Error;for(let F=0;F<U.length;F++)if(U[F]!==v.attValue[v._cur+F])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,D,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,D,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(v);){U.push(this.extractOneOrMore(v,D));try{this.consumeAttributeSpace(v)}catch(F){if(this.atEnd(v))break;throw F}}this.attributes.iceOptions=U}parseFingerprint(v){const U=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:F})}parseExtmap(v){const U=this.extractOneOrMore(v,p);let F;this.peekChar(v)==="/"&&(this.extract(v,this.consume,"/"),F=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeTill,d),Qt=j(j({entry:parseInt(U,10)},F&&{direction:F}),{},{extensionName:dt});this.peekChar(v)===d&&(this.consumeAttributeSpace(v),Qt.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(Qt)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(v,this.consumeTill);if(U!=="active"&&U!=="passive"&&U!=="actpass"&&U!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class ue extends At{constructor(){super(...arguments),Q(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(U){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),U}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const U=this.extract(v,this.consumeToken),F=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;)this.consumeAttributeSpace(v),F.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:F})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,V)}parseIdentity(v){const U=this.extractOneOrMore(v,W),F=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;){this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const Qt=this.extractOneOrMore(v,Be=>Be!==d&&N(Be));F.push({name:dt,value:Qt})}this.attributes.identities.push({assertionValue:U,extensions:F})}parseMsidSemantic(v){this.peekChar(v)===d&&this.consumeAttributeSpace(v);const U={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if(this.peekChar(v)==="*"){this.extract(v,this.consume,"*"),U.applyForAll=!0;break}{const F=this.extract(v,this.consumeTill,d);U.identifierList.push(F)}}this.attributes.msidSemantic=U}}class de extends At{constructor(v){super(),Q(this,"attributes",void 0),v.protos.indexOf("RTP")!==-1||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(U){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),U}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const U=this.extractOneOrMore(v,D,[1,32]);this.consumeAttributeSpace(v);const F=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const Qt=this.extractOneOrMore(v,p,[1,10]);this.consumeAttributeSpace(v);const Be=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const ai=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const Br={foundation:U,componentId:F,transport:dt,priority:Qt,connectionAddress:Be,port:ai,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),Br.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),Br.relPort=this.extract(v,this.consumePort));this.peekChar(v)===d;){this.consumeAttributeSpace(v);const ul=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),Br.extension[ul]=this.extractOneOrMore(v,m)}this.attributes.candidates.push(Br)}parseRemoteCandidate(v){const U=[];for(;;){const F=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Qt=this.extract(v,this.consumePort);U.push({componentId:F,connectionAddress:dt,port:Qt});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const U=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const dt={encodingName:F,clockRate:this.extractOneOrMore(v,p)};this.atEnd(v)||this.peekChar(v)!=="/"||(this.extract(v,this.consume,"/"),dt.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const Qt=this.attributes.payloads.find(Be=>Be.payloadType===parseInt(U,10));Qt?Qt.rtpMap=dt:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:dt,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const U=this.extractOneOrMore(v,p);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill,":");let dt;this.peekChar(v)===":"&&(this.extract(v,this.consume,":"),dt=this.extract(v,this.consumeTill));const Qt=this.attributes.ssrcs.find(Be=>Be.ssrcId===parseInt(U,10));Qt?Qt.attributes[F]=dt:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[F]:dt}})}parseFmtp(v){const U=this.extract(v,this.consumeTill,d);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill),dt={};F.split(";").forEach(Be=>{let[ai,Br]=Be.split("=");ai=Ji(ai).call(ai);const ul=typeof Br=="string"?Ji(Br).call(Br):null;typeof ai=="string"&&ai.length>0&&(dt[ai]=ul)});const Qt=this.attributes.payloads.find(Be=>Be.payloadType===parseInt(U,10));Qt?Qt.fmtp={parameters:dt}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:dt}})}parseFmtParameters(v){const U={},F=this.extract(v,this.consumeTill,"=");v._cur++;const dt=this.extract(v,this.consumeTill,";");for(U[F]=dt;v.attValue[v._cur]===";";){const Qt=this.extract(v,this.consumeTill,"=");v._cur++;const Be=this.extract(v,this.consumeTill,";");U[Qt]=Be}return U}parseRtcpFb(v){let U="";U=this.peekChar(v)==="*"?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,d),this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill,d);let dt;if(F==="trr-int")dt={type:F,interval:this.extract(v,this.consumeTill)};else{const Qt={type:F};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),Qt.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===d&&(Qt.additional=this.extract(v,this.consumeTill))),dt=Qt}if(U==="*")this.attributes.rtcpFeedbackWildcards.push(dt);else{const Qt=this.attributes.payloads.find(Be=>Be.payloadType===parseInt(U,10));Qt?Qt.rtcpFeedbacks.push(dt):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[dt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(v,this.consumePort)};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),U.netType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),U.addressType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),U.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(v){const U={id:this.extractOneOrMore(v,g,[1,64])};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),U.appdata=this.extractOneOrMore(v,g,[1,64])),this.attributes.msids.push(U)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const U=this.extractOneOrMore(v,dt=>y(dt)||p(dt)||dt==="_"||dt==="-");this.consumeAttributeSpace(v);const F={id:U,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===d){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const dt=[];for(;;){const Qt=this.extract(v,this.consumeToken);dt.push(Qt);try{this.extract(v,this.consume,",")}catch{break}}F.payloads=dt,this.peekChar(v)===d&&this.extract(v,this.consume,d)}for(;;){const dt=this.extract(v,this.consumeToken);switch(dt){case"depend":{const Qt={type:dt,rids:this.extract(v,this.consume,"=").split(",")};F.params.push(Qt);break}default:{const Qt={type:dt};this.peekChar(v)==="="&&(this.extract(v,this.consume,"="),Qt.val=this.extract(v,this.consumeTill,";")),F.params.push(Qt)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(F)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,p,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const U=this.extract(v,this.consumeToken),F=[];for(;;)try{this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeInteger);F.push(parseInt(dt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:F})}}function qe(at,v,U){return v in at?Object.defineProperty(at,v,{value:U,enumerable:!0,configurable:!0,writable:!0}):at[v]=U,at}class Pn{constructor(){qe(this,"eol",l)}print(v,U){let F="";return U&&(this.eol=U),F+=this.printVersion(v.version),F+=this.printOrigin(v.origin),F+=this.printSessionName(v.sessionName),F+=this.printInformation(v.information),F+=this.printUri(v.uri),F+=this.printEmail(v.emails),F+=this.printPhone(v.phones),F+=this.printConnection(v.connection),F+=this.printBandwidth(v.bandwidths),F+=this.printTimeFields(v.timeFields),F+=this.printKey(v.key),F+=this.printSessionAttributes(v.attributes),F+=this.printMediaDescription(v.mediaDescriptions),F}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let U="";for(const F of v)U+="e=".concat(F).concat(this.eol);return U}printPhone(v){let U="";for(const F of v)U+="e=".concat(F).concat(this.eol);return U}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let U="";for(const F of v)U+="b=".concat(F.bwtype,":").concat(F.bandwidth).concat(this.eol);return U}printTimeFields(v){let U="";for(const F of v){U+="t=".concat(F.time.startTime," ").concat(F.time.startTime).concat(this.eol);for(const dt of F.repeats)U+="r=".concat(dt.repeatInterval," ").concat(dt.typedTimes.join(" ")).concat(this.eol);F.zoneAdjustments&&(U+="z=",U+="z=".concat(F.zoneAdjustments.map(dt=>"".concat(dt.time," ").concat(dt.back?"-":""," ").concat(dt.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let U="";for(const F of v)U+="a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol);return U}printMediaDescription(v){let U="";for(const F of v)U+=this.printMedia(F.media),U+=this.printInformation(F.information),U+=this.printConnections(F.connections),U+=this.printBandwidth(F.bandwidths),U+=this.printKey(F.key),U+=this.printMediaAttributes(F);return U}printConnections(v){let U="";for(const F of v)U+=this.printConnection(F);return U}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new vr(this.eol).print(v)}printMediaAttributes(v){return new nt(this.eol).print(v)}}class yn{constructor(v){qe(this,"eol",void 0),this.eol=v}printIceUfrag(v){return v===void 0?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return v===void 0?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return v===void 0?"":"a=ice-options:".concat(v.join(d)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(d).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v){return v.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(d).concat(U.extensionName).concat(U.extensionAttributes?"".concat(d).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v){return v===void 0?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class vr extends yn{print(v){let U="";return U+=this.printGroups(v.groups),U+=this.printMsidSemantic(v.msidSemantic),U+=this.printIceLite(v.iceLite),U+=this.printIceUfrag(v.iceUfrag),U+=this.printIcePwd(v.icePwd),U+=this.printIceOptions(v.iceOptions),U+=this.printFingerprints(v.fingerprints),U+=this.printSetup(v.setup),U+=this.printTlsId(v.tlsId),U+=this.printIdentity(v.identities),U+=this.printExtmap(v.extmaps),U+=this.printUnrecognized(v.unrecognized),U}printGroups(v){let U="";return v.length>0&&(U+=v.map(F=>"a=group:".concat(F.semantic).concat(F.identificationTag.map(dt=>"".concat(d).concat(dt)).join("")).concat(this.eol)).join("")),U}printIceLite(v){return v===void 0?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return v.length===0?"":v.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(F=>"".concat(d).concat(F.name).concat(F.value?"=".concat(F.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let U="a=msid-semantic:".concat(v.semantic);return v.applyForAll?U+="".concat(d,"*"):v.identifierList.length>0&&(U+=v.identifierList.map(F=>"".concat(d).concat(F))),U+this.eol}}class nt extends yn{print(v){const U=v.attributes;let F="";return F+=this.printRTCP(U.rtcp),F+=this.printIceUfrag(U.iceUfrag),F+=this.printIcePwd(U.icePwd),F+=this.printIceOptions(U.iceOptions),F+=this.printCandidates(U.candidates),F+=this.printRemoteCandidatesList(U.remoteCandidatesList),F+=this.printEndOfCandidates(U.endOfCandidates),F+=this.printFingerprints(U.fingerprints),F+=this.printSetup(U.setup),F+=this.printMid(U.mid),F+=this.printExtmap(U.extmaps),F+=this.printRTPRelated(U),F+=this.printPtime(U.ptime),F+=this.printMaxPtime(U.maxPtime),F+=this.printDirection(U.direction),F+=this.printSSRCGroups(U.ssrcGroups),F+=this.printSSRC(U.ssrcs),F+=this.printRTCPMux(U.rtcpMux),F+=this.printRTCPMuxOnly(U.rtcpMuxOnly),F+=this.printRTCPRsize(U.rtcpRsize),F+=this.printMSId(U.msids),F+=this.printImageattr(U.imageattr),F+=this.printRid(U.rids),F+=this.printSimulcast(U.simulcast),F+=this.printSCTPPort(U.sctpPort),F+=this.printMaxMessageSize(U.maxMessageSize),F+=this.printUnrecognized(U.unrecognized),F}printCandidates(v){return v.map(U=>"a=candidate:".concat(U.foundation).concat(d).concat(U.componentId).concat(d).concat(U.transport).concat(d).concat(U.priority).concat(d).concat(U.connectionAddress).concat(d).concat(U.port).concat(d,"typ").concat(d).concat(U.type).concat(U.relAddr?"".concat(d,"raddr").concat(d).concat(U.relAddr):"").concat(U.relPort?"".concat(d,"rport").concat(d).concat(U.relPort):"").concat(Object.keys(U.extension).map(F=>"".concat(d).concat(F).concat(d).concat(U.extension[F])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v){return v.map(U=>"a=remote-candidates:".concat(U.join(d)).concat(this.eol)).join("")}printEndOfCandidates(v){return v===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const U=v.payloads;let F="";F+=v.rtcpFeedbackWildcards.map(dt=>this.printRTCPFeedback("*",dt)).join("");for(const dt of U)F+=this.printRtpMap(dt.payloadType,dt.rtpMap),F+=this.printFmtp(dt.payloadType,dt.fmtp),F+=dt.rtcpFeedbacks.map(Qt=>this.printRTCPFeedback(dt.payloadType,Qt)).join("");return F}printFmtp(v,U){if(!U)return"";const F=Object.keys(U.parameters);return F.length===1&&U.parameters[F[0]]===null?"a=fmtp:".concat(v).concat(d).concat(F[0]).concat(this.eol):"a=fmtp:".concat(v).concat(d).concat(Object.keys(U.parameters).map(dt=>"".concat(dt,"=").concat(U.parameters[dt])).join(";")).concat(this.eol)}printRtpMap(v,U){return U?"a=rtpmap:".concat(v).concat(d).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,U){let F="a=rtcp-fb:".concat(v).concat(d),dt=U;return dt.type==="trr-int"?F+="ttr-int".concat(d).concat(dt.interval):(F+="".concat(dt.type),dt.parameter&&(F+="".concat(d).concat(dt.parameter),dt.additional&&(F+="".concat(d).concat(dt.additional)))),F+this.eol}printPtime(v){return v===void 0?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return v===void 0?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return v===void 0?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map(U=>Object.keys(U.attributes).map(F=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(d).concat(F).concat(U.attributes[F]?":".concat(U.attributes[F]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v){return v===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return v===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return v===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(v===void 0)return"";let U="a=rtcp:".concat(v.port);return v.netType&&(U+="".concat(d).concat(v.netType)),v.addressType&&(U+="".concat(d).concat(v.addressType)),v.address&&(U+="".concat(d).concat(v.address)),U+this.eol}printMSId(v){return v.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(d).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(v){return v.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(v){return v.map(U=>{let F="a=rid:".concat(U.id).concat(d).concat(U.direction);return U.payloads&&(F+="".concat(d,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(F+="".concat(d).concat(U.params.map(dt=>dt.type==="depend"?"depend=".concat(dt.rids.join(",")):"".concat(dt.type,"=").concat(dt.val)).join(";"))),F+this.eol}).join("")}printSimulcast(v){return v===void 0?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return v===void 0?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return v===void 0?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return v===void 0?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(F=>"".concat(d).concat(F.toString(10))).join("")).concat(this.eol)).join("")}}function ft(at){return new vt().parse(at)}function Pt(at,v){return new Pn().print(at,v)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var s in r)n.o(r,s)&&!n.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:r[s]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Mr(t){return WP.parse(t)}function gu(t,e){return WP.print(t,e)}var v5=hr("Array").keys,y5=Ra,C5=fi,A5=mt,b5=v5,MI=Array.prototype,I5={DOMTokenList:!0,NodeList:!0},O5=function(t){var e=t.keys;return t===MI||A5(MI,t)&&e===MI.keys||C5(I5,y5(t))?b5:e},ua=P(O5);function KP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ee(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KP(Object(n),!0).forEach(function(i){Sn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Sn(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const YP=new class extends hn{constructor(){super(...arguments),Sn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class w5{constructor(e){Sn(this,"logger",void 0),Sn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function UI(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function zP(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const xa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},zv=Date.now(),Eg=t=>{for(const e in xa)if(Object.prototype.hasOwnProperty.call(xa,e)&&xa[e]===t)return e;return"DEFAULT"},T=new class{constructor(){Sn(this,"proxyServerURL",void 0),Sn(this,"logLevel",xa.DEBUG),Sn(this,"uploadState","collecting"),Sn(this,"uploadLogWaitingList",[]),Sn(this,"uploadLogUploadingList",[]),Sn(this,"uploadErrorCount",0),Sn(this,"currentLogID",0),Sn(this,"url",void 0),Sn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Pe("UPLOAD_LOG",!0)}disableLogUpload(){Pe("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new w5(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-zv<100)return void setTimeout(()=>{this.log(...e)},Date.now()-zv);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=UI()+" Agora-SDK [".concat(Eg(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=UI()+" %cAgora-SDK [".concat(Eg(i),"]:");let s=[];if(!M("USE_NEW_LOG"))switch(i){case xa.DEBUG:s=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case xa.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case xa.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case xa.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-zv<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-zv);const i=Math.max(0,Math.min(4,e[0]));e[0]=UI()+" Agora-SDK [".concat(Eg(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!M("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=zP()+" Agora-SDK [".concat(Eg(t),"]:"):n[0]=zP()+" Agora-SDK [".concat(Eg(t),"]:");let r="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),r+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:Ua,process_id:M("PROCESS_ID"),payload:JSON.stringify(t)};return to(async()=>{const n=await _r.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(M("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(M("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),YP.reportLogUploadError(i),!0},{timeout:M("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:M("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,M("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var qP;function N5(t){return Ei(t.reportId,"params.reportId",0,100,!1),Ei(t.category,"params.category",0,100,!1),Ei(t.event,"params.event",0,100,!1),Ei(t.label,"params.label",0,100,!1),Ve(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(qP={}).FREE="free",qP.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const D5={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ii=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),cn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let L5=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Gt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const s=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];let p=d;if(t.argsMap)try{p=t.argsMap(this,...d)}catch(_){T.warning(_),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const m=(t.report||Mt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:En.TRACER,reportResult:t.reportResult},t.throttleTime);try{const _=r.apply(this,d);return _ instanceof Tt?_.then(g=>(m.onSuccess(t.reportResult&&g),g)).catch(g=>{throw m.onError(g),g}):(m.onSuccess(t.reportResult&&_),_)}catch(_){throw m.onError(_),_}}}return i}}const Mt=new class{constructor(){Sn(this,"baseInfoMap",new Map),Sn(this,"proxyServer",void 0),Sn(this,"eventUploadTimer",void 0),Sn(this,"setSessionIdTimer",void 0),Sn(this,"url",void 0),Sn(this,"sids",new Set),Sn(this,"backupUrl",void 0),Sn(this,"_appId",void 0),Sn(this,"_aid",0),Sn(this,"keyEventUploadPendingItems",[]),Sn(this,"normalEventUploadPendingItems",[]),Sn(this,"apiInvokeUploadPendingItems",[]),Sn(this,"apiInvokeCount",0),Sn(this,"apiInvokeLoggedCount",0),Sn(this,"ltsList",[]),Sn(this,"lastSendNormalEventTime",Date.now()),Sn(this,"customReportCounterTimer",void 0),Sn(this,"customReportCount",0),Sn(this,"extApiInvoke",async t=>{for(const e of t){const n=ee(ee({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:En.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),M("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),M("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,s=!!M("SHOW_REPORT_INVOKER_LOG"),c=!!M("SHOW_REPORT_USER_INVOKER_LOG"),l=s||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function h(g,I){if(l){let y="[apiInvoke-".concat(d,"]");e.id&&(y+="[".concat(e.id,"]")),e.name&&(y+="[".concat(e.name,"]")),T.info("".concat(y," ").concat(g),g==="start"?e.options:I||"")}}const p=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});h("start");let m=!1;gi(e.timeout).then(()=>{m||(this.sendApiInvoke(ee(ee({},p()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const _=new $(L.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:g=>{const I=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(ee(ee({},p()),{},{success:!0},e.reportResult&&{result:g})),h("onSuccess"),g};return n?IP(I,e.name+"Success",n,()=>m=!0):I()},onError:g=>{const I=()=>{if(m)throw g;m=!0,this.sendApiInvoke(ee(ee({},p()),{},{success:!1,error:g})),h("onFailure",g.toString())};return n?IP(I,e.name+"Error",n,()=>m=!0):I()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:M("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:DI?"global":"oversea",areas:M("AREAS")&&M("AREAS").join(",")},e.extend),{stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientRole:p}=e,m=Date.now(),_=ee(ee({},i),{},{eventType:ii.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:PI,lts:m,elapse:m-n,extend:JSON.stringify(r),mode:e.mode,process:M("PROCESS_ID"),appType:M("APP_TYPE"),success:!0,version:Ua,stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientType:_t(g=window.navigator.userAgent).call(g,"AgoraWebView")?42:20,clientRole:p,serviceId:M("PROCESS_ID"),extensionID:M("PLUGIN_INFO").join(",")||""});var g;this.send({type:cn.SESSION,data:_},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{role:e.role,eventType:ii.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:cn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ii.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:cn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:s,avoidJoinStartTime:c,addr:l,isProxy:d}=e,h=r-(s&&c?c:n.startTime),p=ee(ee({},i),{},{eventType:ii.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:h,eventElapse:r-e.lts,firstSuccess:s,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:NI(),isABTestSuccess:e.isABTestSuccess?1:0}),m=p.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),s)this.send({type:cn.JOIN_GATEWAY,data:p},!0);else{let _;if(l)if(d){const I=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),y=l.match(/p=[0-9]{1,6}/g);_={isSuccess:m,gatewayIp:I&&I.length?I[0].split("=")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split("=")[1]:"",isProxy:d?1:0}}else{const I=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),y=l.match(/(:|p=)[0-9]{1,6}/g);_={isSuccess:m,gatewayIp:I&&I.length?I[0].split("//")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split(/:|p=/g)[1]:"",isProxy:d?1:0}}else _={isSuccess:m,gatewayIp:"",port:"",isProxy:d?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const g=Object.assign({},p,_,{eventType:ii.REJOIN_GATEWAY});this.send({type:cn.RE_JOIN_GATEWAY,data:g},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=ee(ee({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:cn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ii.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:cn.PUBLISH,data:s},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,s=Date.now(),c=ee(ee({},r),{},{eventType:ii.SUBSCRIBE,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:cn.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...ua(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee({},s),{},{eventType:ii.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:cn.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee(ee({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee(ee({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:ii.AB_TEST,lts:r});this.send({type:cn.AB_TEST,data:s},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:ii.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:cn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:ii.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:cn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee(ee({},s),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ii.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:cn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ii.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:cn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ii.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:cn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(t){this.proxyServer=t,t?T.debug("reportProxyServerurl: ".concat(t)):T.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:cn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(s,c,l){const d=s[c];if(!d||typeof d!="string")return[s];s[c]="";const h=Qo(JSON.stringify(s));let p=0;const m=[];let _=0;for(let g=0;g<d.length;g++)_+=d.charCodeAt(g)<=127?1:3,_<=l-h||(m[m.length]=bt(bt({},s),{},{[c]:d.substring(p,g)}),p=g,_=d.charCodeAt(g)<=127?1:3);return p!==d.length-1&&(m[m.length]=bt(bt({},s),{},{[c]:d.substring(p)})),m})(ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:cn.WORKER_EVENT,data:s},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:cn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:cn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:cn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>M("CUSTOM_REPORT_LIMIT"))throw new $(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:cn.USER_ANALYTICS,data:ee(ee({sid:t},r),{},{lts:n})}));try{M("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw T.error("send custom report message failed",r.toString()),new $(L.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=M("NOT_REPORT_EVENT");if(t.tag&&_t(e)&&_t(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:s}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof $){const{code:d,message:h}=t.error;c=d||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:s,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:cn.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const s=t.shift();n.length<20?n.push(s):i.push(s)}t.push(...i);for(const s of[...n]){var r;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),JE(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),M("ENABLE_EVENT_REPORT")&&n.length&&(M("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>c=>{M("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-M("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){Vn.networkState===Zr.OFFLINE&&await Tt.race([Vn.onlineWaiter,gi(2*Wn.maxRetryTimeout)]);const e=r=>{let s=new Uint8Array;return r.forEach(c=>{const l=gI(JSON.stringify(c.data)),d=new ArrayBuffer(5),h=(m=>{let _=0;return Object.entries(cn).forEach(g=>{let[I,y]=g;y===m.type&&(_=L5[I])}),_})(c),p=new DataView(d);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=gP(s,new Uint8Array(d)),s=gP(s,l)}),s},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await AI(i,{timeout:1e4,data:e(t),headers:ee(ee({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(r===1)throw s;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};Vn.networkState===Zr.OFFLINE&&await Tt.race([Vn.onlineWaiter,gi(2*Wn.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(M("EVENT_REPORT_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(M("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(s)));try{e?await E5(c,{timeout:1e4,data:r}):await AI(c,{timeout:1e4,data:r})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(t,e){const n=Object.assign({},D5);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:En.TRACER}).onSuccess()}};YP.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Vn.networkState,Mt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:En.TRACER}).onSuccess("logUploadError")});class z extends ${constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Sn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,T)}throw(){super.throw(T)}}const Si={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Re(){return Si}function XP(){return"setSinkId"in HTMLAudioElement.prototype&&(!M("RESTRICTION_SET_PLAYBACK_DEVICE")||(Xc()||sP())&&!mI())}function JP(){return!Si.supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Jc()}let Ti=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Kf(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function Se(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function fs(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function xI(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const P5={"90p":Se(160,90),"90p_1":Se(160,90),"120p":Se(160,120,15,30,65),"120p_1":Se(160,120,15,30,65),"120p_3":Se(120,120,15,30,50),"120p_4":Se(212,120),"180p":Se(320,180,15,30,140),"180p_1":Se(320,180,15,30,140),"180p_3":Se(180,180,15,30,100),"180p_4":Se(240,180,15,30,120),"240p":Se(320,240,15,40,200),"240p_1":Se(320,240,15,40,200),"240p_3":Se(240,240,15,40,140),"240p_4":Se(424,240,15,40,220),"360p":Se(640,360,15,80,400),"360p_1":Se(640,360,15,80,400),"360p_3":Se(360,360,15,80,260),"360p_4":Se(640,360,30,80,600),"360p_6":Se(360,360,30,80,400),"360p_7":Se(480,360,15,80,320),"360p_8":Se(480,360,30,80,490),"360p_9":Se(640,360,15,80,800),"360p_10":Se(640,360,24,80,800),"360p_11":Se(640,360,24,80,1e3),"480p":Se(640,480,15,100,500),"480p_1":Se(640,480,15,100,500),"480p_2":Se(640,480,30,100,1e3),"480p_3":Se(480,480,15,100,400),"480p_4":Se(640,480,30,100,750),"480p_6":Se(480,480,30,100,600),"480p_8":Se(848,480,15,100,610),"480p_9":Se(848,480,30,100,930),"480p_10":Se(640,480,10,100,400),"720p":Se(1280,720,15,120,1130),"720p_auto":Se(1280,720,30,900,3e3),"720p_1":Se(1280,720,15,120,1130),"720p_2":Se(1280,720,30,120,2e3),"720p_3":Se(1280,720,30,120,1710),"720p_5":Se(960,720,15,120,910),"720p_6":Se(960,720,30,120,1380),"1080p":Se(1920,1080,15,120,2080),"1080p_1":Se(1920,1080,15,120,2080),"1080p_2":Se(1920,1080,30,120,3e3),"1080p_3":Se(1920,1080,30,120,3150),"1080p_5":Se(1920,1080,60,120,4780),"1440p":Se(2560,1440,30,120,4850),"1440p_1":Se(2560,1440,30,120,4850),"1440p_2":Se(2560,1440,60,120,7350),"4k":Se(3840,2160,30,120,8910),"4k_1":Se(3840,2160,30,120,8910),"4k_3":Se(3840,2160,60,120,13500)},k5={"480p":fs(640,480,5),"480p_1":fs(640,480,5),"480p_2":fs(640,480,30),"480p_3":fs(640,480,15),"720p":fs(1280,720,5),"720p_auto":Se(1280,720,30,900,3e3),"720p_1":fs(1280,720,5),"720p_2":fs(1280,720,30),"720p_3":fs(1280,720,15),"1080p":fs(1920,1080,5),"1080p_1":fs(1920,1080,5),"1080p_2":fs(1920,1080,30),"1080p_3":fs(1920,1080,15)},M5={"1SL1TL":xI(1,1),"3SL3TL":xI(3,3),"2SL3TL":xI(2,3)};function $o(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},P5[t]):t}function VI(t){return typeof t=="string"?Object.assign({},k5[t]):t}function qv(t){return typeof t=="string"?Object.assign({},M5[t]):t}const U5={speech_low_quality:Kf(16e3,!1),speech_standard:Kf(32e3,!1,18),music_standard:Kf(48e3,!1),standard_stereo:Kf(48e3,!0,56),high_quality:Kf(48e3,!1,128),high_quality_stereo:Kf(48e3,!0,192)};function Xv(t){return typeof t=="string"?Object.assign({},U5[t]):t}const Yf=[];function QP(t){return Zn(t,"mediaSource",["screen","window","application"]),!0}let Nt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),ze=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),zf=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),x5=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),V5=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),oh=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),qf=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Xf=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Jf=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),da=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const BI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},FI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},ZP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},B5={uplinkNetworkQuality:0,downlinkNetworkQuality:0},$P={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ar=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),ha=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),gg=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),ch=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Qi=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),tc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const jI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Jv=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function tk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ln(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tk(Object(n),!0).forEach(function(i){Y(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Y(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Te(t,e,n,i,r){var s,c,l={};return Object.keys(i).forEach(function(d){l[d]=i[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=nr(s=id(c=n.slice()).call(c)).call(s,function(d,h){return h(t,e,d)||d},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(t,e,l),l=null),l}class ek extends hn{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(oh.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),Y(this,"trackMediaType",void 0),Y(this,"_ID",void 0),Y(this,"_rtpTransceiver",void 0),Y(this,"_lowRtpTransceiver",void 0),Y(this,"_hints",[]),Y(this,"_isClosed",!1),Y(this,"_originMediaStreamTrack",void 0),Y(this,"mediaStreamTrack",void 0),Y(this,"_external",{}),this._ID=n||Ye(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){_t(Yf).call(Yf,i)||Yf.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||_u(()=>{var n;Mt.reportApiInvoke(null,{name:Hn.GET_MEDIA_STREAM_TRACK,options:[],tag:En.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===zf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=Yf.indexOf(e);n!==-1&&Yf.splice(n,1)}(this),this.emit(qf.CLOSED),this.removeAllListeners(oh.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===zf.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(oh.TRANSCEIVER_UPDATED,e,n)}}class Qf extends ek{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),Y(this,"_enabled",!0),Y(this,"_muted",!1),Y(this,"_isExternalTrack",!1),Y(this,"_isClosed",!1),Y(this,"_enabledMutex",void 0),Y(this,"processor",void 0),Y(this,"_processorContext",void 0),Y(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ui("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(Nt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qf.TRACK_ENDED)}stateCheck(e,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Qc(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new $(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new $(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Tt.resolve([])}}const nk=window.AudioContext||window.webkitAudioContext;let pa=null;const ke=new class extends hn{constructor(){super(...arguments),Y(this,"prevState",void 0),Y(this,"curState",void 0),Y(this,"currentTime",void 0),Y(this,"currentTimeStuckAt",void 0),Y(this,"interruptDetectorTrack",void 0),Y(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(Ti.IOS_15_16_INTERRUPTION_START)}),Y(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(pa&&await pa.suspend(),this.emit(Ti.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){T.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){T.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Zf(){if(!pa){if(function(){if(!nk)return void T.error("your browser is not support web audio");T.info("create audio context");const t=ln({},M("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(t)),pa=new nk(t),ke.curState=pa.state,pa.onstatechange=()=>{ke.prevState=ke.curState,ke.curState=pa?pa.state:void 0;const{prevState:e,curState:n}=ke,i=n==="running",r=n==="interrupted",s=e==="running",c=e==="suspended",l=e==="interrupted",d=ge().osVersion;(rr()||hs())&&s&&r&&(T.info("ios".concat(d,"-interruption-start")),ke.emit(Ti.IOS_INTERRUPTION_START)),(rr()||hs())&&(c||l)&&i&&(T.info("ios".concat(d,"-interruption-end")),ke.emit(Ti.IOS_INTERRUPTION_END)),e!==n&&ke.emit(Ti.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=pa)===null||e===void 0?void 0:e.currentTime;ke.currentTime!==n?(ke.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),ke.currentTimeStuckAt=void 0),ke.currentTime=n):(n!==ke.currentTimeStuckAt&&(Mt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:En.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),ke.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,s=!1,c=!1;function l(y){e.state==="running"?d(!1):rr()||hs()?e.state==="suspended"&&(d(!0),y&&e.resume().then(h,h)):e.state!=="closed"&&(d(!0),y&&e.resume().then(h,h))}function d(y){if(r!==y){r=y;for(let C=0,N=n;C<N.length;C+=1){const D=N[C];y?window.addEventListener(D,p,{capture:!0,passive:!0}):window.removeEventListener(D,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function m(y){if(!c)if(i.paused)if(y){let C;_(!1),c=!0;try{C=i.play(),C?C.then(g,g):(i.addEventListener("playing",g),i.addEventListener("abort",g),i.addEventListener("error",g))}catch{g()}}else _(!0);else _(!1)}function _(y){if(s!==y){s=y;for(let C=0,N=n;C<N.length;C++){const D=N[C];y?window.addEventListener(D,I,{capture:!0,passive:!0}):window.removeEventListener(D,I,{capture:!0,passive:!0})}}}function g(){i.removeEventListener("playing",g),i.removeEventListener("abort",g),i.removeEventListener("error",g),c=!1,m(!1)}function I(){m(!0)}if(rr()){const y=e.createMediaStreamDestination(),C=document.createElement("div");C.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=C.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=y.stream,m(!0)}ke.on(Ti.STATE_CHANGE,function(){l(!0)}),l(!1)}(pa)}(),!pa)throw new $(L.NOT_SUPPORTED,"can not create audio context");return pa}return pa}function lh(t){if(function(){if(GI!==null)return GI;const i=Zf(),r=i.createBufferSource(),s=i.createGain(),c=i.createGain();r.connect(s),r.connect(c),r.disconnect(s);let l=!1;try{r.disconnect(s)}catch{l=!0}return r.disconnect(),GI=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,s)=>{var c;return t._inputNodes||(t._inputNodes=[]),_t(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,s)):e.call(t,i,r)),t},t.disconnect=(i,r,s)=>{n.call(t),i?Bv(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let GI=null;function HI(t,e){let n=!1;const i=1/e;if(M("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=Zf();let s=r.createGain();s.gain.value=0,s.connect(r.destination);const c=()=>{if(n)return void(s=null);const l=r.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class ik{constructor(){Y(this,"context",void 0),Y(this,"analyserNode",void 0),Y(this,"sourceNode",void 0),this.context=Zf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||rr()||hs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=nr(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class rk extends hn{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Y(this,"outputNode",void 0),Y(this,"outputTrack",void 0),Y(this,"isPlayed",!1),Y(this,"sourceNode",void 0),Y(this,"context",void 0),Y(this,"audioBufferNode",void 0),Y(this,"destNode",void 0),Y(this,"audioOutputLevel",0),Y(this,"volumeLevelAnalyser",void 0),Y(this,"_processedNode",void 0),Y(this,"playNode",void 0),Y(this,"isDestroyed",!1),Y(this,"onNoAudioInput",void 0),Y(this,"isNoAudioInput",!1),Y(this,"_noAudioInputCount",0),this.context=Zf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),lh(this.outputNode),this.volumeLevelAnalyser=new ik}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(da.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const s=i.outputBuffer.getChannelData(r);for(let c=0;c<s.length;c+=1)s[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Re().webAudioMediaStreamDest)throw new $(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Fv(()=>{ke.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;rr()||hs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let s=0;s<i.length;s++)i[s]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await gi(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ak extends rk{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),Y(this,"sourceNode",void 0),Y(this,"track",void 0),Y(this,"clonedTrack",void 0),Y(this,"audioElement",void 0),Y(this,"isCurrentTrackCloned",!1),Y(this,"isRemoteTrack",!1),Y(this,"originVolumeLevelAnalyser",void 0),Y(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),lh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),lh(this.outputNode),this.emit(da.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new $(L.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),lh(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,T.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([l]));lh(d),this.originVolumeLevelAnalyser=new ik,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const c=ge();n&&c.os===ni.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(ke.on(Ti.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),lh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(da.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),ke.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));lh(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function sk(t,e,n){const i=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function F5(t,e){const n=await ok(t.mediaSource),{sourceId:i,audio:r}=await function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Tt((l,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const g=document.createElement("div");g.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(N);const D=new Error("NotAllowedError");D.name="NotAllowedError",d(D)};let y=c;const C=document.createElement("div");if(c){const D=document.createElement("input");D.setAttribute("type","checkbox");const V=document.createElement("span");D.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",D.checked=y,D.onchange=()=>{y=D.checked},C.appendChild(D),C.appendChild(V)}g.appendChild(C),g.appendChild(I),p.appendChild(m),p.appendChild(_),p.appendChild(g);const N=document.createElement("div");N.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),N.appendChild(h),N.appendChild(p),document.body.appendChild(N),s.map(D=>{if(D.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let W=D.thumbnail;try{const{width:K}=W.getSize();K>1920&&(W=W.resize({width:1920}))}catch(K){throw K&&K.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),K}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+W.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+D.name.replace(/[\u00A0-\u9999<>\&]/g,function(K){return"&#"+K.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(N),l({sourceId:D.id,audio:y})},_.appendChild(V)}})})}(n,e);return await sk(i,t,r)}async function ok(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=SP();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new $(L.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new Tt((s,c)=>{n.desktopCapturer.getSources({types:e},(l,d)=>{l?c(l):s(d)})}));try{return await i}catch(s){throw new $(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const WI=new Ui("safari");let ck=!1,lk=!1;async function fa(t,e){let n=0,i=null;for(;n<2;)try{i=await j5(t,e,n>0);break}catch(r){if(r instanceof $)throw T.error("[".concat(e,"] ").concat(r.toString())),r;const s=Qv(r.name||r.code||r,r.message);if(s.code===L.MEDIA_OPTION_INVALID){T.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await gi(500);continue}throw T.error("[".concat(e,"] ").concat(s.toString())),s}if(!i)throw new $(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function j5(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new $(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=Re(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return T.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(SP())t.screen.sourceId?$f(r,await sk(t.screen.sourceId,t.screen,!!t.screenAudio)):$f(r,await F5(t.screen,!!t.screenAudio));else if(Xc()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new $(L.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const _=await(c=t.screen.extensionId,l=e,new Tt((g,I)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},y=>{if(!y||!y.streamId)return T.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),y),void I(new $(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));g(y.streamId)})}catch(y){T.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),y.toString()),I(new $(L.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=_,$f(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var s;t.screen.mediaSource&&QP(t.screen.mediaSource);const _={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(s=t.screen.displaySurface)!==null&&s!==void 0?s:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:g,surfaceSwitching:I,systemAudio:y,preferCurrentTab:C}=t.screen,N={selfBrowserSurface:g,surfaceSwitching:I,systemAudio:y,preferCurrentTab:C};!g&&delete N.selfBrowserSurface,!I&&delete N.surfaceSwitching,!y&&delete N.systemAudio,!C&&delete N.preferCurrentTab,T.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:_,audio:t.screenAudio,controls:N})),$f(r,await navigator.mediaDevices.getDisplayMedia(ln({video:_,audio:t.screenAudio},N)))}else{if(!mn())throw T.error("[".concat(e,"] This browser does not support screenSharing")),new $(L.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&QP(t.screen.mediaSource);const _={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};T.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(_))),$f(r,await navigator.mediaDevices.getUserMedia(_))}}var c,l;if(!t.video&&!t.audio)return r;let d={video:t.video,audio:t.audio},h=M("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=RI(d,h)}catch{}T.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),ge();let p,m=null;(Ii()||rr()||xv())&&(m=await WI.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(_){throw m&&m(),_}return d.audio&&(ck=!0),d.video&&(lk=!0),$f(r,p),m&&m(),r}function Qv(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new $(L.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new $(L.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new $(L.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new $(L.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new $(L.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new $(L.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return T.error("getUserMedia unexpected error",t),new $(L.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function $f(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(i&&t.removeTrack(i),t.addTrack(s)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const ma=new class extends hn{get state(){return this._state}set state(t){t!==this._state&&(this.emit(ch.STATE_CHANGE,t),this._state=t)}constructor(){super(),Y(this,"_state",gg.IDLE),Y(this,"isAccessMicrophonePermission",!1),Y(this,"isAccessCameraPermission",!1),Y(this,"lastAccessMicrophonePermission",!1),Y(this,"lastAccessCameraPermission",!1),Y(this,"checkdeviceMatched",!1),Y(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(M("ENUMERATE_DEVICES_INTERVAL")||(Vv()||Uv()===ni.HARMONY_OS)&&Jc())&&this.updateDevicesInfo()},M("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>T.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new $(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let s=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(s=!1),r.video&&(c=!1);let l=null,d=null,h=null;if(!n&&(s||c)){if(WI.isLocked&&(T.debug("[device manager] wait GUM lock"),(await WI.lock())(),T.debug("[device manager] GUM unlock")),ck&&(s=!1,this.isAccessMicrophonePermission=!0),lk&&(c=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",t,e,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const m=Qv(p.name||p.code||p,p.message);if(m.code===L.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(p){const m=Qv(p.name||p.code||p,p.message);if(m.code===L.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){const m=Qv(p.name||p.code||p,p.message);if(m.code===L.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",t,"cam permission",e)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,p}catch(p){return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,new $(L.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new $(L.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=gg.INITING;try{await this.updateDevicesInfo(),this.state=gg.INITEND}catch(t){throw T.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=gg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new $(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&s?s.groupId===r.groupId?T.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is the same group")):T.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is not the same group")):T.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const s=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((r,s)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==gg.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ch.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ch.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ch.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let KI=!1;const _a=new class extends hn{constructor(){super(...arguments),Y(this,"onAutoplayFailed",void 0),Y(this,"onAudioAutoplayFailed",void 0)}};function uk(){if(ge(),!KI){const t=e=>{e.preventDefault(),KI=!1,lg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};KI=!0,lg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),_a.onAutoplayFailed?_a.onAutoplayFailed():_a.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),_a.emit("autoplay-failed")}}function dk(t,e,n,i){if(!t)return;const r=Mt.getBaseInfoBySessionId(t);if(!r)return;const s=r.info,c=Date.now(),l=ln(ln({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-r.startTime,cbRegistered:_a.onAutoplayFailed||_a.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});Mt.send({type:cn.AUTOPLAY_FAILED,data:l},!0)}const G5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Er=new class{constructor(){Y(this,"onAutoplayFailed",void 0),Y(this,"elementMap",new Map),Y(this,"elementStateMap",new Map),Y(this,"elementsNeedToResume",[]),Y(this,"sinkIdMap",new Map),Y(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),s=i.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(T.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(ke.curState==="running")return Bf()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),Y(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),ke.on(Ti.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.on(Ti.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ke.on(Ti.STATE_CHANGE,()=>{rr()&&ke.prevState==="suspended"&&ke.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new $(L.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,Qi.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{r.setSinkId(s).catch(l=>{T.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){T.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&dk(i,"audio",l.message,e),T.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),Fv(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),uk()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){G5.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),s=i.type==="pause"?"paused":i.type;if(T.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(s)),i.type==="error"){const c=e==null?void 0:e.error;c&&T.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,s)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Tt(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{lg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Dn(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new $(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];const l=i.apply(this,s);return l instanceof Tt?new Tt((d,h)=>{l.then(d).catch(h)}):l}),n}}class hk extends hn{constructor(e){super(),Y(this,"name","VideoProcessorDestination"),Y(this,"ID","0"),Y(this,"_source",void 0),Y(this,"videoContext",void 0),Y(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new $(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new $(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(ar.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ar.ON_TRACK,void 0)}}class pk extends hn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),Y(this,"constraintsMap",new Map),Y(this,"statsRegistry",[]),Y(this,"usageRegistry",[]),Y(this,"trackId",void 0),Y(this,"direction",void 0),Y(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await wi(this,ha.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return T.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new $(L.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Tt&&(i=await i),e.push(ln(ln({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class fk extends hn{constructor(e){super(),Y(this,"name","AudioProcessorDestination"),Y(this,"ID","0"),Y(this,"inputTrack",void 0),Y(this,"inputNode",void 0),Y(this,"audioProcessorContext",void 0),Y(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new $(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new $(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ar.ON_TRACK,void 0),this.emit(ar.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(ar.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(ar.ON_NODE,this.inputNode))}}class mk extends hn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),Y(this,"constraintsMap",new Map),Y(this,"statsRegistry",[]),Y(this,"audioContext",void 0),Y(this,"trackId",void 0),Y(this,"direction",void 0),Y(this,"usageRegistry",[]),Y(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return wi(this,ha.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new $(L.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Tt&&(i=await i),e.push(ln(ln({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class YI extends hn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Y(this,"context",void 0),Y(this,"processSourceNode",void 0),Y(this,"outputTrack",void 0),Y(this,"processedNode",void 0),Y(this,"clonedTrack",void 0),Y(this,"outputNode",void 0),this.outputNode=new H5}setVolume(){}createOutputTrack(){throw new $(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class H5{disconnect(){}connect(){}}function _k(t){return new Tt((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const s=rr()?"canplay":"playing";r.addEventListener(s,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&mn()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(jv),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function Zv(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=$o(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!fP()&&n.frameRate&&(e.frameRate=n.frameRate),sP()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),mn()&&(e.frameRate={ideal:30,max:30}),e}function Ek(t){const e={};return fP()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Xc()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function gk(t){const e=Ek(t);if(t.encoderConfig){const n=Xv(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),Vv()&&(e.sampleRate=void 0),e}const W5=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:s=n,width:c=i,height:l=r}=e;if(!s||!c||!l)return;c=vI(c),l=vI(l),s=vI(s);const{max:d,min:h}=function(g,I,y){const C=200*Math.pow(y/15,.6)*Math.pow(g*I/640/360,.75);return{min:Math.floor(C),max:Math.floor(4*C)}}(c,l,s),{bitrateMax:p,bitrateMin:m}=e||{};p||T.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]"));const{maxFramerate:_}=M("ENCODER_CONFIG_LIMIT");return _&&typeof _=="number"&&(s=Math.min(s,_)),{frameRate:s,bitrateMax:p||d,bitrateMin:m||h,scaleResolutionDownBy:1,scale:0}},Sk=async(t,e,n)=>await(async(i,r,s)=>{const c=function(h){const p=[];for(let m=0;m<h.length;m+=2)p.push(parseInt(h.slice(m,m+2),16));return Uint8Array.from(p)}(NP(""+r+s)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,i))})(t.buffer,e,n),zI=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new Tt((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const s=await Tk(r);n({buffer:s,width:e.width,height:e.height})}else i(new $(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Tk=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var Rk,vk,yk,Ck,Ak,bk,Ik,Ok,wk,Nk,Dk,Lk,Pk,kk,Mk,Uk,xk,Vk,pn,Bk,Fk,jk,Gk,Hk,Wk,ec,Kk,Yk,zk,qk,Xk,Jk,Qk,Zk,$k,tM,eM,nM,iM,Di;let vn=(Rk=Gt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),vk=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),yk=Dn(),Ck=Gf("LocalAudioTrack","_enabledMutex"),Ak=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),bk=Dn(),Ik=Gf("LocalAudioTrack","_enabledMutex"),Ok=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),wk=Dn(),Nk=Dn(),Dk=Dn(),Lk=Gt({argsMap:t=>[t.getTrackId()]}),Pk=Dn(),kk=Gt({argsMap:t=>[t.getTrackId()]}),Mk=Dn(),Uk=Gt({argsMap:t=>[t.getTrackId()]}),xk=Gt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Vk=Gt({argsMap:t=>[t.getTrackId()]}),Te((pn=class extends Qf{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Er.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),Y(this,"trackMediaType",Jf.AUDIO),Y(this,"_encoderConfig",void 0),Y(this,"_trackSource",void 0),Y(this,"metadata",[]),Y(this,"_enabled",!0),Y(this,"_volume",100),Y(this,"_useAudioElement",!0),Y(this,"_bypassWebAudio",!1),Y(this,"processor",void 0),Y(this,"_processorContext",void 0),Y(this,"_processorDestination",void 0),Y(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new YI,M("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),M("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ii()&&!pa?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){Ve(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Er.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Ke(this,Nt.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!XP())throw new $(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Er.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Ke(this,Nt.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Ke(this,Nt.NEED_MUTE_TRACK,this):await Ke(this,Nt.NEED_UNMUTE_TRACK,this))}getStats(){return _u(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},BI)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(da.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(da.ON_AUDIO_BUFFER),this._source.on(da.ON_AUDIO_BUFFER,n=>t(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Er.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Er.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Er.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return Tt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new $(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(ar.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Ke(this,Nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this))}),t.on(ar.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(ar.ON_TRACK),t.removeAllListeners(ar.ON_NODE)}bindProcessorContextEvents(t){t.on(ha.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(ha.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof YI&&(this._trackSource=new ak(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new mk(this._source.context,this.getTrackId(),"local"),e=new fk(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(da.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Er.stop(this.getTrackId()),this._source.play()),Ke(this,Nt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[Rk],Object.getOwnPropertyDescriptor(pn.prototype,"setVolume"),pn.prototype),Te(pn.prototype,"setPlaybackDevice",[vk,yk],Object.getOwnPropertyDescriptor(pn.prototype,"setPlaybackDevice"),pn.prototype),Te(pn.prototype,"setEnabled",[Ck,Ak,bk],Object.getOwnPropertyDescriptor(pn.prototype,"setEnabled"),pn.prototype),Te(pn.prototype,"setMuted",[Ik,Ok,wk],Object.getOwnPropertyDescriptor(pn.prototype,"setMuted"),pn.prototype),Te(pn.prototype,"getStats",[Nk],Object.getOwnPropertyDescriptor(pn.prototype,"getStats"),pn.prototype),Te(pn.prototype,"setAudioFrameCallback",[Dk],Object.getOwnPropertyDescriptor(pn.prototype,"setAudioFrameCallback"),pn.prototype),Te(pn.prototype,"play",[Lk,Pk],Object.getOwnPropertyDescriptor(pn.prototype,"play"),pn.prototype),Te(pn.prototype,"stop",[kk,Mk],Object.getOwnPropertyDescriptor(pn.prototype,"stop"),pn.prototype),Te(pn.prototype,"close",[Uk],Object.getOwnPropertyDescriptor(pn.prototype,"close"),pn.prototype),Te(pn.prototype,"pipe",[xk],Object.getOwnPropertyDescriptor(pn.prototype,"pipe"),pn.prototype),Te(pn.prototype,"unpipe",[Vk],Object.getOwnPropertyDescriptor(pn.prototype,"unpipe"),pn.prototype),pn),$v=(Bk=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),Fk=Dn(),jk=Gf("MicrophoneAudioTrack","_enabledMutex"),Gk=Gt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),Hk=Dn(),Wk=Gt({argsMap:t=>[t.getTrackId()]}),Te((ec=class extends vn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?Xv(e.encoderConfig):{},i,M("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Y(this,"_config",void 0),Y(this,"_deviceName","default"),Y(this,"_constraints",void 0),Y(this,"_originalConstraints",void 0),Y(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Bf()||fI())&&ke.bindInterruptDetectorTrack(this)}async setDevice(t){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await ma.getDeviceById(t),n={};n.audio=ln({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await fa(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await fa({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await ma.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}T.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),M("AUTO_RESET_AUDIO_ROUTE")&&(rr()||hs())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(c){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=ln({},this._constraints),s=ma.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{n||(this._enabled=!0);const c=await fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Ke(this,Nt.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Bf()||fI())&&ke.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((rr()||hs())&&this._enabled&&!this._isClosed&&ke.duringInterruption){const t=async()=>{ke.off(Ti.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ke.on(Ti.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qf.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=ma.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(ha.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(ha.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Bk,Fk],Object.getOwnPropertyDescriptor(ec.prototype,"setDevice"),ec.prototype),Te(ec.prototype,"setEnabled",[jk,Gk,Hk],Object.getOwnPropertyDescriptor(ec.prototype,"setEnabled"),ec.prototype),Te(ec.prototype,"close",[Wk],Object.getOwnPropertyDescriptor(ec.prototype,"close"),ec.prototype),ec),K5=(Kk=Gt({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),Yk=Dn(),zk=Gt({argsMap:t=>[t.getTrackId()]}),qk=Dn(),Xk=Gt({argsMap:t=>[t.getTrackId()]}),Jk=Dn(),Qk=Gt({argsMap:t=>[t.getTrackId()]}),Zk=Dn(),$k=Gt({argsMap:t=>[t.getTrackId()]}),tM=Dn(),eM=Gt({argsMap:t=>[t.getTrackId()]}),nM=Gt({argsMap:t=>[t.getTrackId()]}),iM=Dn(),Te((Di=class extends vn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),Y(this,"source",void 0),Y(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(da.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(qf.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Ve(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[Kk,Yk],Object.getOwnPropertyDescriptor(Di.prototype,"startProcessAudioBuffer"),Di.prototype),Te(Di.prototype,"pauseProcessAudioBuffer",[zk,qk],Object.getOwnPropertyDescriptor(Di.prototype,"pauseProcessAudioBuffer"),Di.prototype),Te(Di.prototype,"seekAudioBuffer",[Xk,Jk],Object.getOwnPropertyDescriptor(Di.prototype,"seekAudioBuffer"),Di.prototype),Te(Di.prototype,"resumeProcessAudioBuffer",[Qk,Zk],Object.getOwnPropertyDescriptor(Di.prototype,"resumeProcessAudioBuffer"),Di.prototype),Te(Di.prototype,"stopProcessAudioBuffer",[$k,tM],Object.getOwnPropertyDescriptor(Di.prototype,"stopProcessAudioBuffer"),Di.prototype),Te(Di.prototype,"close",[eM],Object.getOwnPropertyDescriptor(Di.prototype,"close"),Di.prototype),Te(Di.prototype,"setAudioBufferPlaybackSpeed",[nM,iM],Object.getOwnPropertyDescriptor(Di.prototype,"setAudioBufferPlaybackSpeed"),Di.prototype),Di);class qn extends vn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Zf().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Ye(8,"track-mix-")),Y(this,"trackList",void 0),Y(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(T.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):T.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){T.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}Bv(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof qn?n.emit(oh.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class Y5 extends rk{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(da.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Y(this,"audioBuffer",void 0),Y(this,"sourceNode",void 0),Y(this,"startPlayTime",0),Y(this,"startPlayOffset",0),Y(this,"pausePlayTime",0),Y(this,"options",void 0),Y(this,"currentLoopCount",0),Y(this,"currentPlaybackSpeed",100),Y(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const rM=new Map;class qI{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){Y(this,"trackId",void 0),Y(this,"config",void 0),Y(this,"onFirstVideoFrameDecoded",void 0),Y(this,"onVideoStateChanged",void 0),Y(this,"freezeTimeCounterList",[]),Y(this,"renderFreezeAccTime",0),Y(this,"isKeepLastFrame",!1),Y(this,"timeUpdatedCount",0),Y(this,"freezeTime",0),Y(this,"playbackTime",0),Y(this,"lastTimeUpdatedTime",0),Y(this,"autoplayFailed",!1),Y(this,"videoTrack",void 0),Y(this,"videoElement",void 0),Y(this,"cacheVideoElement",void 0),Y(this,"renderStats",void 0),Y(this,"_videoState",tc.VideoStateStopped),Y(this,"videoElementCheckInterval",void 0),Y(this,"videoElementFreezeTimeout",void 0),Y(this,"_videoElementStatus",Qi.NONE),Y(this,"isGettingVideoDimensions",!1),Y(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),Y(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ke.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(aP())),hP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Y(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Qi.PLAYING;break;case"loadeddata":if(this.videoState=tc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Qi.CANPLAY;break;case"stalled":this.videoElementStatus=Qi.STALLED;break;case"suspend":this.videoElementStatus=Qi.SUSPEND;break;case"pause":this.videoElementStatus=Qi.PAUSED,rr()||hs()||Ii()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Qi.WAITING;break;case"abort":this.videoElementStatus=Qi.ABORT;break;case"ended":this.videoElementStatus=Qi.ENDED;break;case"emptied":this.videoElementStatus=Qi.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Qi.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,$c.lastVisibleTime<$c.lastHiddenTime||s<$c.lastHiddenTime||s<$c.lastVisibleTime)return;for(r>M("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Y(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(aP())),hP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),ke.on(Ti.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.on(Ti.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&dk(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),r)});const i=ge();if((i.name==="Safari"&&Number(i.version)===15||Bf())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new Tt((s,c)=>{i.toBlob(async l=>{if(i.remove(),l){const d=await Tk(l);s({buffer:d,width:i.width,height:i.height})}else c(new $(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await zI(e)}destroy(){this.renderStats=void 0,ke.off(Ti.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.off(Ti.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=tc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Qi.INIT,!this.videoElementCheckInterval&&(aM.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=Qi.DESTROYED)},1e3),M("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let s;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,M("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===tc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=tc.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(h,p)=>{if(this.videoElementStatus===Qi.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=p.mediaTime):this.renderStats={lastTs:p.mediaTime,curTs:p.mediaTime,lastRenderNum:0,renderNum:0},s){const g=p.presentationTime-s.presentationTime;this.videoState===tc.VideoStateStarting&&(this.videoState=tc.VideoStateDecoding),this.videoState===tc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,M("VIDEO_FREEZE_DURATION"))),g<M("VIDEO_FREEZE_DURATION")&&this.videoState===tc.VideoStateFrozen&&(this.videoState=tc.VideoStateDecoding),g>M("VIDEO_FREEZE_DURATION")&&$c.lastVisibleTime>=$c.lastHiddenTime&&s.timestamp>$c.lastVisibleTime&&s.timestamp>$c.lastHiddenTime&&(this.renderFreezeAccTime+=g)}s=ln(ln({},p),{},{timestamp:h})}var m,_;M("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(_=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(_,d))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Vv()&&!M("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=ge();i.name==="Safari"&&Number(i.version)===15||Bf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,mn()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(s=>{T.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){aM.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Qi.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{T.error(i)}),this.autoplayFailed=!1,lg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};lg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),uk()}}const aM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class sM extends qI{constructor(e){super(e),Y(this,"container",void 0),Y(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await zI(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",M("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var oM,cM,lM,uM,dM,hM,pM,fM,mM,_M,EM,gM,SM,TM,RM,vM,yM,CM,AM,bM,IM,OM,wM,NM,me,DM,LM,PM,kM,MM,UM,xM,VM,Ea;let nn=(oM=Gt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),cM=Dn(),lM=Gt({argsMap:t=>[t.getTrackId()]}),uM=Gf("LocalVideoTrack","_enabledMutex"),dM=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),hM=Dn(),pM=Gf("LocalVideoTrack","_enabledMutex"),fM=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),mM=Dn(),_M=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),EM=Dn(),gM=Dn(),SM=Gt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),TM=Dn(),RM=Dn(),vM=Dn(),yM=Dn(),CM=Dn(),AM=Dn(),bM=Dn(),IM=Gt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),OM=Gt({argsMap:t=>[t.getTrackId()]}),wM=Gt({argsMap:t=>[t.getTrackId()]}),NM=Gt({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),me=class nB extends Qf{get videoHeight(){if(Ii()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ii()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,s,c){if(super(e,s),Y(this,"trackMediaType",Jf.VIDEO),Y(this,"_player",void 0),Y(this,"isUseScaleResolutionDownBy",!1),Y(this,"_videoVisibleTimer",null),Y(this,"_previousVideoVisibleStatus",void 0),Y(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Y(this,"_encoderConfig",void 0),Y(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Y(this,"_optimizationMode",void 0),Y(this,"_videoHeight",void 0),Y(this,"_videoWidth",void 0),Y(this,"_forceBitrateLimit",void 0),Y(this,"_enabled",!0),Y(this,"_processorDestination",void 0),Y(this,"_processorContext",void 0),Ii()){const{width:l,height:d}=e.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],this._hints.indexOf(ze.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(dI(Ce.CHROME,115)&&Uv().indexOf("Windows")!==-1){const l=function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&Re().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(d),m=new MediaStreamTrackGenerator({kind:"video"});let _,g,I=Date.now();const y=()=>{C&&(clearInterval(C),C=void 0),_&&(_.close(),_=void 0),d.stop(),g=void 0,m.removeEventListener("ended",y)};let C=window.setInterval(()=>{if(g&&_&&Date.now()-I>1e3)try{m.readyState==="live"?g.enqueue(_.clone()):y()}catch{y()}},1e3);const N=new TransformStream({transform:(D,V)=>{m.readyState==="live"?(g=V,I=Date.now(),_===void 0?(_=D,V.enqueue(D.clone())):(V.enqueue(_),_=D)):D.close()}});return m.addEventListener("ended",y),p.readable.pipeThrough(N).pipeTo(m.writable),m}}(e);l&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(ze.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new pk(this.getTrackId(),"local"),this._processorDestination=new hk(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=ln(ln(ln({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new qI(i):this._player=new sM(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(qf.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Ke(this,Nt.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ke(this,Nt.NEED_MUTE_TRACK,this):await Ke(this,Nt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=$o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=Zv({encoderConfig:e});(Ii()||rr()||hs())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const s=new $(L.UNEXPECTED_ERROR,r.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ke(this,Nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(T)}}getStats(){return _u(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},FI)}async setBeautyEffect(e){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await zI(e)}async setBitrateLimit(e){T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void T.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Ke(this,Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return T.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){_k(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(jv)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=$o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ke(this,Nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:s}=this._encoderConfig;if(s==null||r==null){const{max:c,min:l}=function(d,h,p,m,_){const g=M("BITRATE_ADAPTER_TYPE");if(g==="DEFAULT_BITRATE")return{min:m,max:_};if(_===void 0){var I;const C=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*h/640/360,.75));_=g==="STANDARD_BITRATE"?4*C:2*C,m=(I=m)!==null&&I!==void 0?I:C}else{var y;m=(y=m)!==null&&y!==void 0?y:Math.floor(_/10)}return{min:m,max:_}}(e,n,i,s,r);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:s,slot:c}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=EP.checkOneElementVisible(s),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const h=Mt.reportApiInvoke(null,{tag:En.TRACER,name:Hn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(i){throw new $(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ln(ln({},i),$o(e))),i=ih(i);const r=Ye(8,"track-video-cloned-"),s=new nB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,ih(this._scalabilityMode),this._optimizationMode,r,ih(this._hints));return e&&i&&s.setEncoderConfiguration(i),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new $(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new $(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(_u(()=>{Mt.reportApiInvoke(null,{name:Hn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:En.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!M("ENABLE_VIDEO_SEI")||!M("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new $(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):T.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(ar.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ar.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ha.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ha.REQUEST_CONSTRAINTS)}},Te(me.prototype,"play",[oM,cM],Object.getOwnPropertyDescriptor(me.prototype,"play"),me.prototype),Te(me.prototype,"stop",[lM],Object.getOwnPropertyDescriptor(me.prototype,"stop"),me.prototype),Te(me.prototype,"setEnabled",[uM,dM,hM],Object.getOwnPropertyDescriptor(me.prototype,"setEnabled"),me.prototype),Te(me.prototype,"setMuted",[pM,fM,mM],Object.getOwnPropertyDescriptor(me.prototype,"setMuted"),me.prototype),Te(me.prototype,"setEncoderConfiguration",[_M,EM],Object.getOwnPropertyDescriptor(me.prototype,"setEncoderConfiguration"),me.prototype),Te(me.prototype,"getStats",[gM],Object.getOwnPropertyDescriptor(me.prototype,"getStats"),me.prototype),Te(me.prototype,"setBeautyEffect",[SM,TM],Object.getOwnPropertyDescriptor(me.prototype,"setBeautyEffect"),me.prototype),Te(me.prototype,"getCurrentFrameData",[RM],Object.getOwnPropertyDescriptor(me.prototype,"getCurrentFrameData"),me.prototype),Te(me.prototype,"getCurrentFrameImage",[vM],Object.getOwnPropertyDescriptor(me.prototype,"getCurrentFrameImage"),me.prototype),Te(me.prototype,"setBitrateLimit",[yM],Object.getOwnPropertyDescriptor(me.prototype,"setBitrateLimit"),me.prototype),Te(me.prototype,"setOptimizationMode",[CM],Object.getOwnPropertyDescriptor(me.prototype,"setOptimizationMode"),me.prototype),Te(me.prototype,"setScalabiltyMode",[AM],Object.getOwnPropertyDescriptor(me.prototype,"setScalabiltyMode"),me.prototype),Te(me.prototype,"updateMediaStreamTrackResolution",[bM],Object.getOwnPropertyDescriptor(me.prototype,"updateMediaStreamTrackResolution"),me.prototype),Te(me.prototype,"pipe",[IM],Object.getOwnPropertyDescriptor(me.prototype,"pipe"),me.prototype),Te(me.prototype,"unpipe",[OM],Object.getOwnPropertyDescriptor(me.prototype,"unpipe"),me.prototype),Te(me.prototype,"close",[wM],Object.getOwnPropertyDescriptor(me.prototype,"close"),me.prototype),Te(me.prototype,"replaceTrack",[NM],Object.getOwnPropertyDescriptor(me.prototype,"replaceTrack"),me.prototype),me),XI=(DM=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),LM=Dn(),PM=Gf("CameraVideoTrack","_enabledMutex"),kM=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),MM=Dn(),UM=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),xM=Dn(),VM=Gt({argsMap:t=>[t.getTrackId()]}),Ea=class iB extends nn{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,s,c){super(e,$o(n.encoderConfig),r,s,c),Y(this,"_config",void 0),Y(this,"_originalConstraints",void 0),Y(this,"_constraints",void 0),Y(this,"_enabled",!0),Y(this,"_deviceName","default"),Y(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Bf()||fI())&&!function(){const l=ge();if(l.os!==ni.IOS||!l.osVersion)return!1;const d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&pP()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=$o(this._config.encoderConfig),ke.on(Ti.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ke.on(Ti.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await ma.getDeviceById(e),i={};i.video=ln({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await fa(i,this.getTrackId())}catch(s){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await ma.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:ln(ln({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await fa(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=ln({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await fa({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Ke(this,Nt.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=$o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=gn(this._config);i.encoderConfig=e;const r=Zv(i);(Ii()||rr()||hs())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){const c=new $(L.UNEXPECTED_ERROR,s.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ke(this,Nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((rr()||hs())&&this._enabled&&!this._isClosed&&ke.duringInterruption){const e=async()=>{ke.off(Ti.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ke.on(Ti.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qf.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=ma.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await fa({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ke.off(Ti.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ke.off(Ti.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ln(ln({},i),$o(e))),i=ih(i);const r=Ye(8,"track-cam-cloned-"),s=new iB(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,ih(ln(ln({},this._config),{},{encoderConfig:i})),ih(this._constraints),ih(this._scalabilityMode),this._optimizationMode,r);return e&&i&&s.setEncoderConfiguration(i),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(ha.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(ha.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Te(Ea.prototype,"setDevice",[DM,LM],Object.getOwnPropertyDescriptor(Ea.prototype,"setDevice"),Ea.prototype),Te(Ea.prototype,"setEnabled",[PM,kM,MM],Object.getOwnPropertyDescriptor(Ea.prototype,"setEnabled"),Ea.prototype),Te(Ea.prototype,"setEncoderConfiguration",[UM,xM],Object.getOwnPropertyDescriptor(Ea.prototype,"setEncoderConfiguration"),Ea.prototype),Te(Ea.prototype,"close",[VM],Object.getOwnPropertyDescriptor(Ea.prototype,"close"),Ea.prototype),Ea);function JI(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=ln(ln({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?T.debug("[".concat(t,"] set content hint to"),n.optimizationMode):T.debug("[".concat(t,"] set content hint failed")))):T.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var BM,FM,jM,GM,Va,HM,WM,KM,YM,zM,qM,Zi;class XM extends ek{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(Ye(5,""))),Y(this,"_userId",void 0),Y(this,"_uintId",void 0),Y(this,"_isDestroyed",!1),Y(this,"store",void 0),Y(this,"processor",void 0),Y(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let tm=(BM=Gt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),FM=Gt({argsMap:t=>[t.getTrackId()]}),jM=Gt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),GM=Gt({argsMap:t=>[t.getTrackId()]}),Te((Va=class extends XM{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),Y(this,"_videoVisibleTimer",null),Y(this,"_previousVideoVisibleStatus",void 0),Y(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Y(this,"trackMediaType",Jf.VIDEO),Y(this,"_videoWidth",void 0),Y(this,"_videoHeight",void 0),Y(this,"_player",void 0),Y(this,"processorDestination",void 0),Y(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new pk(this.getTrackId(),"remote"),this.processorDestination=new hk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return _u(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},$P)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=ln(ln({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new qI(n):this._player=new sM(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Xf.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(Xf.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Xf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){_k(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(jv)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const c=EP.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const d=Mt.reportApiInvoke(null,{tag:En.TRACER,name:Hn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new $(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ar.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ar.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(oh.SEI_RECEIVED,t)}}).prototype,"play",[BM],Object.getOwnPropertyDescriptor(Va.prototype,"play"),Va.prototype),Te(Va.prototype,"stop",[FM],Object.getOwnPropertyDescriptor(Va.prototype,"stop"),Va.prototype),Te(Va.prototype,"pipe",[jM],Object.getOwnPropertyDescriptor(Va.prototype,"pipe"),Va.prototype),Te(Va.prototype,"unpipe",[GM],Object.getOwnPropertyDescriptor(Va.prototype,"unpipe"),Va.prototype),Va),em=(HM=Gt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),WM=Gt({argsMap:(t,e)=>[t.getTrackId(),e]}),KM=Gt({argsMap:t=>[t.getTrackId()]}),YM=Gt({argsMap:t=>[t.getTrackId()]}),zM=Gt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),qM=Gt({argsMap:t=>[t.getTrackId()]}),Te((Zi=class extends XM{get isPlaying(){return this._useAudioElement?Er.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),Y(this,"trackMediaType",Jf.AUDIO),Y(this,"_source",void 0),Y(this,"_useAudioElement",!0),Y(this,"_volume",100),Y(this,"processorContext",void 0),Y(this,"processorDestination",void 0),Y(this,"_played",!1),Y(this,"_bypassWebAudio",!1),M("DISABLE_WEBAUDIO")?(this._source=new YI,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ak(t,!0),M("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(da.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Xf.FIRST_FRAME_DECODED)}),this.processorContext=new mk(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new fk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(da.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(da.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(da.ON_AUDIO_BUFFER),this._source.on(da.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Er.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!XP())throw new $(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Er.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return _u(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},ZP)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),Er.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Er.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Er.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ar.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ar.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ar.ON_TRACK),this.processorDestination.removeAllListeners(ar.ON_NODE)}}).prototype,"setVolume",[HM],Object.getOwnPropertyDescriptor(Zi.prototype,"setVolume"),Zi.prototype),Te(Zi.prototype,"setPlaybackDevice",[WM],Object.getOwnPropertyDescriptor(Zi.prototype,"setPlaybackDevice"),Zi.prototype),Te(Zi.prototype,"play",[KM],Object.getOwnPropertyDescriptor(Zi.prototype,"play"),Zi.prototype),Te(Zi.prototype,"stop",[YM],Object.getOwnPropertyDescriptor(Zi.prototype,"stop"),Zi.prototype),Te(Zi.prototype,"pipe",[zM],Object.getOwnPropertyDescriptor(Zi.prototype,"pipe"),Zi.prototype),Te(Zi.prototype,"unpipe",[qM],Object.getOwnPropertyDescriptor(Zi.prototype,"unpipe"),Zi.prototype),Zi);const $c=new class extends hn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Y(this,"_lastHiddenTime",0),Y(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class JM extends hn{constructor(e,n){super(),Y(this,"trackMediaType",Jf.DATA),Y(this,"_version",1),Y(this,"_type",3),Y(this,"_config",void 0),Y(this,"_originDataChannel",void 0),Y(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Y(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),Y(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return M("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Tt((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new $(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new $(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new $(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Jv.OPEN,Jv.CLOSE,Jv.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class z5 extends JM{constructor(e){super(e),Y(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(M("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(Jv.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class q5 extends JM{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function ty(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>tv.revokeObjectURL(t),0),new Worker(tv.createObjectURL(t))}const QM=71,QI=1,ZI=2,$I=1,ZM=2;var tl=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(tl||{});function $M(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==QM)return;const i=t.getUint16(1),r=QI+ZI+i,s=new Uint8Array(t.byteLength-r);s.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:s};let l=QI+ZI;for(;l<r;){const d=t.getUint8(l),h=t.getUint16(l+$I),p=$I+ZM;if(d===tl.AUDIO_LEVEL){let m=t.getUint8(l+p);for(let _=1;_<h;_++)m=m<<8|t.getUint8(l+p+_);c.tlv.push({tag:d,length:h,value:e?127^m>>1:127&m})}else if(d===tl.METADATA||d===tl.AUDIO_64_BIT_PTS){const m=new Uint8Array(h);for(let _=0;_<h;_++)m[_]=t.getUint8(l+p+_);c.tlv.push({tag:d,length:h,value:m})}l+=p+h}return c}const ey=new Map,ny=127,uh=1e-10,tO=139/13,iy=new Map;function eO(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return iy.has(i)?r=iy.get(i):(r=Math.log(function(c,l){const d=c-l;l<d&&(l=d);let h=1;for(let p=c,m=1;p>l;p--,m++)h=h*p/m;return h}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,iy.set(i,r)),r<uh&&(r=uh),r}function t1(t,e,n){const i=e.length,r=t.length/i;let s=!1;for(let c=0,l=0;c<i;c++){let d=0;for(let h=l+r;l<h;l++)t[l]>n&&d++;e[c]!==d&&(e[c]=d,s=!0)}return s}window.cache=iy;let X5=0;class e1{constructor(e){Y(this,"id",void 0),Y(this,"immediates",[]),Y(this,"lastNonSilence",-1),Y(this,"immediateSpeechActivityScore",uh),Y(this,"lastLevelChangedTime",Date.now()),Y(this,"levels",[]),Y(this,"longs",[]),Y(this,"longSpeechActivityScore",uh),Y(this,"mediums",[]),Y(this,"mediumSpeechActivityScore",uh),Y(this,"minLevel",0),Y(this,"nextMinLevel",0),Y(this,"nextMinLevelWindowLength",0),Y(this,"energyScore",0),this.id=e||"".concat(X5++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+tO;let r=!1;for(let s=0;s<e.length;++s){let c=n[s];c<i&&(c=0);const l=Math.floor(c/tO);e[s]!==l&&(e[s]=l,r=!0)}return r}computeLongs(){return t1(this.mediums,this.longs,4)}computeMediums(){return t1(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=eO(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=eO(this.longs[0],10,47),this.longSpeechActivityScore>uh&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=eO(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(id(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>ny&&(i=ny),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+tO?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>ny&&(n=ny),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class J5{constructor(e){Y(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class nO{constructor(e,n,i){Y(this,"isDominant",void 0),Y(this,"energyRanking",void 0),Y(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class Q5 extends hn{constructor(e){super(),Y(this,"dominantId",null),Y(this,"lastDecisionTime",0),Y(this,"lastLevelChangedTime",0),Y(this,"lastLevelIdleTime",0),Y(this,"relativeSpeechActivities",[]),Y(this,"speakers",new Map),Y(this,"enableSilence",!1),Y(this,"timeoutToSilenceInterval",0),Y(this,"decisionMaker",null),Y(this,"loudest",[]),Y(this,"numLoudestToTrack",3),Y(this,"energyExpireTimeMs",250),Y(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const s=r.levelChanged(n,i);return this.updateLoudestList(r,s,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new e1(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new nO(r,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new nO(r,0,e.energyScore);const s=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const d=this.loudest[c];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new nO(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new J5(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let s=null;if(r===0)s=null;else if(r===1){var c;const l=Lr(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(s=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],l=p.value[1])}else s=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const d=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[m,_]=p;if(_===l)continue;_.evaluateSpeechActivityScores(e);for(let C=0;C<d.length;++C){const N=l==null?uh:l.getSpeechActivityScore(C);d[C]=Math.log(_.getSpeechActivityScore(C)/N)}const g=d[0],I=d[1],y=d[2];g>3&&I>2&&y>0&&I>h&&(h=I,s=m)}this.enableSilence&&l!=null&&s===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of Lr(i=this.speakers).call(i)){var i;const s=e-r.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<s&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const nm=new Map;let no=null,ry=null;const n1=3;let dh=[];const io=new Map,ay=new Map;class Z5{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){Y(this,"id",void 0),Y(this,"track",void 0),Y(this,"score",0),Y(this,"active",!0),Y(this,"muted",!1),Y(this,"timer",0),Y(this,"actives",0),Y(this,"inactives",0),this.id=e,this.track=n,this.setActive(io.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],s=[];return Array.from(Lr(io).call(io)).forEach(c=>{c.active?r.push(c):s.push(c)}),{actives:r,inactives:s}}();if(n.length>3){let r;n.forEach(s=>{(!r||r.score>s.score)&&(r=s)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(s=>{(!r||r.score<s.score)&&s.id!==this.id&&(r=s)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(Lr(io).call(io)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(Lr(io).call(io)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let sy;function i1(t){const e=io.get(t);e&&(io.delete(t),e.clearTimer())}const oy=new Map,$5=new Map;function tH(t,e,n){let i=new Uint8Array(t,e,n),r=[],s=0;for(;r.length<n;)s+3<n&&i[s]===0&&i[s+1]===0&&i[s+2]===3&&(i[s+3]===0||i[s+3]===1||i[s+3]===2||i[s+3]===3)?(r.push(i[s],i[s+1],i[s+3]),s+=4):(r.push(i[s]),s++);return new Uint8Array(r)}const cy=new Map,Sg=new Map;(function(){const t=ge();Si.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Si.getStreamFromExtension=t.name===Ce.CHROME&&Number(t.version)>34,Si.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Si.supportMinBitrate=t.name===Ce.CHROME||t.name===Ce.EDGE,Si.supportSetRtpSenderParameters=function(){const e=ge();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Jc()||!(!Ii()&&!xv())||e.name===Ce.FIREFOX&&Number(e.version)>=64)}(),t.name===Ce.SAFARI&&(Number(t.version)>=14?Si.supportDualStream=!0:Si.supportDualStream=!1),Si.webAudioMediaStreamDest=function(){const e=ge();return!(e.name===Ce.SAFARI&&Number(e.version)<12)}(),Si.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Si.supportWebGL=typeof WebGLRenderingContext<"u",Si.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Jc()||(Si.webAudioWithAEC=!0),Si.supportShareAudio=function(){const e=ge();return(e.os===ni.WIN_10||e.os===ni.WIN_81||e.os===ni.WIN_7||e.os===ni.LINUX||e.os===ni.MAC_OS||e.os===ni.CHROMIUM_OS)&&e.name===Ce.CHROME&&Number(e.version)>=74}(),Si.supportDataChannel=!!(cg(76)||function(e){const n=ge();return!(n.name!==Ce.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||cP(14)),Si.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!mn()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Si.supportWebRTCEncodedTransform=function(){const e=ge();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),Si.supportWebRTCInsertableStream=function(){const e=ge();return(e.name===Ce.CHROME||e.name===Ce.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Si.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Si.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Fv(()=>{Si.supportDualStreamEncoding=function(){const e=ge();return!!M("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&M("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",t),T.info("browser compatibility: ",Si)})})();const eH=["CHINA","GLOBAL"],r1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],hh=[],im=[];function ph(t,e){return!!e&&hh.some(n=>n.uid===t&&n.channelName===e)}function iO(){return im.length>0}var nH=bD.forEach,a1=fr("forEach")?[].forEach:function(t){return nH(this,t,arguments.length>1?arguments[1]:void 0)};Ne({target:"Array",proto:!0,forced:[].forEach!=a1},{forEach:a1});var iH=hr("Array").forEach,rH=Ra,aH=fi,sH=mt,oH=iH,rO=Array.prototype,cH={DOMTokenList:!0,NodeList:!0},lH=function(t){var e=t.forEach;return t===rO||sH(rO,t)&&e===rO.forEach||aH(cH,rH(t))?oH:e},uH=P(lH),dH=za,s1=cd;Ne({target:"Object",stat:!0,forced:x(function(){s1(1)})},{keys:function(t){return s1(dH(t))}});var o1=P(Wr.Object.keys),hH=P(td),pH=P(nd),fH=Ne,c1=Yi,mH=zl,_H=Wi,l1=Xh,EH=Is,gH=po,SH=Pa,TH=dn,RH=bd,vH=_D("slice"),yH=TH("species"),aO=Array,CH=Math.max;fH({target:"Array",proto:!0,forced:!vH},{slice:function(t,e){var n,i,r,s=gH(this),c=EH(s),l=l1(t,c),d=l1(e===void 0?c:e,c);if(c1(s)&&(n=s.constructor,(mH(n)&&(n===aO||c1(n.prototype))||_H(n)&&(n=n[yH])===null)&&(n=void 0),n===aO||n===void 0))return RH(s,l,d);for(i=new(n===void 0?aO:n)(CH(d-l,0)),r=0;l<d;l++,r++)l in s&&SH(i,r,s[l]);return i.length=r,i}});var AH=hr("Array").slice,bH=mt,IH=AH,sO=Array.prototype,OH=function(t){var e=t.slice;return t===sO||bH(sO,t)&&e===sO.slice?IH:e},wH=P(OH);function Lt(t,e,n,i,r){var s,c,l,d={};return uH(s=o1(i)).call(s,function(h){d[h]=i[h]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=hH(c=pH(l=wH(n).call(n)).call(l)).call(c,function(h,p){return p(t,e,h)||h},d),r&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(r):void 0,d.initializer=void 0),d.initializer===void 0&&(hD(t,e,d),d=null),d}let ly=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),oO=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ms=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),sr=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),jt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Xe=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Yt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Wt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),Tg=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),le=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),or=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),$t=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function uy(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw T.error("Invalid Channel Name ".concat(t)),new z(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function dy(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||_P(t,1,255)))throw new z(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let el=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const NH={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},cO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function lO(t,e){Ei(t.url,"".concat(e,".url"),1,1e3,!1),_n(t.x)||Ve(t.x,"".concat(e,".x"),0,1e4),_n(t.y)||Ve(t.y,"".concat(e,".y"),0,1e4),_n(t.width)||Ve(t.width,"".concat(e,".width"),0,1e4),_n(t.height)||Ve(t.height,"".concat(e,".height"),0,1e4),_n(t.zOrder)||Ve(t.zOrder,"".concat(e,".zOrder"),0,255),_n(t.alpha)||Ve(t.alpha,"".concat(e,".alpha"),0,1,!1)}const DH={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Su=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),uO=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Xn=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function u1(t){if(!t.channelName)throw new z(L.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new z(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ei(t.token,"info.token",1,2047),dy(t.uid),uy(t.channelName),!0}let cr=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),nl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ur=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),rm=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),we=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),ui=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),hy=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),ri=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Ae=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const d1=[Ae.AFRICA,Ae.ASIA,Ae.CHINA,Ae.EUROPE,Ae.GLOBAL,Ae.INDIA,Ae.JAPAN,Ae.NORTH_AMERICA,Ae.OCEANIA,Ae.OVERSEA,Ae.SOUTH_AMERICA];let xi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const py={CHINA:{},ASIA:{CODE:xi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:xi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:xi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:xi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:xi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:xi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:xi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:xi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:xi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:xi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:xi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:xi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:xi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};DI&&(py.CHINA={CODE:xi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Rg=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function h1(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class p1 extends hn{constructor(e,n){super(),O(this,"onICEConnectionStateChange",void 0),O(this,"onConnectionStateChange",void 0),O(this,"onDTLSTransportStateChange",void 0),O(this,"onDTLSTransportError",void 0),O(this,"onICETransportStateChange",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoReceived",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"onICECandidateError",void 0),O(this,"getLocalVideoStats",void 0)}}class f1 extends p1{constructor(e,n){super(e,n),O(this,"establishPromise",void 0)}}let It=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Vi=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),il=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const m1=["disconnected","failed"];let st=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Oe=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Ft=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),_s=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Es=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),di=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),_1=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),nc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Ba=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),ro=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),am=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Ln=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),sm=function(t){return t.ABORT="abort",t}({}),Tu=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),LH=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const PH={[ly.ACCESS_POINT]:{[sr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[sr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[sr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[sr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[sr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[sr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[sr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ly.UNILBS]:{[ms.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ms.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ms.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ms.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ms.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ms.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ms.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ms.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ms.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ms.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ms.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ms.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ly.STRING_UID_ALLOCATOR]:{[oO.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[oO.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[oO.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function om(t){const e=PH[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===ly.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const kH={[jt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[jt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[jt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[jt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[jt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[jt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[jt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[jt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[jt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[jt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[jt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[jt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[jt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[jt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[jt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[jt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[jt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[jt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[jt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[jt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[jt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[jt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[jt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[jt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[jt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[jt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[jt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[jt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[jt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[jt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[jt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[jt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[jt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[jt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[jt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[jt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[jt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[jt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[jt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[jt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[jt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[jt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[jt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[jt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[jt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[jt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[jt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[jt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[jt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[jt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[jt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[jt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[jt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[jt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[jt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[jt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[jt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[jt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function vg(t){return kH[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function E1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function dO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function g1(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const s=M("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(s,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const MH=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,UH=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,xH=/wss:\/\/(.+):([0-9]+)\/?/,VH=/wss:\/\/(.[^\/]+)\/?/;let BH=0;class FH{constructor(e,n){O(this,"id",0),O(this,"store",void 0),O(this,"recordIndex",void 0),O(this,"websockets",[]),O(this,"try443PortDuration",2e3),O(this,"forceCloseWSDuration",5e3),O(this,"try443PortTimeout",null),O(this,"forceCloseTimeout",null),O(this,"isTry443PortFailed",!1),O(this,"isNormalPortFailed",!1),O(this,"useDoubleDomain",!1),O(this,"useProxy",!1),O(this,"startTime",Date.now()),this.id=++BH,this.try443PortDuration=M("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];T.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=M("GATEWAY_DOMAINS"),s=Date.now(),c=[],l=r.find(_=>{var g;return _t(g=e.host).call(g,_)});l||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)r.forEach(_=>{d.push(g1(dO(dO({},e),{},{host:e.host.replace(l,_)}),n))});else{const _=dO({},e);if(n&&l){const g=r.find(I=>I!==l);g&&(_.host=_.host.replace(l,g))}d.push(g1(_,n))}try{d.forEach(_=>{const g=new WebSocket(_);g.binaryType="arraybuffer",c.push(g),this.logger("ws is connecting:",g.url)})}catch(_){if(this.logger("ws create failed"),c.forEach(g=>g.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new z(L.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}const h=og();this.store&&this.store.recordJoinChannelService({urls:c.map(_=>_.url),service:"gateway"},this.recordIndex),c.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(g=>{g!==_&&(g.onopen=null,g.onclose=null,g.onmessage=null,g.close(),this.logger("close backup websocket: ".concat(g.url)))}),this.websockets.length=0,h.resolve(_)},_.onclose=g=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(_.readyState));const I=c.every(y=>y.readyState===WebSocket.CLOSED||y.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(I)),I&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(g.reason)),h.reject({code:g.code,reason:hy.A_ROUND_WS_FAILED})):!n&&I&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),m()),n?this.isTry443PortFailed=I:this.isNormalPortFailed=I},_.onmessage=g=>this.logger("".concat(_.url," onmessage: ").concat(g.data))}),this.websockets.push(...c);const p=()=>{this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())},m=()=>{if(h.isResolved)return p();ge().os===ni.MAC_OS&&mn()&&p(),this.createWebSocket(e,!0,!0).then(_=>{h.resolve(_)}).catch(_=>{this.isNormalPortFailed&&h.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,m()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(s){let c,l,d;return[,c,l,d]=s.match(MH)||[],c||([,l,d]=s.match(UH)||[]),l&&d||([,l,d]=s.match(xH)||[]),l&&d||([,l]=s.match(VH)||[]),l||T.warning("un-destructible url: ",s),{proxy:c,host:l,port:d||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function S1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class T1 extends hn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;_t(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit($t.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit($t.CONNECTED):this._state==="closed"?this.emit($t.CLOSED):this._state==="failed"&&this.emit($t.FAILED))}resetReconnectCount(e){T.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"urls",[]),O(this,"_reconnectMode","tryNext"),O(this,"reconnectReason",void 0),O(this,"_initMutex",void 0),O(this,"name",void 0),O(this,"_state","closed"),O(this,"reconnectInterrupter",void 0),O(this,"websocket",void 0),O(this,"retryConfig",void 0),O(this,"reconnectCount",0),O(this,"forceCloseTimeout",5e3),O(this,"onlineReconnectListener",void 0),O(this,"useCompress",void 0),O(this,"tryDoubleDomain",!1),O(this,"use443PortOnly",!1),O(this,"wsInflateLength",0),O(this,"wsDeflateLength",0),O(this,"closeEstablishingWs",()=>{}),O(this,"store",void 0),O(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(m){for(var _=1;_<arguments.length;_++){var g=arguments[_]!=null?arguments[_]:{};_%2?S1(Object(g),!0).forEach(function(I){O(m,I,g[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(g)):S1(Object(g)).forEach(function(I){Object.defineProperty(m,I,Object.getOwnPropertyDescriptor(g,I))})}return m}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=s,this._initMutex=new Ui("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:d}=n,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*d)/10);Zr.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),Vn.on(Ff.NETWORK_STATE_CHANGE,(m,_)=>{m!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(m)),m===Zr.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=og(),s=this.urls[this.currentURLIndex];M("ENABLE_PREALLOC_PC")&&this.emit(_1.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(r.resolve).catch(r.reject),this.once($t.CLOSED,()=>{r.reject(new $(L.WS_DISCONNECT))}),this.once($t.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new $(L.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new $(L.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=og();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=p=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},s=async p=>{var m;if(T.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new $(L.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const _=ca(this,$t.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,g=await this.reconnectWithAction(_);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!g)return i.reject(new $(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);i.resolve()}},c=p=>{this.emit($t.ON_MESSAGE,p)},l=p=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),M("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=M("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),e);const d=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;const p=await this.chooseBestWebsocketConnection(e);this.websocket=p,r&&r(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){const m=this.state==="closed",_=p instanceof $,g=_&&p.code===L.WS_ABORT,I=_&&p.code===L.WS_ERR,y=_?p.message:p&&(p.reason||p.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(y)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:g?"aborted":"error",errors:[p]},d),m||I?(i.reject(m?new $(L.WS_DISCONNECT,"websocket is closed: ".concat(y)):new $(L.WS_ERR,"init websocket failed: ".concat(y))),I&&T.error("[".concat(this.name,"] init websocket failed: ").concat(y))):s&&s(p)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Vn.isOnline||!Vn.onlineWaiter||(this.onlineReconnectListener=Vn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=yI(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await Tt.race([gi(c),this.onlineReconnectListener||new Tt(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit($t.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await wi(this,$t.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var s;T.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(s=c.data)===null||s===void 0?void 0:s.desc;return Array.isArray(l)&&_t(l).call(l,"dynamic key expired")?(this.emit($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class hO extends T1{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=og(),r=function(c,l){return new FH(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new $(L.WS_ABORT,"choose best websocket aborted"))};const s=M("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class yg extends T1{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new Tt((i,r)=>{let s=!1;const c=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),c.forEach(I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()}),r(new $(L.WS_ABORT,"choose best websocket aborted"))};const l=M("GATEWAY_DOMAINS");let d;const h=e.indexOf("?h="),p=l.find(I=>h!==-1?_t(e).call(e,I,h):_t(e).call(e,I));T.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let m=!this.tryDoubleDomain||!p;if(!m&&p){var _;const I=Date.now();try{l.forEach(y=>{const C=h===-1?e.replace(p,y):e.substr(0,h)+e.substr(h).replace(p,y),N=new WebSocket(C);N.binaryType="arraybuffer",c.push(N),T.debug("[choose-best-ws] ws is connecting:",N.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(C=>C.close());c.length;)c.pop();m=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:c.map(y=>y.url),service:"gateway"},n),c.forEach(y=>{y.onopen=()=>{if(s)return;const C=Date.now()-I;T.debug("[choose-best-ws] ws open cost ".concat(C,"ms")),c.filter(N=>N!==y).forEach(N=>{T.debug("[choose-best-ws]close backup websocket: ".concat(N.url)),N.close()}),s=!0,i(y)},y.onclose=C=>{d=C,!s&&(c.find(N=>!(N.readyState===WebSocket.CLOSED||N.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),s=!0,r(d)))},y.onmessage=C=>{T.debug("[choose-best-ws]".concat(y.url," onmessage: ").concat(C.data))}}),gi(this.forceCloseTimeout).then(()=>{c.forEach(y=>{y.readyState!==WebSocket.OPEN&&y.close()})})}if(m){var g;let I;T.debug("[choose-best-ws] use single url: ",e),(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:[e],service:"gateway"},n);try{I=new WebSocket(e),c.push(I),I.binaryType="arraybuffer"}catch(y){const C=new $(L.WS_ERR,"init websocket failed! Error: ".concat(y.toString()));return T.error("[".concat(this.name,"]").concat(C)),void r(C)}I.onopen=()=>{i(I)},I.onclose=y=>{r(y)},I.onmessage=y=>{T.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(y.data))},gi(this.forceCloseTimeout).then(()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class jH extends hn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Xe.CONNECTED?this.emit(Yt.WS_CONNECTED):e===Xe.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):e===Xe.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Xe.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new LP(5)),O(this,"pingpongTimer",void 0),O(this,"wsInflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===le.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===le.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Ie.UID_BANNED);break;case 15:this.close(Ie.IP_BANNED);break;case 16:this.close(Ie.CHANNEL_BANNED)}if(r._type===le.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Ie.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Ie.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ie.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Ie.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ie.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Ie.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new hO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Xe.CONNECTED&&this.reconnect("retry",Oi.OFFLINE)})}async request(e,n,i,r){const s=Ye(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new Tt((I,y)=>{if(this.connectionState===Xe.CONNECTED)return I();const C=()=>{this.off(Yt.WS_CLOSED,N),I()},N=()=>{this.off(Yt.WS_CONNECTED,C),y(new z(L.WS_ABORT))};this.once(Yt.WS_CONNECTED,C),this.once(Yt.WS_CLOSED,N),e!==Wt.PUBLISH&&e!==Wt.PUBLISH_DATASTREAM&&e!==Wt.SUBSCRIBE&&e!==Wt.SUBSCRIBE_DATASTREAM&&e!==Wt.UNSUBSCRIBE&&e!==Wt.UNSUBSCRIBE_DATASTREAM&&e!==Wt.UNPUBLISH&&e!==Wt.UNPUBLISH_DATASTREAM&&e!==Wt.CONTROL&&e!==Wt.RESTART_ICE||this.once(Yt.DISCONNECT_P2P,()=>{y(new z(L.DISCONNECT_P2P))}),e!==Wt.PUBLISH&&e!==Wt.RESTART_ICE||this.once(Yt.ABORT_P2P_EXECUTION,()=>{y(new z(L.DISCONNECT_P2P))})});if(this.connectionState!==Xe.CONNECTING&&this.connectionState!==Xe.RECONNECTING||e===Wt.JOIN||e===Wt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new Tt((I,y)=>{let C=!1;const N=(V,W)=>{C=!0,I({isSuccess:V==="success",message:W||{}}),this.off(Yt.WS_CLOSED,D),this.off(Yt.WS_RECONNECTING,D),this.emit(Yt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),N);const D=()=>{y(new z(L.WS_ABORT,"type: ".concat(e))),this.off(Yt.WS_CLOSED,D),this.off(Yt.WS_RECONNECTING,D),this.off("res-@".concat(s),N)};this.once(Yt.WS_CLOSED,D),this.once(Yt.WS_RECONNECTING,D),gi(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||C||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Yt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(I){if(this.connectionState===Xe.CLOSED||e===Wt.LEAVE)throw new z(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():e===Wt.JOIN||e===Wt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),_=vg(m),g=new z(L.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:_.desc});return _.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(_.desc,", action: ").concat(_.action)),m===jt.ERR_TOO_MANY_BROADCASTERS?((e===Wt.JOIN||e===Wt.REJOIN)&&(this.initError=g,this.close()),g.throw()):_.action==="failed"?g.throw():_.action==="quit"?(this.initError=g,this.close(),g.throw()):(m===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Oi.MULTI_IP)):this.reconnect(_.action,Oi.SERVER_ERROR),e===Wt.JOIN||e===Wt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Tt(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Tg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Xe.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Tt((n,i)=>{this.once(Yt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Yt.WS_CLOSED,r=>i(this.initError||new z(L.WS_ABORT,r))),this.connectionState=Xe.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Ie.LEAVE,this.connectionState=Xe.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION);const e=await wi(this,Yt.REQUEST_JOIN_INFO),n=await this.request(Wt.JOIN,e);if(!n)return this.emit(Yt.REPORT_JOIN_GATEWAY,hy.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Xe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new z(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=pg(this,Yt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(Wt.REJOIN,e);return!!n&&(this.connectionState=Xe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(le.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(le.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(le.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(le.MUTE_AUDIO,{uid:i.uid}):this.emit(le.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(le.MUTE_VIDEO,{uid:i.uid}):this.emit(le.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(le.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(le.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(le.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(le.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(le.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=vg(e.code);if(e.code===28&&"detail"in e&&(T.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Yt.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ie.UID_BANNED),void this.close()):void this.reconnect(n.action,Oi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Oi.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),M("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Tg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on($t.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on($t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on($t.CLOSED,()=>{this.connectionState=Xe.CLOSED}),this.websocket.on($t.FAILED,()=>{this._disconnectedReason=Ie.NETWORK_ERROR,this.connectionState=Xe.CLOSED}),this.websocket.on($t.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Xe.CONNECTED?this.connectionState=Xe.RECONNECTING:this.connectionState=Xe.CONNECTING}),this.websocket.on($t.WILL_RECONNECT,(e,n,i)=>{const r=pg(this,Yt.IS_P2P_DISCONNECTED),s=r||e!=="retry";r&&e==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=hy.P2P_DISCONNECTED),s&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(Yt.REPORT_JOIN_GATEWAY,n||hy.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Yt.DISCONNECT_P2P)),i(e)}),this.websocket.on($t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Oi.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof z){if(e.code===L.UNEXPECTED_RESPONSE&&e.data.code===jt.ERR_NO_AUTHORIZED)return this.initError=new z(L.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ie.TOKEN_EXPIRE);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Oi.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on($t.REQUEST_NEW_URLS,(e,n)=>{wi(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(le.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(_1.PRE_CONNECT_PC,()=>{this.emit(Yt.PRE_CONNECT_PC)})}}let GH=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Bn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function R1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function fy(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?R1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ru(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(M("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function pO(t,e){t.addresses||(t.addresses=[]);const n=function(l,d){if(M("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(m=>{let{ip:_,port:g}=m;return{address:"".concat(_,":").concat(g)}});const h=M("GATEWAY_DOMAINS");let p=h[1]&&_t(d).call(d,h[1])?1:0;return l.map(m=>{let{domain_prefix:_,port:g,ip:I}=m;if(_)return{address:"".concat(_,".").concat(h[p++%h.length],":").concat(g)};const y=/^[\.\:\d]+$/.test(I),C=y?"".concat(I.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(g):"".concat(I,":").concat(g);return y||T.debug("Cannot recognized as ip address: ".concat(I,", use as host")),{ip:I,port:g,address:C}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let d=0;d<l.length;d++){var r;const h=Ji(r=l[d]).call(r);n[d]&&h&&(n[d].ip6=h)}}const s=t.detail&&t.detail.candidate;let c;if(s){const[l,d]=s.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function $r(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function v1(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat($r(e.width),"x").concat($r(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function y1(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Cg(t,e){let n,i,r;switch(e){case Bn.CHOOSE_SERVER:i=4096,r="choose server";break;case Bn.CLOUD_PROXY:i=1048576,r="proxy";break;case Bn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case Bn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new z(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(s=>{s.buffer&&s.buffer.flag===i&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>fy(fy({},c),{},{ticket:s.buffer.cert})),server_ts:t.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:fy(fy({},s.buffer.detail),t.detail),flag:s.buffer.flag,opid:t.opid,cert:s.buffer.cert})}),!n)throw new z(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function C1(t,e){return await Tt.all(t.addresses.map(async n=>({address:M("USE_TURN_IP")?n.ip:Ru(n.ip),tcpport:n.port,udpport:n.port,username:e&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Ni.username,password:e&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await SI(e.toString()):Ni.password})))}function fO(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min($r(t.height),$r(t.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function vu(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:s,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const d=r.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=s}return l}function my(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:M("SVC_MODE");if(M("ENABLE_SVC"))return function(e){return e in Wv}(t)?t:Wv.L1T3}const A1={[It.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[It.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function _y(t,e,n){e.forEach(i=>{var r;const s=A1[t].find(l=>{var d;let{key:h}=l;return _t(d=i.extensionName).call(d,h)});if(!s)return;const c=n.find(l=>{let{extensionName:d}=l;return _t(d).call(d,s.key)});c&&_t(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function cm(t,e){e.forEach(n=>{var i;const r=A1[t].find(s=>{var c;let{key:l}=s;return _t(c=n.extensionName).call(c,l)});_t(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function b1(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||_t(t).call(t,"abs-send-time")}function Ey(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||_t(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function I1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function O1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?I1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ag(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d}=e,{useXR:h}=n;let p=[],m=[],_=[],g=[],I=!1,y=!1;if(Mr(t).mediaDescriptions.forEach(N=>{i&&i!==N.attributes.direction||(N.media.mediaType!=="video"||I||(m=N.attributes.payloads,g=N.attributes.extmaps,I=!0),N.media.mediaType!=="audio"||y||(p=N.attributes.payloads,_=N.attributes.extmaps,y=!0))}),!g||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!_||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach(N=>{var D;(D=N.rtpMap)!==null&&D!==void 0&&D.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),h&&N.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(N=>{var D;(D=N.rtpMap)!==null&&D!==void 0&&D.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),h&&N.rtcpFeedbacks.push({type:"rrtr"})}),r&&(p=p.filter(N=>{var D;return((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"}),m=m.filter(N=>{var D;return((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"})),s&&(m=m.filter(N=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),c&&(p=p.filter(N=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(N=>{var D;return _t(l).call(l,((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0){const N=m.filter(D=>{var V;return _t(d).call(d,((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"")});m=N.concat(r?[]:EO(N,m))}const C=M("UNSUPPORTED_VIDEO_CODEC");return C&&C.length>0&&(m=m.filter(N=>!(N.rtpMap&&_t(C).call(C,N.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:m,audioExtensions:_,videoExtensions:g}}function yu(t){const e=Mr(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const s=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:c}}if(!i){const s=r.attributes.fingerprints;s.length>0&&(i={fingerprints:s})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function w1(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const d=(l=i.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?d:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function N1(t,e,n){const{cname:i}=t;let r=[];e&&(r=D1(e)),r.length===0&&(r=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),T.debug("Using candidates from gateway."));const s={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const d=Sy(t.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:It.VIDEO,ssrcId:p.v,rtx:p.v_rtx,mslabel:"".concat(p.v,"_").concat(p.a)},{kind:It.AUDIO,ssrcId:p.a,mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:c,candidates:r,rtpCapabilities:d,setup:l,cname:i,preSSRCs:h}}function D1(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function fh(t,e,n){const i=[],r=[];return t.forEach(s=>{let{ssrcId:c,rtx:l}=s;const d=Ye(8,"track-"),h={ssrcId:c,attributes:O1({label:d,mslabel:n=n||Ye(10,""),msid:"".concat(n," ").concat(d)},e&&{cname:e})};if(i.push(h),l!==void 0){const p={ssrcId:l,attributes:O1({label:d,mslabel:n,msid:"".concat(n," ").concat(d)},e&&{cname:e})};i.push(p),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:i,ssrcGroups:r}}function lm(t,e){e instanceof vn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=e._encoderConfig;s&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(s.bitrate&&!mn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function mO(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function _O(t,e){var n;if(!(e instanceof nn&&e._encoderConfig&&e._hints.indexOf(ze.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;Re().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var s,c;_t(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Re().supportMinBitrate&&!_t(n=e._hints).call(n,ze.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var s,c;_t(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(M("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function L1(t){if(t.media.mediaType!=="video")return;const e=ge();if(e.name!==Ce.SAFARI&&e.os!==ni.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function gy(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const s=i.find(c=>Ey(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>Ey(d.extensionName))||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(_=>_.type==="transport-cc")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const s=t.attributes.extmaps.findIndex(c=>Ey(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const s=i.find(c=>b1(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>d.extensionName===c)||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(_=>_.type==="goog-remb")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const s=t.attributes.extmaps.findIndex(c=>b1(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function P1(t,e,n){if(mn()||t.media.mediaType!=="video"||!(e instanceof nn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!M("SIMULCAST")||n==="vp9"&&M("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:gn(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:gn(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,s.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function k1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:s,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=Ag(h,l,d,"sendonly"),m=Ag(h,l,d,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(gs(p,m,"videoExtensions",_,g,I),gs(p,m,"videoCodecs",_,g,I),gs(p,m,"audioExtensions",_,g,I),gs(p,m,"audioCodecs",_,g,I),M("RAISE_H264_BASELINE_PRIORITY")){const y=[],C=[];I.videoCodecs.forEach((N,D)=>{var V;if(((V=N.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){var W,K;const j=I.videoCodecs[D+1],Q=j&&B1(N,j),ct=(W=N.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"],vt=(K=N.fmtp)===null||K===void 0?void 0:K.parameters["packetization-mode"];!ct||ct!==M("FIRST_H264_PROFILE_LEVEL_ID")||M("FIRST_PACKETIZATION_MODE")&&vt!==M("FIRST_PACKETIZATION_MODE")?Q?C.push([N,j]):C.push([N]):Q?y.push([N,j]):y.push([N])}}),y.length>0&&C.length>0&&(T.debug("raising H264 baseline profile priority"),I.videoCodecs.forEach((N,D)=>{var V;if(((V=N.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){const W=B1(N,I.videoCodecs[D+1]),K=y.shift()||C.shift()||[];K.length>0&&(W?I.videoCodecs.splice(D,2,...K):I.videoCodecs.splice(D,1,...K))}}),g.videoCodecs=g.videoCodecs.filter(N=>{var D,V;return!(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=N.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID"))}),M("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(N=>{var D,V;return!(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=N.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:_,recv:g,sendrecv:I}}(t,e,i);try{n.close()}catch{}return{send:r,recv:s,sendrecv:c}}function M1(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=Ag(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(gs(t,e,"videoExtensions",n,i,r),gs(t,e,"videoCodecs",n,i,r),gs(t,e,"audioExtensions",n,i,r),gs(t,e,"audioCodecs",n,i,r),M("RAISE_H264_BASELINE_PRIORITY")){const s=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){T.debug("raising H264 baseline profile priority");const l=r.videoCodecs[s];r.videoCodecs.splice(s,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function gs(t,e,n,i,r,s){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}}function Sy(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,s;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...i.audioCodecs],s.videoCodecs=[...n.videoCodecs,...i.videoCodecs],s.audioExtensions=[...n.audioExtensions,...i.audioExtensions],s.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):s=i,{send:r,recv:s}}function um(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function bg(t,e,n,i){let r=[];if(t===It.VIDEO){if(M("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(s=>{var c;return _t(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===M("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let s=[];const c=[],l=[],d=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";_t(p).call(p,i)?s.push(h):_t(p).call(p,"vp9")?c.push(h):_t(p).call(p,"vp8")?l.push(h):_t(p).call(p,"h264")&&d.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):d.length!==0&&(s=d,h="h264"),T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(r=e.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),M("USE_PUB_RTX")||M("USE_SUB_RTX")){const s=EO(r,e.videoCodecs);r=[...r,...s]}}else r=e.audioCodecs.filter(s=>{var c;return _t(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(s=>{var c;return _t(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return r}function EO(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&_t(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Ig(t,e,n){const i=e.toString(),r=x1(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const s=await t.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=U1(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function U1(t,e,n){const i=Mr(t),{useXR:r}=e;return i.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(n)&&!_t(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&um(s),r&&_t(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),gu(i)}function x1(t,e,n,i){if(M("SDP_LOGGING"))return T.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{x1(r,"answer",n==="local"?"remote":"local",i)}:void 0}function V1(t){const e=M("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>_t(t).call(t,n))}function B1(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function F1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Fa(t,e){return typeof M(t)===e?M(t):void 0}function HH(){try{const t=M("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?F1(Object(i),!0).forEach(function(r){O(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return T.debug("handle gateway attributes failed: ",t),{}}}const j1={};function Cu(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&T.debug("install service ".concat(t.name)),j1[t.name]=t}function rl(t){const e=j1[t];if(!e)throw new $(L.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function G1(t,e){return rl("DataStream").create(t,e)}function Ty(){return rl("InterceptFrame").create()}function H1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function al(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const gO=new Map;class WH extends hn{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(ui.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(ui.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,s;super(),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"key",void 0),O(this,"ntpOffset",0),O(this,"signal",void 0),O(this,"role",void 0),O(this,"inChannelInfo",{joinAt:null,duration:0}),O(this,"spec",void 0),O(this,"_state","DISCONNECTED"),O(this,"_statsCollector",void 0),O(this,"_disconnectedReason",void 0),O(this,"isSignalRecover",!1),O(this,"hasChangeBGPAddress",!1),O(this,"trafficStatsInterval",void 0),O(this,"networkQualityInterval",void 0),O(this,"_joinGatewayStartTime",0),O(this,"_signalTimeout",!1),O(this,"_clientRoleOptions",void 0),O(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:al(al({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(s=rl("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(s,i)):new jH(al(al({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let s=gO.get(e.cname);if(s||(s=new Map,gO.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const h=new z(L.UID_CONFLICT);throw Mt.joinGateway(e.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),h}s.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{T.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const h=e.gatewayAddrs.map(p=>{let{address:m}=p;const[_,g]=m.split(":"),I={host:_,port:g};return e.proxyServer&&(I.proxy=e.proxyServer),I});c=(await this.signal.init(h)).uid,T.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw T.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),Mt.joinGateway(e.sid,{lts:r,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:e.preload}),s.delete(e.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ui.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ui.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ui.NETWORK_QUALITY,{uplinkNetworkQuality:y1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:y1(this._statsCollector.trafficStats.B_dnq)}):this.emit(ui.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ie.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Xe.CONNECTED||await function(i,r){return r===1/0?i:Tt.race([i,m5(r)])}(this.signal.request(Wt.LEAVE,void 0,!0),3e3)}catch(i){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ie.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:M("PUB_EXTEND"),twcc:!!M("PUBLISH_TWCC"),rtx:!!M("USE_PUB_RTX")};try{return(await this.signal.request(Wt.PUBLISH,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw s}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Wt.PUBLISH_DATASTREAM,s,!0)}catch(c){if(i&&c.data&&c.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Wt.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Tt.all(e.map(n=>this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX")||void 0,extend:M("SUB_EXTEND"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return await this.signal.request(Wt.PRE_SUBSCRIBE,r,!0)}catch(s){if(i&&s.data&&s.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,n,!1);throw s}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX"),extend:M("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return(await this.signal.request(Wt.SUBSCRIBE,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw s}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Wt.SUBSCRIBE_DATASTREAM,r,!0)}catch(s){if(i&&s.data&&s.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw s}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!M("USE_SUB_RTX"),twcc:!!M("SUBSCRIBE_TWCC"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return await this.signal.request(Wt.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,s=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:s,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(Wt.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Tt.all(e.map(i=>this.signal.request(Wt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){T.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Wt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Wt.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Wt.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS")),T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(Wt.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(Wt.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Wt.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(Wt.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(Wt.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Wt.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),al({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Wt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=gO.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Ni.username,password:Ni.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(al(al({},Ni),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(Wt.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Fv(()=>{this.emit(ui.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new z(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=M("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ui.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,_t(im).call(im,r)||im.push(r);const s=!(mn()||oP(87)||JP())&&typeof M("ENABLE_PRE_SUB")=="boolean"&&M("ENABLE_PRE_SUB"),c=!JP()&&Fa("ENABLE_PREALLOC_PC","boolean"),l=HH(),d=cg(87)||function(){const p=ge();if(p.name!==Ce.SAFARI||!p.browserVersion)return!1;const m=p.browserVersion.split(".");return Number(m[0])>15||Number(m[0])===15&&Number(m[1])>=4}(),h=al({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ua,browser:navigator.userAgent,process_id:M("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:M("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:al({enableEncodedTransform:!!M("ENABLE_AUDIO_METADATA")&&d||!!M("ENABLE_AUDIO_TOPN")&&dI(Ce.CHROME,87,116)||void 0,enableAudioMetadata:!!M("ENABLE_AUDIO_METADATA")&&d,enableAudioPts:!!M("ENABLE_AUDIO_PTS_METADATA")&&d,topnSmoothLevel:M("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:M("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:M("TOPN_SWITCH_HOLD_MS"),topnAudioGain:M("TOPN_AUDIO_GAIN"),enablePublishedUserList:M("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:M("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Fa("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Fa("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Fa("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:M("USE_PUB_RTX")===!0||M("USE_SUB_RTX")===!0||void 0,disableFEC:M("DISABLE_FEC"),enableNTPReport:!!M("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!M("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!M("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Fa("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!M("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!M("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Fa("USE_XR","boolean"),enableLossbasedBwe:Fa("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!M("ENABLE_AUT_CC")||void 0,enableCCFallback:Fa("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:s?Fa("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Fa("PUBLISH_TWCC","boolean"),enableSubTWCC:Fa("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Fa("USE_PUB_RTX","boolean"),enableSubRTX:Fa("USE_SUB_RTX","boolean"),enableSubSVC:M("ENABLE_SVC")?M("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0,enableSvcExtended:M("ENABLE_SVC")&&Array.isArray(M("SVC_EXTENDED"))&&M("SVC_EXTENDED").length!==0?M("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,M("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new z(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Yt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Yt.WS_RECONNECTING,e=>{this.joinInfo&&Mt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Oi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Mt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Yt.WS_CLOSED,e=>{let n;switch(e){case Ie.LEAVE:n=Oi.LEAVE;break;case Ie.UID_BANNED:case Ie.IP_BANNED:case Ie.CHANNEL_BANNED:case Ie.SERVER_ERROR:n=Oi.SERVER_ERROR;break;case Ie.FALLBACK:n=Oi.FALLBACK;break;case Ie.LICENSE_MISSING:case Ie.LICENSE_EXPIRED:case Ie.LICENSE_MINUTES_EXCEEDED:case Ie.LICENSE_PERIOD_INVALID:case Ie.LICENSE_MULTIPLE_SDK_SERVICE:case Ie.LICENSE_ILLEGAL:case Ie.TOKEN_EXPIRE:n=e;break;default:n=Oi.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Oi.NETWORK_ERROR)),this.joinInfo&&Mt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Ie.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==Ie.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Yt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=M("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(Mt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Pe("EVENT_REPORT_DOMAIN",e[1]),Pe("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Pe("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(le.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(Yt.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new z(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,wi(this,ui.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Yt.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const s=gn((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(M("NEW_TURN_MODE")&&s){let h=s.servers,p=s.serversFromGateway;const m=this.signal.currentURLIndex;h.length>0&&(h=[h[m%h.length]],s.servers=h),Array.isArray(p)&&p.length>0&&(p=[p[0]],s.serversFromGateway=p),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(m))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await wi(this,ui.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:s});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(h){n(h)}}),this.signal.on(Yt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(Yt.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var s;e instanceof z?(i=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,r=e.message):i=e,Mt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Yt.IS_P2P_DISCONNECTED,e=>{e(pg(this,ui.IS_P2P_DISCONNECTED))}),this.signal.on(Yt.DISCONNECT_P2P,()=>{this.emit(ui.DISCONNECT_P2P)}),this.signal.on(Yt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Yt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Yt.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(ui.JOIN_RESPONSE,e,n)}),this.signal.on(Yt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=M("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=D1(e);this.emit(ui.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(Yt.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof M("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(M("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(Wt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw T.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(Wt.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw T.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===we.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===we.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===It.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===It.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Wt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Wt.RESTART_ICE,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||Oi.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!M("GATEWAY_WSS_ADDRESS"))return M("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Wt.SET_PARAMETER,{enablePublishAudioFilter:e})}}let Ry=0,SO=0;function ao(t,e,n,i){return new Tt((r,s)=>{e.timeout=e.timeout||M("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Ry+=Qo(e.data)):n&&(e.data.size?Ry+=e.data.size:e.data instanceof FormData?Ry+=AP(e.data):Ry+=Qo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,_r.request(e).then(c=>{typeof c.data=="string"?SO+=Qo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?SO+=c.data.byteLength:SO+=Qo(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{_r.isCancel(c)?s(new z(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new z(L.NETWORK_TIMEOUT,c.message)):c.response?s(new z(L.NETWORK_RESPONSE_ERROR,c.response.status)):s(new z(L.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(nt){var ft=0;return function(){return ft<nt.length?{done:!1,value:nt[ft++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(nt,ft,Pt){return nt==Array.prototype||nt==Object.prototype||(nt[ft]=Pt.value),nt},i,r=function(nt){nt=[typeof globalThis=="object"&&globalThis,nt,typeof window=="object"&&window,typeof self=="object"&&self,typeof b=="object"&&b];for(var ft=0;ft<nt.length;++ft){var Pt=nt[ft];if(Pt&&Pt.Math==Math)return Pt}throw Error("Cannot find global object")}(this);function s(nt,ft){if(ft)t:{var Pt=r;nt=nt.split(".");for(var at=0;at<nt.length-1;at++){var v=nt[at];if(!(v in Pt))break t;Pt=Pt[v]}(ft=ft(at=Pt[nt=nt[nt.length-1]]))!=at&&ft!=null&&n(Pt,nt,{configurable:!0,writable:!0,value:ft})}}function c(nt){return(nt={next:nt})[Symbol.iterator]=function(){return this},nt}function l(nt){var ft=typeof Symbol<"u"&&Symbol.iterator&&nt[Symbol.iterator];return ft?ft.call(nt):{next:e(nt)}}if(s("Symbol",function(nt){function ft(v,U){this.A=v,n(this,"description",{configurable:!0,writable:!0,value:U})}if(nt)return nt;ft.prototype.toString=function(){return this.A};var Pt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",at=0;return function v(U){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new ft(Pt+(U||"")+"_"+at++,U)}}),s("Symbol.iterator",function(nt){if(nt)return nt;nt=Symbol("Symbol.iterator");for(var ft="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Pt=0;Pt<ft.length;Pt++){var at=r[ft[Pt]];typeof at=="function"&&typeof at.prototype[nt]!="function"&&n(at.prototype,nt,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return nt}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var d;t:{var h={};try{h.__proto__={a:!0},d=h.a;break t}catch{}d=!1}i=d?function(nt,ft){if(nt.__proto__=ft,nt.__proto__!==ft)throw new TypeError(nt+" is not extensible");return nt}:null}var p=i;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _(nt){if(nt.m)throw new TypeError("Generator is already running");nt.m=!0}function g(nt,ft){return nt.h=3,{value:ft}}function I(nt){this.g=new m,this.G=nt}function y(nt,ft,Pt,at){try{var v=ft.call(nt.g.j,Pt);if(!(v instanceof Object))throw new TypeError("Iterator result "+v+" is not an object");if(!v.done)return nt.g.m=!1,v;var U=v.value}catch(F){return nt.g.j=null,nt.g.s(F),C(nt)}return nt.g.j=null,at.call(nt.g,U),C(nt)}function C(nt){for(;nt.g.h;)try{var ft=nt.G(nt.g);if(ft)return nt.g.m=!1,{value:ft.value,done:!1}}catch(Pt){nt.g.v=void 0,nt.g.s(Pt)}if(nt.g.m=!1,nt.g.l){if(ft=nt.g.l,nt.g.l=null,ft.F)throw ft.D;return{value:ft.return,done:!0}}return{value:void 0,done:!0}}function N(nt){this.next=function(ft){return nt.o(ft)},this.throw=function(ft){return nt.s(ft)},this.return=function(ft){return function(Pt,at){_(Pt.g);var v=Pt.g.j;return v?y(Pt,"return"in v?v.return:function(U){return{value:U,done:!0}},at,Pt.g.return):(Pt.g.return(at),C(Pt))}(nt,ft)},this[Symbol.iterator]=function(){return this}}function D(nt,ft){return ft=new N(new I(ft)),p&&nt.prototype&&p(ft,nt.prototype),ft}if(m.prototype.o=function(nt){this.v=nt},m.prototype.s=function(nt){this.l={D:nt,F:!0},this.h=this.C||this.u},m.prototype.return=function(nt){this.l={return:nt},this.h=this.u},I.prototype.o=function(nt){return _(this.g),this.g.j?y(this,this.g.j.next,nt,this.g.o):(this.g.o(nt),C(this))},I.prototype.s=function(nt){return _(this.g),this.g.j?y(this,this.g.j.throw,nt,this.g.o):(this.g.s(nt),C(this))},s("Array.prototype.entries",function(nt){return nt||function(){return function(ft,Pt){ft instanceof String&&(ft+="");var at=0,v=!1,U={next:function(){if(!v&&at<ft.length){var F=at++;return{value:Pt(F,ft[F]),done:!1}}return v=!0,{done:!0,value:void 0}}};return U[Symbol.iterator]=function(){return U},U}(this,function(ft,Pt){return[ft,Pt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function(nt,ft){for(var Pt=0;Pt<nt.length;Pt++)ft(nt[Pt])},W=function(nt){return nt.replace(/\r?\n|\r/g,`\r
`)},K=function(nt,ft,Pt){return ft instanceof Blob?(Pt=Pt!==void 0?Pt+"":typeof ft.name=="string"?ft.name:"blob",ft.name===Pt&&Object.prototype.toString.call(ft)!=="[object Blob]"||(ft=new File([ft],Pt)),[String(nt),ft]):[String(nt),String(ft)]},j=function(nt,ft){if(nt.length<ft)throw new TypeError(ft+" argument required, but only "+nt.length+" present.")},Q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ct=Q.FormData,vt=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,At=Q.Request&&Q.fetch,ue=Q.navigator&&Q.navigator.sendBeacon,de=Q.Element&&Q.Element.prototype,qe=Q.Symbol&&Symbol.toStringTag;qe&&(Blob.prototype[qe]||(Blob.prototype[qe]="Blob"),"File"in Q&&!File.prototype[qe]&&(File.prototype[qe]="File"));try{new File([],"")}catch{Q.File=function(ft,Pt,at){return ft=new Blob(ft,at||{}),Object.defineProperties(ft,{name:{value:Pt},lastModified:{value:+(at&&at.lastModified!==void 0?new Date(at.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),qe&&Object.defineProperty(ft,qe,{value:"File"}),ft}}var Pn=function(nt){return nt.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},yn=function(nt){this.i=[];var ft=this;nt&&V(nt.elements,function(Pt){if(Pt.name&&!Pt.disabled&&Pt.type!=="submit"&&Pt.type!=="button"&&!Pt.matches("form fieldset[disabled] *"))if(Pt.type==="file"){var at=Pt.files&&Pt.files.length?Pt.files:[new File([],"",{type:"application/octet-stream"})];V(at,function(v){ft.append(Pt.name,v)})}else Pt.type==="select-multiple"||Pt.type==="select-one"?V(Pt.options,function(v){!v.disabled&&v.selected&&ft.append(Pt.name,v.value)}):Pt.type==="checkbox"||Pt.type==="radio"?Pt.checked&&ft.append(Pt.name,Pt.value):(at=Pt.type==="textarea"?W(Pt.value):Pt.value,ft.append(Pt.name,at))})};if((t=yn.prototype).append=function(nt,ft,Pt){j(arguments,2),this.i.push(K(nt,ft,Pt))},t.delete=function(nt){j(arguments,1);var ft=[];nt=String(nt),V(this.i,function(Pt){Pt[0]!==nt&&ft.push(Pt)}),this.i=ft},t.entries=function nt(){var ft,Pt=this;return D(nt,function(at){if(at.h==1&&(ft=0),at.h!=3)return ft<Pt.i.length?at=g(at,Pt.i[ft]):(at.h=0,at=void 0),at;ft++,at.h=2})},t.forEach=function(nt,ft){j(arguments,1);for(var Pt=l(this),at=Pt.next();!at.done;at=Pt.next()){var v=l(at.value);at=v.next().value,v=v.next().value,nt.call(ft,v,at,this)}},t.get=function(nt){j(arguments,1);var ft=this.i;nt=String(nt);for(var Pt=0;Pt<ft.length;Pt++)if(ft[Pt][0]===nt)return ft[Pt][1];return null},t.getAll=function(nt){j(arguments,1);var ft=[];return nt=String(nt),V(this.i,function(Pt){Pt[0]===nt&&ft.push(Pt[1])}),ft},t.has=function(nt){j(arguments,1),nt=String(nt);for(var ft=0;ft<this.i.length;ft++)if(this.i[ft][0]===nt)return!0;return!1},t.keys=function nt(){var ft,Pt,at,v,U=this;return D(nt,function(F){if(F.h==1&&(ft=l(U),Pt=ft.next()),F.h!=3)return Pt.done?void(F.h=0):(at=Pt.value,v=l(at),g(F,v.next().value));Pt=ft.next(),F.h=2})},t.set=function(nt,ft,Pt){j(arguments,2),nt=String(nt);var at=[],v=K(nt,ft,Pt),U=!0;V(this.i,function(F){F[0]===nt?U&&(U=!at.push(v)):at.push(F)}),U&&at.push(v),this.i=at},t.values=function nt(){var ft,Pt,at,v,U=this;return D(nt,function(F){if(F.h==1&&(ft=l(U),Pt=ft.next()),F.h!=3)return Pt.done?void(F.h=0):(at=Pt.value,(v=l(at)).next(),g(F,v.next().value));Pt=ft.next(),F.h=2})},yn.prototype._asNative=function(){for(var nt=new ct,ft=l(this),Pt=ft.next();!Pt.done;Pt=ft.next()){var at=l(Pt.value);Pt=at.next().value,at=at.next().value,nt.append(Pt,at)}return nt},yn.prototype._blob=function(){var nt="----formdata-polyfill-"+Math.random(),ft=[],Pt="--"+nt+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(at,v){return typeof at=="string"?ft.push(Pt+Pn(W(v))+`"\r
\r
`+W(at)+`\r
`):ft.push(Pt+Pn(W(v))+'"; filename="'+Pn(at.name)+`"\r
Content-Type: `+(at.type||"application/octet-stream")+`\r
\r
`,at,`\r
`)}),ft.push("--"+nt+"--"),new Blob(ft,{type:"multipart/form-data; boundary="+nt})},yn.prototype[Symbol.iterator]=function(){return this.entries()},yn.prototype.toString=function(){return"[object FormData]"},de&&!de.matches&&(de.matches=de.matchesSelector||de.mozMatchesSelector||de.msMatchesSelector||de.oMatchesSelector||de.webkitMatchesSelector||function(nt){for(var ft=(nt=(this.document||this.ownerDocument).querySelectorAll(nt)).length;0<=--ft&&nt.item(ft)!==this;);return-1<ft}),qe&&(yn.prototype[qe]="FormData"),vt){var vr=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(nt,ft){vr.call(this,nt,ft),nt.toLowerCase()==="content-type"&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(nt){nt instanceof yn?(nt=nt._blob(),this.B||this.setRequestHeader("Content-Type",nt.type),vt.call(this,nt)):vt.call(this,nt)}}At&&(Q.fetch=function(nt,ft){return ft&&ft.body&&ft.body instanceof yn&&(ft.body=ft.body._blob()),At.call(this,nt,ft)}),ue&&(Q.navigator.sendBeacon=function(nt,ft){return ft instanceof yn&&(ft=ft._asNative()),ue.call(this,nt,ft)}),Q.FormData=yn}})();const Og=()=>{const t=M("AREAS");return t.length===0&&t.push(Ae.GLOBAL),nr(t).call(t,(e,n,i)=>{const r=W1(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},W1=t=>t===Ae.OVERSEA?"".concat(xi.ASIA,",").concat(xi.EUROPE,",").concat(xi.AFRICA,",").concat(xi.NORTH_AMERICA,",").concat(xi.SOUTH_AMERICA,",").concat(xi.OCEANIA):xi[t],KH=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=py[n],r=Object.keys(i);r&&r.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(i[s]))})}),e},vy={GLOBAL:{ASIA:[Ae.CHINA,Ae.JAPAN,Ae.INDIA,Ae.KOREA,Ae.HKMC],EUROPE:[],NORTH_AMERICA:[Ae.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},yy=Object.keys(vy[Ae.GLOBAL]),TO=[Ae.CHINA,Ae.NORTH_AMERICA,Ae.EUROPE,Ae.ASIA,Ae.JAPAN,Ae.INDIA,Ae.OCEANIA,Ae.SOUTH_AMERICA,Ae.AFRICA,Ae.KOREA,Ae.HKMC,Ae.US],YH=function(t,e){let n=[];if(_t(t).call(t,Ae.GLOBAL)){const s=[Ae.GLOBAL,Ae.OVERSEA],c=Object.keys(py);if(e===Ae.GLOBAL)throw new z(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Ae.CHINA)n=[Ae.OVERSEA];else if(r=e,_t(yy).call(yy,r)){const l=(i=e,vy[Ae.GLOBAL][i]||[]),d=[...s,e,...l];n=c.filter(h=>!_t(d).call(d,h))}else if(function(l){let d=!1;return yy.forEach(h=>{var p;_t(p=vy[Ae.GLOBAL][h]).call(p,l)&&(d=!0)}),d}(e)){const l=function(h){let p;return yy.forEach(m=>{var _;_t(_=vy[Ae.GLOBAL][m]).call(_,h)&&(p=m)}),p}(e),d=[...s,l,e];n=c.filter(h=>!_t(d).call(d,h))}else n=t;n=function(l){const d=[];return TO.forEach(h=>{_t(l).call(l,h)&&d.push(h)}),d.concat(l.filter(h=>!_t(TO).call(TO,h)))}(n)}else n=t;var i,r;return n};function K1(t){var e,n;if(!t&&_t(e=M("AREAS")).call(e,Ae.EXTENSIONS))return T.debug("update area from ap : reset"),void RO(eH,!0);if(!_t(n=M("AREAS")).call(n,Ae.GLOBAL)||!t)return;let i=py.EXTENSIONS;i&&(i={CODE:W1(Ae.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},T.debug("update area from ap success: ".concat(t,",config is "),i),Pe("AREAS",[Ae.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Pe(r,i[r][0]):Pe(r,i[r])}))}function RO(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Mt.reportApiInvoke(null,{name:Hn.SET_AREA,options:t,tag:En.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(s=>{if(!_t(d1).call(d1,s))throw new z(L.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:s,excludedArea:c}=t;if(!s)throw new z(L.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),i=c?YH(l,c):l}if(!e){if(eo.AREAS){const s=new z(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void T.warning("setArea is prohibited because of config-distribute")}if(_t(i).call(i,Ae.GLOBAL)&&M("AREAS")===Ae.EXTENSIONS){const s=new z(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void T.warning("setArea is prohibited because of ap extensions")}}Pe("AREAS",i,e);const r=KH(i);Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Pe(s,r[s][0]):Pe(s,r[s])}),T.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function Y1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ic(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Y1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let vO=1;function zH(t,e,n,i,r){vO+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:vO,requestId:vO,version:Ua,cname:n.cname},c={service_name:e,json_body:JSON.stringify(s)};let l,d,h=t[0];return to(async()=>{l=Date.now();const p=await ao(h,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,p.code!==0){const g=new z(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw T.error(g.toString()),g}const m=JSON.parse(p.json_body);if(m.code!==200){const g=new z(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:d});throw T.error(g.toString()),g}if(!m.servers||m.servers.length===0){const g=new z(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:d});throw T.error(g.toString()),g}const _=function(g,I){return{addressList:g.servers.map(y=>"wss://".concat(y.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(y.wss,"?serviceName=").concat(encodeURIComponent(I))),workerToken:g.workerToken,vid:g.vid}}(m,e);return M("LIVE_STREAMING_ADDRESS")&&(_.addressList=M("LIVE_STREAMING_ADDRESS")instanceof Array?M("LIVE_STREAMING_ADDRESS"):[M("LIVE_STREAMING_ADDRESS")]),ic(ic({},_),{},{responseTime:d})},(p,m)=>(Mt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:m===0,responseTime:d,serverIp:t[m%t.length]}),!1),(p,m)=>(Mt.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:d,serverIp:t[m%t.length]}),!!(p.code!==L.OPERATION_ABORTED&&p.code!==L.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=t[(m+1)%t.length],!0)),r)}let yO=1;function z1(t,e,n,i){let{url:r,areaCode:s}=t;const{clientId:c,sid:l}=e,d=Date.now();let h;const p=e.role,[m,_]=AO(e,s,[Bn.CHOOSE_SERVER]);let g=Vn.networkState;return to(async()=>{g&&Vn.networkState===Zr.OFFLINE&&Vn.onlineWaiter&&await Tt.race([Vn.onlineWaiter,gi(i&&i.maxRetryTimeout||Wn.maxRetryTimeout)]),g=Vn.networkState;const{data:I,headers:y}=await ao(r,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=y.http3==="1"?1:-1,Mt.reportResourceTiming(r,l),X1(I,r,e,d,[Bn.CHOOSE_SERVER],h);const C=Cg(I,Bn.CHOOSE_SERVER);return CO(C),pO(C,r)},I=>(I&&Mt.joinChooseServer(l,{role:p,lts:d,succ:!0,csAddr:r,opid:_,serverList:I.gatewayAddrs.map(y=>y.address),ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[Bn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:I.res.detail&&I.res.detail[38]}),!1),I=>I.code!==L.OPERATION_ABORTED&&(I.code===L.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(Mt.joinChooseServer(l,{role:p,lts:d,succ:!1,csAddr:r,serverList:null,opid:_,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[Bn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:g}),isHttp3:h,corssRegionTagReq:e.apRequestDetail}),T.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),I),!0)),i)}function q1(t,e,n,i){let r,{url:s,areaCode:c,serviceIds:l}=t;const d=Date.now(),h=e.role,[p,m]=AO(e,c,l);let _;return to(async()=>{_&&Vn.networkState===Zr.OFFLINE&&Vn.onlineWaiter&&await Tt.race([Vn.onlineWaiter,gi(i&&i.maxRetryTimeout||Wn.maxRetryTimeout)]),_=Vn.networkState;const{data:g,headers:I}=await ao(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=I.http3==="1"?1:-1,Mt.reportResourceTiming(s,e.sid),X1(g,s,e,d,l,r);const y=Cg(g,Bn.CHOOSE_SERVER),C=Cg(g,e.cloudProxyServer==="proxy5"?Bn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Bn.CLOUD_PROXY:Bn.CLOUD_PROXY_FALLBACK);return CO(y),{gatewayInfo:pO(y,s),proxyInfo:C,url:s}},g=>(g.gatewayInfo&&Mt.joinChooseServer(e.sid,{role:h,lts:d,succ:!0,csAddr:s,serverList:g.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:m,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:g.gatewayInfo.res.detail&&g.gatewayInfo.res.detail[38]}),g.proxyInfo&&Mt.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:g.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),g=>g.code!==L.OPERATION_ABORTED&&(g.code===L.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Mt.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:g.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:_})}),T.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const X1=(t,e,n,i,r,s)=>{const{sid:c,clientId:l,cloudProxyServer:d}=n,h=[],p=m=>{m.flag===4096?Mt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||Mt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:m.error.code,eventType:d,unilbsServerIds:r.toString()})};if(t.response_body.forEach(m=>{const _=m.buffer.code;if(m.uri===23&&_===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const g={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:m.buffer.flag};h.push(g),p(g)}if(_!==0){const g=om(_),I={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:t.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?T.warning(I.error.toString()):h.push(I),p(I)}}),h.length)throw T.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new z(L.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:t.detail[502],desc:[...new Set(h.map(m=>{var _;return m==null||(_=m.error)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.desc}).filter(m=>!!m))]})},CO=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new z(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(M("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?K1(t.detail[23].toLowerCase()):K1()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let d=0;d<l.length;d++){var s;const h=Ji(s=l[d]).call(s);t.addresses[d]&&l&&(t.addresses[d].fingerprint=h)}}if(M("GATEWAY_ADDRESS")&&M("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",M("GATEWAY_ADDRESS"));const c=M("GATEWAY_ADDRESS").map(l=>{var d,h;const p=(d=(h=t.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:p}});t.addresses=c}},qH=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=om(n.buffer.code);throw new z(L.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",e),new z(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},AO=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:ic(ic(ic({6:t.stringUid,11:e,12:M("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};s.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]},XH=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let dm=0;function hm(t){return Tt.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const wg=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:s}=t,c=0;const l=e;let d,h=0;const p=async()=>{const m=(()=>{const _=c*l,g=_+l;return n.slice(_,g).map(i)})();s&&s.push(...m);try{d=await hm(m)}catch(_){if(h+=l,c++,!(h>=n.length))return void await p();r(_)}m.forEach(_=>_.cancel())};return await p(),d},J1=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let s=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(d){if(s++,s>=r||i!=null&&i(d))throw d;return c()}};return c()};async function bO(t,e,n,i){return{gatewayInfo:await async function(s,c,l,d){let h=null;const p=[],m=async()=>{const g=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(C=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(C+"/api/v2/transpond/webrtc?v=2"):"https://".concat(C,"/api/v2/transpond/webrtc?v=2"),areaCode:Og()})),I=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(s.clientId,"] Connect to choose_server:"),C.url),z1(C,s,c,l)),allFailedhandler:C=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y},_=async()=>{if(await gi(1e3),h!==null)return h;const g=M("WEBCS_DOMAIN_BACKUP_LIST").map(C=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(C+"/api/v2/transpond/webrtc?v=2"):"https://".concat(C,"/api/v2/transpond/webrtc?v=2"),areaCode:Og()})),I=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),C.url),z1(C,s,c,l)),allFailedhandler:C=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y};try{return h=await hm([m(),_()]),p.length&&p.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),h}catch(g){throw g[0]}}(t,e,n,i)}}async function Q1(t,e,n,i,r){const s=t.cloudProxyServer;if(s==="disabled"){if(t.useLocalAccessPoint)return await bO(t,e,n,r);if(M("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:g}=await tU(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:_};const I=g.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||Ni.tcpport,udpport:y.udpport||Ni.udpport,username:y.username||Ni.username,password:y.password||Ni.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const y=(c=t.uid)!==null&&c!==void 0?c:_.uid,C="glb:".concat(y.toString()),N=await SI(C),D=g.map(V=>({turnServerURL:V.address,tcpport:V.tcpport||Ni.tcpport,udpport:V.udpport||Ni.udpport,username:C,password:N,forceturn:!1,security:!0}));I.push(...D)}return t.turnServer={mode:"manual",servers:I},{gatewayInfo:_}}return await bO(t,e,n,r)}const{proxyInfo:l,gatewayInfo:d}=await tU(t,e,n,r),h={gatewayInfo:d},p=l.map(_=>({turnServerURL:_.address,tcpport:s==="proxy3"?void 0:_.tcpport?_.tcpport:Ni.tcpport,udpport:s==="proxy4"?void 0:_.udpport?_.udpport:Ni.udpport,username:_.username||Ni.username,password:_.password||Ni.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(r.useP2P){var m;const _=(m=t.uid)!==null&&m!==void 0?m:d.uid,g="glb:".concat(_.toString()),I=await SI(g),y=l.map(C=>({turnServerURL:C.address,tcpport:s==="proxy3"?void 0:C.tcpport||Ni.tcpport,udpport:s==="proxy4"?void 0:C.udpport||Ni.udpport,username:g,password:I,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...y)}return t.turnServer={mode:"manual",servers:p},T.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),h}async function Z1(t,e,n,i,r){const s=M("ACCOUNT_REGISTER").slice(0,M("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?s.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const d=await async function(h,p,m,_,g){const I=Date.now(),y={sid:m.sid,opid:10,appid:m.appId,string_uid:p};let C=h[0];const N=await to(()=>ao(C+"".concat(C.indexOf("?")===-1?"?":"&","action=stringuid"),{data:y,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(D,V)=>{if(D.code===0){if(D.uid<=0||D.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(p," => ").concat(D.uid),D),Mt.reqUserAccount(y.sid,{lts:I,success:!1,serverAddr:C,stringUid:y.string_uid,uid:D.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:y}),new z(L.INVALID_UINT_UID_FROM_STRING_UID);return Mt.reqUserAccount(y.sid,{lts:I,success:!0,serverAddr:C,stringUid:y.string_uid,uid:D.uid,errorCode:null,extend:y}),!1}const W=om(D.code);return W.retry&&(C=h[(V+1)%h.length]),Mt.reqUserAccount(y.sid,{lts:I,success:!1,serverAddr:C,stringUid:y.string_uid,uid:D.uid,errorCode:W.desc,extend:y}),W.retry},(D,V)=>D.code!==L.OPERATION_ABORTED&&(Mt.reqUserAccount(y.sid,{lts:I,success:!1,serverAddr:C,stringUid:y.string_uid,uid:null,errorCode:D.code,extend:y}),C=h[(V+1)%h.length],!0),g);if(N.code!==0){const D=om(N.code);throw new z(L.UNEXPECTED_RESPONSE,D.desc)}return N}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function JH(t,e,n){const i=M("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):i.map(s=>"https://".concat(s,"/api/v1"));try{return await J1({referenceList:r,asyncMapHandler:c=>async function(l,d,h,p){const m=Date.now(),_={sid:h.sid,opid:10,appid:h.appId,string_uid:d};try{const g=await ao(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){const I=om(g.code);throw new z(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(I.desc),I)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new z(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:l,req:_,uid:g.uid,elapse:Date.now()-m}}catch(g){throw g}}(c,t,e,n),closeFn:c=>c.code===L.OPERATION_ABORTED||c.code===L.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(s){throw s}}async function QH(t,e,n){const i=M("CDS_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),r=i.map(d=>function(h,p,m,_){const g=ge(),I={flag:64,cipher_method:0,features:ic(ic(ic(ic(ic({install_id:NI(),device:g.name,system:g.os,system_general:navigator.userAgent,vendor:p.appId,version:Ua,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:GH.WEB_RTC,browser_name:g.name,browser_version:g.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),g.os&&{os_name:g.os}),g.osVersion&&{os_version:g.osVersion}),{},{detail:""})};return to(()=>ao(h,{data:I,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,y=>y.code!==L.OPERATION_ABORTED,_)}(d,t,e,n));let s=null,c=null,l={};try{s=await hm(r)}catch(d){if(d.code===L.OPERATION_ABORTED)throw d;c=d}if(r.forEach(d=>d.cancel()),Mt.reportApiInvoke(t.sid,{name:Hn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=function(d){if(!d.test_tags)return{};const h=d.test_tags,p=Object.keys(h),m={};return p.forEach(_=>{var g;const I=Ji(g=_.slice(4)).call(g),y=JSON.parse(h[_]),C=y[1];m[I]={tag:y[0]||"",value:C}}),m}(s)}catch{}return l}async function $1(t,e){const n=M("WEBCS_DOMAIN").concat(M("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Og(),serviceIds:[Bn.CHOOSE_SERVER,Bn.CLOUD_PROXY_FALLBACK]}));try{return await J1({referenceList:n,asyncMapHandler:r=>async function(s,c,l){let d,{url:h,areaCode:p,serviceIds:m}=s;const _=Date.now(),[g,I]=AO(c,p,m);let y=Vn.networkState;try{y&&Vn.networkState===Zr.OFFLINE&&Vn.onlineWaiter&&await Tt.race([Vn.onlineWaiter,gi(Wn.maxRetryTimeout)]),y=Vn.networkState;const{data:C,headers:N}=await ao(h,{data:g,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=N.http3==="1"?1:-1,(K=>{const j=[];if(K.response_body.forEach(Q=>{const ct=Q.buffer.code;if(Q.uri===23&&ct===0&&!Q.buffer.edges_services)if(Q.buffer.flag===4194310)Q.buffer.edges_services=[];else{const vt={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:K.detail[502]}),flag:Q.buffer.flag};j.push(vt)}if(ct!==0){const vt=om(ct),At={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,vt.desc,{desc:vt.desc,retry:vt.retry,csIp:K.detail[502]}),flag:Q.buffer.flag};Q.buffer.flag===4194310?T.warning(At.error.toString()):j.push(At)}}),j.length)throw new z(L.CAN_NOT_GET_GATEWAY_SERVER,j.map(Q=>"flag: ".concat(Q.flag,", message: ").concat(Q.error.message)).join(" | "),{retry:!!j.find(Q=>Q.error.data.retry),csIp:K.detail[502],desc:[...new Set(j.map(Q=>{var ct;return Q==null||(ct=Q.error)===null||ct===void 0||(ct=ct.data)===null||ct===void 0?void 0:ct.desc}).filter(Q=>!!Q))]})})(C);const V=Cg(C,Bn.CHOOSE_SERVER),W=Cg(C,Bn.CLOUD_PROXY_FALLBACK);return CO(V),{gatewayInfo:pO(V,h),proxyInfo:W,opid:I,requestTime:_,url:h,isHttp3:d,elapse:Date.now()-_}}catch(C){throw C}}(r,t,e),closeFn:r=>r.code===L.OPERATION_ABORTED||r.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function tU(t,e,n,i){const r=M("PROXY_SERVER_TYPE3"),s=(g,I,y)=>{let C=y||r;return Array.isArray(C)&&(C=I%2==0?r[1]:r[0]),"https://".concat(C,"/ap/?url=").concat(g)};let c=null;const l=[],d=async()=>{const g=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map((C,N)=>{let D;return D=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(C,"/api/v2/transpond/webrtc?v=2"):s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N),{url:D,areaCode:Og(),serviceIds:[Bn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Bn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Bn.CLOUD_PROXY:Bn.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(t.clientId,"] Connect to choose_server:"),C.url),q1(C,t,e,n)),allFailedhandler:C=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y},h=async()=>{if(await gi(1e3),c!==null)return c;const g=M("WEBCS_DOMAIN_BACKUP_LIST").map((C,N)=>{let D;return D=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(C,"/api/v2/transpond/webrtc?v=2"):s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N),{url:D,areaCode:Og(),serviceIds:[Bn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Bn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Bn.CLOUD_PROXY:Bn.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),C.url),q1(C,t,e,n)),allFailedhandler:C=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y};let p,m,_;try{({gatewayInfo:p,proxyInfo:m,url:_}=await hm([d(),h()]))}catch(g){throw g[0]}if(l.length&&l.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),!p||!m)throw new z(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=_,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&_){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1];_t(r).call(r,g)&&(t.proxyServer=g,T.setProxyServer(g),Mt.setProxyServer(g))}return c={gatewayInfo:p,proxyInfo:await C1(m,p.uid)},c}async function ZH(t,e,n){const i=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(s=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),r=i.map(s=>function(c,l,d,h){const p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Ua,cname:l.cname,uid:l.uid.toString(),requestId:yO,seq:yO};yO+=1;const m={service_name:"tele_channel",json_body:JSON.stringify(p)};return to(async()=>{const _=await ao(c,{data:m,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){const I=new z(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw T.error(I.toString()),I}const g=JSON.parse(_.json_body);if(g.code!==200){const I=new z(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw T.error(I.toString()),I}if(!g.servers||g.servers.length===0){const I=new z(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(I.toString()),I}return{vid:g.vid,workerToken:g.workerToken,addressList:(M("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,_=>!!(_.code!==L.OPERATION_ABORTED&&_.code!==L.UNEXPECTED_RESPONSE||_.data&&_.data.retry),h)}(s,t,e,n));try{const s=await hm(r);return r.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function $H(t,e,n){let i=null;const r=[],s=async c=>{const l=M(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await gi(1e3),i!==null)?i:await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(T.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),function(h,p,m,_){const[g]=XH(p,[Bn.CHOOSE_SERVER]);let I=Vn.networkState;return to(async()=>{I&&Vn.networkState===Zr.OFFLINE&&Vn.onlineWaiter&&await Tt.race([Vn.onlineWaiter,gi(_&&_.maxRetryTimeout||Wn.maxRetryTimeout)]),I=Vn.networkState;const y=await ao(h,{data:g,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return qH(y,h)},()=>!1,y=>y.code!==L.OPERATION_ABORTED&&(y.code===L.UPDATE_TICKET_FAILED?y.data.retry:(T.warning("[".concat(p.clientId,"] update ticket network error, retry"),y),!0)),_)}(d,t,e,n)),allFailedhandler:d=>{throw d[0]},promisesCollector:r})};try{return i=await hm([s(!1),s(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function eU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function IO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class t6 extends hn{get isSuccess(){return!!this.configs}constructor(e,n){super(),O(this,"configs",void 0),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"cancelToken",void 0),O(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O(this,"interval",void 0),O(this,"mutex",void 0),O(this,"mutableParamsRead",!1),O(this,"configCache",{}),O(this,"limit_bitrate",void 0),this.mutex=new Ui("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),M("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},M("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Mt.reportApiInvoke(null,{options:void 0,name:Hn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:En.TRACER}).onSuccess(JSON.stringify(eo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await QH(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var s;const c=JE(s=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const m=c[p],_=r[m].value;if(typeof _.__priority=="number"){const g=_.__priority,I=c[p-1],y=r[I].value;if(typeof y.__priority=="number"){if(!(g>y.__priority))continue;{const C=m;c[p]=c[p-1],c[p-1]=C}}else{const C=m;c[p]=c[p-1],c[p-1]=C}}}const l=Date.now();let d={};return c.forEach(h=>{const p=r[h].value.__expires;p&&p<=l||(d[h]=r[h])}),d}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new z(L.NETWORK_RESPONSE_ERROR,i);T.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){h1(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(Rg.UPDATE_BITRATE_LIMIT,e):this.emit(Rg.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&IO({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(s=>{const c=e[s].value;n[s]=c;const l=c.__id;if(l&&this.configCache[s]&&this.configCache[s].__id===l)return;const d=c.__type,h=e[s].value,p=e[s].tag;let m=0;d?d===jP.REALTIME&&(m=1):Object.keys(h).some(_=>Object.prototype.hasOwnProperty.call(kI,_)||!iO()&&Object.prototype.hasOwnProperty.call(Kv,_)?(m=1,!0):void 0),r.push({tag:p,isApplied:m,feature:s,params:JSON.stringify(c)})}),r.forEach(s=>{let{tag:c,feature:l,params:d,isApplied:h}=s;this.store.sessionId&&Mt.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){T.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const s={};return Object.keys(r).forEach(c=>{const l=r[c].value,d=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=IO(IO({value:l[p]},d&&{expires:d}),h&&{type:h}))})}),s}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&h1(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const d=Date.now();Object.keys(l).forEach(h=>{const{value:p,type:m,expires:_}=l[h];_&&_<=d||((m===jP.REALTIME||Object.prototype.hasOwnProperty.call(kI,h))&&(eo[h]=p,en[h]=p,T.debug("Update realtime parameters from config distribute",h,p)),m||iO()||!Object.prototype.hasOwnProperty.call(Kv,h)||(eo[h]=p,en[h]=p,T.debug("Update gateway parameters from config distribute",h,p)))})}catch(d){T.error("Error update config immediately: ".concat(l),d.message)}}(n);const s=JSON.stringify(n),c=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",c),T.debug("Caching global parameters ".concat(s))}catch(r){T.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(en,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(en[i],r)||(eo[i]=r,en[i]=r,this.emit(Rg.UPDATE_CLIENT_ROLE_OPTIONS,r),T.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){T.error("Error handling global parameter config:",n.message)}}}class e6 extends hn{constructor(){super(...arguments),O(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(M("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var s;const c=_t(s=r.result).call(s,!0);r.isPrevNormal&&!c&&this.emit("exception",nU[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",nU[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof qn&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=$r(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof qn&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const nU={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Bi=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function iU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function mh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class Ng{constructor(e){O(this,"store",void 0),O(this,"onStatsException",void 0),O(this,"onUploadPublishDuration",void 0),O(this,"onStatsChanged",void 0),O(this,"localStats",new Map),O(this,"remoteStats",new Map),O(this,"updateStatsInterval",void 0),O(this,"trafficStats",void 0),O(this,"trafficStatsPeerList",[]),O(this,"uplinkStats",void 0),O(this,"exceptionMonitor",void 0),O(this,"p2pChannel",void 0),O(this,"scalabilityMode",Wv.L1T1),O(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new e6,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(st.LocalAudioTrack)||mh({},BI)}getLocalVideoTrackStats(){return this.localStats.get(st.LocalVideoTrack)||mh({},FI)}getRemoteAudioTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{networkStats:c}]=r;c&&(n[s]=c)});return n}getRemoteVideoTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const s=this.localStats.get(st.LocalAudioTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const c=this.localStats.get(st.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(st.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:m}=h;p&&(i+=p.receiveBytes,r+=p.receiveBitrate),m&&(i+=m.receiveBytes,r+=m.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),s=r!=null&&r.videoSSRC?Bi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?Bi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,s=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case st.LocalVideoTrack:case st.LocalVideoLowTrack:{const c=r,l=mh({},FI),d=e.getStats(),h=e.getLocalMedia(i);if(d){const p=d.videoSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){const m=e.getLocalVideoSize(),_=e.getEncoderConfig(st.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),_&&_.bitrateMax&&(l.targetSendBitrate=1e3*_.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&h&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,h.track,l);break}case st.LocalAudioTrack:{const c=r,l=mh({},BI),d=e.getStats(),h=e.getLocalMedia(i);if(d){const p=d.audioSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const m=e.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(st.LocalAudioTrack,l),l&&h&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,h.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[s,{videoStats:c,audioStats:l,videoPcStats:d}]=n;const h=l,p=c,m=d,_=mh({},ZP),g=mh({},$P),I=mh({},B5),{audioTrack:y,videoTrack:C,audioSSRC:N,videoSSRC:D}=e.getRemoteMedia(s);let V;V=this.store.useP2P?e.getStats(!0):e.getStats();const W=(i=V)===null||i===void 0?void 0:i.audioRecv.find(ct=>ct.ssrc===N),K=(r=V)===null||r===void 0?void 0:r.videoRecv.find(ct=>ct.ssrc===D),j=this.trafficStats&&this.trafficStats.peer_delay.find(ct=>ct.peer_uid===s);if(W&&(W.codec!=="opus"&&W.codec!=="aac"&&W.codec!=="PCMU"&&W.codec!=="PCMA"&&W.codec!=="G722"||(_.codecType=W.codec),W.outputLevel?_.receiveLevel=Math.round(32767*W.outputLevel):y&&(_.receiveLevel=Math.round(32767*y.getVolumeLevel())),_.receiveBytes=W.bytes,_.receivePackets=W.packets,_.receivePacketsLost=W.packetsLost,_.receivePacketsDiscarded=W.packetsDiscarded,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=h?8*Math.max(0,_.receiveBytes-h.receiveBytes):0,_.totalDuration=h?h.totalDuration+1:1,_.totalFreezeTime=h?h.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=W.jitterBufferMs,_.totalDuration>10&&Ng.isRemoteAudioFreeze(y)&&(_.totalFreezeTime+=1)),K){var Q;K.codec!=="H264"&&K.codec!=="H265"&&K.codec!=="VP8"&&K.codec!=="VP9"&&K.codec!=="AV1X"&&K.codec!=="AV1"||(g.codecType=K.codec),g.receiveBytes=K.bytes,g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.decodeFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,g.renderFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,K.outputFrame&&(g.renderFrameRate=K.outputFrame.frameRate),K.receivedFrame?(g.receiveFrameRate=K.receivedFrame.frameRate,g.receiveResolutionHeight=K.receivedFrame.height,g.receiveResolutionWidth=K.receivedFrame.width):C&&(g.receiveResolutionHeight=C._videoHeight||0,g.receiveResolutionWidth=C._videoWidth||0),K.framesRateFirefox!==void 0&&(g.receiveFrameRate=Math.round(K.framesRateFirefox)),g.receivePackets=K.packets,g.receivePacketsLost=K.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost);const ct=p?p.totalFreezeTime:0,vt=p?p.totalDuration:0;g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=(Q=K.totalFreezesDuration)!==null&&Q!==void 0?Q:ct||0,g.receiveDelay=K.jitterBufferMs||0;const At=!!D&&e.getRemoteVideoIsReady(D);K.totalFreezesDuration===void 0&&C&&At&&Ng.isRemoteVideoFreeze(C,K,m)&&(g.totalFreezeTime+=1),g.freezeRate=Math.max(0,Math.min((g.totalFreezeTime-ct)/(g.totalDuration-vt),1))}j&&(_.end2EndDelay=j.B_ad,g.end2EndDelay=j.B_vd,_.transportDelay=j.B_ed,g.transportDelay=j.B_ed,_.currentPacketLossRate=j.B_ealr4/100,g.currentPacketLossRate=j.B_evlr4/100,I.uplinkNetworkQuality=j.B_punq?j.B_punq:0,I.downlinkNetworkQuality=j.B_pdnq?j.B_pdnq:0),this.remoteStats.set(s,{audioStats:_,videoStats:g,videoPcStats:K,networkStats:I}),y&&this.exceptionMonitor.setRemoteAudioStats(y,_),C&&this.exceptionMonitor.setRemoteVideoStats(C,g)})}}class rU{constructor(){O(this,"destChannelMediaInfos",new Map),O(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){u1(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){u1(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){uy(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function aU(t){if(!(t instanceof rU))return new z(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new z(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new z(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Au{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){O(this,"uid",void 0),O(this,"_uintid",void 0),O(this,"_trust_in_room_",!0),O(this,"_trust_audio_enabled_state_",!0),O(this,"_trust_video_enabled_state_",!0),O(this,"_trust_audio_mute_state_",!0),O(this,"_trust_video_mute_state_",!0),O(this,"_audio_muted_",!1),O(this,"_video_muted_",!1),O(this,"_audio_enabled_",!0),O(this,"_video_enabled_",!0),O(this,"_audio_added_",!1),O(this,"_video_added_",!1),O(this,"_is_pre_created",!1),O(this,"_video_pre_subscribed",!1),O(this,"_audio_pre_subscribed",!1),O(this,"_trust_video_stream_added_state_",!0),O(this,"_trust_audio_stream_added_state_",!0),O(this,"_audioTrack",void 0),O(this,"_videoTrack",void 0),O(this,"_dataChannels",[]),O(this,"_audioSSRC",void 0),O(this,"_videoSSRC",void 0),O(this,"_audioOrtc",void 0),O(this,"_videoOrtc",void 0),O(this,"_cname",void 0),O(this,"_rtxSsrcId",void 0),O(this,"_videoMid",void 0),O(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function sU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function oU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?sU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Dg="9",cU=4e4;function lU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var pm=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(pm||{});const Cy=new Map;function uU(t,e,n,i){let{scale:r}=t;if(r===0&&i===pm.UP||r>=e.length-1&&i===pm.DOWN)return t;let s=sl(sl({},t),{},{scale:i===pm.DOWN?++r:--r});switch(n){case"maintain-framerate":s=sl(sl({},s),e[r].motion);break;case"maintain-resolution":s=sl(sl({},s),e[r].detail);break;case"balanced":s=sl(sl({},s),e[r].balanced)}return s}function dU(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:hU(e)};Cy.set(t,n)}else Cy.delete(t)}function hU(t){const e=sl({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:s}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:_,PERF_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:y,BALANCE_FRAMERATE_FACTOR:C,BALANCE_RESOLUTION_FACTOR:N,MOTION_RESOLUTION_FACTOR:D,MOTION_BITRATE_FACTOR:V,DETAIL_FRAMERATE_FACTOR:W,DETAIL_BITRATE_FACTOR:K}=LI,j=Math.min(e.frameRate,l),Q=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(g,1)*j),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s}}];for(let ct=1;ct<=d;ct++){const vt={bwe_up:Math.round(Math.pow(m,ct)*n),bwe_down:Math.round(Math.pow(_,ct+1)*n),fps_up:Math.round(Math.pow(I,ct)*j),fps_down:Math.round(Math.pow(g,ct+1)*j)},At={scaleResolutionDownBy:r/Math.pow(N,ct),frameRate:Math.max(Math.round(Math.pow(C,ct)*i),c),bitrateMax:Math.max(Math.round(Math.pow(y,ct)*n),p),bitrateMin:Math.max(Math.round(Math.pow(y,ct)*s),h)},ue={scaleResolutionDownBy:r/Math.pow(D,ct),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(V,ct)*n),p),bitrateMin:Math.max(Math.round(Math.pow(V,ct)*s),h)},de={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(W,ct)*i),c),bitrateMax:Math.max(Math.round(Math.pow(K,ct)*n),p),bitrateMin:Math.max(Math.round(Math.pow(K,ct)*s),h)};Q.push({scale:ct,threshold:vt,balanced:At,motion:ue,detail:de})}return Q}function n6(t,e,n,i,r,s){const c=Cy.get(t)||{overUse:0,underUse:0,adaptationList:hU(r)},{adaptationList:l}=c;Cy.set(t,c);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=LI,{scale:p}=i;let m,_;return typeof e=="number"&&e>0&&function(g,I,y,C){if(I>=y.length)return!1;let{threshold:{fps_down:N}}=y[I];return M("FORCE_AG_HIGH_FRAMERATE")&&C==="maintain-framerate"&&(N=y[0].threshold.fps_down),g<N}(e,p,l,s)&&(c.overUse++,_=mg.CPU,c.overUse>d)||typeof n=="number"&&n>0&&function(g,I,y){if(I>=y.length)return!1;const{threshold:{bwe_down:C}}=y[I];return g<C}(n,p,l)&&(c.overUse++,_=mg.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,m=uU(i,l,s,pm.DOWN),[m,_]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(g,I,y,C){if(I===0)return;let{threshold:{fps_up:N}}=y[I];return M("FORCE_AG_HIGH_FRAMERATE")&&C==="maintain-framerate"&&(N=y[1].threshold.fps_up),g>N}(e,p,l,s)&&function(g,I,y){if(I===0)return;const{threshold:{bwe_up:C}}=y[I];return g>C}(n,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,m=uU(i,l,s,pm.UP),m.scale===0&&(_=mg.NONE))),[m,_])}function pU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function OO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function i6(t){var e;return!!M("ENABLE_AG_ADAPTATION")&&!!(t instanceof XI||_t(e=t._hints).call(e,ze.CUSTOM_TRACK))&&(!!M("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=ge();if(i.os!==ni.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&lP(17,4)||cP(14)&&uP(17,4,!0)))}const Ay=new Map;function by(t,e){const n=Ay.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),Ay.delete(t)}e.qualityLimitationReason=mg.NONE,dU(t)}function r6(t,e){var n;let i;switch(e){case st.LocalAudioTrack:i=we.Audio;break;case st.LocalVideoTrack:i=_t(n=t._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalVideoLowTrack:i=we.Low}return i}function wO(t){const e=Re();if(t.some(n=>n._bypassWebAudio))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function NO(t,e){wO(t);const n=new qn;return t.forEach(i=>n.addAudioTrack(i)),n}const a6=!Re().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Jc();function Iy(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return a6?(n={spec:e,store:t},rl("PlanBConnection").create(n)):new rc(e,t)}function DO(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function fU(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(hg(t.turnServer.servers))return!1;if(M("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var _e;function mU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function so(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let rc=(_e=class Dh extends f1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return _t(n=Object.keys(Yv)).call(n,e)}))]}constructor(e,n){super(e,n),O(this,"id",Ye(5,"connection-")),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"forceTurn",!1),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:M("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"preSSRCMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"supportAV1RtpSpec",!1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",mg.NONE),O(this,"isFirstConnected",!1),this.store=n,this.forceTurn=fU(e),this.mutex=new Ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Dh.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=wI(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,mn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=yu(i.sdp),s=await k1({filterRTX:!M("USE_PUB_RTX")&&!M("USE_SUB_RTX"),filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterVideoCodec:M("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=Sy(s),this.initialOffer=i,M("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Wv.L1T3}]});const h=await d.createOffer();if(!h.sdp)return void d.close();const p=Mr(h.sdp).mediaDescriptions[0];if(!p)return;const m=p.attributes.extmaps.find(_=>_.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),m}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=s.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&V1(i.sdp)&&(c=gn(s),(n=c).send&&(cm(It.VIDEO,n.send.videoExtensions),cm(It.AUDIO,n.send.audioExtensions)),n.recv&&(cm(It.VIDEO,n.recv.videoExtensions),cm(It.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(cm(It.VIDEO,n.sendrecv.videoExtensions),cm(It.AUDIO,n.sendrecv.audioExtensions))),so(so({},r),{},{rtpCapabilities:c||s,offerSDP:i.sdp})}catch(i){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&V1(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(_y(It.VIDEO,n.send.videoExtensions,i.send.videoExtensions),_y(It.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(_y(It.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),_y(It.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return gn(this._localCapabilities)}get rtpCapabilities(){return gn(this._rtpCapabilities)}get candidates(){return gn(this._candidates)}get iceParameters(){return gn(this._iceParameters)}get dtlsParameters(){return gn(this._dtlsParameters)}constructor(h){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_originCandidates",void 0),O(this,"_iceParameters",void 0),O(this,"_isUseExtmapAllowMixed",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),O(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,h=gn(h);const{iceParameters:m,dtlsParameters:_,candidates:g,rtpCapabilities:I,setup:y,localCapabilities:C,cname:N}=h;this._rtpCapabilities=I,this._candidates=g,this._originCandidates=gn(g),this._iceParameters=m,this._dtlsParameters=_,this._localCapabilities=C,this.setup=y,this.cname=N,this.sessionDesc=this.updateRemoteRTPCapabilities(I),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(h){const p=this.candidates,m=this.dtlsParameters,_=this.iceParameters,g=this.rtpCapabilities.send;let I=this.sessionDesc.mediaDescriptions.length-1;for(let y=1;y<h;y++){const C=2*y+2e4,N=2*y+cU,{ssrcs:D,ssrcGroups:V}=fh([{ssrcId:C}],this.cname),{ssrcs:W,ssrcGroups:K}=fh([{ssrcId:N,rtx:M("USE_SUB_RTX")?N+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.videoCodecs.map(j=>j.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_.iceUfrag,icePwd:_.icePwd,unrecognized:[],candidates:p,extmaps:g.videoExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:W,ssrcGroups:K,rtcpFeedbackWildcards:[],payloads:g.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++I)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.audioCodecs.map(j=>j.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_.iceUfrag,icePwd:_.icePwd,unrecognized:[],candidates:p,extmaps:g.audioExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:D,ssrcGroups:V,rtcpFeedbackWildcards:[],payloads:g.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++I)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return gu(this.sessionDesc)}send(h,p,m,_){const{ssrcs:g,ssrcGroups:I}=fh(p,this.cname,M("SYNC_GROUP")?m:void 0),y=this.findPreloadMediaDesc(g);if(y){if(mn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,y.attributes.mid),_&&(_.twcc||_.remb)){const C=this.sessionDesc.mediaDescriptions.indexOf(y);return this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(y,_),{mid:y.attributes.mid,needExchangeSDP:!0}}return{mid:y.attributes.mid,needExchangeSDP:!1}}{const C=this.findAvailableMediaIndex(h,g);let N;return C===-1||C===1&&(Ii()||function(){const D=ge();return!(D.name!==Ce.CHROME||!D.osVersion)&&Number(D.version)<=90}()||M("ENABLE_ENCODED_TRANSFORM")&&Xc())||C===0&&M("USE_SUB_RTX")||dP()?(N=this.createOrRecycleSendMedia(h,g,I,"sendonly",_),this.updateBundleMids()):(N=gn(this.sessionDesc.mediaDescriptions[C]),N.attributes.direction="sendonly",N.attributes.ssrcs=g,N.attributes.ssrcGroups=I,this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(N,_)),mn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,N.attributes.mid),{mid:N.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:p}}batchSend(h){const p=h.map(g=>{let{kind:I,ssrcMsg:y,mslabel:C}=g;return this.send(I,y,C)}),m=[];let _=!1;return p.forEach(g=>{let{mid:I,needExchangeSDP:y}=g;y&&(_=!0),m.push(I)}),{mids:m,needExchangeSDP:_}}stopSending(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(m=>{m.attributes.mid==="0"||mn()||dP()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>_t(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>_t(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="recvonly"})}receive(h,p,m,_){h.forEach((g,I)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",p,m,_[I])}),this.updateBundleMids()}stopReceiving(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const p=this.sessionDesc||Mr((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=h;const _=this.rtpCapabilities.send,g=this.localCapabilities.send;for(const I of p.mediaDescriptions){if(I.attributes.iceUfrag=this._iceParameters.iceUfrag,I.attributes.icePwd=this._iceParameters.icePwd,I.attributes.fingerprints=this._dtlsParameters.fingerprints,I.attributes.candidates=this._candidates,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"){if(_.videoCodecs.length===0){const y=g.videoCodecs.filter(C=>{var N,D;return(N=C.rtpMap)===null||N===void 0?void 0:_t(D=N.encodingName.toLowerCase()).call(D,"vp8")})||[g.videoCodecs[0]];I.media.fmts=y.map(C=>C.payloadType.toString(10)),I.attributes.payloads=y,I.attributes.extmaps=[]}else if(I.media.fmts=_.videoCodecs.map(y=>y.payloadType.toString(10)),I.attributes.payloads=_.videoCodecs,I.attributes.extmaps=_.videoExtensions,M("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:y,ssrcGroups:C}=fh([{ssrcId:cU,rtx:M("USE_SUB_RTX")?40001:void 0}],this.cname);I.attributes.ssrcs=y,I.attributes.ssrcGroups=C}}if(I.media.mediaType==="audio"){if(_.audioCodecs.length===0){const y=g.audioCodecs.filter(C=>{var N,D;return(N=C.rtpMap)===null||N===void 0?void 0:_t(D=N.encodingName.toLowerCase()).call(D,"opus")})||[g.audioCodecs[0]];I.media.fmts=y.map(C=>C.payloadType.toString(10)),I.attributes.payloads=y,I.attributes.extmaps=[]}else if(I.media.fmts=_.audioCodecs.map(y=>y.payloadType.toString(10)),I.attributes.payloads=_.audioCodecs,I.attributes.extmaps=_.audioExtensions,um(I),M("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:y,ssrcGroups:C}=fh([{ssrcId:2e4}],this.cname);I.attributes.ssrcs=y,I.attributes.ssrcGroups=C}}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(h){const p=this._originCandidates.filter(_=>_.transport==="udp"),m=[];if(p.forEach(_=>{m.push(oU(oU({},_),{},{foundation:"tcpcandidate",priority:Number(_.priority)-1+"",transport:"tcp",port:Number(_.port)+90+""}))}),p.length!==0){switch(h){case Vi.TCP_RELAY:this._candidates=m;break;case Vi.UDP_TCP_RELAY:case Vi.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const _ of this.sessionDesc.mediaDescriptions)_.attributes.candidates=this.candidates}}restartICE(h){h=gn(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let m=0;m<h;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(h,p){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const _=m.media.mediaType===h&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(mn()){if(_){const g=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(g||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!g||g!==m.attributes.mid)}return!1}return _})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:Dg,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,p,m,_,g,I){const y=h._mediaStreamTrack.kind,C=this.rtpCapabilities.recv,N=bg(y,C,this.localCapabilities.send,y===It.VIDEO?_:g),D=y===It.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let W={media:{mediaType:y,port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map(j=>j.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:D,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};W=this.mungRecvMediaDsec(W,h,I);const K=this.findFirstClosedMedia(y);if(K){const j=this.sessionDesc.mediaDescriptions.indexOf(K);this.sessionDesc.mediaDescriptions[j]=W}else this.sessionDesc.mediaDescriptions.push(W);return W}updateRemoteCodec(h,p,m){const _=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"").filter(W=>{var K;return _t(K=Object.keys(Yv)).call(K,W)}))],g=new Set(p);if(_.every(W=>g.has(W)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const I=this._rtpCapabilities.recv.videoCodecs.filter(W=>p.some(K=>{var j;return _t(j=W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"").call(j,K)}));if(I.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(_," codecs: ").concat(p)),!1;const y=[...new Set(I.map(W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||""))];let C;if(T.debug("updateRemoteCodec, from ".concat(_," to ").concat(y)),h.length===0)C=this.sessionDesc.mediaDescriptions.filter(W=>W.media.mediaType==="video"&&W.attributes.direction==="recvonly");else if(C=this.sessionDesc.mediaDescriptions.filter(W=>W.attributes.mid&&_t(h).call(h,W.attributes.mid)&&W.attributes.direction==="recvonly"),C.length!==h.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(p)),!1;if(M("USE_PUB_RTX")||M("USE_SUB_RTX")){const W=EO(I,this.rtpCapabilities.recv.videoCodecs);I.push(...W)}this._rtpCapabilities.recv.videoCodecs=I;const N=this.localCapabilities.send,D=this.rtpCapabilities.recv,V=bg(It.VIDEO,D,N,m);return C.forEach(W=>{const K=V.map(j=>j.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(W.attributes.mid,", from"),W.attributes.payloads,"to",V),W.attributes.payloads=V,W.media.fmts=K}),!0}createOrRecycleSendMedia(h,p,m,_,g){const I=this.rtpCapabilities.send,y=h===It.VIDEO?I.videoCodecs:I.audioCodecs,C=h===It.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const N="".concat(this.currentMidIndex);let D={media:{mediaType:h,port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:y.map(W=>W.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};D=this.mungSendMediaDesc(D,g);const V=this.findFirstClosedMedia(h);if(V){const W=this.sessionDesc.mediaDescriptions.indexOf(V);this.sessionDesc.mediaDescriptions[W]=D}else this.sessionDesc.mediaDescriptions.push(D);return D}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,p,m){const _=gn(h);return mO(_),lm(_,p),_O(_,p),L1(_),gy(_,m,this.localCapabilities.send),_}mungSendMediaDesc(h,p){const m=gn(h);return gy(m,p,this.localCapabilities.recv),um(m),m}updateRecvMedia(h,p){const m=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===h);if(m!==-1){const _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=_}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(p=>mn()?p.media.port==="0"&&p.media.mediaType===h:p.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===h[0].ssrcId})}getSSRC(h){var p;return(p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h))===null||p===void 0?void 0:p.attributes.ssrcs}}(so(so({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),s=U1(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),M("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(M("PRELOAD_MEDIA_COUNT"));const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}const{preSSRCs:d}=e;if(Array.isArray(d)&&d.length>0){const{mids:h}=this.remoteSDP.batchSend(d.map(p=>({kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,m)=>{this.preSSRCMap.set(d[m].ssrcId,p)}),await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));r.forEach((s,c)=>{this.preSSRCMap.set(i[c].ssrcId,s)})}await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Ma(function*(){const s=yield Ee(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=my();e.forEach(C=>{const N=r.peerConnection.addTransceiver(C._mediaStreamTrack,so({direction:"sendonly"},C.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(N),C._updateRtpTransceiver(N)}),mn()&&M("SIMULCAST")===!0&&(yield Ee(r.applySimulcastForFirefox(c,e)));const d=yield Ee(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(e.length),p=r.mungSendOfferSDP(d.sdp,e,h),m=Mr(p),_=h.map(C=>{const N=m.mediaDescriptions.find(D=>D.attributes.mid===C);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return w1(N,M("USE_PUB_RTX"))});let g;try{g=yield _}catch(C){g=[],r.remoteSDP.receive(e,n,i,g);const N=r.remoteSDP.toString();throw yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield Ee(r.stopSending(h,!0)),C}r.remoteSDP.receive(e,n,i,g);const I=r.remoteSDP.toString(),y=r.logSDPExchange(p,"offer","local","send");return yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(r.applySimulcastEncodings(c,e)),yield Ee(r.applySendEncodings(c,e)),y==null||y(I),yield Ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:I})),c.map((C,N)=>{const D=h[N];return{localSSRC:_[N],id:D,transceiver:C}})}catch(c){throw c instanceof $?c:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:M("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(s=>{s._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof $?i:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof $?n:new $(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{var h;by(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const s=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:r,transceiver:s}})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,d]=c;if(d===s)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Ma(function*(){const i=yield Ee(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Re().supportPCSetConfiguration,s=M("FORCE_TURN_TCP")||n.forceTurn;if(e===Vi.RELAY&&!r)return;if(r&&!s){const m=e===Vi.RELAY?"relay":"all",_=n.peerConnection.getConfiguration();_.iceTransportPolicy!==m&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(m,"]")),_.iceTransportPolicy=m,n.peerConnection.setConfiguration(_))}n.remoteSDP.updateCandidates(e);const c=yield Ee(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=yu(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),p=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ee(n.peerConnection.setLocalDescription(c)),p==null||p(h),yield Ee(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Vi.TCP_RELAY),await Ig(this.peerConnection,this.remoteSDP,this.extension)}catch(n){T.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{by(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return so(so({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?mn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:so(so({},Zo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:so(so({},Zo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(hg(e.turnServer.servers)?n.iceServers=e.turnServer.servers:M("NEW_TURN_MODE")&&n.iceServers?(M("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...Dh.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...Dh.newTurnServerConfigToIceServers(e.turnServer.servers)),M("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Dh.turnServerConfigToIceServers(e.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Dh.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),M("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&Re().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ru(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!M("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const r=M("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ru(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ru(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:s}=i.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(C=>C.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Re().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},c={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const l=function(y,C){return y.getTransceivers().find(N=>N.sender.track===C||N.receiver.track===C)}(this.peerConnection,e._mediaStreamTrack),d=W5(e);if(i6(e)&&l&&n&&d&&this.getLocalVideoStats&&_t(i=["vp8","vp9"]).call(i,this.store.codec)){var h;const y=s.degradationPreference||(_t(h=e._hints).call(h,ze.CUSTOM_TRACK)?M("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(C,N,D,V,W,K){if(by(C,D),W(N),V!=="balanced"&&V!=="maintain-framerate"&&V!=="maintain-resolution")return;let j=-1;dU(C,N);const Q=window.setInterval(()=>{const vt=Ay.get(C);if(!M("ENABLE_AG_ADAPTATION")||!vt)return by(C,D),void W(N);const At=K();if(At.sendPackets>0&&At.OutgoingAvailableBandwidth>0){if(j===-1)return void(j=Date.now());if(Date.now()-j<1e3)return;const ue=At.sendFrameRate,de=At.OutgoingAvailableBandwidth,[qe,Pn]=n6(C,ue,de,vt.adaptationConfig,N,V);Pn&&(D.qualityLimitationReason=Pn),qe&&vt.adaptationConfig.scale!==qe.scale&&(T.debug("[".concat(C,"] applyAdaptation: ").concat(D.qualityLimitationReason,`
           sendFps `).concat(ue,", bwe ").concat(de,", switch from ").concat(vt.adaptationConfig.scale," to ").concat(qe.scale," ")),vt.adaptationConfig=OO(OO({},vt.adaptationConfig),qe),W(qe))}},M("CHECK_LOCAL_STATS_INTERVAL")),ct=OO({},N);Ay.set(C,{timer:Q,adaptationConfig:ct,originConfig:N,adaptationFunc:W}),T.debug("[".concat(C,"] start adaptation, originConfig: ").concat(JSON.stringify(N),", degradationPreference: ").concat(V))})(this.id+l.mid,d,this,y,C=>{n&&this.updateAdaptation(n,C)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;const{bitrateMax:y,frameRate:C,scaleResolutionDownBy:N}=e._encoderConfig;y&&(c.maxBitrate=1e3*y),(_t(p=e._hints).call(p,ze.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(C&&(c.maxFramerate=$r(C)),N&&N>=1&&(c.scaleResolutionDownBy=N))}const{maxFramerate:m}=M("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,m):m),M("DSCP_TYPE")&&Jc()){var _;const y=M("DSCP_TYPE");_t(_=["very-low","low","medium","high"]).call(_,y)&&(c.networkPriority=y)}const g=n.getParameters(),I=(r=g.encodings)===null||r===void 0?void 0:r[0];mn()&&!I&&(s.encodings=[c]),I&&Object.assign(I,c),Object.assign(g,s),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await async function(y,C,N){try{var D;if(!Re().supportSetRtpSenderParameters||!function(Q){return Q==="vp9"||Q==="av1"}(y)||!M("ENABLE_SVC"))return;const V={},W={},K=C.getParameters(),j=(D=K.encodings)===null||D===void 0?void 0:D[0];W.scalabilityMode=my(N),j&&Object.assign(j,W),Object.assign(K,V),await C.setParameters(K),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(K.encodings)))}catch(V){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",V)}}(this.store.codec,n,M("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return T.debug("[updateAdaptation] no rtpSender found");if(!Re().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=n;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=$r(l)),d&&d>=1&&_t(i=["vp8","vp9"]).call(i,this.store.codec)&&(s.scaleResolutionDownBy=d);const h=e.getParameters(),p=(r=h.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,s),Object.assign(h,{});try{await e.setParameters(h),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(m){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!Re().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof nn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Mr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(lm(d,s),P1(d,s,this.store.codec))}),gu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof nn&&!_t(i=p._hints).call(i,ze.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},_={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,m))}}}async applySimulcastEncodings(e,n){if(!mn()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof nn&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof nn&&M("SIMULCAST")&&this.store.codec==="vp8"&&!_t(n=e._hints).call(n,ze.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(M("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(Re().supportPCSetConfiguration){const n=Dh.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Lt(_e.prototype,"updateRemoteRTPCapabilities",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"updateRemoteRTPCapabilities"),_e.prototype),Lt(_e.prototype,"connect",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"connect"),_e.prototype),Lt(_e.prototype,"updateRemoteConnect",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"updateRemoteConnect"),_e.prototype),Lt(_e.prototype,"createDataChannels",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"createDataChannels"),_e.prototype),Lt(_e.prototype,"receive",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"receive"),_e.prototype),Lt(_e.prototype,"batchReceive",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"batchReceive"),_e.prototype),Lt(_e.prototype,"stopReceiving",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"stopReceiving"),_e.prototype),Lt(_e.prototype,"muteRemote",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"muteRemote"),_e.prototype),Lt(_e.prototype,"unmuteRemote",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"unmuteRemote"),_e.prototype),Lt(_e.prototype,"muteLocal",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"muteLocal"),_e.prototype),Lt(_e.prototype,"unmuteLocal",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"unmuteLocal"),_e.prototype),Lt(_e.prototype,"close",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"close"),_e.prototype),Lt(_e.prototype,"updateEncoderConfig",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"updateEncoderConfig"),_e.prototype),Lt(_e.prototype,"updateSendParameters",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"updateSendParameters"),_e.prototype),Lt(_e.prototype,"replaceTrack",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"replaceTrack"),_e.prototype),Lt(_e.prototype,"updateAdaptation",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"updateAdaptation"),_e.prototype),Lt(_e.prototype,"getRemoteSSRC",[gr],Object.getOwnPropertyDescriptor(_e.prototype,"getRemoteSSRC"),_e.prototype),_e);function gr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function LO(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=$r(e.width),i.height=$r(e.height);const r=$r(e.framerate||15);document.body.append(n),document.body.append(i);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const c=i.getContext("2d");if(!c)throw new z(L.UNEXPECTED_ERROR,"can not get canvas context");const l=Re(),d=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];d.canvas||(d.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,m=n.videoHeight/p,_=i.width*m;Math.abs(_-i.height)>=2&&(T.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(_)),i.height=_)}c.drawImage(n,0,0,i.width,i.height),d.requestFrame&&d.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},i.stopCapture=HI(()=>i.startCapture&&i.startCapture(),r);const h=d.stop;return d.stop=()=>{h.call(d),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),T.debug("clean low stream renderer")},d}var Oy=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(Oy||{}),Fn=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(Fn||{}),_h=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(_h||{}),jn=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(jn||{}),Eh=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(Eh||{}),_U=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(_U||{}),ac=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(ac||{}),Sr=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(Sr||{}),EU=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(EU||{}),Tr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Tr||{}),wy=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(wy||{});const gh=1e3,Sh=6,Ny=3,s6=Math.max(Sh,Ny);function Ht(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function gU(t){const e={[Tr.CONN_TYPE]:0,[Tr.RTT]:t.rtt,[Tr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[Tr.CONN_TYPE]=1),n==="tcp"&&(e[Tr.CONN_TYPE]=3),n==="tls"&&(e[Tr.CONN_TYPE]=4);break}case"srflx":e[Tr.CONN_TYPE]=2;break;case"unknown":e[Tr.CONN_TYPE]=5;break;default:e[Tr.CONN_TYPE]=0}return e}function SU(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class TU extends hn{constructor(e){super(),O(this,"store",void 0),O(this,"uploadWRTCStatsTimer",void 0),O(this,"uploadOutboundDenoiserStatsTimer",void 0),O(this,"uploadExtStatsTimer",void 0),O(this,"uploadExtUsageStatsTimer",void 0),O(this,"uploadInboundExtStatsTimer",void 0),O(this,"requestStats",void 0),O(this,"requestTransportStats",void 0),O(this,"requestLocalMedia",void 0),O(this,"requestRemoteMedia",void 0),O(this,"requestAllTracks",void 0),O(this,"requestVideoIsReady",void 0),O(this,"requestUploadStats",void 0),O(this,"requestUpload",void 0),O(this,"uploadOutboundStarted",!1),O(this,"uploadInboundStarted",!1),O(this,"uploadTransportStarted",!1),O(this,"uploadBaseStatsStarted",!1),O(this,"uploadExtensionUsageStarted",!1),O(this,"lastRecvStats",void 0),O(this,"lastSendStats",void 0),O(this,"lastRefRecvStats",void 0),O(this,"lastRefSendStats",void 0),O(this,"lastFullRecvStats",void 0),O(this,"lastFullSendStats",void 0),O(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%Ny==0,i=e%Sh==0;let r,s;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(s=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!s&&this.uploadInboundStarted&&(s=this.requestStats(!0)),r||s){var c;const l={};if(this.uploadTransportStarted&&r){const h=this.getTransportStats(r,s,n);h&&(l.misc=[h])}if(this.uploadOutboundStarted&&r){const h=this.getOutboundStats(r,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);h&&(l.outbound=[h])}if(this.uploadInboundStarted&&s){const h=this.getInboundStats(s,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);h&&(l.inbound=h)}const d=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;d&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[wy.RTC_PEER_CONNECTION_STATE]=OI[d]):l.misc=[{addition:{[wy.RTC_PEER_CONNECTION_STATE]:OI[d]}}]),this.requestUploadStats(l)}this.lastRecvStats=s,this.lastSendStats=r,i&&(this.lastFullRecvStats=s,this.lastFullSendStats=r),n&&(this.lastRefRecvStats=s,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[wy.RTC_PEER_CONNECTION_STATE]:OI[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===s6+1&&(e=1)},gh)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[Tr.RTT]:e.rtt,[Tr.CONN_TYPE]:void 0,[Tr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=gU(e);if(this.store.useP2P){if(n){const s=gU(n);r[Tr.CONN_TYPE]+=s[Tr.CONN_TYPE]<<3}r[Tr.CONN_TYPE]+=110}else r[Tr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const s=this.requestLocalMedia();if(!s||s.length===0)return;let c,l,d;return s.forEach(h=>{let[p,{track:m,ssrcs:_}]=h;switch(p){case st.LocalVideoLowTrack:case st.LocalVideoTrack:if(p===st.LocalVideoTrack){const g=function(C,N,D,V,W,K){const j=N.videoSend.find(At=>At.ssrc===C);if(!j)return;const Q={},{sentFrame:ct,inputFrame:vt}=j;if(K&&(Ht(Q,Fn.QP_SUM,j.qpSumPerFrame),vt&&ct)){const At=vt.frameRate,ue=ct.frameRate;Q[Fn.FREEZE]=function(de,qe){let Pn=!0;return Pn=!(de<=5)&&(de<=10?qe<3:de<=20?qe<4:qe<5),Pn}(At,ue)?1:0}if(W){switch(ct&&(Ht(Q,Fn.HEIGHT,ct.height),Ht(Q,Fn.WIDTH,ct.width),Ht(Q,Fn.FRAME_RATE,ct.frameRate)),Q[Fn.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0,j.adaptionChangeReason){case"none":Q[Fn.ADAPTATION]=0;break;case"cpu":Q[Fn.ADAPTATION]=1;break;case"bandwidth":Q[Fn.ADAPTATION]=2;break;case"other":Q[Fn.ADAPTATION]=3}let At=0;j.adaptionChangeReason&&(At+=SU(j.adaptionChangeReason)),N.qualityLimitationReason&&(At+=SU(N.qualityLimitationReason)<<3),Q[Fn.ADAPTATION]=At,Q[Fn.PLAYER_STATUS]=jI[V._player?V._player.videoElementStatus:"uninit"],Ht(Q,Fn.NACKS,j.nacksCount),Ht(Q,Fn.PLIS,j.plisCount),Ht(Q,Fn.FIRS,j.firsCount),Ht(Q,Fn.AVG_ENCODE,j.avgEncodeMs),Ht(Q,Fn.HUGE_FRAME_SENT,j.hugeFramesSent),Ht(Q,Fn.BYTES_RETRANSMIT,j.retransmittedBytesSent),Ht(Q,Fn.PACKAGES_RETRANSMIT,j.retransmittedPacketsSent),Ht(Q,Fn.KEY_FRAMES_ENCODED,j.keyFramesEncoded);const ue=D&&D.videoSend.find(de=>de.ssrc===C);if(ue){let de=W?gh:gh*Sh;ue.timestamp&&j.timestamp&&(de=j.timestamp-ue.timestamp),ue.packets!=null&&j.packets!=null&&Ht(Q,Fn.PACKAGE_RATE,1e3*(j.packets-ue.packets)/de),j.packetsLost!=null&&ue.packetsLost!=null&&Ht(Q,Fn.PACKAGE_LOST,j.packetsLost-ue.packetsLost),ue.bytes!=null&&j.bytes!=null&&Ht(Q,Fn.BITRATE,8*(j.bytes-ue.bytes)/de)}}return Q}(_[0].ssrcId,e,n,m,i,r),I=m&&function(C,N,D,V){const W=N.videoSend.find(j=>j.ssrc===C);if(!W)return null;const K={};if(V){const j=W.inputFrame,Q=j&&j.height||D.videoHeight||0,ct=j&&j.width||D.videoWidth||0,vt=j&&j.frameRate||0;Ht(K,Oy.HEIGHT,Q),Ht(K,Oy.WIDTH,ct),Ht(K,Oy.FRAME_RATE,vt)}return K}(_[0].ssrcId,e,m,i),y=function(C,N){const D={};return N&&(Ht(D,Fn.RETRANSMIT,C.bitrate.retransmit),Ht(D,Fn.TARGET_ENCODED,C.bitrate.targetEncoded),Ht(D,Fn.ACTUAL_ENCODED,C.bitrate.actualEncoded),Ht(D,Fn.TRANSMIT,C.bitrate.transmit),Ht(D,Fn.BANDWIDTH,C.sendBandwidth)),D}(e,i);l=Object.assign({},g,I,y)}else d=function(g,I,y,C){const N=I.videoSend.find(V=>V.ssrc===g);if(!N)return;const D={};if(C){const V=N.sentFrame;if(V&&(Ht(D,_h.HEIGHT,V.height),Ht(D,_h.WIDTH,V.width),Ht(D,_h.FRAME_RATE,V.frameRate)),y){const W=y.videoSend.find(K=>K.ssrc===g);if(W){let K=gh*Sh;W.timestamp&&N.timestamp&&(K=N.timestamp-W.timestamp),W.packets!=null&&N.packets!=null&&Ht(D,_h.PACKAGE_RATE,1e3*(N.packets-W.packets)/K),N.packetsLost!=null&&W.packetsLost!=null&&Ht(D,_h.PACKAGE_LOST,N.packetsLost-W.packetsLost),W.bytes!=null&&N.bytes!=null&&Ht(D,_h.BITRATE,8*(N.bytes-W.bytes)/K)}}}return D}(_[0].ssrcId,e,n,i);break;case st.LocalAudioTrack:c=m&&function(g,I,y,C,N){const D=I.audioSend.find(W=>W.ssrc===g);if(!D)return;const V={};if(N){V[ac.DISABLED]=C._originMediaStreamTrack&&!C._originMediaStreamTrack.enabled||C._mediaStreamTrack&&!C._mediaStreamTrack.enabled?1:0;const W=100*C._source.getAccurateVolumeLevel(),K=D.inputLevel;if(K!=null){const Q=Math.ceil(50*Math.log10(100*K+1));Ht(V,ac.LEVEL,Q)}Ht(V,_U.PCM_LEVEL,W),Ht(V,ac.AEC_RETURN_LOSS,D.aecReturnLoss),Ht(V,ac.AEC_RETURN_LOSS_ENH,D.aecReturnLossEnhancement),Ht(V,ac.BYTES_RETRANSMIT,D.retransmittedBytesSent),Ht(V,ac.PACKAGES_RETRANSMIT,D.retransmittedPacketsSent),V[ac.FREEZE]=0;const j=y&&y.audioSend.find(Q=>Q.ssrc===g);if(j){let Q=gh*Sh;j.timestamp&&D.timestamp&&(Q=D.timestamp-j.timestamp),j.bytes!=null&&D.bytes!=null&&Ht(V,ac.BITRATE,8*(D.bytes-j.bytes)/Q),j.packets!=null&&D.packets!=null&&Ht(V,ac.PACKAGE_RATE,1e3*(D.packets-j.packets)/Q)}}return V}(_[0].ssrcId,e,n,m,i)}}),{high:l,low:d,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[d,h]=l;const p={peer:d.uid};if(h.has(It.VIDEO)&&d.videoTrack){const m=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,_=d.videoTrack?function(g,I,y,C,N,D,V,W){const K=I.videoRecv.find(de=>de.ssrc===g);if(!K)return;const j={},{receivedFrame:Q,outputFrame:ct,decodeFrameRate:vt}=K,At=y&&y.videoRecv.find(de=>de.ssrc===g);if(Ht(j,Eh.FRAME_RATE_DECODE,vt),K.framesRateFirefox&&Ht(j,jn.FRAME_RATE,K.framesRateFirefox),Q&&Ht(j,jn.FRAME_RATE,Q.frameRate),Ht(j,jn.FRAMES_DROPPED,K.framesDroppedCount),Ht(j,jn.BYTES_RETRANSMIT,K.retransmittedBytesReceived),Ht(j,jn.PACKAGES_RETRANSMIT,K.retransmittedPacketsReceived),Ht(j,jn.PACKAGES_DISCARDED,K.packetsDiscarded),Ht(j,jn.AVG_DECODE,K.avgDecodeMs),Ht(j,jn.AVG_PROCESSING_DELAY,K.avgProcessingDelayMs),Ht(j,jn.AVG_ASSEMBLY_TIME,K.avgFramesAssembledFromMultiplePacketsMs),Ht(j,jn.AVG_INTER_FRAME_DELAY,K.avgInterFrameDelayMs),Ht(j,jn.KEY_FRAMES_DECODED,K.keyFramesDecoded),At){const de=I.timestamp-y.timestamp||gh*(W?Sh:V?Ny:1);K.packetsLost!=null&&At.packetsLost!=null&&Ht(j,jn.PACKAGE_LOST,K.packetsLost-At.packetsLost),At.bytes!=null&&K.bytes!=null&&Ht(j,jn.BITRATE,8*(K.bytes-At.bytes)/de),At.packets!=null&&K.packets!=null&&Ht(j,jn.PACKAGE_RATE,1e3*(K.packets-At.packets)/de)}if(W&&(Ht(j,jn.QP_SUM,K.qpSumPerFrame),j[jn.FREEZE]=N&&Ng.isRemoteVideoFreeze(C,K,At)?1:0),V){var ue;Q?(Ht(j,jn.HEIGHT,Q.height),Ht(j,jn.WIDTH,Q.width)):C&&(Ht(j,jn.HEIGHT,C._videoHeight||0),Ht(j,jn.WIDTH,C._videoWidth||0)),ct&&Ht(j,Eh.FRAME_RATE_OUTPUT,ct.frameRate);const de=(ue=C._player)===null||ue===void 0?void 0:ue.rendFrameRate.toFixed(0);if(de&&Ht(j,Eh.FRAME_RATE_RENDER,+de),Ht(j,jn.JITTER_BUFFER,K.jitterBufferMs),Ht(j,jn.CURRENT_DELAY,K.currentDelayMs),Ht(j,jn.FIRS,K.firsCount),Ht(j,jn.NACKS,K.nacksCount),Ht(j,jn.PLIS,K.plisCount),C){j[jn.DISABLED]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1;const qe=C._player;if(qe){const{freezeTimeCounterList:Pn,renderFreezeAccTime:yn,videoElementStatus:vr}=qe;if(Pn&&Pn.length>0&&Ht(j,Eh.FREEZE_TIME,Pn.splice(0,1)[0]),D&&$c.visibility==="visible"&&vr===Qi.PLAYING&&Re().supportRequestVideoFrameCallback){const nt=Math.min(6e3,yn);qe.renderFreezeAccTime=Math.max(0,yn-nt),Ht(j,Eh.FREEZE_TIME_RENDER,nt)}if(typeof K.totalFreezesDuration=="number"){const nt=At&&At.totalFreezesDuration?K.totalFreezesDuration-At.totalFreezesDuration:K.totalFreezesDuration;Ht(j,Eh.FREEZE_DURATION,1e3*nt)}}}if(j[jn.PLAYER_STATUS]=jI[C._player?C._player.videoElementStatus:"uninit"],At&&K.totalInterFrameDelay!==void 0&&K.totalSquaredInterFrameDelay!==void 0&&At.totalInterFrameDelay!==void 0&&At.totalSquaredInterFrameDelay!==void 0){const qe=K.totalInterFrameDelay-At.totalInterFrameDelay,Pn=K.totalSquaredInterFrameDelay-At.totalSquaredInterFrameDelay,yn=K.framesDecodeCount-At.framesDecodeCount,vr=qe/yn*1e3,nt=Math.round(1e3*Math.sqrt((Pn-Math.pow(qe,2)/yn)/yn));!isNaN(nt)&&vr+nt>Math.max(3*vr,vr+150)&&(j[jn.I_FRAME_DELAY]=nt)}}return j}(d._videoSSRC,e,n,d.videoTrack,m===!0,this.needUploadRenderFreezeTime,i,r):void 0;_&&(p.video=_)}if(h.has(It.AUDIO)&&d.audioTrack){const m=d.audioTrack?function(_,g,I,y,C,N){const D=g.audioRecv.find(j=>j.ssrc===_);if(!D)return;const V={},W=I&&I.audioRecv.find(j=>j.ssrc===_);if(Ht(V,Sr.JITTER,D.jitterMs),Ht(V,Sr.BYTES_RETRANSMIT,D.retransmittedBytesReceived),Ht(V,Sr.PACKAGES_RETRANSMIT,D.retransmittedPacketsReceived),Ht(V,Sr.PACKAGES_DISCARDED,D.packetsDiscarded),Ht(V,Sr.AVG_PROCESSING_DELAY,D.avgProcessingDelayMs),W){const j=g.timestamp-I.timestamp||gh*(N?Sh:C?Ny:1);D.packets!=null&&W.packets!=null&&Ht(V,Sr.PACKAGE_RATE,1e3*(D.packets-W.packets)/j),C&&W.bytes!=null&&D.bytes!=null&&Ht(V,Sr.BITRATE,8*(D.bytes-W.bytes)/j),D.packetsLost!=null&&W.packetsLost!=null&&Ht(V,Sr.PACKAGE_LOST,D.packetsLost-W.packetsLost)}if(N){const{receivedFrames:j,droppedFrames:Q}=D;j!=null&&Q!=null&&(V[Sr.FREEZE]=(K=j)===0||100*Q/K>20?1:0)}var K;if(C){const j=100*y._source.getAccurateVolumeLevel(),Q=D.outputLevel;if(Q!=null){const ct=Math.ceil(50*Math.log10(100*Q+1));Ht(V,EU.LEVEL,ct)}if(Ht(V,Sr.PCM_LEVEL,j),y&&(V[Sr.DISABLED]=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?0:1),Ht(V,Sr.JITTER_BUFFER,D.jitterBufferMs),Ht(V,Sr.CURRENT_DELAY,D.jitterBufferMs),V[Sr.PLAYER_STATUS]=jI[Er.getPlayerState(y.getTrackId())],W){const ct=D.concealedSamples-W.concealedSamples;ct>0&&Ht(V,Sr.CONCEALED_SAMPLES,ct);const vt=D.totalSamplesReceived-W.totalSamplesReceived;vt>0&&Ht(V,Sr.TOTAL_SAMPLES_RECEIVED,vt)}}return V}(d._audioSSRC,e,n,d.audioTrack,i,r):void 0;m&&(p.audio=m)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof $v);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Tg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(It.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(It.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of c)p.has(It.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),p.has(It.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(h,p){const m={};for(const{id:y,value:C,level:N,direction:D}of h){var _;const V=(_=p.get(y))!==null&&_!==void 0?_:0,W=C===2?V+M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:V;var g,I;p.set(y,W),m[y]?(C===2&&(m[y].value=C),N>m[y].level&&(m[y].level=N),D==="remote"&&(m[y].remoteUidCount+=1),m[y].totalTs=(g=p.get(y))!==null&&g!==void 0?g:0):m[y]={value:C,level:N,remoteUidCount:D==="local"?0:1,totalTs:(I=p.get(y))!==null&&I!==void 0?I:0}}return Object.keys(m).map(y=>{const{level:C,value:N,totalTs:D}=m[y];return{id:y,level:C,value:N,totalTs:D}})}(r,e);const l=Date.now(),d=l>n?l:n+1;this.requestUpload&&this.requestUpload(Tg.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:d})},M("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const o6=M("ICE_RESTART_INTERVAL");let Dy=new Map,fm=new Map,bu=[Vi.UDP_TCP_RELAY,Vi.TCP_RELAY,Vi.RELAY],PO=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Re().supportPCSetConfiguration;function RU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Dy.get(t.id);n&&(window.clearTimeout(n),Dy.delete(t.id));const i=fm.get(t.id);e&&i&&i.index===bu.length-1&&(T.debug("[".concat(t.id,"] reset ICE restart policy")),fm.delete(t.id))}function vU(t,e,n){if(Dy.size===0&&fm.size===0&&(Array.isArray(M("RESTART_SEQUENCE"))&&M("RESTART_SEQUENCE").length>0&&!function(l,d){if(l.length!==d.length)return!1;for(let h=0;h<l.length;h+=1){const p=l[h];if(l.filter(m=>m===p).length!==d.filter(m=>m===p).length)return!1}return!0}(bu,M("RESTART_SEQUENCE"))&&(bu=M("RESTART_SEQUENCE").filter(l=>{var d;if(_t(d=Object.values(Vi)).call(d,l))return!0}),T.debug("use reconnection policy from config distribution, queues: ".concat(bu.join(" => ")))),PO=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Re().supportPCSetConfiguration),bu.length===0)return void n();let i,{index:r=0,type:s}=fm.get(t.id)||{};if(PO&&s===Vi.RELAY)return void n();let c=s&&r>=bu.length-1;if(PO)s=Vi.RELAY;else{if(c)return void n();s?(r++,s=bu[r]):(s=bu[0],r=0)}T.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(r)),e(s),fm.set(t.id,{index:r,type:s}),i=window.setTimeout(()=>vU(t,e,n),o6),Dy.set(t.id,i)}var ae;function yU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function CU(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=iI,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new Ly(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Ly(t){function e(n){if(Object(n)!==n)return Tt.reject(new TypeError(n+" is not an object."));var i=n.done;return Tt.resolve(n.value).then(function(r){return{value:r,done:i}})}return Ly=function(n){this.s=n,this.n=n.next},Ly.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Tt.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Tt.reject(n):e(i.apply(this.s,arguments))}},new Ly(t)}let Lg=(ae=class extends hn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Ft.StateChange,e,this._state)}constructor(t,e){super(),O(this,"isPlanB",void 0),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"connection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"remoteDataChannelMap",new Map),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"pendingLocalDataChannels",[]),O(this,"pendingRemoteDataChannels",[]),O(this,"statsCollector",void 0),O(this,"shouldForwardP2PCreation",void 0),O(this,"iceFailedCount",0),O(this,"dtlsFailedCount",0),O(this,"mutex",void 0),O(this,"_state",Oe.Disconnected),O(this,"_pcStatsUploadType",M("NEW_ICE_RESTART")?il.FIRST_CONNECTION:il.OLD_FIRST_CONNECTION),O(this,"_isStartRestartIce",!1),O(this,"_restartTimer",void 0),O(this,"_isTryConnecting",!1),O(this,"_iceError",null),O(this,"_forceTurn",!1),O(this,"_isWaitPcToRePub",!1),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createMuteMessage(c);await Ke(this,Ft.RequestMuteLocal,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Re().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=LO(n,pg(this,Ft.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new Tt((p,m)=>{this.handleReplaceTrack(h.track,p,m,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createUnmuteMessage(c);await Ke(this,Ft.RequestUnmuteLocal,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;s||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(st.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Oe.Connected)return void i();const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Ft.UpdateVideoEncoder,p),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(st.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Oe.Connected)return void i();const{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleReplaceMixingTrack",async(n,i,r,s)=>{if(!this.connection||this.state!==Oe.Connected)return void i();const c=NO([n]);let l;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(h){r(h)}finally{var d;(d=l)===null||d===void 0||d()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.connection||!h||this.state!==Oe.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===st.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Re().supportDualStreamEncoding){const p=this.localTrackMap.get(st.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new Tt((_,g)=>{this.handleReplaceTrack(p.track,_,g,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),O(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new TU(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ui("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Re().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Jc(),this.shouldForwardP2PCreation=M("FORWARD_P2P_CREATION")&&Re().supportPCSetConfiguration&&mI(),this.shouldForwardP2PCreation&&(this.connection=Iy(this.store),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=Oe.New,this._forceTurn=fU(t),T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Iy(this.store,t),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=M("NEW_ICE_RESTART")?il.FIRST_CONNECTION:il.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");M("ENABLE_PREALLOC_PC")&&this.state===Oe.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Oe.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var s;let[c]=r;return _t(s=[st.LocalVideoLowTrack,st.LocalVideoTrack]).call(s,c)}),n=e.map(r=>{let[,{id:s}]=r;return s}),i=e.map(r=>{let[s]=r;return s});if(this.connection instanceof rc){if(Mt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!_t(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(s=>_t(t).call(t,s));r&&(this.store.codec=r,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof rc&&this.connection.peerConnectionState!=="closed"&&_t(t=[Oe.New,Oe.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Oe.Connected){if(this.state===Oe.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;_t(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return Ma(function*(){const r=yield Ee(i.mutex.lock("From P2PChannel.publish"));try{var s;const c=i.connection&&_t(s=["disconnected","failed"]).call(s,i.connection.peerConnectionState);if(!i.connection||i.state!==Oe.Connected||c){if(i.state===Oe.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const d=t.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(d),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Bi.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield Ee(i.tryToUnmuteAudio(t)));yield*bv(CU(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return Ma(function*(){e.forEach(_=>{let{track:g,type:I}=_;const y=Date.now();n.store.publish(g.getTrackId(),I===st.LocalAudioTrack?"audio":"video",y)}),n.bindLocalTrackEvents(e);const i=e.map(_=>{let{track:g}=_;return g}),r=yield Ee(t.send(i,n.store.codec,n.store.audioCodec)),s=(yield Ee(r.next())).value,c=n.createGatewayPublishMessage(e,s);let l;try{l=yield c}catch(_){throw r.throw(_),(_==null?void 0:_.code)===L.WS_ABORT&&e.forEach(g=>{let{track:I}=g;n.pendingLocalTracks.indexOf(I)===-1&&n.pendingLocalTracks.push(I)}),n.unbindLocalTrackEvents(e),_}const d=n.mapPubResToRemoteConfig(c,l,i),h=(yield Ee(r.next(d))).value;if(n.state===Oe.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");M("ENABLE_VIDEO_SEI");const p=M("ENABLE_ENCODED_TRANSFORM"),m=M("ENABLE_AUDIO_METADATA");i.forEach(async _=>{const g=_.getRTCRtpTransceiver();if(!g||!p)return;const{interceptLocalVideoFrame:I,interceptLocalAudioFrame:y}=Ty();_.trackMediaType===It.VIDEO?await I(g.sender,_):_.trackMediaType===It.AUDIO&&await y(g.sender,{metadata:m?()=>{const C=_.metadata.shift();return C&&C.value}:void 0})}),e.forEach(_=>{let{type:g}=_;n.statsCollector.addLocalStats(g)}),n.assignLocalTracks(e,h),n.statsUploader.startUploadOutboundStats(),e.forEach(_=>{let{track:g,type:I}=_;const y=Date.now();n.store.publish(g.getTrackId(),I===st.LocalAudioTrack?"audio":"video",void 0,y)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof nn))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(s,c){const l={};return s.height&&s.width&&(l.scaleResolutionDownBy=fO(s,c)),l.maxFramerate=s.framerate?$r(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==st.LocalVideoLowTrack||!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Re().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const s=i._originMediaStreamTrack;if(!s.canvas)return T.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const d=c.canvas;l.width&&(d.width=$r(l.width)),l.height&&(d.height=$r(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=HI(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},$r(l.framerate)))})(s,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),T.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return Ma(function*(){if(!e.connection||e.state!==Oe.Connected)return;const n=yield Ee(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(st.LocalVideoTrack);if(!r)throw new $(L.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(st.LocalVideoLowTrack))throw new $(L.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(r.track,t),type:st.LocalVideoLowTrack}];if(yield*bv(CU(e.doPublish(e.connection,s))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(st.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Ee(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await wi(this,Ft.RequestRePublish,this.pendingLocalTracks),this.emit(Ft.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await wi(this,Ft.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==It.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==It.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await wi(this,Ft.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===It.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(Ft.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Oe.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Oe.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Oe.Connected)return;const t=this.localTrackMap.get(st.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[st.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:s}]=i;return{type:r,track:s}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Oe.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===t.uid&&d===i.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var s;if(!this.connection||this.state!==Oe.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;let c,l,d;const h=this.connection.getPreMedia(n);if(h)T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),d=h.transceiver,c=h.track,l=h.id;else if(r){const _=r.find(I=>{let{stream_type:y}=I;return y===e});if(!_)throw new $(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const g=await this.connection.receive(e,_.ssrcs,String(t._uintid),_.attributes);this.connection instanceof rc&&(d=g.transceiver),c=g.track,l=g.id}else{const _=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof rc&&(d=_.transceiver),c=_.track,l=_.id}if(e===It.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new em(c,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),d&&t._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new tm(c,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),d&&t._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._videoTrack)),d&&M("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:_,interceptRemoteAudioFrame:g}=Ty();e==It.VIDEO?await _(d.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(I=>{var y;return(y=t._videoTrack)===null||y===void 0?void 0:y._onSei(I)})}):e==It.AUDIO&&await g(d.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),onMetadata:I=>{this.safeEmit(Ft.AudioMetadata,I)}})}const p=this.remoteUserMap.get(t);p?p.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex(_=>{let{user:g,kind:I}=_;return g.uid===t.uid&&e===I});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Ft.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Oe.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var s;let{user:c,mediaType:l}=r;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const s=this.connection.getPreMedia(r.ssrcId);s?n.set(r.ssrcId,s):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:d}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(s._uintid)}}));e.forEach((r,s)=>{n.set(r.ssrcId,i[s])});for(const{user:r,mediaType:s,ssrcId:c}of t){const l=n.get(c);if(!l)return void T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(s,", ").concat(c));const{track:d,id:h,transceiver:p}=l;if(p&&M("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:I}=Ty();s==It.VIDEO?await g(p.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(y=>{var C;return(C=r._videoTrack)===null||C===void 0?void 0:C._onSei(y)})}):s==It.AUDIO&&await I(p.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),onMetadata:y=>{this.safeEmit(Ft.AudioMetadata,y)}})}if(s===It.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(d):(r._audioTrack=new em(d,r.uid,r._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),p&&r._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(d):(r._videoTrack=new tm(d,r.uid,r._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),p&&r._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._videoTrack)),M("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:I}=Ty();s==It.VIDEO?await g(p.receiver,{onSei:y=>{var C;(C=r._videoTrack)===null||C===void 0||C._onSei(y)}}):s==It.AUDIO&&await I(p.receiver)}const m=this.remoteUserMap.get(r);m?m.set(s,h):this.remoteUserMap.set(r,new Map([[s,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(g=>{let{user:I,kind:y}=g;return I.uid===r.uid&&s===y});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Ft.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return e!==void 0?l.uid===t.uid&&e===d:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Oe.Connected||n||i.forEach(c=>{let{kind:l}=c;var d;if(l===It.AUDIO)(d=t._audioTrack)===null||d===void 0||d._destroy(),t._audioTrack=void 0;else if(l===It.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Oe.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var h,p;if(d===It.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===It.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(d===It.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const s=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:s}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return s!==void 0?d.uid===r.uid&&s===h:d.uid===r.uid});c.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(c)}if(!this.connection||this.state!==Oe.Connected)return void e.forEach(r=>{let{user:s,kind:c}=r;var l;if(c===It.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===It.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}});const n=nr(t).call(t,(r,s)=>{let{user:c,mediaType:l}=s;const d=this.filterTobeUnSubscribedTracks(c,l);return r.concat(d)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:s}]=r;return s}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[s,{kind:c}]=r;var l,d;if(c===It.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===It.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(c===It.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==Oe.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===It.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(st.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(st.LocalAudioTrack);if((e==null?void 0:e.track)instanceof qn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==st.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===st.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===st.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(st.LocalAudioTrack),l=i?this.localTrackMap.get(st.LocalVideoLowTrack):this.localTrackMap.get(st.LocalVideoTrack);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof vn),l=i?(s=this.localTrackMap.get(st.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof nn);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===It.VIDEO?n._videoSSRC:n._audioSSRC;r&&Mt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===It.VIDEO,audio:i===It.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:Bi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ui("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Iy(this.store),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(st.LocalAudioTrack);if((t==null?void 0:t.track)instanceof qn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Oe.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(st.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(st.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof nn||e&&e.track instanceof vn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ua(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(st.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=JE(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Oe.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Iy(this.store),this.emit(Ft.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case st.LocalVideoTrack:_t(e=i._hints).call(e,ze.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case st.LocalAudioTrack:i instanceof qn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case st.LocalVideoLowTrack:}}),this.emit(Ft.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ua(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Ft.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ua(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof Au?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Au?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Ma(function*(){if(!e.connection||e.state!==Oe.Connected)return;const n=yield Ee(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Ee(e.connection.restartICE(t));const s=yield Ee(i.next());if(s.done)return;const c=s.value,l=yield c;switch(DO(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case Vi.UDP_TCP_RELAY:e._pcStatsUploadType=il.UDP_TCP_RESTART;break;case Vi.TCP_RELAY:e._pcStatsUploadType=il.TCP_RESTART;break;case Vi.RELAY:e._pcStatsUploadType=il.RELAY_RESTART;break;default:e._pcStatsUploadType=il.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(s){var r;(r=i)===null||r===void 0||r.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalAudioTrack),i=t.videoSend.find(g=>g.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(g=>g.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const s=ca(this,Ft.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,_=e==null?void 0:e.track;if(_&&_._encoderConfig&&_._hints.indexOf(ze.SCREEN_TRACK)===-1){const g=_._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(g&&I){const y=(1e3*g-I)/(1e3*g);return r1[y<.15?0:y<.3?1:y<.45?2:y<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===s);if(!c&&!l)return void(e+=1);const d=ca(this,Ft.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,_=t.recvPacketLossRate;let g=.7*_*100/50+.3*p/1500;m&&(g=.6*_*100/50+.2*p/1500+.2*m/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Tt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Oe.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const s=i[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,s)}if(r===st.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Re().supportDualStreamEncoding){const s=this.localTrackMap.get(st.LocalVideoLowTrack);if(s){const c=t._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new Tt((l,d)=>{this.handleReplaceTrack(s.track,l,d,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=jf(t=t.filter(d=>r.indexOf(d)===-1));let s,c=!1;const l=this.localTrackMap.get(st.LocalAudioTrack);for(const d of t){if(d instanceof nn&&(this.localTrackMap.has(st.LocalVideoTrack)||c?new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:st.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:st.LocalVideoLowTrack})}if(d instanceof vn)if(l){const h=l.track;if(h instanceof qn)wO([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const p=NO([h,d]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof qn?(wO([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&Re().webAudioMediaStreamDest&&!d._bypassWebAudio?s=NO(s?[d,s]:[d]):s=d}return s&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),i.push({track:s,type:st.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=jf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof vn){const r=this.localTrackMap.get(st.LocalAudioTrack);if(!r)continue;r.track instanceof qn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([st.LocalAudioTrack,r]),r.track.close())):e.push([st.LocalAudioTrack,r])}if(i instanceof nn){const r=this.localTrackMap.get(st.LocalVideoTrack);if(!r)continue;e.push([st.LocalVideoTrack,r]);const s=this.localTrackMap.get(st.LocalVideoLowTrack);s&&e.push([st.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(t){return t=(t=jf(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=jf(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.addListener(Nt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Nt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof qn?t.trackList.forEach(n=>{n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.off(Nt.GET_STATS,this.handleGetLocalVideoStats),n.off(Nt.GET_RTC_STATS,this.handleGetRTCStats),n.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof qn?t.trackList.forEach(e=>{e.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Nt.GET_STATS,this.handleGetLocalAudioStats),e.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Nt.GET_STATS,this.handleGetLocalAudioStats),t.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof tm&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof em&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(It.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(It.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,c,{track:l,type:d}=n;switch(d){case st.LocalAudioTrack:s=we.Audio,c={dtx:l instanceof $v&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case st.LocalVideoTrack:s=_t(r=l._hints).call(r,ze.SCREEN_TRACK)?we.Screen:we.High,c=sc(sc({},v1(l)),{},{codec:this.store.codec,svc_mode:my()});break;case st.LocalVideoLowTrack:s=we.Low,c=sc(sc({},v1(l)),{},{codec:this.store.codec,svc_mode:my()})}return{stream_type:s,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case st.LocalVideoTrack:i=_t(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalAudioTrack:i=we.Audio;break;case st.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Ft.PeerConnectionStateChange,e),e==="connecting"&&t instanceof rc&&!mn()&&M("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},M("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof rc&&RU(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=il.DISCONNECTED_OR_FAILED,ca(this,Ft.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));Mt.reportApiInvoke(this.store.sessionId,{name:Hn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:En.TRACER}).onSuccess(),this.republish()}if(M("NEW_ICE_RESTART")&&t instanceof rc&&!mn()&&!this._forceTurn){if(_t(m1).call(m1,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{DO(t)&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),ca(this,Ft.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ft.RequestRestartICE,r))},i=()=>{DO(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ft.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{vU(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&M("ICE_RESTART")&&ca(this,Ft.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ft.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ft.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ft.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Mt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:En.TRACER}).onSuccess(),this.emit(Ft.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Xf.FIRST_FRAME_DECODED),Mt.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_DECODE,cn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_RECEIVED,cn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ii.FIRST_VIDEO_RECEIVED,cn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Ft.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return sc(sc({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof rc&&function(e){fm.delete(e.id),RU(e)}(t),t.close(),this.emit(Ft.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive||e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===st.LocalVideoTrack)){const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive&&e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===st.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:i=we.Audio;break;case st.LocalVideoTrack:i=_t(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:i=we.Audio;break;case st.LocalVideoTrack:i=_t(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case It.VIDEO:return void(i._videoSSRC&&e.push({stream_type:It.VIDEO,ssrcId:i._videoSSRC}));case It.AUDIO:return void(i._audioSSRC&&e.push({stream_type:It.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let s=e.get(i);r===It.VIDEO?s|=ri.Video:s|=ri.Audio,e.set(i,s)}else r===It.VIDEO?e.set(i,ri.Video):e.set(i,ri.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var s;let{stream_type:c}=i;const l=(s=e.find(d=>{let{stream_type:h}=d;return c===h}))===null||s===void 0?void 0:s.attributes;if(l&&M("DISABLE_SCREEN_SHARE_REMB")){const d=n[r]._hints;(_t(d).call(d,ze.SCREEN_TRACK)||_t(d).call(d,ze.SCREEN_LOW_TRACK))&&(l.remb=!1,T.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof vn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(s=>{let[,{id:c}]=s;return c})));const r=this.createUnmuteMessage(i);return void await Ke(this,Ft.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Ft.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Ft.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await gi(yI(this.dtlsFailedCount,Wn)),this.emit(Ft.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await wi(this,Ft.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Ft.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(st.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof nn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof nn).length>1)throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof vn).length>1&&(t.some(e=>e instanceof vn&&e._bypassWebAudio)||!Re().webAudioMediaStreamDest))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof nn&&this.pendingLocalTracks.some(n=>n instanceof nn))throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof vn&&this.pendingLocalTracks.some(n=>n instanceof vn)&&(!Re().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof vn&&n._bypassWebAudio)))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Re().supportDualStreamEncoding,r=sc(sc({},{width:160,height:120,framerate:15,bitrate:50}),e);let s;s=i?t._mediaStreamTrack.clone():LO(t,r);const c=Ye(8,"track-low-"),l=new nn(s,sc(sc({},i&&{scaleResolutionDownBy:fO(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(oh.TRANSCEIVER_UPDATED,d=>{t._updateRtpTransceiver(d,zf.LOW_STREAM)}),l._hints.push(ze.LOW_STREAM),_t(n=t._hints).call(n,ze.SCREEN_TRACK)&&l._hints.push(ze.SCREEN_LOW_TRACK),t.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),t.addListener(Nt.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof rc){var r,s,c,l;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:m}=this.connection,{local:_,remote:g}=await this.connection.getSelectedCandidatePair();Mt.pcStats(this.store.sessionId,{startTime:d,eventElapse:t-d||0,iceconnectionsate:h,dtlsstate:p,connectionstate:m,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=_==null?void 0:_.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(s=_.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(_.address,":").concat(_.port),selectedRemoteCandidateProtocol:(c=g.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=g.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ua(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Mt.firstRemoteVideoDecode(this.store.sessionId,ii.FIRST_VIDEO_DECODE,cn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.connection.getRemoteSSRC(r);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===st.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,zf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Lt(ae.prototype,"startP2PConnection",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"startP2PConnection"),ae.prototype),Lt(ae.prototype,"connect",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"connect"),ae.prototype),Lt(ae.prototype,"updateRemoteRTPCapabilities",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"updateRemoteRTPCapabilities"),ae.prototype),Lt(ae.prototype,"publishDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"publishDataChannel"),ae.prototype),Lt(ae.prototype,"unpublish",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unpublish"),ae.prototype),Lt(ae.prototype,"unpublishDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unpublishDataChannel"),ae.prototype),Lt(ae.prototype,"unpublishLowStream",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unpublishLowStream"),ae.prototype),Lt(ae.prototype,"subscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"subscribeDataChannel"),ae.prototype),Lt(ae.prototype,"subscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"subscribe"),ae.prototype),Lt(ae.prototype,"massSubscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"massSubscribe"),ae.prototype),Lt(ae.prototype,"unsubscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unsubscribe"),ae.prototype),Lt(ae.prototype,"unsubscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unsubscribeDataChannel"),ae.prototype),Lt(ae.prototype,"massUnsubscribe",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"massUnsubscribe"),ae.prototype),Lt(ae.prototype,"muteRemote",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"muteRemote"),ae.prototype),Lt(ae.prototype,"unmuteRemote",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"unmuteRemote"),ae.prototype),Lt(ae.prototype,"hasRemoteMediaWithLock",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"hasRemoteMediaWithLock"),ae.prototype),Lt(ae.prototype,"disconnectForReconnect",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"disconnectForReconnect"),ae.prototype),Lt(ae.prototype,"updateBitrateLimit",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"updateBitrateLimit"),ae.prototype),Lt(ae.prototype,"remoteMediaSsrcChanged",[$i],Object.getOwnPropertyDescriptor(ae.prototype,"remoteMediaSsrcChanged"),ae.prototype),ae);function $i(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function AU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?AU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):AU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const c6=Date.now(),l6=20,kO=new Map,Py=new Map;async function IU(t){const e=kO.get(t),n=Array.isArray(e)&&e[e.length-1],i=Py.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const s=n.sendTs-i.firstSendTs,c=s-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-s);let l=n.mediaDelay+c;l<=0?(e.pop(),OU(n.context,r),l=0):l=Math.min(l,l6),setTimeout(()=>e.length&&IU(t),l)}function OU(t,e){t.safeEmit(oe.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function u6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return OU(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=kO.get(i)||[],s=r.findIndex(h=>t.sendTs>=h.sendTs),c=bU(bU({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});s===-1?r.push(c):r.splice(s,0,c),kO.set(i,r);let l=!1;var d;Py.has(i)?l=!((d=Py.get(i))===null||d===void 0||!d.isSyncing):Py.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||IU(i)}const d6=ge().name;function wU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function NU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const mm="websdk_ng_cache_parameter",h6=M("MAX_PRELOAD_ASYNC_LENGTH"),p6=1e4,Th=new Map,Rh=[];let MO=null,UO=0,xO=0;const ky=new Map,f6=function(t,e){const n=[];let i=0;const r=async()=>{const s=n.shift();s&&await s(),n.length>0&&i<e?r():i--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new Tt(async(d,h)=>{n.push(async()=>{try{const p=await t(...c);d(p)}catch(p){h(p)}}),i<e&&(i++,r())})}}(DU,h6),VO=_r.CancelToken.source();async function DU(t,e,n,i,r,s){try{if(!M("ENABLE_PRELOAD"))return;if(!Re().supportWebCrypto)return void _u(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new $(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ei(n,"token",1,2047),Ei(t,"appid",1,2047),uy(e),i&&dy(i);const c=ah();T.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let d,h;typeof i=="string"?(l.stringUid=i,[h,d]=await Tt.all([JH(i,{sid:c,appId:t},VO.token),$1(NU(NU({},l),{},{token:n||t,uid:0}),VO.token)]),l.uid=h.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),d=await $1(l,VO.token));const p={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:d};await async function(m){let _;try{m.uid&&PU({appId:m.appId,cname:m.cname,token:m.token,uid:m.uid,stringUid:m.stringUid});const g=xU(m),I=await async function(C,N){try{const D=await window.crypto.subtle.importKey("raw",yP(N),"AES-GCM",!1,["encrypt"]),V=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},D,rh(window.btoa(JSON.stringify(C))));return Eu(new Uint8Array(V))}catch{return}}(m,m.token||m.appId);if(!I)return;_=UU(mm);const y=_?JSON.parse(_):[];y.push({[g]:I}),y.length>M("AP_CACHE_NUM")&&y.shift(),My(mm,JSON.stringify(y))}catch(g){T.warn("Error caching server parameters:",g.message),My(mm,"")}}(p),UO++}catch(c){throw xO++,function(l){MO||(MO=window.setTimeout(()=>{let h="";ky.forEach((p,m)=>{h+="".concat(m,": ").concat(p," ;")}),Mt.reportApiInvoke(null,{name:Hn.PRELOAD,options:{success:UO,failed:xO,err:h}}).onError(l),UO=0,xO=0,ky.clear(),MO=null},p6));const d=ky.get(l.code)||0;ky.set(l.code,d+1)}(c),c}}async function LU(t){try{if(M("AP_REQUEST_DETAIL")||M("ENABLE_ROLE_SELECT_EDGE"))return;const e=PU(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const s=await window.crypto.subtle.importKey("raw",yP(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,rh(i));return JSON.parse(window.atob(Eu(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<M("AP_CACHE_LIFETIME"))return n}catch(e){T.warn("Error get preloadInfo",e.message)}}function PU(t){let e;try{if(e=UU(mm),!e)return;const n=JSON.parse(e),i=xU(t),r=function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1}(n,c=>i in c);if(r===-1)return;const s=n.splice(r,1)[0];return My(mm,JSON.stringify(n)),s[i]}catch(n){T.warn("Error delete preload info: ".concat(e),n.message),My(mm,"")}}function BO(t){if(t){let e=Th.get(t);e&&(window.clearTimeout(e),e=null,Th.delete(t)),_t(Rh).call(Rh,t)||t.cloudProxyServer!=="disabled"||Rh.push(t)}if(Th.size<M("AP_CACHE_NUM")&&Rh.length>0){const e=Rh.shift();Th.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:s,uid:c,proxyServer:l}=e;try{await f6(n,i,r,c,l,s),Th.has(e)&&BO(e)}catch(d){T.warn("update preload failed",d.message),kU(e)}},M("AP_UPDATE_INTERVAL")))}}function kU(t){const e=Rh.indexOf(t);e!==-1&&Rh.splice(e,1);let n=Th.get(t);n&&(window.clearTimeout(n),n=null,Th.delete(t),BO())}function MU(t,e){const n=t.sua,i=t.ap;e&&n&&Mt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),Mt.reportResourceTiming(t.ap.url,t.sid),Mt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[Bn.CHOOSE_SERVER,Bn.CLOUD_PROXY_FALLBACK].toString()}),Mt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Bn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function UU(t){return window.atob(window.localStorage.getItem(t)||"")}function My(t,e){window.localStorage.setItem(t,window.btoa(e))}function xU(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),NP(e)}function m6(t){let e=function(){const n=g6.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(Gn(i,10),Iu(i,r));let s=n.cid;s!==void 0&&(Gn(i,16),Gn(i,s));let c=n.cname;c!==void 0&&(Gn(i,26),Iu(i,c));let l=n.deviceId;l!==void 0&&(Gn(i,34),Iu(i,l));let d=n.elapse;d!==void 0&&(Gn(i,40),Ou(i,d));let h=n.fileSize;h!==void 0&&(Gn(i,48),Ou(i,_m(h)));let p=n.height;p!==void 0&&(Gn(i,56),Ou(i,_m(p)));let m=n.jpg;m!==void 0&&(Gn(i,66),Gn(i,m.length),BU(i,m));let _=n.networkType;_!==void 0&&(Gn(i,72),Ou(i,_m(_)));let g=n.osType;g!==void 0&&(Gn(i,80),Ou(i,_m(g)));let I=n.requestId;I!==void 0&&(Gn(i,90),Iu(i,I));let y=n.sdkVersion;y!==void 0&&(Gn(i,98),Iu(i,y));let C=n.sequence;C!==void 0&&(Gn(i,104),Ou(i,_m(C)));let N=n.sid;N!==void 0&&(Gn(i,114),Iu(i,N));let D=n.timestamp;D!==void 0&&(Gn(i,120),Ou(i,D));let V=n.uid;V!==void 0&&(Gn(i,128),Gn(i,V));let W=n.vid;W!==void 0&&(Gn(i,136),Gn(i,W));let K=n.width;K!==void 0&&(Gn(i,144),Ou(i,_m(K)));let j=n.service;j!==void 0&&(Gn(i,152),Gn(i,j));let Q=n.callbackData;Q!==void 0&&(Gn(i,162),Gn(i,Q.length),BU(i,Q));let ct=n.ticket;ct!==void 0&&(Gn(i,170),Iu(i,ct));let vt=n.vendorConfigs;vt!==void 0&&(Gn(i,178),Iu(i,vt))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function _6(t){return function(n){let i={};t:for(;!S6(n);){let r=Pg(n);switch(r>>>3){case 0:break t;case 1:i.code=Pg(n);break;case 2:i.msg=FU(n,Pg(n));break;case 3:i.requestId=FU(n,Pg(n));break;case 4:i.timestamp=T6(n,!1);break;default:E6(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function E6(t,e){switch(e){case 0:for(;128&Ss(t););break;case 2:FO(t,Pg(t));break;case 5:FO(t,4);break;case 1:FO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function _m(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let g6=[];function FO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function S6(t){return t.offset>=t.limit}function Uy(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function VU(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function BU(t,e){let n=Uy(t,e.length);t.bytes.set(e,n)}function FU(t,e){let n=VU(t,e),i=String.fromCharCode,r=t.bytes,s="�",c="";for(let l=0;l<e;l++){let d,h,p,m,_=r[l+n];(128&_)==0?c+=i(_):(224&_)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(m=(31&_)<<6|63&d,m<128?c+=s:(c+=i(m),l++))):(240&_)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(m=(15&_)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=s:(c+=i(m),l+=2))):(248&_)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(m=(7&_)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=s:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=s}return c}function Iu(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}Gn(t,i);let r=Uy(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function Ss(t){return t.bytes[VU(t,1)]}function jU(t,e){let n=Uy(t,1);t.bytes[n]=e}function Pg(t){let e,n=0,i=0;do e=Ss(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function Gn(t,e){for(e>>>=0;e>=128;)jU(t,127&e|128),e>>>=7;jU(t,e)}function T6(t,e){let n,i=0,r=0,s=0;return n=Ss(t),i=127&n,128&n&&(n=Ss(t),i|=(127&n)<<7,128&n&&(n=Ss(t),i|=(127&n)<<14,128&n&&(n=Ss(t),i|=(127&n)<<21,128&n&&(n=Ss(t),r=127&n,128&n&&(n=Ss(t),r|=(127&n)<<7,128&n&&(n=Ss(t),r|=(127&n)<<14,128&n&&(n=Ss(t),r|=(127&n)<<21,128&n&&(n=Ss(t),s=127&n,128&n&&(n=Ss(t),s|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|s<<24,unsigned:e}}function Ou(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=Uy(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}const GU={},HU={},xy=4294967296,R6=xy*xy,v6=R6/2;KU(0,!0);const WU=KU(0),y6=kg(0,-2147483648,!1),C6=kg(-1,2147483647,!1);function KU(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=HU[t],i)?i:(n=kg(t,0,!0),r&&(HU[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=GU[t],i)?i:(n=kg(t,t<0?-1:0,!1),r&&(GU[t]=n),n)}function kg(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function YU(t,e){if(isNaN(t))return WU;{if(t<=-9223372036854776e3)return y6;if(t+1>=v6)return C6}return t<0?WU:kg(t%xy|0,t/xy|0,e)}function zU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class jO extends hn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(ro.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),O(this,"name","AgoraRTCImageModeration"),O(this,"_connectionState",Ba.CONNECTING),O(this,"_sequence",0),O(this,"_moderationStartTime",void 0),O(this,"_workerConnection",void 0),O(this,"_workerMessageLengthLimit",void 0),O(this,"_qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",_r.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"_moderationInterval",void 0),O(this,"_moderationTimer",null),O(this,"_moderationMode",1),O(this,"_quality",1),O(this,"_qualityTimer",null),O(this,"_ticket",void 0),O(this,"_moderationIntervalMinimum",void 0),O(this,"_uploadFailedNum",0),O(this,"_uploadNum",0),O(this,"_uploadTimer",null),O(this,"_extraInfo",void 0),O(this,"_vendor",""),O(this,"_encoder",new TextEncoder),O(this,"_moderationId",void 0),O(this,"inspectImage",()=>{if(this.connectionState!==Ba.CONNECTED)throw new z(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ba.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ye(5,"image-moderation-"),this._workerMessageLengthLimit=M("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=M("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=M("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new yg("worker-"+this._moderationId,Wn),this.on(ro.STATE_CHANGE,(i,r)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(am[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(ro.STATE_CHANGE,am.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Tt((r,s)=>{this.on(ro.CONNECTION_STATE_CHANGE,(c,l)=>{c===Ba.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Ba.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=M("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await function(d,h,p,m){let{appId:_,areaCode:g,cname:I,sid:y,token:C,uid:N}=h;dm++;const D="moderation_plugin",V={service_name:D,json_body:JSON.stringify({appId:_,areaCode:g,cname:I,command:"allocateEdge",requestId:dm,seq:dm,sid:y,appToken:C,ts:Date.now(),uid:N+""})};let W,K,j=d[0];return to(async()=>{W=Date.now();const Q=await ao(j,{data:V,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-W,Q.code!==0){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Q.code,{retry:!0,responseTime:K});throw T.error(At.toString()),At}const ct=JSON.parse(Q.json_body);if(ct.code!==200){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ct.code,", reason: ").concat(ct.reason),{code:ct.code,responseTime:K});throw T.error(At.toString()),At}if(!ct.servers||!Array.isArray(ct.servers)||ct.servers.length===0){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ct.code,responseTime:K});throw T.error(At.toString()),At}if(!ct.servers.some(At=>!!At.wss)){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ct.code,responseTime:K});throw T.error(At.toString()),At}const vt=M("IMAGE_MODERATION_WORKER_HOST");return{addressList:ct.servers.map(At=>{let{address:ue,wss:de}=At;if(ue&&de)return"wss://".concat(ue.replace(/\./g,"-"),".").concat(vt,":").concat(de,"/moderation")}).filter(At=>!!At),workerToken:ct.workerToken,vid:ct.vid,ticket:ct.appTicket,responseTime:K}},(Q,ct)=>(Mt.apworkerEvent(y,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(Q.addressList),firstSuccess:ct===0,responseTime:K,serverIp:d[ct%d.length]}),!1),(Q,ct)=>(Mt.apworkerEvent(y,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:D,responseTime:K,serverIp:d[ct%d.length]}),!!(Q.code!==L.OPERATION_ABORTED&&Q.code!==L.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(j=d[(ct+1)%d.length],!0)),m)}(r,e,n,i);this.emit(ro.STATE_CHANGE,am.AP_CONNECTED);const{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(e){this.emit(ro.STATE_CHANGE,am.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on($t.CONNECTED,async()=>{this.emit(ro.STATE_CHANGE,am.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ba.CONNECTED}),this._workerConnection.on($t.CLOSED,()=>{this.connectionState=Ba.CLOSED}),this._workerConnection.on($t.FAILED,()=>{this.connectionState=Ba.CLOSED}),this._workerConnection.on($t.RECONNECTING,()=>{this.connectionState=this.connectionState===Ba.CONNECTED?Ba.RECONNECTING:Ba.CONNECTING}),this._workerConnection.on($t.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=_6(new Uint8Array(e.data));M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Mt.reportApiInvoke(this._connectInfo.sid||null,{name:Hn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:En.TRACER}).onError(new z(L.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},M("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on($t.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on($t.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=ca(this,ro.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await Sk(p,i,r),_=this._sequence+"-"+s+"-"+d+"-"+h+"-"+Ye(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:jO.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:_,sdkVersion:"4.23.2",sequence:this._sequence,sid:l,timestamp:YU(h),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete g.callbackData;const I=m6(g);if(I.byteLength<this._workerMessageLengthLimit){if(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const y=function(C){for(var N=1;N<arguments.length;N++){var D=arguments[N]!=null?arguments[N]:{};N%2?zU(Object(D),!0).forEach(function(V){O(C,V,D[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(D)):zU(Object(D)).forEach(function(V){Object.defineProperty(C,V,Object.getOwnPropertyDescriptor(D,V))})}return C}({},g);delete y.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(y))}return I}{const y=this.quality*this._qualityRatio;return this.quality=y,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=_r.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ba.CLOSED,this.emit(ro.STATE_CHANGE,am.CLOSED)}}function qU(t){if(Ve(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new z(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new z(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const A6={name:"ImageModeration",create:function(t){let{config:e}=t;return qU(e),new jO(e)}};var XU,JU,QU,ZU,$U,t2,e2,n2,i2,r2,a2,s2,o2,c2,l2,u2,d2,h2,p2,f2,m2,_2,E2,g2,S2,T2,R2,v2,y2,C2,A2,b2,I2,O2,w2,N2,D2,L2,P2,k2,M2,Ct;function U2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ts(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?U2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}Ui.setLogger(T);let b6=(XU=Gt(),JU=Gt({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Qf))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),QU=Gt({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Jf.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),ZU=Gt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),$U=Gt({argsMap:(t,e,n)=>[e,n]}),t2=Gt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),e2=Gt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),n2=Gt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),i2=Gt(),r2=Gt(),a2=Gt(),s2=Gt(),o2=Gt(),c2=Gt(),l2=Gt(),u2=Gt(),d2=Gt(),h2=Gt(),p2=Gt(),f2=Gt(),m2=Gt(),_2=Gt(),E2=Gt(),g2=Gt({argsMap:(t,e)=>[e]}),S2=Gt(),T2=Gt(),R2=Gt(),v2=Gt(),y2=Gt(),C2=Gt(),A2=Gt(),b2=Gt(),I2=Gt({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),O2=Gt(),w2=Gt(),N2=Gt(),D2=Gt(),L2=Gt(),P2=Gt(),k2=Gt({reportResult:!0}),M2=Gt(),Ct=class extends hn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),O(this,"store",void 0),O(this,"_uid",void 0),O(this,"_channelName",void 0),O(this,"_uintUid",void 0),O(this,"_users",[]),O(this,"_config",void 0),O(this,"_clientId",void 0),O(this,"_appId",void 0),O(this,"_sessionId",null),O(this,"_key",void 0),O(this,"_rtmConfig",{}),O(this,"_joinInfo",void 0),O(this,"_gateway",void 0),O(this,"_statsCollector",void 0),O(this,"_configDistribute",void 0),O(this,"_leaveMutex",void 0),O(this,"_publishMutex",void 0),O(this,"_renewTokenMutex",void 0),O(this,"_subscribeMutex",void 0),O(this,"_encryptionMode","none"),O(this,"_encryptionSecret",null),O(this,"_encryptionSalt",null),O(this,"_encryptDataStream",!1),O(this,"_encryptDataStreamKey",null),O(this,"_encryptDataStreamIv",null),O(this,"_proxyServer",void 0),O(this,"_turnServer",{servers:[],mode:"auto"}),O(this,"_cloudProxyServerMode","disabled"),O(this,"_isDualStreamEnabled",!1),O(this,"_defaultStreamFallbackType",void 0),O(this,"_lowStreamParameter",void 0),O(this,"_streamFallbackTypeCacheMap",new Map),O(this,"_remoteStreamTypeCacheMap",new Map),O(this,"_axiosCancelSource",_r.CancelToken.source()),O(this,"_audioVolumeIndicationInterval",void 0),O(this,"_networkQualityInterval",void 0),O(this,"_userOfflineTimeout",void 0),O(this,"_streamRemovedTimeout",void 0),O(this,"_liveTranscodeStreamingClient",void 0),O(this,"_liveRawStreamingClient",void 0),O(this,"_channelMediaRelayClient",void 0),O(this,"_networkQualitySensitivity","normal"),O(this,"_p2pChannel",void 0),O(this,"_useLocalAccessPoint",!1),O(this,"_setLocalAPVersion",void 0),O(this,"_joinAndNotLeaveYet",!1),O(this,"_numberOfJoinCount",0),O(this,"_remoteDefaultVideoStreamType",void 0),O(this,"_inspect",void 0),O(this,"_moderation",void 0),O(this,"_license",void 0),O(this,"_pendingPublishedUsers",[]),O(this,"ntpAlignErrorCount",0),O(this,"remoteInboundOffset",0),O(this,"_peerConnectionState",void 0),O(this,"_handleLocalTrackEnable",(r,s,c)=>{this.publish(r,!1).then(s).catch(c)}),O(this,"_handleLocalTrackDisable",(r,s,c)=>{this.unpublish(r).then(s).catch(c)}),O(this,"_handleUserOnline",r=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return void T.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(c=>c.uid===r.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(oe.USER_JOINED,s));else{const c=new Au(r.uid,r.uint_id||r.uid);this._users.push(c),T.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(oe.USER_JOINED,c)}}),O(this,"_handleUserOffline",r=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return;const s=this._users.find(c=>c.uid===r.uid);s&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:Bv(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),T.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(oe.USER_LEAVED,s,r.reason))}),O(this,"_handleAddAudioOrVideoStream",(r,s,c,l,d,h,p)=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(s,this.channelName))return;const m=this._users.find(g=>g.uid===s);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(m.uid,r,void 0,void 0,void 0,Date.now());const _=r==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=d||s),r==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,r==="audio"?(m._audio_added_=!0,c!==void 0&&(m._audioSSRC=c),l!==void 0&&(m._cname=l),h&&(m._audioOrtc=h)):(m._video_added_=!0,c!==void 0&&(m._videoSSRC=c),l!==void 0&&(m._cname=l),p!==void 0&&(m._rtxSsrcId=p),h&&(m._videoOrtc=h)),(r==="audio"?m.hasAudio:m.hasVideo)&&!_&&(T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(r)),this.safeEmit(oe.USER_PUBLISHED,m,r)),r==="video"?Mt.onGatewayStream(this._sessionId,ii.ON_ADD_VIDEO_STREAM,cn.ON_ADD_VIDEO_STREAM,{peer:d||s,ssrc:m._videoSSRC}):Mt.onGatewayStream(this._sessionId,ii.ON_ADD_AUDIO_STREAM,cn.ON_ADD_AUDIO_STREAM,{peer:d||s,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,r,c).then(g=>{if(g&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Lg))return this._p2pChannel.unsubscribe(m,r,!0).then(()=>this._subscribe(m,r,!0).catch(I=>{T.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,r,!0).catch(g=>{T.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),O(this,"_handleRemoveStream",r=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return;const s=this._users.find(l=>l.uid===r.uid);if(!s)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};s.hasAudio&&s.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(oe.USER_UNPUBLISHED,s,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(oe.USER_UNPUBLISHED,s,"video")}:s.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(oe.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(oe.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Lg&&this._p2pChannel.unsubscribe(s).then(l=>{if(l)return this._gateway.unsubscribe(l,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Mt.onGatewayStream(this._sessionId,ii.ON_REMOVE_STREAM,cn.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),O(this,"_handleSetStreamLocalEnable",(r,s,c)=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(s,this.channelName))return;const l=this._users.find(p=>p.uid===s);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(s));const d=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{const m=l._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(oe.USER_INFO_UPDATED,s,m)}}else{l._trust_video_enabled_state_=!0;const p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{const m=l._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(oe.USER_INFO_UPDATED,s,m)}}const h=r==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(T.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(r)),void this.safeEmit(oe.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),T.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(r)),void this.safeEmit(oe.USER_UNPUBLISHED,l,r)):void 0}),O(this,"_handleMuteStream",(r,s,c)=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),r,s,c);const l=this._users.find(p=>p.uid===r);if(!l)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const d=s==="audio"?l.hasAudio:l.hasVideo;if(s==="audio"){l._trust_audio_mute_state_=!0;const p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{const m=l._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(oe.USER_INFO_UPDATED,r,m)}}else{l._trust_video_mute_state_=!0;const p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{const m=l._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(oe.USER_INFO_UPDATED,r,m)}}const h=s==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(s==="audio"?l._audioSSRC:l._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(s)),void this.safeEmit(oe.USER_PUBLISHED,l,s)):void T.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),s==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,s),T.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(s)),this.safeEmit(oe.USER_UNPUBLISHED,l,s)}}),O(this,"_handleP2PLost",async r=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),O(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(oe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),O(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),O(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(oe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(oe.NETWORK_QUALITY,r)}),O(this,"_handleP2PAddAudioOrVideoStream",(r,s,c,l)=>{const d=this._users.find(p=>p.uid===s);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());const h=r==="audio"?d.hasAudio:d.hasVideo;r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(r==="audio"?d.hasAudio:d.hasVideo)&&!h&&(T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(oe.USER_PUBLISHED,d,r)),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(p=>{T.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=t,this._clientId=e||Ye(5,"client-"),this.store=new class{constructor(r,s,c,l){Xt(this,"state",void 0),this.state={codec:r,audioCodec:s,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:sh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(r){this.state=function(s,c){switch(c.type){case ce.SET_SESSION_ID:return bt(bt({},s),{},{sessionId:c.sessionId});case ce.SET_P2P_ID:return bt(bt({},s),{},{p2pId:c.p2pId});case ce.SET_UID:return bt(bt({},s),{},{uid:c.uid});case ce.SET_INT_UID:return bt(bt({},s),{},{intUid:c.intUid});case ce.SET_PUB_ID:return bt(bt({},s),{},{pubId:c.pubId});case ce.KEY_METRIC_CLIENT_CREATED:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{clientCreated:c.metric})});case ce.KEY_METRIC_JOIN_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinStart:c.metric})});case ce.AVOID_JOIN_START:return bt(bt({},s),{},{avoidJoinStart:c.avoidJoinStart});case ce.KEY_METRIC_JOIN_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinEnd:c.metric})});case ce.KEY_METRIC_REQUEST_AP_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{requestAPStart:c.metric})});case ce.KEY_METRIC_REQUEST_AP_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{requestAPEnd:c.metric})});case ce.KEY_METRIC_JOIN_GATEWAY_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinGatewayStart:c.metric})});case ce.KEY_METRIC_JOIN_GATEWAY_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinGatewayEnd:c.metric})});case ce.KEY_METRIC_PEER_CONNECTION_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{peerConnectionStart:c.metric})});case ce.KEY_METRIC_PEER_CONNECTION_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{peerConnectionEnd:c.metric})});case ce.KEY_METRIC_DESCRIPTION_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{descriptionStart:c.metric})});case ce.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{signalChannelOpen:c.metric})});case ce.KEY_METRIC_ICE_CONNECTION_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{iceConnectionEnd:c.metric})});case ce.KEY_METRIC_PUBLISH:{const l=s.keyMetrics.publish,d=l.findIndex(h=>h.trackId===c.metric.trackId);return d!==-1?(l[d]=bt(bt({},l[d]),c.metric),bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{publish:[...l]})})):bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,c.metric]})})}case ce.KEY_METRIC_SUBSCRIBE:{const l=s.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return d!==-1?(l[d]=bt(bt({},l[d]),c.metric),bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{subscribe:[...l]})})):bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,c.metric]})})}case ce.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=c.mode,s;case ce.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,c.record]:(s.joinChannelServiceRecords[c.index]=bt(bt({},s.joinChannelServiceRecords[c.index]),c.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case ce.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case ce.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[]},s;case ce.SET_USE_P2P:return bt(bt({},s),{},{useP2P:c.val});case ce.SET_TRANSPORT_TYPE:return bt(bt({},s),{},{p2pTransport:c.val});default:return s}}(this.state,r)}set sessionId(r){this.dispatch({type:ce.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:ce.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:ce.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:ce.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:ce.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:ce.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:ce.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:ce.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:ce.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:ce.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ce.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ce.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ce.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ce.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ce.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ce.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ce.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ce.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ce.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ce.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ce.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,s,c,l){this.dispatch({type:ce.KEY_METRIC_PUBLISH,metric:bt(bt({trackId:r,type:s},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,s,c,l,d,h,p){this.dispatch({type:ce.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt(bt(bt({userId:r,type:s},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,s,c,l){r.forEach(d=>{this.dispatch({type:ce.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt({userId:d.userId,type:d.type},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,s){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:ce.RECORD_JOIN_CHANNEL_SERVICE,record:bt(bt({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ce.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ce.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ce.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:ce.AVOID_JOIN_START,avoidJoinStart:r})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Ui("client-leave",this._clientId),this._publishMutex=new Ui("client-publish",this._clientId),this._renewTokenMutex=new Ui("client-renewtoken",this._clientId),this._subscribeMutex=new Ui("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ua," build: ").concat(PI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{TI(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){T.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new Ng(this.store),this._statsCollector.onStatsException=(r,s,c)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(s,", uid: ").concat(c)),this.safeEmit(oe.EXCEPTION,{code:r,msg:s,uid:c})},this._statsCollector.onUploadPublishDuration=(r,s,c,l)=>{const d=this._users.find(h=>h.uid===r);d&&Mt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:s,videoPublishDuration:c,peer:d._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new WH(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Wn,httpRetryConfig:t.httpRetryConfig||Wn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new t6(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},rl("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Lg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Pe("JOIN_GATEWAY_USE_443PORT_ONLY",s),Pe("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof hO&&(l.use443PortOnly=s,l.tryDoubleDomain=c),async function(d,h,p){kv.get(d)||kv.set(d,[]),Mv.get(d)||Mv.set(d,h),Jo.get(d)||Jo.set(d,0);const m=kv.get(d),_=Mv.get(d);if(!m||!_)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Jo.get(d)===_){const N=og();m.push(N),await N.promise}Jo.set(d,Jo.get(d)+1);for(var g=arguments.length,I=new Array(g>3?g-3:0),y=3;y<g;y++)I[y-3]=arguments[y];const C=await p(...I);return Jo.set(d,Jo.get(d)-1),Jo.get(d)===_-1&&m.length>0&&(m[0].resolve(),m.shift()),Jo.get(d)===0&&(kv.set(d,[]),Mv.set(d,0),Jo.set(d,0)),C}("client.join",M("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const s=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(Gv||Gv||(Gv=(window.location.protocol.split(":")[0]||"").toUpperCase(),Gv))==="HTTPS",l=PP()?window.isSecureContext:"Browser Not Support";(!PP()&&!c||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Mt.setAppId(t);try{if(!n&&n!==null)throw new z(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ei(n,"token",1,2047),Ei(t,"appid",1,2047),uy(e),i&&dy(i),r&&Ei(r,"optionalInfo",1,2047)}catch(y){throw Mt.reportApiInvoke(ah(),{name:Hn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:En.TRACER}).onError(y),y}if(this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const y=new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Mt.reportApiInvoke(ah(),{name:Hn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:En.TRACER}).onError(y),y}this._gateway.state="CONNECTING";const d=await LU({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const h=(d==null?void 0:d.sid)||ah();T.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);const p=Mt.reportApiInvoke(h,{id:this._clientId,name:Hn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:En.TRACER}),m=Ts(Ts(Ts({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:M("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(m.stringUid=i,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async y=>{const C=function(W){const K=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),j=new Uint8Array(new ArrayBuffer(K.length));for(let Q=0;Q<K.length;Q+=1)j[Q]=K.charCodeAt(Q);return j}(),N=await window.crypto.subtle.importKey("spki",C,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),D=gI(y),V=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},N,D);return function(W){let K="";for(let j=0;j<W.length;j+=1)K+=String.fromCharCode(W[j]);return window.btoa(K)}(new Uint8Array(V))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const y=new TextEncoder,C=M("USE_PURE_ENCRYPTION_MASTER_KEY")?y.encode(m.appId+this._encryptionSecret+this._encryptionSecret):y.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(N,D,V){const W=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),K=N==="aes-128-gcm2"?128:256,j=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:HP,hash:"SHA-256",salt:V},W,K+T5);return new Uint8Array(j).subarray(K/8)}(this._encryptionMode,C,rh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(N,D,V){const W=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),K=N==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:HP,hash:"SHA-256",salt:V},W,{name:"AES-GCM",length:K},!0,["encrypt","decrypt"])}(this._encryptionMode,C,rh(this._encryptionSalt))}else l?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:m.stringUid});const _=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&_===this._sessionId&&Mt.joinChannelTimeout(this._sessionId,5)},5e3);try{var g;let y;const C=m.cloudProxyServer;if(_t(g=["proxy3","proxy4","proxy5"]).call(g,C)){const K=M("PROXY_SERVER_TYPE3");Array.isArray(K)?m.proxyServer=K[0]:m.proxyServer=K}if(Mt.setProxyServer(m.proxyServer),T.setProxyServer(m.proxyServer),this.store.requestAPStart(),d){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(d.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=d.intUid),y={gatewayInfo:d.ap.gatewayInfo},M("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(d.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const K=(await C1(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Ni.tcpport,udpport:j.udpport||Ni.udpport,username:j.username||Ni.username,password:j.password||Ni.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:K}}MU(d,m.stringUid)}else{if(m.stringUid&&!m.uid){let K;[K,y]=await Tt.all([Z1(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||Wn,this.store),Q1(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Wn,!0,this.store)]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(K)),m.uid=K,y.gatewayInfo.uid=K,y.gatewayInfo.res.uid=K}else y=await Q1(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Wn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(Rg.UPDATE_BITRATE_LIMIT,K=>{this._p2pChannel.updateBitrateLimit(K)}),this._configDistribute.on(Rg.UPDATE_CLIENT_ROLE_OPTIONS,K=>{this._setClientRoleOptions(K)})},0),this._key=n||t;const N=y.gatewayInfo,D=m.uid?m.uid:N.uid;this._joinInfo=Ts(Ts({},m),{},{cid:N.cid,uid:D,vid:N.vid,apResponse:N.res,apGatewayAddress:N.apGatewayAddress,uni_lbs_ip:N.uni_lbs_ip,gatewayAddrs:N.gatewayAddrs}),this.store.intUid=D,this.store.cid=N.cid;const V=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(V),this._appId=t,this._channelName=m.cname,this._uid=V,this.store.uid=V,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ii()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const W=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(W)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),I=this,_t(hh).call(hh,I)||hh.push(I),this._cloudProxyServerMode==="disabled"&&Re().supportWebCrypto&&M("ENABLE_PRELOAD")&&BO(this._joinInfo),V}catch(y){const C=Array.isArray(y)?y[0]:y;throw C&&C.code===L.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),C):T.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),C),C.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(C),C}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new z(L.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!M("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ii()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=hh.indexOf(e);n!==-1&&hh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Ie.LEAVE),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Qf))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new z(L.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new z(L.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof Qf))throw new z(L.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new z(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const s=this._configDistribute.getBitrateLimit();r instanceof nn&&s&&r.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw T.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){Ve(t.id,"id",0,65535,!0),Qc(t.ordered,"ordered"),Ei(t.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new z(L.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new z(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return G1(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new z(L.CREATE_DATACHANNEL_ERROR);try{await Tt.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==L.DISCONNECT_P2P)throw r}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Qf))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(Ln.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw T.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Au)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new z(L.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(Zn(e,"mediaType",["audio","video"]),this.store.useP2P)throw new z(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===It.AUDIO,i=e===It.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:c,rtxSsrcId:l,cname:d,uint_id:h}=await this._gateway.presubscribe(t,e,!0);if(s==null)throw new z(L.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(_=>_.uid===t);p||(p=new Au(t,h||t),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=h||t),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),i&&(p._videoSSRC=s,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,e,s,l,c);const m=n?p._audioTrack:p._videoTrack;if(!m)throw new z(L.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),i&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),m}catch(s){throw T.error("[".concat(this._clientId,"] presub user ").concat(t," error"),s),s}finally{r()}}async _subscribeDataChannel(t,e){var n;if(Ve(e,"channelId",0,65535,!0),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new z(L.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new z(L.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new z(L.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&_t(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new z(L.CREATE_DATACHANNEL_ERROR);const d={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,d,!0),await r._waitTillOpen()}catch(d){if((d==null?void 0:d.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),d;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{s()}}async _p2pSubscribe(t,e,n){if(Zn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===t)){const s=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),s}if(!t.hasAudio&&!t.hasVideo){const s=new z(L.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),s}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const s=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),s}const r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const s=e==="audio"?t._audioTrack:t._videoTrack;if(!s)throw new z(L.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),s),s}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(Zn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===t)){const h=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),h}if(!t.hasAudio&&!t.hasVideo){const h=new z(L.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),h}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const h=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),h}let r=e==="audio"?t._audioSSRC:t._videoSSRC,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?It.AUDIO:It.VIDEO,ssrcId:r};const d=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const p=e==="audio"?t._audioSSRC:t._videoSSRC;p!==void 0&&p!==r&&(r=p,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?It.AUDIO:It.VIDEO,ssrcId:r}),Bi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,s);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(m){if((m==null?void 0:m.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),m;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,t,e),p}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=e==="audio"?t._audioTrack:t._videoTrack;if(!h)throw new z(L.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),h),h}finally{d()}}async massSubscribe(t){if(Zc(t,"subscribeList"),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:d,mediaType:h}=l;return{user:d,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h;if(Zn(m,"mediaType",["audio","video"]),!p){const y=new z(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),y}if(!this._users.find(y=>y===p)){const y=new z(L.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),r[d].error=y,t.splice(d,1);continue}if(m==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||m==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const y=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(m,", remote user is not published")),r[d].error=y,t.splice(d,1);continue}const g=ri.Video|ri.LwoVideo,I=n.get(p);if(I){if(m==="video"?I&g:I&ri.Audio){t.splice(d,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(m," twice"));continue}n.set(p,I|(m==="video"?g:ri.Audio))}else n.set(p,m==="video"?g:ri.Audio)}for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h,_=ri.Video|ri.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,m)){await this._p2pChannel.unmuteRemoteNoLock(p,m);const g=n.get(p);n.set(p,m==="video"?g^_:g^ri.Audio),t.splice(d,1)}}this.store.massSubscribe(t.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let l=nr(c=Array.from(n.entries())).call(c,(d,h)=>{let[p,m]=h;if(m===0)return d;const _={stream_id:p.uid,stream_type:m};return m&ri.Audio&&(_.audio_ssrc=p._audioSSRC),m&ri.Video&&(_.video_ssrc=p._videoSSRC),d.push(_),d},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:p,mediaType:m}=h;return{user:p,mediaType:m,ssrcId:m===It.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:m===It.VIDEO?p._rtxSsrcId:void 0}}));const d=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:m,video_error_code:_,audio_error_code:g,error_code:I}=p;(_||g||I)&&d.set(m,{video_error_code:_,audio_error_code:g,error_code:I})})}if(Array.from(d.entries()).length>0){const h=[];Array.from(d.entries()).forEach(p=>{let[m,_]=p;const g=this.remoteUsers.find(I=>I.uid===m);if(g){let I;_.error_code||_.video_error_code&&_.audio_error_code?I=void 0:_.video_error_code?I=It.VIDEO:_.audio_error_code&&(I=It.AUDIO),h.push({user:g,mediaType:I})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const p=d.get(h.user.uid);if(p){const m=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(m){const _=vg(m);T.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(_.desc)),h.error=new z(L.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(_.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var p;Mt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===It.VIDEO,audio:h.mediaType===It.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===It.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:p,mediaType:m}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; "))),r}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(t),d}}finally{s(),i()}}async unsubscribe(t,e,n){if(!(t instanceof Au)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new z(L.INVALID_REMOTE_USER,"user is not in the channel");t=s}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Zn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const s=await this._p2pChannel.unsubscribe(t,e);s&&await this._gateway.unsubscribe(s,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&Bv(this._users,t),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(s){if(s.code===L.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&Ve(e,"id",0,65535,!0),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(s=>s.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===L.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(Zc(t,"unsubscribeList"),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new z(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(Zn(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=ri.Video|ri.LwoVideo;if(e.has(i)){const l=e.get(i);let d;switch(r){case"video":d=l&c;break;case"audio":d=l&ri.Audio;break;default:d=l&(ri.Audio|c)}if(d){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|ri.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|ri.Audio|c)}else r?r==="audio"?e.set(i,ri.Audio):r==="video"&&e.set(i,c):e.set(i,ri.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:s}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===L.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new $(L.INVALID_PARAMS);_n(n.width)||_I(n.width,"streamParameter.width"),_n(n.height)||_I(n.height,"streamParameter.height"),_n(n.framerate)||_I(n.framerate,"streamParameter.framerate"),_n(n.bitrate)||Ve(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,st.LocalVideoLowTrack)}async enableDualStream(){if(!Re().supportDualStream)throw Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new z(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new z(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(st.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Zn(i,"role",["audience","host"])}(t),e&&TI(e),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new z(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new z(L.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new z(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&M("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",Oi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),T.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&TI(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{T.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Ei(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new z(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Mt.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new z(L.INVALID_OPERATION,"You have already set the proxy")}if(hg(t))return this._turnServer={servers:t,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>RP(n)),this._turnServer={servers:t,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"you should set license before join channel");if(Ei(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new z(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,T.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new z(L.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new z(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new z(L.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Stop proxy server after leave channel");Mt.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new z(L.INVALID_PARAMS,"accessPoints is required.");Zc(t.accessPoints.serverList,"accessPoints.serverList"),Ei(t.accessPoints.domain,"accessPoints.domain");const e=(_,g)=>{Ve(_,g,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new z(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");M("CLOSE_AFB_FOR_LOCAL_AP")&&(Pe("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Pe("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,s=t.accessPoints.serverList.map(_=>i.test(_)?"".concat(_.replace(/\./g,"-"),".").concat(r):_),c=s.map(_=>"".concat(_,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Pe("WEBCS_DOMAIN",c),Pe("WEBCS_DOMAIN_BACKUP_LIST",c),Pe("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Zc(t.report.hostname,"report.hostname"),Pe("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Pe("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Pe("EVENT_REPORT_DOMAIN",s[0]),Pe("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),Pe("STATS_COLLECTOR_PORT",l),t.report?Pe("ENABLE_EVENT_REPORT",!0):Pe("ENABLE_EVENT_REPORT",!1);let d="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Zc(t.log.hostname,"log.hostname"),d=t.log.hostname[0]):d=s[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),Pe("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let p=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Zc(t.cds.hostname,"cds.hostname"),p=t.cds.hostname):p=s;let m=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),m=t.cds.port),Pe("CDS_AP",p.map(_=>"".concat(_,":").concat(m))),t.cds?Pe("ENABLE_CONFIG_DISTRIBUTE",!0):Pe("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Zc(t,"serverList"),Ei(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new z(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Pe("WEBCS_DOMAIN",t),Pe("WEBCS_DOMAIN_BACKUP_LIST",t),Pe("GATEWAY_DOMAINS",[e]),Pe("EVENT_REPORT_DOMAIN",t[0]),Pe("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Pe("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Zn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Zn(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Zn(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(s){Zn(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ei(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(_t(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new z(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new z(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Qc(i,"encryptDataStream"),!_t(r).call(r,t))throw new z(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Eu(n))}async renewToken(t){if(Ei(t,"token",1,2047),!this._key||!this._joinInfo)throw new z(L.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(M("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await $H(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Wn);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,T.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(oe.VOLUME_INDICATOR,t)},M("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new z(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new z(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new z(L.LIVE_STREAMING_TASK_CONFLICT);const n=e?el.TRANSCODE:el.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(el.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new z(L.INVALID_PARAMS,"can not find live streaming url to stop");await Tt.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){aU(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){aU(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Lg&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&_t(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,s,c){var l;const d=nr(l=Array.from(c)).call(l,(y,C)=>y+C,0),h={serverTs:0,seq:R5++,length:c.length,checkSum:d},p=new Uint8Array(wP(d,2)),m=new ArrayBuffer(Wf),_=new DataView(m);_.setUint32(0,h.serverTs),_.setUint16(4,h.seq),_.setUint16(6,h.length),_.setUint16(8,h.checkSum);const g=16-c.length%16;c=CP(c,new Uint8Array(g));const I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:GP,additionalData:p},s,c);return CP(new Uint8Array(m),new Uint8Array(I))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new z(L.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Wt.DATA_STREAM,{payload:Eu(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-c6},!n)}sendMetadata(t){if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new z(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Wt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Eu(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(N5),!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not send custom report, not joined");await Mt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Zn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Zn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Qc(e,"apRTM"),Ve(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),function(t){const e=im.indexOf(t);e!==-1&&im.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=_r.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&kU(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Mt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ui("client-publish",this._clientId),this._subscribeMutex=new Ui("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||ah();t?T.debug("[".concat(this._clientId,"] new Session ").concat(i)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Mt.addSid(i);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};Mt.sessionInit(this._sessionId,Ts({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new z(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Ln.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof nn&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(s=>{T.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw n.throw(s),s}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new z(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},rl("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,s)=>{Mt.reportApiInvoke(this._sessionId,{name:Hn.ON_LIVE_STREAM_ERROR,options:[r,s],tag:En.TRACER}).onSuccess(),this.safeEmit(oe.LIVE_STREAMING_ERROR,r,s)},n.onLiveStreamWarning=(r,s)=>{Mt.reportApiInvoke(this._sessionId,{name:Hn.ON_LIVE_STREAM_WARNING,options:[r,s],tag:En.TRACER}).onSuccess(),this.safeEmit(oe.LIVE_STREAMING_WARNING,r,s)},n.on(uO.REQUEST_WORKER_MANAGER_LIST,(r,s,c)=>{if(!this._joinInfo)return c(new z(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,h,p){const m=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(_=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return await zH(m,l,d,h,p)})(r,this._joinInfo,this._axiosCancelSource.token,Wn).then(s).catch(c)}),n};return t===el.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new z(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},rl("ChannelMediaRelay").create(t));i.on("state",r=>{r===Ur.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(oe.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(oe.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,s)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:c,stream_id:l,ordered:d,max_retrans_times:h,metadata:p}=s,m=this._users.find(_=>_._uintid===c);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),_t(r).call(r,m)||r.push(m),m._uintid||(m._uintid=c),m._dataChannels.findIndex(_=>_.id===s.stream_id)===-1){const _={id:l,ordered:!!d,maxRetransmits:h,metadata:p},g=function(I){return G1(I,!0)}(_);m._dataChannels.push(g),T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),e||this.safeEmit(oe.USER_PUBLISHED,m,"datachannel",_)}this._p2pChannel.hasPendingRemoteDataChannel(m,s.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,s.stream_id).catch(_=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),_.toString())}))}),e&&(this.safeEmit(oe.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(s=>{const{uid:c,stream_id:l}=s,d=this._users.find(p=>p._uintid===c);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=d._dataChannels.find(p=>p.id===s.stream_id);h&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then(p=>{if(d._dataChannels=d._dataChannels.filter(m=>m!==h),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(oe.USER_UNPUBLISHED,d,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(oe.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ui.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:s,expires:c}=e[i];c&&c<=n||s||iO()||!Object.prototype.hasOwnProperty.call(Kv,i)||(eo[i]=r,en[i]=r,T.debug("Update gateway parameters from config distribute",i,r))})}catch(e){T.error("Error update config from local cache",e.message)}})()}),this._gateway.on(ui.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ui.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===Ie.FALLBACK)return;const r=()=>{this.safeEmit(oe.CONNECTION_STATE_CHANGE,t,e,n)};if(Mt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Hn.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:En.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,It.AUDIO,!1)),c._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,It.VIDEO,!1)),c._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(ui.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new z(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await LU(Ts(Ts({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,MU(i),this._joinInfo.preload=!0):(n=await bO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Wn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s;const[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):r.push({host:l,port:d})}),t(r)}catch(n){e(n)}}),this._gateway.on(ui.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(oe.NETWORK_QUALITY,t)}),this._gateway.on(ui.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(oe.STREAM_TYPE_CHANGED,t,e),Mt.reportApiInvoke(this._sessionId,{name:Hn.STREAM_TYPE_CHANGE,options:[t,e],tag:En.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(ui.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(ui.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();M("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(ui.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const i=N1(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(ui.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(r),icePwd:"".concat(s,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=M("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(le.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(le.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(le.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(le.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(le.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(le.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(le.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(le.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(le.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,It.AUDIO,!0)),this._gateway.signal.on(le.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,It.AUDIO,!1)),this._gateway.signal.on(le.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,It.VIDEO,!0)),this._gateway.signal.on(le.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,It.VIDEO,!1)),this._gateway.signal.on(le.RECEIVE_METADATA,t=>{const e=rh(t.metadata);this.safeEmit(oe.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(le.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=rh(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&_t(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<Wf)throw new z(L.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Wf));n=await async function(s,c,l){const d=l.subarray(0,Wf),h=d.slice(8,Wf),p=(h[0]<<8)+h[1],m=(d[6]<<8)+d[7],_=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:GP,additionalData:new Uint8Array(wP(p,2))},c,l.subarray(Wf));return new Uint8Array(_).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(s==null?void 0:s._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),u6(Ts(Ts({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(le.ON_CRYPT_ERROR,()=>{_u(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(oe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(le.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(le.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ie.TOKEN_EXPIRE),this.safeEmit(oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(le.ON_STREAM_FALLBACK_UPDATE,t=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(oe.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(le.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(le.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(le.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Yt.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case Wt.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const s=r.some(d=>{let{stream_type:h}=d;return h===we.Audio}),c=r.some(d=>{let{stream_type:h}=d;return h!==we.Audio}),l=r.some(d=>{let{stream_type:h}=d;return h===we.Screen||h===we.ScreenLow});e.state==="offer"&&Mt.publish(this._joinInfo.sid,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:s,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(n=r.find(d=>{let{stream_type:h}=d;return h===we.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(d=>{let{stream_type:h}=d;return h!==we.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Wt.SUBSCRIBE:e&&Mt.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:e.stream_type===It.AUDIO,video:e.stream_type===It.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Bi.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(le.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(le.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;M("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!ph(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(p=>p._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new Au(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(oe.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(oe.USER_JOINED,r)));const s=ri.Audio&i.stream_type,c=(ri.Video|ri.LwoVideo)&i.stream_type,l=(65280&i.stream_type)!=0,d=s&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),s&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),s&&!d&&this.getListeners(oe.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(oe.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(oe.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(oe.USER_PUBLISHED,r,"video")),(s&&!d||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(oe.PUBLISHED_USER_LIST).length>0?M("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(oe.PUBLISHED_USER_LIST,e)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(le.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof Lg&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return _t(i=Object.keys(Yv)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(le.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ln.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:s,ssrcs:c,mid:l,isMuted:d}=r;this._handleP2PAddAudioOrVideoStream(s,i,c[0].ssrcId,l);const h=this._users.find(p=>p.uid===i);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,s,!!d)})}),this._gateway.signal.on(Ln.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(Yt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Ln.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,s=this._users.find(c=>c.uid===r);if(!s)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const d=l===we.Audio?It.AUDIO:It.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(r,d,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(Ln.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case Tu.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,It.VIDEO,!0);break;case Tu.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,It.AUDIO,!0);break;case Tu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,It.VIDEO,!1);break;case Tu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,It.AUDIO,!1)}}),this._gateway.signal.on(Ln.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==or.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(Ln.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(Ft.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(Ln.RESTART_ICE,t,i===or.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Ft.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Ln.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Ft.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(Ln.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(Ft.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Ft.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Ft.StateChange,(t,e)=>{e===Oe.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ft.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(oe.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(Ft.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Ft.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Ft.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(Ft.RequestRePublishDataChannel,(t,e,n)=>{Tt.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==L.DISCONNECT_P2P)throw s}})).then(e).catch(n)}),this._p2pChannel.on(Ft.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===It.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(Ft.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(Ft.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Ft.MediaReconnectStart,t=>{this.safeEmit(oe.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Ft.MediaReconnectEnd,t=>{this.safeEmit(oe.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Ft.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ft.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:s}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(Ft.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ft.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=N1(r,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ft.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(Ft.P2PLost,()=>{this.safeEmit(oe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ft.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Ft.ConnectionTypeChange,t=>{this.safeEmit(oe.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Ft.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ft.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Ft.AudioMetadata,t=>{this.safeEmit(oe.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},rl("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:s,token:c,uid:l,cid:d,vid:h}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:s,token:c,uid:l,cid:d,vid:h?Number(h):0},Wn)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(di.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(oe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===_s.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(oe.CONTENT_INSPECT_ERROR,new z(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(di.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(oe.CONTENT_INSPECT_RESULT,e,n)}),t.on(di.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Qc(t,"enabled"),t){if(!e)throw new z(L.INVALID_PARAMS,"config is required");if(qU(e),!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},rl("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:s,sid:c,token:l,uid:d,cid:h,vid:p}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:s,sid:c,token:l,uid:d,cid:h,vid:p?Number(p):0},Wn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(ro.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(oe.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===Ba.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new z(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(ro.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Zn(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new z(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Qc(t,"enabled"),Pe("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Lt(Ct.prototype,"leave",[XU],Object.getOwnPropertyDescriptor(Ct.prototype,"leave"),Ct.prototype),Lt(Ct.prototype,"publish",[JU],Object.getOwnPropertyDescriptor(Ct.prototype,"publish"),Ct.prototype),Lt(Ct.prototype,"unpublish",[QU],Object.getOwnPropertyDescriptor(Ct.prototype,"unpublish"),Ct.prototype),Lt(Ct.prototype,"subscribe",[ZU],Object.getOwnPropertyDescriptor(Ct.prototype,"subscribe"),Ct.prototype),Lt(Ct.prototype,"presubscribe",[$U],Object.getOwnPropertyDescriptor(Ct.prototype,"presubscribe"),Ct.prototype),Lt(Ct.prototype,"massSubscribe",[t2],Object.getOwnPropertyDescriptor(Ct.prototype,"massSubscribe"),Ct.prototype),Lt(Ct.prototype,"unsubscribe",[e2],Object.getOwnPropertyDescriptor(Ct.prototype,"unsubscribe"),Ct.prototype),Lt(Ct.prototype,"massUnsubscribe",[n2],Object.getOwnPropertyDescriptor(Ct.prototype,"massUnsubscribe"),Ct.prototype),Lt(Ct.prototype,"setLowStreamParameter",[i2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLowStreamParameter"),Ct.prototype),Lt(Ct.prototype,"enableDualStream",[r2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableDualStream"),Ct.prototype),Lt(Ct.prototype,"disableDualStream",[a2],Object.getOwnPropertyDescriptor(Ct.prototype,"disableDualStream"),Ct.prototype),Lt(Ct.prototype,"setClientRole",[s2],Object.getOwnPropertyDescriptor(Ct.prototype,"setClientRole"),Ct.prototype),Lt(Ct.prototype,"_setClientRoleOptions",[o2],Object.getOwnPropertyDescriptor(Ct.prototype,"_setClientRoleOptions"),Ct.prototype),Lt(Ct.prototype,"setProxyServer",[c2],Object.getOwnPropertyDescriptor(Ct.prototype,"setProxyServer"),Ct.prototype),Lt(Ct.prototype,"setTurnServer",[l2],Object.getOwnPropertyDescriptor(Ct.prototype,"setTurnServer"),Ct.prototype),Lt(Ct.prototype,"setLicense",[u2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLicense"),Ct.prototype),Lt(Ct.prototype,"startProxyServer",[d2],Object.getOwnPropertyDescriptor(Ct.prototype,"startProxyServer"),Ct.prototype),Lt(Ct.prototype,"stopProxyServer",[h2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopProxyServer"),Ct.prototype),Lt(Ct.prototype,"setLocalAccessPointsV2",[p2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLocalAccessPointsV2"),Ct.prototype),Lt(Ct.prototype,"setLocalAccessPoints",[f2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLocalAccessPoints"),Ct.prototype),Lt(Ct.prototype,"setRemoteDefaultVideoStreamType",[m2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRemoteDefaultVideoStreamType"),Ct.prototype),Lt(Ct.prototype,"setRemoteVideoStreamType",[_2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRemoteVideoStreamType"),Ct.prototype),Lt(Ct.prototype,"setStreamFallbackOption",[E2],Object.getOwnPropertyDescriptor(Ct.prototype,"setStreamFallbackOption"),Ct.prototype),Lt(Ct.prototype,"setEncryptionConfig",[g2],Object.getOwnPropertyDescriptor(Ct.prototype,"setEncryptionConfig"),Ct.prototype),Lt(Ct.prototype,"renewToken",[S2],Object.getOwnPropertyDescriptor(Ct.prototype,"renewToken"),Ct.prototype),Lt(Ct.prototype,"enableAudioVolumeIndicator",[T2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableAudioVolumeIndicator"),Ct.prototype),Lt(Ct.prototype,"startLiveStreaming",[R2],Object.getOwnPropertyDescriptor(Ct.prototype,"startLiveStreaming"),Ct.prototype),Lt(Ct.prototype,"setLiveTranscoding",[v2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLiveTranscoding"),Ct.prototype),Lt(Ct.prototype,"stopLiveStreaming",[y2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopLiveStreaming"),Ct.prototype),Lt(Ct.prototype,"startChannelMediaRelay",[C2],Object.getOwnPropertyDescriptor(Ct.prototype,"startChannelMediaRelay"),Ct.prototype),Lt(Ct.prototype,"updateChannelMediaRelay",[A2],Object.getOwnPropertyDescriptor(Ct.prototype,"updateChannelMediaRelay"),Ct.prototype),Lt(Ct.prototype,"stopChannelMediaRelay",[b2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopChannelMediaRelay"),Ct.prototype),Lt(Ct.prototype,"sendCustomReportMessage",[I2],Object.getOwnPropertyDescriptor(Ct.prototype,"sendCustomReportMessage"),Ct.prototype),Lt(Ct.prototype,"pickSVCLayer",[O2],Object.getOwnPropertyDescriptor(Ct.prototype,"pickSVCLayer"),Ct.prototype),Lt(Ct.prototype,"setRTMConfig",[w2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRTMConfig"),Ct.prototype),Lt(Ct.prototype,"enableContentInspect",[N2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableContentInspect"),Ct.prototype),Lt(Ct.prototype,"disableContentInspect",[D2],Object.getOwnPropertyDescriptor(Ct.prototype,"disableContentInspect"),Ct.prototype),Lt(Ct.prototype,"setImageModeration",[L2],Object.getOwnPropertyDescriptor(Ct.prototype,"setImageModeration"),Ct.prototype),Lt(Ct.prototype,"setP2PTransport",[P2],Object.getOwnPropertyDescriptor(Ct.prototype,"setP2PTransport"),Ct.prototype),Lt(Ct.prototype,"getJoinChannelServiceRecords",[k2],Object.getOwnPropertyDescriptor(Ct.prototype,"getJoinChannelServiceRecords"),Ct.prototype),Lt(Ct.prototype,"setPublishAudioFilterEnabled",[M2],Object.getOwnPropertyDescriptor(Ct.prototype,"setPublishAudioFilterEnabled"),Ct.prototype),Ct);class Mg{constructor(e,n){O(this,"id",0),O(this,"element",void 0),O(this,"peerPair",void 0),O(this,"context",void 0),O(this,"audioPlayerElement",void 0),O(this,"audioTrack",void 0),Mg.count+=1,this.id=Mg.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const s=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(s),i.iceGatheringState==="complete"?i.localDescription:new Tt(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new z(L.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new z(L.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new z(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var x2,Vy;O(Mg,"count",0);const I6=window.AudioContext||window.webkitAudioContext,O6=new(x2=Gt({report:Mt}),Lt((Vy=class{constructor(){O(this,"units",[]),O(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new I6);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new Mg(t,this.context),this.units.push(e)),e.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return ge().name!==Ce.SAFARI}}).prototype,"processExternalMediaAEC",[x2],Object.getOwnPropertyDescriptor(Vy.prototype,"processExternalMediaAEC"),Vy.prototype),Vy);function V2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function B2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?V2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const GO=window||document;function F2(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!GO)return;const n=Kn._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(Kn.onSecurityPolicyViolation||Kn.getListeners(nc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=r.blockedURI;M("CSP_DETECTED_HOSTNAME_LIST").some(c=>_t(s).call(s,c))&&(Kn.onSecurityPolicyViolation&&typeof Kn.onSecurityPolicyViolation=="function"&&Kn.onSecurityPolicyViolation(r),Kn.getListeners(nc.SECURITY_POLICY_VIOLATION).length>0&&Kn.safeEmit(nc.SECURITY_POLICY_VIOLATION,r))};n&&GO.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||Kn.getListeners(nc.SECURITY_POLICY_VIOLATION).length>0)&&GO.addEventListener("securitypolicyviolation",i),Kn._cspEventHandlerPointer=i}var w6=mt,N6=yL,j2=RegExp.prototype,D6=function(t){return t===j2||w6(j2,t)?N6(t):t.flags},tr=P(D6);function Em(t){let e=t.length;for(;--e>=0;)t[e]=0}const HO=256,G2=286,Ug=30,xg=15,WO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),By=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),L6=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),H2=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ol=new Array(576);Em(ol);const Vg=new Array(60);Em(Vg);const Bg=new Array(512);Em(Bg);const Fg=new Array(256);Em(Fg);const KO=new Array(29);Em(KO);const Fy=new Array(Ug);function YO(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let W2,K2,Y2;function zO(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Em(Fy);const z2=t=>t<256?Bg[t]:Bg[256+(t>>>7)],jg=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},ga=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,jg(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},oc=(t,e,n)=>{ga(t,n[2*e],n[2*e+1])},q2=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},X2=(t,e,n)=>{const i=new Array(16);let r,s,c=0;for(r=1;r<=xg;r++)c=c+n[r-1]<<1,i[r]=c;for(s=0;s<=e;s++){let l=t[2*s+1];l!==0&&(t[2*s]=q2(i[l]++,l))}},J2=t=>{let e;for(e=0;e<G2;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Ug;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Q2=t=>{t.bi_valid>8?jg(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Z2=(t,e,n,i)=>{const r=2*e,s=2*n;return t[r]<t[s]||t[r]===t[s]&&i[e]<=i[n]},qO=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&Z2(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!Z2(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},$2=(t,e,n)=>{let i,r,s,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?oc(t,r,e):(s=Fg[r],oc(t,s+HO+1,e),c=WO[s],c!==0&&(r-=KO[s],ga(t,r,c)),i--,s=z2(i),oc(t,s,n),c=By[s],c!==0&&(i-=Fy[s],ga(t,i,c)));while(l<t.sym_next);oc(t,256,e)},XO=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let c,l,d,h=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<s;c++)n[2*c]!==0?(t.heap[++t.heap_len]=h=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)d=t.heap[++t.heap_len]=h<2?++h:0,n[2*d]=1,t.depth[d]=0,t.opt_len--,r&&(t.static_len-=i[2*d+1]);for(e.max_code=h,c=t.heap_len>>1;c>=1;c--)qO(t,n,c);d=s;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],qO(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*d]=n[2*c]+n[2*l],t.depth[d]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=d,t.heap[1]=d++,qO(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((p,m)=>{const _=m.dyn_tree,g=m.max_code,I=m.stat_desc.static_tree,y=m.stat_desc.has_stree,C=m.stat_desc.extra_bits,N=m.stat_desc.extra_base,D=m.stat_desc.max_length;let V,W,K,j,Q,ct,vt=0;for(j=0;j<=xg;j++)p.bl_count[j]=0;for(_[2*p.heap[p.heap_max]+1]=0,V=p.heap_max+1;V<573;V++)W=p.heap[V],j=_[2*_[2*W+1]+1]+1,j>D&&(j=D,vt++),_[2*W+1]=j,W>g||(p.bl_count[j]++,Q=0,W>=N&&(Q=C[W-N]),ct=_[2*W],p.opt_len+=ct*(j+Q),y&&(p.static_len+=ct*(I[2*W+1]+Q)));if(vt!==0){do{for(j=D-1;p.bl_count[j]===0;)j--;p.bl_count[j]--,p.bl_count[j+1]+=2,p.bl_count[D]--,vt-=2}while(vt>0);for(j=D;j!==0;j--)for(W=p.bl_count[j];W!==0;)K=p.heap[--V],K>g||(_[2*K+1]!==j&&(p.opt_len+=(j-_[2*K+1])*_[2*K],_[2*K+1]=j),W--)}})(t,e),X2(n,h,t.bl_count)},tx=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<d&&r===c||(l<h?t.bl_tree[2*r]+=l:r!==0?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4))},ex=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<d&&r===c)){if(l<h)do oc(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==s&&(oc(t,r,t.bl_tree),l--),oc(t,16,t.bl_tree),ga(t,l-3,2)):l<=10?(oc(t,17,t.bl_tree),ga(t,l-3,3)):(oc(t,18,t.bl_tree),ga(t,l-11,7));l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4)}};let nx=!1;const ix=(t,e,n,i)=>{ga(t,0+(i?1:0),3),Q2(t),jg(t,n),jg(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var P6=t=>{nx||((()=>{let e,n,i,r,s;const c=new Array(16);for(i=0,r=0;r<28;r++)for(KO[r]=i,e=0;e<1<<WO[r];e++)Fg[i++]=r;for(Fg[i-1]=r,s=0,r=0;r<16;r++)for(Fy[r]=s,e=0;e<1<<By[r];e++)Bg[s++]=r;for(s>>=7;r<Ug;r++)for(Fy[r]=s<<7,e=0;e<1<<By[r]-7;e++)Bg[256+s++]=r;for(n=0;n<=xg;n++)c[n]=0;for(e=0;e<=143;)ol[2*e+1]=8,e++,c[8]++;for(;e<=255;)ol[2*e+1]=9,e++,c[9]++;for(;e<=279;)ol[2*e+1]=7,e++,c[7]++;for(;e<=287;)ol[2*e+1]=8,e++,c[8]++;for(X2(ol,287,c),e=0;e<Ug;e++)Vg[2*e+1]=5,Vg[2*e]=q2(e,5);W2=new YO(ol,WO,257,G2,xg),K2=new YO(Vg,By,0,Ug,xg),Y2=new YO(new Array(0),L6,0,19,7)})(),nx=!0),t.l_desc=new zO(t.dyn_ltree,W2),t.d_desc=new zO(t.dyn_dtree,K2),t.bl_desc=new zO(t.bl_tree,Y2),t.bi_buf=0,t.bi_valid=0,J2(t)},k6=(t,e,n,i)=>{let r,s,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<HO;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(t)),XO(t,t.l_desc),XO(t,t.d_desc),c=(l=>{let d;for(tx(l,l.dyn_ltree,l.l_desc.max_code),tx(l,l.dyn_dtree,l.d_desc.max_code),XO(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*H2[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&e!==-1?ix(t,e,n,i):t.strategy===4||s===r?(ga(t,2+(i?1:0),3),$2(t,ol,Vg)):(ga(t,4+(i?1:0),3),((l,d,h,p)=>{let m;for(ga(l,d-257,5),ga(l,h-1,5),ga(l,p-4,4),m=0;m<p;m++)ga(l,l.bl_tree[2*H2[m]+1],3);ex(l,l.dyn_ltree,d-1),ex(l,l.dyn_dtree,h-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),$2(t,t.dyn_ltree,t.dyn_dtree)),J2(t),i&&Q2(t)},M6=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Fg[n]+HO+1)]++,t.dyn_dtree[2*z2(e)]++),t.sym_next===t.sym_end),U6=t=>{ga(t,2,3),oc(t,256,ol),(e=>{e.bi_valid===16?(jg(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},x6={_tr_init:P6,_tr_stored_block:ix,_tr_flush_block:k6,_tr_tally:M6,_tr_align:U6},Gg=(t,e,n,i)=>{let r=65535&t|0,s=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,s=s+r|0;while(--c);r%=65521,s%=65521}return r|s<<16|0};const V6=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var lr=(t,e,n,i)=>{const r=V6,s=i+n;t^=-1;for(let c=i;c<s;c++)t=t>>>8^r[255&(t^e[c])];return-1^t},vh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},jy={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:B6,_tr_stored_block:JO,_tr_flush_block:F6,_tr_tally:wu,_tr_align:j6}=x6,{Z_NO_FLUSH:Nu,Z_PARTIAL_FLUSH:G6,Z_FULL_FLUSH:H6,Z_FINISH:Rs,Z_BLOCK:rx,Z_OK:Rr,Z_STREAM_END:ax,Z_STREAM_ERROR:cc,Z_DATA_ERROR:W6,Z_BUF_ERROR:QO,Z_DEFAULT_COMPRESSION:K6,Z_FILTERED:Y6,Z_HUFFMAN_ONLY:Gy,Z_RLE:z6,Z_FIXED:q6,Z_DEFAULT_STRATEGY:X6,Z_UNKNOWN:J6,Z_DEFLATED:Hy}=jy,ZO=286,Q6=30,Z6=19,$6=2*ZO+1,tW=15,yh=258,lc=262,gm=42,Ch=113,Hg=666,Ah=(t,e)=>(t.msg=vh[e],e),sx=t=>2*t-(t>4?9:0),Du=t=>{let e=t.length;for(;--e>=0;)t[e]=0},eW=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let Lu=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const ja=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Ga=(t,e)=>{F6(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ja(t.strm)},bn=(t,e)=>{t.pending_buf[t.pending++]=e},Wg=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},$O=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=Gg(t.adler,e,r,n):t.state.wrap===2&&(t.adler=lr(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},ox=(t,e)=>{let n,i,r=t.max_chain_length,s=t.strstart,c=t.prev_length,l=t.nice_match;const d=t.strstart>t.w_size-lc?t.strstart-(t.w_size-lc):0,h=t.window,p=t.w_mask,m=t.prev,_=t.strstart+yh;let g=h[s+c-1],I=h[s+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,h[n+c]===I&&h[n+c-1]===g&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<_);if(i=yh-(_-s),s=_-yh,i>c){if(t.match_start=e,c=i,i>=l)break;g=h[s+c-1],I=h[s+c]}}while((e=m[e&p])>d&&--r!=0);return c<=t.lookahead?c:t.lookahead},Sm=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-lc)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),eW(t),i+=e),t.strm.avail_in===0)break;if(n=$O(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=Lu(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=Lu(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<lc&&t.strm.avail_in!==0)},cx=(t,e)=>{let n,i,r,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<s&&(n===0&&e!==Rs||e===Nu||n!==i+t.strm.avail_in)))break;c=e===Rs&&n===i+t.strm.avail_in?1:0,JO(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,ja(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&($O(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==Nu&&e!==Rs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&($O(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,s=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=s||(i||e===Rs)&&e!==Nu&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===Rs&&t.strm.avail_in===0&&n===i?1:0,JO(t,t.block_start,n,c),t.block_start+=n,ja(t.strm)),c?3:1)},tw=(t,e)=>{let n,i;for(;;){if(t.lookahead<lc){if(Sm(t),t.lookahead<lc&&e===Nu)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-lc&&(t.match_length=ox(t,n)),t.match_length>=3)if(i=wu(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+1]);else i=wu(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(Ga(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Rs?(Ga(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ga(t,!1),t.strm.avail_out===0)?1:2},Tm=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<lc){if(Sm(t),t.lookahead<lc&&e===Nu)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-lc&&(t.match_length=ox(t,n),t.match_length<=5&&(t.strategy===Y6||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=wu(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(Ga(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=wu(t,0,t.window[t.strstart-1]),i&&Ga(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=wu(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Rs?(Ga(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ga(t,!1),t.strm.avail_out===0)?1:2};function uc(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const Kg=[new uc(0,0,0,0,cx),new uc(4,4,8,4,tw),new uc(4,5,16,8,tw),new uc(4,6,32,32,tw),new uc(4,4,16,16,Tm),new uc(8,16,32,32,Tm),new uc(8,16,128,128,Tm),new uc(8,32,128,256,Tm),new uc(32,128,258,1024,Tm),new uc(32,258,258,4096,Tm)];function nW(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Hy,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*$6),this.dyn_dtree=new Uint16Array(2*(2*Q6+1)),this.bl_tree=new Uint16Array(2*(2*Z6+1)),Du(this.dyn_ltree),Du(this.dyn_dtree),Du(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(tW+1),this.heap=new Uint16Array(2*ZO+1),Du(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*ZO+1),Du(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Yg=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==gm&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Ch&&e.status!==Hg?1:0},lx=t=>{if(Yg(t))return Ah(t,cc);t.total_in=t.total_out=0,t.data_type=J6;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?gm:Ch,t.adler=e.wrap===2?0:1,e.last_flush=-2,B6(e),Rr},ux=t=>{const e=lx(t);return e===Rr&&(n=>{n.window_size=2*n.w_size,Du(n.head),n.max_lazy_match=Kg[n.level].max_lazy,n.good_match=Kg[n.level].good_length,n.nice_match=Kg[n.level].nice_length,n.max_chain_length=Kg[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},dx=(t,e,n,i,r,s)=>{if(!t)return cc;let c=1;if(e===K6&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==Hy||i<8||i>15||e<0||e>9||s<0||s>q6||i===8&&c!==1)return Ah(t,cc);i===8&&(i=9);const l=new nW;return t.state=l,l.strm=t,l.status=gm,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=s,l.method=n,ux(t)};var iW=(t,e)=>{if(Yg(t)||e>rx||e<0)return t?Ah(t,cc):cc;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Hg&&e!==Rs)return Ah(t,t.avail_out===0?QO:cc);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(ja(t),t.avail_out===0)return n.last_flush=-1,Rr}else if(t.avail_in===0&&sx(e)<=sx(i)&&e!==Rs)return Ah(t,QO);if(n.status===Hg&&t.avail_in!==0)return Ah(t,QO);if(n.status===gm&&n.wrap===0&&(n.status=Ch),n.status===gm){let r=Hy+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=Gy||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=s<<6,n.strstart!==0&&(r|=32),r+=31-r%31,Wg(n,r),n.strstart!==0&&(Wg(n,t.adler>>>16),Wg(n,65535&t.adler)),t.adler=1,n.status=Ch,ja(t),n.pending!==0)return n.last_flush=-1,Rr}if(n.status===57){if(t.adler=0,bn(n,31),bn(n,139),bn(n,8),n.gzhead)bn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),bn(n,255&n.gzhead.time),bn(n,n.gzhead.time>>8&255),bn(n,n.gzhead.time>>16&255),bn(n,n.gzhead.time>>24&255),bn(n,n.level===9?2:n.strategy>=Gy||n.level<2?4:0),bn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(bn(n,255&n.gzhead.extra.length),bn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=lr(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(bn(n,0),bn(n,0),bn(n,0),bn(n,0),bn(n,0),bn(n,n.level===9?2:n.strategy>=Gy||n.level<2?4:0),bn(n,3),n.status=Ch,ja(t),n.pending!==0)return n.last_flush=-1,Rr}if(n.status===69){if(n.gzhead.extra){let r=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=lr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,ja(t),n.pending!==0)return n.last_flush=-1,Rr;r=0,s-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>r&&(t.adler=lr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=lr(t.adler,n.pending_buf,n.pending-s,s)),ja(t),n.pending!==0)return n.last_flush=-1,Rr;s=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,bn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=lr(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=lr(t.adler,n.pending_buf,n.pending-s,s)),ja(t),n.pending!==0)return n.last_flush=-1,Rr;s=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,bn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=lr(t.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ja(t),n.pending!==0))return n.last_flush=-1,Rr;bn(n,255&t.adler),bn(n,t.adler>>8&255),t.adler=0}if(n.status=Ch,ja(t),n.pending!==0)return n.last_flush=-1,Rr}if(t.avail_in!==0||n.lookahead!==0||e!==Nu&&n.status!==Hg){let r=n.level===0?cx(n,e):n.strategy===Gy?((s,c)=>{let l;for(;;){if(s.lookahead===0&&(Sm(s),s.lookahead===0)){if(c===Nu)return 1;break}if(s.match_length=0,l=wu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(Ga(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Rs?(Ga(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ga(s,!1),s.strm.avail_out===0)?1:2})(n,e):n.strategy===z6?((s,c)=>{let l,d,h,p;const m=s.window;for(;;){if(s.lookahead<=yh){if(Sm(s),s.lookahead<=yh&&c===Nu)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,d=m[h],d===m[++h]&&d===m[++h]&&d===m[++h])){p=s.strstart+yh;do;while(d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&h<p);s.match_length=yh-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=wu(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=wu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(Ga(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Rs?(Ga(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ga(s,!1),s.strm.avail_out===0)?1:2})(n,e):Kg[n.level].func(n,e);if(r!==3&&r!==4||(n.status=Hg),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),Rr;if(r===2&&(e===G6?j6(n):e!==rx&&(JO(n,0,0,!1),e===H6&&(Du(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ja(t),t.avail_out===0))return n.last_flush=-1,Rr}return e!==Rs?Rr:n.wrap<=0?ax:(n.wrap===2?(bn(n,255&t.adler),bn(n,t.adler>>8&255),bn(n,t.adler>>16&255),bn(n,t.adler>>24&255),bn(n,255&t.total_in),bn(n,t.total_in>>8&255),bn(n,t.total_in>>16&255),bn(n,t.total_in>>24&255)):(Wg(n,t.adler>>>16),Wg(n,65535&t.adler)),ja(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Rr:ax)},rW=(t,e)=>{let n=e.length;if(Yg(t))return cc;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==gm||i.lookahead)return cc;if(r===1&&(t.adler=Gg(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(Du(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(e.subarray(n-i.w_size,n),0),e=d,n=i.w_size}const s=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Sm(i);i.lookahead>=3;){let d=i.strstart,h=i.lookahead-2;do i.ins_h=Lu(i,i.ins_h,i.window[d+3-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--h);i.strstart=d,i.lookahead=2,Sm(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=s,i.wrap=r,Rr},zg={deflateInit:(t,e)=>dx(t,e,Hy,15,8,X6),deflateInit2:dx,deflateReset:ux,deflateResetKeep:lx,deflateSetHeader:(t,e)=>Yg(t)||t.state.wrap!==2?cc:(t.state.gzhead=e,Rr),deflate:iW,deflateEnd:t=>{if(Yg(t))return cc;const e=t.state.status;return t.state=null,e===Ch?Ah(t,W6):Rr},deflateSetDictionary:rW,deflateInfo:"pako deflate (from Nodeca project)"};const aW=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Wy={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)aW(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,s=t.length;i<s;i++){let c=t[i];n.set(c,r),r+=c.length}return n}};let hx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{hx=!1}const qg=new Uint8Array(256);for(let t=0;t<256;t++)qg[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;qg[254]=qg[254]=1;var Xg={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,s,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),s=0,r=0;s<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){s[r++]=c;continue}let l=qg[c];if(l>4)s[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?s[r++]=65533:c<65536?s[r++]=c:(c-=65536,s[r++]=55296|c>>10&1023,s[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&hx)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let h=0;h<l;h++)d+=String.fromCharCode(c[h]);return d})(s,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+qg[t[n]]>e?n:e}},px=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const fx=Object.prototype.toString,{Z_NO_FLUSH:sW,Z_SYNC_FLUSH:oW,Z_FULL_FLUSH:cW,Z_FINISH:lW,Z_OK:Ky,Z_STREAM_END:uW,Z_DEFAULT_COMPRESSION:dW,Z_DEFAULT_STRATEGY:hW,Z_DEFLATED:pW}=jy;function Yy(t){this.options=Wy.assign({level:dW,method:pW,chunkSize:16384,windowBits:15,memLevel:8,strategy:hW},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new px,this.strm.avail_out=0;let n=zg.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Ky)throw new Error(vh[n]);if(e.header&&zg.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?Xg.string2buf(e.dictionary):fx.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=zg.deflateSetDictionary(this.strm,i),n!==Ky)throw new Error(vh[n]);this._dict_set=!0}}function fW(t,e){const n=new Yy(e);if(n.push(t,!0),n.err)throw n.msg||vh[n.err];return n.result}Yy.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?lW:sW,typeof t=="string"?n.input=Xg.string2buf(t):fx.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===oW||s===cW)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=zg.deflate(n,s),r===uW)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=zg.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Ky;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Yy.prototype.onData=function(t){this.chunks.push(t)},Yy.prototype.onEnd=function(t){t===Ky&&(this.result=Wy.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var mW={deflate:fW};const zy=16209;var _W=function(t,e){let n,i,r,s,c,l,d,h,p,m,_,g,I,y,C,N,D,V,W,K,j,Q,ct,vt;const At=t.state;n=t.next_in,ct=t.input,i=n+(t.avail_in-5),r=t.next_out,vt=t.output,s=r-(e-t.avail_out),c=r+(t.avail_out-257),l=At.dmax,d=At.wsize,h=At.whave,p=At.wnext,m=At.window,_=At.hold,g=At.bits,I=At.lencode,y=At.distcode,C=(1<<At.lenbits)-1,N=(1<<At.distbits)-1;t:do{g<15&&(_+=ct[n++]<<g,g+=8,_+=ct[n++]<<g,g+=8),D=I[_&C];e:for(;;){if(V=D>>>24,_>>>=V,g-=V,V=D>>>16&255,V===0)vt[r++]=65535&D;else{if(!(16&V)){if((64&V)==0){D=I[(65535&D)+(_&(1<<V)-1)];continue e}if(32&V){At.mode=16191;break t}t.msg="invalid literal/length code",At.mode=zy;break t}W=65535&D,V&=15,V&&(g<V&&(_+=ct[n++]<<g,g+=8),W+=_&(1<<V)-1,_>>>=V,g-=V),g<15&&(_+=ct[n++]<<g,g+=8,_+=ct[n++]<<g,g+=8),D=y[_&N];n:for(;;){if(V=D>>>24,_>>>=V,g-=V,V=D>>>16&255,!(16&V)){if((64&V)==0){D=y[(65535&D)+(_&(1<<V)-1)];continue n}t.msg="invalid distance code",At.mode=zy;break t}if(K=65535&D,V&=15,g<V&&(_+=ct[n++]<<g,g+=8,g<V&&(_+=ct[n++]<<g,g+=8)),K+=_&(1<<V)-1,K>l){t.msg="invalid distance too far back",At.mode=zy;break t}if(_>>>=V,g-=V,V=r-s,K>V){if(V=K-V,V>h&&At.sane){t.msg="invalid distance too far back",At.mode=zy;break t}if(j=0,Q=m,p===0){if(j+=d-V,V<W){W-=V;do vt[r++]=m[j++];while(--V);j=r-K,Q=vt}}else if(p<V){if(j+=d+p-V,V-=p,V<W){W-=V;do vt[r++]=m[j++];while(--V);if(j=0,p<W){V=p,W-=V;do vt[r++]=m[j++];while(--V);j=r-K,Q=vt}}}else if(j+=p-V,V<W){W-=V;do vt[r++]=m[j++];while(--V);j=r-K,Q=vt}for(;W>2;)vt[r++]=Q[j++],vt[r++]=Q[j++],vt[r++]=Q[j++],W-=3;W&&(vt[r++]=Q[j++],W>1&&(vt[r++]=Q[j++]))}else{j=r-K;do vt[r++]=vt[j++],vt[r++]=vt[j++],vt[r++]=vt[j++],W-=3;while(W>2);W&&(vt[r++]=vt[j++],W>1&&(vt[r++]=vt[j++]))}break}}break}}while(n<i&&r<c);W=g>>3,n-=W,g-=W<<3,_&=(1<<g)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),At.hold=_,At.bits=g};const qy=15,EW=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),gW=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),SW=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),TW=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Jg=(t,e,n,i,r,s,c,l)=>{const d=l.bits;let h,p,m,_,g,I,y=0,C=0,N=0,D=0,V=0,W=0,K=0,j=0,Q=0,ct=0,vt=null;const At=new Uint16Array(16),ue=new Uint16Array(16);let de,qe,Pn,yn=null;for(y=0;y<=qy;y++)At[y]=0;for(C=0;C<i;C++)At[e[n+C]]++;for(V=d,D=qy;D>=1&&At[D]===0;D--);if(V>D&&(V=D),D===0)return r[s++]=20971520,r[s++]=20971520,l.bits=1,0;for(N=1;N<D&&At[N]===0;N++);for(V<N&&(V=N),j=1,y=1;y<=qy;y++)if(j<<=1,j-=At[y],j<0)return-1;if(j>0&&(t===0||D!==1))return-1;for(ue[1]=0,y=1;y<qy;y++)ue[y+1]=ue[y]+At[y];for(C=0;C<i;C++)e[n+C]!==0&&(c[ue[e[n+C]]++]=C);if(t===0?(vt=yn=c,I=20):t===1?(vt=EW,yn=gW,I=257):(vt=SW,yn=TW,I=0),ct=0,C=0,y=N,g=s,W=V,K=0,m=-1,Q=1<<V,_=Q-1,t===1&&Q>852||t===2&&Q>592)return 1;for(;;){de=y-K,c[C]+1<I?(qe=0,Pn=c[C]):c[C]>=I?(qe=yn[c[C]-I],Pn=vt[c[C]-I]):(qe=96,Pn=0),h=1<<y-K,p=1<<W,N=p;do p-=h,r[g+(ct>>K)+p]=de<<24|qe<<16|Pn|0;while(p!==0);for(h=1<<y-1;ct&h;)h>>=1;if(h!==0?(ct&=h-1,ct+=h):ct=0,C++,--At[y]==0){if(y===D)break;y=e[n+c[C]]}if(y>V&&(ct&_)!==m){for(K===0&&(K=V),g+=N,W=y-K,j=1<<W;W+K<D&&(j-=At[W+K],!(j<=0));)W++,j<<=1;if(Q+=1<<W,t===1&&Q>852||t===2&&Q>592)return 1;m=ct&_,r[m]=V<<24|W<<16|g-s|0}}return ct!==0&&(r[g+ct]=y-K<<24|64<<16|0),l.bits=V,0};const{Z_FINISH:mx,Z_BLOCK:RW,Z_TREES:Xy,Z_OK:bh,Z_STREAM_END:vW,Z_NEED_DICT:yW,Z_STREAM_ERROR:vs,Z_DATA_ERROR:_x,Z_MEM_ERROR:Ex,Z_BUF_ERROR:CW,Z_DEFLATED:gx}=jy,Jy=16180,Qy=16190,cl=16191,ew=16192,nw=16194,Zy=16199,$y=16200,iw=16206,hi=16209,Sx=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function AW(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ih=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Jy||e.mode>16211?1:0},Tx=t=>{if(Ih(t))return vs;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Jy,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,bh},Rx=t=>{if(Ih(t))return vs;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Tx(t)},vx=(t,e)=>{let n;if(Ih(t))return vs;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?vs:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,Rx(t))},yx=(t,e)=>{if(!t)return vs;const n=new AW;t.state=n,n.strm=t,n.window=null,n.mode=Jy;const i=vx(t,e);return i!==bh&&(t.state=null),i};let rw,aw,Cx=!0;const bW=t=>{if(Cx){rw=new Int32Array(512),aw=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Jg(1,t.lens,0,288,rw,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Jg(2,t.lens,0,32,aw,0,t.work,{bits:5}),Cx=!1}t.lencode=rw,t.lenbits=9,t.distcode=aw,t.distbits=5},Ax=(t,e,n,i)=>{let r;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(e.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(e.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var IW=(t,e)=>{let n,i,r,s,c,l,d,h,p,m,_,g,I,y,C,N,D,V,W,K,j,Q,ct=0;const vt=new Uint8Array(4);let At,ue;const de=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ih(t)||!t.output||!t.input&&t.avail_in!==0)return vs;n=t.state,n.mode===cl&&(n.mode=ew),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,m=l,_=d,Q=bh;t:for(;;)switch(n.mode){case Jy:if(n.wrap===0){n.mode=ew;break}for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,vt[0]=255&h,vt[1]=h>>>8&255,n.check=lr(n.check,vt,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=hi;break}if((15&h)!==gx){t.msg="unknown compression method",n.mode=hi;break}if(h>>>=4,p-=4,j=8+(15&h),n.wbits===0&&(n.wbits=j),j>15||j>n.wbits){t.msg="invalid window size",n.mode=hi;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:cl,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.flags=h,(255&tr(n))!==gx){t.msg="unknown compression method",n.mode=hi;break}if(57344&tr(n)){t.msg="unknown header flags set",n.mode=hi;break}n.head&&(n.head.text=h>>8&1),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,n.check=lr(n.check,vt,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.time=h),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,vt[2]=h>>>16&255,vt[3]=h>>>24&255,n.check=lr(n.check,vt,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,n.check=lr(n.check,vt,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&tr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,n.check=lr(n.check,vt,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&tr(n)&&(g=n.length,g>l&&(g=l),g&&(n.head&&(j=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+g),j)),512&tr(n)&&4&n.wrap&&(n.check=lr(n.check,i,g,s)),l-=g,s+=g,n.length-=g),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&tr(n)){if(l===0)break t;g=0;do j=i[s+g++],n.head&&j&&n.length<65536&&(n.head.name+=String.fromCharCode(j));while(j&&g<l);if(512&tr(n)&&4&n.wrap&&(n.check=lr(n.check,i,g,s)),l-=g,s+=g,j)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&tr(n)){if(l===0)break t;g=0;do j=i[s+g++],n.head&&j&&n.length<65536&&(n.head.comment+=String.fromCharCode(j));while(j&&g<l);if(512&tr(n)&&4&n.wrap&&(n.check=lr(n.check,i,g,s)),l-=g,s+=g,j)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&tr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=hi;break}h=0,p=0}n.head&&(n.head.hcrc=tr(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=cl;break;case 16189:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}t.adler=n.check=Sx(h),h=0,p=0,n.mode=Qy;case Qy:if(n.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,yW;t.adler=n.check=1,n.mode=cl;case cl:if(e===RW||e===Xy)break t;case ew:if(n.last){h>>>=7&p,p-=7&p,n.mode=iw;break}for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(bW(n),n.mode=Zy,e===Xy){h>>>=2,p-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=hi}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=hi;break}if(n.length=65535&h,h=0,p=0,n.mode=nw,e===Xy)break t;case nw:n.mode=16195;case 16195:if(g=n.length,g){if(g>l&&(g=l),g>d&&(g=d),g===0)break t;r.set(i.subarray(s,s+g),c),l-=g,s+=g,d-=g,c+=g,n.length-=g;break}n.mode=cl;break;case 16196:for(;p<14;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=hi;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.lens[de[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[de[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,At={bits:n.lenbits},Q=Jg(0,n.lens,0,19,n.lencode,0,n.work,At),n.lenbits=At.bits,Q){t.msg="invalid code lengths set",n.mode=hi;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;ct=n.lencode[h&(1<<n.lenbits)-1],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(D<16)h>>>=C,p-=C,n.lens[n.have++]=D;else{if(D===16){for(ue=C+2;p<ue;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(h>>>=C,p-=C,n.have===0){t.msg="invalid bit length repeat",n.mode=hi;break}j=n.lens[n.have-1],g=3+(3&h),h>>>=2,p-=2}else if(D===17){for(ue=C+3;p<ue;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=C,p-=C,j=0,g=3+(7&h),h>>>=3,p-=3}else{for(ue=C+7;p<ue;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=C,p-=C,j=0,g=11+(127&h),h>>>=7,p-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=hi;break}for(;g--;)n.lens[n.have++]=j}}if(n.mode===hi)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=hi;break}if(n.lenbits=9,At={bits:n.lenbits},Q=Jg(1,n.lens,0,n.nlen,n.lencode,0,n.work,At),n.lenbits=At.bits,Q){t.msg="invalid literal/lengths set",n.mode=hi;break}if(n.distbits=6,n.distcode=n.distdyn,At={bits:n.distbits},Q=Jg(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,At),n.distbits=At.bits,Q){t.msg="invalid distances set",n.mode=hi;break}if(n.mode=Zy,e===Xy)break t;case Zy:n.mode=$y;case $y:if(l>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,_W(t,_),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,n.mode===cl&&(n.back=-1);break}for(n.back=0;ct=n.lencode[h&(1<<n.lenbits)-1],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(N&&(240&N)==0){for(V=C,W=N,K=D;ct=n.lencode[K+((h&(1<<V+W)-1)>>V)],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(V+C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=V,p-=V,n.back+=V}if(h>>>=C,p-=C,n.back+=C,n.length=D,N===0){n.mode=16205;break}if(32&N){n.back=-1,n.mode=cl;break}if(64&N){t.msg="invalid literal/length code",n.mode=hi;break}n.extra=15&N,n.mode=16201;case 16201:if(n.extra){for(ue=n.extra;p<ue;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;ct=n.distcode[h&(1<<n.distbits)-1],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((240&N)==0){for(V=C,W=N,K=D;ct=n.distcode[K+((h&(1<<V+W)-1)>>V)],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(V+C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=V,p-=V,n.back+=V}if(h>>>=C,p-=C,n.back+=C,64&N){t.msg="invalid distance code",n.mode=hi;break}n.offset=D,n.extra=15&N,n.mode=16203;case 16203:if(n.extra){for(ue=n.extra;p<ue;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=hi;break}n.mode=16204;case 16204:if(d===0)break t;if(g=_-d,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=hi;break}g>n.wnext?(g-=n.wnext,I=n.wsize-g):I=n.wnext-g,g>n.length&&(g=n.length),y=n.window}else y=r,I=c-n.offset,g=n.length;g>d&&(g=d),d-=g,n.length-=g;do r[c++]=y[I++];while(--g);n.length===0&&(n.mode=$y);break;case 16205:if(d===0)break t;r[c++]=n.length,d--,n.mode=$y;break;case iw:if(n.wrap){for(;p<32;){if(l===0)break t;l--,h|=i[s++]<<p,p+=8}if(_-=d,t.total_out+=_,n.total+=_,4&n.wrap&&_&&(t.adler=n.check=tr(n)?lr(n.check,r,_,c-_):Gg(n.check,r,_,c-_)),_=d,4&n.wrap&&(tr(n)?h:Sx(h))!==n.check){t.msg="incorrect data check",n.mode=hi;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&tr(n)){for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=hi;break}h=0,p=0}n.mode=16208;case 16208:Q=vW;break t;case hi:Q=_x;break t;case 16210:return Ex;default:return vs}return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,(n.wsize||_!==t.avail_out&&n.mode<hi&&(n.mode<iw||e!==mx))&&Ax(t,t.output,t.next_out,_-t.avail_out),m-=t.avail_in,_-=t.avail_out,t.total_in+=m,t.total_out+=_,n.total+=_,4&n.wrap&&_&&(t.adler=n.check=tr(n)?lr(n.check,r,_,t.next_out-_):Gg(n.check,r,_,t.next_out-_)),t.data_type=n.bits+(n.last?64:0)+(n.mode===cl?128:0)+(n.mode===Zy||n.mode===nw?256:0),(m===0&&_===0||e===mx)&&Q===bh&&(Q=CW),Q},ll={inflateReset:Rx,inflateReset2:vx,inflateResetKeep:Tx,inflateInit:t=>yx(t,15),inflateInit2:yx,inflate:IW,inflateEnd:t=>{if(Ih(t))return vs;let e=t.state;return e.window&&(e.window=null),t.state=null,bh},inflateGetHeader:(t,e)=>{if(Ih(t))return vs;const n=t.state;return(2&n.wrap)==0?vs:(n.head=e,e.done=!1,bh)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,s;return Ih(t)?vs:(i=t.state,i.wrap!==0&&i.mode!==Qy?vs:i.mode===Qy&&(r=1,r=Gg(r,e,n,0),r!==i.check)?_x:(s=Ax(t,e,n,n),s?(i.mode=16210,Ex):(i.havedict=1,bh)))},inflateInfo:"pako inflate (from Nodeca project)"},OW=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const bx=Object.prototype.toString,{Z_NO_FLUSH:wW,Z_FINISH:NW,Z_OK:Qg,Z_STREAM_END:sw,Z_NEED_DICT:ow,Z_STREAM_ERROR:DW,Z_DATA_ERROR:Ix,Z_MEM_ERROR:LW}=jy;function tC(t){this.options=Wy.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new px,this.strm.avail_out=0;let n=ll.inflateInit2(this.strm,e.windowBits);if(n!==Qg)throw new Error(vh[n]);if(this.header=new OW,ll.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Xg.string2buf(e.dictionary):bx.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=ll.inflateSetDictionary(this.strm,e.dictionary),n!==Qg)))throw new Error(vh[n])}function PW(t,e){const n=new tC(e);if(n.push(t),n.err)throw n.msg||vh[n.err];return n.result}tC.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?NW:wW,bx.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=ll.inflate(n,c),s===ow&&r&&(s=ll.inflateSetDictionary(n,r),s===Qg?s=ll.inflate(n,c):s===Ix&&(s=ow));n.avail_in>0&&s===sw&&n.state.wrap>0&&t[n.next_in]!==0;)ll.inflateReset(n),s=ll.inflate(n,c);switch(s){case DW:case Ix:case ow:case LW:return this.onEnd(s),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||s===sw))if(this.options.to==="string"){let d=Xg.utf8border(n.output,n.next_out),h=n.next_out-d,p=Xg.buf2string(n.output,d);n.next_out=h,n.avail_out=i-h,h&&n.output.set(n.output.subarray(d,d+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==Qg||l!==0){if(s===sw)return s=ll.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},tC.prototype.onData=function(t){this.chunks.push(t)},tC.prototype.onEnd=function(t){t===Qg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Wy.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var kW={inflate:PW};const{deflate:MW}=mW,{inflate:UW}=kW;var xW=MW,VW=UW,Ox=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(Ox||{});class BW{constructor(){O(this,"_sequence",0),O(this,"_startTime",Date.now()),O(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const d={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;M("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),s=new DataView(i);let c=0;if(s.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,s.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const s={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,M("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(i,!0),i+=2,s.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let d=!1;if(l.datas.length>0){const h=l.datas.find(p=>p.id===0);h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}c=d?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,s=new ArrayBuffer(i+2),c=new Uint8Array(s),l=new DataView(s);let d=0;if(l.setUint8(d++,n),l.setUint8(d++,i),r.forEach(h=>{n?(l.setUint8(d++,h.id),l.setUint8(d++,h.length),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(l.setUint8(d++,h.id|h.length<<4),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength)}),d!==i+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(i+2));return s}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const s=n.getUint8(i);i++;const c=r===Ox.TWO_BYTE,l=[],d=new DataView(e,2);let h=0;for(;h<s;){let p=0,m=0,_=new ArrayBuffer(0);c?(p=d.getUint8(h),h++,m=d.getUint8(h),h++):(p=15&d.getUint8(h),m=d.getUint8(h)>>4,h++),m>0&&(_=d.buffer.slice(h+2,h+2+m),h+=_.byteLength),l.push({id:p,length:m,data:_})}if(h!==s)throw Error("parse error");return{profile:r,length:s,datas:l}}decompress(e){return VW(new Uint8Array(e))}compress(e){return xW(new Uint8Array(e))}}const FW={name:"DataStream",create:(t,e)=>{const n=e?new z5(t):new q5(t);return n.useDataStream(new BW),n}};class jW extends hn{constructor(e,n,i){super(),O(this,"ws",void 0),O(this,"requestId",1),O(this,"heartBeatTimer",void 0),O(this,"joinInfo",void 0),O(this,"clientId",void 0),O(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),O(this,"onClose",r=>{this.emit("close"),this.dispose()}),O(this,"onMessage",r=>{const s=JSON.parse(r.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=n,this.ws=new yg("cross-channel-".concat(this.clientId),i),this.ws.on($t.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on($t.CONNECTED,this.onOpen),this.ws.on($t.ON_MESSAGE,this.onMessage),this.ws.on($t.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new Tt((n,i)=>{const r=window.setTimeout(()=>{i(new z(L.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(r),s.state&&s.state!==0?i(new z(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new z(L.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new z(L.WS_DISCONNECT);const n=()=>new Tt((c,l)=>{this.ws.once($t.CLOSED,()=>l(new z(L.WS_ABORT))),this.ws.once($t.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new Tt((c,l)=>{const d=()=>{l(new z(L.WS_ABORT))};this.ws.once($t.RECONNECTING,d),this.ws.once($t.CLOSED,d),this.once("req_".concat(i),c),gi(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off($t.RECONNECTING,d),this.ws.off($t.CLOSED,d),l(new z(L.TIMEOUT,"cross channel ws request timeout"))})}),s=await r;if(!s||s.code!==200)throw new z(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners($t.REQUEST_NEW_URLS),this.ws.on($t.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class GW extends hn{set state(e){e!==this._state&&(e!==Ur.RELAY_STATE_FAILURE&&(this.errorCode=rm.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,s){super(),O(this,"joinInfo",void 0),O(this,"sid",void 0),O(this,"clientId",void 0),O(this,"cancelToken",_r.CancelToken.source()),O(this,"workerToken",void 0),O(this,"requestId",0),O(this,"signal",void 0),O(this,"prevChannelMediaConfig",void 0),O(this,"httpRetryConfig",void 0),O(this,"_resolution",void 0),O(this,"_state",Ur.RELAY_STATE_IDLE),O(this,"errorCode",rm.RELAY_OK),O(this,"onStatus",c=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",nl.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",nl.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=rm.SRC_TOKEN_EXPIRED,this.state=Ur.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=rm.DEST_TOKEN_EXPIRED,this.state=Ur.RELAY_STATE_FAILURE))}),O(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",nl.NETWORK_DISCONNECTED),this.state=Ur.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Ur.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",c.toString()),this.errorCode=rm.SERVER_CONNECTION_LOST,this.state=Ur.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=ah(),this.signal=new jW(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==Ur.RELAY_STATE_IDLE)throw new z(L.INVALID_OPERATION);this.state=Ur.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new z(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new z(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new z(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Ur.RELAY_STATE_RUNNING)throw new z(L.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Ur.RELAY_STATE_RUNNING)throw new z(L.INVALID_OPERATION);const n=this.genMessage(cr.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ur.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=_r.CancelToken.source(),this.state=Ur.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await ZH(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",nl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(cr.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(cr.SetSdkProfile,e);await this.signal.request(i),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(cr.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",nl.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(cr.SetSourceUserId,e);await this.signal.request(s),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(cr.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",nl.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(cr.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",nl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ur.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(cr.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",nl.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(cr.StopPacketTransfer);await this.signal.request(e),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],s=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ua,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.2"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(e){case cr.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case cr.SetSourceChannel:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new z(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case cr.SetSourceUserId:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new z(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case cr.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new z(L.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:s},c;case cr.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case cr.Reconnect:return c.clientRequest={command:"Reconnect"},c;case cr.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case cr.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new z(L.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:s},c;case cr.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const HW={name:"ChannelMediaRelay",create:function(t){return new GW(t.joinInfo,t.clientId,t.websocketRetryConfig||Wn,t.httpRetryConfig||Wn,t.resolution)}};function wx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Zg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wx(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class WW extends hn{constructor(e,n,i,r){super(),O(this,"spec",void 0),O(this,"token",void 0),O(this,"websocket",void 0),O(this,"pingpongTimer",void 0),O(this,"reconnectMode","retry"),O(this,"serviceMode",void 0),O(this,"reqId",0),O(this,"commandReqId",0),O(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),O(this,"handleWebSocketMessage",s=>{if(!s.data)return;const c=JSON.parse(s.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(Mt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===el.TRANSCODE?1:2}),this.emit(Su.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new yg("live-streaming",i),this.websocket.on($t.CONNECTED,this.handleWebSocketOpen),this.websocket.on($t.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on($t.REQUEST_NEW_URLS,(s,c)=>{wi(this,Su.REQUEST_NEW_ADDRESS).then(s).catch(c)}),this.websocket.on($t.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const s=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new z(L.UNEXPECTED_ERROR);const l=Zg({command:e,sdkVersion:Ua==="4.23.2"?"0.0.1":Ua,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new z(L.WS_DISCONNECT);const d=()=>new Tt((_,g)=>{this.websocket.once($t.CLOSED,()=>g(new z(L.WS_ABORT))),this.websocket.once($t.CONNECTED,_)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const h=new Tt((_,g)=>{const I=()=>{g(new z(L.WS_ABORT))};this.websocket.once($t.RECONNECTING,I),this.websocket.once($t.CLOSED,I),this.once("@".concat(c,"-").concat(this.spec.sid),y=>{_(y)})});r&&Mt.workerEvent(this.spec.sid,Zg(Zg({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await h}catch(_){if(this.websocket.state==="closed")throw _;return await d(),await this.request(e,n,i)}return r&&Mt.workerEvent(this.spec.sid,Zg(Zg({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-p})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=Ua==="4.23.2"?"0.0.1":Ua;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Xn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case Xn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Xn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Xn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new z(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new z(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new z(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Su.WARNING,n,e.serverResponse.url)}case Xn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new z(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Su.WARNING,n,e.serverResponse.url)}case Xn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new z(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new z(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Su.WARNING,n,e.serverResponse.url)}case Xn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Xn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xn.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new z(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(jv)},6e3)}}function Nx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function xr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Nx(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class KW extends hn{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Wn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wn;super(),O(this,"onLiveStreamWarning",void 0),O(this,"onLiveStreamError",void 0),O(this,"spec",void 0),O(this,"retryTimeout",1e4),O(this,"connection",void 0),O(this,"httpRetryConfig",void 0),O(this,"wsRetryConfig",void 0),O(this,"streamingTasks",new Map),O(this,"isStartingStreamingTask",!1),O(this,"taskMutex",new Ui("live-streaming")),O(this,"cancelToken",_r.CancelToken.source()),O(this,"transcodingConfig",void 0),O(this,"uapResponse",void 0),O(this,"lastTaskId",1),O(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=xr(xr({},DH),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>xr(xr(xr({},NH),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){_n(c.width)||Ve(c.width,"config.width",0,1e4),_n(c.height)||Ve(c.height,"config.height",0,1e4),_n(c.videoBitrate)||Ve(c.videoBitrate,"config.videoBitrate",1,1e6),_n(c.videoFrameRate)||Ve(c.videoFrameRate,"config.videoFrameRate"),_n(c.lowLatency)||Qc(c.lowLatency,"config.lowLatency"),_n(c.audioSampleRate)||Zn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),_n(c.audioBitrate)||Ve(c.audioBitrate,"config.audioBitrate",1,128),_n(c.audioChannels)||Zn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),_n(c.videoGop)||Ve(c.videoGop,"config.videoGop"),_n(c.videoCodecProfile)||Zn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),_n(c.userCount)||Ve(c.userCount,"config.userCount",0,17),_n(c.backgroundColor)||Ve(c.backgroundColor,"config.backgroundColor",0,16777215),_n(c.userConfigExtraInfo)||Ei(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!_n(c.transcodingUsers)&&(Zc(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{dy(l.uid),_n(l.x)||Ve(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),_n(l.y)||Ve(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),_n(l.width)||Ve(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),_n(l.height)||Ve(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),_n(l.zOrder)||Ve(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),_n(l.alpha)||Ve(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),_n(c.watermark)||lO(c.watermark,"watermark"),_n(c.backgroundImage)||lO(c.backgroundImage,"backgroundImage"),c.images&&!_n(c.images)&&(Zc(c.images,"config.images"),c.images.forEach((l,d)=>{lO(l,"images[".concat(d,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>xr(xr(xr({},cO),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(xr(xr(xr({},cO),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(xr(xr(xr({},cO),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>xr({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?Tt.resolve(c.uid):Z1(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Tt.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var s;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Lr(s=this.streamingTasks).call(s)).map(l=>l.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===el.TRANSCODE)throw new z(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&i)return void s();if(this.streamingTasks.get(e)&&!i)return s(),new z(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw s(),l}switch(n){case el.TRANSCODE:r.transcodingConfig=xr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new Tt((h,p)=>{gi(this.retryTimeout).then(()=>{if(i)return p(i);const m=this.statusError.get(e);return m?(this.statusError.delete(e),p(m)):void 0})}),d=await Tt.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===el.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),s()}catch(l){if(s(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new Tt((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new z(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=r.mode;r.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:s===el.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(Lr(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=_r.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new z(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await wi(this,uO.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new WW(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Su.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(Su.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Su.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new z(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));wi(this,uO.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,i(s.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case Xn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new z(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return T.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Xn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new z(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Xn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Lr(s=this.streamingTasks).call(s));for(const l of c)l.abortTask?l.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{T.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const YW={name:"LiveStreaming",create:function(t){return new KW(t.joinInfo,t.websocketRetryConfig||Wn,t.httpRetryConfig||Wn)}};function zW(t){let e=Px();return function(n,i){let r=n.appId;r!==void 0&&(De(i,10),dc(i,r));let s=n.cid;s!==void 0&&(De(i,16),De(i,s));let c=n.cname;c!==void 0&&(De(i,26),dc(i,c));let l=n.deviceId;l!==void 0&&(De(i,34),dc(i,l));let d=n.elapse;d!==void 0&&(De(i,40),Pu(i,d));let h=n.fileSize;h!==void 0&&(De(i,48),Pu(i,Rm(h)));let p=n.height;p!==void 0&&(De(i,56),Pu(i,Rm(p)));let m=n.jpg;m!==void 0&&(De(i,66),De(i,m.length),function(vr,nt){let ft=vm(vr,nt.length);vr.bytes.set(nt,ft)}(i,m));let _=n.networkType;_!==void 0&&(De(i,72),Pu(i,Rm(_)));let g=n.osType;g!==void 0&&(De(i,80),Pu(i,Rm(g)));let I=n.requestId;I!==void 0&&(De(i,90),dc(i,I));let y=n.sdkVersion;y!==void 0&&(De(i,98),dc(i,y));let C=n.sequence;C!==void 0&&(De(i,104),Pu(i,Rm(C)));let N=n.sid;N!==void 0&&(De(i,114),dc(i,N));let D=n.timestamp;D!==void 0&&(De(i,120),Pu(i,D));let V=n.uid;V!==void 0&&(De(i,128),De(i,V));let W=n.vid;W!==void 0&&(De(i,136),De(i,W));let K=n.width;K!==void 0&&(De(i,144),Pu(i,Rm(K)));let j=n.service;j!==void 0&&(De(i,152),De(i,j));let Q=n.callbackData;Q!==void 0&&(De(i,162),dc(i,Q));let ct=n.jpgEncryption;ct!==void 0&&(De(i,168),De(i,ct));let vt=n.requestType;vt!==void 0&&(De(i,176),De(i,vt));let At=n.scorePorn;At!==void 0&&(De(i,185),hw(i,At));let ue=n.scoreSexy;ue!==void 0&&(De(i,193),hw(i,ue));let de=n.scoreNeutral;de!==void 0&&(De(i,201),hw(i,de));let qe=n.scene;qe!==void 0&&(De(i,208),De(i,qe));let Pn=n.ossFilePrefix;Pn!==void 0&&(De(i,218),dc(i,Pn));let yn=n.serviceVendor;if(yn!==void 0)for(let vr of yn){De(i,226);let nt=Px();JW(vr,nt),De(i,nt.limit),t8(i,nt),$W(nt)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function qW(t){return function(n){let i={};t:for(;!kx(n);){let r=hc(n);switch(r>>>3){case 0:break t;case 1:i.code=hc(n);break;case 2:i.msg=Mx(n,hc(n));break;case 3:{let s=QW(n);i.data=XW(n),n.limit=s;break}default:Dx(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function XW(t){let e={};t:for(;!kx(t);){let n=hc(t);switch(n>>>3){case 0:break t;case 1:e.requestId=Mx(t,hc(t));break;case 2:e.requestType=hc(t)>>>0;break;case 3:e.scorePorn=dw(t);break;case 4:e.scoreSexy=dw(t);break;case 5:e.scoreNeutral=dw(t);break;case 6:e.requestScene=hc(t)>>>0;break;case 7:e.scene=hc(t)>>>0;break;default:Dx(t,7&n)}}return e}function JW(t,e){let n=t.service;n!==void 0&&(De(e,8),De(e,n));let i=t.vendor;i!==void 0&&(De(e,16),De(e,i));let r=t.token;r!==void 0&&(De(e,26),dc(e,r));let s=t.callbackUrl;s!==void 0&&(De(e,34),dc(e,s))}function QW(t){let e=hc(t),n=t.limit;return t.limit=t.offset+e,n}function Dx(t,e){switch(e){case 0:for(;128&Ux(t););break;case 2:lw(t,hc(t));break;case 5:lw(t,4);break;case 1:lw(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let ZW=new Float32Array(1);new Uint8Array(ZW.buffer);let cw=new Float64Array(1),Vr=new Uint8Array(cw.buffer);function Rm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Lx=[];function Px(){const t=Lx.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function $W(t){Lx.push(t)}function lw(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function kx(t){return t.offset>=t.limit}function vm(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function uw(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function Mx(t,e){let n=uw(t,e),i=String.fromCharCode,r=t.bytes,s="�",c="";for(let l=0;l<e;l++){let d,h,p,m,_=r[l+n];(128&_)==0?c+=i(_):(224&_)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(m=(31&_)<<6|63&d,m<128?c+=s:(c+=i(m),l++))):(240&_)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(m=(15&_)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=s:(c+=i(m),l+=2))):(248&_)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(m=(7&_)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=s:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=s}return c}function dc(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}De(t,i);let r=vm(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function t8(t,e){let n=vm(t,e.limit),i=t.bytes,r=e.bytes;for(let s=0,c=e.limit;s<c;s++)i[s+n]=r[s]}function Ux(t){return t.bytes[uw(t,1)]}function xx(t,e){let n=vm(t,1);t.bytes[n]=e}function dw(t){let e=uw(t,8),n=t.bytes;return Vr[0]=n[e++],Vr[1]=n[e++],Vr[2]=n[e++],Vr[3]=n[e++],Vr[4]=n[e++],Vr[5]=n[e++],Vr[6]=n[e++],Vr[7]=n[e++],cw[0]}function hw(t,e){let n=vm(t,8),i=t.bytes;cw[0]=e,i[n++]=Vr[0],i[n++]=Vr[1],i[n++]=Vr[2],i[n++]=Vr[3],i[n++]=Vr[4],i[n++]=Vr[5],i[n++]=Vr[6],i[n++]=Vr[7]}function hc(t){let e,n=0,i=0;do e=Ux(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function De(t,e){for(e>>>=0;e>=128;)xx(t,127&e|128),e>>>=7;xx(t,e)}function Pu(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=vm(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}function Vx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const e8=new Map([["moderation",1],["supervise",2]]);class n8 extends hn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(di.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=nr(n=e.map(i=>e8.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),O(this,"name","AgoraRTCVideoContentInspect"),O(this,"_connectionState",_s.CONNECTING),O(this,"_innerConnectionState",void 0),O(this,"sequence",0),O(this,"inspectStartTime",void 0),O(this,"workerManagerConnection",void 0),O(this,"workerConnection",void 0),O(this,"workerMessageLengthLimit",void 0),O(this,"inspectIntervalMinimum",void 0),O(this,"qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",_r.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"wmSequence",0),O(this,"inspectInterval",void 0),O(this,"inspectTimer",null),O(this,"ossFilePrefix",void 0),O(this,"extraInfo",void 0),O(this,"_inspectType",void 0),O(this,"_inspectMode",void 0),O(this,"_quality",1),O(this,"qualityTimer",null),O(this,"_inspectId",void 0),O(this,"_needWorkUrlOnly",!1),O(this,"inspectImage",()=>{if(this.connectionState!==_s.CONNECTED)throw new z(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===_s.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ye(5,"inspect-"),this.workerMessageLengthLimit=M("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=M("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=M("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new yg("worker-manager-"+this._inspectId,Wn),this.on(di.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Es[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new yg("worker-"+this._inspectId,Wn),this.handleWorkerEvents()}async init(e,n){this.emit(di.STATE_CHANGE,Es.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Tt((r,s)=>{this.on(di.CONNECTION_STATE_CHANGE,(c,l)=>{l===_s.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{s(c)})})}async requestAP(e,n,i){const r=M("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,d,h,p){let{appId:m,areaCode:_,cname:g,sid:I,token:y,uid:C}=d;dm++;const N="image_moderation_api",D={service_name:N,json_body:JSON.stringify({appId:m,areaCode:_,cname:g,command:"allocateEdge",requestId:dm,seq:dm,sid:I,token:y,ts:Date.now(),uid:C+""})};let V,W,K=l[0];return to(async()=>{V=Date.now();const j=await ao(K,{data:D,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-V,j.code!==0){const At=new z(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+j.code,{retry:!0,responseTime:W});throw T.error(At.toString()),At}const Q=JSON.parse(j.json_body);if(Q.code!==200){const At=new z(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:W});throw T.error(At.toString()),At}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){const At=new z(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Q.code,responseTime:W});throw T.error(At.toString()),At}const ct=M("VIDEO_INSPECT_WORKER_MANAGER_HOST"),vt=M("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Q.servers.map(At=>{let{address:ue,wss:de}=At;if(ue&&de)return"wss://".concat(ue.replace(/\./g,"-"),".").concat(ct,":").concat(vt||de)}).filter(At=>!!At),workerToken:Q.workerToken,vid:Q.vid,responseTime:W}},(j,Q)=>(Mt.apworkerEvent(I,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(j.addressList),firstSuccess:Q===0,responseTime:W,serverIp:l[Q%l.length]}),!1),(j,Q)=>(Mt.apworkerEvent(I,{success:!1,sc:j.data&&j.data.code||200,serviceName:N,responseTime:W,serverIp:l[Q%l.length]}),!!(j.code!==L.OPERATION_ABORTED&&j.code!==L.UNEXPECTED_RESPONSE||j.data&&j.data.retry)&&(K=l[(Q+1)%l.length],!0)),p)}(r,e,n,i);this.emit(di.STATE_CHANGE,Es.AP_CONNECTED);const{addressList:c}=s;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(di.STATE_CHANGE,Es.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on($t.CONNECTED,async()=>{this.emit(di.STATE_CHANGE,Es.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on($t.CLOSED,()=>{this._innerConnectionState<Es.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on($t.FAILED,()=>{this._innerConnectionState<Es.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on($t.RECONNECTING,()=>{this._innerConnectionState<Es.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on($t.ON_MESSAGE,async e=>{this.emit(di.STATE_CHANGE,Es.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new z(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new z(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=M("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(r));this.emit(di.STATE_CHANGE,Es.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(di.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on($t.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on($t.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on($t.CONNECTED,async()=>{this.emit(di.STATE_CHANGE,Es.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=_s.CONNECTED}),this.workerConnection.on($t.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=qW(new Uint8Array(e.data));if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(di.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},s=nr(n=Object.keys(r)).call(n,(l,d)=>r[l]>r[d]?l:d,"porn"),c=Object.keys(r).find(l=>l===s);this.emit(di.INSPECT_RESULT,c)}else this.emit(di.INSPECT_RESULT,void 0,new z(L.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(di.INSPECT_RESULT,void 0,new z(L.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(di.INSPECT_RESULT,void 0,new z(L.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on($t.CLOSED,()=>{this.connectionState=_s.CLOSED}),this.workerConnection.on($t.FAILED,()=>{this.connectionState=_s.CLOSED}),this.workerConnection.on($t.RECONNECTING,()=>{this.connectionState=this.connectionState===_s.CONNECTED?_s.RECONNECTING:_s.CONNECTING}),this.workerConnection.on($t.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on($t.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(di.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=ca(this,di.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(di.INSPECT_RESULT,void 0,new z(L.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(di.INSPECT_RESULT,void 0,new z(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await Sk(p,i,r),_=this.sequence+"-"+s+"-"+d+"-"+h+"-"+Ye(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:(I=Number(h-this.inspectStartTime),{low:I|=0,high:I>>31,unsigned:I>=0}),fileSize:m.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:_,sdkVersion:"4.23.2",sequence:this.sequence,sid:l,timestamp:YU(h),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var I;this.extraInfo===void 0&&delete g.callbackData,this.ossFilePrefix===void 0&&delete g.ossFilePrefix;const y=zW(g);if(y.byteLength<this.workerMessageLengthLimit){if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const C=function(N){for(var D=1;D<arguments.length;D++){var V=arguments[D]!=null?arguments[D]:{};D%2?Vx(Object(V),!0).forEach(function(W){O(N,W,V[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(V)):Vx(Object(V)).forEach(function(W){Object.defineProperty(N,W,Object.getOwnPropertyDescriptor(V,W))})}return N}({},g);delete C.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(C))}return y}{const C=this.quality*this.qualityRatio;return this.quality=C,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=_r.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=_s.CLOSED,this.emit(di.STATE_CHANGE,Es.CLOSED)}}const i8={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new z(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new z(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var s;if(!_t(s=["supervise","moderation"]).call(s,r))throw new z(L.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new z(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new n8(e)}};var Bx=P(Wr.Object.getOwnPropertySymbols),r8=Ne,a8=Ac.indexOf,s8=fr,pw=oi([].indexOf),Fx=!!pw&&1/pw([1],1,-0)<0;r8({target:"Array",proto:!0,forced:Fx||!s8("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return Fx?pw(this,t,e)||0:a8(this,t,e)}});var o8=hr("Array").indexOf,c8=mt,l8=o8,fw=Array.prototype,u8=function(t){var e=t.indexOf;return t===fw||c8(fw,t)&&e===fw.indexOf?l8:e},jx=P(u8);function d8(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var d,h,p={},m=o1(c);for(h=0;h<m.length;h++)d=m[h],jx(l).call(l,d)>=0||(p[d]=c[d]);return p}(t,e);if(Bx){var s=Bx(t);for(i=0;i<s.length;i++)n=s[i],jx(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let Gx=class{get localCapabilities(){return gn(this._localCapabilities)}get rtpCapabilities(){return gn(this._rtpCapabilities)}get candidates(){return gn(this._candidates)}get iceParameters(){return gn(this._iceParameters)}get dtlsParameters(){return gn(this._dtlsParameters)}constructor(t){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname","o/i14u9pJrxRKAsu"),O(this,"firefoxSsrcMidMap",new Map),t=gn(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:s,direction:c,setup:l,videoCodec:d,audioCodec:h}=t;let p;this.setup=l,p=c===or.RECEIVE_ONLY?Mr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Mr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=s;const m=c===or.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=c===or.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,g=c===or.RECEIVE_ONLY?r.send.videoCodecs:bg(It.VIDEO,m,_,d),I=c===or.RECEIVE_ONLY?r.send.audioCodecs:bg(It.AUDIO,m,_,h);for(const y of p.mediaDescriptions)y.attributes.iceUfrag=e.iceUfrag,y.attributes.icePwd=e.icePwd,y.attributes.fingerprints=n.fingerprints,y.attributes.candidates=i,y.attributes.setup=this.setup,y.media.mediaType==="application"&&(y.attributes.sctpPort="5000"),y.media.mediaType==="video"&&(y.media.fmts=g.map(C=>C.payloadType.toString(10)),y.attributes.payloads=g,y.attributes.extmaps=m.videoExtensions),y.media.mediaType==="audio"&&(y.media.fmts=I.map(C=>C.payloadType.toString(10)),y.attributes.payloads=I,y.attributes.extmaps=m.audioExtensions,um(y));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return gu(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:c}=fh(e,this.cname,M("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(s);if(l){if(mn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(t,s,i);let h;return d===-1?(h=this.createOrRecycleSendMedia(t,s,c,"sendonly",i,r),this.updateBundleMids()):(h=gn(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,r)),mn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const s=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s);let l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=gn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:d})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:s,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(t),h={foundation:e??"",componentId:"1",transport:n??"",priority:d?d+"":"",connectionAddress:i??"",port:r?r+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const s=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=bg(s,c,this.localCapabilities.send,s===It.AUDIO?r:i),d=s===It.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,t);const m=this.findFirstClosedMedia(s);if(m){const _=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[_]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>_t(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>_t(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(mn()){if(r){const s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!s||s!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=gn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,s){const c=this.rtpCapabilities.send,l=t===It.VIDEO?c.videoCodecs:c.audioCodecs,d=t===It.VIDEO?c.videoExtensions:c.audioExtensions;mn()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,s);const p=this.findFirstClosedMedia(t);if(p){const m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(t,e,n){const i=gn(t);return mO(i),lm(i,e),_O(i,e),L1(i),gy(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=gn(t);return gy(n,e,this.localCapabilities.recv),um(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>mn()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const h8=["sdp"];var Je;function Hx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ku(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Hx(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Hx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Wx=(Je=class ym extends p1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),O(this,"direction",void 0),O(this,"name",void 0),O(this,"store",void 0),O(this,"spec",void 0),O(this,"peerConnection",void 0),O(this,"initialOffer",void 0),O(this,"transport",void 0),O(this,"statsFilter",void 0),O(this,"localCandidateCount",0),O(this,"_isInRestartIce",!1),O(this,"mutex",void 0),O(this,"onLocalCandidate",void 0),O(this,"remoteSDP",void 0),O(this,"pendingCandidates",[]),O(this,"localCapabilities",void 0),O(this,"isReady",!1),O(this,"restartCnt",0),O(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new Ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(ym.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??or.SEND_ONLY,this.name=this.direction===or.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=wI(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,mn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await k1();if(this.localCapabilities=Sy(n),e){const{sdp:i}=e,r=d8(e,h8),s=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=Ag(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(gs(m,p,"videoExtensions",_,g,I),gs(m,p,"videoCodecs",_,g,I),gs(m,p,"audioExtensions",_,g,I),gs(m,p,"audioCodecs",_,g,I),M("RAISE_H264_BASELINE_PRIORITY")){const y=I.videoCodecs.findIndex(C=>C.rtpMap&&C.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&C.fmtp&&C.fmtp.parameters["profile-level-id"]==="42001f");if(y!==-1){const C=I.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(C<y){T.debug("raising H264 baseline profile priority");const N=I.videoCodecs[y];I.videoCodecs.splice(y,1),I.videoCodecs.splice(C,0,N)}C!==-1&&M("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(N=>!(N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_,recv:g,sendrecv:I}}({},{},i);this.remoteSDP=new Gx({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=yu(c.sdp);await this.peerConnection.setLocalDescription(c);const d=await M1({},{},c.sdp);this.localCapabilities=Sy(d);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),ku(ku({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=yu(i.sdp);return this.initialOffer=i,ku(ku({},r),{},{sdp:i.sdp})}}catch(n){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,s=await M1({},{},n);this.remoteSDP=new Gx({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new $(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Ma(function*(){const s=yield Ee(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((C,N)=>{if(l[N].needCreateTransceiver){const D=r.peerConnection.addTransceiver(C._mediaStreamTrack,{direction:"sendonly"});c.push(D),C._updateRtpTransceiver(D)}else{const D=r.peerConnection.getTransceivers().find(V=>V.mid===l[N].mid);if(!D)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[N].mid));c.push(D),C._updateRtpTransceiver(D)}}),mn()&&M("SIMULCAST")===!0&&(yield Ee(r.applySimulcastForFirefox(c,e)));const d=l.map(C=>C.mid),h=yield Ee(r.peerConnection.createOffer()),p=r.mungSendOfferSDP(h.sdp,e,d),m=Mr(p),_=d.map(C=>{const N=m.mediaDescriptions.find(D=>D.attributes.mid===C);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return w1(N,M("USE_PUB_RTX"))}),g=c.map((C,N)=>{const D=d[N];return{localSSRC:_[N],id:D}});yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield g}catch(C){const N=r.remoteSDP.toString();throw yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield Ee(r.stopSending(d,!0)),C}yield Ee(r.applySimulcastEncodings(c,e)),yield Ee(r.applySendEncodings(c,e));const I=r.remoteSDP.toString(),y=r.logSDPExchange(p,"offer","local","send");return y==null||y(I),yield Ee(r.setRemoteDescription({type:"answer",sdp:I})),c.map((C,N)=>{const D=d[N];return{localSSRC:_[N],id:D}})}catch(c){throw c instanceof $?c:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,e);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,e);d==null||d(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===sh.Auto&&(this.store.p2pTransport=sh.SdRtn,Re().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ym.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Re().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ym.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=yu(n.sdp);return this.store.descriptionStart(),this.direction===or.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===or.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=yu(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?mn()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:ku(ku({},Zo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ku(ku({},Zo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;_t(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var s;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(hg(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...ym.turnServerConfigToIceServers(e.turnServer.servers,n,i)),M("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...ym.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),_t(s=[sh.Relay,sh.SdRtn]).call(s,n)&&(r.iceTransportPolicy="relay"),M("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&Re().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],s=e.filter(l=>l.tcpport);T.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(i));const c=s.length>i?s[i]:s[0];switch(n){case sh.SdRtn:const l=e.filter(h=>{var p;return _t(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),d=l.length>i?l[i]:l[0];d&&(r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(Ru(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Ru(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case sh.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Ru(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Ru(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Re().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},s={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:p,frameRate:m,scaleResolutionDownBy:_}=e._encoderConfig;p&&(s.maxBitrate=1e3*p),_t(c=e._hints).call(c,ze.LOW_STREAM)&&(m&&(s.maxFramerate=$r(m)),_&&_>=1&&(s.scaleResolutionDownBy=_))}if(M("DSCP_TYPE")&&Jc()){var l;const p=M("DSCP_TYPE");_t(l=["very-low","low","medium","high"]).call(l,p)&&(s.networkPriority=p)}const d=n.getParameters(),h=(i=d.encodings)===null||i===void 0?void 0:i[0];mn()&&!h&&(r.encodings=[s]),h&&Object.assign(h,s),Object.assign(d,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(e,n){try{if(!Re().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof nn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Mr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(lm(d,s),P1(d,s,this.store.codec))}),gu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof nn&&!_t(i=p._hints).call(i,ze.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},_={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,m))}}}async applySimulcastEncodings(e,n){if(!mn()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof nn&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof nn&&M("SIMULCAST")&&this.store.codec==="vp8"&&!_t(n=e._hints).call(n,ze.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(M("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var s;const c=(s=Mr(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||s===void 0?void 0:s.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),_t(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=Mr(e),s=r.mediaDescriptions.find(c=>c.attributes.mid===n);return s&&i===It.AUDIO&&s.media.mediaType==="audio"&&um(s),gu(r)}},Lt(Je.prototype,"establish",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"establish"),Je.prototype),Lt(Je.prototype,"connect",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"connect"),Je.prototype),Lt(Je.prototype,"receive",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"receive"),Je.prototype),Lt(Je.prototype,"mockReceive",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"mockReceive"),Je.prototype),Lt(Je.prototype,"stopReceiving",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"stopReceiving"),Je.prototype),Lt(Je.prototype,"restartICE",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"restartICE"),Je.prototype),Lt(Je.prototype,"close",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"close"),Je.prototype),Lt(Je.prototype,"updateEncoderConfig",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"updateEncoderConfig"),Je.prototype),Lt(Je.prototype,"updateSendParameters",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"updateSendParameters"),Je.prototype),Lt(Je.prototype,"replaceTrack",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"replaceTrack"),Je.prototype),Lt(Je.prototype,"muteLocal",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"muteLocal"),Je.prototype),Lt(Je.prototype,"unmuteLocal",[ys],Object.getOwnPropertyDescriptor(Je.prototype,"unmuteLocal"),Je.prototype),Je);function ys(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}let oo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var Kx,Yx,zx,qx,Xx,Jx,Qx,Zx,$x,tV,eV,un;function nV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function eC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let p8=(Kx=co(oo.SEND_ONLY),Yx=co(oo.SEND_ONLY),zx=co(),qx=co(oo.RECEIVE_ONLY),Xx=co(oo.RECEIVE_ONLY),Jx=co(oo.RECEIVE_ONLY),Qx=co(oo.RECEIVE_ONLY),Zx=co(oo.RECEIVE_ONLY),$x=co(oo.RECEIVE_ONLY),tV=co(),eV=co(oo.RECEIVE_ONLY),un=class extends hn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Ft.StateChange,e,this._state)}constructor(t,e){super(),O(this,"isPlanB",!1),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"sendConnection",void 0),O(this,"recvConnection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"statsCollector",void 0),O(this,"dtlsFailedCount",0),O(this,"sendMutex",void 0),O(this,"recvMutex",void 0),O(this,"_state",Oe.Disconnected),O(this,"_restartStates",["disconnected","failed"]),O(this,"reconnectInterval",void 0),O(this,"uploadUnplinkStarted",!1),O(this,"uploadDownlinkStarted",!1),O(this,"uplinkStateUploadInterval",void 0),O(this,"downlinkStatsUploadInterval",void 0),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(g=>g[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(g=>{let[,{id:I}]=g;return I}));let p=!1;var c,l;n.trackMediaType==="video"?p=!((c=this.localTrackMap.get(st.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(st.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const m=this.createMuteMessage(d);await Ke(this,Ft.RequestMuteLocal,m);const _=n.trackMediaType==="video"?Tu.MUTE_LOCAL_VIDEO:Tu.MUTE_LOCAL_AUDIO;await Ke(this,Ft.RequestP2PMuteLocal,{action:_,message:m,isMuteAll:p}),i()}catch(d){r(d)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(c),d=n.trackMediaType==="video"?Tu.UNMUTE_LOCAL_VIDEO:Tu.UNMUTE_LOCAL_AUDIO;await Ke(this,Ft.RequestP2PMuteLocal,{action:d,message:l}),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;typeof s=="boolean"&&s||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(st.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==Oe.Connected)return void i();const{id:h,track:p}=d;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(Ft.UpdateVideoEncoder,p)),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(st.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==Oe.Connected)return void i();const{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Oe.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),h[0]===st.LocalVideoTrack&&Re().supportDualStreamEncoding){const p=this.localTrackMap.get(st.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new Tt((_,g)=>{this.handleReplaceTrack(p.track,_,g,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new TU(t),this.bindStatsUploaderEvents(),this.sendMutex=new Ui("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Ui("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},M("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new $(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Wx(t,this.store,or.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Oe.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Wx(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Oe.Connected}async addRemoteCandidate(t,e){if(e===or.RECEIVE_ONLY){if(!this.sendConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return Ma(function*(){const r=yield Ee(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Oe.Connected){i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(h))}i.store.pubId=i.store.pubId+1,Bi.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield Ee(i.tryToUnmuteAudio(t)));s.forEach(h=>{let{track:p,type:m}=h;const _=Date.now();i.store.publish(p.getTrackId(),m===st.LocalAudioTrack?"audio":"video",_)}),i.bindLocalTrackEvents(s);const c=yield Ee(i.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),i.store.codec,i.store.audioCodec)),l=(yield Ee(c.next())).value,d=i.createGatewayPublishMessage(s,l);try{yield d}catch(h){throw c.throw(h),(h==null?void 0:h.code)===L.WS_ABORT&&s.forEach(p=>{let{track:m}=p;i.pendingLocalTracks.indexOf(m)===-1&&i.pendingLocalTracks.push(m)}),i.unbindLocalTrackEvents(s),h}yield Ee(c.next()),s.forEach(h=>{let{type:p}=h;i.statsCollector.addLocalStats(p)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(s,l),s.forEach(h=>{let{track:p,type:m}=h;const _=Date.now();i.store.publish(p.getTrackId(),m===st.LocalAudioTrack?"audio":"video",void 0,_)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Oe.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!_t(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[s,{track:c}]=r;return{type:s,track:c}})),e.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Oe.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:s,ssrcs:c}]=i;const l={stream_type:r6(s,r),ssrcs:c};s._muted||!s._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{Ke(this,Ft.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Ke(this,Ft.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Ma(function*(){throw new $(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await wi(this,Ft.RequestRePublish,this.pendingLocalTracks),this.emit(Ft.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new $(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===It.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new em(s,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new tm(s,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const d=this.remoteUserMap.get(t);d?d.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:_}=p;return m.uid===t.uid&&e===_});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Ft.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(s=>{const c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(s=>{let{kind:c}=s;var l;if(c===It.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===It.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(s=>{let[c,{kind:l}]=s;var d,h;if(l===It.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===It.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===It.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),r.forEach(s=>{let[,{kind:c}]=s;Ke(this,Ft.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[It.VIDEO,It.AUDIO].forEach(i=>{n.has(i)?Ke(this,Ft.RequestP2PUnmuteRemote,i):Ke(this,Ft.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===It.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(st.LocalAudioTrack);if((e==null?void 0:e.track)instanceof qn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==st.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===st.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===st.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(st.LocalAudioTrack),l=i?this.localTrackMap.get(st.LocalVideoLowTrack):this.localTrackMap.get(st.LocalVideoTrack);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof vn),l=i?(s=this.localTrackMap.get(st.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof nn);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===It.VIDEO?n._videoSSRC:n._audioSSRC;r&&Mt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===It.VIDEO,audio:i===It.AUDIO,peerid:n.uid,subscribeRequestid:i===It.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Bi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ui("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ui("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(st.LocalAudioTrack);if((t==null?void 0:t.track)instanceof qn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Oe.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(st.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(st.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof nn||e&&e.track instanceof vn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ua(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(st.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=JE(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Oe.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case st.LocalVideoTrack:_t(e=i._hints).call(e,ze.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case st.LocalAudioTrack:i instanceof qn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case st.LocalVideoLowTrack:}}),this.emit(Ft.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ua(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Ft.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Au?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===or.SEND_ONLY){if(!this.sendConnection)throw new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const s=await wi(this,Ft.RequestP2PRestartICE,{direction:or.RECEIVE_ONLY,iceParameter:r});await i.restartICE(s),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalAudioTrack),i=t.videoSend.find(g=>{var I;return g.ssrc===(e==null||(I=e.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),r=t.audioSend.find(g=>{var I;return g.ssrc===(n==null||(I=n.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!i||!r)return 1;const s=ca(this,Ft.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,_=e==null?void 0:e.track;if(_&&_._encoderConfig&&_._hints.indexOf(ze.SCREEN_TRACK)===-1){const g=_._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(g&&I){const y=(1e3*g-I)/(1e3*g);return r1[y<.15?0:y<.3?1:y<.45?2:y<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===s);if(!c&&!l)return void(e+=1);const d=ca(this,Ft.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,_=t.recvPacketLossRate;let g=.7*_*100/50+.3*p/1500;m&&(g=.6*_*100/50+.2*p/1500+.2*m/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Tt((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=Re(),s=this.getAllTracks();t=jf(t=t.filter(d=>s.indexOf(d)===-1));let c=!1,l=!1;for(const d of t){if(d instanceof nn&&(this.localTrackMap.has(st.LocalVideoTrack)||c?new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:st.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:st.LocalVideoLowTrack})}if(d instanceof vn){const h=this.localTrackMap.get(st.LocalAudioTrack);if(h){if(!(h.track instanceof qn))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){const p=i.find(m=>{let{type:_}=m;return _===st.LocalAudioTrack});if(!(p.track instanceof qn))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!r.webAudioMediaStreamDest||d instanceof qn||d._bypassWebAudio)i.push({track:d,type:st.LocalAudioTrack});else{const p=new qn;p.addAudioTrack(d),i.push({track:p,type:st.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=jf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof vn){const r=this.localTrackMap.get(st.LocalAudioTrack);if(!r)continue;r.track instanceof qn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([st.LocalAudioTrack,r]),r.track.close())):e.push([st.LocalAudioTrack,r])}if(i instanceof nn){const r=this.localTrackMap.get(st.LocalVideoTrack);if(!r)continue;e.push([st.LocalVideoTrack,r]);const s=this.localTrackMap.get(st.LocalVideoLowTrack);s&&e.push([st.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.addListener(Nt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof qn?t.trackList.forEach(n=>{n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case st.LocalVideoTrack:n.off(Nt.GET_STATS,this.handleGetLocalVideoStats),n.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case st.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case st.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof qn?t.trackList.forEach(e=>{e.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Nt.GET_STATS,this.handleGetLocalAudioStats),e.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Nt.GET_STATS,this.handleGetLocalAudioStats),t.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof tm&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof em&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(It.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(It.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,{track:c,type:l}=n;switch(l){case st.LocalAudioTrack:s=we.Audio;break;case st.LocalVideoTrack:s=_t(r=c._hints).call(r,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalVideoLowTrack:s=we.Low}return{kind:l===st.LocalAudioTrack?It.AUDIO:It.VIDEO,stream_type:s,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case st.LocalVideoTrack:i=_t(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalAudioTrack:i=we.Audio;break;case st.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(Ft.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),_t(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await gi(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Mt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:En.TRACER}).onSuccess(),this.emit(Ft.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Xf.FIRST_FRAME_DECODED),Mt.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_DECODE,cn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_RECEIVED,cn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ii.FIRST_VIDEO_RECEIVED,cn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Ft.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(Ft.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===or.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===or.SEND_ONLY?this.restartICE(t):wi(this,Ft.RequestP2PRestartICE,{direction:or.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive||e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===st.LocalVideoTrack)){const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(st.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive&&e.push([st.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===st.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(st.LocalVideoLowTrack);r&&e.push([st.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:i=we.Audio;break;case st.LocalVideoTrack:i=_t(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case st.LocalAudioTrack:i=we.Audio;break;case st.LocalVideoTrack:i=_t(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case st.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case It.VIDEO:return void(i._videoSSRC&&e.push({stream_type:It.VIDEO,ssrcId:i._videoSSRC}));case It.AUDIO:return void(i._audioSSRC&&e.push({stream_type:It.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(st.LocalVideoTrack),n=this.localTrackMap.get(st.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new Tt((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof vn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Ke(this,Ft.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Ft.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Ft.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await gi(yI(this.dtlsFailedCount,Wn)),this.emit(Ft.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(st.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof nn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof nn).length>1)throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof vn).length>1&&(t.some(e=>e instanceof vn&&e._bypassWebAudio)||!Re().webAudioMediaStreamDest))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof nn&&this.pendingLocalTracks.some(n=>n instanceof nn))throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof vn&&this.pendingLocalTracks.some(n=>n instanceof vn)&&(!Re().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof vn&&n._bypassWebAudio)))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Re().supportDualStreamEncoding,i=eC(eC({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():LO(t,i);const s=Ye(8,"track-low-"),c=new nn(r,eC(eC({},n&&{scaleResolutionDownBy:fO(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return c.on(oh.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,zf.LOW_STREAM)}),c._hints.push(ze.LOW_STREAM),t.addListener(Nt.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ua(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Mt.firstRemoteVideoDecode(this.store.sessionId,ii.FIRST_VIDEO_DECODE,cn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.recvConnection.getRemoteSSRC(r);return s!==void 0&&s!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new $(L.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new $(L.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}async preConnect(t){throw new $(L.NOT_SUPPORTED)}getEstablishParams(){throw new $(L.NOT_SUPPORTED)}async reSubscribe(t){throw new $(L.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new $(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===st.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,zf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Lt(un.prototype,"p2pConnect",[Kx],Object.getOwnPropertyDescriptor(un.prototype,"p2pConnect"),un.prototype),Lt(un.prototype,"unpublish",[Yx],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),Lt(un.prototype,"unpublishLowStream",[zx],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),Lt(un.prototype,"subscribe",[qx],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),Lt(un.prototype,"mockSubscribe",[Xx],Object.getOwnPropertyDescriptor(un.prototype,"mockSubscribe"),un.prototype),Lt(un.prototype,"unsubscribe",[Jx],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),Lt(un.prototype,"muteRemote",[Qx],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),Lt(un.prototype,"unmuteRemote",[Zx],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),Lt(un.prototype,"hasRemoteMediaWithLock",[$x],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),Lt(un.prototype,"disconnectForReconnect",[tV],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),Lt(un.prototype,"remoteMediaSsrcChanged",[eV],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function co(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(t){case oo.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}case oo.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d(),h()}}}},i}}class Oh extends hn{constructor(e,n){super(),O(this,"signal",void 0),O(this,"token",void 0),O(this,"tokenTimeout",void 0),O(this,"tokenInterval",void 0),O(this,"_sequence",0),O(this,"userMap",new Map),O(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===Xe.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*M("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,s){var c,l,d;if(this.userMap.size===0)return;const h=Array.from(Lr(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(l=r)!==null&&l!==void 0?l:Ye(6,""),s=(d=s)!==null&&d!==void 0?d:this._sequence++;const p={_id:r,_type:e,_seq:s,_message:n,token:"".concat(this.token,"_").concat(h)};M("SHOW_P2P_LOG")&&T.debug("send message",p,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(p)).forEach(_=>{this.signal.request(Wt.DATA_STREAM,{payload:Eu(this.encoder.encode(_))})});const m=new Tt((_,g)=>{const I=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),y),this.off("res-@".concat(r),N),this.off(sm.ABORT,C),T.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?g(new $(L.INVALID_REMOTE_USER)):g(new $(L.TIMEOUT))},M("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{I&&window.clearTimeout(I),this.off(sm.ABORT,C),i&&_()},C=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(r,"_ack"),y),this.off("res-@".concat(r),N),g(new $(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(sm.ABORT,C),this.once("res-@".concat(r,"_ack"),y);const N=(V,W)=>{D=!0,I&&window.clearTimeout(I),this.off("res-@".concat(r,"_ack"),y),this.off(sm.ABORT,C),V==="success"?_(W):g(new $(L.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let D=!1;i||(this.once("res-@".concat(r),N),gi(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{D||T.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(p))}))});try{return await m}catch(_){if(_.code===L.TIMEOUT)return await this.send(e,n,i,r,s);throw _}}onMessage(e){var n;const{_uid:i}=e;let r,s=this.userMap.get(i);if(s)r=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Ln.CHECK)return;const{token:h}=e;r=new Map,s={uid:i,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,s),this.signal.emit(le.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:h,total:p}=e,m=(c=r.get(h))!==null&&c!==void 0?c:[];if(m.push(e),r.has(h)||r.set(h,m),m.length!==p)return;{const _=JE(m).call(m,(g,I)=>g.index-I.index).map(g=>g.payload).join("");r.delete(h),(e=JSON.parse(_))._uid=i}}const{_type:l,token:d}=e;if(_t(n=[Ln.ACK,Ln.CHECK]).call(n,l))return l===Ln.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(e);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):T.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:Ye(6,""),token:this.token,_type:Ln.CHECK};M("SHOW_P2P_LOG")&&T.debug("send message",e),this.signal.request(Wt.DATA_STREAM,{payload:Eu(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:Ln.ACK,token:this.token};M("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(Wt.DATA_STREAM,{payload:Eu(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(Ln.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:m}=h;for(;p.has(m);){const _=p.get(m);p.delete(m),this.receiveMessage(_),h.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,s=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=s;if(r<d)return this.ack(e._id),void T.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===d&&(this.receiveMessage(e),c.delete(d),s.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:s}=e;if(M("SHOW_P2P_LOG")&&T.debug("receive message",e),n){let c;switch(e._type!==Ln.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case Ln.CANDIDATE:case Ln.CONTROL:this.signal.emit(i,c,s);break;case Ln.PUBLISH:case Ln.UNPUBLISH:case Ln.RESTART_ICE:case Ln.CALL:c.uid=s,wi(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case Ln.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Ln.RESPONSE:{const{success:l,message:d}=c;this.emit("res-@".concat(n),l?"success":"failed",d);break}}}}splitMessage(e){if(e.length<Oh.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=Ye(6,"");let s=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){s++;const d={id:r,index:s,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(d).length>Oh.MAX_MESSAGE_SIZE?c-=50:(n.push(d),e=e.slice(c))}return n.map(d=>JSON.stringify(d))}handleCheckToken(e,n){return e.token!==n?(T.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(e.uid)},M("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await wi(this.signal,Ln.CALL,void 0),n=await this.send(Ln.CALL,e);this.signal.emit(Yt.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(sm.ABORT),this.signal.emit(le.ON_USER_OFFLINE,{uid:i.uid,reason:LH.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=Ye(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(sm.ABORT)}}O(Oh,"MAX_SIZE",1),O(Oh,"MAX_MESSAGE_SIZE",1024);class f8 extends hn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Xe.CONNECTED?this.emit(Yt.WS_CONNECTED):e===Xe.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):e===Xe.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Xe.CLOSED),O(this,"reconnectToken",void 0),O(this,"p2pToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new LP(5)),O(this,"pingpongTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"_external_signal",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case le.ON_DATA_STREAM:return void this.handleDataStream(r._message);case le.MUTE_AUDIO:case le.MUTE_VIDEO:case le.ON_P2P_LOST:case le.ON_USER_ONLINE:return;case le.ON_USER_OFFLINE:const{uid:s}=r._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(r._type,r._message),r._type===le.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===le.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Ie.UID_BANNED);break;case 15:this.close(Ie.IP_BANNED);break;case 16:this.close(Ie.CHANNEL_BANNED)}if(r._type===le.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Ie.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Ie.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ie.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Ie.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ie.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Ie.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new hO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Xe.CONNECTED&&this.reconnect("retry",Oi.OFFLINE)}),this.p2pToken=Ye(6,""),this._external_signal=new Oh(this,this.p2pToken)}async request(e,n,i,r){const s=Ye(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new Tt((I,y)=>{if(this.connectionState===Xe.CONNECTED)return I();const C=()=>{this.off(Yt.WS_CLOSED,N),I()},N=()=>{this.off(Yt.WS_CONNECTED,C),y(new $(L.WS_ABORT))};this.once(Yt.WS_CONNECTED,C),this.once(Yt.WS_CLOSED,N)});if(this.connectionState!==Xe.CONNECTING&&this.connectionState!==Xe.RECONNECTING||e===Wt.JOIN||e===Wt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new Tt((I,y)=>{let C=!1;const N=(V,W)=>{C=!0,I({isSuccess:V==="success",message:W||{}}),this.off(Yt.WS_CLOSED,D),this.off(Yt.WS_RECONNECTING,D),this.emit(Yt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),N);const D=()=>{y(new $(L.WS_ABORT,"type: ".concat(e))),this.off(Yt.WS_CLOSED,D),this.off(Yt.WS_RECONNECTING,D),this.off("res-@".concat(s),N)};this.once(Yt.WS_CLOSED,D),this.once(Yt.WS_RECONNECTING,D),gi(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||C||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Yt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(I){if(this.connectionState===Xe.CLOSED||e===Wt.LEAVE)throw new $(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():e===Wt.JOIN||e===Wt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),_=vg(m),g=new $(L.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:_.desc});return _.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(_.desc,", action: ").concat(_.action)),m===jt.ERR_TOO_MANY_BROADCASTERS?((e===Wt.JOIN||e===Wt.REJOIN)&&(this.initError=g,this.close()),g.throw()):_.action==="failed"?g.throw():_.action==="quit"?(this.initError=g,this.close(),g.throw()):(m===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Oi.MULTI_IP)):this.reconnect(_.action,Oi.SERVER_ERROR),e===Wt.JOIN||e===Wt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Tt(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Tg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Xe.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Tt((n,i)=>{this.once(Yt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Yt.WS_CLOSED,()=>i(this.initError||new $(L.WS_ABORT))),this.connectionState=Xe.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Ie.LEAVE,this.connectionState=Xe.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ye(6,""),this._external_signal.clear(),this._external_signal=new Oh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION);const e=await wi(this,Yt.REQUEST_JOIN_INFO),n=await this.request(Wt.JOIN,e);if(!n)return this.emit(Yt.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Xe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=rh(e.payload),r=new TextDecoder().decode(i),s=JSON.parse(r);"total"in s&&"id"in s||_t(n=Object.values(Ln)).call(n,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(le.ON_DATA_STREAM,e)}catch{this.emit(le.ON_DATA_STREAM,e)}}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=vg(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ie.UID_BANNED),void this.close()):void this.reconnect(n.action,Oi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Oi.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),M("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on($t.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on($t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on($t.CLOSED,()=>{this.connectionState=Xe.CLOSED}),this.websocket.on($t.FAILED,()=>{this._disconnectedReason=Ie.NETWORK_ERROR,this.connectionState=Xe.CLOSED}),this.websocket.on($t.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Xe.CONNECTED?this.connectionState=Xe.RECONNECTING:this.connectionState=Xe.CONNECTING}),this.websocket.on($t.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on($t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof $&&e.code===L.UNEXPECTED_RESPONSE&&e.data.code===jt.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Oi.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Oi.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on($t.REQUEST_NEW_URLS,(e,n)=>{wi(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(le.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const m8={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new p8(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new f8(n,e)}};function iV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function rV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class _8{constructor(e){O(this,"sessionDesc",void 0),O(this,"localCapabilities",void 0),O(this,"rtpCapabilities",void 0),O(this,"candidates",void 0),O(this,"_originCandidates",void 0),O(this,"iceParameters",void 0),O(this,"dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),e=gn(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:d,cname:h}=e,p=Mr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=r,this._originCandidates=gn(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=h;for(let m=0;m<p.mediaDescriptions.length;m++){const _=p.mediaDescriptions[m];if(_.attributes.iceUfrag=n.iceUfrag,_.attributes.icePwd=n.icePwd,_.attributes.fingerprints=i.fingerprints,_.attributes.candidates=r,_.attributes.setup=c,_.media.mediaType==="video"){_.media.fmts=s.videoCodecs.map(I=>I.payloadType.toString(10));let g=s.videoCodecs.filter(I=>{var y,C;return(y=I.rtpMap)===null||y===void 0?void 0:_t(C=y.encodingName.toLowerCase()).call(C,d)});g.length===0&&(g=s.videoCodecs),_.attributes.payloads=g,_.attributes.extmaps=s.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=s.audioCodecs.map(g=>g.payloadType.toString(10)),_.attributes.payloads=s.audioCodecs,_.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[m]=this.mungMediaDesc(_)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return gu(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:s}=fh(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>e===It.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,d=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:d}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],s=[];n.attributes.ssrcs.forEach(c=>{_t(e).call(e,c.attributes.label||"")?s.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;_t(l=s.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,s)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(rV(rV({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case Vi.TCP_RELAY:this.candidates=i;break;case Vi.UDP_TCP_RELAY:case Vi.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=gn(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=gn(e);return lm(i,n),_O(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===It.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var s;c&&(c.attributes.label=i,(s=c.attributes.msid)===null||s===void 0||s.replace(n,i))}}mungMediaDesc(e){const n=gn(e);return mO(n),function(i){const r=i.attributes.extmaps.find(s=>Ey(s.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(s=>{const c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var je;function aV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function nC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let E8=(je=class aS extends f1{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return _t(n=Object.keys(Yv)).call(n,e)}))]}constructor(e,n){super(e,n),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"statsFilter",void 0),O(this,"useRTX",!1),O(this,"localCapabilities",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"establishPromise",void 0),O(this,"mutex",void 0),this.store=n,this.mutex=new Ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(aS.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=wI(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,mn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=yu(e.sdp),i=Ag(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,nC(nC({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new _8(nC(nC({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new $(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return Ma(function*(){const r=yield Ee(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(_=>i.peerConnection.addTrack(_._mediaStreamTrack)),c=yield Ee(i.peerConnection.createOffer()),l=Mr(c.sdp),d=e.map(_=>{const g=_._mediaStreamTrack,I=l.mediaDescriptions.find(y=>y.attributes.mid===g.kind);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return function(y,C,N){const D=y.attributes.ssrcs.filter(W=>W.attributes.label===C),V=y.attributes.ssrcGroups;if(D.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&D.length>1){const W=V.find(K=>K.ssrcIds.indexOf(D[0].ssrcId)!==-1);return W?[{ssrcId:W.ssrcIds[0],rtx:N?W.ssrcIds[1]:void 0}]:[{ssrcId:D[0].ssrcId}]}return[{ssrcId:D[0].ssrcId}]}(I,g.id,i.useRTX)});let h;try{h=yield d}catch(_){throw s.forEach(g=>{Ii()&&g.replaceTrack(null),i.peerConnection.removeTrack(g)}),_}const p=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,h);const m=i.remoteSDP.toString();return yield Ee(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(i.applySendEncodings(s,e)),yield Ee(i.peerConnection.setRemoteDescription({type:"answer",sdp:m})),e.map((_,g)=>{const I=_._mediaStreamTrack.id;return{localSSRC:d[g],id:I}})}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{Ii()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:c}=this.remoteSDP.send(e,n,r),l=new Tt((p,m)=>{const _=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(s)))},1e4),g=I=>{const y=ge();if((y.name==="Safari"&&Number(y.version)===11||rr())&&I.track.id!==s&&I.streams[0].id===c){var C;const N=I.streams[0].getTracks()[0];return(C=this.remoteSDP)===null||C===void 0||C.updateTrackLabel(e,s,I.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(_),void p(N)}if(I.track.id===s)return this.peerConnection.removeEventListener("track",g),clearTimeout(_),void p(I.track)};this.peerConnection.addEventListener("track",g)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Ii()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(s=>s.active=!1),i.setParameters(r)}})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(Ii()&&s.track)s.track.enabled=!0;else{const c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Ma(function*(){const i=yield Ee(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Re().supportPCSetConfiguration;if(e===Vi.RELAY&&!r)return;if(r){const h=n.peerConnection.getConfiguration(),p=e===Vi.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}e!==Vi.RELAY&&n.remoteSDP.updateCandidates(e);const s=yield Ee(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=yu(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const d=n.remoteSDP.toString();yield Ee(n.peerConnection.setLocalDescription(s)),yield Ee(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new $(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new $(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(hg(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...aS.turnServerConfigToIceServers(e.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...aS.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Re().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const r={},s={};if(e instanceof nn)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(M("DSCP_TYPE")&&Jc()){var c;const h=M("DSCP_TYPE");_t(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}const l=n.getParameters(),d=(i=l.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,s),Object.assign(l,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!Re().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];r&&s&&await this.updateRtpSenderEncodings(s,r)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=Mr(e);return n.forEach((r,s)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&lm(l,r)}),gu(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((s,c)=>{let{id:l,mslabel:d}=s;const{kind:h}=e[c];return new Tt((p,m)=>{const _=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),g=I=>{const y=ge();if(y.name==="Safari"&&Number(y.version)===11&&I.track.id!==l&&I.streams[0].id===d){var C;const N=I.streams[0].getTracks()[0];return(C=this.remoteSDP)===null||C===void 0||C.updateTrackLabel(h,l,I.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(_),void p({track:N,id:l})}if(I.track.id===l)return this.peerConnection.removeEventListener("track",g),clearTimeout(_),void p({track:I.track,id:l})};this.peerConnection.addEventListener("track",g)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Tt.all(n)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(Re().supportPCSetConfiguration){const n=aS.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Lt(je.prototype,"connect",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"connect"),je.prototype),Lt(je.prototype,"stopSending",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"stopSending"),je.prototype),Lt(je.prototype,"receive",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"receive"),je.prototype),Lt(je.prototype,"stopReceiving",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"stopReceiving"),je.prototype),Lt(je.prototype,"muteRemote",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"muteRemote"),je.prototype),Lt(je.prototype,"unmuteRemote",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"unmuteRemote"),je.prototype),Lt(je.prototype,"muteLocal",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"muteLocal"),je.prototype),Lt(je.prototype,"unmuteLocal",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"unmuteLocal"),je.prototype),Lt(je.prototype,"close",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"close"),je.prototype),Lt(je.prototype,"updateEncoderConfig",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"updateEncoderConfig"),je.prototype),Lt(je.prototype,"updateSendParameters",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"updateSendParameters"),je.prototype),Lt(je.prototype,"replaceTrack",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"replaceTrack"),je.prototype),Lt(je.prototype,"getRemoteSSRC",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"getRemoteSSRC"),je.prototype),je);function Ha(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}const g8={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new E8(n,e)}},S8={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Re().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(ey.has(t)||!t.track)return;const n={track:t.track};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=e.metadata&&e.metadata();d?function(h,p){const{chunk:m,controller:_}=p,g=M("ENABLE_AUDIO_PTS_METADATA")?tl.AUDIO_64_BIT_PTS:tl.METADATA;m.data=function(I,y,C){const N=C.byteLength,D=N+$I+ZM,V=QI+ZI+D,W=new ArrayBuffer(I.byteLength+V),K=new DataView(W);K.setUint8(0,QM),K.setUint16(1,D),K.setUint8(3,y),K.setUint16(4,N);for(let Q=0;Q<N;Q++)K.setUint8(6+Q,C[Q]);const j=new Uint8Array(K.buffer);return j.set(new Uint8Array(I),V),j.buffer}(m.data,g,h),_.enqueue(m)}(d,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Ii()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=ty(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;if(l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id)T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(l.data.getMetadata){const h=e.metadata&&e.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=ey.get(t);if(r){ey.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}ey.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Re().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(oy.has(t))return;const n={track:t.track,onMetadata:e.onMetadata};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");dI(Ce.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(d,h,p){var m;const _=$M(new DataView(h.data));if(!_)return p.enqueue(h);const g=d.track.id;$5.set(g,d.track);const I=(m=_.tlv.find(W=>W.tag===tl.AUDIO_LEVEL))===null||m===void 0?void 0:m.value;let y=0;typeof I=="number"&&(y=127-I);const C=Math.round(Math.pow(10,y/60)-1),{selected:N,speaker:D}=function(W,K){let j=nm.get(W);if(j||(j=function(Q){const ct=new e1;return nm.set(Q,ct),no||(no=new Q5(M("TOPN_SILENCE_THRESHOLD")||500),no.on("ActiveSpeakerChanged",vt=>{vt!=null&&(ry=vt)})),no.addSpeakers([ct]),ct}(W)),nm.size<=n1)return{selected:!0,speaker:j};if(!no)throw new Error("no active speaker detector");return no.levelChanged(j.id,K),dh=no.loudest.map(Q=>Q.id),ry&&!_t(dh).call(dh,ry)&&dh.length>=n1&&dh.pop(),{selected:_t(dh).call(dh,j.id)||j.id===ry,speaker:j}}(d,C),V=function(W,K,j){const Q=io.get(W)||new Z5(W,K);return Q.score=j,io.set(W,Q),function(ct){if(ay.set(ct,!0),!sy)return void(sy=Date.now());const vt=Date.now();vt-sy>1e3&&(ay.get(ct)?ay.set(ct,!1):(i1(ct),ay.delete(ct)),sy=vt)}(W),Q}(g,d.track,D.energyScore);V.addSample(N),V.active&&(h.data=_.frame.buffer,p.enqueue(h))}(t,c,l):e.enableMetadata?function(d,h,p){const m=$M(new DataView(d.data));if(!m)return h.enqueue(d);const _=m.tlv.find(g=>g.tag===tl.METADATA||g.tag===tl.AUDIO_64_BIT_PTS);_&&p&&_.value instanceof Uint8Array&&p(_.value),d.data=m.frame.buffer,h.enqueue(d)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Ii()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=ty(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.metadata&&n.onMetadata&&n.onMetadata(l.data.metadata)},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const s=oy.get(r);if(s){(function(d){const h=nm.get(d);h&&(nm.delete(d),no&&(no.removeSpeakers([h]),nm.size===0&&(no.destroy(),no=null)))})(r),i1(r.track.id),oy.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){T.warning(d&&d.message)}}}(t)}oy.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!Re().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(cy.has(t)||!t.track)return;const n={track:t.track};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void T.error("create video-encoded-streams error",l&&l.message)}const s=[];e.on("sei-to-send",l=>{s.push(l)});const c=new TransformStream({transform(l,d){n.controller||(n.controller=d),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=s.shift();h&&(l.data=function(p,m){const _=function(D){const V=D.length;let W=[],K=0;for(;K<V;)K+2<V&&D[K]===0&&D[K+1]===0&&(D[K+2]===0||D[K+2]===1||D[K+2]===2||D[K+2]===3)?(W.push(D[K],D[K+1],3,D[K+2]),K+=3):(W.push(D[K]),K++);return new Uint8Array(W)}(m),g=_.length,I=Math.floor(g/255),y=g%255,C=new Uint8Array(6+I+1+g+p.byteLength);C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=6,C[5]=101;let N=0;for(;N<I;)C[6+N]=255,N++;return C[6+N]=y,N++,C.set(_,6+N),C.set(new Uint8Array(p),6+N+g),C.buffer}(l.data,h)),d.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!Ii())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=ty(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=cy.get(t);if(r){cy.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}cy.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Re().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!t.track)return;if(Sg.has(t)){const r=Sg.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create video-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=function(h){const p=new DataView(h.data);let m=0;for(;m+4<h.data.byteLength;){if(p.getUint8(m+0)===0&&p.getUint8(m+1)===0&&p.getUint8(m+2)===0&&p.getUint8(m+3)===1&&p.getUint8(m+4)===6){let _=m+6,g=0,I=0;for(;(I=p.getUint8(_++))===255;)g+=255;g+=I;const y=tH(h.data,_,g);return new Uint8Array(y)}m++}return null}(c);d&&n.onSei&&n.onSei(d),l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Ii()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=ty(),s=new MessageChannel;await new Tt(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:s.port2},[s.port2]);t.transform=c,await new Tt(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const s=Sg.get(r);if(s){Sg.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){T.warning(d&&d.message)}}})(t)}Sg.set(t,n),t.track.addEventListener("ended",i)}},T8={name:"InterceptFrame",create:()=>S8};NI(),Pe("PROCESS_ID","process-".concat(Ye(8,""),"-").concat(Ye(4,""),"-").concat(Ye(4,""),"-").concat(Ye(4,""),"-").concat(Ye(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();T.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(en,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;eo[i]=r,en[i]=r}})}catch(e){T.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(eo.AREAS)&&eo.AREAS.length>0&&RO(eo.AREAS,!0);const sV=(t,e,n)=>{T.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Pe(t,e,n)};Cu(HW,!1),Cu(YW,!1),Cu(A6,!1),Cu(i8,!1),Cu(FW,!1),Cu(m8,!1),Cu(g8,!1),Cu(T8,!1);const Kn=function(t){const e=new hn,n=t,i={getListeners:e.getListeners.bind(e),on:(r,s)=>(function(c,l){c===nc.SECURITY_POLICY_VIOLATION&&F2(l,!0)}(r,s),e.on.bind(e)(r,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return B2(B2({},n),i)}({__TRACK_LIST__:Yf,VERSION:Ua,BUILD:PI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:sV,getParameter:M,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return Re().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new z(L.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=Mt.reportApiInvoke(null,{name:Hn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:En.TRACER});let e=!1;try{const s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(s&&c&&l),e&&mI()&&oP(75)&&new s().close()}catch(s){return T.error("check system requirement failed: ",s),!1}let n=!1;const i=ge();i.name===Ce.CHROME&&Number(i.version)>=58&&($s.engine.name!=="WebKit"||function(){const s=ge();if(xv()){if(s.os===ni.MAC_OS)return!0;if(s.os===ni.IOS){const c=$s.os.version&&$s.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Ce.FIREFOX&&Number(i.version)>=56||i.name===Ce.OPERA&&Number(i.version)>=45||i.name===Ce.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(rr()||hs())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||pP()||ge().name===Ce.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return ma.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ma.getRecordingDevices(t)},getCameras:function(t){return ma.getCamerasDevices(t)},getElectronScreenSources:ok,getPlaybackDevices:function(t){return ma.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Ye(5,"client-"),i=Mt.reportApiInvoke(null,{id:n,name:Hn.CREATE_CLIENT,options:[e],tag:En.TRACER});try{(function(r){Zn(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Zn(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Zn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ei(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&RP(r.turnServer),r.httpRetryConfig!==void 0&&TP(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&TP(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(lP(16,0)||uP(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",T.debug("browser not support vp9, force use vp8")),Pe("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new b6(Ts(Ts({forceWaitGatewayResponse:!0},e),{},{role:_t(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=M("CAMERA_CAPTURE_CONFIG"),n=Ye(8,"track-cam-"),i=Mt.reportApiInvoke(null,{id:n,tag:En.TRACER,name:Hn.CREATE_CAM_VIDEO_TRACK,options:[ln({},t),e]});e&&(t.encoderConfig=e);const r=Zv(t);let s=null;T.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{s=(await fa({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!s){const l=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(T)}t.optimizationMode&&JI(n,s,t,$o(t.encoderConfig));const c=new XI(s,t,r,t.scalabiltyMode?qv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),T.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=Ye(8,"track-cus-"),n=Mt.reportApiInvoke(null,{id:e,tag:En.TRACER,name:Hn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),i=new nn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?qv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[ze.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),T.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(_){return Ek(_)}(e):void 0;n&&(e="auto");const i=Ye(8,"track-scr-v-"),r=Mt.reportApiInvoke(null,{id:i,tag:En.TRACER,name:Hn.CREATE_SCREEN_VIDEO_TRACK,options:[ln({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const s=function(_){const g={};_.screenSourceType&&(g.mediaSource=_.screenSourceType),_.extensionId&&Xc()&&(g.extensionId=_.extensionId);const{displaySurface:I,selfBrowserSurface:y,surfaceSwitching:C,systemAudio:N,preferCurrentTab:D}=_;(cg(107)||hI(107)||pI(93))&&(I&&(Zn(I,"displaySurface",["browser","window","monitor"]),g.displaySurface=I),y?(Zn(y,"selfBrowserSurface",["exclude","include"]),g.selfBrowserSurface=y):g.selfBrowserSurface="include",C&&(Zn(C,"surfaceSwitching",["exclude","include"]),g.surfaceSwitching=C)),(cg(105)||hI(105)||pI(91))&&N&&(Zn(N,"systemAudio",["exclude","include"]),g.systemAudio=N),(cg(94)||hI(94)||pI(80))&&D&&(g.preferCurrentTab=!0),_.electronScreenSourceId&&(g.sourceId=_.electronScreenSourceId);const V=_.encoderConfig?VI(_.encoderConfig):null;return g.mandatory={chromeMediaSource:"desktop",maxWidth:V?V.width:void 0,maxHeight:V?V.height:void 0},V&&(V.frameRate&&(typeof V.frameRate=="number"?(g.mandatory.maxFrameRate=V.frameRate,g.mandatory.minFrameRate=V.frameRate):(g.mandatory.maxFrameRate=V.frameRate.max||V.frameRate.ideal||V.frameRate.exact||void 0,g.mandatory.minFrameRate=V.frameRate.min||V.frameRate.ideal||V.frameRate.exact||void 0),g.frameRate=V.frameRate),V.width&&(g.width=V.width),V.height&&(g.height=V.height)),g}(t);let c=null,l=null;const d=Re();if(!d.supportShareAudio&&e==="enable"){const _=new $(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(_),_.throw(T)}T.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const h=d.supportShareAudio&&e!=="disable";try{const _=await fa({screen:s,screenAudio:h?n||!0:void 0},i);c=_.getVideoTracks()[0]||null,l=_.getAudioTracks()[0]||null}catch(_){throw r.onError(_),_}if(!c){const _=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(_),_.throw(T)}if(!l&&e==="enable"){c&&c.stop();const _=new $(L.SHARE_AUDIO_NOT_ALLOWED);return r.onError(_),_.throw(T)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(JI(i,c,t,t.encoderConfig&&VI(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const p=new nn(c,t.encoderConfig?VI(t.encoderConfig):{},t.scalabiltyMode?qv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[ze.SCREEN_TRACK]);if(!l)return r.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const m=new vn(l,void 0,Ye(8,"track-scr-a-"),!1);return r.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=M("CAMERA_CAPTURE_CONFIG"),i=Ye(8,"track-mic-"),r=Ye(8,"track-cam-"),s=Mt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:En.TRACER,name:Hn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=Zv(e),l=gk(t);let d=null,h=null;T.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const _=await fa({audio:l,video:c},"".concat(i,"-").concat(r));d=_.getAudioTracks()[0],h=_.getVideoTracks()[0]}catch(_){throw s.onError(_),_}if(!d||!h){const _=new $(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(_),_.throw(T)}e.optimizationMode&&JI(r,h,e,$o(e.encoderConfig));const p=new $v(d,t,l,i),m=new XI(h,e,c,e.scalabiltyMode?qv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return s.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[p,m]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Ye(8,"track-mic-"),n=Mt.reportApiInvoke(null,{id:e,tag:En.TRACER,name:Hn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=gk(t);let r=null;T.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await fa({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(T)}const s=new $v(r,t,i,e);return n.onSuccess(s.getTrackId()),T.info("create microphone audio track success, trackId:",e),s},createCustomAudioTrack:function(t){const e=Ye(8,"track-cus-"),n=Mt.reportApiInvoke(null,{id:e,tag:En.TRACER,name:Hn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new vn(t.mediaStreamTrack,t.encoderConfig?Xv(t.encoderConfig):{},e,!1);return T.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=Ye(8,"track-buf-"),l=Mt.reportApiInvoke(null,{id:c,tag:En.TRACER,name:Hn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(M("DISABLE_WEBAUDIO"))throw new $(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);const d=r;if(!(r instanceof AudioBuffer))try{r=await async function(m,_){let g=null;if(typeof m=="string"){const y=rM.get(m);if(y)return T.debug("use cached audio resource: ",m),y;try{g=(await to(()=>_r.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(C){throw new $(L.FETCH_AUDIO_FILE_FAILED,C.toString())}}else g=await new Tt((C,N)=>{const D=new FileReader;D.onload=V=>{V.target?C(V.target.result):N(new $(L.READ_LOCAL_AUDIO_FILE_ERROR))},D.onerror=()=>{N(new $(L.READ_LOCAL_AUDIO_FILE_ERROR))},D.readAsArrayBuffer(m)});const I=await function(y){const C=Zf();return new Tt((N,D)=>{C.decodeAudioData(y,V=>{N(V)},V=>{D(new $(L.DECODE_AUDIO_FILE_FAILED,V.toString()))})})}(g);return typeof m=="string"&&_&&rM.set(m,I),I}(r,n)}catch(m){return l.onError(m),m.throw(T)}const h=new Y5(r),p=new K5(d,h,i?Xv(i):{},c);return T.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(t){if(T.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw T.debug("Invalid appType"),new z(L.INVALID_PARAMS,"invalid app type",t);Pe("APP_TYPE",Math.floor(t))},setLogLevel:function(t){T.setLogLevel(t)},enableLogUpload:function(){M("USE_NEW_LOG")?Pe("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){M("USE_NEW_LOG")?Pe("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new rU},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Mt.reportApiInvoke(null,{tag:En.TRACER,name:Hn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof vn||t instanceof em)){const d=new z(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(d),d.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof vn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let s=r,c=r;const l=Date.now();return new Tt(d=>{const h=setInterval(()=>{const p=t.getVolumeLevel();s=p>s?p:s,c=p<c?p:c;const m=s-c>1e-4,_=Date.now()-l;if(m||_>e){clearInterval(h);const g=m,I={duration:_,deviceLabel:i,maxVolumeLevel:s,result:g};T.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),n.onSuccess(I),d(g)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Mt.reportApiInvoke(null,{tag:En.TRACER,name:Hn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof nn||t instanceof tm)){const m=new z(L.INVALID_TRACK,"the parameter is not a video track");return n.onError(m),m.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof nn?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Ii()||xv())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{const m=Date.now();l=await function(_,g,I,y){let C,N=0,D=null;return new Tt((V,W)=>{function K(){N>y&&C&&(C(),V(N));const j=I.getContext("2d");if(!j){const vt=new z(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(vt.toString()),void W(vt)}j.drawImage(_,0,0,160,120);const Q=j.getImageData(0,0,I.width,I.height),ct=Math.floor(Q.data.length/3);if(D){for(let vt=0;vt<ct;vt+=3)if(Q.data[vt]!==D[vt])return N+=1,void(D=Q.data);D=Q.data}else D=Q.data}setTimeout(()=>{C&&(C(),V(N))},g),C=HI(()=>{K()},30)})}(s,e,c,4),d=Date.now()-m}catch(m){throw n.onError(m),m}d6===Ce.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=l>4,p={duration:d,changedPicNum:l,deviceLabel:i,result:h};return T.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:RO,audioElementPlayCenter:Er,resumeAudioContext:function(){Er.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){O6.processExternalMediaAEC(t)},registerExtensions:function(t){const e=M("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!_t(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=T.extLog,i.reporter.hookApiInvoke=Mt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=M(r)})}),sV("PLUGIN_INFO",e)},ChannelMediaRelayError:rm,ChannelMediaRelayEvent:nl,ChannelMediaRelayState:Ur,RemoteStreamFallbackType:V5,RemoteStreamType:x5,ConnectionDisconnectedReason:Ie,AudienceLatencyLevelType:f5,AREAS:Ae,preload:async function(t,e,n,i){return DU(t,e,n,i)}});return Object.defineProperties(Kn,{onAudioAutoplayFailed:{get:()=>_a.onAudioAutoplayFailed,set:t=>{_a.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>_a.onAutoplayFailed,set:t=>{_a.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Kn._onSecurityPolicyViolation,set(t){Kn._onSecurityPolicyViolation=t,F2(t)}},__CLIENT_LIST__:{get:()=>M("SHOW_GLOBAL_CLIENT_LIST")?hh:[]}}),ma.on(ch.CAMERA_DEVICE_CHANGED,t=>{T.info("camera device changed",JSON.stringify(t)),Kn.onCameraChanged&&Kn.onCameraChanged(t),Kn.safeEmit(nc.CAMERA_CHANGED,t)}),ma.on(ch.RECORDING_DEVICE_CHANGED,t=>{T.info("microphone device changed",JSON.stringify(t)),Kn.onMicrophoneChanged&&Kn.onMicrophoneChanged(t),Kn.safeEmit(nc.MICROPHONE_CHANGED,t)}),ma.on(ch.PLAYOUT_DEVICE_CHANGED,t=>{T.debug("playout device changed",JSON.stringify(t)),Kn.onPlaybackDeviceChanged&&Kn.onPlaybackDeviceChanged(t),Kn.safeEmit(nc.PLAYBACK_DEVICE_CHANGED,t)}),Er.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),_a.onAudioAutoplayFailed&&_a.onAudioAutoplayFailed()},ke.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),_a.onAudioAutoplayFailed&&_a.onAudioAutoplayFailed(),Kn.safeEmit(nc.AUTOPLAY_FAILED)}),ke.on(Ti.STATE_CHANGE,(t,e)=>{T.info("audio context state changed: ".concat(e," => ").concat(t)),Kn.onAudioContextStateChanged&&Kn.onAudioContextStateChanged(t,e),Kn.safeEmit(nc.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),Vn.on(Ff.NETWORK_STATE_CHANGE,(t,e)=>{T.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=Kn),Kn})}(cC)),cC.exports}var aY=rY();const AV=xw(aY);function rB(S,A){return function(){return S.apply(A,arguments)}}const{toString:sY}=Object.prototype,{getPrototypeOf:Ww}=Object,{iterator:EC,toStringTag:aB}=Symbol,gC=(S=>A=>{const w=sY.call(A);return S[w]||(S[w]=w.slice(8,-1).toLowerCase())})(Object.create(null)),uo=S=>(S=S.toLowerCase(),A=>gC(A)===S),SC=S=>A=>typeof A===S,{isArray:bm}=Array,oS=SC("undefined");function oY(S){return S!==null&&!oS(S)&&S.constructor!==null&&!oS(S.constructor)&&Sa(S.constructor.isBuffer)&&S.constructor.isBuffer(S)}const sB=uo("ArrayBuffer");function cY(S){let A;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?A=ArrayBuffer.isView(S):A=S&&S.buffer&&sB(S.buffer),A}const lY=SC("string"),Sa=SC("function"),oB=SC("number"),TC=S=>S!==null&&typeof S=="object",uY=S=>S===!0||S===!1,lC=S=>{if(gC(S)!=="object")return!1;const A=Ww(S);return(A===null||A===Object.prototype||Object.getPrototypeOf(A)===null)&&!(aB in S)&&!(EC in S)},dY=uo("Date"),hY=uo("File"),pY=uo("Blob"),fY=uo("FileList"),mY=S=>TC(S)&&Sa(S.pipe),_Y=S=>{let A;return S&&(typeof FormData=="function"&&S instanceof FormData||Sa(S.append)&&((A=gC(S))==="formdata"||A==="object"&&Sa(S.toString)&&S.toString()==="[object FormData]"))},EY=uo("URLSearchParams"),[gY,SY,TY,RY]=["ReadableStream","Request","Response","Headers"].map(uo),vY=S=>S.trim?S.trim():S.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function dS(S,A,{allOwnKeys:w=!1}={}){if(S===null||typeof S>"u")return;let b,P;if(typeof S!="object"&&(S=[S]),bm(S))for(b=0,P=S.length;b<P;b++)A.call(null,S[b],b,S);else{const x=w?Object.getOwnPropertyNames(S):Object.keys(S),H=x.length;let J;for(b=0;b<H;b++)J=x[b],A.call(null,S[J],J,S)}}function cB(S,A){A=A.toLowerCase();const w=Object.keys(S);let b=w.length,P;for(;b-- >0;)if(P=w[b],A===P.toLowerCase())return P;return null}const Lh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,lB=S=>!oS(S)&&S!==Lh;function Dw(){const{caseless:S}=lB(this)&&this||{},A={},w=(b,P)=>{const x=S&&cB(A,P)||P;lC(A[x])&&lC(b)?A[x]=Dw(A[x],b):lC(b)?A[x]=Dw({},b):bm(b)?A[x]=b.slice():A[x]=b};for(let b=0,P=arguments.length;b<P;b++)arguments[b]&&dS(arguments[b],w);return A}const yY=(S,A,w,{allOwnKeys:b}={})=>(dS(A,(P,x)=>{w&&Sa(P)?S[x]=rB(P,w):S[x]=P},{allOwnKeys:b}),S),CY=S=>(S.charCodeAt(0)===65279&&(S=S.slice(1)),S),AY=(S,A,w,b)=>{S.prototype=Object.create(A.prototype,b),S.prototype.constructor=S,Object.defineProperty(S,"super",{value:A.prototype}),w&&Object.assign(S.prototype,w)},bY=(S,A,w,b)=>{let P,x,H;const J={};if(A=A||{},S==null)return A;do{for(P=Object.getOwnPropertyNames(S),x=P.length;x-- >0;)H=P[x],(!b||b(H,S,A))&&!J[H]&&(A[H]=S[H],J[H]=!0);S=w!==!1&&Ww(S)}while(S&&(!w||w(S,A))&&S!==Object.prototype);return A},IY=(S,A,w)=>{S=String(S),(w===void 0||w>S.length)&&(w=S.length),w-=A.length;const b=S.indexOf(A,w);return b!==-1&&b===w},OY=S=>{if(!S)return null;if(bm(S))return S;let A=S.length;if(!oB(A))return null;const w=new Array(A);for(;A-- >0;)w[A]=S[A];return w},wY=(S=>A=>S&&A instanceof S)(typeof Uint8Array<"u"&&Ww(Uint8Array)),NY=(S,A)=>{const b=(S&&S[EC]).call(S);let P;for(;(P=b.next())&&!P.done;){const x=P.value;A.call(S,x[0],x[1])}},DY=(S,A)=>{let w;const b=[];for(;(w=S.exec(A))!==null;)b.push(w);return b},LY=uo("HTMLFormElement"),PY=S=>S.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(w,b,P){return b.toUpperCase()+P}),bV=(({hasOwnProperty:S})=>(A,w)=>S.call(A,w))(Object.prototype),kY=uo("RegExp"),uB=(S,A)=>{const w=Object.getOwnPropertyDescriptors(S),b={};dS(w,(P,x)=>{let H;(H=A(P,x,S))!==!1&&(b[x]=H||P)}),Object.defineProperties(S,b)},MY=S=>{uB(S,(A,w)=>{if(Sa(S)&&["arguments","caller","callee"].indexOf(w)!==-1)return!1;const b=S[w];if(Sa(b)){if(A.enumerable=!1,"writable"in A){A.writable=!1;return}A.set||(A.set=()=>{throw Error("Can not rewrite read-only method '"+w+"'")})}})},UY=(S,A)=>{const w={},b=P=>{P.forEach(x=>{w[x]=!0})};return bm(S)?b(S):b(String(S).split(A)),w},xY=()=>{},VY=(S,A)=>S!=null&&Number.isFinite(S=+S)?S:A;function BY(S){return!!(S&&Sa(S.append)&&S[aB]==="FormData"&&S[EC])}const FY=S=>{const A=new Array(10),w=(b,P)=>{if(TC(b)){if(A.indexOf(b)>=0)return;if(!("toJSON"in b)){A[P]=b;const x=bm(b)?[]:{};return dS(b,(H,J)=>{const X=w(H,P+1);!oS(X)&&(x[J]=X)}),A[P]=void 0,x}}return b};return w(S,0)},jY=uo("AsyncFunction"),GY=S=>S&&(TC(S)||Sa(S))&&Sa(S.then)&&Sa(S.catch),dB=((S,A)=>S?setImmediate:A?((w,b)=>(Lh.addEventListener("message",({source:P,data:x})=>{P===Lh&&x===w&&b.length&&b.shift()()},!1),P=>{b.push(P),Lh.postMessage(w,"*")}))(`axios@${Math.random()}`,[]):w=>setTimeout(w))(typeof setImmediate=="function",Sa(Lh.postMessage)),HY=typeof queueMicrotask<"u"?queueMicrotask.bind(Lh):typeof process<"u"&&process.nextTick||dB,WY=S=>S!=null&&Sa(S[EC]),St={isArray:bm,isArrayBuffer:sB,isBuffer:oY,isFormData:_Y,isArrayBufferView:cY,isString:lY,isNumber:oB,isBoolean:uY,isObject:TC,isPlainObject:lC,isReadableStream:gY,isRequest:SY,isResponse:TY,isHeaders:RY,isUndefined:oS,isDate:dY,isFile:hY,isBlob:pY,isRegExp:kY,isFunction:Sa,isStream:mY,isURLSearchParams:EY,isTypedArray:wY,isFileList:fY,forEach:dS,merge:Dw,extend:yY,trim:vY,stripBOM:CY,inherits:AY,toFlatObject:bY,kindOf:gC,kindOfTest:uo,endsWith:IY,toArray:OY,forEachEntry:NY,matchAll:DY,isHTMLForm:LY,hasOwnProperty:bV,hasOwnProp:bV,reduceDescriptors:uB,freezeMethods:MY,toObjectSet:UY,toCamelCase:PY,noop:xY,toFiniteNumber:VY,findKey:cB,global:Lh,isContextDefined:lB,isSpecCompliantForm:BY,toJSONObject:FY,isAsyncFn:jY,isThenable:GY,setImmediate:dB,asap:HY,isIterable:WY};function Fe(S,A,w,b,P){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=S,this.name="AxiosError",A&&(this.code=A),w&&(this.config=w),b&&(this.request=b),P&&(this.response=P,this.status=P.status?P.status:null)}St.inherits(Fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:St.toJSONObject(this.config),code:this.code,status:this.status}}});const hB=Fe.prototype,pB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(S=>{pB[S]={value:S}});Object.defineProperties(Fe,pB);Object.defineProperty(hB,"isAxiosError",{value:!0});Fe.from=(S,A,w,b,P,x)=>{const H=Object.create(hB);return St.toFlatObject(S,H,function(X){return X!==Error.prototype},J=>J!=="isAxiosError"),Fe.call(H,S.message,A,w,b,P),H.cause=S,H.name=S.name,x&&Object.assign(H,x),H};const KY=null;function Lw(S){return St.isPlainObject(S)||St.isArray(S)}function fB(S){return St.endsWith(S,"[]")?S.slice(0,-2):S}function IV(S,A,w){return S?S.concat(A).map(function(P,x){return P=fB(P),!w&&x?"["+P+"]":P}).join(w?".":""):A}function YY(S){return St.isArray(S)&&!S.some(Lw)}const zY=St.toFlatObject(St,{},null,function(A){return/^is[A-Z]/.test(A)});function RC(S,A,w){if(!St.isObject(S))throw new TypeError("target must be an object");A=A||new FormData,w=St.toFlatObject(w,{metaTokens:!0,dots:!1,indexes:!1},!1,function(xt,yt){return!St.isUndefined(yt[xt])});const b=w.metaTokens,P=w.visitor||Z,x=w.dots,H=w.indexes,X=(w.Blob||typeof Blob<"u"&&Blob)&&St.isSpecCompliantForm(A);if(!St.isFunction(P))throw new TypeError("visitor must be a function");function G(it){if(it===null)return"";if(St.isDate(it))return it.toISOString();if(!X&&St.isBlob(it))throw new Fe("Blob is not supported. Use a Buffer instead.");return St.isArrayBuffer(it)||St.isTypedArray(it)?X&&typeof Blob=="function"?new Blob([it]):Buffer.from(it):it}function Z(it,xt,yt){let kt=it;if(it&&!yt&&typeof it=="object"){if(St.endsWith(xt,"{}"))xt=b?xt:xt.slice(0,-2),it=JSON.stringify(it);else if(St.isArray(it)&&YY(it)||(St.isFileList(it)||St.endsWith(xt,"[]"))&&(kt=St.toArray(it)))return xt=fB(xt),kt.forEach(function(Bt,ie){!(St.isUndefined(Bt)||Bt===null)&&A.append(H===!0?IV([xt],ie,x):H===null?xt:xt+"[]",G(Bt))}),!1}return Lw(it)?!0:(A.append(IV(yt,xt,x),G(it)),!1)}const ot=[],mt=Object.assign(zY,{defaultVisitor:Z,convertValue:G,isVisitable:Lw});function Vt(it,xt){if(!St.isUndefined(it)){if(ot.indexOf(it)!==-1)throw Error("Circular reference detected in "+xt.join("."));ot.push(it),St.forEach(it,function(kt,zt){(!(St.isUndefined(kt)||kt===null)&&P.call(A,kt,St.isString(zt)?zt.trim():zt,xt,mt))===!0&&Vt(kt,xt?xt.concat(zt):[zt])}),ot.pop()}}if(!St.isObject(S))throw new TypeError("data must be an object");return Vt(S),A}function OV(S){const A={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(S).replace(/[!'()~]|%20|%00/g,function(b){return A[b]})}function Kw(S,A){this._pairs=[],S&&RC(S,this,A)}const mB=Kw.prototype;mB.append=function(A,w){this._pairs.push([A,w])};mB.toString=function(A){const w=A?function(b){return A.call(this,b,OV)}:OV;return this._pairs.map(function(P){return w(P[0])+"="+w(P[1])},"").join("&")};function qY(S){return encodeURIComponent(S).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _B(S,A,w){if(!A)return S;const b=w&&w.encode||qY;St.isFunction(w)&&(w={serialize:w});const P=w&&w.serialize;let x;if(P?x=P(A,w):x=St.isURLSearchParams(A)?A.toString():new Kw(A,w).toString(b),x){const H=S.indexOf("#");H!==-1&&(S=S.slice(0,H)),S+=(S.indexOf("?")===-1?"?":"&")+x}return S}class wV{constructor(){this.handlers=[]}use(A,w,b){return this.handlers.push({fulfilled:A,rejected:w,synchronous:b?b.synchronous:!1,runWhen:b?b.runWhen:null}),this.handlers.length-1}eject(A){this.handlers[A]&&(this.handlers[A]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(A){St.forEach(this.handlers,function(b){b!==null&&A(b)})}}const EB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},XY=typeof URLSearchParams<"u"?URLSearchParams:Kw,JY=typeof FormData<"u"?FormData:null,QY=typeof Blob<"u"?Blob:null,ZY={isBrowser:!0,classes:{URLSearchParams:XY,FormData:JY,Blob:QY},protocols:["http","https","file","blob","url","data"]},Yw=typeof window<"u"&&typeof document<"u",Pw=typeof navigator=="object"&&navigator||void 0,$Y=Yw&&(!Pw||["ReactNative","NativeScript","NS"].indexOf(Pw.product)<0),tz=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ez=Yw&&window.location.href||"http://localhost",nz=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Yw,hasStandardBrowserEnv:$Y,hasStandardBrowserWebWorkerEnv:tz,navigator:Pw,origin:ez},Symbol.toStringTag,{value:"Module"})),Gr={...nz,...ZY};function iz(S,A){return RC(S,new Gr.classes.URLSearchParams,Object.assign({visitor:function(w,b,P,x){return Gr.isNode&&St.isBuffer(w)?(this.append(b,w.toString("base64")),!1):x.defaultVisitor.apply(this,arguments)}},A))}function rz(S){return St.matchAll(/\w+|\[(\w*)]/g,S).map(A=>A[0]==="[]"?"":A[1]||A[0])}function az(S){const A={},w=Object.keys(S);let b;const P=w.length;let x;for(b=0;b<P;b++)x=w[b],A[x]=S[x];return A}function gB(S){function A(w,b,P,x){let H=w[x++];if(H==="__proto__")return!0;const J=Number.isFinite(+H),X=x>=w.length;return H=!H&&St.isArray(P)?P.length:H,X?(St.hasOwnProp(P,H)?P[H]=[P[H],b]:P[H]=b,!J):((!P[H]||!St.isObject(P[H]))&&(P[H]=[]),A(w,b,P[H],x)&&St.isArray(P[H])&&(P[H]=az(P[H])),!J)}if(St.isFormData(S)&&St.isFunction(S.entries)){const w={};return St.forEachEntry(S,(b,P)=>{A(rz(b),P,w,0)}),w}return null}function sz(S,A,w){if(St.isString(S))try{return(A||JSON.parse)(S),St.trim(S)}catch(b){if(b.name!=="SyntaxError")throw b}return(w||JSON.stringify)(S)}const hS={transitional:EB,adapter:["xhr","http","fetch"],transformRequest:[function(A,w){const b=w.getContentType()||"",P=b.indexOf("application/json")>-1,x=St.isObject(A);if(x&&St.isHTMLForm(A)&&(A=new FormData(A)),St.isFormData(A))return P?JSON.stringify(gB(A)):A;if(St.isArrayBuffer(A)||St.isBuffer(A)||St.isStream(A)||St.isFile(A)||St.isBlob(A)||St.isReadableStream(A))return A;if(St.isArrayBufferView(A))return A.buffer;if(St.isURLSearchParams(A))return w.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),A.toString();let J;if(x){if(b.indexOf("application/x-www-form-urlencoded")>-1)return iz(A,this.formSerializer).toString();if((J=St.isFileList(A))||b.indexOf("multipart/form-data")>-1){const X=this.env&&this.env.FormData;return RC(J?{"files[]":A}:A,X&&new X,this.formSerializer)}}return x||P?(w.setContentType("application/json",!1),sz(A)):A}],transformResponse:[function(A){const w=this.transitional||hS.transitional,b=w&&w.forcedJSONParsing,P=this.responseType==="json";if(St.isResponse(A)||St.isReadableStream(A))return A;if(A&&St.isString(A)&&(b&&!this.responseType||P)){const H=!(w&&w.silentJSONParsing)&&P;try{return JSON.parse(A)}catch(J){if(H)throw J.name==="SyntaxError"?Fe.from(J,Fe.ERR_BAD_RESPONSE,this,null,this.response):J}}return A}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Gr.classes.FormData,Blob:Gr.classes.Blob},validateStatus:function(A){return A>=200&&A<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};St.forEach(["delete","get","head","post","put","patch"],S=>{hS.headers[S]={}});const oz=St.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cz=S=>{const A={};let w,b,P;return S&&S.split(`
`).forEach(function(H){P=H.indexOf(":"),w=H.substring(0,P).trim().toLowerCase(),b=H.substring(P+1).trim(),!(!w||A[w]&&oz[w])&&(w==="set-cookie"?A[w]?A[w].push(b):A[w]=[b]:A[w]=A[w]?A[w]+", "+b:b)}),A},NV=Symbol("internals");function rS(S){return S&&String(S).trim().toLowerCase()}function uC(S){return S===!1||S==null?S:St.isArray(S)?S.map(uC):String(S)}function lz(S){const A=Object.create(null),w=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let b;for(;b=w.exec(S);)A[b[1]]=b[2];return A}const uz=S=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(S.trim());function Cw(S,A,w,b,P){if(St.isFunction(b))return b.call(this,A,w);if(P&&(A=w),!!St.isString(A)){if(St.isString(b))return A.indexOf(b)!==-1;if(St.isRegExp(b))return b.test(A)}}function dz(S){return S.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(A,w,b)=>w.toUpperCase()+b)}function hz(S,A){const w=St.toCamelCase(" "+A);["get","set","has"].forEach(b=>{Object.defineProperty(S,b+w,{value:function(P,x,H){return this[b].call(this,A,P,x,H)},configurable:!0})})}let Ta=class{constructor(A){A&&this.set(A)}set(A,w,b){const P=this;function x(J,X,G){const Z=rS(X);if(!Z)throw new Error("header name must be a non-empty string");const ot=St.findKey(P,Z);(!ot||P[ot]===void 0||G===!0||G===void 0&&P[ot]!==!1)&&(P[ot||X]=uC(J))}const H=(J,X)=>St.forEach(J,(G,Z)=>x(G,Z,X));if(St.isPlainObject(A)||A instanceof this.constructor)H(A,w);else if(St.isString(A)&&(A=A.trim())&&!uz(A))H(cz(A),w);else if(St.isObject(A)&&St.isIterable(A)){let J={},X,G;for(const Z of A){if(!St.isArray(Z))throw TypeError("Object iterator must return a key-value pair");J[G=Z[0]]=(X=J[G])?St.isArray(X)?[...X,Z[1]]:[X,Z[1]]:Z[1]}H(J,w)}else A!=null&&x(w,A,b);return this}get(A,w){if(A=rS(A),A){const b=St.findKey(this,A);if(b){const P=this[b];if(!w)return P;if(w===!0)return lz(P);if(St.isFunction(w))return w.call(this,P,b);if(St.isRegExp(w))return w.exec(P);throw new TypeError("parser must be boolean|regexp|function")}}}has(A,w){if(A=rS(A),A){const b=St.findKey(this,A);return!!(b&&this[b]!==void 0&&(!w||Cw(this,this[b],b,w)))}return!1}delete(A,w){const b=this;let P=!1;function x(H){if(H=rS(H),H){const J=St.findKey(b,H);J&&(!w||Cw(b,b[J],J,w))&&(delete b[J],P=!0)}}return St.isArray(A)?A.forEach(x):x(A),P}clear(A){const w=Object.keys(this);let b=w.length,P=!1;for(;b--;){const x=w[b];(!A||Cw(this,this[x],x,A,!0))&&(delete this[x],P=!0)}return P}normalize(A){const w=this,b={};return St.forEach(this,(P,x)=>{const H=St.findKey(b,x);if(H){w[H]=uC(P),delete w[x];return}const J=A?dz(x):String(x).trim();J!==x&&delete w[x],w[J]=uC(P),b[J]=!0}),this}concat(...A){return this.constructor.concat(this,...A)}toJSON(A){const w=Object.create(null);return St.forEach(this,(b,P)=>{b!=null&&b!==!1&&(w[P]=A&&St.isArray(b)?b.join(", "):b)}),w}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([A,w])=>A+": "+w).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(A){return A instanceof this?A:new this(A)}static concat(A,...w){const b=new this(A);return w.forEach(P=>b.set(P)),b}static accessor(A){const b=(this[NV]=this[NV]={accessors:{}}).accessors,P=this.prototype;function x(H){const J=rS(H);b[J]||(hz(P,H),b[J]=!0)}return St.isArray(A)?A.forEach(x):x(A),this}};Ta.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);St.reduceDescriptors(Ta.prototype,({value:S},A)=>{let w=A[0].toUpperCase()+A.slice(1);return{get:()=>S,set(b){this[w]=b}}});St.freezeMethods(Ta);function Aw(S,A){const w=this||hS,b=A||w,P=Ta.from(b.headers);let x=b.data;return St.forEach(S,function(J){x=J.call(w,x,P.normalize(),A?A.status:void 0)}),P.normalize(),x}function SB(S){return!!(S&&S.__CANCEL__)}function Im(S,A,w){Fe.call(this,S??"canceled",Fe.ERR_CANCELED,A,w),this.name="CanceledError"}St.inherits(Im,Fe,{__CANCEL__:!0});function TB(S,A,w){const b=w.config.validateStatus;!w.status||!b||b(w.status)?S(w):A(new Fe("Request failed with status code "+w.status,[Fe.ERR_BAD_REQUEST,Fe.ERR_BAD_RESPONSE][Math.floor(w.status/100)-4],w.config,w.request,w))}function pz(S){const A=/^([-+\w]{1,25})(:?\/\/|:)/.exec(S);return A&&A[1]||""}function fz(S,A){S=S||10;const w=new Array(S),b=new Array(S);let P=0,x=0,H;return A=A!==void 0?A:1e3,function(X){const G=Date.now(),Z=b[x];H||(H=G),w[P]=X,b[P]=G;let ot=x,mt=0;for(;ot!==P;)mt+=w[ot++],ot=ot%S;if(P=(P+1)%S,P===x&&(x=(x+1)%S),G-H<A)return;const Vt=Z&&G-Z;return Vt?Math.round(mt*1e3/Vt):void 0}}function mz(S,A){let w=0,b=1e3/A,P,x;const H=(G,Z=Date.now())=>{w=Z,P=null,x&&(clearTimeout(x),x=null),S.apply(null,G)};return[(...G)=>{const Z=Date.now(),ot=Z-w;ot>=b?H(G,Z):(P=G,x||(x=setTimeout(()=>{x=null,H(P)},b-ot)))},()=>P&&H(P)]}const pC=(S,A,w=3)=>{let b=0;const P=fz(50,250);return mz(x=>{const H=x.loaded,J=x.lengthComputable?x.total:void 0,X=H-b,G=P(X),Z=H<=J;b=H;const ot={loaded:H,total:J,progress:J?H/J:void 0,bytes:X,rate:G||void 0,estimated:G&&J&&Z?(J-H)/G:void 0,event:x,lengthComputable:J!=null,[A?"download":"upload"]:!0};S(ot)},w)},DV=(S,A)=>{const w=S!=null;return[b=>A[0]({lengthComputable:w,total:S,loaded:b}),A[1]]},LV=S=>(...A)=>St.asap(()=>S(...A)),_z=Gr.hasStandardBrowserEnv?((S,A)=>w=>(w=new URL(w,Gr.origin),S.protocol===w.protocol&&S.host===w.host&&(A||S.port===w.port)))(new URL(Gr.origin),Gr.navigator&&/(msie|trident)/i.test(Gr.navigator.userAgent)):()=>!0,Ez=Gr.hasStandardBrowserEnv?{write(S,A,w,b,P,x){const H=[S+"="+encodeURIComponent(A)];St.isNumber(w)&&H.push("expires="+new Date(w).toGMTString()),St.isString(b)&&H.push("path="+b),St.isString(P)&&H.push("domain="+P),x===!0&&H.push("secure"),document.cookie=H.join("; ")},read(S){const A=document.cookie.match(new RegExp("(^|;\\s*)("+S+")=([^;]*)"));return A?decodeURIComponent(A[3]):null},remove(S){this.write(S,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function gz(S){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(S)}function Sz(S,A){return A?S.replace(/\/?\/$/,"")+"/"+A.replace(/^\/+/,""):S}function RB(S,A,w){let b=!gz(A);return S&&(b||w==!1)?Sz(S,A):A}const PV=S=>S instanceof Ta?{...S}:S;function kh(S,A){A=A||{};const w={};function b(G,Z,ot,mt){return St.isPlainObject(G)&&St.isPlainObject(Z)?St.merge.call({caseless:mt},G,Z):St.isPlainObject(Z)?St.merge({},Z):St.isArray(Z)?Z.slice():Z}function P(G,Z,ot,mt){if(St.isUndefined(Z)){if(!St.isUndefined(G))return b(void 0,G,ot,mt)}else return b(G,Z,ot,mt)}function x(G,Z){if(!St.isUndefined(Z))return b(void 0,Z)}function H(G,Z){if(St.isUndefined(Z)){if(!St.isUndefined(G))return b(void 0,G)}else return b(void 0,Z)}function J(G,Z,ot){if(ot in A)return b(G,Z);if(ot in S)return b(void 0,G)}const X={url:x,method:x,data:x,baseURL:H,transformRequest:H,transformResponse:H,paramsSerializer:H,timeout:H,timeoutMessage:H,withCredentials:H,withXSRFToken:H,adapter:H,responseType:H,xsrfCookieName:H,xsrfHeaderName:H,onUploadProgress:H,onDownloadProgress:H,decompress:H,maxContentLength:H,maxBodyLength:H,beforeRedirect:H,transport:H,httpAgent:H,httpsAgent:H,cancelToken:H,socketPath:H,responseEncoding:H,validateStatus:J,headers:(G,Z,ot)=>P(PV(G),PV(Z),ot,!0)};return St.forEach(Object.keys(Object.assign({},S,A)),function(Z){const ot=X[Z]||P,mt=ot(S[Z],A[Z],Z);St.isUndefined(mt)&&ot!==J||(w[Z]=mt)}),w}const vB=S=>{const A=kh({},S);let{data:w,withXSRFToken:b,xsrfHeaderName:P,xsrfCookieName:x,headers:H,auth:J}=A;A.headers=H=Ta.from(H),A.url=_B(RB(A.baseURL,A.url,A.allowAbsoluteUrls),S.params,S.paramsSerializer),J&&H.set("Authorization","Basic "+btoa((J.username||"")+":"+(J.password?unescape(encodeURIComponent(J.password)):"")));let X;if(St.isFormData(w)){if(Gr.hasStandardBrowserEnv||Gr.hasStandardBrowserWebWorkerEnv)H.setContentType(void 0);else if((X=H.getContentType())!==!1){const[G,...Z]=X?X.split(";").map(ot=>ot.trim()).filter(Boolean):[];H.setContentType([G||"multipart/form-data",...Z].join("; "))}}if(Gr.hasStandardBrowserEnv&&(b&&St.isFunction(b)&&(b=b(A)),b||b!==!1&&_z(A.url))){const G=P&&x&&Ez.read(x);G&&H.set(P,G)}return A},Tz=typeof XMLHttpRequest<"u",Rz=Tz&&function(S){return new Promise(function(w,b){const P=vB(S);let x=P.data;const H=Ta.from(P.headers).normalize();let{responseType:J,onUploadProgress:X,onDownloadProgress:G}=P,Z,ot,mt,Vt,it;function xt(){Vt&&Vt(),it&&it(),P.cancelToken&&P.cancelToken.unsubscribe(Z),P.signal&&P.signal.removeEventListener("abort",Z)}let yt=new XMLHttpRequest;yt.open(P.method.toUpperCase(),P.url,!0),yt.timeout=P.timeout;function kt(){if(!yt)return;const Bt=Ta.from("getAllResponseHeaders"in yt&&yt.getAllResponseHeaders()),te={data:!J||J==="text"||J==="json"?yt.responseText:yt.response,status:yt.status,statusText:yt.statusText,headers:Bt,config:S,request:yt};TB(function(Le){w(Le),xt()},function(Le){b(Le),xt()},te),yt=null}"onloadend"in yt?yt.onloadend=kt:yt.onreadystatechange=function(){!yt||yt.readyState!==4||yt.status===0&&!(yt.responseURL&&yt.responseURL.indexOf("file:")===0)||setTimeout(kt)},yt.onabort=function(){yt&&(b(new Fe("Request aborted",Fe.ECONNABORTED,S,yt)),yt=null)},yt.onerror=function(){b(new Fe("Network Error",Fe.ERR_NETWORK,S,yt)),yt=null},yt.ontimeout=function(){let ie=P.timeout?"timeout of "+P.timeout+"ms exceeded":"timeout exceeded";const te=P.transitional||EB;P.timeoutErrorMessage&&(ie=P.timeoutErrorMessage),b(new Fe(ie,te.clarifyTimeoutError?Fe.ETIMEDOUT:Fe.ECONNABORTED,S,yt)),yt=null},x===void 0&&H.setContentType(null),"setRequestHeader"in yt&&St.forEach(H.toJSON(),function(ie,te){yt.setRequestHeader(te,ie)}),St.isUndefined(P.withCredentials)||(yt.withCredentials=!!P.withCredentials),J&&J!=="json"&&(yt.responseType=P.responseType),G&&([mt,it]=pC(G,!0),yt.addEventListener("progress",mt)),X&&yt.upload&&([ot,Vt]=pC(X),yt.upload.addEventListener("progress",ot),yt.upload.addEventListener("loadend",Vt)),(P.cancelToken||P.signal)&&(Z=Bt=>{yt&&(b(!Bt||Bt.type?new Im(null,S,yt):Bt),yt.abort(),yt=null)},P.cancelToken&&P.cancelToken.subscribe(Z),P.signal&&(P.signal.aborted?Z():P.signal.addEventListener("abort",Z)));const zt=pz(P.url);if(zt&&Gr.protocols.indexOf(zt)===-1){b(new Fe("Unsupported protocol "+zt+":",Fe.ERR_BAD_REQUEST,S));return}yt.send(x||null)})},vz=(S,A)=>{const{length:w}=S=S?S.filter(Boolean):[];if(A||w){let b=new AbortController,P;const x=function(G){if(!P){P=!0,J();const Z=G instanceof Error?G:this.reason;b.abort(Z instanceof Fe?Z:new Im(Z instanceof Error?Z.message:Z))}};let H=A&&setTimeout(()=>{H=null,x(new Fe(`timeout ${A} of ms exceeded`,Fe.ETIMEDOUT))},A);const J=()=>{S&&(H&&clearTimeout(H),H=null,S.forEach(G=>{G.unsubscribe?G.unsubscribe(x):G.removeEventListener("abort",x)}),S=null)};S.forEach(G=>G.addEventListener("abort",x));const{signal:X}=b;return X.unsubscribe=()=>St.asap(J),X}},yz=function*(S,A){let w=S.byteLength;if(w<A){yield S;return}let b=0,P;for(;b<w;)P=b+A,yield S.slice(b,P),b=P},Cz=async function*(S,A){for await(const w of Az(S))yield*yz(w,A)},Az=async function*(S){if(S[Symbol.asyncIterator]){yield*S;return}const A=S.getReader();try{for(;;){const{done:w,value:b}=await A.read();if(w)break;yield b}}finally{await A.cancel()}},kV=(S,A,w,b)=>{const P=Cz(S,A);let x=0,H,J=X=>{H||(H=!0,b&&b(X))};return new ReadableStream({async pull(X){try{const{done:G,value:Z}=await P.next();if(G){J(),X.close();return}let ot=Z.byteLength;if(w){let mt=x+=ot;w(mt)}X.enqueue(new Uint8Array(Z))}catch(G){throw J(G),G}},cancel(X){return J(X),P.return()}},{highWaterMark:2})},vC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",yB=vC&&typeof ReadableStream=="function",bz=vC&&(typeof TextEncoder=="function"?(S=>A=>S.encode(A))(new TextEncoder):async S=>new Uint8Array(await new Response(S).arrayBuffer())),CB=(S,...A)=>{try{return!!S(...A)}catch{return!1}},Iz=yB&&CB(()=>{let S=!1;const A=new Request(Gr.origin,{body:new ReadableStream,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!A}),MV=64*1024,kw=yB&&CB(()=>St.isReadableStream(new Response("").body)),fC={stream:kw&&(S=>S.body)};vC&&(S=>{["text","arrayBuffer","blob","formData","stream"].forEach(A=>{!fC[A]&&(fC[A]=St.isFunction(S[A])?w=>w[A]():(w,b)=>{throw new Fe(`Response type '${A}' is not supported`,Fe.ERR_NOT_SUPPORT,b)})})})(new Response);const Oz=async S=>{if(S==null)return 0;if(St.isBlob(S))return S.size;if(St.isSpecCompliantForm(S))return(await new Request(Gr.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(St.isArrayBufferView(S)||St.isArrayBuffer(S))return S.byteLength;if(St.isURLSearchParams(S)&&(S=S+""),St.isString(S))return(await bz(S)).byteLength},wz=async(S,A)=>{const w=St.toFiniteNumber(S.getContentLength());return w??Oz(A)},Nz=vC&&(async S=>{let{url:A,method:w,data:b,signal:P,cancelToken:x,timeout:H,onDownloadProgress:J,onUploadProgress:X,responseType:G,headers:Z,withCredentials:ot="same-origin",fetchOptions:mt}=vB(S);G=G?(G+"").toLowerCase():"text";let Vt=vz([P,x&&x.toAbortSignal()],H),it;const xt=Vt&&Vt.unsubscribe&&(()=>{Vt.unsubscribe()});let yt;try{if(X&&Iz&&w!=="get"&&w!=="head"&&(yt=await wz(Z,b))!==0){let te=new Request(A,{method:"POST",body:b,duplex:"half"}),fn;if(St.isFormData(b)&&(fn=te.headers.get("content-type"))&&Z.setContentType(fn),te.body){const[Le,Cn]=DV(yt,pC(LV(X)));b=kV(te.body,MV,Le,Cn)}}St.isString(ot)||(ot=ot?"include":"omit");const kt="credentials"in Request.prototype;it=new Request(A,{...mt,signal:Vt,method:w.toUpperCase(),headers:Z.normalize().toJSON(),body:b,duplex:"half",credentials:kt?ot:void 0});let zt=await fetch(it);const Bt=kw&&(G==="stream"||G==="response");if(kw&&(J||Bt&&xt)){const te={};["status","statusText","headers"].forEach(Tn=>{te[Tn]=zt[Tn]});const fn=St.toFiniteNumber(zt.headers.get("content-length")),[Le,Cn]=J&&DV(fn,pC(LV(J),!0))||[];zt=new Response(kV(zt.body,MV,Le,()=>{Cn&&Cn(),xt&&xt()}),te)}G=G||"text";let ie=await fC[St.findKey(fC,G)||"text"](zt,S);return!Bt&&xt&&xt(),await new Promise((te,fn)=>{TB(te,fn,{data:ie,headers:Ta.from(zt.headers),status:zt.status,statusText:zt.statusText,config:S,request:it})})}catch(kt){throw xt&&xt(),kt&&kt.name==="TypeError"&&/Load failed|fetch/i.test(kt.message)?Object.assign(new Fe("Network Error",Fe.ERR_NETWORK,S,it),{cause:kt.cause||kt}):Fe.from(kt,kt&&kt.code,S,it)}}),Mw={http:KY,xhr:Rz,fetch:Nz};St.forEach(Mw,(S,A)=>{if(S){try{Object.defineProperty(S,"name",{value:A})}catch{}Object.defineProperty(S,"adapterName",{value:A})}});const UV=S=>`- ${S}`,Dz=S=>St.isFunction(S)||S===null||S===!1,AB={getAdapter:S=>{S=St.isArray(S)?S:[S];const{length:A}=S;let w,b;const P={};for(let x=0;x<A;x++){w=S[x];let H;if(b=w,!Dz(w)&&(b=Mw[(H=String(w)).toLowerCase()],b===void 0))throw new Fe(`Unknown adapter '${H}'`);if(b)break;P[H||"#"+x]=b}if(!b){const x=Object.entries(P).map(([J,X])=>`adapter ${J} `+(X===!1?"is not supported by the environment":"is not available in the build"));let H=A?x.length>1?`since :
`+x.map(UV).join(`
`):" "+UV(x[0]):"as no adapter specified";throw new Fe("There is no suitable adapter to dispatch the request "+H,"ERR_NOT_SUPPORT")}return b},adapters:Mw};function bw(S){if(S.cancelToken&&S.cancelToken.throwIfRequested(),S.signal&&S.signal.aborted)throw new Im(null,S)}function xV(S){return bw(S),S.headers=Ta.from(S.headers),S.data=Aw.call(S,S.transformRequest),["post","put","patch"].indexOf(S.method)!==-1&&S.headers.setContentType("application/x-www-form-urlencoded",!1),AB.getAdapter(S.adapter||hS.adapter)(S).then(function(b){return bw(S),b.data=Aw.call(S,S.transformResponse,b),b.headers=Ta.from(b.headers),b},function(b){return SB(b)||(bw(S),b&&b.response&&(b.response.data=Aw.call(S,S.transformResponse,b.response),b.response.headers=Ta.from(b.response.headers))),Promise.reject(b)})}const bB="1.9.0",yC={};["object","boolean","number","function","string","symbol"].forEach((S,A)=>{yC[S]=function(b){return typeof b===S||"a"+(A<1?"n ":" ")+S}});const VV={};yC.transitional=function(A,w,b){function P(x,H){return"[Axios v"+bB+"] Transitional option '"+x+"'"+H+(b?". "+b:"")}return(x,H,J)=>{if(A===!1)throw new Fe(P(H," has been removed"+(w?" in "+w:"")),Fe.ERR_DEPRECATED);return w&&!VV[H]&&(VV[H]=!0,console.warn(P(H," has been deprecated since v"+w+" and will be removed in the near future"))),A?A(x,H,J):!0}};yC.spelling=function(A){return(w,b)=>(console.warn(`${b} is likely a misspelling of ${A}`),!0)};function Lz(S,A,w){if(typeof S!="object")throw new Fe("options must be an object",Fe.ERR_BAD_OPTION_VALUE);const b=Object.keys(S);let P=b.length;for(;P-- >0;){const x=b[P],H=A[x];if(H){const J=S[x],X=J===void 0||H(J,x,S);if(X!==!0)throw new Fe("option "+x+" must be "+X,Fe.ERR_BAD_OPTION_VALUE);continue}if(w!==!0)throw new Fe("Unknown option "+x,Fe.ERR_BAD_OPTION)}}const dC={assertOptions:Lz,validators:yC},fc=dC.validators;let Ph=class{constructor(A){this.defaults=A||{},this.interceptors={request:new wV,response:new wV}}async request(A,w){try{return await this._request(A,w)}catch(b){if(b instanceof Error){let P={};Error.captureStackTrace?Error.captureStackTrace(P):P=new Error;const x=P.stack?P.stack.replace(/^.+\n/,""):"";try{b.stack?x&&!String(b.stack).endsWith(x.replace(/^.+\n.+\n/,""))&&(b.stack+=`
`+x):b.stack=x}catch{}}throw b}}_request(A,w){typeof A=="string"?(w=w||{},w.url=A):w=A||{},w=kh(this.defaults,w);const{transitional:b,paramsSerializer:P,headers:x}=w;b!==void 0&&dC.assertOptions(b,{silentJSONParsing:fc.transitional(fc.boolean),forcedJSONParsing:fc.transitional(fc.boolean),clarifyTimeoutError:fc.transitional(fc.boolean)},!1),P!=null&&(St.isFunction(P)?w.paramsSerializer={serialize:P}:dC.assertOptions(P,{encode:fc.function,serialize:fc.function},!0)),w.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?w.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:w.allowAbsoluteUrls=!0),dC.assertOptions(w,{baseUrl:fc.spelling("baseURL"),withXsrfToken:fc.spelling("withXSRFToken")},!0),w.method=(w.method||this.defaults.method||"get").toLowerCase();let H=x&&St.merge(x.common,x[w.method]);x&&St.forEach(["delete","get","head","post","put","patch","common"],it=>{delete x[it]}),w.headers=Ta.concat(H,x);const J=[];let X=!0;this.interceptors.request.forEach(function(xt){typeof xt.runWhen=="function"&&xt.runWhen(w)===!1||(X=X&&xt.synchronous,J.unshift(xt.fulfilled,xt.rejected))});const G=[];this.interceptors.response.forEach(function(xt){G.push(xt.fulfilled,xt.rejected)});let Z,ot=0,mt;if(!X){const it=[xV.bind(this),void 0];for(it.unshift.apply(it,J),it.push.apply(it,G),mt=it.length,Z=Promise.resolve(w);ot<mt;)Z=Z.then(it[ot++],it[ot++]);return Z}mt=J.length;let Vt=w;for(ot=0;ot<mt;){const it=J[ot++],xt=J[ot++];try{Vt=it(Vt)}catch(yt){xt.call(this,yt);break}}try{Z=xV.call(this,Vt)}catch(it){return Promise.reject(it)}for(ot=0,mt=G.length;ot<mt;)Z=Z.then(G[ot++],G[ot++]);return Z}getUri(A){A=kh(this.defaults,A);const w=RB(A.baseURL,A.url,A.allowAbsoluteUrls);return _B(w,A.params,A.paramsSerializer)}};St.forEach(["delete","get","head","options"],function(A){Ph.prototype[A]=function(w,b){return this.request(kh(b||{},{method:A,url:w,data:(b||{}).data}))}});St.forEach(["post","put","patch"],function(A){function w(b){return function(x,H,J){return this.request(kh(J||{},{method:A,headers:b?{"Content-Type":"multipart/form-data"}:{},url:x,data:H}))}}Ph.prototype[A]=w(),Ph.prototype[A+"Form"]=w(!0)});let Pz=class IB{constructor(A){if(typeof A!="function")throw new TypeError("executor must be a function.");let w;this.promise=new Promise(function(x){w=x});const b=this;this.promise.then(P=>{if(!b._listeners)return;let x=b._listeners.length;for(;x-- >0;)b._listeners[x](P);b._listeners=null}),this.promise.then=P=>{let x;const H=new Promise(J=>{b.subscribe(J),x=J}).then(P);return H.cancel=function(){b.unsubscribe(x)},H},A(function(x,H,J){b.reason||(b.reason=new Im(x,H,J),w(b.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(A){if(this.reason){A(this.reason);return}this._listeners?this._listeners.push(A):this._listeners=[A]}unsubscribe(A){if(!this._listeners)return;const w=this._listeners.indexOf(A);w!==-1&&this._listeners.splice(w,1)}toAbortSignal(){const A=new AbortController,w=b=>{A.abort(b)};return this.subscribe(w),A.signal.unsubscribe=()=>this.unsubscribe(w),A.signal}static source(){let A;return{token:new IB(function(P){A=P}),cancel:A}}};function kz(S){return function(w){return S.apply(null,w)}}function Mz(S){return St.isObject(S)&&S.isAxiosError===!0}const Uw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Uw).forEach(([S,A])=>{Uw[A]=S});function OB(S){const A=new Ph(S),w=rB(Ph.prototype.request,A);return St.extend(w,Ph.prototype,A,{allOwnKeys:!0}),St.extend(w,A,null,{allOwnKeys:!0}),w.create=function(P){return OB(kh(S,P))},w}const Fi=OB(hS);Fi.Axios=Ph;Fi.CanceledError=Im;Fi.CancelToken=Pz;Fi.isCancel=SB;Fi.VERSION=bB;Fi.toFormData=RC;Fi.AxiosError=Fe;Fi.Cancel=Fi.CanceledError;Fi.all=function(A){return Promise.all(A)};Fi.spread=kz;Fi.isAxiosError=Mz;Fi.mergeConfig=kh;Fi.AxiosHeaders=Ta;Fi.formToJSON=S=>gB(St.isHTMLForm(S)?new FormData(S):S);Fi.getAdapter=AB.getAdapter;Fi.HttpStatusCode=Uw;Fi.default=Fi;const{Axios:Gz,AxiosError:Hz,CanceledError:Wz,isCancel:Kz,CancelToken:Yz,VERSION:zz,all:qz,Cancel:Xz,isAxiosError:Jz,spread:Qz,toFormData:Zz,AxiosHeaders:$z,HttpStatusCode:tq,formToJSON:eq,getAdapter:nq,mergeConfig:iq}=Fi,Uz="https://zuba.minidog.club/",Iw=async(S,A)=>{var w,b;try{return(await Fi.post(`${Uz}${S}`,A,{headers:{"Content-Type":"application/json"}})).data}catch(P){return{status:"error",data:((b=(w=P.response)==null?void 0:w.data)==null?void 0:b.message)||P.message||"Unknown error"}}},xz=()=>{const S=xu(),A=new URLSearchParams(S.search),w=A.get("chanel"),b=A.get("username"),P=A.get("callId");A.get("userType");const x=A.get("callType"),H=A.get("notificationId"),[J,X]=Ot.useState(!1),[G,Z]=Ot.useState([]),[ot,mt]=Ot.useState(0),[Vt,it]=Ot.useState(null),[xt,yt]=Ot.useState(!1),[kt,zt]=Ot.useState(!1),Bt=Ot.useRef(null),ie=Ot.useRef(null),te="740baf604340463486afea8a267cc8e8",fn=null,Le=async()=>{ie.current=AV.createClient({mode:"rtc",codec:"h264"}),ie.current.on("user-published",Tn),ie.current.on("user-left",oi),await ie.current.join(te,w,fn,null);const An=await AV.createMicrophoneAudioTrack({encoderConfig:{bitrate:128,sampleRate:48e3,stereo:!0,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});Bt.current=An,await ie.current.publish([An]),X(!0),it(new Date)},Cn=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}),await Le(),await Iw("call/accept",{callId:P})}catch(An){console.error("Error joining call:",An)}},Tn=async(An,Qe)=>{Qe==="audio"&&(await ie.current.subscribe(An,"audio"),An.audioTrack.play(),Z(In=>In.some(gt=>gt.uid===An.uid)?In:[...In,An]))},oi=async An=>{zt(!0),An.audioTrack&&(An.audioTrack.stop(),An.audioTrack.close()),await ie.current.unsubscribe(An,"audio"),Z(Qe=>Qe.filter(In=>In.uid!==An.uid)),await Iw("call/end",{callId:P})},er=async()=>{Bt.current&&(Bt.current.stop(),Bt.current.close()),ie.current&&await ie.current.leave(),await Iw("call/end",{callId:P}),window.location.href="myapp://endcall"};Ot.useEffect(()=>{let An;return Vt&&(An=setInterval(()=>{mt(Math.floor((new Date-Vt)/1e3))},1e3)),()=>clearInterval(An)},[Vt]),Ot.useEffect(()=>{kt&&(window.location.href="myapp://endcall")},[kt]),Ot.useEffect(()=>{x==="caller"&&Cn()},[]),Ot.useEffect(()=>()=>{ie.current&&(ie.current.off("user-published",Tn),ie.current.off("user-left",oi))},[]);const pi=An=>{const Qe=Math.floor(An/60),In=An%60;return`${Qe}m ${In}s`};return $n.jsxs($n.Fragment,{children:[$n.jsxs("div",{className:"header",children:[$n.jsx("img",{src:"https://rich143.com/images/newfavicon.svg",className:"profile-img",alt:"Profile"}),$n.jsxs("div",{children:[$n.jsxs("div",{className:"username",children:[b," , notificationId- ",H]}),$n.jsx("div",{className:"status",children:"Online"})]})]}),$n.jsx("div",{className:"logo",children:$n.jsx("img",{src:"https://rich143.com/static/media/updatedlogo.778bb66b8ac72949874f0c8180098037.svg",className:"img-fluid w-75",alt:"Logo"})}),$n.jsx("div",{className:"timer my-5 text-bold username h1",children:pi(ot)}),$n.jsxs("div",{className:"d-flex justify-content-center gap-5  margin-buttons",children:[x!=="caller"&&$n.jsx("button",{onClick:Cn,className:"btn btn-success d-flex align-items-center justify-content-center call-button red-pulse  mx-5",children:$n.jsx("i",{className:"fas fa-phone"})}),$n.jsx("button",{onClick:er,className:"btn btn-danger d-flex align-items-center justify-content-center call-button  mx-5",children:$n.jsx("i",{className:"fas fa-phone-slash"})})]})]})},Vz=()=>$n.jsx("div",{children:"testing"}),Bz=()=>$n.jsx($n.Fragment,{children:$n.jsx(BK,{children:$n.jsxs(mK,{children:[$n.jsx(ww,{path:"/main",element:$n.jsx(xz,{})}),$n.jsx(ww,{path:"/",element:$n.jsx(Vz,{})})]})})});nY.createRoot(document.getElementById("root")).render($n.jsx(C8.StrictMode,{children:$n.jsx(Bz,{})}));
