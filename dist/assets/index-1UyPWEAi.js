(function(){const Xn=document.createElement("link").relList;if(Xn&&Xn.supports&&Xn.supports("modulepreload"))return;for(const Vt of document.querySelectorAll('link[rel="modulepreload"]'))et(Vt);new MutationObserver(Vt=>{for(const Xt of Vt)if(Xt.type==="childList")for(const Pn of Xt.addedNodes)Pn.tagName==="LINK"&&Pn.rel==="modulepreload"&&et(Pn)}).observe(document,{childList:!0,subtree:!0});function on(Vt){const Xt={};return Vt.integrity&&(Xt.integrity=Vt.integrity),Vt.referrerPolicy&&(Xt.referrerPolicy=Vt.referrerPolicy),Vt.crossOrigin==="use-credentials"?Xt.credentials="include":Vt.crossOrigin==="anonymous"?Xt.credentials="omit":Xt.credentials="same-origin",Xt}function et(Vt){if(Vt.ep)return;Vt.ep=!0;const Xt=on(Vt);fetch(Vt.href,Xt)}})();var gO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function CO(kt){return kt&&kt.__esModule&&Object.prototype.hasOwnProperty.call(kt,"default")?kt.default:kt}var SO={exports:{}},Ie={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j2;function KH(){if(j2)return Ie;j2=1;var kt=Symbol.for("react.transitional.element"),Xn=Symbol.for("react.portal"),on=Symbol.for("react.fragment"),et=Symbol.for("react.strict_mode"),Vt=Symbol.for("react.profiler"),Xt=Symbol.for("react.consumer"),Pn=Symbol.for("react.context"),Xi=Symbol.for("react.forward_ref"),Ft=Symbol.for("react.suspense"),St=Symbol.for("react.memo"),xt=Symbol.for("react.lazy"),Mt=Symbol.iterator;function ue(H){return H===null||typeof H!="object"?null:(H=Mt&&H[Mt]||H["@@iterator"],typeof H=="function"?H:null)}var ai={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_e=Object.assign,Nr={};function bi(H,Tt,Lt){this.props=H,this.context=Tt,this.refs=Nr,this.updater=Lt||ai}bi.prototype.isReactComponent={},bi.prototype.setState=function(H,Tt){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,Tt,"setState")},bi.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function la(){}la.prototype=bi.prototype;function Dr(H,Tt,Lt){this.props=H,this.context=Tt,this.refs=Nr,this.updater=Lt||ai}var Jn=Dr.prototype=new la;Jn.constructor=Dr,_e(Jn,bi.prototype),Jn.isPureReactComponent=!0;var dr=Array.isArray,je={H:null,A:null,T:null,S:null,V:null},Ae=Object.prototype.hasOwnProperty;function dn(H,Tt,Lt,Ot,Bt,Ue){return Lt=Ue.ref,{$$typeof:kt,type:H,key:Tt,ref:Lt!==void 0?Lt:null,props:Ue}}function Qn(H,Tt){return dn(H.type,Tt,void 0,void 0,void 0,H.props)}function da(H){return typeof H=="object"&&H!==null&&H.$$typeof===kt}function Wr(H){var Tt={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(Lt){return Tt[Lt]})}var ua=/\/+/g;function mi(H,Tt){return typeof H=="object"&&H!==null&&H.key!=null?Wr(""+H.key):Tt.toString(36)}function ac(){}function cn(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(ac,ac):(H.status="pending",H.then(function(Tt){H.status==="pending"&&(H.status="fulfilled",H.value=Tt)},function(Tt){H.status==="pending"&&(H.status="rejected",H.reason=Tt)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function si(H,Tt,Lt,Ot,Bt){var Ue=typeof H;(Ue==="undefined"||Ue==="boolean")&&(H=null);var Zt=!1;if(H===null)Zt=!0;else switch(Ue){case"bigint":case"string":case"number":Zt=!0;break;case"object":switch(H.$$typeof){case kt:case Xn:Zt=!0;break;case xt:return Zt=H._init,si(Zt(H._payload),Tt,Lt,Ot,Bt)}}if(Zt)return Bt=Bt(H),Zt=Ot===""?"."+mi(H,0):Ot,dr(Bt)?(Lt="",Zt!=null&&(Lt=Zt.replace(ua,"$&/")+"/"),si(Bt,Tt,Lt,"",function(Ua){return Ua})):Bt!=null&&(da(Bt)&&(Bt=Qn(Bt,Lt+(Bt.key==null||H&&H.key===Bt.key?"":(""+Bt.key).replace(ua,"$&/")+"/")+Zt)),Tt.push(Bt)),1;Zt=0;var Lr=Ot===""?".":Ot+":";if(dr(H))for(var kn=0;kn<H.length;kn++)Ot=H[kn],Ue=Lr+mi(Ot,kn),Zt+=si(Ot,Tt,Lt,Ue,Bt);else if(kn=ue(H),typeof kn=="function")for(H=kn.call(H),kn=0;!(Ot=H.next()).done;)Ot=Ot.value,Ue=Lr+mi(Ot,kn++),Zt+=si(Ot,Tt,Lt,Ue,Bt);else if(Ue==="object"){if(typeof H.then=="function")return si(cn(H),Tt,Lt,Ot,Bt);throw Tt=String(H),Error("Objects are not valid as a React child (found: "+(Tt==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":Tt)+"). If you meant to render a collection of children, use an array instead.")}return Zt}function ot(H,Tt,Lt){if(H==null)return H;var Ot=[],Bt=0;return si(H,Ot,"","",function(Ue){return Tt.call(Lt,Ue,Bt++)}),Ot}function Nt(H){if(H._status===-1){var Tt=H._result;Tt=Tt(),Tt.then(function(Lt){(H._status===0||H._status===-1)&&(H._status=1,H._result=Lt)},function(Lt){(H._status===0||H._status===-1)&&(H._status=2,H._result=Lt)}),H._status===-1&&(H._status=0,H._result=Tt)}if(H._status===1)return H._result.default;throw H._result}var Jt=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Tt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(Tt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)};function se(){}return Ie.Children={map:ot,forEach:function(H,Tt,Lt){ot(H,function(){Tt.apply(this,arguments)},Lt)},count:function(H){var Tt=0;return ot(H,function(){Tt++}),Tt},toArray:function(H){return ot(H,function(Tt){return Tt})||[]},only:function(H){if(!da(H))throw Error("React.Children.only expected to receive a single React element child.");return H}},Ie.Component=bi,Ie.Fragment=on,Ie.Profiler=Vt,Ie.PureComponent=Dr,Ie.StrictMode=et,Ie.Suspense=Ft,Ie.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=je,Ie.__COMPILER_RUNTIME={__proto__:null,c:function(H){return je.H.useMemoCache(H)}},Ie.cache=function(H){return function(){return H.apply(null,arguments)}},Ie.cloneElement=function(H,Tt,Lt){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var Ot=_e({},H.props),Bt=H.key,Ue=void 0;if(Tt!=null)for(Zt in Tt.ref!==void 0&&(Ue=void 0),Tt.key!==void 0&&(Bt=""+Tt.key),Tt)!Ae.call(Tt,Zt)||Zt==="key"||Zt==="__self"||Zt==="__source"||Zt==="ref"&&Tt.ref===void 0||(Ot[Zt]=Tt[Zt]);var Zt=arguments.length-2;if(Zt===1)Ot.children=Lt;else if(1<Zt){for(var Lr=Array(Zt),kn=0;kn<Zt;kn++)Lr[kn]=arguments[kn+2];Ot.children=Lr}return dn(H.type,Bt,void 0,void 0,Ue,Ot)},Ie.createContext=function(H){return H={$$typeof:Pn,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:Xt,_context:H},H},Ie.createElement=function(H,Tt,Lt){var Ot,Bt={},Ue=null;if(Tt!=null)for(Ot in Tt.key!==void 0&&(Ue=""+Tt.key),Tt)Ae.call(Tt,Ot)&&Ot!=="key"&&Ot!=="__self"&&Ot!=="__source"&&(Bt[Ot]=Tt[Ot]);var Zt=arguments.length-2;if(Zt===1)Bt.children=Lt;else if(1<Zt){for(var Lr=Array(Zt),kn=0;kn<Zt;kn++)Lr[kn]=arguments[kn+2];Bt.children=Lr}if(H&&H.defaultProps)for(Ot in Zt=H.defaultProps,Zt)Bt[Ot]===void 0&&(Bt[Ot]=Zt[Ot]);return dn(H,Ue,void 0,void 0,null,Bt)},Ie.createRef=function(){return{current:null}},Ie.forwardRef=function(H){return{$$typeof:Xi,render:H}},Ie.isValidElement=da,Ie.lazy=function(H){return{$$typeof:xt,_payload:{_status:-1,_result:H},_init:Nt}},Ie.memo=function(H,Tt){return{$$typeof:St,type:H,compare:Tt===void 0?null:Tt}},Ie.startTransition=function(H){var Tt=je.T,Lt={};je.T=Lt;try{var Ot=H(),Bt=je.S;Bt!==null&&Bt(Lt,Ot),typeof Ot=="object"&&Ot!==null&&typeof Ot.then=="function"&&Ot.then(se,Jt)}catch(Ue){Jt(Ue)}finally{je.T=Tt}},Ie.unstable_useCacheRefresh=function(){return je.H.useCacheRefresh()},Ie.use=function(H){return je.H.use(H)},Ie.useActionState=function(H,Tt,Lt){return je.H.useActionState(H,Tt,Lt)},Ie.useCallback=function(H,Tt){return je.H.useCallback(H,Tt)},Ie.useContext=function(H){return je.H.useContext(H)},Ie.useDebugValue=function(){},Ie.useDeferredValue=function(H,Tt){return je.H.useDeferredValue(H,Tt)},Ie.useEffect=function(H,Tt,Lt){var Ot=je.H;if(typeof Lt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ot.useEffect(H,Tt)},Ie.useId=function(){return je.H.useId()},Ie.useImperativeHandle=function(H,Tt,Lt){return je.H.useImperativeHandle(H,Tt,Lt)},Ie.useInsertionEffect=function(H,Tt){return je.H.useInsertionEffect(H,Tt)},Ie.useLayoutEffect=function(H,Tt){return je.H.useLayoutEffect(H,Tt)},Ie.useMemo=function(H,Tt){return je.H.useMemo(H,Tt)},Ie.useOptimistic=function(H,Tt){return je.H.useOptimistic(H,Tt)},Ie.useReducer=function(H,Tt,Lt){return je.H.useReducer(H,Tt,Lt)},Ie.useRef=function(H){return je.H.useRef(H)},Ie.useState=function(H){return je.H.useState(H)},Ie.useSyncExternalStore=function(H,Tt,Lt){return je.H.useSyncExternalStore(H,Tt,Lt)},Ie.useTransition=function(){return je.H.useTransition()},Ie.version="19.1.0",Ie}var G2;function AO(){return G2||(G2=1,SO.exports=KH()),SO.exports}var rc=AO();const lr=CO(rc);var TO={exports:{}},Lg={},RO={exports:{}},vO={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H2;function YH(){return H2||(H2=1,function(kt){function Xn(ot,Nt){var Jt=ot.length;ot.push(Nt);t:for(;0<Jt;){var se=Jt-1>>>1,H=ot[se];if(0<Vt(H,Nt))ot[se]=Nt,ot[Jt]=H,Jt=se;else break t}}function on(ot){return ot.length===0?null:ot[0]}function et(ot){if(ot.length===0)return null;var Nt=ot[0],Jt=ot.pop();if(Jt!==Nt){ot[0]=Jt;t:for(var se=0,H=ot.length,Tt=H>>>1;se<Tt;){var Lt=2*(se+1)-1,Ot=ot[Lt],Bt=Lt+1,Ue=ot[Bt];if(0>Vt(Ot,Jt))Bt<H&&0>Vt(Ue,Ot)?(ot[se]=Ue,ot[Bt]=Jt,se=Bt):(ot[se]=Ot,ot[Lt]=Jt,se=Lt);else if(Bt<H&&0>Vt(Ue,Jt))ot[se]=Ue,ot[Bt]=Jt,se=Bt;else break t}}return Nt}function Vt(ot,Nt){var Jt=ot.sortIndex-Nt.sortIndex;return Jt!==0?Jt:ot.id-Nt.id}if(kt.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var Xt=performance;kt.unstable_now=function(){return Xt.now()}}else{var Pn=Date,Xi=Pn.now();kt.unstable_now=function(){return Pn.now()-Xi}}var Ft=[],St=[],xt=1,Mt=null,ue=3,ai=!1,_e=!1,Nr=!1,bi=!1,la=typeof setTimeout=="function"?setTimeout:null,Dr=typeof clearTimeout=="function"?clearTimeout:null,Jn=typeof setImmediate<"u"?setImmediate:null;function dr(ot){for(var Nt=on(St);Nt!==null;){if(Nt.callback===null)et(St);else if(Nt.startTime<=ot)et(St),Nt.sortIndex=Nt.expirationTime,Xn(Ft,Nt);else break;Nt=on(St)}}function je(ot){if(Nr=!1,dr(ot),!_e)if(on(Ft)!==null)_e=!0,Ae||(Ae=!0,mi());else{var Nt=on(St);Nt!==null&&si(je,Nt.startTime-ot)}}var Ae=!1,dn=-1,Qn=5,da=-1;function Wr(){return bi?!0:!(kt.unstable_now()-da<Qn)}function ua(){if(bi=!1,Ae){var ot=kt.unstable_now();da=ot;var Nt=!0;try{t:{_e=!1,Nr&&(Nr=!1,Dr(dn),dn=-1),ai=!0;var Jt=ue;try{e:{for(dr(ot),Mt=on(Ft);Mt!==null&&!(Mt.expirationTime>ot&&Wr());){var se=Mt.callback;if(typeof se=="function"){Mt.callback=null,ue=Mt.priorityLevel;var H=se(Mt.expirationTime<=ot);if(ot=kt.unstable_now(),typeof H=="function"){Mt.callback=H,dr(ot),Nt=!0;break e}Mt===on(Ft)&&et(Ft),dr(ot)}else et(Ft);Mt=on(Ft)}if(Mt!==null)Nt=!0;else{var Tt=on(St);Tt!==null&&si(je,Tt.startTime-ot),Nt=!1}}break t}finally{Mt=null,ue=Jt,ai=!1}Nt=void 0}}finally{Nt?mi():Ae=!1}}}var mi;if(typeof Jn=="function")mi=function(){Jn(ua)};else if(typeof MessageChannel<"u"){var ac=new MessageChannel,cn=ac.port2;ac.port1.onmessage=ua,mi=function(){cn.postMessage(null)}}else mi=function(){la(ua,0)};function si(ot,Nt){dn=la(function(){ot(kt.unstable_now())},Nt)}kt.unstable_IdlePriority=5,kt.unstable_ImmediatePriority=1,kt.unstable_LowPriority=4,kt.unstable_NormalPriority=3,kt.unstable_Profiling=null,kt.unstable_UserBlockingPriority=2,kt.unstable_cancelCallback=function(ot){ot.callback=null},kt.unstable_forceFrameRate=function(ot){0>ot||125<ot?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Qn=0<ot?Math.floor(1e3/ot):5},kt.unstable_getCurrentPriorityLevel=function(){return ue},kt.unstable_next=function(ot){switch(ue){case 1:case 2:case 3:var Nt=3;break;default:Nt=ue}var Jt=ue;ue=Nt;try{return ot()}finally{ue=Jt}},kt.unstable_requestPaint=function(){bi=!0},kt.unstable_runWithPriority=function(ot,Nt){switch(ot){case 1:case 2:case 3:case 4:case 5:break;default:ot=3}var Jt=ue;ue=ot;try{return Nt()}finally{ue=Jt}},kt.unstable_scheduleCallback=function(ot,Nt,Jt){var se=kt.unstable_now();switch(typeof Jt=="object"&&Jt!==null?(Jt=Jt.delay,Jt=typeof Jt=="number"&&0<Jt?se+Jt:se):Jt=se,ot){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=Jt+H,ot={id:xt++,callback:Nt,priorityLevel:ot,startTime:Jt,expirationTime:H,sortIndex:-1},Jt>se?(ot.sortIndex=Jt,Xn(St,ot),on(Ft)===null&&ot===on(St)&&(Nr?(Dr(dn),dn=-1):Nr=!0,si(je,Jt-se))):(ot.sortIndex=H,Xn(Ft,ot),_e||ai||(_e=!0,Ae||(Ae=!0,mi()))),ot},kt.unstable_shouldYield=Wr,kt.unstable_wrapCallback=function(ot){var Nt=ue;return function(){var Jt=ue;ue=Nt;try{return ot.apply(this,arguments)}finally{ue=Jt}}}}(vO)),vO}var W2;function zH(){return W2||(W2=1,RO.exports=YH()),RO.exports}var yO={exports:{}},wr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K2;function qH(){if(K2)return wr;K2=1;var kt=AO();function Xn(Ft){var St="https://react.dev/errors/"+Ft;if(1<arguments.length){St+="?args[]="+encodeURIComponent(arguments[1]);for(var xt=2;xt<arguments.length;xt++)St+="&args[]="+encodeURIComponent(arguments[xt])}return"Minified React error #"+Ft+"; visit "+St+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function on(){}var et={d:{f:on,r:function(){throw Error(Xn(522))},D:on,C:on,L:on,m:on,X:on,S:on,M:on},p:0,findDOMNode:null},Vt=Symbol.for("react.portal");function Xt(Ft,St,xt){var Mt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Vt,key:Mt==null?null:""+Mt,children:Ft,containerInfo:St,implementation:xt}}var Pn=kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Xi(Ft,St){if(Ft==="font")return"";if(typeof St=="string")return St==="use-credentials"?St:""}return wr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=et,wr.createPortal=function(Ft,St){var xt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!St||St.nodeType!==1&&St.nodeType!==9&&St.nodeType!==11)throw Error(Xn(299));return Xt(Ft,St,null,xt)},wr.flushSync=function(Ft){var St=Pn.T,xt=et.p;try{if(Pn.T=null,et.p=2,Ft)return Ft()}finally{Pn.T=St,et.p=xt,et.d.f()}},wr.preconnect=function(Ft,St){typeof Ft=="string"&&(St?(St=St.crossOrigin,St=typeof St=="string"?St==="use-credentials"?St:"":void 0):St=null,et.d.C(Ft,St))},wr.prefetchDNS=function(Ft){typeof Ft=="string"&&et.d.D(Ft)},wr.preinit=function(Ft,St){if(typeof Ft=="string"&&St&&typeof St.as=="string"){var xt=St.as,Mt=Xi(xt,St.crossOrigin),ue=typeof St.integrity=="string"?St.integrity:void 0,ai=typeof St.fetchPriority=="string"?St.fetchPriority:void 0;xt==="style"?et.d.S(Ft,typeof St.precedence=="string"?St.precedence:void 0,{crossOrigin:Mt,integrity:ue,fetchPriority:ai}):xt==="script"&&et.d.X(Ft,{crossOrigin:Mt,integrity:ue,fetchPriority:ai,nonce:typeof St.nonce=="string"?St.nonce:void 0})}},wr.preinitModule=function(Ft,St){if(typeof Ft=="string")if(typeof St=="object"&&St!==null){if(St.as==null||St.as==="script"){var xt=Xi(St.as,St.crossOrigin);et.d.M(Ft,{crossOrigin:xt,integrity:typeof St.integrity=="string"?St.integrity:void 0,nonce:typeof St.nonce=="string"?St.nonce:void 0})}}else St==null&&et.d.M(Ft)},wr.preload=function(Ft,St){if(typeof Ft=="string"&&typeof St=="object"&&St!==null&&typeof St.as=="string"){var xt=St.as,Mt=Xi(xt,St.crossOrigin);et.d.L(Ft,xt,{crossOrigin:Mt,integrity:typeof St.integrity=="string"?St.integrity:void 0,nonce:typeof St.nonce=="string"?St.nonce:void 0,type:typeof St.type=="string"?St.type:void 0,fetchPriority:typeof St.fetchPriority=="string"?St.fetchPriority:void 0,referrerPolicy:typeof St.referrerPolicy=="string"?St.referrerPolicy:void 0,imageSrcSet:typeof St.imageSrcSet=="string"?St.imageSrcSet:void 0,imageSizes:typeof St.imageSizes=="string"?St.imageSizes:void 0,media:typeof St.media=="string"?St.media:void 0})}},wr.preloadModule=function(Ft,St){if(typeof Ft=="string")if(St){var xt=Xi(St.as,St.crossOrigin);et.d.m(Ft,{as:typeof St.as=="string"&&St.as!=="script"?St.as:void 0,crossOrigin:xt,integrity:typeof St.integrity=="string"?St.integrity:void 0})}else et.d.m(Ft)},wr.requestFormReset=function(Ft){et.d.r(Ft)},wr.unstable_batchedUpdates=function(Ft,St){return Ft(St)},wr.useFormState=function(Ft,St,xt){return Pn.H.useFormState(Ft,St,xt)},wr.useFormStatus=function(){return Pn.H.useHostTransitionStatus()},wr.version="19.1.0",wr}var Y2;function XH(){if(Y2)return yO.exports;Y2=1;function kt(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kt)}catch(Xn){console.error(Xn)}}return kt(),yO.exports=qH(),yO.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z2;function JH(){if(z2)return Lg;z2=1;var kt=zH(),Xn=AO(),on=XH();function et(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Vt(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Xt(a){var o=a,d=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(d=o.return),a=o.return;while(a)}return o.tag===3?d:null}function Pn(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function Xi(a){if(Xt(a)!==a)throw Error(et(188))}function Ft(a){var o=a.alternate;if(!o){if(o=Xt(a),o===null)throw Error(et(188));return o!==a?null:a}for(var d=a,f=o;;){var m=d.return;if(m===null)break;var T=m.alternate;if(T===null){if(f=m.return,f!==null){d=f;continue}break}if(m.child===T.child){for(T=m.child;T;){if(T===d)return Xi(m),a;if(T===f)return Xi(m),o;T=T.sibling}throw Error(et(188))}if(d.return!==f.return)d=m,f=T;else{for(var w=!1,P=m.child;P;){if(P===d){w=!0,d=m,f=T;break}if(P===f){w=!0,f=m,d=T;break}P=P.sibling}if(!w){for(P=T.child;P;){if(P===d){w=!0,d=T,f=m;break}if(P===f){w=!0,f=T,d=m;break}P=P.sibling}if(!w)throw Error(et(189))}}if(d.alternate!==f)throw Error(et(190))}if(d.tag!==3)throw Error(et(188));return d.stateNode.current===d?a:o}function St(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=St(a),o!==null)return o;a=a.sibling}return null}var xt=Object.assign,Mt=Symbol.for("react.element"),ue=Symbol.for("react.transitional.element"),ai=Symbol.for("react.portal"),_e=Symbol.for("react.fragment"),Nr=Symbol.for("react.strict_mode"),bi=Symbol.for("react.profiler"),la=Symbol.for("react.provider"),Dr=Symbol.for("react.consumer"),Jn=Symbol.for("react.context"),dr=Symbol.for("react.forward_ref"),je=Symbol.for("react.suspense"),Ae=Symbol.for("react.suspense_list"),dn=Symbol.for("react.memo"),Qn=Symbol.for("react.lazy"),da=Symbol.for("react.activity"),Wr=Symbol.for("react.memo_cache_sentinel"),ua=Symbol.iterator;function mi(a){return a===null||typeof a!="object"?null:(a=ua&&a[ua]||a["@@iterator"],typeof a=="function"?a:null)}var ac=Symbol.for("react.client.reference");function cn(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ac?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case _e:return"Fragment";case bi:return"Profiler";case Nr:return"StrictMode";case je:return"Suspense";case Ae:return"SuspenseList";case da:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case ai:return"Portal";case Jn:return(a.displayName||"Context")+".Provider";case Dr:return(a._context.displayName||"Context")+".Consumer";case dr:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case dn:return o=a.displayName||null,o!==null?o:cn(a.type)||"Memo";case Qn:o=a._payload,a=a._init;try{return cn(a(o))}catch{}}return null}var si=Array.isArray,ot=Xn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Nt=on.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Jt={pending:!1,data:null,method:null,action:null},se=[],H=-1;function Tt(a){return{current:a}}function Lt(a){0>H||(a.current=se[H],se[H]=null,H--)}function Ot(a,o){H++,se[H]=a.current,a.current=o}var Bt=Tt(null),Ue=Tt(null),Zt=Tt(null),Lr=Tt(null);function kn(a,o){switch(Ot(Zt,o),Ot(Ue,a),Ot(Bt,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?GT(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=GT(o),a=HT(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Lt(Bt),Ot(Bt,a)}function Ua(){Lt(Bt),Lt(Ue),Lt(Zt)}function s_(a){a.memoizedState!==null&&Ot(Lr,a);var o=Bt.current,d=HT(o,a.type);o!==d&&(Ot(Ue,a),Ot(Bt,d))}function sc(a){Ue.current===a&&(Lt(Bt),Lt(Ue)),Lr.current===a&&(Lt(Lr),ql._currentValue=Jt)}var eo=Object.prototype.hasOwnProperty,o_=kt.unstable_scheduleCallback,c_=kt.unstable_cancelCallback,tl=kt.unstable_shouldYield,Iy=kt.unstable_requestPaint,xa=kt.unstable_now,no=kt.unstable_getCurrentPriorityLevel,l_=kt.unstable_ImmediatePriority,kg=kt.unstable_UserBlockingPriority,Ni=kt.unstable_NormalPriority,Pr=kt.unstable_LowPriority,mh=kt.unstable_IdlePriority,d_=kt.log,Oy=kt.unstable_setDisableYieldValue,el=null,gn=null;function Ji(a){if(typeof d_=="function"&&Oy(a),gn&&typeof gn.setStrictMode=="function")try{gn.setStrictMode(el,a)}catch{}}var ur=Math.clz32?Math.clz32:Ug,u_=Math.log,Mg=Math.LN2;function Ug(a){return a>>>=0,a===0?32:31-(u_(a)/Mg|0)|0}var yd=256,Cd=4194304;function kr(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ad(a,o,d){var f=a.pendingLanes;if(f===0)return 0;var m=0,T=a.suspendedLanes,w=a.pingedLanes;a=a.warmLanes;var P=f&134217727;return P!==0?(f=P&~T,f!==0?m=kr(f):(w&=P,w!==0?m=kr(w):d||(d=P&~a,d!==0&&(m=kr(d))))):(P=f&~T,P!==0?m=kr(P):w!==0?m=kr(w):d||(d=f&~a,d!==0&&(m=kr(d)))),m===0?0:o!==0&&o!==m&&(o&T)===0&&(T=m&-m,d=o&-o,T>=d||T===32&&(d&4194048)!==0)?o:m}function bd(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function wy(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oc(){var a=yd;return yd<<=1,(yd&4194048)===0&&(yd=256),a}function h_(){var a=Cd;return Cd<<=1,(Cd&62914560)===0&&(Cd=4194304),a}function p_(a){for(var o=[],d=0;31>d;d++)o.push(a);return o}function Id(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ny(a,o,d,f,m,T){var w=a.pendingLanes;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=d,a.entangledLanes&=d,a.errorRecoveryDisabledLanes&=d,a.shellSuspendCounter=0;var P=a.entanglements,F=a.expirationTimes,Q=a.hiddenUpdates;for(d=w&~d;0<d;){var rt=31-ur(d),_t=1<<rt;P[rt]=0,F[rt]=-1;var $=Q[rt];if($!==null)for(Q[rt]=null,rt=0;rt<$.length;rt++){var tt=$[rt];tt!==null&&(tt.lane&=-536870913)}d&=~_t}f!==0&&xg(a,f,0),T!==0&&m===0&&a.tag!==0&&(a.suspendedLanes|=T&~(w&~o))}function xg(a,o,d){a.pendingLanes|=o,a.suspendedLanes&=~o;var f=31-ur(o);a.entangledLanes|=o,a.entanglements[f]=a.entanglements[f]|1073741824|d&4194090}function nl(a,o){var d=a.entangledLanes|=o;for(a=a.entanglements;d;){var f=31-ur(d),m=1<<f;m&o|a[f]&o&&(a[f]|=o),d&=~m}}function f_(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function io(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Vg(){var a=Nt.p;return a!==0?a:(a=window.event,a===void 0?32:lR(a.type))}function Dy(a,o){var d=Nt.p;try{return Nt.p=a,o()}finally{Nt.p=d}}var ro=Math.random().toString(36).slice(2),un="__reactFiber$"+ro,hr="__reactProps$"+ro,il="__reactContainer$"+ro,rl="__reactEvents$"+ro,Bg="__reactListeners$"+ro,Fg="__reactHandles$"+ro,__="__reactResources$"+ro,Od="__reactMarker$"+ro;function gh(a){delete a[un],delete a[hr],delete a[rl],delete a[Bg],delete a[Fg]}function cc(a){var o=a[un];if(o)return o;for(var d=a.parentNode;d;){if(o=d[il]||d[un]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(a=YT(a);a!==null;){if(d=a[un])return d;a=YT(a)}return o}a=d,d=a.parentNode}return null}function al(a){if(a=a[un]||a[il]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function wd(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(et(33))}function lc(a){var o=a[__];return o||(o=a[__]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function oi(a){a[Od]=!0}var E_=new Set,dc={};function uc(a,o){sl(a,o),sl(a+"Capture",o)}function sl(a,o){for(dc[a]=o,a=0;a<o.length;a++)E_.add(o[a])}var Va=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jg={},Gg={};function Zn(a){return eo.call(Gg,a)?!0:eo.call(jg,a)?!1:Va.test(a)?Gg[a]=!0:(jg[a]=!0,!1)}function Sh(a,o,d){if(Zn(o))if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+d)}}function Th(a,o,d){if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+d)}}function _s(a,o,d,f){if(f===null)a.removeAttribute(d);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(d);return}a.setAttributeNS(o,d,""+f)}}var m_,Rh;function ol(a){if(m_===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);m_=o&&o[1]||"",Rh=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+m_+a+Rh}var vh=!1;function g_(a,o){if(!a||vh)return"";vh=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var _t=function(){throw Error()};if(Object.defineProperty(_t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_t,[])}catch(tt){var $=tt}Reflect.construct(a,[],_t)}else{try{_t.call()}catch(tt){$=tt}a.call(_t.prototype)}}else{try{throw Error()}catch(tt){$=tt}(_t=a())&&typeof _t.catch=="function"&&_t.catch(function(){})}}catch(tt){if(tt&&$&&typeof tt.stack=="string")return[tt.stack,$.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=f.DetermineComponentFrameRoot(),w=T[0],P=T[1];if(w&&P){var F=w.split(`
`),Q=P.split(`
`);for(m=f=0;f<F.length&&!F[f].includes("DetermineComponentFrameRoot");)f++;for(;m<Q.length&&!Q[m].includes("DetermineComponentFrameRoot");)m++;if(f===F.length||m===Q.length)for(f=F.length-1,m=Q.length-1;1<=f&&0<=m&&F[f]!==Q[m];)m--;for(;1<=f&&0<=m;f--,m--)if(F[f]!==Q[m]){if(f!==1||m!==1)do if(f--,m--,0>m||F[f]!==Q[m]){var rt=`
`+F[f].replace(" at new "," at ");return a.displayName&&rt.includes("<anonymous>")&&(rt=rt.replace("<anonymous>",a.displayName)),rt}while(1<=f&&0<=m);break}}}finally{vh=!1,Error.prepareStackTrace=d}return(d=a?a.displayName||a.name:"")?ol(d):""}function Ly(a){switch(a.tag){case 26:case 27:case 5:return ol(a.type);case 16:return ol("Lazy");case 13:return ol("Suspense");case 19:return ol("SuspenseList");case 0:case 15:return g_(a.type,!1);case 11:return g_(a.type.render,!1);case 1:return g_(a.type,!0);case 31:return ol("Activity");default:return""}}function Hg(a){try{var o="";do o+=Ly(a),a=a.return;while(a);return o}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function Di(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function yh(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Py(a){var o=yh(a)?"checked":"value",d=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var m=d.get,T=d.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return m.call(this)},set:function(w){f=""+w,T.call(this,w)}}),Object.defineProperty(a,o,{enumerable:d.enumerable}),{getValue:function(){return f},setValue:function(w){f=""+w},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function Xe(a){a._valueTracker||(a._valueTracker=Py(a))}function Wg(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var d=o.getValue(),f="";return a&&(f=yh(a)?a.checked?"true":"false":a.value),a=f,a!==d?(o.setValue(a),!0):!1}function Nd(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Kg=/[\n"\\]/g;function Kr(a){return a.replace(Kg,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function S_(a,o,d,f,m,T,w,P){a.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?a.type=w:a.removeAttribute("type"),o!=null?w==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+Di(o)):a.value!==""+Di(o)&&(a.value=""+Di(o)):w!=="submit"&&w!=="reset"||a.removeAttribute("value"),o!=null?T_(a,w,Di(o)):d!=null?T_(a,w,Di(d)):f!=null&&a.removeAttribute("value"),m==null&&T!=null&&(a.defaultChecked=!!T),m!=null&&(a.checked=m&&typeof m!="function"&&typeof m!="symbol"),P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?a.name=""+Di(P):a.removeAttribute("name")}function Yg(a,o,d,f,m,T,w,P){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(a.type=T),o!=null||d!=null){if(!(T!=="submit"&&T!=="reset"||o!=null))return;d=d!=null?""+Di(d):"",o=o!=null?""+Di(o):d,P||o===a.value||(a.value=o),a.defaultValue=o}f=f??m,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=P?a.checked:!!f,a.defaultChecked=!!f,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(a.name=w)}function T_(a,o,d){o==="number"&&Nd(a.ownerDocument)===a||a.defaultValue===""+d||(a.defaultValue=""+d)}function cl(a,o,d,f){if(a=a.options,o){o={};for(var m=0;m<d.length;m++)o["$"+d[m]]=!0;for(d=0;d<a.length;d++)m=o.hasOwnProperty("$"+a[d].value),a[d].selected!==m&&(a[d].selected=m),m&&f&&(a[d].defaultSelected=!0)}else{for(d=""+Di(d),o=null,m=0;m<a.length;m++){if(a[m].value===d){a[m].selected=!0,f&&(a[m].defaultSelected=!0);return}o!==null||a[m].disabled||(o=a[m])}o!==null&&(o.selected=!0)}}function zg(a,o,d){if(o!=null&&(o=""+Di(o),o!==a.value&&(a.value=o),d==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=d!=null?""+Di(d):""}function Dd(a,o,d,f){if(o==null){if(f!=null){if(d!=null)throw Error(et(92));if(si(f)){if(1<f.length)throw Error(et(93));f=f[0]}d=f}d==null&&(d=""),o=d}d=Di(o),a.defaultValue=d,f=a.textContent,f===d&&f!==""&&f!==null&&(a.value=f)}function hc(a,o){if(o){var d=a.firstChild;if(d&&d===a.lastChild&&d.nodeType===3){d.nodeValue=o;return}}a.textContent=o}var R_=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qg(a,o,d){var f=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?f?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":f?a.setProperty(o,d):typeof d!="number"||d===0||R_.has(o)?o==="float"?a.cssFloat=d:a[o]=(""+d).trim():a[o]=d+"px"}function Ch(a,o,d){if(o!=null&&typeof o!="object")throw Error(et(62));if(a=a.style,d!=null){for(var f in d)!d.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var m in o)f=o[m],o.hasOwnProperty(m)&&d[m]!==f&&qg(a,m,f)}else for(var T in o)o.hasOwnProperty(T)&&qg(a,T,o[T])}function v_(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ky=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ah(a){return ky.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var y_=null;function C_(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var ll=null,dl=null;function Jg(a){var o=al(a);if(o&&(a=o.stateNode)){var d=a[hr]||null;t:switch(a=o.stateNode,o.type){case"input":if(S_(a,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=a;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Kr(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var f=d[o];if(f!==a&&f.form===a.form){var m=f[hr]||null;if(!m)throw Error(et(90));S_(f,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(o=0;o<d.length;o++)f=d[o],f.form===a.form&&Wg(f)}break t;case"textarea":zg(a,d.value,d.defaultValue);break t;case"select":o=d.value,o!=null&&cl(a,!!d.multiple,o,!1)}}}var A_=!1;function b_(a,o,d){if(A_)return a(o,d);A_=!0;try{var f=a(o);return f}finally{if(A_=!1,(ll!==null||dl!==null)&&(kp(),ll&&(o=ll,a=dl,dl=ll=null,Jg(o),a)))for(o=0;o<a.length;o++)Jg(a[o])}}function Ld(a,o){var d=a.stateNode;if(d===null)return null;var f=d[hr]||null;if(f===null)return null;d=f[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break t;default:a=!1}if(a)return null;if(d&&typeof d!="function")throw Error(et(231,o,typeof d));return d}var Es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),I_=!1;if(Es)try{var ms={};Object.defineProperty(ms,"passive",{get:function(){I_=!0}}),window.addEventListener("test",ms,ms),window.removeEventListener("test",ms,ms)}catch{I_=!1}var ao=null,O_=null,bh=null;function Qg(){if(bh)return bh;var a,o=O_,d=o.length,f,m="value"in ao?ao.value:ao.textContent,T=m.length;for(a=0;a<d&&o[a]===m[a];a++);var w=d-a;for(f=1;f<=w&&o[d-f]===m[T-f];f++);return bh=m.slice(a,1<f?1-f:void 0)}function Pd(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Ih(){return!0}function Zg(){return!1}function pr(a){function o(d,f,m,T,w){this._reactName=d,this._targetInst=m,this.type=f,this.nativeEvent=T,this.target=w,this.currentTarget=null;for(var P in a)a.hasOwnProperty(P)&&(d=a[P],this[P]=d?d(T):T[P]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Ih:Zg,this.isPropagationStopped=Zg,this}return xt(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Ih)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Ih)},persist:function(){},isPersistent:Ih}),o}var fr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qi=pr(fr),ul=xt({},fr,{view:0,detail:0}),My=pr(ul),w_,N_,ci,Oh=xt({},ul,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:U_,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ci&&(ci&&a.type==="mousemove"?(w_=a.screenX-ci.screenX,N_=a.screenY-ci.screenY):N_=w_=0,ci=a),w_)},movementY:function(a){return"movementY"in a?a.movementY:N_}}),$g=pr(Oh),Uy=xt({},Oh,{dataTransfer:0}),wh=pr(Uy),tS=xt({},ul,{relatedTarget:0}),D_=pr(tS),L_=xt({},fr,{animationName:0,elapsedTime:0,pseudoElement:0}),xy=pr(L_),P_=xt({},fr,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),k_=pr(P_),M_=xt({},fr,{data:0}),eS=pr(M_),Vy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},so={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function By(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=Nh[a])?!!o[a]:!1}function U_(){return By}var Fy=xt({},ul,{key:function(a){if(a.key){var o=Vy[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=Pd(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?so[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:U_,charCode:function(a){return a.type==="keypress"?Pd(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Pd(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),jy=pr(Fy),Gy=xt({},Oh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pc=pr(Gy),Hy=xt({},ul,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:U_}),hl=pr(Hy),nS=xt({},fr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wy=pr(nS),Ee=xt({},Oh,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Ky=pr(Ee),Yy=xt({},fr,{newState:0,oldState:0}),zy=pr(Yy),qy=[9,13,27,32],kd=Es&&"CompositionEvent"in window,Md=null;Es&&"documentMode"in document&&(Md=document.documentMode);var Xy=Es&&"TextEvent"in window&&!Md,iS=Es&&(!kd||Md&&8<Md&&11>=Md),Dh=" ",rS=!1;function aS(a,o){switch(a){case"keyup":return qy.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function x_(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var pl=!1;function gs(a,o){switch(a){case"compositionend":return x_(o);case"keypress":return o.which!==32?null:(rS=!0,Dh);case"textInput":return a=o.data,a===Dh&&rS?null:a;default:return null}}function Jy(a,o){if(pl)return a==="compositionend"||!kd&&aS(a,o)?(a=Qg(),bh=O_=ao=null,pl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return iS&&o.locale!=="ko"?null:o.data;default:return null}}var Qy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sS(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!Qy[a.type]:o==="textarea"}function V_(a,o,d,f){ll?dl?dl.push(f):dl=[f]:ll=f,o=zp(o,"onChange"),0<o.length&&(d=new Qi("onChange","change",null,d,f),a.push({event:d,listeners:o}))}var fc=null,Ud=null;function Zy(a){VT(a,0)}function Zi(a){var o=wd(a);if(Wg(o))return a}function oS(a,o){if(a==="change")return o}var cS=!1;if(Es){var B_;if(Es){var F_="oninput"in document;if(!F_){var j_=document.createElement("div");j_.setAttribute("oninput","return;"),F_=typeof j_.oninput=="function"}B_=F_}else B_=!1;cS=B_&&(!document.documentMode||9<document.documentMode)}function lS(){fc&&(fc.detachEvent("onpropertychange",dS),Ud=fc=null)}function dS(a){if(a.propertyName==="value"&&Zi(Ud)){var o=[];V_(o,Ud,a,C_(a)),b_(Zy,o)}}function uS(a,o,d){a==="focusin"?(lS(),fc=o,Ud=d,fc.attachEvent("onpropertychange",dS)):a==="focusout"&&lS()}function G_(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Zi(Ud)}function $y(a,o){if(a==="click")return Zi(o)}function tC(a,o){if(a==="input"||a==="change")return Zi(o)}function Lh(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Mr=typeof Object.is=="function"?Object.is:Lh;function xd(a,o){if(Mr(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var d=Object.keys(a),f=Object.keys(o);if(d.length!==f.length)return!1;for(f=0;f<d.length;f++){var m=d[f];if(!eo.call(o,m)||!Mr(a[m],o[m]))return!1}return!0}function hS(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ha(a,o){var d=hS(a);a=0;for(var f;d;){if(d.nodeType===3){if(f=a+d.textContent.length,a<=o&&f>=o)return{node:d,offset:o-a};a=f}t:{for(;d;){if(d.nextSibling){d=d.nextSibling;break t}d=d.parentNode}d=void 0}d=hS(d)}}function pS(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?pS(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function fS(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Nd(a.document);o instanceof a.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)a=o.contentWindow;else break;o=Nd(a.document)}return o}function $i(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var eC=Es&&"documentMode"in document&&11>=document.documentMode,fl=null,H_=null,Vd=null,Ph=!1;function _S(a,o,d){var f=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Ph||fl==null||fl!==Nd(f)||(f=fl,"selectionStart"in f&&$i(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Vd&&xd(Vd,f)||(Vd=f,f=zp(H_,"onSelect"),0<f.length&&(o=new Qi("onSelect","select",null,o,d),a.push({event:o,listeners:f}),o.target=fl)))}function _c(a,o){var d={};return d[a.toLowerCase()]=o.toLowerCase(),d["Webkit"+a]="webkit"+o,d["Moz"+a]="moz"+o,d}var _l={animationend:_c("Animation","AnimationEnd"),animationiteration:_c("Animation","AnimationIteration"),animationstart:_c("Animation","AnimationStart"),transitionrun:_c("Transition","TransitionRun"),transitionstart:_c("Transition","TransitionStart"),transitioncancel:_c("Transition","TransitionCancel"),transitionend:_c("Transition","TransitionEnd")},kh={},ES={};Es&&(ES=document.createElement("div").style,"AnimationEvent"in window||(delete _l.animationend.animation,delete _l.animationiteration.animation,delete _l.animationstart.animation),"TransitionEvent"in window||delete _l.transitionend.transition);function Ec(a){if(kh[a])return kh[a];if(!_l[a])return a;var o=_l[a],d;for(d in o)if(o.hasOwnProperty(d)&&d in ES)return kh[a]=o[d];return a}var Mh=Ec("animationend"),Uh=Ec("animationiteration"),mS=Ec("animationstart"),it=Ec("transitionrun"),nC=Ec("transitionstart"),iC=Ec("transitioncancel"),gS=Ec("transitionend"),SS=new Map,W_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");W_.push("scrollEnd");function pa(a,o){SS.set(a,o),uc(o,[a])}var TS=new WeakMap;function Yr(a,o){if(typeof a=="object"&&a!==null){var d=TS.get(a);return d!==void 0?d:(o={value:a,source:o,stack:Hg(o)},TS.set(a,o),o)}return{value:a,source:o,stack:Hg(o)}}var tr=[],fa=0,K_=0;function xh(){for(var a=fa,o=K_=fa=0;o<a;){var d=tr[o];tr[o++]=null;var f=tr[o];tr[o++]=null;var m=tr[o];tr[o++]=null;var T=tr[o];if(tr[o++]=null,f!==null&&m!==null){var w=f.pending;w===null?m.next=m:(m.next=w.next,w.next=m),f.pending=m}T!==0&&RS(d,m,T)}}function Vh(a,o,d,f){tr[fa++]=a,tr[fa++]=o,tr[fa++]=d,tr[fa++]=f,K_|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function Y_(a,o,d,f){return Vh(a,o,d,f),Bd(a)}function oo(a,o){return Vh(a,null,null,o),Bd(a)}function RS(a,o,d){a.lanes|=d;var f=a.alternate;f!==null&&(f.lanes|=d);for(var m=!1,T=a.return;T!==null;)T.childLanes|=d,f=T.alternate,f!==null&&(f.childLanes|=d),T.tag===22&&(a=T.stateNode,a===null||a._visibility&1||(m=!0)),a=T,T=T.return;return a.tag===3?(T=a.stateNode,m&&o!==null&&(m=31-ur(d),a=T.hiddenUpdates,f=a[m],f===null?a[m]=[o]:f.push(o),o.lane=d|536870912),T):null}function Bd(a){if(50<qa)throw qa=0,ks=null,Error(et(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var ji={};function rC(a,o,d,f){this.tag=a,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Li(a,o,d,f){return new rC(a,o,d,f)}function z_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Ss(a,o){var d=a.alternate;return d===null?(d=Li(a.tag,o,a.key,a.mode),d.elementType=a.elementType,d.type=a.type,d.stateNode=a.stateNode,d.alternate=a,a.alternate=d):(d.pendingProps=o,d.type=a.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=a.flags&65011712,d.childLanes=a.childLanes,d.lanes=a.lanes,d.child=a.child,d.memoizedProps=a.memoizedProps,d.memoizedState=a.memoizedState,d.updateQueue=a.updateQueue,o=a.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=a.sibling,d.index=a.index,d.ref=a.ref,d.refCleanup=a.refCleanup,d}function vS(a,o){a.flags&=65011714;var d=a.alternate;return d===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=d.childLanes,a.lanes=d.lanes,a.child=d.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=d.memoizedProps,a.memoizedState=d.memoizedState,a.updateQueue=d.updateQueue,a.type=d.type,o=d.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Fd(a,o,d,f,m,T){var w=0;if(f=a,typeof a=="function")z_(a)&&(w=1);else if(typeof a=="string")w=VC(a,d,Bt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case da:return a=Li(31,d,o,m),a.elementType=da,a.lanes=T,a;case _e:return mc(d.children,m,T,o);case Nr:w=8,m|=24;break;case bi:return a=Li(12,d,o,m|2),a.elementType=bi,a.lanes=T,a;case je:return a=Li(13,d,o,m),a.elementType=je,a.lanes=T,a;case Ae:return a=Li(19,d,o,m),a.elementType=Ae,a.lanes=T,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case la:case Jn:w=10;break t;case Dr:w=9;break t;case dr:w=11;break t;case dn:w=14;break t;case Qn:w=16,f=null;break t}w=29,d=Error(et(130,a===null?"null":typeof a,"")),f=null}return o=Li(w,d,o,m),o.elementType=a,o.type=f,o.lanes=T,o}function mc(a,o,d,f){return a=Li(7,a,f,o),a.lanes=d,a}function q_(a,o,d){return a=Li(6,a,null,o),a.lanes=d,a}function X_(a,o,d){return o=Li(4,a.children!==null?a.children:[],a.key,o),o.lanes=d,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var co=[],El=0,jd=null,Gd=0,zr=[],Ur=0,Ba=null,Ts=1,Rs="";function gc(a,o){co[El++]=Gd,co[El++]=jd,jd=a,Gd=o}function yS(a,o,d){zr[Ur++]=Ts,zr[Ur++]=Rs,zr[Ur++]=Ba,Ba=a;var f=Ts;a=Rs;var m=32-ur(f)-1;f&=~(1<<m),d+=1;var T=32-ur(o)+m;if(30<T){var w=m-m%5;T=(f&(1<<w)-1).toString(32),f>>=w,m-=w,Ts=1<<32-ur(o)+m|d<<m|f,Rs=T+a}else Ts=1<<T|d<<m|f,Rs=a}function J_(a){a.return!==null&&(gc(a,1),yS(a,1,0))}function Bh(a){for(;a===jd;)jd=co[--El],co[El]=null,Gd=co[--El],co[El]=null;for(;a===Ba;)Ba=zr[--Ur],zr[Ur]=null,Rs=zr[--Ur],zr[Ur]=null,Ts=zr[--Ur],zr[Ur]=null}var Pi=null,Wn=null,Ke=!1,Sc=null,Fa=!1,Q_=Error(et(519));function Tc(a){var o=Error(et(418,""));throw lo(Yr(o,a)),Q_}function CS(a){var o=a.stateNode,d=a.type,f=a.memoizedProps;switch(o[un]=a,o[hr]=f,d){case"dialog":Oe("cancel",o),Oe("close",o);break;case"iframe":case"object":case"embed":Oe("load",o);break;case"video":case"audio":for(d=0;d<Gl.length;d++)Oe(Gl[d],o);break;case"source":Oe("error",o);break;case"img":case"image":case"link":Oe("error",o),Oe("load",o);break;case"details":Oe("toggle",o);break;case"input":Oe("invalid",o),Yg(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),Xe(o);break;case"select":Oe("invalid",o);break;case"textarea":Oe("invalid",o),Dd(o,f.value,f.defaultValue,f.children),Xe(o)}d=f.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||f.suppressHydrationWarning===!0||jT(o.textContent,d)?(f.popover!=null&&(Oe("beforetoggle",o),Oe("toggle",o)),f.onScroll!=null&&Oe("scroll",o),f.onScrollEnd!=null&&Oe("scrollend",o),f.onClick!=null&&(o.onclick=Xp),o=!0):o=!1,o||Tc(a)}function AS(a){for(Pi=a.return;Pi;)switch(Pi.tag){case 5:case 13:Fa=!1;return;case 27:case 3:Fa=!0;return;default:Pi=Pi.return}}function Hd(a){if(a!==Pi)return!1;if(!Ke)return AS(a),Ke=!0,!1;var o=a.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=a.type,d=!(d!=="form"&&d!=="button")||sm(a.type,a.memoizedProps)),d=!d),d&&Wn&&Tc(a),AS(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(et(317));t:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(d=a.data,d==="/$"){if(o===0){Wn=ya(a.nextSibling);break t}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++;a=a.nextSibling}Wn=null}}else o===27?(o=Wn,Po(a.type)?(a=um,um=null,Wn=a):Wn=o):Wn=Pi?ya(a.stateNode.nextSibling):null;return!0}function Wd(){Wn=Pi=null,Ke=!1}function bS(){var a=Sc;return a!==null&&(gr===null?gr=a:gr.push.apply(gr,a),Sc=null),a}function lo(a){Sc===null?Sc=[a]:Sc.push(a)}var ml=Tt(null),vs=null,ys=null;function uo(a,o,d){Ot(ml,o._currentValue),o._currentValue=d}function Cs(a){a._currentValue=ml.current,Lt(ml)}function Fh(a,o,d){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===d)break;a=a.return}}function jh(a,o,d,f){var m=a.child;for(m!==null&&(m.return=a);m!==null;){var T=m.dependencies;if(T!==null){var w=m.child;T=T.firstContext;t:for(;T!==null;){var P=T;T=m;for(var F=0;F<o.length;F++)if(P.context===o[F]){T.lanes|=d,P=T.alternate,P!==null&&(P.lanes|=d),Fh(T.return,d,a),f||(w=null);break t}T=P.next}}else if(m.tag===18){if(w=m.return,w===null)throw Error(et(341));w.lanes|=d,T=w.alternate,T!==null&&(T.lanes|=d),Fh(w,d,a),w=null}else w=m.child;if(w!==null)w.return=m;else for(w=m;w!==null;){if(w===a){w=null;break}if(m=w.sibling,m!==null){m.return=w.return,w=m;break}w=w.return}m=w}}function Rc(a,o,d,f){a=null;for(var m=o,T=!1;m!==null;){if(!T){if((m.flags&524288)!==0)T=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var w=m.alternate;if(w===null)throw Error(et(387));if(w=w.memoizedProps,w!==null){var P=m.type;Mr(m.pendingProps.value,w.value)||(a!==null?a.push(P):a=[P])}}else if(m===Lr.current){if(w=m.alternate,w===null)throw Error(et(387));w.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(a!==null?a.push(ql):a=[ql])}m=m.return}a!==null&&jh(o,a,d,f),o.flags|=262144}function Gh(a){for(a=a.firstContext;a!==null;){if(!Mr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function vc(a){vs=a,ys=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function li(a){return IS(vs,a)}function Hh(a,o){return vs===null&&vc(a),IS(a,o)}function IS(a,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},ys===null){if(a===null)throw Error(et(308));ys=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else ys=ys.next=o;return d}var aC=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(d,f){a.push(f)}};this.abort=function(){o.aborted=!0,a.forEach(function(d){return d()})}},sC=kt.unstable_scheduleCallback,oC=kt.unstable_NormalPriority,gi={$$typeof:Jn,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wh(){return{controller:new aC,data:new Map,refCount:0}}function Kd(a){a.refCount--,a.refCount===0&&sC(oC,function(){a.controller.abort()})}var Yd=null,Z_=0,ho=0,gl=null;function cC(a,o){if(Yd===null){var d=Yd=[];Z_=0,ho=vu(),gl={status:"pending",value:void 0,then:function(f){d.push(f)}}}return Z_++,o.then(zd,zd),o}function zd(){if(--Z_===0&&Yd!==null){gl!==null&&(gl.status="fulfilled");var a=Yd;Yd=null,ho=0,gl=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function lC(a,o){var d=[],f={status:"pending",value:null,reason:null,then:function(m){d.push(m)}};return a.then(function(){f.status="fulfilled",f.value=o;for(var m=0;m<d.length;m++)(0,d[m])(o)},function(m){for(f.status="rejected",f.reason=m,m=0;m<d.length;m++)(0,d[m])(void 0)}),f}var OS=ot.S;ot.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&cC(a,o),OS!==null&&OS(a,o)};var yc=Tt(null);function $_(){var a=yc.current;return a!==null?a:Sn.pooledCache}function Kh(a,o){o===null?Ot(yc,yc.current):Ot(yc,o.pool)}function wS(){var a=$_();return a===null?null:{parent:gi._currentValue,pool:a}}var po=Error(et(460)),tE=Error(et(474)),Yh=Error(et(542)),eE={then:function(){}};function nE(a){return a=a.status,a==="fulfilled"||a==="rejected"}function zh(){}function NS(a,o,d){switch(d=a[d],d===void 0?a.push(o):d!==o&&(o.then(zh,zh),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Xh(a),a;default:if(typeof o.status=="string")o.then(zh,zh);else{if(a=Sn,a!==null&&100<a.shellSuspendCounter)throw Error(et(482));a=o,a.status="pending",a.then(function(f){if(o.status==="pending"){var m=o;m.status="fulfilled",m.value=f}},function(f){if(o.status==="pending"){var m=o;m.status="rejected",m.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Xh(a),a}throw qd=o,po}}var qd=null;function qh(){if(qd===null)throw Error(et(459));var a=qd;return qd=null,a}function Xh(a){if(a===po||a===Yh)throw Error(et(483))}var As=!1;function Xd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Jh(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function bs(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function _a(a,o,d){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,(rn&2)!==0){var m=f.pending;return m===null?o.next=o:(o.next=m.next,m.next=o),f.pending=o,o=Bd(a),RS(a,null,d),o}return Vh(a,f,o,d),Bd(a)}function Is(a,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var f=o.lanes;f&=a.pendingLanes,d|=f,o.lanes=d,nl(a,d)}}function iE(a,o){var d=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,d===f)){var m=null,T=null;if(d=d.firstBaseUpdate,d!==null){do{var w={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};T===null?m=T=w:T=T.next=w,d=d.next}while(d!==null);T===null?m=T=o:T=T.next=o}else m=T=o;d={baseState:f.baseState,firstBaseUpdate:m,lastBaseUpdate:T,shared:f.shared,callbacks:f.callbacks},a.updateQueue=d;return}a=d.lastBaseUpdate,a===null?d.firstBaseUpdate=o:a.next=o,d.lastBaseUpdate=o}var rE=!1;function Sl(){if(rE){var a=gl;if(a!==null)throw a}}function Jd(a,o,d,f){rE=!1;var m=a.updateQueue;As=!1;var T=m.firstBaseUpdate,w=m.lastBaseUpdate,P=m.shared.pending;if(P!==null){m.shared.pending=null;var F=P,Q=F.next;F.next=null,w===null?T=Q:w.next=Q,w=F;var rt=a.alternate;rt!==null&&(rt=rt.updateQueue,P=rt.lastBaseUpdate,P!==w&&(P===null?rt.firstBaseUpdate=Q:P.next=Q,rt.lastBaseUpdate=F))}if(T!==null){var _t=m.baseState;w=0,rt=Q=F=null,P=T;do{var $=P.lane&-536870913,tt=$!==P.lane;if(tt?(xe&$)===$:(f&$)===$){$!==0&&$===ho&&(rE=!0),rt!==null&&(rt=rt.next={lane:0,tag:P.tag,payload:P.payload,callback:null,next:null});t:{var oe=a,Ht=P;$=o;var pn=d;switch(Ht.tag){case 1:if(oe=Ht.payload,typeof oe=="function"){_t=oe.call(pn,_t,$);break t}_t=oe;break t;case 3:oe.flags=oe.flags&-65537|128;case 0:if(oe=Ht.payload,$=typeof oe=="function"?oe.call(pn,_t,$):oe,$==null)break t;_t=xt({},_t,$);break t;case 2:As=!0}}$=P.callback,$!==null&&(a.flags|=64,tt&&(a.flags|=8192),tt=m.callbacks,tt===null?m.callbacks=[$]:tt.push($))}else tt={lane:$,tag:P.tag,payload:P.payload,callback:P.callback,next:null},rt===null?(Q=rt=tt,F=_t):rt=rt.next=tt,w|=$;if(P=P.next,P===null){if(P=m.shared.pending,P===null)break;tt=P,P=tt.next,tt.next=null,m.lastBaseUpdate=tt,m.shared.pending=null}}while(!0);rt===null&&(F=_t),m.baseState=F,m.firstBaseUpdate=Q,m.lastBaseUpdate=rt,T===null&&(m.shared.lanes=0),Io|=w,a.lanes=w,a.memoizedState=_t}}function DS(a,o){if(typeof a!="function")throw Error(et(191,a));a.call(o)}function aE(a,o){var d=a.callbacks;if(d!==null)for(a.callbacks=null,a=0;a<d.length;a++)DS(d[a],o)}var Tl=Tt(null),Qh=Tt(0);function LS(a,o){a=za,Ot(Qh,a),Ot(Tl,o),za=a|o.baseLanes}function sE(){Ot(Qh,za),Ot(Tl,Tl.current)}function oE(){za=Qh.current,Lt(Tl),Lt(Qh)}var fo=0,Te=null,Ge=null,di=null,Zh=!1,Rl=!1,_o=!1,$h=0,vl=0,yl=null,dC=0;function $n(){throw Error(et(321))}function Cl(a,o){if(o===null)return!1;for(var d=0;d<o.length&&d<a.length;d++)if(!Mr(a[d],o[d]))return!1;return!0}function cE(a,o,d,f,m,T){return fo=T,Te=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,ot.H=a===null||a.memoizedState===null?IE:qS,_o=!1,T=d(f,m),_o=!1,Rl&&(T=kS(o,d,f,m)),PS(a),T}function PS(a){ot.H=iu;var o=Ge!==null&&Ge.next!==null;if(fo=0,di=Ge=Te=null,Zh=!1,vl=0,yl=null,o)throw Error(et(300));a===null||Ti||(a=a.dependencies,a!==null&&Gh(a)&&(Ti=!0))}function kS(a,o,d,f){Te=a;var m=0;do{if(Rl&&(yl=null),vl=0,Rl=!1,25<=m)throw Error(et(301));if(m+=1,di=Ge=null,a.updateQueue!=null){var T=a.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}ot.H=Eo,T=o(d,f)}while(Rl);return T}function uC(){var a=ot.H,o=a.useState()[0];return o=typeof o.then=="function"?Al(o):o,a=a.useState()[0],(Ge!==null?Ge.memoizedState:null)!==a&&(Te.flags|=1024),o}function lE(){var a=$h!==0;return $h=0,a}function dE(a,o,d){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~d}function Qd(a){if(Zh){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Zh=!1}fo=0,di=Ge=Te=null,Rl=!1,vl=$h=0,yl=null}function _r(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return di===null?Te.memoizedState=di=a:di=di.next=a,di}function ti(){if(Ge===null){var a=Te.alternate;a=a!==null?a.memoizedState:null}else a=Ge.next;var o=di===null?Te.memoizedState:di.next;if(o!==null)di=o,Ge=a;else{if(a===null)throw Te.alternate===null?Error(et(467)):Error(et(310));Ge=a,a={memoizedState:Ge.memoizedState,baseState:Ge.baseState,baseQueue:Ge.baseQueue,queue:Ge.queue,next:null},di===null?Te.memoizedState=di=a:di=di.next=a}return di}function uE(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Al(a){var o=vl;return vl+=1,yl===null&&(yl=[]),a=NS(yl,a,o),o=Te,(di===null?o.memoizedState:di.next)===null&&(o=o.alternate,ot.H=o===null||o.memoizedState===null?IE:qS),a}function tp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Al(a);if(a.$$typeof===Jn)return li(a)}throw Error(et(438,String(a)))}function hE(a){var o=null,d=Te.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var f=Te.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(m){return m.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=uE(),Te.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(a),f=0;f<a;f++)d[f]=Wr;return o.index++,d}function Os(a,o){return typeof o=="function"?o(a):o}function ep(a){var o=ti();return pE(o,Ge,a)}function pE(a,o,d){var f=a.queue;if(f===null)throw Error(et(311));f.lastRenderedReducer=d;var m=a.baseQueue,T=f.pending;if(T!==null){if(m!==null){var w=m.next;m.next=T.next,T.next=w}o.baseQueue=m=T,f.pending=null}if(T=a.baseState,m===null)a.memoizedState=T;else{o=m.next;var P=w=null,F=null,Q=o,rt=!1;do{var _t=Q.lane&-536870913;if(_t!==Q.lane?(xe&_t)===_t:(fo&_t)===_t){var $=Q.revertLane;if($===0)F!==null&&(F=F.next={lane:0,revertLane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),_t===ho&&(rt=!0);else if((fo&$)===$){Q=Q.next,$===ho&&(rt=!0);continue}else _t={lane:0,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},F===null?(P=F=_t,w=T):F=F.next=_t,Te.lanes|=$,Io|=$;_t=Q.action,_o&&d(T,_t),T=Q.hasEagerState?Q.eagerState:d(T,_t)}else $={lane:_t,revertLane:Q.revertLane,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null},F===null?(P=F=$,w=T):F=F.next=$,Te.lanes|=_t,Io|=_t;Q=Q.next}while(Q!==null&&Q!==o);if(F===null?w=T:F.next=P,!Mr(T,a.memoizedState)&&(Ti=!0,rt&&(d=gl,d!==null)))throw d;a.memoizedState=T,a.baseState=w,a.baseQueue=F,f.lastRenderedState=T}return m===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function fE(a){var o=ti(),d=o.queue;if(d===null)throw Error(et(311));d.lastRenderedReducer=a;var f=d.dispatch,m=d.pending,T=o.memoizedState;if(m!==null){d.pending=null;var w=m=m.next;do T=a(T,w.action),w=w.next;while(w!==m);Mr(T,o.memoizedState)||(Ti=!0),o.memoizedState=T,o.baseQueue===null&&(o.baseState=T),d.lastRenderedState=T}return[T,f]}function _E(a,o,d){var f=Te,m=ti(),T=Ke;if(T){if(d===void 0)throw Error(et(407));d=d()}else d=o();var w=!Mr((Ge||m).memoizedState,d);w&&(m.memoizedState=d,Ti=!0),m=m.queue;var P=EE.bind(null,f,m,a);if(ja(2048,8,P,[a]),m.getSnapshot!==o||w||di!==null&&di.memoizedState.tag&1){if(f.flags|=2048,Ol(9,ap(),US.bind(null,f,m,d,o),null),Sn===null)throw Error(et(349));T||(fo&124)!==0||MS(f,o,d)}return d}function MS(a,o,d){a.flags|=16384,a={getSnapshot:o,value:d},o=Te.updateQueue,o===null?(o=uE(),Te.updateQueue=o,o.stores=[a]):(d=o.stores,d===null?o.stores=[a]:d.push(a))}function US(a,o,d,f){o.value=d,o.getSnapshot=f,xS(o)&&Zd(a)}function EE(a,o,d){return d(function(){xS(o)&&Zd(a)})}function xS(a){var o=a.getSnapshot;a=a.value;try{var d=o();return!Mr(a,d)}catch{return!0}}function Zd(a){var o=oo(a,2);o!==null&&Br(o,a,2)}function np(a){var o=_r();if(typeof a=="function"){var d=a;if(a=d(),_o){Ji(!0);try{d()}finally{Ji(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:a},o}function bl(a,o,d,f){return a.baseState=d,pE(a,Ge,typeof f=="function"?f:Os)}function hC(a,o,d,f,m){if(up(a))throw Error(et(485));if(a=o.action,a!==null){var T={payload:m,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){T.listeners.push(w)}};ot.T!==null?d(!0):T.isTransition=!1,f(T),d=o.pending,d===null?(T.next=o.pending=T,VS(o,T)):(T.next=d.next,o.pending=d.next=T)}}function VS(a,o){var d=o.action,f=o.payload,m=a.state;if(o.isTransition){var T=ot.T,w={};ot.T=w;try{var P=d(m,f),F=ot.S;F!==null&&F(w,P),BS(a,o,P)}catch(Q){Il(a,o,Q)}finally{ot.T=T}}else try{T=d(m,f),BS(a,o,T)}catch(Q){Il(a,o,Q)}}function BS(a,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(f){FS(a,o,f)},function(f){return Il(a,o,f)}):FS(a,o,d)}function FS(a,o,d){o.status="fulfilled",o.value=d,jS(o),a.state=d,o=a.pending,o!==null&&(d=o.next,d===o?a.pending=null:(d=d.next,o.next=d,VS(a,d)))}function Il(a,o,d){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=d,jS(o),o=o.next;while(o!==f)}a.action=null}function jS(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function mE(a,o){return o}function ip(a,o){if(Ke){var d=Sn.formState;if(d!==null){t:{var f=Te;if(Ke){if(Wn){e:{for(var m=Wn,T=Fa;m.nodeType!==8;){if(!T){m=null;break e}if(m=ya(m.nextSibling),m===null){m=null;break e}}T=m.data,m=T==="F!"||T==="F"?m:null}if(m){Wn=ya(m.nextSibling),f=m.data==="F!";break t}}Tc(f)}f=!1}f&&(o=d[0])}}return d=_r(),d.memoizedState=d.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mE,lastRenderedState:o},d.queue=f,d=AE.bind(null,Te,f),f.dispatch=d,f=np(!1),T=nu.bind(null,Te,!1,f.queue),f=_r(),m={state:o,dispatch:null,action:a,pending:null},f.queue=m,d=hC.bind(null,Te,m,T,d),m.dispatch=d,f.memoizedState=a,[o,d,!1]}function rp(a){var o=ti();return GS(o,Ge,a)}function GS(a,o,d){if(o=pE(a,o,mE)[0],a=ep(Os)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Al(o)}catch(w){throw w===po?Yh:w}else f=o;o=ti();var m=o.queue,T=m.dispatch;return d!==o.memoizedState&&(Te.flags|=2048,Ol(9,ap(),pC.bind(null,m,d),null)),[f,T,a]}function pC(a,o){a.action=o}function HS(a){var o=ti(),d=Ge;if(d!==null)return GS(o,d,a);ti(),o=o.memoizedState,d=ti();var f=d.queue.dispatch;return d.memoizedState=a,[o,f,!1]}function Ol(a,o,d,f){return a={tag:a,create:d,deps:f,inst:o,next:null},o=Te.updateQueue,o===null&&(o=uE(),Te.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=a.next=a:(f=d.next,d.next=a,a.next=f,o.lastEffect=a),a}function ap(){return{destroy:void 0,resource:void 0}}function $d(){return ti().memoizedState}function sp(a,o,d,f){var m=_r();f=f===void 0?null:f,Te.flags|=a,m.memoizedState=Ol(1|o,ap(),d,f)}function ja(a,o,d,f){var m=ti();f=f===void 0?null:f;var T=m.memoizedState.inst;Ge!==null&&f!==null&&Cl(f,Ge.memoizedState.deps)?m.memoizedState=Ol(o,T,d,f):(Te.flags|=a,m.memoizedState=Ol(1|o,T,d,f))}function op(a,o){sp(8390656,8,a,o)}function tu(a,o){ja(2048,8,a,o)}function wl(a,o){return ja(4,2,a,o)}function eu(a,o){return ja(4,4,a,o)}function WS(a,o){if(typeof o=="function"){a=a();var d=o(a);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function gE(a,o,d){d=d!=null?d.concat([a]):null,ja(4,4,WS.bind(null,o,a),d)}function SE(){}function TE(a,o){var d=ti();o=o===void 0?null:o;var f=d.memoizedState;return o!==null&&Cl(o,f[1])?f[0]:(d.memoizedState=[a,o],a)}function KS(a,o){var d=ti();o=o===void 0?null:o;var f=d.memoizedState;if(o!==null&&Cl(o,f[1]))return f[0];if(f=a(),_o){Ji(!0);try{a()}finally{Ji(!1)}}return d.memoizedState=[f,o],f}function RE(a,o,d){return d===void 0||(fo&1073741824)!==0?a.memoizedState=o:(a.memoizedState=d,a=vT(),Te.lanes|=a,Io|=a,d)}function cp(a,o,d,f){return Mr(d,o)?d:Tl.current!==null?(a=RE(a,d,f),Mr(a,o)||(Ti=!0),a):(fo&42)===0?(Ti=!0,a.memoizedState=d):(a=vT(),Te.lanes|=a,Io|=a,o)}function lp(a,o,d,f,m){var T=Nt.p;Nt.p=T!==0&&8>T?T:8;var w=ot.T,P={};ot.T=P,nu(a,!1,o,d);try{var F=m(),Q=ot.S;if(Q!==null&&Q(P,F),F!==null&&typeof F=="object"&&typeof F.then=="function"){var rt=lC(F,f);ma(a,o,rt,Sr(a))}else ma(a,o,f,Sr(a))}catch(_t){ma(a,o,{then:function(){},status:"rejected",reason:_t},Sr())}finally{Nt.p=T,ot.T=w}}function fC(){}function vE(a,o,d,f){if(a.tag!==5)throw Error(et(476));var m=yE(a).queue;lp(a,m,o,Jt,d===null?fC:function(){return dp(a),d(f)})}function yE(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:Jt,baseState:Jt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:Jt},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Os,lastRenderedState:d},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function dp(a){var o=yE(a).next.queue;ma(a,o,{},Sr())}function CE(){return li(ql)}function Ea(){return ti().memoizedState}function Cc(){return ti().memoizedState}function Ac(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var d=Sr();a=bs(d);var f=_a(o,a,d);f!==null&&(Br(f,o,d),Is(f,o,d)),o={cache:Wh()},a.payload=o;return}o=o.return}}function YS(a,o,d){var f=Sr();d={lane:f,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},up(a)?bE(o,d):(d=Y_(a,o,d,f),d!==null&&(Br(d,a,f),zS(d,o,f)))}function AE(a,o,d){var f=Sr();ma(a,o,d,f)}function ma(a,o,d,f){var m={lane:f,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(up(a))bE(o,m);else{var T=a.alternate;if(a.lanes===0&&(T===null||T.lanes===0)&&(T=o.lastRenderedReducer,T!==null))try{var w=o.lastRenderedState,P=T(w,d);if(m.hasEagerState=!0,m.eagerState=P,Mr(P,w))return Vh(a,o,m,0),Sn===null&&xh(),!1}catch{}finally{}if(d=Y_(a,o,m,f),d!==null)return Br(d,a,f),zS(d,o,f),!0}return!1}function nu(a,o,d,f){if(f={lane:2,revertLane:vu(),action:f,hasEagerState:!1,eagerState:null,next:null},up(a)){if(o)throw Error(et(479))}else o=Y_(a,d,f,2),o!==null&&Br(o,a,2)}function up(a){var o=a.alternate;return a===Te||o!==null&&o===Te}function bE(a,o){Rl=Zh=!0;var d=a.pending;d===null?o.next=o:(o.next=d.next,d.next=o),a.pending=o}function zS(a,o,d){if((d&4194048)!==0){var f=o.lanes;f&=a.pendingLanes,d|=f,o.lanes=d,nl(a,d)}}var iu={readContext:li,use:tp,useCallback:$n,useContext:$n,useEffect:$n,useImperativeHandle:$n,useLayoutEffect:$n,useInsertionEffect:$n,useMemo:$n,useReducer:$n,useRef:$n,useState:$n,useDebugValue:$n,useDeferredValue:$n,useTransition:$n,useSyncExternalStore:$n,useId:$n,useHostTransitionStatus:$n,useFormState:$n,useActionState:$n,useOptimistic:$n,useMemoCache:$n,useCacheRefresh:$n},IE={readContext:li,use:tp,useCallback:function(a,o){return _r().memoizedState=[a,o===void 0?null:o],a},useContext:li,useEffect:op,useImperativeHandle:function(a,o,d){d=d!=null?d.concat([a]):null,sp(4194308,4,WS.bind(null,o,a),d)},useLayoutEffect:function(a,o){return sp(4194308,4,a,o)},useInsertionEffect:function(a,o){sp(4,2,a,o)},useMemo:function(a,o){var d=_r();o=o===void 0?null:o;var f=a();if(_o){Ji(!0);try{a()}finally{Ji(!1)}}return d.memoizedState=[f,o],f},useReducer:function(a,o,d){var f=_r();if(d!==void 0){var m=d(o);if(_o){Ji(!0);try{d(o)}finally{Ji(!1)}}}else m=o;return f.memoizedState=f.baseState=m,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:m},f.queue=a,a=a.dispatch=YS.bind(null,Te,a),[f.memoizedState,a]},useRef:function(a){var o=_r();return a={current:a},o.memoizedState=a},useState:function(a){a=np(a);var o=a.queue,d=AE.bind(null,Te,o);return o.dispatch=d,[a.memoizedState,d]},useDebugValue:SE,useDeferredValue:function(a,o){var d=_r();return RE(d,a,o)},useTransition:function(){var a=np(!1);return a=lp.bind(null,Te,a.queue,!0,!1),_r().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,d){var f=Te,m=_r();if(Ke){if(d===void 0)throw Error(et(407));d=d()}else{if(d=o(),Sn===null)throw Error(et(349));(xe&124)!==0||MS(f,o,d)}m.memoizedState=d;var T={value:d,getSnapshot:o};return m.queue=T,op(EE.bind(null,f,T,a),[a]),f.flags|=2048,Ol(9,ap(),US.bind(null,f,T,d,o),null),d},useId:function(){var a=_r(),o=Sn.identifierPrefix;if(Ke){var d=Rs,f=Ts;d=(f&~(1<<32-ur(f)-1)).toString(32)+d,o=""+o+"R"+d,d=$h++,0<d&&(o+="H"+d.toString(32)),o+=""}else d=dC++,o=""+o+"r"+d.toString(32)+"";return a.memoizedState=o},useHostTransitionStatus:CE,useFormState:ip,useActionState:ip,useOptimistic:function(a){var o=_r();o.memoizedState=o.baseState=a;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=nu.bind(null,Te,!0,d),d.dispatch=o,[a,o]},useMemoCache:hE,useCacheRefresh:function(){return _r().memoizedState=Ac.bind(null,Te)}},qS={readContext:li,use:tp,useCallback:TE,useContext:li,useEffect:tu,useImperativeHandle:gE,useInsertionEffect:wl,useLayoutEffect:eu,useMemo:KS,useReducer:ep,useRef:$d,useState:function(){return ep(Os)},useDebugValue:SE,useDeferredValue:function(a,o){var d=ti();return cp(d,Ge.memoizedState,a,o)},useTransition:function(){var a=ep(Os)[0],o=ti().memoizedState;return[typeof a=="boolean"?a:Al(a),o]},useSyncExternalStore:_E,useId:Ea,useHostTransitionStatus:CE,useFormState:rp,useActionState:rp,useOptimistic:function(a,o){var d=ti();return bl(d,Ge,a,o)},useMemoCache:hE,useCacheRefresh:Cc},Eo={readContext:li,use:tp,useCallback:TE,useContext:li,useEffect:tu,useImperativeHandle:gE,useInsertionEffect:wl,useLayoutEffect:eu,useMemo:KS,useReducer:fE,useRef:$d,useState:function(){return fE(Os)},useDebugValue:SE,useDeferredValue:function(a,o){var d=ti();return Ge===null?RE(d,a,o):cp(d,Ge.memoizedState,a,o)},useTransition:function(){var a=fE(Os)[0],o=ti().memoizedState;return[typeof a=="boolean"?a:Al(a),o]},useSyncExternalStore:_E,useId:Ea,useHostTransitionStatus:CE,useFormState:HS,useActionState:HS,useOptimistic:function(a,o){var d=ti();return Ge!==null?bl(d,Ge,a,o):(d.baseState=a,[a,d.queue.dispatch])},useMemoCache:hE,useCacheRefresh:Cc},Nl=null,ru=0;function hp(a){var o=ru;return ru+=1,Nl===null&&(Nl=[]),NS(Nl,a,o)}function au(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function su(a,o){throw o.$$typeof===Mt?Error(et(525)):(a=Object.prototype.toString.call(o),Error(et(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function XS(a){var o=a._init;return o(a._payload)}function pp(a){function o(Y,W){if(a){var J=Y.deletions;J===null?(Y.deletions=[W],Y.flags|=16):J.push(W)}}function d(Y,W){if(!a)return null;for(;W!==null;)o(Y,W),W=W.sibling;return null}function f(Y){for(var W=new Map;Y!==null;)Y.key!==null?W.set(Y.key,Y):W.set(Y.index,Y),Y=Y.sibling;return W}function m(Y,W){return Y=Ss(Y,W),Y.index=0,Y.sibling=null,Y}function T(Y,W,J){return Y.index=J,a?(J=Y.alternate,J!==null?(J=J.index,J<W?(Y.flags|=67108866,W):J):(Y.flags|=67108866,W)):(Y.flags|=1048576,W)}function w(Y){return a&&Y.alternate===null&&(Y.flags|=67108866),Y}function P(Y,W,J,pt){return W===null||W.tag!==6?(W=q_(J,Y.mode,pt),W.return=Y,W):(W=m(W,J),W.return=Y,W)}function F(Y,W,J,pt){var bt=J.type;return bt===_e?rt(Y,W,J.props.children,pt,J.key):W!==null&&(W.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===Qn&&XS(bt)===W.type)?(W=m(W,J.props),au(W,J),W.return=Y,W):(W=Fd(J.type,J.key,J.props,null,Y.mode,pt),au(W,J),W.return=Y,W)}function Q(Y,W,J,pt){return W===null||W.tag!==4||W.stateNode.containerInfo!==J.containerInfo||W.stateNode.implementation!==J.implementation?(W=X_(J,Y.mode,pt),W.return=Y,W):(W=m(W,J.children||[]),W.return=Y,W)}function rt(Y,W,J,pt,bt){return W===null||W.tag!==7?(W=mc(J,Y.mode,pt,bt),W.return=Y,W):(W=m(W,J),W.return=Y,W)}function _t(Y,W,J){if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return W=q_(""+W,Y.mode,J),W.return=Y,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case ue:return J=Fd(W.type,W.key,W.props,null,Y.mode,J),au(J,W),J.return=Y,J;case ai:return W=X_(W,Y.mode,J),W.return=Y,W;case Qn:var pt=W._init;return W=pt(W._payload),_t(Y,W,J)}if(si(W)||mi(W))return W=mc(W,Y.mode,J,null),W.return=Y,W;if(typeof W.then=="function")return _t(Y,hp(W),J);if(W.$$typeof===Jn)return _t(Y,Hh(Y,W),J);su(Y,W)}return null}function $(Y,W,J,pt){var bt=W!==null?W.key:null;if(typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint")return bt!==null?null:P(Y,W,""+J,pt);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case ue:return J.key===bt?F(Y,W,J,pt):null;case ai:return J.key===bt?Q(Y,W,J,pt):null;case Qn:return bt=J._init,J=bt(J._payload),$(Y,W,J,pt)}if(si(J)||mi(J))return bt!==null?null:rt(Y,W,J,pt,null);if(typeof J.then=="function")return $(Y,W,hp(J),pt);if(J.$$typeof===Jn)return $(Y,W,Hh(Y,J),pt);su(Y,J)}return null}function tt(Y,W,J,pt,bt){if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return Y=Y.get(J)||null,P(W,Y,""+pt,bt);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case ue:return Y=Y.get(pt.key===null?J:pt.key)||null,F(W,Y,pt,bt);case ai:return Y=Y.get(pt.key===null?J:pt.key)||null,Q(W,Y,pt,bt);case Qn:var we=pt._init;return pt=we(pt._payload),tt(Y,W,J,pt,bt)}if(si(pt)||mi(pt))return Y=Y.get(J)||null,rt(W,Y,pt,bt,null);if(typeof pt.then=="function")return tt(Y,W,J,hp(pt),bt);if(pt.$$typeof===Jn)return tt(Y,W,J,Hh(W,pt),bt);su(W,pt)}return null}function oe(Y,W,J,pt){for(var bt=null,we=null,jt=W,Qt=W=0,Ri=null;jt!==null&&Qt<J.length;Qt++){jt.index>Qt?(Ri=jt,jt=null):Ri=jt.sibling;var Ve=$(Y,jt,J[Qt],pt);if(Ve===null){jt===null&&(jt=Ri);break}a&&jt&&Ve.alternate===null&&o(Y,jt),W=T(Ve,W,Qt),we===null?bt=Ve:we.sibling=Ve,we=Ve,jt=Ri}if(Qt===J.length)return d(Y,jt),Ke&&gc(Y,Qt),bt;if(jt===null){for(;Qt<J.length;Qt++)jt=_t(Y,J[Qt],pt),jt!==null&&(W=T(jt,W,Qt),we===null?bt=jt:we.sibling=jt,we=jt);return Ke&&gc(Y,Qt),bt}for(jt=f(jt);Qt<J.length;Qt++)Ri=tt(jt,Y,Qt,J[Qt],pt),Ri!==null&&(a&&Ri.alternate!==null&&jt.delete(Ri.key===null?Qt:Ri.key),W=T(Ri,W,Qt),we===null?bt=Ri:we.sibling=Ri,we=Ri);return a&&jt.forEach(function(Jr){return o(Y,Jr)}),Ke&&gc(Y,Qt),bt}function Ht(Y,W,J,pt){if(J==null)throw Error(et(151));for(var bt=null,we=null,jt=W,Qt=W=0,Ri=null,Ve=J.next();jt!==null&&!Ve.done;Qt++,Ve=J.next()){jt.index>Qt?(Ri=jt,jt=null):Ri=jt.sibling;var Jr=$(Y,jt,Ve.value,pt);if(Jr===null){jt===null&&(jt=Ri);break}a&&jt&&Jr.alternate===null&&o(Y,jt),W=T(Jr,W,Qt),we===null?bt=Jr:we.sibling=Jr,we=Jr,jt=Ri}if(Ve.done)return d(Y,jt),Ke&&gc(Y,Qt),bt;if(jt===null){for(;!Ve.done;Qt++,Ve=J.next())Ve=_t(Y,Ve.value,pt),Ve!==null&&(W=T(Ve,W,Qt),we===null?bt=Ve:we.sibling=Ve,we=Ve);return Ke&&gc(Y,Qt),bt}for(jt=f(jt);!Ve.done;Qt++,Ve=J.next())Ve=tt(jt,Y,Qt,Ve.value,pt),Ve!==null&&(a&&Ve.alternate!==null&&jt.delete(Ve.key===null?Qt:Ve.key),W=T(Ve,W,Qt),we===null?bt=Ve:we.sibling=Ve,we=Ve);return a&&jt.forEach(function(vm){return o(Y,vm)}),Ke&&gc(Y,Qt),bt}function pn(Y,W,J,pt){if(typeof J=="object"&&J!==null&&J.type===_e&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case ue:t:{for(var bt=J.key;W!==null;){if(W.key===bt){if(bt=J.type,bt===_e){if(W.tag===7){d(Y,W.sibling),pt=m(W,J.props.children),pt.return=Y,Y=pt;break t}}else if(W.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===Qn&&XS(bt)===W.type){d(Y,W.sibling),pt=m(W,J.props),au(pt,J),pt.return=Y,Y=pt;break t}d(Y,W);break}else o(Y,W);W=W.sibling}J.type===_e?(pt=mc(J.props.children,Y.mode,pt,J.key),pt.return=Y,Y=pt):(pt=Fd(J.type,J.key,J.props,null,Y.mode,pt),au(pt,J),pt.return=Y,Y=pt)}return w(Y);case ai:t:{for(bt=J.key;W!==null;){if(W.key===bt)if(W.tag===4&&W.stateNode.containerInfo===J.containerInfo&&W.stateNode.implementation===J.implementation){d(Y,W.sibling),pt=m(W,J.children||[]),pt.return=Y,Y=pt;break t}else{d(Y,W);break}else o(Y,W);W=W.sibling}pt=X_(J,Y.mode,pt),pt.return=Y,Y=pt}return w(Y);case Qn:return bt=J._init,J=bt(J._payload),pn(Y,W,J,pt)}if(si(J))return oe(Y,W,J,pt);if(mi(J)){if(bt=mi(J),typeof bt!="function")throw Error(et(150));return J=bt.call(J),Ht(Y,W,J,pt)}if(typeof J.then=="function")return pn(Y,W,hp(J),pt);if(J.$$typeof===Jn)return pn(Y,W,Hh(Y,J),pt);su(Y,J)}return typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint"?(J=""+J,W!==null&&W.tag===6?(d(Y,W.sibling),pt=m(W,J),pt.return=Y,Y=pt):(d(Y,W),pt=q_(J,Y.mode,pt),pt.return=Y,Y=pt),w(Y)):d(Y,W)}return function(Y,W,J,pt){try{ru=0;var bt=pn(Y,W,J,pt);return Nl=null,bt}catch(jt){if(jt===po||jt===Yh)throw jt;var we=Li(29,jt,null,Y.mode);return we.lanes=pt,we.return=Y,we}finally{}}}var bc=pp(!0),JS=pp(!1),xr=Tt(null),Ga=null;function mo(a){var o=a.alternate;Ot(Si,Si.current&1),Ot(xr,a),Ga===null&&(o===null||Tl.current!==null||o.memoizedState!==null)&&(Ga=a)}function QS(a){if(a.tag===22){if(Ot(Si,Si.current),Ot(xr,a),Ga===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(Ga=a)}}else go()}function go(){Ot(Si,Si.current),Ot(xr,xr.current)}function ws(a){Lt(xr),Ga===a&&(Ga=null),Lt(Si)}var Si=Tt(0);function fp(a){for(var o=a;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||dm(d)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function _p(a,o,d,f){o=a.memoizedState,d=d(f,o),d=d==null?o:xt({},o,d),a.memoizedState=d,a.lanes===0&&(a.updateQueue.baseState=d)}var Ha={enqueueSetState:function(a,o,d){a=a._reactInternals;var f=Sr(),m=bs(f);m.payload=o,d!=null&&(m.callback=d),o=_a(a,m,f),o!==null&&(Br(o,a,f),Is(o,a,f))},enqueueReplaceState:function(a,o,d){a=a._reactInternals;var f=Sr(),m=bs(f);m.tag=1,m.payload=o,d!=null&&(m.callback=d),o=_a(a,m,f),o!==null&&(Br(o,a,f),Is(o,a,f))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var d=Sr(),f=bs(d);f.tag=2,o!=null&&(f.callback=o),o=_a(a,f,d),o!==null&&(Br(o,a,d),Is(o,a,d))}};function ZS(a,o,d,f,m,T,w){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,T,w):o.prototype&&o.prototype.isPureReactComponent?!xd(d,f)||!xd(m,T):!0}function $S(a,o,d,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,f),o.state!==a&&Ha.enqueueReplaceState(o,o.state,null)}function Ic(a,o){var d=o;if("ref"in o){d={};for(var f in o)f!=="ref"&&(d[f]=o[f])}if(a=a.defaultProps){d===o&&(d=xt({},d));for(var m in a)d[m]===void 0&&(d[m]=a[m])}return d}var Ep=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function tT(a){Ep(a)}function eT(a){console.error(a)}function mp(a){Ep(a)}function gp(a,o){try{var d=a.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function nT(a,o,d){try{var f=a.onCaughtError;f(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function OE(a,o,d){return d=bs(d),d.tag=3,d.payload={element:null},d.callback=function(){gp(a,o)},d}function iT(a){return a=bs(a),a.tag=3,a}function rT(a,o,d,f){var m=d.type.getDerivedStateFromError;if(typeof m=="function"){var T=f.value;a.payload=function(){return m(T)},a.callback=function(){nT(o,d,f)}}var w=d.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(a.callback=function(){nT(o,d,f),typeof m!="function"&&(Ps===null?Ps=new Set([this]):Ps.add(this));var P=f.stack;this.componentDidCatch(f.value,{componentStack:P!==null?P:""})})}function _C(a,o,d,f,m){if(d.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=d.alternate,o!==null&&Rc(o,d,m,!0),d=xr.current,d!==null){switch(d.tag){case 13:return Ga===null?Up():d.alternate===null&&Kn===0&&(Kn=3),d.flags&=-257,d.flags|=65536,d.lanes=m,f===eE?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([f]):o.add(f),QE(a,f,m)),!1;case 22:return d.flags|=65536,f===eE?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([f]):d.add(f)),QE(a,f,m)),!1}throw Error(et(435,d.tag))}return QE(a,f,m),Up(),!1}if(Ke)return o=xr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=m,f!==Q_&&(a=Error(et(422),{cause:f}),lo(Yr(a,d)))):(f!==Q_&&(o=Error(et(423),{cause:f}),lo(Yr(o,d))),a=a.current.alternate,a.flags|=65536,m&=-m,a.lanes|=m,f=Yr(f,d),m=OE(a.stateNode,f,m),iE(a,m),Kn!==4&&(Kn=2)),!1;var T=Error(et(520),{cause:f});if(T=Yr(T,d),fu===null?fu=[T]:fu.push(T),Kn!==4&&(Kn=2),o===null)return!0;f=Yr(f,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,a=m&-m,d.lanes|=a,a=OE(d.stateNode,f,a),iE(d,a),!1;case 1:if(o=d.type,T=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Ps===null||!Ps.has(T))))return d.flags|=65536,m&=-m,d.lanes|=m,m=iT(m),rT(m,a,d,f),iE(d,m),!1}d=d.return}while(d!==null);return!1}var wE=Error(et(461)),Ti=!1;function ki(a,o,d,f){o.child=a===null?JS(o,null,d,f):bc(o,a.child,d,f)}function aT(a,o,d,f,m){d=d.render;var T=o.ref;if("ref"in f){var w={};for(var P in f)P!=="ref"&&(w[P]=f[P])}else w=f;return vc(o),f=cE(a,o,d,w,T,m),P=lE(),a!==null&&!Ti?(dE(a,o,m),Ns(a,o,m)):(Ke&&P&&J_(o),o.flags|=1,ki(a,o,f,m),o.child)}function ou(a,o,d,f,m){if(a===null){var T=d.type;return typeof T=="function"&&!z_(T)&&T.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=T,Sp(a,o,T,f,m)):(a=Fd(d.type,null,f,o,o.mode,m),a.ref=o.ref,a.return=o,o.child=a)}if(T=a.child,!UE(a,m)){var w=T.memoizedProps;if(d=d.compare,d=d!==null?d:xd,d(w,f)&&a.ref===o.ref)return Ns(a,o,m)}return o.flags|=1,a=Ss(T,f),a.ref=o.ref,a.return=o,o.child=a}function Sp(a,o,d,f,m){if(a!==null){var T=a.memoizedProps;if(xd(T,f)&&a.ref===o.ref)if(Ti=!1,o.pendingProps=f=T,UE(a,m))(a.flags&131072)!==0&&(Ti=!0);else return o.lanes=a.lanes,Ns(a,o,m)}return DE(a,o,d,f,m)}function NE(a,o,d){var f=o.pendingProps,m=f.children,T=a!==null?a.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=T!==null?T.baseLanes|d:d,a!==null){for(m=o.child=a.child,T=0;m!==null;)T=T|m.lanes|m.childLanes,m=m.sibling;o.childLanes=T&~f}else o.childLanes=0,o.child=null;return cu(a,o,f,d)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&Kh(o,T!==null?T.cachePool:null),T!==null?LS(o,T):sE(),QS(o);else return o.lanes=o.childLanes=536870912,cu(a,o,T!==null?T.baseLanes|d:d,d)}else T!==null?(Kh(o,T.cachePool),LS(o,T),go(),o.memoizedState=null):(a!==null&&Kh(o,null),sE(),go());return ki(a,o,m,d),o.child}function cu(a,o,d,f){var m=$_();return m=m===null?null:{parent:gi._currentValue,pool:m},o.memoizedState={baseLanes:d,cachePool:m},a!==null&&Kh(o,null),sE(),QS(o),a!==null&&Rc(a,o,f,!0),null}function lu(a,o){var d=o.ref;if(d===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(et(284));(a===null||a.ref!==d)&&(o.flags|=4194816)}}function DE(a,o,d,f,m){return vc(o),d=cE(a,o,d,f,void 0,m),f=lE(),a!==null&&!Ti?(dE(a,o,m),Ns(a,o,m)):(Ke&&f&&J_(o),o.flags|=1,ki(a,o,d,m),o.child)}function LE(a,o,d,f,m,T){return vc(o),o.updateQueue=null,d=kS(o,f,d,m),PS(a),f=lE(),a!==null&&!Ti?(dE(a,o,T),Ns(a,o,T)):(Ke&&f&&J_(o),o.flags|=1,ki(a,o,d,T),o.child)}function Tp(a,o,d,f,m){if(vc(o),o.stateNode===null){var T=ji,w=d.contextType;typeof w=="object"&&w!==null&&(T=li(w)),T=new d(f,T),o.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=Ha,o.stateNode=T,T._reactInternals=o,T=o.stateNode,T.props=f,T.state=o.memoizedState,T.refs={},Xd(o),w=d.contextType,T.context=typeof w=="object"&&w!==null?li(w):ji,T.state=o.memoizedState,w=d.getDerivedStateFromProps,typeof w=="function"&&(_p(o,d,w,f),T.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(w=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),w!==T.state&&Ha.enqueueReplaceState(T,T.state,null),Jd(o,f,T,m),Sl(),T.state=o.memoizedState),typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(a===null){T=o.stateNode;var P=o.memoizedProps,F=Ic(d,P);T.props=F;var Q=T.context,rt=d.contextType;w=ji,typeof rt=="object"&&rt!==null&&(w=li(rt));var _t=d.getDerivedStateFromProps;rt=typeof _t=="function"||typeof T.getSnapshotBeforeUpdate=="function",P=o.pendingProps!==P,rt||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(P||Q!==w)&&$S(o,T,f,w),As=!1;var $=o.memoizedState;T.state=$,Jd(o,f,T,m),Sl(),Q=o.memoizedState,P||$!==Q||As?(typeof _t=="function"&&(_p(o,d,_t,f),Q=o.memoizedState),(F=As||ZS(o,d,F,f,$,Q,w))?(rt||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(o.flags|=4194308)):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=Q),T.props=f,T.state=Q,T.context=w,f=F):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{T=o.stateNode,Jh(a,o),w=o.memoizedProps,rt=Ic(d,w),T.props=rt,_t=o.pendingProps,$=T.context,Q=d.contextType,F=ji,typeof Q=="object"&&Q!==null&&(F=li(Q)),P=d.getDerivedStateFromProps,(Q=typeof P=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(w!==_t||$!==F)&&$S(o,T,f,F),As=!1,$=o.memoizedState,T.state=$,Jd(o,f,T,m),Sl();var tt=o.memoizedState;w!==_t||$!==tt||As||a!==null&&a.dependencies!==null&&Gh(a.dependencies)?(typeof P=="function"&&(_p(o,d,P,f),tt=o.memoizedState),(rt=As||ZS(o,d,rt,f,$,tt,F)||a!==null&&a.dependencies!==null&&Gh(a.dependencies))?(Q||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,tt,F),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,tt,F)),typeof T.componentDidUpdate=="function"&&(o.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof T.componentDidUpdate!="function"||w===a.memoizedProps&&$===a.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||w===a.memoizedProps&&$===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=tt),T.props=f,T.state=tt,T.context=F,f=rt):(typeof T.componentDidUpdate!="function"||w===a.memoizedProps&&$===a.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||w===a.memoizedProps&&$===a.memoizedState||(o.flags|=1024),f=!1)}return T=f,lu(a,o),f=(o.flags&128)!==0,T||f?(T=o.stateNode,d=f&&typeof d.getDerivedStateFromError!="function"?null:T.render(),o.flags|=1,a!==null&&f?(o.child=bc(o,a.child,null,m),o.child=bc(o,null,d,m)):ki(a,o,d,m),o.memoizedState=T.state,a=o.child):a=Ns(a,o,m),a}function sT(a,o,d,f){return Wd(),o.flags|=256,ki(a,o,d,f),o.child}var Rp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vp(a){return{baseLanes:a,cachePool:wS()}}function PE(a,o,d){return a=a!==null?a.childLanes&~d:0,o&&(a|=qr),a}function kE(a,o,d){var f=o.pendingProps,m=!1,T=(o.flags&128)!==0,w;if((w=T)||(w=a!==null&&a.memoizedState===null?!1:(Si.current&2)!==0),w&&(m=!0,o.flags&=-129),w=(o.flags&32)!==0,o.flags&=-33,a===null){if(Ke){if(m?mo(o):go(),Ke){var P=Wn,F;if(F=P){t:{for(F=P,P=Fa;F.nodeType!==8;){if(!P){P=null;break t}if(F=ya(F.nextSibling),F===null){P=null;break t}}P=F}P!==null?(o.memoizedState={dehydrated:P,treeContext:Ba!==null?{id:Ts,overflow:Rs}:null,retryLane:536870912,hydrationErrors:null},F=Li(18,null,null,0),F.stateNode=P,F.return=o,o.child=F,Pi=o,Wn=null,F=!0):F=!1}F||Tc(o)}if(P=o.memoizedState,P!==null&&(P=P.dehydrated,P!==null))return dm(P)?o.lanes=32:o.lanes=536870912,null;ws(o)}return P=f.children,f=f.fallback,m?(go(),m=o.mode,P=Cp({mode:"hidden",children:P},m),f=mc(f,m,d,null),P.return=o,f.return=o,P.sibling=f,o.child=P,m=o.child,m.memoizedState=vp(d),m.childLanes=PE(a,w,d),o.memoizedState=Rp,f):(mo(o),yp(o,P))}if(F=a.memoizedState,F!==null&&(P=F.dehydrated,P!==null)){if(T)o.flags&256?(mo(o),o.flags&=-257,o=ME(a,o,d)):o.memoizedState!==null?(go(),o.child=a.child,o.flags|=128,o=null):(go(),m=f.fallback,P=o.mode,f=Cp({mode:"visible",children:f.children},P),m=mc(m,P,d,null),m.flags|=2,f.return=o,m.return=o,f.sibling=m,o.child=f,bc(o,a.child,null,d),f=o.child,f.memoizedState=vp(d),f.childLanes=PE(a,w,d),o.memoizedState=Rp,o=m);else if(mo(o),dm(P)){if(w=P.nextSibling&&P.nextSibling.dataset,w)var Q=w.dgst;w=Q,f=Error(et(419)),f.stack="",f.digest=w,lo({value:f,source:null,stack:null}),o=ME(a,o,d)}else if(Ti||Rc(a,o,d,!1),w=(d&a.childLanes)!==0,Ti||w){if(w=Sn,w!==null&&(f=d&-d,f=(f&42)!==0?1:f_(f),f=(f&(w.suspendedLanes|d))!==0?0:f,f!==0&&f!==F.retryLane))throw F.retryLane=f,oo(a,f),Br(w,a,f),wE;P.data==="$?"||Up(),o=ME(a,o,d)}else P.data==="$?"?(o.flags|=192,o.child=a.child,o=null):(a=F.treeContext,Wn=ya(P.nextSibling),Pi=o,Ke=!0,Sc=null,Fa=!1,a!==null&&(zr[Ur++]=Ts,zr[Ur++]=Rs,zr[Ur++]=Ba,Ts=a.id,Rs=a.overflow,Ba=o),o=yp(o,f.children),o.flags|=4096);return o}return m?(go(),m=f.fallback,P=o.mode,F=a.child,Q=F.sibling,f=Ss(F,{mode:"hidden",children:f.children}),f.subtreeFlags=F.subtreeFlags&65011712,Q!==null?m=Ss(Q,m):(m=mc(m,P,d,null),m.flags|=2),m.return=o,f.return=o,f.sibling=m,o.child=f,f=m,m=o.child,P=a.child.memoizedState,P===null?P=vp(d):(F=P.cachePool,F!==null?(Q=gi._currentValue,F=F.parent!==Q?{parent:Q,pool:Q}:F):F=wS(),P={baseLanes:P.baseLanes|d,cachePool:F}),m.memoizedState=P,m.childLanes=PE(a,w,d),o.memoizedState=Rp,f):(mo(o),d=a.child,a=d.sibling,d=Ss(d,{mode:"visible",children:f.children}),d.return=o,d.sibling=null,a!==null&&(w=o.deletions,w===null?(o.deletions=[a],o.flags|=16):w.push(a)),o.child=d,o.memoizedState=null,d)}function yp(a,o){return o=Cp({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Cp(a,o){return a=Li(22,a,null,o),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function ME(a,o,d){return bc(o,a.child,null,d),a=yp(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function oT(a,o,d){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),Fh(a.return,o,d)}function Dl(a,o,d,f,m){var T=a.memoizedState;T===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:d,tailMode:m}:(T.isBackwards=o,T.rendering=null,T.renderingStartTime=0,T.last=f,T.tail=d,T.tailMode=m)}function cT(a,o,d){var f=o.pendingProps,m=f.revealOrder,T=f.tail;if(ki(a,o,f.children,d),f=Si.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)t:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&oT(a,d,o);else if(a.tag===19)oT(a,d,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break t;for(;a.sibling===null;){if(a.return===null||a.return===o)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}switch(Ot(Si,f),m){case"forwards":for(d=o.child,m=null;d!==null;)a=d.alternate,a!==null&&fp(a)===null&&(m=d),d=d.sibling;d=m,d===null?(m=o.child,o.child=null):(m=d.sibling,d.sibling=null),Dl(o,!1,m,d,T);break;case"backwards":for(d=null,m=o.child,o.child=null;m!==null;){if(a=m.alternate,a!==null&&fp(a)===null){o.child=m;break}a=m.sibling,m.sibling=d,d=m,m=a}Dl(o,!0,d,null,T);break;case"together":Dl(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Ns(a,o,d){if(a!==null&&(o.dependencies=a.dependencies),Io|=o.lanes,(d&o.childLanes)===0)if(a!==null){if(Rc(a,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(et(153));if(o.child!==null){for(a=o.child,d=Ss(a,a.pendingProps),o.child=d,d.return=o;a.sibling!==null;)a=a.sibling,d=d.sibling=Ss(a,a.pendingProps),d.return=o;d.sibling=null}return o.child}function UE(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&Gh(a)))}function lT(a,o,d){switch(o.tag){case 3:kn(o,o.stateNode.containerInfo),uo(o,gi,a.memoizedState.cache),Wd();break;case 27:case 5:s_(o);break;case 4:kn(o,o.stateNode.containerInfo);break;case 10:uo(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(mo(o),o.flags|=128,null):(d&o.child.childLanes)!==0?kE(a,o,d):(mo(o),a=Ns(a,o,d),a!==null?a.sibling:null);mo(o);break;case 19:var m=(a.flags&128)!==0;if(f=(d&o.childLanes)!==0,f||(Rc(a,o,d,!1),f=(d&o.childLanes)!==0),m){if(f)return cT(a,o,d);o.flags|=128}if(m=o.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Ot(Si,Si.current),f)break;return null;case 22:case 23:return o.lanes=0,NE(a,o,d);case 24:uo(o,gi,a.memoizedState.cache)}return Ns(a,o,d)}function dT(a,o,d){if(a!==null)if(a.memoizedProps!==o.pendingProps)Ti=!0;else{if(!UE(a,d)&&(o.flags&128)===0)return Ti=!1,lT(a,o,d);Ti=(a.flags&131072)!==0}else Ti=!1,Ke&&(o.flags&1048576)!==0&&yS(o,Gd,o.index);switch(o.lanes=0,o.tag){case 16:t:{a=o.pendingProps;var f=o.elementType,m=f._init;if(f=m(f._payload),o.type=f,typeof f=="function")z_(f)?(a=Ic(f,a),o.tag=1,o=Tp(null,o,f,a,d)):(o.tag=0,o=DE(null,o,f,a,d));else{if(f!=null){if(m=f.$$typeof,m===dr){o.tag=11,o=aT(null,o,f,a,d);break t}else if(m===dn){o.tag=14,o=ou(null,o,f,a,d);break t}}throw o=cn(f)||f,Error(et(306,o,""))}}return o;case 0:return DE(a,o,o.type,o.pendingProps,d);case 1:return f=o.type,m=Ic(f,o.pendingProps),Tp(a,o,f,m,d);case 3:t:{if(kn(o,o.stateNode.containerInfo),a===null)throw Error(et(387));f=o.pendingProps;var T=o.memoizedState;m=T.element,Jh(a,o),Jd(o,f,null,d);var w=o.memoizedState;if(f=w.cache,uo(o,gi,f),f!==T.cache&&jh(o,[gi],d,!0),Sl(),f=w.element,T.isDehydrated)if(T={element:f,isDehydrated:!1,cache:w.cache},o.updateQueue.baseState=T,o.memoizedState=T,o.flags&256){o=sT(a,o,f,d);break t}else if(f!==m){m=Yr(Error(et(424)),o),lo(m),o=sT(a,o,f,d);break t}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Wn=ya(a.firstChild),Pi=o,Ke=!0,Sc=null,Fa=!0,d=JS(o,null,f,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Wd(),f===m){o=Ns(a,o,d);break t}ki(a,o,f,d)}o=o.child}return o;case 26:return lu(a,o),a===null?(d=QT(o.type,null,o.pendingProps,null))?o.memoizedState=d:Ke||(d=o.type,a=o.pendingProps,f=Jp(Zt.current).createElement(d),f[un]=o,f[hr]=a,Mi(f,d,a),oi(f),o.stateNode=f):o.memoizedState=QT(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return s_(o),a===null&&Ke&&(f=o.stateNode=zT(o.type,o.pendingProps,Zt.current),Pi=o,Fa=!0,m=Wn,Po(o.type)?(um=m,Wn=ya(f.firstChild)):Wn=m),ki(a,o,o.pendingProps.children,d),lu(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&Ke&&((m=f=Wn)&&(f=wC(f,o.type,o.pendingProps,Fa),f!==null?(o.stateNode=f,Pi=o,Wn=ya(f.firstChild),Fa=!1,m=!0):m=!1),m||Tc(o)),s_(o),m=o.type,T=o.pendingProps,w=a!==null?a.memoizedProps:null,f=T.children,sm(m,T)?f=null:w!==null&&sm(m,w)&&(o.flags|=32),o.memoizedState!==null&&(m=cE(a,o,uC,null,null,d),ql._currentValue=m),lu(a,o),ki(a,o,f,d),o.child;case 6:return a===null&&Ke&&((a=d=Wn)&&(d=NC(d,o.pendingProps,Fa),d!==null?(o.stateNode=d,Pi=o,Wn=null,a=!0):a=!1),a||Tc(o)),null;case 13:return kE(a,o,d);case 4:return kn(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=bc(o,null,f,d):ki(a,o,f,d),o.child;case 11:return aT(a,o,o.type,o.pendingProps,d);case 7:return ki(a,o,o.pendingProps,d),o.child;case 8:return ki(a,o,o.pendingProps.children,d),o.child;case 12:return ki(a,o,o.pendingProps.children,d),o.child;case 10:return f=o.pendingProps,uo(o,o.type,f.value),ki(a,o,f.children,d),o.child;case 9:return m=o.type._context,f=o.pendingProps.children,vc(o),m=li(m),f=f(m),o.flags|=1,ki(a,o,f,d),o.child;case 14:return ou(a,o,o.type,o.pendingProps,d);case 15:return Sp(a,o,o.type,o.pendingProps,d);case 19:return cT(a,o,d);case 31:return f=o.pendingProps,d=o.mode,f={mode:f.mode,children:f.children},a===null?(d=Cp(f,d),d.ref=o.ref,o.child=d,d.return=o,o=d):(d=Ss(a.child,f),d.ref=o.ref,o.child=d,d.return=o,o=d),o;case 22:return NE(a,o,d);case 24:return vc(o),f=li(gi),a===null?(m=$_(),m===null&&(m=Sn,T=Wh(),m.pooledCache=T,T.refCount++,T!==null&&(m.pooledCacheLanes|=d),m=T),o.memoizedState={parent:f,cache:m},Xd(o),uo(o,gi,m)):((a.lanes&d)!==0&&(Jh(a,o),Jd(o,null,null,d),Sl()),m=a.memoizedState,T=o.memoizedState,m.parent!==f?(m={parent:f,cache:f},o.memoizedState=m,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=m),uo(o,gi,f)):(f=T.cache,uo(o,gi,f),f!==m.cache&&jh(o,[gi],d,!0))),ki(a,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(et(156,o.tag))}function Ds(a){a.flags|=4}function Ap(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!iR(o)){if(o=xr.current,o!==null&&((xe&4194048)===xe?Ga!==null:(xe&62914560)!==xe&&(xe&536870912)===0||o!==Ga))throw qd=eE,tE;a.flags|=8192}}function bp(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?h_():536870912,a.lanes|=o,Oo|=o)}function Oc(a,o){if(!Ke)switch(a.tailMode){case"hidden":o=a.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?a.tail=null:d.sibling=null;break;case"collapsed":d=a.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function xn(a){var o=a.alternate!==null&&a.alternate.child===a.child,d=0,f=0;if(o)for(var m=a.child;m!==null;)d|=m.lanes|m.childLanes,f|=m.subtreeFlags&65011712,f|=m.flags&65011712,m.return=a,m=m.sibling;else for(m=a.child;m!==null;)d|=m.lanes|m.childLanes,f|=m.subtreeFlags,f|=m.flags,m.return=a,m=m.sibling;return a.subtreeFlags|=f,a.childLanes=d,o}function uT(a,o,d){var f=o.pendingProps;switch(Bh(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xn(o),null;case 1:return xn(o),null;case 3:return d=o.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Cs(gi),Ua(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(a===null||a.child===null)&&(Hd(o)?Ds(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,bS())),xn(o),null;case 26:return d=o.memoizedState,a===null?(Ds(o),d!==null?(xn(o),Ap(o,d)):(xn(o),o.flags&=-16777217)):d?d!==a.memoizedState?(Ds(o),xn(o),Ap(o,d)):(xn(o),o.flags&=-16777217):(a.memoizedProps!==f&&Ds(o),xn(o),o.flags&=-16777217),null;case 27:sc(o),d=Zt.current;var m=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Ds(o);else{if(!f){if(o.stateNode===null)throw Error(et(166));return xn(o),null}a=Bt.current,Hd(o)?CS(o):(a=zT(m,f,d),o.stateNode=a,Ds(o))}return xn(o),null;case 5:if(sc(o),d=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Ds(o);else{if(!f){if(o.stateNode===null)throw Error(et(166));return xn(o),null}if(a=Bt.current,Hd(o))CS(o);else{switch(m=Jp(Zt.current),a){case 1:a=m.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:a=m.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":a=m.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":a=m.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":a=m.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof f.is=="string"?m.createElement("select",{is:f.is}):m.createElement("select"),f.multiple?a.multiple=!0:f.size&&(a.size=f.size);break;default:a=typeof f.is=="string"?m.createElement(d,{is:f.is}):m.createElement(d)}}a[un]=o,a[hr]=f;t:for(m=o.child;m!==null;){if(m.tag===5||m.tag===6)a.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===o)break t;for(;m.sibling===null;){if(m.return===null||m.return===o)break t;m=m.return}m.sibling.return=m.return,m=m.sibling}o.stateNode=a;t:switch(Mi(a,d,f),d){case"button":case"input":case"select":case"textarea":a=!!f.autoFocus;break t;case"img":a=!0;break t;default:a=!1}a&&Ds(o)}}return xn(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==f&&Ds(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(et(166));if(a=Zt.current,Hd(o)){if(a=o.stateNode,d=o.memoizedProps,f=null,m=Pi,m!==null)switch(m.tag){case 27:case 5:f=m.memoizedProps}a[un]=o,a=!!(a.nodeValue===d||f!==null&&f.suppressHydrationWarning===!0||jT(a.nodeValue,d)),a||Tc(o)}else a=Jp(a).createTextNode(f),a[un]=o,o.stateNode=a}return xn(o),null;case 13:if(f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(m=Hd(o),f!==null&&f.dehydrated!==null){if(a===null){if(!m)throw Error(et(318));if(m=o.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(et(317));m[un]=o}else Wd(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;xn(o),m=!1}else m=bS(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=m),m=!0;if(!m)return o.flags&256?(ws(o),o):(ws(o),null)}if(ws(o),(o.flags&128)!==0)return o.lanes=d,o;if(d=f!==null,a=a!==null&&a.memoizedState!==null,d){f=o.child,m=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(m=f.alternate.memoizedState.cachePool.pool);var T=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),T!==m&&(f.flags|=2048)}return d!==a&&d&&(o.child.flags|=8192),bp(o,o.updateQueue),xn(o),null;case 4:return Ua(),a===null&&Lo(o.stateNode.containerInfo),xn(o),null;case 10:return Cs(o.type),xn(o),null;case 19:if(Lt(Si),m=o.memoizedState,m===null)return xn(o),null;if(f=(o.flags&128)!==0,T=m.rendering,T===null)if(f)Oc(m,!1);else{if(Kn!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(T=fp(a),T!==null){for(o.flags|=128,Oc(m,!1),a=T.updateQueue,o.updateQueue=a,bp(o,a),o.subtreeFlags=0,a=d,d=o.child;d!==null;)vS(d,a),d=d.sibling;return Ot(Si,Si.current&1|2),o.child}a=a.sibling}m.tail!==null&&xa()>Ml&&(o.flags|=128,f=!0,Oc(m,!1),o.lanes=4194304)}else{if(!f)if(a=fp(T),a!==null){if(o.flags|=128,f=!0,a=a.updateQueue,o.updateQueue=a,bp(o,a),Oc(m,!0),m.tail===null&&m.tailMode==="hidden"&&!T.alternate&&!Ke)return xn(o),null}else 2*xa()-m.renderingStartTime>Ml&&d!==536870912&&(o.flags|=128,f=!0,Oc(m,!1),o.lanes=4194304);m.isBackwards?(T.sibling=o.child,o.child=T):(a=m.last,a!==null?a.sibling=T:o.child=T,m.last=T)}return m.tail!==null?(o=m.tail,m.rendering=o,m.tail=o.sibling,m.renderingStartTime=xa(),o.sibling=null,a=Si.current,Ot(Si,f?a&1|2:a&1),o):(xn(o),null);case 22:case 23:return ws(o),oE(),f=o.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(d&536870912)!==0&&(o.flags&128)===0&&(xn(o),o.subtreeFlags&6&&(o.flags|=8192)):xn(o),d=o.updateQueue,d!==null&&bp(o,d.retryQueue),d=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==d&&(o.flags|=2048),a!==null&&Lt(yc),null;case 24:return d=null,a!==null&&(d=a.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),Cs(gi),xn(o),null;case 25:return null;case 30:return null}throw Error(et(156,o.tag))}function EC(a,o){switch(Bh(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return Cs(gi),Ua(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return sc(o),null;case 13:if(ws(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(et(340));Wd()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Lt(Si),null;case 4:return Ua(),null;case 10:return Cs(o.type),null;case 22:case 23:return ws(o),oE(),a!==null&&Lt(yc),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return Cs(gi),null;case 25:return null;default:return null}}function hT(a,o){switch(Bh(o),o.tag){case 3:Cs(gi),Ua();break;case 26:case 27:case 5:sc(o);break;case 4:Ua();break;case 13:ws(o);break;case 19:Lt(Si);break;case 10:Cs(o.type);break;case 22:case 23:ws(o),oE(),a!==null&&Lt(yc);break;case 24:Cs(gi)}}function Ll(a,o){try{var d=o.updateQueue,f=d!==null?d.lastEffect:null;if(f!==null){var m=f.next;d=m;do{if((d.tag&a)===a){f=void 0;var T=d.create,w=d.inst;f=T(),w.destroy=f}d=d.next}while(d!==m)}}catch(P){Tn(o,o.return,P)}}function So(a,o,d){try{var f=o.updateQueue,m=f!==null?f.lastEffect:null;if(m!==null){var T=m.next;f=T;do{if((f.tag&a)===a){var w=f.inst,P=w.destroy;if(P!==void 0){w.destroy=void 0,m=o;var F=d,Q=P;try{Q()}catch(rt){Tn(m,F,rt)}}}f=f.next}while(f!==T)}}catch(rt){Tn(o,o.return,rt)}}function pT(a){var o=a.updateQueue;if(o!==null){var d=a.stateNode;try{aE(o,d)}catch(f){Tn(a,a.return,f)}}}function xE(a,o,d){d.props=Ic(a.type,a.memoizedProps),d.state=a.memoizedState;try{d.componentWillUnmount()}catch(f){Tn(a,o,f)}}function du(a,o){try{var d=a.ref;if(d!==null){switch(a.tag){case 26:case 27:case 5:var f=a.stateNode;break;case 30:f=a.stateNode;break;default:f=a.stateNode}typeof d=="function"?a.refCleanup=d(f):d.current=f}}catch(m){Tn(a,o,m)}}function ga(a,o){var d=a.ref,f=a.refCleanup;if(d!==null)if(typeof f=="function")try{f()}catch(m){Tn(a,o,m)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(m){Tn(a,o,m)}else d.current=null}function Ip(a){var o=a.type,d=a.memoizedProps,f=a.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&f.focus();break t;case"img":d.src?f.src=d.src:d.srcSet&&(f.srcset=d.srcSet)}}catch(m){Tn(a,a.return,m)}}function VE(a,o,d){try{var f=a.stateNode;CC(f,a.type,d,o),f[hr]=o}catch(m){Tn(a,a.return,m)}}function fT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Po(a.type)||a.tag===4}function wc(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||fT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Po(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Op(a,o,d){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(a,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(a),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Xp));else if(f!==4&&(f===27&&Po(a.type)&&(d=a.stateNode,o=null),a=a.child,a!==null))for(Op(a,o,d),a=a.sibling;a!==null;)Op(a,o,d),a=a.sibling}function To(a,o,d){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?d.insertBefore(a,o):d.appendChild(a);else if(f!==4&&(f===27&&Po(a.type)&&(d=a.stateNode),a=a.child,a!==null))for(To(a,o,d),a=a.sibling;a!==null;)To(a,o,d),a=a.sibling}function Nc(a){var o=a.stateNode,d=a.memoizedProps;try{for(var f=a.type,m=o.attributes;m.length;)o.removeAttributeNode(m[0]);Mi(o,f,d),o[un]=a,o[hr]=d}catch(T){Tn(a,a.return,T)}}var Wa=!1,Vn=!1,Pl=!1,_T=typeof WeakSet=="function"?WeakSet:Set,Ii=null;function mC(a,o){if(a=a.containerInfo,rm=ef,a=fS(a),$i(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else t:{d=(d=a.ownerDocument)&&d.defaultView||window;var f=d.getSelection&&d.getSelection();if(f&&f.rangeCount!==0){d=f.anchorNode;var m=f.anchorOffset,T=f.focusNode;f=f.focusOffset;try{d.nodeType,T.nodeType}catch{d=null;break t}var w=0,P=-1,F=-1,Q=0,rt=0,_t=a,$=null;e:for(;;){for(var tt;_t!==d||m!==0&&_t.nodeType!==3||(P=w+m),_t!==T||f!==0&&_t.nodeType!==3||(F=w+f),_t.nodeType===3&&(w+=_t.nodeValue.length),(tt=_t.firstChild)!==null;)$=_t,_t=tt;for(;;){if(_t===a)break e;if($===d&&++Q===m&&(P=w),$===T&&++rt===f&&(F=w),(tt=_t.nextSibling)!==null)break;_t=$,$=_t.parentNode}_t=tt}d=P===-1||F===-1?null:{start:P,end:F}}else d=null}d=d||{start:0,end:0}}else d=null;for(am={focusedElem:a,selectionRange:d},ef=!1,Ii=o;Ii!==null;)if(o=Ii,a=o.child,(o.subtreeFlags&1024)!==0&&a!==null)a.return=o,Ii=a;else for(;Ii!==null;){switch(o=Ii,T=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&T!==null){a=void 0,d=o,m=T.memoizedProps,T=T.memoizedState,f=d.stateNode;try{var oe=Ic(d.type,m,d.elementType===d.type);a=f.getSnapshotBeforeUpdate(oe,T),f.__reactInternalSnapshotBeforeUpdate=a}catch(Ht){Tn(d,d.return,Ht)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,d=a.nodeType,d===9)lm(a);else if(d===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":lm(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(et(163))}if(a=o.sibling,a!==null){a.return=o.return,Ii=a;break}Ii=o.return}}function BE(a,o,d){var f=d.flags;switch(d.tag){case 0:case 11:case 15:Ls(a,d),f&4&&Ll(5,d);break;case 1:if(Ls(a,d),f&4)if(a=d.stateNode,o===null)try{a.componentDidMount()}catch(w){Tn(d,d.return,w)}else{var m=Ic(d.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(m,o,a.__reactInternalSnapshotBeforeUpdate)}catch(w){Tn(d,d.return,w)}}f&64&&pT(d),f&512&&du(d,d.return);break;case 3:if(Ls(a,d),f&64&&(a=d.updateQueue,a!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{aE(a,o)}catch(w){Tn(d,d.return,w)}}break;case 27:o===null&&f&4&&Nc(d);case 26:case 5:Ls(a,d),o===null&&f&4&&Ip(d),f&512&&du(d,d.return);break;case 12:Ls(a,d);break;case 13:Ls(a,d),f&4&&mT(a,d),f&64&&(a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(d=$E.bind(null,d),DC(a,d))));break;case 22:if(f=d.memoizedState!==null||Wa,!f){o=o!==null&&o.memoizedState!==null||Vn,m=Wa;var T=Vn;Wa=f,(Vn=o)&&!T?vo(a,d,(d.subtreeFlags&8772)!==0):Ls(a,d),Wa=m,Vn=T}break;case 30:break;default:Ls(a,d)}}function ET(a){var o=a.alternate;o!==null&&(a.alternate=null,ET(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&gh(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Mn=null,Er=!1;function Sa(a,o,d){for(d=d.child;d!==null;)uu(a,o,d),d=d.sibling}function uu(a,o,d){if(gn&&typeof gn.onCommitFiberUnmount=="function")try{gn.onCommitFiberUnmount(el,d)}catch{}switch(d.tag){case 26:Vn||ga(d,o),Sa(a,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:Vn||ga(d,o);var f=Mn,m=Er;Po(d.type)&&(Mn=d.stateNode,Er=!1),Sa(a,o,d),yu(d.stateNode),Mn=f,Er=m;break;case 5:Vn||ga(d,o);case 6:if(f=Mn,m=Er,Mn=null,Sa(a,o,d),Mn=f,Er=m,Mn!==null)if(Er)try{(Mn.nodeType===9?Mn.body:Mn.nodeName==="HTML"?Mn.ownerDocument.body:Mn).removeChild(d.stateNode)}catch(T){Tn(d,o,T)}else try{Mn.removeChild(d.stateNode)}catch(T){Tn(d,o,T)}break;case 18:Mn!==null&&(Er?(a=Mn,KT(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,d.stateNode),Rr(a)):KT(Mn,d.stateNode));break;case 4:f=Mn,m=Er,Mn=d.stateNode.containerInfo,Er=!0,Sa(a,o,d),Mn=f,Er=m;break;case 0:case 11:case 14:case 15:Vn||So(2,d,o),Vn||So(4,d,o),Sa(a,o,d);break;case 1:Vn||(ga(d,o),f=d.stateNode,typeof f.componentWillUnmount=="function"&&xE(d,o,f)),Sa(a,o,d);break;case 21:Sa(a,o,d);break;case 22:Vn=(f=Vn)||d.memoizedState!==null,Sa(a,o,d),Vn=f;break;default:Sa(a,o,d)}}function mT(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Rr(a)}catch(d){Tn(o,o.return,d)}}function kl(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new _T),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new _T),o;default:throw Error(et(435,a.tag))}}function wp(a,o){var d=kl(a);o.forEach(function(f){var m=TC.bind(null,a,f);d.has(f)||(d.add(f),f.then(m,m))})}function Nn(a,o){var d=o.deletions;if(d!==null)for(var f=0;f<d.length;f++){var m=d[f],T=a,w=o,P=w;t:for(;P!==null;){switch(P.tag){case 27:if(Po(P.type)){Mn=P.stateNode,Er=!1;break t}break;case 5:Mn=P.stateNode,Er=!1;break t;case 3:case 4:Mn=P.stateNode.containerInfo,Er=!0;break t}P=P.return}if(Mn===null)throw Error(et(160));uu(T,w,m),Mn=null,Er=!1,T=m.alternate,T!==null&&(T.return=null),m.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)gT(o,a),o=o.sibling}var Ta=null;function gT(a,o){var d=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Nn(o,a),mr(a),f&4&&(So(3,a,a.return),Ll(3,a),So(5,a,a.return));break;case 1:Nn(o,a),mr(a),f&512&&(Vn||d===null||ga(d,d.return)),f&64&&Wa&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(d=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=d===null?f:d.concat(f))));break;case 26:var m=Ta;if(Nn(o,a),mr(a),f&512&&(Vn||d===null||ga(d,d.return)),f&4){var T=d!==null?d.memoizedState:null;if(f=a.memoizedState,d===null)if(f===null)if(a.stateNode===null){t:{f=a.type,d=a.memoizedProps,m=m.ownerDocument||m;e:switch(f){case"title":T=m.getElementsByTagName("title")[0],(!T||T[Od]||T[un]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=m.createElement(f),m.head.insertBefore(T,m.querySelector("head > title"))),Mi(T,f,d),T[un]=a,oi(T),f=T;break t;case"link":var w=eR("link","href",m).get(f+(d.href||""));if(w){for(var P=0;P<w.length;P++)if(T=w[P],T.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&T.getAttribute("rel")===(d.rel==null?null:d.rel)&&T.getAttribute("title")===(d.title==null?null:d.title)&&T.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){w.splice(P,1);break e}}T=m.createElement(f),Mi(T,f,d),m.head.appendChild(T);break;case"meta":if(w=eR("meta","content",m).get(f+(d.content||""))){for(P=0;P<w.length;P++)if(T=w[P],T.getAttribute("content")===(d.content==null?null:""+d.content)&&T.getAttribute("name")===(d.name==null?null:d.name)&&T.getAttribute("property")===(d.property==null?null:d.property)&&T.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&T.getAttribute("charset")===(d.charSet==null?null:d.charSet)){w.splice(P,1);break e}}T=m.createElement(f),Mi(T,f,d),m.head.appendChild(T);break;default:throw Error(et(468,f))}T[un]=a,oi(T),f=T}a.stateNode=f}else nR(m,a.type,a.stateNode);else a.stateNode=tR(m,f,a.memoizedProps);else T!==f?(T===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):T.count--,f===null?nR(m,a.type,a.stateNode):tR(m,f,a.memoizedProps)):f===null&&a.stateNode!==null&&VE(a,a.memoizedProps,d.memoizedProps)}break;case 27:Nn(o,a),mr(a),f&512&&(Vn||d===null||ga(d,d.return)),d!==null&&f&4&&VE(a,a.memoizedProps,d.memoizedProps);break;case 5:if(Nn(o,a),mr(a),f&512&&(Vn||d===null||ga(d,d.return)),a.flags&32){m=a.stateNode;try{hc(m,"")}catch(tt){Tn(a,a.return,tt)}}f&4&&a.stateNode!=null&&(m=a.memoizedProps,VE(a,m,d!==null?d.memoizedProps:m)),f&1024&&(Pl=!0);break;case 6:if(Nn(o,a),mr(a),f&4){if(a.stateNode===null)throw Error(et(162));f=a.memoizedProps,d=a.stateNode;try{d.nodeValue=f}catch(tt){Tn(a,a.return,tt)}}break;case 3:if(bu=null,m=Ta,Ta=Qp(o.containerInfo),Nn(o,a),Ta=m,mr(a),f&4&&d!==null&&d.memoizedState.isDehydrated)try{Rr(o.containerInfo)}catch(tt){Tn(a,a.return,tt)}Pl&&(Pl=!1,ST(a));break;case 4:f=Ta,Ta=Qp(a.stateNode.containerInfo),Nn(o,a),mr(a),Ta=f;break;case 12:Nn(o,a),mr(a);break;case 13:Nn(o,a),mr(a),a.child.flags&8192&&a.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(YE=xa()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,wp(a,f)));break;case 22:m=a.memoizedState!==null;var F=d!==null&&d.memoizedState!==null,Q=Wa,rt=Vn;if(Wa=Q||m,Vn=rt||F,Nn(o,a),Vn=rt,Wa=Q,mr(a),f&8192)t:for(o=a.stateNode,o._visibility=m?o._visibility&-2:o._visibility|1,m&&(d===null||F||Wa||Vn||Ro(a)),d=null,o=a;;){if(o.tag===5||o.tag===26){if(d===null){F=d=o;try{if(T=F.stateNode,m)w=T.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{P=F.stateNode;var _t=F.memoizedProps.style,$=_t!=null&&_t.hasOwnProperty("display")?_t.display:null;P.style.display=$==null||typeof $=="boolean"?"":(""+$).trim()}}catch(tt){Tn(F,F.return,tt)}}}else if(o.tag===6){if(d===null){F=o;try{F.stateNode.nodeValue=m?"":F.memoizedProps}catch(tt){Tn(F,F.return,tt)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break t;for(;o.sibling===null;){if(o.return===null||o.return===a)break t;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=a.updateQueue,f!==null&&(d=f.retryQueue,d!==null&&(f.retryQueue=null,wp(a,d))));break;case 19:Nn(o,a),mr(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,wp(a,f)));break;case 30:break;case 21:break;default:Nn(o,a),mr(a)}}function mr(a){var o=a.flags;if(o&2){try{for(var d,f=a.return;f!==null;){if(fT(f)){d=f;break}f=f.return}if(d==null)throw Error(et(160));switch(d.tag){case 27:var m=d.stateNode,T=wc(a);To(a,T,m);break;case 5:var w=d.stateNode;d.flags&32&&(hc(w,""),d.flags&=-33);var P=wc(a);To(a,P,w);break;case 3:case 4:var F=d.stateNode.containerInfo,Q=wc(a);Op(a,Q,F);break;default:throw Error(et(161))}}catch(rt){Tn(a,a.return,rt)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function ST(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;ST(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function Ls(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)BE(a,o.alternate,o),o=o.sibling}function Ro(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:So(4,o,o.return),Ro(o);break;case 1:ga(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&xE(o,o.return,d),Ro(o);break;case 27:yu(o.stateNode);case 26:case 5:ga(o,o.return),Ro(o);break;case 22:o.memoizedState===null&&Ro(o);break;case 30:Ro(o);break;default:Ro(o)}a=a.sibling}}function vo(a,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,m=a,T=o,w=T.flags;switch(T.tag){case 0:case 11:case 15:vo(m,T,d),Ll(4,T);break;case 1:if(vo(m,T,d),f=T,m=f.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(Q){Tn(f,f.return,Q)}if(f=T,m=f.updateQueue,m!==null){var P=f.stateNode;try{var F=m.shared.hiddenCallbacks;if(F!==null)for(m.shared.hiddenCallbacks=null,m=0;m<F.length;m++)DS(F[m],P)}catch(Q){Tn(f,f.return,Q)}}d&&w&64&&pT(T),du(T,T.return);break;case 27:Nc(T);case 26:case 5:vo(m,T,d),d&&f===null&&w&4&&Ip(T),du(T,T.return);break;case 12:vo(m,T,d);break;case 13:vo(m,T,d),d&&w&4&&mT(m,T);break;case 22:T.memoizedState===null&&vo(m,T,d),du(T,T.return);break;case 30:break;default:vo(m,T,d)}o=o.sibling}}function Np(a,o){var d=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==d&&(a!=null&&a.refCount++,d!=null&&Kd(d))}function FE(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Kd(a))}function Ka(a,o,d,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)TT(a,o,d,f),o=o.sibling}function TT(a,o,d,f){var m=o.flags;switch(o.tag){case 0:case 11:case 15:Ka(a,o,d,f),m&2048&&Ll(9,o);break;case 1:Ka(a,o,d,f);break;case 3:Ka(a,o,d,f),m&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Kd(a)));break;case 12:if(m&2048){Ka(a,o,d,f),a=o.stateNode;try{var T=o.memoizedProps,w=T.id,P=T.onPostCommit;typeof P=="function"&&P(w,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(F){Tn(o,o.return,F)}}else Ka(a,o,d,f);break;case 13:Ka(a,o,d,f);break;case 23:break;case 22:T=o.stateNode,w=o.alternate,o.memoizedState!==null?T._visibility&2?Ka(a,o,d,f):Dc(a,o):T._visibility&2?Ka(a,o,d,f):(T._visibility|=2,yo(a,o,d,f,(o.subtreeFlags&10256)!==0)),m&2048&&Np(w,o);break;case 24:Ka(a,o,d,f),m&2048&&FE(o.alternate,o);break;default:Ka(a,o,d,f)}}function yo(a,o,d,f,m){for(m=m&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var T=a,w=o,P=d,F=f,Q=w.flags;switch(w.tag){case 0:case 11:case 15:yo(T,w,P,F,m),Ll(8,w);break;case 23:break;case 22:var rt=w.stateNode;w.memoizedState!==null?rt._visibility&2?yo(T,w,P,F,m):Dc(T,w):(rt._visibility|=2,yo(T,w,P,F,m)),m&&Q&2048&&Np(w.alternate,w);break;case 24:yo(T,w,P,F,m),m&&Q&2048&&FE(w.alternate,w);break;default:yo(T,w,P,F,m)}o=o.sibling}}function Dc(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=a,f=o,m=f.flags;switch(f.tag){case 22:Dc(d,f),m&2048&&Np(f.alternate,f);break;case 24:Dc(d,f),m&2048&&FE(f.alternate,f);break;default:Dc(d,f)}o=o.sibling}}var hu=8192;function Co(a){if(a.subtreeFlags&hu)for(a=a.child;a!==null;)RT(a),a=a.sibling}function RT(a){switch(a.tag){case 26:Co(a),a.flags&hu&&a.memoizedState!==null&&FC(Ta,a.memoizedState,a.memoizedProps);break;case 5:Co(a);break;case 3:case 4:var o=Ta;Ta=Qp(a.stateNode.containerInfo),Co(a),Ta=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=hu,hu=16777216,Co(a),hu=o):Co(a));break;default:Co(a)}}function jE(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function pu(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];Ii=f,GE(f,a)}jE(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Dp(a),a=a.sibling}function Dp(a){switch(a.tag){case 0:case 11:case 15:pu(a),a.flags&2048&&So(9,a,a.return);break;case 3:pu(a);break;case 12:pu(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,Ao(a)):pu(a);break;default:pu(a)}}function Ao(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];Ii=f,GE(f,a)}jE(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:So(8,o,o.return),Ao(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,Ao(o));break;default:Ao(o)}a=a.sibling}}function GE(a,o){for(;Ii!==null;){var d=Ii;switch(d.tag){case 0:case 11:case 15:So(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var f=d.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Kd(d.memoizedState.cache)}if(f=d.child,f!==null)f.return=d,Ii=f;else t:for(d=a;Ii!==null;){f=Ii;var m=f.sibling,T=f.return;if(ET(f),f===d){Ii=null;break t}if(m!==null){m.return=T,Ii=m;break t}Ii=T}}}var HE={getCacheForType:function(a){var o=li(gi),d=o.data.get(a);return d===void 0&&(d=a(),o.data.set(a,d)),d}},WE=typeof WeakMap=="function"?WeakMap:Map,rn=0,Sn=null,Re=null,xe=0,He=0,er=null,Ya=!1,bo=!1,Lp=!1,za=0,Kn=0,Io=0,Vr=0,Pp=0,qr=0,Oo=0,fu=null,gr=null,KE=!1,YE=0,Ml=1/0,_u=null,Ps=null,Oi=0,Ra=null,Lc=null,wo=0,Ul=0,xl=null,zE=null,qa=0,ks=null;function Sr(){if((rn&2)!==0&&xe!==0)return xe&-xe;if(ot.T!==null){var a=ho;return a!==0?a:vu()}return Vg()}function vT(){qr===0&&(qr=(xe&536870912)===0||Ke?oc():536870912);var a=xr.current;return a!==null&&(a.flags|=32),qr}function Br(a,o,d){(a===Sn&&(He===2||He===9)||a.cancelPendingCommit!==null)&&(Bl(a,0),No(a,xe,qr,!1)),Id(a,d),((rn&2)===0||a!==Sn)&&(a===Sn&&((rn&2)===0&&(Vr|=d),Kn===4&&No(a,xe,qr,!1)),va(a))}function Vl(a,o,d){if((rn&6)!==0)throw Error(et(327));var f=!d&&(o&124)===0&&(o&a.expiredLanes)===0||bd(a,o),m=f?Xa(a,o):JE(a,o,!0),T=f;do{if(m===0){bo&&!f&&No(a,o,0,!1);break}else{if(d=a.current.alternate,T&&!gC(d)){m=JE(a,o,!1),T=!1;continue}if(m===2){if(T=o,a.errorRecoveryDisabledLanes&T)var w=0;else w=a.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){o=w;t:{var P=a;m=fu;var F=P.current.memoizedState.isDehydrated;if(F&&(Bl(P,w).flags|=256),w=JE(P,w,!1),w!==2){if(Lp&&!F){P.errorRecoveryDisabledLanes|=T,Vr|=T,m=4;break t}T=gr,gr=m,T!==null&&(gr===null?gr=T:gr.push.apply(gr,T))}m=w}if(T=!1,m!==2)continue}}if(m===1){Bl(a,0),No(a,o,0,!0);break}t:{switch(f=a,T=m,T){case 0:case 1:throw Error(et(345));case 4:if((o&4194048)!==o)break;case 6:No(f,o,qr,!Ya);break t;case 2:gr=null;break;case 3:case 5:break;default:throw Error(et(329))}if((o&62914560)===o&&(m=YE+300-xa(),10<m)){if(No(f,o,qr,!Ya),Ad(f,0,!0)!==0)break t;f.timeoutHandle=WT(yT.bind(null,f,d,gr,_u,KE,o,qr,Vr,Oo,Ya,T,2,-0,0),m);break t}yT(f,d,gr,_u,KE,o,qr,Vr,Oo,Ya,T,0,-0,0)}}break}while(!0);va(a)}function yT(a,o,d,f,m,T,w,P,F,Q,rt,_t,$,tt){if(a.timeoutHandle=-1,_t=o.subtreeFlags,(_t&8192||(_t&16785408)===16785408)&&(Iu={stylesheets:null,count:0,unsuspend:BC},RT(o),_t=rR(),_t!==null)){a.cancelPendingCommit=_t(gu.bind(null,a,o,T,d,f,m,w,P,F,rt,1,$,tt)),No(a,T,w,!Q);return}gu(a,o,T,d,f,m,w,P,F)}function gC(a){for(var o=a;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var f=0;f<d.length;f++){var m=d[f],T=m.getSnapshot;m=m.value;try{if(!Mr(T(),m))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function No(a,o,d,f){o&=~Pp,o&=~Vr,a.suspendedLanes|=o,a.pingedLanes&=~o,f&&(a.warmLanes|=o),f=a.expirationTimes;for(var m=o;0<m;){var T=31-ur(m),w=1<<T;f[T]=-1,m&=~w}d!==0&&xg(a,d,o)}function kp(){return(rn&6)===0?(Ru(0),!1):!0}function qE(){if(Re!==null){if(He===0)var a=Re.return;else a=Re,ys=vs=null,Qd(a),Nl=null,ru=0,a=Re;for(;a!==null;)hT(a.alternate,a),a=a.return;Re=null}}function Bl(a,o){var d=a.timeoutHandle;d!==-1&&(a.timeoutHandle=-1,bC(d)),d=a.cancelPendingCommit,d!==null&&(a.cancelPendingCommit=null,d()),qE(),Sn=a,Re=d=Ss(a.current,null),xe=o,He=0,er=null,Ya=!1,bo=bd(a,o),Lp=!1,Oo=qr=Pp=Vr=Io=Kn=0,gr=fu=null,KE=!1,(o&8)!==0&&(o|=o&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=o;0<f;){var m=31-ur(f),T=1<<m;o|=a[m],f&=~T}return za=o,xh(),d}function Mp(a,o){Te=null,ot.H=iu,o===po||o===Yh?(o=qh(),He=3):o===tE?(o=qh(),He=4):He=o===wE?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,er=o,Re===null&&(Kn=1,gp(a,Yr(o,a.current)))}function XE(){var a=ot.H;return ot.H=iu,a===null?iu:a}function CT(){var a=ot.A;return ot.A=HE,a}function Up(){Kn=4,Ya||(xe&4194048)!==xe&&xr.current!==null||(bo=!0),(Io&134217727)===0&&(Vr&134217727)===0||Sn===null||No(Sn,xe,qr,!1)}function JE(a,o,d){var f=rn;rn|=2;var m=XE(),T=CT();(Sn!==a||xe!==o)&&(_u=null,Bl(a,o)),o=!1;var w=Kn;t:do try{if(He!==0&&Re!==null){var P=Re,F=er;switch(He){case 8:qE(),w=6;break t;case 3:case 2:case 9:case 6:xr.current===null&&(o=!0);var Q=He;if(He=0,er=null,Do(a,P,F,Q),d&&bo){w=0;break t}break;default:Q=He,He=0,er=null,Do(a,P,F,Q)}}Eu(),w=Kn;break}catch(rt){Mp(a,rt)}while(!0);return o&&a.shellSuspendCounter++,ys=vs=null,rn=f,ot.H=m,ot.A=T,Re===null&&(Sn=null,xe=0,xh()),w}function Eu(){for(;Re!==null;)bT(Re)}function Xa(a,o){var d=rn;rn|=2;var f=XE(),m=CT();Sn!==a||xe!==o?(_u=null,Ml=xa()+500,Bl(a,o)):bo=bd(a,o);t:do try{if(He!==0&&Re!==null){o=Re;var T=er;e:switch(He){case 1:He=0,er=null,Do(a,o,T,1);break;case 2:case 9:if(nE(T)){He=0,er=null,IT(o);break}o=function(){He!==2&&He!==9||Sn!==a||(He=7),va(a)},T.then(o,o);break t;case 3:He=7;break t;case 4:He=5;break t;case 7:nE(T)?(He=0,er=null,IT(o)):(He=0,er=null,Do(a,o,T,7));break;case 5:var w=null;switch(Re.tag){case 26:w=Re.memoizedState;case 5:case 27:var P=Re;if(!w||iR(w)){He=0,er=null;var F=P.sibling;if(F!==null)Re=F;else{var Q=P.return;Q!==null?(Re=Q,mu(Q)):Re=null}break e}}He=0,er=null,Do(a,o,T,5);break;case 6:He=0,er=null,Do(a,o,T,6);break;case 8:qE(),Kn=6;break t;default:throw Error(et(462))}}AT();break}catch(rt){Mp(a,rt)}while(!0);return ys=vs=null,ot.H=f,ot.A=m,rn=d,Re!==null?0:(Sn=null,xe=0,xh(),Kn)}function AT(){for(;Re!==null&&!tl();)bT(Re)}function bT(a){var o=dT(a.alternate,a,za);a.memoizedProps=a.pendingProps,o===null?mu(a):Re=o}function IT(a){var o=a,d=o.alternate;switch(o.tag){case 15:case 0:o=LE(d,o,o.pendingProps,o.type,void 0,xe);break;case 11:o=LE(d,o,o.pendingProps,o.type.render,o.ref,xe);break;case 5:Qd(o);default:hT(d,o),o=Re=vS(o,za),o=dT(d,o,za)}a.memoizedProps=a.pendingProps,o===null?mu(a):Re=o}function Do(a,o,d,f){ys=vs=null,Qd(o),Nl=null,ru=0;var m=o.return;try{if(_C(a,m,o,d,xe)){Kn=1,gp(a,Yr(d,a.current)),Re=null;return}}catch(T){if(m!==null)throw Re=m,T;Kn=1,gp(a,Yr(d,a.current)),Re=null;return}o.flags&32768?(Ke||f===1?a=!0:bo||(xe&536870912)!==0?a=!1:(Ya=a=!0,(f===2||f===9||f===3||f===6)&&(f=xr.current,f!==null&&f.tag===13&&(f.flags|=16384))),OT(o,a)):mu(o)}function mu(a){var o=a;do{if((o.flags&32768)!==0){OT(o,Ya);return}a=o.return;var d=uT(o.alternate,o,za);if(d!==null){Re=d;return}if(o=o.sibling,o!==null){Re=o;return}Re=o=a}while(o!==null);Kn===0&&(Kn=5)}function OT(a,o){do{var d=EC(a.alternate,a);if(d!==null){d.flags&=32767,Re=d;return}if(d=a.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(a=a.sibling,a!==null)){Re=a;return}Re=a=d}while(a!==null);Kn=6,Re=null}function gu(a,o,d,f,m,T,w,P,F){a.cancelPendingCommit=null;do xp();while(Oi!==0);if((rn&6)!==0)throw Error(et(327));if(o!==null){if(o===a.current)throw Error(et(177));if(T=o.lanes|o.childLanes,T|=K_,Ny(a,d,T,w,P,F),a===Sn&&(Re=Sn=null,xe=0),Lc=o,Ra=a,wo=d,Ul=T,xl=m,zE=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,RC(Ni,function(){return DT(),null})):(a.callbackNode=null,a.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=ot.T,ot.T=null,m=Nt.p,Nt.p=2,w=rn,rn|=4;try{mC(a,o,d)}finally{rn=w,Nt.p=m,ot.T=f}}Oi=1,Ms(),Fl(),wT()}}function Ms(){if(Oi===1){Oi=0;var a=Ra,o=Lc,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=ot.T,ot.T=null;var f=Nt.p;Nt.p=2;var m=rn;rn|=4;try{gT(o,a);var T=am,w=fS(a.containerInfo),P=T.focusedElem,F=T.selectionRange;if(w!==P&&P&&P.ownerDocument&&pS(P.ownerDocument.documentElement,P)){if(F!==null&&$i(P)){var Q=F.start,rt=F.end;if(rt===void 0&&(rt=Q),"selectionStart"in P)P.selectionStart=Q,P.selectionEnd=Math.min(rt,P.value.length);else{var _t=P.ownerDocument||document,$=_t&&_t.defaultView||window;if($.getSelection){var tt=$.getSelection(),oe=P.textContent.length,Ht=Math.min(F.start,oe),pn=F.end===void 0?Ht:Math.min(F.end,oe);!tt.extend&&Ht>pn&&(w=pn,pn=Ht,Ht=w);var Y=ha(P,Ht),W=ha(P,pn);if(Y&&W&&(tt.rangeCount!==1||tt.anchorNode!==Y.node||tt.anchorOffset!==Y.offset||tt.focusNode!==W.node||tt.focusOffset!==W.offset)){var J=_t.createRange();J.setStart(Y.node,Y.offset),tt.removeAllRanges(),Ht>pn?(tt.addRange(J),tt.extend(W.node,W.offset)):(J.setEnd(W.node,W.offset),tt.addRange(J))}}}}for(_t=[],tt=P;tt=tt.parentNode;)tt.nodeType===1&&_t.push({element:tt,left:tt.scrollLeft,top:tt.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<_t.length;P++){var pt=_t[P];pt.element.scrollLeft=pt.left,pt.element.scrollTop=pt.top}}ef=!!rm,am=rm=null}finally{rn=m,Nt.p=f,ot.T=d}}a.current=o,Oi=2}}function Fl(){if(Oi===2){Oi=0;var a=Ra,o=Lc,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=ot.T,ot.T=null;var f=Nt.p;Nt.p=2;var m=rn;rn|=4;try{BE(a,o.alternate,o)}finally{rn=m,Nt.p=f,ot.T=d}}Oi=3}}function wT(){if(Oi===4||Oi===3){Oi=0,Iy();var a=Ra,o=Lc,d=wo,f=zE;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Oi=5:(Oi=0,Lc=Ra=null,NT(a,a.pendingLanes));var m=a.pendingLanes;if(m===0&&(Ps=null),io(d),o=o.stateNode,gn&&typeof gn.onCommitFiberRoot=="function")try{gn.onCommitFiberRoot(el,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=ot.T,m=Nt.p,Nt.p=2,ot.T=null;try{for(var T=a.onRecoverableError,w=0;w<f.length;w++){var P=f[w];T(P.value,{componentStack:P.stack})}}finally{ot.T=o,Nt.p=m}}(wo&3)!==0&&xp(),va(a),m=a.pendingLanes,(d&4194090)!==0&&(m&42)!==0?a===ks?qa++:(qa=0,ks=a):qa=0,Ru(0)}}function NT(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Kd(o)))}function xp(a){return Ms(),Fl(),wT(),DT()}function DT(){if(Oi!==5)return!1;var a=Ra,o=Ul;Ul=0;var d=io(wo),f=ot.T,m=Nt.p;try{Nt.p=32>d?32:d,ot.T=null,d=xl,xl=null;var T=Ra,w=wo;if(Oi=0,Lc=Ra=null,wo=0,(rn&6)!==0)throw Error(et(331));var P=rn;if(rn|=4,Dp(T.current),TT(T,T.current,w,d),rn=P,Ru(0,!1),gn&&typeof gn.onPostCommitFiberRoot=="function")try{gn.onPostCommitFiberRoot(el,T)}catch{}return!0}finally{Nt.p=m,ot.T=f,NT(a,o)}}function Vp(a,o,d){o=Yr(d,o),o=OE(a.stateNode,o,2),a=_a(a,o,2),a!==null&&(Id(a,2),va(a))}function Tn(a,o,d){if(a.tag===3)Vp(a,a,d);else for(;o!==null;){if(o.tag===3){Vp(o,a,d);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ps===null||!Ps.has(f))){a=Yr(d,a),d=iT(2),f=_a(o,d,2),f!==null&&(rT(d,f,o,a),Id(f,2),va(f));break}}o=o.return}}function QE(a,o,d){var f=a.pingCache;if(f===null){f=a.pingCache=new WE;var m=new Set;f.set(o,m)}else m=f.get(o),m===void 0&&(m=new Set,f.set(o,m));m.has(d)||(Lp=!0,m.add(d),a=SC.bind(null,a,o,d),o.then(a,a))}function SC(a,o,d){var f=a.pingCache;f!==null&&f.delete(o),a.pingedLanes|=a.suspendedLanes&d,a.warmLanes&=~d,Sn===a&&(xe&d)===d&&(Kn===4||Kn===3&&(xe&62914560)===xe&&300>xa()-YE?(rn&2)===0&&Bl(a,0):Pp|=d,Oo===xe&&(Oo=0)),va(a)}function ZE(a,o){o===0&&(o=h_()),a=oo(a,o),a!==null&&(Id(a,o),va(a))}function $E(a){var o=a.memoizedState,d=0;o!==null&&(d=o.retryLane),ZE(a,d)}function TC(a,o){var d=0;switch(a.tag){case 13:var f=a.stateNode,m=a.memoizedState;m!==null&&(d=m.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(et(314))}f!==null&&f.delete(o),ZE(a,d)}function RC(a,o){return o_(a,o)}var Bp=null,Pc=null,Su=!1,Tu=!1,Fp=!1,Ja=0;function va(a){a!==Pc&&a.next===null&&(Pc===null?Bp=Pc=a:Pc=Pc.next=a),Tu=!0,Su||(Su=!0,kT())}function Ru(a,o){if(!Fp&&Tu){Fp=!0;do for(var d=!1,f=Bp;f!==null;){if(a!==0){var m=f.pendingLanes;if(m===0)var T=0;else{var w=f.suspendedLanes,P=f.pingedLanes;T=(1<<31-ur(42|a)+1)-1,T&=m&~(w&~P),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(d=!0,jp(f,T))}else T=xe,T=Ad(f,f===Sn?T:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(T&3)===0||bd(f,T)||(d=!0,jp(f,T));f=f.next}while(d);Fp=!1}}function tm(){LT()}function LT(){Tu=Su=!1;var a=0;Ja!==0&&(AC()&&(a=Ja),Ja=0);for(var o=xa(),d=null,f=Bp;f!==null;){var m=f.next,T=PT(f,o);T===0?(f.next=null,d===null?Bp=m:d.next=m,m===null&&(Pc=d)):(d=f,(a!==0||(T&3)!==0)&&(Tu=!0)),f=m}Ru(a)}function PT(a,o){for(var d=a.suspendedLanes,f=a.pingedLanes,m=a.expirationTimes,T=a.pendingLanes&-62914561;0<T;){var w=31-ur(T),P=1<<w,F=m[w];F===-1?((P&d)===0||(P&f)!==0)&&(m[w]=wy(P,o)):F<=o&&(a.expiredLanes|=P),T&=~P}if(o=Sn,d=xe,d=Ad(a,a===o?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f=a.callbackNode,d===0||a===o&&(He===2||He===9)||a.cancelPendingCommit!==null)return f!==null&&f!==null&&c_(f),a.callbackNode=null,a.callbackPriority=0;if((d&3)===0||bd(a,d)){if(o=d&-d,o===a.callbackPriority)return o;switch(f!==null&&c_(f),io(d)){case 2:case 8:d=kg;break;case 32:d=Ni;break;case 268435456:d=mh;break;default:d=Ni}return f=jl.bind(null,a),d=o_(d,f),a.callbackPriority=o,a.callbackNode=d,o}return f!==null&&f!==null&&c_(f),a.callbackPriority=2,a.callbackNode=null,2}function jl(a,o){if(Oi!==0&&Oi!==5)return a.callbackNode=null,a.callbackPriority=0,null;var d=a.callbackNode;if(xp()&&a.callbackNode!==d)return null;var f=xe;return f=Ad(a,a===Sn?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f===0?null:(Vl(a,f,o),PT(a,xa()),a.callbackNode!=null&&a.callbackNode===d?jl.bind(null,a):null)}function jp(a,o){if(xp())return null;Vl(a,o,!0)}function kT(){IC(function(){(rn&6)!==0?o_(l_,tm):LT()})}function vu(){return Ja===0&&(Ja=oc()),Ja}function Gp(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Ah(""+a)}function Hp(a,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,a.id&&d.setAttribute("form",a.id),o.parentNode.insertBefore(d,o),a=new FormData(a),d.parentNode.removeChild(d),a}function vC(a,o,d,f,m){if(o==="submit"&&d&&d.stateNode===m){var T=Gp((m[hr]||null).action),w=f.submitter;w&&(o=(o=w[hr]||null)?Gp(o.formAction):w.getAttribute("formAction"),o!==null&&(T=o,w=null));var P=new Qi("action","action",null,f,m);a.push({event:P,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Ja!==0){var F=w?Hp(m,w):new FormData(m);vE(d,{pending:!0,data:F,method:m.method,action:T},null,F)}}else typeof T=="function"&&(P.preventDefault(),F=w?Hp(m,w):new FormData(m),vE(d,{pending:!0,data:F,method:m.method,action:T},T,F))},currentTarget:m}]})}}for(var em=0;em<W_.length;em++){var Wp=W_[em],MT=Wp.toLowerCase(),UT=Wp[0].toUpperCase()+Wp.slice(1);pa(MT,"on"+UT)}pa(Mh,"onAnimationEnd"),pa(Uh,"onAnimationIteration"),pa(mS,"onAnimationStart"),pa("dblclick","onDoubleClick"),pa("focusin","onFocus"),pa("focusout","onBlur"),pa(it,"onTransitionRun"),pa(nC,"onTransitionStart"),pa(iC,"onTransitionCancel"),pa(gS,"onTransitionEnd"),sl("onMouseEnter",["mouseout","mouseover"]),sl("onMouseLeave",["mouseout","mouseover"]),sl("onPointerEnter",["pointerout","pointerover"]),sl("onPointerLeave",["pointerout","pointerover"]),uc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),uc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),uc("onBeforeInput",["compositionend","keypress","textInput","paste"]),uc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),uc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),uc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gl));function VT(a,o){o=(o&4)!==0;for(var d=0;d<a.length;d++){var f=a[d],m=f.event;f=f.listeners;t:{var T=void 0;if(o)for(var w=f.length-1;0<=w;w--){var P=f[w],F=P.instance,Q=P.currentTarget;if(P=P.listener,F!==T&&m.isPropagationStopped())break t;T=P,m.currentTarget=Q;try{T(m)}catch(rt){Ep(rt)}m.currentTarget=null,T=F}else for(w=0;w<f.length;w++){if(P=f[w],F=P.instance,Q=P.currentTarget,P=P.listener,F!==T&&m.isPropagationStopped())break t;T=P,m.currentTarget=Q;try{T(m)}catch(rt){Ep(rt)}m.currentTarget=null,T=F}}}}function Oe(a,o){var d=o[rl];d===void 0&&(d=o[rl]=new Set);var f=a+"__bubble";d.has(f)||(Kp(o,a,2,!1),d.add(f))}function nm(a,o,d){var f=0;o&&(f|=4),Kp(d,a,f,o)}var Us="_reactListening"+Math.random().toString(36).slice(2);function Lo(a){if(!a[Us]){a[Us]=!0,E_.forEach(function(d){d!=="selectionchange"&&(xT.has(d)||nm(d,!1,a),nm(d,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Us]||(o[Us]=!0,nm("selectionchange",!1,o))}}function Kp(a,o,d,f){switch(lR(o)){case 2:var m=jC;break;case 8:m=Tr;break;default:m=mm}d=m.bind(null,o,d,a),m=void 0,!I_||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(m=!0),f?m!==void 0?a.addEventListener(o,d,{capture:!0,passive:m}):a.addEventListener(o,d,!0):m!==void 0?a.addEventListener(o,d,{passive:m}):a.addEventListener(o,d,!1)}function Yp(a,o,d,f,m){var T=f;if((o&1)===0&&(o&2)===0&&f!==null)t:for(;;){if(f===null)return;var w=f.tag;if(w===3||w===4){var P=f.stateNode.containerInfo;if(P===m)break;if(w===4)for(w=f.return;w!==null;){var F=w.tag;if((F===3||F===4)&&w.stateNode.containerInfo===m)return;w=w.return}for(;P!==null;){if(w=cc(P),w===null)return;if(F=w.tag,F===5||F===6||F===26||F===27){f=T=w;continue t}P=P.parentNode}}f=f.return}b_(function(){var Q=T,rt=C_(d),_t=[];t:{var $=SS.get(a);if($!==void 0){var tt=Qi,oe=a;switch(a){case"keypress":if(Pd(d)===0)break t;case"keydown":case"keyup":tt=jy;break;case"focusin":oe="focus",tt=D_;break;case"focusout":oe="blur",tt=D_;break;case"beforeblur":case"afterblur":tt=D_;break;case"click":if(d.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tt=$g;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tt=wh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tt=hl;break;case Mh:case Uh:case mS:tt=xy;break;case gS:tt=Wy;break;case"scroll":case"scrollend":tt=My;break;case"wheel":tt=Ky;break;case"copy":case"cut":case"paste":tt=k_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tt=pc;break;case"toggle":case"beforetoggle":tt=zy}var Ht=(o&4)!==0,pn=!Ht&&(a==="scroll"||a==="scrollend"),Y=Ht?$!==null?$+"Capture":null:$;Ht=[];for(var W=Q,J;W!==null;){var pt=W;if(J=pt.stateNode,pt=pt.tag,pt!==5&&pt!==26&&pt!==27||J===null||Y===null||(pt=Ld(W,Y),pt!=null&&Ht.push(Hl(W,pt,J))),pn)break;W=W.return}0<Ht.length&&($=new tt($,oe,null,d,rt),_t.push({event:$,listeners:Ht}))}}if((o&7)===0){t:{if($=a==="mouseover"||a==="pointerover",tt=a==="mouseout"||a==="pointerout",$&&d!==y_&&(oe=d.relatedTarget||d.fromElement)&&(cc(oe)||oe[il]))break t;if((tt||$)&&($=rt.window===rt?rt:($=rt.ownerDocument)?$.defaultView||$.parentWindow:window,tt?(oe=d.relatedTarget||d.toElement,tt=Q,oe=oe?cc(oe):null,oe!==null&&(pn=Xt(oe),Ht=oe.tag,oe!==pn||Ht!==5&&Ht!==27&&Ht!==6)&&(oe=null)):(tt=null,oe=Q),tt!==oe)){if(Ht=$g,pt="onMouseLeave",Y="onMouseEnter",W="mouse",(a==="pointerout"||a==="pointerover")&&(Ht=pc,pt="onPointerLeave",Y="onPointerEnter",W="pointer"),pn=tt==null?$:wd(tt),J=oe==null?$:wd(oe),$=new Ht(pt,W+"leave",tt,d,rt),$.target=pn,$.relatedTarget=J,pt=null,cc(rt)===Q&&(Ht=new Ht(Y,W+"enter",oe,d,rt),Ht.target=J,Ht.relatedTarget=pn,pt=Ht),pn=pt,tt&&oe)e:{for(Ht=tt,Y=oe,W=0,J=Ht;J;J=kc(J))W++;for(J=0,pt=Y;pt;pt=kc(pt))J++;for(;0<W-J;)Ht=kc(Ht),W--;for(;0<J-W;)Y=kc(Y),J--;for(;W--;){if(Ht===Y||Y!==null&&Ht===Y.alternate)break e;Ht=kc(Ht),Y=kc(Y)}Ht=null}else Ht=null;tt!==null&&BT(_t,$,tt,Ht,!1),oe!==null&&pn!==null&&BT(_t,pn,oe,Ht,!0)}}t:{if($=Q?wd(Q):window,tt=$.nodeName&&$.nodeName.toLowerCase(),tt==="select"||tt==="input"&&$.type==="file")var bt=oS;else if(sS($))if(cS)bt=tC;else{bt=G_;var we=uS}else tt=$.nodeName,!tt||tt.toLowerCase()!=="input"||$.type!=="checkbox"&&$.type!=="radio"?Q&&v_(Q.elementType)&&(bt=oS):bt=$y;if(bt&&(bt=bt(a,Q))){V_(_t,bt,d,rt);break t}we&&we(a,$,Q),a==="focusout"&&Q&&$.type==="number"&&Q.memoizedProps.value!=null&&T_($,"number",$.value)}switch(we=Q?wd(Q):window,a){case"focusin":(sS(we)||we.contentEditable==="true")&&(fl=we,H_=Q,Vd=null);break;case"focusout":Vd=H_=fl=null;break;case"mousedown":Ph=!0;break;case"contextmenu":case"mouseup":case"dragend":Ph=!1,_S(_t,d,rt);break;case"selectionchange":if(eC)break;case"keydown":case"keyup":_S(_t,d,rt)}var jt;if(kd)t:{switch(a){case"compositionstart":var Qt="onCompositionStart";break t;case"compositionend":Qt="onCompositionEnd";break t;case"compositionupdate":Qt="onCompositionUpdate";break t}Qt=void 0}else pl?aS(a,d)&&(Qt="onCompositionEnd"):a==="keydown"&&d.keyCode===229&&(Qt="onCompositionStart");Qt&&(iS&&d.locale!=="ko"&&(pl||Qt!=="onCompositionStart"?Qt==="onCompositionEnd"&&pl&&(jt=Qg()):(ao=rt,O_="value"in ao?ao.value:ao.textContent,pl=!0)),we=zp(Q,Qt),0<we.length&&(Qt=new eS(Qt,a,null,d,rt),_t.push({event:Qt,listeners:we}),jt?Qt.data=jt:(jt=x_(d),jt!==null&&(Qt.data=jt)))),(jt=Xy?gs(a,d):Jy(a,d))&&(Qt=zp(Q,"onBeforeInput"),0<Qt.length&&(we=new eS("onBeforeInput","beforeinput",null,d,rt),_t.push({event:we,listeners:Qt}),we.data=jt)),vC(_t,a,Q,d,rt)}VT(_t,o)})}function Hl(a,o,d){return{instance:a,listener:o,currentTarget:d}}function zp(a,o){for(var d=o+"Capture",f=[];a!==null;){var m=a,T=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||T===null||(m=Ld(a,d),m!=null&&f.unshift(Hl(a,m,T)),m=Ld(a,o),m!=null&&f.push(Hl(a,m,T))),a.tag===3)return f;a=a.return}return[]}function kc(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function BT(a,o,d,f,m){for(var T=o._reactName,w=[];d!==null&&d!==f;){var P=d,F=P.alternate,Q=P.stateNode;if(P=P.tag,F!==null&&F===f)break;P!==5&&P!==26&&P!==27||Q===null||(F=Q,m?(Q=Ld(d,T),Q!=null&&w.unshift(Hl(d,Q,F))):m||(Q=Ld(d,T),Q!=null&&w.push(Hl(d,Q,F)))),d=d.return}w.length!==0&&a.push({event:o,listeners:w})}var yC=/\r\n?/g,qp=/\u0000|\uFFFD/g;function FT(a){return(typeof a=="string"?a:""+a).replace(yC,`
`).replace(qp,"")}function jT(a,o){return o=FT(o),FT(a)===o}function Xp(){}function hn(a,o,d,f,m,T){switch(d){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||hc(a,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&hc(a,""+f);break;case"className":Th(a,"class",f);break;case"tabIndex":Th(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Th(a,d,f);break;case"style":Ch(a,f,T);break;case"data":if(o!=="object"){Th(a,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||d!=="href")){a.removeAttribute(d);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(d);break}f=Ah(""+f),a.setAttribute(d,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(d==="formAction"?(o!=="input"&&hn(a,o,"name",m.name,m,null),hn(a,o,"formEncType",m.formEncType,m,null),hn(a,o,"formMethod",m.formMethod,m,null),hn(a,o,"formTarget",m.formTarget,m,null)):(hn(a,o,"encType",m.encType,m,null),hn(a,o,"method",m.method,m,null),hn(a,o,"target",m.target,m,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(d);break}f=Ah(""+f),a.setAttribute(d,f);break;case"onClick":f!=null&&(a.onclick=Xp);break;case"onScroll":f!=null&&Oe("scroll",a);break;case"onScrollEnd":f!=null&&Oe("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(et(61));if(d=f.__html,d!=null){if(m.children!=null)throw Error(et(60));a.innerHTML=d}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}d=Ah(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(d,""+f):a.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(d,""):a.removeAttribute(d);break;case"capture":case"download":f===!0?a.setAttribute(d,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(d,f):a.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(d,f):a.removeAttribute(d);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(d):a.setAttribute(d,f);break;case"popover":Oe("beforetoggle",a),Oe("toggle",a),Sh(a,"popover",f);break;case"xlinkActuate":_s(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":_s(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":_s(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":_s(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":_s(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":_s(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":_s(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":_s(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":_s(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Sh(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=Xg.get(d)||d,Sh(a,d,f))}}function im(a,o,d,f,m,T){switch(d){case"style":Ch(a,f,T);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(et(61));if(d=f.__html,d!=null){if(m.children!=null)throw Error(et(60));a.innerHTML=d}}break;case"children":typeof f=="string"?hc(a,f):(typeof f=="number"||typeof f=="bigint")&&hc(a,""+f);break;case"onScroll":f!=null&&Oe("scroll",a);break;case"onScrollEnd":f!=null&&Oe("scrollend",a);break;case"onClick":f!=null&&(a.onclick=Xp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!dc.hasOwnProperty(d))t:{if(d[0]==="o"&&d[1]==="n"&&(m=d.endsWith("Capture"),o=d.slice(2,m?d.length-7:void 0),T=a[hr]||null,T=T!=null?T[d]:null,typeof T=="function"&&a.removeEventListener(o,T,m),typeof f=="function")){typeof T!="function"&&T!==null&&(d in a?a[d]=null:a.hasAttribute(d)&&a.removeAttribute(d)),a.addEventListener(o,f,m);break t}d in a?a[d]=f:f===!0?a.setAttribute(d,""):Sh(a,d,f)}}}function Mi(a,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oe("error",a),Oe("load",a);var f=!1,m=!1,T;for(T in d)if(d.hasOwnProperty(T)){var w=d[T];if(w!=null)switch(T){case"src":f=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(et(137,o));default:hn(a,o,T,w,d,null)}}m&&hn(a,o,"srcSet",d.srcSet,d,null),f&&hn(a,o,"src",d.src,d,null);return;case"input":Oe("invalid",a);var P=T=w=m=null,F=null,Q=null;for(f in d)if(d.hasOwnProperty(f)){var rt=d[f];if(rt!=null)switch(f){case"name":m=rt;break;case"type":w=rt;break;case"checked":F=rt;break;case"defaultChecked":Q=rt;break;case"value":T=rt;break;case"defaultValue":P=rt;break;case"children":case"dangerouslySetInnerHTML":if(rt!=null)throw Error(et(137,o));break;default:hn(a,o,f,rt,d,null)}}Yg(a,T,P,F,Q,w,m,!1),Xe(a);return;case"select":Oe("invalid",a),f=w=T=null;for(m in d)if(d.hasOwnProperty(m)&&(P=d[m],P!=null))switch(m){case"value":T=P;break;case"defaultValue":w=P;break;case"multiple":f=P;default:hn(a,o,m,P,d,null)}o=T,d=w,a.multiple=!!f,o!=null?cl(a,!!f,o,!1):d!=null&&cl(a,!!f,d,!0);return;case"textarea":Oe("invalid",a),T=m=f=null;for(w in d)if(d.hasOwnProperty(w)&&(P=d[w],P!=null))switch(w){case"value":f=P;break;case"defaultValue":m=P;break;case"children":T=P;break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(et(91));break;default:hn(a,o,w,P,d,null)}Dd(a,f,m,T),Xe(a);return;case"option":for(F in d)if(d.hasOwnProperty(F)&&(f=d[F],f!=null))switch(F){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:hn(a,o,F,f,d,null)}return;case"dialog":Oe("beforetoggle",a),Oe("toggle",a),Oe("cancel",a),Oe("close",a);break;case"iframe":case"object":Oe("load",a);break;case"video":case"audio":for(f=0;f<Gl.length;f++)Oe(Gl[f],a);break;case"image":Oe("error",a),Oe("load",a);break;case"details":Oe("toggle",a);break;case"embed":case"source":case"link":Oe("error",a),Oe("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Q in d)if(d.hasOwnProperty(Q)&&(f=d[Q],f!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":throw Error(et(137,o));default:hn(a,o,Q,f,d,null)}return;default:if(v_(o)){for(rt in d)d.hasOwnProperty(rt)&&(f=d[rt],f!==void 0&&im(a,o,rt,f,d,void 0));return}}for(P in d)d.hasOwnProperty(P)&&(f=d[P],f!=null&&hn(a,o,P,f,d,null))}function CC(a,o,d,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,T=null,w=null,P=null,F=null,Q=null,rt=null;for(tt in d){var _t=d[tt];if(d.hasOwnProperty(tt)&&_t!=null)switch(tt){case"checked":break;case"value":break;case"defaultValue":F=_t;default:f.hasOwnProperty(tt)||hn(a,o,tt,null,f,_t)}}for(var $ in f){var tt=f[$];if(_t=d[$],f.hasOwnProperty($)&&(tt!=null||_t!=null))switch($){case"type":T=tt;break;case"name":m=tt;break;case"checked":Q=tt;break;case"defaultChecked":rt=tt;break;case"value":w=tt;break;case"defaultValue":P=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(et(137,o));break;default:tt!==_t&&hn(a,o,$,tt,f,_t)}}S_(a,w,P,F,Q,rt,T,m);return;case"select":tt=w=P=$=null;for(T in d)if(F=d[T],d.hasOwnProperty(T)&&F!=null)switch(T){case"value":break;case"multiple":tt=F;default:f.hasOwnProperty(T)||hn(a,o,T,null,f,F)}for(m in f)if(T=f[m],F=d[m],f.hasOwnProperty(m)&&(T!=null||F!=null))switch(m){case"value":$=T;break;case"defaultValue":P=T;break;case"multiple":w=T;default:T!==F&&hn(a,o,m,T,f,F)}o=P,d=w,f=tt,$!=null?cl(a,!!d,$,!1):!!f!=!!d&&(o!=null?cl(a,!!d,o,!0):cl(a,!!d,d?[]:"",!1));return;case"textarea":tt=$=null;for(P in d)if(m=d[P],d.hasOwnProperty(P)&&m!=null&&!f.hasOwnProperty(P))switch(P){case"value":break;case"children":break;default:hn(a,o,P,null,f,m)}for(w in f)if(m=f[w],T=d[w],f.hasOwnProperty(w)&&(m!=null||T!=null))switch(w){case"value":$=m;break;case"defaultValue":tt=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(et(91));break;default:m!==T&&hn(a,o,w,m,f,T)}zg(a,$,tt);return;case"option":for(var oe in d)if($=d[oe],d.hasOwnProperty(oe)&&$!=null&&!f.hasOwnProperty(oe))switch(oe){case"selected":a.selected=!1;break;default:hn(a,o,oe,null,f,$)}for(F in f)if($=f[F],tt=d[F],f.hasOwnProperty(F)&&$!==tt&&($!=null||tt!=null))switch(F){case"selected":a.selected=$&&typeof $!="function"&&typeof $!="symbol";break;default:hn(a,o,F,$,f,tt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ht in d)$=d[Ht],d.hasOwnProperty(Ht)&&$!=null&&!f.hasOwnProperty(Ht)&&hn(a,o,Ht,null,f,$);for(Q in f)if($=f[Q],tt=d[Q],f.hasOwnProperty(Q)&&$!==tt&&($!=null||tt!=null))switch(Q){case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(et(137,o));break;default:hn(a,o,Q,$,f,tt)}return;default:if(v_(o)){for(var pn in d)$=d[pn],d.hasOwnProperty(pn)&&$!==void 0&&!f.hasOwnProperty(pn)&&im(a,o,pn,void 0,f,$);for(rt in f)$=f[rt],tt=d[rt],!f.hasOwnProperty(rt)||$===tt||$===void 0&&tt===void 0||im(a,o,rt,$,f,tt);return}}for(var Y in d)$=d[Y],d.hasOwnProperty(Y)&&$!=null&&!f.hasOwnProperty(Y)&&hn(a,o,Y,null,f,$);for(_t in f)$=f[_t],tt=d[_t],!f.hasOwnProperty(_t)||$===tt||$==null&&tt==null||hn(a,o,_t,$,f,tt)}var rm=null,am=null;function Jp(a){return a.nodeType===9?a:a.ownerDocument}function GT(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function HT(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function sm(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var om=null;function AC(){var a=window.event;return a&&a.type==="popstate"?a===om?!1:(om=a,!0):(om=null,!1)}var WT=typeof setTimeout=="function"?setTimeout:void 0,bC=typeof clearTimeout=="function"?clearTimeout:void 0,cm=typeof Promise=="function"?Promise:void 0,IC=typeof queueMicrotask=="function"?queueMicrotask:typeof cm<"u"?function(a){return cm.resolve(null).then(a).catch(OC)}:WT;function OC(a){setTimeout(function(){throw a})}function Po(a){return a==="head"}function KT(a,o){var d=o,f=0,m=0;do{var T=d.nextSibling;if(a.removeChild(d),T&&T.nodeType===8)if(d=T.data,d==="/$"){if(0<f&&8>f){d=f;var w=a.ownerDocument;if(d&1&&yu(w.documentElement),d&2&&yu(w.body),d&4)for(d=w.head,yu(d),w=d.firstChild;w;){var P=w.nextSibling,F=w.nodeName;w[Od]||F==="SCRIPT"||F==="STYLE"||F==="LINK"&&w.rel.toLowerCase()==="stylesheet"||d.removeChild(w),w=P}}if(m===0){a.removeChild(T),Rr(o);return}m--}else d==="$"||d==="$?"||d==="$!"?m++:f=d.charCodeAt(0)-48;else f=0;d=T}while(d);Rr(o)}function lm(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":lm(d),gh(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}a.removeChild(d)}}function wC(a,o,d,f){for(;a.nodeType===1;){var m=d;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[Od])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(T=a.getAttribute("rel"),T==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(T!==m.rel||a.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||a.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||a.getAttribute("title")!==(m.title==null?null:m.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(T=a.getAttribute("src"),(T!==(m.src==null?null:m.src)||a.getAttribute("type")!==(m.type==null?null:m.type)||a.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&T&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var T=m.name==null?null:""+m.name;if(m.type==="hidden"&&a.getAttribute("name")===T)return a}else return a;if(a=ya(a.nextSibling),a===null)break}return null}function NC(a,o,d){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!d||(a=ya(a.nextSibling),a===null))return null;return a}function dm(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function DC(a,o){var d=a.ownerDocument;if(a.data!=="$?"||d.readyState==="complete")o();else{var f=function(){o(),d.removeEventListener("DOMContentLoaded",f)};d.addEventListener("DOMContentLoaded",f),a._reactRetry=f}}function ya(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}var um=null;function YT(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var d=a.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return a;o--}else d==="/$"&&o++}a=a.previousSibling}return null}function zT(a,o,d){switch(o=Jp(d),a){case"html":if(a=o.documentElement,!a)throw Error(et(452));return a;case"head":if(a=o.head,!a)throw Error(et(453));return a;case"body":if(a=o.body,!a)throw Error(et(454));return a;default:throw Error(et(451))}}function yu(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);gh(a)}var Xr=new Map,qT=new Set;function Qp(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Qa=Nt.d;Nt.d={f:LC,r:hm,D:PC,C:kC,L:JT,m:MC,X:UC,S:pm,M:xC};function LC(){var a=Qa.f(),o=kp();return a||o}function hm(a){var o=al(a);o!==null&&o.tag===5&&o.type==="form"?dp(o):Qa.r(a)}var Wl=typeof document>"u"?null:document;function XT(a,o,d){var f=Wl;if(f&&typeof o=="string"&&o){var m=Kr(o);m='link[rel="'+a+'"][href="'+m+'"]',typeof d=="string"&&(m+='[crossorigin="'+d+'"]'),qT.has(m)||(qT.add(m),a={rel:a,crossOrigin:d,href:o},f.querySelector(m)===null&&(o=f.createElement("link"),Mi(o,"link",a),oi(o),f.head.appendChild(o)))}}function PC(a){Qa.D(a),XT("dns-prefetch",a,null)}function kC(a,o){Qa.C(a,o),XT("preconnect",a,o)}function JT(a,o,d){Qa.L(a,o,d);var f=Wl;if(f&&a&&o){var m='link[rel="preload"][as="'+Kr(o)+'"]';o==="image"&&d&&d.imageSrcSet?(m+='[imagesrcset="'+Kr(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(m+='[imagesizes="'+Kr(d.imageSizes)+'"]')):m+='[href="'+Kr(a)+'"]';var T=m;switch(o){case"style":T=Kl(a);break;case"script":T=ko(a)}Xr.has(T)||(a=xt({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:a,as:o},d),Xr.set(T,a),f.querySelector(m)!==null||o==="style"&&f.querySelector(Yl(T))||o==="script"&&f.querySelector(Cu(T))||(o=f.createElement("link"),Mi(o,"link",a),oi(o),f.head.appendChild(o)))}}function MC(a,o){Qa.m(a,o);var d=Wl;if(d&&a){var f=o&&typeof o.as=="string"?o.as:"script",m='link[rel="modulepreload"][as="'+Kr(f)+'"][href="'+Kr(a)+'"]',T=m;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=ko(a)}if(!Xr.has(T)&&(a=xt({rel:"modulepreload",href:a},o),Xr.set(T,a),d.querySelector(m)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Cu(T)))return}f=d.createElement("link"),Mi(f,"link",a),oi(f),d.head.appendChild(f)}}}function pm(a,o,d){Qa.S(a,o,d);var f=Wl;if(f&&a){var m=lc(f).hoistableStyles,T=Kl(a);o=o||"default";var w=m.get(T);if(!w){var P={loading:0,preload:null};if(w=f.querySelector(Yl(T)))P.loading=5;else{a=xt({rel:"stylesheet",href:a,"data-precedence":o},d),(d=Xr.get(T))&&fm(a,d);var F=w=f.createElement("link");oi(F),Mi(F,"link",a),F._p=new Promise(function(Q,rt){F.onload=Q,F.onerror=rt}),F.addEventListener("load",function(){P.loading|=1}),F.addEventListener("error",function(){P.loading|=2}),P.loading|=4,Au(w,o,f)}w={type:"stylesheet",instance:w,count:1,state:P},m.set(T,w)}}}function UC(a,o){Qa.X(a,o);var d=Wl;if(d&&a){var f=lc(d).hoistableScripts,m=ko(a),T=f.get(m);T||(T=d.querySelector(Cu(m)),T||(a=xt({src:a,async:!0},o),(o=Xr.get(m))&&Zp(a,o),T=d.createElement("script"),oi(T),Mi(T,"link",a),d.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(m,T))}}function xC(a,o){Qa.M(a,o);var d=Wl;if(d&&a){var f=lc(d).hoistableScripts,m=ko(a),T=f.get(m);T||(T=d.querySelector(Cu(m)),T||(a=xt({src:a,async:!0,type:"module"},o),(o=Xr.get(m))&&Zp(a,o),T=d.createElement("script"),oi(T),Mi(T,"link",a),d.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(m,T))}}function QT(a,o,d,f){var m=(m=Zt.current)?Qp(m):null;if(!m)throw Error(et(446));switch(a){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=Kl(d.href),d=lc(m).hoistableStyles,f=d.get(o),f||(f={type:"style",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){a=Kl(d.href);var T=lc(m).hoistableStyles,w=T.get(a);if(w||(m=m.ownerDocument||m,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(a,w),(T=m.querySelector(Yl(a)))&&!T._p&&(w.instance=T,w.state.loading=5),Xr.has(a)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Xr.set(a,d),T||$T(m,a,d,w.state))),o&&f===null)throw Error(et(528,""));return w}if(o&&f!==null)throw Error(et(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=ko(d),d=lc(m).hoistableScripts,f=d.get(o),f||(f={type:"script",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(et(444,a))}}function Kl(a){return'href="'+Kr(a)+'"'}function Yl(a){return'link[rel="stylesheet"]['+a+"]"}function ZT(a){return xt({},a,{"data-precedence":a.precedence,precedence:null})}function $T(a,o,d,f){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=a.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Mi(o,"link",d),oi(o),a.head.appendChild(o))}function ko(a){return'[src="'+Kr(a)+'"]'}function Cu(a){return"script[async]"+a}function tR(a,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var f=a.querySelector('style[data-href~="'+Kr(d.href)+'"]');if(f)return o.instance=f,oi(f),f;var m=xt({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),oi(f),Mi(f,"style",m),Au(f,d.precedence,a),o.instance=f;case"stylesheet":m=Kl(d.href);var T=a.querySelector(Yl(m));if(T)return o.state.loading|=4,o.instance=T,oi(T),T;f=ZT(d),(m=Xr.get(m))&&fm(f,m),T=(a.ownerDocument||a).createElement("link"),oi(T);var w=T;return w._p=new Promise(function(P,F){w.onload=P,w.onerror=F}),Mi(T,"link",f),o.state.loading|=4,Au(T,d.precedence,a),o.instance=T;case"script":return T=ko(d.src),(m=a.querySelector(Cu(T)))?(o.instance=m,oi(m),m):(f=d,(m=Xr.get(T))&&(f=xt({},d),Zp(f,m)),a=a.ownerDocument||a,m=a.createElement("script"),oi(m),Mi(m,"link",f),a.head.appendChild(m),o.instance=m);case"void":return null;default:throw Error(et(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,Au(f,d.precedence,a));return o.instance}function Au(a,o,d){for(var f=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=f.length?f[f.length-1]:null,T=m,w=0;w<f.length;w++){var P=f[w];if(P.dataset.precedence===o)T=P;else if(T!==m)break}T?T.parentNode.insertBefore(a,T.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(a,o.firstChild))}function fm(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Zp(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var bu=null;function eR(a,o,d){if(bu===null){var f=new Map,m=bu=new Map;m.set(d,f)}else m=bu,f=m.get(d),f||(f=new Map,m.set(d,f));if(f.has(a))return f;for(f.set(a,null),d=d.getElementsByTagName(a),m=0;m<d.length;m++){var T=d[m];if(!(T[Od]||T[un]||a==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var w=T.getAttribute(o)||"";w=a+w;var P=f.get(w);P?P.push(T):f.set(w,[T])}}return f}function nR(a,o,d){a=a.ownerDocument||a,a.head.insertBefore(d,o==="title"?a.querySelector("head > title"):null)}function VC(a,o,d){if(d===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function iR(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Iu=null;function BC(){}function FC(a,o,d){if(Iu===null)throw Error(et(475));var f=Iu;if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var m=Kl(d.href),T=a.querySelector(Yl(m));if(T){a=T._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(f.count++,f=Ou.bind(f),a.then(f,f)),o.state.loading|=4,o.instance=T,oi(T);return}T=a.ownerDocument||a,d=ZT(d),(m=Xr.get(m))&&fm(d,m),T=T.createElement("link"),oi(T);var w=T;w._p=new Promise(function(P,F){w.onload=P,w.onerror=F}),Mi(T,"link",d),o.instance=T}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Ou.bind(f),a.addEventListener("load",o),a.addEventListener("error",o))}}function rR(){if(Iu===null)throw Error(et(475));var a=Iu;return a.stylesheets&&a.count===0&&$p(a,a.stylesheets),0<a.count?function(o){var d=setTimeout(function(){if(a.stylesheets&&$p(a,a.stylesheets),a.unsuspend){var f=a.unsuspend;a.unsuspend=null,f()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(d)}}:null}function Ou(){if(this.count--,this.count===0){if(this.stylesheets)$p(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var zl=null;function $p(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,zl=new Map,o.forEach(_m,a),zl=null,Ou.call(a))}function _m(a,o){if(!(o.state.loading&4)){var d=zl.get(a);if(d)var f=d.get(null);else{d=new Map,zl.set(a,d);for(var m=a.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<m.length;T++){var w=m[T];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(d.set(w.dataset.precedence,w),f=w)}f&&d.set(null,f)}m=o.instance,w=m.getAttribute("data-precedence"),T=d.get(w)||f,T===f&&d.set(null,m),d.set(w,m),this.count++,f=Ou.bind(this),m.addEventListener("load",f),m.addEventListener("error",f),T?T.parentNode.insertBefore(m,T.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(m,a.firstChild)),o.state.loading|=4}}var ql={$$typeof:Jn,Provider:null,Consumer:null,_currentValue:Jt,_currentValue2:Jt,_threadCount:0};function at(a,o,d,f,m,T,w,P){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=p_(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=p_(0),this.hiddenUpdates=p_(null),this.identifierPrefix=f,this.onUncaughtError=m,this.onCaughtError=T,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=P,this.incompleteTransitions=new Map}function aR(a,o,d,f,m,T,w,P,F,Q,rt,_t){return a=new at(a,o,d,w,P,F,Q,_t),o=1,T===!0&&(o|=24),T=Li(3,null,null,o),a.current=T,T.stateNode=a,o=Wh(),o.refCount++,a.pooledCache=o,o.refCount++,T.memoizedState={element:f,isDehydrated:d,cache:o},Xd(T),a}function sR(a){return a?(a=ji,a):ji}function oR(a,o,d,f,m,T){m=sR(m),f.context===null?f.context=m:f.pendingContext=m,f=bs(o),f.payload={element:d},T=T===void 0?null:T,T!==null&&(f.callback=T),d=_a(a,f,o),d!==null&&(Br(d,a,o),Is(d,a,o))}function cR(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var d=a.retryLane;a.retryLane=d!==0&&d<o?d:o}}function Em(a,o){cR(a,o),(a=a.alternate)&&cR(a,o)}function tf(a){if(a.tag===13){var o=oo(a,67108864);o!==null&&Br(o,a,67108864),Em(a,67108864)}}var ef=!0;function jC(a,o,d,f){var m=ot.T;ot.T=null;var T=Nt.p;try{Nt.p=2,mm(a,o,d,f)}finally{Nt.p=T,ot.T=m}}function Tr(a,o,d,f){var m=ot.T;ot.T=null;var T=Nt.p;try{Nt.p=8,mm(a,o,d,f)}finally{Nt.p=T,ot.T=m}}function mm(a,o,d,f){if(ef){var m=gm(f);if(m===null)Yp(a,o,f,Xl,d),nf(a,f);else if(HC(m,a,o,d,f))f.stopPropagation();else if(nf(a,f),o&4&&-1<GC.indexOf(a)){for(;m!==null;){var T=al(m);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var w=kr(T.pendingLanes);if(w!==0){var P=T;for(P.pendingLanes|=2,P.entangledLanes|=2;w;){var F=1<<31-ur(w);P.entanglements[1]|=F,w&=~F}va(T),(rn&6)===0&&(Ml=xa()+500,Ru(0))}}break;case 13:P=oo(T,2),P!==null&&Br(P,T,2),kp(),Em(T,2)}if(T=gm(f),T===null&&Yp(a,o,f,Xl,d),T===m)break;m=T}m!==null&&f.stopPropagation()}else Yp(a,o,f,null,d)}}function gm(a){return a=C_(a),Sm(a)}var Xl=null;function Sm(a){if(Xl=null,a=cc(a),a!==null){var o=Xt(a);if(o===null)a=null;else{var d=o.tag;if(d===13){if(a=Pn(o),a!==null)return a;a=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Xl=a,null}function lR(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(no()){case l_:return 2;case kg:return 8;case Ni:case Pr:return 32;case mh:return 268435456;default:return 32}default:return 32}}var Tm=!1,Mo=null,Ca=null,xs=null,wu=new Map,Nu=new Map,Uo=[],GC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function nf(a,o){switch(a){case"focusin":case"focusout":Mo=null;break;case"dragenter":case"dragleave":Ca=null;break;case"mouseover":case"mouseout":xs=null;break;case"pointerover":case"pointerout":wu.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nu.delete(o.pointerId)}}function Jl(a,o,d,f,m,T){return a===null||a.nativeEvent!==T?(a={blockedOn:o,domEventName:d,eventSystemFlags:f,nativeEvent:T,targetContainers:[m]},o!==null&&(o=al(o),o!==null&&tf(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,m!==null&&o.indexOf(m)===-1&&o.push(m),a)}function HC(a,o,d,f,m){switch(o){case"focusin":return Mo=Jl(Mo,a,o,d,f,m),!0;case"dragenter":return Ca=Jl(Ca,a,o,d,f,m),!0;case"mouseover":return xs=Jl(xs,a,o,d,f,m),!0;case"pointerover":var T=m.pointerId;return wu.set(T,Jl(wu.get(T)||null,a,o,d,f,m)),!0;case"gotpointercapture":return T=m.pointerId,Nu.set(T,Jl(Nu.get(T)||null,a,o,d,f,m)),!0}return!1}function rf(a){var o=cc(a.target);if(o!==null){var d=Xt(o);if(d!==null){if(o=d.tag,o===13){if(o=Pn(d),o!==null){a.blockedOn=o,Dy(a.priority,function(){if(d.tag===13){var f=Sr();f=f_(f);var m=oo(d,f);m!==null&&Br(m,d,f),Em(d,f)}});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){a.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}a.blockedOn=null}function af(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var d=gm(a.nativeEvent);if(d===null){d=a.nativeEvent;var f=new d.constructor(d.type,d);y_=f,d.target.dispatchEvent(f),y_=null}else return o=al(d),o!==null&&tf(o),a.blockedOn=d,!1;o.shift()}return!0}function dR(a,o,d){af(a)&&d.delete(o)}function uR(){Tm=!1,Mo!==null&&af(Mo)&&(Mo=null),Ca!==null&&af(Ca)&&(Ca=null),xs!==null&&af(xs)&&(xs=null),wu.forEach(dR),Nu.forEach(dR)}function Ql(a,o){a.blockedOn===o&&(a.blockedOn=null,Tm||(Tm=!0,kt.unstable_scheduleCallback(kt.unstable_NormalPriority,uR)))}var Vs=null;function Du(a){Vs!==a&&(Vs=a,kt.unstable_scheduleCallback(kt.unstable_NormalPriority,function(){Vs===a&&(Vs=null);for(var o=0;o<a.length;o+=3){var d=a[o],f=a[o+1],m=a[o+2];if(typeof f!="function"){if(Sm(f||d)===null)continue;break}var T=al(d);T!==null&&(a.splice(o,3),o-=3,vE(T,{pending:!0,data:m,method:d.method,action:f},f,m))}}))}function Rr(a){function o(F){return Ql(F,a)}Mo!==null&&Ql(Mo,a),Ca!==null&&Ql(Ca,a),xs!==null&&Ql(xs,a),wu.forEach(o),Nu.forEach(o);for(var d=0;d<Uo.length;d++){var f=Uo[d];f.blockedOn===a&&(f.blockedOn=null)}for(;0<Uo.length&&(d=Uo[0],d.blockedOn===null);)rf(d),d.blockedOn===null&&Uo.shift();if(d=(a.ownerDocument||a).$$reactFormReplay,d!=null)for(f=0;f<d.length;f+=3){var m=d[f],T=d[f+1],w=m[hr]||null;if(typeof T=="function")w||Du(d);else if(w){var P=null;if(T&&T.hasAttribute("formAction")){if(m=T,w=T[hr]||null)P=w.formAction;else if(Sm(m)!==null)continue}else P=w.action;typeof P=="function"?d[f+1]=P:(d.splice(f,3),f-=3),Du(d)}}}function xo(a){this._internalRoot=a}Lu.prototype.render=xo.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(et(409));var d=o.current,f=Sr();oR(d,f,a,o,null,null)},Lu.prototype.unmount=xo.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;oR(a.current,2,null,a,null,null),kp(),o[il]=null}};function Lu(a){this._internalRoot=a}Lu.prototype.unstable_scheduleHydration=function(a){if(a){var o=Vg();a={blockedOn:null,target:a,priority:o};for(var d=0;d<Uo.length&&o!==0&&o<Uo[d].priority;d++);Uo.splice(d,0,a),d===0&&rf(a)}};var Rm=Xn.version;if(Rm!=="19.1.0")throw Error(et(527,Rm,"19.1.0"));Nt.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(et(188)):(a=Object.keys(a).join(","),Error(et(268,a)));return a=Ft(o),a=a!==null?St(a):null,a=a===null?null:a.stateNode,a};var WC={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:ot,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sf.isDisabled&&sf.supportsFiber)try{el=sf.inject(WC),gn=sf}catch{}}return Lg.createRoot=function(a,o){if(!Vt(a))throw Error(et(299));var d=!1,f="",m=tT,T=eT,w=mp,P=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(m=o.onUncaughtError),o.onCaughtError!==void 0&&(T=o.onCaughtError),o.onRecoverableError!==void 0&&(w=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(P=o.unstable_transitionCallbacks)),o=aR(a,1,!1,null,null,d,f,m,T,w,P,null),a[il]=o.current,Lo(a),new xo(o)},Lg.hydrateRoot=function(a,o,d){if(!Vt(a))throw Error(et(299));var f=!1,m="",T=tT,w=eT,P=mp,F=null,Q=null;return d!=null&&(d.unstable_strictMode===!0&&(f=!0),d.identifierPrefix!==void 0&&(m=d.identifierPrefix),d.onUncaughtError!==void 0&&(T=d.onUncaughtError),d.onCaughtError!==void 0&&(w=d.onCaughtError),d.onRecoverableError!==void 0&&(P=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(F=d.unstable_transitionCallbacks),d.formState!==void 0&&(Q=d.formState)),o=aR(a,1,!0,o,d??null,f,m,T,w,P,F,Q),o.context=sR(null),d=o.current,f=Sr(),f=f_(f),m=bs(f),m.callback=null,_a(d,m,f),d=f,o.current.lanes=d,Id(o,d),va(o),a[il]=o.current,Lo(a),new Lu(o)},Lg.version="19.1.0",Lg}var q2;function QH(){if(q2)return TO.exports;q2=1;function kt(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kt)}catch(Xn){console.error(Xn)}}return kt(),TO.exports=JH(),TO.exports}var ZH=QH();const $H=CO(ZH);var by={exports:{}},t6=by.exports,X2;function e6(){return X2||(X2=1,function(kt,Xn){(function(on,et){kt.exports=et()})(t6,function(){function on(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var et=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof gO<"u"?gO:typeof self<"u"?self:{};function Vt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Xt=function(t){try{return!!t()}catch{return!0}},Pn=!Xt(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),Xi=Pn,Ft=Function.prototype,St=Ft.call,xt=Xi&&Ft.bind.bind(St,St),Mt=Xi?xt:function(t){return function(){return St.apply(t,arguments)}},ue=Mt({}.isPrototypeOf),ai=function(t){return t&&t.Math==Math&&t},_e=ai(typeof globalThis=="object"&&globalThis)||ai(typeof window=="object"&&window)||ai(typeof self=="object"&&self)||ai(typeof et=="object"&&et)||function(){return this}()||et||Function("return this")(),Nr=Pn,bi=Function.prototype,la=bi.apply,Dr=bi.call,Jn=typeof Reflect=="object"&&Reflect.apply||(Nr?Dr.bind(la):function(){return Dr.apply(la,arguments)}),dr=Mt,je=dr({}.toString),Ae=dr("".slice),dn=function(t){return Ae(je(t),8,-1)},Qn=dn,da=Mt,Wr=function(t){if(Qn(t)==="Function")return da(t)},ua=typeof document=="object"&&document.all,mi={all:ua,IS_HTMLDDA:ua===void 0&&ua!==void 0},ac=mi.all,cn=mi.IS_HTMLDDA?function(t){return typeof t=="function"||t===ac}:function(t){return typeof t=="function"},si={},ot=!Xt(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Nt=Pn,Jt=Function.prototype.call,se=Nt?Jt.bind(Jt):function(){return Jt.apply(Jt,arguments)},H={},Tt={}.propertyIsEnumerable,Lt=Object.getOwnPropertyDescriptor,Ot=Lt&&!Tt.call({1:2},1);H.f=Ot?function(t){var e=Lt(this,t);return!!e&&e.enumerable}:Tt;var Bt,Ue,Zt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Lr=Xt,kn=dn,Ua=Object,s_=Mt("".split),sc=Lr(function(){return!Ua("z").propertyIsEnumerable(0)})?function(t){return kn(t)=="String"?s_(t,""):Ua(t)}:Ua,eo=function(t){return t==null},o_=eo,c_=TypeError,tl=function(t){if(o_(t))throw c_("Can't call method on "+t);return t},Iy=sc,xa=tl,no=function(t){return Iy(xa(t))},l_=cn,kg=mi.all,Ni=mi.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:l_(t)||t===kg}:function(t){return typeof t=="object"?t!==null:l_(t)},Pr={},mh=Pr,d_=_e,Oy=cn,el=function(t){return Oy(t)?t:void 0},gn=function(t,e){return arguments.length<2?el(mh[t])||el(d_[t]):mh[t]&&mh[t][e]||d_[t]&&d_[t][e]},Ji=typeof navigator<"u"&&String(navigator.userAgent)||"",ur=_e,u_=Ji,Mg=ur.process,Ug=ur.Deno,yd=Mg&&Mg.versions||Ug&&Ug.version,Cd=yd&&yd.v8;Cd&&(Ue=(Bt=Cd.split("."))[0]>0&&Bt[0]<4?1:+(Bt[0]+Bt[1])),!Ue&&u_&&(!(Bt=u_.match(/Edge\/(\d+)/))||Bt[1]>=74)&&(Bt=u_.match(/Chrome\/(\d+)/))&&(Ue=+Bt[1]);var kr=Ue,Ad=kr,bd=Xt,wy=_e.String,oc=!!Object.getOwnPropertySymbols&&!bd(function(){var t=Symbol();return!wy(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Ad&&Ad<41}),h_=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",p_=gn,Id=cn,Ny=ue,xg=Object,nl=h_?function(t){return typeof t=="symbol"}:function(t){var e=p_("Symbol");return Id(e)&&Ny(e.prototype,xg(t))},f_=String,io=function(t){try{return f_(t)}catch{return"Object"}},Vg=cn,Dy=io,ro=TypeError,un=function(t){if(Vg(t))return t;throw ro(Dy(t)+" is not a function")},hr=un,il=eo,rl=function(t,e){var n=t[e];return il(n)?void 0:hr(n)},Bg=se,Fg=cn,__=Ni,Od=TypeError,gh={exports:{}},cc=_e,al=Object.defineProperty,wd=function(t,e){try{al(cc,t,{value:e,configurable:!0,writable:!0})}catch{cc[t]=e}return e},lc="__core-js_shared__",oi=_e[lc]||wd(lc,{}),E_=oi;(gh.exports=function(t,e){return E_[t]||(E_[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var dc=gh.exports,uc=tl,sl=Object,Va=function(t){return sl(uc(t))},jg=Va,Gg=Mt({}.hasOwnProperty),Zn=Object.hasOwn||function(t,e){return Gg(jg(t),e)},Sh=Mt,Th=0,_s=Math.random(),m_=Sh(1 .toString),Rh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+m_(++Th+_s,36)},ol=dc,vh=Zn,g_=Rh,Ly=oc,Hg=h_,Di=_e.Symbol,yh=ol("wks"),Py=Hg?Di.for||Di:Di&&Di.withoutSetter||g_,Xe=function(t){return vh(yh,t)||(yh[t]=Ly&&vh(Di,t)?Di[t]:Py("Symbol."+t)),yh[t]},Wg=se,Nd=Ni,Kg=nl,Kr=rl,S_=function(t,e){var n,i;if(Fg(n=t.toString)&&!__(i=Bg(n,t))||Fg(n=t.valueOf)&&!__(i=Bg(n,t)))return i;throw Od("Can't convert object to primitive value")},Yg=TypeError,T_=Xe("toPrimitive"),cl=function(t,e){if(!Nd(t)||Kg(t))return t;var n,i=Kr(t,T_);if(i){if(n=Wg(i,t,e),!Nd(n)||Kg(n))return n;throw Yg("Can't convert object to primitive value")}return S_(t)},zg=nl,Dd=function(t){var e=cl(t,"string");return zg(e)?e:e+""},hc=Ni,R_=_e.document,qg=hc(R_)&&hc(R_.createElement),Ch=function(t){return qg?R_.createElement(t):{}},v_=Ch,Xg=!ot&&!Xt(function(){return Object.defineProperty(v_("div"),"a",{get:function(){return 7}}).a!=7}),ky=ot,Ah=se,y_=H,C_=Zt,ll=no,dl=Dd,Jg=Zn,A_=Xg,b_=Object.getOwnPropertyDescriptor;si.f=ky?b_:function(t,e){if(t=ll(t),e=dl(e),A_)try{return b_(t,e)}catch{}if(Jg(t,e))return C_(!Ah(y_.f,t,e),t[e])};var Ld=Xt,Es=cn,I_=/#|\.prototype\./,ms=function(t,e){var n=O_[ao(t)];return n==Qg||n!=bh&&(Es(e)?Ld(e):!!e)},ao=ms.normalize=function(t){return String(t).replace(I_,".").toLowerCase()},O_=ms.data={},bh=ms.NATIVE="N",Qg=ms.POLYFILL="P",Pd=ms,Ih=un,Zg=Pn,pr=Wr(Wr.bind),fr=function(t,e){return Ih(t),e===void 0?t:Zg?pr(t,e):function(){return t.apply(e,arguments)}},Qi={},ul=ot&&Xt(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),My=Ni,w_=String,N_=TypeError,ci=function(t){if(My(t))return t;throw N_(w_(t)+" is not an object")},Oh=ot,$g=Xg,Uy=ul,wh=ci,tS=Dd,D_=TypeError,L_=Object.defineProperty,xy=Object.getOwnPropertyDescriptor,P_="enumerable",k_="configurable",M_="writable";Qi.f=Oh?Uy?function(t,e,n){if(wh(t),e=tS(e),wh(n),typeof t=="function"&&e==="prototype"&&"value"in n&&M_ in n&&!n[M_]){var i=xy(t,e);i&&i[M_]&&(t[e]=n.value,n={configurable:k_ in n?n[k_]:i[k_],enumerable:P_ in n?n[P_]:i[P_],writable:!1})}return L_(t,e,n)}:L_:function(t,e,n){if(wh(t),e=tS(e),wh(n),$g)try{return L_(t,e,n)}catch{}if("get"in n||"set"in n)throw D_("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var eS=Qi,Vy=Zt,so=ot?function(t,e,n){return eS.f(t,e,Vy(1,n))}:function(t,e,n){return t[e]=n,t},Nh=_e,By=Jn,U_=Wr,Fy=cn,jy=si.f,Gy=Pd,pc=Pr,Hy=fr,hl=so,nS=Zn,Wy=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return By(t,this,arguments)};return e.prototype=t.prototype,e},Ee=function(t,e){var n,i,r,s,c,l,u,h,p,_=t.target,E=t.global,g=t.stat,C=t.proto,v=E?Nh:g?Nh[_]:(Nh[_]||{}).prototype,y=E?pc:pc[_]||hl(pc,_,{})[_],b=y.prototype;for(s in e)i=!(n=Gy(E?s:_+(g?".":"#")+s,t.forced))&&v&&nS(v,s),l=y[s],i&&(u=t.dontCallGetSet?(p=jy(v,s))&&p.value:v[s]),c=i&&u?u:e[s],i&&typeof l==typeof c||(h=t.bind&&i?Hy(c,Nh):t.wrap&&i?Wy(c):C&&Fy(c)?U_(c):c,(t.sham||c&&c.sham||l&&l.sham)&&hl(h,"sham",!0),hl(y,s,h),C&&(nS(pc,r=_+"Prototype")||hl(pc,r,{}),hl(pc[r],s,c),t.real&&b&&(n||!b[s])&&hl(b,s,c)))},Ky=Math.ceil,Yy=Math.floor,zy=Math.trunc||function(t){var e=+t;return(e>0?Yy:Ky)(e)},qy=zy,kd=function(t){var e=+t;return e!=e||e===0?0:qy(e)},Md=kd,Xy=Math.max,iS=Math.min,Dh=function(t,e){var n=Md(t);return n<0?Xy(n+e,0):iS(n,e)},rS=kd,aS=Math.min,x_=function(t){return t>0?aS(rS(t),9007199254740991):0},pl=x_,gs=function(t){return pl(t.length)},Jy=no,Qy=Dh,sS=gs,V_=function(t){return function(e,n,i){var r,s=Jy(e),c=sS(s),l=Qy(i,c);if(t&&n!=n){for(;c>l;)if((r=s[l++])!=r)return!0}else for(;c>l;l++)if((t||l in s)&&s[l]===n)return t||l||0;return!t&&-1}},fc={includes:V_(!0),indexOf:V_(!1)},Ud=fc.includes;Ee({target:"Array",proto:!0,forced:Xt(function(){return!Array(1).includes()})},{includes:function(t){return Ud(this,t,arguments.length>1?arguments[1]:void 0)}});var Zy=Pr,Zi=function(t){return Zy[t+"Prototype"]},oS=Zi("Array").includes,cS=Ni,B_=dn,F_=Xe("match"),j_=function(t){var e;return cS(t)&&((e=t[F_])!==void 0?!!e:B_(t)=="RegExp")},lS=j_,dS=TypeError,uS={};uS[Xe("toStringTag")]="z";var G_=String(uS)==="[object z]",$y=G_,tC=cn,Lh=dn,Mr=Xe("toStringTag"),xd=Object,hS=Lh(function(){return arguments}())=="Arguments",ha=$y?Lh:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,s){try{return r[s]}catch{}}(e=xd(t),Mr))=="string"?n:hS?Lh(e):(i=Lh(e))=="Object"&&tC(e.callee)?"Arguments":i},pS=ha,fS=String,$i=function(t){if(pS(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return fS(t)},eC=Xe("match"),fl=Ee,H_=function(t){if(lS(t))throw dS("The method doesn't accept regular expressions");return t},Vd=tl,Ph=$i,_S=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[eC]=!1,"/./"[t](e)}catch{}}return!1},_c=Mt("".indexOf);fl({target:"String",proto:!0,forced:!_S("includes")},{includes:function(t){return!!~_c(Ph(Vd(this)),Ph(H_(t)),arguments.length>1?arguments[1]:void 0)}});var _l=Zi("String").includes,kh=ue,ES=oS,Ec=_l,Mh=Array.prototype,Uh=String.prototype,mS=function(t){var e=t.includes;return t===Mh||kh(Mh,t)&&e===Mh.includes?ES:typeof t=="string"||t===Uh||kh(Uh,t)&&e===Uh.includes?Ec:e},it=Vt(mS),nC=un,iC=Va,gS=sc,SS=gs,W_=TypeError,pa=function(t){return function(e,n,i,r){nC(n);var s=iC(e),c=gS(s),l=SS(s),u=t?l-1:0,h=t?-1:1;if(i<2)for(;;){if(u in c){r=c[u],u+=h;break}if(u+=h,t?u<0:l<=u)throw W_("Reduce of empty array with no initial value")}for(;t?u>=0:l>u;u+=h)u in c&&(r=n(r,c[u],u,s));return r}},TS={left:pa(!1)},Yr=Xt,tr=function(t,e){var n=[][t];return!!n&&Yr(function(){n.call(null,e||function(){return 1},1)})},fa=typeof process<"u"&&dn(process)=="process",K_=TS.left;Ee({target:"Array",proto:!0,forced:!fa&&kr>79&&kr<83||!tr("reduce")},{reduce:function(t){var e=arguments.length;return K_(this,t,e,e>1?arguments[1]:void 0)}});var xh=Zi("Array").reduce,Vh=ue,Y_=xh,oo=Array.prototype,RS=function(t){var e=t.reduce;return t===oo||Vh(oo,t)&&e===oo.reduce?Y_:e},Bd=RS,ji=Vt(Bd),rC=dn,Li=Array.isArray||function(t){return rC(t)=="Array"},z_=Ee,Ss=Li,vS=Mt([].reverse),Fd=[1,2];z_({target:"Array",proto:!0,forced:String(Fd)===String(Fd.reverse())},{reverse:function(){return Ss(this)&&(this.length=this.length),vS(this)}});var mc=Zi("Array").reverse,q_=ue,X_=mc,co=Array.prototype,El=function(t){var e=t.reverse;return t===co||q_(co,t)&&e===co.reverse?X_:e},jd=El,Gd=Vt(jd),zr=Rh,Ur=dc("keys"),Ba=function(t){return Ur[t]||(Ur[t]=zr(t))},Ts=!Xt(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Rs=Zn,gc=cn,yS=Va,J_=Ts,Bh=Ba("IE_PROTO"),Pi=Object,Wn=Pi.prototype,Ke=J_?Pi.getPrototypeOf:function(t){var e=yS(t);if(Rs(e,Bh))return e[Bh];var n=e.constructor;return gc(n)&&e instanceof n?n.prototype:e instanceof Pi?Wn:null},Sc=Mt,Fa=un,Q_=cn,Tc=String,CS=TypeError,AS=function(t,e,n){try{return Sc(Fa(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},Hd=ci,Wd=function(t){if(typeof t=="object"||Q_(t))return t;throw CS("Can't set "+Tc(t)+" as a prototype")},bS=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=AS(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return Hd(i),Wd(r),e?t(i,r):i.__proto__=r,i}}():void 0),lo={},ml={},vs=Zn,ys=no,uo=fc.indexOf,Cs=ml,Fh=Mt([].push),jh=function(t,e){var n,i=ys(t),r=0,s=[];for(n in i)!vs(Cs,n)&&vs(i,n)&&Fh(s,n);for(;e.length>r;)vs(i,n=e[r++])&&(~uo(s,n)||Fh(s,n));return s},Rc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Gh=jh,vc=Rc.concat("length","prototype");lo.f=Object.getOwnPropertyNames||function(t){return Gh(t,vc)};var li={};li.f=Object.getOwnPropertySymbols;var Hh=gn,IS=lo,aC=li,sC=ci,oC=Mt([].concat),gi=Hh("Reflect","ownKeys")||function(t){var e=IS.f(sC(t)),n=aC.f;return n?oC(e,n(t)):e},Wh=Zn,Kd=gi,Yd=si,Z_=Qi,ho={},gl=jh,cC=Rc,zd=Object.keys||function(t){return gl(t,cC)},lC=ot,OS=ul,yc=Qi,$_=ci,Kh=no,wS=zd;ho.f=lC&&!OS?Object.defineProperties:function(t,e){$_(t);for(var n,i=Kh(e),r=wS(e),s=r.length,c=0;s>c;)yc.f(t,n=r[c++],i[n]);return t};var po,tE=gn("document","documentElement"),Yh=ci,eE=ho,nE=Rc,zh=ml,NS=tE,qd=Ch,qh="prototype",Xh="script",As=Ba("IE_PROTO"),Xd=function(){},Jh=function(t){return"<"+Xh+">"+t+"</"+Xh+">"},bs=function(t){t.write(Jh("")),t.close();var e=t.parentWindow.Object;return t=null,e},_a=function(){try{po=new ActiveXObject("htmlfile")}catch{}var t,e,n;_a=typeof document<"u"?document.domain&&po?bs(po):(e=qd("iframe"),n="java"+Xh+":",e.style.display="none",NS.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(Jh("document.F=Object")),t.close(),t.F):bs(po);for(var i=nE.length;i--;)delete _a[qh][nE[i]];return _a()};zh[As]=!0;var Is=Object.create||function(t,e){var n;return t!==null?(Xd[qh]=Yh(t),n=new Xd,Xd[qh]=null,n[As]=t):n=_a(),e===void 0?n:eE.f(n,e)},iE=Ni,rE=so,Sl=Error,Jd=Mt("".replace),DS=String(Sl("zxcasd").stack),aE=/\n\s*at [^:]*:[^\n]*/,Tl=aE.test(DS),Qh=Zt,LS=!Xt(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Qh(1,7)),t.stack!==7)}),sE=so,oE=function(t,e){if(Tl&&typeof t=="string"&&!Sl.prepareStackTrace)for(;e--;)t=Jd(t,aE,"");return t},fo=LS,Te=Error.captureStackTrace,Ge={},di=Ge,Zh=Xe("iterator"),Rl=Array.prototype,_o=function(t){return t!==void 0&&(di.Array===t||Rl[Zh]===t)},$h=ha,vl=rl,yl=eo,dC=Ge,$n=Xe("iterator"),Cl=function(t){if(!yl(t))return vl(t,$n)||vl(t,"@@iterator")||dC[$h(t)]},cE=se,PS=un,kS=ci,uC=io,lE=Cl,dE=TypeError,Qd=function(t,e){var n=arguments.length<2?lE(t):e;if(PS(n))return kS(cE(n,t));throw dE(uC(t)+" is not iterable")},_r=se,ti=ci,uE=rl,Al=function(t,e,n){var i,r;ti(t);try{if(!(i=uE(t,"return"))){if(e==="throw")throw n;return n}i=_r(i,t)}catch(s){r=!0,i=s}if(e==="throw")throw n;if(r)throw i;return ti(i),n},tp=fr,hE=se,Os=ci,ep=io,pE=_o,fE=gs,_E=ue,MS=Qd,US=Cl,EE=Al,xS=TypeError,Zd=function(t,e){this.stopped=t,this.result=e},np=Zd.prototype,bl=function(t,e,n){var i,r,s,c,l,u,h,p=n&&n.that,_=!(!n||!n.AS_ENTRIES),E=!(!n||!n.IS_RECORD),g=!(!n||!n.IS_ITERATOR),C=!(!n||!n.INTERRUPTED),v=tp(e,p),y=function(I){return i&&EE(i,"normal",I),new Zd(!0,I)},b=function(I){return _?(Os(I),C?v(I[0],I[1],y):v(I[0],I[1])):C?v(I,y):v(I)};if(E)i=t.iterator;else if(g)i=t;else{if(!(r=US(t)))throw xS(ep(t)+" is not iterable");if(pE(r)){for(s=0,c=fE(t);c>s;s++)if((l=b(t[s]))&&_E(np,l))return l;return new Zd(!1)}i=MS(t,r)}for(u=E?t.next:i.next;!(h=hE(u,i)).done;){try{l=b(h.value)}catch(I){EE(i,"throw",I)}if(typeof l=="object"&&l&&_E(np,l))return l}return new Zd(!1)},hC=$i,VS=Ee,BS=ue,FS=Ke,Il=bS,jS=function(t,e,n){for(var i=Kd(e),r=Z_.f,s=Yd.f,c=0;c<i.length;c++){var l=i[c];Wh(t,l)||n&&Wh(n,l)||r(t,l,s(e,l))}},mE=Is,ip=so,rp=Zt,GS=function(t,e){iE(e)&&"cause"in e&&rE(t,"cause",e.cause)},pC=function(t,e,n,i){fo&&(Te?Te(t,e):sE(t,"stack",oE(n,i)))},HS=bl,Ol=function(t,e){return t===void 0?arguments.length<2?"":e:hC(t)},ap=Xe("toStringTag"),$d=Error,sp=[].push,ja=function(t,e){var n,i=BS(op,this);Il?n=Il($d(),i?FS(this):op):(n=i?this:mE(op),ip(n,ap,"Error")),e!==void 0&&ip(n,"message",Ol(e)),pC(n,ja,n.stack,1),arguments.length>2&&GS(n,arguments[2]);var r=[];return HS(t,sp,{that:r}),ip(n,"errors",r),n};Il?Il(ja,$d):jS(ja,$d,{name:!0});var op=ja.prototype=mE($d.prototype,{constructor:rp(1,ja),message:rp(1,""),name:rp(1,"AggregateError")});VS({global:!0},{AggregateError:ja});var tu,wl,eu,WS=cn,gE=_e.WeakMap,SE=WS(gE)&&/native code/.test(String(gE)),TE=_e,KS=Ni,RE=so,cp=Zn,lp=oi,fC=Ba,vE=ml,yE="Object already initialized",dp=TE.TypeError,CE=TE.WeakMap;if(SE||lp.state){var Ea=lp.state||(lp.state=new CE);Ea.get=Ea.get,Ea.has=Ea.has,Ea.set=Ea.set,tu=function(t,e){if(Ea.has(t))throw dp(yE);return e.facade=t,Ea.set(t,e),e},wl=function(t){return Ea.get(t)||{}},eu=function(t){return Ea.has(t)}}else{var Cc=fC("state");vE[Cc]=!0,tu=function(t,e){if(cp(t,Cc))throw dp(yE);return e.facade=t,RE(t,Cc,e),e},wl=function(t){return cp(t,Cc)?t[Cc]:{}},eu=function(t){return cp(t,Cc)}}var Ac,YS,AE,ma={set:tu,get:wl,has:eu,enforce:function(t){return eu(t)?wl(t):tu(t,{})},getterFor:function(t){return function(e){var n;if(!KS(e)||(n=wl(e)).type!==t)throw dp("Incompatible receiver, "+t+" required");return n}}},nu=ot,up=Zn,bE=Function.prototype,zS=nu&&Object.getOwnPropertyDescriptor,iu=up(bE,"name"),IE={PROPER:iu&&(function(){}).name==="something",CONFIGURABLE:iu&&(!nu||nu&&zS(bE,"name").configurable)},qS=so,Eo=function(t,e,n,i){return i&&i.enumerable?t[e]=n:qS(t,e,n),t},Nl=Xt,ru=cn,hp=Ni,au=Is,su=Ke,XS=Eo,pp=Xe("iterator"),bc=!1;[].keys&&("next"in(AE=[].keys())?(YS=su(su(AE)))!==Object.prototype&&(Ac=YS):bc=!0);var JS=!hp(Ac)||Nl(function(){var t={};return Ac[pp].call(t)!==t});ru((Ac=JS?{}:au(Ac))[pp])||XS(Ac,pp,function(){return this});var xr={IteratorPrototype:Ac,BUGGY_SAFARI_ITERATORS:bc},Ga=ha,mo=G_?{}.toString:function(){return"[object "+Ga(this)+"]"},QS=G_,go=Qi.f,ws=so,Si=Zn,fp=mo,_p=Xe("toStringTag"),Ha=function(t,e,n,i){if(t){var r=n?t:t.prototype;Si(r,_p)||go(r,_p,{configurable:!0,value:e}),i&&!QS&&ws(r,"toString",fp)}},ZS=xr.IteratorPrototype,$S=Is,Ic=Zt,Ep=Ha,tT=Ge,eT=function(){return this},mp=function(t,e,n,i){var r=e+" Iterator";return t.prototype=$S(ZS,{next:Ic(+!i,n)}),Ep(t,r,!1,!0),tT[r]=eT,t},gp=Ee,nT=se,OE=IE,iT=mp,rT=Ke,_C=Ha,wE=Eo,Ti=Ge,ki=xr,aT=OE.PROPER,ou=ki.BUGGY_SAFARI_ITERATORS,Sp=Xe("iterator"),NE="keys",cu="values",lu="entries",DE=function(){return this},LE=function(t,e,n,i,r,s,c){iT(n,e,i);var l,u,h,p=function(b){if(b===r&&v)return v;if(!ou&&b in g)return g[b];switch(b){case NE:case cu:case lu:return function(){return new n(this,b)}}return function(){return new n(this)}},_=e+" Iterator",E=!1,g=t.prototype,C=g[Sp]||g["@@iterator"]||r&&g[r],v=!ou&&C||p(r),y=e=="Array"&&g.entries||C;if(y&&(l=rT(y.call(new t)))!==Object.prototype&&l.next&&(_C(l,_,!0,!0),Ti[_]=DE),aT&&r==cu&&C&&C.name!==cu&&(E=!0,v=function(){return nT(C,this)}),r)if(u={values:p(cu),keys:s?v:p(NE),entries:p(lu)},c)for(h in u)(ou||E||!(h in g))&&wE(g,h,u[h]);else gp({target:e,proto:!0,forced:ou||E},u);return c&&g[Sp]!==v&&wE(g,Sp,v,{}),Ti[e]=v,u},Tp=function(t,e){return{value:t,done:e}},sT=no,Rp=Ge,vp=ma;Qi.f;var PE=LE,kE=Tp,yp="Array Iterator",Cp=vp.set,ME=vp.getterFor(yp);PE(Array,"Array",function(t,e){Cp(this,{type:yp,target:sT(t),index:0,kind:e})},function(){var t=ME(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,kE(void 0,!0)):kE(n=="keys"?i:n=="values"?e[i]:[i,e[i]],!1)},"values"),Rp.Arguments=Rp.Array;var oT=Qi,Dl=function(t,e,n){return oT.f(t,e,n)},cT=gn,Ns=Dl,UE=ot,lT=Xe("species"),dT=ue,Ds=TypeError,Ap=function(t,e){if(dT(e,t))return t;throw Ds("Incorrect invocation")},bp=cn,Oc=oi,xn=Mt(Function.toString);bp(Oc.inspectSource)||(Oc.inspectSource=function(t){return xn(t)});var uT=Oc.inspectSource,EC=Mt,hT=Xt,Ll=cn,So=ha,pT=uT,xE=function(){},du=[],ga=gn("Reflect","construct"),Ip=/^\s*(?:class|function)\b/,VE=EC(Ip.exec),fT=!Ip.exec(xE),wc=function(t){if(!Ll(t))return!1;try{return ga(xE,du,t),!0}catch{return!1}},Op=function(t){if(!Ll(t))return!1;switch(So(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return fT||!!VE(Ip,pT(t))}catch{return!0}};Op.sham=!0;var To,Nc,Wa,Vn,Pl=!ga||hT(function(){var t;return wc(wc.call)||!wc(Object)||!wc(function(){t=!0})||t})?Op:wc,_T=Pl,Ii=io,mC=TypeError,BE=ci,ET=function(t){if(_T(t))return t;throw mC(Ii(t)+" is not a constructor")},Mn=eo,Er=Xe("species"),Sa=function(t,e){var n,i=BE(t).constructor;return i===void 0||Mn(n=BE(i)[Er])?e:ET(n)},uu=Mt([].slice),mT=TypeError,kl=function(t,e){if(t<e)throw mT("Not enough arguments");return t},wp=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ji),Nn=_e,Ta=Jn,gT=fr,mr=cn,ST=Zn,Ls=Xt,Ro=tE,vo=uu,Np=Ch,FE=kl,Ka=wp,TT=fa,yo=Nn.setImmediate,Dc=Nn.clearImmediate,hu=Nn.process,Co=Nn.Dispatch,RT=Nn.Function,jE=Nn.MessageChannel,pu=Nn.String,Dp=0,Ao={},GE="onreadystatechange";Ls(function(){To=Nn.location});var HE=function(t){if(ST(Ao,t)){var e=Ao[t];delete Ao[t],e()}},WE=function(t){return function(){HE(t)}},rn=function(t){HE(t.data)},Sn=function(t){Nn.postMessage(pu(t),To.protocol+"//"+To.host)};yo&&Dc||(yo=function(t){FE(arguments.length,1);var e=mr(t)?t:RT(t),n=vo(arguments,1);return Ao[++Dp]=function(){Ta(e,void 0,n)},Nc(Dp),Dp},Dc=function(t){delete Ao[t]},TT?Nc=function(t){hu.nextTick(WE(t))}:Co&&Co.now?Nc=function(t){Co.now(WE(t))}:jE&&!Ka?(Vn=(Wa=new jE).port2,Wa.port1.onmessage=rn,Nc=gT(Vn.postMessage,Vn)):Nn.addEventListener&&mr(Nn.postMessage)&&!Nn.importScripts&&To&&To.protocol!=="file:"&&!Ls(Sn)?(Nc=Sn,Nn.addEventListener("message",rn,!1)):Nc=GE in Np("script")?function(t){Ro.appendChild(Np("script"))[GE]=function(){Ro.removeChild(this),HE(t)}}:function(t){setTimeout(WE(t),0)});var Re={set:yo,clear:Dc},xe=function(){this.head=null,this.tail=null};xe.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var He,er,Ya,bo,Lp,za=xe,Kn=/ipad|iphone|ipod/i.test(Ji)&&typeof Pebble<"u",Io=/web0s(?!.*chrome)/i.test(Ji),Vr=_e,Pp=fr,qr=si.f,Oo=Re.set,fu=za,gr=wp,KE=Kn,YE=Io,Ml=fa,_u=Vr.MutationObserver||Vr.WebKitMutationObserver,Ps=Vr.document,Oi=Vr.process,Ra=Vr.Promise,Lc=qr(Vr,"queueMicrotask"),wo=Lc&&Lc.value;if(!wo){var Ul=new fu,xl=function(){var t,e;for(Ml&&(t=Oi.domain)&&t.exit();e=Ul.get();)try{e()}catch(n){throw Ul.head&&He(),n}t&&t.enter()};gr||Ml||YE||!_u||!Ps?!KE&&Ra&&Ra.resolve?((bo=Ra.resolve(void 0)).constructor=Ra,Lp=Pp(bo.then,bo),He=function(){Lp(xl)}):Ml?He=function(){Oi.nextTick(xl)}:(Oo=Pp(Oo,Vr),He=function(){Oo(xl)}):(er=!0,Ya=Ps.createTextNode(""),new _u(xl).observe(Ya,{characterData:!0}),He=function(){Ya.data=er=!er}),wo=function(t){Ul.head||He(),Ul.add(t)}}var zE=wo,qa=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},ks=_e.Promise,Sr=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",vT=!Sr&&!fa&&typeof window=="object"&&typeof document=="object",Br=_e,Vl=ks,yT=cn,gC=Pd,No=uT,kp=Xe,qE=vT,Bl=Sr,Mp=kr,XE=Vl&&Vl.prototype,CT=kp("species"),Up=yT(Br.PromiseRejectionEvent),JE=gC("Promise",function(){var t=No(Vl),e=t!==String(Vl);if(!e&&Mp===66||!XE.catch||!XE.finally)return!0;if(!Mp||Mp<51||!/native code/.test(t)){var n=new Vl(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[CT]=i,!(n.then(function(){})instanceof i))return!0}return!e&&(qE||Bl)&&!Up}),Eu={CONSTRUCTOR:JE,REJECTION_EVENT:Up},Xa={},AT=un,bT=TypeError,IT=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw bT("Bad Promise constructor");e=i,n=r}),this.resolve=AT(e),this.reject=AT(n)};Xa.f=function(t){return new IT(t)};var Do,mu,OT=Ee,gu=fa,Ms=_e,Fl=se,wT=Eo,NT=Ha,xp=function(t){var e=cT(t);UE&&e&&!e[lT]&&Ns(e,lT,{configurable:!0,get:function(){return this}})},DT=un,Vp=cn,Tn=Ni,QE=Ap,SC=Sa,ZE=Re.set,$E=zE,TC=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},RC=qa,Bp=za,Pc=ma,Su=ks,Tu=Eu,Fp=Xa,Ja="Promise",va=Tu.CONSTRUCTOR,Ru=Tu.REJECTION_EVENT,tm=Pc.getterFor(Ja),LT=Pc.set,PT=Su&&Su.prototype,jl=Su,jp=PT,kT=Ms.TypeError,vu=Ms.document,Gp=Ms.process,Hp=Fp.f,vC=Hp,em=!!(vu&&vu.createEvent&&Ms.dispatchEvent),Wp="unhandledrejection",MT=function(t){var e;return!(!Tn(t)||!Vp(e=t.then))&&e},UT=function(t,e){var n,i,r,s=e.value,c=e.state==1,l=c?t.ok:t.fail,u=t.resolve,h=t.reject,p=t.domain;try{l?(c||(e.rejection===2&&nm(e),e.rejection=1),l===!0?n=s:(p&&p.enter(),n=l(s),p&&(p.exit(),r=!0)),n===t.promise?h(kT("Promise-chain cycle")):(i=MT(n))?Fl(i,n,u,h):u(n)):h(s)}catch(_){p&&!r&&p.exit(),h(_)}},Gl=function(t,e){t.notified||(t.notified=!0,$E(function(){for(var n,i=t.reactions;n=i.get();)UT(n,t);t.notified=!1,e&&!t.rejection&&VT(t)}))},xT=function(t,e,n){var i,r;em?((i=vu.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),Ms.dispatchEvent(i)):i={promise:e,reason:n},!Ru&&(r=Ms["on"+t])?r(i):t===Wp&&TC("Unhandled promise rejection",n)},VT=function(t){Fl(ZE,Ms,function(){var e,n=t.facade,i=t.value;if(Oe(t)&&(e=RC(function(){gu?Gp.emit("unhandledRejection",i,n):xT(Wp,n,i)}),t.rejection=gu||Oe(t)?2:1,e.error))throw e.value})},Oe=function(t){return t.rejection!==1&&!t.parent},nm=function(t){Fl(ZE,Ms,function(){var e=t.facade;gu?Gp.emit("rejectionHandled",e):xT("rejectionhandled",e,t.value)})},Us=function(t,e,n){return function(i){t(e,i,n)}},Lo=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Gl(t,!0))},Kp=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw kT("Promise can't be resolved itself");var i=MT(e);i?$E(function(){var r={done:!1};try{Fl(i,e,Us(Kp,r,t),Us(Lo,r,t))}catch(s){Lo(r,s,t)}}):(t.value=e,t.state=1,Gl(t,!1))}catch(r){Lo({done:!1},r,t)}}};va&&(jp=(jl=function(t){QE(this,jp),DT(t),Fl(Do,this);var e=tm(this);try{t(Us(Kp,e),Us(Lo,e))}catch(n){Lo(e,n)}}).prototype,(Do=function(t){LT(this,{type:Ja,done:!1,notified:!1,parent:!1,reactions:new Bp,rejection:!1,state:0,value:void 0})}).prototype=wT(jp,"then",function(t,e){var n=tm(this),i=Hp(SC(this,jl));return n.parent=!0,i.ok=!Vp(t)||t,i.fail=Vp(e)&&e,i.domain=gu?Gp.domain:void 0,n.state==0?n.reactions.add(i):$E(function(){UT(i,n)}),i.promise}),mu=function(){var t=new Do,e=tm(t);this.promise=t,this.resolve=Us(Kp,e),this.reject=Us(Lo,e)},Fp.f=Hp=function(t){return t===jl||t===void 0?new mu(t):vC(t)}),OT({global:!0,wrap:!0,forced:va},{Promise:jl}),NT(jl,Ja,!1,!0),xp(Ja);var Yp=Xe("iterator"),Hl=!1;try{var zp=0,kc={next:function(){return{done:!!zp++}},return:function(){Hl=!0}};kc[Yp]=function(){return this},Array.from(kc,function(){throw 2})}catch{}var BT=ks,yC=function(t,e){if(!Hl)return!1;var n=!1;try{var i={};i[Yp]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},qp=Eu.CONSTRUCTOR||!yC(function(t){BT.all(t).then(void 0,function(){})}),FT=se,jT=un,Xp=Xa,hn=qa,im=bl;Ee({target:"Promise",stat:!0,forced:qp},{all:function(t){var e=this,n=Xp.f(e),i=n.resolve,r=n.reject,s=hn(function(){var c=jT(e.resolve),l=[],u=0,h=1;im(t,function(p){var _=u++,E=!1;h++,FT(c,e,p).then(function(g){E||(E=!0,l[_]=g,--h||i(l))},r)}),--h||i(l)});return s.error&&r(s.value),n.promise}});var Mi=Ee,CC=Eu.CONSTRUCTOR;ks&&ks.prototype,Mi({target:"Promise",proto:!0,forced:CC,real:!0},{catch:function(t){return this.then(void 0,t)}});var rm=se,am=un,Jp=Xa,GT=qa,HT=bl;Ee({target:"Promise",stat:!0,forced:qp},{race:function(t){var e=this,n=Jp.f(e),i=n.reject,r=GT(function(){var s=am(e.resolve);HT(t,function(c){rm(s,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var sm=se,om=Xa;Ee({target:"Promise",stat:!0,forced:Eu.CONSTRUCTOR},{reject:function(t){var e=om.f(this);return sm(e.reject,void 0,t),e.promise}});var AC=ci,WT=Ni,bC=Xa,cm=function(t,e){if(AC(t),WT(e)&&e.constructor===t)return e;var n=bC.f(t);return(0,n.resolve)(e),n.promise},IC=Ee,OC=ks,Po=Eu.CONSTRUCTOR,KT=cm,lm=gn("Promise"),wC=!Po;IC({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return KT(wC&&this===lm?OC:this,t)}});var NC=se,dm=un,DC=Xa,ya=qa,um=bl;Ee({target:"Promise",stat:!0,forced:qp},{allSettled:function(t){var e=this,n=DC.f(e),i=n.resolve,r=n.reject,s=ya(function(){var c=dm(e.resolve),l=[],u=0,h=1;um(t,function(p){var _=u++,E=!1;h++,NC(c,e,p).then(function(g){E||(E=!0,l[_]={status:"fulfilled",value:g},--h||i(l))},function(g){E||(E=!0,l[_]={status:"rejected",reason:g},--h||i(l))})}),--h||i(l)});return s.error&&r(s.value),n.promise}});var YT=se,zT=un,yu=gn,Xr=Xa,qT=qa,Qp=bl,Qa="No one promise resolved";Ee({target:"Promise",stat:!0,forced:qp},{any:function(t){var e=this,n=yu("AggregateError"),i=Xr.f(e),r=i.resolve,s=i.reject,c=qT(function(){var l=zT(e.resolve),u=[],h=0,p=1,_=!1;Qp(t,function(E){var g=h++,C=!1;p++,YT(l,e,E).then(function(v){C||_||(_=!0,r(v))},function(v){C||_||(C=!0,u[g]=v,--p||s(new n(u,Qa)))})}),--p||s(new n(u,Qa))});return c.error&&s(c.value),i.promise}});var LC=Ee,hm=ks,Wl=Xt,XT=gn,PC=cn,kC=Sa,JT=cm,MC=hm&&hm.prototype;LC({target:"Promise",proto:!0,real:!0,forced:!!hm&&Wl(function(){MC.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=kC(this,XT("Promise")),n=PC(t);return this.then(n?function(i){return JT(e,t()).then(function(){return i})}:t,n?function(i){return JT(e,t()).then(function(){throw i})}:t)}});var pm=Mt,UC=kd,xC=$i,QT=tl,Kl=pm("".charAt),Yl=pm("".charCodeAt),ZT=pm("".slice),$T=function(t){return function(e,n){var i,r,s=xC(QT(e)),c=UC(n),l=s.length;return c<0||c>=l?t?"":void 0:(i=Yl(s,c))<55296||i>56319||c+1===l||(r=Yl(s,c+1))<56320||r>57343?t?Kl(s,c):i:t?ZT(s,c,c+2):r-56320+(i-55296<<10)+65536}},ko={codeAt:$T(!1),charAt:$T(!0)},Cu=ko.charAt,tR=$i,Au=ma,fm=LE,Zp=Tp,bu="String Iterator",eR=Au.set,nR=Au.getterFor(bu);fm(String,"String",function(t){eR(this,{type:bu,string:tR(t),index:0})},function(){var t,e=nR(this),n=e.string,i=e.index;return i>=n.length?Zp(void 0,!0):(t=Cu(n,i),e.index+=t.length,Zp(t,!1))});var VC=Pr.Promise,iR={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Iu=_e,BC=ha,FC=so,rR=Ge,Ou=Xe("toStringTag");for(var zl in iR){var $p=Iu[zl],_m=$p&&$p.prototype;_m&&BC(_m)!==Ou&&FC(_m,Ou,zl),rR[zl]=rR.Array}var ql=VC,at=Vt(ql),aR=Zi("Array").values,sR=ha,oR=Zn,cR=ue,Em=aR,tf=Array.prototype,ef={DOMTokenList:!0,NodeList:!0},jC=function(t){var e=t.values;return t===tf||cR(tf,t)&&e===tf.values||oR(ef,sR(t))?Em:e},Tr=Vt(jC),mm=Xt,gm=Xe("iterator"),Xl=!mm(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),i="";return t.pathname="c%20d",e.forEach(function(r,s){e.delete("b"),i+=s+r}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[gm]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Sm=Eo,lR=Dd,Tm=Qi,Mo=Zt,Ca=function(t,e,n){var i=lR(e);i in t?Tm.f(t,i,Mo(0,n)):t[i]=n},xs=Dh,wu=gs,Nu=Ca,Uo=Array,GC=Math.max,nf=function(t,e,n){for(var i=wu(t),r=xs(e,i),s=xs(n===void 0?i:n,i),c=Uo(GC(s-r,0)),l=0;r<s;r++,l++)Nu(c,l,t[r]);return c.length=l,c},Jl=nf,HC=Math.floor,rf=function(t,e){var n=t.length,i=HC(n/2);return n<8?af(t,e):dR(t,rf(Jl(t,0,i),e),rf(Jl(t,i),e),e)},af=function(t,e){for(var n,i,r=t.length,s=1;s<r;){for(i=s,n=t[s];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==s++&&(t[i]=n)}return t},dR=function(t,e,n,i){for(var r=e.length,s=n.length,c=0,l=0;c<r||l<s;)t[c+l]=c<r&&l<s?i(e[c],n[l])<=0?e[c++]:n[l++]:c<r?e[c++]:n[l++];return t},uR=rf,Ql=Ee,Vs=_e,Du=se,Rr=Mt,xo=ot,Lu=Xl,Rm=Eo,WC=Dl,sf=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:Sm(t,i,e[i],n);return t},a=Ha,o=mp,d=ma,f=Ap,m=cn,T=Zn,w=fr,P=ha,F=ci,Q=Ni,rt=$i,_t=Is,$=Zt,tt=Qd,oe=Cl,Ht=kl,pn=uR,Y=Xe("iterator"),W="URLSearchParams",J=W+"Iterator",pt=d.set,bt=d.getterFor(W),we=d.getterFor(J),jt=Object.getOwnPropertyDescriptor,Qt=function(t){if(!xo)return Vs[t];var e=jt(Vs,t);return e&&e.value},Ri=Qt("fetch"),Ve=Qt("Request"),Jr=Qt("Headers"),vm=Ve&&Ve.prototype,bO=Jr&&Jr.prototype,$2=Vs.RegExp,tx=Vs.TypeError,IO=Vs.decodeURIComponent,ex=Vs.encodeURIComponent,nx=Rr("".charAt),OO=Rr([].join),Pu=Rr([].push),KC=Rr("".replace),ix=Rr([].shift),wO=Rr([].splice),NO=Rr("".split),rx=Rr("".slice),ax=/\+/g,DO=Array(4),sx=function(t){return DO[t-1]||(DO[t-1]=$2("((?:%[\\da-f]{2}){"+t+"})","gi"))},ox=function(t){try{return IO(t)}catch{return t}},LO=function(t){var e=KC(t,ax," "),n=4;try{return IO(e)}catch{for(;n;)e=KC(e,sx(n--),ox);return e}},cx=/[!'()~]|%20/g,lx={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},dx=function(t){return lx[t]},PO=function(t){return KC(ex(t),cx,dx)},YC=o(function(t,e){pt(this,{type:J,iterator:tt(bt(t).entries),kind:e})},"Iterator",function(){var t=we(this),e=t.kind,n=t.iterator.next(),i=n.value;return n.done||(n.value=e==="keys"?i.key:e==="values"?i.value:[i.key,i.value]),n},!0),kO=function(t){this.entries=[],this.url=null,t!==void 0&&(Q(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?nx(t,0)==="?"?rx(t,1):t:rt(t)))};kO.prototype={type:W,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,s,c,l,u=oe(t);if(u)for(n=(e=tt(t,u)).next;!(i=Du(n,e)).done;){if(s=(r=tt(F(i.value))).next,(c=Du(s,r)).done||(l=Du(s,r)).done||!Du(s,r).done)throw tx("Expected sequence with length 2");Pu(this.entries,{key:rt(c.value),value:rt(l.value)})}else for(var h in t)T(t,h)&&Pu(this.entries,{key:h,value:rt(t[h])})},parseQuery:function(t){if(t)for(var e,n,i=NO(t,"&"),r=0;r<i.length;)(e=i[r++]).length&&(n=NO(e,"="),Pu(this.entries,{key:LO(ix(n)),value:LO(OO(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],Pu(n,PO(t.key)+"="+PO(t.value));return OO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var hR=function(){f(this,of);var t=pt(this,new kO(arguments.length>0?arguments[0]:void 0));xo||(this.size=t.entries.length)},of=hR.prototype;if(sf(of,{append:function(t,e){var n=bt(this);Ht(arguments.length,2),Pu(n.entries,{key:rt(t),value:rt(e)}),xo||this.length++,n.updateURL()},delete:function(t){for(var e=bt(this),n=Ht(arguments.length,1),i=e.entries,r=rt(t),s=n<2?void 0:arguments[1],c=s===void 0?s:rt(s),l=0;l<i.length;){var u=i[l];if(u.key!==r||c!==void 0&&u.value!==c)l++;else if(wO(i,l,1),c!==void 0)break}xo||(this.size=i.length),e.updateURL()},get:function(t){var e=bt(this).entries;Ht(arguments.length,1);for(var n=rt(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=bt(this).entries;Ht(arguments.length,1);for(var n=rt(t),i=[],r=0;r<e.length;r++)e[r].key===n&&Pu(i,e[r].value);return i},has:function(t){for(var e=bt(this).entries,n=Ht(arguments.length,1),i=rt(t),r=n<2?void 0:arguments[1],s=r===void 0?r:rt(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(s===void 0||l.value===s))return!0}return!1},set:function(t,e){var n=bt(this);Ht(arguments.length,1);for(var i,r=n.entries,s=!1,c=rt(t),l=rt(e),u=0;u<r.length;u++)(i=r[u]).key===c&&(s?wO(r,u--,1):(s=!0,i.value=l));s||Pu(r,{key:c,value:l}),xo||(this.size=r.length),n.updateURL()},sort:function(){var t=bt(this);pn(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=bt(this).entries,i=w(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new YC(this,"keys")},values:function(){return new YC(this,"values")},entries:function(){return new YC(this,"entries")}},{enumerable:!0}),Rm(of,Y,of.entries,{}),Rm(of,"toString",function(){return bt(this).serialize()},{enumerable:!0}),xo&&WC(of,"size",{get:function(){return bt(this).entries.length},configurable:!0,enumerable:!0}),a(hR,W),Ql({global:!0,forced:!Lu},{URLSearchParams:hR}),!Lu&&m(Jr)){var ux=Rr(bO.has),hx=Rr(bO.set),MO=function(t){if(Q(t)){var e,n=t.body;if(P(n)===W)return e=t.headers?new Jr(t.headers):new Jr,ux(e,"content-type")||hx(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),_t(t,{body:$(0,rt(n)),headers:$(0,e)})}return t};if(m(Ri)&&Ql({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return Ri(t,arguments.length>1?MO(arguments[1]):{})}}),m(Ve)){var zC=function(t){return f(this,vm),new Ve(t,arguments.length>1?MO(arguments[1]):{})};vm.constructor=zC,zC.prototype=vm,Ql({global:!0,dontCallGetSet:!0,forced:!0},{Request:zC})}}var Za,px={URLSearchParams:hR,getState:bt},fx=Pr.URLSearchParams,UO=ot,_x=Mt,Ex=se,mx=Xt,qC=zd,gx=li,Sx=H,Tx=Va,Rx=sc,cf=Object.assign,xO=Object.defineProperty,vx=_x([].concat),yx=!cf||mx(function(){if(UO&&cf({b:1},cf(xO({},"a",{enumerable:!0,get:function(){xO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),cf({},t)[n]!=7||qC(cf({},e)).join("")!=i})?function(t,e){for(var n=Tx(t),i=arguments.length,r=1,s=gx.f,c=Sx.f;i>r;)for(var l,u=Rx(arguments[r++]),h=s?vx(qC(u),s(u)):qC(u),p=h.length,_=0;p>_;)l=h[_++],UO&&!Ex(c,u,l)||(n[l]=u[l]);return n}:cf,Cx=ci,Ax=Al,bx=fr,Ix=se,Ox=Va,wx=function(t,e,n,i){try{return i?e(Cx(n)[0],n[1]):e(n)}catch(r){Ax(t,"throw",r)}},Nx=_o,Dx=Pl,Lx=gs,VO=Ca,Px=Qd,kx=Cl,BO=Array,ku=Mt,XC=2147483647,Mx=/[^\0-\u007E]/,FO=/[.\u3002\uFF0E\uFF61]/g,jO="Overflow: input needs wider integers to process",GO=RangeError,Ux=ku(FO.exec),lf=Math.floor,JC=String.fromCharCode,HO=ku("".charCodeAt),WO=ku([].join),Zl=ku([].push),xx=ku("".replace),Vx=ku("".split),Bx=ku("".toLowerCase),KO=function(t){return t+22+75*(t<26)},Fx=function(t,e,n){var i=0;for(t=n?lf(t/700):t>>1,t+=lf(t/e);t>455;)t=lf(t/35),i+=36;return lf(i+36*t/(t+38))},jx=function(t){var e=[];t=function(b){for(var I=[],L=0,U=b.length;L<U;){var x=HO(b,L++);if(x>=55296&&x<=56319&&L<U){var M=HO(b,L++);(64512&M)==56320?Zl(I,((1023&x)<<10)+(1023&M)+65536):(Zl(I,x),L--)}else Zl(I,x)}return I}(t);var n,i,r=t.length,s=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&Zl(e,JC(i));var u=e.length,h=u;for(u&&Zl(e,"-");h<r;){var p=XC;for(n=0;n<t.length;n++)(i=t[n])>=s&&i<p&&(p=i);var _=h+1;if(p-s>lf((XC-c)/_))throw GO(jO);for(c+=(p-s)*_,s=p,n=0;n<t.length;n++){if((i=t[n])<s&&++c>XC)throw GO(jO);if(i==s){for(var E=c,g=36;;){var C=g<=l?1:g>=l+26?26:g-l;if(E<C)break;var v=E-C,y=36-C;Zl(e,JC(KO(C+v%y))),E=lf(v/y),g+=36}Zl(e,JC(KO(E))),l=Fx(c,_,h==u),c=0,h++}}c++,s++}return WO(e,"")},Gx=Ee,QC=ot,Hx=Xl,ZC=_e,YO=fr,$a=Mt,pR=Eo,ts=Dl,Wx=Ap,$C=Zn,tA=yx,df=function(t){var e=Ox(t),n=Dx(this),i=arguments.length,r=i>1?arguments[1]:void 0,s=r!==void 0;s&&(r=bx(r,i>2?arguments[2]:void 0));var c,l,u,h,p,_,E=kx(e),g=0;if(!E||this===BO&&Nx(E))for(c=Lx(e),l=n?new this(c):BO(c);c>g;g++)_=s?r(e[g],g):e[g],VO(l,g,_);else for(p=(h=Px(e,E)).next,l=n?new this:[];!(u=Ix(p,h)).done;g++)_=s?wx(h,r,[u.value,g],!0):u.value,VO(l,g,_);return l.length=g,l},Bs=nf,Kx=ko.codeAt,Yx=function(t){var e,n,i=[],r=Vx(xx(Bx(t),FO,"."),".");for(e=0;e<r.length;e++)n=r[e],Zl(i,Ux(Mx,n)?"xn--"+jx(n):n);return WO(i,".")},Mc=$i,zx=Ha,qx=kl,zO=px,qO=ma,Xx=qO.set,fR=qO.getterFor("URL"),Jx=zO.URLSearchParams,Qx=zO.getState,ym=ZC.URL,eA=ZC.TypeError,_R=ZC.parseInt,Zx=Math.floor,XO=Math.pow,es=$a("".charAt),Fs=$a(/./.exec),Cm=$a([].join),$x=$a(1 .toString),tV=$a([].pop),uf=$a([].push),nA=$a("".replace),eV=$a([].shift),nV=$a("".split),Am=$a("".slice),ER=$a("".toLowerCase),iV=$a([].unshift),iA="Invalid scheme",Mu="Invalid host",JO="Invalid port",QO=/[a-z]/i,rV=/[\d+-.a-z]/i,rA=/\d/,aV=/^0x/i,sV=/^[0-7]+$/,oV=/^\d+$/,ZO=/^[\da-f]+$/i,cV=/[\0\t\n\r #%/:<>?@[\\\]^|]/,lV=/[\0\t\n\r #/:<>?@[\\\]^|]/,dV=/^[\u0000-\u0020]+/,uV=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,hV=/[\t\n\r]/g,bm=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)iV(e,t%256),t=Zx(t/256);return Cm(e,".")}if(typeof t=="object"){for(e="",i=function(s){for(var c=null,l=1,u=null,h=0,p=0;p<8;p++)s[p]!==0?(h>l&&(c=u,l=h),u=null,h=0):(u===null&&(u=p),++h);return h>l&&(c=u,l=h),c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=$x(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},mR={},$O=tA({},mR,{" ":1,'"':1,"<":1,">":1,"`":1}),t0=tA({},$O,{"#":1,"?":1,"{":1,"}":1}),aA=tA({},t0,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),$l=function(t,e){var n=Kx(t,0);return n>32&&n<127&&!$C(e,t)?t:encodeURIComponent(t)},gR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Im=function(t,e){var n;return t.length==2&&Fs(QO,es(t,0))&&((n=es(t,1))==":"||!e&&n=="|")},e0=function(t){var e;return t.length>1&&Im(Am(t,0,2))&&(t.length==2||(e=es(t,2))==="/"||e==="\\"||e==="?"||e==="#")},pV=function(t){return t==="."||ER(t)==="%2e"},sA={},n0={},oA={},i0={},r0={},cA={},a0={},s0={},SR={},TR={},lA={},dA={},uA={},hA={},o0={},pA={},hf={},Vo={},c0={},Uu={},Uc={},fA=function(t,e,n){var i,r,s,c=Mc(t);if(e){if(r=this.parse(c))throw eA(r);this.searchParams=null}else{if(n!==void 0&&(i=new fA(n,!0)),r=this.parse(c,null,i))throw eA(r);(s=Qx(new Jx)).bindURL(this),this.searchParams=s}};fA.prototype={type:"URL",parse:function(t,e,n){var i,r,s,c,l,u=this,h=e||sA,p=0,_="",E=!1,g=!1,C=!1;for(t=Mc(t),e||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,t=nA(t,dV,""),t=nA(t,uV,"$1")),t=nA(t,hV,""),i=df(t);p<=i.length;){switch(r=i[p],h){case sA:if(!r||!Fs(QO,r)){if(e)return iA;h=oA;continue}_+=ER(r),h=n0;break;case n0:if(r&&(Fs(rV,r)||r=="+"||r=="-"||r=="."))_+=ER(r);else{if(r!=":"){if(e)return iA;_="",h=oA,p=0;continue}if(e&&(u.isSpecial()!=$C(gR,_)||_=="file"&&(u.includesCredentials()||u.port!==null)||u.scheme=="file"&&!u.host))return;if(u.scheme=_,e)return void(u.isSpecial()&&gR[u.scheme]==u.port&&(u.port=null));_="",u.scheme=="file"?h=hA:u.isSpecial()&&n&&n.scheme==u.scheme?h=i0:u.isSpecial()?h=s0:i[p+1]=="/"?(h=r0,p++):(u.cannotBeABaseURL=!0,uf(u.path,""),h=c0)}break;case oA:if(!n||n.cannotBeABaseURL&&r!="#")return iA;if(n.cannotBeABaseURL&&r=="#"){u.scheme=n.scheme,u.path=Bs(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,h=Uc;break}h=n.scheme=="file"?hA:cA;continue;case i0:if(r!="/"||i[p+1]!="/"){h=cA;continue}h=SR,p++;break;case r0:if(r=="/"){h=TR;break}h=Vo;continue;case cA:if(u.scheme=n.scheme,r==Za)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Bs(n.path),u.query=n.query;else if(r=="/"||r=="\\"&&u.isSpecial())h=a0;else if(r=="?")u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Bs(n.path),u.query="",h=Uu;else{if(r!="#"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Bs(n.path),u.path.length--,h=Vo;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=Bs(n.path),u.query=n.query,u.fragment="",h=Uc}break;case a0:if(!u.isSpecial()||r!="/"&&r!="\\"){if(r!="/"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,h=Vo;continue}h=TR}else h=SR;break;case s0:if(h=SR,r!="/"||es(_,p+1)!="/")continue;p++;break;case SR:if(r!="/"&&r!="\\"){h=TR;continue}break;case TR:if(r=="@"){E&&(_="%40"+_),E=!0,s=df(_);for(var v=0;v<s.length;v++){var y=s[v];if(y!=":"||C){var b=$l(y,aA);C?u.password+=b:u.username+=b}else C=!0}_=""}else if(r==Za||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()){if(E&&_=="")return"Invalid authority";p-=df(_).length+1,_="",h=lA}else _+=r;break;case lA:case dA:if(e&&u.scheme=="file"){h=pA;continue}if(r!=":"||g){if(r==Za||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()){if(u.isSpecial()&&_=="")return Mu;if(e&&_==""&&(u.includesCredentials()||u.port!==null))return;if(c=u.parseHost(_))return c;if(_="",h=hf,e)return;continue}r=="["?g=!0:r=="]"&&(g=!1),_+=r}else{if(_=="")return Mu;if(c=u.parseHost(_))return c;if(_="",h=uA,e==dA)return}break;case uA:if(!Fs(rA,r)){if(r==Za||r=="/"||r=="?"||r=="#"||r=="\\"&&u.isSpecial()||e){if(_!=""){var I=_R(_,10);if(I>65535)return JO;u.port=u.isSpecial()&&I===gR[u.scheme]?null:I,_=""}if(e)return;h=hf;continue}return JO}_+=r;break;case hA:if(u.scheme="file",r=="/"||r=="\\")h=o0;else{if(!n||n.scheme!="file"){h=Vo;continue}if(r==Za)u.host=n.host,u.path=Bs(n.path),u.query=n.query;else if(r=="?")u.host=n.host,u.path=Bs(n.path),u.query="",h=Uu;else{if(r!="#"){e0(Cm(Bs(i,p),""))||(u.host=n.host,u.path=Bs(n.path),u.shortenPath()),h=Vo;continue}u.host=n.host,u.path=Bs(n.path),u.query=n.query,u.fragment="",h=Uc}}break;case o0:if(r=="/"||r=="\\"){h=pA;break}n&&n.scheme=="file"&&!e0(Cm(Bs(i,p),""))&&(Im(n.path[0],!0)?uf(u.path,n.path[0]):u.host=n.host),h=Vo;continue;case pA:if(r==Za||r=="/"||r=="\\"||r=="?"||r=="#"){if(!e&&Im(_))h=Vo;else if(_==""){if(u.host="",e)return;h=hf}else{if(c=u.parseHost(_))return c;if(u.host=="localhost"&&(u.host=""),e)return;_="",h=hf}continue}_+=r;break;case hf:if(u.isSpecial()){if(h=Vo,r!="/"&&r!="\\")continue}else if(e||r!="?")if(e||r!="#"){if(r!=Za&&(h=Vo,r!="/"))continue}else u.fragment="",h=Uc;else u.query="",h=Uu;break;case Vo:if(r==Za||r=="/"||r=="\\"&&u.isSpecial()||!e&&(r=="?"||r=="#")){if((l=ER(l=_))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(u.shortenPath(),r=="/"||r=="\\"&&u.isSpecial()||uf(u.path,"")):pV(_)?r=="/"||r=="\\"&&u.isSpecial()||uf(u.path,""):(u.scheme=="file"&&!u.path.length&&Im(_)&&(u.host&&(u.host=""),_=es(_,0)+":"),uf(u.path,_)),_="",u.scheme=="file"&&(r==Za||r=="?"||r=="#"))for(;u.path.length>1&&u.path[0]==="";)eV(u.path);r=="?"?(u.query="",h=Uu):r=="#"&&(u.fragment="",h=Uc)}else _+=$l(r,t0);break;case c0:r=="?"?(u.query="",h=Uu):r=="#"?(u.fragment="",h=Uc):r!=Za&&(u.path[0]+=$l(r,mR));break;case Uu:e||r!="#"?r!=Za&&(r=="'"&&u.isSpecial()?u.query+="%27":u.query+=r=="#"?"%23":$l(r,mR)):(u.fragment="",h=Uc);break;case Uc:r!=Za&&(u.fragment+=$l(r,$O))}p++}},parseHost:function(t){var e,n,i;if(es(t,0)=="["){if(es(t,t.length-1)!="]"||(e=function(r){var s,c,l,u,h,p,_,E=[0,0,0,0,0,0,0,0],g=0,C=null,v=0,y=function(){return es(r,v)};if(y()==":"){if(es(r,1)!=":")return;v+=2,C=++g}for(;y();){if(g==8)return;if(y()!=":"){for(s=c=0;c<4&&Fs(ZO,y());)s=16*s+_R(y(),16),v++,c++;if(y()=="."){if(c==0||(v-=c,g>6))return;for(l=0;y();){if(u=null,l>0){if(!(y()=="."&&l<4))return;v++}if(!Fs(rA,y()))return;for(;Fs(rA,y());){if(h=_R(y(),10),u===null)u=h;else{if(u==0)return;u=10*u+h}if(u>255)return;v++}E[g]=256*E[g]+u,++l!=2&&l!=4||g++}if(l!=4)return;break}if(y()==":"){if(v++,!y())return}else if(y())return;E[g++]=s}else{if(C!==null)return;v++,C=++g}}if(C!==null)for(p=g-C,g=7;g!=0&&p>0;)_=E[g],E[g--]=E[C+p-1],E[C+--p]=_;else if(g!=8)return;return E}(Am(t,1,-1)),!e))return Mu;this.host=e}else if(this.isSpecial()){if(t=Yx(t),Fs(cV,t)||(e=function(r){var s,c,l,u,h,p,_,E=nV(r,".");if(E.length&&E[E.length-1]==""&&E.length--,(s=E.length)>4)return r;for(c=[],l=0;l<s;l++){if((u=E[l])=="")return r;if(h=10,u.length>1&&es(u,0)=="0"&&(h=Fs(aV,u)?16:8,u=Am(u,h==8?1:2)),u==="")p=0;else{if(!Fs(h==10?oV:h==8?sV:ZO,u))return r;p=_R(u,h)}uf(c,p)}for(l=0;l<s;l++)if(p=c[l],l==s-1){if(p>=XO(256,5-s))return null}else if(p>255)return null;for(_=tV(c),l=0;l<c.length;l++)_+=c[l]*XO(256,3-l);return _}(t),e===null))return Mu;this.host=e}else{if(Fs(lV,t))return Mu;for(e="",n=df(t),i=0;i<n.length;i++)e+=$l(n[i],mR);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return $C(gR,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&Im(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,s=t.port,c=t.path,l=t.query,u=t.fragment,h=e+":";return r!==null?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=bm(r),s!==null&&(h+=":"+s)):e=="file"&&(h+="//"),h+=t.cannotBeABaseURL?c[0]:c.length?"/"+Cm(c,"/"):"",l!==null&&(h+="?"+l),u!==null&&(h+="#"+u),h},setHref:function(t){var e=this.parse(t);if(e)throw eA(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new pf(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+bm(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Mc(t)+":",sA)},getUsername:function(){return this.username},setUsername:function(t){var e=df(Mc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=$l(e[n],aA)}},getPassword:function(){return this.password},setPassword:function(t){var e=df(Mc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=$l(e[n],aA)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?bm(t):bm(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,lA)},getHostname:function(){var t=this.host;return t===null?"":bm(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,dA)},getPort:function(){var t=this.port;return t===null?"":Mc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Mc(t))==""?this.port=null:this.parse(t,uA))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Cm(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,hf))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Mc(t))==""?this.query=null:(es(t,0)=="?"&&(t=Am(t,1)),this.query="",this.parse(t,Uu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Mc(t))!=""?(es(t,0)=="#"&&(t=Am(t,1)),this.fragment="",this.parse(t,Uc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var pf=function(t){var e=Wx(this,Fr),n=qx(arguments.length,1)>1?arguments[1]:void 0,i=Xx(e,new fA(t,!1,n));QC||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Fr=pf.prototype,ns=function(t,e){return{get:function(){return fR(this)[t]()},set:e&&function(n){return fR(this)[e](n)},configurable:!0,enumerable:!0}};if(QC&&(ts(Fr,"href",ns("serialize","setHref")),ts(Fr,"origin",ns("getOrigin")),ts(Fr,"protocol",ns("getProtocol","setProtocol")),ts(Fr,"username",ns("getUsername","setUsername")),ts(Fr,"password",ns("getPassword","setPassword")),ts(Fr,"host",ns("getHost","setHost")),ts(Fr,"hostname",ns("getHostname","setHostname")),ts(Fr,"port",ns("getPort","setPort")),ts(Fr,"pathname",ns("getPathname","setPathname")),ts(Fr,"search",ns("getSearch","setSearch")),ts(Fr,"searchParams",ns("getSearchParams")),ts(Fr,"hash",ns("getHash","setHash"))),pR(Fr,"toJSON",function(){return fR(this).serialize()},{enumerable:!0}),pR(Fr,"toString",function(){return fR(this).serialize()},{enumerable:!0}),ym){var l0=ym.createObjectURL,d0=ym.revokeObjectURL;l0&&pR(pf,"createObjectURL",YO(l0,ym)),d0&&pR(pf,"revokeObjectURL",YO(d0,ym))}zx(pf,"URL"),Gx({global:!0,forced:!Hx,sham:!QC},{URL:pf});var fV=Ee,_V=Xt,EV=kl,u0=$i,mV=Xl,h0=gn("URL");fV({target:"URL",stat:!0,forced:!(mV&&_V(function(){h0.canParse()}))},{canParse:function(t){var e=EV(arguments.length,1),n=u0(t),i=e<2||arguments[1]===void 0?void 0:u0(arguments[1]);try{return!!new h0(n,i)}catch{return!1}}});var RR=Vt(Pr.URL);let p0=!0,f0=!0;function vR(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function xu(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const u=h=>{const p=n(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,u),r.apply(this,[c,u])};const s=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const u=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,u])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function gV(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(p0=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function SV(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(f0=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function _0(){if(typeof window=="object"){if(p0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _A(t,e){f0&&console.warn(t+" is deprecated, please use "+e+" instead.")}function E0(t){return Object.prototype.toString.call(t)==="[object Object]"}function m0(t){var e;return E0(t)?ji(e=Object.keys(t)).call(e,function(n,i){const r=E0(t[i]),s=r?m0(t[i]):t[i],c=r&&!Object.keys(s).length;return s===void 0||c?n:Object.assign(n,{[i]:s})},{}):t}function EA(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?EA(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{EA(t,t.get(r),n)})}))}function g0(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&EA(t,l,r)})}),r}const S0=_0;function T0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const h=typeof c[u]=="object"?c[u]:{ideal:c[u]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(_,E){return _?_+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(h.ideal!==void 0){l.optional=l.optional||[];let _={};typeof h.ideal=="number"?(_[p("min",u)]=h.ideal,l.optional.push(_),_={},_[p("max",u)]=h.ideal,l.optional.push(_)):(_[p("",u)]=h.ideal,l.optional.push(_))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",u)]=h.exact):["min","max"].forEach(_=>{h[_]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(_,u)]=h[_])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const u=function(h,p,_){p in h&&!(_ in h)&&(h[_]=h[p],delete h[p])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const h=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?p=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(_=>{let E=(_=_.filter(g=>g.kind==="videoinput")).find(g=>p.some(C=>{var v;return it(v=g.label.toLowerCase()).call(v,C)}));return!E&&_.length&&it(p).call(p,"back")&&(E=_[_.length-1]),E&&(c.video.deviceId=u.exact?{exact:E.deviceId}:{ideal:E.deviceId}),c.video=i(c.video),S0("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return S0("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,u){r(c,h=>{n.webkitGetUserMedia(h,l,p=>{u&&u(s(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,u=>c(u).then(h=>{if(u.audio&&!h.getAudioTracks().length||u.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>at.reject(s(h))))}}}function R0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function v0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else xu(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function y0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let u=r.apply(this,arguments);return u||(u=e(this,c),this._senders.push(u)),u};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{const c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function C0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const s=function(l){const u={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(_=>{p[_]=h.stat(_)}),u[p.id]=p}),u},c=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){i(c(s(u)))};return e.apply(this,[l,n])}return new at((l,u)=>{e.apply(this,[function(h){l(c(s(h)))},u])}).then(i,r)}}function A0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>g0(s,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),xu(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>g0(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,s;return this.getSenders().forEach(c=>{c.track===n&&(i?s=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?s=!0:r=c),c.track===n)),s||i&&r?at.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():at.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function b0(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(u=>{if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function I0(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return b0(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(_=>_.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;function s(u,h){let p=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(_=>{const E=u._reverseStreams[_],g=u._streams[E.id];p=p.replace(new RegExp(g.id,"g"),E.id)}),new RTCSessionDescription({type:h.type,sdp:p})}t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[h.id];if(E)E.addTrack(u),at.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===u)},["createOffer","createAnswer"].forEach(function(u){const h=t.RTCPeerConnection.prototype[u],p={[u](){const _=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[E=>{const g=s(this,E);_[0].apply(null,[g])},E=>{_[1]&&_[1].apply(null,E)},arguments[2]]):h.apply(this,arguments).then(E=>s(this,E))}};t.RTCPeerConnection.prototype[u]=p[u]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(u,h){let p=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(_=>{const E=u._reverseStreams[_],g=u._streams[E.id];p=p.replace(new RegExp(E.id,"g"),g.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=l.get.apply(this);return u.type===""?u:s(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(_=>u.track===_)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function mA(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function O0(t,e){xu(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var w0=Object.freeze({__proto__:null,fixNegotiationNeeded:O0,shimAddTrackRemoveTrack:I0,shimAddTrackRemoveTrackWithNative:b0,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,s=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),s&&(n.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:y0,shimGetStats:C0,shimGetUserMedia:T0,shimMediaStream:R0,shimOnTrack:v0,shimPeerConnection:mA,shimSenderReceiverGetStats:A0});function N0(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,c){_A("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function D0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gA(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,s,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!s)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(s,c)}}function L0(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):at.resolve(new Map)}}function P0(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),xu(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function k0(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){_A("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&it(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function M0(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function U0(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:s}=r,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function x0(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function V0(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?at.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function B0(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?at.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var F0=Object.freeze({__proto__:null,shimAddTransceiver:U0,shimCreateAnswer:B0,shimCreateOffer:V0,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,at.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:x0,shimGetUserMedia:N0,shimOnTrack:D0,shimPeerConnection:gA,shimRTCDataChannel:M0,shimReceiverGetStats:P0,shimRemoveStream:k0,shimSenderGetStats:L0});function j0(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),it(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r&&r.forEach(c=>{var l;this._localStreams?it(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{it(i).call(i,r.track)&&this.removeTrack(r)})})}}function G0(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),it(s=this._remoteStreams).call(s,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,n.dispatchEvent(s)})}),e.apply(n,arguments)}}}function H0(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(u,h){const p=arguments.length>=2?arguments[2]:arguments[0],_=n.apply(this,[p]);return h?(_.then(u,h),at.resolve()):_},e.createAnswer=function(u,h){const p=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[p]);return h?(_.then(u,h),at.resolve()):_};let l=function(u,h,p){const _=r.apply(this,[u]);return p?(_.then(h,p),at.resolve()):_};e.setLocalDescription=l,l=function(u,h,p){const _=s.apply(this,[u]);return p?(_.then(h,p),at.resolve()):_},e.setRemoteDescription=l,l=function(u,h,p){const _=c.apply(this,[u]);return p?(_.then(h,p),at.resolve()):_},e.addIceCandidate=l}function W0(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(K0(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function K0(t){return t&&t.video!==void 0?Object.assign({},t,{video:m0(t.video)}):t}function Y0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let s=0;s<n.iceServers.length;s++){let c=n.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(_A("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[s])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function z0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function q0(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function X0(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var J0=Object.freeze({__proto__:null,shimAudioContext:X0,shimCallbacksAPI:H0,shimConstraints:K0,shimCreateOfferLegacy:q0,shimGetUserMedia:W0,shimLocalStreamsAPI:j0,shimRTCIceServerUrls:Y0,shimRemoteStreamsAPI:G0,shimTrackEventTransceiver:z0}),Q0=`	
\v\f\r \u2028\u2029\uFEFF`,TV=tl,RV=$i,SA=Q0,Z0=Mt("".replace),vV=RegExp("^["+SA+"]+"),yV=RegExp("(^|[^"+SA+"])["+SA+"]+$"),CV=function(t){return function(e){var n=RV(TV(e));return 1&t&&(n=Z0(n,vV,"")),2&t&&(n=Z0(n,yV,"$1")),n}},AV={trim:CV(3)},bV=IE.PROPER,IV=Xt,$0=Q0,OV=AV.trim;Ee({target:"String",proto:!0,forced:function(t){return IV(function(){return!!$0[t]()||""[t]()!==""||bV&&$0[t].name!==t})}("trim")},{trim:function(){return OV(this)}});var wV=Zi("String").trim,NV=ue,DV=wV,TA=String.prototype,LV=function(t){var e=t.trim;return typeof t=="string"||t===TA||NV(TA,t)&&e===TA.trim?DV:e},Ui=Vt(LV),tw={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)r=s[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?s.push(c+"="+n.parameters[c]):s.push(c)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],u=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(u){const h=e.parseRtpMap(u),p=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=p.length?e.parseFmtp(p[0]):{},h.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let s=0;return i.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(E=>e.parseSsrcMedia(E)).filter(E=>E.attribute==="cname"),u=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(E=>E.substring(17).split(" ").map(g=>parseInt(g,10)));p.length>0&&p[0].length>1&&p[0][0]===u&&(h=p[0][1]),r.codecs.forEach(E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let g={ssrc:u,codecPayloadType:parseInt(E.parameters.apt,10)};u&&h&&(g.rtx={ssrc:h}),i.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},i.push(g))}}),i.length===0&&u&&i.push({ssrc:u});let _=e.matchPrefix(n,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,i.forEach(E=>{E.maxBitrate=_})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(i=s[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const c=i!==void 0?i:2;return s=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(tw);var ew=tw.exports,ff=Vt(ew),PV=on({__proto__:null,default:ff},[ew]);function yR(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=ff.parseCandidate(n.candidate),s=Object.assign(i,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,xu(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function RA(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||xu(t,"icecandidate",e=>{if(e.candidate){const n=ff.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function CR(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const u=ff.splitSections(l.sdp);return u.shift(),u.some(h=>{const p=ff.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const h=parseInt(u[1],10);return h!=h?-1:h},r=function(l){let u=65536;return e.browser==="firefox"&&(u=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),u},s=function(l,u){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=ff.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):e.browser==="firefox"&&u!==-1&&(h=2147483637),h},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),u=r(l),h=s(arguments[0],l);let p;p=u===0&&h===0?Number.POSITIVE_INFINITY:u===0||h===0?Math.max(u,h):Math.min(u,h);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>p}),this._sctp=_}return c.apply(this,arguments)}}function AR(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},xu(t,"datachannel",i=>(e(i.channel,i.target),i))}function vA(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",r);s.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function yA(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(s=>Ui(s).call(s)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function bR(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?at.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),at.resolve())})}function IR(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var kV=Object.freeze({__proto__:null,removeExtmapAllowMixed:yA,shimAddIceCandidateNullOrEmpty:bR,shimConnectionState:vA,shimMaxMessageSize:CR,shimParameterlessSetLocalDescription:IR,shimRTCIceCandidate:yR,shimRTCIceCandidateRelayProtocol:RA,shimSendThrowTypeError:AR});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=_0,i=function(s){const c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;const{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=vR(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=vR(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=vR(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:kV,extractVersion:vR,disableLog:gV,disableWarnings:SV,sdp:PV};switch(i.browser){case"chrome":if(!w0||!mA||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=w0,bR(t,i),IR(t),T0(t,i),R0(t),mA(t,i),v0(t),I0(t,i),y0(t),C0(t),A0(t),O0(t,i),yR(t),RA(t),vA(t),CR(t,i),AR(t),yA(t,i);break;case"firefox":if(!F0||!gA||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=F0,bR(t,i),IR(t),N0(t,i),gA(t,i),D0(t),k0(t),L0(t),P0(t),M0(t),U0(t),x0(t),V0(t),B0(t),yR(t),vA(t),CR(t,i),AR(t);break;case"safari":if(!J0||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=J0,bR(t,i),IR(t),Y0(t),q0(t),H0(t),j0(t),G0(t),z0(t),W0(t),X0(t),yR(t),RA(t),CR(t,i),AR(t),yA(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var nw=io,MV=TypeError,iw=Ji.match(/firefox\/(\d+)/i),UV=!!iw&&+iw[1],xV=/MSIE|Trident/.test(Ji),rw=Ji.match(/AppleWebKit\/(\d+)\./),VV=!!rw&&+rw[1],BV=Ee,aw=Mt,FV=un,jV=Va,sw=gs,GV=function(t,e){if(!delete t[e])throw MV("Cannot delete property "+nw(e)+" of "+nw(t))},ow=$i,CA=Xt,HV=uR,WV=tr,cw=UV,KV=xV,lw=kr,dw=VV,td=[],uw=aw(td.sort),YV=aw(td.push),zV=CA(function(){td.sort(void 0)}),qV=CA(function(){td.sort(null)}),XV=WV("sort"),hw=!CA(function(){if(lw)return lw<70;if(!(cw&&cw>3)){if(KV)return!0;if(dw)return dw<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)td.push({k:e+i,v:n})}for(td.sort(function(s,c){return c.v-s.v}),i=0;i<td.length;i++)e=td[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});BV({target:"Array",proto:!0,forced:zV||!qV||!XV||!hw},{sort:function(t){t!==void 0&&FV(t);var e=jV(this);if(hw)return t===void 0?uw(e):uw(e,t);var n,i,r=[],s=sw(e);for(i=0;i<s;i++)i in e&&YV(r,e[i]);for(HV(r,function(c){return function(l,u){return u===void 0?-1:l===void 0?1:c!==void 0?+c(l,u)||0:ow(l)>ow(u)?1:-1}}(t)),n=sw(r),i=0;i<n;)e[i]=r[i++];for(;i<s;)GV(e,i++);return e}});var JV=Zi("Array").sort,QV=ue,ZV=JV,AA=Array.prototype,$V=function(t){var e=t.sort;return t===AA||QV(AA,t)&&e===AA.sort?ZV:e},Om=Vt($V),bA=_e;Ee({global:!0,forced:bA.globalThis!==bA},{globalThis:bA});var pw=Vt(_e),IA={exports:{}};(function(t,e){(function(n,i){var r="function",s="undefined",c="object",l="string",u="major",h="model",p="name",_="type",E="vendor",g="version",C="architecture",v="console",y="mobile",b="tablet",I="smarttv",L="wearable",U="embedded",x="Amazon",M="Apple",j="ASUS",X="BlackBerry",ct="Browser",dt="Chrome",zt="Firefox",qt="Google",Pe="Huawei",En="LG",sn="Microsoft",cr="Motorola",K="Opera",nt="Samsung",mt="Sharp",z="Sony",R="Xiaomi",D="Zebra",k="Facebook",Z="Chromium OS",Dt="Mac OS",Ce=function(wn){for(var Hn={},We=0;We<wn.length;We++)Hn[wn[We].toUpperCase()]=wn[We];return Hn},Gn=function(wn,Hn){return typeof wn===l&&Ir(Hn).indexOf(Ir(wn))!==-1},Ir=function(wn){return wn.toLowerCase()},$c=function(wn,Hn){if(typeof wn===l)return wn=wn.replace(/^\s\s*/,""),typeof Hn===s?wn:wn.substring(0,350)},fh=function(wn,Hn){for(var We,Hr,ic,mn,de,Or,vd=0;vd<Hn.length&&!de;){var to=Hn[vd],F2=Hn[vd+1];for(We=Hr=0;We<to.length&&!de&&to[We];)if(de=to[We++].exec(wn))for(ic=0;ic<F2.length;ic++)Or=de[++Hr],typeof(mn=F2[ic])===c&&mn.length>0?mn.length===2?typeof mn[1]==r?this[mn[0]]=mn[1].call(this,Or):this[mn[0]]=mn[1]:mn.length===3?typeof mn[1]!==r||mn[1].exec&&mn[1].test?this[mn[0]]=Or?Or.replace(mn[1],mn[2]):i:this[mn[0]]=Or?mn[1].call(this,Or,mn[2]):i:mn.length===4&&(this[mn[0]]=Or?mn[3].call(this,Or.replace(mn[1],mn[2])):i):this[mn]=Or||i;vd+=2}},Dg=function(wn,Hn){for(var We in Hn)if(typeof Hn[We]===c&&Hn[We].length>0){for(var Hr=0;Hr<Hn[We].length;Hr++)if(Gn(Hn[We][Hr],wn))return We==="?"?i:We}else if(Gn(Hn[We],wn))return We==="?"?i:We;return wn},Cy={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ay={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,K+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[p,K]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+ct]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[g,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+ct],g],[/\bfocus\/([\w\.]+)/i],[g,[p,zt+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,K+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,K+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI "+ct]],[/fxios\/([-\w\.]+)/i],[g,[p,zt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+ct]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+ct],g],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,k],g],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,dt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,dt+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+ct]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,Dg,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,zt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,g],[/(cobalt)\/([\w\.]+)/i],[p,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[C,"amd64"]],[/(ia32(?=;))/i],[[C,Ir]],[/((?:i[346]|x)86)[;\)]/i],[[C,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/windows (ce|mobile); ppc;/i],[[C,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[C,/ower/,"",Ir]],[/(sun4\w)[;\)]/i],[[C,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[C,Ir]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[E,nt],[_,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[E,nt],[_,y]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[E,M],[_,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[E,M],[_,b]],[/(macintosh);/i],[h,[E,M]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[E,mt],[_,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[E,Pe],[_,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[E,Pe],[_,y]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[E,R],[_,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[E,R],[_,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[E,"OPPO"],[_,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[E,"Vivo"],[_,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[E,"Realme"],[_,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[E,cr],[_,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[E,cr],[_,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[E,En],[_,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[E,En],[_,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[E,"Lenovo"],[_,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[E,"Nokia"],[_,y]],[/(pixel c)\b/i],[h,[E,qt],[_,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[E,qt],[_,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[E,z],[_,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[E,z],[_,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[E,"OnePlus"],[_,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[E,x],[_,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[E,x],[_,y]],[/(playbook);[-\w\),; ]+(rim)/i],[h,E,[_,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[E,X],[_,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[E,j],[_,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[E,j],[_,y]],[/(nexus 9)/i],[h,[E,"HTC"],[_,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[h,/_/g," "],[_,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[E,"Acer"],[_,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[E,"Meizu"],[_,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,h,[_,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,h,[_,b]],[/(surface duo)/i],[h,[E,sn],[_,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[E,"Fairphone"],[_,y]],[/(u304aa)/i],[h,[E,"AT&T"],[_,y]],[/\bsie-(\w*)/i],[h,[E,"Siemens"],[_,y]],[/\b(rct\w+) b/i],[h,[E,"RCA"],[_,b]],[/\b(venue[\d ]{2,7}) b/i],[h,[E,"Dell"],[_,b]],[/\b(q(?:mv|ta)\w+) b/i],[h,[E,"Verizon"],[_,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[E,"Barnes & Noble"],[_,b]],[/\b(tm\d{3}\w+) b/i],[h,[E,"NuVision"],[_,b]],[/\b(k88) b/i],[h,[E,"ZTE"],[_,b]],[/\b(nx\d{3}j) b/i],[h,[E,"ZTE"],[_,y]],[/\b(gen\d{3}) b.+49h/i],[h,[E,"Swiss"],[_,y]],[/\b(zur\d{3}) b/i],[h,[E,"Swiss"],[_,b]],[/\b((zeki)?tb.*\b) b/i],[h,[E,"Zeki"],[_,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],h,[_,b]],[/\b(ns-?\w{0,9}) b/i],[h,[E,"Insignia"],[_,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[E,"NextBook"],[_,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],h,[_,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],h,[_,y]],[/\b(ph-1) /i],[h,[E,"Essential"],[_,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[E,"Envizen"],[_,b]],[/\b(trio[-\w\. ]+) b/i],[h,[E,"MachSpeed"],[_,b]],[/\btu_(1491) b/i],[h,[E,"Rotor"],[_,b]],[/(shield[\w ]+) b/i],[h,[E,"Nvidia"],[_,b]],[/(sprint) (\w+)/i],[E,h,[_,y]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[E,sn],[_,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[E,D],[_,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[E,D],[_,y]],[/smart-tv.+(samsung)/i],[E,[_,I]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[E,nt],[_,I]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,En],[_,I]],[/(apple) ?tv/i],[E,[h,M+" TV"],[_,I]],[/crkey/i],[[h,dt+"cast"],[E,qt],[_,I]],[/droid.+aft(\w)( bui|\))/i],[h,[E,x],[_,I]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[E,mt],[_,I]],[/(bravia[\w ]+)( bui|\))/i],[h,[E,z],[_,I]],[/(mitv-\w{5}) bui/i],[h,[E,R],[_,I]],[/Hbbtv.*(technisat) (.*);/i],[E,h,[_,I]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,$c],[h,$c],[_,I]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,I]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,h,[_,v]],[/droid.+; (shield) bui/i],[h,[E,"Nvidia"],[_,v]],[/(playstation [345portablevi]+)/i],[h,[E,z],[_,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[E,sn],[_,v]],[/((pebble))app/i],[E,h,[_,L]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[E,M],[_,L]],[/droid.+; (glass) \d/i],[h,[E,qt],[_,L]],[/droid.+; (wt63?0{2,3})\)/i],[h,[E,D],[_,L]],[/(quest( 2| pro)?)/i],[h,[E,k],[_,L]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[_,U]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[_,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[_,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,y]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[g,Dg,Cy]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[g,Dg,Cy]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Dt],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,g],[/\(bb(10);/i],[g,[p,X]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,zt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[p,dt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Z],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,g]]},Ma=function(wn,Hn){if(typeof wn===c&&(Hn=wn,wn=i),!(this instanceof Ma))return new Ma(wn,Hn).getResult();var We=typeof n!==s&&n.navigator?n.navigator:i,Hr=wn||(We&&We.userAgent?We.userAgent:""),ic=We&&We.userAgentData?We.userAgentData:i,mn=Hn?function(de,Or){var vd={};for(var to in de)Or[to]&&Or[to].length%2==0?vd[to]=Or[to].concat(de[to]):vd[to]=de[to];return vd}(Ay,Hn):Ay;return this.getBrowser=function(){var de={};return de[p]=i,de[g]=i,fh.call(de,Hr,mn.browser),de[u]=function(Or){return typeof Or===l?Or.replace(/[^\d\.]/g,"").split(".")[0]:i}(de[g]),We&&We.brave&&typeof We.brave.isBrave==r&&(de[p]="Brave"),de},this.getCPU=function(){var de={};return de[C]=i,fh.call(de,Hr,mn.cpu),de},this.getDevice=function(){var de={};return de[E]=i,de[h]=i,de[_]=i,fh.call(de,Hr,mn.device),!de[_]&&ic&&ic.mobile&&(de[_]=y),de[h]=="Macintosh"&&We&&typeof We.standalone!==s&&We.maxTouchPoints&&We.maxTouchPoints>2&&(de[h]="iPad",de[_]=b),de},this.getEngine=function(){var de={};return de[p]=i,de[g]=i,fh.call(de,Hr,mn.engine),de},this.getOS=function(){var de={};return de[p]=i,de[g]=i,fh.call(de,Hr,mn.os),!de[p]&&ic&&ic.platform!="Unknown"&&(de[p]=ic.platform.replace(/chrome os/i,Z).replace(/macos/i,Dt)),de},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Hr},this.setUA=function(de){return Hr=typeof de===l&&de.length>350?$c(de,350):de,this},this.setUA(Hr),this};Ma.VERSION="0.7.34",Ma.BROWSER=Ce([p,g,u]),Ma.CPU=Ce([C]),Ma.DEVICE=Ce([h,E,_,v,y,I,b,L,U]),Ma.ENGINE=Ma.OS=Ce([p,g]),t.exports&&(e=t.exports=Ma),e.UAParser=Ma;var Rd=typeof n!==s&&(n.jQuery||n.Zepto);if(Rd&&!Rd.ua){var _h=new Ma;Rd.ua=_h.getResult(),Rd.ua.get=function(){return _h.getUA()},Rd.ua.set=function(wn){_h.setUA(wn);var Hn=_h.getResult();for(var We in Hn)Rd.ua[We]=Hn[We]}}})(typeof window=="object"?window:et)})(IA,IA.exports);var tB=Vt(IA.exports),eB=ha,nB=Zn,iB=eo,rB=Ge,aB=Xe("iterator"),sB=Object,oB=function(t){if(iB(t))return!1;var e=sB(t);return e[aB]!==void 0||"@@iterator"in e||nB(rB,eB(e))},cB=Vt(oB),fw=Re.clear;Ee({global:!0,bind:!0,forced:_e.clearImmediate!==fw},{clearImmediate:fw});var lB=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",_w=_e,dB=Jn,uB=cn,hB=lB,pB=Ji,fB=uu,_B=kl,EB=_w.Function,mB=/MSIE .\./.test(pB)||hB&&function(){var t=_w.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),gB=Ee,Ew=_e,mw=Re.set,SB=function(t,e){var n=1;return mB?function(i,r){var s=_B(arguments.length,1)>n,c=uB(i)?i:EB(i),l=s?fB(arguments,n):[],u=s?function(){dB(c,this,l)}:c;return t(u)}:t},gw=Ew.setImmediate?SB(mw):mw;gB({global:!0,bind:!0,forced:Ew.setImmediate!==gw},{setImmediate:gw});var Sw=Vt(Pr.setImmediate),TB=Ee,RB=zE,vB=un,yB=kl,CB=fa,AB=_e.process;TB({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){yB(arguments.length,1),vB(t);var e=CB&&AB.domain;RB(e?e.bind(t):t)}});var Tw=Vt(Pr.queueMicrotask);function Rw(t,e){return function(){return t.apply(e,arguments)}}const{toString:bB}=Object.prototype,{getPrototypeOf:OA}=Object,OR=(wA=Object.create(null),t=>{const e=bB.call(t);return wA[e]||(wA[e]=e.slice(8,-1).toLowerCase())});var wA;const js=t=>(t=t.toLowerCase(),e=>OR(e)===t),wR=t=>e=>typeof e===t,{isArray:_f}=Array,wm=wR("undefined"),vw=js("ArrayBuffer"),IB=wR("string"),Aa=wR("function"),yw=wR("number"),NR=t=>t!==null&&typeof t=="object",DR=t=>{if(OR(t)!=="object")return!1;const e=OA(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||cB(t))},OB=js("Date"),wB=js("File"),NB=js("Blob"),DB=js("FileList"),LB=js("URLSearchParams"),[PB,kB,MB,UB]=["ReadableStream","Request","Response","Headers"].map(js);function Nm(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),_f(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const s=r?Object.getOwnPropertyNames(t):Object.keys(t),c=s.length;let l;for(n=0;n<c;n++)l=s[n],e.call(null,t[l],l,t)}}function Cw(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Vu=pw!==void 0?pw:typeof self<"u"?self:typeof window<"u"?window:gO,Aw=t=>!wm(t)&&t!==Vu,xB=(NA=typeof Uint8Array<"u"&&OA(Uint8Array),t=>NA&&t instanceof NA);var NA;const VB=js("HTMLFormElement"),bw=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),BB=js("RegExp"),Iw=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};Nm(n,(r,s)=>{let c;(c=e(r,s,t))!==!1&&(i[s]=c||r)}),Object.defineProperties(t,i)},DA="abcdefghijklmnopqrstuvwxyz",Ow="0123456789",ww={DIGIT:Ow,ALPHA:DA,ALPHA_DIGIT:DA+DA.toUpperCase()+Ow},FB=js("AsyncFunction"),Nw=(Dw=typeof Sw=="function",Lw=Aa(Vu.postMessage),Dw?Sw:Lw?(LA="axios@".concat(Math.random()),LR=[],Vu.addEventListener("message",t=>{let{source:e,data:n}=t;e===Vu&&n===LA&&LR.length&&LR.shift()()},!1),t=>{LR.push(t),Vu.postMessage(LA,"*")}):t=>setTimeout(t));var Dw,Lw,LA,LR;const jB=Tw!==void 0?Tw.bind(Vu):typeof process<"u"&&process.nextTick||Nw;var st={isArray:_f,isArrayBuffer:vw,isBuffer:function(t){return t!==null&&!wm(t)&&t.constructor!==null&&!wm(t.constructor)&&Aa(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Aa(t.append)&&((e=OR(t))==="formdata"||e==="object"&&Aa(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&vw(t.buffer),e},isString:IB,isNumber:yw,isBoolean:t=>t===!0||t===!1,isObject:NR,isPlainObject:DR,isReadableStream:PB,isRequest:kB,isResponse:MB,isHeaders:UB,isUndefined:wm,isDate:OB,isFile:wB,isBlob:NB,isRegExp:BB,isFunction:Aa,isStream:t=>NR(t)&&Aa(t.pipe),isURLSearchParams:LB,isTypedArray:xB,isFileList:DB,forEach:Nm,merge:function t(){const{caseless:e}=Aw(this)&&this||{},n={},i=(r,s)=>{const c=e&&Cw(n,s)||s;DR(n[c])&&DR(r)?n[c]=t(n[c],r):DR(r)?n[c]=t({},r):_f(r)?n[c]=r.slice():n[c]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Nm(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Nm(e,(r,s)=>{n&&Aa(r)?t[s]=Rw(r,n):t[s]=r},{allOwnKeys:i}),t},trim:t=>Ui(t)?Ui(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,s,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)c=r[s],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&OA(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:OR,kindOfTest:js,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(_f(t))return t;let e=t.length;if(!yw(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:VB,hasOwnProperty:bw,hasOwnProp:bw,reduceDescriptors:Iw,freezeMethods:t=>{Iw(t,(e,n)=>{if(Aa(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];Aa(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(s=>{n[s]=!0})};return _f(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:Cw,global:Vu,isContextDefined:Aw,ALPHABET:ww,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ww.ALPHA_DIGIT,n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&Aa(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(NR(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=_f(i)?[]:{};return Nm(i,(c,l)=>{const u=n(c,r+1);!wm(u)&&(s[l]=u)}),e[r]=void 0,s}}return i};return n(t,0)},isAsyncFn:FB,isThenable:t=>t&&(NR(t)||Aa(t))&&Aa(t.then)&&Aa(t.catch),setImmediate:Nw,asap:jB};function ve(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}st.inherits(ve,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:st.toJSONObject(this.config),code:this.code,status:this.status}}});const Pw=ve.prototype,kw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{kw[t]={value:t}}),Object.defineProperties(ve,kw),Object.defineProperty(Pw,"isAxiosError",{value:!0}),ve.from=(t,e,n,i,r,s)=>{const c=Object.create(Pw);return st.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),ve.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,s&&Object.assign(c,s),c};function PA(t){return st.isPlainObject(t)||st.isArray(t)}function Mw(t){return st.endsWith(t,"[]")?t.slice(0,-2):t}function Uw(t,e,n){return t?t.concat(e).map(function(i,r){return i=Mw(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const GB=st.toFlatObject(st,{},null,function(t){return/^is[A-Z]/.test(t)});function PR(t,e,n){if(!st.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=st.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,g){return!st.isUndefined(g[E])})).metaTokens,r=n.visitor||h,s=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&st.isSpecCompliantForm(e);if(!st.isFunction(r))throw new TypeError("visitor must be a function");function u(E){if(E===null)return"";if(st.isDate(E))return E.toISOString();if(!l&&st.isBlob(E))throw new ve("Blob is not supported. Use a Buffer instead.");return st.isArrayBuffer(E)||st.isTypedArray(E)?l&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function h(E,g,C){let v=E;if(E&&!C&&typeof E=="object"){if(st.endsWith(g,"{}"))g=i?g:g.slice(0,-2),E=JSON.stringify(E);else if(st.isArray(E)&&function(y){return st.isArray(y)&&!y.some(PA)}(E)||(st.isFileList(E)||st.endsWith(g,"[]"))&&(v=st.toArray(E)))return g=Mw(g),v.forEach(function(y,b){!st.isUndefined(y)&&y!==null&&e.append(c===!0?Uw([g],b,s):c===null?g:g+"[]",u(y))}),!1}return!!PA(E)||(e.append(Uw(C,g,s),u(E)),!1)}const p=[],_=Object.assign(GB,{defaultVisitor:h,convertValue:u,isVisitable:PA});if(!st.isObject(t))throw new TypeError("data must be an object");return function E(g,C){if(!st.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+C.join("."));p.push(g),st.forEach(g,function(v,y){(!(st.isUndefined(v)||v===null)&&r.call(e,v,st.isString(y)?Ui(y).call(y):y,C,_))===!0&&E(v,C?C.concat(y):[y])}),p.pop()}}(t),e}function xw(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function kA(t,e){this._pairs=[],t&&PR(t,this,e)}const Vw=kA.prototype;function HB(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Bw(t,e,n){if(!e)return t;const i=n&&n.encode||HB;st.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let s;if(s=r?r(e,n):st.isURLSearchParams(e)?e.toString():new kA(e,n).toString(i),s){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}Vw.append=function(t,e){this._pairs.push([t,e])},Vw.toString=function(t){const e=t?function(n){return t.call(this,n,xw)}:xw;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var Fw=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){st.forEach(this.handlers,function(e){e!==null&&t(e)})}},jw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Gw={exports:{}},WB=Ee,KB=ot,Hw=Qi.f;WB({target:"Object",stat:!0,forced:Object.defineProperty!==Hw,sham:!KB},{defineProperty:Hw});var Ww=Pr.Object,YB=Gw.exports=function(t,e,n){return Ww.defineProperty(t,e,n)};Ww.defineProperty.sham&&(YB.sham=!0);var Kw=Vt(Gw.exports),zB=TypeError,Yw=Li,qB=Pl,XB=Ni,JB=Xe("species"),zw=Array,QB=function(t){var e;return Yw(t)&&(e=t.constructor,(qB(e)&&(e===zw||Yw(e.prototype))||XB(e)&&(e=e[JB])===null)&&(e=void 0)),e===void 0?zw:e},qw=function(t,e){return new(QB(t))(e===0?0:e)},ZB=Xt,$B=kr,tF=Xe("species"),Xw=function(t){return $B>=51||!ZB(function(){var e=[];return(e.constructor={})[tF]=function(){return{foo:1}},e[t](Boolean).foo!==1})},eF=Ee,nF=Xt,iF=Li,rF=Ni,aF=Va,sF=gs,Jw=function(t){if(t>9007199254740991)throw zB("Maximum allowed index exceeded");return t},Qw=Ca,oF=qw,cF=Xw,lF=kr,Zw=Xe("isConcatSpreadable"),dF=lF>=51||!nF(function(){var t=[];return t[Zw]=!1,t.concat()[0]!==t}),uF=function(t){if(!rF(t))return!1;var e=t[Zw];return e!==void 0?!!e:iF(t)};eF({target:"Array",proto:!0,forced:!dF||!cF("concat")},{concat:function(t){var e,n,i,r,s,c=aF(this),l=oF(c,0),u=0;for(e=-1,i=arguments.length;e<i;e++)if(uF(s=e===-1?c:arguments[e]))for(r=sF(s),Jw(u+r),n=0;n<r;n++,u++)n in s&&Qw(l,u,s[n]);else Jw(u+1),Qw(l,u++,s);return l.length=u,l}});var $w={},hF=dn,pF=no,tN=lo.f,fF=nf,eN=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];$w.f=function(t){return eN&&hF(t)=="Window"?function(e){try{return tN(e)}catch{return fF(eN)}}(t):tN(pF(t))};var Ef={},_F=Xe;Ef.f=_F;var nN=Pr,EF=Zn,mF=Ef,gF=Qi.f,ui=function(t){var e=nN.Symbol||(nN.Symbol={});EF(e,t)||gF(e,t,{value:mF.f(t)})},SF=se,TF=gn,RF=Xe,vF=Eo,iN=function(){var t=TF("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=RF("toPrimitive");e&&!e[i]&&vF(e,i,function(r){return SF(n,this)},{})},yF=fr,CF=sc,AF=Va,bF=gs,IF=qw,rN=Mt([].push),OF=function(t){var e=t==1,n=t==2,i=t==3,r=t==4,s=t==6,c=t==7,l=t==5||s;return function(u,h,p,_){for(var E,g,C=AF(u),v=CF(C),y=yF(h,p),b=bF(v),I=0,L=_||IF,U=e?L(u,b):n||c?L(u,0):void 0;b>I;I++)if((l||I in v)&&(g=y(E=v[I],I,C),t))if(e)U[I]=g;else if(g)switch(t){case 3:return!0;case 5:return E;case 6:return I;case 2:rN(U,E)}else switch(t){case 4:return!1;case 7:rN(U,E)}return s?-1:i||r?r:U}},aN={forEach:OF(0)},kR=Ee,MA=_e,UA=se,wF=Mt,mf=ot,gf=oc,NF=Xt,Gi=Zn,DF=ue,xA=ci,MR=no,VA=Dd,LF=$i,BA=Zt,Dm=Is,sN=zd,PF=lo,oN=$w,kF=li,cN=si,lN=Qi,MF=ho,dN=H,uN=Eo,UF=Dl,FA=dc,hN=ml,pN=Rh,xF=Xe,VF=Ef,BF=ui,FF=iN,jF=Ha,fN=ma,UR=aN.forEach,Qr=Ba("hidden"),xR="Symbol",Lm="prototype",GF=fN.set,_N=fN.getterFor(xR),Gs=Object[Lm],Bu=MA.Symbol,VR=Bu&&Bu[Lm],HF=MA.TypeError,jA=MA.QObject,EN=cN.f,Fu=lN.f,mN=oN.f,WF=dN.f,gN=wF([].push),xc=FA("symbols"),Pm=FA("op-symbols"),KF=FA("wks"),GA=!jA||!jA[Lm]||!jA[Lm].findChild,HA=mf&&NF(function(){return Dm(Fu({},"a",{get:function(){return Fu(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var i=EN(Gs,e);i&&delete Gs[e],Fu(t,e,n),i&&t!==Gs&&Fu(Gs,e,i)}:Fu,WA=function(t,e){var n=xc[t]=Dm(VR);return GF(n,{type:xR,tag:t,description:e}),mf||(n.description=e),n},BR=function(t,e,n){t===Gs&&BR(Pm,e,n),xA(t);var i=VA(e);return xA(n),Gi(xc,i)?(n.enumerable?(Gi(t,Qr)&&t[Qr][i]&&(t[Qr][i]=!1),n=Dm(n,{enumerable:BA(0,!1)})):(Gi(t,Qr)||Fu(t,Qr,BA(1,{})),t[Qr][i]=!0),HA(t,i,n)):Fu(t,i,n)},KA=function(t,e){xA(t);var n=MR(e),i=sN(n).concat(vN(n));return UR(i,function(r){mf&&!UA(SN,n,r)||BR(t,r,n[r])}),t},SN=function(t){var e=VA(t),n=UA(WF,this,e);return!(this===Gs&&Gi(xc,e)&&!Gi(Pm,e))&&(!(n||!Gi(this,e)||!Gi(xc,e)||Gi(this,Qr)&&this[Qr][e])||n)},TN=function(t,e){var n=MR(t),i=VA(e);if(n!==Gs||!Gi(xc,i)||Gi(Pm,i)){var r=EN(n,i);return!r||!Gi(xc,i)||Gi(n,Qr)&&n[Qr][i]||(r.enumerable=!0),r}},RN=function(t){var e=mN(MR(t)),n=[];return UR(e,function(i){Gi(xc,i)||Gi(hN,i)||gN(n,i)}),n},vN=function(t){var e=t===Gs,n=mN(e?Pm:MR(t)),i=[];return UR(n,function(r){!Gi(xc,r)||e&&!Gi(Gs,r)||gN(i,xc[r])}),i};gf||(Bu=function(){if(DF(VR,this))throw HF("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?LF(arguments[0]):void 0,e=pN(t),n=function(i){this===Gs&&UA(n,Pm,i),Gi(this,Qr)&&Gi(this[Qr],e)&&(this[Qr][e]=!1),HA(this,e,BA(1,i))};return mf&&GA&&HA(Gs,e,{configurable:!0,set:n}),WA(e,t)},uN(VR=Bu[Lm],"toString",function(){return _N(this).tag}),uN(Bu,"withoutSetter",function(t){return WA(pN(t),t)}),dN.f=SN,lN.f=BR,MF.f=KA,cN.f=TN,PF.f=oN.f=RN,kF.f=vN,VF.f=function(t){return WA(xF(t),t)},mf&&UF(VR,"description",{configurable:!0,get:function(){return _N(this).description}})),kR({global:!0,wrap:!0,forced:!gf,sham:!gf},{Symbol:Bu}),UR(sN(KF),function(t){BF(t)}),kR({target:xR,stat:!0,forced:!gf},{useSetter:function(){GA=!0},useSimple:function(){GA=!1}}),kR({target:"Object",stat:!0,forced:!gf,sham:!mf},{create:function(t,e){return e===void 0?Dm(t):KA(Dm(t),e)},defineProperty:BR,defineProperties:KA,getOwnPropertyDescriptor:TN}),kR({target:"Object",stat:!0,forced:!gf},{getOwnPropertyNames:RN}),FF(),jF(Bu,xR),hN[Qr]=!0;var yN=oc&&!!Symbol.for&&!!Symbol.keyFor,YF=Ee,zF=gn,qF=Zn,XF=$i,CN=dc,JF=yN,YA=CN("string-to-symbol-registry"),QF=CN("symbol-to-string-registry");YF({target:"Symbol",stat:!0,forced:!JF},{for:function(t){var e=XF(t);if(qF(YA,e))return YA[e];var n=zF("Symbol")(e);return YA[e]=n,QF[n]=e,n}});var ZF=Ee,$F=Zn,t3=nl,e3=io,n3=yN,AN=dc("symbol-to-string-registry");ZF({target:"Symbol",stat:!0,forced:!n3},{keyFor:function(t){if(!t3(t))throw TypeError(e3(t)+" is not a symbol");if($F(AN,t))return AN[t]}});var bN=Li,i3=cn,IN=dn,r3=$i,ON=Mt([].push),a3=Ee,wN=gn,NN=Jn,s3=se,km=Mt,DN=Xt,LN=cn,PN=nl,kN=uu,o3=function(t){if(i3(t))return t;if(bN(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?ON(n,r):typeof r!="number"&&IN(r)!="Number"&&IN(r)!="String"||ON(n,r3(r))}var s=n.length,c=!0;return function(l,u){if(c)return c=!1,u;if(bN(this))return u;for(var h=0;h<s;h++)if(n[h]===l)return u}}},c3=oc,l3=String,ed=wN("JSON","stringify"),FR=km(/./.exec),MN=km("".charAt),d3=km("".charCodeAt),u3=km("".replace),h3=km(1 .toString),p3=/[\uD800-\uDFFF]/g,UN=/^[\uD800-\uDBFF]$/,xN=/^[\uDC00-\uDFFF]$/,VN=!c3||DN(function(){var t=wN("Symbol")();return ed([t])!="[null]"||ed({a:t})!="{}"||ed(Object(t))!="{}"}),BN=DN(function(){return ed("\uDF06\uD834")!=='"\\udf06\\ud834"'||ed("\uDEAD")!=='"\\udead"'}),f3=function(t,e){var n=kN(arguments),i=o3(e);if(LN(i)||t!==void 0&&!PN(t))return n[1]=function(r,s){if(LN(i)&&(s=s3(i,this,l3(r),s)),!PN(s))return s},NN(ed,null,n)},_3=function(t,e,n){var i=MN(n,e-1),r=MN(n,e+1);return FR(UN,t)&&!FR(xN,r)||FR(xN,t)&&!FR(UN,i)?"\\u"+h3(d3(t,0),16):t};ed&&a3({target:"JSON",stat:!0,forced:VN||BN},{stringify:function(t,e,n){var i=kN(arguments),r=NN(VN?f3:ed,null,i);return BN&&typeof r=="string"?u3(r,p3,_3):r}});var FN=li,E3=Va;Ee({target:"Object",stat:!0,forced:!oc||Xt(function(){FN.f(1)})},{getOwnPropertySymbols:function(t){var e=FN.f;return e?e(E3(t)):[]}}),ui("asyncIterator"),ui("hasInstance"),ui("isConcatSpreadable"),ui("iterator"),ui("match"),ui("matchAll"),ui("replace"),ui("search"),ui("species"),ui("split");var m3=iN;ui("toPrimitive"),m3();var g3=gn,S3=Ha;ui("toStringTag"),S3(g3("Symbol"),"Symbol"),ui("unscopables"),Ha(_e.JSON,"JSON",!0);var T3=Pr.Symbol,R3=Xe,v3=Qi.f,jN=R3("metadata"),GN=Function.prototype;GN[jN]===void 0&&v3(GN,jN,{value:null}),ui("dispose"),ui("metadata");var y3=T3;ui("asyncDispose");var C3=Mt,zA=gn("Symbol"),A3=zA.keyFor,b3=C3(zA.prototype.valueOf),HN=zA.isRegisteredSymbol||function(t){try{return A3(b3(t))!==void 0}catch{return!1}};Ee({target:"Symbol",stat:!0},{isRegisteredSymbol:HN});for(var I3=dc,WN=gn,O3=Mt,w3=nl,N3=Xe,jR=WN("Symbol"),KN=jR.isWellKnownSymbol,YN=WN("Object","getOwnPropertyNames"),D3=O3(jR.prototype.valueOf),zN=I3("wks"),qA=0,qN=YN(jR),L3=qN.length;qA<L3;qA++)try{var XN=qN[qA];w3(jR[XN])&&N3(XN)}catch{}var JN=function(t){if(KN&&KN(t))return!0;try{for(var e=D3(t),n=0,i=YN(zN),r=i.length;n<r;n++)if(zN[i[n]]==e)return!0}catch{}return!1};Ee({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:JN}),ui("matcher"),ui("observable"),Ee({target:"Symbol",stat:!0},{isRegistered:HN}),Ee({target:"Symbol",stat:!0,forced:!0},{isWellKnown:JN}),ui("metadataKey"),ui("patternMatch"),ui("replaceAll");var Sf=Vt(y3),QN=Vt(Ef.f("iterator"));function Mm(t){return Mm=typeof Sf=="function"&&typeof QN=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Sf=="function"&&e.constructor===Sf&&e!==Sf.prototype?"symbol":typeof e},Mm(t)}var P3=Vt(Ef.f("toPrimitive"));function k3(t){var e=function(n,i){if(Mm(n)!=="object"||n===null)return n;var r=n[P3];if(r!==void 0){var s=r.call(n,i);if(Mm(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return Mm(e)==="symbol"?e:String(e)}function A(t,e,n){return(e=k3(e))in t?Kw(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ZN=Vt(fx),M3={isBrowser:!0,classes:{URLSearchParams:ZN!==void 0?ZN:kA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const XA=typeof window<"u"&&typeof document<"u",JA=typeof navigator=="object"&&navigator||void 0,U3=XA&&(!JA||["ReactNative","NativeScript","NS"].indexOf(JA.product)<0),x3=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",V3=XA&&window.location.href||"http://localhost";function $N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function tD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$N(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$N(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var vr=tD(tD({},Object.freeze({__proto__:null,hasBrowserEnv:XA,hasStandardBrowserEnv:U3,hasStandardBrowserWebWorkerEnv:x3,navigator:JA,origin:V3})),M3),B3=ci,F3=se,j3=Zn,G3=ue,H3=function(){var t=B3(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},eD=RegExp.prototype,nD=function(t){var e=t.flags;return e!==void 0||"flags"in eD||j3(t,"flags")||!G3(eD,t)?e:F3(H3,t)},W3=ko.charAt,iD=se,K3=ci,Y3=cn,z3=dn,q3=/./.exec,X3=TypeError,J3=Ee,rD=se,aD=Wr,Q3=mp,GR=Tp,sD=tl,oD=x_,Um=$i,Z3=ci,$3=eo,tj=dn,ej=j_,cD=nD,nj=rl,ij=Xt,rj=Sa,aj=function(t,e,n){return e+(n?W3(t,e).length:1)},sj=function(t,e){var n=t.exec;if(Y3(n)){var i=iD(n,t,e);return i!==null&&K3(i),i}if(z3(t)==="RegExp")return iD(q3,t,e);throw X3("RegExp#exec called on incompatible receiver")},lD=ma,oj=Xe("matchAll"),dD="RegExp String",uD=dD+" Iterator",cj=lD.set,lj=lD.getterFor(uD),dj=TypeError,QA=aD("".indexOf),HR=aD("".matchAll),ZA=!!HR&&!ij(function(){HR("a",/./)}),uj=Q3(function(t,e,n,i){cj(this,{type:uD,regexp:t,string:e,global:n,unicode:i,done:!1})},dD,function(){var t=lj(this);if(t.done)return GR(void 0,!0);var e=t.regexp,n=t.string,i=sj(e,n);return i===null?(t.done=!0,GR(void 0,!0)):t.global?(Um(i[0])===""&&(e.lastIndex=aj(n,oD(e.lastIndex),t.unicode)),GR(i,!1)):(t.done=!0,GR(i,!1))}),hD=function(t){var e,n,i,r=Z3(this),s=Um(t),c=rj(r,RegExp),l=Um(cD(r));return e=new c(c===RegExp?r.source:r,l),n=!!~QA(l,"g"),i=!!~QA(l,"u"),e.lastIndex=oD(r.lastIndex),new uj(e,s,n,i)};J3({target:"String",proto:!0,forced:ZA},{matchAll:function(t){var e,n,i,r,s=sD(this);if($3(t)){if(ZA)return HR(s,t)}else{if(ej(t)&&(e=Um(sD(cD(t))),!~QA(e,"g")))throw dj("`.matchAll` does not allow non-global regexes");if(ZA)return HR(s,t);if((i=nj(t,oj))===void 0&&tj(t)=="RegExp"&&(i=hD),i)return rD(i,t,s)}return n=Um(s),r=new RegExp(t,"g"),rD(hD,r,n)}});var hj=Zi("String").matchAll,pj=ue,fj=hj,$A=String.prototype,_j=function(t){var e=t.matchAll;return typeof t=="string"||t===$A||pj($A,t)&&e===$A.matchAll?fj:e},Ej=Vt(_j);function pD(t){function e(n,i,r,s){let c=n[s++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),u=s>=n.length;return c=!c&&st.isArray(r)?r.length:c,u?(st.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&st.isObject(r[c])||(r[c]=[]),e(n,i,r[c],s)&&st.isArray(r[c])&&(r[c]=function(h){const p={},_=Object.keys(h);let E;const g=_.length;let C;for(E=0;E<g;E++)C=_[E],p[C]=h[C];return p}(r[c])),!l)}if(st.isFormData(t)&&st.isFunction(t.entries)){const n={};return st.forEachEntry(t,(i,r)=>{e(function(s){return Ej(st).call(st,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const tb={transitional:jw,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=st.isObject(t);if(r&&st.isHTMLForm(t)&&(t=new FormData(t)),st.isFormData(t))return i?JSON.stringify(pD(t)):t;if(st.isArrayBuffer(t)||st.isBuffer(t)||st.isStream(t)||st.isFile(t)||st.isBlob(t)||st.isReadableStream(t))return t;if(st.isArrayBufferView(t))return t.buffer;if(st.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return PR(c,new vr.classes.URLSearchParams,Object.assign({visitor:function(u,h,p,_){return vr.isNode&&st.isBuffer(u)?(this.append(h,u.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((s=st.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return PR(s?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,u){if(st.isString(c))try{return(l||JSON.parse)(c),Ui(st).call(st,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(u||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||tb.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(st.isResponse(t)||st.isReadableStream(t))return t;if(t&&st.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(s){if(r)throw s.name==="SyntaxError"?ve.from(s,ve.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vr.classes.FormData,Blob:vr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};st.forEach(["delete","get","head","post","put","patch"],t=>{tb.headers[t]={}});var eb=tb;const mj=st.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),fD=Symbol("internals");function xm(t){var e;return t&&Ui(e=String(t)).call(e).toLowerCase()}function WR(t){return t===!1||t==null?t:st.isArray(t)?t.map(WR):String(t)}function nb(t,e,n,i,r){return st.isFunction(i)?i.call(this,e,n):(r&&(e=n),st.isString(e)?st.isString(i)?e.indexOf(i)!==-1:st.isRegExp(i)?i.test(e):void 0:void 0)}class KR{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function s(u,h,p){const _=xm(h);if(!_)throw new Error("header name must be a non-empty string");const E=st.findKey(r,_);(!E||r[E]===void 0||p===!0||p===void 0&&r[E]!==!1)&&(r[E||h]=WR(u))}const c=(u,h)=>st.forEach(u,(p,_)=>s(p,_,h));if(st.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(st.isString(e)&&(e=Ui(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ui(l=e).call(l)))c((u=>{const h={};let p,_,E;return u&&u.split(`
`).forEach(function(g){var C,v;E=g.indexOf(":"),p=Ui(C=g.substring(0,E)).call(C).toLowerCase(),_=Ui(v=g.substring(E+1)).call(v),!p||h[p]&&mj[p]||(p==="set-cookie"?h[p]?h[p].push(_):h[p]=[_]:h[p]=h[p]?h[p]+", "+_:_)}),h})(e),n);else if(st.isHeaders(e))for(const[u,h]of e.entries())s(h,u,i);else e!=null&&s(n,e,i);var l;return this}get(e,n){if(e=xm(e)){const i=st.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(s){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=l.exec(s);)c[u[1]]=u[2];return c}(r);if(st.isFunction(n))return n.call(this,r,i);if(st.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=xm(e)){const i=st.findKey(this,e);return!(!i||this[i]===void 0||n&&!nb(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function s(c){if(c=xm(c)){const l=st.findKey(i,c);!l||n&&!nb(0,i[l],l,n)||(delete i[l],r=!0)}}return st.isArray(e)?e.forEach(s):s(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const s=n[i];e&&!nb(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const n=this,i={};return st.forEach(this,(r,s)=>{var c;const l=st.findKey(i,s);if(l)return n[l]=WR(r),void delete n[s];const u=e?function(h){return Ui(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,_,E)=>_.toUpperCase()+E)}(s):Ui(c=String(s)).call(c);u!==s&&delete n[s],n[u]=WR(r),i[u]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return st.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&st.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[fD]=this[fD]={accessors:{}}).accessors,i=this.prototype;function r(s){const c=xm(s);n[c]||(function(l,u){const h=st.toCamelCase(" "+u);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(_,E,g){return this[p].call(this,u,_,E,g)},configurable:!0})})}(i,s),n[c]=!0)}return st.isArray(e)?e.forEach(r):r(e),this}}KR.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),st.reduceDescriptors(KR.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),st.freezeMethods(KR);var Hs=KR;function ib(t,e){const n=this||eb,i=e||n,r=Hs.from(i.headers);let s=i.data;return st.forEach(t,function(c){s=c.call(n,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function _D(t){return!(!t||!t.__CANCEL__)}function Tf(t,e,n){ve.call(this,t??"canceled",ve.ERR_CANCELED,e,n),this.name="CanceledError"}function ED(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new ve("Request failed with status code "+n.status,[ve.ERR_BAD_REQUEST,ve.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}st.inherits(Tf,ve,{__CANCEL__:!0});const YR=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(s,c){s=s||10;const l=new Array(s),u=new Array(s);let h,p=0,_=0;return c=c!==void 0?c:1e3,function(E){const g=Date.now(),C=u[_];h||(h=g),l[p]=E,u[p]=g;let v=_,y=0;for(;v!==p;)y+=l[v++],v%=s;if(p=(p+1)%s,p===_&&(_=(_+1)%s),g-h<c)return;const b=C&&g-C;return b?Math.round(1e3*y/b):void 0}}(50,250);return function(s,c){let l,u,h=0,p=1e3/c;const _=function(E){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,u&&(clearTimeout(u),u=null),s.apply(null,E)};return[function(){const E=Date.now(),g=E-h;for(var C=arguments.length,v=new Array(C),y=0;y<C;y++)v[y]=arguments[y];g>=p?_(v,E):(l=v,u||(u=setTimeout(()=>{u=null,_(l)},p-g)))},()=>l&&_(l)]}(s=>{const c=s.loaded,l=s.lengthComputable?s.total:void 0,u=c-i,h=r(u);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:u,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},mD=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},gD=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return st.asap(()=>t(...n))};var gj=vr.hasStandardBrowserEnv?((t,e)=>n=>(n=new RR(n,vr.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new RR(vr.origin),vr.navigator&&/(msie|trident)/i.test(vr.navigator.userAgent)):()=>!0,Sj=vr.hasStandardBrowserEnv?{write(t,e,n,i,r,s){const c=[t+"="+encodeURIComponent(e)];st.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),st.isString(i)&&c.push("path="+i),st.isString(r)&&c.push("domain="+r),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function SD(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(t,e):e}function TD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const RD=t=>t instanceof Hs?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?TD(Object(i),!0).forEach(function(r){A(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TD(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function ju(t,e){e=e||{};const n={};function i(h,p,_,E){return st.isPlainObject(h)&&st.isPlainObject(p)?st.merge.call({caseless:E},h,p):st.isPlainObject(p)?st.merge({},p):st.isArray(p)?p.slice():p}function r(h,p,_,E){return st.isUndefined(p)?st.isUndefined(h)?void 0:i(void 0,h,0,E):i(h,p,0,E)}function s(h,p){if(!st.isUndefined(p))return i(void 0,p)}function c(h,p){return st.isUndefined(p)?st.isUndefined(h)?void 0:i(void 0,h):i(void 0,p)}function l(h,p,_){return _ in e?i(h,p):_ in t?i(void 0,h):void 0}const u={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,_)=>r(RD(h),RD(p),0,!0)};return st.forEach(Object.keys(Object.assign({},t,e)),function(h){const p=u[h]||r,_=p(t[h],e[h],h);st.isUndefined(_)&&p!==l||(n[h]=_)}),n}var vD=t=>{const e=ju({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:c,headers:l,auth:u}=e;if(e.headers=l=Hs.from(l),e.url=Bw(SD(e.baseURL,e.url),t.params,t.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),st.isFormData(i)){if(vr.hasStandardBrowserEnv||vr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[h,...p]=n?n.split(";").map(_=>Ui(_).call(_)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(vr.hasStandardBrowserEnv&&(r&&st.isFunction(r)&&(r=r(e)),r||r!==!1&&gj(e.url))){const h=s&&c&&Sj.read(c);h&&l.set(s,h)}return e},Tj=typeof XMLHttpRequest<"u"&&function(t){return new at(function(e,n){const i=vD(t);let r=i.data;const s=Hs.from(i.headers).normalize();let c,l,u,h,p,{responseType:_,onUploadProgress:E,onDownloadProgress:g}=i;function C(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let v=new XMLHttpRequest;function y(){if(!v)return;const I=Hs.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders());ED(function(L){e(L),C()},function(L){n(L),C()},{data:_&&_!=="text"&&_!=="json"?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:I,config:t,request:v}),v=null}v.open(i.method.toUpperCase(),i.url,!0),v.timeout=i.timeout,"onloadend"in v?v.onloadend=y:v.onreadystatechange=function(){v&&v.readyState===4&&(v.status!==0||v.responseURL&&v.responseURL.indexOf("file:")===0)&&setTimeout(y)},v.onabort=function(){v&&(n(new ve("Request aborted",ve.ECONNABORTED,t,v)),v=null)},v.onerror=function(){n(new ve("Network Error",ve.ERR_NETWORK,t,v)),v=null},v.ontimeout=function(){let I=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const L=i.transitional||jw;i.timeoutErrorMessage&&(I=i.timeoutErrorMessage),n(new ve(I,L.clarifyTimeoutError?ve.ETIMEDOUT:ve.ECONNABORTED,t,v)),v=null},r===void 0&&s.setContentType(null),"setRequestHeader"in v&&st.forEach(s.toJSON(),function(I,L){v.setRequestHeader(L,I)}),st.isUndefined(i.withCredentials)||(v.withCredentials=!!i.withCredentials),_&&_!=="json"&&(v.responseType=i.responseType),g&&([u,p]=YR(g,!0),v.addEventListener("progress",u)),E&&v.upload&&([l,h]=YR(E),v.upload.addEventListener("progress",l),v.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=I=>{v&&(n(!I||I.type?new Tf(null,t,v):I),v.abort(),v=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const b=function(I){const L=/^([-+\w]{1,25})(:?\/\/|:)/.exec(I);return L&&L[1]||""}(i.url);b&&vr.protocols.indexOf(b)===-1?n(new ve("Unsupported protocol "+b+":",ve.ERR_BAD_REQUEST,t)):v.send(r||null)})},Rj=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const s=function(h){if(!i){i=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof ve?p:new Tf(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,s(new ve("timeout ".concat(e," of ms exceeded"),ve.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),t=null)};t.forEach(h=>h.addEventListener("abort",s));const{signal:u}=r;return u.unsubscribe=()=>st.asap(l),u}},vj=ql,yj=Xa;Ee({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=yj.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Cj=Xa,Aj=qa;Ee({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=Cj.f(this),n=Aj(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var rb=Vt(vj),yD=Ef.f("asyncIterator"),bj=Vt(yD);function ab(t,e){this.v=t,this.k=e}function Vm(t){var e,n;function i(s,c){try{var l=t[s](c),u=l.value,h=u instanceof ab;rb.resolve(h?u.v:u).then(function(p){if(h){var _=s==="return"?"return":"next";if(!u.k||p.done)return i(_,p);p=t[_](p).value}r(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){r("throw",p)}}function r(s,c){switch(s){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(s,c){return new rb(function(l,u){var h={key:s,arg:c,resolve:l,reject:u,next:null};n?n=n.next=h:(e=n=h,i(s,c))})},typeof t.return!="function"&&(this.return=void 0)}function ba(t){return function(){return new Vm(t.apply(this,arguments))}}function ee(t){return new ab(t,0)}function zR(t){var e={},n=!1;function i(r,s){return n=!0,{done:!1,value:new ab(s=new rb(function(c){c(t[r](s))}),1)}}return e[Sf!==void 0&&QN||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}Vm.prototype[typeof Sf=="function"&&bj||"@@asyncIterator"]=function(){return this},Vm.prototype.next=function(t){return this._invoke("next",t)},Vm.prototype.throw=function(t){return this._invoke("throw",t)},Vm.prototype.return=function(t){return this._invoke("return",t)};var sb=Vt(yD);function ob(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=sb,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new qR(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function qR(t){function e(n){if(Object(n)!==n)return at.reject(new TypeError(n+" is not an object."));var i=n.done;return at.resolve(n.value).then(function(r){return{value:r,done:i}})}return qR=function(n){this.s=n,this.n=n.next},qR.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?at.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?at.reject(n):e(i.apply(this.s,arguments))}},new qR(t)}const Ij=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},Oj=function(){var t=ba(function*(e,n){var i,r=!1,s=!1;try{for(var c,l=ob(wj(e));r=!(c=yield ee(l.next())).done;r=!1){const u=c.value;yield*zR(ob(Ij(u,n)))}}catch(u){s=!0,i=u}finally{try{r&&l.return!=null&&(yield ee(l.return()))}finally{if(s)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),wj=function(){var t=ba(function*(e){if(e[sb])return void(yield*zR(ob(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield ee(n.read());if(i)break;yield r}}finally{yield ee(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),CD=(t,e,n,i)=>{const r=Oj(t,e);let s,c=0,l=u=>{s||(s=!0,i&&i(u))};return new ReadableStream({async pull(u){try{const{done:h,value:p}=await r.next();if(h)return l(),void u.close();let _=p.byteLength;if(n){let E=c+=_;n(E)}u.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:u=>(l(u),r.return())},{highWaterMark:2})};function AD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?AD(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):AD(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const XR=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ID=XR&&typeof ReadableStream=="function",Nj=XR&&(typeof TextEncoder=="function"?(OD=new TextEncoder,t=>OD.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var OD;const wD=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},Dj=ID&&wD(()=>{let t=!1;const e=new Request(vr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),cb=ID&&wD(()=>st.isReadableStream(new Response("").body)),JR={stream:cb&&(t=>t.body)};var ND;XR&&(ND=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!JR[t]&&(JR[t]=st.isFunction(ND[t])?e=>e[t]():(e,n)=>{throw new ve("Response type '".concat(t,"' is not supported"),ve.ERR_NOT_SUPPORT,n)})}));const Lj=async(t,e)=>{const n=st.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:st.isBlob(i)?i.size:st.isSpecCompliantForm(i)?(await new Request(vr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:st.isArrayBufferView(i)||st.isArrayBuffer(i)?i.byteLength:(st.isURLSearchParams(i)&&(i+=""),st.isString(i)?(await Nj(i)).byteLength:void 0))(e)};var Pj=XR&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:s,timeout:c,onDownloadProgress:l,onUploadProgress:u,responseType:h,headers:p,withCredentials:_="same-origin",fetchOptions:E}=vD(t);h=h?(h+"").toLowerCase():"text";let g,C=Rj([r,s&&s.toAbortSignal()],c);const v=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let y;try{if(u&&Dj&&n!=="get"&&n!=="head"&&(y=await Lj(p,i))!==0){let x,M=new Request(e,{method:"POST",body:i,duplex:"half"});if(st.isFormData(i)&&(x=M.headers.get("content-type"))&&p.setContentType(x),M.body){const[j,X]=mD(y,YR(gD(u)));i=CD(M.body,65536,j,X)}}st.isString(_)||(_=_?"include":"omit");const b="credentials"in Request.prototype;g=new Request(e,bD(bD({},E),{},{signal:C,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:b?_:void 0}));let I=await fetch(g);const L=cb&&(h==="stream"||h==="response");if(cb&&(l||L&&v)){const x={};["status","statusText","headers"].forEach(ct=>{x[ct]=I[ct]});const M=st.toFiniteNumber(I.headers.get("content-length")),[j,X]=l&&mD(M,YR(gD(l),!0))||[];I=new Response(CD(I.body,65536,j,()=>{X&&X(),v&&v()}),x)}h=h||"text";let U=await JR[st.findKey(JR,h)||"text"](I,t);return!L&&v&&v(),await new at((x,M)=>{ED(x,M,{data:U,headers:Hs.from(I.headers),status:I.status,statusText:I.statusText,config:t,request:g})})}catch(b){throw v&&v(),b&&b.name==="TypeError"&&/fetch/i.test(b.message)?Object.assign(new ve("Network Error",ve.ERR_NETWORK,t,g),{cause:b.cause||b}):ve.from(b,b&&b.code,t,g)}});const lb={http:null,xhr:Tj,fetch:Pj};st.forEach(lb,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const DD=t=>"- ".concat(t),kj=t=>st.isFunction(t)||t===null||t===!1;var LD={getAdapter:t=>{t=st.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let s=0;s<e;s++){let c;if(n=t[s],i=n,!kj(n)&&(i=lb[(c=String(n)).toLowerCase()],i===void 0))throw new ve("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+s]=i}if(!i){const s=Object.entries(r).map(c=>{let[l,u]=c;return"adapter ".concat(l," ")+(u===!1?"is not supported by the environment":"is not available in the build")});throw new ve("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(DD).join(`
`):" "+DD(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:lb};function db(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Tf(null,t)}function PD(t){return db(t),t.headers=Hs.from(t.headers),t.data=ib.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),LD.getAdapter(t.adapter||eb.adapter)(t).then(function(e){return db(t),e.data=ib.call(t,t.transformResponse,e),e.headers=Hs.from(e.headers),e},function(e){return _D(e)||(db(t),e&&e.response&&(e.response.data=ib.call(t,t.transformResponse,e.response),e.response.headers=Hs.from(e.response.headers))),at.reject(e)})}const kD="1.7.9",QR={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{QR[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const MD={};QR.transitional=function(t,e,n){function i(r,s){return"[Axios v"+kD+"] Transitional option '"+r+"'"+s+(n?". "+n:"")}return(r,s,c)=>{if(t===!1)throw new ve(i(s," has been removed"+(e?" in "+e:"")),ve.ERR_DEPRECATED);return e&&!MD[s]&&(MD[s]=!0,console.warn(i(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,s,c)}},QR.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var ZR={assertOptions:function(t,e,n){if(typeof t!="object")throw new ve("options must be an object",ve.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const s=i[r],c=e[s];if(c){const l=t[s],u=l===void 0||c(l,s,t);if(u!==!0)throw new ve("option "+s+" must be "+u,ve.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new ve("Unknown option "+s,ve.ERR_BAD_OPTION)}},validators:QR};const Bo=ZR.validators;let $R=class{constructor(t){this.defaults=t,this.interceptors={request:new Fw,response:new Fw}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=ju(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&ZR.assertOptions(n,{silentJSONParsing:Bo.transitional(Bo.boolean),forcedJSONParsing:Bo.transitional(Bo.boolean),clarifyTimeoutError:Bo.transitional(Bo.boolean)},!1),i!=null&&(st.isFunction(i)?e.paramsSerializer={serialize:i}:ZR.assertOptions(i,{encode:Bo.function,serialize:Bo.function},!0)),ZR.assertOptions(e,{baseUrl:Bo.spelling("baseURL"),withXsrfToken:Bo.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=r&&st.merge(r.common,r[e.method]);r&&st.forEach(["delete","get","head","post","put","patch","common"],g=>{delete r[g]}),e.headers=Hs.concat(s,r);const c=[];let l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(l=l&&g.synchronous,c.unshift(g.fulfilled,g.rejected))});const u=[];let h;this.interceptors.response.forEach(function(g){u.push(g.fulfilled,g.rejected)});let p,_=0;if(!l){const g=[PD.bind(this),void 0];for(g.unshift.apply(g,c),g.push.apply(g,u),p=g.length,h=at.resolve(e);_<p;)h=h.then(g[_++],g[_++]);return h}p=c.length;let E=e;for(_=0;_<p;){const g=c[_++],C=c[_++];try{E=g(E)}catch(v){C.call(this,v);break}}try{h=PD.call(this,E)}catch(g){return at.reject(g)}for(_=0,p=u.length;_<p;)h=h.then(u[_++],u[_++]);return h}getUri(t){return Bw(SD((t=ju(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};st.forEach(["delete","get","head","options"],function(t){$R.prototype[t]=function(e,n){return this.request(ju(n||{},{method:t,url:e,data:(n||{}).data}))}}),st.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,s){return this.request(ju(s||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}$R.prototype[t]=e(),$R.prototype[t+"Form"]=e(!0)});var tv=$R;class ub{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new at(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const c=new at(l=>{i.subscribe(l),s=l}).then(r);return c.cancel=function(){i.unsubscribe(s)},c},e(function(r,s,c){i.reason||(i.reason=new Tf(r,s,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new ub(function(i){e=i}),cancel:e}}}var Mj=ub;const hb={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hb).forEach(t=>{let[e,n]=t;hb[n]=e});var Uj=hb;const wi=function t(e){const n=new tv(e),i=Rw(tv.prototype.request,n);return st.extend(i,tv.prototype,n,{allOwnKeys:!0}),st.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(ju(e,r))},i}(eb);wi.Axios=tv,wi.CanceledError=Tf,wi.CancelToken=Mj,wi.isCancel=_D,wi.VERSION=kD,wi.toFormData=PR,wi.AxiosError=ve,wi.Cancel=wi.CanceledError,wi.all=function(t){return at.all(t)},wi.spread=function(t){return function(e){return t.apply(null,e)}},wi.isAxiosError=function(t){return st.isObject(t)&&t.isAxiosError===!0},wi.mergeConfig=ju,wi.AxiosHeaders=Hs,wi.formToJSON=t=>pD(st.isHTMLForm(t)?new FormData(t):t),wi.getAdapter=LD.getAdapter,wi.HttpStatusCode=Uj,wi.default=wi;var nr=wi;const xj=()=>{};function Bm(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:xj};return t.promise=new at((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const ev=new Map,nv=new Map,Fo=new Map;let Bn=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),ce=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const UD=new tB;let Ws=UD.getResult(),pb=null;function ne(t){if(!pb){Ws=UD.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return ce.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ce.CHROME;case"Safari":case"Mobile Safari":return ce.SAFARI;case"Edge":return ce.EDGE;case"Firefox":return ce.FIREFOX;case"QQ":case"QQBrowser":return ce.QQ;case"Opera":return ce.OPERA;case"WeChat":return ce.WECHAT;default:return l.browser.name||""}}(Ws),n=xD(Ws),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(Ws),r=Ws.os.version,s=xD(Ws,!1),c=Ws.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c};pb={name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c}}return pb}function xD(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function iv(){return ne().os}function VD(){const t=ne();return"".concat(t.os," ").concat(t.osVersion)}function rv(){const t=ne();return!!(Ws.engine.name==="WebKit"&&t.os===Bn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==ce.SAFARI||Hi()&&t.name!==ce.SAFARI)}function Vc(){return ne().name===ce.CHROME}function hi(){return ne().name===ce.SAFARI}function BD(){return ne().name===ce.EDGE}function Ze(){return ne().name===ce.FIREFOX}function Hi(){return ne().os===Bn.IOS}function Fm(t){const e=ne();return!(e.name!==ce.CHROME||!e.osVersion)&&Number(e.version)>=t}function FD(t){const e=ne();return!(e.name!==ce.CHROME||!e.osVersion)&&Number(e.version)<t}function fb(t,e,n){const i=ne();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function _b(t){const e=ne();return!(e.name!==ce.EDGE||!e.osVersion)&&Number(e.version)>=t}function jD(t){const e=ne();return!(e.name!==ce.SAFARI||!e.osVersion)&&Number(e.version)>=t}function GD(t,e,n){const i=ne();if(i.os!==Bn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function HD(t,e,n){const i=ne();if(i.name!==ce.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function Eb(t){const e=ne();return!(e.name!==ce.OPERA||!e.osVersion)&&Number(e.version)>=t}function WD(){const t=ne();if(t.os!==Bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Rf(){const t=ne();if(t.os!==Bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function mb(){const t=ne();if(t.os!==Bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function KD(){const t=ne();if(t.os!==Bn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function is(){return hi()&&navigator.maxTouchPoints>0}function YD(){return ne().name===ce.WECHAT}function zD(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function gb(){const t=iv();return function(){const{deviceType:e}=ne();return e==="mobile"||e==="tablet"}()||t===Bn.ANDROID||t===Bn.IOS||t===Bn.HARMONY_OS}function Bc(){const t=ne();return t.name!==ce.EDGE&&t.name!==ce.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function av(){return iv()===Bn.ANDROID}function jm(){const t=ne();return av()&&(t.name===ce.CHROME||t.name===ce.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function qD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qD(Object(n),!0).forEach(function(i){wt(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qD(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function wt(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var u=l.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let O=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),G=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),wt(this,"code",void 0),wt(this,"message",void 0),wt(this,"data",void 0),wt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Fc(t,e){if(typeof t!="boolean")throw new G(O.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Un(t,e,n){if(!it(n).call(n,t))throw new G(O.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function ye(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new G(O.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function Sb(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new G(O.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&ye(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&ye(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&ye(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&ye(t.ideal,"".concat(e,".ideal"),1,1/0)}else ye(t,e,1,1/0)}function ei(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new G(O.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!XD(t,n,i,r))throw new G(O.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function jc(t,e){if(!Array.isArray(t))throw new G(O.INVALID_PARAMS,"".concat(e," should be an array"))}function $e(t){return t==null}function XD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let s=0;s<r.length;s+=1){const c=r.charCodeAt(s);if(c<0||c>255)return!1}return!0}(t))}var Gm=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Gm||{}),Tb=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(Tb||{});const JD=new class{constructor(){wt(this,"_clientSize",null),wt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),wt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),wt(this,"getStyle",t=>window.getComputedStyle(t,null)),wt(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:s,opacity:c,filter:l}=i;return(r==="none"||it(e=["hidden","collapse"]).call(e,s)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(u=>{var h;const p=u.split("(")[0];return it(h=["brightness","blur","opacity"]).call(h,p)}).map(u=>{const[h,p]=u.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(u=>{const[h,p]=u;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),wt(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let s=t;for(;s&&i;)r(s)||(n=!1,i=!1),s=s.parentElement,s||(i=!1);return n}),wt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),wt(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:s,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),u=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:s,bottom:c,clientWidth:l,clientHeight:u,clientMin:Math.min(l,u)}}),wt(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),wt(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),wt(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),wt(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,s=e/6,c=[],l=10**6;for(let u=0;u<5;u++)for(let h=0;h<5;h++){const p=(n*l+(u===0?.1:u===4?(r*u*l-1e5)/l:r*u)*l)/l,_=(i*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:p,y:_})}return[...c]}),wt(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),wt(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),wt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:s,clientMin:c}=this._clientSize;let l,u,h,p;if(t<0)l=0;else{if(!(t<s))return!1;l=t}if(e<0)return!1;if(u=e<s?e:s,n<0)h=0;else{if(!(n<r))return!1;h=n}if(i<0)return!1;p=i<r?i:r;const _=u-l,E=p-h;return this.checkSizeIsVisible(_,E,c)}),wt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),wt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Gm.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(Gm.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Gm.SIZE)}}return this.returnHiddenResult(Gm.STYLE)}return this.returnHiddenResult(Tb.UNMOUNTED)}return this.returnHiddenResult(Tb.INVALID_HTML_ELEMENT)}),wt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function Rb(t){return new TextEncoder().encode(t)}const QD=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},vb=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",Rb(t)),16);let Je=class{constructor(){wt(this,"_events",{}),wt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(s=>s);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let s=0;s<e.length;s+=1){const c=e[s];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(t," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},Hm=null;function ZD(){if(Hm)return Hm;if(window.electron)return Hm=window.electron;if(!window.require)return null;try{return Hm=window.require("electron"),Hm}catch{return null}}let bn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),tn=function(t){return t.TRACER="tracer",t}({});function $D(t){return ye(t.timeout,"config.timeout",0,1e5),ye(t.timeoutFactor,"config.timeoutFactor",0,100,!1),ye(t.maxRetryCount,"config.maxRetryConfig",0,1/0),ye(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Vj=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),he=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Wm(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function tL(t){return ei(t.turnServerURL,"turnServerURL"),ei(t.username,"username"),ei(t.password,"password"),t.udpport&&ye(t.udpport,"udpport",1,99999,!0),t.forceturn&&Fc(t.forceturn,"forceturn"),t.security&&Fc(t.security,"security"),t.tcpport&&ye(t.tcpport,"tcpport",1,99999,!0),!0}function yb(t){return t.level!==void 0&&Un(t.level,"level",[1,2,3]),t.delay!==void 0&&ye(t.delay,"delay",0,3e3,!0),!0}let Wt=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),pi=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),jr=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),vf=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function fi(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?at.reject(new G(O.UNEXPECTED_ERROR,"can not emit promise")):new at((s,c)=>{t.emit(e,...i,s,c)})}function Ne(t,e){if(t.getListeners(e).length===0)return at.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return fi(t,e,...i)}function Zr(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return Km(t,e,...i)}function Km(t,e){let n=null,i=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];if(t.emit(e,...s,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new G(O.UNEXPECTED_ERROR,"handler is not sync");return n}const Rn=new class extends Je{set networkState(t){this.emit(vf.NETWORK_STATE_CHANGE,t,this._networkState),t===jr.ONLINE?this.emit(vf.ONLINE):t===jr.OFFLINE&&(this.onlineWaiter=new at(e=>{this.once(vf.ONLINE,()=>{this.onlineWaiter=void 0,e(jr.ONLINE)})}),this.emit(vf.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===jr.ONLINE}constructor(){super(),wt(this,"_moduleName","network-indicator"),wt(this,"_networkState",jr.ONLINE),wt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=jr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=jr.OFFLINE})}};function sv(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function yf(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function ov(t){at!==void 0?at.resolve().then(t):setTimeout(t,0)}function en(t){return JSON.parse(JSON.stringify(t))}function Gu(t){try{return en(t)}catch{return t}}const eL={};function nd(t,e){eL[e]||(eL[e]=!0,t())}function Hu(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function id(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function nL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function iL(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=ji(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let s=0;return e.forEach(c=>{r.set(c,s),s+=c.length}),r}function jo(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function rL(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?jo(n):n.size}),e+138}function Bj(t){const e=new G(O.TIMEOUT,"timeout");return new at((n,i)=>{window.setTimeout(()=>i(e),t)})}function ni(t){return new at(e=>{window.setTimeout(e,t)})}function De(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+De(t-n.length,"")}function Wu(){return De(32,"").toUpperCase()}const cv=()=>{},aL=new class{constructor(){wt(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,s=new Array(r>4?r-4:0),c=4;c<r;c++)s[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const u=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:u,args:s,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,ut(ut({},l),{},{fn:t,args:s,skipFn:i}))}else{const l=window.setTimeout(()=>{const u=this.fnMap.get(e);u&&u.fn(...u.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:s,skipFn:i})}}},sL=aL.throttleByKey.bind(aL);function oL(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function Cb(t,e){if(!oL(t)||!oL(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=Cb(t[i],e[i]);return n}{const n=ut({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=Cb(t[i],e[i]):n[i]=e[i]);return n}}function cL(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function Ab(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function lL(t){const e="0123456789abcdef";function n(L){let U,x="";for(U=0;U<=3;U++)x+=e.charAt(L>>8*U+4&15)+e.charAt(L>>8*U&15);return x}function i(L,U){const x=(65535&L)+(65535&U);return(L>>16)+(U>>16)+(x>>16)<<16|65535&x}function r(L,U,x,M,j,X){return i(function(ct,dt){return ct<<dt|ct>>>32-dt}(i(i(U,L),i(M,X)),j),x)}function s(L,U,x,M,j,X,ct){return r(U&x|~U&M,L,U,j,X,ct)}function c(L,U,x,M,j,X,ct){return r(U&M|x&~M,L,U,j,X,ct)}function l(L,U,x,M,j,X,ct){return r(U^x^M,L,U,j,X,ct)}function u(L,U,x,M,j,X,ct){return r(x^(U|~M),L,U,j,X,ct)}const h=function(L){let U;const x=1+(L.length+8>>6),M=new Array(16*x);for(U=0;U<16*x;U++)M[U]=0;for(U=0;U<L.length;U++)M[U>>2]|=L.charCodeAt(U)<<U%4*8;return M[U>>2]|=128<<U%4*8,M[16*x-2]=8*L.length,M}(t);let p,_,E,g,C,v=1732584193,y=-271733879,b=-1732584194,I=271733878;for(p=0;p<h.length;p+=16)_=v,E=y,g=b,C=I,v=s(v,y,b,I,h[p+0],7,-680876936),I=s(I,v,y,b,h[p+1],12,-389564586),b=s(b,I,v,y,h[p+2],17,606105819),y=s(y,b,I,v,h[p+3],22,-1044525330),v=s(v,y,b,I,h[p+4],7,-176418897),I=s(I,v,y,b,h[p+5],12,1200080426),b=s(b,I,v,y,h[p+6],17,-1473231341),y=s(y,b,I,v,h[p+7],22,-45705983),v=s(v,y,b,I,h[p+8],7,1770035416),I=s(I,v,y,b,h[p+9],12,-1958414417),b=s(b,I,v,y,h[p+10],17,-42063),y=s(y,b,I,v,h[p+11],22,-1990404162),v=s(v,y,b,I,h[p+12],7,1804603682),I=s(I,v,y,b,h[p+13],12,-40341101),b=s(b,I,v,y,h[p+14],17,-1502002290),y=s(y,b,I,v,h[p+15],22,1236535329),v=c(v,y,b,I,h[p+1],5,-165796510),I=c(I,v,y,b,h[p+6],9,-1069501632),b=c(b,I,v,y,h[p+11],14,643717713),y=c(y,b,I,v,h[p+0],20,-373897302),v=c(v,y,b,I,h[p+5],5,-701558691),I=c(I,v,y,b,h[p+10],9,38016083),b=c(b,I,v,y,h[p+15],14,-660478335),y=c(y,b,I,v,h[p+4],20,-405537848),v=c(v,y,b,I,h[p+9],5,568446438),I=c(I,v,y,b,h[p+14],9,-1019803690),b=c(b,I,v,y,h[p+3],14,-187363961),y=c(y,b,I,v,h[p+8],20,1163531501),v=c(v,y,b,I,h[p+13],5,-1444681467),I=c(I,v,y,b,h[p+2],9,-51403784),b=c(b,I,v,y,h[p+7],14,1735328473),y=c(y,b,I,v,h[p+12],20,-1926607734),v=l(v,y,b,I,h[p+5],4,-378558),I=l(I,v,y,b,h[p+8],11,-2022574463),b=l(b,I,v,y,h[p+11],16,1839030562),y=l(y,b,I,v,h[p+14],23,-35309556),v=l(v,y,b,I,h[p+1],4,-1530992060),I=l(I,v,y,b,h[p+4],11,1272893353),b=l(b,I,v,y,h[p+7],16,-155497632),y=l(y,b,I,v,h[p+10],23,-1094730640),v=l(v,y,b,I,h[p+13],4,681279174),I=l(I,v,y,b,h[p+0],11,-358537222),b=l(b,I,v,y,h[p+3],16,-722521979),y=l(y,b,I,v,h[p+6],23,76029189),v=l(v,y,b,I,h[p+9],4,-640364487),I=l(I,v,y,b,h[p+12],11,-421815835),b=l(b,I,v,y,h[p+15],16,530742520),y=l(y,b,I,v,h[p+2],23,-995338651),v=u(v,y,b,I,h[p+0],6,-198630844),I=u(I,v,y,b,h[p+7],10,1126891415),b=u(b,I,v,y,h[p+14],15,-1416354905),y=u(y,b,I,v,h[p+5],21,-57434055),v=u(v,y,b,I,h[p+12],6,1700485571),I=u(I,v,y,b,h[p+3],10,-1894986606),b=u(b,I,v,y,h[p+10],15,-1051523),y=u(y,b,I,v,h[p+1],21,-2054922799),v=u(v,y,b,I,h[p+8],6,1873313359),I=u(I,v,y,b,h[p+15],10,-30611744),b=u(b,I,v,y,h[p+6],15,-1560198380),y=u(y,b,I,v,h[p+13],21,1309151649),v=u(v,y,b,I,h[p+4],6,-145523070),I=u(I,v,y,b,h[p+11],10,-1120210379),b=u(b,I,v,y,h[p+2],15,718787259),y=u(y,b,I,v,h[p+9],21,-343485551),v=i(v,_),y=i(y,E),b=i(b,g),I=i(I,C);return n(v)+n(y)+n(b)+n(I)}let Fj=1,dL=console,vi=class{static setLogger(t){dL=t}constructor(t,e){wt(this,"id",void 0),wt(this,"lockingPromise",at.resolve()),wt(this,"locks",0),wt(this,"name",""),wt(this,"lockId",void 0),this.lockId=Fj++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");dL.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new at(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Cf(t,e){return function(n,i,r){const s=r.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var u=arguments.length,h=new Array(u),p=0;p<u;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{l()}},r}}const In={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function bb(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function Ks(t,e,n,i){const r=Object.assign({},In,i);let s=r.timeout;const c=async()=>{await function(h){return new at(p=>{window.setTimeout(p,h)})}(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)};let l=!1;const u=new at(async(h,p)=>{e=e||(()=>!1),n=n||(()=>!0);for(let _=0;_<r.maxRetryCount;_+=1){if(l)return p(new G(O.OPERATION_ABORTED));try{const E=await t();if(!e(E,_)||_+1===r.maxRetryCount)return h(E);await c()}catch(E){if(!n(E,_)||_+1===r.maxRetryCount)return p(E);await c()}}});return u.cancel=()=>l=!0,u}let lv,uL=class{constructor(t){wt(this,"input",[]),wt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:ji(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},dv=0,Ib=0;function Ob(t,e,n,i){return new at((r,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),dv+=jo(e.data)):n&&(e.data.size?dv+=e.data.size:e.data instanceof FormData?dv+=rL(e.data):dv+=jo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,nr.request(e).then(c=>{typeof c.data=="string"?Ib+=jo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Ib+=c.data.byteLength:Ib+=jo(JSON.stringify(c.data)),r(c.data)}).catch(c=>{nr.isCancel(c)?s(new G(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new G(O.NETWORK_TIMEOUT,c.message)):c.response?s(new G(O.NETWORK_RESPONSE_ERROR,c.response.status)):s(new G(O.NETWORK_ERROR,c.message))})})}async function jj(t,e){const n=new Blob([e.data],{type:"buffer"});return await Ob(t,ut(ut({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const hL=()=>window.isSecureContext!==void 0;function rs(t){if(Array.isArray(t))return t.map(n=>n);if(!pL(t))return t;const e={};for(const n in t){const i=t[n];pL(i)||Array.isArray(i)?e[n]=rs(i):e[n]=i}return e}function pL(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let wb=class{constructor(t){wt(this,"input",[]),wt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Go={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ym={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Go,remoteCandidate:Go},updateInterval:0},fL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},_L={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},EL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},mL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let Nb=class{constructor(t,e){wt(this,"onFirstVideoReceived",void 0),wt(this,"onFirstVideoDecoded",void 0),wt(this,"onFirstAudioReceived",void 0),wt(this,"onFirstVideoDecodedTimeout",void 0),wt(this,"onFirstAudioDecoded",void 0),wt(this,"onSelectedLocalCandidateChanged",void 0),wt(this,"onSelectedRemoteCandidateChanged",void 0),wt(this,"videoIsReady",!1),wt(this,"videoIsReady2",{}),wt(this,"pc",void 0),wt(this,"options",void 0),wt(this,"intervalTimer",void 0),wt(this,"stats",rs(Ym)),wt(this,"isFirstVideoReceived",{}),wt(this,"isFirstVideoDecoded",{}),wt(this,"isFirstAudioReceived",{}),wt(this,"isFirstAudioDecoded",{}),wt(this,"isFirstVideoDecodedTimeout",{}),wt(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new at(t=>{t({local:ut({},Go),remote:ut({},Go)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,s=0,c=0;for(const l of n)t[l].forEach((u,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const p=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,_=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(i+=p,s+=_):(r+=p,c+=_),Number.isNaN(p)||Number.isNaN(p)?u.packetLostRate=0:u.packetLostRate=p<=0||_<=0?0:_/(p+_)});t.sendPacketLossRate=i<=0||s<=0?0:s/(i+s),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},Gj=class extends Nb{constructor(){super(...arguments),wt(this,"_stats",Ym),wt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=rs(Ym);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=it(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=rs(_L);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=rs(fL),s=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),s){const c=s.stats,l=Date.now()-s.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<s.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:ut({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=rs(mL);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=rs(EL);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new at((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},zm=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),uv=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),Db=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),$r=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Af=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Af||{});function qm(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Af.kNone;if(!e)return;const s=Number(e[n]);if(typeof s!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?s/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const u=Number(t[i]);if(typeof u!="number")return;const h=c-u;return h?(s-l)/h*r:void 0}let gL=class extends Nb{constructor(){super(...arguments),wt(this,"_stats",Ym),wt(this,"report",void 0),wt(this,"lastDecodeVideoReceiverStats",new Map),wt(this,"lastVideoFramesRecv",new Map),wt(this,"lastVideoFramesSent",new Map),wt(this,"lastVideoFramesDecode",new Map),wt(this,"lastVideoFramesOutput",new Map),wt(this,"lastVideoJBDelay",new Map),wt(this,"lastAudioJBDelay",new Map),wt(this,"mediaBytesSent",new Map),wt(this,"mediaBytesRetransmit",new Map),wt(this,"mediaBytesTargetEncode",new Map),wt(this,"lastDecodeAudioReceiverStats",new Map),wt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=rs(Ym),this.report.forEach(t=>{switch(t.type){case $r.OUTBOUND:case $r.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===$r.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===$r.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case $r.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case $r.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:ut({},Go),remote:ut({},Go)};return t.forEach(n=>{let i;if(n.type===$r.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===$r.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const s=t.get(i.localCandidateId);s&&r(e.local,s)}if(i.remoteCandidateId){const s=t.get(i.remoteCandidateId);s&&r(e.remote,s)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===$r.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===$r.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===$r.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ut({},e),ut({},this.stats.selectedCandidatePair.localCandidate)),t.type===$r.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ut({},e),ut({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=rs(mL),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=qm(n,e,"totalProcessingDelay","jitterBufferEmittedCount",Af.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,ut({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=rs(fL),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),s=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=s-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=qm(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=qm(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",Af.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=qm(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",Af.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=qm(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",Af.kMillisecondsFromSeconds),i&&s-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&s-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:ut({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=rs(_L),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new wb(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new wb(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new wb(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,s=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*s/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,$r.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=rs(EL),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,$r.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(Tr(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,u=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof u!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,p=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:t.frameHeight,_=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),_==null){const E=Date.now(),g=this.lastVideoFramesSent.get(n.ssrc);g&&E-g.lts>=800?(_=Math.round((u-g.count)/((E-g.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:u,lts:E,rate:_})):g?_=g.rate:this.lastVideoFramesSent.set(n.ssrc,{count:u,lts:E,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(t,e,n){var i,r,s,c,l;const u=e?this.report.get(e):void 0,h=(i=u==null?void 0:u.framesReceived)!==null&&i!==void 0?i:t.framesReceived,p=(r=u==null?void 0:u.frameWidth)!==null&&r!==void 0?r:t.frameWidth,_=(s=u==null?void 0:u.frameHeight)!==null&&s!==void 0?s:t.frameHeight,E=(c=u==null?void 0:u.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,g=(l=u==null?void 0:u.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const C=this.lastVideoFramesRecv.get(n.ssrc),v=Date.now();n.framesReceivedCount=h;let y=0;C&&v-C.lts>=800?(y=Math.round((h-C.count)/((v-C.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:v,rate:y})):C?y=C.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:v,rate:0}),n.receivedFrame={width:p||0,height:_||0,frameRate:y||0},n.decodedFrame={width:p||0,height:_||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:_||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(E&&g){const C=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let v=C.jitterBufferMs;const y=g-C.jitterBufferEmittedCount;y>0&&(v=1e3*(E-C.jitterBufferDelay)/y),n.jitterBufferMs=v,n.currentDelayMs=Math.round(v),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:E,jitterBufferEmittedCount:g,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,u=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,h=(s=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=u,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,n){var i,r,s,c,l,u,h;const p=e?this.report.get(e):void 0,_=(i=p==null?void 0:p.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,E=(r=p==null?void 0:p.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,g=(s=p==null?void 0:p.jitterBufferDelay)!==null&&s!==void 0?s:t.jitterBufferDelay,C=(c=p==null?void 0:p.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,v=(l=p==null?void 0:p.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,y=(u=p==null?void 0:p.totalSamplesDuration)!==null&&u!==void 0?u:t==null?void 0:t.totalSamplesDuration,b=(h=p==null?void 0:p.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples;if(typeof E=="number"&&(n.totalSamplesReceived=E),_&&E&&(n.accelerateRate=_/E),g&&C){const L=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=L.jitterBufferMs;const x=C-L.jitterBufferEmittedCount;x>0&&(U=1e3*(g-L.jitterBufferDelay)/x),n.jitterBufferMs=Math.round(U),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:C,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=v;let I=1920;y&&E&&(I=E/y/50,n.receivedFrames=Math.round(E/I)),b&&(n.droppedFrames=Math.round(b/I))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},Hj=class extends Nb{updateStats(){return at.resolve()}};function Lb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return s?s<76?new Gj(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new gL(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof at||function(u){return!!u&&(typeof u=="object"||typeof u=="function")&&typeof u.then=="function"}(l))}(t)?new gL(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new Hj(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const SL="websdk_ng_install_id";function Pb(){try{if(N("INSTALL_ID"))return N("INSTALL_ID");let t=window.localStorage.getItem(SL);return t||(t=Wu(),window.localStorage.setItem(SL,t)),ge("INSTALL_ID",t),t}catch{return}}const Ia=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.2"),kb=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Ku=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const _i=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const s=r.join(""),c={};return c[t]=i,c[e]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=_i;const hv={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},Mb={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Ub="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",xb={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Be=ut(ut(ut({},xb),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Mb,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},hv),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function ge(t,e,n){var i,r,s;it(i=Object.keys(Be)).call(i,t)&&(!n&&it(r=Object.keys(Ys)).call(r,t)||(Be[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||e!==!0||(Be.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(Be.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,Be.USE_NEW_NETWORK_CONFIG=s,s&&(Be.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Be.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Be.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Be.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Be.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Be.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Be.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(Be.ENABLE_INSTANT_VIDEO=!0,Be.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(Be.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(Be.NEW_TURN_MODE||(Be.NEW_TURN_MODE=4))))}function N(t){return Be[t]}kb||(Be.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Be.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Be.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Be.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Be.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Be.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Be.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Be.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Be.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Be.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Be.AREAS=["NORTH_AMERICA","OVERSEA"]);let TL=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Ys={};var Kt=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Kt||{});let pv=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const RL=128,Wj=96,vL=1e3,bf=10;let Kj=0;var yL=(()=>{var t={8:(i,r,s)=>{s.r(r),s.d(r,{Parser:()=>ct,Printer:()=>En,parse:()=>nt,print:()=>mt});const c=`
`,l="".concat("\r").concat(c),u=" ";let h;function p(z){return z>="0"&&z<="9"}function _(z){return z>="!"&&z<="~"}function E(z){return _(z)||z>=""&&z<=""}function g(z){return z==="!"||z>="#"&&z<="'"||z>="*"&&z<="+"||z>="-"&&z<="."||z>="0"&&z<="9"||z>="A"&&z<="Z"||z>="^"&&z<="~"}function C(z){return z>="1"&&z<="9"}function v(z){return z>="A"&&z<="Z"||z>="a"&&z<="z"}function y(z){return z==="d"||z==="h"||z==="m"||z==="s"}function b(z){return z>""&&z<"	"||z>"\v"&&z<"\f"||z>""&&z<""}function I(z){return v(z)||p(z)||z==="+"||z==="/"}function L(z){return p(z)||v(z)||z==="+"||z==="/"||z==="-"||z==="_"}function U(z){return v(z)||p(z)||z==="+"||z==="/"}function x(z,R){var D=Object.keys(z);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(z);R&&(k=k.filter(function(Z){return Object.getOwnPropertyDescriptor(z,Z).enumerable})),D.push.apply(D,k)}return D}function M(z){for(var R=1;R<arguments.length;R++){var D=arguments[R]!=null?arguments[R]:{};R%2?x(Object(D),!0).forEach(function(k){j(z,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(D)):x(Object(D)).forEach(function(k){Object.defineProperty(z,k,Object.getOwnPropertyDescriptor(D,k))})}return z}function j(z,R,D){return R in z?Object.defineProperty(z,R,{value:D,enumerable:!0,configurable:!0,writable:!0}):z[R]=D,z}(function(z){z.VERSION="v",z.ORIGIN="o",z.SESSION_NAME="s",z.INFORMATION="i",z.URI="u",z.EMAIL="e",z.PHONE="p",z.CONNECTION="c",z.BANDWIDTH="b",z.TIME="t",z.REPEAT="r",z.ZONE_ADJUSTMENTS="z",z.KEY="k",z.ATTRIBUTE="a",z.MEDIA="m"})(h||(h={}));class X{consumeText(R,D){let k=D;for(;k<R.length;){const Z=R[k];if(Z==="\0"||Z==="\r"||Z===c)break;k+=1}if(k-D==0)throw new Error("Invalid text, at ".concat(R));return k}consumeUnicastAddress(R,D,k){return this.consumeTill(R,D,u)}consumeOneOrMore(R,D,k){let Z=D;for(;k(R[Z]);)Z++;if(Z-D==0)throw new Error("Invalid rule at ".concat(D,"."));return Z}consumeSpace(R,D){if(R[D]===u)return D+1;throw new Error("Invalid space at ".concat(D,"."))}consumeIP4Address(R,D){let k=D;for(let Z=0;Z<4;Z++)if(k=this.consumeDecimalUChar(R,k),Z!==3){if(R[k]!==".")throw new Error("Invalid IP4 address.");k++}return k}consumeDecimalUChar(R,D){let k=D;for(let Dt=0;Dt<3&&p(R[k]);Dt++,k++);if(k-D==0)throw new Error("Invalid decimal uchar.");const Z=parseInt(R.slice(D,k));if(Z>=0&&Z<=255)return k;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,D){let k=this.consumeHexpart(R,D);return R[k]===":"&&(k+=1,k=this.consumeIP4Address(R,k)),k}consumeHexpart(R,D){let k=D;if(R[k]===":"&&R[k+1]===":"){k+=2;try{k=this.consumeHexseq(R,k)}catch{}return k}if(k=this.consumeHexseq(R,k),R[k]===":"&&R[k+1]===":"){k+=2;try{k=this.consumeHexseq(R,k)}catch{}return k}return k}consumeHexseq(R,D){let k=D;for(;k=this.consumeHex4(R,k),R[k]===":"&&R[k+1]!==":";)k+=1;return k}consumeHex4(R,D){let k=0;for(;k<4;k++)if(!((Z=R[D+k])>="0"&&Z<="9"||Z>="a"&&Z<="f"||Z>="A"&&Z<="F")){if(k===0)throw new Error("Invalid hex 4");break}var Z;return D+k}consumeFQDN(R,D){let k=D;for(;p(R[k])||v(R[k])||R[k]==="-"||R[k]===".";)k+=1;if(k-D<4)throw new Error("Invalid FQDN");return k}consumeExtnAddr(R,D){return this.consumeOneOrMore(R,D,E)}consumeMulticastAddress(R,D,k){switch(k){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,D);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,D);default:try{return this.consumeFQDN(R,D)}catch{return this.consumeExtnAddr(R,D)}}}consumeIP6MulticastAddress(R,D){const k=this.consumeHexpart(R,D);return R[k]==="/"?this.consumeInteger(R,k+1):k}consumeIP4MulticastAddress(R,D){let k=D+3;const Z=R.slice(D,k),Dt=parseInt(Z);if(Dt<224||Dt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ce=0;Ce<3;Ce++){if(R[k]!==".")throw new Error("Invalid IP4 multicast address.");k+=1,k=this.consumeDecimalUChar(R,k)}return R[k]==="/"&&(k+=1),k=this.consumeTTL(R,k),R[k]==="/"&&(k=this.consumeInteger(R,k)),k}consumeInteger(R,D){if(!C(R[D]))throw new Error("Invalid integer.");for(D+=1;p(R[D]);)D+=1;return D}consumeTTL(R,D){if(R[D]==="0")return D+1;if(!C(R[D]))throw new Error("Invalid TTL.");D+=1;for(let k=0;k<2&&p(R[D]);k++)D+=1;return D}consumeToken(R,D){return this.consumeOneOrMore(R,D,g)}consumeTime(R,D){let k=D;if(R[k]==="0")return k+1;for(C(R[k])&&(k+=1);p(R[k]);)k++;if(k-D<10)throw new Error("Invalid time");return k}consumeAddress(R,D){return this.consumeTill(R,D,u)}consumeTypedTime(R,D){let k=D;return k=this.consumeOneOrMore(R,k,p),y(R[k])?k+1:k}consumeRepeatInterval(R,D){if(!C(R[D]))throw new Error("Invalid repeat interval");for(D+=1;p(R[D]);)D+=1;return y(R[D])&&(D+=1),D}consumePort(R,D){return this.consumeOneOrMore(R,D,p)}consume(R,D,k){for(let Z=0;Z<k.length;Z++){if(D+Z>=R.length)throw new Error("consume exceeding value length");if(R[D+Z]!==k[Z])throw new Error("consume ".concat(k," failed at ").concat(Z))}return D+k.length}consumeTill(R,D,k){let Z=D;for(;Z<R.length&&(typeof k!="string"||R[Z]!==k)&&(typeof k!="function"||!k(R[Z]));)Z++;return Z}}class ct extends X{constructor(){super(),j(this,"records",[]),j(this,"currentLine",0)}parse(R){const D=this.probeEOL(R);this.records=R.split(D).filter(_h=>!!Ui(_h).call(_h)).map(this.parseLine),this.currentLine=0;const k=this.parseVersion(),Z=this.parseOrigin(),Dt=this.parseSessionName(),Ce=this.parseInformation(),Gn=this.parseUri(),Ir=this.parseEmail(),$c=this.parsePhone(),fh=this.parseConnection(),Dg=this.parseBandWidth(),Cy=this.parseTimeFields(),Ay=this.parseKey(),Ma=this.parseSessionAttribute(),Rd=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:k,origin:Z,sessionName:Dt,information:Ce,uri:Gn,emails:Ir,phones:$c,connection:fh,bandwidths:Dg,timeFields:Cy,key:Ay,attributes:Ma,mediaDescriptions:Rd}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let D=0;D<R.length;D++)if(R[D]===c)return R[D-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(R,D){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const k=R[0];if(R[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:k,value:R.slice(2),line:D,cur:0}}parseSessionAttribute(){const R=new zt;for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==h.ATTRIBUTE)break;const k={attField:this.extractOneOrMore(D,Z=>g(Z)&&Z!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,k.attValue=this.extractOneOrMore(D,b)),R.parse(k),this.currentLine++}return R.digest()}parseMediaAttributes(R){const D=new qt(R);for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==h.ATTRIBUTE)break;const Z={attField:this.extractOneOrMore(k,Dt=>g(Dt)&&Dt!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,Z.attValue=this.extractOneOrMore(k,b)),D.parse(Z),this.currentLine++}return D.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===h.KEY){if(R.value==="prompt"||R.value==="clear:"||R.value==="base64:"||R.value==="uri:")return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===h.ZONE_ADJUSTMENTS){const D=[];for(;;)try{const k=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let Z=!1;R.value[R.cur]==="-"&&(Z=!0,R.cur+=1);const Dt=this.extract(R,this.consumeTypedTime);D.push({time:k,typedTime:Dt,back:Z})}catch{break}if(D.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,D}return[]}parseRepeat(){const R=[];for(;;){const D=this.getCurrentRecord();if(D.type!==h.REPEAT)break;{const k=this.extract(D,this.consumeRepeatInterval),Z=this.parseTypedTime(D);R.push({repeatInterval:k,typedTimes:Z}),this.currentLine++}}return R}parseTypedTime(R){const D=[];for(;;)try{this.consumeSpaceForRecord(R),D.push(this.extract(R,this.consumeTypedTime))}catch{break}if(D.length===0)throw new Error("Invalid typed time.");return D}parseTime(){const R=this.getCurrentRecord(),D=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const k=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:D,stopTime:k}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==h.BANDWIDTH)break;{const k=this.extractOneOrMore(D,g);if(D.value[D.cur]!==":")throw new Error("Invalid bandwidth field.");D.cur++;const Z=this.extractOneOrMore(D,p);R.push({bwtype:k,bandwidth:Z}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==h.VERSION)throw new Error("first sdp record must be version");const D=R.value.slice(0,this.consumeOneOrMore(R.value,0,p));if(D.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,D}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const D=this.extractOneOrMore(R,E);this.consumeSpaceForRecord(R);const k=this.extractOneOrMore(R,p);this.consumeSpaceForRecord(R);const Z=this.extractOneOrMore(R,p);this.consumeSpaceForRecord(R);const Dt=this.extractOneOrMore(R,g);this.consumeSpaceForRecord(R);const Ce=this.extractOneOrMore(R,g);this.consumeSpaceForRecord(R);const Gn=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:D,sessId:k,sessVersion:Z,nettype:Dt,addrtype:Ce,unicastAddress:Gn}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===h.SESSION_NAME){const D=this.extract(R,this.consumeText);return this.currentLine++,D}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==h.INFORMATION)return;const D=this.extract(R,this.consumeText);return this.currentLine++,D}parseUri(){const R=this.getCurrentRecord();if(R.type===h.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const D=this.getCurrentRecord();if(D.type!==h.EMAIL)break;R.push(D.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const D=this.getCurrentRecord();if(D.type!==h.PHONE)break;R.push(D.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===h.CONNECTION){const D=this.extractOneOrMore(R,g);this.consumeSpaceForRecord(R);const k=this.extractOneOrMore(R,g);this.consumeSpaceForRecord(R);const Z=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:D,addrtype:k,address:Z}}}parseMedia(){const R=this.getCurrentRecord(),D=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let k=this.extract(R,this.consumePort);R.value[R.cur]==="/"&&(R.cur+=1,k+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const Z=[];for(Z.push(this.extract(R,this.consumeToken));R.value[R.cur]==="/";)R.cur+=1,Z.push(this.extract(R,this.consumeToken));if(Z.length===0)throw new Error("Invalid proto");const Dt=this.parseFmt(R);return this.currentLine++,{mediaType:D,port:k,protos:Z,fmts:Dt}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===h.TIME;){const D=this.parseTime(),k=this.parseRepeat(),Z=this.parseZone();R.push({time:D,repeats:k,zones:Z})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const D=this.parseMedia(),k=this.parseInformation(),Z=this.parseConnections(),Dt=this.parseBandWidth(),Ce=this.parseKey(),Gn=this.parseMediaAttributes(D);R.push({media:D,information:k,connections:Z,bandwidths:Dt,key:Ce,attributes:Gn})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const D=[];for(;;)try{this.consumeSpaceForRecord(R),D.push(this.extract(R,this.consumeToken))}catch{break}if(D.length===0)throw new Error("Invalid fmts");return D}extract(R,D){for(var k=arguments.length,Z=new Array(k>2?k-2:0),Dt=2;Dt<k;Dt++)Z[Dt-2]=arguments[Dt];const Ce=D.call(this,R.value,R.cur,...Z),Gn=R.value.slice(R.cur,Ce);return R.cur=Ce,Gn}extractOneOrMore(R,D){const k=this.consumeOneOrMore(R.value,R.cur,D),Z=R.value.slice(R.cur,k);return R.cur=k,Z}consumeSpaceForRecord(R){if(R.value[R.cur]!==u)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class dt extends X{constructor(){super(...arguments),j(this,"attributes",void 0),j(this,"digested",!1)}extractOneOrMore(R,D,k){const Z=this.consumeOneOrMore(R.attValue,R._cur,D),Dt=R.attValue.slice(R._cur,Z),[Ce,Gn]=k||[];if(typeof Ce=="number"&&Dt.length<Ce)throw new Error("error in length, should be more or equal than ".concat(Ce," characters."));if(typeof Gn=="number"&&Dt.length>Gn)throw new Error("error in length, should be less or equal than ".concat(Gn," characters."));return R._cur=Z,Dt}consumeAttributeSpace(R){if(R.attValue[R._cur]!==u)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,D){if(!R.attValue)throw new Error("Nothing to extract from attValue.");for(var k=arguments.length,Z=new Array(k>2?k-2:0),Dt=2;Dt<k;Dt++)Z[Dt-2]=arguments[Dt];const Ce=D.call(this,R.attValue,R._cur,...Z),Gn=R.attValue.slice(R._cur,Ce);return R._cur=Ce,Gn}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,D){if(!R.attValue)throw new Error;for(let k=0;k<D.length;k++)if(D[k]!==R.attValue[R._cur+k])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,I,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,I,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const D=[];for(;!this.atEnd(R);){D.push(this.extractOneOrMore(R,I));try{this.consumeAttributeSpace(R)}catch(k){if(this.atEnd(R))break;throw k}}this.attributes.iceOptions=D}parseFingerprint(R){const D=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const k=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:D,fingerprint:k})}parseExtmap(R){const D=this.extractOneOrMore(R,p);let k;this.peekChar(R)==="/"&&(this.extract(R,this.consume,"/"),k=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const Z=this.extract(R,this.consumeTill,u),Dt=M(M({entry:parseInt(D,10)},k&&{direction:k}),{},{extensionName:Z});this.peekChar(R)===u&&(this.consumeAttributeSpace(R),Dt.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(Dt)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const D=this.extract(R,this.consumeTill);if(D!=="active"&&D!=="passive"&&D!=="actpass"&&D!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=D}}class zt extends dt{constructor(){super(...arguments),j(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(D){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),D}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const D=this.extract(R,this.consumeToken),k=[];for(;!this.atEnd(R)&&this.peekChar(R)===u;)this.consumeAttributeSpace(R),k.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:D,identificationTag:k})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,L)}parseIdentity(R){const D=this.extractOneOrMore(R,U),k=[];for(;!this.atEnd(R)&&this.peekChar(R)===u;){this.consumeAttributeSpace(R);const Z=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const Dt=this.extractOneOrMore(R,Ce=>Ce!==u&&b(Ce));k.push({name:Z,value:Dt})}this.attributes.identities.push({assertionValue:D,extensions:k})}parseMsidSemantic(R){this.peekChar(R)===u&&this.consumeAttributeSpace(R);const D={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if(this.peekChar(R)==="*"){this.extract(R,this.consume,"*"),D.applyForAll=!0;break}{const k=this.extract(R,this.consumeTill,u);D.identifierList.push(k)}}this.attributes.msidSemantic=D}}class qt extends dt{constructor(R){super(),j(this,"attributes",void 0),R.protos.indexOf("RTP")!==-1||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(D){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),D}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const D=this.extractOneOrMore(R,I,[1,32]);this.consumeAttributeSpace(R);const k=this.extractOneOrMore(R,p,[1,5]);this.consumeAttributeSpace(R);const Z=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Dt=this.extractOneOrMore(R,p,[1,10]);this.consumeAttributeSpace(R);const Ce=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Gn=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const Ir={foundation:D,componentId:k,transport:Z,priority:Dt,connectionAddress:Ce,port:Gn,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Ir.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Ir.relPort=this.extract(R,this.consumePort));this.peekChar(R)===u;){this.consumeAttributeSpace(R);const $c=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Ir.extension[$c]=this.extractOneOrMore(R,_)}this.attributes.candidates.push(Ir)}parseRemoteCandidate(R){const D=[];for(;;){const k=this.extractOneOrMore(R,p,[1,5]);this.consumeAttributeSpace(R);const Z=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Dt=this.extract(R,this.consumePort);D.push({componentId:k,connectionAddress:Z,port:Dt});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(D)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const D=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const k=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const Z={encodingName:k,clockRate:this.extractOneOrMore(R,p)};this.atEnd(R)||this.peekChar(R)!=="/"||(this.extract(R,this.consume,"/"),Z.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const Dt=this.attributes.payloads.find(Ce=>Ce.payloadType===parseInt(D,10));Dt?Dt.rtpMap=Z:this.attributes.payloads.push({payloadType:parseInt(D,10),rtpMap:Z,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const D=this.extractOneOrMore(R,p);this.consumeAttributeSpace(R);const k=this.extract(R,this.consumeTill,":");let Z;this.peekChar(R)===":"&&(this.extract(R,this.consume,":"),Z=this.extract(R,this.consumeTill));const Dt=this.attributes.ssrcs.find(Ce=>Ce.ssrcId===parseInt(D,10));Dt?Dt.attributes[k]=Z:this.attributes.ssrcs.push({ssrcId:parseInt(D,10),attributes:{[k]:Z}})}parseFmtp(R){const D=this.extract(R,this.consumeTill,u);this.consumeAttributeSpace(R);const k=this.extract(R,this.consumeTill),Z={};k.split(";").forEach(Ce=>{let[Gn,Ir]=Ce.split("=");Gn=Ui(Gn).call(Gn);const $c=typeof Ir=="string"?Ui(Ir).call(Ir):null;typeof Gn=="string"&&Gn.length>0&&(Z[Gn]=$c)});const Dt=this.attributes.payloads.find(Ce=>Ce.payloadType===parseInt(D,10));Dt?Dt.fmtp={parameters:Z}:this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[],fmtp:{parameters:Z}})}parseFmtParameters(R){const D={},k=this.extract(R,this.consumeTill,"=");R._cur++;const Z=this.extract(R,this.consumeTill,";");for(D[k]=Z;R.attValue[R._cur]===";";){const Dt=this.extract(R,this.consumeTill,"=");R._cur++;const Ce=this.extract(R,this.consumeTill,";");D[Dt]=Ce}return D}parseRtcpFb(R){let D="";D=this.peekChar(R)==="*"?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,u),this.consumeAttributeSpace(R);const k=this.extract(R,this.consumeTill,u);let Z;if(k==="trr-int")Z={type:k,interval:this.extract(R,this.consumeTill)};else{const Dt={type:k};this.peekChar(R)===u&&(this.consumeAttributeSpace(R),Dt.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===u&&(Dt.additional=this.extract(R,this.consumeTill))),Z=Dt}if(D==="*")this.attributes.rtcpFeedbackWildcards.push(Z);else{const Dt=this.attributes.payloads.find(Ce=>Ce.payloadType===parseInt(D,10));Dt?Dt.rtcpFeedbacks.push(Z):this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[Z]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const D={port:this.extract(R,this.consumePort)};this.peekChar(R)===u&&(this.consumeAttributeSpace(R),D.netType=this.extractOneOrMore(R,g),this.consumeAttributeSpace(R),D.addressType=this.extractOneOrMore(R,g),this.consumeAttributeSpace(R),D.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=D}parseMsid(R){const D={id:this.extractOneOrMore(R,g,[1,64])};this.peekChar(R)===u&&(this.consumeAttributeSpace(R),D.appdata=this.extractOneOrMore(R,g,[1,64])),this.attributes.msids.push(D)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const D=this.extractOneOrMore(R,Z=>v(Z)||p(Z)||Z==="_"||Z==="-");this.consumeAttributeSpace(R);const k={id:D,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===u){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const Z=[];for(;;){const Dt=this.extract(R,this.consumeToken);Z.push(Dt);try{this.extract(R,this.consume,",")}catch{break}}k.payloads=Z,this.peekChar(R)===u&&this.extract(R,this.consume,u)}for(;;){const Z=this.extract(R,this.consumeToken);switch(Z){case"depend":{const Dt={type:Z,rids:this.extract(R,this.consume,"=").split(",")};k.params.push(Dt);break}default:{const Dt={type:Z};this.peekChar(R)==="="&&(this.extract(R,this.consume,"="),Dt.val=this.extract(R,this.consumeTill,";")),k.params.push(Dt)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(k)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,p,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const D=this.extract(R,this.consumeToken),k=[];for(;;)try{this.consumeAttributeSpace(R);const Z=this.extract(R,this.consumeInteger);k.push(parseInt(Z,10))}catch{break}this.attributes.ssrcGroups.push({semantic:D,ssrcIds:k})}}function Pe(z,R,D){return R in z?Object.defineProperty(z,R,{value:D,enumerable:!0,configurable:!0,writable:!0}):z[R]=D,z}class En{constructor(){Pe(this,"eol",l)}print(R,D){let k="";return D&&(this.eol=D),k+=this.printVersion(R.version),k+=this.printOrigin(R.origin),k+=this.printSessionName(R.sessionName),k+=this.printInformation(R.information),k+=this.printUri(R.uri),k+=this.printEmail(R.emails),k+=this.printPhone(R.phones),k+=this.printConnection(R.connection),k+=this.printBandwidth(R.bandwidths),k+=this.printTimeFields(R.timeFields),k+=this.printKey(R.key),k+=this.printSessionAttributes(R.attributes),k+=this.printMediaDescription(R.mediaDescriptions),k}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let D="";for(const k of R)D+="e=".concat(k).concat(this.eol);return D}printPhone(R){let D="";for(const k of R)D+="e=".concat(k).concat(this.eol);return D}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let D="";for(const k of R)D+="b=".concat(k.bwtype,":").concat(k.bandwidth).concat(this.eol);return D}printTimeFields(R){let D="";for(const k of R){D+="t=".concat(k.time.startTime," ").concat(k.time.startTime).concat(this.eol);for(const Z of k.repeats)D+="r=".concat(Z.repeatInterval," ").concat(Z.typedTimes.join(" ")).concat(this.eol);k.zoneAdjustments&&(D+="z=",D+="z=".concat(k.zoneAdjustments.map(Z=>"".concat(Z.time," ").concat(Z.back?"-":""," ").concat(Z.typedTime)).join(" ")).concat(this.eol),D+=this.eol)}return D}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let D="";for(const k of R)D+="a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol);return D}printMediaDescription(R){let D="";for(const k of R)D+=this.printMedia(k.media),D+=this.printInformation(k.information),D+=this.printConnections(k.connections),D+=this.printBandwidth(k.bandwidths),D+=this.printKey(k.key),D+=this.printMediaAttributes(k);return D}printConnections(R){let D="";for(const k of R)D+=this.printConnection(k);return D}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new cr(this.eol).print(R)}printMediaAttributes(R){return new K(this.eol).print(R)}}class sn{constructor(R){Pe(this,"eol",void 0),this.eol=R}printIceUfrag(R){return R===void 0?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return R===void 0?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return R===void 0?"":"a=ice-options:".concat(R.join(u)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(D=>"a=fingerprint:".concat(D.hashFunction).concat(u).concat(D.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(D=>"a=extmap:".concat(D.entry).concat(D.direction?"/".concat(D.direction):"").concat(u).concat(D.extensionName).concat(D.extensionAttributes?"".concat(u).concat(D.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return R===void 0?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(D=>"a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol)).join("")}}class cr extends sn{print(R){let D="";return D+=this.printGroups(R.groups),D+=this.printMsidSemantic(R.msidSemantic),D+=this.printIceLite(R.iceLite),D+=this.printIceUfrag(R.iceUfrag),D+=this.printIcePwd(R.icePwd),D+=this.printIceOptions(R.iceOptions),D+=this.printFingerprints(R.fingerprints),D+=this.printSetup(R.setup),D+=this.printTlsId(R.tlsId),D+=this.printIdentity(R.identities),D+=this.printExtmap(R.extmaps),D+=this.printUnrecognized(R.unrecognized),D}printGroups(R){let D="";return R.length>0&&(D+=R.map(k=>"a=group:".concat(k.semantic).concat(k.identificationTag.map(Z=>"".concat(u).concat(Z)).join("")).concat(this.eol)).join("")),D}printIceLite(R){return R===void 0?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return R.length===0?"":R.map(D=>"a=identity:".concat(D.assertionValue).concat(D.extensions.map(k=>"".concat(u).concat(k.name).concat(k.value?"=".concat(k.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let D="a=msid-semantic:".concat(R.semantic);return R.applyForAll?D+="".concat(u,"*"):R.identifierList.length>0&&(D+=R.identifierList.map(k=>"".concat(u).concat(k))),D+this.eol}}class K extends sn{print(R){const D=R.attributes;let k="";return k+=this.printRTCP(D.rtcp),k+=this.printIceUfrag(D.iceUfrag),k+=this.printIcePwd(D.icePwd),k+=this.printIceOptions(D.iceOptions),k+=this.printCandidates(D.candidates),k+=this.printRemoteCandidatesList(D.remoteCandidatesList),k+=this.printEndOfCandidates(D.endOfCandidates),k+=this.printFingerprints(D.fingerprints),k+=this.printSetup(D.setup),k+=this.printMid(D.mid),k+=this.printExtmap(D.extmaps),k+=this.printRTPRelated(D),k+=this.printPtime(D.ptime),k+=this.printMaxPtime(D.maxPtime),k+=this.printDirection(D.direction),k+=this.printSSRCGroups(D.ssrcGroups),k+=this.printSSRC(D.ssrcs),k+=this.printRTCPMux(D.rtcpMux),k+=this.printRTCPMuxOnly(D.rtcpMuxOnly),k+=this.printRTCPRsize(D.rtcpRsize),k+=this.printMSId(D.msids),k+=this.printImageattr(D.imageattr),k+=this.printRid(D.rids),k+=this.printSimulcast(D.simulcast),k+=this.printSCTPPort(D.sctpPort),k+=this.printMaxMessageSize(D.maxMessageSize),k+=this.printUnrecognized(D.unrecognized),k}printCandidates(R){return R.map(D=>"a=candidate:".concat(D.foundation).concat(u).concat(D.componentId).concat(u).concat(D.transport).concat(u).concat(D.priority).concat(u).concat(D.connectionAddress).concat(u).concat(D.port).concat(u,"typ").concat(u).concat(D.type).concat(D.relAddr?"".concat(u,"raddr").concat(u).concat(D.relAddr):"").concat(D.relPort?"".concat(u,"rport").concat(u).concat(D.relPort):"").concat(Object.keys(D.extension).map(k=>"".concat(u).concat(k).concat(u).concat(D.extension[k])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(D=>"a=remote-candidates:".concat(D.join(u)).concat(this.eol)).join("")}printEndOfCandidates(R){return R===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const D=R.payloads;let k="";k+=R.rtcpFeedbackWildcards.map(Z=>this.printRTCPFeedback("*",Z)).join("");for(const Z of D)k+=this.printRtpMap(Z.payloadType,Z.rtpMap),k+=this.printFmtp(Z.payloadType,Z.fmtp),k+=Z.rtcpFeedbacks.map(Dt=>this.printRTCPFeedback(Z.payloadType,Dt)).join("");return k}printFmtp(R,D){if(!D)return"";const k=Object.keys(D.parameters);return k.length===1&&D.parameters[k[0]]===null?"a=fmtp:".concat(R).concat(u).concat(k[0]).concat(this.eol):"a=fmtp:".concat(R).concat(u).concat(Object.keys(D.parameters).map(Z=>"".concat(Z,"=").concat(D.parameters[Z])).join(";")).concat(this.eol)}printRtpMap(R,D){return D?"a=rtpmap:".concat(R).concat(u).concat(D.encodingName,"/").concat(D.clockRate).concat(D.encodingParameters?"/".concat(D.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,D){let k="a=rtcp-fb:".concat(R).concat(u),Z=D;return Z.type==="trr-int"?k+="ttr-int".concat(u).concat(Z.interval):(k+="".concat(Z.type),Z.parameter&&(k+="".concat(u).concat(Z.parameter),Z.additional&&(k+="".concat(u).concat(Z.additional)))),k+this.eol}printPtime(R){return R===void 0?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return R===void 0?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return R===void 0?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(D=>Object.keys(D.attributes).map(k=>"a=ssrc:".concat(D.ssrcId.toString(10)).concat(u).concat(k).concat(D.attributes[k]?":".concat(D.attributes[k]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return R===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return R===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return R===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(R===void 0)return"";let D="a=rtcp:".concat(R.port);return R.netType&&(D+="".concat(u).concat(R.netType)),R.addressType&&(D+="".concat(u).concat(R.addressType)),R.address&&(D+="".concat(u).concat(R.address)),D+this.eol}printMSId(R){return R.map(D=>"a=msid:".concat(D.id).concat(D.appdata?"".concat(u).concat(D.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(D=>"a=imageattr:".concat(D).concat(this.eol)).join("")}printRid(R){return R.map(D=>{let k="a=rid:".concat(D.id).concat(u).concat(D.direction);return D.payloads&&(k+="".concat(u,"pt=").concat(D.payloads.join(","))),D.params.length>0&&(k+="".concat(u).concat(D.params.map(Z=>Z.type==="depend"?"depend=".concat(Z.rids.join(",")):"".concat(Z.type,"=").concat(Z.val)).join(";"))),k+this.eol}).join("")}printSimulcast(R){return R===void 0?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return R===void 0?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return R===void 0?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return R===void 0?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(D=>"a=ssrc-group:".concat(D.semantic).concat(D.ssrcIds.map(k=>"".concat(u).concat(k.toString(10))).join("")).concat(this.eol)).join("")}}function nt(z){return new ct().parse(z)}function mt(z,R){return new En().print(z,R)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var s in r)n.o(r,s)&&!n.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:r[s]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function yr(t){return yL.parse(t)}function rd(t,e){return yL.print(t,e)}var Yj=Zi("Array").keys,zj=ha,qj=Zn,Xj=ue,Jj=Yj,Vb=Array.prototype,Qj={DOMTokenList:!0,NodeList:!0},Zj=function(t){var e=t.keys;return t===Vb||Xj(Vb,t)&&e===Vb.keys||qj(Qj,zj(t))?Jj:e},ta=Vt(Zj);function CL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ut(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CL(Object(n),!0).forEach(function(i){nn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function nn(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var u=l.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const AL=new class extends Je{constructor(){super(...arguments),nn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class $j{constructor(e){nn(this,"logger",void 0),nn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function Bb(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function bL(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Oa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},fv=Date.now(),Xm=t=>{for(const e in Oa)if(Object.prototype.hasOwnProperty.call(Oa,e)&&Oa[e]===t)return e;return"DEFAULT"},S=new class{constructor(){nn(this,"proxyServerURL",void 0),nn(this,"logLevel",Oa.DEBUG),nn(this,"uploadState","collecting"),nn(this,"uploadLogWaitingList",[]),nn(this,"uploadLogUploadingList",[]),nn(this,"uploadErrorCount",0),nn(this,"currentLogID",0),nn(this,"url",void 0),nn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Oa.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Oa.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Oa.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Oa.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Oa.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){ge("UPLOAD_LOG",!0)}disableLogUpload(){ge("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new $j(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-fv<100)return void setTimeout(()=>{this.log(...e)},Date.now()-fv);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=Bb()+" Agora-SDK [".concat(Xm(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=Bb()+" %cAgora-SDK [".concat(Xm(i),"]:");let s=[];if(!N("USE_NEW_LOG"))switch(i){case Oa.DEBUG:s=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case Oa.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case Oa.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case Oa.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-fv<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-fv);const i=Math.max(0,Math.min(4,e[0]));e[0]=Bb()+" Agora-SDK [".concat(Xm(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!N("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=bL()+" Agora-SDK [".concat(Xm(t),"]:"):n[0]=bL()+" Agora-SDK [".concat(Xm(t),"]:");let r="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),r+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:Ia,process_id:N("PROCESS_ID"),payload:JSON.stringify(t)};return Ks(async()=>{const n=await nr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(N("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(N("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),AL.reportLogUploadError(i),!0},{timeout:N("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:N("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,N("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var IL;function tG(t){return ei(t.reportId,"params.reportId",0,100,!1),ei(t.category,"params.category",0,100,!1),ei(t.event,"params.event",0,100,!1),ei(t.label,"params.label",0,100,!1),ye(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(IL={}).FREE="free",IL.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const eG={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Fn=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Ye=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let nG=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function yt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const s=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];let p=u;if(t.argsMap)try{p=t.argsMap(this,...u)}catch(E){S.warning(E),p=[]}try{JSON.stringify(p)}catch{S.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const _=(t.report||gt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:tn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const E=r.apply(this,u);return E instanceof at?E.then(g=>(_.onSuccess(t.reportResult&&g),g)).catch(g=>{throw _.onError(g),g}):(_.onSuccess(t.reportResult&&E),E)}catch(E){throw _.onError(E),E}}}return i}}const gt=new class{constructor(){nn(this,"baseInfoMap",new Map),nn(this,"proxyServer",void 0),nn(this,"eventUploadTimer",void 0),nn(this,"setSessionIdTimer",void 0),nn(this,"url",void 0),nn(this,"sids",new Set),nn(this,"backupUrl",void 0),nn(this,"_appId",void 0),nn(this,"_aid",0),nn(this,"keyEventUploadPendingItems",[]),nn(this,"normalEventUploadPendingItems",[]),nn(this,"apiInvokeUploadPendingItems",[]),nn(this,"apiInvokeCount",0),nn(this,"apiInvokeLoggedCount",0),nn(this,"ltsList",[]),nn(this,"lastSendNormalEventTime",Date.now()),nn(this,"customReportCounterTimer",void 0),nn(this,"customReportCount",0),nn(this,"extApiInvoke",async t=>{for(const e of t){const n=Ut(Ut({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:tn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),N("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),N("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,s=!!N("SHOW_REPORT_INVOKER_LOG"),c=!!N("SHOW_REPORT_USER_INVOKER_LOG"),l=s||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const u=this.apiInvokeLoggedCount;function h(g,C){if(l){let v="[apiInvoke-".concat(u,"]");e.id&&(v+="[".concat(e.id,"]")),e.name&&(v+="[".concat(e.name,"]")),S.info("".concat(v," ").concat(g),g==="start"?e.options:C||"")}}const p=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});h("start");let _=!1;ni(e.timeout).then(()=>{_||(this.sendApiInvoke(Ut(Ut({},p()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const E=new G(O.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:g=>{const C=()=>{if(_)throw E;return _=!0,this.sendApiInvoke(Ut(Ut({},p()),{},{success:!0},e.reportResult&&{result:g})),h("onSuccess"),g};return n?sL(C,e.name+"Success",n,()=>_=!0):C()},onError:g=>{const C=()=>{if(_)throw g;_=!0,this.sendApiInvoke(Ut(Ut({},p()),{},{success:!1,error:g})),h("onFailure",g.toString())};return n?sL(C,e.name+"Error",n,()=>_=!0):C()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:N("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:kb?"global":"oversea",areas:N("AREAS")&&N("AREAS").join(",")},e.extend),{stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:u,lsid:h,clientRole:p}=e,_=Date.now(),E=Ut(Ut({},i),{},{eventType:Fn.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:Ub,lts:_,elapse:_-n,extend:JSON.stringify(r),mode:e.mode,process:N("PROCESS_ID"),appType:N("APP_TYPE"),success:!0,version:Ia,stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:u,lsid:h,clientType:it(g=window.navigator.userAgent).call(g,"AgoraWebView")?42:20,clientRole:p,serviceId:N("PROCESS_ID"),extensionID:N("PLUGIN_INFO").join(",")||""});var g;this.send({type:Ye.SESSION,data:E},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut({},i),{},{role:e.role,eventType:Fn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:Ye.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut({},i),{},{eventType:Fn.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:Ye.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:s,avoidJoinStartTime:c,addr:l,isProxy:u}=e,h=r-(s&&c?c:n.startTime),p=Ut(Ut({},i),{},{eventType:Fn.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:h,eventElapse:r-e.lts,firstSuccess:s,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:Pb(),isABTestSuccess:e.isABTestSuccess?1:0}),_=p.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),s)this.send({type:Ye.JOIN_GATEWAY,data:p},!0);else{let E;if(l)if(u){const C=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),v=l.match(/p=[0-9]{1,6}/g);E={isSuccess:_,gatewayIp:C&&C.length?C[0].split("=")[1].replace(/-/g,"."):"",port:v&&v.length?v[0].split("=")[1]:"",isProxy:u?1:0}}else{const C=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),v=l.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:_,gatewayIp:C&&C.length?C[0].split("//")[1].replace(/-/g,"."):"",port:v&&v.length?v[0].split(/:|p=/g)[1]:"",isProxy:u?1:0}}else E={isSuccess:_,gatewayIp:"",port:"",isProxy:u?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const g=Object.assign({},p,E,{eventType:Fn.REJOIN_GATEWAY});this.send({type:Ye.RE_JOIN_GATEWAY,data:g},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=Ut(Ut({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:Ye.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut({},i),{},{eventType:Fn.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:Ye.PUBLISH,data:s},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,s=Date.now(),c=Ut(Ut({},r),{},{eventType:Fn.SUBSCRIBE,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:Ye.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...ta(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const s=r.info,c=Date.now(),l=Ut(Ut({},s),{},{eventType:Fn.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:Ye.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=Ut(Ut(Ut({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=Ut(Ut(Ut({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut(Ut({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:Fn.AB_TEST,lts:r});this.send({type:Ye.AB_TEST,data:s},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut(Ut({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:Fn.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:Ye.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut(Ut({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Fn.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:Ye.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=Ut(Ut(Ut({},s),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut({},i),{},{eventType:Fn.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:Ye.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut({},i),{},{eventType:Fn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Ye.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut({},i),{},{eventType:Fn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Ye.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(t){this.proxyServer=t,t?S.debug("reportProxyServerurl: ".concat(t)):S.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:Ye.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(s,c,l){const u=s[c];if(!u||typeof u!="string")return[s];s[c]="";const h=jo(JSON.stringify(s));let p=0;const _=[];let E=0;for(let g=0;g<u.length;g++)E+=u.charCodeAt(g)<=127?1:3,E<=l-h||(_[_.length]=ut(ut({},s),{},{[c]:u.substring(p,g)}),p=g,E=u.charCodeAt(g)<=127?1:3);return p!==u.length-1&&(_[_.length]=ut(ut({},s),{},{[c]:u.substring(p)})),_})(Ut(Ut(Ut({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:Ye.WORKER_EVENT,data:s},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut(Ut({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:Ye.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut(Ut({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:Ye.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Ut(Ut(Ut({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:Ye.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>N("CUSTOM_REPORT_LIMIT"))throw new G(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:Ye.USER_ANALYTICS,data:Ut(Ut({sid:t},r),{},{lts:n})}));try{N("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw S.error("send custom report message failed",r.toString()),new G(O.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=N("NOT_REPORT_EVENT");if(t.tag&&it(e)&&it(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:s}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof G){const{code:u,message:h}=t.error;c=u||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:s,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Ye.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const s=t.shift();n.length<20?n.push(s):i.push(s)}t.push(...i);for(const s of[...n]){var r;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Om(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),N("ENABLE_EVENT_REPORT")&&n.length&&(N("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>c=>{N("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-N("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){Rn.networkState===jr.OFFLINE&&await at.race([Rn.onlineWaiter,ni(2*In.maxRetryTimeout)]);const e=r=>{let s=new Uint8Array;return r.forEach(c=>{const l=Rb(JSON.stringify(c.data)),u=new ArrayBuffer(5),h=(_=>{let E=0;return Object.entries(Ye).forEach(g=>{let[C,v]=g;v===_.type&&(E=nG[C])}),E})(c),p=new DataView(u);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=QD(s,new Uint8Array(u)),s=QD(s,l)}),s},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Ob(i,{timeout:1e4,data:e(t),headers:Ut(Ut({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(r===1)throw s;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const u=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return u&&u.info.vid&&+u.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};Rn.networkState===jr.OFFLINE&&await at.race([Rn.onlineWaiter,ni(2*In.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(N("EVENT_REPORT_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(N("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(s)));try{e?await jj(c,{timeout:1e4,data:r}):await Ob(c,{timeout:1e4,data:r})}catch(u){if(l===1)throw u;continue}return}}createBaseInfo(t,e){const n=Object.assign({},eG);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:tn.TRACER}).onSuccess()}};AL.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Rn.networkState,gt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:tn.TRACER}).onSuccess("logUploadError")});class B extends G{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),nn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,S)}throw(){super.throw(S)}}const ii={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ae(){return ii}function OL(){return"setSinkId"in HTMLAudioElement.prototype&&(!N("RESTRICTION_SET_PLAYBACK_DEVICE")||(Vc()||BD())&&!gb())}function wL(){return!ii.supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&Bc()}let ri=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function If(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function ie(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function as(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function Fb(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const iG={"90p":ie(160,90),"90p_1":ie(160,90),"120p":ie(160,120,15,30,65),"120p_1":ie(160,120,15,30,65),"120p_3":ie(120,120,15,30,50),"120p_4":ie(212,120),"180p":ie(320,180,15,30,140),"180p_1":ie(320,180,15,30,140),"180p_3":ie(180,180,15,30,100),"180p_4":ie(240,180,15,30,120),"240p":ie(320,240,15,40,200),"240p_1":ie(320,240,15,40,200),"240p_3":ie(240,240,15,40,140),"240p_4":ie(424,240,15,40,220),"360p":ie(640,360,15,80,400),"360p_1":ie(640,360,15,80,400),"360p_3":ie(360,360,15,80,260),"360p_4":ie(640,360,30,80,600),"360p_6":ie(360,360,30,80,400),"360p_7":ie(480,360,15,80,320),"360p_8":ie(480,360,30,80,490),"360p_9":ie(640,360,15,80,800),"360p_10":ie(640,360,24,80,800),"360p_11":ie(640,360,24,80,1e3),"480p":ie(640,480,15,100,500),"480p_1":ie(640,480,15,100,500),"480p_2":ie(640,480,30,100,1e3),"480p_3":ie(480,480,15,100,400),"480p_4":ie(640,480,30,100,750),"480p_6":ie(480,480,30,100,600),"480p_8":ie(848,480,15,100,610),"480p_9":ie(848,480,30,100,930),"480p_10":ie(640,480,10,100,400),"720p":ie(1280,720,15,120,1130),"720p_auto":ie(1280,720,30,900,3e3),"720p_1":ie(1280,720,15,120,1130),"720p_2":ie(1280,720,30,120,2e3),"720p_3":ie(1280,720,30,120,1710),"720p_5":ie(960,720,15,120,910),"720p_6":ie(960,720,30,120,1380),"1080p":ie(1920,1080,15,120,2080),"1080p_1":ie(1920,1080,15,120,2080),"1080p_2":ie(1920,1080,30,120,3e3),"1080p_3":ie(1920,1080,30,120,3150),"1080p_5":ie(1920,1080,60,120,4780),"1440p":ie(2560,1440,30,120,4850),"1440p_1":ie(2560,1440,30,120,4850),"1440p_2":ie(2560,1440,60,120,7350),"4k":ie(3840,2160,30,120,8910),"4k_1":ie(3840,2160,30,120,8910),"4k_3":ie(3840,2160,60,120,13500)},rG={"480p":as(640,480,5),"480p_1":as(640,480,5),"480p_2":as(640,480,30),"480p_3":as(640,480,15),"720p":as(1280,720,5),"720p_auto":ie(1280,720,30,900,3e3),"720p_1":as(1280,720,5),"720p_2":as(1280,720,30),"720p_3":as(1280,720,15),"1080p":as(1920,1080,5),"1080p_1":as(1920,1080,5),"1080p_2":as(1920,1080,30),"1080p_3":as(1920,1080,15)},aG={"1SL1TL":Fb(1,1),"3SL3TL":Fb(3,3),"2SL3TL":Fb(2,3)};function Ho(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},iG[t]):t}function jb(t){return typeof t=="string"?Object.assign({},rG[t]):t}function _v(t){return typeof t=="string"?Object.assign({},aG[t]):t}const sG={speech_low_quality:If(16e3,!1),speech_standard:If(32e3,!1,18),music_standard:If(48e3,!1),standard_stereo:If(48e3,!0,56),high_quality:If(48e3,!1,128),high_quality_stereo:If(48e3,!0,192)};function Ev(t){return typeof t=="string"?Object.assign({},sG[t]):t}const Of=[];function NL(t){return Un(t,"mediaSource",["screen","window","application"]),!0}let ft=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Le=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),wf=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),oG=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),cG=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),Yu=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Nf=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Df=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Lf=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),ea=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const Gb={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Hb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},DL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},lG={uplinkNetworkQuality:0,downlinkNetworkQuality:0},LL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Wi=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),na=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),Jm=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),zu=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),xi=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Wo=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const Wb={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let mv=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function PL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ze(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?PL(Object(n),!0).forEach(function(i){V(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):PL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function V(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var u=l.call(s,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function re(t,e,n,i,r){var s,c,l={};return Object.keys(i).forEach(function(u){l[u]=i[u]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=ji(s=Gd(c=n.slice()).call(c)).call(s,function(u,h){return h(t,e,u)||u},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(t,e,l),l=null),l}class kL extends Je{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Yu.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),V(this,"trackMediaType",void 0),V(this,"_ID",void 0),V(this,"_rtpTransceiver",void 0),V(this,"_lowRtpTransceiver",void 0),V(this,"_hints",[]),V(this,"_isClosed",!1),V(this,"_originMediaStreamTrack",void 0),V(this,"mediaStreamTrack",void 0),V(this,"_external",{}),this._ID=n||De(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){it(Of).call(Of,i)||Of.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||nd(()=>{var n;gt.reportApiInvoke(null,{name:bn.GET_MEDIA_STREAM_TRACK,options:[],tag:tn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===wf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=Of.indexOf(e);n!==-1&&Of.splice(n,1)}(this),this.emit(Nf.CLOSED),this.removeAllListeners(Yu.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===wf.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Yu.TRANSCEIVER_UPDATED,e,n)}}class Pf extends kL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),V(this,"_enabled",!0),V(this,"_muted",!1),V(this,"_isExternalTrack",!1),V(this,"_isClosed",!1),V(this,"_enabledMutex",void 0),V(this,"processor",void 0),V(this,"_processorContext",void 0),V(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new vi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(ft.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ne(this,ft.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Nf.TRACK_ENDED)}stateCheck(e,n){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Fc(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new G(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new G(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():at.resolve([])}}const ML=window.AudioContext||window.webkitAudioContext;let ia=null;const Se=new class extends Je{constructor(){super(...arguments),V(this,"prevState",void 0),V(this,"curState",void 0),V(this,"currentTime",void 0),V(this,"currentTimeStuckAt",void 0),V(this,"interruptDetectorTrack",void 0),V(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit(ri.IOS_15_16_INTERRUPTION_START)}),V(this,"onLocalAudioTrackUnmute",async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(ia&&await ia.suspend(),this.emit(ri.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){S.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){S.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function kf(){if(!ia){if(function(){if(!ML)return void S.error("your browser is not support web audio");S.info("create audio context");const t=ze({},N("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(t)),ia=new ML(t),Se.curState=ia.state,ia.onstatechange=()=>{Se.prevState=Se.curState,Se.curState=ia?ia.state:void 0;const{prevState:e,curState:n}=Se,i=n==="running",r=n==="interrupted",s=e==="running",c=e==="suspended",l=e==="interrupted",u=ne().osVersion;(Hi()||is())&&s&&r&&(S.info("ios".concat(u,"-interruption-start")),Se.emit(ri.IOS_INTERRUPTION_START)),(Hi()||is())&&(c||l)&&i&&(S.info("ios".concat(u,"-interruption-end")),Se.emit(ri.IOS_INTERRUPTION_END)),e!==n&&Se.emit(ri.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=ia)===null||e===void 0?void 0:e.currentTime;Se.currentTime!==n?(Se.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(n)),Se.currentTimeStuckAt=void 0),Se.currentTime=n):(n!==Se.currentTimeStuckAt&&(gt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:tn.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(n))),Se.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,s=!1,c=!1;function l(v){e.state==="running"?u(!1):Hi()||is()?e.state==="suspended"&&(u(!0),v&&e.resume().then(h,h)):e.state!=="closed"&&(u(!0),v&&e.resume().then(h,h))}function u(v){if(r!==v){r=v;for(let y=0,b=n;y<b.length;y+=1){const I=b[y];v?window.addEventListener(I,p,{capture:!0,passive:!0}):window.removeEventListener(I,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function _(v){if(!c)if(i.paused)if(v){let y;E(!1),c=!0;try{y=i.play(),y?y.then(g,g):(i.addEventListener("playing",g),i.addEventListener("abort",g),i.addEventListener("error",g))}catch{g()}}else E(!0);else E(!1)}function E(v){if(s!==v){s=v;for(let y=0,b=n;y<b.length;y++){const I=b[y];v?window.addEventListener(I,C,{capture:!0,passive:!0}):window.removeEventListener(I,C,{capture:!0,passive:!0})}}}function g(){i.removeEventListener("playing",g),i.removeEventListener("abort",g),i.removeEventListener("error",g),c=!1,_(!1)}function C(){_(!0)}if(Hi()){const v=e.createMediaStreamDestination(),y=document.createElement("div");y.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=y.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=v.stream,_(!0)}Se.on(ri.STATE_CHANGE,function(){l(!0)}),l(!1)}(ia)}(),!ia)throw new G(O.NOT_SUPPORTED,"can not create audio context");return ia}return ia}function qu(t){if(function(){if(Kb!==null)return Kb;const i=kf(),r=i.createBufferSource(),s=i.createGain(),c=i.createGain();r.connect(s),r.connect(c),r.disconnect(s);let l=!1;try{r.disconnect(s)}catch{l=!0}return r.disconnect(),Kb=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,s)=>{var c;return t._inputNodes||(t._inputNodes=[]),it(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,s)):e.call(t,i,r)),t},t.disconnect=(i,r,s)=>{n.call(t),i?sv(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let Kb=null;function Yb(t,e){let n=!1;const i=1/e;if(N("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=kf();let s=r.createGain();s.gain.value=0,s.connect(r.destination);const c=()=>{if(n)return void(s=null);const l=r.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class UL{constructor(){V(this,"context",void 0),V(this,"analyserNode",void 0),V(this,"sourceNode",void 0),this.context=kf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Hi()||is()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=ji(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class xL extends Je{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),V(this,"outputNode",void 0),V(this,"outputTrack",void 0),V(this,"isPlayed",!1),V(this,"sourceNode",void 0),V(this,"context",void 0),V(this,"audioBufferNode",void 0),V(this,"destNode",void 0),V(this,"audioOutputLevel",0),V(this,"volumeLevelAnalyser",void 0),V(this,"_processedNode",void 0),V(this,"playNode",void 0),V(this,"isDestroyed",!1),V(this,"onNoAudioInput",void 0),V(this,"isNoAudioInput",!1),V(this,"_noAudioInputCount",0),this.context=kf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),qu(this.outputNode),this.volumeLevelAnalyser=new UL}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ea.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const s=i.outputBuffer.getChannelData(r);for(let c=0;c<s.length;c+=1)s[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ae().webAudioMediaStreamDest)throw new G(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&ov(()=>{Se.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Hi()||is()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let s=0;s<i.length;s++)i[s]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await ni(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class VL extends xL{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),V(this,"sourceNode",void 0),V(this,"track",void 0),V(this,"clonedTrack",void 0),V(this,"audioElement",void 0),V(this,"isCurrentTrackCloned",!1),V(this,"isRemoteTrack",!1),V(this,"originVolumeLevelAnalyser",void 0),V(this,"rebuildWebAudio",async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),qu(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),qu(this.outputNode),this.emit(ea.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new G(O.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),qu(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,S.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([l]));qu(u),this.originVolumeLevelAnalyser=new UL,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const c=ne();n&&c.os===Bn.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(Se.on(ri.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),qu(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ea.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Se.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),S.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));qu(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function BL(t,e,n){const i=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function dG(t,e){const n=await FL(t.mediaSource),{sourceId:i,audio:r}=await function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new at((l,u)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const g=document.createElement("div");g.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const C=document.createElement("button");C.innerHTML="cancel",C.setAttribute("style","width: 85px;"),C.onclick=()=>{document.body.removeChild(b);const I=new Error("NotAllowedError");I.name="NotAllowedError",u(I)};let v=c;const y=document.createElement("div");if(c){const I=document.createElement("input");I.setAttribute("type","checkbox");const L=document.createElement("span");I.setAttribute("style","margin-right: 6px;"),L.innerText="Share audio",I.checked=v,I.onchange=()=>{v=I.checked},y.appendChild(I),y.appendChild(L)}g.appendChild(y),g.appendChild(C),p.appendChild(_),p.appendChild(E),p.appendChild(g);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(h),b.appendChild(p),document.body.appendChild(b),s.map(I=>{if(I.id){const L=document.createElement("div");L.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let U=I.thumbnail;try{const{width:x}=U.getSize();x>1920&&(U=U.resize({width:1920}))}catch(x){throw x&&x.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),x}L.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+U.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+I.name.replace(/[\u00A0-\u9999<>\&]/g,function(x){return"&#"+x.charCodeAt(0)+";"})+"</span>",L.onclick=()=>{document.body.removeChild(b),l({sourceId:I.id,audio:v})},E.appendChild(L)}})})}(n,e);return await BL(i,t,r)}async function FL(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=ZD();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new G(O.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new at((s,c)=>{n.desktopCapturer.getSources({types:e},(l,u)=>{l?c(l):s(u)})}));try{return await i}catch(s){throw new G(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const zb=new vi("safari");let jL=!1,GL=!1;async function ra(t,e){let n=0,i=null;for(;n<2;)try{i=await uG(t,e,n>0);break}catch(r){if(r instanceof G)throw S.error("[".concat(e,"] ").concat(r.toString())),r;const s=gv(r.name||r.code||r,r.message);if(s.code===O.MEDIA_OPTION_INVALID){S.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await ni(500);continue}throw S.error("[".concat(e,"] ").concat(s.toString())),s}if(!i)throw new G(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function uG(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new G(O.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=ae(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return S.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(ZD())t.screen.sourceId?Mf(r,await BL(t.screen.sourceId,t.screen,!!t.screenAudio)):Mf(r,await dG(t.screen,!!t.screenAudio));else if(Vc()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new G(O.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const E=await(c=t.screen.extensionId,l=e,new at((g,C)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},v=>{if(!v||!v.streamId)return S.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),v),void C(new G(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));g(v.streamId)})}catch(v){S.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),v.toString()),C(new G(O.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=E,Mf(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var s;t.screen.mediaSource&&NL(t.screen.mediaSource);const E={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(s=t.screen.displaySurface)!==null&&s!==void 0?s:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:g,surfaceSwitching:C,systemAudio:v,preferCurrentTab:y}=t.screen,b={selfBrowserSurface:g,surfaceSwitching:C,systemAudio:v,preferCurrentTab:y};!g&&delete b.selfBrowserSurface,!C&&delete b.surfaceSwitching,!v&&delete b.systemAudio,!y&&delete b.preferCurrentTab,S.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:E,audio:t.screenAudio,controls:b})),Mf(r,await navigator.mediaDevices.getDisplayMedia(ze({video:E,audio:t.screenAudio},b)))}else{if(!Ze())throw S.error("[".concat(e,"] This browser does not support screenSharing")),new G(O.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&NL(t.screen.mediaSource);const E={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};S.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(E))),Mf(r,await navigator.mediaDevices.getUserMedia(E))}}var c,l;if(!t.video&&!t.audio)return r;let u={video:t.video,audio:t.audio},h=N("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),u=Cb(u,h)}catch{}S.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(u)),ne();let p,_=null;(hi()||Hi()||rv())&&(_=await zb.lock());try{p=await navigator.mediaDevices.getUserMedia(u)}catch(E){throw _&&_(),E}return u.audio&&(jL=!0),u.video&&(GL=!0),Mf(r,p),_&&_(),r}function gv(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new G(O.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new G(O.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new G(O.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new G(O.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new G(O.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new G(O.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return S.error("getUserMedia unexpected error",t),new G(O.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function Mf(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(i&&t.removeTrack(i),t.addTrack(s)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const aa=new class extends Je{get state(){return this._state}set state(t){t!==this._state&&(this.emit(zu.STATE_CHANGE,t),this._state=t)}constructor(){super(),V(this,"_state",Jm.IDLE),V(this,"isAccessMicrophonePermission",!1),V(this,"isAccessCameraPermission",!1),V(this,"lastAccessMicrophonePermission",!1),V(this,"lastAccessCameraPermission",!1),V(this,"checkdeviceMatched",!1),V(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(N("ENUMERATE_DEVICES_INTERVAL")||(av()||iv()===Bn.HARMONY_OS)&&Bc())&&this.updateDevicesInfo()},N("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>S.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new G(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let s=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(s=!1),r.video&&(c=!1);let l=null,u=null,h=null;if(!n&&(s||c)){if(zb.isLocked&&(S.debug("[device manager] wait GUM lock"),(await zb.lock())(),S.debug("[device manager] GUM unlock")),jL&&(s=!1,this.isAccessMicrophonePermission=!0),GL&&(c=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",t,e,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const _=gv(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;S.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(p){const _=gv(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;S.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){const _=gv(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;S.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",t,"cam permission",e)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,u=null,h=null,p}catch(p){return l&&l.getTracks().forEach(_=>_.stop()),u&&u.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,u=null,h=null,new G(O.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new G(O.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=Jm.INITING;try{await this.updateDevicesInfo(),this.state=Jm.INITEND}catch(t){throw S.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=Jm.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new G(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&s?s.groupId===r.groupId?S.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is the same group")):S.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is not the same group")):S.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const s=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((r,s)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==Jm.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(zu.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(zu.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(zu.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let qb=!1;const sa=new class extends Je{constructor(){super(...arguments),V(this,"onAutoplayFailed",void 0),V(this,"onAudioAutoplayFailed",void 0)}};function HL(){if(ne(),!qb){const t=e=>{e.preventDefault(),qb=!1,jm()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};qb=!0,jm()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),sa.onAutoplayFailed?sa.onAutoplayFailed():sa.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),sa.emit("autoplay-failed")}}function WL(t,e,n,i){if(!t)return;const r=gt.getBaseInfoBySessionId(t);if(!r)return;const s=r.info,c=Date.now(),l=ze(ze({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-r.startTime,cbRegistered:sa.onAutoplayFailed||sa.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});gt.send({type:Ye.AUTOPLAY_FAILED,data:l},!0)}const hG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ir=new class{constructor(){V(this,"onAutoplayFailed",void 0),V(this,"elementMap",new Map),V(this,"elementStateMap",new Map),V(this,"elementsNeedToResume",[]),V(this,"sinkIdMap",new Map),V(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),s=i.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(S.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(Se.curState==="running")return Rf()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),V(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Se.on(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Se.on(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Se.on(ri.STATE_CHANGE,()=>{Hi()&&Se.prevState==="suspended"&&Se.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new G(O.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,xi.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{r.setSinkId(s).catch(l=>{S.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){S.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&WL(i,"audio",l.message,e),S.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),ov(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),HL()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){hG.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),s=i.type==="pause"?"paused":i.type;if(S.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(s)),i.type==="error"){const c=e==null?void 0:e.error;c&&S.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,s)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{S.debug("Auto resume audio element success")}).catch(n=>{S.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new at(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{jm()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function fn(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new G(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];const l=i.apply(this,s);return l instanceof at?new at((u,h)=>{l.then(u).catch(h)}):l}),n}}class KL extends Je{constructor(e){super(),V(this,"name","VideoProcessorDestination"),V(this,"ID","0"),V(this,"_source",void 0),V(this,"videoContext",void 0),V(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new G(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new G(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Wi.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Wi.ON_TRACK,void 0)}}class YL extends Je{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),V(this,"constraintsMap",new Map),V(this,"statsRegistry",[]),V(this,"usageRegistry",[]),V(this,"trackId",void 0),V(this,"direction",void 0),V(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await fi(this,na.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ne(this,na.REQUEST_UPDATE_CONSTRAINTS,Array.from(Tr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return S.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Ne(this,na.REQUEST_UPDATE_CONSTRAINTS,Array.from(Tr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){S.error(new G(O.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof at&&(i=await i),e.push(ze(ze({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class zL extends Je{constructor(e){super(),V(this,"name","AudioProcessorDestination"),V(this,"ID","0"),V(this,"inputTrack",void 0),V(this,"inputNode",void 0),V(this,"audioProcessorContext",void 0),V(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new G(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new G(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Wi.ON_TRACK,void 0),this.emit(Wi.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Wi.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Wi.ON_NODE,this.inputNode))}}class qL extends Je{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),V(this,"constraintsMap",new Map),V(this,"statsRegistry",[]),V(this,"audioContext",void 0),V(this,"trackId",void 0),V(this,"direction",void 0),V(this,"usageRegistry",[]),V(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return fi(this,na.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ne(this,na.REQUEST_UPDATE_CONSTRAINTS,Array.from(Tr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Ne(this,na.REQUEST_UPDATE_CONSTRAINTS,Array.from(Tr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){S.error(new G(O.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof at&&(i=await i),e.push(ze(ze({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class Xb extends Je{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),V(this,"context",void 0),V(this,"processSourceNode",void 0),V(this,"outputTrack",void 0),V(this,"processedNode",void 0),V(this,"clonedTrack",void 0),V(this,"outputNode",void 0),this.outputNode=new pG}setVolume(){}createOutputTrack(){throw new G(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class pG{disconnect(){}connect(){}}function XL(t){return new at((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const s=Hi()?"canplay":"playing";r.addEventListener(s,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&Ze()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(cv),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function Sv(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=Ho(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!zD()&&n.frameRate&&(e.frameRate=n.frameRate),BD()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Ze()&&(e.frameRate={ideal:30,max:30}),e}function JL(t){const e={};return zD()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Vc()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function QL(t){const e=JL(t);if(t.encoderConfig){const n=Ev(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),av()&&(e.sampleRate=void 0),e}const fG=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:s=n,width:c=i,height:l=r}=e;if(!s||!c||!l)return;c=Ab(c),l=Ab(l),s=Ab(s);const{max:u,min:h}=function(g,C,v){const y=200*Math.pow(v/15,.6)*Math.pow(g*C/640/360,.75);return{min:Math.floor(y),max:Math.floor(4*y)}}(c,l,s),{bitrateMax:p,bitrateMin:_}=e||{};p||S.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(_,"]"));const{maxFramerate:E}=N("ENCODER_CONFIG_LIMIT");return E&&typeof E=="number"&&(s=Math.min(s,E)),{frameRate:s,bitrateMax:p||u,bitrateMin:_||h,scaleResolutionDownBy:1,scale:0}},ZL=async(t,e,n)=>await(async(i,r,s)=>{const c=function(h){const p=[];for(let _=0;_<h.length;_+=2)p.push(parseInt(h.slice(_,_+2),16));return Uint8Array.from(p)}(lL(""+r+s)).slice(0,16),l=c.slice(0,12),u=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},u,i))})(t.buffer,e,n),Jb=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new at((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const s=await $L(r);n({buffer:s,width:e.width,height:e.height})}else i(new G(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},$L=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var tP,eP,nP,iP,rP,aP,sP,oP,cP,lP,dP,uP,hP,pP,fP,_P,EP,mP,Qe,gP,SP,TP,RP,vP,yP,Ko,CP,AP,bP,IP,OP,wP,NP,DP,LP,PP,kP,MP,UP,Ei;let an=(tP=yt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),eP=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),nP=fn(),iP=Cf("LocalAudioTrack","_enabledMutex"),rP=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),aP=fn(),sP=Cf("LocalAudioTrack","_enabledMutex"),oP=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),cP=fn(),lP=fn(),dP=fn(),uP=yt({argsMap:t=>[t.getTrackId()]}),hP=fn(),pP=yt({argsMap:t=>[t.getTrackId()]}),fP=fn(),_P=yt({argsMap:t=>[t.getTrackId()]}),EP=yt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),mP=yt({argsMap:t=>[t.getTrackId()]}),re((Qe=class extends Pf{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ir.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),V(this,"trackMediaType",Lf.AUDIO),V(this,"_encoderConfig",void 0),V(this,"_trackSource",void 0),V(this,"metadata",[]),V(this,"_enabled",!0),V(this,"_volume",100),V(this,"_useAudioElement",!0),V(this,"_bypassWebAudio",!1),V(this,"processor",void 0),V(this,"_processorContext",void 0),V(this,"_processorDestination",void 0),V(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new Xb,N("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),N("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),hi()&&!ia?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){ye(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&ir.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Ne(this,ft.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!OL())throw new G(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ir.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Ne(this,ft.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Ne(this,ft.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Ne(this,ft.NEED_MUTE_TRACK,this):await Ne(this,ft.NEED_UNMUTE_TRACK,this))}getStats(){return nd(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Zr(this,ft.GET_STATS)||ze({},Gb)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ea.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ea.ON_AUDIO_BUFFER),this._source.on(ea.ON_AUDIO_BUFFER,n=>t(n))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ir.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ir.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ir.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ne(this,ft.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return at.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new G(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(Wi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Ne(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ne(this,ft.NEED_REPLACE_TRACK,this))}),t.on(Wi.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Wi.ON_TRACK),t.removeAllListeners(Wi.ON_NODE)}bindProcessorContextEvents(t){t.on(na.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(na.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Xb&&(this._trackSource=new VL(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new qL(this._source.context,this.getTrackId(),"local"),e=new zL(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(ea.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ir.stop(this.getTrackId()),this._source.play()),Ne(this,ft.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[tP],Object.getOwnPropertyDescriptor(Qe.prototype,"setVolume"),Qe.prototype),re(Qe.prototype,"setPlaybackDevice",[eP,nP],Object.getOwnPropertyDescriptor(Qe.prototype,"setPlaybackDevice"),Qe.prototype),re(Qe.prototype,"setEnabled",[iP,rP,aP],Object.getOwnPropertyDescriptor(Qe.prototype,"setEnabled"),Qe.prototype),re(Qe.prototype,"setMuted",[sP,oP,cP],Object.getOwnPropertyDescriptor(Qe.prototype,"setMuted"),Qe.prototype),re(Qe.prototype,"getStats",[lP],Object.getOwnPropertyDescriptor(Qe.prototype,"getStats"),Qe.prototype),re(Qe.prototype,"setAudioFrameCallback",[dP],Object.getOwnPropertyDescriptor(Qe.prototype,"setAudioFrameCallback"),Qe.prototype),re(Qe.prototype,"play",[uP,hP],Object.getOwnPropertyDescriptor(Qe.prototype,"play"),Qe.prototype),re(Qe.prototype,"stop",[pP,fP],Object.getOwnPropertyDescriptor(Qe.prototype,"stop"),Qe.prototype),re(Qe.prototype,"close",[_P],Object.getOwnPropertyDescriptor(Qe.prototype,"close"),Qe.prototype),re(Qe.prototype,"pipe",[EP],Object.getOwnPropertyDescriptor(Qe.prototype,"pipe"),Qe.prototype),re(Qe.prototype,"unpipe",[mP],Object.getOwnPropertyDescriptor(Qe.prototype,"unpipe"),Qe.prototype),Qe),Tv=(gP=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),SP=fn(),TP=Cf("MicrophoneAudioTrack","_enabledMutex"),RP=yt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),vP=fn(),yP=yt({argsMap:t=>[t.getTrackId()]}),re((Ko=class extends an{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?Ev(e.encoderConfig):{},i,N("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),V(this,"_config",void 0),V(this,"_deviceName","default"),V(this,"_constraints",void 0),V(this,"_originalConstraints",void 0),V(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Rf()||mb())&&Se.bindInterruptDetectorTrack(this)}async setDevice(t){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await aa.getDeviceById(t),n={};n.audio=ze({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await ra(n,this.getTrackId())}catch(r){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await ra({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await aa.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}S.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),N("AUTO_RESET_AUDIO_ROUTE")&&(Hi()||is())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Ne(this,ft.NEED_DISABLE_TRACK,this)}catch(c){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=ze({},this._constraints),s=aa.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{n||(this._enabled=!0);const c=await ra({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Ne(this,ft.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Rf()||mb())&&Se.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Hi()||is())&&this._enabled&&!this._isClosed&&Se.duringInterruption){const t=async()=>{Se.off(ri.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Se.on(ri.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Nf.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=aa.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await ra({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(na.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(na.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[gP,SP],Object.getOwnPropertyDescriptor(Ko.prototype,"setDevice"),Ko.prototype),re(Ko.prototype,"setEnabled",[TP,RP,vP],Object.getOwnPropertyDescriptor(Ko.prototype,"setEnabled"),Ko.prototype),re(Ko.prototype,"close",[yP],Object.getOwnPropertyDescriptor(Ko.prototype,"close"),Ko.prototype),Ko),_G=(CP=yt({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),AP=fn(),bP=yt({argsMap:t=>[t.getTrackId()]}),IP=fn(),OP=yt({argsMap:t=>[t.getTrackId()]}),wP=fn(),NP=yt({argsMap:t=>[t.getTrackId()]}),DP=fn(),LP=yt({argsMap:t=>[t.getTrackId()]}),PP=fn(),kP=yt({argsMap:t=>[t.getTrackId()]}),MP=yt({argsMap:t=>[t.getTrackId()]}),UP=fn(),re((Ei=class extends an{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),V(this,"source",void 0),V(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(ea.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(Nf.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){ye(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[CP,AP],Object.getOwnPropertyDescriptor(Ei.prototype,"startProcessAudioBuffer"),Ei.prototype),re(Ei.prototype,"pauseProcessAudioBuffer",[bP,IP],Object.getOwnPropertyDescriptor(Ei.prototype,"pauseProcessAudioBuffer"),Ei.prototype),re(Ei.prototype,"seekAudioBuffer",[OP,wP],Object.getOwnPropertyDescriptor(Ei.prototype,"seekAudioBuffer"),Ei.prototype),re(Ei.prototype,"resumeProcessAudioBuffer",[NP,DP],Object.getOwnPropertyDescriptor(Ei.prototype,"resumeProcessAudioBuffer"),Ei.prototype),re(Ei.prototype,"stopProcessAudioBuffer",[LP,PP],Object.getOwnPropertyDescriptor(Ei.prototype,"stopProcessAudioBuffer"),Ei.prototype),re(Ei.prototype,"close",[kP],Object.getOwnPropertyDescriptor(Ei.prototype,"close"),Ei.prototype),re(Ei.prototype,"setAudioBufferPlaybackSpeed",[MP,UP],Object.getOwnPropertyDescriptor(Ei.prototype,"setAudioBufferPlaybackSpeed"),Ei.prototype),Ei);class Dn extends an{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=kf().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,De(8,"track-mix-")),V(this,"trackList",void 0),V(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(S.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):S.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){S.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}sv(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof Dn?n.emit(Yu.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class EG extends xL{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(ea.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),V(this,"audioBuffer",void 0),V(this,"sourceNode",void 0),V(this,"startPlayTime",0),V(this,"startPlayOffset",0),V(this,"pausePlayTime",0),V(this,"options",void 0),V(this,"currentLoopCount",0),V(this,"currentPlaybackSpeed",100),V(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const xP=new Map;class Qb{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){V(this,"trackId",void 0),V(this,"config",void 0),V(this,"onFirstVideoFrameDecoded",void 0),V(this,"onVideoStateChanged",void 0),V(this,"freezeTimeCounterList",[]),V(this,"renderFreezeAccTime",0),V(this,"isKeepLastFrame",!1),V(this,"timeUpdatedCount",0),V(this,"freezeTime",0),V(this,"playbackTime",0),V(this,"lastTimeUpdatedTime",0),V(this,"autoplayFailed",!1),V(this,"videoTrack",void 0),V(this,"videoElement",void 0),V(this,"cacheVideoElement",void 0),V(this,"renderStats",void 0),V(this,"_videoState",Wo.VideoStateStopped),V(this,"videoElementCheckInterval",void 0),V(this,"videoElementFreezeTimeout",void 0),V(this,"_videoElementStatus",xi.NONE),V(this,"isGettingVideoDimensions",!1),V(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),V(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Se.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(VD())),KD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),V(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=xi.PLAYING;break;case"loadeddata":if(this.videoState=Wo.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=xi.CANPLAY;break;case"stalled":this.videoElementStatus=xi.STALLED;break;case"suspend":this.videoElementStatus=xi.SUSPEND;break;case"pause":this.videoElementStatus=xi.PAUSED,Hi()||is()||hi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=xi.WAITING;break;case"abort":this.videoElementStatus=xi.ABORT;break;case"ended":this.videoElementStatus=xi.ENDED;break;case"emptied":this.videoElementStatus=xi.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=xi.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Gc.lastVisibleTime<Gc.lastHiddenTime||s<Gc.lastHiddenTime||s<Gc.lastVisibleTime)return;for(r>N("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),V(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(VD())),KD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Se.on(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Se.on(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&WL(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),r)});const i=ne();if((i.name==="Safari"&&Number(i.version)===15||Rf())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new at((s,c)=>{i.toBlob(async l=>{if(i.remove(),l){const u=await $L(l);s({buffer:u,width:i.width,height:i.height})}else c(new G(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await Jb(e)}destroy(){this.renderStats=void 0,Se.off(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Se.off(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Wo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=xi.INIT,!this.videoElementCheckInterval&&(VP.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=xi.DESTROYED)},1e3),N("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let s;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,N("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Wo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Wo.VideoStateFrozen:document.addEventListener("visibilitychange",c))},u=(h,p)=>{if(this.videoElementStatus===xi.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=p.mediaTime):this.renderStats={lastTs:p.mediaTime,curTs:p.mediaTime,lastRenderNum:0,renderNum:0},s){const g=p.presentationTime-s.presentationTime;this.videoState===Wo.VideoStateStarting&&(this.videoState=Wo.VideoStateDecoding),this.videoState===Wo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,N("VIDEO_FREEZE_DURATION"))),g<N("VIDEO_FREEZE_DURATION")&&this.videoState===Wo.VideoStateFrozen&&(this.videoState=Wo.VideoStateDecoding),g>N("VIDEO_FREEZE_DURATION")&&Gc.lastVisibleTime>=Gc.lastHiddenTime&&s.timestamp>Gc.lastVisibleTime&&s.timestamp>Gc.lastHiddenTime&&(this.renderFreezeAccTime+=g)}s=ze(ze({},p),{},{timestamp:h})}var _,E;N("ENABLE_VIDEO_FRAME_CALLBACK")&&((_=(E=this.videoElement).requestVideoFrameCallback)===null||_===void 0||_.call(E,u))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,u)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),av()&&!N("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=ne();i.name==="Safari"&&Number(i.version)===15||Rf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ze()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Ze()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(s=>{S.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){VP.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=xi.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{S.error(i)}),this.autoplayFailed=!1,jm()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};jm()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),HL()}}const VP=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class BP extends Qb{constructor(e){super(e),V(this,"container",void 0),V(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await Jb(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",N("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var FP,jP,GP,HP,WP,KP,YP,zP,qP,XP,JP,QP,ZP,$P,tk,ek,nk,ik,rk,ak,sk,ok,ck,lk,$t,dk,uk,hk,pk,fk,_k,Ek,mk,oa;let Fe=(FP=yt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),jP=fn(),GP=yt({argsMap:t=>[t.getTrackId()]}),HP=Cf("LocalVideoTrack","_enabledMutex"),WP=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),KP=fn(),YP=Cf("LocalVideoTrack","_enabledMutex"),zP=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),qP=fn(),XP=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),JP=fn(),QP=fn(),ZP=yt({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),$P=fn(),tk=fn(),ek=fn(),nk=fn(),ik=fn(),rk=fn(),ak=fn(),sk=yt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),ok=yt({argsMap:t=>[t.getTrackId()]}),ck=yt({argsMap:t=>[t.getTrackId()]}),lk=yt({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),$t=class Q2 extends Pf{get videoHeight(){if(hi()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(hi()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,s,c){if(super(e,s),V(this,"trackMediaType",Lf.VIDEO),V(this,"_player",void 0),V(this,"isUseScaleResolutionDownBy",!1),V(this,"_videoVisibleTimer",null),V(this,"_previousVideoVisibleStatus",void 0),V(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),V(this,"_encoderConfig",void 0),V(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),V(this,"_optimizationMode",void 0),V(this,"_videoHeight",void 0),V(this,"_videoWidth",void 0),V(this,"_forceBitrateLimit",void 0),V(this,"_enabled",!0),V(this,"_processorDestination",void 0),V(this,"_processorContext",void 0),hi()){const{width:l,height:u}=e.getSettings();this._videoWidth=l,this._videoHeight=u}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],this._hints.indexOf(Le.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(fb(ce.CHROME,115)&&iv().indexOf("Windows")!==-1){const l=function(u,h){if("VideoFrame"in window&&"TransformStream"in window&&ae().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(u),_=new MediaStreamTrackGenerator({kind:"video"});let E,g,C=Date.now();const v=()=>{y&&(clearInterval(y),y=void 0),E&&(E.close(),E=void 0),u.stop(),g=void 0,_.removeEventListener("ended",v)};let y=window.setInterval(()=>{if(g&&E&&Date.now()-C>1e3)try{_.readyState==="live"?g.enqueue(E.clone()):v()}catch{v()}},1e3);const b=new TransformStream({transform:(I,L)=>{_.readyState==="live"?(g=L,C=Date.now(),E===void 0?(E=I,L.enqueue(I.clone())):(L.enqueue(E),E=I)):I.close()}});return _.addEventListener("ended",v),p.readable.pipeThrough(b).pipeTo(_.writable),_}}(e);l&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(Le.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new YL(this.getTrackId(),"local"),this._processorDestination=new KL(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=ze(ze(ze({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new Qb(i):this._player=new BP(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Nf.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Ne(this,ft.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Ne(this,ft.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ne(this,ft.NEED_MUTE_TRACK,this):await Ne(this,ft.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new G(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=Ho(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=Sv({encoderConfig:e});(hi()||Hi()||is())&&(i.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const s=new G(O.UNEXPECTED_ERROR,r.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(Le.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ne(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(S)}}getStats(){return nd(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Zr(this,ft.GET_STATS)||ze({},Hb)}async setBeautyEffect(e){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await Jb(e)}async setBitrateLimit(e){S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void S.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Ne(this,ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return S.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){XL(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(cv)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new G(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=Ho(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Le.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ne(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:s}=this._encoderConfig;if(s==null||r==null){const{max:c,min:l}=function(u,h,p,_,E){const g=N("BITRATE_ADAPTER_TYPE");if(g==="DEFAULT_BITRATE")return{min:_,max:E};if(E===void 0){var C;const y=Math.floor(200*Math.pow(p/15,.6)*Math.pow(u*h/640/360,.75));E=g==="STANDARD_BITRATE"?4*y:2*y,_=(C=_)!==null&&C!==void 0?C:y}else{var v;_=(v=_)!==null&&v!==void 0?v:Math.floor(E/10)}return{min:_,max:E}}(e,n,i,s,r);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:s,slot:c}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=JD.checkOneElementVisible(s),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const h=gt.reportApiInvoke(null,{tag:tn.TRACER,name:bn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(i){throw new G(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ze(ze({},i),Ho(e))),i=Gu(i);const r=De(8,"track-video-cloned-"),s=new Q2(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Gu(this._scalabilityMode),this._optimizationMode,r,Gu(this._hints));return e&&i&&s.setEncoderConfiguration(i),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new G(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new G(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(nd(()=>{gt.reportApiInvoke(null,{name:bn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:tn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!N("ENABLE_VIDEO_SEI")||!N("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new G(O.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void S.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):S.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Wi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Ne(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ne(this,ft.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(na.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(na.REQUEST_CONSTRAINTS)}},re($t.prototype,"play",[FP,jP],Object.getOwnPropertyDescriptor($t.prototype,"play"),$t.prototype),re($t.prototype,"stop",[GP],Object.getOwnPropertyDescriptor($t.prototype,"stop"),$t.prototype),re($t.prototype,"setEnabled",[HP,WP,KP],Object.getOwnPropertyDescriptor($t.prototype,"setEnabled"),$t.prototype),re($t.prototype,"setMuted",[YP,zP,qP],Object.getOwnPropertyDescriptor($t.prototype,"setMuted"),$t.prototype),re($t.prototype,"setEncoderConfiguration",[XP,JP],Object.getOwnPropertyDescriptor($t.prototype,"setEncoderConfiguration"),$t.prototype),re($t.prototype,"getStats",[QP],Object.getOwnPropertyDescriptor($t.prototype,"getStats"),$t.prototype),re($t.prototype,"setBeautyEffect",[ZP,$P],Object.getOwnPropertyDescriptor($t.prototype,"setBeautyEffect"),$t.prototype),re($t.prototype,"getCurrentFrameData",[tk],Object.getOwnPropertyDescriptor($t.prototype,"getCurrentFrameData"),$t.prototype),re($t.prototype,"getCurrentFrameImage",[ek],Object.getOwnPropertyDescriptor($t.prototype,"getCurrentFrameImage"),$t.prototype),re($t.prototype,"setBitrateLimit",[nk],Object.getOwnPropertyDescriptor($t.prototype,"setBitrateLimit"),$t.prototype),re($t.prototype,"setOptimizationMode",[ik],Object.getOwnPropertyDescriptor($t.prototype,"setOptimizationMode"),$t.prototype),re($t.prototype,"setScalabiltyMode",[rk],Object.getOwnPropertyDescriptor($t.prototype,"setScalabiltyMode"),$t.prototype),re($t.prototype,"updateMediaStreamTrackResolution",[ak],Object.getOwnPropertyDescriptor($t.prototype,"updateMediaStreamTrackResolution"),$t.prototype),re($t.prototype,"pipe",[sk],Object.getOwnPropertyDescriptor($t.prototype,"pipe"),$t.prototype),re($t.prototype,"unpipe",[ok],Object.getOwnPropertyDescriptor($t.prototype,"unpipe"),$t.prototype),re($t.prototype,"close",[ck],Object.getOwnPropertyDescriptor($t.prototype,"close"),$t.prototype),re($t.prototype,"replaceTrack",[lk],Object.getOwnPropertyDescriptor($t.prototype,"replaceTrack"),$t.prototype),$t),Zb=(dk=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),uk=fn(),hk=Cf("CameraVideoTrack","_enabledMutex"),pk=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),fk=fn(),_k=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),Ek=fn(),mk=yt({argsMap:t=>[t.getTrackId()]}),oa=class Z2 extends Fe{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,s,c){super(e,Ho(n.encoderConfig),r,s,c),V(this,"_config",void 0),V(this,"_originalConstraints",void 0),V(this,"_constraints",void 0),V(this,"_enabled",!0),V(this,"_deviceName","default"),V(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Rf()||mb())&&!function(){const l=ne();if(l.os!==Bn.IOS||!l.osVersion)return!1;const u=l.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2}()&&YD()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=Ho(this._config.encoderConfig),Se.on(ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Se.on(ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await aa.getDeviceById(e),i={};i.video=ze({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ra(i,this.getTrackId())}catch(s){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await ra({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await aa.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:ze(ze({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await ra(n,this.getTrackId())}catch(r){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await ra({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=ze({},n.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await ra({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Ne(this,ft.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Ne(this,ft.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new G(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Ho(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=en(this._config);i.encoderConfig=e;const r=Sv(i);(hi()||Hi()||is())&&(r.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){const c=new G(O.UNEXPECTED_ERROR,s.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(Le.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ne(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(S)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Hi()||is())&&this._enabled&&!this._isClosed&&Se.duringInterruption){const e=async()=>{Se.off(ri.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Se.on(ri.IOS_INTERRUPTION_END,e)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Nf.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=aa.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await ra({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Se.off(ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Se.off(ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ze(ze({},i),Ho(e))),i=Gu(i);const r=De(8,"track-cam-cloned-"),s=new Z2(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Gu(ze(ze({},this._config),{},{encoderConfig:i})),Gu(this._constraints),Gu(this._scalabilityMode),this._optimizationMode,r);return e&&i&&s.setEncoderConfiguration(i),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(na.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(na.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},re(oa.prototype,"setDevice",[dk,uk],Object.getOwnPropertyDescriptor(oa.prototype,"setDevice"),oa.prototype),re(oa.prototype,"setEnabled",[hk,pk,fk],Object.getOwnPropertyDescriptor(oa.prototype,"setEnabled"),oa.prototype),re(oa.prototype,"setEncoderConfiguration",[_k,Ek],Object.getOwnPropertyDescriptor(oa.prototype,"setEncoderConfiguration"),oa.prototype),re(oa.prototype,"close",[mk],Object.getOwnPropertyDescriptor(oa.prototype,"close"),oa.prototype),oa);function $b(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=ze(ze({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?S.debug("[".concat(t,"] set content hint to"),n.optimizationMode):S.debug("[".concat(t,"] set content hint failed")))):S.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var gk,Sk,Tk,Rk,wa,vk,yk,Ck,Ak,bk,Ik,Vi;class Ok extends kL{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(De(5,""))),V(this,"_userId",void 0),V(this,"_uintId",void 0),V(this,"_isDestroyed",!1),V(this,"store",void 0),V(this,"processor",void 0),V(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Uf=(gk=yt({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Sk=yt({argsMap:t=>[t.getTrackId()]}),Tk=yt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Rk=yt({argsMap:t=>[t.getTrackId()]}),re((wa=class extends Ok{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),V(this,"_videoVisibleTimer",null),V(this,"_previousVideoVisibleStatus",void 0),V(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),V(this,"trackMediaType",Lf.VIDEO),V(this,"_videoWidth",void 0),V(this,"_videoHeight",void 0),V(this,"_player",void 0),V(this,"processorDestination",void 0),V(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new YL(this.getTrackId(),"remote"),this.processorDestination=new KL(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return nd(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Zr(this,ft.GET_STATS)||ze({},LL)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=ze(ze({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new Qb(n):this._player=new BP(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Df.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(Df.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Df.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){XL(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(cv)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const c=JD.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=gt.reportApiInvoke(null,{tag:tn.TRACER,name:bn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new G(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Wi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wi.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(Yu.SEI_RECEIVED,t)}}).prototype,"play",[gk],Object.getOwnPropertyDescriptor(wa.prototype,"play"),wa.prototype),re(wa.prototype,"stop",[Sk],Object.getOwnPropertyDescriptor(wa.prototype,"stop"),wa.prototype),re(wa.prototype,"pipe",[Tk],Object.getOwnPropertyDescriptor(wa.prototype,"pipe"),wa.prototype),re(wa.prototype,"unpipe",[Rk],Object.getOwnPropertyDescriptor(wa.prototype,"unpipe"),wa.prototype),wa),xf=(vk=yt({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),yk=yt({argsMap:(t,e)=>[t.getTrackId(),e]}),Ck=yt({argsMap:t=>[t.getTrackId()]}),Ak=yt({argsMap:t=>[t.getTrackId()]}),bk=yt({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Ik=yt({argsMap:t=>[t.getTrackId()]}),re((Vi=class extends Ok{get isPlaying(){return this._useAudioElement?ir.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),V(this,"trackMediaType",Lf.AUDIO),V(this,"_source",void 0),V(this,"_useAudioElement",!0),V(this,"_volume",100),V(this,"processorContext",void 0),V(this,"processorDestination",void 0),V(this,"_played",!1),V(this,"_bypassWebAudio",!1),N("DISABLE_WEBAUDIO")?(this._source=new Xb,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new VL(t,!0),N("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ea.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Df.FIRST_FRAME_DECODED)}),this.processorContext=new qL(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new zL(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ea.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ea.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ea.ON_AUDIO_BUFFER),this._source.on(ea.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?ir.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!OL())throw new G(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ir.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return nd(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Zr(this,ft.GET_STATS)||ze({},DL)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),ir.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ir.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ir.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Wi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Wi.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wi.ON_TRACK),this.processorDestination.removeAllListeners(Wi.ON_NODE)}}).prototype,"setVolume",[vk],Object.getOwnPropertyDescriptor(Vi.prototype,"setVolume"),Vi.prototype),re(Vi.prototype,"setPlaybackDevice",[yk],Object.getOwnPropertyDescriptor(Vi.prototype,"setPlaybackDevice"),Vi.prototype),re(Vi.prototype,"play",[Ck],Object.getOwnPropertyDescriptor(Vi.prototype,"play"),Vi.prototype),re(Vi.prototype,"stop",[Ak],Object.getOwnPropertyDescriptor(Vi.prototype,"stop"),Vi.prototype),re(Vi.prototype,"pipe",[bk],Object.getOwnPropertyDescriptor(Vi.prototype,"pipe"),Vi.prototype),re(Vi.prototype,"unpipe",[Ik],Object.getOwnPropertyDescriptor(Vi.prototype,"unpipe"),Vi.prototype),Vi);const Gc=new class extends Je{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),V(this,"_lastHiddenTime",0),V(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),S.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class wk extends Je{constructor(e,n){super(),V(this,"trackMediaType",Lf.DATA),V(this,"_version",1),V(this,"_type",3),V(this,"_config",void 0),V(this,"_originDataChannel",void 0),V(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),V(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),V(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return N("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new at((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new G(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new G(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new G(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[mv.OPEN,mv.CLOSE,mv.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class mG extends wk{constructor(e){super(e),V(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(N("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(mv.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class gG extends wk{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function Rv(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>RR.revokeObjectURL(t),0),new Worker(RR.createObjectURL(t))}const Nk=71,tI=1,eI=2,nI=1,Dk=2;var Hc=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Hc||{});function Lk(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==Nk)return;const i=t.getUint16(1),r=tI+eI+i,s=new Uint8Array(t.byteLength-r);s.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:s};let l=tI+eI;for(;l<r;){const u=t.getUint8(l),h=t.getUint16(l+nI),p=nI+Dk;if(u===Hc.AUDIO_LEVEL){let _=t.getUint8(l+p);for(let E=1;E<h;E++)_=_<<8|t.getUint8(l+p+E);c.tlv.push({tag:u,length:h,value:e?127^_>>1:127&_})}else if(u===Hc.METADATA||u===Hc.AUDIO_64_BIT_PTS){const _=new Uint8Array(h);for(let E=0;E<h;E++)_[E]=t.getUint8(l+p+E);c.tlv.push({tag:u,length:h,value:_})}l+=p+h}return c}const vv=new Map,yv=127,Xu=1e-10,iI=139/13,Cv=new Map;function rI(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return Cv.has(i)?r=Cv.get(i):(r=Math.log(function(c,l){const u=c-l;l<u&&(l=u);let h=1;for(let p=c,_=1;p>l;p--,_++)h=h*p/_;return h}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,Cv.set(i,r)),r<Xu&&(r=Xu),r}function Pk(t,e,n){const i=e.length,r=t.length/i;let s=!1;for(let c=0,l=0;c<i;c++){let u=0;for(let h=l+r;l<h;l++)t[l]>n&&u++;e[c]!==u&&(e[c]=u,s=!0)}return s}window.cache=Cv;let SG=0;class kk{constructor(e){V(this,"id",void 0),V(this,"immediates",[]),V(this,"lastNonSilence",-1),V(this,"immediateSpeechActivityScore",Xu),V(this,"lastLevelChangedTime",Date.now()),V(this,"levels",[]),V(this,"longs",[]),V(this,"longSpeechActivityScore",Xu),V(this,"mediums",[]),V(this,"mediumSpeechActivityScore",Xu),V(this,"minLevel",0),V(this,"nextMinLevel",0),V(this,"nextMinLevelWindowLength",0),V(this,"energyScore",0),this.id=e||"".concat(SG++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+iI;let r=!1;for(let s=0;s<e.length;++s){let c=n[s];c<i&&(c=0);const l=Math.floor(c/iI);e[s]!==l&&(e[s]=l,r=!0)}return r}computeLongs(){return Pk(this.mediums,this.longs,4)}computeMediums(){return Pk(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=rI(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=rI(this.longs[0],10,47),this.longSpeechActivityScore>Xu&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=rI(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(Gd(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>yv&&(i=yv),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+iI?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>yv&&(n=yv),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class TG{constructor(e){V(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class aI{constructor(e,n,i){V(this,"isDominant",void 0),V(this,"energyRanking",void 0),V(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class RG extends Je{constructor(e){super(),V(this,"dominantId",null),V(this,"lastDecisionTime",0),V(this,"lastLevelChangedTime",0),V(this,"lastLevelIdleTime",0),V(this,"relativeSpeechActivities",[]),V(this,"speakers",new Map),V(this,"enableSilence",!1),V(this,"timeoutToSilenceInterval",0),V(this,"decisionMaker",null),V(this,"loudest",[]),V(this,"numLoudestToTrack",3),V(this,"energyExpireTimeMs",250),V(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const s=r.levelChanged(n,i);return this.updateLoudestList(r,s,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new kk(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let u=0;for(;u<this.loudest.length&&this.loudest[u]!==e;)++u;return new aI(r,u,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new aI(r,0,e.energyScore);const s=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const u=this.loudest[c];if(u.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(u.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new aI(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new TG(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let s=null;if(r===0)s=null;else if(r===1){var c;const l=Tr(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(s=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],l=p.value[1])}else s=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const u=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[_,E]=p;if(E===l)continue;E.evaluateSpeechActivityScores(e);for(let y=0;y<u.length;++y){const b=l==null?Xu:l.getSpeechActivityScore(y);u[y]=Math.log(E.getSpeechActivityScore(y)/b)}const g=u[0],C=u[1],v=u[2];g>3&&C>2&&v>0&&C>h&&(h=C,s=_)}this.enableSilence&&l!=null&&s===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of Tr(i=this.speakers).call(i)){var i;const s=e-r.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<s&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const Vf=new Map;let zs=null,Av=null;const Mk=3;let Ju=[];const qs=new Map,bv=new Map;class vG{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){V(this,"id",void 0),V(this,"track",void 0),V(this,"score",0),V(this,"active",!0),V(this,"muted",!1),V(this,"timer",0),V(this,"actives",0),V(this,"inactives",0),this.id=e,this.track=n,this.setActive(qs.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],s=[];return Array.from(Tr(qs).call(qs)).forEach(c=>{c.active?r.push(c):s.push(c)}),{actives:r,inactives:s}}();if(n.length>3){let r;n.forEach(s=>{(!r||r.score>s.score)&&(r=s)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(s=>{(!r||r.score<s.score)&&s.id!==this.id&&(r=s)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(Tr(qs).call(qs)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(Tr(qs).call(qs)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let Iv;function Uk(t){const e=qs.get(t);e&&(qs.delete(t),e.clearTimer())}const Ov=new Map,yG=new Map;function CG(t,e,n){let i=new Uint8Array(t,e,n),r=[],s=0;for(;r.length<n;)s+3<n&&i[s]===0&&i[s+1]===0&&i[s+2]===3&&(i[s+3]===0||i[s+3]===1||i[s+3]===2||i[s+3]===3)?(r.push(i[s],i[s+1],i[s+3]),s+=4):(r.push(i[s]),s++);return new Uint8Array(r)}const wv=new Map,Qm=new Map;(function(){const t=ne();ii.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ii.getStreamFromExtension=t.name===ce.CHROME&&Number(t.version)>34,ii.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),ii.supportMinBitrate=t.name===ce.CHROME||t.name===ce.EDGE,ii.supportSetRtpSenderParameters=function(){const e=ne();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Bc()||!(!hi()&&!rv())||e.name===ce.FIREFOX&&Number(e.version)>=64)}(),t.name===ce.SAFARI&&(Number(t.version)>=14?ii.supportDualStream=!0:ii.supportDualStream=!1),ii.webAudioMediaStreamDest=function(){const e=ne();return!(e.name===ce.SAFARI&&Number(e.version)<12)}(),ii.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ii.supportWebGL=typeof WebGLRenderingContext<"u",ii.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Bc()||(ii.webAudioWithAEC=!0),ii.supportShareAudio=function(){const e=ne();return(e.os===Bn.WIN_10||e.os===Bn.WIN_81||e.os===Bn.WIN_7||e.os===Bn.LINUX||e.os===Bn.MAC_OS||e.os===Bn.CHROMIUM_OS)&&e.name===ce.CHROME&&Number(e.version)>=74}(),ii.supportDataChannel=!!(Fm(76)||function(e){const n=ne();return!(n.name!==ce.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||jD(14)),ii.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Ze()&&!!e&&e.prototype.setConfiguration instanceof Function}(),ii.supportWebRTCEncodedTransform=function(){const e=ne();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),ii.supportWebRTCInsertableStream=function(){const e=ne();return(e.name===ce.CHROME||e.name===ce.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ii.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ii.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,ov(()=>{ii.supportDualStreamEncoding=function(){const e=ne();return!!N("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&N("CHROME_DUAL_STREAM_USE_ENCODING"))}(),S.debug("browser ua: ",navigator.userAgent),S.info("browser info: ",t),S.info("browser compatibility: ",ii)})})();const AG=["CHINA","GLOBAL"],xk=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Qu=[],Bf=[];function Zu(t,e){return!!e&&Qu.some(n=>n.uid===t&&n.channelName===e)}function sI(){return Bf.length>0}var bG=aN.forEach,Vk=tr("forEach")?[].forEach:function(t){return bG(this,t,arguments.length>1?arguments[1]:void 0)};Ee({target:"Array",proto:!0,forced:[].forEach!=Vk},{forEach:Vk});var IG=Zi("Array").forEach,OG=ha,wG=Zn,NG=ue,DG=IG,oI=Array.prototype,LG={DOMTokenList:!0,NodeList:!0},PG=function(t){var e=t.forEach;return t===oI||NG(oI,t)&&e===oI.forEach||wG(LG,OG(t))?DG:e},kG=Vt(PG),MG=Va,Bk=zd;Ee({target:"Object",stat:!0,forced:Xt(function(){Bk(1)})},{keys:function(t){return Bk(MG(t))}});var Fk=Vt(Pr.Object.keys),UG=Vt(Bd),xG=Vt(jd),VG=Ee,jk=Li,BG=Pl,FG=Ni,Gk=Dh,jG=gs,GG=no,HG=Ca,WG=Xe,KG=uu,YG=Xw("slice"),zG=WG("species"),cI=Array,qG=Math.max;VG({target:"Array",proto:!0,forced:!YG},{slice:function(t,e){var n,i,r,s=GG(this),c=jG(s),l=Gk(t,c),u=Gk(e===void 0?c:e,c);if(jk(s)&&(n=s.constructor,(BG(n)&&(n===cI||jk(n.prototype))||FG(n)&&(n=n[zG])===null)&&(n=void 0),n===cI||n===void 0))return KG(s,l,u);for(i=new(n===void 0?cI:n)(qG(u-l,0)),r=0;l<u;l++,r++)l in s&&HG(i,r,s[l]);return i.length=r,i}});var XG=Zi("Array").slice,JG=ue,QG=XG,lI=Array.prototype,ZG=function(t){var e=t.slice;return t===lI||JG(lI,t)&&e===lI.slice?QG:e},$G=Vt(ZG);function Et(t,e,n,i,r){var s,c,l,u={};return kG(s=Fk(i)).call(s,function(h){u[h]=i[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=UG(c=xG(l=$G(n).call(n)).call(l)).call(c,function(h,p){return p(t,e,h)||h},u),r&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(r):void 0,u.initializer=void 0),u.initializer===void 0&&(Kw(t,e,u),u=null),u}let Nv=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),dI=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ss=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Ki=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),vt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),ke=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),It=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),At=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),Zm=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Yt=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Yi=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Pt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function Dv(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw S.error("Invalid Channel Name ".concat(t)),new B(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Lv(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||XD(t,1,255)))throw new B(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Wc=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const t4={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},uI={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function hI(t,e){ei(t.url,"".concat(e,".url"),1,1e3,!1),$e(t.x)||ye(t.x,"".concat(e,".x"),0,1e4),$e(t.y)||ye(t.y,"".concat(e,".y"),0,1e4),$e(t.width)||ye(t.width,"".concat(e,".width"),0,1e4),$e(t.height)||ye(t.height,"".concat(e,".height"),0,1e4),$e(t.zOrder)||ye(t.zOrder,"".concat(e,".zOrder"),0,255),$e(t.alpha)||ye(t.alpha,"".concat(e,".alpha"),0,1,!1)}const e4={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let ad=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),pI=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Ln=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function Hk(t){if(!t.channelName)throw new B(O.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new B(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ei(t.token,"info.token",1,2047),Lv(t.uid),Dv(t.channelName),!0}let zi=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Kc=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Cr=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Ff=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),fe=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),Yn=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),Pv=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),jn=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),le=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const Wk=[le.AFRICA,le.ASIA,le.CHINA,le.EUROPE,le.GLOBAL,le.INDIA,le.JAPAN,le.NORTH_AMERICA,le.OCEANIA,le.OVERSEA,le.SOUTH_AMERICA];let yi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const kv={CHINA:{},ASIA:{CODE:yi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:yi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:yi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:yi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:yi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:yi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:yi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:yi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:yi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:yi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:yi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:yi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:yi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};kb&&(kv.CHINA={CODE:yi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let $m=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function Kk(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class Yk extends Je{constructor(e,n){super(),A(this,"onICEConnectionStateChange",void 0),A(this,"onConnectionStateChange",void 0),A(this,"onDTLSTransportStateChange",void 0),A(this,"onDTLSTransportError",void 0),A(this,"onICETransportStateChange",void 0),A(this,"onFirstAudioReceived",void 0),A(this,"onFirstVideoReceived",void 0),A(this,"onFirstAudioDecoded",void 0),A(this,"onFirstVideoDecoded",void 0),A(this,"onFirstVideoDecodedTimeout",void 0),A(this,"onSelectedLocalCandidateChanged",void 0),A(this,"onSelectedRemoteCandidateChanged",void 0),A(this,"onICECandidateError",void 0),A(this,"getLocalVideoStats",void 0)}}class zk extends Yk{constructor(e,n){super(e,n),A(this,"establishPromise",void 0)}}let ht=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ci=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),Yc=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const qk=["disconnected","failed"];let q=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),pe=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Rt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),os=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),cs=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),zn=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Xk=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Yo=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Na=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Xs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),jf=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),_n=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Gf=function(t){return t.ABORT="abort",t}({}),sd=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),n4=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const i4={[Nv.ACCESS_POINT]:{[Ki.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ki.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ki.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ki.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ki.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ki.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ki.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Nv.UNILBS]:{[ss.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ss.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ss.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ss.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ss.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ss.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ss.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ss.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ss.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ss.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ss.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ss.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Nv.STRING_UID_ALLOCATOR]:{[dI.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[dI.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[dI.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Hf(t){const e=i4[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===Nv.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const r4={[vt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[vt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[vt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[vt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[vt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[vt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[vt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[vt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[vt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[vt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[vt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[vt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[vt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[vt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[vt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[vt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[vt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[vt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[vt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[vt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[vt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[vt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[vt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[vt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[vt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[vt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[vt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[vt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[vt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[vt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[vt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[vt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[vt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[vt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[vt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[vt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[vt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[vt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[vt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[vt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[vt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[vt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[vt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[vt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[vt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[vt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[vt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[vt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[vt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[vt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[vt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[vt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[vt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[vt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[vt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[vt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[vt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[vt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[vt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[vt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[vt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[vt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[vt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function tg(t){return r4[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function Jk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function fI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Jk(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Jk(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Qk(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const s=N("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(s,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const a4=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,s4=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,o4=/wss:\/\/(.+):([0-9]+)\/?/,c4=/wss:\/\/(.[^\/]+)\/?/;let l4=0;class d4{constructor(e,n){A(this,"id",0),A(this,"store",void 0),A(this,"recordIndex",void 0),A(this,"websockets",[]),A(this,"try443PortDuration",2e3),A(this,"forceCloseWSDuration",5e3),A(this,"try443PortTimeout",null),A(this,"forceCloseTimeout",null),A(this,"isTry443PortFailed",!1),A(this,"isNormalPortFailed",!1),A(this,"useDoubleDomain",!1),A(this,"useProxy",!1),A(this,"startTime",Date.now()),this.id=++l4,this.try443PortDuration=N("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];S.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=N("GATEWAY_DOMAINS"),s=Date.now(),c=[],l=r.find(E=>{var g;return it(g=e.host).call(g,E)});l||(this.useDoubleDomain=!1);const u=[];if(this.useDoubleDomain)r.forEach(E=>{u.push(Qk(fI(fI({},e),{},{host:e.host.replace(l,E)}),n))});else{const E=fI({},e);if(n&&l){const g=r.find(C=>C!==l);g&&(E.host=E.host.replace(l,g))}u.push(Qk(E,n))}try{u.forEach(E=>{const g=new WebSocket(E);g.binaryType="arraybuffer",c.push(g),this.logger("ws is connecting:",g.url)})}catch(E){if(this.logger("ws create failed"),c.forEach(g=>g.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new B(O.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const h=Bm();this.store&&this.store.recordJoinChannelService({urls:c.map(E=>E.url),service:"gateway"},this.recordIndex),c.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(g=>{g!==E&&(g.onopen=null,g.onclose=null,g.onmessage=null,g.close(),this.logger("close backup websocket: ".concat(g.url)))}),this.websockets.length=0,h.resolve(E)},E.onclose=g=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(E.readyState));const C=c.every(v=>v.readyState===WebSocket.CLOSED||v.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(C)),C&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(g.reason)),h.reject({code:g.code,reason:Pv.A_ROUND_WS_FAILED})):!n&&C&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),_()),n?this.isTry443PortFailed=C:this.isNormalPortFailed=C},E.onmessage=g=>this.logger("".concat(E.url," onmessage: ").concat(g.data))}),this.websockets.push(...c);const p=()=>{this.websockets.forEach(E=>E.readyState!==WebSocket.OPEN&&E.close())},_=()=>{if(h.isResolved)return p();ne().os===Bn.MAC_OS&&Ze()&&p(),this.createWebSocket(e,!0,!0).then(E=>{h.resolve(E)}).catch(E=>{this.isNormalPortFailed&&h.reject(E),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,_()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(s){let c,l,u;return[,c,l,u]=s.match(a4)||[],c||([,l,u]=s.match(s4)||[]),l&&u||([,l,u]=s.match(o4)||[]),l&&u||([,l]=s.match(c4)||[]),l||S.warning("un-destructible url: ",s),{proxy:c,host:l,port:u||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function Zk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class $k extends Je{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;it(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Pt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Pt.CONNECTED):this._state==="closed"?this.emit(Pt.CLOSED):this._state==="failed"&&this.emit(Pt.FAILED))}resetReconnectCount(e){S.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),A(this,"connectionID",0),A(this,"currentURLIndex",0),A(this,"urls",[]),A(this,"_reconnectMode","tryNext"),A(this,"reconnectReason",void 0),A(this,"_initMutex",void 0),A(this,"name",void 0),A(this,"_state","closed"),A(this,"reconnectInterrupter",void 0),A(this,"websocket",void 0),A(this,"retryConfig",void 0),A(this,"reconnectCount",0),A(this,"forceCloseTimeout",5e3),A(this,"onlineReconnectListener",void 0),A(this,"useCompress",void 0),A(this,"tryDoubleDomain",!1),A(this,"use443PortOnly",!1),A(this,"wsInflateLength",0),A(this,"wsDeflateLength",0),A(this,"closeEstablishingWs",()=>{}),A(this,"store",void 0),A(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(_){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?Zk(Object(g),!0).forEach(function(C){A(_,C,g[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(g)):Zk(Object(g)).forEach(function(C){Object.defineProperty(_,C,Object.getOwnPropertyDescriptor(g,C))})}return _}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=s,this._initMutex=new vi("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:u}=n,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*u)/10);jr.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),Rn.on(vf.NETWORK_STATE_CHANGE,(_,E)=>{_!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(_)),_===jr.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=u))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=Bm(),s=this.urls[this.currentURLIndex];N("ENABLE_PREALLOC_PC")&&this.emit(Xk.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(r.resolve).catch(r.reject),this.once(Pt.CLOSED,()=>{r.reject(new G(O.WS_DISCONNECT))}),this.once(Pt.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new G(O.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new G(O.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=Bm();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=p=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},s=async p=>{var _;if(S.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new G(O.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const E=Zr(this,Pt.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,g=await this.reconnectWithAction(E);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!g)return i.reject(new G(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);i.resolve()}},c=p=>{this.emit(Pt.ON_MESSAGE,p)},l=p=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),N("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=N("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),e);const u=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;const p=await this.chooseBestWebsocketConnection(e);this.websocket=p,r&&r(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this.joinGatewayRecordIndex=u}catch(p){const _=this.state==="closed",E=p instanceof G,g=E&&p.code===O.WS_ABORT,C=E&&p.code===O.WS_ERR,v=E?p.message:p&&(p.reason||p.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(v)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:g?"aborted":"error",errors:[p]},u),_||C?(i.reject(_?new G(O.WS_DISCONNECT,"websocket is closed: ".concat(v)):new G(O.WS_ERR,"init websocket failed: ".concat(v))),C&&S.error("[".concat(this.name,"] init websocket failed: ").concat(v))):s&&s(p)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Rn.isOnline||!Rn.onlineWaiter||(this.onlineReconnectListener=Rn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=bb(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await at.race([ni(c),this.onlineReconnectListener||new at(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit(Pt.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await fi(this,Pt.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var s;S.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(s=c.data)===null||s===void 0?void 0:s.desc;return Array.isArray(l)&&it(l).call(l,"dynamic key expired")?(this.emit(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class _I extends $k{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=Bm(),r=function(c,l){return new d4(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new G(O.WS_ABORT,"choose best websocket aborted"))};const s=N("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class eg extends $k{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new at((i,r)=>{let s=!1;const c=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),c.forEach(C=>{C.onclose=null,C.onopen=null,C.onmessage=null,C.close()}),r(new G(O.WS_ABORT,"choose best websocket aborted"))};const l=N("GATEWAY_DOMAINS");let u;const h=e.indexOf("?h="),p=l.find(C=>h!==-1?it(e).call(e,C,h):it(e).call(e,C));S.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let _=!this.tryDoubleDomain||!p;if(!_&&p){var E;const C=Date.now();try{l.forEach(v=>{const y=h===-1?e.replace(p,v):e.substr(0,h)+e.substr(h).replace(p,v),b=new WebSocket(y);b.binaryType="arraybuffer",c.push(b),S.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(y=>y.close());c.length;)c.pop();_=!0}(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:c.map(v=>v.url),service:"gateway"},n),c.forEach(v=>{v.onopen=()=>{if(s)return;const y=Date.now()-C;S.debug("[choose-best-ws] ws open cost ".concat(y,"ms")),c.filter(b=>b!==v).forEach(b=>{S.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,i(v)},v.onclose=y=>{u=y,!s&&(c.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),s=!0,r(u)))},v.onmessage=y=>{S.debug("[choose-best-ws]".concat(v.url," onmessage: ").concat(y.data))}}),ni(this.forceCloseTimeout).then(()=>{c.forEach(v=>{v.readyState!==WebSocket.OPEN&&v.close()})})}if(_){var g;let C;S.debug("[choose-best-ws] use single url: ",e),(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:[e],service:"gateway"},n);try{C=new WebSocket(e),c.push(C),C.binaryType="arraybuffer"}catch(v){const y=new G(O.WS_ERR,"init websocket failed! Error: ".concat(v.toString()));return S.error("[".concat(this.name,"]").concat(y)),void r(y)}C.onopen=()=>{i(C)},C.onclose=v=>{r(v)},C.onmessage=v=>{S.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(v.data))},ni(this.forceCloseTimeout).then(()=>{C&&C.readyState!==WebSocket.OPEN&&C.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class u4 extends Je{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===ke.CONNECTED?this.emit(It.WS_CONNECTED):e===ke.RECONNECTING?this.emit(It.WS_RECONNECTING,this._websocketReconnectReason):e===ke.CLOSED&&this.emit(It.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),A(this,"_disconnectedReason",void 0),A(this,"_websocketReconnectReason",void 0),A(this,"_connectionState",ke.CLOSED),A(this,"reconnectToken",void 0),A(this,"websocket",void 0),A(this,"openConnectionTime",void 0),A(this,"clientId",void 0),A(this,"lastMsgTime",Date.now()),A(this,"uploadCache",[]),A(this,"uploadCacheInterval",void 0),A(this,"rttRolling",new uL(5)),A(this,"pingpongTimer",void 0),A(this,"wsInflateDataTimer",void 0),A(this,"pingpongTimeoutCount",0),A(this,"joinResponse",void 0),A(this,"multiIpOption",void 0),A(this,"initError",void 0),A(this,"spec",void 0),A(this,"store",void 0),A(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(It.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Yt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Yt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(he.UID_BANNED);break;case 15:this.close(he.IP_BANNED);break;case 16:this.close(he.CHANNEL_BANNED)}if(r._type===Yt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case vt.ERR_LICENSE_MISSING:this.close(he.LICENSE_MISSING);break;case vt.ERR_LICENSE_EXPIRED:this.close(he.LICENSE_EXPIRED);break;case vt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(he.LICENSE_MINUTES_EXCEEDED);break;case vt.ERR_LICENSE_PERIOD_INVALID:this.close(he.LICENSE_PERIOD_INVALID);break;case vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(he.LICENSE_MULTIPLE_SDK_SERVICE);break;case vt.ERR_LICENSE_ILLEGAL:this.close(he.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new _I("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ke.CONNECTED&&this.reconnect("retry",pi.OFFLINE)})}async request(e,n,i,r){const s=De(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,u=()=>new at((C,v)=>{if(this.connectionState===ke.CONNECTED)return C();const y=()=>{this.off(It.WS_CLOSED,b),C()},b=()=>{this.off(It.WS_CONNECTED,y),v(new B(O.WS_ABORT))};this.once(It.WS_CONNECTED,y),this.once(It.WS_CLOSED,b),e!==At.PUBLISH&&e!==At.PUBLISH_DATASTREAM&&e!==At.SUBSCRIBE&&e!==At.SUBSCRIBE_DATASTREAM&&e!==At.UNSUBSCRIBE&&e!==At.UNSUBSCRIBE_DATASTREAM&&e!==At.UNPUBLISH&&e!==At.UNPUBLISH_DATASTREAM&&e!==At.CONTROL&&e!==At.RESTART_ICE||this.once(It.DISCONNECT_P2P,()=>{v(new B(O.DISCONNECT_P2P))}),e!==At.PUBLISH&&e!==At.RESTART_ICE||this.once(It.ABORT_P2P_EXECUTION,()=>{v(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==ke.CONNECTING&&this.connectionState!==ke.RECONNECTING||e===At.JOIN||e===At.REJOIN||await u(),this.websocket.sendMessage(c,!0),r)return;const h=new at((C,v)=>{let y=!1;const b=(L,U)=>{y=!0,C({isSuccess:L==="success",message:U||{}}),this.off(It.WS_CLOSED,I),this.off(It.WS_RECONNECTING,I),this.emit(It.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{v(new B(O.WS_ABORT,"type: ".concat(e))),this.off(It.WS_CLOSED,I),this.off(It.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(It.WS_CLOSED,I),this.once(It.WS_RECONNECTING,I),ni(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||y||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(It.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(C){if(this.connectionState===ke.CLOSED||e===At.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?C.throw():e===At.JOIN||e===At.REJOIN?null:(await u(),await this.request(e,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),E=tg(_),g=new B(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:E.desc});return E.action==="success"?p.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_,", message: ").concat(E.desc,", action: ").concat(E.action)),_===vt.ERR_TOO_MANY_BROADCASTERS?((e===At.JOIN||e===At.REJOIN)&&(this.initError=g,this.close()),g.throw()):E.action==="failed"?g.throw():E.action==="quit"?(this.initError=g,this.close(),g.throw()):(_===vt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",pi.MULTI_IP)):this.reconnect(E.action,pi.SERVER_ERROR),e===At.JOIN||e===At.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new at(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Zm.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ke.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new at((n,i)=>{this.once(It.WS_CONNECTED,()=>n(this.joinResponse)),this.once(It.WS_CLOSED,r=>i(this.initError||new B(O.WS_ABORT,r))),this.connectionState=ke.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||he.LEAVE,this.connectionState=ke.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(It.ABORT_P2P_EXECUTION);const e=await fi(this,It.REQUEST_JOIN_INFO),n=await this.request(At.JOIN,e);if(!n)return this.emit(It.REPORT_JOIN_GATEWAY,Pv.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(It.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ke.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Km(this,It.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(At.REJOIN,e);return!!n&&(this.connectionState=ke.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Yt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Yt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Yt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Yt.MUTE_AUDIO,{uid:i.uid}):this.emit(Yt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Yt.MUTE_VIDEO,{uid:i.uid}):this.emit(Yt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Yt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Yt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Yt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Yt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Yt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=tg(e.code);if(e.code===28&&"detail"in e&&(S.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(It.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(he.UID_BANNED),void this.close()):void this.reconnect(n.action,pi.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=N("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",pi.TIMEOUT):this.request(At.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),N("REPORT_STATS")&&this.send(At.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Zm.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Pt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(It.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Pt.CLOSED,()=>{this.connectionState=ke.CLOSED}),this.websocket.on(Pt.FAILED,()=>{this._disconnectedReason=he.NETWORK_ERROR,this.connectionState=ke.CLOSED}),this.websocket.on(Pt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===ke.CONNECTED?this.connectionState=ke.RECONNECTING:this.connectionState=ke.CONNECTING}),this.websocket.on(Pt.WILL_RECONNECT,(e,n,i)=>{const r=Km(this,It.IS_P2P_DISCONNECTED),s=r||e!=="retry";r&&e==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=Pv.P2P_DISCONNECTED),s&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(It.REPORT_JOIN_GATEWAY,n||Pv.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(It.DISCONNECT_P2P)),i(e)}),this.websocket.on(Pt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",pi.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(It.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof B){if(e.code===O.UNEXPECTED_RESPONSE&&e.data.code===vt.ERR_NO_AUTHORIZED)return this.initError=new B(O.TOKEN_EXPIRE,"dynamic key expired"),void this.close(he.TOKEN_EXPIRE);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",pi.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Pt.REQUEST_NEW_URLS,(e,n)=>{fi(this,It.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Xk.PRE_CONNECT_PC,()=>{this.emit(It.PRE_CONNECT_PC)})}}let h4=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),vn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function tM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Mv(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function od(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(N("TURN_DOMAIN")):(S.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function EI(t,e){t.addresses||(t.addresses=[]);const n=function(l,u){if(N("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(_=>{let{ip:E,port:g}=_;return{address:"".concat(E,":").concat(g)}});const h=N("GATEWAY_DOMAINS");let p=h[1]&&it(u).call(u,h[1])?1:0;return l.map(_=>{let{domain_prefix:E,port:g,ip:C}=_;if(E)return{address:"".concat(E,".").concat(h[p++%h.length],":").concat(g)};const v=/^[\.\:\d]+$/.test(C),y=v?"".concat(C.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(g):"".concat(C,":").concat(g);return v||S.debug("Cannot recognized as ip address: ".concat(C,", use as host")),{ip:C,port:g,address:y}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let u=0;u<l.length;u++){var r;const h=Ui(r=l[u]).call(r);n[u]&&h&&(n[u].ip6=h)}}const s=t.detail&&t.detail.candidate;let c;if(s){const[l,u]=s.split(":");l&&u&&(c={port:Number(u),ip:l,address:"".concat(l,":").concat(u)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Gr(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function eM(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(Gr(e.width),"x").concat(Gr(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function nM(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function ng(t,e){let n,i,r;switch(e){case vn.CHOOSE_SERVER:i=4096,r="choose server";break;case vn.CLOUD_PROXY:i=1048576,r="proxy";break;case vn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case vn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new B(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(s=>{s.buffer&&s.buffer.flag===i&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>Mv(Mv({},c),{},{ticket:s.buffer.cert})),server_ts:t.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:Mv(Mv({},s.buffer.detail),t.detail),flag:s.buffer.flag,opid:t.opid,cert:s.buffer.cert})}),!n)throw new B(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function iM(t,e){return await at.all(t.addresses.map(async n=>({address:N("USE_TURN_IP")?n.ip:od(n.ip),tcpport:n.port,udpport:n.port,username:e&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():_i.username,password:e&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await vb(e.toString()):_i.password})))}function mI(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(Gr(t.height),Gr(t.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function cd(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:s,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const u=r.split(".");u.length>=4&&(u[1]="*",u[2]="*"),l.address=u.join("."),l.port=s}return l}function Uv(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N("SVC_MODE");if(N("ENABLE_SVC"))return function(e){return e in uv}(t)?t:uv.L1T3}const rM={[ht.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ht.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function xv(t,e,n){e.forEach(i=>{var r;const s=rM[t].find(l=>{var u;let{key:h}=l;return it(u=i.extensionName).call(u,h)});if(!s)return;const c=n.find(l=>{let{extensionName:u}=l;return it(u).call(u,s.key)});c&&it(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function Wf(t,e){e.forEach(n=>{var i;const r=rM[t].find(s=>{var c;let{key:l}=s;return it(c=n.extensionName).call(c,l)});it(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function aM(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||it(t).call(t,"abs-send-time")}function Vv(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||it(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function sM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function oM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?sM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function ig(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:u}=e,{useXR:h}=n;let p=[],_=[],E=[],g=[],C=!1,v=!1;if(yr(t).mediaDescriptions.forEach(b=>{i&&i!==b.attributes.direction||(b.media.mediaType!=="video"||C||(_=b.attributes.payloads,g=b.attributes.extmaps,C=!0),b.media.mediaType!=="audio"||v||(p=b.attributes.payloads,E=b.attributes.extmaps,v=!0))}),!g||_.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!E||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(_.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),h&&b.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),h&&b.rtcpFeedbacks.push({type:"rrtr"})}),r&&(p=p.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"}),_=_.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"})),s&&(_=_.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),c&&(p=p.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(b=>{var I;return it(l).call(l,((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())||"")})),u&&(u==null?void 0:u.length)>0){const b=_.filter(I=>{var L;return it(u).call(u,((L=I.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())||"")});_=b.concat(r?[]:TI(b,_))}const y=N("UNSUPPORTED_VIDEO_CODEC");return y&&y.length>0&&(_=_.filter(b=>!(b.rtpMap&&it(y).call(y,b.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:_,audioExtensions:E,videoExtensions:g}}function ld(t){const e=yr(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const s=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:c}}if(!i){const s=r.attributes.fingerprints;s.length>0&&(i={fingerprints:s})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function cM(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const u=(l=i.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?u:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function lM(t,e,n){const{cname:i}=t;let r=[];e&&(r=dM(e)),r.length===0&&(r=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),S.debug("Using candidates from gateway."));const s={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const u=Fv(t.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:ht.VIDEO,ssrcId:p.v,rtx:p.v_rtx,mslabel:"".concat(p.v,"_").concat(p.a)},{kind:ht.AUDIO,ssrcId:p.a,mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:c,candidates:r,rtpCapabilities:u,setup:l,cname:i,preSSRCs:h}}function dM(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function $u(t,e,n){const i=[],r=[];return t.forEach(s=>{let{ssrcId:c,rtx:l}=s;const u=De(8,"track-"),h={ssrcId:c,attributes:oM({label:u,mslabel:n=n||De(10,""),msid:"".concat(n," ").concat(u)},e&&{cname:e})};if(i.push(h),l!==void 0){const p={ssrcId:l,attributes:oM({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},e&&{cname:e})};i.push(p),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:i,ssrcGroups:r}}function Kf(t,e){e instanceof an&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=e._encoderConfig;s&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(s.bitrate&&!Ze()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function gI(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function SI(t,e){var n;if(!(e instanceof Fe&&e._encoderConfig&&e._hints.indexOf(Le.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;ae().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var s,c;it(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),ae().supportMinBitrate&&!it(n=e._hints).call(n,Le.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var s,c;it(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(N("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function uM(t){if(t.media.mediaType!=="video")return;const e=ne();if(e.name!==ce.SAFARI&&e.os!==Bn.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function Bv(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const s=i.find(c=>Vv(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(u=>Vv(u.extensionName))||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(u,h){return h.filter(p=>!!u.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(E=>E.type==="transport-cc")))}(r,t.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="transport-cc")||u.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const s=t.attributes.extmaps.findIndex(c=>Vv(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const s=i.find(c=>aM(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(u=>u.extensionName===c)||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(u,h){return h.filter(p=>!!u.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(E=>E.type==="goog-remb")))}(r,t.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="goog-remb")||u.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const s=t.attributes.extmaps.findIndex(c=>aM(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function hM(t,e,n){if(Ze()||t.media.mediaType!=="video"||!(e instanceof Fe)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!N("SIMULCAST")||n==="vp9"&&N("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:en(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:en(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,s.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function pM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:s,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=ig(h,l,u,"sendonly"),_=ig(h,l,u,"recvonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ls(p,_,"videoExtensions",E,g,C),ls(p,_,"videoCodecs",E,g,C),ls(p,_,"audioExtensions",E,g,C),ls(p,_,"audioCodecs",E,g,C),N("RAISE_H264_BASELINE_PRIORITY")){const v=[],y=[];C.videoCodecs.forEach((b,I)=>{var L;if(((L=b.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"){var U,x;const M=C.videoCodecs[I+1],j=M&&gM(b,M),X=(U=b.fmtp)===null||U===void 0?void 0:U.parameters["profile-level-id"],ct=(x=b.fmtp)===null||x===void 0?void 0:x.parameters["packetization-mode"];!X||X!==N("FIRST_H264_PROFILE_LEVEL_ID")||N("FIRST_PACKETIZATION_MODE")&&ct!==N("FIRST_PACKETIZATION_MODE")?j?y.push([b,M]):y.push([b]):j?v.push([b,M]):v.push([b])}}),v.length>0&&y.length>0&&(S.debug("raising H264 baseline profile priority"),C.videoCodecs.forEach((b,I)=>{var L;if(((L=b.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"){const U=gM(b,C.videoCodecs[I+1]),x=v.shift()||y.shift()||[];x.length>0&&(U?C.videoCodecs.splice(I,2,...x):C.videoCodecs.splice(I,1,...x))}}),g.videoCodecs=g.videoCodecs.filter(b=>{var I,L;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((L=b.fmtp)===null||L===void 0?void 0:L.parameters["profile-level-id"])!==N("FIRST_H264_PROFILE_LEVEL_ID"))}),N("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(b=>{var I,L;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((L=b.fmtp)===null||L===void 0?void 0:L.parameters["profile-level-id"])!==N("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:E,recv:g,sendrecv:C}}(t,e,i);try{n.close()}catch{}return{send:r,recv:s,sendrecv:c}}function fM(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=ig(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ls(t,e,"videoExtensions",n,i,r),ls(t,e,"videoCodecs",n,i,r),ls(t,e,"audioExtensions",n,i,r),ls(t,e,"audioCodecs",n,i,r),N("RAISE_H264_BASELINE_PRIORITY")){const s=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){S.debug("raising H264 baseline profile priority");const l=r.videoCodecs[s];r.videoCodecs.splice(s,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function ls(t,e,n,i,r,s){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((u,h)=>{if(l.entry===u.entry&&l.extensionName===u.extensionName)return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,u)=>{c.indexOf(u)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((u,h)=>{if(l.payloadType===u.payloadType&&JSON.stringify(l)===JSON.stringify(u))return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,u)=>{c.indexOf(u)===-1&&r[n].push(l)})}}function Fv(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,s;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...i.audioCodecs],s.videoCodecs=[...n.videoCodecs,...i.videoCodecs],s.audioExtensions=[...n.audioExtensions,...i.audioExtensions],s.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):s=i,{send:r,recv:s}}function Yf(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function rg(t,e,n,i){let r=[];if(t===ht.VIDEO){if(N("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(s=>{var c;return it(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===N("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let s=[];const c=[],l=[],u=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";it(p).call(p,i)?s.push(h):it(p).call(p,"vp9")?c.push(h):it(p).call(p,"vp8")?l.push(h):it(p).call(p,"h264")&&u.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):u.length!==0&&(s=u,h="h264"),S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(r=e.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(r.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),N("USE_PUB_RTX")||N("USE_SUB_RTX")){const s=TI(r,e.videoCodecs);r=[...r,...s]}}else r=e.audioCodecs.filter(s=>{var c;return it(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),r.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(s=>{var c;return it(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return r}function TI(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&it(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function ag(t,e,n){const i=e.toString(),r=EM(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const s=await t.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=_M(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function _M(t,e,n){const i=yr(t),{useXR:r}=e;return i.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(n)&&!it(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Yf(s),r&&it(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(u=>u.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),rd(i)}function EM(t,e,n,i){if(N("SDP_LOGGING"))return S.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{EM(r,"answer",n==="local"?"remote":"local",i)}:void 0}function mM(t){const e=N("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>it(t).call(t,n))}function gM(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function SM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Da(t,e){return typeof N(t)===e?N(t):void 0}function p4(){try{const t=N("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?SM(Object(i),!0).forEach(function(r){A(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return S.debug("handle gateway attributes failed: ",t),{}}}const TM={};function dd(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&S.debug("install service ".concat(t.name)),TM[t.name]=t}function zc(t){const e=TM[t];if(!e)throw new G(O.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function RM(t,e){return zc("DataStream").create(t,e)}function jv(){return zc("InterceptFrame").create()}function vM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function qc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const RI=new Map;class f4 extends Je{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(Yn.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(Yn.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,s;super(),A(this,"store",void 0),A(this,"joinInfo",void 0),A(this,"key",void 0),A(this,"ntpOffset",0),A(this,"signal",void 0),A(this,"role",void 0),A(this,"inChannelInfo",{joinAt:null,duration:0}),A(this,"spec",void 0),A(this,"_state","DISCONNECTED"),A(this,"_statsCollector",void 0),A(this,"_disconnectedReason",void 0),A(this,"isSignalRecover",!1),A(this,"hasChangeBGPAddress",!1),A(this,"trafficStatsInterval",void 0),A(this,"networkQualityInterval",void 0),A(this,"_joinGatewayStartTime",0),A(this,"_signalTimeout",!1),A(this,"_clientRoleOptions",void 0),A(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:qc(qc({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(s=zc("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(s,i)):new u4(qc(qc({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let s=RI.get(e.cname);if(s||(s=new Map,RI.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const h=new B(O.UID_CONFLICT);throw gt.joinGateway(e.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),h}s.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{S.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const h=e.gatewayAddrs.map(p=>{let{address:_}=p;const[E,g]=_.split(":"),C={host:E,port:g};return e.proxyServer&&(C.proxy=e.proxyServer),C});c=(await this.signal.init(h)).uid,S.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var u;throw S.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),gt.joinGateway(e.sid,{lts:r,succ:!1,ec:((u=h.data)===null||u===void 0?void 0:u.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:e.preload}),s.delete(e.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Yn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Yn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Yn.NETWORK_QUALITY,{uplinkNetworkQuality:nM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:nM(this._statsCollector.trafficStats.B_dnq)}):this.emit(Yn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==he.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==ke.CONNECTED||await function(i,r){return r===1/0?i:at.race([i,Bj(r)])}(this.signal.request(At.LEAVE,void 0,!0),3e3)}catch(i){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==he.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:N("PUB_EXTEND"),twcc:!!N("PUBLISH_TWCC"),rtx:!!N("USE_PUB_RTX")};try{return(await this.signal.request(At.PUBLISH,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===vt.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw s}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(At.PUBLISH_DATASTREAM,s,!0)}catch(c){if(i&&c.data&&c.data.code===vt.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(At.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await at.all(e.map(n=>this.signal.request(At.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){S.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX")||void 0,extend:N("SUB_EXTEND"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(At.PRE_SUBSCRIBE,r,!0)}catch(s){if(i&&s.data&&s.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,n,!1);throw s}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX"),extend:N("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return(await this.signal.request(At.SUBSCRIBE,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw s}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(At.SUBSCRIBE_DATASTREAM,r,!0)}catch(s){if(i&&s.data&&s.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw s}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!N("USE_SUB_RTX"),twcc:!!N("SUBSCRIBE_TWCC"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(At.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===vt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,s=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:s,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(At.SET_VIDEO_PROFILE,n);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(At.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await at.all(e.map(i=>this.signal.request(At.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){S.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(At.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(At.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(At.GATEWAY_INFO)}async renewToken(e){await this.signal.request(At.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),N("CLIENT_ROLE_OPTIONS")&&(S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(N("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},N("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),N("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},N("CLIENT_ROLE_OPTIONS")),S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(N("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(At.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(At.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(At.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(At.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(At.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(At.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),qc({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(At.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=RI.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:_i.username,password:_i.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(qc(qc({},_i),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(At.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&ov(()=>{this.emit(Yn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new B(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=N("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Yn.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,it(Bf).call(Bf,r)||Bf.push(r);const s=!(Ze()||FD(87)||wL())&&typeof N("ENABLE_PRE_SUB")=="boolean"&&N("ENABLE_PRE_SUB"),c=!wL()&&Da("ENABLE_PREALLOC_PC","boolean"),l=p4(),u=Fm(87)||function(){const p=ne();if(p.name!==ce.SAFARI||!p.browserVersion)return!1;const _=p.browserVersion.split(".");return Number(_[0])>15||Number(_[0])===15&&Number(_[1])>=4}(),h=qc({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ia,browser:navigator.userAgent,process_id:N("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:N("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:qc({enableEncodedTransform:!!N("ENABLE_AUDIO_METADATA")&&u||!!N("ENABLE_AUDIO_TOPN")&&fb(ce.CHROME,87,116)||void 0,enableAudioMetadata:!!N("ENABLE_AUDIO_METADATA")&&u,enableAudioPts:!!N("ENABLE_AUDIO_PTS_METADATA")&&u,topnSmoothLevel:N("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:N("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:N("TOPN_SWITCH_HOLD_MS"),topnAudioGain:N("TOPN_AUDIO_GAIN"),enablePublishedUserList:N("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:N("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Da("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Da("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Da("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:N("USE_PUB_RTX")===!0||N("USE_SUB_RTX")===!0||void 0,disableFEC:N("DISABLE_FEC"),enableNTPReport:!!N("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!N("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!N("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Da("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!N("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!N("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Da("USE_XR","boolean"),enableLossbasedBwe:Da("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!N("ENABLE_AUT_CC")||void 0,enableCCFallback:Da("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:s?Da("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Da("PUBLISH_TWCC","boolean"),enableSubTWCC:Da("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Da("USE_PUB_RTX","boolean"),enableSubRTX:Da("USE_SUB_RTX","boolean"),enableSubSVC:N("ENABLE_SVC")?N("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0,enableSvcExtended:N("ENABLE_SVC")&&Array.isArray(N("SVC_EXTENDED"))&&N("SVC_EXTENDED").length!==0?N("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,N("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new B(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(It.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(It.WS_RECONNECTING,e=>{this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||pi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",gt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(It.WS_CLOSED,e=>{let n;switch(e){case he.LEAVE:n=pi.LEAVE;break;case he.UID_BANNED:case he.IP_BANNED:case he.CHANNEL_BANNED:case he.SERVER_ERROR:n=pi.SERVER_ERROR;break;case he.FALLBACK:n=pi.FALLBACK;break;case he.LICENSE_MISSING:case he.LICENSE_EXPIRED:case he.LICENSE_MINUTES_EXCEEDED:case he.LICENSE_PERIOD_INVALID:case he.LICENSE_MULTIPLE_SDK_SERVICE:case he.LICENSE_ILLEGAL:case he.TOKEN_EXPIRE:n=e;break;default:n=pi.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+pi.NETWORK_ERROR)),this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===he.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==he.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(It.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=N("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));ge("EVENT_REPORT_DOMAIN",e[1]),ge("EVENT_REPORT_BACKUP_DOMAIN",e[1]),ge("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(Yt.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(It.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new B(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,fi(this,Yn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(It.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const s=en((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(N("NEW_TURN_MODE")&&s){let h=s.servers,p=s.serversFromGateway;const _=this.signal.currentURLIndex;h.length>0&&(h=[h[_%h.length]],s.servers=h),Array.isArray(p)&&p.length>0&&(p=[p[0]],s.serversFromGateway=p),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(_))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:u}=await fi(this,Yn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:s});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:u,version:"2"}}))}catch(h){n(h)}}),this.signal.on(It.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(It.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var s;e instanceof B?(i=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,r=e.message):i=e,gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(It.IS_P2P_DISCONNECTED,e=>{e(Km(this,Yn.IS_P2P_DISCONNECTED))}),this.signal.on(It.DISCONNECT_P2P,()=>{this.emit(Yn.DISCONNECT_P2P)}),this.signal.on(It.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(It.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(It.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(Yn.JOIN_RESPONSE,e,n)}),this.signal.on(It.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=N("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=dM(e);this.emit(Yn.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(It.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof N("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(N("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(At.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(At.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw S.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(At.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(At.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw S.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(At.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===fe.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===fe.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===ht.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===ht.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(At.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(At.RESTART_ICE,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||pi.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!N("GATEWAY_WSS_ADDRESS"))return N("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(S.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(At.SET_PARAMETER,{enablePublishAudioFilter:e})}}let Gv=0,vI=0;function Js(t,e,n,i){return new at((r,s)=>{e.timeout=e.timeout||N("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Gv+=jo(e.data)):n&&(e.data.size?Gv+=e.data.size:e.data instanceof FormData?Gv+=rL(e.data):Gv+=jo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,nr.request(e).then(c=>{typeof c.data=="string"?vI+=jo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?vI+=c.data.byteLength:vI+=jo(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{nr.isCancel(c)?s(new B(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new B(O.NETWORK_TIMEOUT,c.message)):c.response?s(new B(O.NETWORK_RESPONSE_ERROR,c.response.status)):s(new B(O.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(K){var nt=0;return function(){return nt<K.length?{done:!1,value:K[nt++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(K,nt,mt){return K==Array.prototype||K==Object.prototype||(K[nt]=mt.value),K},i,r=function(K){K=[typeof globalThis=="object"&&globalThis,K,typeof window=="object"&&window,typeof self=="object"&&self,typeof et=="object"&&et];for(var nt=0;nt<K.length;++nt){var mt=K[nt];if(mt&&mt.Math==Math)return mt}throw Error("Cannot find global object")}(this);function s(K,nt){if(nt)t:{var mt=r;K=K.split(".");for(var z=0;z<K.length-1;z++){var R=K[z];if(!(R in mt))break t;mt=mt[R]}(nt=nt(z=mt[K=K[K.length-1]]))!=z&&nt!=null&&n(mt,K,{configurable:!0,writable:!0,value:nt})}}function c(K){return(K={next:K})[Symbol.iterator]=function(){return this},K}function l(K){var nt=typeof Symbol<"u"&&Symbol.iterator&&K[Symbol.iterator];return nt?nt.call(K):{next:e(K)}}if(s("Symbol",function(K){function nt(R,D){this.A=R,n(this,"description",{configurable:!0,writable:!0,value:D})}if(K)return K;nt.prototype.toString=function(){return this.A};var mt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",z=0;return function R(D){if(this instanceof R)throw new TypeError("Symbol is not a constructor");return new nt(mt+(D||"")+"_"+z++,D)}}),s("Symbol.iterator",function(K){if(K)return K;K=Symbol("Symbol.iterator");for(var nt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),mt=0;mt<nt.length;mt++){var z=r[nt[mt]];typeof z=="function"&&typeof z.prototype[K]!="function"&&n(z.prototype,K,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return K}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var u;t:{var h={};try{h.__proto__={a:!0},u=h.a;break t}catch{}u=!1}i=u?function(K,nt){if(K.__proto__=nt,K.__proto__!==nt)throw new TypeError(K+" is not extensible");return K}:null}var p=i;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function E(K){if(K.m)throw new TypeError("Generator is already running");K.m=!0}function g(K,nt){return K.h=3,{value:nt}}function C(K){this.g=new _,this.G=K}function v(K,nt,mt,z){try{var R=nt.call(K.g.j,mt);if(!(R instanceof Object))throw new TypeError("Iterator result "+R+" is not an object");if(!R.done)return K.g.m=!1,R;var D=R.value}catch(k){return K.g.j=null,K.g.s(k),y(K)}return K.g.j=null,z.call(K.g,D),y(K)}function y(K){for(;K.g.h;)try{var nt=K.G(K.g);if(nt)return K.g.m=!1,{value:nt.value,done:!1}}catch(mt){K.g.v=void 0,K.g.s(mt)}if(K.g.m=!1,K.g.l){if(nt=K.g.l,K.g.l=null,nt.F)throw nt.D;return{value:nt.return,done:!0}}return{value:void 0,done:!0}}function b(K){this.next=function(nt){return K.o(nt)},this.throw=function(nt){return K.s(nt)},this.return=function(nt){return function(mt,z){E(mt.g);var R=mt.g.j;return R?v(mt,"return"in R?R.return:function(D){return{value:D,done:!0}},z,mt.g.return):(mt.g.return(z),y(mt))}(K,nt)},this[Symbol.iterator]=function(){return this}}function I(K,nt){return nt=new b(new C(nt)),p&&K.prototype&&p(nt,K.prototype),nt}if(_.prototype.o=function(K){this.v=K},_.prototype.s=function(K){this.l={D:K,F:!0},this.h=this.C||this.u},_.prototype.return=function(K){this.l={return:K},this.h=this.u},C.prototype.o=function(K){return E(this.g),this.g.j?v(this,this.g.j.next,K,this.g.o):(this.g.o(K),y(this))},C.prototype.s=function(K){return E(this.g),this.g.j?v(this,this.g.j.throw,K,this.g.o):(this.g.s(K),y(this))},s("Array.prototype.entries",function(K){return K||function(){return function(nt,mt){nt instanceof String&&(nt+="");var z=0,R=!1,D={next:function(){if(!R&&z<nt.length){var k=z++;return{value:mt(k,nt[k]),done:!1}}return R=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}(this,function(nt,mt){return[nt,mt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var L=function(K,nt){for(var mt=0;mt<K.length;mt++)nt(K[mt])},U=function(K){return K.replace(/\r?\n|\r/g,`\r
`)},x=function(K,nt,mt){return nt instanceof Blob?(mt=mt!==void 0?mt+"":typeof nt.name=="string"?nt.name:"blob",nt.name===mt&&Object.prototype.toString.call(nt)!=="[object Blob]"||(nt=new File([nt],mt)),[String(K),nt]):[String(K),String(nt)]},M=function(K,nt){if(K.length<nt)throw new TypeError(nt+" argument required, but only "+K.length+" present.")},j=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,X=j.FormData,ct=j.XMLHttpRequest&&j.XMLHttpRequest.prototype.send,dt=j.Request&&j.fetch,zt=j.navigator&&j.navigator.sendBeacon,qt=j.Element&&j.Element.prototype,Pe=j.Symbol&&Symbol.toStringTag;Pe&&(Blob.prototype[Pe]||(Blob.prototype[Pe]="Blob"),"File"in j&&!File.prototype[Pe]&&(File.prototype[Pe]="File"));try{new File([],"")}catch{j.File=function(nt,mt,z){return nt=new Blob(nt,z||{}),Object.defineProperties(nt,{name:{value:mt},lastModified:{value:+(z&&z.lastModified!==void 0?new Date(z.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Pe&&Object.defineProperty(nt,Pe,{value:"File"}),nt}}var En=function(K){return K.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},sn=function(K){this.i=[];var nt=this;K&&L(K.elements,function(mt){if(mt.name&&!mt.disabled&&mt.type!=="submit"&&mt.type!=="button"&&!mt.matches("form fieldset[disabled] *"))if(mt.type==="file"){var z=mt.files&&mt.files.length?mt.files:[new File([],"",{type:"application/octet-stream"})];L(z,function(R){nt.append(mt.name,R)})}else mt.type==="select-multiple"||mt.type==="select-one"?L(mt.options,function(R){!R.disabled&&R.selected&&nt.append(mt.name,R.value)}):mt.type==="checkbox"||mt.type==="radio"?mt.checked&&nt.append(mt.name,mt.value):(z=mt.type==="textarea"?U(mt.value):mt.value,nt.append(mt.name,z))})};if((t=sn.prototype).append=function(K,nt,mt){M(arguments,2),this.i.push(x(K,nt,mt))},t.delete=function(K){M(arguments,1);var nt=[];K=String(K),L(this.i,function(mt){mt[0]!==K&&nt.push(mt)}),this.i=nt},t.entries=function K(){var nt,mt=this;return I(K,function(z){if(z.h==1&&(nt=0),z.h!=3)return nt<mt.i.length?z=g(z,mt.i[nt]):(z.h=0,z=void 0),z;nt++,z.h=2})},t.forEach=function(K,nt){M(arguments,1);for(var mt=l(this),z=mt.next();!z.done;z=mt.next()){var R=l(z.value);z=R.next().value,R=R.next().value,K.call(nt,R,z,this)}},t.get=function(K){M(arguments,1);var nt=this.i;K=String(K);for(var mt=0;mt<nt.length;mt++)if(nt[mt][0]===K)return nt[mt][1];return null},t.getAll=function(K){M(arguments,1);var nt=[];return K=String(K),L(this.i,function(mt){mt[0]===K&&nt.push(mt[1])}),nt},t.has=function(K){M(arguments,1),K=String(K);for(var nt=0;nt<this.i.length;nt++)if(this.i[nt][0]===K)return!0;return!1},t.keys=function K(){var nt,mt,z,R,D=this;return I(K,function(k){if(k.h==1&&(nt=l(D),mt=nt.next()),k.h!=3)return mt.done?void(k.h=0):(z=mt.value,R=l(z),g(k,R.next().value));mt=nt.next(),k.h=2})},t.set=function(K,nt,mt){M(arguments,2),K=String(K);var z=[],R=x(K,nt,mt),D=!0;L(this.i,function(k){k[0]===K?D&&(D=!z.push(R)):z.push(k)}),D&&z.push(R),this.i=z},t.values=function K(){var nt,mt,z,R,D=this;return I(K,function(k){if(k.h==1&&(nt=l(D),mt=nt.next()),k.h!=3)return mt.done?void(k.h=0):(z=mt.value,(R=l(z)).next(),g(k,R.next().value));mt=nt.next(),k.h=2})},sn.prototype._asNative=function(){for(var K=new X,nt=l(this),mt=nt.next();!mt.done;mt=nt.next()){var z=l(mt.value);mt=z.next().value,z=z.next().value,K.append(mt,z)}return K},sn.prototype._blob=function(){var K="----formdata-polyfill-"+Math.random(),nt=[],mt="--"+K+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(z,R){return typeof z=="string"?nt.push(mt+En(U(R))+`"\r
\r
`+U(z)+`\r
`):nt.push(mt+En(U(R))+'"; filename="'+En(z.name)+`"\r
Content-Type: `+(z.type||"application/octet-stream")+`\r
\r
`,z,`\r
`)}),nt.push("--"+K+"--"),new Blob(nt,{type:"multipart/form-data; boundary="+K})},sn.prototype[Symbol.iterator]=function(){return this.entries()},sn.prototype.toString=function(){return"[object FormData]"},qt&&!qt.matches&&(qt.matches=qt.matchesSelector||qt.mozMatchesSelector||qt.msMatchesSelector||qt.oMatchesSelector||qt.webkitMatchesSelector||function(K){for(var nt=(K=(this.document||this.ownerDocument).querySelectorAll(K)).length;0<=--nt&&K.item(nt)!==this;);return-1<nt}),Pe&&(sn.prototype[Pe]="FormData"),ct){var cr=j.XMLHttpRequest.prototype.setRequestHeader;j.XMLHttpRequest.prototype.setRequestHeader=function(K,nt){cr.call(this,K,nt),K.toLowerCase()==="content-type"&&(this.B=!0)},j.XMLHttpRequest.prototype.send=function(K){K instanceof sn?(K=K._blob(),this.B||this.setRequestHeader("Content-Type",K.type),ct.call(this,K)):ct.call(this,K)}}dt&&(j.fetch=function(K,nt){return nt&&nt.body&&nt.body instanceof sn&&(nt.body=nt.body._blob()),dt.call(this,K,nt)}),zt&&(j.navigator.sendBeacon=function(K,nt){return nt instanceof sn&&(nt=nt._asNative()),zt.call(this,K,nt)}),j.FormData=sn}})();const sg=()=>{const t=N("AREAS");return t.length===0&&t.push(le.GLOBAL),ji(t).call(t,(e,n,i)=>{const r=yM(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},yM=t=>t===le.OVERSEA?"".concat(yi.ASIA,",").concat(yi.EUROPE,",").concat(yi.AFRICA,",").concat(yi.NORTH_AMERICA,",").concat(yi.SOUTH_AMERICA,",").concat(yi.OCEANIA):yi[t],_4=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=kv[n],r=Object.keys(i);r&&r.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(i[s]))})}),e},Hv={GLOBAL:{ASIA:[le.CHINA,le.JAPAN,le.INDIA,le.KOREA,le.HKMC],EUROPE:[],NORTH_AMERICA:[le.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Wv=Object.keys(Hv[le.GLOBAL]),yI=[le.CHINA,le.NORTH_AMERICA,le.EUROPE,le.ASIA,le.JAPAN,le.INDIA,le.OCEANIA,le.SOUTH_AMERICA,le.AFRICA,le.KOREA,le.HKMC,le.US],E4=function(t,e){let n=[];if(it(t).call(t,le.GLOBAL)){const s=[le.GLOBAL,le.OVERSEA],c=Object.keys(kv);if(e===le.GLOBAL)throw new B(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===le.CHINA)n=[le.OVERSEA];else if(r=e,it(Wv).call(Wv,r)){const l=(i=e,Hv[le.GLOBAL][i]||[]),u=[...s,e,...l];n=c.filter(h=>!it(u).call(u,h))}else if(function(l){let u=!1;return Wv.forEach(h=>{var p;it(p=Hv[le.GLOBAL][h]).call(p,l)&&(u=!0)}),u}(e)){const l=function(h){let p;return Wv.forEach(_=>{var E;it(E=Hv[le.GLOBAL][_]).call(E,h)&&(p=_)}),p}(e),u=[...s,l,e];n=c.filter(h=>!it(u).call(u,h))}else n=t;n=function(l){const u=[];return yI.forEach(h=>{it(l).call(l,h)&&u.push(h)}),u.concat(l.filter(h=>!it(yI).call(yI,h)))}(n)}else n=t;var i,r;return n};function CM(t){var e,n;if(!t&&it(e=N("AREAS")).call(e,le.EXTENSIONS))return S.debug("update area from ap : reset"),void CI(AG,!0);if(!it(n=N("AREAS")).call(n,le.GLOBAL)||!t)return;let i=kv.EXTENSIONS;i&&(i={CODE:yM(le.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},S.debug("update area from ap success: ".concat(t,",config is "),i),ge("AREAS",[le.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?ge(r,i[r][0]):ge(r,i[r])}))}function CI(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=gt.reportApiInvoke(null,{name:bn.SET_AREA,options:t,tag:tn.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(s=>{if(!it(Wk).call(Wk,s))throw new B(O.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:s,excludedArea:c}=t;if(!s)throw new B(O.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),i=c?E4(l,c):l}if(!e){if(Ys.AREAS){const s=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void S.warning("setArea is prohibited because of config-distribute")}if(it(i).call(i,le.GLOBAL)&&N("AREAS")===le.EXTENSIONS){const s=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void S.warning("setArea is prohibited because of ap extensions")}}ge("AREAS",i,e);const r=_4(i);Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?ge(s,r[s][0]):ge(s,r[s])}),S.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function AM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function zo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?AM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):AM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let AI=1;function m4(t,e,n,i,r){AI+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:AI,requestId:AI,version:Ia,cname:n.cname},c={service_name:e,json_body:JSON.stringify(s)};let l,u,h=t[0];return Ks(async()=>{l=Date.now();const p=await Js(h,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-l,p.code!==0){const g=new B(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:u});throw S.error(g.toString()),g}const _=JSON.parse(p.json_body);if(_.code!==200){const g=new B(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:u});throw S.error(g.toString()),g}if(!_.servers||_.servers.length===0){const g=new B(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:u});throw S.error(g.toString()),g}const E=function(g,C){return{addressList:g.servers.map(v=>"wss://".concat(v.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(v.wss,"?serviceName=").concat(encodeURIComponent(C))),workerToken:g.workerToken,vid:g.vid}}(_,e);return N("LIVE_STREAMING_ADDRESS")&&(E.addressList=N("LIVE_STREAMING_ADDRESS")instanceof Array?N("LIVE_STREAMING_ADDRESS"):[N("LIVE_STREAMING_ADDRESS")]),zo(zo({},E),{},{responseTime:u})},(p,_)=>(gt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:_===0,responseTime:u,serverIp:t[_%t.length]}),!1),(p,_)=>(gt.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:u,serverIp:t[_%t.length]}),!!(p.code!==O.OPERATION_ABORTED&&p.code!==O.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=t[(_+1)%t.length],!0)),r)}let bI=1;function bM(t,e,n,i){let{url:r,areaCode:s}=t;const{clientId:c,sid:l}=e,u=Date.now();let h;const p=e.role,[_,E]=OI(e,s,[vn.CHOOSE_SERVER]);let g=Rn.networkState;return Ks(async()=>{g&&Rn.networkState===jr.OFFLINE&&Rn.onlineWaiter&&await at.race([Rn.onlineWaiter,ni(i&&i.maxRetryTimeout||In.maxRetryTimeout)]),g=Rn.networkState;const{data:C,headers:v}=await Js(r,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=v.http3==="1"?1:-1,gt.reportResourceTiming(r,l),OM(C,r,e,u,[vn.CHOOSE_SERVER],h);const y=ng(C,vn.CHOOSE_SERVER);return II(y),EI(y,r)},C=>(C&&gt.joinChooseServer(l,{role:p,lts:u,succ:!0,csAddr:r,opid:E,serverList:C.gatewayAddrs.map(v=>v.address),ec:null,cid:C.cid.toString(),uid:C.uid.toString(),csIp:C.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:C.res.detail&&C.res.detail[38]}),!1),C=>C.code!==O.OPERATION_ABORTED&&(C.code===O.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(gt.joinChooseServer(l,{role:p,lts:u,succ:!1,csAddr:r,serverList:null,opid:E,ec:C.code,csIp:C.data&&C.data.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:g}),isHttp3:h,corssRegionTagReq:e.apRequestDetail}),S.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),C),!0)),i)}function IM(t,e,n,i){let r,{url:s,areaCode:c,serviceIds:l}=t;const u=Date.now(),h=e.role,[p,_]=OI(e,c,l);let E;return Ks(async()=>{E&&Rn.networkState===jr.OFFLINE&&Rn.onlineWaiter&&await at.race([Rn.onlineWaiter,ni(i&&i.maxRetryTimeout||In.maxRetryTimeout)]),E=Rn.networkState;const{data:g,headers:C}=await Js(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=C.http3==="1"?1:-1,gt.reportResourceTiming(s,e.sid),OM(g,s,e,u,l,r);const v=ng(g,vn.CHOOSE_SERVER),y=ng(g,e.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK);return II(v),{gatewayInfo:EI(v,s),proxyInfo:y,url:s}},g=>(g.gatewayInfo&&gt.joinChooseServer(e.sid,{role:h,lts:u,succ:!0,csAddr:s,serverList:g.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:_,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:g.gatewayInfo.res.detail&&g.gatewayInfo.res.detail[38]}),g.proxyInfo&&gt.joinWebProxyAP(e.sid,{lts:u,sucess:1,apServerAddr:s,turnServerAddrList:g.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),g=>g.code!==O.OPERATION_ABORTED&&(g.code===O.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(gt.joinWebProxyAP(e.sid,{lts:u,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:g.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:E})}),S.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const OM=(t,e,n,i,r,s)=>{const{sid:c,clientId:l,cloudProxyServer:u}=n,h=[],p=_=>{_.flag===4096?gt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||gt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:_.error.code,eventType:u,unilbsServerIds:r.toString()})};if(t.response_body.forEach(_=>{const E=_.buffer.code;if(_.uri===23&&E===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{const g={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:_.buffer.flag};h.push(g),p(g)}if(E!==0){const g=Hf(E),C={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:t.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?S.warning(C.error.toString()):h.push(C),p(C)}}),h.length)throw S.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new B(O.CAN_NOT_GET_GATEWAY_SERVER,h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!h.find(_=>_.error.data.retry),csIp:t.detail[502],desc:[...new Set(h.map(_=>{var E;return _==null||(E=_.error)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.desc}).filter(_=>!!_))]})},II=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(N("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?CM(t.detail[23].toLowerCase()):CM()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let u=0;u<l.length;u++){var s;const h=Ui(s=l[u]).call(s);t.addresses[u]&&l&&(t.addresses[u].fingerprint=h)}}if(N("GATEWAY_ADDRESS")&&N("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",N("GATEWAY_ADDRESS"));const c=N("GATEWAY_ADDRESS").map(l=>{var u,h;const p=(u=(h=t.addresses.find(_=>_.ip===l.ip&&_.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&u!==void 0?u:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:p}});t.addresses=c}},g4=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=Hf(n.buffer.code);throw new B(O.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",e),new B(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},OI=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:zo(zo(zo({6:t.stringUid,11:e,12:N("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};s.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]},S4=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let zf=0;function qf(t){return at.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const og=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:s}=t,c=0;const l=e;let u,h=0;const p=async()=>{const _=(()=>{const E=c*l,g=E+l;return n.slice(E,g).map(i)})();s&&s.push(..._);try{u=await qf(_)}catch(E){if(h+=l,c++,!(h>=n.length))return void await p();r(E)}_.forEach(E=>E.cancel())};return await p(),u},wM=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let s=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(u){if(s++,s>=r||i!=null&&i(u))throw u;return c()}};return c()};async function wI(t,e,n,i){return{gatewayInfo:await async function(s,c,l,u){let h=null;const p=[],_=async()=>{const g=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:sg()})),C=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),v=await og({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(s.clientId,"] Connect to choose_server:"),y.url),bM(y,s,c,l)),allFailedhandler:y=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:p});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},C),v},E=async()=>{if(await ni(1e3),h!==null)return h;const g=N("WEBCS_DOMAIN_BACKUP_LIST").map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:sg()})),C=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),v=await og({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),y.url),bM(y,s,c,l)),allFailedhandler:y=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:p});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},C),v};try{return h=await qf([_(),E()]),p.length&&p.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),h}catch(g){throw g[0]}}(t,e,n,i)}}async function NM(t,e,n,i,r){const s=t.cloudProxyServer;if(s==="disabled"){if(t.useLocalAccessPoint)return await wI(t,e,n,r);if(N("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:E,proxyInfo:g}=await PM(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:E};const C=g.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||_i.tcpport,udpport:v.udpport||_i.udpport,username:v.username||_i.username,password:v.password||_i.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const v=(c=t.uid)!==null&&c!==void 0?c:E.uid,y="glb:".concat(v.toString()),b=await vb(y),I=g.map(L=>({turnServerURL:L.address,tcpport:L.tcpport||_i.tcpport,udpport:L.udpport||_i.udpport,username:y,password:b,forceturn:!1,security:!0}));C.push(...I)}return t.turnServer={mode:"manual",servers:C},{gatewayInfo:E}}return await wI(t,e,n,r)}const{proxyInfo:l,gatewayInfo:u}=await PM(t,e,n,r),h={gatewayInfo:u},p=l.map(E=>({turnServerURL:E.address,tcpport:s==="proxy3"?void 0:E.tcpport?E.tcpport:_i.tcpport,udpport:s==="proxy4"?void 0:E.udpport?E.udpport:_i.udpport,username:E.username||_i.username,password:E.password||_i.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(r.useP2P){var _;const E=(_=t.uid)!==null&&_!==void 0?_:u.uid,g="glb:".concat(E.toString()),C=await vb(g),v=l.map(y=>({turnServerURL:y.address,tcpport:s==="proxy3"?void 0:y.tcpport||_i.tcpport,udpport:s==="proxy4"?void 0:y.udpport||_i.udpport,username:g,password:C,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...v)}return t.turnServer={mode:"manual",servers:p},S.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),h}async function DM(t,e,n,i,r){const s=N("ACCOUNT_REGISTER").slice(0,N("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?s.map(u=>"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1")):s.map(u=>"https://".concat(u,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const u=await async function(h,p,_,E,g){const C=Date.now(),v={sid:_.sid,opid:10,appid:_.appId,string_uid:p};let y=h[0];const b=await Ks(()=>Js(y+"".concat(y.indexOf("?")===-1?"?":"&","action=stringuid"),{data:v,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(I,L)=>{if(I.code===0){if(I.uid<=0||I.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(p," => ").concat(I.uid),I),gt.reqUserAccount(v.sid,{lts:C,success:!1,serverAddr:y,stringUid:v.string_uid,uid:I.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:v}),new B(O.INVALID_UINT_UID_FROM_STRING_UID);return gt.reqUserAccount(v.sid,{lts:C,success:!0,serverAddr:y,stringUid:v.string_uid,uid:I.uid,errorCode:null,extend:v}),!1}const U=Hf(I.code);return U.retry&&(y=h[(L+1)%h.length]),gt.reqUserAccount(v.sid,{lts:C,success:!1,serverAddr:y,stringUid:v.string_uid,uid:I.uid,errorCode:U.desc,extend:v}),U.retry},(I,L)=>I.code!==O.OPERATION_ABORTED&&(gt.reqUserAccount(v.sid,{lts:C,success:!1,serverAddr:y,stringUid:v.string_uid,uid:null,errorCode:I.code,extend:v}),y=h[(L+1)%h.length],!0),g);if(b.code!==0){const I=Hf(b.code);throw new B(O.UNEXPECTED_RESPONSE,I.desc)}return b}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),u.uid}catch(u){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},l),u}}async function T4(t,e,n){const i=N("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):i.map(s=>"https://".concat(s,"/api/v1"));try{return await wM({referenceList:r,asyncMapHandler:c=>async function(l,u,h,p){const _=Date.now(),E={sid:h.sid,opid:10,appid:h.appId,string_uid:u};try{const g=await Js(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){const C=Hf(g.code);throw new B(O.UNEXPECTED_RESPONSE,"preload sua error:".concat(C.desc),C)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new B(O.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_,url:l,req:E,uid:g.uid,elapse:Date.now()-_}}catch(g){throw g}}(c,t,e,n),closeFn:c=>c.code===O.OPERATION_ABORTED||c.code===O.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(s){throw s}}async function R4(t,e,n){const i=N("CDS_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")),r=i.map(u=>function(h,p,_,E){const g=ne(),C={flag:64,cipher_method:0,features:zo(zo(zo(zo(zo({install_id:Pb(),device:g.name,system:g.os,system_general:navigator.userAgent,vendor:p.appId,version:Ia,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:h4.WEB_RTC,browser_name:g.name,browser_version:g.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),g.os&&{os_name:g.os}),g.osVersion&&{os_version:g.osVersion}),{},{detail:""})};return Ks(()=>Js(h,{data:C,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,v=>v.code!==O.OPERATION_ABORTED,E)}(u,t,e,n));let s=null,c=null,l={};try{s=await qf(r)}catch(u){if(u.code===O.OPERATION_ABORTED)throw u;c=u}if(r.forEach(u=>u.cancel()),gt.reportApiInvoke(t.sid,{name:bn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=function(u){if(!u.test_tags)return{};const h=u.test_tags,p=Object.keys(h),_={};return p.forEach(E=>{var g;const C=Ui(g=E.slice(4)).call(g),v=JSON.parse(h[E]),y=v[1];_[C]={tag:v[0]||"",value:y}}),_}(s)}catch{}return l}async function LM(t,e){const n=N("WEBCS_DOMAIN").concat(N("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:sg(),serviceIds:[vn.CHOOSE_SERVER,vn.CLOUD_PROXY_FALLBACK]}));try{return await wM({referenceList:n,asyncMapHandler:r=>async function(s,c,l){let u,{url:h,areaCode:p,serviceIds:_}=s;const E=Date.now(),[g,C]=OI(c,p,_);let v=Rn.networkState;try{v&&Rn.networkState===jr.OFFLINE&&Rn.onlineWaiter&&await at.race([Rn.onlineWaiter,ni(In.maxRetryTimeout)]),v=Rn.networkState;const{data:y,headers:b}=await Js(h,{data:g,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=b.http3==="1"?1:-1,(x=>{const M=[];if(x.response_body.forEach(j=>{const X=j.buffer.code;if(j.uri===23&&X===0&&!j.buffer.edges_services)if(j.buffer.flag===4194310)j.buffer.edges_services=[];else{const ct={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:x.detail[502]}),flag:j.buffer.flag};M.push(ct)}if(X!==0){const ct=Hf(X),dt={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,ct.desc,{desc:ct.desc,retry:ct.retry,csIp:x.detail[502]}),flag:j.buffer.flag};j.buffer.flag===4194310?S.warning(dt.error.toString()):M.push(dt)}}),M.length)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,M.map(j=>"flag: ".concat(j.flag,", message: ").concat(j.error.message)).join(" | "),{retry:!!M.find(j=>j.error.data.retry),csIp:x.detail[502],desc:[...new Set(M.map(j=>{var X;return j==null||(X=j.error)===null||X===void 0||(X=X.data)===null||X===void 0?void 0:X.desc}).filter(j=>!!j))]})})(y);const L=ng(y,vn.CHOOSE_SERVER),U=ng(y,vn.CLOUD_PROXY_FALLBACK);return II(L),{gatewayInfo:EI(L,h),proxyInfo:U,opid:C,requestTime:E,url:h,isHttp3:u,elapse:Date.now()-E}}catch(y){throw y}}(r,t,e),closeFn:r=>r.code===O.OPERATION_ABORTED||r.code===O.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function PM(t,e,n,i){const r=N("PROXY_SERVER_TYPE3"),s=(g,C,v)=>{let y=v||r;return Array.isArray(y)&&(y=C%2==0?r[1]:r[0]),"https://".concat(y,"/ap/?url=").concat(g)};let c=null;const l=[],u=async()=>{const g=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map((y,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:sg(),serviceIds:[vn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK]}}),C=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),v=await og({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(t.clientId,"] Connect to choose_server:"),y.url),IM(y,t,e,n)),allFailedhandler:y=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},C),v},h=async()=>{if(await ni(1e3),c!==null)return c;const g=N("WEBCS_DOMAIN_BACKUP_LIST").map((y,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:sg(),serviceIds:[vn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?vn.CLOUD_PROXY:vn.CLOUD_PROXY_FALLBACK]}}),C=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),v=await og({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),y.url),IM(y,t,e,n)),allFailedhandler:y=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},C),v};let p,_,E;try{({gatewayInfo:p,proxyInfo:_,url:E}=await qf([u(),h()]))}catch(g){throw g[0]}if(l.length&&l.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),!p||!_)throw new B(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=E,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&E){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(E)[1];it(r).call(r,g)&&(t.proxyServer=g,S.setProxyServer(g),gt.setProxyServer(g))}return c={gatewayInfo:p,proxyInfo:await iM(_,p.uid)},c}async function v4(t,e,n){const i=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(s=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),r=i.map(s=>function(c,l,u,h){const p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Ia,cname:l.cname,uid:l.uid.toString(),requestId:bI,seq:bI};bI+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(p)};return Ks(async()=>{const E=await Js(c,{data:_,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const C=new B(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw S.error(C.toString()),C}const g=JSON.parse(E.json_body);if(g.code!==200){const C=new B(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw S.error(C.toString()),C}if(!g.servers||g.servers.length===0){const C=new B(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(C.toString()),C}return{vid:g.vid,workerToken:g.workerToken,addressList:(N("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(C.wss))}},void 0,E=>!!(E.code!==O.OPERATION_ABORTED&&E.code!==O.UNEXPECTED_RESPONSE||E.data&&E.data.retry),h)}(s,t,e,n));try{const s=await qf(r);return r.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function y4(t,e,n){let i=null;const r=[],s=async c=>{const l=N(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return c&&(await ni(1e3),i!==null)?i:await og({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:u=>(S.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),function(h,p,_,E){const[g]=S4(p,[vn.CHOOSE_SERVER]);let C=Rn.networkState;return Ks(async()=>{C&&Rn.networkState===jr.OFFLINE&&Rn.onlineWaiter&&await at.race([Rn.onlineWaiter,ni(E&&E.maxRetryTimeout||In.maxRetryTimeout)]),C=Rn.networkState;const v=await Js(h,{data:g,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return g4(v,h)},()=>!1,v=>v.code!==O.OPERATION_ABORTED&&(v.code===O.UPDATE_TICKET_FAILED?v.data.retry:(S.warning("[".concat(p.clientId,"] update ticket network error, retry"),v),!0)),E)}(u,t,e,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:r})};try{return i=await qf([s(!1),s(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function kM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function NI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?kM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class C4 extends Je{get isSuccess(){return!!this.configs}constructor(e,n){super(),A(this,"configs",void 0),A(this,"store",void 0),A(this,"joinInfo",void 0),A(this,"cancelToken",void 0),A(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),A(this,"interval",void 0),A(this,"mutex",void 0),A(this,"mutableParamsRead",!1),A(this,"configCache",{}),A(this,"limit_bitrate",void 0),this.mutex=new vi("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),N("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},N("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,gt.reportApiInvoke(null,{options:void 0,name:bn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:tn.TRACER}).onSuccess(JSON.stringify(Ys))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await R4(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var s;const c=Om(s=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const _=c[p],E=r[_].value;if(typeof E.__priority=="number"){const g=E.__priority,C=c[p-1],v=r[C].value;if(typeof v.__priority=="number"){if(!(g>v.__priority))continue;{const y=_;c[p]=c[p-1],c[p-1]=y}}else{const y=_;c[p]=c[p-1],c[p-1]=y}}}const l=Date.now();let u={};return c.forEach(h=>{const p=r[h].value.__expires;p&&p<=l||(u[h]=r[h])}),u}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new B(O.NETWORK_RESPONSE_ERROR,i);S.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){Kk(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit($m.UPDATE_BITRATE_LIMIT,e):this.emit($m.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&NI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(s=>{const c=e[s].value;n[s]=c;const l=c.__id;if(l&&this.configCache[s]&&this.configCache[s].__id===l)return;const u=c.__type,h=e[s].value,p=e[s].tag;let _=0;u?u===TL.REALTIME&&(_=1):Object.keys(h).some(E=>Object.prototype.hasOwnProperty.call(xb,E)||!sI()&&Object.prototype.hasOwnProperty.call(hv,E)?(_=1,!0):void 0),r.push({tag:p,isApplied:_,feature:s,params:JSON.stringify(c)})}),r.forEach(s=>{let{tag:c,feature:l,params:u,isApplied:h}=s;this.store.sessionId&&gt.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:u,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){S.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const s={};return Object.keys(r).forEach(c=>{const l=r[c].value,u=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=NI(NI({value:l[p]},u&&{expires:u}),h&&{type:h}))})}),s}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&Kk(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const u=Date.now();Object.keys(l).forEach(h=>{const{value:p,type:_,expires:E}=l[h];E&&E<=u||((_===TL.REALTIME||Object.prototype.hasOwnProperty.call(xb,h))&&(Ys[h]=p,Be[h]=p,S.debug("Update realtime parameters from config distribute",h,p)),_||sI()||!Object.prototype.hasOwnProperty.call(hv,h)||(Ys[h]=p,Be[h]=p,S.debug("Update gateway parameters from config distribute",h,p)))})}catch(u){S.error("Error update config immediately: ".concat(l),u.message)}}(n);const s=JSON.stringify(n),c=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",c),S.debug("Caching global parameters ".concat(s))}catch(r){S.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Be,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(Be[i],r)||(Ys[i]=r,Be[i]=r,this.emit($m.UPDATE_CLIENT_ROLE_OPTIONS,r),S.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){S.error("Error handling global parameter config:",n.message)}}}class A4 extends Je{constructor(){super(...arguments),A(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(N("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var s;const c=it(s=r.result).call(s,!0);r.isPrevNormal&&!c&&this.emit("exception",MM[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",MM[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof Dn&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Gr(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof Dn&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const MM={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ai=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function UM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function th(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?UM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):UM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class cg{constructor(e){A(this,"store",void 0),A(this,"onStatsException",void 0),A(this,"onUploadPublishDuration",void 0),A(this,"onStatsChanged",void 0),A(this,"localStats",new Map),A(this,"remoteStats",new Map),A(this,"updateStatsInterval",void 0),A(this,"trafficStats",void 0),A(this,"trafficStatsPeerList",[]),A(this,"uplinkStats",void 0),A(this,"exceptionMonitor",void 0),A(this,"p2pChannel",void 0),A(this,"scalabilityMode",uv.L1T1),A(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new A4,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(q.LocalAudioTrack)||th({},Gb)}getLocalVideoTrackStats(){return this.localStats.get(q.LocalVideoTrack)||th({},Hb)}getRemoteAudioTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{networkStats:c}]=r;c&&(n[s]=c)});return n}getRemoteVideoTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const s=this.localStats.get(q.LocalAudioTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const c=this.localStats.get(q.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(q.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:_}=h;p&&(i+=p.receiveBytes,r+=p.receiveBitrate),_&&(i+=_.receiveBytes,r+=_.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),s=r!=null&&r.videoSSRC?Ai.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?Ai.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,s=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case q.LocalVideoTrack:case q.LocalVideoLowTrack:{const c=r,l=th({},Hb),u=e.getStats(),h=e.getLocalMedia(i);if(u){const p=u.videoSend.find(_=>_.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){const _=e.getLocalVideoSize(),E=e.getEncoderConfig(q.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):_&&(l.captureResolutionWidth=_.width,l.captureResolutionHeight=_.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):_&&(l.sendResolutionWidth=_.width,l.sendResolutionHeight=_.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),E&&E.bitrateMax&&(l.targetSendBitrate=1e3*E.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&h&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,h.track,l);break}case q.LocalAudioTrack:{const c=r,l=th({},Gb),u=e.getStats(),h=e.getLocalMedia(i);if(u){const p=u.audioSend.find(_=>_.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const _=e.getLocalAudioVolume();_&&(l.sendVolumeLevel=Math.round(32767*_))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(q.LocalAudioTrack,l),l&&h&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,h.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[s,{videoStats:c,audioStats:l,videoPcStats:u}]=n;const h=l,p=c,_=u,E=th({},DL),g=th({},LL),C=th({},lG),{audioTrack:v,videoTrack:y,audioSSRC:b,videoSSRC:I}=e.getRemoteMedia(s);let L;L=this.store.useP2P?e.getStats(!0):e.getStats();const U=(i=L)===null||i===void 0?void 0:i.audioRecv.find(X=>X.ssrc===b),x=(r=L)===null||r===void 0?void 0:r.videoRecv.find(X=>X.ssrc===I),M=this.trafficStats&&this.trafficStats.peer_delay.find(X=>X.peer_uid===s);if(U&&(U.codec!=="opus"&&U.codec!=="aac"&&U.codec!=="PCMU"&&U.codec!=="PCMA"&&U.codec!=="G722"||(E.codecType=U.codec),U.outputLevel?E.receiveLevel=Math.round(32767*U.outputLevel):v&&(E.receiveLevel=Math.round(32767*v.getVolumeLevel())),E.receiveBytes=U.bytes,E.receivePackets=U.packets,E.receivePacketsLost=U.packetsLost,E.receivePacketsDiscarded=U.packetsDiscarded,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=h?8*Math.max(0,E.receiveBytes-h.receiveBytes):0,E.totalDuration=h?h.totalDuration+1:1,E.totalFreezeTime=h?h.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=U.jitterBufferMs,E.totalDuration>10&&cg.isRemoteAudioFreeze(v)&&(E.totalFreezeTime+=1)),x){var j;x.codec!=="H264"&&x.codec!=="H265"&&x.codec!=="VP8"&&x.codec!=="VP9"&&x.codec!=="AV1X"&&x.codec!=="AV1"||(g.codecType=x.codec),g.receiveBytes=x.bytes,g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.decodeFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,g.renderFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,x.outputFrame&&(g.renderFrameRate=x.outputFrame.frameRate),x.receivedFrame?(g.receiveFrameRate=x.receivedFrame.frameRate,g.receiveResolutionHeight=x.receivedFrame.height,g.receiveResolutionWidth=x.receivedFrame.width):y&&(g.receiveResolutionHeight=y._videoHeight||0,g.receiveResolutionWidth=y._videoWidth||0),x.framesRateFirefox!==void 0&&(g.receiveFrameRate=Math.round(x.framesRateFirefox)),g.receivePackets=x.packets,g.receivePacketsLost=x.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost);const X=p?p.totalFreezeTime:0,ct=p?p.totalDuration:0;g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=(j=x.totalFreezesDuration)!==null&&j!==void 0?j:X||0,g.receiveDelay=x.jitterBufferMs||0;const dt=!!I&&e.getRemoteVideoIsReady(I);x.totalFreezesDuration===void 0&&y&&dt&&cg.isRemoteVideoFreeze(y,x,_)&&(g.totalFreezeTime+=1),g.freezeRate=Math.max(0,Math.min((g.totalFreezeTime-X)/(g.totalDuration-ct),1))}M&&(E.end2EndDelay=M.B_ad,g.end2EndDelay=M.B_vd,E.transportDelay=M.B_ed,g.transportDelay=M.B_ed,E.currentPacketLossRate=M.B_ealr4/100,g.currentPacketLossRate=M.B_evlr4/100,C.uplinkNetworkQuality=M.B_punq?M.B_punq:0,C.downlinkNetworkQuality=M.B_pdnq?M.B_pdnq:0),this.remoteStats.set(s,{audioStats:E,videoStats:g,videoPcStats:x,networkStats:C}),v&&this.exceptionMonitor.setRemoteAudioStats(v,E),y&&this.exceptionMonitor.setRemoteVideoStats(y,g)})}}class xM{constructor(){A(this,"destChannelMediaInfos",new Map),A(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Hk(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Hk(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Dv(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function VM(t){if(!(t instanceof xM))return new B(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new B(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new B(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class ud{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){A(this,"uid",void 0),A(this,"_uintid",void 0),A(this,"_trust_in_room_",!0),A(this,"_trust_audio_enabled_state_",!0),A(this,"_trust_video_enabled_state_",!0),A(this,"_trust_audio_mute_state_",!0),A(this,"_trust_video_mute_state_",!0),A(this,"_audio_muted_",!1),A(this,"_video_muted_",!1),A(this,"_audio_enabled_",!0),A(this,"_video_enabled_",!0),A(this,"_audio_added_",!1),A(this,"_video_added_",!1),A(this,"_is_pre_created",!1),A(this,"_video_pre_subscribed",!1),A(this,"_audio_pre_subscribed",!1),A(this,"_trust_video_stream_added_state_",!0),A(this,"_trust_audio_stream_added_state_",!0),A(this,"_audioTrack",void 0),A(this,"_videoTrack",void 0),A(this,"_dataChannels",[]),A(this,"_audioSSRC",void 0),A(this,"_videoSSRC",void 0),A(this,"_audioOrtc",void 0),A(this,"_videoOrtc",void 0),A(this,"_cname",void 0),A(this,"_rtxSsrcId",void 0),A(this,"_videoMid",void 0),A(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function BM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function FM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?BM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):BM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const lg="9",jM=4e4;function GM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Xc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Xf=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Xf||{});const Kv=new Map;function HM(t,e,n,i){let{scale:r}=t;if(r===0&&i===Xf.UP||r>=e.length-1&&i===Xf.DOWN)return t;let s=Xc(Xc({},t),{},{scale:i===Xf.DOWN?++r:--r});switch(n){case"maintain-framerate":s=Xc(Xc({},s),e[r].motion);break;case"maintain-resolution":s=Xc(Xc({},s),e[r].detail);break;case"balanced":s=Xc(Xc({},s),e[r].balanced)}return s}function WM(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:KM(e)};Kv.set(t,n)}else Kv.delete(t)}function KM(t){const e=Xc({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:s}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:u,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_UP_THRESHOLD:C,BALANCE_BITRATE_FACTOR:v,BALANCE_FRAMERATE_FACTOR:y,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:I,MOTION_BITRATE_FACTOR:L,DETAIL_FRAMERATE_FACTOR:U,DETAIL_BITRATE_FACTOR:x}=Mb,M=Math.min(e.frameRate,l),j=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(E,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(g,1)*M),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s}}];for(let X=1;X<=u;X++){const ct={bwe_up:Math.round(Math.pow(_,X)*n),bwe_down:Math.round(Math.pow(E,X+1)*n),fps_up:Math.round(Math.pow(C,X)*M),fps_down:Math.round(Math.pow(g,X+1)*M)},dt={scaleResolutionDownBy:r/Math.pow(b,X),frameRate:Math.max(Math.round(Math.pow(y,X)*i),c),bitrateMax:Math.max(Math.round(Math.pow(v,X)*n),p),bitrateMin:Math.max(Math.round(Math.pow(v,X)*s),h)},zt={scaleResolutionDownBy:r/Math.pow(I,X),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(L,X)*n),p),bitrateMin:Math.max(Math.round(Math.pow(L,X)*s),h)},qt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(U,X)*i),c),bitrateMax:Math.max(Math.round(Math.pow(x,X)*n),p),bitrateMin:Math.max(Math.round(Math.pow(x,X)*s),h)};j.push({scale:X,threshold:ct,balanced:dt,motion:zt,detail:qt})}return j}function b4(t,e,n,i,r,s){const c=Kv.get(t)||{overUse:0,underUse:0,adaptationList:KM(r)},{adaptationList:l}=c;Kv.set(t,c);const{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:h}=Mb,{scale:p}=i;let _,E;return typeof e=="number"&&e>0&&function(g,C,v,y){if(C>=v.length)return!1;let{threshold:{fps_down:b}}=v[C];return N("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=v[0].threshold.fps_down),g<b}(e,p,l,s)&&(c.overUse++,E=zm.CPU,c.overUse>u)||typeof n=="number"&&n>0&&function(g,C,v){if(C>=v.length)return!1;const{threshold:{bwe_down:y}}=v[C];return g<y}(n,p,l)&&(c.overUse++,E=zm.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,_=HM(i,l,s,Xf.DOWN),[_,E]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(g,C,v,y){if(C===0)return;let{threshold:{fps_up:b}}=v[C];return N("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=v[1].threshold.fps_up),g>b}(e,p,l,s)&&function(g,C,v){if(C===0)return;const{threshold:{bwe_up:y}}=v[C];return g>y}(n,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,_=HM(i,l,s,Xf.UP),_.scale===0&&(E=zm.NONE))),[_,E])}function YM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function DI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function I4(t){var e;return!!N("ENABLE_AG_ADAPTATION")&&!!(t instanceof Zb||it(e=t._hints).call(e,Le.CUSTOM_TRACK))&&(!!N("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=ne();if(i.os!==Bn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&GD(17,4)||jD(14)&&HD(17,4,!0)))}const Yv=new Map;function zv(t,e){const n=Yv.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),Yv.delete(t)}e.qualityLimitationReason=zm.NONE,WM(t)}function O4(t,e){var n;let i;switch(e){case q.LocalAudioTrack:i=fe.Audio;break;case q.LocalVideoTrack:i=it(n=t._hints).call(n,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalVideoLowTrack:i=fe.Low}return i}function LI(t){const e=ae();if(t.some(n=>n._bypassWebAudio))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function PI(t,e){LI(t);const n=new Dn;return t.forEach(i=>n.addAudioTrack(i)),n}const w4=!ae().supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&Bc();function qv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return w4?(n={spec:e,store:t},zc("PlanBConnection").create(n)):new qo(e,t)}function kI(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function zM(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Wm(t.turnServer.servers))return!1;if(N("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var te;function qM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let qo=(te=class Eh extends zk{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return it(n=Object.keys(pv)).call(n,e)}))]}constructor(e,n){super(e,n),A(this,"id",De(5,"connection-")),A(this,"store",void 0),A(this,"peerConnection",void 0),A(this,"forceTurn",!1),A(this,"remoteSDP",void 0),A(this,"initialOffer",void 0),A(this,"transportEventReceiver",void 0),A(this,"statsFilter",void 0),A(this,"extension",{useXR:N("USE_XR")}),A(this,"localCapabilities",void 0),A(this,"remoteCodecs",void 0),A(this,"localCandidateCount",0),A(this,"allCandidatesReceived",!1),A(this,"isPreallocation",!1),A(this,"preSSRCMap",new Map),A(this,"dataStreamChannelMap",new Map),A(this,"establishPromise",void 0),A(this,"recoveredDataChannelIds",[]),A(this,"currentDataChannelId",1),A(this,"supportAV1RtpSpec",!1),A(this,"mutex",void 0),A(this,"qualityLimitationReason",zm.NONE),A(this,"isFirstConnected",!1),this.store=n,this.forceTurn=zM(e),this.mutex=new vi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Eh.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Lb(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,Ze()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=ld(i.sdp),s=await pM({filterRTX:!N("USE_PUB_RTX")&&!N("USE_SUB_RTX"),filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterVideoCodec:N("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=Fv(s),this.initialOffer=i,N("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const u=new RTCPeerConnection;u.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:uv.L1T3}]});const h=await u.createOffer();if(!h.sdp)return void u.close();const p=yr(h.sdp).mediaDescriptions[0];if(!p)return;const _=p.attributes.extmaps.find(E=>E.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return u.close(),_}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=s.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&mM(i.sdp)&&(c=en(s),(n=c).send&&(Wf(ht.VIDEO,n.send.videoExtensions),Wf(ht.AUDIO,n.send.audioExtensions)),n.recv&&(Wf(ht.VIDEO,n.recv.videoExtensions),Wf(ht.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Wf(ht.VIDEO,n.sendrecv.videoExtensions),Wf(ht.AUDIO,n.sendrecv.audioExtensions))),Qs(Qs({},r),{},{rtpCapabilities:c||s,offerSDP:i.sdp})}catch(i){throw new G(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&mM(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(xv(ht.VIDEO,n.send.videoExtensions,i.send.videoExtensions),xv(ht.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(xv(ht.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),xv(ht.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return en(this._localCapabilities)}get rtpCapabilities(){return en(this._rtpCapabilities)}get candidates(){return en(this._candidates)}get iceParameters(){return en(this._iceParameters)}get dtlsParameters(){return en(this._dtlsParameters)}constructor(h){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];A(this,"sessionDesc",void 0),A(this,"_localCapabilities",void 0),A(this,"_rtpCapabilities",void 0),A(this,"_candidates",void 0),A(this,"_originCandidates",void 0),A(this,"_iceParameters",void 0),A(this,"_isUseExtmapAllowMixed",void 0),A(this,"_dtlsParameters",void 0),A(this,"setup",void 0),A(this,"currentMidIndex",void 0),A(this,"cname",void 0),A(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,h=en(h);const{iceParameters:_,dtlsParameters:E,candidates:g,rtpCapabilities:C,setup:v,localCapabilities:y,cname:b}=h;this._rtpCapabilities=C,this._candidates=g,this._originCandidates=en(g),this._iceParameters=_,this._dtlsParameters=E,this._localCapabilities=y,this.setup=v,this.cname=b,this.sessionDesc=this.updateRemoteRTPCapabilities(C),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(h){const p=this.candidates,_=this.dtlsParameters,E=this.iceParameters,g=this.rtpCapabilities.send;let C=this.sessionDesc.mediaDescriptions.length-1;for(let v=1;v<h;v++){const y=2*v+2e4,b=2*v+jM,{ssrcs:I,ssrcGroups:L}=$u([{ssrcId:y}],this.cname),{ssrcs:U,ssrcGroups:x}=$u([{ssrcId:b,rtx:N("USE_SUB_RTX")?b+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:lg,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.videoCodecs.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:E.iceUfrag,icePwd:E.icePwd,unrecognized:[],candidates:p,extmaps:g.videoExtensions,fingerprints:_.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:U,ssrcGroups:x,rtcpFeedbackWildcards:[],payloads:g.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++C)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:lg,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.audioCodecs.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:E.iceUfrag,icePwd:E.icePwd,unrecognized:[],candidates:p,extmaps:g.audioExtensions,fingerprints:_.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:L,rtcpFeedbackWildcards:[],payloads:g.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++C)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return rd(this.sessionDesc)}send(h,p,_,E){const{ssrcs:g,ssrcGroups:C}=$u(p,this.cname,N("SYNC_GROUP")?_:void 0),v=this.findPreloadMediaDesc(g);if(v){if(Ze()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,v.attributes.mid),E&&(E.twcc||E.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(v);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,E),{mid:v.attributes.mid,needExchangeSDP:!0}}return{mid:v.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(h,g);let b;return y===-1||y===1&&(hi()||function(){const I=ne();return!(I.name!==ce.CHROME||!I.osVersion)&&Number(I.version)<=90}()||N("ENABLE_ENCODED_TRANSFORM")&&Vc())||y===0&&N("USE_SUB_RTX")||WD()?(b=this.createOrRecycleSendMedia(h,g,C,"sendonly",E),this.updateBundleMids()):(b=en(this.sessionDesc.mediaDescriptions[y]),b.attributes.direction="sendonly",b.attributes.ssrcs=g,b.attributes.ssrcGroups=C,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(b,E)),Ze()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,b.attributes.mid),{mid:b.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:p}}batchSend(h){const p=h.map(g=>{let{kind:C,ssrcMsg:v,mslabel:y}=g;return this.send(C,v,y)}),_=[];let E=!1;return p.forEach(g=>{let{mid:C,needExchangeSDP:v}=g;v&&(E=!0),_.push(C)}),{mids:_,needExchangeSDP:E}}stopSending(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>_.attributes.mid&&h.indexOf(_.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(_=>{_.attributes.mid==="0"||Ze()||WD()?_.attributes.ssrcs=[]:(_.attributes.ssrcs=[],_.attributes.direction="inactive",_.media.port="0")}),this.updateBundleMids()}mute(h){const p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>it(h).call(h,_.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(_=>{_.attributes.direction="inactive"})}unmuteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>it(h).call(h,_.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(_=>{_.attributes.direction="recvonly"})}receive(h,p,_,E){h.forEach((g,C)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",p,_,E[C])}),this.updateBundleMids()}stopReceiving(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>h.indexOf(_.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(_=>{_.media.port="0",_.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const p=this.sessionDesc||yr((_=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(_?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var _;this._rtpCapabilities=h;const E=this.rtpCapabilities.send,g=this.localCapabilities.send;for(const C of p.mediaDescriptions){if(C.attributes.iceUfrag=this._iceParameters.iceUfrag,C.attributes.icePwd=this._iceParameters.icePwd,C.attributes.fingerprints=this._dtlsParameters.fingerprints,C.attributes.candidates=this._candidates,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"){if(E.videoCodecs.length===0){const v=g.videoCodecs.filter(y=>{var b,I;return(b=y.rtpMap)===null||b===void 0?void 0:it(I=b.encodingName.toLowerCase()).call(I,"vp8")})||[g.videoCodecs[0]];C.media.fmts=v.map(y=>y.payloadType.toString(10)),C.attributes.payloads=v,C.attributes.extmaps=[]}else if(C.media.fmts=E.videoCodecs.map(v=>v.payloadType.toString(10)),C.attributes.payloads=E.videoCodecs,C.attributes.extmaps=E.videoExtensions,N("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:v,ssrcGroups:y}=$u([{ssrcId:jM,rtx:N("USE_SUB_RTX")?40001:void 0}],this.cname);C.attributes.ssrcs=v,C.attributes.ssrcGroups=y}}if(C.media.mediaType==="audio"){if(E.audioCodecs.length===0){const v=g.audioCodecs.filter(y=>{var b,I;return(b=y.rtpMap)===null||b===void 0?void 0:it(I=b.encodingName.toLowerCase()).call(I,"opus")})||[g.audioCodecs[0]];C.media.fmts=v.map(y=>y.payloadType.toString(10)),C.attributes.payloads=v,C.attributes.extmaps=[]}else if(C.media.fmts=E.audioCodecs.map(v=>v.payloadType.toString(10)),C.attributes.payloads=E.audioCodecs,C.attributes.extmaps=E.audioExtensions,Yf(C),N("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:v,ssrcGroups:y}=$u([{ssrcId:2e4}],this.cname);C.attributes.ssrcs=v,C.attributes.ssrcGroups=y}}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(h){const p=this._originCandidates.filter(E=>E.transport==="udp"),_=[];if(p.forEach(E=>{_.push(FM(FM({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}),p.length!==0){switch(h){case Ci.TCP_RELAY:this._candidates=_;break;case Ci.UDP_TCP_RELAY:case Ci.RELAY:this._candidates=[...p,..._];break;default:this._candidates=p}for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(h){h=en(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let _=0;_<h;_++)p.push((this.currentMidIndex+_+1).toString(10));return p}findAvailableMediaIndex(h,p){return this.sessionDesc.mediaDescriptions.findIndex(_=>{const E=_.media.mediaType===h&&_.media.port!=="0"&&(_.attributes.direction==="sendonly"||_.attributes.direction==="sendrecv")&&_.attributes.ssrcs.length===0;if(Ze()){if(E){const g=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(g||_.attributes.mid!=="0"&&_.attributes.mid!=="1")||!(!g||g!==_.attributes.mid)}return!1}return E})}createOrRecycleDataChannel(){for(const _ of this.sessionDesc.mediaDescriptions)if(_.media.mediaType==="application")return{mediaDesc:_,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:lg,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,p,_,E,g,C){const v=h._mediaStreamTrack.kind,y=this.rtpCapabilities.recv,b=rg(v,y,this.localCapabilities.send,v===ht.VIDEO?E:g),I=v===ht.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;const L="".concat(this.currentMidIndex);let U={media:{mediaType:v,port:lg,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:b,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(L)}};U=this.mungRecvMediaDsec(U,h,C);const x=this.findFirstClosedMedia(v);if(x){const M=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[M]=U}else this.sessionDesc.mediaDescriptions.push(U);return U}updateRemoteCodec(h,p,_){const E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(U=>U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||"").filter(U=>{var x;return it(x=Object.keys(pv)).call(x,U)}))],g=new Set(p);if(E.every(U=>g.has(U)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const C=this._rtpCapabilities.recv.videoCodecs.filter(U=>p.some(x=>{var M;return it(M=U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||"").call(M,x)}));if(C.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(p)),!1;const v=[...new Set(C.map(U=>U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||""))];let y;if(S.debug("updateRemoteCodec, from ".concat(E," to ").concat(v)),h.length===0)y=this.sessionDesc.mediaDescriptions.filter(U=>U.media.mediaType==="video"&&U.attributes.direction==="recvonly");else if(y=this.sessionDesc.mediaDescriptions.filter(U=>U.attributes.mid&&it(h).call(h,U.attributes.mid)&&U.attributes.direction==="recvonly"),y.length!==h.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(p)),!1;if(N("USE_PUB_RTX")||N("USE_SUB_RTX")){const U=TI(C,this.rtpCapabilities.recv.videoCodecs);C.push(...U)}this._rtpCapabilities.recv.videoCodecs=C;const b=this.localCapabilities.send,I=this.rtpCapabilities.recv,L=rg(ht.VIDEO,I,b,_);return y.forEach(U=>{const x=L.map(M=>M.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(U.attributes.mid,", from"),U.attributes.payloads,"to",L),U.attributes.payloads=L,U.media.fmts=x}),!0}createOrRecycleSendMedia(h,p,_,E,g){const C=this.rtpCapabilities.send,v=h===ht.VIDEO?C.videoCodecs:C.audioCodecs,y=h===ht.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let I={media:{mediaType:h,port:lg,protos:["UDP","TLS","RTP","SAVPF"],fmts:v.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:v,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};I=this.mungSendMediaDesc(I,g);const L=this.findFirstClosedMedia(h);if(L){const U=this.sessionDesc.mediaDescriptions.indexOf(L);this.sessionDesc.mediaDescriptions[U]=I}else this.sessionDesc.mediaDescriptions.push(I);return I}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,p,_){const E=en(h);return gI(E),Kf(E,p),SI(E,p),uM(E),Bv(E,_,this.localCapabilities.send),E}mungSendMediaDesc(h,p){const _=en(h);return Bv(_,p,this.localCapabilities.recv),Yf(_),_}updateRecvMedia(h,p){const _=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h);if(_!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_],p);this.sessionDesc.mediaDescriptions[_]=E}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(p=>Ze()?p.media.port==="0"&&p.media.mediaType===h:p.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(p=>{var _;return((_=p.attributes)===null||_===void 0||(_=_.ssrcs[0])===null||_===void 0?void 0:_.ssrcId)===h[0].ssrcId})}getSSRC(h){var p;return(p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h))===null||p===void 0?void 0:p.attributes.ssrcs}}(Qs(Qs({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),s=_M(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),N("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(N("PRELOAD_MEDIA_COUNT"));const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}const{preSSRCs:u}=e;if(Array.isArray(u)&&u.length>0){const{mids:h}=this.remoteSDP.batchSend(u.map(p=>({kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,_)=>{this.preSSRCMap.set(u[_].ssrcId,p)}),await ag(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));r.forEach((s,c)=>{this.preSSRCMap.set(i[c].ssrcId,s)})}await ag(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return ba(function*(){const s=yield ee(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=Uv();e.forEach(y=>{const b=r.peerConnection.addTransceiver(y._mediaStreamTrack,Qs({direction:"sendonly"},y.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(b),y._updateRtpTransceiver(b)}),Ze()&&N("SIMULCAST")===!0&&(yield ee(r.applySimulcastForFirefox(c,e)));const u=yield ee(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(e.length),p=r.mungSendOfferSDP(u.sdp,e,h),_=yr(p),E=h.map(y=>{const b=_.mediaDescriptions.find(I=>I.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return cM(b,N("USE_PUB_RTX"))});let g;try{g=yield E}catch(y){g=[],r.remoteSDP.receive(e,n,i,g);const b=r.remoteSDP.toString();throw yield ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield ee(r.stopSending(h,!0)),y}r.remoteSDP.receive(e,n,i,g);const C=r.remoteSDP.toString(),v=r.logSDPExchange(p,"offer","local","send");return yield ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ee(r.applySimulcastEncodings(c,e)),yield ee(r.applySendEncodings(c,e)),v==null||v(C),yield ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:C})),c.map((y,b)=>{const I=h[b];return{localSSRC:E[b],id:I,transceiver:y}})}catch(c){throw c instanceof G?c:new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:N("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(s=>{s._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof G?i:new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof G?n:new G(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(u=>e.indexOf(u.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(u=>{var h;zv(this.id+u.mid,this),u.direction="inactive",(h=u.stop)===null||h===void 0||h.call(u)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await ag(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(u=>u.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await ag(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const s=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:r,transceiver:s}})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,u]=c;if(u===s)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return ba(function*(){const i=yield ee(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=ae().supportPCSetConfiguration,s=N("FORCE_TURN_TCP")||n.forceTurn;if(e===Ci.RELAY&&!r)return;if(r&&!s){const _=e===Ci.RELAY?"relay":"all",E=n.peerConnection.getConfiguration();E.iceTransportPolicy!==_&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(_,"]")),E.iceTransportPolicy=_,n.peerConnection.setConfiguration(E))}n.remoteSDP.updateCandidates(e);const c=yield ee(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=ld(c.sdp),{remoteIceParameters:u}=yield l.iceParameters;n.remoteSDP.restartICE(u);const h=n.remoteSDP.toString(),p=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield ee(n.peerConnection.setLocalDescription(c)),p==null||p(h),yield ee(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ci.TCP_RELAY),await ag(this.peerConnection,this.remoteSDP,this.extension)}catch(n){S.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{zv(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Qs(Qs({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new G(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Ze()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Qs(Qs({},Go),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Qs(Qs({},Go),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(Wm(e.turnServer.servers)?n.iceServers=e.turnServer.servers:N("NEW_TURN_MODE")&&n.iceServers?(N("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...Eh.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...Eh.newTurnServerConfigToIceServers(e.turnServer.servers)),N("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Eh.turnServerConfigToIceServers(e.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Eh.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),N("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&ae().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(od(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!N("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const r=N("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(od(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(od(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:s}=i.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ae().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},c={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const l=function(v,y){return v.getTransceivers().find(b=>b.sender.track===y||b.receiver.track===y)}(this.peerConnection,e._mediaStreamTrack),u=fG(e);if(I4(e)&&l&&n&&u&&this.getLocalVideoStats&&it(i=["vp8","vp9"]).call(i,this.store.codec)){var h;const v=s.degradationPreference||(it(h=e._hints).call(h,Le.CUSTOM_TRACK)?N("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(y,b,I,L,U,x){if(zv(y,I),U(b),L!=="balanced"&&L!=="maintain-framerate"&&L!=="maintain-resolution")return;let M=-1;WM(y,b);const j=window.setInterval(()=>{const ct=Yv.get(y);if(!N("ENABLE_AG_ADAPTATION")||!ct)return zv(y,I),void U(b);const dt=x();if(dt.sendPackets>0&&dt.OutgoingAvailableBandwidth>0){if(M===-1)return void(M=Date.now());if(Date.now()-M<1e3)return;const zt=dt.sendFrameRate,qt=dt.OutgoingAvailableBandwidth,[Pe,En]=b4(y,zt,qt,ct.adaptationConfig,b,L);En&&(I.qualityLimitationReason=En),Pe&&ct.adaptationConfig.scale!==Pe.scale&&(S.debug("[".concat(y,"] applyAdaptation: ").concat(I.qualityLimitationReason,`
           sendFps `).concat(zt,", bwe ").concat(qt,", switch from ").concat(ct.adaptationConfig.scale," to ").concat(Pe.scale," ")),ct.adaptationConfig=DI(DI({},ct.adaptationConfig),Pe),U(Pe))}},N("CHECK_LOCAL_STATS_INTERVAL")),X=DI({},b);Yv.set(y,{timer:j,adaptationConfig:X,originConfig:b,adaptationFunc:U}),S.debug("[".concat(y,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(L))})(this.id+l.mid,u,this,v,y=>{n&&this.updateAdaptation(n,y)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;const{bitrateMax:v,frameRate:y,scaleResolutionDownBy:b}=e._encoderConfig;v&&(c.maxBitrate=1e3*v),(it(p=e._hints).call(p,Le.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(y&&(c.maxFramerate=Gr(y)),b&&b>=1&&(c.scaleResolutionDownBy=b))}const{maxFramerate:_}=N("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,_):_),N("DSCP_TYPE")&&Bc()){var E;const v=N("DSCP_TYPE");it(E=["very-low","low","medium","high"]).call(E,v)&&(c.networkPriority=v)}const g=n.getParameters(),C=(r=g.encodings)===null||r===void 0?void 0:r[0];Ze()&&!C&&(s.encodings=[c]),C&&Object.assign(C,c),Object.assign(g,s),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await async function(v,y,b){try{var I;if(!ae().supportSetRtpSenderParameters||!function(j){return j==="vp9"||j==="av1"}(v)||!N("ENABLE_SVC"))return;const L={},U={},x=y.getParameters(),M=(I=x.encodings)===null||I===void 0?void 0:I[0];U.scalabilityMode=Uv(b),M&&Object.assign(M,U),Object.assign(x,L),await y.setParameters(x),S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(x.encodings)))}catch(L){S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",L)}}(this.store.codec,n,N("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return S.debug("[updateAdaptation] no rtpSender found");if(!ae().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:u}=n;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=Gr(l)),u&&u>=1&&it(i=["vp8","vp9"]).call(i,this.store.codec)&&(s.scaleResolutionDownBy=u);const h=e.getParameters(),p=(r=h.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,s),Object.assign(h,{});try{await e.setParameters(h),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(_){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof Fe&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=yr(e);return n.forEach((s,c)=>{const l=i[c],u=r.mediaDescriptions.find(h=>h.attributes.mid===l);u&&(Kf(u,s),hM(u,s,this.store.codec))}),rd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let u=0;u<e.length;u++){var i,r,s,c,l;const h=e[u],p=n[u];if(p instanceof Fe&&!it(i=p._hints).call(i,Le.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},E={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,_))}}}async applySimulcastEncodings(e,n){if(!Ze()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof Fe&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=s.sender.getParameters();await s.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof Fe&&N("SIMULCAST")&&this.store.codec==="vp8"&&!it(n=e._hints).call(n,Le.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(N("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(ae().supportPCSetConfiguration){const n=Eh.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Et(te.prototype,"updateRemoteRTPCapabilities",[rr],Object.getOwnPropertyDescriptor(te.prototype,"updateRemoteRTPCapabilities"),te.prototype),Et(te.prototype,"connect",[rr],Object.getOwnPropertyDescriptor(te.prototype,"connect"),te.prototype),Et(te.prototype,"updateRemoteConnect",[rr],Object.getOwnPropertyDescriptor(te.prototype,"updateRemoteConnect"),te.prototype),Et(te.prototype,"createDataChannels",[rr],Object.getOwnPropertyDescriptor(te.prototype,"createDataChannels"),te.prototype),Et(te.prototype,"receive",[rr],Object.getOwnPropertyDescriptor(te.prototype,"receive"),te.prototype),Et(te.prototype,"batchReceive",[rr],Object.getOwnPropertyDescriptor(te.prototype,"batchReceive"),te.prototype),Et(te.prototype,"stopReceiving",[rr],Object.getOwnPropertyDescriptor(te.prototype,"stopReceiving"),te.prototype),Et(te.prototype,"muteRemote",[rr],Object.getOwnPropertyDescriptor(te.prototype,"muteRemote"),te.prototype),Et(te.prototype,"unmuteRemote",[rr],Object.getOwnPropertyDescriptor(te.prototype,"unmuteRemote"),te.prototype),Et(te.prototype,"muteLocal",[rr],Object.getOwnPropertyDescriptor(te.prototype,"muteLocal"),te.prototype),Et(te.prototype,"unmuteLocal",[rr],Object.getOwnPropertyDescriptor(te.prototype,"unmuteLocal"),te.prototype),Et(te.prototype,"close",[rr],Object.getOwnPropertyDescriptor(te.prototype,"close"),te.prototype),Et(te.prototype,"updateEncoderConfig",[rr],Object.getOwnPropertyDescriptor(te.prototype,"updateEncoderConfig"),te.prototype),Et(te.prototype,"updateSendParameters",[rr],Object.getOwnPropertyDescriptor(te.prototype,"updateSendParameters"),te.prototype),Et(te.prototype,"replaceTrack",[rr],Object.getOwnPropertyDescriptor(te.prototype,"replaceTrack"),te.prototype),Et(te.prototype,"updateAdaptation",[rr],Object.getOwnPropertyDescriptor(te.prototype,"updateAdaptation"),te.prototype),Et(te.prototype,"getRemoteSSRC",[rr],Object.getOwnPropertyDescriptor(te.prototype,"getRemoteSSRC"),te.prototype),te);function rr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{s()}},n}function MI(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Gr(e.width),i.height=Gr(e.height);const r=Gr(e.framerate||15);document.body.append(n),document.body.append(i);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const c=i.getContext("2d");if(!c)throw new B(O.UNEXPECTED_ERROR,"can not get canvas context");const l=ae(),u=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];u.canvas||(u.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,_=n.videoHeight/p,E=i.width*_;Math.abs(E-i.height)>=2&&(S.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(E)),i.height=E)}c.drawImage(n,0,0,i.width,i.height),u.requestFrame&&u.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},i.stopCapture=Yb(()=>i.startCapture&&i.startCapture(),r);const h=u.stop;return u.stop=()=>{h.call(u),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),S.debug("clean low stream renderer")},u}var Xv=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(Xv||{}),yn=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(yn||{}),eh=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(eh||{}),Cn=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Cn||{}),nh=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(nh||{}),XM=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(XM||{}),Xo=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Xo||{}),ar=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(ar||{}),JM=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(JM||{}),sr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(sr||{}),Jv=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(Jv||{});const ih=1e3,rh=6,Qv=3,N4=Math.max(rh,Qv);function Ct(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function QM(t){const e={[sr.CONN_TYPE]:0,[sr.RTT]:t.rtt,[sr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[sr.CONN_TYPE]=1),n==="tcp"&&(e[sr.CONN_TYPE]=3),n==="tls"&&(e[sr.CONN_TYPE]=4);break}case"srflx":e[sr.CONN_TYPE]=2;break;case"unknown":e[sr.CONN_TYPE]=5;break;default:e[sr.CONN_TYPE]=0}return e}function ZM(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class $M extends Je{constructor(e){super(),A(this,"store",void 0),A(this,"uploadWRTCStatsTimer",void 0),A(this,"uploadOutboundDenoiserStatsTimer",void 0),A(this,"uploadExtStatsTimer",void 0),A(this,"uploadExtUsageStatsTimer",void 0),A(this,"uploadInboundExtStatsTimer",void 0),A(this,"requestStats",void 0),A(this,"requestTransportStats",void 0),A(this,"requestLocalMedia",void 0),A(this,"requestRemoteMedia",void 0),A(this,"requestAllTracks",void 0),A(this,"requestVideoIsReady",void 0),A(this,"requestUploadStats",void 0),A(this,"requestUpload",void 0),A(this,"uploadOutboundStarted",!1),A(this,"uploadInboundStarted",!1),A(this,"uploadTransportStarted",!1),A(this,"uploadBaseStatsStarted",!1),A(this,"uploadExtensionUsageStarted",!1),A(this,"lastRecvStats",void 0),A(this,"lastSendStats",void 0),A(this,"lastRefRecvStats",void 0),A(this,"lastRefSendStats",void 0),A(this,"lastFullRecvStats",void 0),A(this,"lastFullSendStats",void 0),A(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%Qv==0,i=e%rh==0;let r,s;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(s=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!s&&this.uploadInboundStarted&&(s=this.requestStats(!0)),r||s){var c;const l={};if(this.uploadTransportStarted&&r){const h=this.getTransportStats(r,s,n);h&&(l.misc=[h])}if(this.uploadOutboundStarted&&r){const h=this.getOutboundStats(r,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);h&&(l.outbound=[h])}if(this.uploadInboundStarted&&s){const h=this.getInboundStats(s,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);h&&(l.inbound=h)}const u=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;u&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Jv.RTC_PEER_CONNECTION_STATE]=Db[u]):l.misc=[{addition:{[Jv.RTC_PEER_CONNECTION_STATE]:Db[u]}}]),this.requestUploadStats(l)}this.lastRecvStats=s,this.lastSendStats=r,i&&(this.lastFullRecvStats=s,this.lastFullSendStats=r),n&&(this.lastRefRecvStats=s,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Jv.RTC_PEER_CONNECTION_STATE]:Db[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===N4+1&&(e=1)},ih)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[sr.RTT]:e.rtt,[sr.CONN_TYPE]:void 0,[sr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=QM(e);if(this.store.useP2P){if(n){const s=QM(n);r[sr.CONN_TYPE]+=s[sr.CONN_TYPE]<<3}r[sr.CONN_TYPE]+=110}else r[sr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const s=this.requestLocalMedia();if(!s||s.length===0)return;let c,l,u;return s.forEach(h=>{let[p,{track:_,ssrcs:E}]=h;switch(p){case q.LocalVideoLowTrack:case q.LocalVideoTrack:if(p===q.LocalVideoTrack){const g=function(y,b,I,L,U,x){const M=b.videoSend.find(dt=>dt.ssrc===y);if(!M)return;const j={},{sentFrame:X,inputFrame:ct}=M;if(x&&(Ct(j,yn.QP_SUM,M.qpSumPerFrame),ct&&X)){const dt=ct.frameRate,zt=X.frameRate;j[yn.FREEZE]=function(qt,Pe){let En=!0;return En=!(qt<=5)&&(qt<=10?Pe<3:qt<=20?Pe<4:Pe<5),En}(dt,zt)?1:0}if(U){switch(X&&(Ct(j,yn.HEIGHT,X.height),Ct(j,yn.WIDTH,X.width),Ct(j,yn.FRAME_RATE,X.frameRate)),j[yn.DISABLED]=L._originMediaStreamTrack&&!L._originMediaStreamTrack.enabled||L._mediaStreamTrack&&!L._mediaStreamTrack.enabled?1:0,M.adaptionChangeReason){case"none":j[yn.ADAPTATION]=0;break;case"cpu":j[yn.ADAPTATION]=1;break;case"bandwidth":j[yn.ADAPTATION]=2;break;case"other":j[yn.ADAPTATION]=3}let dt=0;M.adaptionChangeReason&&(dt+=ZM(M.adaptionChangeReason)),b.qualityLimitationReason&&(dt+=ZM(b.qualityLimitationReason)<<3),j[yn.ADAPTATION]=dt,j[yn.PLAYER_STATUS]=Wb[L._player?L._player.videoElementStatus:"uninit"],Ct(j,yn.NACKS,M.nacksCount),Ct(j,yn.PLIS,M.plisCount),Ct(j,yn.FIRS,M.firsCount),Ct(j,yn.AVG_ENCODE,M.avgEncodeMs),Ct(j,yn.HUGE_FRAME_SENT,M.hugeFramesSent),Ct(j,yn.BYTES_RETRANSMIT,M.retransmittedBytesSent),Ct(j,yn.PACKAGES_RETRANSMIT,M.retransmittedPacketsSent),Ct(j,yn.KEY_FRAMES_ENCODED,M.keyFramesEncoded);const zt=I&&I.videoSend.find(qt=>qt.ssrc===y);if(zt){let qt=U?ih:ih*rh;zt.timestamp&&M.timestamp&&(qt=M.timestamp-zt.timestamp),zt.packets!=null&&M.packets!=null&&Ct(j,yn.PACKAGE_RATE,1e3*(M.packets-zt.packets)/qt),M.packetsLost!=null&&zt.packetsLost!=null&&Ct(j,yn.PACKAGE_LOST,M.packetsLost-zt.packetsLost),zt.bytes!=null&&M.bytes!=null&&Ct(j,yn.BITRATE,8*(M.bytes-zt.bytes)/qt)}}return j}(E[0].ssrcId,e,n,_,i,r),C=_&&function(y,b,I,L){const U=b.videoSend.find(M=>M.ssrc===y);if(!U)return null;const x={};if(L){const M=U.inputFrame,j=M&&M.height||I.videoHeight||0,X=M&&M.width||I.videoWidth||0,ct=M&&M.frameRate||0;Ct(x,Xv.HEIGHT,j),Ct(x,Xv.WIDTH,X),Ct(x,Xv.FRAME_RATE,ct)}return x}(E[0].ssrcId,e,_,i),v=function(y,b){const I={};return b&&(Ct(I,yn.RETRANSMIT,y.bitrate.retransmit),Ct(I,yn.TARGET_ENCODED,y.bitrate.targetEncoded),Ct(I,yn.ACTUAL_ENCODED,y.bitrate.actualEncoded),Ct(I,yn.TRANSMIT,y.bitrate.transmit),Ct(I,yn.BANDWIDTH,y.sendBandwidth)),I}(e,i);l=Object.assign({},g,C,v)}else u=function(g,C,v,y){const b=C.videoSend.find(L=>L.ssrc===g);if(!b)return;const I={};if(y){const L=b.sentFrame;if(L&&(Ct(I,eh.HEIGHT,L.height),Ct(I,eh.WIDTH,L.width),Ct(I,eh.FRAME_RATE,L.frameRate)),v){const U=v.videoSend.find(x=>x.ssrc===g);if(U){let x=ih*rh;U.timestamp&&b.timestamp&&(x=b.timestamp-U.timestamp),U.packets!=null&&b.packets!=null&&Ct(I,eh.PACKAGE_RATE,1e3*(b.packets-U.packets)/x),b.packetsLost!=null&&U.packetsLost!=null&&Ct(I,eh.PACKAGE_LOST,b.packetsLost-U.packetsLost),U.bytes!=null&&b.bytes!=null&&Ct(I,eh.BITRATE,8*(b.bytes-U.bytes)/x)}}}return I}(E[0].ssrcId,e,n,i);break;case q.LocalAudioTrack:c=_&&function(g,C,v,y,b){const I=C.audioSend.find(U=>U.ssrc===g);if(!I)return;const L={};if(b){L[Xo.DISABLED]=y._originMediaStreamTrack&&!y._originMediaStreamTrack.enabled||y._mediaStreamTrack&&!y._mediaStreamTrack.enabled?1:0;const U=100*y._source.getAccurateVolumeLevel(),x=I.inputLevel;if(x!=null){const j=Math.ceil(50*Math.log10(100*x+1));Ct(L,Xo.LEVEL,j)}Ct(L,XM.PCM_LEVEL,U),Ct(L,Xo.AEC_RETURN_LOSS,I.aecReturnLoss),Ct(L,Xo.AEC_RETURN_LOSS_ENH,I.aecReturnLossEnhancement),Ct(L,Xo.BYTES_RETRANSMIT,I.retransmittedBytesSent),Ct(L,Xo.PACKAGES_RETRANSMIT,I.retransmittedPacketsSent),L[Xo.FREEZE]=0;const M=v&&v.audioSend.find(j=>j.ssrc===g);if(M){let j=ih*rh;M.timestamp&&I.timestamp&&(j=I.timestamp-M.timestamp),M.bytes!=null&&I.bytes!=null&&Ct(L,Xo.BITRATE,8*(I.bytes-M.bytes)/j),M.packets!=null&&I.packets!=null&&Ct(L,Xo.PACKAGE_RATE,1e3*(I.packets-M.packets)/j)}}return L}(E[0].ssrcId,e,n,_,i)}}),{high:l,low:u,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[u,h]=l;const p={peer:u.uid};if(h.has(ht.VIDEO)&&u.videoTrack){const _=u._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(u._videoSSRC)||!1,E=u.videoTrack?function(g,C,v,y,b,I,L,U){const x=C.videoRecv.find(qt=>qt.ssrc===g);if(!x)return;const M={},{receivedFrame:j,outputFrame:X,decodeFrameRate:ct}=x,dt=v&&v.videoRecv.find(qt=>qt.ssrc===g);if(Ct(M,nh.FRAME_RATE_DECODE,ct),x.framesRateFirefox&&Ct(M,Cn.FRAME_RATE,x.framesRateFirefox),j&&Ct(M,Cn.FRAME_RATE,j.frameRate),Ct(M,Cn.FRAMES_DROPPED,x.framesDroppedCount),Ct(M,Cn.BYTES_RETRANSMIT,x.retransmittedBytesReceived),Ct(M,Cn.PACKAGES_RETRANSMIT,x.retransmittedPacketsReceived),Ct(M,Cn.PACKAGES_DISCARDED,x.packetsDiscarded),Ct(M,Cn.AVG_DECODE,x.avgDecodeMs),Ct(M,Cn.AVG_PROCESSING_DELAY,x.avgProcessingDelayMs),Ct(M,Cn.AVG_ASSEMBLY_TIME,x.avgFramesAssembledFromMultiplePacketsMs),Ct(M,Cn.AVG_INTER_FRAME_DELAY,x.avgInterFrameDelayMs),Ct(M,Cn.KEY_FRAMES_DECODED,x.keyFramesDecoded),dt){const qt=C.timestamp-v.timestamp||ih*(U?rh:L?Qv:1);x.packetsLost!=null&&dt.packetsLost!=null&&Ct(M,Cn.PACKAGE_LOST,x.packetsLost-dt.packetsLost),dt.bytes!=null&&x.bytes!=null&&Ct(M,Cn.BITRATE,8*(x.bytes-dt.bytes)/qt),dt.packets!=null&&x.packets!=null&&Ct(M,Cn.PACKAGE_RATE,1e3*(x.packets-dt.packets)/qt)}if(U&&(Ct(M,Cn.QP_SUM,x.qpSumPerFrame),M[Cn.FREEZE]=b&&cg.isRemoteVideoFreeze(y,x,dt)?1:0),L){var zt;j?(Ct(M,Cn.HEIGHT,j.height),Ct(M,Cn.WIDTH,j.width)):y&&(Ct(M,Cn.HEIGHT,y._videoHeight||0),Ct(M,Cn.WIDTH,y._videoWidth||0)),X&&Ct(M,nh.FRAME_RATE_OUTPUT,X.frameRate);const qt=(zt=y._player)===null||zt===void 0?void 0:zt.rendFrameRate.toFixed(0);if(qt&&Ct(M,nh.FRAME_RATE_RENDER,+qt),Ct(M,Cn.JITTER_BUFFER,x.jitterBufferMs),Ct(M,Cn.CURRENT_DELAY,x.currentDelayMs),Ct(M,Cn.FIRS,x.firsCount),Ct(M,Cn.NACKS,x.nacksCount),Ct(M,Cn.PLIS,x.plisCount),y){M[Cn.DISABLED]=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?0:1;const Pe=y._player;if(Pe){const{freezeTimeCounterList:En,renderFreezeAccTime:sn,videoElementStatus:cr}=Pe;if(En&&En.length>0&&Ct(M,nh.FREEZE_TIME,En.splice(0,1)[0]),I&&Gc.visibility==="visible"&&cr===xi.PLAYING&&ae().supportRequestVideoFrameCallback){const K=Math.min(6e3,sn);Pe.renderFreezeAccTime=Math.max(0,sn-K),Ct(M,nh.FREEZE_TIME_RENDER,K)}if(typeof x.totalFreezesDuration=="number"){const K=dt&&dt.totalFreezesDuration?x.totalFreezesDuration-dt.totalFreezesDuration:x.totalFreezesDuration;Ct(M,nh.FREEZE_DURATION,1e3*K)}}}if(M[Cn.PLAYER_STATUS]=Wb[y._player?y._player.videoElementStatus:"uninit"],dt&&x.totalInterFrameDelay!==void 0&&x.totalSquaredInterFrameDelay!==void 0&&dt.totalInterFrameDelay!==void 0&&dt.totalSquaredInterFrameDelay!==void 0){const Pe=x.totalInterFrameDelay-dt.totalInterFrameDelay,En=x.totalSquaredInterFrameDelay-dt.totalSquaredInterFrameDelay,sn=x.framesDecodeCount-dt.framesDecodeCount,cr=Pe/sn*1e3,K=Math.round(1e3*Math.sqrt((En-Math.pow(Pe,2)/sn)/sn));!isNaN(K)&&cr+K>Math.max(3*cr,cr+150)&&(M[Cn.I_FRAME_DELAY]=K)}}return M}(u._videoSSRC,e,n,u.videoTrack,_===!0,this.needUploadRenderFreezeTime,i,r):void 0;E&&(p.video=E)}if(h.has(ht.AUDIO)&&u.audioTrack){const _=u.audioTrack?function(E,g,C,v,y,b){const I=g.audioRecv.find(M=>M.ssrc===E);if(!I)return;const L={},U=C&&C.audioRecv.find(M=>M.ssrc===E);if(Ct(L,ar.JITTER,I.jitterMs),Ct(L,ar.BYTES_RETRANSMIT,I.retransmittedBytesReceived),Ct(L,ar.PACKAGES_RETRANSMIT,I.retransmittedPacketsReceived),Ct(L,ar.PACKAGES_DISCARDED,I.packetsDiscarded),Ct(L,ar.AVG_PROCESSING_DELAY,I.avgProcessingDelayMs),U){const M=g.timestamp-C.timestamp||ih*(b?rh:y?Qv:1);I.packets!=null&&U.packets!=null&&Ct(L,ar.PACKAGE_RATE,1e3*(I.packets-U.packets)/M),y&&U.bytes!=null&&I.bytes!=null&&Ct(L,ar.BITRATE,8*(I.bytes-U.bytes)/M),I.packetsLost!=null&&U.packetsLost!=null&&Ct(L,ar.PACKAGE_LOST,I.packetsLost-U.packetsLost)}if(b){const{receivedFrames:M,droppedFrames:j}=I;M!=null&&j!=null&&(L[ar.FREEZE]=(x=M)===0||100*j/x>20?1:0)}var x;if(y){const M=100*v._source.getAccurateVolumeLevel(),j=I.outputLevel;if(j!=null){const X=Math.ceil(50*Math.log10(100*j+1));Ct(L,JM.LEVEL,X)}if(Ct(L,ar.PCM_LEVEL,M),v&&(L[ar.DISABLED]=v._originMediaStreamTrack.enabled&&v._mediaStreamTrack.enabled?0:1),Ct(L,ar.JITTER_BUFFER,I.jitterBufferMs),Ct(L,ar.CURRENT_DELAY,I.jitterBufferMs),L[ar.PLAYER_STATUS]=Wb[ir.getPlayerState(v.getTrackId())],U){const X=I.concealedSamples-U.concealedSamples;X>0&&Ct(L,ar.CONCEALED_SAMPLES,X);const ct=I.totalSamplesReceived-U.totalSamplesReceived;ct>0&&Ct(L,ar.TOTAL_SAMPLES_RECEIVED,ct)}}return L}(u._audioSSRC,e,n,u.audioTrack,i,r):void 0;_&&(p.audio=_)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof Tv);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Zm.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(ht.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(ht.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of c)p.has(ht.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),p.has(ht.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(h,p){const _={};for(const{id:v,value:y,level:b,direction:I}of h){var E;const L=(E=p.get(v))!==null&&E!==void 0?E:0,U=y===2?L+N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:L;var g,C;p.set(v,U),_[v]?(y===2&&(_[v].value=y),b>_[v].level&&(_[v].level=b),I==="remote"&&(_[v].remoteUidCount+=1),_[v].totalTs=(g=p.get(v))!==null&&g!==void 0?g:0):_[v]={value:y,level:b,remoteUidCount:I==="local"?0:1,totalTs:(C=p.get(v))!==null&&C!==void 0?C:0}}return Object.keys(_).map(v=>{const{level:y,value:b,totalTs:I}=_[v];return{id:v,level:y,value:b,totalTs:I}})}(r,e);const l=Date.now(),u=l>n?l:n+1;this.requestUpload&&this.requestUpload(Zm.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:u})},N("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const D4=N("ICE_RESTART_INTERVAL");let Zv=new Map,Jf=new Map,hd=[Ci.UDP_TCP_RELAY,Ci.TCP_RELAY,Ci.RELAY],UI=N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ae().supportPCSetConfiguration;function t1(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Zv.get(t.id);n&&(window.clearTimeout(n),Zv.delete(t.id));const i=Jf.get(t.id);e&&i&&i.index===hd.length-1&&(S.debug("[".concat(t.id,"] reset ICE restart policy")),Jf.delete(t.id))}function e1(t,e,n){if(Zv.size===0&&Jf.size===0&&(Array.isArray(N("RESTART_SEQUENCE"))&&N("RESTART_SEQUENCE").length>0&&!function(l,u){if(l.length!==u.length)return!1;for(let h=0;h<l.length;h+=1){const p=l[h];if(l.filter(_=>_===p).length!==u.filter(_=>_===p).length)return!1}return!0}(hd,N("RESTART_SEQUENCE"))&&(hd=N("RESTART_SEQUENCE").filter(l=>{var u;if(it(u=Object.values(Ci)).call(u,l))return!0}),S.debug("use reconnection policy from config distribution, queues: ".concat(hd.join(" => ")))),UI=N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ae().supportPCSetConfiguration),hd.length===0)return void n();let i,{index:r=0,type:s}=Jf.get(t.id)||{};if(UI&&s===Ci.RELAY)return void n();let c=s&&r>=hd.length-1;if(UI)s=Ci.RELAY;else{if(c)return void n();s?(r++,s=hd[r]):(s=hd[0],r=0)}S.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(r)),e(s),Jf.set(t.id,{index:r,type:s}),i=window.setTimeout(()=>e1(t,e,n),D4),Zv.set(t.id,i)}var Gt;function n1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Jo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?n1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):n1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function i1(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=sb,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new $v(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function $v(t){function e(n){if(Object(n)!==n)return at.reject(new TypeError(n+" is not an object."));var i=n.done;return at.resolve(n.value).then(function(r){return{value:r,done:i}})}return $v=function(n){this.s=n,this.n=n.next},$v.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?at.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?at.reject(n):e(i.apply(this.s,arguments))}},new $v(t)}let dg=(Gt=class extends Je{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Rt.StateChange,e,this._state)}constructor(t,e){super(),A(this,"isPlanB",void 0),A(this,"store",void 0),A(this,"statsUploader",void 0),A(this,"connection",void 0),A(this,"localTrackMap",new Map),A(this,"remoteUserMap",new Map),A(this,"localDataChannels",[]),A(this,"remoteDataChannelMap",new Map),A(this,"pendingLocalTracks",[]),A(this,"pendingRemoteTracks",[]),A(this,"pendingLocalDataChannels",[]),A(this,"pendingRemoteDataChannels",[]),A(this,"statsCollector",void 0),A(this,"shouldForwardP2PCreation",void 0),A(this,"iceFailedCount",0),A(this,"dtlsFailedCount",0),A(this,"mutex",void 0),A(this,"_state",pe.Disconnected),A(this,"_pcStatsUploadType",N("NEW_ICE_RESTART")?Yc.FIRST_CONNECTION:Yc.OLD_FIRST_CONNECTION),A(this,"_isStartRestartIce",!1),A(this,"_restartTimer",void 0),A(this,"_isTryConnecting",!1),A(this,"_iceError",null),A(this,"_forceTurn",!1),A(this,"_isWaitPcToRePub",!1),A(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==pe.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const u=this.createMuteMessage(c);await Ne(this,Rt.RequestMuteLocal,u),i()}catch(c){r(c)}finally{s()}}),A(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==pe.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=MI(n,Km(this,Rt.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new at((p,_)=>{this.handleReplaceTrack(h.track,p,_,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const u=this.createUnmuteMessage(c);await Ne(this,Rt.RequestUnmuteLocal,u),i()}catch(c){r(c)}finally{s()}}),A(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;s||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const u=this.localTrackMap.get(q.LocalVideoTrack);if(!this.connection||!u||u.track!==n||this.state!==pe.Connected)return void i();const{id:h,track:p}=u;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Rt.UpdateVideoEncoder,p),i()}catch(u){r(u)}finally{var l;(l=c)===null||l===void 0||l()}}),A(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(q.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==pe.Connected)return void i();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),i()}catch(c){r(c)}finally{s()}}),A(this,"handleReplaceMixingTrack",async(n,i,r,s)=>{if(!this.connection||this.state!==pe.Connected)return void i();const c=PI([n]);let l;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(h){r(h)}finally{var u;(u=l)===null||u===void 0||u()}}),A(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.connection||!h||this.state!==pe.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===q.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding){const p=this.localTrackMap.get(q.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new at((E,g)=>{this.handleReplaceTrack(p.track,E,g,!0)})}}i()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),A(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),A(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),A(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),A(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),A(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new $M(this.store),this.bindStatsUploaderEvents(),this.mutex=new vi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!ae().supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&Bc(),this.shouldForwardP2PCreation=N("FORWARD_P2P_CREATION")&&ae().supportPCSetConfiguration&&gb(),this.shouldForwardP2PCreation&&(this.connection=qv(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=pe.New,this._forceTurn=zM(t),S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=qv(this.store,t),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=N("NEW_ICE_RESTART")?Yc.FIRST_CONNECTION:Yc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");N("ENABLE_PREALLOC_PC")&&this.state===pe.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pe.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var s;let[c]=r;return it(s=[q.LocalVideoLowTrack,q.LocalVideoTrack]).call(s,c)}),n=e.map(r=>{let[,{id:s}]=r;return s}),i=e.map(r=>{let[s]=r;return s});if(this.connection instanceof qo){if(gt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!it(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(s=>it(t).call(t,s));r&&(this.store.codec=r,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof qo&&this.connection.peerConnectionState!=="closed"&&it(t=[pe.New,pe.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==pe.Connected){if(this.state===pe.Disconnected)throw new G(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;it(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return ba(function*(){const r=yield ee(i.mutex.lock("From P2PChannel.publish"));try{var s;const c=i.connection&&it(s=["disconnected","failed"]).call(s,i.connection.peerConnectionState);if(!i.connection||i.state!==pe.Connected||c){if(i.state===pe.Disconnected)throw new G(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const u=t.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(u),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Ai.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield ee(i.tryToUnmuteAudio(t)));yield*zR(i1(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return ba(function*(){e.forEach(E=>{let{track:g,type:C}=E;const v=Date.now();n.store.publish(g.getTrackId(),C===q.LocalAudioTrack?"audio":"video",v)}),n.bindLocalTrackEvents(e);const i=e.map(E=>{let{track:g}=E;return g}),r=yield ee(t.send(i,n.store.codec,n.store.audioCodec)),s=(yield ee(r.next())).value,c=n.createGatewayPublishMessage(e,s);let l;try{l=yield c}catch(E){throw r.throw(E),(E==null?void 0:E.code)===O.WS_ABORT&&e.forEach(g=>{let{track:C}=g;n.pendingLocalTracks.indexOf(C)===-1&&n.pendingLocalTracks.push(C)}),n.unbindLocalTrackEvents(e),E}const u=n.mapPubResToRemoteConfig(c,l,i),h=(yield ee(r.next(u))).value;if(n.state===pe.Disconnected)throw new G(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");N("ENABLE_VIDEO_SEI");const p=N("ENABLE_ENCODED_TRANSFORM"),_=N("ENABLE_AUDIO_METADATA");i.forEach(async E=>{const g=E.getRTCRtpTransceiver();if(!g||!p)return;const{interceptLocalVideoFrame:C,interceptLocalAudioFrame:v}=jv();E.trackMediaType===ht.VIDEO?await C(g.sender,E):E.trackMediaType===ht.AUDIO&&await v(g.sender,{metadata:_?()=>{const y=E.metadata.shift();return y&&y.value}:void 0})}),e.forEach(E=>{let{type:g}=E;n.statsCollector.addLocalStats(g)}),n.assignLocalTracks(e,h),n.statsUploader.startUploadOutboundStats(),e.forEach(E=>{let{track:g,type:C}=E;const v=Date.now();n.store.publish(g.getTrackId(),C===q.LocalAudioTrack?"audio":"video",void 0,v)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof Fe))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(s,c){const l={};return s.height&&s.width&&(l.scaleResolutionDownBy=mI(s,c)),l.maxFramerate=s.framerate?Gr(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==q.LocalVideoLowTrack||!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const s=i._originMediaStreamTrack;if(!s.canvas)return S.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const u=c.canvas;l.width&&(u.width=Gr(l.width)),l.height&&(u.height=Gr(l.height)),l.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=Yb(()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()},Gr(l.framerate)))})(s,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),S.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return ba(function*(){if(!e.connection||e.state!==pe.Connected)return;const n=yield ee(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(q.LocalVideoTrack);if(!r)throw new G(O.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(q.LocalVideoLowTrack))throw new G(O.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(r.track,t),type:q.LocalVideoLowTrack}];if(yield*zR(i1(e.doPublish(e.connection,s))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(q.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield ee(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fi(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await fi(this,Rt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==ht.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==ht.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await fi(this,Rt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===ht.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(Rt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==pe.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==pe.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==pe.Connected)return;const t=this.localTrackMap.get(q.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[q.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:s}]=i;return{type:r,track:s}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==pe.Connected)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:u}=c;return l.uid===t.uid&&u===i.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var s;if(!this.connection||this.state!==pe.Connected)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;let c,l,u;const h=this.connection.getPreMedia(n);if(h)S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),u=h.transceiver,c=h.track,l=h.id;else if(r){const E=r.find(C=>{let{stream_type:v}=C;return v===e});if(!E)throw new G(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const g=await this.connection.receive(e,E.ssrcs,String(t._uintid),E.attributes);this.connection instanceof qo&&(u=g.transceiver),c=g.track,l=g.id}else{const E=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof qo&&(u=E.transceiver),c=E.track,l=E.id}if(e===ht.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new xf(c,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),u&&t._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new Uf(c,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),u&&t._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(t,t._videoTrack)),u&&N("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:E,interceptRemoteAudioFrame:g}=jv();e==ht.VIDEO?await E(u.receiver,{onSei:N("ENABLE_VIDEO_SEI")&&(C=>{var v;return(v=t._videoTrack)===null||v===void 0?void 0:v._onSei(C)})}):e==ht.AUDIO&&await g(u.receiver,{enableTopn:!!N("ENABLE_AUDIO_TOPN"),enableMetadata:!!N("ENABLE_AUDIO_METADATA"),onMetadata:C=>{this.safeEmit(Rt.AudioMetadata,C)}})}const p=this.remoteUserMap.get(t);p?p.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(E=>{let{user:g,kind:C}=E;return g.uid===t.uid&&e===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Rt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==pe.Connected)throw new G(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var s;let{user:c,mediaType:l}=r;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const s=this.connection.getPreMedia(r.ssrcId);s?n.set(r.ssrcId,s):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:u}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:u}],mslabel:String(s._uintid)}}));e.forEach((r,s)=>{n.set(r.ssrcId,i[s])});for(const{user:r,mediaType:s,ssrcId:c}of t){const l=n.get(c);if(!l)return void S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(s,", ").concat(c));const{track:u,id:h,transceiver:p}=l;if(p&&N("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:C}=jv();s==ht.VIDEO?await g(p.receiver,{onSei:N("ENABLE_VIDEO_SEI")&&(v=>{var y;return(y=r._videoTrack)===null||y===void 0?void 0:y._onSei(v)})}):s==ht.AUDIO&&await C(p.receiver,{enableTopn:!!N("ENABLE_AUDIO_TOPN"),enableMetadata:!!N("ENABLE_AUDIO_METADATA"),onMetadata:v=>{this.safeEmit(Rt.AudioMetadata,v)}})}if(s===ht.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(u):(r._audioTrack=new xf(u,r.uid,r._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),p&&r._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(u):(r._videoTrack=new Uf(u,r.uid,r._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),p&&r._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._videoTrack)),N("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:C}=jv();s==ht.VIDEO?await g(p.receiver,{onSei:v=>{var y;(y=r._videoTrack)===null||y===void 0||y._onSei(v)}}):s==ht.AUDIO&&await C(p.receiver)}const _=this.remoteUserMap.get(r);_?_.set(s,h):this.remoteUserMap.set(r,new Map([[s,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(g=>{let{user:C,kind:v}=g;return C.uid===r.uid&&s===v});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Rt.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return e!==void 0?l.uid===t.uid&&e===u:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===pe.Connected||n||i.forEach(c=>{let{kind:l}=c;var u;if(l===ht.AUDIO)(u=t._audioTrack)===null||u===void 0||u._destroy(),t._audioTrack=void 0;else if(l===ht.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==pe.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:u}]=c;var h,p;if(u===ht.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===ht.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(u===ht.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const s=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:s}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return s!==void 0?u.uid===r.uid&&s===h:u.uid===r.uid});c.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),e=e.concat(c)}if(!this.connection||this.state!==pe.Connected)return void e.forEach(r=>{let{user:s,kind:c}=r;var l;if(c===ht.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===ht.VIDEO){var u;(u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0}});const n=ji(t).call(t,(r,s)=>{let{user:c,mediaType:l}=s;const u=this.filterTobeUnSubscribedTracks(c,l);return r.concat(u)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:s}]=r;return s}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[s,{kind:c}]=r;var l,u;if(c===ht.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===ht.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(u=s._videoTrack)===null||u===void 0||u._destroy(),s._videoTrack=void 0;else if(c===ht.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==pe.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===ht.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(q.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(q.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Dn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==q.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===q.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===q.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(q.LocalAudioTrack),l=i?this.localTrackMap.get(q.LocalVideoLowTrack):this.localTrackMap.get(q.LocalVideoTrack);gt.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Le.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(u=>u instanceof an),l=i?(s=this.localTrackMap.get(q.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(u=>u instanceof Fe);gt.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Le.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===ht.VIDEO?n._videoSSRC:n._audioSSRC;r&&gt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===ht.VIDEO,audio:i===ht.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:Ai.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new vi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=qv(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(q.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Dn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=pe.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(q.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(q.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof Fe||e&&e.track instanceof an?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ta(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(q.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Om(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=pe.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=qv(this.store),this.emit(Rt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case q.LocalVideoTrack:it(e=i._hints).call(e,Le.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case q.LocalAudioTrack:i instanceof Dn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case q.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ta(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Rt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ta(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof ud?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof ud?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return ba(function*(){if(!e.connection||e.state!==pe.Connected)return;const n=yield ee(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield ee(e.connection.restartICE(t));const s=yield ee(i.next());if(s.done)return;const c=s.value,l=yield c;switch(kI(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case Ci.UDP_TCP_RELAY:e._pcStatsUploadType=Yc.UDP_TCP_RESTART;break;case Ci.TCP_RELAY:e._pcStatsUploadType=Yc.TCP_RESTART;break;case Ci.RELAY:e._pcStatsUploadType=Yc.RELAY_RESTART;break;default:e._pcStatsUploadType=Yc.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(s){var r;(r=i)===null||r===void 0||r.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(q.LocalVideoTrack),n=this.localTrackMap.get(q.LocalAudioTrack),i=t.videoSend.find(g=>g.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(g=>g.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const s=Zr(this,Rt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&s?(u+s)/2:u||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,E=e==null?void 0:e.track;if(E&&E._encoderConfig&&E._hints.indexOf(Le.SCREEN_TRACK)===-1){const g=E._encoderConfig.bitrateMax,C=t.bitrate.actualEncoded;if(g&&C){const v=(1e3*g-C)/(1e3*g);return xk[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(C=>C.ssrc===r),l=t.videoRecv.find(C=>C.ssrc===s);if(!c&&!l)return void(e+=1);const u=Zr(this,Rt.NeedSignalRTT),h=t.rtt,p=(h&&u?(h+u)/2:h||u)||0,_=c?c.jitterMs:void 0,E=t.recvPacketLossRate;let g=.7*E*100/50+.3*p/1500;_&&(g=.6*E*100/50+.2*p/1500+.2*_/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new at((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==pe.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const s=i[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,s)}if(r===q.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding){const s=this.localTrackMap.get(q.LocalVideoLowTrack);if(s){const c=t._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new at((l,u)=>{this.handleReplaceTrack(s.track,l,u,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=yf(t=t.filter(u=>r.indexOf(u)===-1));let s,c=!1;const l=this.localTrackMap.get(q.LocalAudioTrack);for(const u of t){if(u instanceof Fe&&(this.localTrackMap.has(q.LocalVideoTrack)||c?new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:q.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,n);i.push({track:h,type:q.LocalVideoLowTrack})}if(u instanceof an)if(l){const h=l.track;if(h instanceof Dn)LI([u]),h.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0);else{const p=PI([h,u]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof Dn?(LI([u]),s.addAudioTrack(u)):s||!u._useAudioElement&&ae().webAudioMediaStreamDest&&!u._bypassWebAudio?s=PI(s?[u,s]:[u]):s=u}return s&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),i.push({track:s,type:q.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=yf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof an){const r=this.localTrackMap.get(q.LocalAudioTrack);if(!r)continue;r.track instanceof Dn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([q.LocalAudioTrack,r]),r.track.close())):e.push([q.LocalAudioTrack,r])}if(i instanceof Fe){const r=this.localTrackMap.get(q.LocalVideoTrack);if(!r)continue;e.push([q.LocalVideoTrack,r]);const s=this.localTrackMap.get(q.LocalVideoLowTrack);s&&e.push([q.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(t){return t=(t=yf(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=yf(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case q.LocalVideoTrack:n.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),n.addListener(ft.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case q.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case q.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Dn?t.trackList.forEach(n=>{n.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),n.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),t.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(ft.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case q.LocalVideoTrack:n.off(ft.GET_STATS,this.handleGetLocalVideoStats),n.off(ft.GET_RTC_STATS,this.handleGetRTCStats),n.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case q.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case q.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Dn?t.trackList.forEach(e=>{e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(ft.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Uf&&e.addListener(ft.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof xf&&e.addListener(ft.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(ht.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(ht.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,c,{track:l,type:u}=n;switch(u){case q.LocalAudioTrack:s=fe.Audio,c={dtx:l instanceof Tv&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case q.LocalVideoTrack:s=it(r=l._hints).call(r,Le.SCREEN_TRACK)?fe.Screen:fe.High,c=Jo(Jo({},eM(l)),{},{codec:this.store.codec,svc_mode:Uv()});break;case q.LocalVideoLowTrack:s=fe.Low,c=Jo(Jo({},eM(l)),{},{codec:this.store.codec,svc_mode:Uv()})}return{stream_type:s,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case q.LocalVideoTrack:i=it(n=s._hints).call(n,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalAudioTrack:i=fe.Audio;break;case q.LocalVideoLowTrack:i=fe.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Rt.PeerConnectionStateChange,e),e==="connecting"&&t instanceof qo&&!Ze()&&N("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},N("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof qo&&t1(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Yc.DISCONNECTED_OR_FAILED,Zr(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));gt.reportApiInvoke(this.store.sessionId,{name:bn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:tn.TRACER}).onSuccess(),this.republish()}if(N("NEW_ICE_RESTART")&&t instanceof qo&&!Ze()&&!this._forceTurn){if(it(qk).call(qk,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{kI(t)&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),Zr(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE,r))},i=()=>{kI(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{e1(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&N("ICE_RESTART")&&Zr(this,Rt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Rt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Rt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),gt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:tn.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ta(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Df.FIRST_FRAME_DECODED),gt.firstRemoteFrame(this.store.sessionId,Fn.FIRST_AUDIO_DECODE,Ye.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ta(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,Fn.FIRST_AUDIO_RECEIVED,Ye.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ta(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,Fn.FIRST_VIDEO_RECEIVED,Ye.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Rt.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(cd(n))," -> ").concat(JSON.stringify(cd(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(cd(n))," -> ").concat(JSON.stringify(cd(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return Jo(Jo({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof qo&&function(e){Jf.delete(e.id),t1(e)}(t),t.close(),this.emit(Rt.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(q.LocalAudioTrack);if(t instanceof an&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive||e.push([q.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===q.LocalVideoTrack)){const r=this.localTrackMap.get(q.LocalVideoLowTrack);r&&e.push([q.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(q.LocalAudioTrack);if(t instanceof an&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive&&e.push([q.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===q.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(q.LocalVideoLowTrack);r&&e.push([q.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case q.LocalAudioTrack:i=fe.Audio;break;case q.LocalVideoTrack:i=it(n=s._hints).call(n,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalVideoLowTrack:i=fe.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case q.LocalAudioTrack:i=fe.Audio;break;case q.LocalVideoTrack:i=it(n=s._hints).call(n,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalVideoLowTrack:i=fe.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case ht.VIDEO:return void(i._videoSSRC&&e.push({stream_type:ht.VIDEO,ssrcId:i._videoSSRC}));case ht.AUDIO:return void(i._audioSSRC&&e.push({stream_type:ht.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let s=e.get(i);r===ht.VIDEO?s|=jn.Video:s|=jn.Audio,e.set(i,s)}else r===ht.VIDEO?e.set(i,jn.Video):e.set(i,jn.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(q.LocalVideoTrack),n=this.localTrackMap.get(q.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new at((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new at((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var s;let{stream_type:c}=i;const l=(s=e.find(u=>{let{stream_type:h}=u;return c===h}))===null||s===void 0?void 0:s.attributes;if(l&&N("DISABLE_SCREEN_SHARE_REMB")){const u=n[r]._hints;(it(u).call(u,Le.SCREEN_TRACK)||it(u).call(u,Le.SCREEN_LOW_TRACK))&&(l.remb=!1,S.debug("disable remb for screen share, hints:",u))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof an){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(s=>{let[,{id:c}]=s;return c})));const r=this.createUnmuteMessage(i);return void await Ne(this,Rt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Rt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Rt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ni(bb(this.dtlsFailedCount,In)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await fi(this,Rt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Rt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(q.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Fe)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof Fe).length>1)throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof an).length>1&&(t.some(e=>e instanceof an&&e._bypassWebAudio)||!ae().webAudioMediaStreamDest))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof Fe&&this.pendingLocalTracks.some(n=>n instanceof Fe))throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof an&&this.pendingLocalTracks.some(n=>n instanceof an)&&(!ae().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof an&&n._bypassWebAudio)))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding,r=Jo(Jo({},{width:160,height:120,framerate:15,bitrate:50}),e);let s;s=i?t._mediaStreamTrack.clone():MI(t,r);const c=De(8,"track-low-"),l=new Fe(s,Jo(Jo({},i&&{scaleResolutionDownBy:mI(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(Yu.TRANSCEIVER_UPDATED,u=>{t._updateRtpTransceiver(u,wf.LOW_STREAM)}),l._hints.push(Le.LOW_STREAM),it(n=t._hints).call(n,Le.SCREEN_TRACK)&&l._hints.push(Le.SCREEN_LOW_TRACK),t.on("sei-to-send",u=>{l.emit("sei-to-send",u)}),t.addListener(ft.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof qo){var r,s,c,l;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:_}=this.connection,{local:E,remote:g}=await this.connection.getSelectedCandidatePair();gt.pcStats(this.store.sessionId,{startTime:u,eventElapse:t-u||0,iceconnectionsate:h,dtlsstate:p,connectionstate:_,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=E==null?void 0:E.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(s=E.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(E.address,":").concat(E.port),selectedRemoteCandidateProtocol:(c=g.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=g.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ta(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===s.uid&&u.type==="video");gt.firstRemoteVideoDecode(this.store.sessionId,Fn.FIRST_VIDEO_DECODE,Ye.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.connection.getRemoteSSRC(r);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===q.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,wf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Et(Gt.prototype,"startP2PConnection",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"startP2PConnection"),Gt.prototype),Et(Gt.prototype,"connect",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"connect"),Gt.prototype),Et(Gt.prototype,"updateRemoteRTPCapabilities",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"updateRemoteRTPCapabilities"),Gt.prototype),Et(Gt.prototype,"publishDataChannel",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"publishDataChannel"),Gt.prototype),Et(Gt.prototype,"unpublish",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"unpublish"),Gt.prototype),Et(Gt.prototype,"unpublishDataChannel",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"unpublishDataChannel"),Gt.prototype),Et(Gt.prototype,"unpublishLowStream",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"unpublishLowStream"),Gt.prototype),Et(Gt.prototype,"subscribeDataChannel",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"subscribeDataChannel"),Gt.prototype),Et(Gt.prototype,"subscribe",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"subscribe"),Gt.prototype),Et(Gt.prototype,"massSubscribe",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"massSubscribe"),Gt.prototype),Et(Gt.prototype,"unsubscribe",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"unsubscribe"),Gt.prototype),Et(Gt.prototype,"unsubscribeDataChannel",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"unsubscribeDataChannel"),Gt.prototype),Et(Gt.prototype,"massUnsubscribe",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"massUnsubscribe"),Gt.prototype),Et(Gt.prototype,"muteRemote",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"muteRemote"),Gt.prototype),Et(Gt.prototype,"unmuteRemote",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"unmuteRemote"),Gt.prototype),Et(Gt.prototype,"hasRemoteMediaWithLock",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"hasRemoteMediaWithLock"),Gt.prototype),Et(Gt.prototype,"disconnectForReconnect",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"disconnectForReconnect"),Gt.prototype),Et(Gt.prototype,"updateBitrateLimit",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"updateBitrateLimit"),Gt.prototype),Et(Gt.prototype,"remoteMediaSsrcChanged",[Bi],Object.getOwnPropertyDescriptor(Gt.prototype,"remoteMediaSsrcChanged"),Gt.prototype),Gt);function Bi(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{s()}},n}function r1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function a1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?r1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const L4=Date.now(),P4=20,xI=new Map,ty=new Map;async function s1(t){const e=xI.get(t),n=Array.isArray(e)&&e[e.length-1],i=ty.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const s=n.sendTs-i.firstSendTs,c=s-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-s);let l=n.mediaDelay+c;l<=0?(e.pop(),o1(n.context,r),l=0):l=Math.min(l,P4),setTimeout(()=>e.length&&s1(t),l)}function o1(t,e){t.safeEmit(Wt.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function k4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return o1(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=xI.get(i)||[],s=r.findIndex(h=>t.sendTs>=h.sendTs),c=a1(a1({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});s===-1?r.push(c):r.splice(s,0,c),xI.set(i,r);let l=!1;var u;ty.has(i)?l=!((u=ty.get(i))===null||u===void 0||!u.isSyncing):ty.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||s1(i)}const M4=ne().name;function c1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function l1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?c1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Qf="websdk_ng_cache_parameter",U4=N("MAX_PRELOAD_ASYNC_LENGTH"),x4=1e4,ah=new Map,sh=[];let VI=null,BI=0,FI=0;const ey=new Map,V4=function(t,e){const n=[];let i=0;const r=async()=>{const s=n.shift();s&&await s(),n.length>0&&i<e?r():i--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new at(async(u,h)=>{n.push(async()=>{try{const p=await t(...c);u(p)}catch(p){h(p)}}),i<e&&(i++,r())})}}(d1,U4),jI=nr.CancelToken.source();async function d1(t,e,n,i,r,s){try{if(!N("ENABLE_PRELOAD"))return;if(!ae().supportWebCrypto)return void nd(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new G(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ei(n,"token",1,2047),ei(t,"appid",1,2047),Dv(e),i&&Lv(i);const c=Wu();S.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let u,h;typeof i=="string"?(l.stringUid=i,[h,u]=await at.all([T4(i,{sid:c,appId:t},jI.token),LM(l1(l1({},l),{},{token:n||t,uid:0}),jI.token)]),l.uid=h.uid,u.gatewayInfo.uid=l.uid,u.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),u=await LM(l,jI.token));const p={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||u.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:u};await async function(_){let E;try{_.uid&&h1({appId:_.appId,cname:_.cname,token:_.token,uid:_.uid,stringUid:_.stringUid});const g=E1(_),C=await async function(y,b){try{const I=await window.crypto.subtle.importKey("raw",nL(b),"AES-GCM",!1,["encrypt"]),L=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},I,Hu(window.btoa(JSON.stringify(y))));return id(new Uint8Array(L))}catch{return}}(_,_.token||_.appId);if(!C)return;E=_1(Qf);const v=E?JSON.parse(E):[];v.push({[g]:C}),v.length>N("AP_CACHE_NUM")&&v.shift(),ny(Qf,JSON.stringify(v))}catch(g){S.warn("Error caching server parameters:",g.message),ny(Qf,"")}}(p),BI++}catch(c){throw FI++,function(l){VI||(VI=window.setTimeout(()=>{let h="";ey.forEach((p,_)=>{h+="".concat(_,": ").concat(p," ;")}),gt.reportApiInvoke(null,{name:bn.PRELOAD,options:{success:BI,failed:FI,err:h}}).onError(l),BI=0,FI=0,ey.clear(),VI=null},x4));const u=ey.get(l.code)||0;ey.set(l.code,u+1)}(c),c}}async function u1(t){try{if(N("AP_REQUEST_DETAIL")||N("ENABLE_ROLE_SELECT_EDGE"))return;const e=h1(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const s=await window.crypto.subtle.importKey("raw",nL(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,Hu(i));return JSON.parse(window.atob(id(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<N("AP_CACHE_LIFETIME"))return n}catch(e){S.warn("Error get preloadInfo",e.message)}}function h1(t){let e;try{if(e=_1(Qf),!e)return;const n=JSON.parse(e),i=E1(t),r=function(c,l){for(let u=c.length-1;u>=0;u--)if(l(c[u]))return u;return-1}(n,c=>i in c);if(r===-1)return;const s=n.splice(r,1)[0];return ny(Qf,JSON.stringify(n)),s[i]}catch(n){S.warn("Error delete preload info: ".concat(e),n.message),ny(Qf,"")}}function GI(t){if(t){let e=ah.get(t);e&&(window.clearTimeout(e),e=null,ah.delete(t)),it(sh).call(sh,t)||t.cloudProxyServer!=="disabled"||sh.push(t)}if(ah.size<N("AP_CACHE_NUM")&&sh.length>0){const e=sh.shift();ah.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:s,uid:c,proxyServer:l}=e;try{await V4(n,i,r,c,l,s),ah.has(e)&&GI(e)}catch(u){S.warn("update preload failed",u.message),p1(e)}},N("AP_UPDATE_INTERVAL")))}}function p1(t){const e=sh.indexOf(t);e!==-1&&sh.splice(e,1);let n=ah.get(t);n&&(window.clearTimeout(n),n=null,ah.delete(t),GI())}function f1(t,e){const n=t.sua,i=t.ap;e&&n&&gt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),gt.reportResourceTiming(t.ap.url,t.sid),gt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[vn.CHOOSE_SERVER,vn.CLOUD_PROXY_FALLBACK].toString()}),gt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[vn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function _1(t){return window.atob(window.localStorage.getItem(t)||"")}function ny(t,e){window.localStorage.setItem(t,window.btoa(e))}function E1(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),lL(e)}function B4(t){let e=function(){const n=G4.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(An(i,10),pd(i,r));let s=n.cid;s!==void 0&&(An(i,16),An(i,s));let c=n.cname;c!==void 0&&(An(i,26),pd(i,c));let l=n.deviceId;l!==void 0&&(An(i,34),pd(i,l));let u=n.elapse;u!==void 0&&(An(i,40),fd(i,u));let h=n.fileSize;h!==void 0&&(An(i,48),fd(i,Zf(h)));let p=n.height;p!==void 0&&(An(i,56),fd(i,Zf(p)));let _=n.jpg;_!==void 0&&(An(i,66),An(i,_.length),g1(i,_));let E=n.networkType;E!==void 0&&(An(i,72),fd(i,Zf(E)));let g=n.osType;g!==void 0&&(An(i,80),fd(i,Zf(g)));let C=n.requestId;C!==void 0&&(An(i,90),pd(i,C));let v=n.sdkVersion;v!==void 0&&(An(i,98),pd(i,v));let y=n.sequence;y!==void 0&&(An(i,104),fd(i,Zf(y)));let b=n.sid;b!==void 0&&(An(i,114),pd(i,b));let I=n.timestamp;I!==void 0&&(An(i,120),fd(i,I));let L=n.uid;L!==void 0&&(An(i,128),An(i,L));let U=n.vid;U!==void 0&&(An(i,136),An(i,U));let x=n.width;x!==void 0&&(An(i,144),fd(i,Zf(x)));let M=n.service;M!==void 0&&(An(i,152),An(i,M));let j=n.callbackData;j!==void 0&&(An(i,162),An(i,j.length),g1(i,j));let X=n.ticket;X!==void 0&&(An(i,170),pd(i,X));let ct=n.vendorConfigs;ct!==void 0&&(An(i,178),pd(i,ct))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function F4(t){return function(n){let i={};t:for(;!H4(n);){let r=ug(n);switch(r>>>3){case 0:break t;case 1:i.code=ug(n);break;case 2:i.msg=S1(n,ug(n));break;case 3:i.requestId=S1(n,ug(n));break;case 4:i.timestamp=W4(n,!1);break;default:j4(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function j4(t,e){switch(e){case 0:for(;128&ds(t););break;case 2:HI(t,ug(t));break;case 5:HI(t,4);break;case 1:HI(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function Zf(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let G4=[];function HI(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function H4(t){return t.offset>=t.limit}function iy(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function m1(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function g1(t,e){let n=iy(t,e.length);t.bytes.set(e,n)}function S1(t,e){let n=m1(t,e),i=String.fromCharCode,r=t.bytes,s="",c="";for(let l=0;l<e;l++){let u,h,p,_,E=r[l+n];(128&E)==0?c+=i(E):(224&E)==192?l+1>=e?c+=s:(u=r[l+n+1],(192&u)!=128?c+=s:(_=(31&E)<<6|63&u,_<128?c+=s:(c+=i(_),l++))):(240&E)==224?l+2>=e?c+=s:(u=r[l+n+1],h=r[l+n+2],(49344&(u|h<<8))!=32896?c+=s:(_=(15&E)<<12|(63&u)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=i(_),l+=2))):(248&E)==240?l+3>=e?c+=s:(u=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(u|h<<8|p<<16))!=8421504?c+=s:(_=(7&E)<<18|(63&u)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s}return c}function pd(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}An(t,i);let r=iy(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function ds(t){return t.bytes[m1(t,1)]}function T1(t,e){let n=iy(t,1);t.bytes[n]=e}function ug(t){let e,n=0,i=0;do e=ds(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function An(t,e){for(e>>>=0;e>=128;)T1(t,127&e|128),e>>>=7;T1(t,e)}function W4(t,e){let n,i=0,r=0,s=0;return n=ds(t),i=127&n,128&n&&(n=ds(t),i|=(127&n)<<7,128&n&&(n=ds(t),i|=(127&n)<<14,128&n&&(n=ds(t),i|=(127&n)<<21,128&n&&(n=ds(t),r=127&n,128&n&&(n=ds(t),r|=(127&n)<<7,128&n&&(n=ds(t),r|=(127&n)<<14,128&n&&(n=ds(t),r|=(127&n)<<21,128&n&&(n=ds(t),s=127&n,128&n&&(n=ds(t),s|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|s<<24,unsigned:e}}function fd(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=iy(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}const R1={},v1={},ry=4294967296,K4=ry*ry,Y4=K4/2;C1(0,!0);const y1=C1(0),z4=hg(0,-2147483648,!1),q4=hg(-1,2147483647,!1);function C1(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=v1[t],i)?i:(n=hg(t,0,!0),r&&(v1[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=R1[t],i)?i:(n=hg(t,t<0?-1:0,!1),r&&(R1[t]=n),n)}function hg(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function A1(t,e){if(isNaN(t))return y1;{if(t<=-9223372036854776e3)return z4;if(t+1>=Y4)return q4}return t<0?y1:hg(t%ry|0,t/ry|0,e)}function b1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class WI extends Je{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Xs.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),A(this,"name","AgoraRTCImageModeration"),A(this,"_connectionState",Na.CONNECTING),A(this,"_sequence",0),A(this,"_moderationStartTime",void 0),A(this,"_workerConnection",void 0),A(this,"_workerMessageLengthLimit",void 0),A(this,"_qualityRatio",void 0),A(this,"_connectInfo",void 0),A(this,"_cancelTokenSource",nr.CancelToken.source()),A(this,"_retryConfig",void 0),A(this,"_moderationInterval",void 0),A(this,"_moderationTimer",null),A(this,"_moderationMode",1),A(this,"_quality",1),A(this,"_qualityTimer",null),A(this,"_ticket",void 0),A(this,"_moderationIntervalMinimum",void 0),A(this,"_uploadFailedNum",0),A(this,"_uploadNum",0),A(this,"_uploadTimer",null),A(this,"_extraInfo",void 0),A(this,"_vendor",""),A(this,"_encoder",new TextEncoder),A(this,"_moderationId",void 0),A(this,"inspectImage",()=>{if(this.connectionState!==Na.CONNECTED)throw new B(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Na.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=De(5,"image-moderation-"),this._workerMessageLengthLimit=N("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=N("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=N("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new eg("worker-"+this._moderationId,In),this.on(Xs.STATE_CHANGE,(i,r)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(jf[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(Xs.STATE_CHANGE,jf.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new at((r,s)=>{this.on(Xs.CONNECTION_STATE_CHANGE,(c,l)=>{c===Na.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Na.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=N("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),s=await function(u,h,p,_){let{appId:E,areaCode:g,cname:C,sid:v,token:y,uid:b}=h;zf++;const I="moderation_plugin",L={service_name:I,json_body:JSON.stringify({appId:E,areaCode:g,cname:C,command:"allocateEdge",requestId:zf,seq:zf,sid:v,appToken:y,ts:Date.now(),uid:b+""})};let U,x,M=u[0];return Ks(async()=>{U=Date.now();const j=await Js(M,{data:L,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(x=Date.now()-U,j.code!==0){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+j.code,{retry:!0,responseTime:x});throw S.error(dt.toString()),dt}const X=JSON.parse(j.json_body);if(X.code!==200){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(X.code,", reason: ").concat(X.reason),{code:X.code,responseTime:x});throw S.error(dt.toString()),dt}if(!X.servers||!Array.isArray(X.servers)||X.servers.length===0){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:X.code,responseTime:x});throw S.error(dt.toString()),dt}if(!X.servers.some(dt=>!!dt.wss)){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:X.code,responseTime:x});throw S.error(dt.toString()),dt}const ct=N("IMAGE_MODERATION_WORKER_HOST");return{addressList:X.servers.map(dt=>{let{address:zt,wss:qt}=dt;if(zt&&qt)return"wss://".concat(zt.replace(/\./g,"-"),".").concat(ct,":").concat(qt,"/moderation")}).filter(dt=>!!dt),workerToken:X.workerToken,vid:X.vid,ticket:X.appTicket,responseTime:x}},(j,X)=>(gt.apworkerEvent(v,{success:!0,sc:200,serviceName:I,responseDetail:JSON.stringify(j.addressList),firstSuccess:X===0,responseTime:x,serverIp:u[X%u.length]}),!1),(j,X)=>(gt.apworkerEvent(v,{success:!1,sc:j.data&&j.data.code||200,serviceName:I,responseTime:x,serverIp:u[X%u.length]}),!!(j.code!==O.OPERATION_ABORTED&&j.code!==O.UNEXPECTED_RESPONSE||j.data&&j.data.retry)&&(M=u[(X+1)%u.length],!0)),_)}(r,e,n,i);this.emit(Xs.STATE_CHANGE,jf.AP_CONNECTED);const{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(e){this.emit(Xs.STATE_CHANGE,jf.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Pt.CONNECTED,async()=>{this.emit(Xs.STATE_CHANGE,jf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Na.CONNECTED}),this._workerConnection.on(Pt.CLOSED,()=>{this.connectionState=Na.CLOSED}),this._workerConnection.on(Pt.FAILED,()=>{this.connectionState=Na.CLOSED}),this._workerConnection.on(Pt.RECONNECTING,()=>{this.connectionState=this.connectionState===Na.CONNECTED?Na.RECONNECTING:Na.CONNECTING}),this._workerConnection.on(Pt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=F4(new Uint8Array(e.data));N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{gt.reportApiInvoke(this._connectInfo.sid||null,{name:bn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:tn.TRACER}).onError(new B(O.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},N("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Pt.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(Pt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Zr(this,Xs.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:u}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),_=await ZL(p,i,r),E=this._sequence+"-"+s+"-"+u+"-"+h+"-"+De(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:WI.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:E,sdkVersion:"4.23.2",sequence:this._sequence,sid:l,timestamp:A1(h),uid:u,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete g.callbackData;const C=B4(g);if(C.byteLength<this._workerMessageLengthLimit){if(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const v=function(y){for(var b=1;b<arguments.length;b++){var I=arguments[b]!=null?arguments[b]:{};b%2?b1(Object(I),!0).forEach(function(L){A(y,L,I[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(I)):b1(Object(I)).forEach(function(L){Object.defineProperty(y,L,Object.getOwnPropertyDescriptor(I,L))})}return y}({},g);delete v.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(v))}return C}{const v=this.quality*this._qualityRatio;return this.quality=v,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=nr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Na.CLOSED,this.emit(Xs.STATE_CHANGE,jf.CLOSED)}}function I1(t){if(ye(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new B(O.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const X4={name:"ImageModeration",create:function(t){let{config:e}=t;return I1(e),new WI(e)}};var O1,w1,N1,D1,L1,P1,k1,M1,U1,x1,V1,B1,F1,j1,G1,H1,W1,K1,Y1,z1,q1,X1,J1,Q1,Z1,$1,tU,eU,nU,iU,rU,aU,sU,oU,cU,lU,dU,uU,hU,pU,fU,lt;function _U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function us(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_U(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_U(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}vi.setLogger(S);let J4=(O1=yt(),w1=yt({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Pf))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),N1=yt({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Lf.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),D1=yt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),L1=yt({argsMap:(t,e,n)=>[e,n]}),P1=yt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),k1=yt({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),M1=yt({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),U1=yt(),x1=yt(),V1=yt(),B1=yt(),F1=yt(),j1=yt(),G1=yt(),H1=yt(),W1=yt(),K1=yt(),Y1=yt(),z1=yt(),q1=yt(),X1=yt(),J1=yt(),Q1=yt({argsMap:(t,e)=>[e]}),Z1=yt(),$1=yt(),tU=yt(),eU=yt(),nU=yt(),iU=yt(),rU=yt(),aU=yt(),sU=yt({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),oU=yt(),cU=yt(),lU=yt(),dU=yt(),uU=yt(),hU=yt(),pU=yt({reportResult:!0}),fU=yt(),lt=class extends Je{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),A(this,"store",void 0),A(this,"_uid",void 0),A(this,"_channelName",void 0),A(this,"_uintUid",void 0),A(this,"_users",[]),A(this,"_config",void 0),A(this,"_clientId",void 0),A(this,"_appId",void 0),A(this,"_sessionId",null),A(this,"_key",void 0),A(this,"_rtmConfig",{}),A(this,"_joinInfo",void 0),A(this,"_gateway",void 0),A(this,"_statsCollector",void 0),A(this,"_configDistribute",void 0),A(this,"_leaveMutex",void 0),A(this,"_publishMutex",void 0),A(this,"_renewTokenMutex",void 0),A(this,"_subscribeMutex",void 0),A(this,"_encryptionMode","none"),A(this,"_encryptionSecret",null),A(this,"_encryptionSalt",null),A(this,"_encryptDataStream",!1),A(this,"_encryptDataStreamKey",null),A(this,"_encryptDataStreamIv",null),A(this,"_proxyServer",void 0),A(this,"_turnServer",{servers:[],mode:"auto"}),A(this,"_cloudProxyServerMode","disabled"),A(this,"_isDualStreamEnabled",!1),A(this,"_defaultStreamFallbackType",void 0),A(this,"_lowStreamParameter",void 0),A(this,"_streamFallbackTypeCacheMap",new Map),A(this,"_remoteStreamTypeCacheMap",new Map),A(this,"_axiosCancelSource",nr.CancelToken.source()),A(this,"_audioVolumeIndicationInterval",void 0),A(this,"_networkQualityInterval",void 0),A(this,"_userOfflineTimeout",void 0),A(this,"_streamRemovedTimeout",void 0),A(this,"_liveTranscodeStreamingClient",void 0),A(this,"_liveRawStreamingClient",void 0),A(this,"_channelMediaRelayClient",void 0),A(this,"_networkQualitySensitivity","normal"),A(this,"_p2pChannel",void 0),A(this,"_useLocalAccessPoint",!1),A(this,"_setLocalAPVersion",void 0),A(this,"_joinAndNotLeaveYet",!1),A(this,"_numberOfJoinCount",0),A(this,"_remoteDefaultVideoStreamType",void 0),A(this,"_inspect",void 0),A(this,"_moderation",void 0),A(this,"_license",void 0),A(this,"_pendingPublishedUsers",[]),A(this,"ntpAlignErrorCount",0),A(this,"remoteInboundOffset",0),A(this,"_peerConnectionState",void 0),A(this,"_handleLocalTrackEnable",(r,s,c)=>{this.publish(r,!1).then(s).catch(c)}),A(this,"_handleLocalTrackDisable",(r,s,c)=>{this.unpublish(r).then(s).catch(c)}),A(this,"_handleUserOnline",r=>{if(N("BLOCK_LOCAL_CLIENT")&&Zu(r.uid,this.channelName))return void S.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(c=>c.uid===r.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(Wt.USER_JOINED,s));else{const c=new ud(r.uid,r.uint_id||r.uid);this._users.push(c),S.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(Wt.USER_JOINED,c)}}),A(this,"_handleUserOffline",r=>{if(N("BLOCK_LOCAL_CLIENT")&&Zu(r.uid,this.channelName))return;const s=this._users.find(c=>c.uid===r.uid);s&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:sv(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),S.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(Wt.USER_LEAVED,s,r.reason))}),A(this,"_handleAddAudioOrVideoStream",(r,s,c,l,u,h,p)=>{if(N("BLOCK_LOCAL_CLIENT")&&Zu(s,this.channelName))return;const _=this._users.find(g=>g.uid===s);if(!_)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(_.uid,r,void 0,void 0,void 0,Date.now());const E=r==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=u||s),r==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,r==="audio"?(_._audio_added_=!0,c!==void 0&&(_._audioSSRC=c),l!==void 0&&(_._cname=l),h&&(_._audioOrtc=h)):(_._video_added_=!0,c!==void 0&&(_._videoSSRC=c),l!==void 0&&(_._cname=l),p!==void 0&&(_._rtxSsrcId=p),h&&(_._videoOrtc=h)),(r==="audio"?_.hasAudio:_.hasVideo)&&!E&&(S.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(r)),this.safeEmit(Wt.USER_PUBLISHED,_,r)),r==="video"?gt.onGatewayStream(this._sessionId,Fn.ON_ADD_VIDEO_STREAM,Ye.ON_ADD_VIDEO_STREAM,{peer:u||s,ssrc:_._videoSSRC}):gt.onGatewayStream(this._sessionId,Fn.ON_ADD_AUDIO_STREAM,Ye.ON_ADD_AUDIO_STREAM,{peer:u||s,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,r,c).then(g=>{if(g&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof dg))return this._p2pChannel.unsubscribe(_,r,!0).then(()=>this._subscribe(_,r,!0).catch(C=>{S.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,r)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,r,!0).catch(g=>{S.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),A(this,"_handleRemoveStream",r=>{if(N("BLOCK_LOCAL_CLIENT")&&Zu(r.uid,this.channelName))return;const s=this._users.find(l=>l.uid===r.uid);if(!s)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};s.hasAudio&&s.hasVideo?c=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Wt.USER_UNPUBLISHED,s,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Wt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?c=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(Wt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(c=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(Wt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof dg&&this._p2pChannel.unsubscribe(s).then(l=>{if(l)return this._gateway.unsubscribe(l,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),gt.onGatewayStream(this._sessionId,Fn.ON_REMOVE_STREAM,Ye.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),A(this,"_handleSetStreamLocalEnable",(r,s,c)=>{if(N("BLOCK_LOCAL_CLIENT")&&Zu(s,this.channelName))return;const l=this._users.find(p=>p.uid===s);if(!l)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(s));const u=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{const _=l._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Wt.USER_INFO_UPDATED,s,_)}}else{l._trust_video_enabled_state_=!0;const p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{const _=l._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(Wt.USER_INFO_UPDATED,s,_)}}const h=r==="audio"?l.hasAudio:l.hasVideo;return u!==h?!u&&h?(S.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(r)),void this.safeEmit(Wt.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),S.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(r)),void this.safeEmit(Wt.USER_UNPUBLISHED,l,r)):void 0}),A(this,"_handleMuteStream",(r,s,c)=>{if(N("BLOCK_LOCAL_CLIENT")&&Zu(r,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),r,s,c);const l=this._users.find(p=>p.uid===r);if(!l)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const u=s==="audio"?l.hasAudio:l.hasVideo;if(s==="audio"){l._trust_audio_mute_state_=!0;const p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{const _=l._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(_)),this.safeEmit(Wt.USER_INFO_UPDATED,r,_)}}else{l._trust_video_mute_state_=!0;const p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{const _=l._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(_)),this.safeEmit(Wt.USER_INFO_UPDATED,r,_)}}const h=s==="audio"?l.hasAudio:l.hasVideo;if(u!==h){if(!u&&h)return(s==="audio"?l._audioSSRC:l._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(s)),void this.safeEmit(Wt.USER_PUBLISHED,l,s)):void S.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),s==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,s),S.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(s)),this.safeEmit(Wt.USER_UNPUBLISHED,l,s)}}),A(this,"_handleP2PLost",async r=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),A(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Wt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),A(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),A(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Wt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Wt.NETWORK_QUALITY,r)}),A(this,"_handleP2PAddAudioOrVideoStream",(r,s,c,l)=>{const u=this._users.find(p=>p.uid===s);if(!u)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(u.uid,r,void 0,void 0,void 0,Date.now());const h=r==="audio"?u.hasAudio:u.hasVideo;r==="audio"?u._trust_audio_stream_added_state_=!0:u._trust_video_stream_added_state_=!0,r==="audio"?(u._audio_added_=!0,c!==void 0&&(u._audioSSRC=c),l!==void 0&&(u._audioMid=l)):(u._video_added_=!0,c!==void 0&&(u._videoSSRC=c),l!==void 0&&(u._videoMid=l)),(r==="audio"?u.hasAudio:u.hasVideo)&&!h&&(S.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published ").concat(r)),this.safeEmit(Wt.USER_PUBLISHED,u,r)),this._p2pChannel.hasPendingRemoteMedia(u,r)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(u.uid," after reconnect.")),this._subscribe(u,r,!0).catch(p=>{S.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=t,this._clientId=e||De(5,"client-"),this.store=new class{constructor(r,s,c,l){wt(this,"state",void 0),this.state={codec:r,audioCodec:s,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Ku.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(r){this.state=function(s,c){switch(c.type){case Kt.SET_SESSION_ID:return ut(ut({},s),{},{sessionId:c.sessionId});case Kt.SET_P2P_ID:return ut(ut({},s),{},{p2pId:c.p2pId});case Kt.SET_UID:return ut(ut({},s),{},{uid:c.uid});case Kt.SET_INT_UID:return ut(ut({},s),{},{intUid:c.intUid});case Kt.SET_PUB_ID:return ut(ut({},s),{},{pubId:c.pubId});case Kt.KEY_METRIC_CLIENT_CREATED:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{clientCreated:c.metric})});case Kt.KEY_METRIC_JOIN_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinStart:c.metric})});case Kt.AVOID_JOIN_START:return ut(ut({},s),{},{avoidJoinStart:c.avoidJoinStart});case Kt.KEY_METRIC_JOIN_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinEnd:c.metric})});case Kt.KEY_METRIC_REQUEST_AP_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{requestAPStart:c.metric})});case Kt.KEY_METRIC_REQUEST_AP_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{requestAPEnd:c.metric})});case Kt.KEY_METRIC_JOIN_GATEWAY_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinGatewayStart:c.metric})});case Kt.KEY_METRIC_JOIN_GATEWAY_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{joinGatewayEnd:c.metric})});case Kt.KEY_METRIC_PEER_CONNECTION_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{peerConnectionStart:c.metric})});case Kt.KEY_METRIC_PEER_CONNECTION_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{peerConnectionEnd:c.metric})});case Kt.KEY_METRIC_DESCRIPTION_START:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{descriptionStart:c.metric})});case Kt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{signalChannelOpen:c.metric})});case Kt.KEY_METRIC_ICE_CONNECTION_END:return ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{iceConnectionEnd:c.metric})});case Kt.KEY_METRIC_PUBLISH:{const l=s.keyMetrics.publish,u=l.findIndex(h=>h.trackId===c.metric.trackId);return u!==-1?(l[u]=ut(ut({},l[u]),c.metric),ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{publish:[...l]})})):ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,c.metric]})})}case Kt.KEY_METRIC_SUBSCRIBE:{const l=s.keyMetrics.subscribe,u=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return u!==-1?(l[u]=ut(ut({},l[u]),c.metric),ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{subscribe:[...l]})})):ut(ut({},s),{},{keyMetrics:ut(ut({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,c.metric]})})}case Kt.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=c.mode,s;case Kt.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,c.record]:(s.joinChannelServiceRecords[c.index]=ut(ut({},s.joinChannelServiceRecords[c.index]),c.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case Kt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case Kt.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[]},s;case Kt.SET_USE_P2P:return ut(ut({},s),{},{useP2P:c.val});case Kt.SET_TRANSPORT_TYPE:return ut(ut({},s),{},{p2pTransport:c.val});default:return s}}(this.state,r)}set sessionId(r){this.dispatch({type:Kt.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:Kt.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:Kt.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:Kt.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:Kt.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:Kt.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:Kt.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:Kt.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:Kt.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Kt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Kt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Kt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Kt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Kt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Kt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Kt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Kt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Kt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Kt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Kt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Kt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,s,c,l){this.dispatch({type:Kt.KEY_METRIC_PUBLISH,metric:ut(ut({trackId:r,type:s},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,s,c,l,u,h,p){this.dispatch({type:Kt.KEY_METRIC_SUBSCRIBE,metric:ut(ut(ut(ut(ut({userId:r,type:s},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),u&&{firstFrame:u}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,s,c,l){r.forEach(u=>{this.dispatch({type:Kt.KEY_METRIC_SUBSCRIBE,metric:ut(ut(ut({userId:u.userId,type:u.type},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,s){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:Kt.RECORD_JOIN_CHANNEL_SERVICE,record:ut(ut({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Kt.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Kt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Kt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:Kt.AVOID_JOIN_START,avoidJoinStart:r})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new vi("client-leave",this._clientId),this._publishMutex=new vi("client-publish",this._clientId),this._renewTokenMutex=new vi("client-renewtoken",this._clientId),this._subscribeMutex=new vi("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ia," build: ").concat(Ub,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{yb(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){S.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new cg(this.store),this._statsCollector.onStatsException=(r,s,c)=>{S.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(s,", uid: ").concat(c)),this.safeEmit(Wt.EXCEPTION,{code:r,msg:s,uid:c})},this._statsCollector.onUploadPublishDuration=(r,s,c,l)=>{const u=this._users.find(h=>h.uid===r);u&&gt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:s,videoPublishDuration:c,peer:u._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new f4(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||In,httpRetryConfig:t.httpRetryConfig||In,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new C4(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},zc("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new dg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ge("JOIN_GATEWAY_USE_443PORT_ONLY",s),ge("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof _I&&(l.use443PortOnly=s,l.tryDoubleDomain=c),async function(u,h,p){ev.get(u)||ev.set(u,[]),nv.get(u)||nv.set(u,h),Fo.get(u)||Fo.set(u,0);const _=ev.get(u),E=nv.get(u);if(!_||!E)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Fo.get(u)===E){const b=Bm();_.push(b),await b.promise}Fo.set(u,Fo.get(u)+1);for(var g=arguments.length,C=new Array(g>3?g-3:0),v=3;v<g;v++)C[v-3]=arguments[v];const y=await p(...C);return Fo.set(u,Fo.get(u)-1),Fo.get(u)===E-1&&_.length>0&&(_[0].resolve(),_.shift()),Fo.get(u)===0&&(ev.set(u,[]),nv.set(u,0),Fo.set(u,0)),y}("client.join",N("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const s=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(lv||lv||(lv=(window.location.protocol.split(":")[0]||"").toUpperCase(),lv))==="HTTPS",l=hL()?window.isSecureContext:"Browser Not Support";(!hL()&&!c||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),S.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),gt.setAppId(t);try{if(!n&&n!==null)throw new B(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ei(n,"token",1,2047),ei(t,"appid",1,2047),Dv(e),i&&Lv(i),r&&ei(r,"optionalInfo",1,2047)}catch(v){throw gt.reportApiInvoke(Wu(),{name:bn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:tn.TRACER}).onError(v),v}if(this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const v=new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw gt.reportApiInvoke(Wu(),{name:bn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:tn.TRACER}).onError(v),v}this._gateway.state="CONNECTING";const u=await u1({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const h=(u==null?void 0:u.sid)||Wu();S.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);const p=gt.reportApiInvoke(h,{id:this._clientId,name:bn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:tn.TRACER}),_=us(us(us({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:N("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(_.stringUid=i,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async v=>{const y=function(U){const x=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),M=new Uint8Array(new ArrayBuffer(x.length));for(let j=0;j<x.length;j+=1)M[j]=x.charCodeAt(j);return M}(),b=await window.crypto.subtle.importKey("spki",y,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),I=Rb(v),L=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},b,I);return function(U){let x="";for(let M=0;M<U.length;M+=1)x+=String.fromCharCode(U[M]);return window.btoa(x)}(new Uint8Array(L))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const v=new TextEncoder,y=N("USE_PURE_ENCRYPTION_MASTER_KEY")?v.encode(_.appId+this._encryptionSecret+this._encryptionSecret):v.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(b,I,L){const U=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),x=b==="aes-128-gcm2"?128:256,M=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:vL,hash:"SHA-256",salt:L},U,x+Wj);return new Uint8Array(M).subarray(x/8)}(this._encryptionMode,y,Hu(this._encryptionSalt)),this._encryptDataStreamKey=await async function(b,I,L){const U=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),x=b==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:vL,hash:"SHA-256",salt:L},U,{name:"AES-GCM",length:x},!0,["encrypt","decrypt"])}(this._encryptionMode,y,Hu(this._encryptionSalt))}else l?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:_.stringUid});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&gt.joinChannelTimeout(this._sessionId,5)},5e3);try{var g;let v;const y=_.cloudProxyServer;if(it(g=["proxy3","proxy4","proxy5"]).call(g,y)){const x=N("PROXY_SERVER_TYPE3");Array.isArray(x)?_.proxyServer=x[0]:_.proxyServer=x}if(gt.setProxyServer(_.proxyServer),S.setProxyServer(_.proxyServer),this.store.requestAPStart(),u){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(u.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=u.intUid),v={gatewayInfo:u.ap.gatewayInfo},N("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const x=(await iM(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(M=>({turnServerURL:M.address,tcpport:M.tcpport||_i.tcpport,udpport:M.udpport||_i.udpport,username:M.username||_i.username,password:M.password||_i.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:x}}f1(u,_.stringUid)}else{if(_.stringUid&&!_.uid){let x;[x,v]=await at.all([DM(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||In,this.store),NM(_,this._axiosCancelSource.token,this._config.httpRetryConfig||In,!0,this.store)]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(x)),_.uid=x,v.gatewayInfo.uid=x,v.gatewayInfo.res.uid=x}else v=await NM(_,this._axiosCancelSource.token,this._config.httpRetryConfig||In,!0,this.store);if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on($m.UPDATE_BITRATE_LIMIT,x=>{this._p2pChannel.updateBitrateLimit(x)}),this._configDistribute.on($m.UPDATE_CLIENT_ROLE_OPTIONS,x=>{this._setClientRoleOptions(x)})},0),this._key=n||t;const b=v.gatewayInfo,I=_.uid?_.uid:b.uid;this._joinInfo=us(us({},_),{},{cid:b.cid,uid:I,vid:b.vid,apResponse:b.res,apGatewayAddress:b.apGatewayAddress,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),this.store.intUid=I,this.store.cid=b.cid;const L=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(L),this._appId=t,this._channelName=_.cname,this._uid=L,this.store.uid=L,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(hi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const U=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(U)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),C=this,it(Qu).call(Qu,C)||Qu.push(C),this._cloudProxyServerMode==="disabled"&&ae().supportWebCrypto&&N("ENABLE_PRELOAD")&&GI(this._joinInfo),L}catch(v){const y=Array.isArray(v)?v[0]:v;throw y&&y.code===O.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),y):S.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),y),y.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(y),y}var C}_joinGateway(){if(!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!N("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(hi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=Qu.indexOf(e);n!==-1&&Qu.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",he.LEAVE),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Pf))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new B(O.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new B(O.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof Pf))throw new B(O.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new B(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const s=this._configDistribute.getBitrateLimit();r instanceof Fe&&s&&r.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),S.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw S.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){ye(t.id,"id",0,65535,!0),Fc(t.ordered,"ordered"),ei(t.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new B(O.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return RM(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new B(O.CREATE_DATACHANNEL_ERROR);try{await at.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==O.DISCONNECT_P2P)throw r}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw S.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Pf))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(_n.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw S.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof ud)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(Un(e,"mediaType",["audio","video"]),this.store.useP2P)throw new B(O.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===ht.AUDIO,i=e===ht.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:c,rtxSsrcId:l,cname:u,uint_id:h}=await this._gateway.presubscribe(t,e,!0);if(s==null)throw new B(O.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(E=>E.uid===t);p||(p=new ud(t,h||t),p._is_pre_created=!0,this._users.push(p)),u&&(p._cname=u),p._uintid||(p._uintid=h||t),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),i&&(p._videoSSRC=s,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,e,s,l,c);const _=n?p._audioTrack:p._videoTrack;if(!_)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),i&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),_}catch(s){throw S.error("[".concat(this._clientId,"] presub user ").concat(t," error"),s),s}finally{r()}}async _subscribeDataChannel(t,e){var n;if(ye(e,"channelId",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new B(O.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new B(O.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new B(O.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&it(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new B(O.CREATE_DATACHANNEL_ERROR);const u={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,u,!0),await r._waitTillOpen()}catch(u){if((u==null?void 0:u.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),u;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{s()}}async _p2pSubscribe(t,e,n){if(Un(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===t)){const s=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),s}if(!t.hasAudio&&!t.hasVideo){const s=new B(O.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),s}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const s=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),s}const r=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const s=e==="audio"?t._audioTrack:t._videoTrack;if(!s)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),s),s}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(Un(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===t)){const h=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),h}if(!t.hasAudio&&!t.hasVideo){const h=new B(O.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),h}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const h=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),h}let r=e==="audio"?t._audioSSRC:t._videoSSRC,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?ht.AUDIO:ht.VIDEO,ssrcId:r};const u=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const p=e==="audio"?t._audioSSRC:t._videoSSRC;p!==void 0&&p!==r&&(r=p,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?ht.AUDIO:ht.VIDEO,ssrcId:r}),Ai.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,s);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(_){if((_==null?void 0:_.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),_;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,t,e),p}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=e==="audio"?t._audioTrack:t._videoTrack;if(!h)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),h),h}finally{u()}}async massSubscribe(t){if(jc(t,"subscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:u,mediaType:h}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:u,mediaType:h}=l;return{user:u,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let u=t.length-1;u>=0;u--){const h=t[u],{user:p,mediaType:_}=h;if(Un(_,"mediaType",["audio","video"]),!p){const v=new B(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),v}if(!this._users.find(v=>v===p)){const v=new B(O.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),r[u].error=v,t.splice(u,1);continue}if(_==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||_==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const v=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(_,", remote user is not published")),r[u].error=v,t.splice(u,1);continue}const g=jn.Video|jn.LwoVideo,C=n.get(p);if(C){if(_==="video"?C&g:C&jn.Audio){t.splice(u,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(_," twice"));continue}n.set(p,C|(_==="video"?g:jn.Audio))}else n.set(p,_==="video"?g:jn.Audio)}for(let u=t.length-1;u>=0;u--){const h=t[u],{user:p,mediaType:_}=h,E=jn.Video|jn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,_)){await this._p2pChannel.unmuteRemoteNoLock(p,_);const g=n.get(p);n.set(p,_==="video"?g^E:g^jn.Audio),t.splice(u,1)}}this.store.massSubscribe(t.map(u=>({userId:u.user.uid,type:u.mediaType})),e);let l=ji(c=Array.from(n.entries())).call(c,(u,h)=>{let[p,_]=h;if(_===0)return u;const E={stream_id:p.uid,stream_type:_};return _&jn.Audio&&(E.audio_ssrc=p._audioSSRC),_&jn.Video&&(E.video_ssrc=p._videoSSRC),u.push(E),u},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:p,mediaType:_}=h;return{user:p,mediaType:_,ssrcId:_===ht.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:_===ht.VIDEO?p._rtxSsrcId:void 0}}));const u=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:_,video_error_code:E,audio_error_code:g,error_code:C}=p;(E||g||C)&&u.set(_,{video_error_code:E,audio_error_code:g,error_code:C})})}if(Array.from(u.entries()).length>0){const h=[];Array.from(u.entries()).forEach(p=>{let[_,E]=p;const g=this.remoteUsers.find(C=>C.uid===_);if(g){let C;E.error_code||E.video_error_code&&E.audio_error_code?C=void 0:E.video_error_code?C=ht.VIDEO:E.audio_error_code&&(C=ht.AUDIO),h.push({user:g,mediaType:C})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const p=u.get(h.user.uid);if(p){const _=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(_){const E=tg(_);S.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(E.desc)),h.error=new B(O.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(E.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var p;gt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===ht.VIDEO,audio:h.mediaType===ht.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===ht.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:p,mediaType:_}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_)}).join("; "))),r}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(t),u}}finally{s(),i()}}async unsubscribe(t,e,n){if(!(t instanceof ud)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");t=s}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Un(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const s=await this._p2pChannel.unsubscribe(t,e);s&&await this._gateway.unsubscribe(s,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&sv(this._users,t),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(s){if(s.code===O.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&ye(e,"id",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(s=>s.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===O.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(jc(t,"unsubscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new B(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(Un(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=jn.Video|jn.LwoVideo;if(e.has(i)){const l=e.get(i);let u;switch(r){case"video":u=l&c;break;case"audio":u=l&jn.Audio;break;default:u=l&(jn.Audio|c)}if(u){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|jn.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|jn.Audio|c)}else r?r==="audio"?e.set(i,jn.Audio):r==="video"&&e.set(i,c):e.set(i,jn.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:s}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===O.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new G(O.INVALID_PARAMS);$e(n.width)||Sb(n.width,"streamParameter.width"),$e(n.height)||Sb(n.height,"streamParameter.height"),$e(n.framerate)||Sb(n.framerate,"streamParameter.framerate"),$e(n.bitrate)||ye(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,q.LocalVideoLowTrack)}async enableDualStream(){if(!ae().supportDualStream)throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new B(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new B(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(q.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Un(i,"role",["audience","host"])}(t),e&&yb(e),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new B(O.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new B(O.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new B(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&N("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",pi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),S.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&yb(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{S.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(ei(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,gt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}if(Wm(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>tL(n)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"you should set license before join channel");if(ei(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new B(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,S.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new B(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new B(O.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Stop proxy server after leave channel");gt.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new B(O.INVALID_PARAMS,"accessPoints is required.");jc(t.accessPoints.serverList,"accessPoints.serverList"),ei(t.accessPoints.domain,"accessPoints.domain");const e=(E,g)=>{ye(E,g,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");N("CLOSE_AFB_FOR_LOCAL_AP")&&(ge("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ge("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,s=t.accessPoints.serverList.map(E=>i.test(E)?"".concat(E.replace(/\./g,"-"),".").concat(r):E),c=s.map(E=>"".concat(E,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ge("WEBCS_DOMAIN",c),ge("WEBCS_DOMAIN_BACKUP_LIST",c),ge("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(jc(t.report.hostname,"report.hostname"),ge("EVENT_REPORT_DOMAIN",t.report.hostname[0]),ge("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(ge("EVENT_REPORT_DOMAIN",s[0]),ge("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),ge("STATS_COLLECTOR_PORT",l),t.report?ge("ENABLE_EVENT_REPORT",!0):ge("ENABLE_EVENT_REPORT",!1);let u="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(jc(t.log.hostname,"log.hostname"),u=t.log.hostname[0]):u=s[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),ge("LOG_UPLOAD_SERVER","".concat(u,":").concat(h));let p=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(jc(t.cds.hostname,"cds.hostname"),p=t.cds.hostname):p=s;let _=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),_=t.cds.port),ge("CDS_AP",p.map(E=>"".concat(E,":").concat(_))),t.cds?ge("ENABLE_CONFIG_DISTRIBUTE",!0):ge("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(jc(t,"serverList"),ei(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ge("WEBCS_DOMAIN",t),ge("WEBCS_DOMAIN_BACKUP_LIST",t),ge("GATEWAY_DOMAINS",[e]),ge("EVENT_REPORT_DOMAIN",t[0]),ge("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),ge("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Un(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Un(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Un(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(s){Un(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ei(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(it(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new B(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new B(O.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Fc(i,"encryptDataStream"),!it(r).call(r,t))throw new B(O.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=id(n))}async renewToken(t){if(ei(t,"token",1,2047),!this._key||!this._joinInfo)throw new B(O.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(N("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await y4(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||In);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,S.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Wt.VOLUME_INDICATOR,t)},N("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new B(O.LIVE_STREAMING_TASK_CONFLICT);const n=e?Wc.TRANSCODE:Wc.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(Wc.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new B(O.INVALID_PARAMS,"can not find live streaming url to stop");await at.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){VM(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){VM(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof dg&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&it(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,s,c){var l;const u=ji(l=Array.from(c)).call(l,(v,y)=>v+y,0),h={serverTs:0,seq:Kj++,length:c.length,checkSum:u},p=new Uint8Array(cL(u,2)),_=new ArrayBuffer(bf),E=new DataView(_);E.setUint32(0,h.serverTs),E.setUint16(4,h.seq),E.setUint16(6,h.length),E.setUint16(8,h.checkSum);const g=16-c.length%16;c=iL(c,new Uint8Array(g));const C=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:RL,additionalData:p},s,c);return iL(new Uint8Array(_),new Uint8Array(C))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new B(O.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(At.DATA_STREAM,{payload:id(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-L4},!n)}sendMetadata(t){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new B(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(At.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:id(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(tG),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send custom report, not joined");await gt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Un(e.spatialLayer,"spatialLayer",[0,1,2,3]),Un(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Fc(e,"apRTM"),ye(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),function(t){const e=Bf.indexOf(t);e!==-1&&Bf.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=nr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&p1(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&gt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new vi("client-publish",this._clientId),this._subscribeMutex=new vi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||Wu();t?S.debug("[".concat(this._clientId,"] new Session ").concat(i)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,gt.addSid(i);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};gt.sessionInit(this._sessionId,us({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(_n.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof Fe&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(s=>{S.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new B(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},zc("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,s)=>{gt.reportApiInvoke(this._sessionId,{name:bn.ON_LIVE_STREAM_ERROR,options:[r,s],tag:tn.TRACER}).onSuccess(),this.safeEmit(Wt.LIVE_STREAMING_ERROR,r,s)},n.onLiveStreamWarning=(r,s)=>{gt.reportApiInvoke(this._sessionId,{name:bn.ON_LIVE_STREAM_WARNING,options:[r,s],tag:tn.TRACER}).onSuccess(),this.safeEmit(Wt.LIVE_STREAMING_WARNING,r,s)},n.on(pI.REQUEST_WORKER_MANAGER_LIST,(r,s,c)=>{if(!this._joinInfo)return c(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,u,h,p){const _=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(E=>u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(E+"/api/v1?action=uap"):"https://".concat(E,"/api/v1?action=uap"));return await m4(_,l,u,h,p)})(r,this._joinInfo,this._axiosCancelSource.token,In).then(s).catch(c)}),n};return t===Wc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new B(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},zc("ChannelMediaRelay").create(t));i.on("state",r=>{r===Cr.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(Wt.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(Wt.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,s)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(u=>u.uid!==c._uintid||u.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:c,stream_id:l,ordered:u,max_retrans_times:h,metadata:p}=s,_=this._users.find(E=>E._uintid===c);if(!_)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),it(r).call(r,_)||r.push(_),_._uintid||(_._uintid=c),_._dataChannels.findIndex(E=>E.id===s.stream_id)===-1){const E={id:l,ordered:!!u,maxRetransmits:h,metadata:p},g=function(C){return RM(C,!0)}(E);_._dataChannels.push(g),S.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),e||this.safeEmit(Wt.USER_PUBLISHED,_,"datachannel",E)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch(E=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),E.toString())}))}),e&&(this.safeEmit(Wt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(s=>{const{uid:c,stream_id:l}=s,u=this._users.find(p=>p._uintid===c);if(!u)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=u._dataChannels.find(p=>p.id===s.stream_id);h&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[h]).then(p=>{if(u._dataChannels=u._dataChannels.filter(_=>_!==h),p)return this._gateway.unsubscribeDataChannel(p,u.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(Wt.USER_UNPUBLISHED,u,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(Wt.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Yn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void S.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:s,expires:c}=e[i];c&&c<=n||s||sI()||!Object.prototype.hasOwnProperty.call(hv,i)||(Ys[i]=r,Be[i]=r,S.debug("Update gateway parameters from config distribute",i,r))})}catch(e){S.error("Error update config from local cache",e.message)}})()}),this._gateway.on(Yn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Yn.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===he.FALLBACK)return;const r=()=>{this.safeEmit(Wt.CONNECTION_STATE_CHANGE,t,e,n)};if(gt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:bn.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:tn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),S.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ht.AUDIO,!1)),c._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ht.VIDEO,!1)),c._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(Yn.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new B(O.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await u1(us(us({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,f1(i),this._joinInfo.preload=!0):(n=await wI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||In,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s;const[l,u]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:u}):r.push({host:l,port:u})}),t(r)}catch(n){e(n)}}),this._gateway.on(Yn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Wt.NETWORK_QUALITY,t)}),this._gateway.on(Yn.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(Wt.STREAM_TYPE_CHANGED,t,e),gt.reportApiInvoke(this._sessionId,{name:bn.STREAM_TYPE_CHANGE,options:[t,e],tag:tn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(Yn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(Yn.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();N("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(Yn.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:S.debug("no attributes in joinResponse");const i=lM(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(Yn.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(r),icePwd:"".concat(s,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=N("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Yt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Yt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Yt.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Yt.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Yt.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Yt.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Yt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Yt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Yt.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,ht.AUDIO,!0)),this._gateway.signal.on(Yt.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,ht.AUDIO,!1)),this._gateway.signal.on(Yt.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,ht.VIDEO,!0)),this._gateway.signal.on(Yt.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,ht.VIDEO,!1)),this._gateway.signal.on(Yt.RECEIVE_METADATA,t=>{const e=Hu(t.metadata);this.safeEmit(Wt.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Yt.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=Hu(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&it(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<bf)throw new B(O.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(bf));n=await async function(s,c,l){const u=l.subarray(0,bf),h=u.slice(8,bf),p=(h[0]<<8)+h[1],_=(u[6]<<8)+u[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:RL,additionalData:new Uint8Array(cL(p,2))},c,l.subarray(bf));return new Uint8Array(E).subarray(0,_)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(s==null?void 0:s._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),k4(us(us({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Yt.ON_CRYPT_ERROR,()=>{nd(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Wt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Yt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,he.TOKEN_EXPIRE),this.safeEmit(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Yt.ON_STREAM_FALLBACK_UPDATE,t=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Wt.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Yt.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Yt.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Yt.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(It.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case At.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const s=r.some(u=>{let{stream_type:h}=u;return h===fe.Audio}),c=r.some(u=>{let{stream_type:h}=u;return h!==fe.Audio}),l=r.some(u=>{let{stream_type:h}=u;return h===fe.Screen||h===fe.ScreenLow});e.state==="offer"&&gt.publish(this._joinInfo.sid,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:s,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(n=r.find(u=>{let{stream_type:h}=u;return h===fe.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(u=>{let{stream_type:h}=u;return h!==fe.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case At.SUBSCRIBE:e&&gt.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:e.stream_type===ht.AUDIO,video:e.stream_type===ht.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Ai.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(Yt.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Yt.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;N("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!Zu(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(p=>p._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new ud(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(Wt.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(Wt.USER_JOINED,r)));const s=jn.Audio&i.stream_type,c=(jn.Video|jn.LwoVideo)&i.stream_type,l=(65280&i.stream_type)!=0,u=s&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),s&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),s&&!u&&this.getListeners(Wt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(Wt.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(Wt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(Wt.USER_PUBLISHED,r,"video")),(s&&!u||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(Wt.PUBLISHED_USER_LIST).length>0?N("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(Wt.PUBLISHED_USER_LIST,e)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(Yt.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof dg&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return it(i=Object.keys(pv)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Yt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(_n.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:s,ssrcs:c,mid:l,isMuted:u}=r;this._handleP2PAddAudioOrVideoStream(s,i,c[0].ssrcId,l);const h=this._users.find(p=>p.uid===i);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,s,!!u)})}),this._gateway.signal.on(_n.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(It.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(_n.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,s=this._users.find(c=>c.uid===r);if(!s)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const u=l===fe.Audio?ht.AUDIO:ht.VIDEO;await this._p2pChannel.unsubscribe(s,u),this._handleMuteStream(r,u,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(_n.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case sd.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,ht.VIDEO,!0);break;case sd.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,ht.AUDIO,!0);break;case sd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,ht.VIDEO,!1);break;case sd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,ht.AUDIO,!1)}}),this._gateway.signal.on(_n.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==Yi.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(_n.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(Rt.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(_n.RESTART_ICE,t,i===Yi.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Rt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(_n.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Rt.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(_n.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(Rt.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Rt.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Rt.StateChange,(t,e)=>{e===pe.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Rt.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(Wt.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(Rt.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Rt.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Rt.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(Rt.RequestRePublishDataChannel,(t,e,n)=>{at.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}})).then(e).catch(n)}),this._p2pChannel.on(Rt.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===ht.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(Rt.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(Rt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Rt.MediaReconnectStart,t=>{this.safeEmit(Wt.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Rt.MediaReconnectEnd,t=>{this.safeEmit(Wt.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Rt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Rt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:s}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(Rt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Rt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=lM(r,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Rt.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(Rt.P2PLost,()=>{this.safeEmit(Wt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Rt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Rt.ConnectionTypeChange,t=>{this.safeEmit(Wt.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Rt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Rt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Rt.AudioMetadata,t=>{this.safeEmit(Wt.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},zc("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:s,token:c,uid:l,cid:u,vid:h}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:s,token:c,uid:l,cid:u,vid:h?Number(h):0},In)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(zn.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(Wt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===os.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Wt.CONTENT_INSPECT_ERROR,new B(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(zn.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(Wt.CONTENT_INSPECT_RESULT,e,n)}),t.on(zn.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Fc(t,"enabled"),t){if(!e)throw new B(O.INVALID_PARAMS,"config is required");if(I1(e),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},zc("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:s,sid:c,token:l,uid:u,cid:h,vid:p}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:s,sid:c,token:l,uid:u,cid:h,vid:p?Number(p):0},In)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(Xs.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(Wt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===Na.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new B(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Xs.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Un(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new B(O.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Fc(t,"enabled"),ge("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Et(lt.prototype,"leave",[O1],Object.getOwnPropertyDescriptor(lt.prototype,"leave"),lt.prototype),Et(lt.prototype,"publish",[w1],Object.getOwnPropertyDescriptor(lt.prototype,"publish"),lt.prototype),Et(lt.prototype,"unpublish",[N1],Object.getOwnPropertyDescriptor(lt.prototype,"unpublish"),lt.prototype),Et(lt.prototype,"subscribe",[D1],Object.getOwnPropertyDescriptor(lt.prototype,"subscribe"),lt.prototype),Et(lt.prototype,"presubscribe",[L1],Object.getOwnPropertyDescriptor(lt.prototype,"presubscribe"),lt.prototype),Et(lt.prototype,"massSubscribe",[P1],Object.getOwnPropertyDescriptor(lt.prototype,"massSubscribe"),lt.prototype),Et(lt.prototype,"unsubscribe",[k1],Object.getOwnPropertyDescriptor(lt.prototype,"unsubscribe"),lt.prototype),Et(lt.prototype,"massUnsubscribe",[M1],Object.getOwnPropertyDescriptor(lt.prototype,"massUnsubscribe"),lt.prototype),Et(lt.prototype,"setLowStreamParameter",[U1],Object.getOwnPropertyDescriptor(lt.prototype,"setLowStreamParameter"),lt.prototype),Et(lt.prototype,"enableDualStream",[x1],Object.getOwnPropertyDescriptor(lt.prototype,"enableDualStream"),lt.prototype),Et(lt.prototype,"disableDualStream",[V1],Object.getOwnPropertyDescriptor(lt.prototype,"disableDualStream"),lt.prototype),Et(lt.prototype,"setClientRole",[B1],Object.getOwnPropertyDescriptor(lt.prototype,"setClientRole"),lt.prototype),Et(lt.prototype,"_setClientRoleOptions",[F1],Object.getOwnPropertyDescriptor(lt.prototype,"_setClientRoleOptions"),lt.prototype),Et(lt.prototype,"setProxyServer",[j1],Object.getOwnPropertyDescriptor(lt.prototype,"setProxyServer"),lt.prototype),Et(lt.prototype,"setTurnServer",[G1],Object.getOwnPropertyDescriptor(lt.prototype,"setTurnServer"),lt.prototype),Et(lt.prototype,"setLicense",[H1],Object.getOwnPropertyDescriptor(lt.prototype,"setLicense"),lt.prototype),Et(lt.prototype,"startProxyServer",[W1],Object.getOwnPropertyDescriptor(lt.prototype,"startProxyServer"),lt.prototype),Et(lt.prototype,"stopProxyServer",[K1],Object.getOwnPropertyDescriptor(lt.prototype,"stopProxyServer"),lt.prototype),Et(lt.prototype,"setLocalAccessPointsV2",[Y1],Object.getOwnPropertyDescriptor(lt.prototype,"setLocalAccessPointsV2"),lt.prototype),Et(lt.prototype,"setLocalAccessPoints",[z1],Object.getOwnPropertyDescriptor(lt.prototype,"setLocalAccessPoints"),lt.prototype),Et(lt.prototype,"setRemoteDefaultVideoStreamType",[q1],Object.getOwnPropertyDescriptor(lt.prototype,"setRemoteDefaultVideoStreamType"),lt.prototype),Et(lt.prototype,"setRemoteVideoStreamType",[X1],Object.getOwnPropertyDescriptor(lt.prototype,"setRemoteVideoStreamType"),lt.prototype),Et(lt.prototype,"setStreamFallbackOption",[J1],Object.getOwnPropertyDescriptor(lt.prototype,"setStreamFallbackOption"),lt.prototype),Et(lt.prototype,"setEncryptionConfig",[Q1],Object.getOwnPropertyDescriptor(lt.prototype,"setEncryptionConfig"),lt.prototype),Et(lt.prototype,"renewToken",[Z1],Object.getOwnPropertyDescriptor(lt.prototype,"renewToken"),lt.prototype),Et(lt.prototype,"enableAudioVolumeIndicator",[$1],Object.getOwnPropertyDescriptor(lt.prototype,"enableAudioVolumeIndicator"),lt.prototype),Et(lt.prototype,"startLiveStreaming",[tU],Object.getOwnPropertyDescriptor(lt.prototype,"startLiveStreaming"),lt.prototype),Et(lt.prototype,"setLiveTranscoding",[eU],Object.getOwnPropertyDescriptor(lt.prototype,"setLiveTranscoding"),lt.prototype),Et(lt.prototype,"stopLiveStreaming",[nU],Object.getOwnPropertyDescriptor(lt.prototype,"stopLiveStreaming"),lt.prototype),Et(lt.prototype,"startChannelMediaRelay",[iU],Object.getOwnPropertyDescriptor(lt.prototype,"startChannelMediaRelay"),lt.prototype),Et(lt.prototype,"updateChannelMediaRelay",[rU],Object.getOwnPropertyDescriptor(lt.prototype,"updateChannelMediaRelay"),lt.prototype),Et(lt.prototype,"stopChannelMediaRelay",[aU],Object.getOwnPropertyDescriptor(lt.prototype,"stopChannelMediaRelay"),lt.prototype),Et(lt.prototype,"sendCustomReportMessage",[sU],Object.getOwnPropertyDescriptor(lt.prototype,"sendCustomReportMessage"),lt.prototype),Et(lt.prototype,"pickSVCLayer",[oU],Object.getOwnPropertyDescriptor(lt.prototype,"pickSVCLayer"),lt.prototype),Et(lt.prototype,"setRTMConfig",[cU],Object.getOwnPropertyDescriptor(lt.prototype,"setRTMConfig"),lt.prototype),Et(lt.prototype,"enableContentInspect",[lU],Object.getOwnPropertyDescriptor(lt.prototype,"enableContentInspect"),lt.prototype),Et(lt.prototype,"disableContentInspect",[dU],Object.getOwnPropertyDescriptor(lt.prototype,"disableContentInspect"),lt.prototype),Et(lt.prototype,"setImageModeration",[uU],Object.getOwnPropertyDescriptor(lt.prototype,"setImageModeration"),lt.prototype),Et(lt.prototype,"setP2PTransport",[hU],Object.getOwnPropertyDescriptor(lt.prototype,"setP2PTransport"),lt.prototype),Et(lt.prototype,"getJoinChannelServiceRecords",[pU],Object.getOwnPropertyDescriptor(lt.prototype,"getJoinChannelServiceRecords"),lt.prototype),Et(lt.prototype,"setPublishAudioFilterEnabled",[fU],Object.getOwnPropertyDescriptor(lt.prototype,"setPublishAudioFilterEnabled"),lt.prototype),lt);class pg{constructor(e,n){A(this,"id",0),A(this,"element",void 0),A(this,"peerPair",void 0),A(this,"context",void 0),A(this,"audioPlayerElement",void 0),A(this,"audioTrack",void 0),pg.count+=1,this.id=pg.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const s=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(s),i.iceGatheringState==="complete"?i.localDescription:new at(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new B(O.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new B(O.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new B(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var EU,ay;A(pg,"count",0);const Q4=window.AudioContext||window.webkitAudioContext,Z4=new(EU=yt({report:gt}),Et((ay=class{constructor(){A(this,"units",[]),A(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Q4);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new pg(t,this.context),this.units.push(e)),e.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return ne().name!==ce.SAFARI}}).prototype,"processExternalMediaAEC",[EU],Object.getOwnPropertyDescriptor(ay.prototype,"processExternalMediaAEC"),ay.prototype),ay);function mU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function gU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mU(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const KI=window||document;function SU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!KI)return;const n=On._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(On.onSecurityPolicyViolation||On.getListeners(Yo.SECURITY_POLICY_VIOLATION).length>0)))return;const s=r.blockedURI;N("CSP_DETECTED_HOSTNAME_LIST").some(c=>it(s).call(s,c))&&(On.onSecurityPolicyViolation&&typeof On.onSecurityPolicyViolation=="function"&&On.onSecurityPolicyViolation(r),On.getListeners(Yo.SECURITY_POLICY_VIOLATION).length>0&&On.safeEmit(Yo.SECURITY_POLICY_VIOLATION,r))};n&&KI.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||On.getListeners(Yo.SECURITY_POLICY_VIOLATION).length>0)&&KI.addEventListener("securitypolicyviolation",i),On._cspEventHandlerPointer=i}var $4=ue,t5=nD,TU=RegExp.prototype,e5=function(t){return t===TU||$4(TU,t)?t5(t):t.flags},Fi=Vt(e5);function $f(t){let e=t.length;for(;--e>=0;)t[e]=0}const YI=256,RU=286,fg=30,_g=15,zI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),sy=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n5=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),vU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jc=new Array(576);$f(Jc);const Eg=new Array(60);$f(Eg);const mg=new Array(512);$f(mg);const gg=new Array(256);$f(gg);const qI=new Array(29);$f(qI);const oy=new Array(fg);function XI(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let yU,CU,AU;function JI(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}$f(oy);const bU=t=>t<256?mg[t]:mg[256+(t>>>7)],Sg=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},ca=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,Sg(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Qo=(t,e,n)=>{ca(t,n[2*e],n[2*e+1])},IU=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},OU=(t,e,n)=>{const i=new Array(16);let r,s,c=0;for(r=1;r<=_g;r++)c=c+n[r-1]<<1,i[r]=c;for(s=0;s<=e;s++){let l=t[2*s+1];l!==0&&(t[2*s]=IU(i[l]++,l))}},wU=t=>{let e;for(e=0;e<RU;e++)t.dyn_ltree[2*e]=0;for(e=0;e<fg;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},NU=t=>{t.bi_valid>8?Sg(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},DU=(t,e,n,i)=>{const r=2*e,s=2*n;return t[r]<t[s]||t[r]===t[s]&&i[e]<=i[n]},QI=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&DU(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!DU(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},LU=(t,e,n)=>{let i,r,s,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?Qo(t,r,e):(s=gg[r],Qo(t,s+YI+1,e),c=zI[s],c!==0&&(r-=qI[s],ca(t,r,c)),i--,s=bU(i),Qo(t,s,n),c=sy[s],c!==0&&(i-=oy[s],ca(t,i,c)));while(l<t.sym_next);Qo(t,256,e)},ZI=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let c,l,u,h=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<s;c++)n[2*c]!==0?(t.heap[++t.heap_len]=h=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)u=t.heap[++t.heap_len]=h<2?++h:0,n[2*u]=1,t.depth[u]=0,t.opt_len--,r&&(t.static_len-=i[2*u+1]);for(e.max_code=h,c=t.heap_len>>1;c>=1;c--)QI(t,n,c);u=s;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],QI(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*u]=n[2*c]+n[2*l],t.depth[u]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=u,t.heap[1]=u++,QI(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((p,_)=>{const E=_.dyn_tree,g=_.max_code,C=_.stat_desc.static_tree,v=_.stat_desc.has_stree,y=_.stat_desc.extra_bits,b=_.stat_desc.extra_base,I=_.stat_desc.max_length;let L,U,x,M,j,X,ct=0;for(M=0;M<=_g;M++)p.bl_count[M]=0;for(E[2*p.heap[p.heap_max]+1]=0,L=p.heap_max+1;L<573;L++)U=p.heap[L],M=E[2*E[2*U+1]+1]+1,M>I&&(M=I,ct++),E[2*U+1]=M,U>g||(p.bl_count[M]++,j=0,U>=b&&(j=y[U-b]),X=E[2*U],p.opt_len+=X*(M+j),v&&(p.static_len+=X*(C[2*U+1]+j)));if(ct!==0){do{for(M=I-1;p.bl_count[M]===0;)M--;p.bl_count[M]--,p.bl_count[M+1]+=2,p.bl_count[I]--,ct-=2}while(ct>0);for(M=I;M!==0;M--)for(U=p.bl_count[M];U!==0;)x=p.heap[--L],x>g||(E[2*x+1]!==M&&(p.opt_len+=(M-E[2*x+1])*E[2*x],E[2*x+1]=M),U--)}})(t,e),OU(n,h,t.bl_count)},PU=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,u=7,h=4;for(c===0&&(u=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<u&&r===c||(l<h?t.bl_tree[2*r]+=l:r!==0?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,s=r,c===0?(u=138,h=3):r===c?(u=6,h=3):(u=7,h=4))},kU=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,u=7,h=4;for(c===0&&(u=138,h=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<u&&r===c)){if(l<h)do Qo(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==s&&(Qo(t,r,t.bl_tree),l--),Qo(t,16,t.bl_tree),ca(t,l-3,2)):l<=10?(Qo(t,17,t.bl_tree),ca(t,l-3,3)):(Qo(t,18,t.bl_tree),ca(t,l-11,7));l=0,s=r,c===0?(u=138,h=3):r===c?(u=6,h=3):(u=7,h=4)}};let MU=!1;const UU=(t,e,n,i)=>{ca(t,0+(i?1:0),3),NU(t),Sg(t,n),Sg(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var i5=t=>{MU||((()=>{let e,n,i,r,s;const c=new Array(16);for(i=0,r=0;r<28;r++)for(qI[r]=i,e=0;e<1<<zI[r];e++)gg[i++]=r;for(gg[i-1]=r,s=0,r=0;r<16;r++)for(oy[r]=s,e=0;e<1<<sy[r];e++)mg[s++]=r;for(s>>=7;r<fg;r++)for(oy[r]=s<<7,e=0;e<1<<sy[r]-7;e++)mg[256+s++]=r;for(n=0;n<=_g;n++)c[n]=0;for(e=0;e<=143;)Jc[2*e+1]=8,e++,c[8]++;for(;e<=255;)Jc[2*e+1]=9,e++,c[9]++;for(;e<=279;)Jc[2*e+1]=7,e++,c[7]++;for(;e<=287;)Jc[2*e+1]=8,e++,c[8]++;for(OU(Jc,287,c),e=0;e<fg;e++)Eg[2*e+1]=5,Eg[2*e]=IU(e,5);yU=new XI(Jc,zI,257,RU,_g),CU=new XI(Eg,sy,0,fg,_g),AU=new XI(new Array(0),n5,0,19,7)})(),MU=!0),t.l_desc=new JI(t.dyn_ltree,yU),t.d_desc=new JI(t.dyn_dtree,CU),t.bl_desc=new JI(t.bl_tree,AU),t.bi_buf=0,t.bi_valid=0,wU(t)},r5=(t,e,n,i)=>{let r,s,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let u,h=4093624447;for(u=0;u<=31;u++,h>>>=1)if(1&h&&l.dyn_ltree[2*u]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(u=32;u<YI;u++)if(l.dyn_ltree[2*u]!==0)return 1;return 0})(t)),ZI(t,t.l_desc),ZI(t,t.d_desc),c=(l=>{let u;for(PU(l,l.dyn_ltree,l.l_desc.max_code),PU(l,l.dyn_dtree,l.d_desc.max_code),ZI(l,l.bl_desc),u=18;u>=3&&l.bl_tree[2*vU[u]+1]===0;u--);return l.opt_len+=3*(u+1)+5+5+4,u})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&e!==-1?UU(t,e,n,i):t.strategy===4||s===r?(ca(t,2+(i?1:0),3),LU(t,Jc,Eg)):(ca(t,4+(i?1:0),3),((l,u,h,p)=>{let _;for(ca(l,u-257,5),ca(l,h-1,5),ca(l,p-4,4),_=0;_<p;_++)ca(l,l.bl_tree[2*vU[_]+1],3);kU(l,l.dyn_ltree,u-1),kU(l,l.dyn_dtree,h-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),LU(t,t.dyn_ltree,t.dyn_dtree)),wU(t),i&&NU(t)},a5=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(gg[n]+YI+1)]++,t.dyn_dtree[2*bU(e)]++),t.sym_next===t.sym_end),s5=t=>{ca(t,2,3),Qo(t,256,Jc),(e=>{e.bi_valid===16?(Sg(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},o5={_tr_init:i5,_tr_stored_block:UU,_tr_flush_block:r5,_tr_tally:a5,_tr_align:s5},Tg=(t,e,n,i)=>{let r=65535&t|0,s=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,s=s+r|0;while(--c);r%=65521,s%=65521}return r|s<<16|0};const c5=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var qi=(t,e,n,i)=>{const r=c5,s=i+n;t^=-1;for(let c=i;c<s;c++)t=t>>>8^r[255&(t^e[c])];return-1^t},oh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},cy={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:l5,_tr_stored_block:$I,_tr_flush_block:d5,_tr_tally:_d,_tr_align:u5}=o5,{Z_NO_FLUSH:Ed,Z_PARTIAL_FLUSH:h5,Z_FULL_FLUSH:p5,Z_FINISH:hs,Z_BLOCK:xU,Z_OK:or,Z_STREAM_END:VU,Z_STREAM_ERROR:Zo,Z_DATA_ERROR:f5,Z_BUF_ERROR:tO,Z_DEFAULT_COMPRESSION:_5,Z_FILTERED:E5,Z_HUFFMAN_ONLY:ly,Z_RLE:m5,Z_FIXED:g5,Z_DEFAULT_STRATEGY:S5,Z_UNKNOWN:T5,Z_DEFLATED:dy}=cy,eO=286,R5=30,v5=19,y5=2*eO+1,C5=15,ch=258,$o=262,t_=42,lh=113,Rg=666,dh=(t,e)=>(t.msg=oh[e],e),BU=t=>2*t-(t>4?9:0),md=t=>{let e=t.length;for(;--e>=0;)t[e]=0},A5=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let gd=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const La=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Pa=(t,e)=>{d5(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,La(t.strm)},ln=(t,e)=>{t.pending_buf[t.pending++]=e},vg=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},nO=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=Tg(t.adler,e,r,n):t.state.wrap===2&&(t.adler=qi(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},FU=(t,e)=>{let n,i,r=t.max_chain_length,s=t.strstart,c=t.prev_length,l=t.nice_match;const u=t.strstart>t.w_size-$o?t.strstart-(t.w_size-$o):0,h=t.window,p=t.w_mask,_=t.prev,E=t.strstart+ch;let g=h[s+c-1],C=h[s+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,h[n+c]===C&&h[n+c-1]===g&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<E);if(i=ch-(E-s),s=E-ch,i>c){if(t.match_start=e,c=i,i>=l)break;g=h[s+c-1],C=h[s+c]}}while((e=_[e&p])>u&&--r!=0);return c<=t.lookahead?c:t.lookahead},e_=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-$o)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),A5(t),i+=e),t.strm.avail_in===0)break;if(n=nO(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=gd(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=gd(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<$o&&t.strm.avail_in!==0)},jU=(t,e)=>{let n,i,r,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<s&&(n===0&&e!==hs||e===Ed||n!==i+t.strm.avail_in)))break;c=e===hs&&n===i+t.strm.avail_in?1:0,$I(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,La(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(nO(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==Ed&&e!==hs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(nO(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,s=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=s||(i||e===hs)&&e!==Ed&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===hs&&t.strm.avail_in===0&&n===i?1:0,$I(t,t.block_start,n,c),t.block_start+=n,La(t.strm)),c?3:1)},iO=(t,e)=>{let n,i;for(;;){if(t.lookahead<$o){if(e_(t),t.lookahead<$o&&e===Ed)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-$o&&(t.match_length=FU(t,n)),t.match_length>=3)if(i=_d(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=gd(t,t.ins_h,t.window[t.strstart+1]);else i=_d(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(Pa(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===hs?(Pa(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Pa(t,!1),t.strm.avail_out===0)?1:2},n_=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<$o){if(e_(t),t.lookahead<$o&&e===Ed)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-$o&&(t.match_length=FU(t,n),t.match_length<=5&&(t.strategy===E5||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=_d(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=gd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(Pa(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=_d(t,0,t.window[t.strstart-1]),i&&Pa(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=_d(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===hs?(Pa(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Pa(t,!1),t.strm.avail_out===0)?1:2};function tc(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const yg=[new tc(0,0,0,0,jU),new tc(4,4,8,4,iO),new tc(4,5,16,8,iO),new tc(4,6,32,32,iO),new tc(4,4,16,16,n_),new tc(8,16,32,32,n_),new tc(8,16,128,128,n_),new tc(8,32,128,256,n_),new tc(32,128,258,1024,n_),new tc(32,258,258,4096,n_)];function b5(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=dy,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*y5),this.dyn_dtree=new Uint16Array(2*(2*R5+1)),this.bl_tree=new Uint16Array(2*(2*v5+1)),md(this.dyn_ltree),md(this.dyn_dtree),md(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(C5+1),this.heap=new Uint16Array(2*eO+1),md(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*eO+1),md(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Cg=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==t_&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==lh&&e.status!==Rg?1:0},GU=t=>{if(Cg(t))return dh(t,Zo);t.total_in=t.total_out=0,t.data_type=T5;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?t_:lh,t.adler=e.wrap===2?0:1,e.last_flush=-2,l5(e),or},HU=t=>{const e=GU(t);return e===or&&(n=>{n.window_size=2*n.w_size,md(n.head),n.max_lazy_match=yg[n.level].max_lazy,n.good_match=yg[n.level].good_length,n.nice_match=yg[n.level].nice_length,n.max_chain_length=yg[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},WU=(t,e,n,i,r,s)=>{if(!t)return Zo;let c=1;if(e===_5&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==dy||i<8||i>15||e<0||e>9||s<0||s>g5||i===8&&c!==1)return dh(t,Zo);i===8&&(i=9);const l=new b5;return t.state=l,l.strm=t,l.status=t_,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=s,l.method=n,HU(t)};var I5=(t,e)=>{if(Cg(t)||e>xU||e<0)return t?dh(t,Zo):Zo;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Rg&&e!==hs)return dh(t,t.avail_out===0?tO:Zo);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(La(t),t.avail_out===0)return n.last_flush=-1,or}else if(t.avail_in===0&&BU(e)<=BU(i)&&e!==hs)return dh(t,tO);if(n.status===Rg&&t.avail_in!==0)return dh(t,tO);if(n.status===t_&&n.wrap===0&&(n.status=lh),n.status===t_){let r=dy+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=ly||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=s<<6,n.strstart!==0&&(r|=32),r+=31-r%31,vg(n,r),n.strstart!==0&&(vg(n,t.adler>>>16),vg(n,65535&t.adler)),t.adler=1,n.status=lh,La(t),n.pending!==0)return n.last_flush=-1,or}if(n.status===57){if(t.adler=0,ln(n,31),ln(n,139),ln(n,8),n.gzhead)ln(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ln(n,255&n.gzhead.time),ln(n,n.gzhead.time>>8&255),ln(n,n.gzhead.time>>16&255),ln(n,n.gzhead.time>>24&255),ln(n,n.level===9?2:n.strategy>=ly||n.level<2?4:0),ln(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(ln(n,255&n.gzhead.extra.length),ln(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=qi(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(ln(n,0),ln(n,0),ln(n,0),ln(n,0),ln(n,0),ln(n,n.level===9?2:n.strategy>=ly||n.level<2?4:0),ln(n,3),n.status=lh,La(t),n.pending!==0)return n.last_flush=-1,or}if(n.status===69){if(n.gzhead.extra){let r=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=qi(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,La(t),n.pending!==0)return n.last_flush=-1,or;r=0,s-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>r&&(t.adler=qi(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=qi(t.adler,n.pending_buf,n.pending-s,s)),La(t),n.pending!==0)return n.last_flush=-1,or;s=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,ln(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=qi(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=qi(t.adler,n.pending_buf,n.pending-s,s)),La(t),n.pending!==0)return n.last_flush=-1,or;s=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,ln(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=qi(t.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(La(t),n.pending!==0))return n.last_flush=-1,or;ln(n,255&t.adler),ln(n,t.adler>>8&255),t.adler=0}if(n.status=lh,La(t),n.pending!==0)return n.last_flush=-1,or}if(t.avail_in!==0||n.lookahead!==0||e!==Ed&&n.status!==Rg){let r=n.level===0?jU(n,e):n.strategy===ly?((s,c)=>{let l;for(;;){if(s.lookahead===0&&(e_(s),s.lookahead===0)){if(c===Ed)return 1;break}if(s.match_length=0,l=_d(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(Pa(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===hs?(Pa(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Pa(s,!1),s.strm.avail_out===0)?1:2})(n,e):n.strategy===m5?((s,c)=>{let l,u,h,p;const _=s.window;for(;;){if(s.lookahead<=ch){if(e_(s),s.lookahead<=ch&&c===Ed)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,u=_[h],u===_[++h]&&u===_[++h]&&u===_[++h])){p=s.strstart+ch;do;while(u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&u===_[++h]&&h<p);s.match_length=ch-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=_d(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=_d(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(Pa(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===hs?(Pa(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Pa(s,!1),s.strm.avail_out===0)?1:2})(n,e):yg[n.level].func(n,e);if(r!==3&&r!==4||(n.status=Rg),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),or;if(r===2&&(e===h5?u5(n):e!==xU&&($I(n,0,0,!1),e===p5&&(md(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),La(t),t.avail_out===0))return n.last_flush=-1,or}return e!==hs?or:n.wrap<=0?VU:(n.wrap===2?(ln(n,255&t.adler),ln(n,t.adler>>8&255),ln(n,t.adler>>16&255),ln(n,t.adler>>24&255),ln(n,255&t.total_in),ln(n,t.total_in>>8&255),ln(n,t.total_in>>16&255),ln(n,t.total_in>>24&255)):(vg(n,t.adler>>>16),vg(n,65535&t.adler)),La(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?or:VU)},O5=(t,e)=>{let n=e.length;if(Cg(t))return Zo;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==t_||i.lookahead)return Zo;if(r===1&&(t.adler=Tg(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(md(i.head),i.strstart=0,i.block_start=0,i.insert=0);let u=new Uint8Array(i.w_size);u.set(e.subarray(n-i.w_size,n),0),e=u,n=i.w_size}const s=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,e_(i);i.lookahead>=3;){let u=i.strstart,h=i.lookahead-2;do i.ins_h=gd(i,i.ins_h,i.window[u+3-1]),i.prev[u&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=u,u++;while(--h);i.strstart=u,i.lookahead=2,e_(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=s,i.wrap=r,or},Ag={deflateInit:(t,e)=>WU(t,e,dy,15,8,S5),deflateInit2:WU,deflateReset:HU,deflateResetKeep:GU,deflateSetHeader:(t,e)=>Cg(t)||t.state.wrap!==2?Zo:(t.state.gzhead=e,or),deflate:I5,deflateEnd:t=>{if(Cg(t))return Zo;const e=t.state.status;return t.state=null,e===lh?dh(t,f5):or},deflateSetDictionary:O5,deflateInfo:"pako deflate (from Nodeca project)"};const w5=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var uy={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)w5(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,s=t.length;i<s;i++){let c=t[i];n.set(c,r),r+=c.length}return n}};let KU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{KU=!1}const bg=new Uint8Array(256);for(let t=0;t<256;t++)bg[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;bg[254]=bg[254]=1;var Ig={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,s,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),s=0,r=0;s<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){s[r++]=c;continue}let l=bg[c];if(l>4)s[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?s[r++]=65533:c<65536?s[r++]=c:(c-=65536,s[r++]=55296|c>>10&1023,s[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&KU)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let u="";for(let h=0;h<l;h++)u+=String.fromCharCode(c[h]);return u})(s,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+bg[t[n]]>e?n:e}},YU=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const zU=Object.prototype.toString,{Z_NO_FLUSH:N5,Z_SYNC_FLUSH:D5,Z_FULL_FLUSH:L5,Z_FINISH:P5,Z_OK:hy,Z_STREAM_END:k5,Z_DEFAULT_COMPRESSION:M5,Z_DEFAULT_STRATEGY:U5,Z_DEFLATED:x5}=cy;function py(t){this.options=uy.assign({level:M5,method:x5,chunkSize:16384,windowBits:15,memLevel:8,strategy:U5},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new YU,this.strm.avail_out=0;let n=Ag.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==hy)throw new Error(oh[n]);if(e.header&&Ag.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?Ig.string2buf(e.dictionary):zU.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=Ag.deflateSetDictionary(this.strm,i),n!==hy)throw new Error(oh[n]);this._dict_set=!0}}function V5(t,e){const n=new py(e);if(n.push(t,!0),n.err)throw n.msg||oh[n.err];return n.result}py.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?P5:N5,typeof t=="string"?n.input=Ig.string2buf(t):zU.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===D5||s===L5)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=Ag.deflate(n,s),r===k5)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=Ag.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===hy;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},py.prototype.onData=function(t){this.chunks.push(t)},py.prototype.onEnd=function(t){t===hy&&(this.result=uy.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var B5={deflate:V5};const fy=16209;var F5=function(t,e){let n,i,r,s,c,l,u,h,p,_,E,g,C,v,y,b,I,L,U,x,M,j,X,ct;const dt=t.state;n=t.next_in,X=t.input,i=n+(t.avail_in-5),r=t.next_out,ct=t.output,s=r-(e-t.avail_out),c=r+(t.avail_out-257),l=dt.dmax,u=dt.wsize,h=dt.whave,p=dt.wnext,_=dt.window,E=dt.hold,g=dt.bits,C=dt.lencode,v=dt.distcode,y=(1<<dt.lenbits)-1,b=(1<<dt.distbits)-1;t:do{g<15&&(E+=X[n++]<<g,g+=8,E+=X[n++]<<g,g+=8),I=C[E&y];e:for(;;){if(L=I>>>24,E>>>=L,g-=L,L=I>>>16&255,L===0)ct[r++]=65535&I;else{if(!(16&L)){if((64&L)==0){I=C[(65535&I)+(E&(1<<L)-1)];continue e}if(32&L){dt.mode=16191;break t}t.msg="invalid literal/length code",dt.mode=fy;break t}U=65535&I,L&=15,L&&(g<L&&(E+=X[n++]<<g,g+=8),U+=E&(1<<L)-1,E>>>=L,g-=L),g<15&&(E+=X[n++]<<g,g+=8,E+=X[n++]<<g,g+=8),I=v[E&b];n:for(;;){if(L=I>>>24,E>>>=L,g-=L,L=I>>>16&255,!(16&L)){if((64&L)==0){I=v[(65535&I)+(E&(1<<L)-1)];continue n}t.msg="invalid distance code",dt.mode=fy;break t}if(x=65535&I,L&=15,g<L&&(E+=X[n++]<<g,g+=8,g<L&&(E+=X[n++]<<g,g+=8)),x+=E&(1<<L)-1,x>l){t.msg="invalid distance too far back",dt.mode=fy;break t}if(E>>>=L,g-=L,L=r-s,x>L){if(L=x-L,L>h&&dt.sane){t.msg="invalid distance too far back",dt.mode=fy;break t}if(M=0,j=_,p===0){if(M+=u-L,L<U){U-=L;do ct[r++]=_[M++];while(--L);M=r-x,j=ct}}else if(p<L){if(M+=u+p-L,L-=p,L<U){U-=L;do ct[r++]=_[M++];while(--L);if(M=0,p<U){L=p,U-=L;do ct[r++]=_[M++];while(--L);M=r-x,j=ct}}}else if(M+=p-L,L<U){U-=L;do ct[r++]=_[M++];while(--L);M=r-x,j=ct}for(;U>2;)ct[r++]=j[M++],ct[r++]=j[M++],ct[r++]=j[M++],U-=3;U&&(ct[r++]=j[M++],U>1&&(ct[r++]=j[M++]))}else{M=r-x;do ct[r++]=ct[M++],ct[r++]=ct[M++],ct[r++]=ct[M++],U-=3;while(U>2);U&&(ct[r++]=ct[M++],U>1&&(ct[r++]=ct[M++]))}break}}break}}while(n<i&&r<c);U=g>>3,n-=U,g-=U<<3,E&=(1<<g)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),dt.hold=E,dt.bits=g};const _y=15,j5=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),G5=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),H5=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),W5=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Og=(t,e,n,i,r,s,c,l)=>{const u=l.bits;let h,p,_,E,g,C,v=0,y=0,b=0,I=0,L=0,U=0,x=0,M=0,j=0,X=0,ct=null;const dt=new Uint16Array(16),zt=new Uint16Array(16);let qt,Pe,En,sn=null;for(v=0;v<=_y;v++)dt[v]=0;for(y=0;y<i;y++)dt[e[n+y]]++;for(L=u,I=_y;I>=1&&dt[I]===0;I--);if(L>I&&(L=I),I===0)return r[s++]=20971520,r[s++]=20971520,l.bits=1,0;for(b=1;b<I&&dt[b]===0;b++);for(L<b&&(L=b),M=1,v=1;v<=_y;v++)if(M<<=1,M-=dt[v],M<0)return-1;if(M>0&&(t===0||I!==1))return-1;for(zt[1]=0,v=1;v<_y;v++)zt[v+1]=zt[v]+dt[v];for(y=0;y<i;y++)e[n+y]!==0&&(c[zt[e[n+y]]++]=y);if(t===0?(ct=sn=c,C=20):t===1?(ct=j5,sn=G5,C=257):(ct=H5,sn=W5,C=0),X=0,y=0,v=b,g=s,U=L,x=0,_=-1,j=1<<L,E=j-1,t===1&&j>852||t===2&&j>592)return 1;for(;;){qt=v-x,c[y]+1<C?(Pe=0,En=c[y]):c[y]>=C?(Pe=sn[c[y]-C],En=ct[c[y]-C]):(Pe=96,En=0),h=1<<v-x,p=1<<U,b=p;do p-=h,r[g+(X>>x)+p]=qt<<24|Pe<<16|En|0;while(p!==0);for(h=1<<v-1;X&h;)h>>=1;if(h!==0?(X&=h-1,X+=h):X=0,y++,--dt[v]==0){if(v===I)break;v=e[n+c[y]]}if(v>L&&(X&E)!==_){for(x===0&&(x=L),g+=b,U=v-x,M=1<<U;U+x<I&&(M-=dt[U+x],!(M<=0));)U++,M<<=1;if(j+=1<<U,t===1&&j>852||t===2&&j>592)return 1;_=X&E,r[_]=L<<24|U<<16|g-s|0}}return X!==0&&(r[g+X]=v-x<<24|64<<16|0),l.bits=L,0};const{Z_FINISH:qU,Z_BLOCK:K5,Z_TREES:Ey,Z_OK:uh,Z_STREAM_END:Y5,Z_NEED_DICT:z5,Z_STREAM_ERROR:ps,Z_DATA_ERROR:XU,Z_MEM_ERROR:JU,Z_BUF_ERROR:q5,Z_DEFLATED:QU}=cy,my=16180,gy=16190,Qc=16191,rO=16192,aO=16194,Sy=16199,Ty=16200,sO=16206,qn=16209,ZU=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function X5(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const hh=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<my||e.mode>16211?1:0},$U=t=>{if(hh(t))return ps;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=my,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,uh},t2=t=>{if(hh(t))return ps;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,$U(t)},e2=(t,e)=>{let n;if(hh(t))return ps;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?ps:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,t2(t))},n2=(t,e)=>{if(!t)return ps;const n=new X5;t.state=n,n.strm=t,n.window=null,n.mode=my;const i=e2(t,e);return i!==uh&&(t.state=null),i};let oO,cO,i2=!0;const J5=t=>{if(i2){oO=new Int32Array(512),cO=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Og(1,t.lens,0,288,oO,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Og(2,t.lens,0,32,cO,0,t.work,{bits:5}),i2=!1}t.lencode=oO,t.lenbits=9,t.distcode=cO,t.distbits=5},r2=(t,e,n,i)=>{let r;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(e.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(e.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var Q5=(t,e)=>{let n,i,r,s,c,l,u,h,p,_,E,g,C,v,y,b,I,L,U,x,M,j,X=0;const ct=new Uint8Array(4);let dt,zt;const qt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(hh(t)||!t.output||!t.input&&t.avail_in!==0)return ps;n=t.state,n.mode===Qc&&(n.mode=rO),c=t.next_out,r=t.output,u=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,_=l,E=u,j=uh;t:for(;;)switch(n.mode){case my:if(n.wrap===0){n.mode=rO;break}for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,ct[0]=255&h,ct[1]=h>>>8&255,n.check=qi(n.check,ct,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=qn;break}if((15&h)!==QU){t.msg="unknown compression method",n.mode=qn;break}if(h>>>=4,p-=4,M=8+(15&h),n.wbits===0&&(n.wbits=M),M>15||M>n.wbits){t.msg="invalid window size",n.mode=qn;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:Qc,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.flags=h,(255&Fi(n))!==QU){t.msg="unknown compression method",n.mode=qn;break}if(57344&Fi(n)){t.msg="unknown header flags set",n.mode=qn;break}n.head&&(n.head.text=h>>8&1),512&Fi(n)&&4&n.wrap&&(ct[0]=255&h,ct[1]=h>>>8&255,n.check=qi(n.check,ct,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.time=h),512&Fi(n)&&4&n.wrap&&(ct[0]=255&h,ct[1]=h>>>8&255,ct[2]=h>>>16&255,ct[3]=h>>>24&255,n.check=qi(n.check,ct,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&Fi(n)&&4&n.wrap&&(ct[0]=255&h,ct[1]=h>>>8&255,n.check=qi(n.check,ct,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&Fi(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&Fi(n)&&4&n.wrap&&(ct[0]=255&h,ct[1]=h>>>8&255,n.check=qi(n.check,ct,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Fi(n)&&(g=n.length,g>l&&(g=l),g&&(n.head&&(M=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+g),M)),512&Fi(n)&&4&n.wrap&&(n.check=qi(n.check,i,g,s)),l-=g,s+=g,n.length-=g),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&Fi(n)){if(l===0)break t;g=0;do M=i[s+g++],n.head&&M&&n.length<65536&&(n.head.name+=String.fromCharCode(M));while(M&&g<l);if(512&Fi(n)&&4&n.wrap&&(n.check=qi(n.check,i,g,s)),l-=g,s+=g,M)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Fi(n)){if(l===0)break t;g=0;do M=i[s+g++],n.head&&M&&n.length<65536&&(n.head.comment+=String.fromCharCode(M));while(M&&g<l);if(512&Fi(n)&&4&n.wrap&&(n.check=qi(n.check,i,g,s)),l-=g,s+=g,M)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Fi(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=qn;break}h=0,p=0}n.head&&(n.head.hcrc=Fi(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Qc;break;case 16189:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}t.adler=n.check=ZU(h),h=0,p=0,n.mode=gy;case gy:if(n.havedict===0)return t.next_out=c,t.avail_out=u,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,z5;t.adler=n.check=1,n.mode=Qc;case Qc:if(e===K5||e===Ey)break t;case rO:if(n.last){h>>>=7&p,p-=7&p,n.mode=sO;break}for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(J5(n),n.mode=Sy,e===Ey){h>>>=2,p-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=qn}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=qn;break}if(n.length=65535&h,h=0,p=0,n.mode=aO,e===Ey)break t;case aO:n.mode=16195;case 16195:if(g=n.length,g){if(g>l&&(g=l),g>u&&(g=u),g===0)break t;r.set(i.subarray(s,s+g),c),l-=g,s+=g,u-=g,c+=g,n.length-=g;break}n.mode=Qc;break;case 16196:for(;p<14;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=qn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.lens[qt[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[qt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,dt={bits:n.lenbits},j=Og(0,n.lens,0,19,n.lencode,0,n.work,dt),n.lenbits=dt.bits,j){t.msg="invalid code lengths set",n.mode=qn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;X=n.lencode[h&(1<<n.lenbits)-1],y=X>>>24,b=X>>>16&255,I=65535&X,!(y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(I<16)h>>>=y,p-=y,n.lens[n.have++]=I;else{if(I===16){for(zt=y+2;p<zt;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(h>>>=y,p-=y,n.have===0){t.msg="invalid bit length repeat",n.mode=qn;break}M=n.lens[n.have-1],g=3+(3&h),h>>>=2,p-=2}else if(I===17){for(zt=y+3;p<zt;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=y,p-=y,M=0,g=3+(7&h),h>>>=3,p-=3}else{for(zt=y+7;p<zt;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=y,p-=y,M=0,g=11+(127&h),h>>>=7,p-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=qn;break}for(;g--;)n.lens[n.have++]=M}}if(n.mode===qn)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=qn;break}if(n.lenbits=9,dt={bits:n.lenbits},j=Og(1,n.lens,0,n.nlen,n.lencode,0,n.work,dt),n.lenbits=dt.bits,j){t.msg="invalid literal/lengths set",n.mode=qn;break}if(n.distbits=6,n.distcode=n.distdyn,dt={bits:n.distbits},j=Og(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,dt),n.distbits=dt.bits,j){t.msg="invalid distances set",n.mode=qn;break}if(n.mode=Sy,e===Ey)break t;case Sy:n.mode=Ty;case Ty:if(l>=6&&u>=258){t.next_out=c,t.avail_out=u,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,F5(t,E),c=t.next_out,r=t.output,u=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,n.mode===Qc&&(n.back=-1);break}for(n.back=0;X=n.lencode[h&(1<<n.lenbits)-1],y=X>>>24,b=X>>>16&255,I=65535&X,!(y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(b&&(240&b)==0){for(L=y,U=b,x=I;X=n.lencode[x+((h&(1<<L+U)-1)>>L)],y=X>>>24,b=X>>>16&255,I=65535&X,!(L+y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=y,p-=y,n.back+=y,n.length=I,b===0){n.mode=16205;break}if(32&b){n.back=-1,n.mode=Qc;break}if(64&b){t.msg="invalid literal/length code",n.mode=qn;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(zt=n.extra;p<zt;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;X=n.distcode[h&(1<<n.distbits)-1],y=X>>>24,b=X>>>16&255,I=65535&X,!(y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((240&b)==0){for(L=y,U=b,x=I;X=n.distcode[x+((h&(1<<L+U)-1)>>L)],y=X>>>24,b=X>>>16&255,I=65535&X,!(L+y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=y,p-=y,n.back+=y,64&b){t.msg="invalid distance code",n.mode=qn;break}n.offset=I,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(zt=n.extra;p<zt;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=qn;break}n.mode=16204;case 16204:if(u===0)break t;if(g=E-u,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=qn;break}g>n.wnext?(g-=n.wnext,C=n.wsize-g):C=n.wnext-g,g>n.length&&(g=n.length),v=n.window}else v=r,C=c-n.offset,g=n.length;g>u&&(g=u),u-=g,n.length-=g;do r[c++]=v[C++];while(--g);n.length===0&&(n.mode=Ty);break;case 16205:if(u===0)break t;r[c++]=n.length,u--,n.mode=Ty;break;case sO:if(n.wrap){for(;p<32;){if(l===0)break t;l--,h|=i[s++]<<p,p+=8}if(E-=u,t.total_out+=E,n.total+=E,4&n.wrap&&E&&(t.adler=n.check=Fi(n)?qi(n.check,r,E,c-E):Tg(n.check,r,E,c-E)),E=u,4&n.wrap&&(Fi(n)?h:ZU(h))!==n.check){t.msg="incorrect data check",n.mode=qn;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&Fi(n)){for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=qn;break}h=0,p=0}n.mode=16208;case 16208:j=Y5;break t;case qn:j=XU;break t;case 16210:return JU;default:return ps}return t.next_out=c,t.avail_out=u,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,(n.wsize||E!==t.avail_out&&n.mode<qn&&(n.mode<sO||e!==qU))&&r2(t,t.output,t.next_out,E-t.avail_out),_-=t.avail_in,E-=t.avail_out,t.total_in+=_,t.total_out+=E,n.total+=E,4&n.wrap&&E&&(t.adler=n.check=Fi(n)?qi(n.check,r,E,t.next_out-E):Tg(n.check,r,E,t.next_out-E)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Qc?128:0)+(n.mode===Sy||n.mode===aO?256:0),(_===0&&E===0||e===qU)&&j===uh&&(j=q5),j},Zc={inflateReset:t2,inflateReset2:e2,inflateResetKeep:$U,inflateInit:t=>n2(t,15),inflateInit2:n2,inflate:Q5,inflateEnd:t=>{if(hh(t))return ps;let e=t.state;return e.window&&(e.window=null),t.state=null,uh},inflateGetHeader:(t,e)=>{if(hh(t))return ps;const n=t.state;return(2&n.wrap)==0?ps:(n.head=e,e.done=!1,uh)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,s;return hh(t)?ps:(i=t.state,i.wrap!==0&&i.mode!==gy?ps:i.mode===gy&&(r=1,r=Tg(r,e,n,0),r!==i.check)?XU:(s=r2(t,e,n,n),s?(i.mode=16210,JU):(i.havedict=1,uh)))},inflateInfo:"pako inflate (from Nodeca project)"},Z5=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const a2=Object.prototype.toString,{Z_NO_FLUSH:$5,Z_FINISH:tH,Z_OK:wg,Z_STREAM_END:lO,Z_NEED_DICT:dO,Z_STREAM_ERROR:eH,Z_DATA_ERROR:s2,Z_MEM_ERROR:nH}=cy;function Ry(t){this.options=uy.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new YU,this.strm.avail_out=0;let n=Zc.inflateInit2(this.strm,e.windowBits);if(n!==wg)throw new Error(oh[n]);if(this.header=new Z5,Zc.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ig.string2buf(e.dictionary):a2.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Zc.inflateSetDictionary(this.strm,e.dictionary),n!==wg)))throw new Error(oh[n])}function iH(t,e){const n=new Ry(e);if(n.push(t),n.err)throw n.msg||oh[n.err];return n.result}Ry.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?tH:$5,a2.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=Zc.inflate(n,c),s===dO&&r&&(s=Zc.inflateSetDictionary(n,r),s===wg?s=Zc.inflate(n,c):s===s2&&(s=dO));n.avail_in>0&&s===lO&&n.state.wrap>0&&t[n.next_in]!==0;)Zc.inflateReset(n),s=Zc.inflate(n,c);switch(s){case eH:case s2:case dO:case nH:return this.onEnd(s),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||s===lO))if(this.options.to==="string"){let u=Ig.utf8border(n.output,n.next_out),h=n.next_out-u,p=Ig.buf2string(n.output,u);n.next_out=h,n.avail_out=i-h,h&&n.output.set(n.output.subarray(u,u+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==wg||l!==0){if(s===lO)return s=Zc.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Ry.prototype.onData=function(t){this.chunks.push(t)},Ry.prototype.onEnd=function(t){t===wg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=uy.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var rH={inflate:iH};const{deflate:aH}=B5,{inflate:sH}=rH;var oH=aH,cH=sH,o2=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(o2||{});class lH{constructor(){A(this,"_sequence",0),A(this,"_startTime",Date.now()),A(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const u={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[u]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;N("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),s=new DataView(i);let c=0;if(s.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,s.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const s={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,N("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(i,!0),i+=2,s.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let u=!1;if(l.datas.length>0){const h=l.datas.find(p=>p.id===0);h&&(u=(1&new DataView(h.data).getUint32(0,!0))==1)}c=u?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,s=new ArrayBuffer(i+2),c=new Uint8Array(s),l=new DataView(s);let u=0;if(l.setUint8(u++,n),l.setUint8(u++,i),r.forEach(h=>{n?(l.setUint8(u++,h.id),l.setUint8(u++,h.length),c.set(new Uint8Array(h.data),u),u+=h.data.byteLength):(l.setUint8(u++,h.id|h.length<<4),c.set(new Uint8Array(h.data),u),u+=h.data.byteLength)}),u!==i+2)throw Error("serialize extension error, is ".concat(u,"!==").concat(i+2));return s}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const s=n.getUint8(i);i++;const c=r===o2.TWO_BYTE,l=[],u=new DataView(e,2);let h=0;for(;h<s;){let p=0,_=0,E=new ArrayBuffer(0);c?(p=u.getUint8(h),h++,_=u.getUint8(h),h++):(p=15&u.getUint8(h),_=u.getUint8(h)>>4,h++),_>0&&(E=u.buffer.slice(h+2,h+2+_),h+=E.byteLength),l.push({id:p,length:_,data:E})}if(h!==s)throw Error("parse error");return{profile:r,length:s,datas:l}}decompress(e){return cH(new Uint8Array(e))}compress(e){return oH(new Uint8Array(e))}}const dH={name:"DataStream",create:(t,e)=>{const n=e?new mG(t):new gG(t);return n.useDataStream(new lH),n}};class uH extends Je{constructor(e,n,i){super(),A(this,"ws",void 0),A(this,"requestId",1),A(this,"heartBeatTimer",void 0),A(this,"joinInfo",void 0),A(this,"clientId",void 0),A(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),A(this,"onClose",r=>{this.emit("close"),this.dispose()}),A(this,"onMessage",r=>{const s=JSON.parse(r.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=n,this.ws=new eg("cross-channel-".concat(this.clientId),i),this.ws.on(Pt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Pt.CONNECTED,this.onOpen),this.ws.on(Pt.ON_MESSAGE,this.onMessage),this.ws.on(Pt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new at((n,i)=>{const r=window.setTimeout(()=>{i(new B(O.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(r),s.state&&s.state!==0?i(new B(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new B(O.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new B(O.WS_DISCONNECT);const n=()=>new at((c,l)=>{this.ws.once(Pt.CLOSED,()=>l(new B(O.WS_ABORT))),this.ws.once(Pt.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new at((c,l)=>{const u=()=>{l(new B(O.WS_ABORT))};this.ws.once(Pt.RECONNECTING,u),this.ws.once(Pt.CLOSED,u),this.once("req_".concat(i),c),ni(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Pt.RECONNECTING,u),this.ws.off(Pt.CLOSED,u),l(new B(O.TIMEOUT,"cross channel ws request timeout"))})}),s=await r;if(!s||s.code!==200)throw new B(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners(Pt.REQUEST_NEW_URLS),this.ws.on(Pt.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class hH extends Je{set state(e){e!==this._state&&(e!==Cr.RELAY_STATE_FAILURE&&(this.errorCode=Ff.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,s){super(),A(this,"joinInfo",void 0),A(this,"sid",void 0),A(this,"clientId",void 0),A(this,"cancelToken",nr.CancelToken.source()),A(this,"workerToken",void 0),A(this,"requestId",0),A(this,"signal",void 0),A(this,"prevChannelMediaConfig",void 0),A(this,"httpRetryConfig",void 0),A(this,"_resolution",void 0),A(this,"_state",Cr.RELAY_STATE_IDLE),A(this,"errorCode",Ff.RELAY_OK),A(this,"onStatus",c=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Kc.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Kc.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Ff.SRC_TOKEN_EXPIRED,this.state=Cr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Ff.DEST_TOKEN_EXPIRED,this.state=Cr.RELAY_STATE_FAILURE))}),A(this,"onReconnect",async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Kc.NETWORK_DISCONNECTED),this.state=Cr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Cr.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",c.toString()),this.errorCode=Ff.SERVER_CONNECTION_LOST,this.state=Cr.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=Wu(),this.signal=new uH(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==Cr.RELAY_STATE_IDLE)throw new B(O.INVALID_OPERATION);this.state=Cr.RELAY_STATE_CONNECTING,await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new B(O.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new B(O.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new B(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Cr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Cr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);const n=this.genMessage(zi.SetVideoProfile);await this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Cr.RELAY_STATE_IDLE,this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=nr.CancelToken.source(),this.state=Cr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await v4(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Kc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(zi.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(zi.SetSdkProfile,e);await this.signal.request(i),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(zi.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Kc.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(zi.SetSourceUserId,e);await this.signal.request(s),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(zi.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Kc.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(zi.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",Kc.PACKET_SENT_TO_DEST_CHANNEL),this.state=Cr.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(zi.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",Kc.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(zi.StopPacketTransfer);await this.signal.request(e),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],s=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ia,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.2"&&(c.sdkVersion="0.0.1");let l=null,u=null;switch(e){case zi.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case zi.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},c;case zi.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:u.uid+""},c;case zi.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:s},c;case zi.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case zi.Reconnect:return c.clientRequest={command:"Reconnect"},c;case zi.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case zi.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:s},c;case zi.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const pH={name:"ChannelMediaRelay",create:function(t){return new hH(t.joinInfo,t.clientId,t.websocketRetryConfig||In,t.httpRetryConfig||In,t.resolution)}};function c2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ng(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?c2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class fH extends Je{constructor(e,n,i,r){super(),A(this,"spec",void 0),A(this,"token",void 0),A(this,"websocket",void 0),A(this,"pingpongTimer",void 0),A(this,"reconnectMode","retry"),A(this,"serviceMode",void 0),A(this,"reqId",0),A(this,"commandReqId",0),A(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),A(this,"handleWebSocketMessage",s=>{if(!s.data)return;const c=JSON.parse(s.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(gt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Wc.TRANSCODE?1:2}),this.emit(ad.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new eg("live-streaming",i),this.websocket.on(Pt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Pt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Pt.REQUEST_NEW_URLS,(s,c)=>{fi(this,ad.REQUEST_NEW_ADDRESS).then(s).catch(c)}),this.websocket.on(Pt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const s=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new B(O.UNEXPECTED_ERROR);const l=Ng({command:e,sdkVersion:Ia==="4.23.2"?"0.0.1":Ia,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new B(O.WS_DISCONNECT);const u=()=>new at((E,g)=>{this.websocket.once(Pt.CLOSED,()=>g(new B(O.WS_ABORT))),this.websocket.once(Pt.CONNECTED,E)});this.websocket.state!=="connected"&&await u(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const h=new at((E,g)=>{const C=()=>{g(new B(O.WS_ABORT))};this.websocket.once(Pt.RECONNECTING,C),this.websocket.once(Pt.CLOSED,C),this.once("@".concat(c,"-").concat(this.spec.sid),v=>{E(v)})});r&&gt.workerEvent(this.spec.sid,Ng(Ng({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let _=null;try{_=await h}catch(E){if(this.websocket.state==="closed")throw E;return await u(),await this.request(e,n,i)}return r&&gt.workerEvent(this.spec.sid,Ng(Ng({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-p})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=Ia==="4.23.2"?"0.0.1":Ia;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Ln.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case Ln.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ln.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ln.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new B(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ln.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new B(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ad.WARNING,n,e.serverResponse.url)}case Ln.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new B(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ad.WARNING,n,e.serverResponse.url)}case Ln.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ln.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new B(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new B(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ad.WARNING,n,e.serverResponse.url)}case Ln.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ln.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ln.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ln.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ln.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(cv)},6e3)}}function l2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ar(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?l2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class _H extends Je{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:In,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:In;super(),A(this,"onLiveStreamWarning",void 0),A(this,"onLiveStreamError",void 0),A(this,"spec",void 0),A(this,"retryTimeout",1e4),A(this,"connection",void 0),A(this,"httpRetryConfig",void 0),A(this,"wsRetryConfig",void 0),A(this,"streamingTasks",new Map),A(this,"isStartingStreamingTask",!1),A(this,"taskMutex",new vi("live-streaming")),A(this,"cancelToken",nr.CancelToken.source()),A(this,"transcodingConfig",void 0),A(this,"uapResponse",void 0),A(this,"lastTaskId",1),A(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=Ar(Ar({},e4),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>Ar(Ar(Ar({},t4),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){$e(c.width)||ye(c.width,"config.width",0,1e4),$e(c.height)||ye(c.height,"config.height",0,1e4),$e(c.videoBitrate)||ye(c.videoBitrate,"config.videoBitrate",1,1e6),$e(c.videoFrameRate)||ye(c.videoFrameRate,"config.videoFrameRate"),$e(c.lowLatency)||Fc(c.lowLatency,"config.lowLatency"),$e(c.audioSampleRate)||Un(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),$e(c.audioBitrate)||ye(c.audioBitrate,"config.audioBitrate",1,128),$e(c.audioChannels)||Un(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),$e(c.videoGop)||ye(c.videoGop,"config.videoGop"),$e(c.videoCodecProfile)||Un(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),$e(c.userCount)||ye(c.userCount,"config.userCount",0,17),$e(c.backgroundColor)||ye(c.backgroundColor,"config.backgroundColor",0,16777215),$e(c.userConfigExtraInfo)||ei(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!$e(c.transcodingUsers)&&(jc(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,u)=>{Lv(l.uid),$e(l.x)||ye(l.x,"transcodingUser[".concat(u,"].x"),0,1e4),$e(l.y)||ye(l.y,"transcodingUser[".concat(u,"].y"),0,1e4),$e(l.width)||ye(l.width,"transcodingUser[".concat(u,"].width"),0,1e4),$e(l.height)||ye(l.height,"transcodingUser[".concat(u,"].height"),0,1e4),$e(l.zOrder)||ye(l.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),$e(l.alpha)||ye(l.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)})),$e(c.watermark)||hI(c.watermark,"watermark"),$e(c.backgroundImage)||hI(c.backgroundImage,"backgroundImage"),c.images&&!$e(c.images)&&(jc(c.images,"config.images"),c.images.forEach((l,u)=>{hI(l,"images[".concat(u,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>Ar(Ar(Ar({},uI),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(Ar(Ar(Ar({},uI),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(Ar(Ar(Ar({},uI),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>Ar({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?at.resolve(c.uid):DM(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await at.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var s;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Tr(s=this.streamingTasks).call(s)).map(l=>l.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(u=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===Wc.TRANSCODE)throw new B(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&i)return void s();if(this.streamingTasks.get(e)&&!i)return s(),new B(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw s(),l}switch(n){case Wc.TRANSCODE:r.transcodingConfig=Ar({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new at((h,p)=>{ni(this.retryTimeout).then(()=>{if(i)return p(i);const _=this.statusError.get(e);return _?(this.statusError.delete(e),p(_)):void 0})}),u=await at.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===Wc.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(u.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),s()}catch(l){if(s(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new at((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new B(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=r.mode;r.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:s===Wc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(Tr(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=nr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new B(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await fi(this,pI.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new fH(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(ad.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(ad.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(ad.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new B(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));fi(this,pI.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,i(s.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case Ln.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return S.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Ln.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Ln.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ln.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Tr(s=this.streamingTasks).call(s));for(const l of c)l.abortTask?l.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(u=>{S.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const EH={name:"LiveStreaming",create:function(t){return new _H(t.joinInfo,t.websocketRetryConfig||In,t.httpRetryConfig||In)}};function mH(t){let e=h2();return function(n,i){let r=n.appId;r!==void 0&&(me(i,10),ec(i,r));let s=n.cid;s!==void 0&&(me(i,16),me(i,s));let c=n.cname;c!==void 0&&(me(i,26),ec(i,c));let l=n.deviceId;l!==void 0&&(me(i,34),ec(i,l));let u=n.elapse;u!==void 0&&(me(i,40),Sd(i,u));let h=n.fileSize;h!==void 0&&(me(i,48),Sd(i,i_(h)));let p=n.height;p!==void 0&&(me(i,56),Sd(i,i_(p)));let _=n.jpg;_!==void 0&&(me(i,66),me(i,_.length),function(cr,K){let nt=r_(cr,K.length);cr.bytes.set(K,nt)}(i,_));let E=n.networkType;E!==void 0&&(me(i,72),Sd(i,i_(E)));let g=n.osType;g!==void 0&&(me(i,80),Sd(i,i_(g)));let C=n.requestId;C!==void 0&&(me(i,90),ec(i,C));let v=n.sdkVersion;v!==void 0&&(me(i,98),ec(i,v));let y=n.sequence;y!==void 0&&(me(i,104),Sd(i,i_(y)));let b=n.sid;b!==void 0&&(me(i,114),ec(i,b));let I=n.timestamp;I!==void 0&&(me(i,120),Sd(i,I));let L=n.uid;L!==void 0&&(me(i,128),me(i,L));let U=n.vid;U!==void 0&&(me(i,136),me(i,U));let x=n.width;x!==void 0&&(me(i,144),Sd(i,i_(x)));let M=n.service;M!==void 0&&(me(i,152),me(i,M));let j=n.callbackData;j!==void 0&&(me(i,162),ec(i,j));let X=n.jpgEncryption;X!==void 0&&(me(i,168),me(i,X));let ct=n.requestType;ct!==void 0&&(me(i,176),me(i,ct));let dt=n.scorePorn;dt!==void 0&&(me(i,185),_O(i,dt));let zt=n.scoreSexy;zt!==void 0&&(me(i,193),_O(i,zt));let qt=n.scoreNeutral;qt!==void 0&&(me(i,201),_O(i,qt));let Pe=n.scene;Pe!==void 0&&(me(i,208),me(i,Pe));let En=n.ossFilePrefix;En!==void 0&&(me(i,218),ec(i,En));let sn=n.serviceVendor;if(sn!==void 0)for(let cr of sn){me(i,226);let K=h2();TH(cr,K),me(i,K.limit),CH(i,K),yH(K)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function gH(t){return function(n){let i={};t:for(;!p2(n);){let r=nc(n);switch(r>>>3){case 0:break t;case 1:i.code=nc(n);break;case 2:i.msg=f2(n,nc(n));break;case 3:{let s=RH(n);i.data=SH(n),n.limit=s;break}default:d2(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function SH(t){let e={};t:for(;!p2(t);){let n=nc(t);switch(n>>>3){case 0:break t;case 1:e.requestId=f2(t,nc(t));break;case 2:e.requestType=nc(t)>>>0;break;case 3:e.scorePorn=fO(t);break;case 4:e.scoreSexy=fO(t);break;case 5:e.scoreNeutral=fO(t);break;case 6:e.requestScene=nc(t)>>>0;break;case 7:e.scene=nc(t)>>>0;break;default:d2(t,7&n)}}return e}function TH(t,e){let n=t.service;n!==void 0&&(me(e,8),me(e,n));let i=t.vendor;i!==void 0&&(me(e,16),me(e,i));let r=t.token;r!==void 0&&(me(e,26),ec(e,r));let s=t.callbackUrl;s!==void 0&&(me(e,34),ec(e,s))}function RH(t){let e=nc(t),n=t.limit;return t.limit=t.offset+e,n}function d2(t,e){switch(e){case 0:for(;128&_2(t););break;case 2:hO(t,nc(t));break;case 5:hO(t,4);break;case 1:hO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let vH=new Float32Array(1);new Uint8Array(vH.buffer);let uO=new Float64Array(1),br=new Uint8Array(uO.buffer);function i_(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let u2=[];function h2(){const t=u2.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function yH(t){u2.push(t)}function hO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function p2(t){return t.offset>=t.limit}function r_(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function pO(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function f2(t,e){let n=pO(t,e),i=String.fromCharCode,r=t.bytes,s="",c="";for(let l=0;l<e;l++){let u,h,p,_,E=r[l+n];(128&E)==0?c+=i(E):(224&E)==192?l+1>=e?c+=s:(u=r[l+n+1],(192&u)!=128?c+=s:(_=(31&E)<<6|63&u,_<128?c+=s:(c+=i(_),l++))):(240&E)==224?l+2>=e?c+=s:(u=r[l+n+1],h=r[l+n+2],(49344&(u|h<<8))!=32896?c+=s:(_=(15&E)<<12|(63&u)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=i(_),l+=2))):(248&E)==240?l+3>=e?c+=s:(u=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(u|h<<8|p<<16))!=8421504?c+=s:(_=(7&E)<<18|(63&u)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s}return c}function ec(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}me(t,i);let r=r_(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function CH(t,e){let n=r_(t,e.limit),i=t.bytes,r=e.bytes;for(let s=0,c=e.limit;s<c;s++)i[s+n]=r[s]}function _2(t){return t.bytes[pO(t,1)]}function E2(t,e){let n=r_(t,1);t.bytes[n]=e}function fO(t){let e=pO(t,8),n=t.bytes;return br[0]=n[e++],br[1]=n[e++],br[2]=n[e++],br[3]=n[e++],br[4]=n[e++],br[5]=n[e++],br[6]=n[e++],br[7]=n[e++],uO[0]}function _O(t,e){let n=r_(t,8),i=t.bytes;uO[0]=e,i[n++]=br[0],i[n++]=br[1],i[n++]=br[2],i[n++]=br[3],i[n++]=br[4],i[n++]=br[5],i[n++]=br[6],i[n++]=br[7]}function nc(t){let e,n=0,i=0;do e=_2(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function me(t,e){for(e>>>=0;e>=128;)E2(t,127&e|128),e>>>=7;E2(t,e)}function Sd(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=r_(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}function m2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const AH=new Map([["moderation",1],["supervise",2]]);class bH extends Je{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(zn.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=ji(n=e.map(i=>AH.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),A(this,"name","AgoraRTCVideoContentInspect"),A(this,"_connectionState",os.CONNECTING),A(this,"_innerConnectionState",void 0),A(this,"sequence",0),A(this,"inspectStartTime",void 0),A(this,"workerManagerConnection",void 0),A(this,"workerConnection",void 0),A(this,"workerMessageLengthLimit",void 0),A(this,"inspectIntervalMinimum",void 0),A(this,"qualityRatio",void 0),A(this,"_connectInfo",void 0),A(this,"_cancelTokenSource",nr.CancelToken.source()),A(this,"_retryConfig",void 0),A(this,"wmSequence",0),A(this,"inspectInterval",void 0),A(this,"inspectTimer",null),A(this,"ossFilePrefix",void 0),A(this,"extraInfo",void 0),A(this,"_inspectType",void 0),A(this,"_inspectMode",void 0),A(this,"_quality",1),A(this,"qualityTimer",null),A(this,"_inspectId",void 0),A(this,"_needWorkUrlOnly",!1),A(this,"inspectImage",()=>{if(this.connectionState!==os.CONNECTED)throw new B(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===os.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=De(5,"inspect-"),this.workerMessageLengthLimit=N("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=N("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=N("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new eg("worker-manager-"+this._inspectId,In),this.on(zn.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(cs[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new eg("worker-"+this._inspectId,In),this.handleWorkerEvents()}async init(e,n){this.emit(zn.STATE_CHANGE,cs.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new at((r,s)=>{this.on(zn.CONNECTION_STATE_CHANGE,(c,l)=>{l===os.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{s(c)})})}async requestAP(e,n,i){const r=N("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,u,h,p){let{appId:_,areaCode:E,cname:g,sid:C,token:v,uid:y}=u;zf++;const b="image_moderation_api",I={service_name:b,json_body:JSON.stringify({appId:_,areaCode:E,cname:g,command:"allocateEdge",requestId:zf,seq:zf,sid:C,token:v,ts:Date.now(),uid:y+""})};let L,U,x=l[0];return Ks(async()=>{L=Date.now();const M=await Js(x,{data:I,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(U=Date.now()-L,M.code!==0){const dt=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+M.code,{retry:!0,responseTime:U});throw S.error(dt.toString()),dt}const j=JSON.parse(M.json_body);if(j.code!==200){const dt=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(j.code,", reason: ").concat(j.reason),{code:j.code,responseTime:U});throw S.error(dt.toString()),dt}if(!j.servers||!Array.isArray(j.servers)||j.servers.length===0){const dt=new B(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:j.code,responseTime:U});throw S.error(dt.toString()),dt}const X=N("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ct=N("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:j.servers.map(dt=>{let{address:zt,wss:qt}=dt;if(zt&&qt)return"wss://".concat(zt.replace(/\./g,"-"),".").concat(X,":").concat(ct||qt)}).filter(dt=>!!dt),workerToken:j.workerToken,vid:j.vid,responseTime:U}},(M,j)=>(gt.apworkerEvent(C,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(M.addressList),firstSuccess:j===0,responseTime:U,serverIp:l[j%l.length]}),!1),(M,j)=>(gt.apworkerEvent(C,{success:!1,sc:M.data&&M.data.code||200,serviceName:b,responseTime:U,serverIp:l[j%l.length]}),!!(M.code!==O.OPERATION_ABORTED&&M.code!==O.UNEXPECTED_RESPONSE||M.data&&M.data.retry)&&(x=l[(j+1)%l.length],!0)),p)}(r,e,n,i);this.emit(zn.STATE_CHANGE,cs.AP_CONNECTED);const{addressList:c}=s;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(zn.STATE_CHANGE,cs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Pt.CONNECTED,async()=>{this.emit(zn.STATE_CHANGE,cs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Pt.CLOSED,()=>{this._innerConnectionState<cs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Pt.FAILED,()=>{this._innerConnectionState<cs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Pt.RECONNECTING,()=>{this._innerConnectionState<cs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Pt.ON_MESSAGE,async e=>{this.emit(zn.STATE_CHANGE,cs.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new B(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new B(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=N("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(r));this.emit(zn.STATE_CHANGE,cs.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(zn.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(Pt.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(Pt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Pt.CONNECTED,async()=>{this.emit(zn.STATE_CHANGE,cs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=os.CONNECTED}),this.workerConnection.on(Pt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=gH(new Uint8Array(e.data));if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(zn.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},s=ji(n=Object.keys(r)).call(n,(l,u)=>r[l]>r[u]?l:u,"porn"),c=Object.keys(r).find(l=>l===s);this.emit(zn.INSPECT_RESULT,c)}else this.emit(zn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(zn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(zn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Pt.CLOSED,()=>{this.connectionState=os.CLOSED}),this.workerConnection.on(Pt.FAILED,()=>{this.connectionState=os.CLOSED}),this.workerConnection.on(Pt.RECONNECTING,()=>{this.connectionState=this.connectionState===os.CONNECTED?os.RECONNECTING:os.CONNECTING}),this.workerConnection.on(Pt.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(Pt.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(zn.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=Zr(this,zn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(zn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(zn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:u}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),_=await ZL(p,i,r),E=this.sequence+"-"+s+"-"+u+"-"+h+"-"+De(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:(C=Number(h-this.inspectStartTime),{low:C|=0,high:C>>31,unsigned:C>=0}),fileSize:_.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:E,sdkVersion:"4.23.2",sequence:this.sequence,sid:l,timestamp:A1(h),uid:u,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var C;this.extraInfo===void 0&&delete g.callbackData,this.ossFilePrefix===void 0&&delete g.ossFilePrefix;const v=mH(g);if(v.byteLength<this.workerMessageLengthLimit){if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const y=function(b){for(var I=1;I<arguments.length;I++){var L=arguments[I]!=null?arguments[I]:{};I%2?m2(Object(L),!0).forEach(function(U){A(b,U,L[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(L)):m2(Object(L)).forEach(function(U){Object.defineProperty(b,U,Object.getOwnPropertyDescriptor(L,U))})}return b}({},g);delete y.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(y))}return v}{const y=this.quality*this.qualityRatio;return this.quality=y,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=nr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=os.CLOSED,this.emit(zn.STATE_CHANGE,cs.CLOSED)}}const IH={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new B(O.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new B(O.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var s;if(!it(s=["supervise","moderation"]).call(s,r))throw new B(O.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new bH(e)}};var g2=Vt(Pr.Object.getOwnPropertySymbols),OH=Ee,wH=fc.indexOf,NH=tr,EO=Wr([].indexOf),S2=!!EO&&1/EO([1],1,-0)<0;OH({target:"Array",proto:!0,forced:S2||!NH("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return S2?EO(this,t,e)||0:wH(this,t,e)}});var DH=Zi("Array").indexOf,LH=ue,PH=DH,mO=Array.prototype,kH=function(t){var e=t.indexOf;return t===mO||LH(mO,t)&&e===mO.indexOf?PH:e},T2=Vt(kH);function MH(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var u,h,p={},_=Fk(c);for(h=0;h<_.length;h++)u=_[h],T2(l).call(l,u)>=0||(p[u]=c[u]);return p}(t,e);if(g2){var s=g2(t);for(i=0;i<s.length;i++)n=s[i],T2(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let R2=class{get localCapabilities(){return en(this._localCapabilities)}get rtpCapabilities(){return en(this._rtpCapabilities)}get candidates(){return en(this._candidates)}get iceParameters(){return en(this._iceParameters)}get dtlsParameters(){return en(this._dtlsParameters)}constructor(t){A(this,"sessionDesc",void 0),A(this,"_localCapabilities",void 0),A(this,"_rtpCapabilities",void 0),A(this,"_candidates",void 0),A(this,"_iceParameters",void 0),A(this,"_dtlsParameters",void 0),A(this,"setup",void 0),A(this,"currentMidIndex",void 0),A(this,"cname","o/i14u9pJrxRKAsu"),A(this,"firefoxSsrcMidMap",new Map),t=en(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:s,direction:c,setup:l,videoCodec:u,audioCodec:h}=t;let p;this.setup=l,p=c===Yi.RECEIVE_ONLY?yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=s;const _=c===Yi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,E=c===Yi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,g=c===Yi.RECEIVE_ONLY?r.send.videoCodecs:rg(ht.VIDEO,_,E,u),C=c===Yi.RECEIVE_ONLY?r.send.audioCodecs:rg(ht.AUDIO,_,E,h);for(const v of p.mediaDescriptions)v.attributes.iceUfrag=e.iceUfrag,v.attributes.icePwd=e.icePwd,v.attributes.fingerprints=n.fingerprints,v.attributes.candidates=i,v.attributes.setup=this.setup,v.media.mediaType==="application"&&(v.attributes.sctpPort="5000"),v.media.mediaType==="video"&&(v.media.fmts=g.map(y=>y.payloadType.toString(10)),v.attributes.payloads=g,v.attributes.extmaps=_.videoExtensions),v.media.mediaType==="audio"&&(v.media.fmts=C.map(y=>y.payloadType.toString(10)),v.attributes.payloads=C,v.attributes.extmaps=_.audioExtensions,Yf(v));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return rd(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:c}=$u(e,this.cname,N("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(s);if(l){if(Ze()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,s,i);let h;return u===-1?(h=this.createOrRecycleSendMedia(t,s,c,"sendonly",i,r),this.updateBundleMids()):(h=en(this.sessionDesc.mediaDescriptions[u]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(h,r)),Ze()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const s=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s);let l,u=!1;c===-1?(u=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=en(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:u})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:s,relatedAddress:c,relatedPort:l,priority:u}=new RTCIceCandidate(t),h={foundation:e??"",componentId:"1",transport:n??"",priority:u?u+"":"",connectionAddress:i??"",port:r?r+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const s=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=rg(s,c,this.localCapabilities.send,s===ht.AUDIO?r:i),u=s===ht.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,t);const _=this.findFirstClosedMedia(s);if(_){const E=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[E]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>it(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>it(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Ze()){if(r){const s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!s||s!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=en(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,s){const c=this.rtpCapabilities.send,l=t===ht.VIDEO?c.videoCodecs:c.audioCodecs,u=t===ht.VIDEO?c.videoExtensions:c.audioExtensions;Ze()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,s);const p=this.findFirstClosedMedia(t);if(p){const _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(t,e,n){const i=en(t);return gI(i),Kf(i,e),SI(i,e),uM(i),Bv(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=en(t);return Bv(n,e,this.localCapabilities.recv),Yf(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Ze()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const UH=["sdp"];var Me;function v2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Td(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?v2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let y2=(Me=class a_ extends Yk{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),A(this,"direction",void 0),A(this,"name",void 0),A(this,"store",void 0),A(this,"spec",void 0),A(this,"peerConnection",void 0),A(this,"initialOffer",void 0),A(this,"transport",void 0),A(this,"statsFilter",void 0),A(this,"localCandidateCount",0),A(this,"_isInRestartIce",!1),A(this,"mutex",void 0),A(this,"onLocalCandidate",void 0),A(this,"remoteSDP",void 0),A(this,"pendingCandidates",[]),A(this,"localCapabilities",void 0),A(this,"isReady",!1),A(this,"restartCnt",0),A(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new vi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(a_.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Yi.SEND_ONLY,this.name=this.direction===Yi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Lb(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,Ze()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await pM();if(this.localCapabilities=Fv(n),e){const{sdp:i}=e,r=MH(e,UH),s=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=ig(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ls(_,p,"videoExtensions",E,g,C),ls(_,p,"videoCodecs",E,g,C),ls(_,p,"audioExtensions",E,g,C),ls(_,p,"audioCodecs",E,g,C),N("RAISE_H264_BASELINE_PRIORITY")){const v=C.videoCodecs.findIndex(y=>y.rtpMap&&y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&y.fmtp&&y.fmtp.parameters["profile-level-id"]==="42001f");if(v!==-1){const y=C.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(y<v){S.debug("raising H264 baseline profile priority");const b=C.videoCodecs[v];C.videoCodecs.splice(v,1),C.videoCodecs.splice(y,0,b)}y!==-1&&N("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:E,recv:g,sendrecv:C}}({},{},i);this.remoteSDP=new R2({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=ld(c.sdp);await this.peerConnection.setLocalDescription(c);const u=await fM({},{},c.sdp);this.localCapabilities=Fv(u);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),Td(Td({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=ld(i.sdp);return this.initialOffer=i,Td(Td({},r),{},{sdp:i.sdp})}}catch(n){throw new G(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,s=await fM({},{},n);this.remoteSDP=new R2({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new G(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return ba(function*(){const s=yield ee(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((y,b)=>{if(l[b].needCreateTransceiver){const I=r.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});c.push(I),y._updateRtpTransceiver(I)}else{const I=r.peerConnection.getTransceivers().find(L=>L.mid===l[b].mid);if(!I)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[b].mid));c.push(I),y._updateRtpTransceiver(I)}}),Ze()&&N("SIMULCAST")===!0&&(yield ee(r.applySimulcastForFirefox(c,e)));const u=l.map(y=>y.mid),h=yield ee(r.peerConnection.createOffer()),p=r.mungSendOfferSDP(h.sdp,e,u),_=yr(p),E=u.map(y=>{const b=_.mediaDescriptions.find(I=>I.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return cM(b,N("USE_PUB_RTX"))}),g=c.map((y,b)=>{const I=u[b];return{localSSRC:E[b],id:I}});yield ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield g}catch(y){const b=r.remoteSDP.toString();throw yield ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield ee(r.stopSending(u,!0)),y}yield ee(r.applySimulcastEncodings(c,e)),yield ee(r.applySendEncodings(c,e));const C=r.remoteSDP.toString(),v=r.logSDPExchange(p,"offer","local","send");return v==null||v(C),yield ee(r.setRemoteDescription({type:"answer",sdp:C})),c.map((y,b)=>{const I=u[b];return{localSSRC:E[b],id:I}})}catch(c){throw c instanceof G?c:new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(u=>e.indexOf(u.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(u=>{var h;u.direction="inactive",(h=u.stop)===null||h===void 0||h.call(u)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,s,e);h==null||h(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),u=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,e);u==null||u(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===Ku.Auto&&(this.store.p2pTransport=Ku.SdRtn,ae().supportPCSetConfiguration&&this.peerConnection.setConfiguration(a_.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ae().supportPCSetConfiguration&&this.peerConnection.setConfiguration(a_.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=ld(n.sdp);return this.store.descriptionStart(),this.direction===Yi.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Yi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=ld(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new G(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?Ze()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Td(Td({},Go),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Td(Td({},Go),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;it(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var s;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Wm(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...a_.turnServerConfigToIceServers(e.turnServer.servers,n,i)),N("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...a_.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),it(s=[Ku.Relay,Ku.SdRtn]).call(s,n)&&(r.iceTransportPolicy="relay"),N("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&ae().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],s=e.filter(l=>l.tcpport);S.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(i));const c=s.length>i?s[i]:s[0];switch(n){case Ku.SdRtn:const l=e.filter(h=>{var p;return it(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),u=l.length>i?l[i]:l[0];u&&(r.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(od(u.turnServerURL),":").concat(u.tcpport,"?transport=udp")}),r.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(od(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;case Ku.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(od(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(od(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ae().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},s={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:p,frameRate:_,scaleResolutionDownBy:E}=e._encoderConfig;p&&(s.maxBitrate=1e3*p),it(c=e._hints).call(c,Le.LOW_STREAM)&&(_&&(s.maxFramerate=Gr(_)),E&&E>=1&&(s.scaleResolutionDownBy=E))}if(N("DSCP_TYPE")&&Bc()){var l;const p=N("DSCP_TYPE");it(l=["very-low","low","medium","high"]).call(l,p)&&(s.networkPriority=p)}const u=n.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];Ze()&&!h&&(r.encodings=[s]),h&&Object.assign(h,s),Object.assign(u,r),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(e,n){try{if(!ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof Fe&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=yr(e);return n.forEach((s,c)=>{const l=i[c],u=r.mediaDescriptions.find(h=>h.attributes.mid===l);u&&(Kf(u,s),hM(u,s,this.store.codec))}),rd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let u=0;u<e.length;u++){var i,r,s,c,l;const h=e[u],p=n[u];if(p instanceof Fe&&!it(i=p._hints).call(i,Le.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},E={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,_))}}}async applySimulcastEncodings(e,n){if(!Ze()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof Fe&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=s.sender.getParameters();await s.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof Fe&&N("SIMULCAST")&&this.store.codec==="vp8"&&!it(n=e._hints).call(n,Le.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(N("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var s;const c=(s=yr(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||s===void 0?void 0:s.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),it(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=yr(e),s=r.mediaDescriptions.find(c=>c.attributes.mid===n);return s&&i===ht.AUDIO&&s.media.mediaType==="audio"&&Yf(s),rd(r)}},Et(Me.prototype,"establish",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"establish"),Me.prototype),Et(Me.prototype,"connect",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"connect"),Me.prototype),Et(Me.prototype,"receive",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"receive"),Me.prototype),Et(Me.prototype,"mockReceive",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"mockReceive"),Me.prototype),Et(Me.prototype,"stopReceiving",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"stopReceiving"),Me.prototype),Et(Me.prototype,"restartICE",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"restartICE"),Me.prototype),Et(Me.prototype,"close",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"close"),Me.prototype),Et(Me.prototype,"updateEncoderConfig",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"updateEncoderConfig"),Me.prototype),Et(Me.prototype,"updateSendParameters",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"updateSendParameters"),Me.prototype),Et(Me.prototype,"replaceTrack",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"replaceTrack"),Me.prototype),Et(Me.prototype,"muteLocal",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"muteLocal"),Me.prototype),Et(Me.prototype,"unmuteLocal",[fs],Object.getOwnPropertyDescriptor(Me.prototype,"unmuteLocal"),Me.prototype),Me);function fs(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{s()}},n}let Zs=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var C2,A2,b2,I2,O2,w2,N2,D2,L2,P2,k2,qe;function M2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function vy(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?M2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let xH=(C2=$s(Zs.SEND_ONLY),A2=$s(Zs.SEND_ONLY),b2=$s(),I2=$s(Zs.RECEIVE_ONLY),O2=$s(Zs.RECEIVE_ONLY),w2=$s(Zs.RECEIVE_ONLY),N2=$s(Zs.RECEIVE_ONLY),D2=$s(Zs.RECEIVE_ONLY),L2=$s(Zs.RECEIVE_ONLY),P2=$s(),k2=$s(Zs.RECEIVE_ONLY),qe=class extends Je{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Rt.StateChange,e,this._state)}constructor(t,e){super(),A(this,"isPlanB",!1),A(this,"store",void 0),A(this,"statsUploader",void 0),A(this,"sendConnection",void 0),A(this,"recvConnection",void 0),A(this,"localTrackMap",new Map),A(this,"remoteUserMap",new Map),A(this,"localDataChannels",[]),A(this,"pendingLocalTracks",[]),A(this,"pendingRemoteTracks",[]),A(this,"statsCollector",void 0),A(this,"dtlsFailedCount",0),A(this,"sendMutex",void 0),A(this,"recvMutex",void 0),A(this,"_state",pe.Disconnected),A(this,"_restartStates",["disconnected","failed"]),A(this,"reconnectInterval",void 0),A(this,"uploadUnplinkStarted",!1),A(this,"uploadDownlinkStarted",!1),A(this,"uplinkStateUploadInterval",void 0),A(this,"downlinkStatsUploadInterval",void 0),A(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==pe.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void i();const h=u.find(g=>g[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(u.map(g=>{let[,{id:C}]=g;return C}));let p=!1;var c,l;n.trackMediaType==="video"?p=!((c=this.localTrackMap.get(q.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(q.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const _=this.createMuteMessage(u);await Ne(this,Rt.RequestMuteLocal,_);const E=n.trackMediaType==="video"?sd.MUTE_LOCAL_VIDEO:sd.MUTE_LOCAL_AUDIO;await Ne(this,Rt.RequestP2PMuteLocal,{action:E,message:_,isMuteAll:p}),i()}catch(u){r(u)}finally{s()}}),A(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==pe.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(c),u=n.trackMediaType==="video"?sd.UNMUTE_LOCAL_VIDEO:sd.UNMUTE_LOCAL_AUDIO;await Ne(this,Rt.RequestP2PMuteLocal,{action:u,message:l}),i()}catch(c){r(c)}finally{s()}}),A(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;typeof s=="boolean"&&s||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const u=this.localTrackMap.get(q.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==n||this.state!==pe.Connected)return void i();const{id:h,track:p}=u;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(Rt.UpdateVideoEncoder,p)),i()}catch(u){r(u)}finally{var l;(l=c)===null||l===void 0||l()}}),A(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(q.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==pe.Connected)return void i();const{id:l,track:u}=c;l&&await this.sendConnection.updateSendParameters(l,u),i()}catch(c){r(c)}finally{s()}}),A(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==pe.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),h[0]===q.LocalVideoTrack&&ae().supportDualStreamEncoding){const p=this.localTrackMap.get(q.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new at((E,g)=>{this.handleReplaceTrack(p.track,E,g,!0)})}}i()}catch(h){r(h)}finally{var u;(u=c)===null||u===void 0||u()}}),A(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),A(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),A(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),A(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new $M(t),this.bindStatsUploaderEvents(),this.sendMutex=new vi("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new vi("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},N("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new G(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new y2(t,this.store,Yi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=pe.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new y2(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pe.Connected}async addRemoteCandidate(t,e){if(e===Yi.RECEIVE_ONLY){if(!this.sendConnection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return ba(function*(){const r=yield ee(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==pe.Connected){i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(h))}i.store.pubId=i.store.pubId+1,Ai.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield ee(i.tryToUnmuteAudio(t)));s.forEach(h=>{let{track:p,type:_}=h;const E=Date.now();i.store.publish(p.getTrackId(),_===q.LocalAudioTrack?"audio":"video",E)}),i.bindLocalTrackEvents(s);const c=yield ee(i.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),i.store.codec,i.store.audioCodec)),l=(yield ee(c.next())).value,u=i.createGatewayPublishMessage(s,l);try{yield u}catch(h){throw c.throw(h),(h==null?void 0:h.code)===O.WS_ABORT&&s.forEach(p=>{let{track:_}=p;i.pendingLocalTracks.indexOf(_)===-1&&i.pendingLocalTracks.push(_)}),i.unbindLocalTrackEvents(s),h}yield ee(c.next()),s.forEach(h=>{let{type:p}=h;i.statsCollector.addLocalStats(p)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(s,l),s.forEach(h=>{let{track:p,type:_}=h;const E=Date.now();i.store.publish(p.getTrackId(),_===q.LocalAudioTrack?"audio":"video",void 0,E)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==pe.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!it(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[s,{track:c}]=r;return{type:s,track:c}})),e.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===pe.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:s,ssrcs:c}]=i;const l={stream_type:O4(s,r),ssrcs:c};s._muted||!s._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{Ne(this,Rt.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Ne(this,Rt.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return ba(function*(){throw new G(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fi(this,Rt.RequestRePublish,this.pendingLocalTracks),this.emit(Rt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new G(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===ht.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new xf(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new Uf(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const u=this.remoteUserMap.get(t);u?u.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:_,kind:E}=p;return _.uid===t.uid&&e===E});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Rt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(s=>{const c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(s=>{let{kind:c}=s;var l;if(c===ht.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===ht.VIDEO){var u;(u=t._videoTrack)===null||u===void 0||u._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(s=>{let[c,{kind:l}]=s;var u,h;if(l===ht.VIDEO&&c._videoSSRC&&((u=this.recvConnection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===ht.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===ht.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),r.forEach(s=>{let[,{kind:c}]=s;Ne(this,Rt.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[ht.VIDEO,ht.AUDIO].forEach(i=>{n.has(i)?Ne(this,Rt.RequestP2PUnmuteRemote,i):Ne(this,Rt.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===ht.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(q.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Dn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==q.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===q.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===q.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(q.LocalAudioTrack),l=i?this.localTrackMap.get(q.LocalVideoLowTrack):this.localTrackMap.get(q.LocalVideoTrack);gt.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Le.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(u=>u instanceof an),l=i?(s=this.localTrackMap.get(q.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(u=>u instanceof Fe);gt.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Le.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===ht.VIDEO?n._videoSSRC:n._audioSSRC;r&&gt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===ht.VIDEO,audio:i===ht.AUDIO,peerid:n.uid,subscribeRequestid:i===ht.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ai.measureFromSubscribeStart(this.store.clientId,r)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new vi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new vi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(q.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Dn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=pe.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(q.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(q.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof Fe||e&&e.track instanceof an?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ta(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(q.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Om(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=pe.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case q.LocalVideoTrack:it(e=i._hints).call(e,Le.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case q.LocalAudioTrack:i instanceof Dn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case q.LocalVideoLowTrack:}}),this.emit(Rt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ta(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Rt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof ud?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===Yi.SEND_ONLY){if(!this.sendConnection)throw new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const s=await fi(this,Rt.RequestP2PRestartICE,{direction:Yi.RECEIVE_ONLY,iceParameter:r});await i.restartICE(s),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(q.LocalVideoTrack),n=this.localTrackMap.get(q.LocalAudioTrack),i=t.videoSend.find(g=>{var C;return g.ssrc===(e==null||(C=e.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)}),r=t.audioSend.find(g=>{var C;return g.ssrc===(n==null||(C=n.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)});if(!i||!r)return 1;const s=Zr(this,Rt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,u=c&&l?(c+l)/2:c||l,h=(u&&s?(u+s)/2:u||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,E=e==null?void 0:e.track;if(E&&E._encoderConfig&&E._hints.indexOf(Le.SCREEN_TRACK)===-1){const g=E._encoderConfig.bitrateMax,C=t.bitrate.actualEncoded;if(g&&C){const v=(1e3*g-C)/(1e3*g);return xk[v<.15?0:v<.3?1:v<.45?2:v<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(C=>C.ssrc===r),l=t.videoRecv.find(C=>C.ssrc===s);if(!c&&!l)return void(e+=1);const u=Zr(this,Rt.NeedSignalRTT),h=t.rtt,p=(h&&u?(h+u)/2:h||u)||0,_=c?c.jitterMs:void 0,E=t.recvPacketLossRate;let g=.7*E*100/50+.3*p/1500;_&&(g=.6*E*100/50+.2*p/1500+.2*_/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new at((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=ae(),s=this.getAllTracks();t=yf(t=t.filter(u=>s.indexOf(u)===-1));let c=!1,l=!1;for(const u of t){if(u instanceof Fe&&(this.localTrackMap.has(q.LocalVideoTrack)||c?new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:q.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(u,n);i.push({track:h,type:q.LocalVideoLowTrack})}if(u instanceof an){const h=this.localTrackMap.get(q.LocalAudioTrack);if(h){if(!(h.track instanceof Dn))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const p=i.find(_=>{let{type:E}=_;return E===q.LocalAudioTrack});if(!(p.track instanceof Dn))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u)}else{if(!r.webAudioMediaStreamDest||u instanceof Dn||u._bypassWebAudio)i.push({track:u,type:q.LocalAudioTrack});else{const p=new Dn;p.addAudioTrack(u),i.push({track:p,type:q.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=yf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof an){const r=this.localTrackMap.get(q.LocalAudioTrack);if(!r)continue;r.track instanceof Dn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([q.LocalAudioTrack,r]),r.track.close())):e.push([q.LocalAudioTrack,r])}if(i instanceof Fe){const r=this.localTrackMap.get(q.LocalVideoTrack);if(!r)continue;e.push([q.LocalVideoTrack,r]);const s=this.localTrackMap.get(q.LocalVideoLowTrack);s&&e.push([q.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case q.LocalVideoTrack:n.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),n.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case q.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case q.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Dn?t.trackList.forEach(n=>{n.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),n.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),t.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case q.LocalVideoTrack:n.off(ft.GET_STATS,this.handleGetLocalVideoStats),n.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(ft.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case q.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case q.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Dn?t.trackList.forEach(e=>{e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Uf&&e.addListener(ft.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof xf&&e.addListener(ft.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(ht.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(ht.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,{track:c,type:l}=n;switch(l){case q.LocalAudioTrack:s=fe.Audio;break;case q.LocalVideoTrack:s=it(r=c._hints).call(r,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalVideoLowTrack:s=fe.Low}return{kind:l===q.LocalAudioTrack?ht.AUDIO:ht.VIDEO,stream_type:s,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case q.LocalVideoTrack:i=it(n=s._hints).call(n,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalAudioTrack:i=fe.Audio;break;case q.LocalVideoLowTrack:i=fe.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(Rt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),it(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await ni(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),gt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:tn.TRACER}).onSuccess(),this.emit(Rt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ta(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Df.FIRST_FRAME_DECODED),gt.firstRemoteFrame(this.store.sessionId,Fn.FIRST_AUDIO_DECODE,Ye.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ta(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,Fn.FIRST_AUDIO_RECEIVED,Ye.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ta(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,Fn.FIRST_VIDEO_RECEIVED,Ye.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Rt.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(cd(n))," -> ").concat(JSON.stringify(cd(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(cd(n))," -> ").concat(JSON.stringify(cd(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(Rt.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Yi.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Yi.SEND_ONLY?this.restartICE(t):fi(this,Rt.RequestP2PRestartICE,{direction:Yi.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(q.LocalAudioTrack);if(t instanceof an&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive||e.push([q.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===q.LocalVideoTrack)){const r=this.localTrackMap.get(q.LocalVideoLowTrack);r&&e.push([q.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(q.LocalAudioTrack);if(t instanceof an&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive&&e.push([q.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===q.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(q.LocalVideoLowTrack);r&&e.push([q.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case q.LocalAudioTrack:i=fe.Audio;break;case q.LocalVideoTrack:i=it(n=s._hints).call(n,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalVideoLowTrack:i=fe.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case q.LocalAudioTrack:i=fe.Audio;break;case q.LocalVideoTrack:i=it(n=s._hints).call(n,Le.SCREEN_TRACK)?fe.Screen:fe.High;break;case q.LocalVideoLowTrack:i=fe.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case ht.VIDEO:return void(i._videoSSRC&&e.push({stream_type:ht.VIDEO,ssrcId:i._videoSSRC}));case ht.AUDIO:return void(i._audioSSRC&&e.push({stream_type:ht.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(q.LocalVideoTrack),n=this.localTrackMap.get(q.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new at((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new at((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof an){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Ne(this,Rt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Rt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Rt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ni(bb(this.dtlsFailedCount,In)),this.emit(Rt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(q.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Fe)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof Fe).length>1)throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof an).length>1&&(t.some(e=>e instanceof an&&e._bypassWebAudio)||!ae().webAudioMediaStreamDest))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof Fe&&this.pendingLocalTracks.some(n=>n instanceof Fe))throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof an&&this.pendingLocalTracks.some(n=>n instanceof an)&&(!ae().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof an&&n._bypassWebAudio)))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&ae().supportDualStreamEncoding,i=vy(vy({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():MI(t,i);const s=De(8,"track-low-"),c=new Fe(r,vy(vy({},n&&{scaleResolutionDownBy:mI(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return c.on(Yu.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,wf.LOW_STREAM)}),c._hints.push(Le.LOW_STREAM),t.addListener(ft.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ta(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===s.uid&&u.type==="video");gt.firstRemoteVideoDecode(this.store.sessionId,Fn.FIRST_VIDEO_DECODE,Ye.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.recvConnection.getRemoteSSRC(r);return s!==void 0&&s!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new G(O.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new G(O.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}async preConnect(t){throw new G(O.NOT_SUPPORTED)}getEstablishParams(){throw new G(O.NOT_SUPPORTED)}async reSubscribe(t){throw new G(O.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new G(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===q.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,wf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Et(qe.prototype,"p2pConnect",[C2],Object.getOwnPropertyDescriptor(qe.prototype,"p2pConnect"),qe.prototype),Et(qe.prototype,"unpublish",[A2],Object.getOwnPropertyDescriptor(qe.prototype,"unpublish"),qe.prototype),Et(qe.prototype,"unpublishLowStream",[b2],Object.getOwnPropertyDescriptor(qe.prototype,"unpublishLowStream"),qe.prototype),Et(qe.prototype,"subscribe",[I2],Object.getOwnPropertyDescriptor(qe.prototype,"subscribe"),qe.prototype),Et(qe.prototype,"mockSubscribe",[O2],Object.getOwnPropertyDescriptor(qe.prototype,"mockSubscribe"),qe.prototype),Et(qe.prototype,"unsubscribe",[w2],Object.getOwnPropertyDescriptor(qe.prototype,"unsubscribe"),qe.prototype),Et(qe.prototype,"muteRemote",[N2],Object.getOwnPropertyDescriptor(qe.prototype,"muteRemote"),qe.prototype),Et(qe.prototype,"unmuteRemote",[D2],Object.getOwnPropertyDescriptor(qe.prototype,"unmuteRemote"),qe.prototype),Et(qe.prototype,"hasRemoteMediaWithLock",[L2],Object.getOwnPropertyDescriptor(qe.prototype,"hasRemoteMediaWithLock"),qe.prototype),Et(qe.prototype,"disconnectForReconnect",[P2],Object.getOwnPropertyDescriptor(qe.prototype,"disconnectForReconnect"),qe.prototype),Et(qe.prototype,"remoteMediaSsrcChanged",[k2],Object.getOwnPropertyDescriptor(qe.prototype,"remoteMediaSsrcChanged"),qe.prototype),qe);function $s(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(t){case Zs.SEND_ONLY:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{u()}}case Zs.RECEIVE_ONLY:{const u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{u()}}default:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{u(),h()}}}},i}}class ph extends Je{constructor(e,n){super(),A(this,"signal",void 0),A(this,"token",void 0),A(this,"tokenTimeout",void 0),A(this,"tokenInterval",void 0),A(this,"_sequence",0),A(this,"userMap",new Map),A(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===ke.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*N("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,s){var c,l,u;if(this.userMap.size===0)return;const h=Array.from(Tr(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(l=r)!==null&&l!==void 0?l:De(6,""),s=(u=s)!==null&&u!==void 0?u:this._sequence++;const p={_id:r,_type:e,_seq:s,_message:n,token:"".concat(this.token,"_").concat(h)};N("SHOW_P2P_LOG")&&S.debug("send message",p,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(p)).forEach(E=>{this.signal.request(At.DATA_STREAM,{payload:id(this.encoder.encode(E))})});const _=new at((E,g)=>{const C=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),v),this.off("res-@".concat(r),b),this.off(Gf.ABORT,y),S.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?g(new G(O.INVALID_REMOTE_USER)):g(new G(O.TIMEOUT))},N("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),v=()=>{C&&window.clearTimeout(C),this.off(Gf.ABORT,y),i&&E()},y=()=>{C&&window.clearTimeout(C),this.off("res-@".concat(r,"_ack"),v),this.off("res-@".concat(r),b),g(new G(O.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(Gf.ABORT,y),this.once("res-@".concat(r,"_ack"),v);const b=(L,U)=>{I=!0,C&&window.clearTimeout(C),this.off("res-@".concat(r,"_ack"),v),this.off(Gf.ABORT,y),L==="success"?E(U):g(new G(O.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let I=!1;i||(this.once("res-@".concat(r),b),ni(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{I||S.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(p))}))});try{return await _}catch(E){if(E.code===O.TIMEOUT)return await this.send(e,n,i,r,s);throw E}}onMessage(e){var n;const{_uid:i}=e;let r,s=this.userMap.get(i);if(s)r=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==_n.CHECK)return;const{token:h}=e;r=new Map,s={uid:i,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,s),this.signal.emit(Yt.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:h,total:p}=e,_=(c=r.get(h))!==null&&c!==void 0?c:[];if(_.push(e),r.has(h)||r.set(h,_),_.length!==p)return;{const E=Om(_).call(_,(g,C)=>g.index-C.index).map(g=>g.payload).join("");r.delete(h),(e=JSON.parse(E))._uid=i}}const{_type:l,token:u}=e;if(it(n=[_n.ACK,_n.CHECK]).call(n,l))return l===_n.CHECK&&this.handleCheckToken(s,u),void this.receiveMessage(e);u==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):S.debug('Receive unexpected message", '.concat(u,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:De(6,""),token:this.token,_type:_n.CHECK};N("SHOW_P2P_LOG")&&S.debug("send message",e),this.signal.request(At.DATA_STREAM,{payload:id(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:_n.ACK,token:this.token};N("SHOW_P2P_LOG")&&S.debug("send message",n),this.signal.request(At.DATA_STREAM,{payload:id(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(_n.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:_}=h;for(;p.has(_);){const E=p.get(_);p.delete(_),this.receiveMessage(E),h.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,s=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:u}=s;if(r<u)return this.ack(e._id),void S.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===u&&(this.receiveMessage(e),c.delete(u),s.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:s}=e;if(N("SHOW_P2P_LOG")&&S.debug("receive message",e),n){let c;switch(e._type!==_n.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case _n.CANDIDATE:case _n.CONTROL:this.signal.emit(i,c,s);break;case _n.PUBLISH:case _n.UNPUBLISH:case _n.RESTART_ICE:case _n.CALL:c.uid=s,fi(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case _n.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case _n.RESPONSE:{const{success:l,message:u}=c;this.emit("res-@".concat(n),l?"success":"failed",u);break}}}}splitMessage(e){if(e.length<ph.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=De(6,"");let s=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){s++;const u={id:r,index:s,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(u).length>ph.MAX_MESSAGE_SIZE?c-=50:(n.push(u),e=e.slice(c))}return n.map(u=>JSON.stringify(u))}handleCheckToken(e,n){return e.token!==n?(S.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(n)),this.reset(e.uid)},N("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await fi(this.signal,_n.CALL,void 0),n=await this.send(_n.CALL,e);this.signal.emit(It.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(Gf.ABORT),this.signal.emit(Yt.ON_USER_OFFLINE,{uid:i.uid,reason:n4.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(S.debug("change local token from ".concat(n," to ").concat(n)),this.token=De(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Gf.ABORT)}}A(ph,"MAX_SIZE",1),A(ph,"MAX_MESSAGE_SIZE",1024);class VH extends Je{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===ke.CONNECTED?this.emit(It.WS_CONNECTED):e===ke.RECONNECTING?this.emit(It.WS_RECONNECTING,this._websocketReconnectReason):e===ke.CLOSED&&this.emit(It.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),A(this,"_disconnectedReason",void 0),A(this,"_websocketReconnectReason",void 0),A(this,"_connectionState",ke.CLOSED),A(this,"reconnectToken",void 0),A(this,"p2pToken",void 0),A(this,"websocket",void 0),A(this,"openConnectionTime",void 0),A(this,"clientId",void 0),A(this,"lastMsgTime",Date.now()),A(this,"uploadCache",[]),A(this,"uploadCacheInterval",void 0),A(this,"rttRolling",new uL(5)),A(this,"pingpongTimer",void 0),A(this,"pingpongTimeoutCount",0),A(this,"joinResponse",void 0),A(this,"multiIpOption",void 0),A(this,"initError",void 0),A(this,"spec",void 0),A(this,"store",void 0),A(this,"_external_signal",void 0),A(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(It.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Yt.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Yt.MUTE_AUDIO:case Yt.MUTE_VIDEO:case Yt.ON_P2P_LOST:case Yt.ON_USER_ONLINE:return;case Yt.ON_USER_OFFLINE:const{uid:s}=r._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(r._type,r._message),r._type===Yt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Yt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(he.UID_BANNED);break;case 15:this.close(he.IP_BANNED);break;case 16:this.close(he.CHANNEL_BANNED)}if(r._type===Yt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case vt.ERR_LICENSE_MISSING:this.close(he.LICENSE_MISSING);break;case vt.ERR_LICENSE_EXPIRED:this.close(he.LICENSE_EXPIRED);break;case vt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(he.LICENSE_MINUTES_EXCEEDED);break;case vt.ERR_LICENSE_PERIOD_INVALID:this.close(he.LICENSE_PERIOD_INVALID);break;case vt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(he.LICENSE_MULTIPLE_SDK_SERVICE);break;case vt.ERR_LICENSE_ILLEGAL:this.close(he.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new _I("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ke.CONNECTED&&this.reconnect("retry",pi.OFFLINE)}),this.p2pToken=De(6,""),this._external_signal=new ph(this,this.p2pToken)}async request(e,n,i,r){const s=De(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,u=()=>new at((C,v)=>{if(this.connectionState===ke.CONNECTED)return C();const y=()=>{this.off(It.WS_CLOSED,b),C()},b=()=>{this.off(It.WS_CONNECTED,y),v(new G(O.WS_ABORT))};this.once(It.WS_CONNECTED,y),this.once(It.WS_CLOSED,b)});if(this.connectionState!==ke.CONNECTING&&this.connectionState!==ke.RECONNECTING||e===At.JOIN||e===At.REJOIN||await u(),this.websocket.sendMessage(c,!0),r)return;const h=new at((C,v)=>{let y=!1;const b=(L,U)=>{y=!0,C({isSuccess:L==="success",message:U||{}}),this.off(It.WS_CLOSED,I),this.off(It.WS_RECONNECTING,I),this.emit(It.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{v(new G(O.WS_ABORT,"type: ".concat(e))),this.off(It.WS_CLOSED,I),this.off(It.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(It.WS_CLOSED,I),this.once(It.WS_RECONNECTING,I),ni(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||y||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(It.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(C){if(this.connectionState===ke.CLOSED||e===At.LEAVE)throw new G(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?C.throw():e===At.JOIN||e===At.REJOIN?null:(await u(),await this.request(e,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),E=tg(_),g=new G(O.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:E.desc});return E.action==="success"?p.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_,", message: ").concat(E.desc,", action: ").concat(E.action)),_===vt.ERR_TOO_MANY_BROADCASTERS?((e===At.JOIN||e===At.REJOIN)&&(this.initError=g,this.close()),g.throw()):E.action==="failed"?g.throw():E.action==="quit"?(this.initError=g,this.close(),g.throw()):(_===vt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",pi.MULTI_IP)):this.reconnect(E.action,pi.SERVER_ERROR),e===At.JOIN||e===At.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new at(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Zm.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ke.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new at((n,i)=>{this.once(It.WS_CONNECTED,()=>n(this.joinResponse)),this.once(It.WS_CLOSED,()=>i(this.initError||new G(O.WS_ABORT))),this.connectionState=ke.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||he.LEAVE,this.connectionState=ke.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=De(6,""),this._external_signal.clear(),this._external_signal=new ph(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(It.ABORT_P2P_EXECUTION);const e=await fi(this,It.REQUEST_JOIN_INFO),n=await this.request(At.JOIN,e);if(!n)return this.emit(It.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(It.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ke.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=Hu(e.payload),r=new TextDecoder().decode(i),s=JSON.parse(r);"total"in s&&"id"in s||it(n=Object.values(_n)).call(n,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(Yt.ON_DATA_STREAM,e)}catch{this.emit(Yt.ON_DATA_STREAM,e)}}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=tg(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(he.UID_BANNED),void this.close()):void this.reconnect(n.action,pi.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=N("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",pi.TIMEOUT):this.request(At.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),N("REPORT_STATS")&&this.send(At.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(Pt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(It.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Pt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Pt.CLOSED,()=>{this.connectionState=ke.CLOSED}),this.websocket.on(Pt.FAILED,()=>{this._disconnectedReason=he.NETWORK_ERROR,this.connectionState=ke.CLOSED}),this.websocket.on(Pt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===ke.CONNECTED?this.connectionState=ke.RECONNECTING:this.connectionState=ke.CONNECTING}),this.websocket.on(Pt.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(Pt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(It.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof G&&e.code===O.UNEXPECTED_RESPONSE&&e.data.code===vt.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",pi.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",pi.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Pt.REQUEST_NEW_URLS,(e,n)=>{fi(this,It.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const BH={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new xH(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new VH(n,e)}};function U2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function x2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?U2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class FH{constructor(e){A(this,"sessionDesc",void 0),A(this,"localCapabilities",void 0),A(this,"rtpCapabilities",void 0),A(this,"candidates",void 0),A(this,"_originCandidates",void 0),A(this,"iceParameters",void 0),A(this,"dtlsParameters",void 0),A(this,"setup",void 0),A(this,"currentMidIndex",void 0),A(this,"cname",void 0),e=en(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:u,cname:h}=e,p=yr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=r,this._originCandidates=en(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=h;for(let _=0;_<p.mediaDescriptions.length;_++){const E=p.mediaDescriptions[_];if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=i.fingerprints,E.attributes.candidates=r,E.attributes.setup=c,E.media.mediaType==="video"){E.media.fmts=s.videoCodecs.map(C=>C.payloadType.toString(10));let g=s.videoCodecs.filter(C=>{var v,y;return(v=C.rtpMap)===null||v===void 0?void 0:it(y=v.encodingName.toLowerCase()).call(y,u)});g.length===0&&(g=s.videoCodecs),E.attributes.payloads=g,E.attributes.extmaps=s.videoExtensions}E.media.mediaType==="audio"&&(E.media.fmts=s.audioCodecs.map(g=>g.payloadType.toString(10)),E.attributes.payloads=s.audioCodecs,E.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[_]=this.mungMediaDesc(E)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return rd(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:s}=$u(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>e===ht.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,u=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:u}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],s=[];n.attributes.ssrcs.forEach(c=>{it(e).call(e,c.attributes.label||"")?s.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;it(l=s.map(u=>u.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,s)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=u})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(x2(x2({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case Ci.TCP_RELAY:this.candidates=i;break;case Ci.UDP_TCP_RELAY:case Ci.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=en(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=en(e);return Kf(i,n),SI(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===ht.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var s;c&&(c.attributes.label=i,(s=c.attributes.msid)===null||s===void 0||s.replace(n,i))}}mungMediaDesc(e){const n=en(e);return gI(n),function(i){const r=i.attributes.extmaps.find(s=>Vv(s.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(s=>{const c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var be;function V2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function yy(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?V2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let jH=(be=class Pg extends zk{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return it(n=Object.keys(pv)).call(n,e)}))]}constructor(e,n){super(e,n),A(this,"store",void 0),A(this,"peerConnection",void 0),A(this,"remoteSDP",void 0),A(this,"initialOffer",void 0),A(this,"statsFilter",void 0),A(this,"useRTX",!1),A(this,"localCapabilities",void 0),A(this,"localCandidateCount",0),A(this,"allCandidatesReceived",!1),A(this,"establishPromise",void 0),A(this,"mutex",void 0),this.store=n,this.mutex=new vi("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Pg.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Lb(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,Ze()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=ld(e.sdp),i=ig(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,yy(yy({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new G(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new FH(yy(yy({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new G(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return ba(function*(){const r=yield ee(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(E=>i.peerConnection.addTrack(E._mediaStreamTrack)),c=yield ee(i.peerConnection.createOffer()),l=yr(c.sdp),u=e.map(E=>{const g=E._mediaStreamTrack,C=l.mediaDescriptions.find(v=>v.attributes.mid===g.kind);if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return function(v,y,b){const I=v.attributes.ssrcs.filter(U=>U.attributes.label===y),L=v.attributes.ssrcGroups;if(I.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(L&&I.length>1){const U=L.find(x=>x.ssrcIds.indexOf(I[0].ssrcId)!==-1);return U?[{ssrcId:U.ssrcIds[0],rtx:b?U.ssrcIds[1]:void 0}]:[{ssrcId:I[0].ssrcId}]}return[{ssrcId:I[0].ssrcId}]}(C,g.id,i.useRTX)});let h;try{h=yield u}catch(E){throw s.forEach(g=>{hi()&&g.replaceTrack(null),i.peerConnection.removeTrack(g)}),E}const p=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,h);const _=i.remoteSDP.toString();return yield ee(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ee(i.applySendEncodings(s,e)),yield ee(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),e.map((E,g)=>{const C=E._mediaStreamTrack.id;return{localSSRC:u[g],id:C}})}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{hi()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:c}=this.remoteSDP.send(e,n,r),l=new at((p,_)=>{const E=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(s)))},1e4),g=C=>{const v=ne();if((v.name==="Safari"&&Number(v.version)===11||Hi())&&C.track.id!==s&&C.streams[0].id===c){var y;const b=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(e,s,C.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p(b)}if(C.track.id===s)return this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p(C.track)};this.peerConnection.addEventListener("track",g)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(hi()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(s=>s.active=!1),i.setParameters(r)}})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(hi()&&s.track)s.track.enabled=!0;else{const c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return ba(function*(){const i=yield ee(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=ae().supportPCSetConfiguration;if(e===Ci.RELAY&&!r)return;if(r){const h=n.peerConnection.getConfiguration(),p=e===Ci.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}e!==Ci.RELAY&&n.remoteSDP.updateCandidates(e);const s=yield ee(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=ld(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const u=n.remoteSDP.toString();yield ee(n.peerConnection.setLocalDescription(s)),yield ee(n.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(r){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new G(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new G(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new G(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Wm(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...Pg.turnServerConfigToIceServers(e.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Pg.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!ae().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");const r={},s={};if(e instanceof Fe)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(N("DSCP_TYPE")&&Bc()){var c;const h=N("DSCP_TYPE");it(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}const l=n.getParameters(),u=(i=l.encodings)===null||i===void 0?void 0:i[0];u&&Object.assign(u,s),Object.assign(l,r),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!ae().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];r&&s&&await this.updateRtpSenderEncodings(s,r)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=yr(e);return n.forEach((r,s)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(u=>u.attributes.mid===c.kind);l&&Kf(l,r)}),rd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((s,c)=>{let{id:l,mslabel:u}=s;const{kind:h}=e[c];return new at((p,_)=>{const E=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(l)))},1e4),g=C=>{const v=ne();if(v.name==="Safari"&&Number(v.version)===11&&C.track.id!==l&&C.streams[0].id===u){var y;const b=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(h,l,C.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p({track:b,id:l})}if(C.track.id===l)return this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p({track:C.track,id:l})};this.peerConnection.addEventListener("track",g)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await at.all(n)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(ae().supportPCSetConfiguration){const n=Pg.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Et(be.prototype,"connect",[ka],Object.getOwnPropertyDescriptor(be.prototype,"connect"),be.prototype),Et(be.prototype,"stopSending",[ka],Object.getOwnPropertyDescriptor(be.prototype,"stopSending"),be.prototype),Et(be.prototype,"receive",[ka],Object.getOwnPropertyDescriptor(be.prototype,"receive"),be.prototype),Et(be.prototype,"stopReceiving",[ka],Object.getOwnPropertyDescriptor(be.prototype,"stopReceiving"),be.prototype),Et(be.prototype,"muteRemote",[ka],Object.getOwnPropertyDescriptor(be.prototype,"muteRemote"),be.prototype),Et(be.prototype,"unmuteRemote",[ka],Object.getOwnPropertyDescriptor(be.prototype,"unmuteRemote"),be.prototype),Et(be.prototype,"muteLocal",[ka],Object.getOwnPropertyDescriptor(be.prototype,"muteLocal"),be.prototype),Et(be.prototype,"unmuteLocal",[ka],Object.getOwnPropertyDescriptor(be.prototype,"unmuteLocal"),be.prototype),Et(be.prototype,"close",[ka],Object.getOwnPropertyDescriptor(be.prototype,"close"),be.prototype),Et(be.prototype,"updateEncoderConfig",[ka],Object.getOwnPropertyDescriptor(be.prototype,"updateEncoderConfig"),be.prototype),Et(be.prototype,"updateSendParameters",[ka],Object.getOwnPropertyDescriptor(be.prototype,"updateSendParameters"),be.prototype),Et(be.prototype,"replaceTrack",[ka],Object.getOwnPropertyDescriptor(be.prototype,"replaceTrack"),be.prototype),Et(be.prototype,"getRemoteSSRC",[ka],Object.getOwnPropertyDescriptor(be.prototype,"getRemoteSSRC"),be.prototype),be);function ka(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{s()}},n}const GH={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new jH(n,e)}},HH={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ae().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(vv.has(t)||!t.track)return;const n={track:t.track};if(Vc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void S.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const u=e.metadata&&e.metadata();u?function(h,p){const{chunk:_,controller:E}=p,g=N("ENABLE_AUDIO_PTS_METADATA")?Hc.AUDIO_64_BIT_PTS:Hc.METADATA;_.data=function(C,v,y){const b=y.byteLength,I=b+nI+Dk,L=tI+eI+I,U=new ArrayBuffer(C.byteLength+L),x=new DataView(U);x.setUint8(0,Nk),x.setUint16(1,I),x.setUint8(3,v),x.setUint16(4,b);for(let j=0;j<b;j++)x.setUint8(6+j,y[j]);const M=new Uint8Array(x.buffer);return M.set(new Uint8Array(C),L),M.buffer}(_.data,g,h),E.enqueue(_)}(u,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=Rv(),s=new MessageChannel;await new at(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:s.port2},[s.port2]);t.transform=c,await new at(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var u;if(l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id)S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(l.data.getMetadata){const h=e.metadata&&e.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=vv.get(t);if(r){vv.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){S.warning(l&&l.message)}}}vv.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ae().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(Ov.has(t))return;const n={track:t.track,onMetadata:e.onMetadata};if(Vc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");fb(ce.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void S.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(u,h,p){var _;const E=Lk(new DataView(h.data));if(!E)return p.enqueue(h);const g=u.track.id;yG.set(g,u.track);const C=(_=E.tlv.find(U=>U.tag===Hc.AUDIO_LEVEL))===null||_===void 0?void 0:_.value;let v=0;typeof C=="number"&&(v=127-C);const y=Math.round(Math.pow(10,v/60)-1),{selected:b,speaker:I}=function(U,x){let M=Vf.get(U);if(M||(M=function(j){const X=new kk;return Vf.set(j,X),zs||(zs=new RG(N("TOPN_SILENCE_THRESHOLD")||500),zs.on("ActiveSpeakerChanged",ct=>{ct!=null&&(Av=ct)})),zs.addSpeakers([X]),X}(U)),Vf.size<=Mk)return{selected:!0,speaker:M};if(!zs)throw new Error("no active speaker detector");return zs.levelChanged(M.id,x),Ju=zs.loudest.map(j=>j.id),Av&&!it(Ju).call(Ju,Av)&&Ju.length>=Mk&&Ju.pop(),{selected:it(Ju).call(Ju,M.id)||M.id===Av,speaker:M}}(u,y),L=function(U,x,M){const j=qs.get(U)||new vG(U,x);return j.score=M,qs.set(U,j),function(X){if(bv.set(X,!0),!Iv)return void(Iv=Date.now());const ct=Date.now();ct-Iv>1e3&&(bv.get(X)?bv.set(X,!1):(Uk(X),bv.delete(X)),Iv=ct)}(U),j}(g,u.track,I.energyScore);L.addSample(b),L.active&&(h.data=E.frame.buffer,p.enqueue(h))}(t,c,l):e.enableMetadata?function(u,h,p){const _=Lk(new DataView(u.data));if(!_)return h.enqueue(u);const E=_.tlv.find(g=>g.tag===Hc.METADATA||g.tag===Hc.AUDIO_64_BIT_PTS);E&&p&&E.value instanceof Uint8Array&&p(E.value),u.data=_.frame.buffer,h.enqueue(u)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=Rv(),s=new MessageChannel;await new at(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:s.port2},[s.port2]);t.transform=c,await new at(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var u;l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id?(S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.metadata&&n.onMetadata&&n.onMetadata(l.data.metadata)},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const s=Ov.get(r);if(s){(function(u){const h=Vf.get(u);h&&(Vf.delete(u),zs&&(zs.removeSpeakers([h]),Vf.size===0&&(zs.destroy(),zs=null)))})(r),Uk(r.track.id),Ov.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(u){S.warning(u&&u.message)}}}(t)}Ov.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!ae().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(wv.has(t)||!t.track)return;const n={track:t.track};if(Vc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void S.error("create video-encoded-streams error",l&&l.message)}const s=[];e.on("sei-to-send",l=>{s.push(l)});const c=new TransformStream({transform(l,u){n.controller||(n.controller=u),t.track&&t.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=s.shift();h&&(l.data=function(p,_){const E=function(I){const L=I.length;let U=[],x=0;for(;x<L;)x+2<L&&I[x]===0&&I[x+1]===0&&(I[x+2]===0||I[x+2]===1||I[x+2]===2||I[x+2]===3)?(U.push(I[x],I[x+1],3,I[x+2]),x+=3):(U.push(I[x]),x++);return new Uint8Array(U)}(_),g=E.length,C=Math.floor(g/255),v=g%255,y=new Uint8Array(6+C+1+g+p.byteLength);y[0]=0,y[1]=0,y[2]=0,y[3]=1,y[4]=6,y[5]=101;let b=0;for(;b<C;)y[6+b]=255,b++;return y[6+b]=v,b++,y.set(E,6+b),y.set(new Uint8Array(p),6+b+g),y.buffer}(l.data,h)),u.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!hi())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=Rv(),s=new MessageChannel;await new at(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:s.port2},[s.port2]);t.transform=c,await new at(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var u;l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=wv.get(t);if(r){wv.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){S.warning(l&&l.message)}}}wv.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ae().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!t.track)return;if(Qm.has(t)){const r=Qm.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(Vc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void S.error("create video-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const u=function(h){const p=new DataView(h.data);let _=0;for(;_+4<h.data.byteLength;){if(p.getUint8(_+0)===0&&p.getUint8(_+1)===0&&p.getUint8(_+2)===0&&p.getUint8(_+3)===1&&p.getUint8(_+4)===6){let E=_+6,g=0,C=0;for(;(C=p.getUint8(E++))===255;)g+=255;g+=C;const v=CG(h.data,E,g);return new Uint8Array(v)}_++}return null}(c);u&&n.onSei&&n.onSei(u),l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=Rv(),s=new MessageChannel;await new at(l=>r.onmessage=u=>{u.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:s.port2},[s.port2]);t.transform=c,await new at(l=>r.onmessage=u=>{u.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var u;l.data.transformed&&t.track&&((u=t.track)===null||u===void 0?void 0:u.id)!==n.track.id?(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const s=Qm.get(r);if(s){Qm.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(u){S.warning(u&&u.message)}}})(t)}Qm.set(t,n),t.track.addEventListener("ended",i)}},WH={name:"InterceptFrame",create:()=>HH};Pb(),ge("PROCESS_ID","process-".concat(De(8,""),"-").concat(De(4,""),"-").concat(De(4,""),"-").concat(De(4,""),"-").concat(De(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void S.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();S.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Be,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;Ys[i]=r,Be[i]=r}})}catch(e){S.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(Ys.AREAS)&&Ys.AREAS.length>0&&CI(Ys.AREAS,!0);const B2=(t,e,n)=>{S.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),ge(t,e,n)};dd(pH,!1),dd(EH,!1),dd(X4,!1),dd(IH,!1),dd(dH,!1),dd(BH,!1),dd(GH,!1),dd(WH,!1);const On=function(t){const e=new Je,n=t,i={getListeners:e.getListeners.bind(e),on:(r,s)=>(function(c,l){c===Yo.SECURITY_POLICY_VIOLATION&&SU(l,!0)}(r,s),e.on.bind(e)(r,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return gU(gU({},n),i)}({__TRACK_LIST__:Of,VERSION:Ia,BUILD:Ub,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:B2,getParameter:N,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return ae().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new B(O.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=gt.reportApiInvoke(null,{name:bn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:tn.TRACER});let e=!1;try{const s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(s&&c&&l),e&&gb()&&FD(75)&&new s().close()}catch(s){return S.error("check system requirement failed: ",s),!1}let n=!1;const i=ne();i.name===ce.CHROME&&Number(i.version)>=58&&(Ws.engine.name!=="WebKit"||function(){const s=ne();if(rv()){if(s.os===Bn.MAC_OS)return!0;if(s.os===Bn.IOS){const c=Ws.os.version&&Ws.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===ce.FIREFOX&&Number(i.version)>=56||i.name===ce.OPERA&&Number(i.version)>=45||i.name===ce.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(Hi()||is())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||YD()||ne().name===ce.QQ)&&(n=!0),S.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return aa.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return aa.getRecordingDevices(t)},getCameras:function(t){return aa.getCamerasDevices(t)},getElectronScreenSources:FL,getPlaybackDevices:function(t){return aa.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=De(5,"client-"),i=gt.reportApiInvoke(null,{id:n,name:bn.CREATE_CLIENT,options:[e],tag:tn.TRACER});try{(function(r){Un(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Un(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Un(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&ei(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&tL(r.turnServer),r.httpRetryConfig!==void 0&&$D(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&$D(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(GD(16,0)||HD(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",S.debug("browser not support vp9, force use vp8")),ge("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new J4(us(us({forceWaitGatewayResponse:!0},e),{},{role:it(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=N("CAMERA_CAPTURE_CONFIG"),n=De(8,"track-cam-"),i=gt.reportApiInvoke(null,{id:n,tag:tn.TRACER,name:bn.CREATE_CAM_VIDEO_TRACK,options:[ze({},t),e]});e&&(t.encoderConfig=e);const r=Sv(t);let s=null;S.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{s=(await ra({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!s){const l=new G(O.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(S)}t.optimizationMode&&$b(n,s,t,Ho(t.encoderConfig));const c=new Zb(s,t,r,t.scalabiltyMode?_v(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),S.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=De(8,"track-cus-"),n=gt.reportApiInvoke(null,{id:e,tag:tn.TRACER,name:bn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),i=new Fe(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?_v(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[Le.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),S.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(E){return JL(E)}(e):void 0;n&&(e="auto");const i=De(8,"track-scr-v-"),r=gt.reportApiInvoke(null,{id:i,tag:tn.TRACER,name:bn.CREATE_SCREEN_VIDEO_TRACK,options:[ze({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const s=function(E){const g={};E.screenSourceType&&(g.mediaSource=E.screenSourceType),E.extensionId&&Vc()&&(g.extensionId=E.extensionId);const{displaySurface:C,selfBrowserSurface:v,surfaceSwitching:y,systemAudio:b,preferCurrentTab:I}=E;(Fm(107)||_b(107)||Eb(93))&&(C&&(Un(C,"displaySurface",["browser","window","monitor"]),g.displaySurface=C),v?(Un(v,"selfBrowserSurface",["exclude","include"]),g.selfBrowserSurface=v):g.selfBrowserSurface="include",y&&(Un(y,"surfaceSwitching",["exclude","include"]),g.surfaceSwitching=y)),(Fm(105)||_b(105)||Eb(91))&&b&&(Un(b,"systemAudio",["exclude","include"]),g.systemAudio=b),(Fm(94)||_b(94)||Eb(80))&&I&&(g.preferCurrentTab=!0),E.electronScreenSourceId&&(g.sourceId=E.electronScreenSourceId);const L=E.encoderConfig?jb(E.encoderConfig):null;return g.mandatory={chromeMediaSource:"desktop",maxWidth:L?L.width:void 0,maxHeight:L?L.height:void 0},L&&(L.frameRate&&(typeof L.frameRate=="number"?(g.mandatory.maxFrameRate=L.frameRate,g.mandatory.minFrameRate=L.frameRate):(g.mandatory.maxFrameRate=L.frameRate.max||L.frameRate.ideal||L.frameRate.exact||void 0,g.mandatory.minFrameRate=L.frameRate.min||L.frameRate.ideal||L.frameRate.exact||void 0),g.frameRate=L.frameRate),L.width&&(g.width=L.width),L.height&&(g.height=L.height)),g}(t);let c=null,l=null;const u=ae();if(!u.supportShareAudio&&e==="enable"){const E=new G(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(E),E.throw(S)}S.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const h=u.supportShareAudio&&e!=="disable";try{const E=await ra({screen:s,screenAudio:h?n||!0:void 0},i);c=E.getVideoTracks()[0]||null,l=E.getAudioTracks()[0]||null}catch(E){throw r.onError(E),E}if(!c){const E=new G(O.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(E),E.throw(S)}if(!l&&e==="enable"){c&&c.stop();const E=new G(O.SHARE_AUDIO_NOT_ALLOWED);return r.onError(E),E.throw(S)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&($b(i,c,t,t.encoderConfig&&jb(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const p=new Fe(c,t.encoderConfig?jb(t.encoderConfig):{},t.scalabiltyMode?_v(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[Le.SCREEN_TRACK]);if(!l)return r.onSuccess(p.getTrackId()),S.info("create screen video track success","video:",p.getTrackId()),p;const _=new an(l,void 0,De(8,"track-scr-a-"),!1);return r.onSuccess([p.getTrackId(),_.getTrackId()]),S.info("create screen video track success","video:",p.getTrackId(),"audio:",_.getTrackId()),[p,_]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=N("CAMERA_CAPTURE_CONFIG"),i=De(8,"track-mic-"),r=De(8,"track-cam-"),s=gt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:tn.TRACER,name:bn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=Sv(e),l=QL(t);let u=null,h=null;S.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const E=await ra({audio:l,video:c},"".concat(i,"-").concat(r));u=E.getAudioTracks()[0],h=E.getVideoTracks()[0]}catch(E){throw s.onError(E),E}if(!u||!h){const E=new G(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(E),E.throw(S)}e.optimizationMode&&$b(r,h,e,Ho(e.encoderConfig));const p=new Tv(u,t,l,i),_=new Zb(h,e,c,e.scalabiltyMode?_v(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return s.onSuccess([p.getTrackId(),_.getTrackId()]),S.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[p,_]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=De(8,"track-mic-"),n=gt.reportApiInvoke(null,{id:e,tag:tn.TRACER,name:bn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=QL(t);let r=null;S.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await ra({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new G(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(S)}const s=new Tv(r,t,i,e);return n.onSuccess(s.getTrackId()),S.info("create microphone audio track success, trackId:",e),s},createCustomAudioTrack:function(t){const e=De(8,"track-cus-"),n=gt.reportApiInvoke(null,{id:e,tag:tn.TRACER,name:bn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new an(t.mediaStreamTrack,t.encoderConfig?Ev(t.encoderConfig):{},e,!1);return S.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=De(8,"track-buf-"),l=gt.reportApiInvoke(null,{id:c,tag:tn.TRACER,name:bn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(N("DISABLE_WEBAUDIO"))throw new G(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");S.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);const u=r;if(!(r instanceof AudioBuffer))try{r=await async function(_,E){let g=null;if(typeof _=="string"){const v=xP.get(_);if(v)return S.debug("use cached audio resource: ",_),v;try{g=(await Ks(()=>nr.get(_,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(y){throw new G(O.FETCH_AUDIO_FILE_FAILED,y.toString())}}else g=await new at((y,b)=>{const I=new FileReader;I.onload=L=>{L.target?y(L.target.result):b(new G(O.READ_LOCAL_AUDIO_FILE_ERROR))},I.onerror=()=>{b(new G(O.READ_LOCAL_AUDIO_FILE_ERROR))},I.readAsArrayBuffer(_)});const C=await function(v){const y=kf();return new at((b,I)=>{y.decodeAudioData(v,L=>{b(L)},L=>{I(new G(O.DECODE_AUDIO_FILE_FAILED,L.toString()))})})}(g);return typeof _=="string"&&E&&xP.set(_,C),C}(r,n)}catch(_){return l.onError(_),_.throw(S)}const h=new EG(r),p=new _G(u,h,i?Ev(i):{},c);return S.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(t){if(S.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw S.debug("Invalid appType"),new B(O.INVALID_PARAMS,"invalid app type",t);ge("APP_TYPE",Math.floor(t))},setLogLevel:function(t){S.setLogLevel(t)},enableLogUpload:function(){N("USE_NEW_LOG")?ge("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){N("USE_NEW_LOG")?ge("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new xM},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=gt.reportApiInvoke(null,{tag:tn.TRACER,name:bn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof an||t instanceof xf)){const u=new B(O.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof an?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let s=r,c=r;const l=Date.now();return new at(u=>{const h=setInterval(()=>{const p=t.getVolumeLevel();s=p>s?p:s,c=p<c?p:c;const _=s-c>1e-4,E=Date.now()-l;if(_||E>e){clearInterval(h);const g=_,C={duration:E,deviceLabel:i,maxVolumeLevel:s,result:g};S.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),n.onSuccess(C),u(g)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=gt.reportApiInvoke(null,{tag:tn.TRACER,name:bn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof Fe||t instanceof Uf)){const _=new B(O.INVALID_TRACK,"the parameter is not a video track");return n.onError(_),_.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof Fe?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(hi()||rv())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,u=0;try{const _=Date.now();l=await function(E,g,C,v){let y,b=0,I=null;return new at((L,U)=>{function x(){b>v&&y&&(y(),L(b));const M=C.getContext("2d");if(!M){const ct=new B(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(ct.toString()),void U(ct)}M.drawImage(E,0,0,160,120);const j=M.getImageData(0,0,C.width,C.height),X=Math.floor(j.data.length/3);if(I){for(let ct=0;ct<X;ct+=3)if(j.data[ct]!==I[ct])return b+=1,void(I=j.data);I=j.data}else I=j.data}setTimeout(()=>{y&&(y(),L(b))},g),y=Yb(()=>{x()},30)})}(s,e,c,4),u=Date.now()-_}catch(_){throw n.onError(_),_}M4===ce.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=l>4,p={duration:u,changedPicNum:l,deviceLabel:i,result:h};return S.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:CI,audioElementPlayCenter:ir,resumeAudioContext:function(){ir.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){Z4.processExternalMediaAEC(t)},registerExtensions:function(t){const e=N("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!it(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=S.extLog,i.reporter.hookApiInvoke=gt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=N(r)})}),B2("PLUGIN_INFO",e)},ChannelMediaRelayError:Ff,ChannelMediaRelayEvent:Kc,ChannelMediaRelayState:Cr,RemoteStreamFallbackType:cG,RemoteStreamType:oG,ConnectionDisconnectedReason:he,AudienceLatencyLevelType:Vj,AREAS:le,preload:async function(t,e,n,i){return d1(t,e,n,i)}});return Object.defineProperties(On,{onAudioAutoplayFailed:{get:()=>sa.onAudioAutoplayFailed,set:t=>{sa.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>sa.onAutoplayFailed,set:t=>{sa.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>On._onSecurityPolicyViolation,set(t){On._onSecurityPolicyViolation=t,SU(t)}},__CLIENT_LIST__:{get:()=>N("SHOW_GLOBAL_CLIENT_LIST")?Qu:[]}}),aa.on(zu.CAMERA_DEVICE_CHANGED,t=>{S.info("camera device changed",JSON.stringify(t)),On.onCameraChanged&&On.onCameraChanged(t),On.safeEmit(Yo.CAMERA_CHANGED,t)}),aa.on(zu.RECORDING_DEVICE_CHANGED,t=>{S.info("microphone device changed",JSON.stringify(t)),On.onMicrophoneChanged&&On.onMicrophoneChanged(t),On.safeEmit(Yo.MICROPHONE_CHANGED,t)}),aa.on(zu.PLAYOUT_DEVICE_CHANGED,t=>{S.debug("playout device changed",JSON.stringify(t)),On.onPlaybackDeviceChanged&&On.onPlaybackDeviceChanged(t),On.safeEmit(Yo.PLAYBACK_DEVICE_CHANGED,t)}),ir.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),sa.onAudioAutoplayFailed&&sa.onAudioAutoplayFailed()},Se.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),sa.onAudioAutoplayFailed&&sa.onAudioAutoplayFailed(),On.safeEmit(Yo.AUTOPLAY_FAILED)}),Se.on(ri.STATE_CHANGE,(t,e)=>{S.info("audio context state changed: ".concat(e," => ").concat(t)),On.onAudioContextStateChanged&&On.onAudioContextStateChanged(t,e),On.safeEmit(Yo.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),Rn.on(vf.NETWORK_STATE_CHANGE,(t,e)=>{S.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=On),On})}(by)),by.exports}var n6=e6();const J2=CO(n6),i6=()=>{const[kt,Xn]=rc.useState(!1),[on,et]=rc.useState([]),[Vt,Xt]=rc.useState(0),[Pn,Xi]=rc.useState(null),[Ft,St]=rc.useState(!1),xt=rc.useRef(null),Mt=rc.useRef(null),ue="740baf604340463486afea8a267cc8e8",ai="audio-channel",_e=null,Nr=async()=>{if(kt){console.log("Already joined the call.");return}try{Mt.current=J2.createClient({mode:"rtc",codec:"h264"}),Mt.current.on("user-published",bi),Mt.current.on("user-left",la),Mt.current.on("network-quality",Dr),await Mt.current.join(ue,ai,_e,null);const Ae=await J2.createMicrophoneAudioTrack();xt.current=Ae,await Mt.current.publish([Ae]),Xn(!0),Xi(new Date)}catch(Ae){console.error("Error joining the channel:",Ae)}},bi=async(Ae,dn)=>{dn==="audio"&&(await Mt.current.subscribe(Ae,"audio"),Ae.audioTrack.play(),et(Qn=>Qn.some(Wr=>Wr.uid===Ae.uid)?Qn:[...Qn,Ae]))},la=Ae=>{et(dn=>dn.filter(Qn=>Qn.uid!==Ae.uid))},Dr=Ae=>{console.log("Network Quality:",Ae)},Jn=async()=>{xt.current&&(Ft?await xt.current.setEnabled(!0):await xt.current.setEnabled(!1),St(!Ft))},dr=async()=>{xt.current&&(xt.current.stop(),xt.current.close()),Mt.current&&await Mt.current.leave(),et([]),Xn(!1),Xt(0),Xi(null),St(!1)};rc.useEffect(()=>{let Ae;return Pn&&(Ae=setInterval(()=>{Xt(Math.floor((new Date-Pn)/1e3))},1e3)),()=>clearInterval(Ae)},[Pn]),rc.useEffect(()=>()=>{Mt.current&&(Mt.current.off("user-published",bi),Mt.current.off("user-left",la),Mt.current.off("network-quality",Dr))},[]);const je=Ae=>{const dn=Math.floor(Ae/60),Qn=Ae%60;return`${dn}m ${Qn}s`};return navigator.mediaDevices.getUserMedia({audio:!0}).then(Ae=>{}).catch(Ae=>{console.error("Microphone access denied:",Ae)}),lr.createElement("div",{className:"bg-gray-100 p-4 rounded-lg shadow-lg w-[500px] mx-auto mt-10"},lr.createElement("h1",null,"Agora Audio Call"),lr.createElement("div",null,kt?lr.createElement("p",null,"You're in the call!"):lr.createElement("button",{onClick:Nr},"Join Call")),lr.createElement("div",null,lr.createElement("h3",null,"Remote Users"),on.length>0?on.map(Ae=>lr.createElement("div",{key:Ae.uid},lr.createElement("p",null,"Remote user ",Ae.uid))):lr.createElement("p",null,"No remote users yet.")),kt&&lr.createElement("div",null,lr.createElement("p",null,"Call Duration: ",je(Vt)),lr.createElement("button",{onClick:Jn},Ft?"Unmute":"Mute"),lr.createElement("button",{onClick:dr},"End Call")))};$H.createRoot(document.getElementById("root")).render(lr.createElement(lr.StrictMode,null,lr.createElement(i6,null)));
