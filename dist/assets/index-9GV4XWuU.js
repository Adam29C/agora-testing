(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))u(h);new MutationObserver(h=>{for(const E of h)if(E.type==="childList")for(const v of E.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&u(v)}).observe(document,{childList:!0,subtree:!0});function o(h){const E={};return h.integrity&&(E.integrity=h.integrity),h.referrerPolicy&&(E.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?E.credentials="include":h.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function u(h){if(h.ep)return;h.ep=!0;const E=o(h);fetch(h.href,E)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var jsxRuntime={exports:{}},reactJsxRuntime_production={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var i=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function o(u,h,E){var v=null;if(E!==void 0&&(v=""+E),h.key!==void 0&&(v=""+h.key),"key"in h){E={};for(var O in h)O!=="key"&&(E[O]=h[O])}else E=h;return h=E.ref,{$$typeof:i,type:u,key:v,ref:h!==void 0?h:null,props:E}}return reactJsxRuntime_production.Fragment=r,reactJsxRuntime_production.jsx=o,reactJsxRuntime_production.jsxs=o,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var i=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),v=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),k=Symbol.for("react.memo"),j=Symbol.for("react.lazy"),K=Symbol.iterator;function $(_u){return _u===null||typeof _u!="object"?null:(_u=K&&_u[K]||_u["@@iterator"],typeof _u=="function"?_u:null)}var _e={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},na=Object.assign,_c={};function _a(_u,S_,P_){this.props=_u,this.context=S_,this.refs=_c,this.updater=P_||_e}_a.prototype.isReactComponent={},_a.prototype.setState=function(_u,S_){if(typeof _u!="object"&&typeof _u!="function"&&_u!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_u,S_,"setState")},_a.prototype.forceUpdate=function(_u){this.updater.enqueueForceUpdate(this,_u,"forceUpdate")};function _s(){}_s.prototype=_a.prototype;function _h(_u,S_,P_){this.props=_u,this.context=S_,this.refs=_c,this.updater=P_||_e}var _f=_h.prototype=new _s;_f.constructor=_h,na(_f,_a.prototype),_f.isPureReactComponent=!0;var E_=Array.isArray,y_={H:null,A:null,T:null,S:null,V:null},F_=Object.prototype.hasOwnProperty;function w_(_u,S_,P_,G_,lb,kS){return P_=kS.ref,{$$typeof:i,type:_u,key:S_,ref:P_!==void 0?P_:null,props:kS}}function W_(_u,S_){return w_(_u.type,S_,void 0,void 0,void 0,_u.props)}function _S(_u){return typeof _u=="object"&&_u!==null&&_u.$$typeof===i}function o_(_u){var S_={"=":"=0",":":"=2"};return"$"+_u.replace(/[=:]/g,function(P_){return S_[P_]})}var b_=/\/+/g;function h_(_u,S_){return typeof _u=="object"&&_u!==null&&_u.key!=null?o_(""+_u.key):S_.toString(36)}function B_(){}function e_(_u){switch(_u.status){case"fulfilled":return _u.value;case"rejected":throw _u.reason;default:switch(typeof _u.status=="string"?_u.then(B_,B_):(_u.status="pending",_u.then(function(S_){_u.status==="pending"&&(_u.status="fulfilled",_u.value=S_)},function(S_){_u.status==="pending"&&(_u.status="rejected",_u.reason=S_)})),_u.status){case"fulfilled":return _u.value;case"rejected":throw _u.reason}}throw _u}function r_(_u,S_,P_,G_,lb){var kS=typeof _u;(kS==="undefined"||kS==="boolean")&&(_u=null);var Z_=!1;if(_u===null)Z_=!0;else switch(kS){case"bigint":case"string":case"number":Z_=!0;break;case"object":switch(_u.$$typeof){case i:case r:Z_=!0;break;case j:return Z_=_u._init,r_(Z_(_u._payload),S_,P_,G_,lb)}}if(Z_)return lb=lb(_u),Z_=G_===""?"."+h_(_u,0):G_,E_(lb)?(P_="",Z_!=null&&(P_=Z_.replace(b_,"$&/")+"/"),r_(lb,S_,P_,"",function(t0){return t0})):lb!=null&&(_S(lb)&&(lb=W_(lb,P_+(lb.key==null||_u&&_u.key===lb.key?"":(""+lb.key).replace(b_,"$&/")+"/")+Z_)),S_.push(lb)),1;Z_=0;var $S=G_===""?".":G_+":";if(E_(_u))for(var FS=0;FS<_u.length;FS++)G_=_u[FS],kS=$S+h_(G_,FS),Z_+=r_(G_,S_,P_,kS,lb);else if(FS=$(_u),typeof FS=="function")for(_u=FS.call(_u),FS=0;!(G_=_u.next()).done;)G_=G_.value,kS=$S+h_(G_,FS++),Z_+=r_(G_,S_,P_,kS,lb);else if(kS==="object"){if(typeof _u.then=="function")return r_(e_(_u),S_,P_,G_,lb);throw S_=String(_u),Error("Objects are not valid as a React child (found: "+(S_==="[object Object]"?"object with keys {"+Object.keys(_u).join(", ")+"}":S_)+"). If you meant to render a collection of children, use an array instead.")}return Z_}function _p(_u,S_,P_){if(_u==null)return _u;var G_=[],lb=0;return r_(_u,G_,"","",function(kS){return S_.call(P_,kS,lb++)}),G_}function c_(_u){if(_u._status===-1){var S_=_u._result;S_=S_(),S_.then(function(P_){(_u._status===0||_u._status===-1)&&(_u._status=1,_u._result=P_)},function(P_){(_u._status===0||_u._status===-1)&&(_u._status=2,_u._result=P_)}),_u._status===-1&&(_u._status=0,_u._result=S_)}if(_u._status===1)return _u._result.default;throw _u._result}var v_=typeof reportError=="function"?reportError:function(_u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var S_=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _u=="object"&&_u!==null&&typeof _u.message=="string"?String(_u.message):String(_u),error:_u});if(!window.dispatchEvent(S_))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_u);return}console.error(_u)};function q_(){}return react_production.Children={map:_p,forEach:function(_u,S_,P_){_p(_u,function(){S_.apply(this,arguments)},P_)},count:function(_u){var S_=0;return _p(_u,function(){S_++}),S_},toArray:function(_u){return _p(_u,function(S_){return S_})||[]},only:function(_u){if(!_S(_u))throw Error("React.Children.only expected to receive a single React element child.");return _u}},react_production.Component=_a,react_production.Fragment=o,react_production.Profiler=h,react_production.PureComponent=_h,react_production.StrictMode=u,react_production.Suspense=C,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=y_,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(_u){return y_.H.useMemoCache(_u)}},react_production.cache=function(_u){return function(){return _u.apply(null,arguments)}},react_production.cloneElement=function(_u,S_,P_){if(_u==null)throw Error("The argument must be a React element, but you passed "+_u+".");var G_=na({},_u.props),lb=_u.key,kS=void 0;if(S_!=null)for(Z_ in S_.ref!==void 0&&(kS=void 0),S_.key!==void 0&&(lb=""+S_.key),S_)!F_.call(S_,Z_)||Z_==="key"||Z_==="__self"||Z_==="__source"||Z_==="ref"&&S_.ref===void 0||(G_[Z_]=S_[Z_]);var Z_=arguments.length-2;if(Z_===1)G_.children=P_;else if(1<Z_){for(var $S=Array(Z_),FS=0;FS<Z_;FS++)$S[FS]=arguments[FS+2];G_.children=$S}return w_(_u.type,lb,void 0,void 0,kS,G_)},react_production.createContext=function(_u){return _u={$$typeof:v,_currentValue:_u,_currentValue2:_u,_threadCount:0,Provider:null,Consumer:null},_u.Provider=_u,_u.Consumer={$$typeof:E,_context:_u},_u},react_production.createElement=function(_u,S_,P_){var G_,lb={},kS=null;if(S_!=null)for(G_ in S_.key!==void 0&&(kS=""+S_.key),S_)F_.call(S_,G_)&&G_!=="key"&&G_!=="__self"&&G_!=="__source"&&(lb[G_]=S_[G_]);var Z_=arguments.length-2;if(Z_===1)lb.children=P_;else if(1<Z_){for(var $S=Array(Z_),FS=0;FS<Z_;FS++)$S[FS]=arguments[FS+2];lb.children=$S}if(_u&&_u.defaultProps)for(G_ in Z_=_u.defaultProps,Z_)lb[G_]===void 0&&(lb[G_]=Z_[G_]);return w_(_u,kS,void 0,void 0,null,lb)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(_u){return{$$typeof:O,render:_u}},react_production.isValidElement=_S,react_production.lazy=function(_u){return{$$typeof:j,_payload:{_status:-1,_result:_u},_init:c_}},react_production.memo=function(_u,S_){return{$$typeof:k,type:_u,compare:S_===void 0?null:S_}},react_production.startTransition=function(_u){var S_=y_.T,P_={};y_.T=P_;try{var G_=_u(),lb=y_.S;lb!==null&&lb(P_,G_),typeof G_=="object"&&G_!==null&&typeof G_.then=="function"&&G_.then(q_,v_)}catch(kS){v_(kS)}finally{y_.T=S_}},react_production.unstable_useCacheRefresh=function(){return y_.H.useCacheRefresh()},react_production.use=function(_u){return y_.H.use(_u)},react_production.useActionState=function(_u,S_,P_){return y_.H.useActionState(_u,S_,P_)},react_production.useCallback=function(_u,S_){return y_.H.useCallback(_u,S_)},react_production.useContext=function(_u){return y_.H.useContext(_u)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(_u,S_){return y_.H.useDeferredValue(_u,S_)},react_production.useEffect=function(_u,S_,P_){var G_=y_.H;if(typeof P_=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return G_.useEffect(_u,S_)},react_production.useId=function(){return y_.H.useId()},react_production.useImperativeHandle=function(_u,S_,P_){return y_.H.useImperativeHandle(_u,S_,P_)},react_production.useInsertionEffect=function(_u,S_){return y_.H.useInsertionEffect(_u,S_)},react_production.useLayoutEffect=function(_u,S_){return y_.H.useLayoutEffect(_u,S_)},react_production.useMemo=function(_u,S_){return y_.H.useMemo(_u,S_)},react_production.useOptimistic=function(_u,S_){return y_.H.useOptimistic(_u,S_)},react_production.useReducer=function(_u,S_,P_){return y_.H.useReducer(_u,S_,P_)},react_production.useRef=function(_u){return y_.H.useRef(_u)},react_production.useState=function(_u){return y_.H.useState(_u)},react_production.useSyncExternalStore=function(_u,S_,P_){return y_.H.useSyncExternalStore(_u,S_,P_)},react_production.useTransition=function(){return y_.H.useTransition()},react_production.version="19.1.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports);var dist={},hasRequiredDist;function requireDist(){if(hasRequiredDist)return dist;hasRequiredDist=1,Object.defineProperty(dist,"__esModule",{value:!0}),dist.parse=v,dist.serialize=k;const i=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,r=/^[\u0021-\u003A\u003C-\u007E]*$/,o=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,u=/^[\u0020-\u003A\u003D-\u007E]*$/,h=Object.prototype.toString,E=(()=>{const $=function(){};return $.prototype=Object.create(null),$})();function v($,_e){const na=new E,_c=$.length;if(_c<2)return na;const _a=(_e==null?void 0:_e.decode)||j;let _s=0;do{const _h=$.indexOf("=",_s);if(_h===-1)break;const _f=$.indexOf(";",_s),E_=_f===-1?_c:_f;if(_h>E_){_s=$.lastIndexOf(";",_h-1)+1;continue}const y_=O($,_s,_h),F_=C($,_h,y_),w_=$.slice(y_,F_);if(na[w_]===void 0){let W_=O($,_h+1,E_),_S=C($,E_,W_);const o_=_a($.slice(W_,_S));na[w_]=o_}_s=E_+1}while(_s<_c);return na}function O($,_e,na){do{const _c=$.charCodeAt(_e);if(_c!==32&&_c!==9)return _e}while(++_e<na);return na}function C($,_e,na){for(;_e>na;){const _c=$.charCodeAt(--_e);if(_c!==32&&_c!==9)return _e+1}return na}function k($,_e,na){const _c=(na==null?void 0:na.encode)||encodeURIComponent;if(!i.test($))throw new TypeError(`argument name is invalid: ${$}`);const _a=_c(_e);if(!r.test(_a))throw new TypeError(`argument val is invalid: ${_e}`);let _s=$+"="+_a;if(!na)return _s;if(na.maxAge!==void 0){if(!Number.isInteger(na.maxAge))throw new TypeError(`option maxAge is invalid: ${na.maxAge}`);_s+="; Max-Age="+na.maxAge}if(na.domain){if(!o.test(na.domain))throw new TypeError(`option domain is invalid: ${na.domain}`);_s+="; Domain="+na.domain}if(na.path){if(!u.test(na.path))throw new TypeError(`option path is invalid: ${na.path}`);_s+="; Path="+na.path}if(na.expires){if(!K(na.expires)||!Number.isFinite(na.expires.valueOf()))throw new TypeError(`option expires is invalid: ${na.expires}`);_s+="; Expires="+na.expires.toUTCString()}if(na.httpOnly&&(_s+="; HttpOnly"),na.secure&&(_s+="; Secure"),na.partitioned&&(_s+="; Partitioned"),na.priority)switch(typeof na.priority=="string"?na.priority.toLowerCase():void 0){case"low":_s+="; Priority=Low";break;case"medium":_s+="; Priority=Medium";break;case"high":_s+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${na.priority}`)}if(na.sameSite)switch(typeof na.sameSite=="string"?na.sameSite.toLowerCase():na.sameSite){case!0:case"strict":_s+="; SameSite=Strict";break;case"lax":_s+="; SameSite=Lax";break;case"none":_s+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${na.sameSite}`)}return _s}function j($){if($.indexOf("%")===-1)return $;try{return decodeURIComponent($)}catch{return $}}function K($){return h.call($)==="[object Date]"}return dist}requireDist();var PopStateEventType="popstate";function createBrowserHistory(i={}){function r(u,h){let{pathname:E,search:v,hash:O}=u.location;return createLocation("",{pathname:E,search:v,hash:O},h.state&&h.state.usr||null,h.state&&h.state.key||"default")}function o(u,h){return typeof h=="string"?h:createPath(h)}return getUrlBasedHistory(r,o,null,i)}function invariant(i,r){if(i===!1||i===null||typeof i>"u")throw new Error(r)}function warning(i,r){if(!i){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function createKey(){return Math.random().toString(36).substring(2,10)}function getHistoryState(i,r){return{usr:i.state,key:i.key,idx:r}}function createLocation(i,r,o=null,u){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof r=="string"?parsePath(r):r,state:o,key:r&&r.key||u||createKey()}}function createPath({pathname:i="/",search:r="",hash:o=""}){return r&&r!=="?"&&(i+=r.charAt(0)==="?"?r:"?"+r),o&&o!=="#"&&(i+=o.charAt(0)==="#"?o:"#"+o),i}function parsePath(i){let r={};if(i){let o=i.indexOf("#");o>=0&&(r.hash=i.substring(o),i=i.substring(0,o));let u=i.indexOf("?");u>=0&&(r.search=i.substring(u),i=i.substring(0,u)),i&&(r.pathname=i)}return r}function getUrlBasedHistory(i,r,o,u={}){let{window:h=document.defaultView,v5Compat:E=!1}=u,v=h.history,O="POP",C=null,k=j();k==null&&(k=0,v.replaceState({...v.state,idx:k},""));function j(){return(v.state||{idx:null}).idx}function K(){O="POP";let _a=j(),_s=_a==null?null:_a-k;k=_a,C&&C({action:O,location:_c.location,delta:_s})}function $(_a,_s){O="PUSH";let _h=createLocation(_c.location,_a,_s);k=j()+1;let _f=getHistoryState(_h,k),E_=_c.createHref(_h);try{v.pushState(_f,"",E_)}catch(y_){if(y_ instanceof DOMException&&y_.name==="DataCloneError")throw y_;h.location.assign(E_)}E&&C&&C({action:O,location:_c.location,delta:1})}function _e(_a,_s){O="REPLACE";let _h=createLocation(_c.location,_a,_s);k=j();let _f=getHistoryState(_h,k),E_=_c.createHref(_h);v.replaceState(_f,"",E_),E&&C&&C({action:O,location:_c.location,delta:0})}function na(_a){let _s=h.location.origin!=="null"?h.location.origin:h.location.href,_h=typeof _a=="string"?_a:createPath(_a);return _h=_h.replace(/ $/,"%20"),invariant(_s,`No window.location.(origin|href) available to create URL for href: ${_h}`),new URL(_h,_s)}let _c={get action(){return O},get location(){return i(h,v)},listen(_a){if(C)throw new Error("A history only accepts one active listener");return h.addEventListener(PopStateEventType,K),C=_a,()=>{h.removeEventListener(PopStateEventType,K),C=null}},createHref(_a){return r(h,_a)},createURL:na,encodeLocation(_a){let _s=na(_a);return{pathname:_s.pathname,search:_s.search,hash:_s.hash}},push:$,replace:_e,go(_a){return v.go(_a)}};return _c}function matchRoutes(i,r,o="/"){return matchRoutesImpl(i,r,o,!1)}function matchRoutesImpl(i,r,o,u){let h=typeof r=="string"?parsePath(r):r,E=stripBasename(h.pathname||"/",o);if(E==null)return null;let v=flattenRoutes(i);rankRouteBranches(v);let O=null;for(let C=0;O==null&&C<v.length;++C){let k=decodePath(E);O=matchRouteBranch(v[C],k,u)}return O}function flattenRoutes(i,r=[],o=[],u=""){let h=(E,v,O)=>{let C={relativePath:O===void 0?E.path||"":O,caseSensitive:E.caseSensitive===!0,childrenIndex:v,route:E};C.relativePath.startsWith("/")&&(invariant(C.relativePath.startsWith(u),`Absolute route path "${C.relativePath}" nested under path "${u}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),C.relativePath=C.relativePath.slice(u.length));let k=joinPaths([u,C.relativePath]),j=o.concat(C);E.children&&E.children.length>0&&(invariant(E.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${k}".`),flattenRoutes(E.children,r,j,k)),!(E.path==null&&!E.index)&&r.push({path:k,score:computeScore(k,E.index),routesMeta:j})};return i.forEach((E,v)=>{var O;if(E.path===""||!((O=E.path)!=null&&O.includes("?")))h(E,v);else for(let C of explodeOptionalSegments(E.path))h(E,v,C)}),r}function explodeOptionalSegments(i){let r=i.split("/");if(r.length===0)return[];let[o,...u]=r,h=o.endsWith("?"),E=o.replace(/\?$/,"");if(u.length===0)return h?[E,""]:[E];let v=explodeOptionalSegments(u.join("/")),O=[];return O.push(...v.map(C=>C===""?E:[E,C].join("/"))),h&&O.push(...v),O.map(C=>i.startsWith("/")&&C===""?"/":C)}function rankRouteBranches(i){i.sort((r,o)=>r.score!==o.score?o.score-r.score:compareIndexes(r.routesMeta.map(u=>u.childrenIndex),o.routesMeta.map(u=>u.childrenIndex)))}var paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=i=>i==="*";function computeScore(i,r){let o=i.split("/"),u=o.length;return o.some(isSplat)&&(u+=splatPenalty),r&&(u+=indexRouteValue),o.filter(h=>!isSplat(h)).reduce((h,E)=>h+(paramRe.test(E)?dynamicSegmentValue:E===""?emptySegmentValue:staticSegmentValue),u)}function compareIndexes(i,r){return i.length===r.length&&i.slice(0,-1).every((u,h)=>u===r[h])?i[i.length-1]-r[r.length-1]:0}function matchRouteBranch(i,r,o=!1){let{routesMeta:u}=i,h={},E="/",v=[];for(let O=0;O<u.length;++O){let C=u[O],k=O===u.length-1,j=E==="/"?r:r.slice(E.length)||"/",K=matchPath({path:C.relativePath,caseSensitive:C.caseSensitive,end:k},j),$=C.route;if(!K&&k&&o&&!u[u.length-1].route.index&&(K=matchPath({path:C.relativePath,caseSensitive:C.caseSensitive,end:!1},j)),!K)return null;Object.assign(h,K.params),v.push({params:h,pathname:joinPaths([E,K.pathname]),pathnameBase:normalizePathname(joinPaths([E,K.pathnameBase])),route:$}),K.pathnameBase!=="/"&&(E=joinPaths([E,K.pathnameBase]))}return v}function matchPath(i,r){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[o,u]=compilePath(i.path,i.caseSensitive,i.end),h=r.match(o);if(!h)return null;let E=h[0],v=E.replace(/(.)\/+$/,"$1"),O=h.slice(1);return{params:u.reduce((k,{paramName:j,isOptional:K},$)=>{if(j==="*"){let na=O[$]||"";v=E.slice(0,E.length-na.length).replace(/(.)\/+$/,"$1")}const _e=O[$];return K&&!_e?k[j]=void 0:k[j]=(_e||"").replace(/%2F/g,"/"),k},{}),pathname:E,pathnameBase:v,pattern:i}}function compilePath(i,r=!1,o=!0){warning(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let u=[],h="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(v,O,C)=>(u.push({paramName:O,isOptional:C!=null}),C?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(u.push({paramName:"*"}),h+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?h+="\\/*$":i!==""&&i!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,r?void 0:"i"),u]}function decodePath(i){try{return i.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return warning(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${r}).`),i}}function stripBasename(i,r){if(r==="/")return i;if(!i.toLowerCase().startsWith(r.toLowerCase()))return null;let o=r.endsWith("/")?r.length-1:r.length,u=i.charAt(o);return u&&u!=="/"?null:i.slice(o)||"/"}function resolvePath(i,r="/"){let{pathname:o,search:u="",hash:h=""}=typeof i=="string"?parsePath(i):i;return{pathname:o?o.startsWith("/")?o:resolvePathname(o,r):r,search:normalizeSearch(u),hash:normalizeHash(h)}}function resolvePathname(i,r){let o=r.replace(/\/+$/,"").split("/");return i.split("/").forEach(h=>{h===".."?o.length>1&&o.pop():h!=="."&&o.push(h)}),o.length>1?o.join("/"):"/"}function getInvalidPathError(i,r,o,u){return`Cannot include a '${i}' character in a manually specified \`to.${r}\` field [${JSON.stringify(u)}].  Please separate it out to the \`to.${o}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function getPathContributingMatches(i){return i.filter((r,o)=>o===0||r.route.path&&r.route.path.length>0)}function getResolveToMatches(i){let r=getPathContributingMatches(i);return r.map((o,u)=>u===r.length-1?o.pathname:o.pathnameBase)}function resolveTo(i,r,o,u=!1){let h;typeof i=="string"?h=parsePath(i):(h={...i},invariant(!h.pathname||!h.pathname.includes("?"),getInvalidPathError("?","pathname","search",h)),invariant(!h.pathname||!h.pathname.includes("#"),getInvalidPathError("#","pathname","hash",h)),invariant(!h.search||!h.search.includes("#"),getInvalidPathError("#","search","hash",h)));let E=i===""||h.pathname==="",v=E?"/":h.pathname,O;if(v==null)O=o;else{let K=r.length-1;if(!u&&v.startsWith("..")){let $=v.split("/");for(;$[0]==="..";)$.shift(),K-=1;h.pathname=$.join("/")}O=K>=0?r[K]:"/"}let C=resolvePath(h,O),k=v&&v!=="/"&&v.endsWith("/"),j=(E||v===".")&&o.endsWith("/");return!C.pathname.endsWith("/")&&(k||j)&&(C.pathname+="/"),C}var joinPaths=i=>i.join("/").replace(/\/\/+/g,"/"),normalizePathname=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,normalizeHash=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function isRouteErrorResponse(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var validMutationMethodsArr=["POST","PUT","PATCH","DELETE"];new Set(validMutationMethodsArr);var validRequestMethodsArr=["GET",...validMutationMethodsArr];new Set(validRequestMethodsArr);var DataRouterContext=reactExports.createContext(null);DataRouterContext.displayName="DataRouter";var DataRouterStateContext=reactExports.createContext(null);DataRouterStateContext.displayName="DataRouterState";var ViewTransitionContext=reactExports.createContext({isTransitioning:!1});ViewTransitionContext.displayName="ViewTransition";var FetchersContext=reactExports.createContext(new Map);FetchersContext.displayName="Fetchers";var AwaitContext=reactExports.createContext(null);AwaitContext.displayName="Await";var NavigationContext=reactExports.createContext(null);NavigationContext.displayName="Navigation";var LocationContext=reactExports.createContext(null);LocationContext.displayName="Location";var RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1});RouteContext.displayName="Route";var RouteErrorContext=reactExports.createContext(null);RouteErrorContext.displayName="RouteError";function useHref(i,{relative:r}={}){invariant(useInRouterContext(),"useHref() may be used only in the context of a <Router> component.");let{basename:o,navigator:u}=reactExports.useContext(NavigationContext),{hash:h,pathname:E,search:v}=useResolvedPath(i,{relative:r}),O=E;return o!=="/"&&(O=E==="/"?o:joinPaths([o,E])),u.createHref({pathname:O,search:v,hash:h})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return invariant(useInRouterContext(),"useLocation() may be used only in the context of a <Router> component."),reactExports.useContext(LocationContext).location}var navigateEffectWarning="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function useIsomorphicLayoutEffect(i){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(i)}function useNavigate(){let{isDataRoute:i}=reactExports.useContext(RouteContext);return i?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){invariant(useInRouterContext(),"useNavigate() may be used only in the context of a <Router> component.");let i=reactExports.useContext(DataRouterContext),{basename:r,navigator:o}=reactExports.useContext(NavigationContext),{matches:u}=reactExports.useContext(RouteContext),{pathname:h}=useLocation(),E=JSON.stringify(getResolveToMatches(u)),v=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{v.current=!0}),reactExports.useCallback((C,k={})=>{if(warning(v.current,navigateEffectWarning),!v.current)return;if(typeof C=="number"){o.go(C);return}let j=resolveTo(C,JSON.parse(E),h,k.relative==="path");i==null&&r!=="/"&&(j.pathname=j.pathname==="/"?r:joinPaths([r,j.pathname])),(k.replace?o.replace:o.push)(j,k.state,k)},[r,o,E,h,i])}reactExports.createContext(null);function useResolvedPath(i,{relative:r}={}){let{matches:o}=reactExports.useContext(RouteContext),{pathname:u}=useLocation(),h=JSON.stringify(getResolveToMatches(o));return reactExports.useMemo(()=>resolveTo(i,JSON.parse(h),u,r==="path"),[i,h,u,r])}function useRoutes(i,r){return useRoutesImpl(i,r)}function useRoutesImpl(i,r,o,u){var _h;invariant(useInRouterContext(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:h,static:E}=reactExports.useContext(NavigationContext),{matches:v}=reactExports.useContext(RouteContext),O=v[v.length-1],C=O?O.params:{},k=O?O.pathname:"/",j=O?O.pathnameBase:"/",K=O&&O.route;{let _f=K&&K.path||"";warningOnce(k,!K||_f.endsWith("*")||_f.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${k}" (under <Route path="${_f}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_f}"> to <Route path="${_f==="/"?"*":`${_f}/*`}">.`)}let $=useLocation(),_e;if(r){let _f=typeof r=="string"?parsePath(r):r;invariant(j==="/"||((_h=_f.pathname)==null?void 0:_h.startsWith(j)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${j}" but pathname "${_f.pathname}" was given in the \`location\` prop.`),_e=_f}else _e=$;let na=_e.pathname||"/",_c=na;if(j!=="/"){let _f=j.replace(/^\//,"").split("/");_c="/"+na.replace(/^\//,"").split("/").slice(_f.length).join("/")}let _a=!E&&o&&o.matches&&o.matches.length>0?o.matches:matchRoutes(i,{pathname:_c});warning(K||_a!=null,`No routes matched location "${_e.pathname}${_e.search}${_e.hash}" `),warning(_a==null||_a[_a.length-1].route.element!==void 0||_a[_a.length-1].route.Component!==void 0||_a[_a.length-1].route.lazy!==void 0,`Matched leaf route at location "${_e.pathname}${_e.search}${_e.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _s=_renderMatches(_a&&_a.map(_f=>Object.assign({},_f,{params:Object.assign({},C,_f.params),pathname:joinPaths([j,h.encodeLocation?h.encodeLocation(_f.pathname).pathname:_f.pathname]),pathnameBase:_f.pathnameBase==="/"?j:joinPaths([j,h.encodeLocation?h.encodeLocation(_f.pathnameBase).pathname:_f.pathnameBase])})),v,o,u);return r&&_s?reactExports.createElement(LocationContext.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._e},navigationType:"POP"}},_s):_s}function DefaultErrorComponent(){let i=useRouteError(),r=isRouteErrorResponse(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),o=i instanceof Error?i.stack:null,u="rgba(200,200,200, 0.5)",h={padding:"0.5rem",backgroundColor:u},E={padding:"2px 4px",backgroundColor:u},v=null;return console.error("Error handled by React Router default ErrorBoundary:",i),v=reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("p",null,"💿 Hey developer 👋"),reactExports.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",reactExports.createElement("code",{style:E},"ErrorBoundary")," or"," ",reactExports.createElement("code",{style:E},"errorElement")," prop on your route.")),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},r),o?reactExports.createElement("pre",{style:h},o):null,v)}var defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null),RenderErrorBoundary=class extends reactExports.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,r){return r.location!==i.location||r.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:r.error,location:r.location,revalidation:i.revalidation||r.revalidation}}componentDidCatch(i,r){console.error("React Router caught the following error during render",i,r)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function RenderedRoute({routeContext:i,match:r,children:o}){let u=reactExports.useContext(DataRouterContext);return u&&u.static&&u.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=r.route.id),reactExports.createElement(RouteContext.Provider,{value:i},o)}function _renderMatches(i,r=[],o=null,u=null){if(i==null){if(!o)return null;if(o.errors)i=o.matches;else if(r.length===0&&!o.initialized&&o.matches.length>0)i=o.matches;else return null}let h=i,E=o==null?void 0:o.errors;if(E!=null){let C=h.findIndex(k=>k.route.id&&(E==null?void 0:E[k.route.id])!==void 0);invariant(C>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(E).join(",")}`),h=h.slice(0,Math.min(h.length,C+1))}let v=!1,O=-1;if(o)for(let C=0;C<h.length;C++){let k=h[C];if((k.route.HydrateFallback||k.route.hydrateFallbackElement)&&(O=C),k.route.id){let{loaderData:j,errors:K}=o,$=k.route.loader&&!j.hasOwnProperty(k.route.id)&&(!K||K[k.route.id]===void 0);if(k.route.lazy||$){v=!0,O>=0?h=h.slice(0,O+1):h=[h[0]];break}}}return h.reduceRight((C,k,j)=>{let K,$=!1,_e=null,na=null;o&&(K=E&&k.route.id?E[k.route.id]:void 0,_e=k.route.errorElement||defaultErrorElement,v&&(O<0&&j===0?(warningOnce("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),$=!0,na=null):O===j&&($=!0,na=k.route.hydrateFallbackElement||null)));let _c=r.concat(h.slice(0,j+1)),_a=()=>{let _s;return K?_s=_e:$?_s=na:k.route.Component?_s=reactExports.createElement(k.route.Component,null):k.route.element?_s=k.route.element:_s=C,reactExports.createElement(RenderedRoute,{match:k,routeContext:{outlet:C,matches:_c,isDataRoute:o!=null},children:_s})};return o&&(k.route.ErrorBoundary||k.route.errorElement||j===0)?reactExports.createElement(RenderErrorBoundary,{location:o.location,revalidation:o.revalidation,component:_e,error:K,children:_a(),routeContext:{outlet:null,matches:_c,isDataRoute:!0}}):_a()},null)}function getDataRouterConsoleError(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext(i){let r=reactExports.useContext(DataRouterContext);return invariant(r,getDataRouterConsoleError(i)),r}function useDataRouterState(i){let r=reactExports.useContext(DataRouterStateContext);return invariant(r,getDataRouterConsoleError(i)),r}function useRouteContext(i){let r=reactExports.useContext(RouteContext);return invariant(r,getDataRouterConsoleError(i)),r}function useCurrentRouteId(i){let r=useRouteContext(i),o=r.matches[r.matches.length-1];return invariant(o.route.id,`${i} can only be used on routes that contain a unique "id"`),o.route.id}function useRouteId(){return useCurrentRouteId("useRouteId")}function useRouteError(){var u;let i=reactExports.useContext(RouteErrorContext),r=useDataRouterState("useRouteError"),o=useCurrentRouteId("useRouteError");return i!==void 0?i:(u=r.errors)==null?void 0:u[o]}function useNavigateStable(){let{router:i}=useDataRouterContext("useNavigate"),r=useCurrentRouteId("useNavigate"),o=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{o.current=!0}),reactExports.useCallback(async(h,E={})=>{warning(o.current,navigateEffectWarning),o.current&&(typeof h=="number"?i.navigate(h):await i.navigate(h,{fromRouteId:r,...E}))},[i,r])}var alreadyWarned={};function warningOnce(i,r,o){!r&&!alreadyWarned[i]&&(alreadyWarned[i]=!0,warning(!1,o))}reactExports.memo(DataRoutes);function DataRoutes({routes:i,future:r,state:o}){return useRoutesImpl(i,void 0,o,r)}function Route(i){invariant(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Router({basename:i="/",children:r=null,location:o,navigationType:u="POP",navigator:h,static:E=!1}){invariant(!useInRouterContext(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let v=i.replace(/^\/*/,"/"),O=reactExports.useMemo(()=>({basename:v,navigator:h,static:E,future:{}}),[v,h,E]);typeof o=="string"&&(o=parsePath(o));let{pathname:C="/",search:k="",hash:j="",state:K=null,key:$="default"}=o,_e=reactExports.useMemo(()=>{let na=stripBasename(C,v);return na==null?null:{location:{pathname:na,search:k,hash:j,state:K,key:$},navigationType:u}},[v,C,k,j,K,$,u]);return warning(_e!=null,`<Router basename="${v}"> is not able to match the URL "${C}${k}${j}" because it does not start with the basename, so the <Router> won't render anything.`),_e==null?null:reactExports.createElement(NavigationContext.Provider,{value:O},reactExports.createElement(LocationContext.Provider,{children:r,value:_e}))}function Routes({children:i,location:r}){return useRoutes(createRoutesFromChildren(i),r)}function createRoutesFromChildren(i,r=[]){let o=[];return reactExports.Children.forEach(i,(u,h)=>{if(!reactExports.isValidElement(u))return;let E=[...r,h];if(u.type===reactExports.Fragment){o.push.apply(o,createRoutesFromChildren(u.props.children,E));return}invariant(u.type===Route,`[${typeof u.type=="string"?u.type:u.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),invariant(!u.props.index||!u.props.children,"An index route cannot have child routes.");let v={id:u.props.id||E.join("-"),caseSensitive:u.props.caseSensitive,element:u.props.element,Component:u.props.Component,index:u.props.index,path:u.props.path,loader:u.props.loader,action:u.props.action,hydrateFallbackElement:u.props.hydrateFallbackElement,HydrateFallback:u.props.HydrateFallback,errorElement:u.props.errorElement,ErrorBoundary:u.props.ErrorBoundary,hasErrorBoundary:u.props.hasErrorBoundary===!0||u.props.ErrorBoundary!=null||u.props.errorElement!=null,shouldRevalidate:u.props.shouldRevalidate,handle:u.props.handle,lazy:u.props.lazy};u.props.children&&(v.children=createRoutesFromChildren(u.props.children,E)),o.push(v)}),o}var defaultMethod="get",defaultEncType="application/x-www-form-urlencoded";function isHtmlElement(i){return i!=null&&typeof i.tagName=="string"}function isButtonElement(i){return isHtmlElement(i)&&i.tagName.toLowerCase()==="button"}function isFormElement(i){return isHtmlElement(i)&&i.tagName.toLowerCase()==="form"}function isInputElement(i){return isHtmlElement(i)&&i.tagName.toLowerCase()==="input"}function isModifiedEvent(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function shouldProcessLinkClick(i,r){return i.button===0&&(!r||r==="_self")&&!isModifiedEvent(i)}var _formDataSupportsSubmitter=null;function isFormDataSubmitterSupported(){if(_formDataSupportsSubmitter===null)try{new FormData(document.createElement("form"),0),_formDataSupportsSubmitter=!1}catch{_formDataSupportsSubmitter=!0}return _formDataSupportsSubmitter}var supportedFormEncTypes=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function getFormEncType(i){return i!=null&&!supportedFormEncTypes.has(i)?(warning(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${defaultEncType}"`),null):i}function getFormSubmissionInfo(i,r){let o,u,h,E,v;if(isFormElement(i)){let O=i.getAttribute("action");u=O?stripBasename(O,r):null,o=i.getAttribute("method")||defaultMethod,h=getFormEncType(i.getAttribute("enctype"))||defaultEncType,E=new FormData(i)}else if(isButtonElement(i)||isInputElement(i)&&(i.type==="submit"||i.type==="image")){let O=i.form;if(O==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let C=i.getAttribute("formaction")||O.getAttribute("action");if(u=C?stripBasename(C,r):null,o=i.getAttribute("formmethod")||O.getAttribute("method")||defaultMethod,h=getFormEncType(i.getAttribute("formenctype"))||getFormEncType(O.getAttribute("enctype"))||defaultEncType,E=new FormData(O,i),!isFormDataSubmitterSupported()){let{name:k,type:j,value:K}=i;if(j==="image"){let $=k?`${k}.`:"";E.append(`${$}x`,"0"),E.append(`${$}y`,"0")}else k&&E.append(k,K)}}else{if(isHtmlElement(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');o=defaultMethod,u=null,h=defaultEncType,v=i}return E&&h==="text/plain"&&(v=E,E=void 0),{action:u,method:o.toLowerCase(),encType:h,formData:E,body:v}}function invariant2(i,r){if(i===!1||i===null||typeof i>"u")throw new Error(r)}async function loadRouteModule(i,r){if(i.id in r)return r[i.id];try{let o=await import(i.module);return r[i.id]=o,o}catch(o){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(o),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function isHtmlLinkDescriptor(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function getKeyedPrefetchLinks(i,r,o){let u=await Promise.all(i.map(async h=>{let E=r.routes[h.route.id];if(E){let v=await loadRouteModule(E,o);return v.links?v.links():[]}return[]}));return dedupeLinkDescriptors(u.flat(1).filter(isHtmlLinkDescriptor).filter(h=>h.rel==="stylesheet"||h.rel==="preload").map(h=>h.rel==="stylesheet"?{...h,rel:"prefetch",as:"style"}:{...h,rel:"prefetch"}))}function getNewMatchesForLinks(i,r,o,u,h,E){let v=(C,k)=>o[k]?C.route.id!==o[k].route.id:!0,O=(C,k)=>{var j;return o[k].pathname!==C.pathname||((j=o[k].route.path)==null?void 0:j.endsWith("*"))&&o[k].params["*"]!==C.params["*"]};return E==="assets"?r.filter((C,k)=>v(C,k)||O(C,k)):E==="data"?r.filter((C,k)=>{var K;let j=u.routes[C.route.id];if(!j||!j.hasLoader)return!1;if(v(C,k)||O(C,k))return!0;if(C.route.shouldRevalidate){let $=C.route.shouldRevalidate({currentUrl:new URL(h.pathname+h.search+h.hash,window.origin),currentParams:((K=o[0])==null?void 0:K.params)||{},nextUrl:new URL(i,window.origin),nextParams:C.params,defaultShouldRevalidate:!0});if(typeof $=="boolean")return $}return!0}):[]}function getModuleLinkHrefs(i,r,{includeHydrateFallback:o}={}){return dedupeHrefs(i.map(u=>{let h=r.routes[u.route.id];if(!h)return[];let E=[h.module];return h.clientActionModule&&(E=E.concat(h.clientActionModule)),h.clientLoaderModule&&(E=E.concat(h.clientLoaderModule)),o&&h.hydrateFallbackModule&&(E=E.concat(h.hydrateFallbackModule)),h.imports&&(E=E.concat(h.imports)),E}).flat(1))}function dedupeHrefs(i){return[...new Set(i)]}function sortKeys(i){let r={},o=Object.keys(i).sort();for(let u of o)r[u]=i[u];return r}function dedupeLinkDescriptors(i,r){let o=new Set;return new Set(r),i.reduce((u,h)=>{let E=JSON.stringify(sortKeys(h));return o.has(E)||(o.add(E),u.push({key:E,link:h})),u},[])}var NO_BODY_STATUS_CODES=new Set([100,101,204,205]);function singleFetchUrl(i,r){let o=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return o.pathname==="/"?o.pathname="_root.data":r&&stripBasename(o.pathname,r)==="/"?o.pathname=`${r.replace(/\/$/,"")}/_root.data`:o.pathname=`${o.pathname.replace(/\/$/,"")}.data`,o}function useDataRouterContext2(){let i=reactExports.useContext(DataRouterContext);return invariant2(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function useDataRouterStateContext(){let i=reactExports.useContext(DataRouterStateContext);return invariant2(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var FrameworkContext=reactExports.createContext(void 0);FrameworkContext.displayName="FrameworkContext";function useFrameworkContext(){let i=reactExports.useContext(FrameworkContext);return invariant2(i,"You must render this element inside a <HydratedRouter> element"),i}function usePrefetchBehavior(i,r){let o=reactExports.useContext(FrameworkContext),[u,h]=reactExports.useState(!1),[E,v]=reactExports.useState(!1),{onFocus:O,onBlur:C,onMouseEnter:k,onMouseLeave:j,onTouchStart:K}=r,$=reactExports.useRef(null);reactExports.useEffect(()=>{if(i==="render"&&v(!0),i==="viewport"){let _c=_s=>{_s.forEach(_h=>{v(_h.isIntersecting)})},_a=new IntersectionObserver(_c,{threshold:.5});return $.current&&_a.observe($.current),()=>{_a.disconnect()}}},[i]),reactExports.useEffect(()=>{if(u){let _c=setTimeout(()=>{v(!0)},100);return()=>{clearTimeout(_c)}}},[u]);let _e=()=>{h(!0)},na=()=>{h(!1),v(!1)};return o?i!=="intent"?[E,$,{}]:[E,$,{onFocus:composeEventHandlers(O,_e),onBlur:composeEventHandlers(C,na),onMouseEnter:composeEventHandlers(k,_e),onMouseLeave:composeEventHandlers(j,na),onTouchStart:composeEventHandlers(K,_e)}]:[!1,$,{}]}function composeEventHandlers(i,r){return o=>{i&&i(o),o.defaultPrevented||r(o)}}function PrefetchPageLinks({page:i,...r}){let{router:o}=useDataRouterContext2(),u=reactExports.useMemo(()=>matchRoutes(o.routes,i,o.basename),[o.routes,i,o.basename]);return u?reactExports.createElement(PrefetchPageLinksImpl,{page:i,matches:u,...r}):null}function useKeyedPrefetchLinks(i){let{manifest:r,routeModules:o}=useFrameworkContext(),[u,h]=reactExports.useState([]);return reactExports.useEffect(()=>{let E=!1;return getKeyedPrefetchLinks(i,r,o).then(v=>{E||h(v)}),()=>{E=!0}},[i,r,o]),u}function PrefetchPageLinksImpl({page:i,matches:r,...o}){let u=useLocation(),{manifest:h,routeModules:E}=useFrameworkContext(),{basename:v}=useDataRouterContext2(),{loaderData:O,matches:C}=useDataRouterStateContext(),k=reactExports.useMemo(()=>getNewMatchesForLinks(i,r,C,h,u,"data"),[i,r,C,h,u]),j=reactExports.useMemo(()=>getNewMatchesForLinks(i,r,C,h,u,"assets"),[i,r,C,h,u]),K=reactExports.useMemo(()=>{if(i===u.pathname+u.search+u.hash)return[];let na=new Set,_c=!1;if(r.forEach(_s=>{var _f;let _h=h.routes[_s.route.id];!_h||!_h.hasLoader||(!k.some(E_=>E_.route.id===_s.route.id)&&_s.route.id in O&&((_f=E[_s.route.id])!=null&&_f.shouldRevalidate)||_h.hasClientLoader?_c=!0:na.add(_s.route.id))}),na.size===0)return[];let _a=singleFetchUrl(i,v);return _c&&na.size>0&&_a.searchParams.set("_routes",r.filter(_s=>na.has(_s.route.id)).map(_s=>_s.route.id).join(",")),[_a.pathname+_a.search]},[v,O,u,h,k,r,i,E]),$=reactExports.useMemo(()=>getModuleLinkHrefs(j,h),[j,h]),_e=useKeyedPrefetchLinks(j);return reactExports.createElement(reactExports.Fragment,null,K.map(na=>reactExports.createElement("link",{key:na,rel:"prefetch",as:"fetch",href:na,...o})),$.map(na=>reactExports.createElement("link",{key:na,rel:"modulepreload",href:na,...o})),_e.map(({key:na,link:_c})=>reactExports.createElement("link",{key:na,..._c})))}function mergeRefs(...i){return r=>{i.forEach(o=>{typeof o=="function"?o(r):o!=null&&(o.current=r)})}}var isBrowser=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{isBrowser&&(window.__reactRouterVersion="7.5.2")}catch{}function BrowserRouter({basename:i,children:r,window:o}){let u=reactExports.useRef();u.current==null&&(u.current=createBrowserHistory({window:o,v5Compat:!0}));let h=u.current,[E,v]=reactExports.useState({action:h.action,location:h.location}),O=reactExports.useCallback(C=>{reactExports.startTransition(()=>v(C))},[v]);return reactExports.useLayoutEffect(()=>h.listen(O),[h,O]),reactExports.createElement(Router,{basename:i,children:r,location:E.location,navigationType:E.action,navigator:h})}var ABSOLUTE_URL_REGEX2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function({onClick:r,discover:o="render",prefetch:u="none",relative:h,reloadDocument:E,replace:v,state:O,target:C,to:k,preventScrollReset:j,viewTransition:K,...$},_e){let{basename:na}=reactExports.useContext(NavigationContext),_c=typeof k=="string"&&ABSOLUTE_URL_REGEX2.test(k),_a,_s=!1;if(typeof k=="string"&&_c&&(_a=k,isBrowser))try{let _S=new URL(window.location.href),o_=k.startsWith("//")?new URL(_S.protocol+k):new URL(k),b_=stripBasename(o_.pathname,na);o_.origin===_S.origin&&b_!=null?k=b_+o_.search+o_.hash:_s=!0}catch{warning(!1,`<Link to="${k}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let _h=useHref(k,{relative:h}),[_f,E_,y_]=usePrefetchBehavior(u,$),F_=useLinkClickHandler(k,{replace:v,state:O,target:C,preventScrollReset:j,relative:h,viewTransition:K});function w_(_S){r&&r(_S),_S.defaultPrevented||F_(_S)}let W_=reactExports.createElement("a",{...$,...y_,href:_a||_h,onClick:_s||E?r:w_,ref:mergeRefs(_e,E_),target:C,"data-discover":!_c&&o==="render"?"true":void 0});return _f&&!_c?reactExports.createElement(reactExports.Fragment,null,W_,reactExports.createElement(PrefetchPageLinks,{page:_h})):W_});Link.displayName="Link";var NavLink=reactExports.forwardRef(function({"aria-current":r="page",caseSensitive:o=!1,className:u="",end:h=!1,style:E,to:v,viewTransition:O,children:C,...k},j){let K=useResolvedPath(v,{relative:k.relative}),$=useLocation(),_e=reactExports.useContext(DataRouterStateContext),{navigator:na,basename:_c}=reactExports.useContext(NavigationContext),_a=_e!=null&&useViewTransitionState(K)&&O===!0,_s=na.encodeLocation?na.encodeLocation(K).pathname:K.pathname,_h=$.pathname,_f=_e&&_e.navigation&&_e.navigation.location?_e.navigation.location.pathname:null;o||(_h=_h.toLowerCase(),_f=_f?_f.toLowerCase():null,_s=_s.toLowerCase()),_f&&_c&&(_f=stripBasename(_f,_c)||_f);const E_=_s!=="/"&&_s.endsWith("/")?_s.length-1:_s.length;let y_=_h===_s||!h&&_h.startsWith(_s)&&_h.charAt(E_)==="/",F_=_f!=null&&(_f===_s||!h&&_f.startsWith(_s)&&_f.charAt(_s.length)==="/"),w_={isActive:y_,isPending:F_,isTransitioning:_a},W_=y_?r:void 0,_S;typeof u=="function"?_S=u(w_):_S=[u,y_?"active":null,F_?"pending":null,_a?"transitioning":null].filter(Boolean).join(" ");let o_=typeof E=="function"?E(w_):E;return reactExports.createElement(Link,{...k,"aria-current":W_,className:_S,ref:j,style:o_,to:v,viewTransition:O},typeof C=="function"?C(w_):C)});NavLink.displayName="NavLink";var Form=reactExports.forwardRef(({discover:i="render",fetcherKey:r,navigate:o,reloadDocument:u,replace:h,state:E,method:v=defaultMethod,action:O,onSubmit:C,relative:k,preventScrollReset:j,viewTransition:K,...$},_e)=>{let na=useSubmit(),_c=useFormAction(O,{relative:k}),_a=v.toLowerCase()==="get"?"get":"post",_s=typeof O=="string"&&ABSOLUTE_URL_REGEX2.test(O),_h=_f=>{if(C&&C(_f),_f.defaultPrevented)return;_f.preventDefault();let E_=_f.nativeEvent.submitter,y_=(E_==null?void 0:E_.getAttribute("formmethod"))||v;na(E_||_f.currentTarget,{fetcherKey:r,method:y_,navigate:o,replace:h,state:E,relative:k,preventScrollReset:j,viewTransition:K})};return reactExports.createElement("form",{ref:_e,method:_a,action:_c,onSubmit:u?C:_h,...$,"data-discover":!_s&&i==="render"?"true":void 0})});Form.displayName="Form";function getDataRouterConsoleError2(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext3(i){let r=reactExports.useContext(DataRouterContext);return invariant(r,getDataRouterConsoleError2(i)),r}function useLinkClickHandler(i,{target:r,replace:o,state:u,preventScrollReset:h,relative:E,viewTransition:v}={}){let O=useNavigate(),C=useLocation(),k=useResolvedPath(i,{relative:E});return reactExports.useCallback(j=>{if(shouldProcessLinkClick(j,r)){j.preventDefault();let K=o!==void 0?o:createPath(C)===createPath(k);O(i,{replace:K,state:u,preventScrollReset:h,relative:E,viewTransition:v})}},[C,O,k,o,u,r,i,h,E,v])}var fetcherId=0,getUniqueFetcherId=()=>`__${String(++fetcherId)}__`;function useSubmit(){let{router:i}=useDataRouterContext3("useSubmit"),{basename:r}=reactExports.useContext(NavigationContext),o=useRouteId();return reactExports.useCallback(async(u,h={})=>{let{action:E,method:v,encType:O,formData:C,body:k}=getFormSubmissionInfo(u,r);if(h.navigate===!1){let j=h.fetcherKey||getUniqueFetcherId();await i.fetch(j,o,h.action||E,{preventScrollReset:h.preventScrollReset,formData:C,body:k,formMethod:h.method||v,formEncType:h.encType||O,flushSync:h.flushSync})}else await i.navigate(h.action||E,{preventScrollReset:h.preventScrollReset,formData:C,body:k,formMethod:h.method||v,formEncType:h.encType||O,replace:h.replace,state:h.state,fromRouteId:o,flushSync:h.flushSync,viewTransition:h.viewTransition})},[i,r,o])}function useFormAction(i,{relative:r}={}){let{basename:o}=reactExports.useContext(NavigationContext),u=reactExports.useContext(RouteContext);invariant(u,"useFormAction must be used inside a RouteContext");let[h]=u.matches.slice(-1),E={...useResolvedPath(i||".",{relative:r})},v=useLocation();if(i==null){E.search=v.search;let O=new URLSearchParams(E.search),C=O.getAll("index");if(C.some(j=>j==="")){O.delete("index"),C.filter(K=>K).forEach(K=>O.append("index",K));let j=O.toString();E.search=j?`?${j}`:""}}return(!i||i===".")&&h.route.index&&(E.search=E.search?E.search.replace(/^\?/,"?index&"):"?index"),o!=="/"&&(E.pathname=E.pathname==="/"?o:joinPaths([o,E.pathname])),createPath(E)}function useViewTransitionState(i,r={}){let o=reactExports.useContext(ViewTransitionContext);invariant(o!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:u}=useDataRouterContext3("useViewTransitionState"),h=useResolvedPath(i,{relative:r.relative});if(!o.isTransitioning)return!1;let E=stripBasename(o.currentLocation.pathname,u)||o.currentLocation.pathname,v=stripBasename(o.nextLocation.pathname,u)||o.nextLocation.pathname;return matchPath(h.pathname,v)!=null||matchPath(h.pathname,E)!=null}new TextEncoder;[...NO_BODY_STATUS_CODES];var reactDom={exports:{}},reactDom_production={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var i=requireReact();function r(C){var k="https://react.dev/errors/"+C;if(1<arguments.length){k+="?args[]="+encodeURIComponent(arguments[1]);for(var j=2;j<arguments.length;j++)k+="&args[]="+encodeURIComponent(arguments[j])}return"Minified React error #"+C+"; visit "+k+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var u={d:{f:o,r:function(){throw Error(r(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},h=Symbol.for("react.portal");function E(C,k,j){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:h,key:K==null?null:""+K,children:C,containerInfo:k,implementation:j}}var v=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function O(C,k){if(C==="font")return"";if(typeof k=="string")return k==="use-credentials"?k:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=u,reactDom_production.createPortal=function(C,k){var j=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!k||k.nodeType!==1&&k.nodeType!==9&&k.nodeType!==11)throw Error(r(299));return E(C,k,null,j)},reactDom_production.flushSync=function(C){var k=v.T,j=u.p;try{if(v.T=null,u.p=2,C)return C()}finally{v.T=k,u.p=j,u.d.f()}},reactDom_production.preconnect=function(C,k){typeof C=="string"&&(k?(k=k.crossOrigin,k=typeof k=="string"?k==="use-credentials"?k:"":void 0):k=null,u.d.C(C,k))},reactDom_production.prefetchDNS=function(C){typeof C=="string"&&u.d.D(C)},reactDom_production.preinit=function(C,k){if(typeof C=="string"&&k&&typeof k.as=="string"){var j=k.as,K=O(j,k.crossOrigin),$=typeof k.integrity=="string"?k.integrity:void 0,_e=typeof k.fetchPriority=="string"?k.fetchPriority:void 0;j==="style"?u.d.S(C,typeof k.precedence=="string"?k.precedence:void 0,{crossOrigin:K,integrity:$,fetchPriority:_e}):j==="script"&&u.d.X(C,{crossOrigin:K,integrity:$,fetchPriority:_e,nonce:typeof k.nonce=="string"?k.nonce:void 0})}},reactDom_production.preinitModule=function(C,k){if(typeof C=="string")if(typeof k=="object"&&k!==null){if(k.as==null||k.as==="script"){var j=O(k.as,k.crossOrigin);u.d.M(C,{crossOrigin:j,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0})}}else k==null&&u.d.M(C)},reactDom_production.preload=function(C,k){if(typeof C=="string"&&typeof k=="object"&&k!==null&&typeof k.as=="string"){var j=k.as,K=O(j,k.crossOrigin);u.d.L(C,j,{crossOrigin:K,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0,type:typeof k.type=="string"?k.type:void 0,fetchPriority:typeof k.fetchPriority=="string"?k.fetchPriority:void 0,referrerPolicy:typeof k.referrerPolicy=="string"?k.referrerPolicy:void 0,imageSrcSet:typeof k.imageSrcSet=="string"?k.imageSrcSet:void 0,imageSizes:typeof k.imageSizes=="string"?k.imageSizes:void 0,media:typeof k.media=="string"?k.media:void 0})}},reactDom_production.preloadModule=function(C,k){if(typeof C=="string")if(k){var j=O(k.as,k.crossOrigin);u.d.m(C,{as:typeof k.as=="string"&&k.as!=="script"?k.as:void 0,crossOrigin:j,integrity:typeof k.integrity=="string"?k.integrity:void 0})}else u.d.m(C)},reactDom_production.requestFormReset=function(C){u.d.r(C)},reactDom_production.unstable_batchedUpdates=function(C,k){return C(k)},reactDom_production.useFormState=function(C,k,j){return v.H.useFormState(C,k,j)},reactDom_production.useFormStatus=function(){return v.H.useHostTransitionStatus()},reactDom_production.version="19.1.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(r){console.error(r)}}return i(),reactDom.exports=requireReactDom_production(),reactDom.exports}var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,function(i){function r(_p,c_){var v_=_p.length;_p.push(c_);t:for(;0<v_;){var q_=v_-1>>>1,_u=_p[q_];if(0<h(_u,c_))_p[q_]=c_,_p[v_]=_u,v_=q_;else break t}}function o(_p){return _p.length===0?null:_p[0]}function u(_p){if(_p.length===0)return null;var c_=_p[0],v_=_p.pop();if(v_!==c_){_p[0]=v_;t:for(var q_=0,_u=_p.length,S_=_u>>>1;q_<S_;){var P_=2*(q_+1)-1,G_=_p[P_],lb=P_+1,kS=_p[lb];if(0>h(G_,v_))lb<_u&&0>h(kS,G_)?(_p[q_]=kS,_p[lb]=v_,q_=lb):(_p[q_]=G_,_p[P_]=v_,q_=P_);else if(lb<_u&&0>h(kS,v_))_p[q_]=kS,_p[lb]=v_,q_=lb;else break t}}return c_}function h(_p,c_){var v_=_p.sortIndex-c_.sortIndex;return v_!==0?v_:_p.id-c_.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var E=performance;i.unstable_now=function(){return E.now()}}else{var v=Date,O=v.now();i.unstable_now=function(){return v.now()-O}}var C=[],k=[],j=1,K=null,$=3,_e=!1,na=!1,_c=!1,_a=!1,_s=typeof setTimeout=="function"?setTimeout:null,_h=typeof clearTimeout=="function"?clearTimeout:null,_f=typeof setImmediate<"u"?setImmediate:null;function E_(_p){for(var c_=o(k);c_!==null;){if(c_.callback===null)u(k);else if(c_.startTime<=_p)u(k),c_.sortIndex=c_.expirationTime,r(C,c_);else break;c_=o(k)}}function y_(_p){if(_c=!1,E_(_p),!na)if(o(C)!==null)na=!0,F_||(F_=!0,h_());else{var c_=o(k);c_!==null&&r_(y_,c_.startTime-_p)}}var F_=!1,w_=-1,W_=5,_S=-1;function o_(){return _a?!0:!(i.unstable_now()-_S<W_)}function b_(){if(_a=!1,F_){var _p=i.unstable_now();_S=_p;var c_=!0;try{t:{na=!1,_c&&(_c=!1,_h(w_),w_=-1),_e=!0;var v_=$;try{e:{for(E_(_p),K=o(C);K!==null&&!(K.expirationTime>_p&&o_());){var q_=K.callback;if(typeof q_=="function"){K.callback=null,$=K.priorityLevel;var _u=q_(K.expirationTime<=_p);if(_p=i.unstable_now(),typeof _u=="function"){K.callback=_u,E_(_p),c_=!0;break e}K===o(C)&&u(C),E_(_p)}else u(C);K=o(C)}if(K!==null)c_=!0;else{var S_=o(k);S_!==null&&r_(y_,S_.startTime-_p),c_=!1}}break t}finally{K=null,$=v_,_e=!1}c_=void 0}}finally{c_?h_():F_=!1}}}var h_;if(typeof _f=="function")h_=function(){_f(b_)};else if(typeof MessageChannel<"u"){var B_=new MessageChannel,e_=B_.port2;B_.port1.onmessage=b_,h_=function(){e_.postMessage(null)}}else h_=function(){_s(b_,0)};function r_(_p,c_){w_=_s(function(){_p(i.unstable_now())},c_)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(_p){_p.callback=null},i.unstable_forceFrameRate=function(_p){0>_p||125<_p?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W_=0<_p?Math.floor(1e3/_p):5},i.unstable_getCurrentPriorityLevel=function(){return $},i.unstable_next=function(_p){switch($){case 1:case 2:case 3:var c_=3;break;default:c_=$}var v_=$;$=c_;try{return _p()}finally{$=v_}},i.unstable_requestPaint=function(){_a=!0},i.unstable_runWithPriority=function(_p,c_){switch(_p){case 1:case 2:case 3:case 4:case 5:break;default:_p=3}var v_=$;$=_p;try{return c_()}finally{$=v_}},i.unstable_scheduleCallback=function(_p,c_,v_){var q_=i.unstable_now();switch(typeof v_=="object"&&v_!==null?(v_=v_.delay,v_=typeof v_=="number"&&0<v_?q_+v_:q_):v_=q_,_p){case 1:var _u=-1;break;case 2:_u=250;break;case 5:_u=1073741823;break;case 4:_u=1e4;break;default:_u=5e3}return _u=v_+_u,_p={id:j++,callback:c_,priorityLevel:_p,startTime:v_,expirationTime:_u,sortIndex:-1},v_>q_?(_p.sortIndex=v_,r(k,_p),o(C)===null&&_p===o(k)&&(_c?(_h(w_),w_=-1):_c=!0,r_(y_,v_-q_))):(_p.sortIndex=_u,r(C,_p),na||_e||(na=!0,F_||(F_=!0,h_()))),_p},i.unstable_shouldYield=o_,i.unstable_wrapCallback=function(_p){var c_=$;return function(){var v_=$;$=c_;try{return _p.apply(this,arguments)}finally{$=v_}}}}(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var i=requireScheduler(),r=requireReact(),o=requireReactDom();function u(l){var p="https://react.dev/errors/"+l;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)p+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+l+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function h(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function E(l){var p=l,g=l;if(l.alternate)for(;p.return;)p=p.return;else{l=p;do p=l,(p.flags&4098)!==0&&(g=p.return),l=p.return;while(l)}return p.tag===3?g:null}function v(l){if(l.tag===13){var p=l.memoizedState;if(p===null&&(l=l.alternate,l!==null&&(p=l.memoizedState)),p!==null)return p.dehydrated}return null}function O(l){if(E(l)!==l)throw Error(u(188))}function C(l){var p=l.alternate;if(!p){if(p=E(l),p===null)throw Error(u(188));return p!==l?null:l}for(var g=l,A=p;;){var U=g.return;if(U===null)break;var q=U.alternate;if(q===null){if(A=U.return,A!==null){g=A;continue}break}if(U.child===q.child){for(q=U.child;q;){if(q===g)return O(U),l;if(q===A)return O(U),p;q=q.sibling}throw Error(u(188))}if(g.return!==A.return)g=U,A=q;else{for(var _o=!1,ba=U.child;ba;){if(ba===g){_o=!0,g=U,A=q;break}if(ba===A){_o=!0,A=U,g=q;break}ba=ba.sibling}if(!_o){for(ba=q.child;ba;){if(ba===g){_o=!0,g=q,A=U;break}if(ba===A){_o=!0,A=q,g=U;break}ba=ba.sibling}if(!_o)throw Error(u(189))}}if(g.alternate!==A)throw Error(u(190))}if(g.tag!==3)throw Error(u(188));return g.stateNode.current===g?l:p}function k(l){var p=l.tag;if(p===5||p===26||p===27||p===6)return l;for(l=l.child;l!==null;){if(p=k(l),p!==null)return p;l=l.sibling}return null}var j=Object.assign,K=Symbol.for("react.element"),$=Symbol.for("react.transitional.element"),_e=Symbol.for("react.portal"),na=Symbol.for("react.fragment"),_c=Symbol.for("react.strict_mode"),_a=Symbol.for("react.profiler"),_s=Symbol.for("react.provider"),_h=Symbol.for("react.consumer"),_f=Symbol.for("react.context"),E_=Symbol.for("react.forward_ref"),y_=Symbol.for("react.suspense"),F_=Symbol.for("react.suspense_list"),w_=Symbol.for("react.memo"),W_=Symbol.for("react.lazy"),_S=Symbol.for("react.activity"),o_=Symbol.for("react.memo_cache_sentinel"),b_=Symbol.iterator;function h_(l){return l===null||typeof l!="object"?null:(l=b_&&l[b_]||l["@@iterator"],typeof l=="function"?l:null)}var B_=Symbol.for("react.client.reference");function e_(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===B_?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case na:return"Fragment";case _a:return"Profiler";case _c:return"StrictMode";case y_:return"Suspense";case F_:return"SuspenseList";case _S:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case _e:return"Portal";case _f:return(l.displayName||"Context")+".Provider";case _h:return(l._context.displayName||"Context")+".Consumer";case E_:var p=l.render;return l=l.displayName,l||(l=p.displayName||p.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case w_:return p=l.displayName||null,p!==null?p:e_(l.type)||"Memo";case W_:p=l._payload,l=l._init;try{return e_(l(p))}catch{}}return null}var r_=Array.isArray,_p=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,c_=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,v_={pending:!1,data:null,method:null,action:null},q_=[],_u=-1;function S_(l){return{current:l}}function P_(l){0>_u||(l.current=q_[_u],q_[_u]=null,_u--)}function G_(l,p){_u++,q_[_u]=l.current,l.current=p}var lb=S_(null),kS=S_(null),Z_=S_(null),$S=S_(null);function FS(l,p){switch(G_(Z_,p),G_(kS,l),G_(lb,null),p.nodeType){case 9:case 11:l=(l=p.documentElement)&&(l=l.namespaceURI)?D4(l):0;break;default:if(l=p.tagName,p=p.namespaceURI)p=D4(p),l=k4(p,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}P_(lb),G_(lb,l)}function t0(){P_(lb),P_(kS),P_(Z_)}function WO(l){l.memoizedState!==null&&G_($S,l);var p=lb.current,g=k4(p,l.type);p!==g&&(G_(kS,l),G_(lb,g))}function YO(l){kS.current===l&&(P_(lb),P_(kS)),$S.current===l&&(P_($S),bP._currentValue=v_)}var PI=Object.prototype.hasOwnProperty,w3=i.unstable_scheduleCallback,I3=i.unstable_cancelCallback,OL=i.unstable_shouldYield,pK=i.unstable_requestPaint,mO=i.unstable_now,MI=i.unstable_getCurrentPriorityLevel,N3=i.unstable_ImmediatePriority,T6=i.unstable_UserBlockingPriority,SR=i.unstable_NormalPriority,v0=i.unstable_LowPriority,qM=i.unstable_IdlePriority,D3=i.log,fK=i.unstable_setDisableYieldValue,wL=null,vT=null;function FR(l){if(typeof D3=="function"&&fK(l),vT&&typeof vT.setStrictMode=="function")try{vT.setStrictMode(wL,l)}catch{}}var e0=Math.clz32?Math.clz32:A6,k3=Math.log,R6=Math.LN2;function A6(l){return l>>>=0,l===0?32:31-(k3(l)/R6|0)|0}var JP=256,ZP=4194304;function y0(l){var p=l&42;if(p!==0)return p;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function QP(l,p,g){var A=l.pendingLanes;if(A===0)return 0;var U=0,q=l.suspendedLanes,_o=l.pingedLanes;l=l.warmLanes;var ba=A&134217727;return ba!==0?(A=ba&~q,A!==0?U=y0(A):(_o&=ba,_o!==0?U=y0(_o):g||(g=ba&~l,g!==0&&(U=y0(g))))):(ba=A&~q,ba!==0?U=y0(ba):_o!==0?U=y0(_o):g||(g=A&~l,g!==0&&(U=y0(g)))),U===0?0:p!==0&&p!==U&&(p&q)===0&&(q=U&-U,g=p&-p,q>=g||q===32&&(g&4194048)!==0)?p:U}function $P(l,p){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&p)===0}function mK(l,p){switch(l){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xN(){var l=JP;return JP<<=1,(JP&4194048)===0&&(JP=256),l}function L3(){var l=ZP;return ZP<<=1,(ZP&62914560)===0&&(ZP=4194304),l}function P3(l){for(var p=[],g=0;31>g;g++)p.push(l);return p}function t1(l,p){l.pendingLanes|=p,p!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function EK(l,p,g,A,U,q){var _o=l.pendingLanes;l.pendingLanes=g,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=g,l.entangledLanes&=g,l.errorRecoveryDisabledLanes&=g,l.shellSuspendCounter=0;var ba=l.entanglements,wE=l.expirationTimes,p_=l.hiddenUpdates;for(g=_o&~g;0<g;){var R_=31-e0(g),x_=1<<R_;ba[R_]=0,wE[R_]=-1;var m_=p_[R_];if(m_!==null)for(p_[R_]=null,R_=0;R_<m_.length;R_++){var g_=m_[R_];g_!==null&&(g_.lane&=-536870913)}g&=~x_}A!==0&&C6(l,A,0),q!==0&&U===0&&l.tag!==0&&(l.suspendedLanes|=q&~(_o&~p))}function C6(l,p,g){l.pendingLanes|=p,l.suspendedLanes&=~p;var A=31-e0(p);l.entangledLanes|=p,l.entanglements[A]=l.entanglements[A]|1073741824|g&4194090}function IL(l,p){var g=l.entangledLanes|=p;for(l=l.entanglements;g;){var A=31-e0(g),U=1<<A;U&p|l[A]&p&&(l[A]|=p),g&=~U}}function M3(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function xI(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function O6(){var l=c_.p;return l!==0?l:(l=window.event,l===void 0?32:Q4(l.type))}function gK(l,p){var g=c_.p;try{return c_.p=l,p()}finally{c_.p=g}}var UI=Math.random().toString(36).slice(2),hT="__reactFiber$"+UI,n0="__reactProps$"+UI,NL="__reactContainer$"+UI,DL="__reactEvents$"+UI,w6="__reactListeners$"+UI,I6="__reactHandles$"+UI,x3="__reactResources$"+UI,e1="__reactMarker$"+UI;function zM(l){delete l[hT],delete l[n0],delete l[DL],delete l[w6],delete l[I6]}function UN(l){var p=l[hT];if(p)return p;for(var g=l.parentNode;g;){if(p=g[NL]||g[hT]){if(g=p.alternate,p.child!==null||g!==null&&g.child!==null)for(l=M4(l);l!==null;){if(g=l[hT])return g;l=M4(l)}return p}l=g,g=l.parentNode}return null}function kL(l){if(l=l[hT]||l[NL]){var p=l.tag;if(p===5||p===6||p===13||p===26||p===27||p===3)return l}return null}function n1(l){var p=l.tag;if(p===5||p===26||p===27||p===6)return l.stateNode;throw Error(u(33))}function jN(l){var p=l[x3];return p||(p=l[x3]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function eR(l){l[e1]=!0}var U3=new Set,VN={};function BN(l,p){LL(l,p),LL(l+"Capture",p)}function LL(l,p){for(VN[l]=p,l=0;l<p.length;l++)U3.add(p[l])}var EO=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),N6={},D6={};function YT(l){return PI.call(D6,l)?!0:PI.call(N6,l)?!1:EO.test(l)?D6[l]=!0:(N6[l]=!0,!1)}function KM(l,p,g){if(YT(p))if(g===null)l.removeAttribute(p);else{switch(typeof g){case"undefined":case"function":case"symbol":l.removeAttribute(p);return;case"boolean":var A=p.toLowerCase().slice(0,5);if(A!=="data-"&&A!=="aria-"){l.removeAttribute(p);return}}l.setAttribute(p,""+g)}}function WM(l,p,g){if(g===null)l.removeAttribute(p);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(p);return}l.setAttribute(p,""+g)}}function XO(l,p,g,A){if(A===null)l.removeAttribute(g);else{switch(typeof A){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(g);return}l.setAttributeNS(p,g,""+A)}}var j3,YM;function PL(l){if(j3===void 0)try{throw Error()}catch(g){var p=g.stack.trim().match(/\n( *(at )?)/);j3=p&&p[1]||"",YM=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+j3+l+YM}var XM=!1;function V3(l,p){if(!l||XM)return"";XM=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var A={DetermineComponentFrameRoot:function(){try{if(p){var x_=function(){throw Error()};if(Object.defineProperty(x_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x_,[])}catch(g_){var m_=g_}Reflect.construct(l,[],x_)}else{try{x_.call()}catch(g_){m_=g_}l.call(x_.prototype)}}else{try{throw Error()}catch(g_){m_=g_}(x_=l())&&typeof x_.catch=="function"&&x_.catch(function(){})}}catch(g_){if(g_&&m_&&typeof g_.stack=="string")return[g_.stack,m_.stack]}return[null,null]}};A.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var U=Object.getOwnPropertyDescriptor(A.DetermineComponentFrameRoot,"name");U&&U.configurable&&Object.defineProperty(A.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=A.DetermineComponentFrameRoot(),_o=q[0],ba=q[1];if(_o&&ba){var wE=_o.split(`
`),p_=ba.split(`
`);for(U=A=0;A<wE.length&&!wE[A].includes("DetermineComponentFrameRoot");)A++;for(;U<p_.length&&!p_[U].includes("DetermineComponentFrameRoot");)U++;if(A===wE.length||U===p_.length)for(A=wE.length-1,U=p_.length-1;1<=A&&0<=U&&wE[A]!==p_[U];)U--;for(;1<=A&&0<=U;A--,U--)if(wE[A]!==p_[U]){if(A!==1||U!==1)do if(A--,U--,0>U||wE[A]!==p_[U]){var R_=`
`+wE[A].replace(" at new "," at ");return l.displayName&&R_.includes("<anonymous>")&&(R_=R_.replace("<anonymous>",l.displayName)),R_}while(1<=A&&0<=U);break}}}finally{XM=!1,Error.prepareStackTrace=g}return(g=l?l.displayName||l.name:"")?PL(g):""}function _K(l){switch(l.tag){case 26:case 27:case 5:return PL(l.type);case 16:return PL("Lazy");case 13:return PL("Suspense");case 19:return PL("SuspenseList");case 0:case 15:return V3(l.type,!1);case 11:return V3(l.type.render,!1);case 1:return V3(l.type,!0);case 31:return PL("Activity");default:return""}}function k6(l){try{var p="";do p+=_K(l),l=l.return;while(l);return p}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}function TR(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function JM(l){var p=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function vK(l){var p=JM(l)?"checked":"value",g=Object.getOwnPropertyDescriptor(l.constructor.prototype,p),A=""+l[p];if(!l.hasOwnProperty(p)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var U=g.get,q=g.set;return Object.defineProperty(l,p,{configurable:!0,get:function(){return U.call(this)},set:function(_o){A=""+_o,q.call(this,_o)}}),Object.defineProperty(l,p,{enumerable:g.enumerable}),{getValue:function(){return A},setValue:function(_o){A=""+_o},stopTracking:function(){l._valueTracker=null,delete l[p]}}}}function tT(l){l._valueTracker||(l._valueTracker=vK(l))}function L6(l){if(!l)return!1;var p=l._valueTracker;if(!p)return!0;var g=p.getValue(),A="";return l&&(A=JM(l)?l.checked?"true":"false":l.value),l=A,l!==g?(p.setValue(l),!0):!1}function r1(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var P6=/[\n"\\]/g;function N0(l){return l.replace(P6,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function B3(l,p,g,A,U,q,_o,ba){l.name="",_o!=null&&typeof _o!="function"&&typeof _o!="symbol"&&typeof _o!="boolean"?l.type=_o:l.removeAttribute("type"),p!=null?_o==="number"?(p===0&&l.value===""||l.value!=p)&&(l.value=""+TR(p)):l.value!==""+TR(p)&&(l.value=""+TR(p)):_o!=="submit"&&_o!=="reset"||l.removeAttribute("value"),p!=null?F3(l,_o,TR(p)):g!=null?F3(l,_o,TR(g)):A!=null&&l.removeAttribute("value"),U==null&&q!=null&&(l.defaultChecked=!!q),U!=null&&(l.checked=U&&typeof U!="function"&&typeof U!="symbol"),ba!=null&&typeof ba!="function"&&typeof ba!="symbol"&&typeof ba!="boolean"?l.name=""+TR(ba):l.removeAttribute("name")}function M6(l,p,g,A,U,q,_o,ba){if(q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(l.type=q),p!=null||g!=null){if(!(q!=="submit"&&q!=="reset"||p!=null))return;g=g!=null?""+TR(g):"",p=p!=null?""+TR(p):g,ba||p===l.value||(l.value=p),l.defaultValue=p}A=A??U,A=typeof A!="function"&&typeof A!="symbol"&&!!A,l.checked=ba?l.checked:!!A,l.defaultChecked=!!A,_o!=null&&typeof _o!="function"&&typeof _o!="symbol"&&typeof _o!="boolean"&&(l.name=_o)}function F3(l,p,g){p==="number"&&r1(l.ownerDocument)===l||l.defaultValue===""+g||(l.defaultValue=""+g)}function ML(l,p,g,A){if(l=l.options,p){p={};for(var U=0;U<g.length;U++)p["$"+g[U]]=!0;for(g=0;g<l.length;g++)U=p.hasOwnProperty("$"+l[g].value),l[g].selected!==U&&(l[g].selected=U),U&&A&&(l[g].defaultSelected=!0)}else{for(g=""+TR(g),p=null,U=0;U<l.length;U++){if(l[U].value===g){l[U].selected=!0,A&&(l[U].defaultSelected=!0);return}p!==null||l[U].disabled||(p=l[U])}p!==null&&(p.selected=!0)}}function x6(l,p,g){if(p!=null&&(p=""+TR(p),p!==l.value&&(l.value=p),g==null)){l.defaultValue!==p&&(l.defaultValue=p);return}l.defaultValue=g!=null?""+TR(g):""}function i1(l,p,g,A){if(p==null){if(A!=null){if(g!=null)throw Error(u(92));if(r_(A)){if(1<A.length)throw Error(u(93));A=A[0]}g=A}g==null&&(g=""),p=g}g=TR(p),l.defaultValue=g,A=l.textContent,A===g&&A!==""&&A!==null&&(l.value=A)}function FN(l,p){if(p){var g=l.firstChild;if(g&&g===l.lastChild&&g.nodeType===3){g.nodeValue=p;return}}l.textContent=p}var G3=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function U6(l,p,g){var A=p.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?A?l.setProperty(p,""):p==="float"?l.cssFloat="":l[p]="":A?l.setProperty(p,g):typeof g!="number"||g===0||G3.has(p)?p==="float"?l.cssFloat=g:l[p]=(""+g).trim():l[p]=g+"px"}function ZM(l,p,g){if(p!=null&&typeof p!="object")throw Error(u(62));if(l=l.style,g!=null){for(var A in g)!g.hasOwnProperty(A)||p!=null&&p.hasOwnProperty(A)||(A.indexOf("--")===0?l.setProperty(A,""):A==="float"?l.cssFloat="":l[A]="");for(var U in p)A=p[U],p.hasOwnProperty(U)&&g[U]!==A&&U6(l,U,A)}else for(var q in p)p.hasOwnProperty(q)&&U6(l,q,p[q])}function H3(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var j6=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),yK=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function QM(l){return yK.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var q3=null;function z3(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var xL=null,UL=null;function V6(l){var p=kL(l);if(p&&(l=p.stateNode)){var g=l[n0]||null;t:switch(l=p.stateNode,p.type){case"input":if(B3(l,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),p=g.name,g.type==="radio"&&p!=null){for(g=l;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+N0(""+p)+'"][type="radio"]'),p=0;p<g.length;p++){var A=g[p];if(A!==l&&A.form===l.form){var U=A[n0]||null;if(!U)throw Error(u(90));B3(A,U.value,U.defaultValue,U.defaultValue,U.checked,U.defaultChecked,U.type,U.name)}}for(p=0;p<g.length;p++)A=g[p],A.form===l.form&&L6(A)}break t;case"textarea":x6(l,g.value,g.defaultValue);break t;case"select":p=g.value,p!=null&&ML(l,!!g.multiple,p,!1)}}}var K3=!1;function W3(l,p,g){if(K3)return l(p,g);K3=!0;try{var A=l(p);return A}finally{if(K3=!1,(xL!==null||UL!==null)&&(iV(),xL&&(p=xL,l=UL,UL=xL=null,V6(p),l)))for(p=0;p<l.length;p++)V6(l[p])}}function o1(l,p){var g=l.stateNode;if(g===null)return null;var A=g[n0]||null;if(A===null)return null;g=A[p];t:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(A=!A.disabled)||(l=l.type,A=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!A;break t;default:l=!1}if(l)return null;if(g&&typeof g!="function")throw Error(u(231,p,typeof g));return g}var JO=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Y3=!1;if(JO)try{var ZO={};Object.defineProperty(ZO,"passive",{get:function(){Y3=!0}}),window.addEventListener("test",ZO,ZO),window.removeEventListener("test",ZO,ZO)}catch{Y3=!1}var jI=null,X3=null,$M=null;function B6(){if($M)return $M;var l,p=X3,g=p.length,A,U="value"in jI?jI.value:jI.textContent,q=U.length;for(l=0;l<g&&p[l]===U[l];l++);var _o=g-l;for(A=1;A<=_o&&p[g-A]===U[q-A];A++);return $M=U.slice(l,1<A?1-A:void 0)}function a1(l){var p=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&p===13&&(l=13)):l=p,l===10&&(l=13),32<=l||l===13?l:0}function _x(){return!0}function F6(){return!1}function r0(l){function p(g,A,U,q,_o){this._reactName=g,this._targetInst=U,this.type=A,this.nativeEvent=q,this.target=_o,this.currentTarget=null;for(var ba in l)l.hasOwnProperty(ba)&&(g=l[ba],this[ba]=g?g(q):q[ba]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?_x:F6,this.isPropagationStopped=F6,this}return j(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=_x)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=_x)},persist:function(){},isPersistent:_x}),p}var i0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},GR=r0(i0),jL=j({},i0,{view:0,detail:0}),bK=r0(jL),J3,Z3,nR,tU=j({},jL,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:SF,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==nR&&(nR&&l.type==="mousemove"?(J3=l.screenX-nR.screenX,Z3=l.screenY-nR.screenY):Z3=J3=0,nR=l),J3)},movementY:function(l){return"movementY"in l?l.movementY:Z3}}),G6=r0(tU),SK=j({},tU,{dataTransfer:0}),eU=r0(SK),H6=j({},jL,{relatedTarget:0}),Q3=r0(H6),$3=j({},i0,{animationName:0,elapsedTime:0,pseudoElement:0}),TK=r0($3),EF=j({},i0,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),_F=r0(EF),yF=j({},i0,{data:0}),q6=r0(yF),RK={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AK(l){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(l):(l=nU[l])?!!p[l]:!1}function SF(){return AK}var CK=j({},jL,{key:function(l){if(l.key){var p=RK[l.key]||l.key;if(p!=="Unidentified")return p}return l.type==="keypress"?(l=a1(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?VI[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:SF,charCode:function(l){return l.type==="keypress"?a1(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?a1(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),OK=r0(CK),wK=j({},tU,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),GN=r0(wK),IK=j({},jL,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:SF}),VL=r0(IK),z6=j({},i0,{propertyName:0,elapsedTime:0,pseudoElement:0}),NK=r0(z6),SS=j({},tU,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),DK=r0(SS),kK=j({},i0,{newState:0,oldState:0}),LK=r0(kK),PK=[9,13,27,32],s1=JO&&"CompositionEvent"in window,c1=null;JO&&"documentMode"in document&&(c1=document.documentMode);var MK=JO&&"TextEvent"in window&&!c1,K6=JO&&(!s1||c1&&8<c1&&11>=c1),rU=" ",W6=!1;function Y6(l,p){switch(l){case"keyup":return PK.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function TF(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var BL=!1;function QO(l,p){switch(l){case"compositionend":return TF(p);case"keypress":return p.which!==32?null:(W6=!0,rU);case"textInput":return l=p.data,l===rU&&W6?null:l;default:return null}}function xK(l,p){if(BL)return l==="compositionend"||!s1&&Y6(l,p)?(l=B6(),$M=X3=jI=null,BL=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return K6&&p.locale!=="ko"?null:p.data;default:return null}}var UK={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function X6(l){var p=l&&l.nodeName&&l.nodeName.toLowerCase();return p==="input"?!!UK[l.type]:p==="textarea"}function RF(l,p,g,A){xL?UL?UL.push(A):UL=[A]:xL=A,p=gV(p,"onChange"),0<p.length&&(g=new GR("onChange","change",null,g,A),l.push({event:g,listeners:p}))}var HN=null,u1=null;function jK(l){O4(l,0)}function HR(l){var p=n1(l);if(L6(p))return l}function J6(l,p){if(l==="change")return p}var Z6=!1;if(JO){var AF;if(JO){var CF="oninput"in document;if(!CF){var OF=document.createElement("div");OF.setAttribute("oninput","return;"),CF=typeof OF.oninput=="function"}AF=CF}else AF=!1;Z6=AF&&(!document.documentMode||9<document.documentMode)}function Q6(){HN&&(HN.detachEvent("onpropertychange",$6),u1=HN=null)}function $6(l){if(l.propertyName==="value"&&HR(u1)){var p=[];RF(p,u1,l,z3(l)),W3(jK,p)}}function t5(l,p,g){l==="focusin"?(Q6(),HN=p,u1=g,HN.attachEvent("onpropertychange",$6)):l==="focusout"&&Q6()}function IF(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return HR(u1)}function VK(l,p){if(l==="click")return HR(p)}function BK(l,p){if(l==="input"||l==="change")return HR(p)}function iU(l,p){return l===p&&(l!==0||1/l===1/p)||l!==l&&p!==p}var b0=typeof Object.is=="function"?Object.is:iU;function l1(l,p){if(b0(l,p))return!0;if(typeof l!="object"||l===null||typeof p!="object"||p===null)return!1;var g=Object.keys(l),A=Object.keys(p);if(g.length!==A.length)return!1;for(A=0;A<g.length;A++){var U=g[A];if(!PI.call(p,U)||!b0(l[U],p[U]))return!1}return!0}function e5(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function Y0(l,p){var g=e5(l);l=0;for(var A;g;){if(g.nodeType===3){if(A=l+g.textContent.length,l<=p&&A>=p)return{node:g,offset:p-l};l=A}t:{for(;g;){if(g.nextSibling){g=g.nextSibling;break t}g=g.parentNode}g=void 0}g=e5(g)}}function n5(l,p){return l&&p?l===p?!0:l&&l.nodeType===3?!1:p&&p.nodeType===3?n5(l,p.parentNode):"contains"in l?l.contains(p):l.compareDocumentPosition?!!(l.compareDocumentPosition(p)&16):!1:!1}function r5(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var p=r1(l.document);p instanceof l.HTMLIFrameElement;){try{var g=typeof p.contentWindow.location.href=="string"}catch{g=!1}if(g)l=p.contentWindow;else break;p=r1(l.document)}return p}function qR(l){var p=l&&l.nodeName&&l.nodeName.toLowerCase();return p&&(p==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||p==="textarea"||l.contentEditable==="true")}var FK=JO&&"documentMode"in document&&11>=document.documentMode,FL=null,NF=null,d1=null,oU=!1;function i5(l,p,g){var A=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;oU||FL==null||FL!==r1(A)||(A=FL,"selectionStart"in A&&qR(A)?A={start:A.selectionStart,end:A.selectionEnd}:(A=(A.ownerDocument&&A.ownerDocument.defaultView||window).getSelection(),A={anchorNode:A.anchorNode,anchorOffset:A.anchorOffset,focusNode:A.focusNode,focusOffset:A.focusOffset}),d1&&l1(d1,A)||(d1=A,A=gV(NF,"onSelect"),0<A.length&&(p=new GR("onSelect","select",null,p,g),l.push({event:p,listeners:A}),p.target=FL)))}function qN(l,p){var g={};return g[l.toLowerCase()]=p.toLowerCase(),g["Webkit"+l]="webkit"+p,g["Moz"+l]="moz"+p,g}var GL={animationend:qN("Animation","AnimationEnd"),animationiteration:qN("Animation","AnimationIteration"),animationstart:qN("Animation","AnimationStart"),transitionrun:qN("Transition","TransitionRun"),transitionstart:qN("Transition","TransitionStart"),transitioncancel:qN("Transition","TransitionCancel"),transitionend:qN("Transition","TransitionEnd")},aU={},o5={};JO&&(o5=document.createElement("div").style,"AnimationEvent"in window||(delete GL.animationend.animation,delete GL.animationiteration.animation,delete GL.animationstart.animation),"TransitionEvent"in window||delete GL.transitionend.transition);function zN(l){if(aU[l])return aU[l];if(!GL[l])return l;var p=GL[l],g;for(g in p)if(p.hasOwnProperty(g)&&g in o5)return aU[l]=p[g];return l}var sU=zN("animationend"),cU=zN("animationiteration"),a5=zN("animationstart"),T_=zN("transitionrun"),GK=zN("transitionstart"),HK=zN("transitioncancel"),s5=zN("transitionend"),c5=new Map,DF="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");DF.push("scrollEnd");function X0(l,p){c5.set(l,p),BN(p,[l])}var u5=new WeakMap;function D0(l,p){if(typeof l=="object"&&l!==null){var g=u5.get(l);return g!==void 0?g:(p={value:l,source:p,stack:k6(p)},u5.set(l,p),p)}return{value:l,source:p,stack:k6(p)}}var zR=[],J0=0,LF=0;function uU(){for(var l=J0,p=LF=J0=0;p<l;){var g=zR[p];zR[p++]=null;var A=zR[p];zR[p++]=null;var U=zR[p];zR[p++]=null;var q=zR[p];if(zR[p++]=null,A!==null&&U!==null){var _o=A.pending;_o===null?U.next=U:(U.next=_o.next,_o.next=U),A.pending=U}q!==0&&l5(g,U,q)}}function lU(l,p,g,A){zR[J0++]=l,zR[J0++]=p,zR[J0++]=g,zR[J0++]=A,LF|=A,l.lanes|=A,l=l.alternate,l!==null&&(l.lanes|=A)}function PF(l,p,g,A){return lU(l,p,g,A),h1(l)}function BI(l,p){return lU(l,null,null,p),h1(l)}function l5(l,p,g){l.lanes|=g;var A=l.alternate;A!==null&&(A.lanes|=g);for(var U=!1,q=l.return;q!==null;)q.childLanes|=g,A=q.alternate,A!==null&&(A.childLanes|=g),q.tag===22&&(l=q.stateNode,l===null||l._visibility&1||(U=!0)),l=q,q=q.return;return l.tag===3?(q=l.stateNode,U&&p!==null&&(U=31-e0(g),l=q.hiddenUpdates,A=l[U],A===null?l[U]=[p]:A.push(p),p.lane=g|536870912),q):null}function h1(l){if(50<CO)throw CO=0,pI=null,Error(u(185));for(var p=l.return;p!==null;)l=p,p=l.return;return l.tag===3?l.stateNode:null}var LR={};function qK(l,p,g,A){this.tag=l,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=A,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function RR(l,p,g,A){return new qK(l,p,g,A)}function MF(l){return l=l.prototype,!(!l||!l.isReactComponent)}function $O(l,p){var g=l.alternate;return g===null?(g=RR(l.tag,p,l.key,l.mode),g.elementType=l.elementType,g.type=l.type,g.stateNode=l.stateNode,g.alternate=l,l.alternate=g):(g.pendingProps=p,g.type=l.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=l.flags&65011712,g.childLanes=l.childLanes,g.lanes=l.lanes,g.child=l.child,g.memoizedProps=l.memoizedProps,g.memoizedState=l.memoizedState,g.updateQueue=l.updateQueue,p=l.dependencies,g.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},g.sibling=l.sibling,g.index=l.index,g.ref=l.ref,g.refCleanup=l.refCleanup,g}function d5(l,p){l.flags&=65011714;var g=l.alternate;return g===null?(l.childLanes=0,l.lanes=p,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=g.childLanes,l.lanes=g.lanes,l.child=g.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=g.memoizedProps,l.memoizedState=g.memoizedState,l.updateQueue=g.updateQueue,l.type=g.type,p=g.dependencies,l.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),l}function p1(l,p,g,A,U,q){var _o=0;if(A=l,typeof l=="function")MF(l)&&(_o=1);else if(typeof l=="string")_o=RW(l,g,lb.current)?26:l==="html"||l==="head"||l==="body"?27:5;else t:switch(l){case _S:return l=RR(31,g,p,U),l.elementType=_S,l.lanes=q,l;case na:return KN(g.children,U,q,p);case _c:_o=8,U|=24;break;case _a:return l=RR(12,g,p,U|2),l.elementType=_a,l.lanes=q,l;case y_:return l=RR(13,g,p,U),l.elementType=y_,l.lanes=q,l;case F_:return l=RR(19,g,p,U),l.elementType=F_,l.lanes=q,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case _s:case _f:_o=10;break t;case _h:_o=9;break t;case E_:_o=11;break t;case w_:_o=14;break t;case W_:_o=16,A=null;break t}_o=29,g=Error(u(130,l===null?"null":typeof l,"")),A=null}return p=RR(_o,g,p,U),p.elementType=l,p.type=A,p.lanes=q,p}function KN(l,p,g,A){return l=RR(7,l,A,p),l.lanes=g,l}function xF(l,p,g){return l=RR(6,l,null,p),l.lanes=g,l}function UF(l,p,g){return p=RR(4,l.children!==null?l.children:[],l.key,p),p.lanes=g,p.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},p}var FI=[],HL=0,f1=null,m1=0,k0=[],S0=0,gO=null,_w=1,tI="";function WN(l,p){FI[HL++]=m1,FI[HL++]=f1,f1=l,m1=p}function h5(l,p,g){k0[S0++]=_w,k0[S0++]=tI,k0[S0++]=gO,gO=l;var A=_w;l=tI;var U=32-e0(A)-1;A&=~(1<<U),g+=1;var q=32-e0(p)+U;if(30<q){var _o=U-U%5;q=(A&(1<<_o)-1).toString(32),A>>=_o,U-=_o,_w=1<<32-e0(p)+U|g<<U|A,tI=q+l}else _w=1<<q|g<<U|A,tI=l}function VF(l){l.return!==null&&(WN(l,1),h5(l,1,0))}function dU(l){for(;l===f1;)f1=FI[--HL],FI[HL]=null,m1=FI[--HL],FI[HL]=null;for(;l===gO;)gO=k0[--S0],k0[S0]=null,tI=k0[--S0],k0[S0]=null,_w=k0[--S0],k0[S0]=null}var AR=null,HT=null,XS=!1,YN=null,_O=!1,BF=Error(u(519));function XN(l){var p=Error(u(418,""));throw GI(D0(p,l)),BF}function p5(l){var p=l.stateNode,g=l.type,A=l.memoizedProps;switch(p[hT]=l,p[n0]=A,g){case"dialog":LS("cancel",p),LS("close",p);break;case"iframe":case"object":case"embed":LS("load",p);break;case"video":case"audio":for(g=0;g<mP.length;g++)LS(mP[g],p);break;case"source":LS("error",p);break;case"img":case"image":case"link":LS("error",p),LS("load",p);break;case"details":LS("toggle",p);break;case"input":LS("invalid",p),M6(p,A.value,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name,!0),tT(p);break;case"select":LS("invalid",p);break;case"textarea":LS("invalid",p),i1(p,A.value,A.defaultValue,A.children),tT(p)}g=A.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||p.textContent===""+g||A.suppressHydrationWarning===!0||N4(p.textContent,g)?(A.popover!=null&&(LS("beforetoggle",p),LS("toggle",p)),A.onScroll!=null&&LS("scroll",p),A.onScrollEnd!=null&&LS("scrollend",p),A.onClick!=null&&(p.onclick=vV),p=!0):p=!1,p||XN(l)}function f5(l){for(AR=l.return;AR;)switch(AR.tag){case 5:case 13:_O=!1;return;case 27:case 3:_O=!0;return;default:AR=AR.return}}function E1(l){if(l!==AR)return!1;if(!XS)return f5(l),XS=!0,!1;var p=l.tag,g;if((g=p!==3&&p!==27)&&((g=p===5)&&(g=l.type,g=!(g!=="form"&&g!=="button")||JG(l.type,l.memoizedProps)),g=!g),g&&HT&&XN(l),f5(l),p===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(u(317));t:{for(l=l.nextSibling,p=0;l;){if(l.nodeType===8)if(g=l.data,g==="/$"){if(p===0){HT=nO(l.nextSibling);break t}p--}else g!=="$"&&g!=="$!"&&g!=="$?"||p++;l=l.nextSibling}HT=null}}else p===27?(p=HT,dN(l.type)?(l=e2,e2=null,HT=l):HT=p):HT=AR?nO(l.stateNode.nextSibling):null;return!0}function g1(){HT=AR=null,XS=!1}function m5(){var l=YN;return l!==null&&(c0===null?c0=l:c0.push.apply(c0,l),YN=null),l}function GI(l){YN===null?YN=[l]:YN.push(l)}var qL=S_(null),eI=null,nI=null;function HI(l,p,g){G_(qL,p._currentValue),p._currentValue=g}function rI(l){l._currentValue=qL.current,P_(qL)}function hU(l,p,g){for(;l!==null;){var A=l.alternate;if((l.childLanes&p)!==p?(l.childLanes|=p,A!==null&&(A.childLanes|=p)):A!==null&&(A.childLanes&p)!==p&&(A.childLanes|=p),l===g)break;l=l.return}}function pU(l,p,g,A){var U=l.child;for(U!==null&&(U.return=l);U!==null;){var q=U.dependencies;if(q!==null){var _o=U.child;q=q.firstContext;t:for(;q!==null;){var ba=q;q=U;for(var wE=0;wE<p.length;wE++)if(ba.context===p[wE]){q.lanes|=g,ba=q.alternate,ba!==null&&(ba.lanes|=g),hU(q.return,g,l),A||(_o=null);break t}q=ba.next}}else if(U.tag===18){if(_o=U.return,_o===null)throw Error(u(341));_o.lanes|=g,q=_o.alternate,q!==null&&(q.lanes|=g),hU(_o,g,l),_o=null}else _o=U.child;if(_o!==null)_o.return=U;else for(_o=U;_o!==null;){if(_o===l){_o=null;break}if(U=_o.sibling,U!==null){U.return=_o.return,_o=U;break}_o=_o.return}U=_o}}function JN(l,p,g,A){l=null;for(var U=p,q=!1;U!==null;){if(!q){if((U.flags&524288)!==0)q=!0;else if((U.flags&262144)!==0)break}if(U.tag===10){var _o=U.alternate;if(_o===null)throw Error(u(387));if(_o=_o.memoizedProps,_o!==null){var ba=U.type;b0(U.pendingProps.value,_o.value)||(l!==null?l.push(ba):l=[ba])}}else if(U===$S.current){if(_o=U.alternate,_o===null)throw Error(u(387));_o.memoizedState.memoizedState!==U.memoizedState.memoizedState&&(l!==null?l.push(bP):l=[bP])}U=U.return}l!==null&&pU(p,l,g,A),p.flags|=262144}function fU(l){for(l=l.firstContext;l!==null;){if(!b0(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function ZN(l){eI=l,nI=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function rR(l){return E5(eI,l)}function mU(l,p){return eI===null&&ZN(l),E5(l,p)}function E5(l,p){var g=p._currentValue;if(p={context:p,memoizedValue:g,next:null},nI===null){if(l===null)throw Error(u(308));nI=p,l.dependencies={lanes:0,firstContext:p},l.flags|=524288}else nI=nI.next=p;return g}var zK=typeof AbortController<"u"?AbortController:function(){var l=[],p=this.signal={aborted:!1,addEventListener:function(g,A){l.push(A)}};this.abort=function(){p.aborted=!0,l.forEach(function(g){return g()})}},KK=i.unstable_scheduleCallback,WK=i.unstable_NormalPriority,dR={$$typeof:_f,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function EU(){return{controller:new zK,data:new Map,refCount:0}}function _1(l){l.refCount--,l.refCount===0&&KK(WK,function(){l.controller.abort()})}var v1=null,FF=0,qI=0,zL=null;function YK(l,p){if(v1===null){var g=v1=[];FF=0,qI=X1(),zL={status:"pending",value:void 0,then:function(A){g.push(A)}}}return FF++,p.then(y1,y1),p}function y1(){if(--FF===0&&v1!==null){zL!==null&&(zL.status="fulfilled");var l=v1;v1=null,qI=0,zL=null;for(var p=0;p<l.length;p++)(0,l[p])()}}function XK(l,p){var g=[],A={status:"pending",value:null,reason:null,then:function(U){g.push(U)}};return l.then(function(){A.status="fulfilled",A.value=p;for(var U=0;U<g.length;U++)(0,g[U])(p)},function(U){for(A.status="rejected",A.reason=U,U=0;U<g.length;U++)(0,g[U])(void 0)}),A}var g5=_p.S;_p.S=function(l,p){typeof p=="object"&&p!==null&&typeof p.then=="function"&&YK(l,p),g5!==null&&g5(l,p)};var QN=S_(null);function GF(){var l=QN.current;return l!==null?l:yT.pooledCache}function gU(l,p){p===null?G_(QN,QN.current):G_(QN,p.pool)}function _5(){var l=GF();return l===null?null:{parent:dR._currentValue,pool:l}}var zI=Error(u(460)),HF=Error(u(474)),_U=Error(u(542)),zF={then:function(){}};function KF(l){return l=l.status,l==="fulfilled"||l==="rejected"}function vU(){}function v5(l,p,g){switch(g=l[g],g===void 0?l.push(p):g!==p&&(p.then(vU,vU),p=g),p.status){case"fulfilled":return p.value;case"rejected":throw l=p.reason,bU(l),l;default:if(typeof p.status=="string")p.then(vU,vU);else{if(l=yT,l!==null&&100<l.shellSuspendCounter)throw Error(u(482));l=p,l.status="pending",l.then(function(A){if(p.status==="pending"){var U=p;U.status="fulfilled",U.value=A}},function(A){if(p.status==="pending"){var U=p;U.status="rejected",U.reason=A}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw l=p.reason,bU(l),l}throw b1=p,zI}}var b1=null;function yU(){if(b1===null)throw Error(u(459));var l=b1;return b1=null,l}function bU(l){if(l===zI||l===_U)throw Error(u(483))}var iI=!1;function S1(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function SU(l,p){l=l.updateQueue,p.updateQueue===l&&(p.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function oI(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Z0(l,p,g){var A=l.updateQueue;if(A===null)return null;if(A=A.shared,(cT&2)!==0){var U=A.pending;return U===null?p.next=p:(p.next=U.next,U.next=p),A.pending=p,p=h1(l),l5(l,null,g),p}return lU(l,A,p,g),h1(l)}function aI(l,p,g){if(p=p.updateQueue,p!==null&&(p=p.shared,(g&4194048)!==0)){var A=p.lanes;A&=l.pendingLanes,g|=A,p.lanes=g,IL(l,g)}}function WF(l,p){var g=l.updateQueue,A=l.alternate;if(A!==null&&(A=A.updateQueue,g===A)){var U=null,q=null;if(g=g.firstBaseUpdate,g!==null){do{var _o={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};q===null?U=q=_o:q=q.next=_o,g=g.next}while(g!==null);q===null?U=q=p:q=q.next=p}else U=q=p;g={baseState:A.baseState,firstBaseUpdate:U,lastBaseUpdate:q,shared:A.shared,callbacks:A.callbacks},l.updateQueue=g;return}l=g.lastBaseUpdate,l===null?g.firstBaseUpdate=p:l.next=p,g.lastBaseUpdate=p}var YF=!1;function KL(){if(YF){var l=zL;if(l!==null)throw l}}function T1(l,p,g,A){YF=!1;var U=l.updateQueue;iI=!1;var q=U.firstBaseUpdate,_o=U.lastBaseUpdate,ba=U.shared.pending;if(ba!==null){U.shared.pending=null;var wE=ba,p_=wE.next;wE.next=null,_o===null?q=p_:_o.next=p_,_o=wE;var R_=l.alternate;R_!==null&&(R_=R_.updateQueue,ba=R_.lastBaseUpdate,ba!==_o&&(ba===null?R_.firstBaseUpdate=p_:ba.next=p_,R_.lastBaseUpdate=wE))}if(q!==null){var x_=U.baseState;_o=0,R_=p_=wE=null,ba=q;do{var m_=ba.lane&-536870913,g_=m_!==ba.lane;if(g_?(GS&m_)===m_:(A&m_)===m_){m_!==0&&m_===qI&&(YF=!0),R_!==null&&(R_=R_.next={lane:0,tag:ba.tag,payload:ba.payload,callback:null,next:null});t:{var fS=l,tS=ba;m_=p;var fT=g;switch(tS.tag){case 1:if(fS=tS.payload,typeof fS=="function"){x_=fS.call(fT,x_,m_);break t}x_=fS;break t;case 3:fS.flags=fS.flags&-65537|128;case 0:if(fS=tS.payload,m_=typeof fS=="function"?fS.call(fT,x_,m_):fS,m_==null)break t;x_=j({},x_,m_);break t;case 2:iI=!0}}m_=ba.callback,m_!==null&&(l.flags|=64,g_&&(l.flags|=8192),g_=U.callbacks,g_===null?U.callbacks=[m_]:g_.push(m_))}else g_={lane:m_,tag:ba.tag,payload:ba.payload,callback:ba.callback,next:null},R_===null?(p_=R_=g_,wE=x_):R_=R_.next=g_,_o|=m_;if(ba=ba.next,ba===null){if(ba=U.shared.pending,ba===null)break;g_=ba,ba=g_.next,g_.next=null,U.lastBaseUpdate=g_,U.shared.pending=null}}while(!0);R_===null&&(wE=x_),U.baseState=wE,U.firstBaseUpdate=p_,U.lastBaseUpdate=R_,q===null&&(U.shared.lanes=0),oN|=_o,l.lanes=_o,l.memoizedState=x_}}function y5(l,p){if(typeof l!="function")throw Error(u(191,l));l.call(p)}function XF(l,p){var g=l.callbacks;if(g!==null)for(l.callbacks=null,l=0;l<g.length;l++)y5(g[l],p)}var WL=S_(null),TU=S_(0);function b5(l,p){l=AO,G_(TU,l),G_(WL,p),AO=l|p.baseLanes}function JF(){G_(TU,AO),G_(WL,WL.current)}function ZF(){AO=TU.current,P_(WL),P_(TU)}var KI=0,CS=null,KS=null,iR=null,RU=!1,YL=!1,WI=!1,AU=0,XL=0,JL=null,JK=0;function XT(){throw Error(u(321))}function ZL(l,p){if(p===null)return!1;for(var g=0;g<p.length&&g<l.length;g++)if(!b0(l[g],p[g]))return!1;return!0}function QF(l,p,g,A,U,q){return KI=q,CS=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,_p.H=l===null||l.memoizedState===null?gG:U5,WI=!1,q=g(A,U),WI=!1,YL&&(q=T5(p,g,A,U)),S5(l),q}function S5(l){_p.H=N1;var p=KS!==null&&KS.next!==null;if(KI=0,iR=KS=CS=null,RU=!1,XL=0,JL=null,p)throw Error(u(300));l===null||pR||(l=l.dependencies,l!==null&&fU(l)&&(pR=!0))}function T5(l,p,g,A){CS=l;var U=0;do{if(YL&&(JL=null),XL=0,YL=!1,25<=U)throw Error(u(301));if(U+=1,iR=KS=null,l.updateQueue!=null){var q=l.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}_p.H=YI,q=p(g,A)}while(YL);return q}function ZK(){var l=_p.H,p=l.useState()[0];return p=typeof p.then=="function"?QL(p):p,l=l.useState()[0],(KS!==null?KS.memoizedState:null)!==l&&(CS.flags|=1024),p}function $F(){var l=AU!==0;return AU=0,l}function tG(l,p,g){p.updateQueue=l.updateQueue,p.flags&=-2053,l.lanes&=~g}function R1(l){if(RU){for(l=l.memoizedState;l!==null;){var p=l.queue;p!==null&&(p.pending=null),l=l.next}RU=!1}KI=0,iR=KS=CS=null,YL=!1,XL=AU=0,JL=null}function o0(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return iR===null?CS.memoizedState=iR=l:iR=iR.next=l,iR}function JT(){if(KS===null){var l=CS.alternate;l=l!==null?l.memoizedState:null}else l=KS.next;var p=iR===null?CS.memoizedState:iR.next;if(p!==null)iR=p,KS=l;else{if(l===null)throw CS.alternate===null?Error(u(467)):Error(u(310));KS=l,l={memoizedState:KS.memoizedState,baseState:KS.baseState,baseQueue:KS.baseQueue,queue:KS.queue,next:null},iR===null?CS.memoizedState=iR=l:iR=iR.next=l}return iR}function eG(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function QL(l){var p=XL;return XL+=1,JL===null&&(JL=[]),l=v5(JL,l,p),p=CS,(iR===null?p.memoizedState:iR.next)===null&&(p=p.alternate,_p.H=p===null||p.memoizedState===null?gG:U5),l}function CU(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return QL(l);if(l.$$typeof===_f)return rR(l)}throw Error(u(438,String(l)))}function nG(l){var p=null,g=CS.updateQueue;if(g!==null&&(p=g.memoCache),p==null){var A=CS.alternate;A!==null&&(A=A.updateQueue,A!==null&&(A=A.memoCache,A!=null&&(p={data:A.data.map(function(U){return U.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),g===null&&(g=eG(),CS.updateQueue=g),g.memoCache=p,g=p.data[p.index],g===void 0)for(g=p.data[p.index]=Array(l),A=0;A<l;A++)g[A]=o_;return p.index++,g}function sI(l,p){return typeof p=="function"?p(l):p}function OU(l){var p=JT();return rG(p,KS,l)}function rG(l,p,g){var A=l.queue;if(A===null)throw Error(u(311));A.lastRenderedReducer=g;var U=l.baseQueue,q=A.pending;if(q!==null){if(U!==null){var _o=U.next;U.next=q.next,q.next=_o}p.baseQueue=U=q,A.pending=null}if(q=l.baseState,U===null)l.memoizedState=q;else{p=U.next;var ba=_o=null,wE=null,p_=p,R_=!1;do{var x_=p_.lane&-536870913;if(x_!==p_.lane?(GS&x_)===x_:(KI&x_)===x_){var m_=p_.revertLane;if(m_===0)wE!==null&&(wE=wE.next={lane:0,revertLane:0,action:p_.action,hasEagerState:p_.hasEagerState,eagerState:p_.eagerState,next:null}),x_===qI&&(R_=!0);else if((KI&m_)===m_){p_=p_.next,m_===qI&&(R_=!0);continue}else x_={lane:0,revertLane:p_.revertLane,action:p_.action,hasEagerState:p_.hasEagerState,eagerState:p_.eagerState,next:null},wE===null?(ba=wE=x_,_o=q):wE=wE.next=x_,CS.lanes|=m_,oN|=m_;x_=p_.action,WI&&g(q,x_),q=p_.hasEagerState?p_.eagerState:g(q,x_)}else m_={lane:x_,revertLane:p_.revertLane,action:p_.action,hasEagerState:p_.hasEagerState,eagerState:p_.eagerState,next:null},wE===null?(ba=wE=m_,_o=q):wE=wE.next=m_,CS.lanes|=x_,oN|=x_;p_=p_.next}while(p_!==null&&p_!==p);if(wE===null?_o=q:wE.next=ba,!b0(q,l.memoizedState)&&(pR=!0,R_&&(g=zL,g!==null)))throw g;l.memoizedState=q,l.baseState=_o,l.baseQueue=wE,A.lastRenderedState=q}return U===null&&(A.lanes=0),[l.memoizedState,A.dispatch]}function iG(l){var p=JT(),g=p.queue;if(g===null)throw Error(u(311));g.lastRenderedReducer=l;var A=g.dispatch,U=g.pending,q=p.memoizedState;if(U!==null){g.pending=null;var _o=U=U.next;do q=l(q,_o.action),_o=_o.next;while(_o!==U);b0(q,p.memoizedState)||(pR=!0),p.memoizedState=q,p.baseQueue===null&&(p.baseState=q),g.lastRenderedState=q}return[q,A]}function oG(l,p,g){var A=CS,U=JT(),q=XS;if(q){if(g===void 0)throw Error(u(407));g=g()}else g=p();var _o=!b0((KS||U).memoizedState,g);_o&&(U.memoizedState=g,pR=!0),U=U.queue;var ba=aG.bind(null,A,U,l);if(vO(2048,8,ba,[l]),U.getSnapshot!==p||_o||iR!==null&&iR.memoizedState.tag&1){if(A.flags|=2048,eP(9,DU(),A5.bind(null,A,U,g,p),null),yT===null)throw Error(u(349));q||(KI&124)!==0||R5(A,p,g)}return g}function R5(l,p,g){l.flags|=16384,l={getSnapshot:p,value:g},p=CS.updateQueue,p===null?(p=eG(),CS.updateQueue=p,p.stores=[l]):(g=p.stores,g===null?p.stores=[l]:g.push(l))}function A5(l,p,g,A){p.value=g,p.getSnapshot=A,C5(p)&&A1(l)}function aG(l,p,g){return g(function(){C5(p)&&A1(l)})}function C5(l){var p=l.getSnapshot;l=l.value;try{var g=p();return!b0(l,g)}catch{return!0}}function A1(l){var p=BI(l,2);p!==null&&A0(p,l,2)}function wU(l){var p=o0();if(typeof l=="function"){var g=l;if(l=g(),WI){FR(!0);try{g()}finally{FR(!1)}}}return p.memoizedState=p.baseState=l,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sI,lastRenderedState:l},p}function $L(l,p,g,A){return l.baseState=g,rG(l,KS,typeof A=="function"?A:sI)}function QK(l,p,g,A,U){if(UU(l))throw Error(u(485));if(l=p.action,l!==null){var q={payload:U,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_o){q.listeners.push(_o)}};_p.T!==null?g(!0):q.isTransition=!1,A(q),g=p.pending,g===null?(q.next=p.pending=q,O5(p,q)):(q.next=g.next,p.pending=g.next=q)}}function O5(l,p){var g=p.action,A=p.payload,U=l.state;if(p.isTransition){var q=_p.T,_o={};_p.T=_o;try{var ba=g(U,A),wE=_p.S;wE!==null&&wE(_o,ba),w5(l,p,ba)}catch(p_){tP(l,p,p_)}finally{_p.T=q}}else try{q=g(U,A),w5(l,p,q)}catch(p_){tP(l,p,p_)}}function w5(l,p,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(A){I5(l,p,A)},function(A){return tP(l,p,A)}):I5(l,p,g)}function I5(l,p,g){p.status="fulfilled",p.value=g,N5(p),l.state=g,p=l.pending,p!==null&&(g=p.next,g===p?l.pending=null:(g=g.next,p.next=g,O5(l,g)))}function tP(l,p,g){var A=l.pending;if(l.pending=null,A!==null){A=A.next;do p.status="rejected",p.reason=g,N5(p),p=p.next;while(p!==A)}l.action=null}function N5(l){l=l.listeners;for(var p=0;p<l.length;p++)(0,l[p])()}function sG(l,p){return p}function IU(l,p){if(XS){var g=yT.formState;if(g!==null){t:{var A=CS;if(XS){if(HT){e:{for(var U=HT,q=_O;U.nodeType!==8;){if(!q){U=null;break e}if(U=nO(U.nextSibling),U===null){U=null;break e}}q=U.data,U=q==="F!"||q==="F"?U:null}if(U){HT=nO(U.nextSibling),A=U.data==="F!";break t}}XN(A)}A=!1}A&&(p=g[0])}}return g=o0(),g.memoizedState=g.baseState=p,A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sG,lastRenderedState:p},g.queue=A,g=mG.bind(null,CS,A),A.dispatch=g,A=wU(!1),q=I1.bind(null,CS,!1,A.queue),A=o0(),U={state:p,dispatch:null,action:l,pending:null},A.queue=U,g=QK.bind(null,CS,U,q,g),U.dispatch=g,A.memoizedState=l,[p,g,!1]}function NU(l){var p=JT();return D5(p,KS,l)}function D5(l,p,g){if(p=rG(l,p,sG)[0],l=OU(sI)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var A=QL(p)}catch(_o){throw _o===zI?_U:_o}else A=p;p=JT();var U=p.queue,q=U.dispatch;return g!==p.memoizedState&&(CS.flags|=2048,eP(9,DU(),$K.bind(null,U,g),null)),[A,q,l]}function $K(l,p){l.action=p}function k5(l){var p=JT(),g=KS;if(g!==null)return D5(p,g,l);JT(),p=p.memoizedState,g=JT();var A=g.queue.dispatch;return g.memoizedState=l,[p,A,!1]}function eP(l,p,g,A){return l={tag:l,create:g,deps:A,inst:p,next:null},p=CS.updateQueue,p===null&&(p=eG(),CS.updateQueue=p),g=p.lastEffect,g===null?p.lastEffect=l.next=l:(A=g.next,g.next=l,l.next=A,p.lastEffect=l),l}function DU(){return{destroy:void 0,resource:void 0}}function C1(){return JT().memoizedState}function kU(l,p,g,A){var U=o0();A=A===void 0?null:A,CS.flags|=l,U.memoizedState=eP(1|p,DU(),g,A)}function vO(l,p,g,A){var U=JT();A=A===void 0?null:A;var q=U.memoizedState.inst;KS!==null&&A!==null&&ZL(A,KS.memoizedState.deps)?U.memoizedState=eP(p,q,g,A):(CS.flags|=l,U.memoizedState=eP(1|p,q,g,A))}function LU(l,p){kU(8390656,8,l,p)}function O1(l,p){vO(2048,8,l,p)}function nP(l,p){return vO(4,2,l,p)}function w1(l,p){return vO(4,4,l,p)}function L5(l,p){if(typeof p=="function"){l=l();var g=p(l);return function(){typeof g=="function"?g():p(null)}}if(p!=null)return l=l(),p.current=l,function(){p.current=null}}function cG(l,p,g){g=g!=null?g.concat([l]):null,vO(4,4,L5.bind(null,p,l),g)}function uG(){}function lG(l,p){var g=JT();p=p===void 0?null:p;var A=g.memoizedState;return p!==null&&ZL(p,A[1])?A[0]:(g.memoizedState=[l,p],l)}function P5(l,p){var g=JT();p=p===void 0?null:p;var A=g.memoizedState;if(p!==null&&ZL(p,A[1]))return A[0];if(A=l(),WI){FR(!0);try{l()}finally{FR(!1)}}return g.memoizedState=[A,p],A}function dG(l,p,g){return g===void 0||(KI&1073741824)!==0?l.memoizedState=p:(l.memoizedState=g,l=d4(),CS.lanes|=l,oN|=l,g)}function PU(l,p,g,A){return b0(g,p)?g:WL.current!==null?(l=dG(l,g,A),b0(l,p)||(pR=!0),l):(KI&42)===0?(pR=!0,l.memoizedState=g):(l=d4(),CS.lanes|=l,oN|=l,p)}function MU(l,p,g,A,U){var q=c_.p;c_.p=q!==0&&8>q?q:8;var _o=_p.T,ba={};_p.T=ba,I1(l,!1,p,g);try{var wE=U(),p_=_p.S;if(p_!==null&&p_(ba,wE),wE!==null&&typeof wE=="object"&&typeof wE.then=="function"){var R_=XK(wE,A);$0(l,p,R_,u0(l))}else $0(l,p,A,u0(l))}catch(x_){$0(l,p,{then:function(){},status:"rejected",reason:x_},u0())}finally{c_.p=q,_p.T=_o}}function tW(){}function hG(l,p,g,A){if(l.tag!==5)throw Error(u(476));var U=pG(l).queue;MU(l,U,p,v_,g===null?tW:function(){return xU(l),g(A)})}function pG(l){var p=l.memoizedState;if(p!==null)return p;p={memoizedState:v_,baseState:v_,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:sI,lastRenderedState:v_},next:null};var g={};return p.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:sI,lastRenderedState:g},next:null},l.memoizedState=p,l=l.alternate,l!==null&&(l.memoizedState=p),p}function xU(l){var p=pG(l).next.queue;$0(l,p,{},u0())}function fG(){return rR(bP)}function Q0(){return JT().memoizedState}function $N(){return JT().memoizedState}function _D(l){for(var p=l.return;p!==null;){switch(p.tag){case 24:case 3:var g=u0();l=oI(g);var A=Z0(p,l,g);A!==null&&(A0(A,p,g),aI(A,p,g)),p={cache:EU()},l.payload=p;return}p=p.return}}function M5(l,p,g){var A=u0();g={lane:A,revertLane:0,action:g,hasEagerState:!1,eagerState:null,next:null},UU(l)?EG(p,g):(g=PF(l,p,g,A),g!==null&&(A0(g,l,A),x5(g,p,A)))}function mG(l,p,g){var A=u0();$0(l,p,g,A)}function $0(l,p,g,A){var U={lane:A,revertLane:0,action:g,hasEagerState:!1,eagerState:null,next:null};if(UU(l))EG(p,U);else{var q=l.alternate;if(l.lanes===0&&(q===null||q.lanes===0)&&(q=p.lastRenderedReducer,q!==null))try{var _o=p.lastRenderedState,ba=q(_o,g);if(U.hasEagerState=!0,U.eagerState=ba,b0(ba,_o))return lU(l,p,U,0),yT===null&&uU(),!1}catch{}finally{}if(g=PF(l,p,U,A),g!==null)return A0(g,l,A),x5(g,p,A),!0}return!1}function I1(l,p,g,A){if(A={lane:2,revertLane:X1(),action:A,hasEagerState:!1,eagerState:null,next:null},UU(l)){if(p)throw Error(u(479))}else p=PF(l,g,A,2),p!==null&&A0(p,l,2)}function UU(l){var p=l.alternate;return l===CS||p!==null&&p===CS}function EG(l,p){YL=RU=!0;var g=l.pending;g===null?p.next=p:(p.next=g.next,g.next=p),l.pending=p}function x5(l,p,g){if((g&4194048)!==0){var A=p.lanes;A&=l.pendingLanes,g|=A,p.lanes=g,IL(l,g)}}var N1={readContext:rR,use:CU,useCallback:XT,useContext:XT,useEffect:XT,useImperativeHandle:XT,useLayoutEffect:XT,useInsertionEffect:XT,useMemo:XT,useReducer:XT,useRef:XT,useState:XT,useDebugValue:XT,useDeferredValue:XT,useTransition:XT,useSyncExternalStore:XT,useId:XT,useHostTransitionStatus:XT,useFormState:XT,useActionState:XT,useOptimistic:XT,useMemoCache:XT,useCacheRefresh:XT},gG={readContext:rR,use:CU,useCallback:function(l,p){return o0().memoizedState=[l,p===void 0?null:p],l},useContext:rR,useEffect:LU,useImperativeHandle:function(l,p,g){g=g!=null?g.concat([l]):null,kU(4194308,4,L5.bind(null,p,l),g)},useLayoutEffect:function(l,p){return kU(4194308,4,l,p)},useInsertionEffect:function(l,p){kU(4,2,l,p)},useMemo:function(l,p){var g=o0();p=p===void 0?null:p;var A=l();if(WI){FR(!0);try{l()}finally{FR(!1)}}return g.memoizedState=[A,p],A},useReducer:function(l,p,g){var A=o0();if(g!==void 0){var U=g(p);if(WI){FR(!0);try{g(p)}finally{FR(!1)}}}else U=p;return A.memoizedState=A.baseState=U,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:U},A.queue=l,l=l.dispatch=M5.bind(null,CS,l),[A.memoizedState,l]},useRef:function(l){var p=o0();return l={current:l},p.memoizedState=l},useState:function(l){l=wU(l);var p=l.queue,g=mG.bind(null,CS,p);return p.dispatch=g,[l.memoizedState,g]},useDebugValue:uG,useDeferredValue:function(l,p){var g=o0();return dG(g,l,p)},useTransition:function(){var l=wU(!1);return l=MU.bind(null,CS,l.queue,!0,!1),o0().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,p,g){var A=CS,U=o0();if(XS){if(g===void 0)throw Error(u(407));g=g()}else{if(g=p(),yT===null)throw Error(u(349));(GS&124)!==0||R5(A,p,g)}U.memoizedState=g;var q={value:g,getSnapshot:p};return U.queue=q,LU(aG.bind(null,A,q,l),[l]),A.flags|=2048,eP(9,DU(),A5.bind(null,A,q,g,p),null),g},useId:function(){var l=o0(),p=yT.identifierPrefix;if(XS){var g=tI,A=_w;g=(A&~(1<<32-e0(A)-1)).toString(32)+g,p="«"+p+"R"+g,g=AU++,0<g&&(p+="H"+g.toString(32)),p+="»"}else g=JK++,p="«"+p+"r"+g.toString(32)+"»";return l.memoizedState=p},useHostTransitionStatus:fG,useFormState:IU,useActionState:IU,useOptimistic:function(l){var p=o0();p.memoizedState=p.baseState=l;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=g,p=I1.bind(null,CS,!0,g),g.dispatch=p,[l,p]},useMemoCache:nG,useCacheRefresh:function(){return o0().memoizedState=_D.bind(null,CS)}},U5={readContext:rR,use:CU,useCallback:lG,useContext:rR,useEffect:O1,useImperativeHandle:cG,useInsertionEffect:nP,useLayoutEffect:w1,useMemo:P5,useReducer:OU,useRef:C1,useState:function(){return OU(sI)},useDebugValue:uG,useDeferredValue:function(l,p){var g=JT();return PU(g,KS.memoizedState,l,p)},useTransition:function(){var l=OU(sI)[0],p=JT().memoizedState;return[typeof l=="boolean"?l:QL(l),p]},useSyncExternalStore:oG,useId:Q0,useHostTransitionStatus:fG,useFormState:NU,useActionState:NU,useOptimistic:function(l,p){var g=JT();return $L(g,KS,l,p)},useMemoCache:nG,useCacheRefresh:$N},YI={readContext:rR,use:CU,useCallback:lG,useContext:rR,useEffect:O1,useImperativeHandle:cG,useInsertionEffect:nP,useLayoutEffect:w1,useMemo:P5,useReducer:iG,useRef:C1,useState:function(){return iG(sI)},useDebugValue:uG,useDeferredValue:function(l,p){var g=JT();return KS===null?dG(g,l,p):PU(g,KS.memoizedState,l,p)},useTransition:function(){var l=iG(sI)[0],p=JT().memoizedState;return[typeof l=="boolean"?l:QL(l),p]},useSyncExternalStore:oG,useId:Q0,useHostTransitionStatus:fG,useFormState:k5,useActionState:k5,useOptimistic:function(l,p){var g=JT();return KS!==null?$L(g,KS,l,p):(g.baseState=l,[l,g.queue.dispatch])},useMemoCache:nG,useCacheRefresh:$N},rP=null,D1=0;function jU(l){var p=D1;return D1+=1,rP===null&&(rP=[]),v5(rP,l,p)}function k1(l,p){p=p.props.ref,l.ref=p!==void 0?p:null}function L1(l,p){throw p.$$typeof===K?Error(u(525)):(l=Object.prototype.toString.call(p),Error(u(31,l==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":l)))}function j5(l){var p=l._init;return p(l._payload)}function VU(l){function p(a_,n_){if(l){var d_=a_.deletions;d_===null?(a_.deletions=[n_],a_.flags|=16):d_.push(n_)}}function g(a_,n_){if(!l)return null;for(;n_!==null;)p(a_,n_),n_=n_.sibling;return null}function A(a_){for(var n_=new Map;a_!==null;)a_.key!==null?n_.set(a_.key,a_):n_.set(a_.index,a_),a_=a_.sibling;return n_}function U(a_,n_){return a_=$O(a_,n_),a_.index=0,a_.sibling=null,a_}function q(a_,n_,d_){return a_.index=d_,l?(d_=a_.alternate,d_!==null?(d_=d_.index,d_<n_?(a_.flags|=67108866,n_):d_):(a_.flags|=67108866,n_)):(a_.flags|=1048576,n_)}function _o(a_){return l&&a_.alternate===null&&(a_.flags|=67108866),a_}function ba(a_,n_,d_,L_){return n_===null||n_.tag!==6?(n_=xF(d_,a_.mode,L_),n_.return=a_,n_):(n_=U(n_,d_),n_.return=a_,n_)}function wE(a_,n_,d_,L_){var J_=d_.type;return J_===na?R_(a_,n_,d_.props.children,L_,d_.key):n_!==null&&(n_.elementType===J_||typeof J_=="object"&&J_!==null&&J_.$$typeof===W_&&j5(J_)===n_.type)?(n_=U(n_,d_.props),k1(n_,d_),n_.return=a_,n_):(n_=p1(d_.type,d_.key,d_.props,null,a_.mode,L_),k1(n_,d_),n_.return=a_,n_)}function p_(a_,n_,d_,L_){return n_===null||n_.tag!==4||n_.stateNode.containerInfo!==d_.containerInfo||n_.stateNode.implementation!==d_.implementation?(n_=UF(d_,a_.mode,L_),n_.return=a_,n_):(n_=U(n_,d_.children||[]),n_.return=a_,n_)}function R_(a_,n_,d_,L_,J_){return n_===null||n_.tag!==7?(n_=KN(d_,a_.mode,L_,J_),n_.return=a_,n_):(n_=U(n_,d_),n_.return=a_,n_)}function x_(a_,n_,d_){if(typeof n_=="string"&&n_!==""||typeof n_=="number"||typeof n_=="bigint")return n_=xF(""+n_,a_.mode,d_),n_.return=a_,n_;if(typeof n_=="object"&&n_!==null){switch(n_.$$typeof){case $:return d_=p1(n_.type,n_.key,n_.props,null,a_.mode,d_),k1(d_,n_),d_.return=a_,d_;case _e:return n_=UF(n_,a_.mode,d_),n_.return=a_,n_;case W_:var L_=n_._init;return n_=L_(n_._payload),x_(a_,n_,d_)}if(r_(n_)||h_(n_))return n_=KN(n_,a_.mode,d_,null),n_.return=a_,n_;if(typeof n_.then=="function")return x_(a_,jU(n_),d_);if(n_.$$typeof===_f)return x_(a_,mU(a_,n_),d_);L1(a_,n_)}return null}function m_(a_,n_,d_,L_){var J_=n_!==null?n_.key:null;if(typeof d_=="string"&&d_!==""||typeof d_=="number"||typeof d_=="bigint")return J_!==null?null:ba(a_,n_,""+d_,L_);if(typeof d_=="object"&&d_!==null){switch(d_.$$typeof){case $:return d_.key===J_?wE(a_,n_,d_,L_):null;case _e:return d_.key===J_?p_(a_,n_,d_,L_):null;case W_:return J_=d_._init,d_=J_(d_._payload),m_(a_,n_,d_,L_)}if(r_(d_)||h_(d_))return J_!==null?null:R_(a_,n_,d_,L_,null);if(typeof d_.then=="function")return m_(a_,n_,jU(d_),L_);if(d_.$$typeof===_f)return m_(a_,n_,mU(a_,d_),L_);L1(a_,d_)}return null}function g_(a_,n_,d_,L_,J_){if(typeof L_=="string"&&L_!==""||typeof L_=="number"||typeof L_=="bigint")return a_=a_.get(d_)||null,ba(n_,a_,""+L_,J_);if(typeof L_=="object"&&L_!==null){switch(L_.$$typeof){case $:return a_=a_.get(L_.key===null?d_:L_.key)||null,wE(n_,a_,L_,J_);case _e:return a_=a_.get(L_.key===null?d_:L_.key)||null,p_(n_,a_,L_,J_);case W_:var PS=L_._init;return L_=PS(L_._payload),g_(a_,n_,d_,L_,J_)}if(r_(L_)||h_(L_))return a_=a_.get(d_)||null,R_(n_,a_,L_,J_,null);if(typeof L_.then=="function")return g_(a_,n_,d_,jU(L_),J_);if(L_.$$typeof===_f)return g_(a_,n_,d_,mU(n_,L_),J_);L1(n_,L_)}return null}function fS(a_,n_,d_,L_){for(var J_=null,PS=null,_b=n_,aS=n_=0,fR=null;_b!==null&&aS<d_.length;aS++){_b.index>aS?(fR=_b,_b=null):fR=_b.sibling;var HS=m_(a_,_b,d_[aS],L_);if(HS===null){_b===null&&(_b=fR);break}l&&_b&&HS.alternate===null&&p(a_,_b),n_=q(HS,n_,aS),PS===null?J_=HS:PS.sibling=HS,PS=HS,_b=fR}if(aS===d_.length)return g(a_,_b),XS&&WN(a_,aS),J_;if(_b===null){for(;aS<d_.length;aS++)_b=x_(a_,d_[aS],L_),_b!==null&&(n_=q(_b,n_,aS),PS===null?J_=_b:PS.sibling=_b,PS=_b);return XS&&WN(a_,aS),J_}for(_b=A(_b);aS<d_.length;aS++)fR=g_(_b,a_,aS,d_[aS],L_),fR!==null&&(l&&fR.alternate!==null&&_b.delete(fR.key===null?aS:fR.key),n_=q(fR,n_,aS),PS===null?J_=fR:PS.sibling=fR,PS=fR);return l&&_b.forEach(function(M0){return p(a_,M0)}),XS&&WN(a_,aS),J_}function tS(a_,n_,d_,L_){if(d_==null)throw Error(u(151));for(var J_=null,PS=null,_b=n_,aS=n_=0,fR=null,HS=d_.next();_b!==null&&!HS.done;aS++,HS=d_.next()){_b.index>aS?(fR=_b,_b=null):fR=_b.sibling;var M0=m_(a_,_b,HS.value,L_);if(M0===null){_b===null&&(_b=fR);break}l&&_b&&M0.alternate===null&&p(a_,_b),n_=q(M0,n_,aS),PS===null?J_=M0:PS.sibling=M0,PS=M0,_b=fR}if(HS.done)return g(a_,_b),XS&&WN(a_,aS),J_;if(_b===null){for(;!HS.done;aS++,HS=d_.next())HS=x_(a_,HS.value,L_),HS!==null&&(n_=q(HS,n_,aS),PS===null?J_=HS:PS.sibling=HS,PS=HS);return XS&&WN(a_,aS),J_}for(_b=A(_b);!HS.done;aS++,HS=d_.next())HS=g_(_b,a_,aS,HS.value,L_),HS!==null&&(l&&HS.alternate!==null&&_b.delete(HS.key===null?aS:HS.key),n_=q(HS,n_,aS),PS===null?J_=HS:PS.sibling=HS,PS=HS);return l&&_b.forEach(function(h2){return p(a_,h2)}),XS&&WN(a_,aS),J_}function fT(a_,n_,d_,L_){if(typeof d_=="object"&&d_!==null&&d_.type===na&&d_.key===null&&(d_=d_.props.children),typeof d_=="object"&&d_!==null){switch(d_.$$typeof){case $:t:{for(var J_=d_.key;n_!==null;){if(n_.key===J_){if(J_=d_.type,J_===na){if(n_.tag===7){g(a_,n_.sibling),L_=U(n_,d_.props.children),L_.return=a_,a_=L_;break t}}else if(n_.elementType===J_||typeof J_=="object"&&J_!==null&&J_.$$typeof===W_&&j5(J_)===n_.type){g(a_,n_.sibling),L_=U(n_,d_.props),k1(L_,d_),L_.return=a_,a_=L_;break t}g(a_,n_);break}else p(a_,n_);n_=n_.sibling}d_.type===na?(L_=KN(d_.props.children,a_.mode,L_,d_.key),L_.return=a_,a_=L_):(L_=p1(d_.type,d_.key,d_.props,null,a_.mode,L_),k1(L_,d_),L_.return=a_,a_=L_)}return _o(a_);case _e:t:{for(J_=d_.key;n_!==null;){if(n_.key===J_)if(n_.tag===4&&n_.stateNode.containerInfo===d_.containerInfo&&n_.stateNode.implementation===d_.implementation){g(a_,n_.sibling),L_=U(n_,d_.children||[]),L_.return=a_,a_=L_;break t}else{g(a_,n_);break}else p(a_,n_);n_=n_.sibling}L_=UF(d_,a_.mode,L_),L_.return=a_,a_=L_}return _o(a_);case W_:return J_=d_._init,d_=J_(d_._payload),fT(a_,n_,d_,L_)}if(r_(d_))return fS(a_,n_,d_,L_);if(h_(d_)){if(J_=h_(d_),typeof J_!="function")throw Error(u(150));return d_=J_.call(d_),tS(a_,n_,d_,L_)}if(typeof d_.then=="function")return fT(a_,n_,jU(d_),L_);if(d_.$$typeof===_f)return fT(a_,n_,mU(a_,d_),L_);L1(a_,d_)}return typeof d_=="string"&&d_!==""||typeof d_=="number"||typeof d_=="bigint"?(d_=""+d_,n_!==null&&n_.tag===6?(g(a_,n_.sibling),L_=U(n_,d_),L_.return=a_,a_=L_):(g(a_,n_),L_=xF(d_,a_.mode,L_),L_.return=a_,a_=L_),_o(a_)):g(a_,n_)}return function(a_,n_,d_,L_){try{D1=0;var J_=fT(a_,n_,d_,L_);return rP=null,J_}catch(_b){if(_b===zI||_b===_U)throw _b;var PS=RR(29,_b,null,a_.mode);return PS.lanes=L_,PS.return=a_,PS}finally{}}}var _k=VU(!0),V5=VU(!1),T0=S_(null),yO=null;function XI(l){var p=l.alternate;G_(hR,hR.current&1),G_(T0,l),yO===null&&(p===null||WL.current!==null||p.memoizedState!==null)&&(yO=l)}function B5(l){if(l.tag===22){if(G_(hR,hR.current),G_(T0,l),yO===null){var p=l.alternate;p!==null&&p.memoizedState!==null&&(yO=l)}}else JI()}function JI(){G_(hR,hR.current),G_(T0,T0.current)}function cI(l){P_(T0),yO===l&&(yO=null),P_(hR)}var hR=S_(0);function BU(l){for(var p=l;p!==null;){if(p.tag===13){var g=p.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||t2(g)))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===l)break;for(;p.sibling===null;){if(p.return===null||p.return===l)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}function FU(l,p,g,A){p=l.memoizedState,g=g(A,p),g=g==null?p:j({},p,g),l.memoizedState=g,l.lanes===0&&(l.updateQueue.baseState=g)}var bO={enqueueSetState:function(l,p,g){l=l._reactInternals;var A=u0(),U=oI(A);U.payload=p,g!=null&&(U.callback=g),p=Z0(l,U,A),p!==null&&(A0(p,l,A),aI(p,l,A))},enqueueReplaceState:function(l,p,g){l=l._reactInternals;var A=u0(),U=oI(A);U.tag=1,U.payload=p,g!=null&&(U.callback=g),p=Z0(l,U,A),p!==null&&(A0(p,l,A),aI(p,l,A))},enqueueForceUpdate:function(l,p){l=l._reactInternals;var g=u0(),A=oI(g);A.tag=2,p!=null&&(A.callback=p),p=Z0(l,A,g),p!==null&&(A0(p,l,g),aI(p,l,g))}};function F5(l,p,g,A,U,q,_o){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(A,q,_o):p.prototype&&p.prototype.isPureReactComponent?!l1(g,A)||!l1(U,q):!0}function G5(l,p,g,A){l=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(g,A),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(g,A),p.state!==l&&bO.enqueueReplaceState(p,p.state,null)}function tL(l,p){var g=p;if("ref"in p){g={};for(var A in p)A!=="ref"&&(g[A]=p[A])}if(l=l.defaultProps){g===p&&(g=j({},g));for(var U in l)g[U]===void 0&&(g[U]=l[U])}return g}var GU=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function H5(l){GU(l)}function q5(l){console.error(l)}function HU(l){GU(l)}function qU(l,p){try{var g=l.onUncaughtError;g(p.value,{componentStack:p.stack})}catch(A){setTimeout(function(){throw A})}}function z5(l,p,g){try{var A=l.onCaughtError;A(g.value,{componentStack:g.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(U){setTimeout(function(){throw U})}}function _G(l,p,g){return g=oI(g),g.tag=3,g.payload={element:null},g.callback=function(){qU(l,p)},g}function K5(l){return l=oI(l),l.tag=3,l}function W5(l,p,g,A){var U=g.type.getDerivedStateFromError;if(typeof U=="function"){var q=A.value;l.payload=function(){return U(q)},l.callback=function(){z5(p,g,A)}}var _o=g.stateNode;_o!==null&&typeof _o.componentDidCatch=="function"&&(l.callback=function(){z5(p,g,A),typeof U!="function"&&(hI===null?hI=new Set([this]):hI.add(this));var ba=A.stack;this.componentDidCatch(A.value,{componentStack:ba!==null?ba:""})})}function eW(l,p,g,A,U){if(g.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){if(p=g.alternate,p!==null&&JN(p,g,U,!0),g=T0.current,g!==null){switch(g.tag){case 13:return yO===null?aV():g.alternate===null&&qT===0&&(qT=3),g.flags&=-257,g.flags|=65536,g.lanes=U,A===zF?g.flags|=16384:(p=g.updateQueue,p===null?g.updateQueue=new Set([A]):p.add(A),FG(l,A,U)),!1;case 22:return g.flags|=65536,A===zF?g.flags|=16384:(p=g.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([A])},g.updateQueue=p):(g=p.retryQueue,g===null?p.retryQueue=new Set([A]):g.add(A)),FG(l,A,U)),!1}throw Error(u(435,g.tag))}return FG(l,A,U),aV(),!1}if(XS)return p=T0.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=U,A!==BF&&(l=Error(u(422),{cause:A}),GI(D0(l,g)))):(A!==BF&&(p=Error(u(423),{cause:A}),GI(D0(p,g))),l=l.current.alternate,l.flags|=65536,U&=-U,l.lanes|=U,A=D0(A,g),U=_G(l.stateNode,A,U),WF(l,U),qT!==4&&(qT=2)),!1;var q=Error(u(520),{cause:A});if(q=D0(q,g),F1===null?F1=[q]:F1.push(q),qT!==4&&(qT=2),p===null)return!0;A=D0(A,g),g=p;do{switch(g.tag){case 3:return g.flags|=65536,l=U&-U,g.lanes|=l,l=_G(g.stateNode,A,l),WF(g,l),!1;case 1:if(p=g.type,q=g.stateNode,(g.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(hI===null||!hI.has(q))))return g.flags|=65536,U&=-U,g.lanes|=U,U=K5(U),W5(U,l,g,A),WF(g,U),!1}g=g.return}while(g!==null);return!1}var vG=Error(u(461)),pR=!1;function CR(l,p,g,A){p.child=l===null?V5(p,null,g,A):_k(p,l.child,g,A)}function Y5(l,p,g,A,U){g=g.render;var q=p.ref;if("ref"in A){var _o={};for(var ba in A)ba!=="ref"&&(_o[ba]=A[ba])}else _o=A;return ZN(p),A=QF(l,p,g,_o,q,U),ba=$F(),l!==null&&!pR?(tG(l,p,U),uI(l,p,U)):(XS&&ba&&VF(p),p.flags|=1,CR(l,p,A,U),p.child)}function P1(l,p,g,A,U){if(l===null){var q=g.type;return typeof q=="function"&&!MF(q)&&q.defaultProps===void 0&&g.compare===null?(p.tag=15,p.type=q,zU(l,p,q,A,U)):(l=p1(g.type,null,A,p,p.mode,U),l.ref=p.ref,l.return=p,p.child=l)}if(q=l.child,!CG(l,U)){var _o=q.memoizedProps;if(g=g.compare,g=g!==null?g:l1,g(_o,A)&&l.ref===p.ref)return uI(l,p,U)}return p.flags|=1,l=$O(q,A),l.ref=p.ref,l.return=p,p.child=l}function zU(l,p,g,A,U){if(l!==null){var q=l.memoizedProps;if(l1(q,A)&&l.ref===p.ref)if(pR=!1,p.pendingProps=A=q,CG(l,U))(l.flags&131072)!==0&&(pR=!0);else return p.lanes=l.lanes,uI(l,p,U)}return bG(l,p,g,A,U)}function yG(l,p,g){var A=p.pendingProps,U=A.children,q=l!==null?l.memoizedState:null;if(A.mode==="hidden"){if((p.flags&128)!==0){if(A=q!==null?q.baseLanes|g:g,l!==null){for(U=p.child=l.child,q=0;U!==null;)q=q|U.lanes|U.childLanes,U=U.sibling;p.childLanes=q&~A}else p.childLanes=0,p.child=null;return M1(l,p,A,g)}if((g&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},l!==null&&gU(p,q!==null?q.cachePool:null),q!==null?b5(p,q):JF(),B5(p);else return p.lanes=p.childLanes=536870912,M1(l,p,q!==null?q.baseLanes|g:g,g)}else q!==null?(gU(p,q.cachePool),b5(p,q),JI(),p.memoizedState=null):(l!==null&&gU(p,null),JF(),JI());return CR(l,p,U,g),p.child}function M1(l,p,g,A){var U=GF();return U=U===null?null:{parent:dR._currentValue,pool:U},p.memoizedState={baseLanes:g,cachePool:U},l!==null&&gU(p,null),JF(),B5(p),l!==null&&JN(l,p,A,!0),null}function x1(l,p){var g=p.ref;if(g===null)l!==null&&l.ref!==null&&(p.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(u(284));(l===null||l.ref!==g)&&(p.flags|=4194816)}}function bG(l,p,g,A,U){return ZN(p),g=QF(l,p,g,A,void 0,U),A=$F(),l!==null&&!pR?(tG(l,p,U),uI(l,p,U)):(XS&&A&&VF(p),p.flags|=1,CR(l,p,g,U),p.child)}function SG(l,p,g,A,U,q){return ZN(p),p.updateQueue=null,g=T5(p,A,g,U),S5(l),A=$F(),l!==null&&!pR?(tG(l,p,q),uI(l,p,q)):(XS&&A&&VF(p),p.flags|=1,CR(l,p,g,q),p.child)}function KU(l,p,g,A,U){if(ZN(p),p.stateNode===null){var q=LR,_o=g.contextType;typeof _o=="object"&&_o!==null&&(q=rR(_o)),q=new g(A,q),p.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=bO,p.stateNode=q,q._reactInternals=p,q=p.stateNode,q.props=A,q.state=p.memoizedState,q.refs={},S1(p),_o=g.contextType,q.context=typeof _o=="object"&&_o!==null?rR(_o):LR,q.state=p.memoizedState,_o=g.getDerivedStateFromProps,typeof _o=="function"&&(FU(p,g,_o,A),q.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(_o=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),_o!==q.state&&bO.enqueueReplaceState(q,q.state,null),T1(p,A,q,U),KL(),q.state=p.memoizedState),typeof q.componentDidMount=="function"&&(p.flags|=4194308),A=!0}else if(l===null){q=p.stateNode;var ba=p.memoizedProps,wE=tL(g,ba);q.props=wE;var p_=q.context,R_=g.contextType;_o=LR,typeof R_=="object"&&R_!==null&&(_o=rR(R_));var x_=g.getDerivedStateFromProps;R_=typeof x_=="function"||typeof q.getSnapshotBeforeUpdate=="function",ba=p.pendingProps!==ba,R_||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ba||p_!==_o)&&G5(p,q,A,_o),iI=!1;var m_=p.memoizedState;q.state=m_,T1(p,A,q,U),KL(),p_=p.memoizedState,ba||m_!==p_||iI?(typeof x_=="function"&&(FU(p,g,x_,A),p_=p.memoizedState),(wE=iI||F5(p,g,wE,A,m_,p_,_o))?(R_||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(p.flags|=4194308)):(typeof q.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=A,p.memoizedState=p_),q.props=A,q.state=p_,q.context=_o,A=wE):(typeof q.componentDidMount=="function"&&(p.flags|=4194308),A=!1)}else{q=p.stateNode,SU(l,p),_o=p.memoizedProps,R_=tL(g,_o),q.props=R_,x_=p.pendingProps,m_=q.context,p_=g.contextType,wE=LR,typeof p_=="object"&&p_!==null&&(wE=rR(p_)),ba=g.getDerivedStateFromProps,(p_=typeof ba=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(_o!==x_||m_!==wE)&&G5(p,q,A,wE),iI=!1,m_=p.memoizedState,q.state=m_,T1(p,A,q,U),KL();var g_=p.memoizedState;_o!==x_||m_!==g_||iI||l!==null&&l.dependencies!==null&&fU(l.dependencies)?(typeof ba=="function"&&(FU(p,g,ba,A),g_=p.memoizedState),(R_=iI||F5(p,g,R_,A,m_,g_,wE)||l!==null&&l.dependencies!==null&&fU(l.dependencies))?(p_||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(A,g_,wE),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(A,g_,wE)),typeof q.componentDidUpdate=="function"&&(p.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof q.componentDidUpdate!="function"||_o===l.memoizedProps&&m_===l.memoizedState||(p.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||_o===l.memoizedProps&&m_===l.memoizedState||(p.flags|=1024),p.memoizedProps=A,p.memoizedState=g_),q.props=A,q.state=g_,q.context=wE,A=R_):(typeof q.componentDidUpdate!="function"||_o===l.memoizedProps&&m_===l.memoizedState||(p.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||_o===l.memoizedProps&&m_===l.memoizedState||(p.flags|=1024),A=!1)}return q=A,x1(l,p),A=(p.flags&128)!==0,q||A?(q=p.stateNode,g=A&&typeof g.getDerivedStateFromError!="function"?null:q.render(),p.flags|=1,l!==null&&A?(p.child=_k(p,l.child,null,U),p.child=_k(p,null,g,U)):CR(l,p,g,U),p.memoizedState=q.state,l=p.child):l=uI(l,p,U),l}function X5(l,p,g,A){return g1(),p.flags|=256,CR(l,p,g,A),p.child}var WU={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function YU(l){return{baseLanes:l,cachePool:_5()}}function TG(l,p,g){return l=l!==null?l.childLanes&~g:0,p&&(l|=L0),l}function RG(l,p,g){var A=p.pendingProps,U=!1,q=(p.flags&128)!==0,_o;if((_o=q)||(_o=l!==null&&l.memoizedState===null?!1:(hR.current&2)!==0),_o&&(U=!0,p.flags&=-129),_o=(p.flags&32)!==0,p.flags&=-33,l===null){if(XS){if(U?XI(p):JI(),XS){var ba=HT,wE;if(wE=ba){t:{for(wE=ba,ba=_O;wE.nodeType!==8;){if(!ba){ba=null;break t}if(wE=nO(wE.nextSibling),wE===null){ba=null;break t}}ba=wE}ba!==null?(p.memoizedState={dehydrated:ba,treeContext:gO!==null?{id:_w,overflow:tI}:null,retryLane:536870912,hydrationErrors:null},wE=RR(18,null,null,0),wE.stateNode=ba,wE.return=p,p.child=wE,AR=p,HT=null,wE=!0):wE=!1}wE||XN(p)}if(ba=p.memoizedState,ba!==null&&(ba=ba.dehydrated,ba!==null))return t2(ba)?p.lanes=32:p.lanes=536870912,null;cI(p)}return ba=A.children,A=A.fallback,U?(JI(),U=p.mode,ba=JU({mode:"hidden",children:ba},U),A=KN(A,U,g,null),ba.return=p,A.return=p,ba.sibling=A,p.child=ba,U=p.child,U.memoizedState=YU(g),U.childLanes=TG(l,_o,g),p.memoizedState=WU,A):(XI(p),XU(p,ba))}if(wE=l.memoizedState,wE!==null&&(ba=wE.dehydrated,ba!==null)){if(q)p.flags&256?(XI(p),p.flags&=-257,p=AG(l,p,g)):p.memoizedState!==null?(JI(),p.child=l.child,p.flags|=128,p=null):(JI(),U=A.fallback,ba=p.mode,A=JU({mode:"visible",children:A.children},ba),U=KN(U,ba,g,null),U.flags|=2,A.return=p,U.return=p,A.sibling=U,p.child=A,_k(p,l.child,null,g),A=p.child,A.memoizedState=YU(g),A.childLanes=TG(l,_o,g),p.memoizedState=WU,p=U);else if(XI(p),t2(ba)){if(_o=ba.nextSibling&&ba.nextSibling.dataset,_o)var p_=_o.dgst;_o=p_,A=Error(u(419)),A.stack="",A.digest=_o,GI({value:A,source:null,stack:null}),p=AG(l,p,g)}else if(pR||JN(l,p,g,!1),_o=(g&l.childLanes)!==0,pR||_o){if(_o=yT,_o!==null&&(A=g&-g,A=(A&42)!==0?1:M3(A),A=(A&(_o.suspendedLanes|g))!==0?0:A,A!==0&&A!==wE.retryLane))throw wE.retryLane=A,BI(l,A),A0(_o,l,A),vG;ba.data==="$?"||aV(),p=AG(l,p,g)}else ba.data==="$?"?(p.flags|=192,p.child=l.child,p=null):(l=wE.treeContext,HT=nO(ba.nextSibling),AR=p,XS=!0,YN=null,_O=!1,l!==null&&(k0[S0++]=_w,k0[S0++]=tI,k0[S0++]=gO,_w=l.id,tI=l.overflow,gO=p),p=XU(p,A.children),p.flags|=4096);return p}return U?(JI(),U=A.fallback,ba=p.mode,wE=l.child,p_=wE.sibling,A=$O(wE,{mode:"hidden",children:A.children}),A.subtreeFlags=wE.subtreeFlags&65011712,p_!==null?U=$O(p_,U):(U=KN(U,ba,g,null),U.flags|=2),U.return=p,A.return=p,A.sibling=U,p.child=A,A=U,U=p.child,ba=l.child.memoizedState,ba===null?ba=YU(g):(wE=ba.cachePool,wE!==null?(p_=dR._currentValue,wE=wE.parent!==p_?{parent:p_,pool:p_}:wE):wE=_5(),ba={baseLanes:ba.baseLanes|g,cachePool:wE}),U.memoizedState=ba,U.childLanes=TG(l,_o,g),p.memoizedState=WU,A):(XI(p),g=l.child,l=g.sibling,g=$O(g,{mode:"visible",children:A.children}),g.return=p,g.sibling=null,l!==null&&(_o=p.deletions,_o===null?(p.deletions=[l],p.flags|=16):_o.push(l)),p.child=g,p.memoizedState=null,g)}function XU(l,p){return p=JU({mode:"visible",children:p},l.mode),p.return=l,l.child=p}function JU(l,p){return l=RR(22,l,null,p),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function AG(l,p,g){return _k(p,l.child,null,g),l=XU(p,p.pendingProps.children),l.flags|=2,p.memoizedState=null,l}function J5(l,p,g){l.lanes|=p;var A=l.alternate;A!==null&&(A.lanes|=p),hU(l.return,p,g)}function iP(l,p,g,A,U){var q=l.memoizedState;q===null?l.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:A,tail:g,tailMode:U}:(q.isBackwards=p,q.rendering=null,q.renderingStartTime=0,q.last=A,q.tail=g,q.tailMode=U)}function Z5(l,p,g){var A=p.pendingProps,U=A.revealOrder,q=A.tail;if(CR(l,p,A.children,g),A=hR.current,(A&2)!==0)A=A&1|2,p.flags|=128;else{if(l!==null&&(l.flags&128)!==0)t:for(l=p.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&J5(l,g,p);else if(l.tag===19)J5(l,g,p);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===p)break t;for(;l.sibling===null;){if(l.return===null||l.return===p)break t;l=l.return}l.sibling.return=l.return,l=l.sibling}A&=1}switch(G_(hR,A),U){case"forwards":for(g=p.child,U=null;g!==null;)l=g.alternate,l!==null&&BU(l)===null&&(U=g),g=g.sibling;g=U,g===null?(U=p.child,p.child=null):(U=g.sibling,g.sibling=null),iP(p,!1,U,g,q);break;case"backwards":for(g=null,U=p.child,p.child=null;U!==null;){if(l=U.alternate,l!==null&&BU(l)===null){p.child=U;break}l=U.sibling,U.sibling=g,g=U,U=l}iP(p,!0,g,null,q);break;case"together":iP(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function uI(l,p,g){if(l!==null&&(p.dependencies=l.dependencies),oN|=p.lanes,(g&p.childLanes)===0)if(l!==null){if(JN(l,p,g,!1),(g&p.childLanes)===0)return null}else return null;if(l!==null&&p.child!==l.child)throw Error(u(153));if(p.child!==null){for(l=p.child,g=$O(l,l.pendingProps),p.child=g,g.return=p;l.sibling!==null;)l=l.sibling,g=g.sibling=$O(l,l.pendingProps),g.return=p;g.sibling=null}return p.child}function CG(l,p){return(l.lanes&p)!==0?!0:(l=l.dependencies,!!(l!==null&&fU(l)))}function Q5(l,p,g){switch(p.tag){case 3:FS(p,p.stateNode.containerInfo),HI(p,dR,l.memoizedState.cache),g1();break;case 27:case 5:WO(p);break;case 4:FS(p,p.stateNode.containerInfo);break;case 10:HI(p,p.type,p.memoizedProps.value);break;case 13:var A=p.memoizedState;if(A!==null)return A.dehydrated!==null?(XI(p),p.flags|=128,null):(g&p.child.childLanes)!==0?RG(l,p,g):(XI(p),l=uI(l,p,g),l!==null?l.sibling:null);XI(p);break;case 19:var U=(l.flags&128)!==0;if(A=(g&p.childLanes)!==0,A||(JN(l,p,g,!1),A=(g&p.childLanes)!==0),U){if(A)return Z5(l,p,g);p.flags|=128}if(U=p.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),G_(hR,hR.current),A)break;return null;case 22:case 23:return p.lanes=0,yG(l,p,g);case 24:HI(p,dR,l.memoizedState.cache)}return uI(l,p,g)}function $5(l,p,g){if(l!==null)if(l.memoizedProps!==p.pendingProps)pR=!0;else{if(!CG(l,g)&&(p.flags&128)===0)return pR=!1,Q5(l,p,g);pR=(l.flags&131072)!==0}else pR=!1,XS&&(p.flags&1048576)!==0&&h5(p,m1,p.index);switch(p.lanes=0,p.tag){case 16:t:{l=p.pendingProps;var A=p.elementType,U=A._init;if(A=U(A._payload),p.type=A,typeof A=="function")MF(A)?(l=tL(A,l),p.tag=1,p=KU(null,p,A,l,g)):(p.tag=0,p=bG(null,p,A,l,g));else{if(A!=null){if(U=A.$$typeof,U===E_){p.tag=11,p=Y5(null,p,A,l,g);break t}else if(U===w_){p.tag=14,p=P1(null,p,A,l,g);break t}}throw p=e_(A)||A,Error(u(306,p,""))}}return p;case 0:return bG(l,p,p.type,p.pendingProps,g);case 1:return A=p.type,U=tL(A,p.pendingProps),KU(l,p,A,U,g);case 3:t:{if(FS(p,p.stateNode.containerInfo),l===null)throw Error(u(387));A=p.pendingProps;var q=p.memoizedState;U=q.element,SU(l,p),T1(p,A,null,g);var _o=p.memoizedState;if(A=_o.cache,HI(p,dR,A),A!==q.cache&&pU(p,[dR],g,!0),KL(),A=_o.element,q.isDehydrated)if(q={element:A,isDehydrated:!1,cache:_o.cache},p.updateQueue.baseState=q,p.memoizedState=q,p.flags&256){p=X5(l,p,A,g);break t}else if(A!==U){U=D0(Error(u(424)),p),GI(U),p=X5(l,p,A,g);break t}else{switch(l=p.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(HT=nO(l.firstChild),AR=p,XS=!0,YN=null,_O=!0,g=V5(p,null,A,g),p.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling}else{if(g1(),A===U){p=uI(l,p,g);break t}CR(l,p,A,g)}p=p.child}return p;case 26:return x1(l,p),l===null?(g=B4(p.type,null,p.pendingProps,null))?p.memoizedState=g:XS||(g=p.type,l=p.pendingProps,A=yV(Z_.current).createElement(g),A[hT]=p,A[n0]=l,OR(A,g,l),eR(A),p.stateNode=A):p.memoizedState=B4(p.type,l.memoizedProps,p.pendingProps,l.memoizedState),null;case 27:return WO(p),l===null&&XS&&(A=p.stateNode=x4(p.type,p.pendingProps,Z_.current),AR=p,_O=!0,U=HT,dN(p.type)?(e2=U,HT=nO(A.firstChild)):HT=U),CR(l,p,p.pendingProps.children,g),x1(l,p),l===null&&(p.flags|=4194304),p.child;case 5:return l===null&&XS&&((U=A=HT)&&(A=mW(A,p.type,p.pendingProps,_O),A!==null?(p.stateNode=A,AR=p,HT=nO(A.firstChild),_O=!1,U=!0):U=!1),U||XN(p)),WO(p),U=p.type,q=p.pendingProps,_o=l!==null?l.memoizedProps:null,A=q.children,JG(U,q)?A=null:_o!==null&&JG(U,_o)&&(p.flags|=32),p.memoizedState!==null&&(U=QF(l,p,ZK,null,null,g),bP._currentValue=U),x1(l,p),CR(l,p,A,g),p.child;case 6:return l===null&&XS&&((l=g=HT)&&(g=EW(g,p.pendingProps,_O),g!==null?(p.stateNode=g,AR=p,HT=null,l=!0):l=!1),l||XN(p)),null;case 13:return RG(l,p,g);case 4:return FS(p,p.stateNode.containerInfo),A=p.pendingProps,l===null?p.child=_k(p,null,A,g):CR(l,p,A,g),p.child;case 11:return Y5(l,p,p.type,p.pendingProps,g);case 7:return CR(l,p,p.pendingProps,g),p.child;case 8:return CR(l,p,p.pendingProps.children,g),p.child;case 12:return CR(l,p,p.pendingProps.children,g),p.child;case 10:return A=p.pendingProps,HI(p,p.type,A.value),CR(l,p,A.children,g),p.child;case 9:return U=p.type._context,A=p.pendingProps.children,ZN(p),U=rR(U),A=A(U),p.flags|=1,CR(l,p,A,g),p.child;case 14:return P1(l,p,p.type,p.pendingProps,g);case 15:return zU(l,p,p.type,p.pendingProps,g);case 19:return Z5(l,p,g);case 31:return A=p.pendingProps,g=p.mode,A={mode:A.mode,children:A.children},l===null?(g=JU(A,g),g.ref=p.ref,p.child=g,g.return=p,p=g):(g=$O(l.child,A),g.ref=p.ref,p.child=g,g.return=p,p=g),p;case 22:return yG(l,p,g);case 24:return ZN(p),A=rR(dR),l===null?(U=GF(),U===null&&(U=yT,q=EU(),U.pooledCache=q,q.refCount++,q!==null&&(U.pooledCacheLanes|=g),U=q),p.memoizedState={parent:A,cache:U},S1(p),HI(p,dR,U)):((l.lanes&g)!==0&&(SU(l,p),T1(p,null,null,g),KL()),U=l.memoizedState,q=p.memoizedState,U.parent!==A?(U={parent:A,cache:A},p.memoizedState=U,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=U),HI(p,dR,A)):(A=q.cache,HI(p,dR,A),A!==U.cache&&pU(p,[dR],g,!0))),CR(l,p,p.pendingProps.children,g),p.child;case 29:throw p.pendingProps}throw Error(u(156,p.tag))}function lI(l){l.flags|=4}function ZU(l,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!K4(p)){if(p=T0.current,p!==null&&((GS&4194048)===GS?yO!==null:(GS&62914560)!==GS&&(GS&536870912)===0||p!==yO))throw b1=zF,HF;l.flags|=8192}}function QU(l,p){p!==null&&(l.flags|=4),l.flags&16384&&(p=l.tag!==22?L3():536870912,l.lanes|=p,aN|=p)}function eL(l,p){if(!XS)switch(l.tailMode){case"hidden":p=l.tail;for(var g=null;p!==null;)p.alternate!==null&&(g=p),p=p.sibling;g===null?l.tail=null:g.sibling=null;break;case"collapsed":g=l.tail;for(var A=null;g!==null;)g.alternate!==null&&(A=g),g=g.sibling;A===null?p||l.tail===null?l.tail=null:l.tail.sibling=null:A.sibling=null}}function xT(l){var p=l.alternate!==null&&l.alternate.child===l.child,g=0,A=0;if(p)for(var U=l.child;U!==null;)g|=U.lanes|U.childLanes,A|=U.subtreeFlags&65011712,A|=U.flags&65011712,U.return=l,U=U.sibling;else for(U=l.child;U!==null;)g|=U.lanes|U.childLanes,A|=U.subtreeFlags,A|=U.flags,U.return=l,U=U.sibling;return l.subtreeFlags|=A,l.childLanes=g,p}function t4(l,p,g){var A=p.pendingProps;switch(dU(p),p.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xT(p),null;case 1:return xT(p),null;case 3:return g=p.stateNode,A=null,l!==null&&(A=l.memoizedState.cache),p.memoizedState.cache!==A&&(p.flags|=2048),rI(dR),t0(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(l===null||l.child===null)&&(E1(p)?lI(p):l===null||l.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,m5())),xT(p),null;case 26:return g=p.memoizedState,l===null?(lI(p),g!==null?(xT(p),ZU(p,g)):(xT(p),p.flags&=-16777217)):g?g!==l.memoizedState?(lI(p),xT(p),ZU(p,g)):(xT(p),p.flags&=-16777217):(l.memoizedProps!==A&&lI(p),xT(p),p.flags&=-16777217),null;case 27:YO(p),g=Z_.current;var U=p.type;if(l!==null&&p.stateNode!=null)l.memoizedProps!==A&&lI(p);else{if(!A){if(p.stateNode===null)throw Error(u(166));return xT(p),null}l=lb.current,E1(p)?p5(p):(l=x4(U,A,g),p.stateNode=l,lI(p))}return xT(p),null;case 5:if(YO(p),g=p.type,l!==null&&p.stateNode!=null)l.memoizedProps!==A&&lI(p);else{if(!A){if(p.stateNode===null)throw Error(u(166));return xT(p),null}if(l=lb.current,E1(p))p5(p);else{switch(U=yV(Z_.current),l){case 1:l=U.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:l=U.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":l=U.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":l=U.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":l=U.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof A.is=="string"?U.createElement("select",{is:A.is}):U.createElement("select"),A.multiple?l.multiple=!0:A.size&&(l.size=A.size);break;default:l=typeof A.is=="string"?U.createElement(g,{is:A.is}):U.createElement(g)}}l[hT]=p,l[n0]=A;t:for(U=p.child;U!==null;){if(U.tag===5||U.tag===6)l.appendChild(U.stateNode);else if(U.tag!==4&&U.tag!==27&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===p)break t;for(;U.sibling===null;){if(U.return===null||U.return===p)break t;U=U.return}U.sibling.return=U.return,U=U.sibling}p.stateNode=l;t:switch(OR(l,g,A),g){case"button":case"input":case"select":case"textarea":l=!!A.autoFocus;break t;case"img":l=!0;break t;default:l=!1}l&&lI(p)}}return xT(p),p.flags&=-16777217,null;case 6:if(l&&p.stateNode!=null)l.memoizedProps!==A&&lI(p);else{if(typeof A!="string"&&p.stateNode===null)throw Error(u(166));if(l=Z_.current,E1(p)){if(l=p.stateNode,g=p.memoizedProps,A=null,U=AR,U!==null)switch(U.tag){case 27:case 5:A=U.memoizedProps}l[hT]=p,l=!!(l.nodeValue===g||A!==null&&A.suppressHydrationWarning===!0||N4(l.nodeValue,g)),l||XN(p)}else l=yV(l).createTextNode(A),l[hT]=p,p.stateNode=l}return xT(p),null;case 13:if(A=p.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(U=E1(p),A!==null&&A.dehydrated!==null){if(l===null){if(!U)throw Error(u(318));if(U=p.memoizedState,U=U!==null?U.dehydrated:null,!U)throw Error(u(317));U[hT]=p}else g1(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;xT(p),U=!1}else U=m5(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=U),U=!0;if(!U)return p.flags&256?(cI(p),p):(cI(p),null)}if(cI(p),(p.flags&128)!==0)return p.lanes=g,p;if(g=A!==null,l=l!==null&&l.memoizedState!==null,g){A=p.child,U=null,A.alternate!==null&&A.alternate.memoizedState!==null&&A.alternate.memoizedState.cachePool!==null&&(U=A.alternate.memoizedState.cachePool.pool);var q=null;A.memoizedState!==null&&A.memoizedState.cachePool!==null&&(q=A.memoizedState.cachePool.pool),q!==U&&(A.flags|=2048)}return g!==l&&g&&(p.child.flags|=8192),QU(p,p.updateQueue),xT(p),null;case 4:return t0(),l===null&&lN(p.stateNode.containerInfo),xT(p),null;case 10:return rI(p.type),xT(p),null;case 19:if(P_(hR),U=p.memoizedState,U===null)return xT(p),null;if(A=(p.flags&128)!==0,q=U.rendering,q===null)if(A)eL(U,!1);else{if(qT!==0||l!==null&&(l.flags&128)!==0)for(l=p.child;l!==null;){if(q=BU(l),q!==null){for(p.flags|=128,eL(U,!1),l=q.updateQueue,p.updateQueue=l,QU(p,l),p.subtreeFlags=0,l=g,g=p.child;g!==null;)d5(g,l),g=g.sibling;return G_(hR,hR.current&1|2),p.child}l=l.sibling}U.tail!==null&&mO()>cP&&(p.flags|=128,A=!0,eL(U,!1),p.lanes=4194304)}else{if(!A)if(l=BU(q),l!==null){if(p.flags|=128,A=!0,l=l.updateQueue,p.updateQueue=l,QU(p,l),eL(U,!0),U.tail===null&&U.tailMode==="hidden"&&!q.alternate&&!XS)return xT(p),null}else 2*mO()-U.renderingStartTime>cP&&g!==536870912&&(p.flags|=128,A=!0,eL(U,!1),p.lanes=4194304);U.isBackwards?(q.sibling=p.child,p.child=q):(l=U.last,l!==null?l.sibling=q:p.child=q,U.last=q)}return U.tail!==null?(p=U.tail,U.rendering=p,U.tail=p.sibling,U.renderingStartTime=mO(),p.sibling=null,l=hR.current,G_(hR,A?l&1|2:l&1),p):(xT(p),null);case 22:case 23:return cI(p),ZF(),A=p.memoizedState!==null,l!==null?l.memoizedState!==null!==A&&(p.flags|=8192):A&&(p.flags|=8192),A?(g&536870912)!==0&&(p.flags&128)===0&&(xT(p),p.subtreeFlags&6&&(p.flags|=8192)):xT(p),g=p.updateQueue,g!==null&&QU(p,g.retryQueue),g=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(g=l.memoizedState.cachePool.pool),A=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(A=p.memoizedState.cachePool.pool),A!==g&&(p.flags|=2048),l!==null&&P_(QN),null;case 24:return g=null,l!==null&&(g=l.memoizedState.cache),p.memoizedState.cache!==g&&(p.flags|=2048),rI(dR),xT(p),null;case 25:return null;case 30:return null}throw Error(u(156,p.tag))}function nW(l,p){switch(dU(p),p.tag){case 1:return l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 3:return rI(dR),t0(),l=p.flags,(l&65536)!==0&&(l&128)===0?(p.flags=l&-65537|128,p):null;case 26:case 27:case 5:return YO(p),null;case 13:if(cI(p),l=p.memoizedState,l!==null&&l.dehydrated!==null){if(p.alternate===null)throw Error(u(340));g1()}return l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 19:return P_(hR),null;case 4:return t0(),null;case 10:return rI(p.type),null;case 22:case 23:return cI(p),ZF(),l!==null&&P_(QN),l=p.flags,l&65536?(p.flags=l&-65537|128,p):null;case 24:return rI(dR),null;case 25:return null;default:return null}}function e4(l,p){switch(dU(p),p.tag){case 3:rI(dR),t0();break;case 26:case 27:case 5:YO(p);break;case 4:t0();break;case 13:cI(p);break;case 19:P_(hR);break;case 10:rI(p.type);break;case 22:case 23:cI(p),ZF(),l!==null&&P_(QN);break;case 24:rI(dR)}}function oP(l,p){try{var g=p.updateQueue,A=g!==null?g.lastEffect:null;if(A!==null){var U=A.next;g=U;do{if((g.tag&l)===l){A=void 0;var q=g.create,_o=g.inst;A=q(),_o.destroy=A}g=g.next}while(g!==U)}}catch(ba){bT(p,p.return,ba)}}function ZI(l,p,g){try{var A=p.updateQueue,U=A!==null?A.lastEffect:null;if(U!==null){var q=U.next;A=q;do{if((A.tag&l)===l){var _o=A.inst,ba=_o.destroy;if(ba!==void 0){_o.destroy=void 0,U=p;var wE=g,p_=ba;try{p_()}catch(R_){bT(U,wE,R_)}}}A=A.next}while(A!==q)}}catch(R_){bT(p,p.return,R_)}}function n4(l){var p=l.updateQueue;if(p!==null){var g=l.stateNode;try{XF(p,g)}catch(A){bT(l,l.return,A)}}}function OG(l,p,g){g.props=tL(l.type,l.memoizedProps),g.state=l.memoizedState;try{g.componentWillUnmount()}catch(A){bT(l,p,A)}}function U1(l,p){try{var g=l.ref;if(g!==null){switch(l.tag){case 26:case 27:case 5:var A=l.stateNode;break;case 30:A=l.stateNode;break;default:A=l.stateNode}typeof g=="function"?l.refCleanup=g(A):g.current=A}}catch(U){bT(l,p,U)}}function _A(l,p){var g=l.ref,A=l.refCleanup;if(g!==null)if(typeof A=="function")try{A()}catch(U){bT(l,p,U)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(U){bT(l,p,U)}else g.current=null}function $U(l){var p=l.type,g=l.memoizedProps,A=l.stateNode;try{t:switch(p){case"button":case"input":case"select":case"textarea":g.autoFocus&&A.focus();break t;case"img":g.src?A.src=g.src:g.srcSet&&(A.srcset=g.srcSet)}}catch(U){bT(l,l.return,U)}}function wG(l,p,g){try{var A=l.stateNode;lW(A,l.type,g,p),A[n0]=p}catch(U){bT(l,l.return,U)}}function r4(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&dN(l.type)||l.tag===4}function nL(l){t:for(;;){for(;l.sibling===null;){if(l.return===null||r4(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&dN(l.type)||l.flags&2||l.child===null||l.tag===4)continue t;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function _j(l,p,g){var A=l.tag;if(A===5||A===6)l=l.stateNode,p?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(l,p):(p=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,p.appendChild(l),g=g._reactRootContainer,g!=null||p.onclick!==null||(p.onclick=vV));else if(A!==4&&(A===27&&dN(l.type)&&(g=l.stateNode,p=null),l=l.child,l!==null))for(_j(l,p,g),l=l.sibling;l!==null;)_j(l,p,g),l=l.sibling}function QI(l,p,g){var A=l.tag;if(A===5||A===6)l=l.stateNode,p?g.insertBefore(l,p):g.appendChild(l);else if(A!==4&&(A===27&&dN(l.type)&&(g=l.stateNode),l=l.child,l!==null))for(QI(l,p,g),l=l.sibling;l!==null;)QI(l,p,g),l=l.sibling}function rL(l){var p=l.stateNode,g=l.memoizedProps;try{for(var A=l.type,U=p.attributes;U.length;)p.removeAttributeNode(U[0]);OR(p,A,g),p[hT]=l,p[n0]=g}catch(q){bT(l,l.return,q)}}var SO=!1,UT=!1,aP=!1,i4=typeof WeakSet=="function"?WeakSet:Set,vR=null;function rW(l,p){if(l=l.containerInfo,YG=AV,l=r5(l),qR(l)){if("selectionStart"in l)var g={start:l.selectionStart,end:l.selectionEnd};else t:{g=(g=l.ownerDocument)&&g.defaultView||window;var A=g.getSelection&&g.getSelection();if(A&&A.rangeCount!==0){g=A.anchorNode;var U=A.anchorOffset,q=A.focusNode;A=A.focusOffset;try{g.nodeType,q.nodeType}catch{g=null;break t}var _o=0,ba=-1,wE=-1,p_=0,R_=0,x_=l,m_=null;e:for(;;){for(var g_;x_!==g||U!==0&&x_.nodeType!==3||(ba=_o+U),x_!==q||A!==0&&x_.nodeType!==3||(wE=_o+A),x_.nodeType===3&&(_o+=x_.nodeValue.length),(g_=x_.firstChild)!==null;)m_=x_,x_=g_;for(;;){if(x_===l)break e;if(m_===g&&++p_===U&&(ba=_o),m_===q&&++R_===A&&(wE=_o),(g_=x_.nextSibling)!==null)break;x_=m_,m_=x_.parentNode}x_=g_}g=ba===-1||wE===-1?null:{start:ba,end:wE}}else g=null}g=g||{start:0,end:0}}else g=null;for(XG={focusedElem:l,selectionRange:g},AV=!1,vR=p;vR!==null;)if(p=vR,l=p.child,(p.subtreeFlags&1024)!==0&&l!==null)l.return=p,vR=l;else for(;vR!==null;){switch(p=vR,q=p.alternate,l=p.flags,p.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&q!==null){l=void 0,g=p,U=q.memoizedProps,q=q.memoizedState,A=g.stateNode;try{var fS=tL(g.type,U,g.elementType===g.type);l=A.getSnapshotBeforeUpdate(fS,q),A.__reactInternalSnapshotBeforeUpdate=l}catch(tS){bT(g,g.return,tS)}}break;case 3:if((l&1024)!==0){if(l=p.stateNode.containerInfo,g=l.nodeType,g===9)$G(l);else if(g===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":$G(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(u(163))}if(l=p.sibling,l!==null){l.return=p.return,vR=l;break}vR=p.return}}function IG(l,p,g){var A=g.flags;switch(g.tag){case 0:case 11:case 15:dI(l,g),A&4&&oP(5,g);break;case 1:if(dI(l,g),A&4)if(l=g.stateNode,p===null)try{l.componentDidMount()}catch(_o){bT(g,g.return,_o)}else{var U=tL(g.type,p.memoizedProps);p=p.memoizedState;try{l.componentDidUpdate(U,p,l.__reactInternalSnapshotBeforeUpdate)}catch(_o){bT(g,g.return,_o)}}A&64&&n4(g),A&512&&U1(g,g.return);break;case 3:if(dI(l,g),A&64&&(l=g.updateQueue,l!==null)){if(p=null,g.child!==null)switch(g.child.tag){case 27:case 5:p=g.child.stateNode;break;case 1:p=g.child.stateNode}try{XF(l,p)}catch(_o){bT(g,g.return,_o)}}break;case 27:p===null&&A&4&&rL(g);case 26:case 5:dI(l,g),p===null&&A&4&&$U(g),A&512&&U1(g,g.return);break;case 12:dI(l,g);break;case 13:dI(l,g),A&4&&a4(l,g),A&64&&(l=g.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(g=HG.bind(null,g),gW(l,g))));break;case 22:if(A=g.memoizedState!==null||SO,!A){p=p!==null&&p.memoizedState!==null||UT,U=SO;var q=UT;SO=A,(UT=p)&&!q?tN(l,g,(g.subtreeFlags&8772)!==0):dI(l,g),SO=U,UT=q}break;case 30:break;default:dI(l,g)}}function o4(l){var p=l.alternate;p!==null&&(l.alternate=null,o4(p)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(p=l.stateNode,p!==null&&zM(p)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var PT=null,a0=!1;function qA(l,p,g){for(g=g.child;g!==null;)j1(l,p,g),g=g.sibling}function j1(l,p,g){if(vT&&typeof vT.onCommitFiberUnmount=="function")try{vT.onCommitFiberUnmount(wL,g)}catch{}switch(g.tag){case 26:UT||_A(g,p),qA(l,p,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:UT||_A(g,p);var A=PT,U=a0;dN(g.type)&&(PT=g.stateNode,a0=!1),qA(l,p,g),J1(g.stateNode),PT=A,a0=U;break;case 5:UT||_A(g,p);case 6:if(A=PT,U=a0,PT=null,qA(l,p,g),PT=A,a0=U,PT!==null)if(a0)try{(PT.nodeType===9?PT.body:PT.nodeName==="HTML"?PT.ownerDocument.body:PT).removeChild(g.stateNode)}catch(q){bT(g,p,q)}else try{PT.removeChild(g.stateNode)}catch(q){bT(g,p,q)}break;case 18:PT!==null&&(a0?(l=PT,P4(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,g.stateNode),d0(l)):P4(PT,g.stateNode));break;case 4:A=PT,U=a0,PT=g.stateNode.containerInfo,a0=!0,qA(l,p,g),PT=A,a0=U;break;case 0:case 11:case 14:case 15:UT||ZI(2,g,p),UT||ZI(4,g,p),qA(l,p,g);break;case 1:UT||(_A(g,p),A=g.stateNode,typeof A.componentWillUnmount=="function"&&OG(g,p,A)),qA(l,p,g);break;case 21:qA(l,p,g);break;case 22:UT=(A=UT)||g.memoizedState!==null,qA(l,p,g),UT=A;break;default:qA(l,p,g)}}function a4(l,p){if(p.memoizedState===null&&(l=p.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{d0(l)}catch(g){bT(p,p.return,g)}}function sP(l){switch(l.tag){case 13:case 19:var p=l.stateNode;return p===null&&(p=l.stateNode=new i4),p;case 22:return l=l.stateNode,p=l._retryCache,p===null&&(p=l._retryCache=new i4),p;default:throw Error(u(435,l.tag))}}function $j(l,p){var g=sP(l);p.forEach(function(A){var U=aW.bind(null,l,A);g.has(A)||(g.add(A),A.then(U,U))})}function DT(l,p){var g=p.deletions;if(g!==null)for(var A=0;A<g.length;A++){var U=g[A],q=l,_o=p,ba=_o;t:for(;ba!==null;){switch(ba.tag){case 27:if(dN(ba.type)){PT=ba.stateNode,a0=!1;break t}break;case 5:PT=ba.stateNode,a0=!1;break t;case 3:case 4:PT=ba.stateNode.containerInfo,a0=!0;break t}ba=ba.return}if(PT===null)throw Error(u(160));j1(q,_o,U),PT=null,a0=!1,q=U.alternate,q!==null&&(q.return=null),U.return=null}if(p.subtreeFlags&13878)for(p=p.child;p!==null;)s4(p,l),p=p.sibling}var _C=null;function s4(l,p){var g=l.alternate,A=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:DT(p,l),s0(l),A&4&&(ZI(3,l,l.return),oP(3,l),ZI(5,l,l.return));break;case 1:DT(p,l),s0(l),A&512&&(UT||g===null||_A(g,g.return)),A&64&&SO&&(l=l.updateQueue,l!==null&&(A=l.callbacks,A!==null&&(g=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=g===null?A:g.concat(A))));break;case 26:var U=_C;if(DT(p,l),s0(l),A&512&&(UT||g===null||_A(g,g.return)),A&4){var q=g!==null?g.memoizedState:null;if(A=l.memoizedState,g===null)if(A===null)if(l.stateNode===null){t:{A=l.type,g=l.memoizedProps,U=U.ownerDocument||U;e:switch(A){case"title":q=U.getElementsByTagName("title")[0],(!q||q[e1]||q[hT]||q.namespaceURI==="http://www.w3.org/2000/svg"||q.hasAttribute("itemprop"))&&(q=U.createElement(A),U.head.insertBefore(q,U.querySelector("head > title"))),OR(q,A,g),q[hT]=l,eR(q),A=q;break t;case"link":var _o=q4("link","href",U).get(A+(g.href||""));if(_o){for(var ba=0;ba<_o.length;ba++)if(q=_o[ba],q.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&q.getAttribute("rel")===(g.rel==null?null:g.rel)&&q.getAttribute("title")===(g.title==null?null:g.title)&&q.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){_o.splice(ba,1);break e}}q=U.createElement(A),OR(q,A,g),U.head.appendChild(q);break;case"meta":if(_o=q4("meta","content",U).get(A+(g.content||""))){for(ba=0;ba<_o.length;ba++)if(q=_o[ba],q.getAttribute("content")===(g.content==null?null:""+g.content)&&q.getAttribute("name")===(g.name==null?null:g.name)&&q.getAttribute("property")===(g.property==null?null:g.property)&&q.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&q.getAttribute("charset")===(g.charSet==null?null:g.charSet)){_o.splice(ba,1);break e}}q=U.createElement(A),OR(q,A,g),U.head.appendChild(q);break;default:throw Error(u(468,A))}q[hT]=l,eR(q),A=q}l.stateNode=A}else z4(U,l.type,l.stateNode);else l.stateNode=H4(U,A,l.memoizedProps);else q!==A?(q===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):q.count--,A===null?z4(U,l.type,l.stateNode):H4(U,A,l.memoizedProps)):A===null&&l.stateNode!==null&&wG(l,l.memoizedProps,g.memoizedProps)}break;case 27:DT(p,l),s0(l),A&512&&(UT||g===null||_A(g,g.return)),g!==null&&A&4&&wG(l,l.memoizedProps,g.memoizedProps);break;case 5:if(DT(p,l),s0(l),A&512&&(UT||g===null||_A(g,g.return)),l.flags&32){U=l.stateNode;try{FN(U,"")}catch(g_){bT(l,l.return,g_)}}A&4&&l.stateNode!=null&&(U=l.memoizedProps,wG(l,U,g!==null?g.memoizedProps:U)),A&1024&&(aP=!0);break;case 6:if(DT(p,l),s0(l),A&4){if(l.stateNode===null)throw Error(u(162));A=l.memoizedProps,g=l.stateNode;try{g.nodeValue=A}catch(g_){bT(l,l.return,g_)}}break;case 3:if($1=null,U=_C,_C=bV(p.containerInfo),DT(p,l),_C=U,s0(l),A&4&&g!==null&&g.memoizedState.isDehydrated)try{d0(p.containerInfo)}catch(g_){bT(l,l.return,g_)}aP&&(aP=!1,c4(l));break;case 4:A=_C,_C=bV(l.stateNode.containerInfo),DT(p,l),s0(l),_C=A;break;case 12:DT(p,l),s0(l);break;case 13:DT(p,l),s0(l),l.child.flags&8192&&l.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(xG=mO()),A&4&&(A=l.updateQueue,A!==null&&(l.updateQueue=null,$j(l,A)));break;case 22:U=l.memoizedState!==null;var wE=g!==null&&g.memoizedState!==null,p_=SO,R_=UT;if(SO=p_||U,UT=R_||wE,DT(p,l),UT=R_,SO=p_,s0(l),A&8192)t:for(p=l.stateNode,p._visibility=U?p._visibility&-2:p._visibility|1,U&&(g===null||wE||SO||UT||$I(l)),g=null,p=l;;){if(p.tag===5||p.tag===26){if(g===null){wE=g=p;try{if(q=wE.stateNode,U)_o=q.style,typeof _o.setProperty=="function"?_o.setProperty("display","none","important"):_o.display="none";else{ba=wE.stateNode;var x_=wE.memoizedProps.style,m_=x_!=null&&x_.hasOwnProperty("display")?x_.display:null;ba.style.display=m_==null||typeof m_=="boolean"?"":(""+m_).trim()}}catch(g_){bT(wE,wE.return,g_)}}}else if(p.tag===6){if(g===null){wE=p;try{wE.stateNode.nodeValue=U?"":wE.memoizedProps}catch(g_){bT(wE,wE.return,g_)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===l)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===l)break t;for(;p.sibling===null;){if(p.return===null||p.return===l)break t;g===p&&(g=null),p=p.return}g===p&&(g=null),p.sibling.return=p.return,p=p.sibling}A&4&&(A=l.updateQueue,A!==null&&(g=A.retryQueue,g!==null&&(A.retryQueue=null,$j(l,g))));break;case 19:DT(p,l),s0(l),A&4&&(A=l.updateQueue,A!==null&&(l.updateQueue=null,$j(l,A)));break;case 30:break;case 21:break;default:DT(p,l),s0(l)}}function s0(l){var p=l.flags;if(p&2){try{for(var g,A=l.return;A!==null;){if(r4(A)){g=A;break}A=A.return}if(g==null)throw Error(u(160));switch(g.tag){case 27:var U=g.stateNode,q=nL(l);QI(l,q,U);break;case 5:var _o=g.stateNode;g.flags&32&&(FN(_o,""),g.flags&=-33);var ba=nL(l);QI(l,ba,_o);break;case 3:case 4:var wE=g.stateNode.containerInfo,p_=nL(l);_j(l,p_,wE);break;default:throw Error(u(161))}}catch(R_){bT(l,l.return,R_)}l.flags&=-3}p&4096&&(l.flags&=-4097)}function c4(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var p=l;c4(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),l=l.sibling}}function dI(l,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)IG(l,p.alternate,p),p=p.sibling}function $I(l){for(l=l.child;l!==null;){var p=l;switch(p.tag){case 0:case 11:case 14:case 15:ZI(4,p,p.return),$I(p);break;case 1:_A(p,p.return);var g=p.stateNode;typeof g.componentWillUnmount=="function"&&OG(p,p.return,g),$I(p);break;case 27:J1(p.stateNode);case 26:case 5:_A(p,p.return),$I(p);break;case 22:p.memoizedState===null&&$I(p);break;case 30:$I(p);break;default:$I(p)}l=l.sibling}}function tN(l,p,g){for(g=g&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var A=p.alternate,U=l,q=p,_o=q.flags;switch(q.tag){case 0:case 11:case 15:tN(U,q,g),oP(4,q);break;case 1:if(tN(U,q,g),A=q,U=A.stateNode,typeof U.componentDidMount=="function")try{U.componentDidMount()}catch(p_){bT(A,A.return,p_)}if(A=q,U=A.updateQueue,U!==null){var ba=A.stateNode;try{var wE=U.shared.hiddenCallbacks;if(wE!==null)for(U.shared.hiddenCallbacks=null,U=0;U<wE.length;U++)y5(wE[U],ba)}catch(p_){bT(A,A.return,p_)}}g&&_o&64&&n4(q),U1(q,q.return);break;case 27:rL(q);case 26:case 5:tN(U,q,g),g&&A===null&&_o&4&&$U(q),U1(q,q.return);break;case 12:tN(U,q,g);break;case 13:tN(U,q,g),g&&_o&4&&a4(U,q);break;case 22:q.memoizedState===null&&tN(U,q,g),U1(q,q.return);break;case 30:break;default:tN(U,q,g)}p=p.sibling}}function tV(l,p){var g=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(g=l.memoizedState.cachePool.pool),l=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(l=p.memoizedState.cachePool.pool),l!==g&&(l!=null&&l.refCount++,g!=null&&_1(g))}function NG(l,p){l=null,p.alternate!==null&&(l=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==l&&(p.refCount++,l!=null&&_1(l))}function TO(l,p,g,A){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)u4(l,p,g,A),p=p.sibling}function u4(l,p,g,A){var U=p.flags;switch(p.tag){case 0:case 11:case 15:TO(l,p,g,A),U&2048&&oP(9,p);break;case 1:TO(l,p,g,A);break;case 3:TO(l,p,g,A),U&2048&&(l=null,p.alternate!==null&&(l=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==l&&(p.refCount++,l!=null&&_1(l)));break;case 12:if(U&2048){TO(l,p,g,A),l=p.stateNode;try{var q=p.memoizedProps,_o=q.id,ba=q.onPostCommit;typeof ba=="function"&&ba(_o,p.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(wE){bT(p,p.return,wE)}}else TO(l,p,g,A);break;case 13:TO(l,p,g,A);break;case 23:break;case 22:q=p.stateNode,_o=p.alternate,p.memoizedState!==null?q._visibility&2?TO(l,p,g,A):iL(l,p):q._visibility&2?TO(l,p,g,A):(q._visibility|=2,eN(l,p,g,A,(p.subtreeFlags&10256)!==0)),U&2048&&tV(_o,p);break;case 24:TO(l,p,g,A),U&2048&&NG(p.alternate,p);break;default:TO(l,p,g,A)}}function eN(l,p,g,A,U){for(U=U&&(p.subtreeFlags&10256)!==0,p=p.child;p!==null;){var q=l,_o=p,ba=g,wE=A,p_=_o.flags;switch(_o.tag){case 0:case 11:case 15:eN(q,_o,ba,wE,U),oP(8,_o);break;case 23:break;case 22:var R_=_o.stateNode;_o.memoizedState!==null?R_._visibility&2?eN(q,_o,ba,wE,U):iL(q,_o):(R_._visibility|=2,eN(q,_o,ba,wE,U)),U&&p_&2048&&tV(_o.alternate,_o);break;case 24:eN(q,_o,ba,wE,U),U&&p_&2048&&NG(_o.alternate,_o);break;default:eN(q,_o,ba,wE,U)}p=p.sibling}}function iL(l,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var g=l,A=p,U=A.flags;switch(A.tag){case 22:iL(g,A),U&2048&&tV(A.alternate,A);break;case 24:iL(g,A),U&2048&&NG(A.alternate,A);break;default:iL(g,A)}p=p.sibling}}var V1=8192;function nN(l){if(l.subtreeFlags&V1)for(l=l.child;l!==null;)l4(l),l=l.sibling}function l4(l){switch(l.tag){case 26:nN(l),l.flags&V1&&l.memoizedState!==null&&CW(_C,l.memoizedState,l.memoizedProps);break;case 5:nN(l);break;case 3:case 4:var p=_C;_C=bV(l.stateNode.containerInfo),nN(l),_C=p;break;case 22:l.memoizedState===null&&(p=l.alternate,p!==null&&p.memoizedState!==null?(p=V1,V1=16777216,nN(l),V1=p):nN(l));break;default:nN(l)}}function DG(l){var p=l.alternate;if(p!==null&&(l=p.child,l!==null)){p.child=null;do p=l.sibling,l.sibling=null,l=p;while(l!==null)}}function B1(l){var p=l.deletions;if((l.flags&16)!==0){if(p!==null)for(var g=0;g<p.length;g++){var A=p[g];vR=A,kG(A,l)}DG(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)eV(l),l=l.sibling}function eV(l){switch(l.tag){case 0:case 11:case 15:B1(l),l.flags&2048&&ZI(9,l,l.return);break;case 3:B1(l);break;case 12:B1(l);break;case 22:var p=l.stateNode;l.memoizedState!==null&&p._visibility&2&&(l.return===null||l.return.tag!==13)?(p._visibility&=-3,rN(l)):B1(l);break;default:B1(l)}}function rN(l){var p=l.deletions;if((l.flags&16)!==0){if(p!==null)for(var g=0;g<p.length;g++){var A=p[g];vR=A,kG(A,l)}DG(l)}for(l=l.child;l!==null;){switch(p=l,p.tag){case 0:case 11:case 15:ZI(8,p,p.return),rN(p);break;case 22:g=p.stateNode,g._visibility&2&&(g._visibility&=-3,rN(p));break;default:rN(p)}l=l.sibling}}function kG(l,p){for(;vR!==null;){var g=vR;switch(g.tag){case 0:case 11:case 15:ZI(8,g,p);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var A=g.memoizedState.cachePool.pool;A!=null&&A.refCount++}break;case 24:_1(g.memoizedState.cache)}if(A=g.child,A!==null)A.return=g,vR=A;else t:for(g=l;vR!==null;){A=vR;var U=A.sibling,q=A.return;if(o4(A),A===g){vR=null;break t}if(U!==null){U.return=q,vR=U;break t}vR=q}}}var LG={getCacheForType:function(l){var p=rR(dR),g=p.data.get(l);return g===void 0&&(g=l(),p.data.set(l,g)),g}},PG=typeof WeakMap=="function"?WeakMap:Map,cT=0,yT=null,OS=null,GS=0,WS=0,KR=null,RO=!1,iN=!1,nV=!1,AO=0,qT=0,oN=0,R0=0,rV=0,L0=0,aN=0,F1=null,c0=null,MG=!1,xG=0,cP=1/0,G1=null,hI=null,yR=0,tO=null,oL=null,sN=0,uP=0,lP=null,UG=null,CO=0,pI=null;function u0(){if((cT&2)!==0&&GS!==0)return GS&-GS;if(_p.T!==null){var l=qI;return l!==0?l:X1()}return O6()}function d4(){L0===0&&(L0=(GS&536870912)===0||XS?xN():536870912);var l=T0.current;return l!==null&&(l.flags|=32),L0}function A0(l,p,g){(l===yT&&(WS===2||WS===9)||l.cancelPendingCommit!==null)&&(hP(l,0),cN(l,GS,L0,!1)),t1(l,g),((cT&2)===0||l!==yT)&&(l===yT&&((cT&2)===0&&(R0|=g),qT===4&&cN(l,GS,L0,!1)),eO(l))}function dP(l,p,g){if((cT&6)!==0)throw Error(u(327));var A=!g&&(p&124)===0&&(p&l.expiredLanes)===0||$P(l,p),U=A?OO(l,p):BG(l,p,!0),q=A;do{if(U===0){iN&&!A&&cN(l,p,0,!1);break}else{if(g=l.current.alternate,q&&!iW(g)){U=BG(l,p,!1),q=!1;continue}if(U===2){if(q=p,l.errorRecoveryDisabledLanes&q)var _o=0;else _o=l.pendingLanes&-536870913,_o=_o!==0?_o:_o&536870912?536870912:0;if(_o!==0){p=_o;t:{var ba=l;U=F1;var wE=ba.current.memoizedState.isDehydrated;if(wE&&(hP(ba,_o).flags|=256),_o=BG(ba,_o,!1),_o!==2){if(nV&&!wE){ba.errorRecoveryDisabledLanes|=q,R0|=q,U=4;break t}q=c0,c0=U,q!==null&&(c0===null?c0=q:c0.push.apply(c0,q))}U=_o}if(q=!1,U!==2)continue}}if(U===1){hP(l,0),cN(l,p,0,!0);break}t:{switch(A=l,q=U,q){case 0:case 1:throw Error(u(345));case 4:if((p&4194048)!==p)break;case 6:cN(A,p,L0,!RO);break t;case 2:c0=null;break;case 3:case 5:break;default:throw Error(u(329))}if((p&62914560)===p&&(U=xG+300-mO(),10<U)){if(cN(A,p,L0,!RO),QP(A,0,!0)!==0)break t;A.timeoutHandle=L4(h4.bind(null,A,g,c0,G1,MG,p,L0,R0,aN,RO,q,2,-0,0),U);break t}h4(A,g,c0,G1,MG,p,L0,R0,aN,RO,q,0,-0,0)}}break}while(!0);eO(l)}function h4(l,p,g,A,U,q,_o,ba,wE,p_,R_,x_,m_,g_){if(l.timeoutHandle=-1,x_=p.subtreeFlags,(x_&8192||(x_&16785408)===16785408)&&(tM={stylesheets:null,count:0,unsuspend:AW},l4(p),x_=W4(),x_!==null)){l.cancelPendingCommit=x_(z1.bind(null,l,p,q,g,A,U,_o,ba,wE,R_,1,m_,g_)),cN(l,q,_o,!p_);return}z1(l,p,q,g,A,U,_o,ba,wE)}function iW(l){for(var p=l;;){var g=p.tag;if((g===0||g===11||g===15)&&p.flags&16384&&(g=p.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var A=0;A<g.length;A++){var U=g[A],q=U.getSnapshot;U=U.value;try{if(!b0(q(),U))return!1}catch{return!1}}if(g=p.child,p.subtreeFlags&16384&&g!==null)g.return=p,p=g;else{if(p===l)break;for(;p.sibling===null;){if(p.return===null||p.return===l)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function cN(l,p,g,A){p&=~rV,p&=~R0,l.suspendedLanes|=p,l.pingedLanes&=~p,A&&(l.warmLanes|=p),A=l.expirationTimes;for(var U=p;0<U;){var q=31-e0(U),_o=1<<q;A[q]=-1,U&=~_o}g!==0&&C6(l,g,p)}function iV(){return(cT&6)===0?(Y1(0),!1):!0}function jG(){if(OS!==null){if(WS===0)var l=OS.return;else l=OS,nI=eI=null,R1(l),rP=null,D1=0,l=OS;for(;l!==null;)e4(l.alternate,l),l=l.return;OS=null}}function hP(l,p){var g=l.timeoutHandle;g!==-1&&(l.timeoutHandle=-1,hW(g)),g=l.cancelPendingCommit,g!==null&&(l.cancelPendingCommit=null,g()),jG(),yT=l,OS=g=$O(l.current,null),GS=p,WS=0,KR=null,RO=!1,iN=$P(l,p),nV=!1,aN=L0=rV=R0=oN=qT=0,c0=F1=null,MG=!1,(p&8)!==0&&(p|=p&32);var A=l.entangledLanes;if(A!==0)for(l=l.entanglements,A&=p;0<A;){var U=31-e0(A),q=1<<U;p|=l[U],A&=~q}return AO=p,uU(),g}function oV(l,p){CS=null,_p.H=N1,p===zI||p===_U?(p=yU(),WS=3):p===HF?(p=yU(),WS=4):WS=p===vG?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,KR=p,OS===null&&(qT=1,qU(l,D0(p,l.current)))}function VG(){var l=_p.H;return _p.H=N1,l===null?N1:l}function p4(){var l=_p.A;return _p.A=LG,l}function aV(){qT=4,RO||(GS&4194048)!==GS&&T0.current!==null||(iN=!0),(oN&134217727)===0&&(R0&134217727)===0||yT===null||cN(yT,GS,L0,!1)}function BG(l,p,g){var A=cT;cT|=2;var U=VG(),q=p4();(yT!==l||GS!==p)&&(G1=null,hP(l,p)),p=!1;var _o=qT;t:do try{if(WS!==0&&OS!==null){var ba=OS,wE=KR;switch(WS){case 8:jG(),_o=6;break t;case 3:case 2:case 9:case 6:T0.current===null&&(p=!0);var p_=WS;if(WS=0,KR=null,uN(l,ba,wE,p_),g&&iN){_o=0;break t}break;default:p_=WS,WS=0,KR=null,uN(l,ba,wE,p_)}}H1(),_o=qT;break}catch(R_){oV(l,R_)}while(!0);return p&&l.shellSuspendCounter++,nI=eI=null,cT=A,_p.H=U,_p.A=q,OS===null&&(yT=null,GS=0,uU()),_o}function H1(){for(;OS!==null;)m4(OS)}function OO(l,p){var g=cT;cT|=2;var A=VG(),U=p4();yT!==l||GS!==p?(G1=null,cP=mO()+500,hP(l,p)):iN=$P(l,p);t:do try{if(WS!==0&&OS!==null){p=OS;var q=KR;e:switch(WS){case 1:WS=0,KR=null,uN(l,p,q,1);break;case 2:case 9:if(KF(q)){WS=0,KR=null,E4(p);break}p=function(){WS!==2&&WS!==9||yT!==l||(WS=7),eO(l)},q.then(p,p);break t;case 3:WS=7;break t;case 4:WS=5;break t;case 7:KF(q)?(WS=0,KR=null,E4(p)):(WS=0,KR=null,uN(l,p,q,7));break;case 5:var _o=null;switch(OS.tag){case 26:_o=OS.memoizedState;case 5:case 27:var ba=OS;if(!_o||K4(_o)){WS=0,KR=null;var wE=ba.sibling;if(wE!==null)OS=wE;else{var p_=ba.return;p_!==null?(OS=p_,q1(p_)):OS=null}break e}}WS=0,KR=null,uN(l,p,q,5);break;case 6:WS=0,KR=null,uN(l,p,q,6);break;case 8:jG(),qT=6;break t;default:throw Error(u(462))}}f4();break}catch(R_){oV(l,R_)}while(!0);return nI=eI=null,_p.H=A,_p.A=U,cT=g,OS!==null?0:(yT=null,GS=0,uU(),qT)}function f4(){for(;OS!==null&&!OL();)m4(OS)}function m4(l){var p=$5(l.alternate,l,AO);l.memoizedProps=l.pendingProps,p===null?q1(l):OS=p}function E4(l){var p=l,g=p.alternate;switch(p.tag){case 15:case 0:p=SG(g,p,p.pendingProps,p.type,void 0,GS);break;case 11:p=SG(g,p,p.pendingProps,p.type.render,p.ref,GS);break;case 5:R1(p);default:e4(g,p),p=OS=d5(p,AO),p=$5(g,p,AO)}l.memoizedProps=l.pendingProps,p===null?q1(l):OS=p}function uN(l,p,g,A){nI=eI=null,R1(p),rP=null,D1=0;var U=p.return;try{if(eW(l,U,p,g,GS)){qT=1,qU(l,D0(g,l.current)),OS=null;return}}catch(q){if(U!==null)throw OS=U,q;qT=1,qU(l,D0(g,l.current)),OS=null;return}p.flags&32768?(XS||A===1?l=!0:iN||(GS&536870912)!==0?l=!1:(RO=l=!0,(A===2||A===9||A===3||A===6)&&(A=T0.current,A!==null&&A.tag===13&&(A.flags|=16384))),g4(p,l)):q1(p)}function q1(l){var p=l;do{if((p.flags&32768)!==0){g4(p,RO);return}l=p.return;var g=t4(p.alternate,p,AO);if(g!==null){OS=g;return}if(p=p.sibling,p!==null){OS=p;return}OS=p=l}while(p!==null);qT===0&&(qT=5)}function g4(l,p){do{var g=nW(l.alternate,l);if(g!==null){g.flags&=32767,OS=g;return}if(g=l.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!p&&(l=l.sibling,l!==null)){OS=l;return}OS=l=g}while(l!==null);qT=6,OS=null}function z1(l,p,g,A,U,q,_o,ba,wE){l.cancelPendingCommit=null;do sV();while(yR!==0);if((cT&6)!==0)throw Error(u(327));if(p!==null){if(p===l.current)throw Error(u(177));if(q=p.lanes|p.childLanes,q|=LF,EK(l,g,q,_o,ba,wE),l===yT&&(OS=yT=null,GS=0),oL=p,tO=l,sN=g,uP=q,lP=U,UG=A,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,sW(SR,function(){return y4(),null})):(l.callbackNode=null,l.callbackPriority=0),A=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||A){A=_p.T,_p.T=null,U=c_.p,c_.p=2,_o=cT,cT|=4;try{rW(l,p,g)}finally{cT=_o,c_.p=U,_p.T=A}}yR=1,fI(),pP(),_4()}}function fI(){if(yR===1){yR=0;var l=tO,p=oL,g=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||g){g=_p.T,_p.T=null;var A=c_.p;c_.p=2;var U=cT;cT|=4;try{s4(p,l);var q=XG,_o=r5(l.containerInfo),ba=q.focusedElem,wE=q.selectionRange;if(_o!==ba&&ba&&ba.ownerDocument&&n5(ba.ownerDocument.documentElement,ba)){if(wE!==null&&qR(ba)){var p_=wE.start,R_=wE.end;if(R_===void 0&&(R_=p_),"selectionStart"in ba)ba.selectionStart=p_,ba.selectionEnd=Math.min(R_,ba.value.length);else{var x_=ba.ownerDocument||document,m_=x_&&x_.defaultView||window;if(m_.getSelection){var g_=m_.getSelection(),fS=ba.textContent.length,tS=Math.min(wE.start,fS),fT=wE.end===void 0?tS:Math.min(wE.end,fS);!g_.extend&&tS>fT&&(_o=fT,fT=tS,tS=_o);var a_=Y0(ba,tS),n_=Y0(ba,fT);if(a_&&n_&&(g_.rangeCount!==1||g_.anchorNode!==a_.node||g_.anchorOffset!==a_.offset||g_.focusNode!==n_.node||g_.focusOffset!==n_.offset)){var d_=x_.createRange();d_.setStart(a_.node,a_.offset),g_.removeAllRanges(),tS>fT?(g_.addRange(d_),g_.extend(n_.node,n_.offset)):(d_.setEnd(n_.node,n_.offset),g_.addRange(d_))}}}}for(x_=[],g_=ba;g_=g_.parentNode;)g_.nodeType===1&&x_.push({element:g_,left:g_.scrollLeft,top:g_.scrollTop});for(typeof ba.focus=="function"&&ba.focus(),ba=0;ba<x_.length;ba++){var L_=x_[ba];L_.element.scrollLeft=L_.left,L_.element.scrollTop=L_.top}}AV=!!YG,XG=YG=null}finally{cT=U,c_.p=A,_p.T=g}}l.current=p,yR=2}}function pP(){if(yR===2){yR=0;var l=tO,p=oL,g=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||g){g=_p.T,_p.T=null;var A=c_.p;c_.p=2;var U=cT;cT|=4;try{IG(l,p.alternate,p)}finally{cT=U,c_.p=A,_p.T=g}}yR=3}}function _4(){if(yR===4||yR===3){yR=0,pK();var l=tO,p=oL,g=sN,A=UG;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?yR=5:(yR=0,oL=tO=null,v4(l,l.pendingLanes));var U=l.pendingLanes;if(U===0&&(hI=null),xI(g),p=p.stateNode,vT&&typeof vT.onCommitFiberRoot=="function")try{vT.onCommitFiberRoot(wL,p,void 0,(p.current.flags&128)===128)}catch{}if(A!==null){p=_p.T,U=c_.p,c_.p=2,_p.T=null;try{for(var q=l.onRecoverableError,_o=0;_o<A.length;_o++){var ba=A[_o];q(ba.value,{componentStack:ba.stack})}}finally{_p.T=p,c_.p=U}}(sN&3)!==0&&sV(),eO(l),U=l.pendingLanes,(g&4194090)!==0&&(U&42)!==0?l===pI?CO++:(CO=0,pI=l):CO=0,Y1(0)}}function v4(l,p){(l.pooledCacheLanes&=p)===0&&(p=l.pooledCache,p!=null&&(l.pooledCache=null,_1(p)))}function sV(l){return fI(),pP(),_4(),y4()}function y4(){if(yR!==5)return!1;var l=tO,p=uP;uP=0;var g=xI(sN),A=_p.T,U=c_.p;try{c_.p=32>g?32:g,_p.T=null,g=lP,lP=null;var q=tO,_o=sN;if(yR=0,oL=tO=null,sN=0,(cT&6)!==0)throw Error(u(331));var ba=cT;if(cT|=4,eV(q.current),u4(q,q.current,_o,g),cT=ba,Y1(0,!1),vT&&typeof vT.onPostCommitFiberRoot=="function")try{vT.onPostCommitFiberRoot(wL,q)}catch{}return!0}finally{c_.p=U,_p.T=A,v4(l,p)}}function cV(l,p,g){p=D0(g,p),p=_G(l.stateNode,p,2),l=Z0(l,p,2),l!==null&&(t1(l,2),eO(l))}function bT(l,p,g){if(l.tag===3)cV(l,l,g);else for(;p!==null;){if(p.tag===3){cV(p,l,g);break}else if(p.tag===1){var A=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof A.componentDidCatch=="function"&&(hI===null||!hI.has(A))){l=D0(g,l),g=K5(2),A=Z0(p,g,2),A!==null&&(W5(g,A,p,l),t1(A,2),eO(A));break}}p=p.return}}function FG(l,p,g){var A=l.pingCache;if(A===null){A=l.pingCache=new PG;var U=new Set;A.set(p,U)}else U=A.get(p),U===void 0&&(U=new Set,A.set(p,U));U.has(g)||(nV=!0,U.add(g),l=oW.bind(null,l,p,g),p.then(l,l))}function oW(l,p,g){var A=l.pingCache;A!==null&&A.delete(p),l.pingedLanes|=l.suspendedLanes&g,l.warmLanes&=~g,yT===l&&(GS&g)===g&&(qT===4||qT===3&&(GS&62914560)===GS&&300>mO()-xG?(cT&2)===0&&hP(l,0):rV|=g,aN===GS&&(aN=0)),eO(l)}function GG(l,p){p===0&&(p=L3()),l=BI(l,p),l!==null&&(t1(l,p),eO(l))}function HG(l){var p=l.memoizedState,g=0;p!==null&&(g=p.retryLane),GG(l,g)}function aW(l,p){var g=0;switch(l.tag){case 13:var A=l.stateNode,U=l.memoizedState;U!==null&&(g=U.retryLane);break;case 19:A=l.stateNode;break;case 22:A=l.stateNode._retryCache;break;default:throw Error(u(314))}A!==null&&A.delete(p),GG(l,g)}function sW(l,p){return w3(l,p)}var uV=null,aL=null,K1=!1,W1=!1,lV=!1,wO=0;function eO(l){l!==aL&&l.next===null&&(aL===null?uV=aL=l:aL=aL.next=l),W1=!0,K1||(K1=!0,T4())}function Y1(l,p){if(!lV&&W1){lV=!0;do for(var g=!1,A=uV;A!==null;){if(l!==0){var U=A.pendingLanes;if(U===0)var q=0;else{var _o=A.suspendedLanes,ba=A.pingedLanes;q=(1<<31-e0(42|l)+1)-1,q&=U&~(_o&~ba),q=q&201326741?q&201326741|1:q?q|2:0}q!==0&&(g=!0,dV(A,q))}else q=GS,q=QP(A,A===yT?q:0,A.cancelPendingCommit!==null||A.timeoutHandle!==-1),(q&3)===0||$P(A,q)||(g=!0,dV(A,q));A=A.next}while(g);lV=!1}}function qG(){b4()}function b4(){W1=K1=!1;var l=0;wO!==0&&(dW()&&(l=wO),wO=0);for(var p=mO(),g=null,A=uV;A!==null;){var U=A.next,q=S4(A,p);q===0?(A.next=null,g===null?uV=U:g.next=U,U===null&&(aL=g)):(g=A,(l!==0||(q&3)!==0)&&(W1=!0)),A=U}Y1(l)}function S4(l,p){for(var g=l.suspendedLanes,A=l.pingedLanes,U=l.expirationTimes,q=l.pendingLanes&-62914561;0<q;){var _o=31-e0(q),ba=1<<_o,wE=U[_o];wE===-1?((ba&g)===0||(ba&A)!==0)&&(U[_o]=mK(ba,p)):wE<=p&&(l.expiredLanes|=ba),q&=~ba}if(p=yT,g=GS,g=QP(l,l===p?g:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),A=l.callbackNode,g===0||l===p&&(WS===2||WS===9)||l.cancelPendingCommit!==null)return A!==null&&A!==null&&I3(A),l.callbackNode=null,l.callbackPriority=0;if((g&3)===0||$P(l,g)){if(p=g&-g,p===l.callbackPriority)return p;switch(A!==null&&I3(A),xI(g)){case 2:case 8:g=T6;break;case 32:g=SR;break;case 268435456:g=qM;break;default:g=SR}return A=fP.bind(null,l),g=w3(g,A),l.callbackPriority=p,l.callbackNode=g,p}return A!==null&&A!==null&&I3(A),l.callbackPriority=2,l.callbackNode=null,2}function fP(l,p){if(yR!==0&&yR!==5)return l.callbackNode=null,l.callbackPriority=0,null;var g=l.callbackNode;if(sV()&&l.callbackNode!==g)return null;var A=GS;return A=QP(l,l===yT?A:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),A===0?null:(dP(l,A,p),S4(l,mO()),l.callbackNode!=null&&l.callbackNode===g?fP.bind(null,l):null)}function dV(l,p){if(sV())return null;dP(l,p,!0)}function T4(){pW(function(){(cT&6)!==0?w3(N3,qG):b4()})}function X1(){return wO===0&&(wO=xN()),wO}function hV(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:QM(""+l)}function pV(l,p){var g=p.ownerDocument.createElement("input");return g.name=p.name,g.value=p.value,l.id&&g.setAttribute("form",l.id),p.parentNode.insertBefore(g,p),l=new FormData(l),g.parentNode.removeChild(g),l}function cW(l,p,g,A,U){if(p==="submit"&&g&&g.stateNode===U){var q=hV((U[n0]||null).action),_o=A.submitter;_o&&(p=(p=_o[n0]||null)?hV(p.formAction):_o.getAttribute("formAction"),p!==null&&(q=p,_o=null));var ba=new GR("action","action",null,A,U);l.push({event:ba,listeners:[{instance:null,listener:function(){if(A.defaultPrevented){if(wO!==0){var wE=_o?pV(U,_o):new FormData(U);hG(g,{pending:!0,data:wE,method:U.method,action:q},null,wE)}}else typeof q=="function"&&(ba.preventDefault(),wE=_o?pV(U,_o):new FormData(U),hG(g,{pending:!0,data:wE,method:U.method,action:q},q,wE))},currentTarget:U}]})}}for(var zG=0;zG<DF.length;zG++){var fV=DF[zG],R4=fV.toLowerCase(),A4=fV[0].toUpperCase()+fV.slice(1);X0(R4,"on"+A4)}X0(sU,"onAnimationEnd"),X0(cU,"onAnimationIteration"),X0(a5,"onAnimationStart"),X0("dblclick","onDoubleClick"),X0("focusin","onFocus"),X0("focusout","onBlur"),X0(T_,"onTransitionRun"),X0(GK,"onTransitionStart"),X0(HK,"onTransitionCancel"),X0(s5,"onTransitionEnd"),LL("onMouseEnter",["mouseout","mouseover"]),LL("onMouseLeave",["mouseout","mouseover"]),LL("onPointerEnter",["pointerout","pointerover"]),LL("onPointerLeave",["pointerout","pointerover"]),BN("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),BN("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),BN("onBeforeInput",["compositionend","keypress","textInput","paste"]),BN("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),BN("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),BN("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mP="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C4=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mP));function O4(l,p){p=(p&4)!==0;for(var g=0;g<l.length;g++){var A=l[g],U=A.event;A=A.listeners;t:{var q=void 0;if(p)for(var _o=A.length-1;0<=_o;_o--){var ba=A[_o],wE=ba.instance,p_=ba.currentTarget;if(ba=ba.listener,wE!==q&&U.isPropagationStopped())break t;q=ba,U.currentTarget=p_;try{q(U)}catch(R_){GU(R_)}U.currentTarget=null,q=wE}else for(_o=0;_o<A.length;_o++){if(ba=A[_o],wE=ba.instance,p_=ba.currentTarget,ba=ba.listener,wE!==q&&U.isPropagationStopped())break t;q=ba,U.currentTarget=p_;try{q(U)}catch(R_){GU(R_)}U.currentTarget=null,q=wE}}}}function LS(l,p){var g=p[DL];g===void 0&&(g=p[DL]=new Set);var A=l+"__bubble";g.has(A)||(mV(p,l,2,!1),g.add(A))}function KG(l,p,g){var A=0;p&&(A|=4),mV(g,l,A,p)}var mI="_reactListening"+Math.random().toString(36).slice(2);function lN(l){if(!l[mI]){l[mI]=!0,U3.forEach(function(g){g!=="selectionchange"&&(C4.has(g)||KG(g,!1,l),KG(g,!0,l))});var p=l.nodeType===9?l:l.ownerDocument;p===null||p[mI]||(p[mI]=!0,KG("selectionchange",!1,p))}}function mV(l,p,g,A){switch(Q4(p)){case 2:var U=OW;break;case 8:U=l0;break;default:U=s2}g=U.bind(null,p,g,l),U=void 0,!Y3||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(U=!0),A?U!==void 0?l.addEventListener(p,g,{capture:!0,passive:U}):l.addEventListener(p,g,!0):U!==void 0?l.addEventListener(p,g,{passive:U}):l.addEventListener(p,g,!1)}function EV(l,p,g,A,U){var q=A;if((p&1)===0&&(p&2)===0&&A!==null)t:for(;;){if(A===null)return;var _o=A.tag;if(_o===3||_o===4){var ba=A.stateNode.containerInfo;if(ba===U)break;if(_o===4)for(_o=A.return;_o!==null;){var wE=_o.tag;if((wE===3||wE===4)&&_o.stateNode.containerInfo===U)return;_o=_o.return}for(;ba!==null;){if(_o=UN(ba),_o===null)return;if(wE=_o.tag,wE===5||wE===6||wE===26||wE===27){A=q=_o;continue t}ba=ba.parentNode}}A=A.return}W3(function(){var p_=q,R_=z3(g),x_=[];t:{var m_=c5.get(l);if(m_!==void 0){var g_=GR,fS=l;switch(l){case"keypress":if(a1(g)===0)break t;case"keydown":case"keyup":g_=OK;break;case"focusin":fS="focus",g_=Q3;break;case"focusout":fS="blur",g_=Q3;break;case"beforeblur":case"afterblur":g_=Q3;break;case"click":if(g.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g_=G6;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g_=eU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g_=VL;break;case sU:case cU:case a5:g_=TK;break;case s5:g_=NK;break;case"scroll":case"scrollend":g_=bK;break;case"wheel":g_=DK;break;case"copy":case"cut":case"paste":g_=_F;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g_=GN;break;case"toggle":case"beforetoggle":g_=LK}var tS=(p&4)!==0,fT=!tS&&(l==="scroll"||l==="scrollend"),a_=tS?m_!==null?m_+"Capture":null:m_;tS=[];for(var n_=p_,d_;n_!==null;){var L_=n_;if(d_=L_.stateNode,L_=L_.tag,L_!==5&&L_!==26&&L_!==27||d_===null||a_===null||(L_=o1(n_,a_),L_!=null&&tS.push(EP(n_,L_,d_))),fT)break;n_=n_.return}0<tS.length&&(m_=new g_(m_,fS,null,g,R_),x_.push({event:m_,listeners:tS}))}}if((p&7)===0){t:{if(m_=l==="mouseover"||l==="pointerover",g_=l==="mouseout"||l==="pointerout",m_&&g!==q3&&(fS=g.relatedTarget||g.fromElement)&&(UN(fS)||fS[NL]))break t;if((g_||m_)&&(m_=R_.window===R_?R_:(m_=R_.ownerDocument)?m_.defaultView||m_.parentWindow:window,g_?(fS=g.relatedTarget||g.toElement,g_=p_,fS=fS?UN(fS):null,fS!==null&&(fT=E(fS),tS=fS.tag,fS!==fT||tS!==5&&tS!==27&&tS!==6)&&(fS=null)):(g_=null,fS=p_),g_!==fS)){if(tS=G6,L_="onMouseLeave",a_="onMouseEnter",n_="mouse",(l==="pointerout"||l==="pointerover")&&(tS=GN,L_="onPointerLeave",a_="onPointerEnter",n_="pointer"),fT=g_==null?m_:n1(g_),d_=fS==null?m_:n1(fS),m_=new tS(L_,n_+"leave",g_,g,R_),m_.target=fT,m_.relatedTarget=d_,L_=null,UN(R_)===p_&&(tS=new tS(a_,n_+"enter",fS,g,R_),tS.target=d_,tS.relatedTarget=fT,L_=tS),fT=L_,g_&&fS)e:{for(tS=g_,a_=fS,n_=0,d_=tS;d_;d_=sL(d_))n_++;for(d_=0,L_=a_;L_;L_=sL(L_))d_++;for(;0<n_-d_;)tS=sL(tS),n_--;for(;0<d_-n_;)a_=sL(a_),d_--;for(;n_--;){if(tS===a_||a_!==null&&tS===a_.alternate)break e;tS=sL(tS),a_=sL(a_)}tS=null}else tS=null;g_!==null&&w4(x_,m_,g_,tS,!1),fS!==null&&fT!==null&&w4(x_,fT,fS,tS,!0)}}t:{if(m_=p_?n1(p_):window,g_=m_.nodeName&&m_.nodeName.toLowerCase(),g_==="select"||g_==="input"&&m_.type==="file")var J_=J6;else if(X6(m_))if(Z6)J_=BK;else{J_=IF;var PS=t5}else g_=m_.nodeName,!g_||g_.toLowerCase()!=="input"||m_.type!=="checkbox"&&m_.type!=="radio"?p_&&H3(p_.elementType)&&(J_=J6):J_=VK;if(J_&&(J_=J_(l,p_))){RF(x_,J_,g,R_);break t}PS&&PS(l,m_,p_),l==="focusout"&&p_&&m_.type==="number"&&p_.memoizedProps.value!=null&&F3(m_,"number",m_.value)}switch(PS=p_?n1(p_):window,l){case"focusin":(X6(PS)||PS.contentEditable==="true")&&(FL=PS,NF=p_,d1=null);break;case"focusout":d1=NF=FL=null;break;case"mousedown":oU=!0;break;case"contextmenu":case"mouseup":case"dragend":oU=!1,i5(x_,g,R_);break;case"selectionchange":if(FK)break;case"keydown":case"keyup":i5(x_,g,R_)}var _b;if(s1)t:{switch(l){case"compositionstart":var aS="onCompositionStart";break t;case"compositionend":aS="onCompositionEnd";break t;case"compositionupdate":aS="onCompositionUpdate";break t}aS=void 0}else BL?Y6(l,g)&&(aS="onCompositionEnd"):l==="keydown"&&g.keyCode===229&&(aS="onCompositionStart");aS&&(K6&&g.locale!=="ko"&&(BL||aS!=="onCompositionStart"?aS==="onCompositionEnd"&&BL&&(_b=B6()):(jI=R_,X3="value"in jI?jI.value:jI.textContent,BL=!0)),PS=gV(p_,aS),0<PS.length&&(aS=new q6(aS,l,null,g,R_),x_.push({event:aS,listeners:PS}),_b?aS.data=_b:(_b=TF(g),_b!==null&&(aS.data=_b)))),(_b=MK?QO(l,g):xK(l,g))&&(aS=gV(p_,"onBeforeInput"),0<aS.length&&(PS=new q6("onBeforeInput","beforeinput",null,g,R_),x_.push({event:PS,listeners:aS}),PS.data=_b)),cW(x_,l,p_,g,R_)}O4(x_,p)})}function EP(l,p,g){return{instance:l,listener:p,currentTarget:g}}function gV(l,p){for(var g=p+"Capture",A=[];l!==null;){var U=l,q=U.stateNode;if(U=U.tag,U!==5&&U!==26&&U!==27||q===null||(U=o1(l,g),U!=null&&A.unshift(EP(l,U,q)),U=o1(l,p),U!=null&&A.push(EP(l,U,q))),l.tag===3)return A;l=l.return}return[]}function sL(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function w4(l,p,g,A,U){for(var q=p._reactName,_o=[];g!==null&&g!==A;){var ba=g,wE=ba.alternate,p_=ba.stateNode;if(ba=ba.tag,wE!==null&&wE===A)break;ba!==5&&ba!==26&&ba!==27||p_===null||(wE=p_,U?(p_=o1(g,q),p_!=null&&_o.unshift(EP(g,p_,wE))):U||(p_=o1(g,q),p_!=null&&_o.push(EP(g,p_,wE)))),g=g.return}_o.length!==0&&l.push({event:p,listeners:_o})}var uW=/\r\n?/g,_V=/\u0000|\uFFFD/g;function I4(l){return(typeof l=="string"?l:""+l).replace(uW,`
`).replace(_V,"")}function N4(l,p){return p=I4(p),I4(l)===p}function vV(){}function pT(l,p,g,A,U,q){switch(g){case"children":typeof A=="string"?p==="body"||p==="textarea"&&A===""||FN(l,A):(typeof A=="number"||typeof A=="bigint")&&p!=="body"&&FN(l,""+A);break;case"className":WM(l,"class",A);break;case"tabIndex":WM(l,"tabindex",A);break;case"dir":case"role":case"viewBox":case"width":case"height":WM(l,g,A);break;case"style":ZM(l,A,q);break;case"data":if(p!=="object"){WM(l,"data",A);break}case"src":case"href":if(A===""&&(p!=="a"||g!=="href")){l.removeAttribute(g);break}if(A==null||typeof A=="function"||typeof A=="symbol"||typeof A=="boolean"){l.removeAttribute(g);break}A=QM(""+A),l.setAttribute(g,A);break;case"action":case"formAction":if(typeof A=="function"){l.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof q=="function"&&(g==="formAction"?(p!=="input"&&pT(l,p,"name",U.name,U,null),pT(l,p,"formEncType",U.formEncType,U,null),pT(l,p,"formMethod",U.formMethod,U,null),pT(l,p,"formTarget",U.formTarget,U,null)):(pT(l,p,"encType",U.encType,U,null),pT(l,p,"method",U.method,U,null),pT(l,p,"target",U.target,U,null)));if(A==null||typeof A=="symbol"||typeof A=="boolean"){l.removeAttribute(g);break}A=QM(""+A),l.setAttribute(g,A);break;case"onClick":A!=null&&(l.onclick=vV);break;case"onScroll":A!=null&&LS("scroll",l);break;case"onScrollEnd":A!=null&&LS("scrollend",l);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(u(61));if(g=A.__html,g!=null){if(U.children!=null)throw Error(u(60));l.innerHTML=g}}break;case"multiple":l.multiple=A&&typeof A!="function"&&typeof A!="symbol";break;case"muted":l.muted=A&&typeof A!="function"&&typeof A!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(A==null||typeof A=="function"||typeof A=="boolean"||typeof A=="symbol"){l.removeAttribute("xlink:href");break}g=QM(""+A),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":A!=null&&typeof A!="function"&&typeof A!="symbol"?l.setAttribute(g,""+A):l.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":A&&typeof A!="function"&&typeof A!="symbol"?l.setAttribute(g,""):l.removeAttribute(g);break;case"capture":case"download":A===!0?l.setAttribute(g,""):A!==!1&&A!=null&&typeof A!="function"&&typeof A!="symbol"?l.setAttribute(g,A):l.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":A!=null&&typeof A!="function"&&typeof A!="symbol"&&!isNaN(A)&&1<=A?l.setAttribute(g,A):l.removeAttribute(g);break;case"rowSpan":case"start":A==null||typeof A=="function"||typeof A=="symbol"||isNaN(A)?l.removeAttribute(g):l.setAttribute(g,A);break;case"popover":LS("beforetoggle",l),LS("toggle",l),KM(l,"popover",A);break;case"xlinkActuate":XO(l,"http://www.w3.org/1999/xlink","xlink:actuate",A);break;case"xlinkArcrole":XO(l,"http://www.w3.org/1999/xlink","xlink:arcrole",A);break;case"xlinkRole":XO(l,"http://www.w3.org/1999/xlink","xlink:role",A);break;case"xlinkShow":XO(l,"http://www.w3.org/1999/xlink","xlink:show",A);break;case"xlinkTitle":XO(l,"http://www.w3.org/1999/xlink","xlink:title",A);break;case"xlinkType":XO(l,"http://www.w3.org/1999/xlink","xlink:type",A);break;case"xmlBase":XO(l,"http://www.w3.org/XML/1998/namespace","xml:base",A);break;case"xmlLang":XO(l,"http://www.w3.org/XML/1998/namespace","xml:lang",A);break;case"xmlSpace":XO(l,"http://www.w3.org/XML/1998/namespace","xml:space",A);break;case"is":KM(l,"is",A);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=j6.get(g)||g,KM(l,g,A))}}function WG(l,p,g,A,U,q){switch(g){case"style":ZM(l,A,q);break;case"dangerouslySetInnerHTML":if(A!=null){if(typeof A!="object"||!("__html"in A))throw Error(u(61));if(g=A.__html,g!=null){if(U.children!=null)throw Error(u(60));l.innerHTML=g}}break;case"children":typeof A=="string"?FN(l,A):(typeof A=="number"||typeof A=="bigint")&&FN(l,""+A);break;case"onScroll":A!=null&&LS("scroll",l);break;case"onScrollEnd":A!=null&&LS("scrollend",l);break;case"onClick":A!=null&&(l.onclick=vV);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!VN.hasOwnProperty(g))t:{if(g[0]==="o"&&g[1]==="n"&&(U=g.endsWith("Capture"),p=g.slice(2,U?g.length-7:void 0),q=l[n0]||null,q=q!=null?q[g]:null,typeof q=="function"&&l.removeEventListener(p,q,U),typeof A=="function")){typeof q!="function"&&q!==null&&(g in l?l[g]=null:l.hasAttribute(g)&&l.removeAttribute(g)),l.addEventListener(p,A,U);break t}g in l?l[g]=A:A===!0?l.setAttribute(g,""):KM(l,g,A)}}}function OR(l,p,g){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":LS("error",l),LS("load",l);var A=!1,U=!1,q;for(q in g)if(g.hasOwnProperty(q)){var _o=g[q];if(_o!=null)switch(q){case"src":A=!0;break;case"srcSet":U=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(u(137,p));default:pT(l,p,q,_o,g,null)}}U&&pT(l,p,"srcSet",g.srcSet,g,null),A&&pT(l,p,"src",g.src,g,null);return;case"input":LS("invalid",l);var ba=q=_o=U=null,wE=null,p_=null;for(A in g)if(g.hasOwnProperty(A)){var R_=g[A];if(R_!=null)switch(A){case"name":U=R_;break;case"type":_o=R_;break;case"checked":wE=R_;break;case"defaultChecked":p_=R_;break;case"value":q=R_;break;case"defaultValue":ba=R_;break;case"children":case"dangerouslySetInnerHTML":if(R_!=null)throw Error(u(137,p));break;default:pT(l,p,A,R_,g,null)}}M6(l,q,ba,wE,p_,_o,U,!1),tT(l);return;case"select":LS("invalid",l),A=_o=q=null;for(U in g)if(g.hasOwnProperty(U)&&(ba=g[U],ba!=null))switch(U){case"value":q=ba;break;case"defaultValue":_o=ba;break;case"multiple":A=ba;default:pT(l,p,U,ba,g,null)}p=q,g=_o,l.multiple=!!A,p!=null?ML(l,!!A,p,!1):g!=null&&ML(l,!!A,g,!0);return;case"textarea":LS("invalid",l),q=U=A=null;for(_o in g)if(g.hasOwnProperty(_o)&&(ba=g[_o],ba!=null))switch(_o){case"value":A=ba;break;case"defaultValue":U=ba;break;case"children":q=ba;break;case"dangerouslySetInnerHTML":if(ba!=null)throw Error(u(91));break;default:pT(l,p,_o,ba,g,null)}i1(l,A,U,q),tT(l);return;case"option":for(wE in g)if(g.hasOwnProperty(wE)&&(A=g[wE],A!=null))switch(wE){case"selected":l.selected=A&&typeof A!="function"&&typeof A!="symbol";break;default:pT(l,p,wE,A,g,null)}return;case"dialog":LS("beforetoggle",l),LS("toggle",l),LS("cancel",l),LS("close",l);break;case"iframe":case"object":LS("load",l);break;case"video":case"audio":for(A=0;A<mP.length;A++)LS(mP[A],l);break;case"image":LS("error",l),LS("load",l);break;case"details":LS("toggle",l);break;case"embed":case"source":case"link":LS("error",l),LS("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(p_ in g)if(g.hasOwnProperty(p_)&&(A=g[p_],A!=null))switch(p_){case"children":case"dangerouslySetInnerHTML":throw Error(u(137,p));default:pT(l,p,p_,A,g,null)}return;default:if(H3(p)){for(R_ in g)g.hasOwnProperty(R_)&&(A=g[R_],A!==void 0&&WG(l,p,R_,A,g,void 0));return}}for(ba in g)g.hasOwnProperty(ba)&&(A=g[ba],A!=null&&pT(l,p,ba,A,g,null))}function lW(l,p,g,A){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var U=null,q=null,_o=null,ba=null,wE=null,p_=null,R_=null;for(g_ in g){var x_=g[g_];if(g.hasOwnProperty(g_)&&x_!=null)switch(g_){case"checked":break;case"value":break;case"defaultValue":wE=x_;default:A.hasOwnProperty(g_)||pT(l,p,g_,null,A,x_)}}for(var m_ in A){var g_=A[m_];if(x_=g[m_],A.hasOwnProperty(m_)&&(g_!=null||x_!=null))switch(m_){case"type":q=g_;break;case"name":U=g_;break;case"checked":p_=g_;break;case"defaultChecked":R_=g_;break;case"value":_o=g_;break;case"defaultValue":ba=g_;break;case"children":case"dangerouslySetInnerHTML":if(g_!=null)throw Error(u(137,p));break;default:g_!==x_&&pT(l,p,m_,g_,A,x_)}}B3(l,_o,ba,wE,p_,R_,q,U);return;case"select":g_=_o=ba=m_=null;for(q in g)if(wE=g[q],g.hasOwnProperty(q)&&wE!=null)switch(q){case"value":break;case"multiple":g_=wE;default:A.hasOwnProperty(q)||pT(l,p,q,null,A,wE)}for(U in A)if(q=A[U],wE=g[U],A.hasOwnProperty(U)&&(q!=null||wE!=null))switch(U){case"value":m_=q;break;case"defaultValue":ba=q;break;case"multiple":_o=q;default:q!==wE&&pT(l,p,U,q,A,wE)}p=ba,g=_o,A=g_,m_!=null?ML(l,!!g,m_,!1):!!A!=!!g&&(p!=null?ML(l,!!g,p,!0):ML(l,!!g,g?[]:"",!1));return;case"textarea":g_=m_=null;for(ba in g)if(U=g[ba],g.hasOwnProperty(ba)&&U!=null&&!A.hasOwnProperty(ba))switch(ba){case"value":break;case"children":break;default:pT(l,p,ba,null,A,U)}for(_o in A)if(U=A[_o],q=g[_o],A.hasOwnProperty(_o)&&(U!=null||q!=null))switch(_o){case"value":m_=U;break;case"defaultValue":g_=U;break;case"children":break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(u(91));break;default:U!==q&&pT(l,p,_o,U,A,q)}x6(l,m_,g_);return;case"option":for(var fS in g)if(m_=g[fS],g.hasOwnProperty(fS)&&m_!=null&&!A.hasOwnProperty(fS))switch(fS){case"selected":l.selected=!1;break;default:pT(l,p,fS,null,A,m_)}for(wE in A)if(m_=A[wE],g_=g[wE],A.hasOwnProperty(wE)&&m_!==g_&&(m_!=null||g_!=null))switch(wE){case"selected":l.selected=m_&&typeof m_!="function"&&typeof m_!="symbol";break;default:pT(l,p,wE,m_,A,g_)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var tS in g)m_=g[tS],g.hasOwnProperty(tS)&&m_!=null&&!A.hasOwnProperty(tS)&&pT(l,p,tS,null,A,m_);for(p_ in A)if(m_=A[p_],g_=g[p_],A.hasOwnProperty(p_)&&m_!==g_&&(m_!=null||g_!=null))switch(p_){case"children":case"dangerouslySetInnerHTML":if(m_!=null)throw Error(u(137,p));break;default:pT(l,p,p_,m_,A,g_)}return;default:if(H3(p)){for(var fT in g)m_=g[fT],g.hasOwnProperty(fT)&&m_!==void 0&&!A.hasOwnProperty(fT)&&WG(l,p,fT,void 0,A,m_);for(R_ in A)m_=A[R_],g_=g[R_],!A.hasOwnProperty(R_)||m_===g_||m_===void 0&&g_===void 0||WG(l,p,R_,m_,A,g_);return}}for(var a_ in g)m_=g[a_],g.hasOwnProperty(a_)&&m_!=null&&!A.hasOwnProperty(a_)&&pT(l,p,a_,null,A,m_);for(x_ in A)m_=A[x_],g_=g[x_],!A.hasOwnProperty(x_)||m_===g_||m_==null&&g_==null||pT(l,p,x_,m_,A,g_)}var YG=null,XG=null;function yV(l){return l.nodeType===9?l:l.ownerDocument}function D4(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function k4(l,p){if(l===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&p==="foreignObject"?0:l}function JG(l,p){return l==="textarea"||l==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var ZG=null;function dW(){var l=window.event;return l&&l.type==="popstate"?l===ZG?!1:(ZG=l,!0):(ZG=null,!1)}var L4=typeof setTimeout=="function"?setTimeout:void 0,hW=typeof clearTimeout=="function"?clearTimeout:void 0,QG=typeof Promise=="function"?Promise:void 0,pW=typeof queueMicrotask=="function"?queueMicrotask:typeof QG<"u"?function(l){return QG.resolve(null).then(l).catch(fW)}:L4;function fW(l){setTimeout(function(){throw l})}function dN(l){return l==="head"}function P4(l,p){var g=p,A=0,U=0;do{var q=g.nextSibling;if(l.removeChild(g),q&&q.nodeType===8)if(g=q.data,g==="/$"){if(0<A&&8>A){g=A;var _o=l.ownerDocument;if(g&1&&J1(_o.documentElement),g&2&&J1(_o.body),g&4)for(g=_o.head,J1(g),_o=g.firstChild;_o;){var ba=_o.nextSibling,wE=_o.nodeName;_o[e1]||wE==="SCRIPT"||wE==="STYLE"||wE==="LINK"&&_o.rel.toLowerCase()==="stylesheet"||g.removeChild(_o),_o=ba}}if(U===0){l.removeChild(q),d0(p);return}U--}else g==="$"||g==="$?"||g==="$!"?U++:A=g.charCodeAt(0)-48;else A=0;g=q}while(g);d0(p)}function $G(l){var p=l.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var g=p;switch(p=p.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":$G(g),zM(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}l.removeChild(g)}}function mW(l,p,g,A){for(;l.nodeType===1;){var U=g;if(l.nodeName.toLowerCase()!==p.toLowerCase()){if(!A&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(A){if(!l[e1])switch(p){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(q=l.getAttribute("rel"),q==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(q!==U.rel||l.getAttribute("href")!==(U.href==null||U.href===""?null:U.href)||l.getAttribute("crossorigin")!==(U.crossOrigin==null?null:U.crossOrigin)||l.getAttribute("title")!==(U.title==null?null:U.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(q=l.getAttribute("src"),(q!==(U.src==null?null:U.src)||l.getAttribute("type")!==(U.type==null?null:U.type)||l.getAttribute("crossorigin")!==(U.crossOrigin==null?null:U.crossOrigin))&&q&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(p==="input"&&l.type==="hidden"){var q=U.name==null?null:""+U.name;if(U.type==="hidden"&&l.getAttribute("name")===q)return l}else return l;if(l=nO(l.nextSibling),l===null)break}return null}function EW(l,p,g){if(p==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!g||(l=nO(l.nextSibling),l===null))return null;return l}function t2(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function gW(l,p){var g=l.ownerDocument;if(l.data!=="$?"||g.readyState==="complete")p();else{var A=function(){p(),g.removeEventListener("DOMContentLoaded",A)};g.addEventListener("DOMContentLoaded",A),l._reactRetry=A}}function nO(l){for(;l!=null;l=l.nextSibling){var p=l.nodeType;if(p===1||p===3)break;if(p===8){if(p=l.data,p==="$"||p==="$!"||p==="$?"||p==="F!"||p==="F")break;if(p==="/$")return null}}return l}var e2=null;function M4(l){l=l.previousSibling;for(var p=0;l;){if(l.nodeType===8){var g=l.data;if(g==="$"||g==="$!"||g==="$?"){if(p===0)return l;p--}else g==="/$"&&p++}l=l.previousSibling}return null}function x4(l,p,g){switch(p=yV(g),l){case"html":if(l=p.documentElement,!l)throw Error(u(452));return l;case"head":if(l=p.head,!l)throw Error(u(453));return l;case"body":if(l=p.body,!l)throw Error(u(454));return l;default:throw Error(u(451))}}function J1(l){for(var p=l.attributes;p.length;)l.removeAttributeNode(p[0]);zM(l)}var P0=new Map,U4=new Set;function bV(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var IO=c_.d;c_.d={f:_W,r:n2,D:vW,C:yW,L:V4,m:bW,X:SW,S:r2,M:TW};function _W(){var l=IO.f(),p=iV();return l||p}function n2(l){var p=kL(l);p!==null&&p.tag===5&&p.type==="form"?xU(p):IO.r(l)}var gP=typeof document>"u"?null:document;function j4(l,p,g){var A=gP;if(A&&typeof p=="string"&&p){var U=N0(p);U='link[rel="'+l+'"][href="'+U+'"]',typeof g=="string"&&(U+='[crossorigin="'+g+'"]'),U4.has(U)||(U4.add(U),l={rel:l,crossOrigin:g,href:p},A.querySelector(U)===null&&(p=A.createElement("link"),OR(p,"link",l),eR(p),A.head.appendChild(p)))}}function vW(l){IO.D(l),j4("dns-prefetch",l,null)}function yW(l,p){IO.C(l,p),j4("preconnect",l,p)}function V4(l,p,g){IO.L(l,p,g);var A=gP;if(A&&l&&p){var U='link[rel="preload"][as="'+N0(p)+'"]';p==="image"&&g&&g.imageSrcSet?(U+='[imagesrcset="'+N0(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(U+='[imagesizes="'+N0(g.imageSizes)+'"]')):U+='[href="'+N0(l)+'"]';var q=U;switch(p){case"style":q=_P(l);break;case"script":q=hN(l)}P0.has(q)||(l=j({rel:"preload",href:p==="image"&&g&&g.imageSrcSet?void 0:l,as:p},g),P0.set(q,l),A.querySelector(U)!==null||p==="style"&&A.querySelector(vP(q))||p==="script"&&A.querySelector(Z1(q))||(p=A.createElement("link"),OR(p,"link",l),eR(p),A.head.appendChild(p)))}}function bW(l,p){IO.m(l,p);var g=gP;if(g&&l){var A=p&&typeof p.as=="string"?p.as:"script",U='link[rel="modulepreload"][as="'+N0(A)+'"][href="'+N0(l)+'"]',q=U;switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":q=hN(l)}if(!P0.has(q)&&(l=j({rel:"modulepreload",href:l},p),P0.set(q,l),g.querySelector(U)===null)){switch(A){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(Z1(q)))return}A=g.createElement("link"),OR(A,"link",l),eR(A),g.head.appendChild(A)}}}function r2(l,p,g){IO.S(l,p,g);var A=gP;if(A&&l){var U=jN(A).hoistableStyles,q=_P(l);p=p||"default";var _o=U.get(q);if(!_o){var ba={loading:0,preload:null};if(_o=A.querySelector(vP(q)))ba.loading=5;else{l=j({rel:"stylesheet",href:l,"data-precedence":p},g),(g=P0.get(q))&&i2(l,g);var wE=_o=A.createElement("link");eR(wE),OR(wE,"link",l),wE._p=new Promise(function(p_,R_){wE.onload=p_,wE.onerror=R_}),wE.addEventListener("load",function(){ba.loading|=1}),wE.addEventListener("error",function(){ba.loading|=2}),ba.loading|=4,Q1(_o,p,A)}_o={type:"stylesheet",instance:_o,count:1,state:ba},U.set(q,_o)}}}function SW(l,p){IO.X(l,p);var g=gP;if(g&&l){var A=jN(g).hoistableScripts,U=hN(l),q=A.get(U);q||(q=g.querySelector(Z1(U)),q||(l=j({src:l,async:!0},p),(p=P0.get(U))&&SV(l,p),q=g.createElement("script"),eR(q),OR(q,"link",l),g.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},A.set(U,q))}}function TW(l,p){IO.M(l,p);var g=gP;if(g&&l){var A=jN(g).hoistableScripts,U=hN(l),q=A.get(U);q||(q=g.querySelector(Z1(U)),q||(l=j({src:l,async:!0,type:"module"},p),(p=P0.get(U))&&SV(l,p),q=g.createElement("script"),eR(q),OR(q,"link",l),g.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},A.set(U,q))}}function B4(l,p,g,A){var U=(U=Z_.current)?bV(U):null;if(!U)throw Error(u(446));switch(l){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(p=_P(g.href),g=jN(U).hoistableStyles,A=g.get(p),A||(A={type:"style",instance:null,count:0,state:null},g.set(p,A)),A):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){l=_P(g.href);var q=jN(U).hoistableStyles,_o=q.get(l);if(_o||(U=U.ownerDocument||U,_o={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},q.set(l,_o),(q=U.querySelector(vP(l)))&&!q._p&&(_o.instance=q,_o.state.loading=5),P0.has(l)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},P0.set(l,g),q||G4(U,l,g,_o.state))),p&&A===null)throw Error(u(528,""));return _o}if(p&&A!==null)throw Error(u(529,""));return null;case"script":return p=g.async,g=g.src,typeof g=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=hN(g),g=jN(U).hoistableScripts,A=g.get(p),A||(A={type:"script",instance:null,count:0,state:null},g.set(p,A)),A):{type:"void",instance:null,count:0,state:null};default:throw Error(u(444,l))}}function _P(l){return'href="'+N0(l)+'"'}function vP(l){return'link[rel="stylesheet"]['+l+"]"}function F4(l){return j({},l,{"data-precedence":l.precedence,precedence:null})}function G4(l,p,g,A){l.querySelector('link[rel="preload"][as="style"]['+p+"]")?A.loading=1:(p=l.createElement("link"),A.preload=p,p.addEventListener("load",function(){return A.loading|=1}),p.addEventListener("error",function(){return A.loading|=2}),OR(p,"link",g),eR(p),l.head.appendChild(p))}function hN(l){return'[src="'+N0(l)+'"]'}function Z1(l){return"script[async]"+l}function H4(l,p,g){if(p.count++,p.instance===null)switch(p.type){case"style":var A=l.querySelector('style[data-href~="'+N0(g.href)+'"]');if(A)return p.instance=A,eR(A),A;var U=j({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return A=(l.ownerDocument||l).createElement("style"),eR(A),OR(A,"style",U),Q1(A,g.precedence,l),p.instance=A;case"stylesheet":U=_P(g.href);var q=l.querySelector(vP(U));if(q)return p.state.loading|=4,p.instance=q,eR(q),q;A=F4(g),(U=P0.get(U))&&i2(A,U),q=(l.ownerDocument||l).createElement("link"),eR(q);var _o=q;return _o._p=new Promise(function(ba,wE){_o.onload=ba,_o.onerror=wE}),OR(q,"link",A),p.state.loading|=4,Q1(q,g.precedence,l),p.instance=q;case"script":return q=hN(g.src),(U=l.querySelector(Z1(q)))?(p.instance=U,eR(U),U):(A=g,(U=P0.get(q))&&(A=j({},g),SV(A,U)),l=l.ownerDocument||l,U=l.createElement("script"),eR(U),OR(U,"link",A),l.head.appendChild(U),p.instance=U);case"void":return null;default:throw Error(u(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(A=p.instance,p.state.loading|=4,Q1(A,g.precedence,l));return p.instance}function Q1(l,p,g){for(var A=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),U=A.length?A[A.length-1]:null,q=U,_o=0;_o<A.length;_o++){var ba=A[_o];if(ba.dataset.precedence===p)q=ba;else if(q!==U)break}q?q.parentNode.insertBefore(l,q.nextSibling):(p=g.nodeType===9?g.head:g,p.insertBefore(l,p.firstChild))}function i2(l,p){l.crossOrigin==null&&(l.crossOrigin=p.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=p.referrerPolicy),l.title==null&&(l.title=p.title)}function SV(l,p){l.crossOrigin==null&&(l.crossOrigin=p.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=p.referrerPolicy),l.integrity==null&&(l.integrity=p.integrity)}var $1=null;function q4(l,p,g){if($1===null){var A=new Map,U=$1=new Map;U.set(g,A)}else U=$1,A=U.get(g),A||(A=new Map,U.set(g,A));if(A.has(l))return A;for(A.set(l,null),g=g.getElementsByTagName(l),U=0;U<g.length;U++){var q=g[U];if(!(q[e1]||q[hT]||l==="link"&&q.getAttribute("rel")==="stylesheet")&&q.namespaceURI!=="http://www.w3.org/2000/svg"){var _o=q.getAttribute(p)||"";_o=l+_o;var ba=A.get(_o);ba?ba.push(q):A.set(_o,[q])}}return A}function z4(l,p,g){l=l.ownerDocument||l,l.head.insertBefore(g,p==="title"?l.querySelector("head > title"):null)}function RW(l,p,g){if(g===1||p.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return l=p.disabled,typeof p.precedence=="string"&&l==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function K4(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var tM=null;function AW(){}function CW(l,p,g){if(tM===null)throw Error(u(475));var A=tM;if(p.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var U=_P(g.href),q=l.querySelector(vP(U));if(q){l=q._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(A.count++,A=eM.bind(A),l.then(A,A)),p.state.loading|=4,p.instance=q,eR(q);return}q=l.ownerDocument||l,g=F4(g),(U=P0.get(U))&&i2(g,U),q=q.createElement("link"),eR(q);var _o=q;_o._p=new Promise(function(ba,wE){_o.onload=ba,_o.onerror=wE}),OR(q,"link",g),p.instance=q}A.stylesheets===null&&(A.stylesheets=new Map),A.stylesheets.set(p,l),(l=p.state.preload)&&(p.state.loading&3)===0&&(A.count++,p=eM.bind(A),l.addEventListener("load",p),l.addEventListener("error",p))}}function W4(){if(tM===null)throw Error(u(475));var l=tM;return l.stylesheets&&l.count===0&&TV(l,l.stylesheets),0<l.count?function(p){var g=setTimeout(function(){if(l.stylesheets&&TV(l,l.stylesheets),l.unsuspend){var A=l.unsuspend;l.unsuspend=null,A()}},6e4);return l.unsuspend=p,function(){l.unsuspend=null,clearTimeout(g)}}:null}function eM(){if(this.count--,this.count===0){if(this.stylesheets)TV(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var yP=null;function TV(l,p){l.stylesheets=null,l.unsuspend!==null&&(l.count++,yP=new Map,p.forEach(o2,l),yP=null,eM.call(l))}function o2(l,p){if(!(p.state.loading&4)){var g=yP.get(l);if(g)var A=g.get(null);else{g=new Map,yP.set(l,g);for(var U=l.querySelectorAll("link[data-precedence],style[data-precedence]"),q=0;q<U.length;q++){var _o=U[q];(_o.nodeName==="LINK"||_o.getAttribute("media")!=="not all")&&(g.set(_o.dataset.precedence,_o),A=_o)}A&&g.set(null,A)}U=p.instance,_o=U.getAttribute("data-precedence"),q=g.get(_o)||A,q===A&&g.set(null,U),g.set(_o,U),this.count++,A=eM.bind(this),U.addEventListener("load",A),U.addEventListener("error",A),q?q.parentNode.insertBefore(U,q.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(U,l.firstChild)),p.state.loading|=4}}var bP={$$typeof:_f,Provider:null,Consumer:null,_currentValue:v_,_currentValue2:v_,_threadCount:0};function A_(l,p,g,A,U,q,_o,ba){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=P3(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=P3(0),this.hiddenUpdates=P3(null),this.identifierPrefix=A,this.onUncaughtError=U,this.onCaughtError=q,this.onRecoverableError=_o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ba,this.incompleteTransitions=new Map}function Y4(l,p,g,A,U,q,_o,ba,wE,p_,R_,x_){return l=new A_(l,p,g,_o,ba,wE,p_,x_),p=1,q===!0&&(p|=24),q=RR(3,null,null,p),l.current=q,q.stateNode=l,p=EU(),p.refCount++,l.pooledCache=p,p.refCount++,q.memoizedState={element:A,isDehydrated:g,cache:p},S1(q),l}function X4(l){return l?(l=LR,l):LR}function J4(l,p,g,A,U,q){U=X4(U),A.context===null?A.context=U:A.pendingContext=U,A=oI(p),A.payload={element:g},q=q===void 0?null:q,q!==null&&(A.callback=q),g=Z0(l,A,p),g!==null&&(A0(g,l,p),aI(g,l,p))}function Z4(l,p){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var g=l.retryLane;l.retryLane=g!==0&&g<p?g:p}}function a2(l,p){Z4(l,p),(l=l.alternate)&&Z4(l,p)}function RV(l){if(l.tag===13){var p=BI(l,67108864);p!==null&&A0(p,l,67108864),a2(l,67108864)}}var AV=!0;function OW(l,p,g,A){var U=_p.T;_p.T=null;var q=c_.p;try{c_.p=2,s2(l,p,g,A)}finally{c_.p=q,_p.T=U}}function l0(l,p,g,A){var U=_p.T;_p.T=null;var q=c_.p;try{c_.p=8,s2(l,p,g,A)}finally{c_.p=q,_p.T=U}}function s2(l,p,g,A){if(AV){var U=c2(A);if(U===null)EV(l,p,A,SP,g),CV(l,A);else if(IW(U,l,p,g,A))A.stopPropagation();else if(CV(l,A),p&4&&-1<wW.indexOf(l)){for(;U!==null;){var q=kL(U);if(q!==null)switch(q.tag){case 3:if(q=q.stateNode,q.current.memoizedState.isDehydrated){var _o=y0(q.pendingLanes);if(_o!==0){var ba=q;for(ba.pendingLanes|=2,ba.entangledLanes|=2;_o;){var wE=1<<31-e0(_o);ba.entanglements[1]|=wE,_o&=~wE}eO(q),(cT&6)===0&&(cP=mO()+500,Y1(0))}}break;case 13:ba=BI(q,2),ba!==null&&A0(ba,q,2),iV(),a2(q,2)}if(q=c2(A),q===null&&EV(l,p,A,SP,g),q===U)break;U=q}U!==null&&A.stopPropagation()}else EV(l,p,A,null,g)}}function c2(l){return l=z3(l),u2(l)}var SP=null;function u2(l){if(SP=null,l=UN(l),l!==null){var p=E(l);if(p===null)l=null;else{var g=p.tag;if(g===13){if(l=v(p),l!==null)return l;l=null}else if(g===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;l=null}else p!==l&&(l=null)}}return SP=l,null}function Q4(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(MI()){case N3:return 2;case T6:return 8;case SR:case v0:return 32;case qM:return 268435456;default:return 32}default:return 32}}var l2=!1,pN=null,rO=null,EI=null,nM=new Map,rM=new Map,fN=[],wW="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function CV(l,p){switch(l){case"focusin":case"focusout":pN=null;break;case"dragenter":case"dragleave":rO=null;break;case"mouseover":case"mouseout":EI=null;break;case"pointerover":case"pointerout":nM.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":rM.delete(p.pointerId)}}function TP(l,p,g,A,U,q){return l===null||l.nativeEvent!==q?(l={blockedOn:p,domEventName:g,eventSystemFlags:A,nativeEvent:q,targetContainers:[U]},p!==null&&(p=kL(p),p!==null&&RV(p)),l):(l.eventSystemFlags|=A,p=l.targetContainers,U!==null&&p.indexOf(U)===-1&&p.push(U),l)}function IW(l,p,g,A,U){switch(p){case"focusin":return pN=TP(pN,l,p,g,A,U),!0;case"dragenter":return rO=TP(rO,l,p,g,A,U),!0;case"mouseover":return EI=TP(EI,l,p,g,A,U),!0;case"pointerover":var q=U.pointerId;return nM.set(q,TP(nM.get(q)||null,l,p,g,A,U)),!0;case"gotpointercapture":return q=U.pointerId,rM.set(q,TP(rM.get(q)||null,l,p,g,A,U)),!0}return!1}function OV(l){var p=UN(l.target);if(p!==null){var g=E(p);if(g!==null){if(p=g.tag,p===13){if(p=v(g),p!==null){l.blockedOn=p,gK(l.priority,function(){if(g.tag===13){var A=u0();A=M3(A);var U=BI(g,A);U!==null&&A0(U,g,A),a2(g,A)}});return}}else if(p===3&&g.stateNode.current.memoizedState.isDehydrated){l.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}l.blockedOn=null}function wV(l){if(l.blockedOn!==null)return!1;for(var p=l.targetContainers;0<p.length;){var g=c2(l.nativeEvent);if(g===null){g=l.nativeEvent;var A=new g.constructor(g.type,g);q3=A,g.target.dispatchEvent(A),q3=null}else return p=kL(g),p!==null&&RV(p),l.blockedOn=g,!1;p.shift()}return!0}function $4(l,p,g){wV(l)&&g.delete(p)}function tH(){l2=!1,pN!==null&&wV(pN)&&(pN=null),rO!==null&&wV(rO)&&(rO=null),EI!==null&&wV(EI)&&(EI=null),nM.forEach($4),rM.forEach($4)}function RP(l,p){l.blockedOn===p&&(l.blockedOn=null,l2||(l2=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,tH)))}var gI=null;function iM(l){gI!==l&&(gI=l,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){gI===l&&(gI=null);for(var p=0;p<l.length;p+=3){var g=l[p],A=l[p+1],U=l[p+2];if(typeof A!="function"){if(u2(A||g)===null)continue;break}var q=kL(g);q!==null&&(l.splice(p,3),p-=3,hG(q,{pending:!0,data:U,method:g.method,action:A},A,U))}}))}function d0(l){function p(wE){return RP(wE,l)}pN!==null&&RP(pN,l),rO!==null&&RP(rO,l),EI!==null&&RP(EI,l),nM.forEach(p),rM.forEach(p);for(var g=0;g<fN.length;g++){var A=fN[g];A.blockedOn===l&&(A.blockedOn=null)}for(;0<fN.length&&(g=fN[0],g.blockedOn===null);)OV(g),g.blockedOn===null&&fN.shift();if(g=(l.ownerDocument||l).$$reactFormReplay,g!=null)for(A=0;A<g.length;A+=3){var U=g[A],q=g[A+1],_o=U[n0]||null;if(typeof q=="function")_o||iM(g);else if(_o){var ba=null;if(q&&q.hasAttribute("formAction")){if(U=q,_o=q[n0]||null)ba=_o.formAction;else if(u2(U)!==null)continue}else ba=_o.action;typeof ba=="function"?g[A+1]=ba:(g.splice(A,3),A-=3),iM(g)}}}function mN(l){this._internalRoot=l}oM.prototype.render=mN.prototype.render=function(l){var p=this._internalRoot;if(p===null)throw Error(u(409));var g=p.current,A=u0();J4(g,A,l,p,null,null)},oM.prototype.unmount=mN.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var p=l.containerInfo;J4(l.current,2,null,l,null,null),iV(),p[NL]=null}};function oM(l){this._internalRoot=l}oM.prototype.unstable_scheduleHydration=function(l){if(l){var p=O6();l={blockedOn:null,target:l,priority:p};for(var g=0;g<fN.length&&p!==0&&p<fN[g].priority;g++);fN.splice(g,0,l),g===0&&OV(l)}};var d2=r.version;if(d2!=="19.1.0")throw Error(u(527,d2,"19.1.0"));c_.findDOMNode=function(l){var p=l._reactInternals;if(p===void 0)throw typeof l.render=="function"?Error(u(188)):(l=Object.keys(l).join(","),Error(u(268,l)));return l=C(p),l=l!==null?k(l):null,l=l===null?null:l.stateNode,l};var NW={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:_p,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var IV=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!IV.isDisabled&&IV.supportsFiber)try{wL=IV.inject(NW),vT=IV}catch{}}return reactDomClient_production.createRoot=function(l,p){if(!h(l))throw Error(u(299));var g=!1,A="",U=H5,q=q5,_o=HU,ba=null;return p!=null&&(p.unstable_strictMode===!0&&(g=!0),p.identifierPrefix!==void 0&&(A=p.identifierPrefix),p.onUncaughtError!==void 0&&(U=p.onUncaughtError),p.onCaughtError!==void 0&&(q=p.onCaughtError),p.onRecoverableError!==void 0&&(_o=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(ba=p.unstable_transitionCallbacks)),p=Y4(l,1,!1,null,null,g,A,U,q,_o,ba,null),l[NL]=p.current,lN(l),new mN(p)},reactDomClient_production.hydrateRoot=function(l,p,g){if(!h(l))throw Error(u(299));var A=!1,U="",q=H5,_o=q5,ba=HU,wE=null,p_=null;return g!=null&&(g.unstable_strictMode===!0&&(A=!0),g.identifierPrefix!==void 0&&(U=g.identifierPrefix),g.onUncaughtError!==void 0&&(q=g.onUncaughtError),g.onCaughtError!==void 0&&(_o=g.onCaughtError),g.onRecoverableError!==void 0&&(ba=g.onRecoverableError),g.unstable_transitionCallbacks!==void 0&&(wE=g.unstable_transitionCallbacks),g.formState!==void 0&&(p_=g.formState)),p=Y4(l,1,!0,p,g??null,A,U,q,_o,ba,wE,p_),p.context=X4(null),g=p.current,A=u0(),A=M3(A),U=oI(A),U.callback=null,Z0(g,U,A),g=A,p.current.lanes=g,t1(p,g),eO(p),l[NL]=p.current,lN(l),new oM(p)},reactDomClient_production.version="19.1.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(r){console.error(r)}}return i(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const ReactDOM=getDefaultExportFromCjs(clientExports);var agoraRtmSdk$1={exports:{}},agoraRtmSdk=agoraRtmSdk$1.exports,hasRequiredAgoraRtmSdk;function requireAgoraRtmSdk(){return hasRequiredAgoraRtmSdk||(hasRequiredAgoraRtmSdk=1,function(module,exports){var define_process_env_default={};/*
 @preserve
 AgoraRTM Web SDK 1.5.1 - commit: v1.5.1-0-g5bbbcd72
 Copyright (C) 2018-2022 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(i,r){module.exports=r()})(agoraRtmSdk,function(){function Be(i,r){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(i);r&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(i,h).enumerable})),o.push.apply(o,u)}return o}function Wa(i){for(var r=1;r<arguments.length;r++){var o=arguments[r]!=null?arguments[r]:{};r%2?Be(Object(o),!0).forEach(function(u){x(i,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Be(Object(o)).forEach(function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(o,u))})}return i}function qa(i){return(qa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(i)}function wm(i,r,o,u,h,E,v){try{var O=i[E](v),C=O.value}catch(k){return void o(k)}O.done?r(C):Promise.resolve(C).then(u,h)}function ma(i){return function(){var r=this,o=arguments;return new Promise(function(u,h){function E(C){wm(O,u,h,E,v,"next",C)}function v(C){wm(O,u,h,E,v,"throw",C)}var O=i.apply(r,o);E(void 0)})}}function va(i,r){if(!(i instanceof r))throw new TypeError("Cannot call a class as a function")}function xm(i,r){for(var o=0;o<r.length;o++){var u=r[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}function eb(i,r,o){return r&&xm(i.prototype,r),o&&xm(i,o),i}function x(i,r,o){return r in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}function Ga(i,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(r&&r.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),r&&Jf(i,r)}function Td(i){return(Td=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(i)}function Jf(i,r){return(Jf=Object.setPrototypeOf||function(o,u){return o.__proto__=u,o})(i,r)}function ym(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ji(i,r,o){return(Ji=ym()?Reflect.construct:function(u,h,E){var v=[null];return v.push.apply(v,h),u=new(Function.bind.apply(u,v)),E&&Jf(u,E.prototype),u}).apply(null,arguments)}function Kf(i){var r=typeof Map=="function"?new Map:void 0;return(Kf=function(o){function u(){return Ji(o,arguments,Td(this).constructor)}if(o===null||Function.toString.call(o).indexOf("[native code]")===-1)return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(r!==void 0){if(r.has(o))return r.get(o);r.set(o,u)}return u.prototype=Object.create(o.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),Jf(u,o)})(i)}function Ki(i,r){if(i==null)return{};if(i==null)var o={};else{o={};var u,h=Object.keys(i);for(u=0;u<h.length;u++){var E=h[u];0<=r.indexOf(E)||(o[E]=i[E])}}if(Object.getOwnPropertySymbols)for(u=Object.getOwnPropertySymbols(i),E=0;E<u.length;E++)h=u[E],0<=r.indexOf(h)||Object.prototype.propertyIsEnumerable.call(i,h)&&(o[h]=i[h]);return o}function z(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ha(i){var r=ym();return function(){var o=Td(i);if(r){var u=Td(this).constructor;o=Reflect.construct(o,arguments,u)}else o=o.apply(this,arguments);return o=!o||typeof o!="object"&&typeof o!="function"?z(this):o}}function Li(i,r,o){return(Li=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(u,h,E){for(;!Object.prototype.hasOwnProperty.call(u,h)&&(u=Td(u))!==null;);if(u)return(h=Object.getOwnPropertyDescriptor(u,h)).get?h.get.call(E):h.value})(i,r,o||i)}function $a(i,r){var o=Array.isArray(i)?i:void 0;if(!o)if((o=i&&(typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"]))==null)o=void 0;else{var u,h=[],E=!0,v=!1;try{for(o=o.call(i);!(E=(u=o.next()).done)&&(h.push(u.value),!r||h.length!==r);E=!0);}catch(C){v=!0;var O=C}finally{try{E||o.return==null||o.return()}finally{if(v)throw O}}o=h}if(!(i=o||zm(i,r)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return i}function Z(i){var r=Array.isArray(i)?Mi(i):void 0;if(r||(r=typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null?Array.from(i):void 0),!(i=r||zm(i)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return i}function zm(i,r){if(i){if(typeof i=="string")return Mi(i,r);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Mi(i,r)}}function Mi(i,r){(r==null||r>i.length)&&(r=i.length);for(var o=0,u=Array(r);o<r;o++)u[o]=i[o];return u}function Da(i,r,o,u,h){var E={};return Object.keys(u).forEach(function(v){E[v]=u[v]}),E.enumerable=!!E.enumerable,E.configurable=!!E.configurable,("value"in E||E.initializer)&&(E.writable=!0),E=o.slice().reverse().reduce(function(v,O){return O(i,r,v)||v},E),h&&E.initializer!==void 0&&(E.value=E.initializer?E.initializer.call(h):void 0,E.initializer=void 0),E.initializer===void 0&&(Object.defineProperty(i,r,E),E=null),E}function xb(i){var r={exports:{}};return i(r,r.exports),r.exports}function Ce(i){i||(i={});var r=i.ua;if(r||typeof navigator>"u"||(r=navigator.userAgent),r&&r.headers&&typeof r.headers["user-agent"]=="string"&&(r=r.headers["user-agent"]),typeof r!="string")return!1;var o=Zt.test(r)&&!$t.test(r)||!!i.tablet&&au.test(r);return!o&&i.tablet&&i.featureDetect&&navigator&&1<navigator.maxTouchPoints&&r.indexOf("Macintosh")!==-1&&r.indexOf("Safari")!==-1&&(o=!0),o}function Am(i,r){var o,u=3>arguments.length?i:arguments[2];return Ia(i)===u?i[r]:(o=dc.f(i,r))?ka(o,"value")?o.value:o.get===void 0?void 0:o.get.call(u):xa(o=uc(i))?Am(o,r,u):void 0}function bu(i){var r=i.charCodeAt(0)<<24,o=0|cu(~r),u=0,h=0|i.length,E="";if(5>o&&h>=o){for(r=r<<o>>>24+o,u=1;u<o;u=u+1|0)r=r<<6|63&i.charCodeAt(u);65535>=r?E+=Ud(r):1114111>=r?E+=Ud(55296+((r=r-65536|0)>>10)|0,56320+(1023&r)|0):u=0}for(;u<h;u=u+1|0)E+="�";return E}function Bm(){}function du(i){var r=0|i.charCodeAt(0);if(55296<=r&&56319>=r){var o=0|i.charCodeAt(1);if(!(o==o&&56320<=o&&57343>=o))return Ud(239,191,189);if(65535<(r=(r-55296<<10)+o-56320+65536|0))return Ud(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)}return 127>=r?i:2047>=r?Ud(192|r>>>6,128|63&r):Ud(224|r>>>12,128|r>>>6&63,128|63&r)}function Cm(){}function Ba(){Ba.init.call(this)}function Wg(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+qa(i))}function Dm(i,r,o,u){Wg(o);var h=i._events;if(h===void 0)h=i._events=Object.create(null),i._eventsCount=0;else{h.newListener!==void 0&&(i.emit("newListener",r,o.listener?o.listener:o),h=i._events);var E=h[r]}return E===void 0?(h[r]=o,++i._eventsCount):(typeof E=="function"?E=h[r]=u?[o,E]:[E,o]:u?E.unshift(o):E.push(o),0<(o=i._maxListeners===void 0?Ba.defaultMaxListeners:i._maxListeners)&&E.length>o&&!E.warned&&(E.warned=!0,(o=Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",o.emitter=i,o.type=r,o.count=E.length,console&&console.warn&&console.warn(o))),i}function eu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Em(i,r,o){return i={fired:!1,wrapFn:void 0,target:i,type:r,listener:o},(r=eu.bind(i)).listener=o,i.wrapFn=r}function Fm(i,r,o){if((i=i._events)===void 0)return[];if((r=i[r])===void 0)return[];if(typeof r=="function")return o?[r.listener||r]:[r];if(o)for(o=Array(r.length),i=0;i<o.length;++i)o[i]=r[i].listener||r[i];else o=Gm(r,r.length);return o}function Hm(i){var r=this._events;if(r!==void 0){if(typeof(i=r[i])=="function")return 1;if(i!==void 0)return i.length}return 0}function Gm(i,r){for(var o=Array(r),u=0;u<r;++u)o[u]=i[u];return o}function fu(i,r,o){typeof i.on=="function"&&Im(i,"error",r,o)}function Im(i,r,o,u){if(typeof i.on=="function")u.once?i.once(r,o):i.on(r,o);else{if(typeof i.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+qa(i));i.addEventListener(r,function h(E){u.once&&i.removeEventListener(r,h),o(E)})}}function gu(i){return i?Z(i):hu(function(){return[]},function(r,o){return r.push(o),r})}function Jm(i,r){var o,u,h,E;return N.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:o=Km(i)([Lm,Lm,function(O,C){return C}])[2],u=0;case 2:if(!(u<r.length)){v.next=17;break}if(h=r[u],!((E=o(Ni,h))instanceof Xg)){v.next=11;break}if((E=Oi(E.deref()))===Ni){v.next=10;break}return v.next=10,E;case 10:return v.abrupt("return");case 11:if(E===Ni){v.next=14;break}return v.next=14,E;case 14:u++,v.next=2;break;case 17:case"end":return v.stop()}},iu)}function Yg(i,r){return r!=null&&typeof r[Symbol.iterator]=="function"?Jm(Yg(i),r):function(o){var u=o[2];return ju(o,function(h,E){return u(h,i(E))})}}function $c(i){return Object.prototype.toString.call(i).slice(8,-1)}function De(i){return $c(i)==="Object"&&i.constructor===Object&&Object.getPrototypeOf(i)===Object.prototype}function Mm(i){var r;return(r=$c(i)==="Boolean"||$c(i)==="Null"||$c(i)==="Undefined")||(r=$c(i)==="Number"&&!isNaN(i)),r||$c(i)==="String"||$c(i)==="Symbol"}function Vd(i){var r=-1,o=i==null?0:i.length;for(this.clear();++r<o;){var u=i[r];this.set(u[0],u[1])}}function Ee(i){var r=-1,o=i==null?0:i.length;for(this.clear();++r<o;){var u=i[r];this.set(u[0],u[1])}}function Fe(i){var r=-1,o=i==null?0:i.length;for(this.clear();++r<o;){var u=i[r];this.set(u[0],u[1])}}function Lf(i){var r=-1,o=i==null?0:i.length;for(this.__data__=new Zg;++r<o;)this.add(i[r])}function Ge(i){this.size=(this.__data__=new $g(i)).size}function He(i,r,o,u,h,E){var v,O=1&r,C=2&r,k=4&r;if(o&&(v=h?o(i,u,h,E):o(i)),v!==void 0)return v;if(!Gb(i))return i;if(u=ub(i)){if(v=ku(i),!O)return Pi(i,v)}else{var j=Mf(i),K=j=="[object Function]"||j=="[object GeneratorFunction]";if(Nf(i))return Nm(i,O);if(j=="[object Object]"||j=="[object Arguments]"||K&&!h){if(v=C||K?{}:Om(i),!O)return C?lu(i,mu(v,i)):nu(i,ou(v,i))}else{if(!Oa[j])return h?i:{};v=pu(i,j,O)}}if(E||(E=new Ie),h=E.get(i))return h;E.set(i,v),qu(i)?i.forEach(function(_e){v.add(He(_e,r,o,_e,i,E))}):ru(i)&&i.forEach(function(_e,na){v.set(na,He(_e,r,o,na,i,E))}),C=k?C?Pm:Qi:C?Of:Wd;var $=u?void 0:C(i);return su($||i,function(_e,na){$&&(_e=i[na=_e]),Qm(v,na,He(_e,r,o,na,i,E))}),v}function Ri(i,r){if(typeof i!="function"||r!=null&&typeof r!="function")throw new TypeError("Expected a function");var o=function u(){var h=arguments,E=r?r.apply(this,h):h[0],v=u.cache;return v.has(E)?v.get(E):(h=i.apply(this,h),u.cache=v.set(E,h)||v,h)};return o.cache=new(Ri.Cache||Zg),o}function Rm(i){if(typeof i=="string")return i;if(ub(i))return Je(i,Rm)+"";if(Ke(i))return Sm?Sm.call(i):"";var r=i+"";return r=="0"&&1/i==-1/0?"-0":r}function Si(i,r,o,u,h){var E=-1,v=i.length;for(o||(o=uu),h||(h=[]);++E<v;){var O=i[E];o(O)?Ti(h,O):h[h.length]=O}return h}function Le(i,r,o,u,h){if(i===r)r=!0;else if(i==null||r==null||!Hc(i)&&!Hc(r))r=i!=i&&r!=r;else t:{var E=ub(i),v=ub(r),O=E?"[object Array]":Mf(i),C=v?"[object Array]":Mf(r),k=(O=O=="[object Arguments]"?"[object Object]":O)=="[object Object]";if(v=(C=C=="[object Arguments]"?"[object Object]":C)=="[object Object]",(C=O==C)&&Nf(i)){if(!Nf(r)){r=!1;break t}E=!0,k=!1}if(C&&!k)h||(h=new Ie),r=E||Ui(i)?Tm(i,r,o,u,Le,h):vu(i,r,O,o,u,Le,h);else{if(!(1&o)&&(E=k&&Um.call(i,"__wrapped__"),O=v&&Um.call(r,"__wrapped__"),E||O)){i=E?i.value():i,r=O?r.value():r,h||(h=new Ie),r=Le(i,r,o,u,h);break t}if(C)e:if(h||(h=new Ie),E=1&o,O=Qi(i),v=O.length,C=Qi(r).length,v==C||E){for(C=v;C--;){var j=O[C];if(!(E?j in r:wu.call(r,j))){r=!1;break e}}if(k=h.get(i),j=h.get(r),k&&j)r=k==r&&j==i;else{k=!0,h.set(i,r),h.set(r,i);for(var K=E;++C<v;){var $=i[j=O[C]],_e=r[j];if(u)var na=E?u(_e,$,j,r,i,h):u($,_e,j,i,r,h);if(na===void 0?$!==_e&&!Le($,_e,o,u,h):!na){k=!1;break}K||(K=j=="constructor")}k&&!K&&(o=i.constructor)!=(u=r.constructor)&&"constructor"in i&&"constructor"in r&&!(typeof o=="function"&&o instanceof o&&typeof u=="function"&&u instanceof u)&&(k=!1),h.delete(i),h.delete(r),r=k}}else r=!1;else r=!1}}return r}function Pa(i,r,o){this.low=0|i,this.high=0|r,this.unsigned=!!o}function Hb(i){return(i&&i.__isLong__)===!0}function Xd(i,r){var o;if(r){if((r=0<=(i>>>=0)&&256>i)&&(o=Vm[i]))return o;o=Qa(i,0>(0|i)?-1:0,!0),r&&(Vm[i]=o)}else{if((r=-128<=(i|=0)&&128>i)&&(o=Wm[i]))return o;o=Qa(i,0>i?-1:0,!1),r&&(Wm[i]=o)}return o}function ec(i,r){if(isNaN(i))return r?Yd:fc;if(r){if(0>i)return Yd;if(i>=Xm)return Ym}else{if(i<=-9223372036854776e3)return Ib;if(i+1>=Zm)return $m}return 0>i?ec(-i,r).neg():Qa(i%Me|0,i/Me|0,r)}function Qa(i,r,o){return new Pa(i,r,o)}function Vi(i,r,o){if(i.length===0)throw Error("empty string");if(i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return fc;if(typeof r=="number"?(o=r,r=!1):r=!!r,2>(o=o||10)||36<o)throw RangeError("radix");var u;if(0<(u=i.indexOf("-")))throw Error("interior hyphen");if(u===0)return Vi(i.substring(1),r,o).neg();u=ec(ah(o,8));for(var h=fc,E=0;E<i.length;E+=8){var v=Math.min(8,i.length-E),O=parseInt(i.substring(E,E+v),o);8>v?(v=ec(ah(o,v)),h=h.mul(v).add(ec(O))):h=(h=h.mul(u)).add(ec(O))}return h.unsigned=r,h}function vc(i,r){return typeof i=="number"?ec(i,r):typeof i=="string"?Vi(i,r):Qa(i.low,i.high,typeof r=="boolean"?r:i.unsigned)}function ha(i,r){function o(){this.constructor=i}Wi(i,r),i.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}function Ne(i){return typeof i=="function"}function Oe(i){setTimeout(function(){throw i},0)}function Xi(i){return i!==null&&qa(i)==="object"}function an(i){return i.reduce(function(r,o){return r.concat(o instanceof Pf?o.errors:o)},[])}function Yi(i){for(;i;){var r=i.destination,o=i.isStopped;if(i.closed||o)return!1;i=r&&r instanceof za?r:null}return!0}function wd(i){return i}function Zi(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return bn(i)}function bn(i){return i.length===0?wd:i.length===1?i[0]:function(r){return i.reduce(function(o,u){return u(o)},r)}}function cn(i){if(i||(i=gc.Promise||Promise),!i)throw Error("no Promise impl found");return i}function dn(){return function(i){return i.lift(new xu(i))}}function Qf(i){return i?yu(i):Sb}function yu(i){return new ua(function(r){return i.schedule(function(){return r.complete()})})}function ad(i){return i&&typeof i.schedule=="function"}function $i(i,r){return new ua(function(o){var u=new nb,h=0;return u.add(r.schedule(function(){h===i.length?o.complete():(o.next(i[h++]),o.closed||u.add(this.schedule()))})),u})}function Rf(i,r){return r?$i(i,r):new ua(en(i))}function ob(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return ad(r=i[i.length-1])?(i.pop(),$i(i,r)):Rf(i)}function ra(i,r){return new ua(r?function(o){return r.schedule(zu,0,{error:i,subscriber:o})}:function(o){return o.error(i)})}function zu(i){i.subscriber.error(i.error)}function Au(i,r){return r===void 0&&(r=0),function(o){return o.lift(new Bu(i,r))}}function fn(i){return i in aj&&(delete aj[i],!0)}function Ic(){}function Ea(i,r){return function(o){if(typeof i!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return o.lift(new Cu(i,r))}}function gn(i,r,o){if(r){if(!ad(r))return function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return gn(i,o).apply(void 0,u).pipe(Ea(function(E){return hc(E)?r.apply(void 0,E):r(E)}))};o=r}return function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];var E,v=this,O={context:v,subject:E,callbackFunc:i,scheduler:o};return new ua(function(C){if(o)return o.schedule(Du,0,{args:u,subscriber:C,params:O});if(!E){E=new Sf;try{i.apply(v,u.concat([function(){for(var k=[],j=0;j<arguments.length;j++)k[j]=arguments[j];E.next(1>=k.length?k[0]:k),E.complete()}]))}catch(k){Yi(E)?E.error(k):console.warn(k)}}return E.subscribe(C)})}}function Du(i){var r=this,o=i.args,u=i.subscriber,h=i.params;i=h.callbackFunc;var E=h.context,v=h.scheduler,O=h.subject;if(!O){O=h.subject=new Sf,h=function(){for(var C=[],k=0;k<arguments.length;k++)C[k]=arguments[k];r.add(v.schedule(Eu,0,{value:1>=C.length?C[0]:C,subject:O}))};try{i.apply(E,o.concat([h]))}catch(C){O.error(C)}}this.add(O.subscribe(u))}function Eu(i){var r=i.subject;r.next(i.value),r.complete()}function hn(i,r,o){if(r){if(!ad(r))return function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return hn(i,o).apply(void 0,u).pipe(Ea(function(E){return hc(E)?r.apply(void 0,E):r(E)}))};o=r}return function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];var E={subject:void 0,args:u,callbackFunc:i,scheduler:o,context:this};return new ua(function(v){var O=E.context,C=E.subject;if(o)return o.schedule(Fu,0,{params:E,subscriber:v,context:O});if(!C){C=E.subject=new Sf;try{i.apply(O,u.concat([function(){for(var k=[],j=0;j<arguments.length;j++)k[j]=arguments[j];(j=k.shift())?C.error(j):(C.next(1>=k.length?k[0]:k),C.complete())}]))}catch(k){Yi(C)?C.error(k):console.warn(k)}}return C.subscribe(v)})}}function Fu(i){var r=this,o=i.params,u=i.subscriber;i=i.context;var h=o.callbackFunc,E=o.args,v=o.scheduler,O=o.subject;if(!O){O=o.subject=new Sf,o=function(){for(var C=[],k=0;k<arguments.length;k++)C[k]=arguments[k];(k=C.shift())?r.add(v.schedule(jn,0,{err:k,subject:O})):r.add(v.schedule(Gu,0,{value:1>=C.length?C[0]:C,subject:O}))};try{h.apply(i,E.concat([o]))}catch(C){this.add(v.schedule(jn,0,{err:C,subject:O}))}}this.add(O.subscribe(u))}function Gu(i){var r=i.subject;r.next(i.value),r.complete()}function jn(i){i.subject.error(i.err)}function kn(i){return!!i&&typeof i.subscribe!="function"&&typeof i.then=="function"}function bj(i,r,o,u,h){if(h===void 0&&(h=new Hu(i,o,u)),!h.closed)return r instanceof ua?r.subscribe(h):Tf(r)(h)}function Iu(i,r){return new ua(function(o){var u=new nb;return u.add(r.schedule(function(){var h=i[Pe]();u.add(h.subscribe({next:function(E){u.add(r.schedule(function(){return o.next(E)}))},error:function(E){u.add(r.schedule(function(){return o.error(E)}))},complete:function(){u.add(r.schedule(function(){return o.complete()}))}}))})),u})}function Ju(i,r){return new ua(function(o){var u=new nb;return u.add(r.schedule(function(){return i.then(function(h){u.add(r.schedule(function(){o.next(h),u.add(r.schedule(function(){return o.complete()}))}))},function(h){u.add(r.schedule(function(){return o.error(h)}))})})),u})}function Ku(i,r){if(!i)throw Error("Iterable cannot be null");return new ua(function(o){var u,h=new nb;return h.add(function(){u&&typeof u.return=="function"&&u.return()}),h.add(r.schedule(function(){u=i[xd](),h.add(r.schedule(function(){if(!o.closed){try{var E=u.next(),v=E.value,O=E.done}catch(C){return void o.error(C)}O?o.complete():(o.next(v),this.schedule())}}))})),h})}function ln(i,r){if(i!=null){if(i&&typeof i[Pe]=="function")return Iu(i,r);if(kn(i))return Ju(i,r);if(mn(i))return $i(i,r);if(i&&typeof i[xd]=="function"||typeof i=="string")return Ku(i,r)}throw new TypeError((i!==null&&qa(i)||i)+" is not observable")}function Jc(i,r){return r?ln(i,r):i instanceof ua?i:new ua(Tf(i))}function bd(i,r){if(!r.closed){if(i instanceof ua)return i.subscribe(r);try{var o=Tf(i)(r)}catch(u){r.error(u)}return o}}function Cb(i,r,o){return o===void 0&&(o=Number.POSITIVE_INFINITY),typeof r=="function"?function(u){return u.pipe(Cb(function(h,E){return Jc(i(h,E)).pipe(Ea(function(v,O){return r(h,v,E,O)}))},o))}:(typeof r=="number"&&(o=r),function(u){return u.lift(new Lu(i,o))})}function bh(i){return i===void 0&&(i=Number.POSITIVE_INFINITY),Cb(wd,i)}function nn(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return bh(1)(ob.apply(void 0,i))}function yd(i){return new ua(function(r){try{var o=i()}catch(u){return void r.error(u)}return(o?Jc(o):Qf()).subscribe(r)})}function ch(i,r){return new ua(function(o){var u=i.length;if(u===0)o.complete();else for(var h=Array(u),E=0,v=0,O=function(k){var j=Jc(i[k]),K=!1;o.add(j.subscribe({next:function($){K||(K=!0,v++),h[k]=$},error:function($){return o.error($)},complete:function(){++E!==u&&K||(v===u&&o.next(r?r.reduce(function($,_e,na){return $[_e]=h[na],$},{}):h),o.complete())}}))},C=0;C<u;C++)O(C)})}function Db(i,r,o,u){return Ne(o)&&(u=o,o=void 0),u?Db(i,r,o).pipe(Ea(function(h){return hc(h)?u.apply(void 0,h):u(h)})):new ua(function(h){on(i,r,function(E){1<arguments.length?h.next(Array.prototype.slice.call(arguments)):h.next(E)},h,o)})}function on(i,r,o,u,h){if(i&&typeof i.addEventListener=="function"&&typeof i.removeEventListener=="function"){i.addEventListener(r,o,h);var E=function(){return i.removeEventListener(r,o,h)}}else if(i&&typeof i.on=="function"&&typeof i.off=="function")i.on(r,o),E=function(){return i.off(r,o)};else if(i&&typeof i.addListener=="function"&&typeof i.removeListener=="function")i.addListener(r,o),E=function(){return i.removeListener(r,o)};else{if(!i||!i.length)throw new TypeError("Invalid event target");for(var v=0,O=i.length;v<O;v++)on(i[v],r,o,u,h)}u.add(E)}function pn(i,r,o){return o?pn(i,r).pipe(Ea(function(u){return hc(u)?o.apply(void 0,u):o(u)})):new ua(function(u){var h=function(){for(var v=[],O=0;O<arguments.length;O++)v[O]=arguments[O];return u.next(v.length===1?v[0]:v)};try{var E=i(h)}catch(v){return void u.error(v)}if(Ne(r))return function(){return r(h,E)}})}function Mu(i){var r=i.subscriber,o=i.condition;if(!r.closed){if(i.needIterate)try{i.state=i.iterate(i.state)}catch(E){return void r.error(E)}else i.needIterate=!0;if(o){var u=void 0;try{u=o(i.state)}catch(E){return void r.error(E)}if(!u)return void r.complete();if(r.closed)return}try{var h=i.resultSelector(i.state)}catch(E){return void r.error(E)}if(!r.closed&&(r.next(h),!r.closed))return this.schedule(i)}}function cj(i){return!hc(i)&&0<=i-parseFloat(i)+1}function Qe(i,r){return i===void 0&&(i=0),r===void 0&&(r=cd),(!cj(i)||0>i)&&(i=0),r&&typeof r.schedule=="function"||(r=cd),new ua(function(o){return o.add(r.schedule(Nu,i,{subscriber:o,counter:0,period:i})),o})}function Nu(i){var r=i.subscriber,o=i.counter;i=i.period,r.next(o),this.schedule({subscriber:r,counter:o+1,period:i},i)}function Jb(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];r=Number.POSITIVE_INFINITY;var o=null,u=i[i.length-1];return ad(u)?(o=i.pop(),1<i.length&&typeof i[i.length-1]=="number"&&(r=i.pop())):typeof u=="number"&&(r=i.pop()),o===null&&i.length===1&&i[0]instanceof ua?i[0]:bh(r)(Rf(i,o))}function dj(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(i.length===0)return Sb;var o=i[0],u=i.slice(1);return i.length===1&&hc(o)?dj.apply(void 0,o):new ua(function(h){var E=function(){return h.add(dj.apply(void 0,u).subscribe(h))};return Jc(o).subscribe({next:function(v){h.next(v)},error:E,complete:E})})}function Ou(i){var r=i.keys,o=i.index,u=i.subscriber,h=i.subscription;if(i=i.obj,!u.closed)if(o<r.length){var E=r[o];u.next([E,i[E]]),h.add(this.schedule({keys:r,index:o+1,subscriber:u,subscription:h,obj:i}))}else u.complete()}function Pu(i,r){function o(){return!o.pred.apply(o.thisArg,arguments)}return o.pred=i,o.thisArg=r,o}function yb(i,r){return function(o){return o.lift(new Qu(i,r))}}function fb(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(i.length===1){if(!hc(i[0]))return i[0];i=i[0]}return Rf(i,void 0).lift(new Ru)}function Su(i){var r=i.start,o=i.index,u=i.subscriber;o>=i.count?u.complete():(u.next(r),u.closed||(i.index=o+1,i.start=r+1,this.schedule(i)))}function dd(i,r,o){i===void 0&&(i=0);var u=-1;return cj(r)?u=1>Number(r)?1:Number(r):ad(r)&&(o=r),ad(o)||(o=cd),new ua(function(h){var E=cj(i)?i:+i-o.now();return o.schedule(Tu,E,{index:0,period:u,subscriber:h})})}function Tu(i){var r=i.index,o=i.period,u=i.subscriber;if(u.next(r),!u.closed){if(o===-1)return u.complete();i.index=r+1,this.schedule(i,o)}}function ej(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return typeof(r=i[i.length-1])=="function"&&i.pop(),Rf(i,void 0).lift(new Uu(r))}function dh(i){var r=arguments.length,o=cd;ad(arguments[arguments.length-1])&&(o=arguments[arguments.length-1],r--);var u=null;2<=r&&(u=arguments[1]);var h=Number.POSITIVE_INFINITY;return 3<=r&&(h=arguments[2]),function(E){return E.lift(new Vu(i,u,h,o))}}function qn(i){var r=i.subscriber,o=i.context;o&&r.closeContext(o),r.closed||(i.context=r.openContext(),i.context.closeAction=this.schedule(i,i.bufferTimeSpan))}function Wu(i){var r=i.bufferCreationInterval,o=i.bufferTimeSpan,u=i.subscriber,h=i.scheduler,E=u.openContext();u.closed||(u.add(E.closeAction=h.schedule(rn,o,{subscriber:u,context:E})),this.schedule(i,r))}function rn(i){i.subscriber.closeContext(i.context)}function ab(i){return function(r){var o=new Xu(i);return r=r.lift(o),o.caught=r}}function fj(i,r){return Cb(i,r,1)}function sn(i){return i===void 0&&(i=null),function(r){return r.lift(new Yu(i))}}function Zd(i,r){r===void 0&&(r=cd);var o=i instanceof Date&&!isNaN(+i)?+i-r.now():Math.abs(i);return function(u){return u.lift(new Zu(o,r))}}function tn(i,r){return function(o){return o.lift(new $u(i,r))}}function $d(i){return i===void 0&&(i=av),function(r){return r.lift(new bv(i))}}function av(){return new eh}function hb(i){return function(r){return i===0?Qf():r.lift(new cv(i))}}function fh(i){return function(r){return r.lift(new dv(i))}}function Ca(i,r){var o=2<=arguments.length;return function(u){return u.pipe(i?yb(function(h,E){return i(h,E,u)}):wd,hb(1),o?sn(r):$d(function(){return new eh}))}}function ev(){return function(i){return i.lift(new fv)}}function un(i){return function(r){return i===0?Qf():r.lift(new gv(i))}}function Uf(i){return function(r){return r.lift(new hv(i))}}function gh(i,r){var o=!1;return 2<=arguments.length&&(o=!0),function(u){return u.lift(new iv(i,r,o))}}function vn(i,r){return 2<=arguments.length?function(o){return Zi(gh(i,r),un(1),sn(r))(o)}:function(o){return Zi(gh(function(u,h,E){return i(u,h,E+1)}),un(1))(o)}}function jv(i,r){return function(o){var u=typeof i=="function"?i:function(){return i},h=Object.create(o,lv);return h.source=o,h.subjectFactory=u,h}}function Re(i){return function(r){return r.lift(new mv(i,r))}}function nv(){return new rb}function Se(){return function(i){return dn()(jv(nv)(i))}}function wn(i,r,o){var u=i&&qa(i)==="object"?i:{bufferSize:i,windowTime:r,refCount:!1,scheduler:o};return function(h){return h.lift(ov(u))}}function ov(i){var r,o,u=i.bufferSize,h=u===void 0?Number.POSITIVE_INFINITY:u,E=(u=i.windowTime)===void 0?Number.POSITIVE_INFINITY:u,v=i.refCount,O=i.scheduler,C=0,k=!1,j=!1;return function(K){if(C++,!r||k){k=!1;var $=(r=new Te(h,E,O)).subscribe(this);o=K.subscribe({next:function(_e){r.next(_e)},error:function(_e){k=!0,r.error(_e)},complete:function(){j=!0,o=void 0,r.complete()}}),j&&(o=void 0)}else $=r.subscribe(this);this.add(function(){C--,$.unsubscribe(),$=void 0,o&&!j&&v&&C===0&&(o.unsubscribe(),r=o=void 0)})}}function Kb(i,r){return function(o){return o.lift(new pv(i))}}function Kc(i){return function(r){return r.lift(new qv(i))}}function sa(i,r,o){return function(u){return u.lift(new rv(i,r,o))}}function sv(i,r,o){return r===void 0&&(r=cd),o===void 0&&(o=tv),function(u){return u.lift(new uv(i,r,o.leading,o.trailing))}}function vv(i){i.subscriber.clearThrottle()}function wv(i,r,o){return o===void 0&&(o=cd),function(u){var h=i instanceof Date&&!isNaN(+i),E=h?+i-o.now():Math.abs(i);return u.lift(new xv(E,h,r,o))}}function Lb(i,r){return r===void 0&&(r=cd),wv(i,ra(new Tb),r)}function yv(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return function(o){var u;return typeof i[i.length-1]=="function"&&(u=i.pop()),o.lift(new zv(i,u))}}function xn(i){(gj||i)&&(yn.abort(),i&&(yn=new AbortController),gj=i)}function zn(i,r,o,u,h){i!==r&&An(r,function(E,v){if(h||(h=new Ie),Gb(E)){E=h;var O=hj(i,v),C=hj(r,v),k=E.get(C);if(k)ij(i,v,k);else{var j=(k=u?u(O,C,v+"",i,r,E):void 0)===void 0;if(j){var K=ub(C),$=!K&&Nf(C),_e=!K&&!$&&Ui(C);k=C,K||$||_e?ub(O)?k=O:Hc(O)&&ae(O)?k=Pi(O):$?(j=!1,k=Nm(C,!0)):_e?(j=!1,k=Bn(C,!0)):k=[]:Cn(C)||Vf(C)?(k=O,Vf(O)?k=Ue(O,Of(O)):Gb(O)&&!jj(O)||(k=Om(C))):j=!1}j&&(E.set(C,k),zn(k,C,o,u,E),E.delete(C)),ij(i,v,k)}}else(O=u?u(hj(i,v),E,v+"",i,r,h):void 0)===void 0&&(O=E),ij(i,v,O)},Of)}function Av(i){var r=1,o=kj;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?r=1>=arguments.length?void 0:arguments[1]:o=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(r=1>=arguments.length?void 0:arguments[1],o=2>=arguments.length?void 0:arguments[2]);var u=r||1;return function(h){return h.pipe(gh(function(E,v){var O=o.now(),C=O-i;if((E=E.filter(function(K){return K.until>C})).length>=u){var k=E[E.length-1],j=E[0].until+i*Math.floor(E.length/u);E.push({delay:k.until<O?j-O:j-k.until,until:j,value:v})}else E.push({delay:0,until:O,value:v});return E},[]),Ea(function(E){return E[E.length-1]}),fj(function(E){var v=ob(E.value);return E.delay?v.pipe(Zd(E.delay,o)):v}))}}function Bv(i,r){var o=(r=r===void 0?{protocols:Dn,makeWebSocket:En}:r).protocols,u=o===void 0?Dn:o,h=(r=r.makeWebSocket)===void 0?En:r;return new ua(function(E){var v,O=new rb,C=h(i,u),k=!1,j=!1,K=!1,$=function(_e){if(v)throw k=!0,_e=Error("Web socket message factory function called more than once"),E.error(_e),_e;return v=_e.subscribe(function(na){C.send(na)}),O};return C.onopen=function(){K=!0,j?(k=!0,C.close()):E.next($)},C.onmessage=function(_e){O.next(_e.data)},C.onerror=function(_e){k=!0,E.error(Error(_e.message))},C.onclose=function(_e){k||(k=!0,j?(E.complete(),O.complete()):E.error(Error(_e.code===1e3?"Normal closure":_e.reason)))},function(){j=!0,v&&v.unsubscribe(),k||(k=!0,K&&C.close())}})}function hh(){this._listeners={}}function Fn(i){return typeof Float32Array<"u"?function(){function r(C,k,j){E[0]=C,k[j]=v[0],k[j+1]=v[1],k[j+2]=v[2],k[j+3]=v[3]}function o(C,k,j){E[0]=C,k[j]=v[3],k[j+1]=v[2],k[j+2]=v[1],k[j+3]=v[0]}function u(C,k){return v[0]=C[k],v[1]=C[k+1],v[2]=C[k+2],v[3]=C[k+3],E[0]}function h(C,k){return v[3]=C[k],v[2]=C[k+1],v[1]=C[k+2],v[0]=C[k+3],E[0]}var E=new Float32Array([-0]),v=new Uint8Array(E.buffer),O=v[3]===128;i.writeFloatLE=O?r:o,i.writeFloatBE=O?o:r,i.readFloatLE=O?u:h,i.readFloatBE=O?h:u}():function(){function r(u,h,E,v){var O=0>h?1:0;if(O&&(h=-h),h===0)u(0<1/h?0:2147483648,E,v);else if(isNaN(h))u(2143289344,E,v);else if(34028234663852886e22<h)u((O<<31|2139095040)>>>0,E,v);else if(11754943508222875e-54>h)u((O<<31|Math.round(h/1401298464324817e-60))>>>0,E,v);else{var C=Math.floor(Math.log(h)/Math.LN2);u((O<<31|C+127<<23|8388607&Math.round(h*Math.pow(2,-C)*8388608))>>>0,E,v)}}function o(u,h,E){return E=u(h,E),u=2*(E>>31)+1,h=E>>>23&255,E&=8388607,h===255?E?NaN:1/0*u:h===0?1401298464324817e-60*u*E:u*Math.pow(2,h-150)*(E+8388608)}i.writeFloatLE=r.bind(null,Gn),i.writeFloatBE=r.bind(null,Hn),i.readFloatLE=o.bind(null,In),i.readFloatBE=o.bind(null,Jn)}(),typeof Float64Array<"u"?function(){function r(C,k,j){E[0]=C,k[j]=v[0],k[j+1]=v[1],k[j+2]=v[2],k[j+3]=v[3],k[j+4]=v[4],k[j+5]=v[5],k[j+6]=v[6],k[j+7]=v[7]}function o(C,k,j){E[0]=C,k[j]=v[7],k[j+1]=v[6],k[j+2]=v[5],k[j+3]=v[4],k[j+4]=v[3],k[j+5]=v[2],k[j+6]=v[1],k[j+7]=v[0]}function u(C,k){return v[0]=C[k],v[1]=C[k+1],v[2]=C[k+2],v[3]=C[k+3],v[4]=C[k+4],v[5]=C[k+5],v[6]=C[k+6],v[7]=C[k+7],E[0]}function h(C,k){return v[7]=C[k],v[6]=C[k+1],v[5]=C[k+2],v[4]=C[k+3],v[3]=C[k+4],v[2]=C[k+5],v[1]=C[k+6],v[0]=C[k+7],E[0]}var E=new Float64Array([-0]),v=new Uint8Array(E.buffer),O=v[7]===128;i.writeDoubleLE=O?r:o,i.writeDoubleBE=O?o:r,i.readDoubleLE=O?u:h,i.readDoubleBE=O?h:u}():function(){function r(u,h,E,v,O,C){var k=0>v?1:0;if(k&&(v=-v),v===0)u(0,O,C+h),u(0<1/v?0:2147483648,O,C+E);else if(isNaN(v))u(0,O,C+h),u(2146959360,O,C+E);else if(17976931348623157e292<v)u(0,O,C+h),u((k<<31|2146435072)>>>0,O,C+E);else if(22250738585072014e-324>v)u((v/=5e-324)>>>0,O,C+h),u((k<<31|v/4294967296)>>>0,O,C+E);else{var j=Math.floor(Math.log(v)/Math.LN2);j===1024&&(j=1023),u(4503599627370496*(v*=Math.pow(2,-j))>>>0,O,C+h),u((k<<31|j+1023<<20|1048576*v&1048575)>>>0,O,C+E)}}function o(u,h,E,v,O){return h=u(v,O+h),v=u(v,O+E),u=2*(v>>31)+1,h=4294967296*(1048575&v)+h,(E=v>>>20&2047)===2047?h?NaN:1/0*u:E===0?5e-324*u*h:u*Math.pow(2,E-1075)*(h+4503599627370496)}i.writeDoubleLE=r.bind(null,Gn,0,4),i.writeDoubleBE=r.bind(null,Hn,4,0),i.readDoubleLE=o.bind(null,In,0,4),i.readDoubleBE=o.bind(null,Jn,4,0)}(),i}function Gn(i,r,o){r[o]=255&i,r[o+1]=i>>>8&255,r[o+2]=i>>>16&255,r[o+3]=i>>>24}function Hn(i,r,o){r[o]=i>>>24,r[o+1]=i>>>16&255,r[o+2]=i>>>8&255,r[o+3]=255&i}function In(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16|i[r+3]<<24)>>>0}function Jn(i,r){return(i[r]<<24|i[r+1]<<16|i[r+2]<<8|i[r+3])>>>0}function vb(i,r){this.lo=i>>>0,this.hi=r>>>0}function Wf(i,r,o){this.fn=i,this.len=r,this.next=void 0,this.val=o}function lj(){}function Cv(i){this.head=i.head,this.tail=i.tail,this.len=i.len,this.next=i.states}function Aa(){this.len=0,this.tail=this.head=new Wf(lj,0,0),this.states=null}function mj(i,r,o){r[o]=255&i}function nj(i,r){this.len=i,this.next=void 0,this.val=r}function oj(i,r,o){for(;i.hi;)r[o++]=127&i.lo|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;127<i.lo;)r[o++]=127&i.lo|128,i.lo>>>=7;r[o++]=i.lo}function pj(i,r,o){r[o]=255&i,r[o+1]=i>>>8&255,r[o+2]=i>>>16&255,r[o+3]=i>>>24}function Lc(){qj.call(this)}function Dv(i,r,o){40>i.length?pa.utf8.write(i,r,o):r.utf8Write?r.utf8Write(i,o):r.write(i,o)}function wc(i,r){return RangeError("index out of range: "+i.pos+" + "+(r||1)+" > "+i.len)}function ib(i){this.buf=i,this.pos=0,this.len=i.length}function rj(){var i=new Kn(0,0),r=0;if(!(4<this.len-this.pos)){for(;3>r;++r){if(this.pos>=this.len)throw wc(this);if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return i}return i.lo=(i.lo|(127&this.buf[this.pos++])<<7*r)>>>0,i}for(;4>r;++r)if(i.lo=(i.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return i;if(i.lo=(i.lo|(127&this.buf[this.pos])<<28)>>>0,i.hi=(i.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return i;if(r=0,4<this.len-this.pos){for(;5>r;++r)if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return i}else for(;5>r;++r){if(this.pos>=this.len)throw wc(this);if(i.hi=(i.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return i}throw Error("invalid varint encoding")}function ih(i,r){return(i[r-4]|i[r-3]<<8|i[r-2]<<16|i[r-1]<<24)>>>0}function Ln(){if(this.pos+8>this.len)throw wc(this,8);return new Kn(ih(this.buf,this.pos+=4),ih(this.buf,this.pos+=4))}function be(i){sj.call(this,i)}function Xf(i,r,o){if(typeof i!="function")throw TypeError("rpcImpl must be a function");pa.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=!!r,this.responseDelimited=!!o}function Mn(i){var r=[];return function o(u){if(u===null||qa(u)!=="object")return u;if(r.indexOf(u)!==-1)return"[Circular]";if(r.push(u),typeof u.toJSON=="function")try{var h=o(u.toJSON());return r.pop(),h}catch(E){return"[Throws: "+(E?E.message:"?")+"]"}return Array.isArray(u)?(h=u.map(o),r.pop(),h):(h=Object.keys(u).reduce(function(E,v){t:{if(Ev.call(u,v))try{var O=u[v];break t}catch(C){O="[Throws: "+(C?C.message:"?")+"]";break t}O=u[v]}return E[v]=o(O),E},{}),r.pop(),h)}(i)}function Fv(i){if(!(100<(i=String(i)).length)&&(i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(i))){var r=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}function jh(i,r,o,u){return Math.round(i/o)+" "+u+(r>=1.5*o?"s":"")}function Gv(i){var r=i.areas,o=i.excludedArea;if(r.length===1&&r[0]===S.GLOBAL&&o===S.CHINA)return Ve([S.OVERSEA]);if(r.includes(S.GLOBAL)){if(i=Yf(kh).filter(function(E){return E!==S.GLOBAL&&E!==S.OVERSEA}),o in Zf){r=Zf[o];var u=[].concat(Z(r??[]),[o]);return Ve(i.filter(function(E){return!u.includes(E)}))}if(Nn(o)){var h=Hv(o);return Ve(i.filter(function(E){return E!==o&&E!==h}))}}if(Nn(o)||o in Zf)return Ve(r);throw new ca("Invalid excludedArea area config")}function jb(i,r,o){o===void 0&&(o=Object.getOwnPropertyDescriptor(i,r));var u=o.value;return o.value=function(){for(var h=this,E=arguments.length,v=Array(E),O=0;O<E;O++)v[O]=arguments[O];this.invokeTracker.apply(this,["%s: ".concat(0<v.length?"%s with args: ".concat(v.map(function(){return"%o"})):"%s"),this.name,r].concat(Z(v.map(We))));try{var C=u.apply(this,v)}catch(j){throw this.logError.apply(this,["".concat(j.code!==void 0?"Error Code ".concat(j.code,": "):"","%s failed").concat(0<v.length?" with args: ".concat(v.map(function(){return"%o"})):""),r].concat(Z(v.map(We)))),j.originalError&&this.logError(j.originalError),this.errorTracker(j),j}var k=Date.now();return ma(N.mark(function j(){var K,$;return N.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.prev=0,_e.next=3,C;case 3:K=_e.sent,_e.next=12;break;case 6:return _e.prev=6,_e.t0=_e.catch(0),h.logError.apply(h,["".concat(_e.t0.code!==void 0?"Error Code ".concat(_e.t0.code,": "):"","%s failed").concat(0<v.length?" with args: ".concat(v.map(function(){return"%o"})):""),r].concat(Z(v.map(We)))),_e.t0.originalError&&h.logError(_e.t0.originalError),h.errorTracker(_e.t0),_e.abrupt("return");case 12:K!==C?K===void 0?h.resultTracker("%s promise resolves after %dms",r,Date.now()-k):h.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-k,We(K)):$c(K)!=="Object"||De(K)?h.resultTracker("%s result is %o",r,We(K)):h.resultTracker("%s result is %s",r,K.name||(($=K.constructor)===null||$===void 0?void 0:$.name));case 13:case"end":return _e.stop()}},j,null,[[0,6]])}))(),C},o}function Mc(i,r,o){o===void 0&&(o=Object.getOwnPropertyDescriptor(i,r));var u=o.value;return o.value=function(){for(var h=this,E=arguments.length,v=Array(E),O=0;O<E;O++)v[O]=arguments[O];this.invokeTracker.apply(this,["%s: ".concat(0<v.length?"%s with args: ".concat(v.map(function(){return"%o"})):"%s"),this.name,r].concat(v));try{var C=u.apply(this,v)}catch(j){throw this.logError.apply(this,["".concat(j.code!==void 0?"Error Code ".concat(j.code,": "):"","%s failed").concat(0<v.length?" with args: ".concat(v.map(function(){return"%o"})):""),r].concat(v)),j.originalError&&this.logError(j.originalError),this.errorTracker(j),j}var k=Date.now();return ma(N.mark(function j(){var K,$;return N.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.prev=0,_e.next=3,C;case 3:K=_e.sent,_e.next=12;break;case 6:return _e.prev=6,_e.t0=_e.catch(0),h.logError.apply(h,["".concat(_e.t0.code!==void 0?"Error Code ".concat(_e.t0.code,": "):"","%s failed").concat(0<v.length?" with args: ".concat(v.map(function(){return"%o"})):""),r].concat(v)),_e.t0.originalError&&h.logError(_e.t0.originalError),h.errorTracker(_e.t0),_e.abrupt("return");case 12:K!==C?K===void 0?h.resultTracker("%s promise resolves after %dms",r,Date.now()-k):h.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-k,K):$c(K)!=="Object"||De(K)?h.resultTracker("%s result is %o",r,K):h.resultTracker("%s result is %s",r,K.name||(($=K.constructor)===null||$===void 0?void 0:$.name));case 13:case"end":return _e.stop()}},j,null,[[0,6]])}))(),C},o}function bb(i,r,o){return tj.apply(this,arguments)}function tj(){return(tj=ma(N.mark(function i(r,o,u){var h,E,v,O=arguments;return N.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return h=3<O.length&&O[3]!==void 0&&O[3],E=Iv[r].encode(o).finish(),v=function(){var k=ma(N.mark(function j(K){var $,_e,na,_c=arguments;return N.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(!(3<(_e=1<_c.length&&_c[1]!==void 0?_c[1]:0))){_a.next=3;break}return _a.abrupt("return");case 3:if(na=Xe(na=u?"https://".concat(($=fa==null?void 0:fa.PROXY_NGINX[0])!==null&&$!==void 0?$:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(K,"&p=443&d=events/proto-raw"):"https://".concat(K,"/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),na=Xe(na,"id",Jv[r].toString()),!h){_a.next=9;break}return _a.next=9,Kv(1e4);case 9:return _a.next=11,lh(na,{body:E,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(_s){return v(K,_e+1)});case 11:case"end":return _a.stop()}},j)}));return function(j){return k.apply(this,arguments)}}(),C.prev=3,C.next=6,v((fa==null?void 0:fa.EVENT_REPORT_DOMAIN[0])||$f()||"webcollector-rtm.agora.io");case 6:C.next=12;break;case 8:return C.prev=8,C.t0=C.catch(3),C.next=12,v(fa&&On(1<(fa==null?void 0:fa.EVENT_REPORT_DOMAIN.length)?fa==null?void 0:fa.EVENT_REPORT_DOMAIN.slice(1):fa==null?void 0:fa.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 12:case"end":return C.stop()}},i,null,[[3,8]])}))).apply(this,arguments)}function Xa(i){return i===void 0?P.fromNumber(0):P.fromNumber(Date.now()-i)}function Ta(i){return typeof i=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(i)&&i!=="null"}function Pn(i){try{var r=i.split(".").map(function(u){return Number(u)})}catch{return!1}if(r.length!==4||r[0]===0)return!1;for(i=0;i<r.length;i++){var o=r[i];if(!Number.isInteger(o)||0>o||255<o)return!1}return!0}function Qn(i,r){if(!Array.isArray(r)||r.length===0||32<r.length||r.some(function(o){return o.length===0||32<o.length}))throw new ca("arguments is not valid",gb);if(!Ta(i))throw new ca("ID is invalid",gb)}function ag(i){var r=i.attributes,o=i.attrSizeMap,u=i.maxAttrsCount,h=i.maxAttrValueSize;if(i=i.maxTotalSize,!De(r))throw new ca("attributes must be an object",gb);if(Object.keys(r).length>u)throw new ic("Exceed the limit of ".concat(u," attributes"),Ye);if(Object.keys(r).length===0)throw new ca("The attributes is an empty object",gb);var E=0,v=0;for(r=Object.entries(r);v<r.length;v++){var O=$a(r[v],2),C=O[1];O=new Blob([O[0]]).size;var k=new Blob([C]).size;if(O===0||32<O)throw new ca("Invalid attribute key",gb);if(k>h)throw new ic("Invalid attribute value, over the limit of ".concat(h," bytes"),Ye);if(typeof C!="string"||C.length===0)throw new ca("Invalid attribute value",gb);E+=O,E+=k}if(E>i)throw new ic("The attributes size overflow",Ye);if(o!==void 0){if(Object.keys(o).length>u)throw new ic("Exceed the limit of ".concat(u," attributes"),Ye);for(E=u=0,o=Object.entries(o);E<o.length;E++){if(v=(r=$a(o[E],2))[1],(r=new Blob([r[0]]).size)===0)throw new ca("Invalid attribute key",gb);if(v>h)throw new ic("Invalid attribute value, over the limit of ".concat(h," bytes"),Ye);u+=r,u+=v}if(u>i)throw new ic("The attributes size overflow",Ye)}}function mh(i,r){return Math.floor(Math.random()*(Math.floor(r)-Math.ceil(i)+1))+i}function nh(){var i=mh(0,4294967295),r=mh(1,4294967295);return new P(i,r,!0)}function sb(i){return i.toString().padEnd(32,"0")}function Rn(i,r){return new TypeError("Unexpected ".concat(i,": ").concat(r))}function Sn(i,r){return i=i.split(".").map(function(o){return Number(o)}),r=r.split(".").map(function(o){return Number(o)}),Math.sqrt(1e3*Math.pow(i[0]-r[0],2)+100*Math.pow(i[1]-r[1],2)+10*Math.pow(i[2]-r[2],2)+1*Math.pow(i[3]-r[3],2))}function Tn(i){return i.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?i.toNumber():i.toString()}function uj(i,r){r="".concat(i).concat(r||"");var o=Un.get(r)||1;return Un.set(r,o+1),"".concat(i).concat(o)}function Vn(i,r){var o=typeof r=="number"?r:r!==void 0&&typeof r!="string"?r.code:void 0;return r=typeof r!="number"&&typeof r!="string"&&r!==void 0&&r.serverCode!==void 0?r.serverCode:void 0,o="".concat(o!==void 0?" Error Code ".concat(o):"").concat(r!==void 0?", server Code ".concat(r):""),i=typeof i=="string"&&i?oh(i):Array.isArray(i)&&typeof i[0]=="string"&&i[0]?oh(Wn.apply(void 0,[i[0]].concat(Z(i.slice(1))))):"","".concat(o===""?"":"".concat(o," - ")).concat(i)}function Kv(i,r){return vj.apply(this,arguments)}function vj(){return(vj=ma(N.mark(function i(r,o){return N.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!o||!o.aborted){u.next=2;break}return u.abrupt("return");case 2:return u.abrupt("return",new Promise(function(h){setTimeout(h,r),o==null||o.addEventListener("abort",h)}));case 3:case"end":return u.stop()}},i)}))).apply(this,arguments)}function lh(i,r,o){return wj.apply(this,arguments)}function wj(){return(wj=ma(N.mark(function i(r,o,u){var h,E,v,O,C,k,j,K,$,_e,na,_c,_a,_s,_h,_f,E_,y_,F_,w_,W_,_S,o_,b_,h_,B_;return N.wrap(function(e_){for(;;)switch(e_.prev=e_.next){case 0:if(h=o.body,E=o.headers,v=E===void 0?{}:E,O=o.timeout,C=O===void 0?1e4:O,k=o.signal,j=o.withCredentials,K=j!==void 0&&j,$=(u||{}).useBinaryResponse,_e=$!==void 0&&$,(na=new XMLHttpRequest).open("POST",r,!0),na.responseType=_e?"arraybuffer":"text",na.withCredentials=K,na.timeout=C,_c=h instanceof FormData,_a=h instanceof Uint8Array,!(1<(_s=Object.keys(v).filter(function(r_){return r_.toLowerCase()==="content-type"})).length)){e_.next=14;break}throw new RangeError("multiple content-type");case 14:_s.length===0&&(_a?v["Content-Type"]="application/octet-stream":_c||(v["Content-Type"]="application/json"));case 15:if("setRequestHeader"in na){e_.next=46;break}return na.abort(),e_.next=19,fetch(r,{body:_c||_a?h:JSON.stringify(h),cache:"no-cache",credentials:K?"include":"same-origin",headers:v,method:"POST",mode:"cors",referrer:"no-referrer",signal:k});case 19:if(_h=e_.sent,!(200<=(_f=_h.status)&&300>_f||_f===304)){e_.next=31;break}if(!_e){e_.next=27;break}return e_.next=25,_h.arrayBuffer();case 25:return E_=e_.sent,e_.abrupt("return",{status:_f,responseData:E_});case 27:return e_.next=29,_h.text();case 29:return y_=e_.sent,e_.abrupt("return",{status:_f,responseText:y_});case 31:return F_=new Ja(["Post XHR failure, status %d",_f]),e_.prev=32,e_.next=35,_h.text();case 35:throw w_=e_.sent,F_.statusCode=_f,F_.message=w_||"Request failed, status ".concat(_f),F_;case 41:throw e_.prev=41,e_.t0=e_.catch(32),F_.statusCode=_f,F_.message="Request failed, status ".concat(_f),F_;case 46:if(Object.keys(v).length!==0)for(W_=0,_S=Object.entries(v);W_<_S.length;W_++)o_=$a(_S[W_],2),b_=o_[0],h_=o_[1],na.setRequestHeader(b_,h_);return k!==void 0&&(B_=function r_(){na.abort(),k.removeEventListener("abort",r_)},k.addEventListener("abort",B_)),_c||_a?na.send(h):na.send(JSON.stringify(h)),e_.abrupt("return",new Promise(function(r_,_p){na.onload=function(){var c_=na.status;if(200<=c_&&300>c_||c_===304)r_(_e?{status:c_,responseData:na.response}:{status:c_,responseText:na.responseText});else{var v_=new Ja(["Post XHR failure, status %d",c_]);v_.statusCode=c_,v_.message=na.response||"Request failed, status ".concat(na.status),_p(v_)}},na.ontimeout=function(c_){_p(new Ub(["XHR request timed out after %d ms",C],{originalError:c_}))},na.onerror=function(){var c_=new Ja(["Post XHR failure, status %d",na.status]);c_.statusCode=na.status,c_.message=na.response||"Request failed, status ".concat(na.status),_p(c_)},na.onabort=function(){try{_p(new DOMException("The request aborted.","AbortError"))}catch{var c_=Error("The request aborted.");c_.name="AbortError",_p(c_)}}}));case 50:case"end":return e_.stop()}},i,null,[[32,41]])}))).apply(this,arguments)}function Xn(i,r){if(!De(i))throw new ca("message object is not a plain object",r);if(i.messageType===void 0)if(i.rawMessage instanceof Uint8Array){if(i.messageType="RAW",i.text!==void 0)throw new ca("Raw messages cannot have text property. Use description instead",r)}else{if(typeof i.text!="string")throw new ca("messageType is undefined",r);if(i.messageType="TEXT",i.rawMessage!==void 0)throw new ca("Text messages cannot have rawMessage property",r)}}function ph(i){return xj.apply(this,arguments)}function xj(){return(xj=ma(N.mark(function i(r){var o,u,h,E,v,O,C,k,j,K,$,_e,na,_c,_a,_s,_h,_f,E_,y_,F_;return N.wrap(function(w_){for(;;)switch(w_.prev=w_.next){case 0:if(o=r.message,u=r.peerId,h=r.toPeer,E=r.session,v=r.errorCodes,O=r.diff,C=r.logger,E!==void 0){w_.next=3;break}throw new da("The client is not logged in. Cannot do the operation",v.NOT_LOGGED_IN);case 3:if(k=!1,j=h?o.messageType==="TEXT"?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag:o.messageType==="TEXT"?Ka.ChannelSMsg:Ka.ChannelRMsg,o.messageType!=="TEXT"||!o.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!h){w_.next=14;break}if(K=o.text.split("_"),$=$a(K,3),_e=$[0],na=$[1],$[2]!==void 0&&Ta(na)&&_e==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){w_.next=13;break}throw E.emit("messageCount",{messageCategory:j,type:"common",key:"sentcount"}),E.emit("messageCount",{messageCategory:j,type:"common",key:"invalidmessagecount"}),new ca("Message is not valid",bg);case 13:k=!0;case 14:if(_c=Date.now(),_a=E.messageSentTimes.length-1,!((_s=E.messageSentTimes[_a])&&_s+3e3<_c)){w_.next=21;break}E.messageSentTimes=[_c],w_.next=34;break;case 21:_h=_a;case 22:if(!(0<=_h)){w_.next=33;break}if(!(E.messageSentTimes[_h]+3e3<_c)){w_.next=26;break}return E.messageSentTimes=E.messageSentTimes.slice(_h+1,_a+1),w_.abrupt("break",33);case 26:if(!(180<=_a-_h+1)){w_.next=30;break}throw E.emit("messageCount",{messageCategory:j,type:"common",key:"sentcount"}),E.emit("messageCount",{messageCategory:j,type:"common",key:"toooftencount"}),new ic("Message sent failed, exceeded the 180 message in 3 seconds",v.TOO_OFTEN);case 30:_h--,w_.next=22;break;case 33:E.messageSentTimes.push(_c);case 34:w_.t0=o.messageType,w_.next=w_.t0==="TEXT"?37:w_.t0==="RAW"?42:44;break;case 37:if(!k){w_.next=41;break}return _f=o.text.split("_"),E_=$a(_f,3),y_=E_[1],F_=E_[2],C.info("[rtm-API] EndCall message send api is called"),w_.abrupt("return",E.sendInvitationMessage({peerId:u,type:"CallCancel",extra:F_,channelId:y_,callId:"0"}));case 41:return w_.abrupt("return",E.sendTextMessage(o.text,u,h,1e4-O));case 42:return o.description===void 0&&(o.description=""),w_.abrupt("return",E.sendRawMessage(o.rawMessage,o.description,u,h,1e4-O));case 44:throw E.emit("messageCount",{messageCategory:j,type:"common",key:"sentcount"}),E.emit("messageCount",{messageCategory:j,type:"common",key:"invalidmessagecount"}),new ca("Invalid message type",bg);case 47:case"end":return w_.stop()}},i)}))).apply(this,arguments)}function Lv(i){var r=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],o=i.replace(/(https?:\/\/)?(www.)?/i,"");return r||(o=o.split(".").slice(i.length-2).join(".")),o.indexOf("/")!==-1?o.split("/")[0]:o}function La(i){if(typeof i!="string")return"[Sensitive Info]";var r=Math.floor(.7*i.length),o=i.length;return Yn(i,r,o,"*".repeat(o-r))}function Zn(i,r,o){function u(h){if(i===void 0)return i;if(Mm(h))return h;if(Array.isArray(h))return h.map(u);var E={},v=0;for(h=qh(h);v<h.length;v++){var O=$a(h[v],2),C=O[0];if(typeof(O=O[1])=="string"&&o.includes(C)){E[C]=typeof O=="string"?La(O):"[Sensitive Info]";break}r.includes(C)?E[C]="[Hidden Info]":E[C]=O==null?O:o.includes(C)?"[Sensitive Info]":u(O)}return E}return Array.isArray(i)?i.map(u):u(i)}function $n(i){return Object.getOwnPropertyNames(i).forEach(function(r){qa(r=i[r])=="object"&&r!==null&&$n(r)}),Object.freeze(i)}function cg(i){return new TextDecoder("utf-8").decode(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength))}function rh(i){return new TextEncoder().encode(i).length}function ao(){for(var i=0,r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];for(r=0;r<o.length;r++)i+=o[r].length;for(i=new Uint8Array(i),u=r=0;u<o.length;u++){var h=o[u];i.set(h,r),r+=h.length}return i}function Xe(i,r,o){var u=i.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(i=u==null?void 0:u[1],u=u==null?void 0:u[2]){var h;for(u=u.substr(1).split("&"),h=0;h<u.length;h++)if(u[h].split("=")[0]==r){u[h]=r+"="+encodeURIComponent(o);break}return h==u.length&&u.push(r+"="+encodeURIComponent(o)),i+"?"+u.join("&")}return i+"?"+r+"="+encodeURIComponent(o)}function Yn(i,r,o,u){return typeof i!="string"?"[Sensitive Info]":i.substring(0,r)+u+i.substring(o)}function $f(i){return!1}function Mv(i,r){var o="".concat(i,"Uri");if(typeof(o=yj[o])!="number"||o===0)throw new TypeError("Got Unknown URI Name");return r=new(i=bo[i])(r),r=i.encode(r).finish(),new Nv({uri:o,data:r})}function co(i,r){return"".concat(i.split(".").join("-"),".edge.").concat(r?"sd-rtn.com":"agora.io")}function sh(i,r){return P.fromValue(i).eq(r)}function th(i,r){var o=r===void 0?i.val:r,u=i.isBoolean;r=i.isNumber;var h=i.oneof,E=i.len;if([u,r,h].filter(function(v){return!v}).length!==2)throw new TypeError("invalid field type");if(o!==void 0&&(i=!1,h!==void 0&&(h=zj(h),Ov(h,sh).length===h.length&&Pv(h,function(v){return sh(o,v)})!==void 0&&(i=!0)),u=u!==void 0&&(o===0||o===1)&&E===1,r=r!==void 0&&o.toString(2).length<=E,!(i||u||r)))throw Error("invalid field value")}function eo(i){return i.reduce(function(r,o){return r.concat(o instanceof uh.UnsubscriptionError?o.errors:o)},[])}function Qv(i,r){do dg==2147483647?dg=0:dg++;while(Ze.hasOwnProperty(dg));var o=dg;return Ze[o]={callback:i,parameters:Array.prototype.slice.call(arguments,2)},Aj.postMessage({name:"setInterval",fakeId:o,time:r}),o}function fo(i){return function(){var r=i();if(!r)throw new da("Client is not logged in. Cannot do the operation");return r}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},vh=function(i){return i&&i.Math==Math&&i},R=vh(typeof globalThis=="object"&&globalThis)||vh(typeof window=="object"&&window)||vh(typeof self=="object"&&self)||vh(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),la=function(i){try{return!!i()}catch{return!0}},wa=!la(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),go={}.propertyIsEnumerable,ho=Object.getOwnPropertyDescriptor,eg=ho&&!go.call({1:2},1)?function(i){return!!(i=ho(this,i))&&i.enumerable}:go,Nc=function(i,r){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:r}},Rv={}.toString,xc=function(i){return Rv.call(i).slice(8,-1)},Sv="".split,fg=la(function(){return!Object("z").propertyIsEnumerable(0)})?function(i){return xc(i)=="String"?Sv.call(i,""):Object(i)}:Object,Eb=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i},Mb=function(i){return fg(Eb(i))},xa=function(i){return typeof i=="object"?i!==null:typeof i=="function"},Oc=function(i,r){if(!xa(i))return i;var o,u;if(r&&typeof(o=i.toString)=="function"&&!xa(u=o.call(i))||typeof(o=i.valueOf)=="function"&&!xa(u=o.call(i))||!r&&typeof(o=i.toString)=="function"&&!xa(u=o.call(i)))return u;throw TypeError("Can't convert object to primitive value")},pb=function(i){return Object(Eb(i))},Tv={}.hasOwnProperty,ka=function(i,r){return Tv.call(pb(i),r)},$e=R.document,wh=xa($e)&&xa($e.createElement),io=!wa&&!la(function(){return Object.defineProperty(wh?$e.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),jo=Object.getOwnPropertyDescriptor,dc={f:wa?jo:function(i,r){if(i=Mb(i),r=Oc(r,!0),io)try{return jo(i,r)}catch{}if(ka(i,r))return Nc(!eg.call(i,r),i[r])}},Ia=function(i){if(!xa(i))throw TypeError(String(i)+" is not an object");return i},ko=Object.defineProperty,qb={f:wa?ko:function(i,r,o){if(Ia(i),r=Oc(r,!0),Ia(o),io)try{return ko(i,r,o)}catch{}if("get"in o||"set"in o)throw TypeError("Accessors not supported");return"value"in o&&(i[r]=o.value),i}},kb=wa?function(i,r,o){return qb.f(i,r,Nc(1,o))}:function(i,r,o){return i[r]=o,i},Bj=function(i,r){try{kb(R,i,r)}catch{R[i]=r}return r},zd=R["__core-js_shared__"]||Bj("__core-js_shared__",{}),Uv=Function.toString;typeof zd.inspectSource!="function"&&(zd.inspectSource=function(i){return Uv.call(i)});var Cj=zd.inspectSource,lo=R.WeakMap,Vv=typeof lo=="function"&&/native code/.test(Cj(lo)),Ad=xb(function(i){(i.exports=function(r,o){return zd[r]||(zd[r]=o!==void 0?o:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})}),Wv=0,Xv=Math.random(),af=function(i){return"Symbol("+String(i===void 0?"":i)+")_"+(++Wv+Xv).toString(36)},mo=Ad("keys"),xh=function(i){return mo[i]||(mo[i]=af(i))},bf={},Yv=R.WeakMap;if(Vv||zd.state)var ce=zd.state||(zd.state=new Yv),Zv=ce.get,no=ce.has,$v=ce.set,Dj=function(i,r){if(no.call(ce,i))throw new TypeError("Object already initialized");return r.facade=i,$v.call(ce,i,r),r},yh=function(i){return Zv.call(ce,i)||{}},Ej=function(i){return no.call(ce,i)};else{var cf=xh("state");bf[cf]=!0,Dj=function(i,r){if(ka(i,cf))throw new TypeError("Object already initialized");return r.facade=i,kb(i,cf,r),r},yh=function(i){return ka(i,cf)?i[cf]:{}},Ej=function(i){return ka(i,cf)}}var cb={set:Dj,get:yh,has:Ej,enforce:function(i){return Ej(i)?yh(i):Dj(i,{})},getterFor:function(i){return function(r){var o;if(!xa(r)||(o=yh(r)).type!==i)throw TypeError("Incompatible receiver, "+i+" required");return o}}},Za=xb(function(i){var r=cb.get,o=cb.enforce,u=String(String).split("String");(i.exports=function(h,E,v,O){var C=!!O&&!!O.unsafe,k=!!O&&!!O.enumerable;if(O=!!O&&!!O.noTargetGet,typeof v=="function"){typeof E!="string"||ka(v,"name")||kb(v,"name",E);var j=o(v);j.source||(j.source=u.join(typeof E=="string"?E:""))}h===R?k?h[E]=v:Bj(E,v):(C?!O&&h[E]&&(k=!0):delete h[E],k?h[E]=v:kb(h,E,v))})(Function.prototype,"toString",function(){return typeof this=="function"&&r(this).source||Cj(this)})}),oo=function(i){return typeof i=="function"?i:void 0},Pc=function(i,r){return 2>arguments.length?oo(R[i])||oo(R[i]):R[i]&&R[i][r]||R[i]&&R[i][r]},aw=Math.ceil,bw=Math.floor,yc=function(i){return isNaN(i=+i)?0:(0<i?bw:aw)(i)},cw=Math.min,Ma=function(i){return 0<i?cw(yc(i),9007199254740991):0},dw=Math.max,ew=Math.min,Vb=function(i,r){return 0>(i=yc(i))?dw(i+r,0):ew(i,r)},po=function(i){return function(r,o,u){r=Mb(r);var h=Ma(r.length);if(u=Vb(u,h),i&&o!=o){for(;h>u;)if((o=r[u++])!=o)return!0}else for(;h>u;u++)if((i||u in r)&&r[u]===o)return i||u||0;return!i&&-1}},qo=po(!0),Fj=po(!1),ro=function(i,r){i=Mb(i);var o,u=0,h=[];for(o in i)!ka(bf,o)&&ka(i,o)&&h.push(o);for(;r.length>u;)ka(i,o=r[u++])&&(~Fj(h,o)||h.push(o));return h},zh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),fw=zh.concat("length","prototype"),de={f:Object.getOwnPropertyNames||function(i){return ro(i,fw)}},gg={f:Object.getOwnPropertySymbols},so=Pc("Reflect","ownKeys")||function(i){var r=de.f(Ia(i)),o=gg.f;return o?r.concat(o(i)):r},to=function(i,r){for(var o=so(r),u=qb.f,h=dc.f,E=0;E<o.length;E++){var v=o[E];ka(i,v)||u(i,v,h(r,v))}},gw=/#|\.prototype\./,Qc=function(i,r){return(i=hw[iw(i)])==jw||i!=kw&&(typeof r=="function"?la(r):!!r)},iw=Qc.normalize=function(i){return String(i).replace(gw,".").toLowerCase()},hw=Qc.data={},kw=Qc.NATIVE="N",jw=Qc.POLYFILL="P",lw=dc.f,ea=function(i,r){var o,u,h,E=i.target,v=i.global,O=i.stat;if(u=v?R:O?R[E]||Bj(E,{}):(R[E]||{}).prototype)for(h in r){var C=r[h],k=i.noTargetGet?(o=lw(u,h))&&o.value:u[h];if(!(o=Qc(v?h:E+(O?".":"#")+h,i.forced))&&k!==void 0){if(typeof C==typeof k)continue;to(C,k)}(i.sham||k&&k.sham)&&kb(C,"sham",!0);try{Za(u,h,C,i)}catch{}}},Gj=function(){var i=Ia(this),r="";return i.global&&(r+="g"),i.ignoreCase&&(r+="i"),i.multiline&&(r+="m"),i.dotAll&&(r+="s"),i.unicode&&(r+="u"),i.sticky&&(r+="y"),r},Rc=la(function(){var i=/a/y;return i.lastIndex=2,i.exec("abcd")!=null}),mw=la(function(){var i=/^r/gy;return i.lastIndex=2,i.exec("str")!=null}),Ah=RegExp.prototype.exec,nw=Ad("native-string-replace",String.prototype.replace),uo=Ah,Hj=(c=/a/,b=/b*/g,Ah.call(c,"a"),Ah.call(b,"a"),c.lastIndex!==0||b.lastIndex!==0),vo=Rc||mw,Ij=/()??/.exec("")[1]!==void 0,c,b;(Hj||Ij||vo)&&(uo=function(i){var r,o=vo&&this.sticky,u=Gj.call(this),h=this.source,E=0,v=i;if(o){(u=u.replace("y","")).indexOf("g")===-1&&(u+="g"),v=String(i).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&i[this.lastIndex-1]!==`
`)&&(h="(?: "+h+")",v=" "+v,E++);var O=new RegExp("^(?:"+h+")",u)}if(Ij&&(O=new RegExp("^"+h+"$(?!\\s)",u)),Hj)var C=this.lastIndex;var k=Ah.call(o?O:this,v);return o?k?(k.input=k.input.slice(E),k[0]=k[0].slice(E),k.index=this.lastIndex,this.lastIndex+=k[0].length):this.lastIndex=0:Hj&&k&&(this.lastIndex=this.global?k.index+k[0].length:C),Ij&&k&&1<k.length&&nw.call(k[0],O,function(){for(r=1;r<arguments.length-2;r++)arguments[r]===void 0&&(k[r]=void 0)}),k});var hg=uo;ea({target:"RegExp",proto:!0,forced:/./.exec!==hg},{exec:hg});var df=Pc("navigator","userAgent")||"",wo=R.process,xo=wo&&wo.versions,yo=xo&&xo.v8;if(yo)var Bd=yo.split("."),Jj=4>Bd[0]?1:Bd[0]+Bd[1];else df&&(Bd=df.match(/Edge\/(\d+)/),(!Bd||74<=Bd[1])&&(Bd=df.match(/Chrome\/(\d+)/))&&(Jj=Bd[1]));var Cd=Jj&&+Jj,Sc=!!Object.getOwnPropertySymbols&&!la(function(){return!String(Symbol())||!Symbol.sham&&Cd&&41>Cd}),zo=Sc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ig=Ad("wks"),jg=R.Symbol,ow=zo?jg:jg&&jg.withoutSetter||af,Fa=function(i){return ka(ig,i)&&(Sc||typeof ig[i]=="string")||(Sc&&ka(jg,i)?ig[i]=jg[i]:ig[i]=ow("Symbol."+i)),ig[i]},pw=Fa("species"),Kj=RegExp.prototype,qw=!la(function(){var i=/./;return i.exec=function(){var r=[];return r.groups={a:"7"},r},"".replace(i,"$<a>")!=="7"}),Ao="a".replace(/./,"$0")==="$0",Bo=Fa("replace"),Co=!!/./[Bo]&&/./[Bo]("a","$0")==="",rw=!la(function(){var i=/(?:)/,r=i.exec;return i.exec=function(){return r.apply(this,arguments)},(i="ab".split(i)).length!==2||i[0]!=="a"||i[1]!=="b"}),Bh=function(i,r,o,u){var h=Fa(i),E=!la(function(){var k={};return k[h]=function(){return 7},""[i](k)!=7}),v=E&&!la(function(){var k=!1,j=/a/;return i==="split"&&((j={constructor:{}}).constructor[pw]=function(){return j},j.flags="",j[h]=/./[h]),j.exec=function(){return k=!0,null},j[h](""),!k});if(!E||!v||i==="replace"&&(!qw||!Ao||Co)||i==="split"&&!rw){var O=/./[h],C=(o=o(h,""[i],function(k,j,K,$,_e){var na=j.exec;return na===hg||na===Kj.exec?E&&!_e?{done:!0,value:O.call(j,K,$)}:{done:!0,value:k.call(K,j,$)}:{done:!1}},{REPLACE_KEEPS_$0:Ao,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Co}))[1];Za(String.prototype,i,o[0]),Za(Kj,h,r==2?function(k,j){return C.call(k,this,j)}:function(k){return C.call(k,this)})}u&&kb(Kj[h],"sham",!0)},sw=Fa("match"),Lj=function(i){var r;return xa(i)&&((r=i[sw])!==void 0?!!r:xc(i)=="RegExp")},Wb=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i},tw=Fa("species"),ee=function(i,r){var o;return(i=Ia(i).constructor)===void 0||(o=Ia(i)[tw])==null?r:Wb(o)},Do=function(i){return function(r,o){r=String(Eb(r)),o=yc(o);var u,h=r.length;if(0>o||o>=h)return i?"":void 0;var E=r.charCodeAt(o);return 55296>E||56319<E||o+1===h||56320>(u=r.charCodeAt(o+1))||57343<u?i?r.charAt(o):E:i?r.slice(o,o+2):u-56320+(E-55296<<10)+65536}},uw=Do(!1),Eo=Do(!0),Mj=function(i,r,o){return r+(o?Eo(i,r).length:1)},ef=function(i,r){var o=i.exec;if(typeof o=="function"){if(typeof(i=o.call(i,r))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return i}if(xc(i)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return hg.call(i,r)},vw=[].push,ww=Math.min;Bh("split",2,function(i,r,o){var u="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(h,E){var v=String(Eb(this));if((E=E===void 0?4294967295:E>>>0)===0)return[];if(h===void 0)return[v];if(!Lj(h))return r.call(v,h,E);var O,C,k,j=[],K=0;for(h=new RegExp(h.source,(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(h.sticky?"y":"")+"g");(O=hg.call(h,v))&&!((C=h.lastIndex)>K&&(j.push(v.slice(K,O.index)),1<O.length&&O.index<v.length&&vw.apply(j,O.slice(1)),k=O[0].length,K=C,j.length>=E));)h.lastIndex===O.index&&h.lastIndex++;return K===v.length?(k||!h.test(""))&&j.push(""):j.push(v.slice(K)),j.length>E?j.slice(0,E):j}:"0".split(void 0,0).length?function(h,E){return h===void 0&&E===0?[]:r.call(this,h,E)}:r;return[function(h,E){var v=Eb(this),O=h==null?void 0:h[i];return O!==void 0?O.call(h,v,E):u.call(String(v),h,E)},function(h,E){var v=o(u,h,this,E,u!==r);if(v.done)return v.value;var O=Ia(h);h=String(this);var C=ee(O,RegExp);if(v=O.unicode,O=new C(Rc?"^(?:"+O.source+")":O,(O.ignoreCase?"i":"")+(O.multiline?"m":"")+(O.unicode?"u":"")+(Rc?"g":"y")),(E=E===void 0?4294967295:E>>>0)===0)return[];if(h.length===0)return ef(O,h)===null?[h]:[];var k=0,j=0;for(C=[];j<h.length;){O.lastIndex=Rc?0:j;var K,$=ef(O,Rc?h.slice(j):h);if($===null||(K=ww(Ma(O.lastIndex+(Rc?j:0)),h.length))===k)j=Mj(h,j,v);else{if(C.push(h.slice(k,j)),C.length===E)return C;for(k=1;k<=$.length-1;k++)if(C.push($[k]),C.length===E)return C;j=k=K}}return C.push(h.slice(k)),C}]},Rc);var xw=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,yw=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,Nj=function(i){return function(r){return r=String(Eb(r)),1&i&&(r=r.replace(xw,"")),2&i&&(r=r.replace(yw,"")),r}},Oj=Nj(3),Ch=R.parseInt,zw=/^[+-]?0[Xx]/,Fo=Ch(`	
\v\f\r                　\u2028\u2029\uFEFF08`)!==8||Ch(`	
\v\f\r                　\u2028\u2029\uFEFF0x16`)!==22?function(i,r){return i=Oj(String(i)),Ch(i,r>>>0||(zw.test(i)?16:10))}:Ch;ea({global:!0,forced:parseInt!=Fo},{parseInt:Fo});var Dd=function(i,r,o){if(Wb(i),r===void 0)return i;switch(o){case 0:return function(){return i.call(r)};case 1:return function(u){return i.call(r,u)};case 2:return function(u,h){return i.call(r,u,h)};case 3:return function(u,h,E){return i.call(r,u,h,E)}}return function(){return i.apply(r,arguments)}},Ed=Array.isArray||function(i){return xc(i)=="Array"},Aw=Fa("species"),Dh=function(i,r){if(Ed(i)){var o=i.constructor;typeof o!="function"||o!==Array&&!Ed(o.prototype)?xa(o)&&(o=o[Aw])===null&&(o=void 0):o=void 0}return new(o===void 0?Array:o)(r===0?0:r)},Go=[].push,Fd=function(i){var r=i==1,o=i==2,u=i==3,h=i==4,E=i==6,v=i==7,O=i==5||E;return function(C,k,j,K){var $=pb(C),_e=fg($);k=Dd(k,j,3),j=Ma(_e.length);var na,_c=0;for(K=K||Dh,C=r?K(C,j):o||v?K(C,0):void 0;j>_c;_c++)if((O||_c in _e)&&(na=k(K=_e[_c],_c,$),i))if(r)C[_c]=na;else if(na)switch(i){case 3:return!0;case 5:return K;case 6:return _c;case 2:Go.call(C,K)}else switch(i){case 4:return!1;case 7:Go.call(C,K)}return E?-1:u||h?h:C}},fe=Fd(0),Ho=Fd(1),Io=Fd(2),Bw=Fd(3),Cw=Fd(4),Jo=Fd(5),Dw=Fd(6),Ew=Fa("species"),kg=function(i){return 51<=Cd||!la(function(){var r=[];return(r.constructor={})[Ew]=function(){return{foo:1}},r[i](Boolean).foo!==1})},Fw=kg("filter");ea({target:"Array",proto:!0,forced:!Fw},{filter:function(i){return Io(this,i,1<arguments.length?arguments[1]:void 0)}});var ed=Object.keys||function(i){return ro(i,zh)},Gw=la(function(){ed(1)});ea({target:"Object",stat:!0,forced:Gw},{keys:function(i){return ed(pb(i))}});var ff=function(i,r){var o=[][i];return!!o&&la(function(){o.call(null,r||function(){throw 1},1)})},Hw=[].join,Iw=fg!=Object,Jw=ff("join",",");ea({target:"Array",proto:!0,forced:Iw||!Jw},{join:function(i){return Hw.call(Mb(this),i===void 0?",":i)}});var Kw=kg("map");ea({target:"Array",proto:!0,forced:!Kw},{map:function(i){return Ho(this,i,1<arguments.length?arguments[1]:void 0)}});var Pj=function(i){var r=i.return;if(r!==void 0)return Ia(r.call(i)).value},gf={},Lw=Fa("iterator"),Mw=Array.prototype,Qj=function(i){return i!==void 0&&(gf.Array===i||Mw[Lw]===i)},hf=function(i,r,o){(r=Oc(r))in i?qb.f(i,r,Nc(0,o)):i[r]=o},Nw=Fa("toStringTag"),Ko={};Ko[Nw]="z";var Rj=String(Ko)==="[object z]",Ow=Fa("toStringTag"),Pw=xc(function(){return arguments}())=="Arguments",jf=Rj?xc:function(i){var r;if(i===void 0)var o="Undefined";else{if(i===null)var u="Null";else{t:{var h=i=Object(i);try{u=h[Ow];break t}catch{}u=void 0}u=typeof(o=u)=="string"?o:Pw?xc(i):(r=xc(i))=="Object"&&typeof i.callee=="function"?"Arguments":r}o=u}return o},Qw=Fa("iterator"),lg=function(i){if(i!=null)return i[Qw]||i["@@iterator"]||gf[jf(i)]},ge=function(i){var r,o=pb(i),u=typeof this=="function"?this:Array,h=arguments.length,E=1<h?arguments[1]:void 0,v=E!==void 0,O=lg(o),C=0;if(v&&(E=Dd(E,2<h?arguments[2]:void 0,2)),O==null||u==Array&&Qj(O)){var k=Ma(o.length);for(u=new u(k);k>C;C++)O=v?E(o[C],C):o[C],hf(u,C,O)}else for(h=(o=O.call(o)).next,u=new u;!(r=h.call(o)).done;C++){if(v){O=o;var j=E;r=[r.value,C];try{k=j(Ia(r)[0],r[1])}catch(K){throw Pj(O),K}}else k=r.value;hf(u,C,O=k)}return u.length=C,u},Lo=Fa("iterator"),Mo=!1;try{var Rw=0,No={next:function(){return{done:!!Rw++}},return:function(){Mo=!0}};No[Lo]=function(){return this},Array.from(No,function(){throw 2})}catch(i){}var Eh=function(i,r){if(!r&&!Mo)return!1;var o=!1;try{(r={})[Lo]=function(){return{next:function(){return{done:o=!0}}}},i(r)}catch{}return o},Sw=!Eh(function(i){Array.from(i)});ea({target:"Array",stat:!0,forced:Sw},{from:ge});var Oo=!la(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),Po=xh("IE_PROTO"),Tw=Object.prototype,uc=Oo?Object.getPrototypeOf:function(i){return i=pb(i),ka(i,Po)?i[Po]:typeof i.constructor=="function"&&i instanceof i.constructor?i.constructor.prototype:i instanceof Object?Tw:null},Sj=Fa("iterator"),Qo=!1,Uw=function(){return this},he;if([].keys){var Ro=[].keys();if("next"in Ro){var So=uc(uc(Ro));So!==Object.prototype&&(he=So)}else Qo=!0}(he==null||la(function(){var i={};return he[Sj].call(i)!==i}))&&(he={}),ka(he,Sj)||kb(he,Sj,Uw);var Fh=he,Gh=Qo,To=wa?Object.defineProperties:function(i,r){Ia(i);for(var o,u=ed(r),h=u.length,E=0;h>E;)qb.f(i,o=u[E++],r[o]);return i},Tj=Pc("document","documentElement"),Uo=xh("IE_PROTO"),Uj=function(){},Vj,Hh=function(){try{Vj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(Vj){var i=Vj;i.write("<script><\/script>"),i.close(),i=i.parentWindow.Object}else(i=wh?$e.createElement("iframe"):{}).style.display="none",Tj.appendChild(i),i.src="javascript:",(i=i.contentWindow.document).open(),i.write("<script>document.F=Object<\/script>"),i.close(),i=i.F;for(Hh=i,i=zh.length;i--;)delete Hh.prototype[zh[i]];return Hh()};bf[Uo]=!0;var jc=Object.create||function(i,r){if(i!==null){Uj.prototype=Ia(i);var o=new Uj;Uj.prototype=null,o[Uo]=i}else o=Hh();return r===void 0?o:To(o,r)},Vw=qb.f,Vo=Fa("toStringTag"),zc=function(i,r,o){i&&!ka(i=o?i:i.prototype,Vo)&&Vw(i,Vo,{configurable:!0,value:r})},Ww=function(){return this},Wo=function(i,r,o){return r+=" Iterator",i.prototype=jc(Fh,{next:Nc(1,o)}),zc(i,r,!1),gf[r]=Ww,i},tb=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,r={};try{var o=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;o.call(r,[]),i=r instanceof Array}catch{}return function(u,h){if(Ia(u),!xa(h)&&h!==null)throw TypeError("Can't set "+String(h)+" as a prototype");return i?o.call(u,h):u.__proto__=h,u}}():void 0),mg=Fa("iterator"),Xw=function(){return this},Wj=function(i,r,o,u,h,E,v){Wo(o,r,u),u=function(_c){if(_c===h&&$)return $;if(!Gh&&_c in j)return j[_c];switch(_c){case"keys":case"values":case"entries":return function(){return new o(this,_c)}}return function(){return new o(this)}};var O,C=r+" Iterator",k=!1,j=i.prototype,K=j[mg]||j["@@iterator"]||h&&j[h],$=!Gh&&K||u(h),_e=r=="Array"&&j.entries||K;if(_e&&(i=uc(_e.call(new i)),Fh!==Object.prototype&&i.next&&(uc(i)!==Fh&&(tb?tb(i,Fh):typeof i[mg]!="function"&&kb(i,mg,Xw)),zc(i,C,!0))),h=="values"&&K&&K.name!=="values"&&(k=!0,$=function(){return K.call(this)}),j[mg]!==$&&kb(j,mg,$),gf[r]=$,h){var na={values:u("values"),keys:E?$:u("keys"),entries:u("entries")};if(v)for(O in na)!Gh&&!k&&O in j||Za(j,O,na[O]);else ea({target:r,proto:!0,forced:Gh||k},na)}return na},Yw=cb.set,Zw=cb.getterFor("String Iterator");Wj(String,"String",function(i){Yw(this,{type:"String Iterator",string:String(i),index:0})},function(){var i=Zw(this),r=i.string,o=i.index;return o>=r.length?{value:void 0,done:!0}:(r=Eo(r,o),i.index+=r.length,{value:r,done:!1})});var Xj=Fa("unscopables"),Yj=Array.prototype;Yj[Xj]==null&&qb.f(Yj,Xj,{configurable:!0,value:jc(null)});var ng=function(i){Yj[Xj][i]=!0},Xo=!0;"find"in[]&&Array(1).find(function(){Xo=!1}),ea({target:"Array",proto:!0,forced:Xo},{find:function(i){return Jo(this,i,1<arguments.length?arguments[1]:void 0)}}),ng("find");var Yo=function(i){var r=String(Eb(this)),o="";if(0>(i=yc(i))||i==1/0)throw RangeError("Wrong number of repetitions");for(;0<i;(i>>>=1)&&(r+=r))1&i&&(o+=r);return o};ea({target:"String",proto:!0},{repeat:Yo});var Zo=[].indexOf,$o=!!Zo&&0>1/[1].indexOf(1,-0),$w=ff("indexOf");ea({target:"Array",proto:!0,forced:$o||!$w},{indexOf:function(i){return $o?Zo.apply(this,arguments)||0:Fj(this,i,1<arguments.length?arguments[1]:void 0)}});var Zt=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,$t=/CrOS/,au=/android|ipad|playbook|silk/i;Ce.isMobile=Ce,Ce.default=Ce,ea({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),ea({target:"Number",stat:!0},{isNaN:function(i){return i!=i}}),R.Number.isNaN;var ax=Rj?{}.toString:function(){return"[object "+jf(this)+"]"};Rj||Za(Object.prototype,"toString",ax,{unsafe:!0});var Ih=R.Promise,kf=function(i,r,o){for(var u in r)Za(i,u,r[u],o);return i},ap=Fa("species"),og=function(i){i=Pc(i);var r=qb.f;wa&&i&&!i[ap]&&r(i,ap,{configurable:!0,get:function(){return this}})},Ac=function(i,r,o){if(!(i instanceof r))throw TypeError("Incorrect "+(o?o+" ":"")+"invocation");return i},pg=function(i,r){this.stopped=i,this.result=r},Jh=function(i,r,o){var u,h=!(!o||!o.AS_ENTRIES),E=!(!o||!o.IS_ITERATOR),v=!(!o||!o.INTERRUPTED),O=Dd(r,o&&o.that,1+h+v),C=function(j){return k&&Pj(k),new pg(!0,j)};if(r=function(j){return h?(Ia(j),v?O(j[0],j[1],C):O(j[0],j[1])):v?O(j,C):O(j)},E)var k=i;else{if(typeof(E=lg(i))!="function")throw TypeError("Target is not iterable");if(Qj(E)){for(E=0,o=Ma(i.length);o>E;E++)if((u=r(i[E]))&&u instanceof pg)return u;return new pg(!1)}k=E.call(i)}for(i=k.next;!(E=i.call(k)).done;){try{u=r(E.value)}catch(j){throw Pj(k),j}if(typeof u=="object"&&u&&u instanceof pg)return u}return new pg(!1)},bp=/(?:iphone|ipod|ipad).*applewebkit/i.test(df),fd=xc(R.process)=="process",Kh=R.location,Zj=R.setImmediate,cp=R.clearImmediate,bx=R.process,dp=R.MessageChannel,ak=R.Dispatch,bk=0,qg={},ck=function(i){if(qg.hasOwnProperty(i)){var r=qg[i];delete qg[i],r()}},dk=function(i){return function(){ck(i)}},ep=function(i){ck(i.data)},fp=function(i){R.postMessage(i+"",Kh.protocol+"//"+Kh.host)};if(!Zj||!cp)if(Zj=function(i){for(var r=[],o=1;arguments.length>o;)r.push(arguments[o++]);return qg[++bk]=function(){(typeof i=="function"?i:Function(i)).apply(void 0,r)},rg(bk),bk},cp=function(i){delete qg[i]},fd)var rg=function(i){bx.nextTick(dk(i))};else if(ak&&ak.now)rg=function(i){ak.now(dk(i))};else if(dp&&!bp){var gp=new dp,hp=gp.port2;gp.port1.onmessage=ep,rg=Dd(hp.postMessage,hp,1)}else R.addEventListener&&typeof postMessage=="function"&&!R.importScripts&&Kh&&Kh.protocol!=="file:"&&!la(fp)?(rg=fp,R.addEventListener("message",ep,!1)):rg="onreadystatechange"in(wh?$e.createElement("script"):{})?function(i){Tj.appendChild(wh?$e.createElement("script"):{}).onreadystatechange=function(){Tj.removeChild(this),ck(i)}}:function(i){setTimeout(dk(i),0)};var ek=Zj,cx=/web0s(?!.*chrome)/i.test(df),dx=dc.f,ip=R.MutationObserver||R.WebKitMutationObserver,jp=R.document,kp=R.process,Lh=R.Promise,lp=dx(R,"queueMicrotask"),mp=lp&&lp.value,ie,sg;if(!mp){var Nh=function(){var i;for(fd&&(i=kp.domain)&&i.exit();ie;){var r=ie.fn;ie=ie.next;try{r()}catch(o){throw ie?Mh():sg=void 0,o}}sg=void 0,i&&i.enter()};if(bp||fd||cx||!ip||!jp)if(Lh&&Lh.resolve){var fk=Lh.resolve(void 0);fk.constructor=Lh;var ex=fk.then,Mh=function(){ex.call(fk,Nh)}}else Mh=fd?function(){kp.nextTick(Nh)}:function(){ek.call(R,Nh)};else{var np=!0,op=jp.createTextNode("");new ip(Nh).observe(op,{characterData:!0}),Mh=function(){op.data=np=!np}}}var pp=mp||function(i){i={fn:i,next:void 0},sg&&(sg.next=i),ie||(ie=i,Mh()),sg=i},fx=function(i){var r,o;this.promise=new i(function(u,h){if(r!==void 0||o!==void 0)throw TypeError("Bad Promise constructor");r=u,o=h}),this.resolve=Wb(r),this.reject=Wb(o)},gk={f:function(i){return new fx(i)}},gx=function(i,r){var o=R.console;o&&o.error&&(arguments.length===1?o.error(i):o.error(i,r))},hk=function(i){try{return{error:!1,value:i()}}catch(r){return{error:!0,value:r}}},hx=typeof window=="object",ix=Fa("species"),qp=cb.get,jx=cb.set,kx=cb.getterFor("Promise"),je=Ih&&Ih.prototype,Xb=Ih,Oh=je,rp=R.TypeError,ik=R.document,jk=R.process,lf=gk.f,lx=lf,mx=!!(ik&&ik.createEvent&&R.dispatchEvent),sp=typeof PromiseRejectionEvent=="function",tp=!1,tg=Qc("Promise",function(){var i=Cj(Xb)!==String(Xb);if(!i&&Cd===66)return!0;if(51<=Cd&&/native code/.test(Xb))return!1;var r=new Xb(function(u){u(1)}),o=function(u){u(function(){},function(){})};return(r.constructor={})[ix]=o,!(tp=r.then(function(){})instanceof o)||!i&&hx&&!sp}),nx=tg||!Eh(function(i){Xb.all(i).catch(function(){})}),up=function(i){var r;return!(!xa(i)||typeof(r=i.then)!="function")&&r},kk=function(i,r){if(!i.notified){i.notified=!0;var o=i.reactions;pp(function(){for(var u=i.value,h=i.state==1,E=0;o.length>E;){var v,O=o[E++],C=h?O.ok:O.fail,k=O.resolve,j=O.reject,K=O.domain;try{if(C){if(h||(i.rejection===2&&ox(i),i.rejection=1),C===!0)var $=u;else if(K&&K.enter(),$=C(u),K){K.exit();var _e=!0}$===O.promise?j(rp("Promise-chain cycle")):(v=up($))?v.call($,k,j):k($)}else j(u)}catch(na){K&&!_e&&K.exit(),j(na)}}i.reactions=[],i.notified=!1,r&&!i.rejection&&px(i)})}},vp=function(i,r,o){var u;if(mx){var h=ik.createEvent("Event");h.promise=r,h.reason=o,h.initEvent(i,!1,!0),R.dispatchEvent(h)}else h={promise:r,reason:o};!sp&&(u=R["on"+i])?u(h):i==="unhandledrejection"&&gx("Unhandled promise rejection",o)},px=function(i){ek.call(R,function(){var r=i.facade,o=i.value;if(i.rejection!==1&&!i.parent){var u=hk(function(){fd?jk.emit("unhandledRejection",o,r):vp("unhandledrejection",r,o)});if(i.rejection=fd||i.rejection!==1&&!i.parent?2:1,u.error)throw u.value}})},ox=function(i){ek.call(R,function(){var r=i.facade;fd?jk.emit("rejectionHandled",r):vp("rejectionhandled",r,i.value)})},mf=function(i,r,o){return function(u){i(r,u,o)}},nf=function(i,r,o){i.done||(i.done=!0,o&&(i=o),i.value=r,i.state=2,kk(i,!0))},lk=function(i,r,o){if(!i.done){i.done=!0,o&&(i=o);try{if(i.facade===r)throw rp("Promise can't be resolved itself");var u=up(r);u?pp(function(){var h={done:!1};try{u.call(r,mf(lk,h,i),mf(nf,h,i))}catch(E){nf(h,E,i)}}):(i.value=r,i.state=1,kk(i,!1))}catch(h){nf({done:!1},h,i)}}};if(tg){Xb=function(i){Ac(this,Xb,"Promise"),Wb(i),mk.call(this);var r=qp(this);try{i(mf(lk,r),mf(nf,r))}catch(o){nf(r,o)}},Oh=Xb.prototype;var mk=function(i){jx(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};mk.prototype=kf(Oh,{then:function(i,r){var o=kx(this),u=lf(ee(this,Xb));return u.ok=typeof i!="function"||i,u.fail=typeof r=="function"&&r,u.domain=fd?jk.domain:void 0,o.parent=!0,o.reactions.push(u),o.state!=0&&kk(o,!1),u.promise},catch:function(i){return this.then(void 0,i)}});var qx=function(){var i=new mk,r=qp(i);this.promise=i,this.resolve=mf(lk,r),this.reject=mf(nf,r)};if(gk.f=lf=function(i){return i===Xb||i===rx?new qx(i):lx(i)},typeof Ih=="function"&&je!==Object.prototype){var sx=je.then;tp||(Za(je,"then",function(i,r){var o=this;return new Xb(function(u,h){sx.call(o,u,h)}).then(i,r)},{unsafe:!0}),Za(je,"catch",Oh.catch,{unsafe:!0}));try{delete je.constructor}catch{}tb&&tb(je,Oh)}}ea({global:!0,wrap:!0,forced:tg},{Promise:Xb}),zc(Xb,"Promise",!1),og("Promise");var rx=Pc("Promise");ea({target:"Promise",stat:!0,forced:tg},{reject:function(i){var r=lf(this);return r.reject.call(void 0,i),r.promise}}),ea({target:"Promise",stat:!0,forced:tg},{resolve:function(i){if(Ia(this),!xa(i)||i.constructor!==this){var r=gk.f(this);(0,r.resolve)(i),i=r.promise}return i}}),ea({target:"Promise",stat:!0,forced:nx},{all:function(i){var r=this,o=lf(r),u=o.resolve,h=o.reject,E=hk(function(){var v=Wb(r.resolve),O=[],C=0,k=1;Jh(i,function(j){var K=C++,$=!1;O.push(void 0),k++,v.call(r,j).then(function(_e){$||($=!0,O[K]=_e,--k||u(O))},h)}),--k||u(O)});return E.error&&h(E.value),o.promise},race:function(i){var r=this,o=lf(r),u=o.reject,h=hk(function(){var E=Wb(r.resolve);Jh(i,function(v){E.call(r,v).then(o.resolve,u)})});return h.error&&u(h.value),o.promise}});var tx=Math.floor,ux="".replace,vx=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wx=/\$([$&'`]|\d{1,2})/g,xx=function(i,r,o,u,h,E){var v=o+i.length,O=u.length,C=wx;return h!==void 0&&(h=pb(h),C=vx),ux.call(E,C,function(k,j){switch(j.charAt(0)){case"$":return"$";case"&":return i;case"`":return r.slice(0,o);case"'":return r.slice(v);case"<":k=h[j.slice(1,-1)];break;default:var K=+j;if(K===0)return k;if(K>O)return(K=tx(K/10))===0?k:K<=O?u[K-1]===void 0?j.charAt(1):u[K-1]+j.charAt(1):k;k=u[K-1]}return k===void 0?"":k})},yx=Math.max,zx=Math.min;Bh("replace",2,function(i,r,o,u){var h=u.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,E=u.REPLACE_KEEPS_$0,v=h?"$":"$0";return[function(O,C){var k=Eb(this),j=O==null?void 0:O[i];return j!==void 0?j.call(O,k,C):r.call(String(k),O,C)},function(O,C){if(!h&&E||typeof C=="string"&&C.indexOf(v)===-1){var k=o(r,O,this,C);if(k.done)return k.value}var j=Ia(O);O=String(this),(k=typeof C=="function")||(C=String(C));var K=j.global;if(K){var $=j.unicode;j.lastIndex=0}for(var _e=[];;){var na=ef(j,O);if(na===null||(_e.push(na),!K))break;String(na[0])===""&&(j.lastIndex=Mj(O,Ma(j.lastIndex),$))}for($="",K=j=0;K<_e.length;K++){na=_e[K];for(var _c=String(na[0]),_a=yx(zx(yc(na.index),O.length),0),_s=[],_h=1;_h<na.length;_h++){var _f=_s,E_=na[_h];_f.push.call(_f,E_===void 0?E_:String(E_))}na=na.groups,k?(_s=[_c].concat(_s,_a,O),na!==void 0&&_s.push(na),na=String(C.apply(void 0,_s))):na=xx(_c,O,_a,_s,na,C),_a>=j&&($+=O.slice(j,_a)+na,j=_a+_c.length)}return $+O.slice(j)}]});var Ax=kg("slice"),Bx=Fa("species"),Cx=[].slice,Dx=Math.max;ea({target:"Array",proto:!0,forced:!Ax},{slice:function(i,r){var o=Mb(this),u=Ma(o.length);if(i=Vb(i,u),r=Vb(r===void 0?u:r,u),Ed(o)){var h=o.constructor;if(typeof h!="function"||h!==Array&&!Ed(h.prototype)?xa(h)&&(h=h[Bx])===null&&(h=void 0):h=void 0,h===Array||h===void 0)return Cx.call(o,i,r)}for(h=new(h===void 0?Array:h)(Dx(r-i,0)),u=0;i<r;i++,u++)i in o&&hf(h,u,o[i]);return h.length=u,h}});var Ex=cb.set,Fx=cb.getterFor("Array Iterator"),Gd=Wj(Array,"Array",function(i,r){Ex(this,{type:"Array Iterator",target:Mb(i),index:0,kind:r})},function(){var i=Fx(this),r=i.target,o=i.kind,u=i.index++;return!r||u>=r.length?(i.target=void 0,{value:void 0,done:!0}):o=="keys"?{value:u,done:!1}:o=="values"?{value:r[u],done:!1}:{value:[u,r[u]],done:!1}},"values");gf.Arguments=gf.Array,ng("keys"),ng("values"),ng("entries");var wp=typeof ArrayBuffer<"u"&&typeof DataView<"u",of=function(i){if(i===void 0)return 0;i=yc(i);var r=Ma(i);if(i!==r)throw RangeError("Wrong length or index");return r},Gx=Math.abs,gd=Math.pow,Hx=Math.floor,Ix=Math.log,Jx=Math.LN2,xp=function(i){var r=pb(this),o=Ma(r.length),u=arguments.length,h=Vb(1<u?arguments[1]:void 0,o);for(o=(u=2<u?arguments[2]:void 0)===void 0?o:Vb(u,o);o>h;)r[h++]=i;return r},Kx=de.f,Lx=qb.f,pf=cb.get,yp=cb.set,Bc=R.ArrayBuffer,Yb=Bc,Cc=R.DataView,Ph=Cc&&Cc.prototype,zp=Object.prototype,Qh=R.RangeError,Ap=function(i,r,o){var u,h=Array(o),E=(1<<(o=8*o-r-1))-1,v=E>>1,O=r===23?gd(2,-24)-gd(2,-77):0,C=0>i||i===0&&0>1/i?1:0,k=0;if((i=Gx(i))!=i||i===1/0){i=i!=i?1:0;var j=E}else j=Hx(Ix(i)/Jx),1>i*(u=gd(2,-j))&&(j--,u*=2),2<=(i=1<=j+v?i+O/u:i+O*gd(2,1-v))*u&&(j++,u/=2),j+v>=E?(i=0,j=E):1<=j+v?(i=(i*u-1)*gd(2,r),j+=v):(i=i*gd(2,v-1)*gd(2,r),j=0);for(;8<=r;h[k++]=255&i,i/=256,r-=8);for(j=j<<r|i,o+=r;0<o;h[k++]=255&j,j/=256,o-=8);return h[--k]|=128*C,h},Bp=function(i,r){var o=i.length,u=8*o-r-1,h=(1<<u)-1,E=h>>1;u-=7,--o;var v=i[o--],O=127&v;for(v>>=7;0<u;O=256*O+i[o],o--,u-=8);var C=O&(1<<-u)-1;for(O>>=-u,u+=r;0<u;C=256*C+i[o],o--,u-=8);if(O===0)O=1-E;else{if(O===h)return C?NaN:v?-1/0:1/0;C+=gd(2,r),O-=E}return(v?-1:1)*C*gd(2,O-r)},Cp=function(i){return[255&i]},Dp=function(i){return[255&i,i>>8&255]},Ep=function(i){return[255&i,i>>8&255,i>>16&255,i>>24&255]},Fp=function(i){return i[3]<<24|i[2]<<16|i[1]<<8|i[0]},Mx=function(i){return Ap(i,23,4)},Nx=function(i){return Ap(i,52,8)},Rh=function(i,r){Lx(i.prototype,r,{get:function(){return pf(this)[r]}})},Hd=function(i,r,o,u){o=of(o);var h=pf(i);if(o+r>h.byteLength)throw Qh("Wrong index");return i=pf(h.buffer).bytes,o+=h.byteOffset,r=i.slice(o,o+r),u?r:r.reverse()},Id=function(i,r,o,u,h,E){o=of(o);var v=pf(i);if(o+r>v.byteLength)throw Qh("Wrong index");for(i=pf(v.buffer).bytes,o+=v.byteOffset,u=u(+h),h=0;h<r;h++)i[o+h]=u[E?h:r-h-1]};if(wp){if(!la(function(){Bc(1)})||!la(function(){new Bc(-1)})||la(function(){return new Bc,new Bc(1.5),new Bc(NaN),Bc.name!="ArrayBuffer"})){Yb=function(i){return Ac(this,Yb),new Bc(of(i))};for(var Ox=Yb.prototype=Bc.prototype,Gp=Kx(Bc),Hp=0,nk;Gp.length>Hp;)(nk=Gp[Hp++])in Yb||kb(Yb,nk,Bc[nk]);Ox.constructor=Yb}tb&&uc(Ph)!==zp&&tb(Ph,zp);var Sh=new Cc(new Yb(2)),Ip=Ph.setInt8;Sh.setInt8(0,2147483648),Sh.setInt8(1,2147483649),!Sh.getInt8(0)&&Sh.getInt8(1)||kf(Ph,{setInt8:function(i,r){Ip.call(this,i,r<<24>>24)},setUint8:function(i,r){Ip.call(this,i,r<<24>>24)}},{unsafe:!0})}else Yb=function(i){Ac(this,Yb,"ArrayBuffer"),i=of(i),yp(this,{bytes:xp.call(Array(i),0),byteLength:i}),wa||(this.byteLength=i)},Cc=function(i,r,o){Ac(this,Cc,"DataView"),Ac(i,Yb,"DataView");var u=pf(i).byteLength;if(0>(r=yc(r))||r>u)throw Qh("Wrong offset");if(r+(o=o===void 0?u-r:Ma(o))>u)throw Qh("Wrong length");yp(this,{buffer:i,byteLength:o,byteOffset:r}),wa||(this.buffer=i,this.byteLength=o,this.byteOffset=r)},wa&&(Rh(Yb,"byteLength"),Rh(Cc,"buffer"),Rh(Cc,"byteLength"),Rh(Cc,"byteOffset")),kf(Cc.prototype,{getInt8:function(i){return Hd(this,1,i)[0]<<24>>24},getUint8:function(i){return Hd(this,1,i)[0]},getInt16:function(i){var r=Hd(this,2,i,1<arguments.length?arguments[1]:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(i){var r=Hd(this,2,i,1<arguments.length?arguments[1]:void 0);return r[1]<<8|r[0]},getInt32:function(i){return Fp(Hd(this,4,i,1<arguments.length?arguments[1]:void 0))},getUint32:function(i){return Fp(Hd(this,4,i,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(i){return Bp(Hd(this,4,i,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(i){return Bp(Hd(this,8,i,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(i,r){Id(this,1,i,Cp,r)},setUint8:function(i,r){Id(this,1,i,Cp,r)},setInt16:function(i,r){Id(this,2,i,Dp,r,2<arguments.length?arguments[2]:void 0)},setUint16:function(i,r){Id(this,2,i,Dp,r,2<arguments.length?arguments[2]:void 0)},setInt32:function(i,r){Id(this,4,i,Ep,r,2<arguments.length?arguments[2]:void 0)},setUint32:function(i,r){Id(this,4,i,Ep,r,2<arguments.length?arguments[2]:void 0)},setFloat32:function(i,r){Id(this,4,i,Mx,r,2<arguments.length?arguments[2]:void 0)},setFloat64:function(i,r){Id(this,8,i,Nx,r,2<arguments.length?arguments[2]:void 0)}});zc(Yb,"ArrayBuffer"),zc(Cc,"DataView");var ug={ArrayBuffer:Yb,DataView:Cc},ok=ug.ArrayBuffer,Jp=ug.DataView,Kp=ok.prototype.slice,Px=la(function(){return!new ok(2).slice(1,void 0).byteLength});ea({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Px},{slice:function(i,r){if(Kp!==void 0&&r===void 0)return Kp.call(Ia(this),i);var o=Ia(this).byteLength;i=Vb(i,o),r=Vb(r===void 0?o:r,o),o=new(ee(this,ok))(Ma(r-i));for(var u=new Jp(this),h=new Jp(o),E=0;i<r;)h.setUint8(E++,u.getUint8(i++));return o}});var Qx=qb.f,Th=R.Int8Array,pk=Th&&Th.prototype,Lp=R.Uint8ClampedArray,Mp=Lp&&Lp.prototype,Tc=Th&&uc(Th),Dc=pk&&uc(pk),Np=Object.prototype,Op=Np.isPrototypeOf,Pp=Fa("toStringTag"),qk=af("TYPED_ARRAY_TAG"),hd=wp&&!!tb&&jf(R.opera)!=="Opera",Qp=!1,Zb,Uc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Rx={BigInt64Array:8,BigUint64Array:8},Uh=function(i){return!!xa(i)&&(i=jf(i),ka(Uc,i)||ka(Rx,i))};for(Zb in Uc)R[Zb]||(hd=!1);if((!hd||typeof Tc!="function"||Tc===Function.prototype)&&(Tc=function(){throw TypeError("Incorrect invocation")},hd))for(Zb in Uc)R[Zb]&&tb(R[Zb],Tc);if((!hd||!Dc||Dc===Np)&&(Dc=Tc.prototype,hd))for(Zb in Uc)R[Zb]&&tb(R[Zb].prototype,Dc);if(hd&&uc(Mp)!==Dc&&tb(Mp,Dc),wa&&!ka(Dc,Pp))for(Zb in Qp=!0,Qx(Dc,Pp,{get:function(){return xa(this)?this[qk]:void 0}}),Uc)R[Zb]&&kb(R[Zb],qk,Zb);var vg=hd,Rp=Qp&&qk,Ua=function(i){if(Uh(i))return i;throw TypeError("Target is not a typed array")},qf=function(i){if(tb){if(Op.call(Tc,i))return i}else for(var r in Uc)if(ka(Uc,Zb)){var o=R[r];if(o&&(i===o||Op.call(o,i)))return i}throw TypeError("Target is not a typed array constructor")},Ra=function(i,r,o){if(wa){if(o)for(var u in Uc){var h=R[u];if(h&&ka(h.prototype,i))try{delete h.prototype[i]}catch{}}Dc[i]&&!o||Za(Dc,i,o?r:hd&&pk[i]||r)}},Sp=function(i,r,o){var u,h;if(wa){if(tb){if(o){for(u in Uc)if((h=R[u])&&ka(h,i))try{delete h[i]}catch{}}if(Tc[i]&&!o)return;try{return Za(Tc,i,o?r:hd&&Tc[i]||r)}catch{}}for(u in Uc)!(h=R[u])||h[i]&&!o||Za(h,i,r)}},Tp=Tc,wg=Dc,Sx=R.ArrayBuffer,ke=R.Int8Array,rk=!vg||!la(function(){ke(1)})||!la(function(){new ke(-1)})||!Eh(function(i){new ke,new ke(null),new ke(1.5),new ke(i)},!0)||la(function(){return new ke(new Sx(2),1,void 0).length!==1}),Vh=function(i,r){if(0>(i=yc(i)))throw RangeError("The argument can't be less than 0");if(i%r)throw RangeError("Wrong offset");return i},sk=function(i){var r=pb(i),o=arguments.length,u=1<o?arguments[1]:void 0,h=u!==void 0,E=lg(r);if(E!=null&&!Qj(E)){var v=E.call(r),O=v.next;for(r=[];!(E=O.call(v)).done;)r.push(E.value)}for(h&&2<o&&(u=Dd(u,arguments[2],2)),E=Ma(r.length),v=new(qf(this))(E),o=0;E>o;o++)v[o]=h?u(r[o],o):r[o];return v},Wh=function(i,r,o){var u,h;return tb&&typeof(u=r.constructor)=="function"&&u!==o&&xa(h=u.prototype)&&h!==o.prototype&&tb(i,h),i},xg=xb(function(i){var r=de.f,o=cb.get,u=cb.set,h=qb.f,E=dc.f,v=Math.round,O=R.RangeError,C=ug.ArrayBuffer,k=ug.DataView,j=function(_a,_s){var _h=0,_f=_s.length;for(_a=new(qf(_a))(_f);_f>_h;)_a[_h]=_s[_h++];return _a},K=function(_a,_s){h(_a,_s,{get:function(){return o(this)[_s]}})},$=function(_a){var _s;return _a instanceof C||(_s=jf(_a))=="ArrayBuffer"||_s=="SharedArrayBuffer"},_e=function(_a,_s){return Uh(_a)&&typeof _s!="symbol"&&_s in _a&&String(+_s)==String(_s)},na=function(_a,_s){return _e(_a,_s=Oc(_s,!0))?Nc(2,_a[_s]):E(_a,_s)},_c=function(_a,_s,_h){return!(_e(_a,_s=Oc(_s,!0))&&xa(_h)&&ka(_h,"value"))||ka(_h,"get")||ka(_h,"set")||_h.configurable||ka(_h,"writable")&&!_h.writable||ka(_h,"enumerable")&&!_h.enumerable?h(_a,_s,_h):(_a[_s]=_h.value,_a)};wa?(vg||(dc.f=na,qb.f=_c,K(wg,"buffer"),K(wg,"byteOffset"),K(wg,"byteLength"),K(wg,"length")),ea({target:"Object",stat:!0,forced:!vg},{getOwnPropertyDescriptor:na,defineProperty:_c}),i.exports=function(_a,_s,_h){var _f=_a.match(/\d+$/)[0]/8,E_=_a+(_h?"Clamped":"")+"Array",y_="get"+_a,F_="set"+_a,w_=R[E_],W_=w_;_a=W_&&W_.prototype;var _S={},o_=function(b_,h_){h(b_,h_,{get:function(){var B_=o(this);return B_.view[y_](h_*_f+B_.byteOffset,!0)},set:function(B_){var e_=o(this);_h&&(B_=0>(B_=v(B_))?0:255<B_?255:255&B_),e_.view[F_](h_*_f+e_.byteOffset,B_,!0)},enumerable:!0})};vg?rk&&(W_=_s(function(b_,h_,B_,e_){return Ac(b_,W_,E_),Wh(xa(h_)?$(h_)?e_!==void 0?new w_(h_,Vh(B_,_f),e_):B_!==void 0?new w_(h_,Vh(B_,_f)):new w_(h_):Uh(h_)?j(W_,h_):sk.call(W_,h_):new w_(of(h_)),b_,W_)}),tb&&tb(W_,Tp),fe(r(w_),function(b_){b_ in W_||kb(W_,b_,w_[b_])}),W_.prototype=_a):(W_=_s(function(b_,h_,B_,e_){Ac(b_,W_,E_);var r_=0,_p=0;if(xa(h_)){if(!$(h_))return Uh(h_)?j(W_,h_):sk.call(W_,h_);var c_=h_;if(_p=Vh(B_,_f),h_=h_.byteLength,e_===void 0){if(h_%_f||0>(e_=h_-_p))throw O("Wrong length")}else if((e_=Ma(e_)*_f)+_p>h_)throw O("Wrong length");h_=e_/_f}else h_=of(h_),c_=new C(e_=h_*_f);for(u(b_,{buffer:c_,byteOffset:_p,byteLength:e_,length:h_,view:new k(c_)});r_<h_;)o_(b_,r_++)}),tb&&tb(W_,Tp),_a=W_.prototype=jc(wg)),_a.constructor!==W_&&kb(_a,"constructor",W_),Rp&&kb(_a,Rp,E_),_S[E_]=W_,ea({global:!0,forced:W_!=w_,sham:!vg},_S),"BYTES_PER_ELEMENT"in W_||kb(W_,"BYTES_PER_ELEMENT",_f),"BYTES_PER_ELEMENT"in _a||kb(_a,"BYTES_PER_ELEMENT",_f),og(E_)}):i.exports=function(){}});xg("Uint8",function(i){return function(r,o,u){return i(this,r,o,u)}});var Tx=Math.min,Ux=[].copyWithin||function(i,r){var o=pb(this),u=Ma(o.length),h=Vb(i,u),E=Vb(r,u),v=2<arguments.length?arguments[2]:void 0;for(u=Tx((v===void 0?u:Vb(v,u))-E,u-h),v=1,E<h&&h<E+u&&(v=-1,E+=u-1,h+=u-1);0<u--;)E in o?o[h]=o[E]:delete o[h],h+=v,E+=v;return o};Ra("copyWithin",function(i,r){return Ux.call(Ua(this),i,r,2<arguments.length?arguments[2]:void 0)}),Ra("every",function(i){return Cw(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("fill",function(i){return xp.apply(Ua(this),arguments)}),Ra("filter",function(i){var r=Io(Ua(this),i,1<arguments.length?arguments[1]:void 0),o=ee(this,this.constructor),u=0,h=r.length;for(o=new(qf(o))(h);h>u;)o[u]=r[u++];return o}),Ra("find",function(i){return Jo(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("findIndex",function(i){return Dw(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("forEach",function(i){fe(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("includes",function(i){return qo(Ua(this),i,1<arguments.length?arguments[1]:void 0)}),Ra("indexOf",function(i){return Fj(Ua(this),i,1<arguments.length?arguments[1]:void 0)});var Up=Fa("iterator"),Vp=R.Uint8Array,Vx=Gd.values,Wx=Gd.keys,Xx=Gd.entries,tk=Vp&&Vp.prototype[Up],Wp=!!tk&&(tk.name=="values"||tk.name==null),Xp=function(){return Vx.call(Ua(this))};Ra("entries",function(){return Xx.call(Ua(this))}),Ra("keys",function(){return Wx.call(Ua(this))}),Ra("values",Xp,!Wp),Ra(Up,Xp,!Wp);var Yx=[].join;Ra("join",function(i){return Yx.apply(Ua(this),arguments)});var Zx=Math.min,uk=[].lastIndexOf,Yp=!!uk&&0>1/[1].lastIndexOf(1,-0),$x=ff("lastIndexOf"),ay=Yp||!$x?function(i){if(Yp)return uk.apply(this,arguments)||0;var r=Mb(this),o=Ma(r.length),u=o-1;for(1<arguments.length&&(u=Zx(u,yc(arguments[1]))),0>u&&(u=o+u);0<=u;u--)if(u in r&&r[u]===i)return u||0;return-1}:uk;Ra("lastIndexOf",function(i){return ay.apply(Ua(this),arguments)}),Ra("map",function(i){return Ho(Ua(this),i,1<arguments.length?arguments[1]:void 0,function(r,o){return new(qf(ee(r,r.constructor)))(o)})});var Zp=function(i){return function(r,o,u,h){Wb(o),r=pb(r);var E=fg(r),v=Ma(r.length),O=i?v-1:0,C=i?-1:1;if(2>u)for(;;){if(O in E){h=E[O],O+=C;break}if(O+=C,i?0>O:v<=O)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=O:v>O;O+=C)O in E&&(h=o(h,E[O],O,r));return h}},$p=Zp(!1),by=Zp(!0);Ra("reduce",function(i){return $p(Ua(this),i,arguments.length,1<arguments.length?arguments[1]:void 0)}),Ra("reduceRight",function(i){return by(Ua(this),i,arguments.length,1<arguments.length?arguments[1]:void 0)});var cy=Math.floor;Ra("reverse",function(){for(var i,r=Ua(this).length,o=cy(r/2),u=0;u<o;)i=this[u],this[u++]=this[--r],this[r]=i;return this});var dy=la(function(){new Int8Array(1).set({})});Ra("set",function(i){Ua(this);var r=Vh(1<arguments.length?arguments[1]:void 0,1),o=this.length,u=pb(i),h=Ma(u.length),E=0;if(h+r>o)throw RangeError("Wrong length");for(;E<h;)this[r+E]=u[E++]},dy);var ey=[].slice,fy=la(function(){new Int8Array(1).slice()});Ra("slice",function(i,r){i=ey.call(Ua(this),i,r);var o=ee(this,this.constructor);r=0;var u=i.length;for(o=new(qf(o))(u);u>r;)o[r]=i[r++];return o},fy),Ra("some",function(i){return Bw(Ua(this),i,1<arguments.length?arguments[1]:void 0)});var gy=[].sort;Ra("sort",function(i){return gy.call(Ua(this),i)}),Ra("subarray",function(i,r){var o=Ua(this),u=o.length;return i=Vb(i,u),new(ee(o,o.constructor))(o.buffer,o.byteOffset+i*o.BYTES_PER_ELEMENT,Ma((r===void 0?u:Vb(r,u))-i))});var Xh=R.Int8Array,aq=[].toLocaleString,hy=[].slice,iy=!!Xh&&la(function(){aq.call(new Xh(1))}),jy=la(function(){return[1,2].toLocaleString()!=new Xh([1,2]).toLocaleString()})||!la(function(){Xh.prototype.toLocaleString.call([1,2])});Ra("toLocaleString",function(){return aq.apply(iy?hy.call(Ua(this)):Ua(this),arguments)},jy);var bq=R.Uint8Array,ky=bq&&bq.prototype||{},Yh=[].toString,ly=[].join;la(function(){Yh.call({})})&&(Yh=function(){return ly.call(this)}),Ra("toString",Yh,ky.toString!=Yh);var cq=ug.ArrayBuffer;ea({global:!0,forced:R.ArrayBuffer!==cq},{ArrayBuffer:cq}),og("ArrayBuffer");var my=qb.f,vk=Function.prototype,ny=vk.toString,oy=/^\s*function ([^ (]*)/;!wa||"name"in vk||my(vk,"name",{configurable:!0,get:function(){try{return ny.call(this).match(oy)[1]}catch{return""}}});var dq=RegExp.prototype,eq=dq.toString,py=la(function(){return eq.call({source:"a",flags:"b"})!="/a/b"}),qy=eq.name!="toString";(py||qy)&&Za(RegExp.prototype,"toString",function(){var i=Ia(this),r=String(i.source),o=i.flags;return"/"+r+"/"+(i=String(o===void 0&&i instanceof RegExp&&!("flags"in dq)?Gj.call(i):o))},{unsafe:!0});var ry=kg("splice"),sy=Math.max,ty=Math.min;ea({target:"Array",proto:!0,forced:!ry},{splice:function(i,r){var o,u,h=pb(this),E=Ma(h.length),v=Vb(i,E),O=arguments.length;if(O===0?O=o=0:O===1?(O=0,o=E-v):(O-=2,o=ty(sy(yc(r),0),E-v)),9007199254740991<E+O-o)throw TypeError("Maximum allowed length exceeded");var C=Dh(h,o);for(u=0;u<o;u++){var k=v+u;k in h&&hf(C,u,h[k])}if(C.length=o,O<o){for(u=v;u<E-o;u++){var j=u+O;(k=u+o)in h?h[j]=h[k]:delete h[j]}for(u=E;u>E-o+O;u--)delete h[u-1]}else if(O>o)for(u=E-o;u>v;u--)j=u+O-1,(k=u+o-1)in h?h[j]=h[k]:delete h[j];for(u=0;u<O;u++)h[u+v]=arguments[u+2];return h.length=E-o+O,C}});var wk={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xk=Fa("iterator"),fq=Fa("toStringTag"),yk=Gd.values,Zh;for(Zh in wk){var gq=R[Zh],id=gq&&gq.prototype;if(id){if(id[xk]!==yk)try{kb(id,xk,yk)}catch{id[xk]=yk}if(id[fq]||kb(id,fq,Zh),wk[Zh]){for(var rf in Gd)if(id[rf]!==Gd[rf])try{kb(id,rf,Gd[rf])}catch{id[rf]=Gd[rf]}}}}var hq=Object.is||function(i,r){return i===r?i!==0||1/i==1/r:i!=i&&r!=r};Bh("search",1,function(i,r,o){return[function(u){var h=Eb(this),E=u==null?void 0:u[i];return E!==void 0?E.call(u,h):new RegExp(u)[i](String(h))},function(u){var h=o(r,u,this);if(h.done)return h.value;u=Ia(u);var E=String(this);return h=u.lastIndex,hq(h,0)||(u.lastIndex=0),E=ef(u,E),hq(u.lastIndex,h)||(u.lastIndex=h),E===null?-1:E.index}]}),xb(function(i){(function(r,o){i.exports?i.exports=o(r):o(r)})(typeof self<"u"?self:Ya,function(r){function o(o_){return btoa(o_).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function u(o_){return o_=(o_+="===").slice(0,-o_.length%4),atob(o_.replace(/-/g,"+").replace(/_/g,"/"))}function h(o_){for(var b_=new Uint8Array(o_.length),h_=0;h_<o_.length;h_++)b_[h_]=o_.charCodeAt(h_);return b_}function E(o_){return o_ instanceof ArrayBuffer&&(o_=new Uint8Array(o_)),String.fromCharCode.apply(String,o_)}function v(o_){var b_={name:(o_.name||o_||"").toUpperCase().replace("V","v")};switch(b_.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":o_.length&&(b_.length=o_.length);break;case"HMAC":o_.hash&&(b_.hash=v(o_.hash)),o_.length&&(b_.length=o_.length);break;case"RSAES-PKCS1-v1_5":o_.publicExponent&&(b_.publicExponent=new Uint8Array(o_.publicExponent)),o_.modulusLength&&(b_.modulusLength=o_.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":o_.hash&&(b_.hash=v(o_.hash)),o_.publicExponent&&(b_.publicExponent=new Uint8Array(o_.publicExponent)),o_.modulusLength&&(b_.modulusLength=o_.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return b_}function O(o_){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[o_.name][(o_.hash||{}).name||o_.length||""]}function C(o_){(o_ instanceof ArrayBuffer||o_ instanceof Uint8Array)&&(o_=JSON.parse(decodeURIComponent(escape(E(o_)))));var b_={kty:o_.kty,alg:o_.alg,ext:o_.ext||o_.extractable};switch(b_.kty){case"oct":b_.k=o_.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(h_){h_ in o_&&(b_[h_]=o_[h_])});break;default:throw new TypeError("Unsupported key type")}return b_}function k(o_){return o_=C(o_),y_&&(o_.extractable=o_.ext,delete o_.ext),h(unescape(encodeURIComponent(JSON.stringify(o_)))).buffer}function j(o_){var b_=K(o_),h_=!1;switch(2<b_.length&&(h_=!0,b_.shift()),o_={ext:!0},b_[0][0]){case"1.2.840.113549.1.1.1":var B_="n e d p q dp dq qi".split(" ");for(b_=K(b_[1]),h_&&b_.shift(),h_=0;h_<b_.length;h_++)b_[h_][0]||(b_[h_]=b_[h_].subarray(1)),o_[B_[h_]]=o(E(b_[h_]));o_.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return o_}function K(o_,b_){if(o_ instanceof ArrayBuffer&&(o_=new Uint8Array(o_)),b_||(b_={pos:0,end:o_.length}),2>b_.end-b_.pos||b_.end>o_.length)throw new RangeError("Malformed DER");var h_=o_[b_.pos++],B_=o_[b_.pos++];if(128<=B_){if(B_&=127,b_.end-b_.pos<B_)throw new RangeError("Malformed DER");for(var e_=0;B_--;)e_<<=8,e_|=o_[b_.pos++];B_=e_}if(b_.end-b_.pos<B_)throw new RangeError("Malformed DER");switch(h_){case 2:h_=o_.subarray(b_.pos,b_.pos+=B_);break;case 3:if(o_[b_.pos++])throw Error("Unsupported bit string");B_--;case 4:h_=new Uint8Array(o_.subarray(b_.pos,b_.pos+=B_)).buffer;break;case 5:h_=null;break;case 6:if(!((o_=btoa(E(o_.subarray(b_.pos,b_.pos+=B_))))in w_))throw Error("Unsupported OBJECT ID "+o_);h_=w_[o_];break;case 48:for(h_=[],B_=b_.pos+B_;b_.pos<B_;)h_.push(K(o_,b_));break;default:throw Error("Unsupported DER tag 0x"+h_.toString(16))}return h_}function $(o_,b_){b_||(b_=[]);var h_=b_.length+2;if(b_.push(0,0),o_ instanceof Uint8Array)for(var B_=2,e_=o_.length,r_=0;r_<e_;r_++)b_.push(o_[r_]);else if(o_ instanceof ArrayBuffer)for(B_=4,e_=o_.byteLength,o_=new Uint8Array(o_),r_=0;r_<e_;r_++)b_.push(o_[r_]);else if(o_===null)B_=5,e_=0;else if(typeof o_=="string"&&o_ in W_)for(B_=6,e_=(o_=h(atob(W_[o_]))).length,r_=0;r_<e_;r_++)b_.push(o_[r_]);else if(o_ instanceof Array){for(r_=0;r_<o_.length;r_++)$(o_[r_],b_);B_=48,e_=b_.length-h_}else{if(!(qa(o_)==="object"&&o_.tag===3&&o_.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+o_);for(B_=3,e_=(o_=new Uint8Array(o_.value)).byteLength,b_.push(0),r_=0;r_<e_;r_++)b_.push(o_[r_]);e_++}if(128<=e_){for(r_=e_,e_=4,b_.splice(h_,0,r_>>24&255,r_>>16&255,r_>>8&255,255&r_);1<e_&&!(r_>>24);)r_<<=8,e_--;4>e_&&b_.splice(h_,4-e_),e_|=128}return b_.splice(h_-2,2,B_,e_),b_}function _e(o_,b_,h_,B_){Object.defineProperties(this,{_key:{value:o_},type:{value:o_.type,enumerable:!0},extractable:{value:h_===void 0?o_.extractable:h_,enumerable:!0},algorithm:{value:b_===void 0?o_.algorithm:b_,enumerable:!0},usages:{value:B_===void 0?o_.usages:B_,enumerable:!0}})}function na(o_){return o_==="verify"||o_==="encrypt"||o_==="wrapKey"}function _c(o_){return o_==="sign"||o_==="decrypt"||o_==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var _a=r.crypto||r.msCrypto;if(_a){var _s=_a.subtle||_a.webkitSubtle;if(_s){var _h=r.Crypto||_a.constructor||Object,_f=r.SubtleCrypto||_s.constructor||Object;r.CryptoKey||r.Key;var E_=-1<r.navigator.userAgent.indexOf("Edge/"),y_=!!r.msCrypto&&!E_,F_=!_a.subtle&&!!_a.webkitSubtle;if(y_||F_){var w_={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},W_={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(o_){var b_=_s[o_];_s[o_]=function(h_,B_,e_){var r_=[].slice.call(arguments);switch(o_){case"generateKey":var _p=v(h_),c_=B_,v_=e_;break;case"importKey":_p=v(e_),c_=r_[3],v_=r_[4],h_==="jwk"&&((B_=C(B_)).alg||(B_.alg=O(_p)),B_.key_ops||(B_.key_ops=B_.kty!=="oct"?"d"in B_?v_.filter(_c):v_.filter(na):v_.slice()),r_[1]=k(B_));break;case"unwrapKey":_p=r_[4],c_=r_[5],v_=r_[6],r_[2]=e_._key}if(o_==="generateKey"&&_p.name==="HMAC"&&_p.hash)return _p.length=_p.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[_p.hash.name],_s.importKey("raw",_a.getRandomValues(new Uint8Array(_p.length+7>>3)),_p,c_,v_);if(F_&&o_==="generateKey"&&_p.name==="RSASSA-PKCS1-v1_5"&&(!_p.modulusLength||2048<=_p.modulusLength))return(h_=v(h_)).name="RSAES-PKCS1-v1_5",delete h_.hash,_s.generateKey(h_,!0,["encrypt","decrypt"]).then(function(_u){return Promise.all([_s.exportKey("jwk",_u.publicKey),_s.exportKey("jwk",_u.privateKey)])}).then(function(_u){return _u[0].alg=_u[1].alg=O(_p),_u[0].key_ops=v_.filter(na),_u[1].key_ops=v_.filter(_c),Promise.all([_s.importKey("jwk",_u[0],_p,!0,_u[0].key_ops),_s.importKey("jwk",_u[1],_p,c_,_u[1].key_ops)])}).then(function(_u){return{publicKey:_u[0],privateKey:_u[1]}});if((F_||y_&&(_p.hash||{}).name==="SHA-1")&&o_==="importKey"&&h_==="jwk"&&_p.name==="HMAC"&&B_.kty==="oct")return _s.importKey("raw",h(u(B_.k)),e_,r_[3],r_[4]);if(F_&&o_==="importKey"&&(h_==="spki"||h_==="pkcs8"))return _s.importKey("jwk",j(B_),e_,r_[3],r_[4]);if(y_&&o_==="unwrapKey")return _s.decrypt(r_[3],e_,B_).then(function(_u){return _s.importKey(h_,_u,r_[4],r_[5],r_[6])});try{var q_=b_.apply(_s,r_)}catch(_u){return Promise.reject(_u)}return y_&&(q_=new Promise(function(_u,S_){q_.onabort=q_.onerror=function(P_){S_(P_)},q_.oncomplete=function(P_){_u(P_.target.result)}})),q_=q_.then(function(_u){return _p.name!=="HMAC"||_p.length||(_p.length=8*_u.algorithm.length),_p.name.search("RSA")==0&&(_p.modulusLength||(_p.modulusLength=(_u.publicKey||_u).algorithm.modulusLength),_p.publicExponent||(_p.publicExponent=(_u.publicKey||_u).algorithm.publicExponent)),_u.publicKey&&_u.privateKey?{publicKey:new _e(_u.publicKey,_p,c_,v_.filter(na)),privateKey:new _e(_u.privateKey,_p,c_,v_.filter(_c))}:new _e(_u,_p,c_,v_)})}}),["exportKey","wrapKey"].forEach(function(o_){var b_=_s[o_];_s[o_]=function(h_,B_,e_){var r_=[].slice.call(arguments);switch(o_){case"exportKey":r_[1]=B_._key;break;case"wrapKey":r_[1]=B_._key,r_[2]=e_._key}if((F_||y_&&(B_.algorithm.hash||{}).name==="SHA-1")&&o_==="exportKey"&&h_==="jwk"&&B_.algorithm.name==="HMAC"&&(r_[0]="raw"),!F_||o_!=="exportKey"||h_!=="spki"&&h_!=="pkcs8"||(r_[0]="jwk"),y_&&o_==="wrapKey")return _s.exportKey(h_,B_).then(function(c_){return h_==="jwk"&&(c_=h(unescape(encodeURIComponent(JSON.stringify(C(c_)))))),_s.encrypt(r_[3],e_,c_)});try{var _p=b_.apply(_s,r_)}catch(c_){return Promise.reject(c_)}return y_&&(_p=new Promise(function(c_,v_){_p.onabort=_p.onerror=function(q_){v_(q_)},_p.oncomplete=function(q_){c_(q_.target.result)}})),o_==="exportKey"&&h_==="jwk"&&(_p=_p.then(function(c_){return(F_||y_&&(B_.algorithm.hash||{}).name==="SHA-1")&&B_.algorithm.name==="HMAC"?{kty:"oct",alg:O(B_.algorithm),key_ops:B_.usages.slice(),ext:!0,k:o(E(c_))}:((c_=C(c_)).alg||(c_.alg=O(B_.algorithm)),c_.key_ops||(c_.key_ops=B_.type==="public"?B_.usages.filter(na):B_.type==="private"?B_.usages.filter(_c):B_.usages.slice()),c_)})),!F_||o_!=="exportKey"||h_!=="spki"&&h_!=="pkcs8"||(_p=_p.then(function(c_){var v_=[["",null]],q_=!1;switch((c_=C(c_)).kty){case"RSA":for(var _u="n e d p q dp dq qi".split(" "),S_=[],P_=0;P_<_u.length&&_u[P_]in c_;P_++){var G_=S_[P_]=h(u(c_[_u[P_]]));128&G_[0]&&(S_[P_]=new Uint8Array(G_.length+1),S_[P_].set(G_,1))}2<S_.length&&(q_=!0,S_.unshift(new Uint8Array([0]))),v_[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return v_.push(new Uint8Array($(S_)).buffer),q_?v_.unshift(new Uint8Array([0])):v_[1]={tag:3,value:v_[1]},new Uint8Array($(v_)).buffer})),_p}}),["encrypt","decrypt","sign","verify"].forEach(function(o_){var b_=_s[o_];_s[o_]=function(h_,B_,e_,r_){if(y_&&(!e_.byteLength||r_&&!r_.byteLength))throw Error("Empty input is not allowed");var _p=[].slice.call(arguments),c_=v(h_);if(!y_||o_!=="sign"&&o_!=="verify"||h_!=="RSASSA-PKCS1-v1_5"&&h_!=="HMAC"||(_p[0]={name:h_}),y_&&B_.algorithm.hash&&(_p[0].hash=_p[0].hash||B_.algorithm.hash),y_&&o_==="decrypt"&&c_.name==="AES-GCM"){var v_=h_.tagLength>>3;_p[2]=(e_.buffer||e_).slice(0,e_.byteLength-v_),h_.tag=(e_.buffer||e_).slice(e_.byteLength-v_)}y_&&c_.name==="AES-GCM"&&_p[0].tagLength===void 0&&(_p[0].tagLength=128),_p[1]=B_._key;try{var q_=b_.apply(_s,_p)}catch(_u){return Promise.reject(_u)}return y_&&(q_=new Promise(function(_u,S_){q_.onabort=q_.onerror=function(P_){S_(P_)},q_.oncomplete=function(P_){if(P_=P_.target.result,o_==="encrypt"&&P_ instanceof AesGcmEncryptResult){var G_=P_.ciphertext,lb=P_.tag;(P_=new Uint8Array(G_.byteLength+lb.byteLength)).set(new Uint8Array(G_),0),P_.set(new Uint8Array(lb),G_.byteLength),P_=P_.buffer}_u(P_)}})),q_}}),y_){var _S=_s.digest;_s.digest=function(o_,b_){if(!b_.byteLength)throw Error("Empty input is not allowed");try{var h_=_S.call(_s,o_,b_)}catch(B_){return Promise.reject(B_)}return h_=new Promise(function(B_,e_){h_.onabort=h_.onerror=function(r_){e_(r_)},h_.oncomplete=function(r_){B_(r_.target.result)}})},r.crypto=Object.create(_a,{getRandomValues:{value:function(o_){return _a.getRandomValues(o_)}},subtle:{value:_s}}),r.CryptoKey=_e}F_&&(_a.subtle=_s,r.Crypto=_h,r.SubtleCrypto=_f,r.CryptoKey=_e)}}}})}),function(i){i.console||(i.console={}),i=i.console;for(var r,o=function(){},u=["memory"],h="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");r=u.pop();)i[r]||(i[r]={});for(;r=h.pop();)i[r]||(i[r]=o)}(typeof window>"u"?Ya:window),ea({target:"Object",stat:!0},{setPrototypeOf:tb});var uy=la(function(){uc(1)});ea({target:"Object",stat:!0,forced:uy,sham:!Oo},{getPrototypeOf:function(i){return uc(pb(i))}});var iq=[].slice,zk={},vy=Function.bind||function(i){var r=Wb(this),o=iq.call(arguments,1),u=function(){var h=o.concat(iq.call(arguments));if(this instanceof u){var E=h.length;if(!(E in zk)){for(var v=[],O=0;O<E;O++)v[O]="a["+O+"]";zk[E]=Function("C,a","return new C("+v.join(",")+")")}h=zk[E](r,h)}else h=r.apply(i,h);return h};return xa(r.prototype)&&(u.prototype=r.prototype),u},Ak=Pc("Reflect","construct"),jq=la(function(){function i(){}return!(Ak(function(){},[],i)instanceof i)}),kq=!la(function(){Ak(function(){})}),lq=jq||kq;ea({target:"Reflect",stat:!0,forced:lq,sham:lq},{construct:function(i,r){Wb(i),Ia(r);var o=3>arguments.length?i:Wb(arguments[2]);if(kq&&!jq)return Ak(i,r,o);if(i==o){switch(r.length){case 0:return new i;case 1:return new i(r[0]);case 2:return new i(r[0],r[1]);case 3:return new i(r[0],r[1],r[2]);case 4:return new i(r[0],r[1],r[2],r[3])}return(o=[null]).push.apply(o,r),new(vy.apply(i,o))}o=o.prototype,o=jc(xa(o)?o:Object.prototype);var u=Function.apply.call(i,o,r);return xa(u)?u:o}}),ea({target:"Reflect",stat:!0},{get:Am});var mq=dc.f,wy=la(function(){mq(1)});ea({target:"Object",stat:!0,forced:!wa||wy,sham:!wa},{getOwnPropertyDescriptor:function(i,r){return mq(Mb(i),r)}});var nq=de.f,xy={}.toString,oq=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Bk=function(i){if(oq&&xy.call(i)=="[object Window]")try{var r=nq(i)}catch{r=oq.slice()}else r=nq(Mb(i));return r},pq={f:Fa},yy=qb.f,$h=function(i){var r=R.Symbol||(R.Symbol={});ka(r,i)||yy(r,i,{value:pq.f(i)})},Nb=xh("hidden"),qq=Fa("toPrimitive"),zy=cb.set,rq=cb.getterFor("Symbol"),kc=Object.prototype,Ob=R.Symbol,yg=Pc("JSON","stringify"),sq=dc.f,Jd=qb.f,tq=Bk,Ay=eg,jd=Ad("symbols"),zg=Ad("op-symbols"),Ck=Ad("string-to-symbol-registry"),Dk=Ad("symbol-to-string-registry"),By=Ad("wks"),Ek=R.QObject,Fk=!Ek||!Ek.prototype||!Ek.prototype.findChild,Gk=wa&&la(function(){return jc(Jd({},"a",{get:function(){return Jd(this,"a",{value:7}).a}})).a!=7})?function(i,r,o){var u=sq(kc,r);u&&delete kc[r],Jd(i,r,o),u&&i!==kc&&Jd(kc,r,u)}:Jd,Hk=function(i,r){var o=jd[i]=jc(Ob.prototype);return zy(o,{type:"Symbol",tag:i,description:r}),wa||(o.description=r),o},Ik=zo?function(i){return typeof i=="symbol"}:function(i){return Object(i)instanceof Ob},ai=function(i,r,o){return i===kc&&ai(zg,r,o),Ia(i),r=Oc(r,!0),Ia(o),ka(jd,r)?(o.enumerable?(ka(i,Nb)&&i[Nb][r]&&(i[Nb][r]=!1),o=jc(o,{enumerable:Nc(0,!1)})):(ka(i,Nb)||Jd(i,Nb,Nc(1,{})),i[Nb][r]=!0),Gk(i,r,o)):Jd(i,r,o)},uq=function(i,r){Ia(i);var o=Mb(r);return r=ed(o).concat(Jk(o)),fe(r,function(u){wa&&!Kk.call(o,u)||ai(i,u,o[u])}),i},Kk=function(i){i=Oc(i,!0);var r=Ay.call(this,i);return!(this===kc&&ka(jd,i)&&!ka(zg,i))&&(!(r||!ka(this,i)||!ka(jd,i)||ka(this,Nb)&&this[Nb][i])||r)},vq=function(i,r){if(i=Mb(i),r=Oc(r,!0),i!==kc||!ka(jd,r)||ka(zg,r)){var o=sq(i,r);return!o||!ka(jd,r)||ka(i,Nb)&&i[Nb][r]||(o.enumerable=!0),o}},wq=function(i){i=tq(Mb(i));var r=[];return fe(i,function(o){ka(jd,o)||ka(bf,o)||r.push(o)}),r},Jk=function(i){var r=i===kc;i=tq(r?zg:Mb(i));var o=[];return fe(i,function(u){!ka(jd,u)||r&&!ka(kc,u)||o.push(jd[u])}),o};if(Sc||(Ob=function(){if(this instanceof Ob)throw TypeError("Symbol is not a constructor");var i=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,r=af(i),o=function(u){this===kc&&o.call(zg,u),ka(this,Nb)&&ka(this[Nb],r)&&(this[Nb][r]=!1),Gk(this,r,Nc(1,u))};return wa&&Fk&&Gk(kc,r,{configurable:!0,set:o}),Hk(r,i)},Za(Ob.prototype,"toString",function(){return rq(this).tag}),Za(Ob,"withoutSetter",function(i){return Hk(af(i),i)}),eg=Kk,qb.f=ai,dc.f=vq,de.f=Bk=wq,gg.f=Jk,pq.f=function(i){return Hk(Fa(i),i)},wa&&(Jd(Ob.prototype,"description",{configurable:!0,get:function(){return rq(this).description}}),Za(kc,"propertyIsEnumerable",Kk,{unsafe:!0}))),ea({global:!0,wrap:!0,forced:!Sc,sham:!Sc},{Symbol:Ob}),fe(ed(By),function(i){$h(i)}),ea({target:"Symbol",stat:!0,forced:!Sc},{for:function(i){if(i=String(i),ka(Ck,i))return Ck[i];var r=Ob(i);return Ck[i]=r,Dk[r]=i,r},keyFor:function(i){if(!Ik(i))throw TypeError(i+" is not a symbol");if(ka(Dk,i))return Dk[i]},useSetter:function(){Fk=!0},useSimple:function(){Fk=!1}}),ea({target:"Object",stat:!0,forced:!Sc,sham:!wa},{create:function(i,r){return r===void 0?jc(i):uq(jc(i),r)},defineProperty:ai,defineProperties:uq,getOwnPropertyDescriptor:vq}),ea({target:"Object",stat:!0,forced:!Sc},{getOwnPropertyNames:wq,getOwnPropertySymbols:Jk}),ea({target:"Object",stat:!0,forced:la(function(){gg.f(1)})},{getOwnPropertySymbols:function(i){return gg.f(pb(i))}}),yg){var Cy=!Sc||la(function(){var i=Ob();return yg([i])!="[null]"||yg({a:i})!="{}"||yg(Object(i))!="{}"});ea({target:"JSON",stat:!0,forced:Cy},{stringify:function(i,r,o){for(var u,h=[i],E=1;arguments.length>E;)h.push(arguments[E++]);if(u=r,(xa(r)||i!==void 0)&&!Ik(i))return Ed(r)||(r=function(v,O){if(typeof u=="function"&&(O=u.call(this,v,O)),!Ik(O))return O}),h[1]=r,yg.apply(null,h)}})}Ob.prototype[qq]||kb(Ob.prototype,qq,Ob.prototype.valueOf),zc(Ob,"Symbol"),bf[Nb]=!0;var Dy=qb.f,kd=R.Symbol;if(wa&&typeof kd=="function"&&(!("description"in kd.prototype)||kd().description!==void 0)){var xq={},Ag=function(){var i=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),r=this instanceof Ag?new kd(i):i===void 0?kd():kd(i);return i===""&&(xq[r]=!0),r};to(Ag,kd);var Lk=Ag.prototype=kd.prototype;Lk.constructor=Ag;var Ey=Lk.toString,Fy=String(kd("test"))=="Symbol(test)",Gy=/^Symbol\((.*)\)[^)]+$/;Dy(Lk,"description",{configurable:!0,get:function(){var i=xa(this)?this.valueOf():this,r=Ey.call(i);return ka(xq,i)?"":(i=Fy?r.slice(7,-1):r.replace(Gy,"$1"))===""?void 0:i}}),ea({global:!0,forced:!0},{Symbol:Ag})}$h("toStringTag"),zc(R.JSON,"JSON",!0),zc(Math,"Math",!0),function(){function i(K,$){if(!(K instanceof $))throw new TypeError("Cannot call a class as a function")}function r(K,$){for(var _e=0;_e<$.length;_e++){var na=$[_e];na.enumerable=na.enumerable||!1,na.configurable=!0,"value"in na&&(na.writable=!0),Object.defineProperty(K,na.key,na)}}function o(K,$,_e){return $&&r(K.prototype,$),K}function u(K){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function($){return $.__proto__||Object.getPrototypeOf($)})(K)}function h(K,$){return(h=Object.setPrototypeOf||function(_e,na){return _e.__proto__=na,_e})(K,$)}function E(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}function v(K){var $=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _e=u(K);if($){var na=u(this).constructor;_e=Reflect.construct(_e,arguments,na)}else _e=_e.apply(this,arguments);return _e=!_e||qa(_e)!=="object"&&typeof _e!="function"?E(this):_e}}function O(K,$,_e){return(O=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(na,_c,_a){for(;!Object.prototype.hasOwnProperty.call(na,_c)&&(na=u(na))!==null;);if(na)return(_c=Object.getOwnPropertyDescriptor(na,_c)).get?_c.get.call(_a):_c.value})(K,$,_e||K)}var C=function(){function K(){i(this,K),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return o(K,[{key:"addEventListener",value:function($,_e,na){$ in this.listeners||(this.listeners[$]=[]),this.listeners[$].push({callback:_e,options:na})}},{key:"removeEventListener",value:function($,_e){if($ in this.listeners){for(var na=0,_c=($=this.listeners[$]).length;na<_c;na++)if($[na].callback===_e){$.splice(na,1);break}}}},{key:"dispatchEvent",value:function($){if($.type in this.listeners){for(var _e=this.listeners[$.type].slice(),na=0,_c=_e.length;na<_c;na++){var _a=_e[na];try{_a.callback.call(this,$)}catch(_s){Promise.resolve().then(function(){throw _s})}_a.options&&_a.options.once&&this.removeEventListener($.type,_a.callback)}return!$.defaultPrevented}}}]),K}(),k=function(K){function $(){i(this,$);var na=_e.call(this);return na.listeners||C.call(E(na)),Object.defineProperty(E(na),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(E(na),"onabort",{value:null,writable:!0,configurable:!0}),na}(function(na,_c){if(typeof _c!="function"&&_c!==null)throw new TypeError("Super expression must either be null or a function");na.prototype=Object.create(_c&&_c.prototype,{constructor:{value:na,writable:!0,configurable:!0}}),_c&&h(na,_c)})($,K);var _e=v($);return o($,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(na){na.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,na)),O(u($.prototype),"dispatchEvent",this).call(this,na)}}]),$}(C),j=function(){function K(){i(this,K),Object.defineProperty(this,"signal",{value:new k,writable:!0,configurable:!0})}return o(K,[{key:"abort",value:function(){try{var $=new Event("abort")}catch{typeof document<"u"?document.createEvent?($=document.createEvent("Event")).initEvent("abort",!1,!1):($=document.createEventObject()).type="abort":$={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent($)}},{key:"toString",value:function(){return"[object AbortController]"}}]),K}();typeof Symbol<"u"&&Symbol.toStringTag&&(j.prototype[Symbol.toStringTag]="AbortController",k.prototype[Symbol.toStringTag]="AbortSignal"),function(K){if(K.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var $=!0}else $=typeof K.Request=="function"&&!K.Request.prototype.hasOwnProperty("signal")||!K.AbortController;$&&(K.AbortController=j,K.AbortSignal=k)}(typeof self<"u"?self:Ya)}();var Hy=Math.floor,Iy=Math.log,Jy=Math.LOG2E;ea({target:"Math",stat:!0},{clz32:function(i){return(i>>>=0)?31-Hy(Iy(i+.5)*Jy):32}});var Ky=Math.log,Ly=Math.LN2,cu=Math.clz32||function(i){return 31-Ky(i>>>0)/Ly|0},Ud=String.fromCharCode,yq={}.toString,Mk=window.Uint8Array,Nk=Mk||Array,My=yq.call((window.ArrayBuffer||Nk).prototype),Ok;Bm.prototype.decode=function(i){if(i=i&&i.buffer||i,yq.call(i)!==My)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var r="",o=0,u=0|(i=Mk?new Nk(i):i).length;o<u;o=o+32768|0)r+=Ud.apply(0,i[Mk?"slice":"subarray"](o,o+32768|0));return r.replace(/[\xc0-\xff][\x80-\xbf]*/g,bu)},window.TextDecoder||(window.TextDecoder=Bm),Cm.prototype.encode=function(i){for(var r=0|(i=i===void 0?"":(""+i).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,du)).length,o=new Nk(r),u=0;u<r;u=u+1|0)o[u]=i.charCodeAt(u);return o},window.TextEncoder||(window.TextEncoder=Cm),function(i){var r,o,u,h,E,v,O,C,k,j,K,$;(o=r||(r={})).LOGIN="LOGIN",o.LOGIN_SUCCESS="LOGIN_SUCCESS",o.LOGIN_FAILURE="LOGIN_FAILURE",o.LOGIN_TIMEOUT="LOGIN_TIMEOUT",o.INTERRUPTED="INTERRUPTED",o.LOGOUT="LOGOUT",o.BANNED_BY_SERVER="BANNED_BY_SERVER",o.REMOTE_LOGIN="REMOTE_LOGIN",o.TOKEN_EXPIRED="TOKEN_EXPIRED",i.ConnectionChangeReason=r,function(_e){_e.DISCONNECTED="DISCONNECTED",_e.CONNECTING="CONNECTING",_e.CONNECTED="CONNECTED",_e.RECONNECTING="RECONNECTING",_e.ABORTED="ABORTED"}(u||(u={})),i.ConnectionState=u,function(_e){_e.IDLE="IDLE",_e.SENT_TO_REMOTE="SENT_TO_REMOTE",_e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",_e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",_e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",_e.CANCELED="CANCELED",_e.FAILURE="FAILURE"}(h||(h={})),i.LocalInvitationState=h,function(_e){_e.INVITATION_RECEIVED="INVITATION_RECEIVED",_e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",_e.REFUSED="REFUSED",_e.ACCEPTED="ACCEPTED",_e.CANCELED="CANCELED",_e.FAILURE="FAILURE"}(E||(E={})),i.RemoteInvitationState=E,function(_e){_e.UNKNOWN="UNKNOWN",_e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",_e.INVITATION_EXPIRE="INVITATION_EXPIRE",_e.PEER_OFFLINE="PEER_OFFLINE",_e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(v||(v={})),i.LocalInvitationFailureReason=v,function(_e){_e.UNKNOWN="UNKNOWN",_e.PEER_OFFLINE="PEER_OFFLINE",_e.ACCEPT_FAILURE="ACCEPT_FAILURE",_e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(O||(O={})),i.RemoteInvitationFailureReason=O,function(_e){_e.ONLINE="ONLINE",_e.UNREACHABLE="UNREACHABLE",_e.OFFLINE="OFFLINE"}(C||(C={})),i.PeerOnlineState=C,(k||(k={})).ONLINE_STATUS="ONLINE_STATUS",i.PeerSubscriptionOption=k,function(_e){_e.TEXT="TEXT",_e.RAW="RAW"}(j||(j={})),i.MessageType=j,function(_e){_e.CN="CN",_e.NA="NA",_e.EU="EU",_e.AS="AS",_e.JP="JP",_e.IN="IN",_e.GLOB="GLOB",_e.OC="OC",_e.SA="SA",_e.AF="AF",_e.OVS="OVS"}(K||(K={})),i.LegacyAreaCode=K,function(_e){_e.GLOBAL="GLOBAL",_e.INDIA="INDIA",_e.JAPAN="JAPAN",_e.ASIA="ASIA",_e.EUROPE="EUROPE",_e.CHINA="CHINA",_e.NORTH_AMERICA="NORTH_AMERICA"}($||($={})),i.AreaCode=$}(Ok||(Ok={}));var ta=Ok;ea({target:"Array",proto:!0},{includes:function(i){return qo(this,i,1<arguments.length?arguments[1]:void 0)}}),ng("includes");var Pk=function(i){if(Lj(i))throw TypeError("The method doesn't accept regular expressions");return i},Ny=Fa("match"),Qk=function(i){var r=/./;try{"/./"[i](r)}catch{try{return r[Ny]=!1,"/./"[i](r)}catch{}}return!1};ea({target:"String",proto:!0,forced:!Qk("includes")},{includes:function(i){return!!~String(Eb(this)).indexOf(Pk(i),1<arguments.length?arguments[1]:void 0)}});var Ec={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0,ENABLE_EDGE_AUTO_FALLBACK:!0};$h("iterator"),$h("asyncIterator");var Rk=ff("forEach")?[].forEach:function(i){return fe(this,i,1<arguments.length?arguments[1]:void 0)},zq;for(zq in wk){var Aq=R[zq],bi=Aq&&Aq.prototype;if(bi&&bi.forEach!==Rk)try{kb(bi,"forEach",Rk)}catch{bi.forEach=Rk}}var Oy=[].reverse,Bq=[1,2];ea({target:"Array",proto:!0,forced:String(Bq)===String(Bq.reverse())},{reverse:function(){return Ed(this)&&(this.length=this.length),Oy.call(this)}});var N=xb(function(i){i=function(r){function o(e_,r_,_p){return Object.defineProperty(e_,r_,{value:_p,enumerable:!0,configurable:!0,writable:!0}),e_[r_]}function u(e_,r_,_p,c_){return r_=Object.create((r_&&r_.prototype instanceof E?r_:E).prototype),c_=new _e(c_||[]),r_._invoke=function(v_,q_,_u){var S_=w_;return function(P_,G_){if(S_===_S)throw Error("Generator is already running");if(S_===o_){if(P_==="throw")throw G_;return _c()}for(_u.method=P_,_u.arg=G_;;){if((P_=_u.delegate)&&(P_=j(P_,_u))){if(P_===b_)continue;return P_}if(_u.method==="next")_u.sent=_u._sent=_u.arg;else if(_u.method==="throw"){if(S_===w_)throw S_=o_,_u.arg;_u.dispatchException(_u.arg)}else _u.method==="return"&&_u.abrupt("return",_u.arg);if(S_=_S,(P_=h(v_,q_,_u)).type==="normal"){if(S_=_u.done?o_:W_,P_.arg===b_)continue;return{value:P_.arg,done:_u.done}}P_.type==="throw"&&(S_=o_,_u.method="throw",_u.arg=P_.arg)}}}(e_,_p,c_),r_}function h(e_,r_,_p){try{return{type:"normal",arg:e_.call(r_,_p)}}catch(c_){return{type:"throw",arg:c_}}}function E(){}function v(){}function O(){}function C(e_){["next","throw","return"].forEach(function(r_){o(e_,r_,function(_p){return this._invoke(r_,_p)})})}function k(e_,r_){function _p(v_,q_,_u,S_){if((v_=h(e_[v_],e_,q_)).type!=="throw"){var P_=v_.arg;return(v_=P_.value)&&qa(v_)==="object"&&_h.call(v_,"__await")?r_.resolve(v_.__await).then(function(G_){_p("next",G_,_u,S_)},function(G_){_p("throw",G_,_u,S_)}):r_.resolve(v_).then(function(G_){P_.value=G_,_u(P_)},function(G_){return _p("throw",G_,_u,S_)})}S_(v_.arg)}var c_;this._invoke=function(v_,q_){function _u(){return new r_(function(S_,P_){_p(v_,q_,S_,P_)})}return c_=c_?c_.then(_u,_u):_u()}}function j(e_,r_){var _p=e_.iterator[r_.method];if(_p===_a){if(r_.delegate=null,r_.method==="throw"){if(e_.iterator.return&&(r_.method="return",r_.arg=_a,j(e_,r_),r_.method==="throw"))return b_;r_.method="throw",r_.arg=new TypeError("The iterator does not provide a 'throw' method")}return b_}return(_p=h(_p,e_.iterator,r_.arg)).type==="throw"?(r_.method="throw",r_.arg=_p.arg,r_.delegate=null,b_):(_p=_p.arg)?_p.done?(r_[e_.resultName]=_p.value,r_.next=e_.nextLoc,r_.method!=="return"&&(r_.method="next",r_.arg=_a),r_.delegate=null,b_):_p:(r_.method="throw",r_.arg=new TypeError("iterator result is not an object"),r_.delegate=null,b_)}function K(e_){var r_={tryLoc:e_[0]};1 in e_&&(r_.catchLoc=e_[1]),2 in e_&&(r_.finallyLoc=e_[2],r_.afterLoc=e_[3]),this.tryEntries.push(r_)}function $(e_){var r_=e_.completion||{};r_.type="normal",delete r_.arg,e_.completion=r_}function _e(e_){this.tryEntries=[{tryLoc:"root"}],e_.forEach(K,this),this.reset(!0)}function na(e_){if(e_){var r_=e_[E_];if(r_)return r_.call(e_);if(typeof e_.next=="function")return e_;if(!isNaN(e_.length)){var _p=-1;return(r_=function c_(){for(;++_p<e_.length;)if(_h.call(e_,_p))return c_.value=e_[_p],c_.done=!1,c_;return c_.value=_a,c_.done=!0,c_}).next=r_}}return{next:_c}}function _c(){return{value:_a,done:!0}}var _a,_s=Object.prototype,_h=_s.hasOwnProperty,_f=typeof Symbol=="function"?Symbol:{},E_=_f.iterator||"@@iterator",y_=_f.asyncIterator||"@@asyncIterator",F_=_f.toStringTag||"@@toStringTag";try{o({},"")}catch{o=function(r_,_p,c_){return r_[_p]=c_}}r.wrap=u;var w_="suspendedStart",W_="suspendedYield",_S="executing",o_="completed",b_={};o(_f={},E_,function(){return this});var h_=Object.getPrototypeOf;(h_=h_&&h_(h_(na([]))))&&h_!==_s&&_h.call(h_,E_)&&(_f=h_);var B_=O.prototype=E.prototype=Object.create(_f);return v.prototype=O,o(B_,"constructor",O),o(O,"constructor",v),v.displayName=o(O,F_,"GeneratorFunction"),r.isGeneratorFunction=function(e_){return!!(e_=typeof e_=="function"&&e_.constructor)&&(e_===v||(e_.displayName||e_.name)==="GeneratorFunction")},r.mark=function(e_){return Object.setPrototypeOf?Object.setPrototypeOf(e_,O):(e_.__proto__=O,o(e_,F_,"GeneratorFunction")),e_.prototype=Object.create(B_),e_},r.awrap=function(e_){return{__await:e_}},C(k.prototype),o(k.prototype,y_,function(){return this}),r.AsyncIterator=k,r.async=function(e_,r_,_p,c_,v_){v_===void 0&&(v_=Promise);var q_=new k(u(e_,r_,_p,c_),v_);return r.isGeneratorFunction(r_)?q_:q_.next().then(function(_u){return _u.done?_u.value:q_.next()})},C(B_),o(B_,F_,"Generator"),o(B_,E_,function(){return this}),o(B_,"toString",function(){return"[object Generator]"}),r.keys=function(e_){var r_,_p=[];for(r_ in e_)_p.push(r_);return _p.reverse(),function c_(){for(;_p.length;){var v_=_p.pop();if(v_ in e_)return c_.value=v_,c_.done=!1,c_}return c_.done=!0,c_}},r.values=na,_e.prototype={constructor:_e,reset:function(e_){if(this.next=this.prev=0,this.sent=this._sent=_a,this.done=!1,this.delegate=null,this.method="next",this.arg=_a,this.tryEntries.forEach($),!e_)for(var r_ in this)r_.charAt(0)==="t"&&_h.call(this,r_)&&!isNaN(+r_.slice(1))&&(this[r_]=_a)},stop:function(){this.done=!0;var e_=this.tryEntries[0].completion;if(e_.type==="throw")throw e_.arg;return this.rval},dispatchException:function(e_){function r_(P_,G_){return q_.type="throw",q_.arg=e_,_p.next=P_,G_&&(_p.method="next",_p.arg=_a),!!G_}if(this.done)throw e_;for(var _p=this,c_=this.tryEntries.length-1;0<=c_;--c_){var v_=this.tryEntries[c_],q_=v_.completion;if(v_.tryLoc==="root")return r_("end");if(v_.tryLoc<=this.prev){var _u=_h.call(v_,"catchLoc"),S_=_h.call(v_,"finallyLoc");if(_u&&S_){if(this.prev<v_.catchLoc)return r_(v_.catchLoc,!0);if(this.prev<v_.finallyLoc)return r_(v_.finallyLoc)}else if(_u){if(this.prev<v_.catchLoc)return r_(v_.catchLoc,!0)}else{if(!S_)throw Error("try statement without catch or finally");if(this.prev<v_.finallyLoc)return r_(v_.finallyLoc)}}}},abrupt:function(e_,r_){for(var _p=this.tryEntries.length-1;0<=_p;--_p){var c_=this.tryEntries[_p];if(c_.tryLoc<=this.prev&&_h.call(c_,"finallyLoc")&&this.prev<c_.finallyLoc){var v_=c_;break}}return v_&&(e_==="break"||e_==="continue")&&v_.tryLoc<=r_&&r_<=v_.finallyLoc&&(v_=null),(_p=v_?v_.completion:{}).type=e_,_p.arg=r_,v_?(this.method="next",this.next=v_.finallyLoc,b_):this.complete(_p)},complete:function(e_,r_){if(e_.type==="throw")throw e_.arg;return e_.type==="break"||e_.type==="continue"?this.next=e_.arg:e_.type==="return"?(this.rval=this.arg=e_.arg,this.method="return",this.next="end"):e_.type==="normal"&&r_&&(this.next=r_),b_},finish:function(e_){for(var r_=this.tryEntries.length-1;0<=r_;--r_){var _p=this.tryEntries[r_];if(_p.finallyLoc===e_)return this.complete(_p.completion,_p.afterLoc),$(_p),b_}},catch:function(e_){for(var r_=this.tryEntries.length-1;0<=r_;--r_){var _p=this.tryEntries[r_];if(_p.tryLoc===e_){if((e_=_p.completion).type==="throw"){var c_=e_.arg;$(_p)}return c_}}throw Error("illegal catch attempt")},delegateYield:function(e_,r_,_p){return this.delegate={iterator:na(e_),resultName:r_,nextLoc:_p},this.method==="next"&&(this.arg=_a),b_}},r}(i.exports);try{regeneratorRuntime=i}catch{(typeof globalThis>"u"?"undefined":qa(globalThis))==="object"?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}}),Cq=!la(function(){return Object.isExtensible(Object.preventExtensions({}))}),Sk=xb(function(i){var r=qb.f,o=af("meta"),u=0,h=Object.isExtensible||function(){return!0},E=function(O){r(O,o,{value:{objectID:"O"+ ++u,weakData:{}}})},v=i.exports={REQUIRED:!1,fastKey:function(O,C){if(!xa(O))return typeof O=="symbol"?O:(typeof O=="string"?"S":"P")+O;if(!ka(O,o)){if(!h(O))return"F";if(!C)return"E";E(O)}return O[o].objectID},getWeakData:function(O,C){if(!ka(O,o)){if(!h(O))return!0;if(!C)return!1;E(O)}return O[o].weakData},onFreeze:function(O){return Cq&&v.REQUIRED&&h(O)&&!ka(O,o)&&E(O),O}};bf[o]=!0}),Dq=function(i,r,o){var u=i.indexOf("Map")!==-1,h=i.indexOf("Weak")!==-1,E=u?"set":"add",v=R[i],O=v&&v.prototype,C=v,k={},j=function(_a){var _s=O[_a];Za(O,_a,_a=="add"?function(_h){return _s.call(this,_h===0?0:_h),this}:_a=="delete"?function(_h){return!(h&&!xa(_h))&&_s.call(this,_h===0?0:_h)}:_a=="get"?function(_h){return h&&!xa(_h)?void 0:_s.call(this,_h===0?0:_h)}:_a=="has"?function(_h){return!(h&&!xa(_h))&&_s.call(this,_h===0?0:_h)}:function(_h,_f){return _s.call(this,_h===0?0:_h,_f),this})};if(Qc(i,typeof v!="function"||!(h||O.forEach&&!la(function(){new v().entries().next()}))))C=o.getConstructor(r,i,u,E),Sk.REQUIRED=!0;else if(Qc(i,!0)){var K=new C,$=K[E](h?{}:-0,1)!=K,_e=la(function(){K.has(1)}),na=Eh(function(_a){new v(_a)}),_c=!h&&la(function(){for(var _a=new v,_s=5;_s--;)_a[E](_s,_s);return!_a.has(-0)});na||((C=r(function(_a,_s){return Ac(_a,C,i),_a=Wh(new v,_a,C),_s!=null&&Jh(_s,_a[E],{that:_a,AS_ENTRIES:u}),_a})).prototype=O,O.constructor=C),(_e||_c)&&(j("delete"),j("has"),u&&j("get")),(_c||$)&&j(E),h&&O.clear&&delete O.clear}return k[i]=C,ea({global:!0,forced:C!=v},k),zc(C,i),h||o.setStrong(C,i,u),C},Py=qb.f,Eq=Sk.fastKey,Fq=cb.set,Tk=cb.getterFor,Gq={getConstructor:function(i,r,o,u){var h=i(function(C,k){Ac(C,h,r),Fq(C,{type:r,index:jc(null),first:void 0,last:void 0,size:0}),wa||(C.size=0),k!=null&&Jh(k,C[u],{that:C,AS_ENTRIES:o})}),E=Tk(r),v=function(C,k,j){var K,$=E(C),_e=O(C,k);return _e?_e.value=j:($.last=_e={index:K=Eq(k,!0),key:k,value:j,previous:k=$.last,next:void 0,removed:!1},$.first||($.first=_e),k&&(k.next=_e),wa?$.size++:C.size++,K!=="F"&&($.index[K]=_e)),C},O=function(C,k){C=E(C);var j=Eq(k);if(j!=="F")return C.index[j];for(C=C.first;C;C=C.next)if(C.key==k)return C};return kf(h.prototype,{clear:function(){for(var C=E(this),k=C.index,j=C.first;j;)j.removed=!0,j.previous&&(j.previous=j.previous.next=void 0),delete k[j.index],j=j.next;C.first=C.last=void 0,wa?C.size=0:this.size=0},delete:function(C){var k=E(this);if(C=O(this,C)){var j=C.next,K=C.previous;delete k.index[C.index],C.removed=!0,K&&(K.next=j),j&&(j.previous=K),k.first==C&&(k.first=j),k.last==C&&(k.last=K),wa?k.size--:this.size--}return!!C},forEach:function(C){for(var k,j=E(this),K=Dd(C,1<arguments.length?arguments[1]:void 0,3);k=k?k.next:j.first;)for(K(k.value,k.key,this);k&&k.removed;)k=k.previous},has:function(C){return!!O(this,C)}}),kf(h.prototype,o?{get:function(C){return(C=O(this,C))&&C.value},set:function(C,k){return v(this,C===0?0:C,k)}}:{add:function(C){return v(this,C=C===0?0:C,C)}}),wa&&Py(h.prototype,"size",{get:function(){return E(this).size}}),h},setStrong:function(i,r,o){var u=r+" Iterator",h=Tk(r),E=Tk(u);Wj(i,r,function(v,O){Fq(this,{type:u,target:v,state:h(v),kind:O,last:void 0})},function(){for(var v=E(this),O=v.kind,C=v.last;C&&C.removed;)C=C.previous;return v.target&&(v.last=C=C?C.next:v.state.first)?O=="keys"?{value:C.key,done:!1}:O=="values"?{value:C.value,done:!1}:{value:[C.key,C.value],done:!1}:(v.target=void 0,{value:void 0,done:!0})},o?"entries":"values",!o,!0),og(r)}};Dq("Set",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},Gq);var Uk=Pc("Reflect","apply"),Qy=Function.apply,Ry=!la(function(){Uk(function(){})});ea({target:"Reflect",stat:!0,forced:Ry},{apply:function(i,r,o){return Wb(i),Ia(o),Uk?Uk(i,r,o):Qy.call(i,r,o)}}),ea({target:"Reflect",stat:!0},{ownKeys:so});var Hq=Fa("isConcatSpreadable"),Sy=51<=Cd||!la(function(){var i=[];return i[Hq]=!1,i.concat()[0]!==i}),Ty=kg("concat");ea({target:"Array",proto:!0,forced:!Sy||!Ty},{concat:function(i){var r,o=pb(this),u=Dh(o,0),h=0,E=-1;for(r=arguments.length;E<r;E++){var v=E===-1?o:arguments[E],O=v;if(xa(O)){var C=O[Hq];O=C!==void 0?!!C:Ed(O)}else O=!1;if(O){if(9007199254740991<h+(C=Ma(v.length)))throw TypeError("Maximum allowed index exceeded");for(O=0;O<C;O++,h++)O in v&&hf(u,h,v[O])}else{if(9007199254740991<=h)throw TypeError("Maximum allowed index exceeded");hf(u,h++,v)}}return u.length=h,u}});var Uy=Bk,Vy=la(function(){return!Object.getOwnPropertyNames(1)});ea({target:"Object",stat:!0,forced:Vy},{getOwnPropertyNames:Uy});var Wy=de.f,Xy=dc.f,Yy=qb.f,Kd=R.Number,ci=Kd.prototype,Zy=xc(jc(ci))=="Number",Iq=function(i){var r,o=Oc(i,!1);if(typeof o=="string"&&2<o.length){if((i=(o=Oj(o)).charCodeAt(0))===43||i===45){if((i=o.charCodeAt(2))===88||i===120)return NaN}else if(i===48){switch(o.charCodeAt(1)){case 66:case 98:i=2;var u=49;break;case 79:case 111:i=8,u=55;break;default:return+o}var h=(o=o.slice(2)).length;for(r=0;r<h;r++){var E=o.charCodeAt(r);if(48>E||E>u)return NaN}return parseInt(o,i)}}return+o};if(Qc("Number",!Kd(" 0o1")||!Kd("0b1")||Kd("+0x1"))){for(var le=function(i){var r=1>arguments.length?0:i,o=this;return o instanceof le&&(Zy?la(function(){ci.valueOf.call(o)}):xc(o)!="Number")?Wh(new Kd(Iq(r)),o,le):Iq(r)},Jq=wa?Wy(Kd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),Vk=0,di;Jq.length>Vk;Vk++)ka(Kd,di=Jq[Vk])&&!ka(le,di)&&Yy(le,di,Xy(Kd,di));le.prototype=ci,ci.constructor=le,Za(R,"Number",le)}var sf=(typeof Reflect>"u"?"undefined":qa(Reflect))==="object"?Reflect:null,Kq=sf&&typeof sf.apply=="function"?sf.apply:function(i,r,o){return Function.prototype.apply.call(i,r,o)},$y=sf&&typeof sf.ownKeys=="function"?sf.ownKeys:Object.getOwnPropertySymbols?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:function(i){return Object.getOwnPropertyNames(i)},Lq=Number.isNaN||function(i){return i!=i};Ba.EventEmitter=Ba,Ba.prototype._events=void 0,Ba.prototype._eventsCount=0,Ba.prototype._maxListeners=void 0;var Mq=10;Object.defineProperty(Ba,"defaultMaxListeners",{enumerable:!0,get:function(){return Mq},set:function(i){if(typeof i!="number"||0>i||Lq(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Mq=i}}),Ba.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ba.prototype.setMaxListeners=function(i){if(typeof i!="number"||0>i||Lq(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this},Ba.prototype.getMaxListeners=function(){return this._maxListeners===void 0?Ba.defaultMaxListeners:this._maxListeners},Ba.prototype.emit=function(i){for(var r=[],o=1;o<arguments.length;o++)r.push(arguments[o]);o=i==="error";var u=this._events;if(u!==void 0)o=o&&u.error===void 0;else if(!o)return!1;if(o){var h;throw 0<r.length&&(h=r[0]),h instanceof Error?h:((r=Error("Unhandled error."+(h?" ("+h.message+")":""))).context=h,r)}if((o=u[i])===void 0)return!1;if(typeof o=="function")Kq(o,this,r);else for(u=Gm(o,h=o.length),o=0;o<h;++o)Kq(u[o],this,r);return!0},Ba.prototype.addListener=function(i,r){return Dm(this,i,r,!1)},Ba.prototype.on=Ba.prototype.addListener,Ba.prototype.prependListener=function(i,r){return Dm(this,i,r,!0)},Ba.prototype.once=function(i,r){return Wg(r),this.on(i,Em(this,i,r)),this},Ba.prototype.prependOnceListener=function(i,r){return Wg(r),this.prependListener(i,Em(this,i,r)),this},Ba.prototype.removeListener=function(i,r){var o;Wg(r);var u=this._events;if(u===void 0)return this;var h=u[i];if(h===void 0)return this;if(h===r||h.listener===r)--this._eventsCount==0?this._events=Object.create(null):(delete u[i],u.removeListener&&this.emit("removeListener",i,h.listener||r));else if(typeof h!="function"){var E=-1;for(o=h.length-1;0<=o;o--)if(h[o]===r||h[o].listener===r){var v=h[o].listener;E=o;break}if(0>E)return this;if(E===0)h.shift();else{for(;E+1<h.length;E++)h[E]=h[E+1];h.pop()}h.length===1&&(u[i]=h[0]),u.removeListener!==void 0&&this.emit("removeListener",i,v||r)}return this},Ba.prototype.off=Ba.prototype.removeListener,Ba.prototype.removeAllListeners=function(i){var r=this._events;if(r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[i]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[i]),this;if(arguments.length===0){var o=Object.keys(r);for(r=0;r<o.length;++r){var u=o[r];u!=="removeListener"&&this.removeAllListeners(u)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(o=r[i])=="function")this.removeListener(i,o);else if(o!==void 0)for(r=o.length-1;0<=r;r--)this.removeListener(i,o[r]);return this},Ba.prototype.listeners=function(i){return Fm(this,i,!0)},Ba.prototype.rawListeners=function(i){return Fm(this,i,!1)},Ba.listenerCount=function(i,r){return typeof i.listenerCount=="function"?i.listenerCount(r):Hm.call(i,r)},Ba.prototype.listenerCount=Hm,Ba.prototype.eventNames=function(){return 0<this._eventsCount?$y(this._events):[]},Ba.once=function(i,r){return new Promise(function(o,u){function h(v){i.removeListener(r,E),u(v)}function E(){typeof i.removeListener=="function"&&i.removeListener("error",h),o([].slice.call(arguments))}Im(i,r,E,{once:!0}),r!=="error"&&fu(i,h,{once:!0})})};var tf=Object.assign,Nq=Object.defineProperty,Bg=!tf||la(function(){if(wa&&tf({b:1},tf(Nq({},"a",{enumerable:!0,get:function(){Nq(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var i={},r={},o=Symbol();return i[o]=7,"abcdefghijklmnopqrst".split("").forEach(function(u){r[u]=u}),tf({},i)[o]!=7||ed(tf({},r)).join("")!="abcdefghijklmnopqrst"})?function(i,r){for(var o=pb(i),u=arguments.length,h=1,E=gg.f,v=eg;u>h;)for(var O,C=fg(arguments[h++]),k=E?ed(C).concat(E(C)):ed(C),j=k.length,K=0;j>K;)O=k[K++],(!wa||v.call(C,O))&&(o[O]=C[O]);return o}:tf;ea({target:"Object",stat:!0,forced:Object.assign!==Bg},{assign:Bg}),Dq("Map",function(i){return function(){return i(this,arguments.length?arguments[0]:void 0)}},Gq);var az=Math.log,bz=Math.LN2;ea({target:"Math",stat:!0},{log2:function(i){return az(i)/bz}});var cz=qb.f,dz=de.f,ez=cb.enforce,fz=Fa("match"),Vc=R.RegExp,Wk=Vc.prototype,Cg=/a/g,Xk=/a/g,Yk=new Vc(Cg)!==Cg;if(wa&&Qc("RegExp",!Yk||Rc||la(function(){return Xk[fz]=!1,Vc(Cg)!=Cg||Vc(Xk)==Xk||Vc(Cg,"i")!="/a/i"}))){for(var ld=function(i,r){var o,u=this instanceof ld,h=Lj(i),E=r===void 0;return!u&&h&&i.constructor===ld&&E||(Yk?h&&!E&&(i=i.source):i instanceof ld&&(E&&(r=Gj.call(i)),i=i.source),Rc&&(o=!!r&&-1<r.indexOf("y"))&&(r=r.replace(/y/g,"")),i=Wh(Yk?new Vc(i,r):Vc(i,r),u?this:Wk,ld),Rc&&o&&(ez(i).sticky=!0)),i},gz=function(i){i in ld||cz(ld,i,{configurable:!0,get:function(){return Vc[i]},set:function(r){Vc[i]=r}})},Oq=dz(Vc),Pq=0;Oq.length>Pq;)gz(Oq[Pq++]);Wk.constructor=ld,ld.prototype=Wk,Za(R,"RegExp",ld)}og("RegExp"),xg("Float32",function(i){return function(r,o,u){return i(this,r,o,u)}}),xg("Float64",function(i){return function(r,o,u){return i(this,r,o,u)}}),xg("Uint32",function(i){return function(r,o,u){return i(this,r,o,u)}}),xg("Uint16",function(i){return function(r,o,u){return i(this,r,o,u)}});var Zk=function(i,r){return i===r?0:i==null?r==null?0:-1:r==null?i==null?0:1:typeof i.compare=="function"?i.compare(r):typeof r.compare=="function"?-r.compare(i):i<r?-1:i>r?1:0},$k=[],Qq=$k.sort,hz=la(function(){$k.sort(void 0)}),iz=la(function(){$k.sort(null)}),jz=ff("sort");ea({target:"Array",proto:!0,forced:hz||!iz||!jz},{sort:function(i){return i===void 0?Qq.call(pb(this)):Qq.call(pb(this),Wb(i))}});var Rq=Object.getPrototypeOf({}),Dg=function(i,r){var o;return i===r||(i==null?i==r:qa(i.equiv)==="function"?i.equiv(r):r==null?i==r:qa(r.equiv)==="function"?r.equiv(i):qa(i)!=="string"&&qa(r)!=="string"&&((o=Object.getPrototypeOf(i))!=null&&o!==Rq||(o=Object.getPrototypeOf(r))!=null&&o!==Rq?qa(i)!=="function"&&i.length!==void 0&&qa(r)!=="function"&&r.length!==void 0?lz(i,r):i instanceof Set&&r instanceof Set?mz(i,r):i instanceof Map&&r instanceof Map?nz(i,r):i instanceof Date&&r instanceof Date?i.getTime()===r.getTime():i instanceof RegExp&&r instanceof RegExp?i.toString()===r.toString():i!=i&&r!=r:kz(i,r)))},lz=function(i,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg,u=i.length;if(u===r.length)for(;0<=--u&&o(i[u],r[u]););return 0>u},mz=function(i,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg;return i.size===r.size&&o(Z(i.keys()).sort(),Z(r.keys()).sort())},nz=function(i,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg;return i.size===r.size&&o(Z(i).sort(),Z(r).sort())},kz=function(i,r){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Dg;if(Object.keys(i).length!==Object.keys(r).length)return!1;for(var u in i)if(!r.hasOwnProperty(u)||!o(i[u],r[u]))return!1;return!0},Sq=function(i){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(o){return o!==void 0?": "+o:""};return function(o){function u(E){return va(this,u),h.call(this,i(E)+r(E))}Ga(u,o);var h=Ha(u);return u}(Kf(Error))},oz=Sq(function(){return"illegal argument(s)"}),ei=function(i){throw new oz(i)},al=Sq(function(){return"index out of bounds"}),Tq=1/4294967295,pz=function(){function i(){va(this,i)}return eb(i,[{key:"float",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Tq*r}},{key:"norm",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Tq-.5)*r}},{key:"minmax",value:function(r,o){return this.float()*(o-r)+r}}]),i}(),bl=Math.random,qz=new(function(i){function r(){return va(this,r),o.apply(this,arguments)}Ga(r,i);var o=Ha(r);return eb(r,[{key:"int",value:function(){return 4294967296*bl()>>>0}},{key:"float",value:function(){var u=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return bl()*u}},{key:"norm",value:function(){var u=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(bl()-.5)*u}}]),r}(pz)),Ni=Symbol(),Lm=function(){},rz=Sk.onFreeze,cl=Object.freeze,sz=la(function(){cl(1)});ea({target:"Object",stat:!0,forced:sz,sham:!Cq},{freeze:function(i){return cl&&xa(i)?cl(rz(i)):i}});var tz=ff("reduce"),uz=!fd&&79<Cd&&83>Cd;ea({target:"Array",proto:!0,forced:!tz||uz},{reduce:function(i){return $p(this,i,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Km=function(i){return i!=null&&typeof i.xform=="function"?i.xform():i},Xg=function(){function i(r){va(this,i),this.value=r}return eb(i,[{key:"deref",value:function(){return this.value}}]),i}(),Oi=function(i){return i instanceof Xg?i.deref():i},hu=function(i,r){return[i,function(o){return o},r]},vz=N.mark(function(i,r){var o,u,h,E,v,O;return N.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:o=Km(i)(gu()),u=o[1],h=o[2],E=0;case 4:if(!(E<r.length)){C.next=15;break}if(v=r[E],!((O=h([],v))instanceof Xg)){C.next=10;break}return C.delegateYield(Oi(u(O.deref())),"t0",9);case 9:return C.abrupt("return");case 10:if(!O.length){C.next=12;break}return C.delegateYield(O,"t1",12);case 12:E++,C.next=4;break;case 15:return C.delegateYield(Oi(u([])),"t2",16);case 16:case"end":return C.stop()}},vz)}),iu=N.mark(Jm),ju=function(i,r){return[i[0],i[1],r]},wz=function(){function i(r){va(this,i),this._length=0,r&&this.into(r)}return eb(i,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new i(this)}},{key:"empty",value:function(){return new i}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var r,o=this.head;o;)r=o.next,delete o.value,delete o.prev,delete o.next,o=r;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(r){var o=this._length;if(o<r._length)return-1;if(o>r._length)return 1;if(o===0)return 0;o=this.head,r=r.head;for(var u=0;o&&u==0;)u=Zk(o.value,r.value),o=o.next,r=r.next;return u}},{key:"equiv",value:function(r){if(!(r instanceof i||r!=null&&typeof r!="function"&&r.length!==void 0)||this._length!==r.length)return!1;if(!this._length||this===r)return!0;for(var o=this.head,u=0;u<r.length;u++){if(!Dg(o.value,r[u]))return!1;o=o.next}return!0}},{key:Symbol.iterator,value:N.mark(function r(){var o;return N.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o=this.head;case 1:if(!o){u.next=7;break}return u.next=4,o.value;case 4:o=o.next,u.next=1;break;case 7:case"end":return u.stop()}},r,this)})},{key:"seq",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(r>=o||0>r)){r=this.nthCell(r);var u=this.nthCell(o-1);return o=function h(E){return{first:function(){return E.value},next:function(){return E!==u&&E.next?h(E.next):void 0}}},r?o(r):void 0}}},{key:"cycle",value:N.mark(function r(){return N.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.delegateYield(this,"t0",2);case 2:o.next=0;break;case 4:case"end":return o.stop()}},r,this)})},{key:"$reduce",value:function(r,o){for(var u=this.head;u&&!(o instanceof Xg);)o=r(o,u.value),u=u.next;return o}},{key:"drop",value:function(){var r=this.head;if(r)return(this.head=r.next)?delete this.head.prev:delete this.tail,this._length--,r.value}},{key:"cons",value:function(r){return r={value:r,next:this.head},this.head?this.head.prev=r:this.tail=r,this.head=r,this._length++,this}},{key:"insertBefore",value:function(r,o){return r||ei("cell is undefined"),o={value:o,next:r,prev:r.prev},r.prev?r.prev.next=o:this.head=o,r.prev=o,this._length++,this}},{key:"insertAfter",value:function(r,o){return r||ei("cell is undefined"),o={value:o,next:r.next,prev:r},r.next?r.next.prev=o:this.tail=o,r.next=o,this._length++,this}},{key:"insertBeforeNth",value:function(r,o){if(0>r&&(r+=this._length),0>=r)return this.cons(o);if(0>r||r>=this._length)throw new al(r);return this.insertBefore(this.nthCellUnsafe(r),o)}},{key:"insertAfterNth",value:function(r,o){if(0>r&&(r+=this._length),r>=this._length-1)return this.push(o);if(0>r||r>=this._length)throw new al(r);return this.insertAfter(this.nthCellUnsafe(r),o)}},{key:"insertSorted",value:function(r,o){o=o||Zk;for(var u=this.head;u;){if(0>=o(r,u.value))return this.insertBefore(u,r);u=u.next}return this.push(r)}},{key:"find",value:function(r){for(var o=this.head;o;){if(o.value===r)return o;o=o.next}}},{key:"findWith",value:function(r){for(var o=this.head;o;){if(r(o.value))return o;o=o.next}}},{key:"concat",value:function(){for(var r=this.copy(),o=arguments.length,u=Array(o),h=0;h<o;h++)u[h]=arguments[h];for(o=0;o<u.length;o++)r.into(u[o]);return r}},{key:"into",value:function(r){for(var o=0;o<r.length;o++)this.push(r[o])}},{key:"slice",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;r=0>r?r+this._length:r,o=0>o?o+this._length:o,(0>r||0>o)&&ei("invalid indices: ${from} / ${to}");for(var u=new i,h=this.nthCell(r);h&&++r<=o;)u.push(h.value),h=h.next;return u}},{key:"splice",value:function(r){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,u=2<arguments.length?arguments[2]:void 0;if(typeof r=="number"){if(0>r&&(r+=this._length),0>r||r>=this._length)throw new al(r);var h=this.nthCellUnsafe(r)}else h=r;var E=new i;if(0<o)for(;h&&0<o--;)this.remove(h),E.push(h.value),h=h.next;else h&&(h=h.next);if(u)if(h)for(o=0;o<u.length;o++)this.insertBefore(h,u[o]);else for(h=0;h<u.length;h++)this.push(u[h]);return E}},{key:"remove",value:function(r){return r.prev?r.prev.next=r.next:this.head=r.next,r.next?r.next.prev=r.prev:this.tail=r.prev,this._length--,this}},{key:"swap",value:function(r,o){if(r!==o){var u=r.value;r.value=o.value,o.value=u}return this}},{key:"push",value:function(r){return this.tail?(r={value:r,prev:this.tail},this.tail=this.tail.next=r,this._length++,this):this.cons(r)}},{key:"pop",value:function(){var r=this.tail;if(r)return(this.tail=r.prev)?delete this.tail.next:delete this.head,this._length--,r.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(r){return this.head?(this.head.value=r,this):this.cons(r)}},{key:"setTail",value:function(r){return this.tail?(this.tail.value=r,this):this.push(r)}},{key:"setNth",value:function(r,o){var u=this.nthCell(r);return!u&&ei("index out of bounds: ".concat(r)),u.value=o,this}},{key:"nth",value:function(r,o){return(r=this.nthCell(r))?r.value:o}},{key:"nthCell",value:function(r){if(0>r&&(r+=this._length),!(0>r||r>=this._length))return this.nthCellUnsafe(r)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var r=this.peek();return this.pop(),this.cons(r)}}},{key:"map",value:function(r){for(var o=new i,u=this.head;u;)o.push(r(u.value)),u=u.next;return o}},{key:"filter",value:function(r){for(var o=new i,u=this.head;u;)r(u.value)&&o.push(u.value),u=u.next;return o}},{key:"reduce",value:function(r,o){for(var u=this.head;u;)o=r(o,u.value),u=u.next;return o}},{key:"shuffle",value:function(r){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:qz;if(2>this._length)return this;for(r=r??Math.ceil(1.5*Math.log2(this._length));0<r;r--)for(var u=this.head;u;){var h=u.next;.5>o.float()?this.asHead(u):this.asTail(u),u=h}return this}},{key:"sort",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:Zk;if(!this._length)return this;for(var o=1;;){var u=this.head;this.tail=this.head=void 0;for(var h=0;u;){h++;for(var E=u,v=0,O=0;O<o&&(v++,E=E.next);O++);for(O=o;0<v||0<O&&E;){if(v===0){var C=E;E=E.next,O--}else E&&O!==0?0>=r(u.value,E.value)?(C=u,u=u.next,v--):(C=E,E=E.next,O--):(C=u,u=u.next,v--);this.tail?this.tail.next=C:this.head=C,C.prev=this.tail,this.tail=C}u=E}if(this.tail.next=void 0,1>=h)return this;o*=2}}},{key:"reverse",value:function(){for(var r=this.head,o=this.tail,u=(this._length>>>1)+(1&this._length);r&&o&&0<u;){var h=r.value;r.value=o.value,o.value=h,r=r.next,o=o.prev,u--}return this}},{key:"asHead",value:function(r){return r===this.head||(this.remove(r),this.head.prev=r,r.next=this.head,r.prev=void 0,this.head=r,this._length++),this}},{key:"asTail",value:function(r){return r===this.tail||(this.remove(r),this.tail.next=r,r.prev=this.tail,r.next=void 0,this.tail=r,this._length++),this}},{key:"toString",value:function(){for(var r=[],o=this.head;o;)r.push(String(o.value)),o=o.next;return r.join(", ")}},{key:"toJSON",value:function(){return Z(this)}},{key:"nthCellUnsafe",value:function(r){if(r<=this._length>>1)var o=this.head,u="next";else o=this.tail,u="prev",r=this._length-r-1;for(;0<r--&&o;)o=o[u];return o}}]),i}(),Wc=function(){function i(r,o){va(this,i),o=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},o),this.map=o.map(),this.items=new wz,this._size=0,this.opts=o,r&&this.into(r)}return eb(i,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return Yg(function(r){return[r.k,r]},this.items)}},{key:"keys",value:function(){return Yg(function(r){return r.k},this.items)}},{key:"values",value:function(){return Yg(function(r){return r.v},this.items)}},{key:"copy",value:function(){var r=this.empty();r.items=this.items.copy();for(var o=r.items.head;o;)r.map.set(o.value.k,o),o=o.next;return r}},{key:"empty",value:function(){return new i(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var r=this.opts.release;if(r){for(var o;o=this.items.drop();)r(o.k,o.v);return!0}return this.items.release()}},{key:"has",value:function(r){return this.map.has(r)}},{key:"get",value:function(r,o){return(r=this.map.get(r))?this.resetEntry(r):o}},{key:"set",value:function(r,o){var u=this.opts.ksize(r)+this.opts.vsize(o),h=this.map.get(r);return this._size+=Math.max(0,u-(h?h.value.s:0)),this.ensureSize()&&this.doSetEntry(h,r,o,u),o}},{key:"into",value:function(r){for(var o=0;o<r.length;o++){var u=r[o];this.set(u[0],u[1])}return this}},{key:"getSet",value:function(r,o){var u=this,h=this.map.get(r);return h?Promise.resolve(this.resetEntry(h)):o().then(function(E){return u.set(r,E)})}},{key:"delete",value:function(r){return!!(r=this.map.get(r))&&(this.removeEntry(r),!0)}},{key:"resetEntry",value:function(r){return this.items.asTail(r),r.value.v}},{key:"ensureSize",value:function(){for(var r=this.opts.release,o=this.opts.maxsize,u=this.opts.maxlen;this._size>o||this.length>=u;){var h=this.items.drop();if(!h)return!1;this.map.delete(h.k),r&&r(h.k,h.v),this._size-=h.s}return!0}},{key:"removeEntry",value:function(r){var o=r.value;this.map.delete(o.k),this.items.remove(r),this.opts.release&&this.opts.release(o.k,o.v),this._size-=o.s}},{key:"doSetEntry",value:function(r,o,u,h){r?(r.value.v=u,r.value.s=h,this.items.asTail(r)):(this.items.push({k:o,v:u,s:h}),this.map.set(o,this.items.tail))}}]),i}(),xz=function(i){function r(u,h){return va(this,r),h=Object.assign({ttl:36e5},h),o.call(this,u,h)}Ga(r,i);var o=Ha(r);return eb(r,[{key:"empty",value:function(){return new r(null,this.opts)}},{key:"has",value:function(u){return this.get(u)!==void 0}},{key:"get",value:function(u,h){if(u=this.map.get(u)){if(u.value.t>=Date.now())return this.resetEntry(u);this.removeEntry(u)}return h}},{key:"set",value:function(u,h){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,v=this.opts.ksize(u)+this.opts.vsize(h),O=this.map.get(u);return this._size+=Math.max(0,v-(O?O.value.s:0)),this.ensureSize()&&(E=Date.now()+E,O?(O.value.v=h,O.value.s=v,O.value.t=E,this.items.asTail(O)):(this.items.push({k:u,v:h,s:v,t:E}),this.map.set(u,this.items.tail))),h}},{key:"getSet",value:function(u,h){var E=this,v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,O=this.get(u);return O?Promise.resolve(O):h().then(function(C){return E.set(u,C,v)})}},{key:"prune",value:function(){for(var u=Date.now(),h=this.items.head;h;)h.value.t<u&&this.removeEntry(h),h=h.next}},{key:"ensureSize",value:function(){for(var u=this.opts.maxsize,h=this.opts.maxlen,E=Date.now(),v=this.items.head;v&&(this._size>u||this.length>=h);)v.value.t<E&&this.removeEntry(v),v=v.next;return Li(Td(r.prototype),"ensureSize",this).call(this)}}]),r}(Wc),Uq=qa(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,yz=(typeof self>"u"?"undefined":qa(self))=="object"&&self&&self.Object===Object&&self,$b=Uq||yz||Function("return this")(),lc=$b.Symbol,Vq=Object.prototype,zz=Vq.hasOwnProperty,Az=Vq.toString,Eg=lc?lc.toStringTag:void 0,Bz=Object.prototype.toString,Wq=lc?lc.toStringTag:void 0,me=function(i){if(i==null)i=i===void 0?"[object Undefined]":"[object Null]";else if(Wq&&Wq in Object(i)){var r=zz.call(i,Eg),o=i[Eg];try{i[Eg]=void 0;var u=!0}catch{}var h=Az.call(i);u&&(r?i[Eg]=o:delete i[Eg]),i=h}else i=Bz.call(i);return i},Gb=function(i){var r=qa(i);return i!=null&&(r=="object"||r=="function")},jj=function(i){return!!Gb(i)&&((i=me(i))=="[object Function]"||i=="[object GeneratorFunction]"||i=="[object AsyncFunction]"||i=="[object Proxy]")},dl=$b["__core-js_shared__"],Xq=function(){var i=/[^.]+$/.exec(dl&&dl.keys&&dl.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Cz=Function.prototype.toString,ne=function(i){if(i!=null){try{return Cz.call(i)}catch{}return i+""}return""},Dz=/^\[object .+?Constructor\]$/,Ez=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oe=function(i,r){return i=i==null?void 0:i[r],!Gb(i)||Xq&&Xq in i||!(jj(i)?Ez:Dz).test(ne(i))?void 0:i},Fg=oe(Object,"create"),Fz=Object.prototype.hasOwnProperty,Gz=Object.prototype.hasOwnProperty;Vd.prototype.clear=function(){this.__data__=Fg?Fg(null):{},this.size=0},Vd.prototype.delete=function(i){return i=this.has(i)&&delete this.__data__[i],this.size-=i?1:0,i},Vd.prototype.get=function(i){var r=this.__data__;return Fg?(i=r[i])==="__lodash_hash_undefined__"?void 0:i:Fz.call(r,i)?r[i]:void 0},Vd.prototype.has=function(i){var r=this.__data__;return Fg?r[i]!==void 0:Gz.call(r,i)},Vd.prototype.set=function(i,r){var o=this.__data__;return this.size+=this.has(i)?0:1,o[i]=Fg&&r===void 0?"__lodash_hash_undefined__":r,this};var Gg=function(i,r){return i===r||i!=i&&r!=r},fi=function(i,r){for(var o=i.length;o--;)if(Gg(i[o][0],r))return o;return-1},Hz=Array.prototype.splice;Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(i){var r=this.__data__;return!(0>(i=fi(r,i)))&&(i==r.length-1?r.pop():Hz.call(r,i,1),--this.size,!0)},Ee.prototype.get=function(i){var r=this.__data__;return 0>(i=fi(r,i))?void 0:r[i][1]},Ee.prototype.has=function(i){return-1<fi(this.__data__,i)},Ee.prototype.set=function(i,r){var o=this.__data__,u=fi(o,i);return 0>u?(++this.size,o.push([i,r])):o[u][1]=r,this};var $g=Ee,Hg=oe($b,"Map"),gi=function(i,r){i=i.__data__;var o=qa(r);return(o=="string"||o=="number"||o=="symbol"||o=="boolean"?r!=="__proto__":r===null)?i[typeof r=="string"?"string":"hash"]:i.map};Fe.prototype.clear=function(){this.size=0,this.__data__={hash:new Vd,map:new(Hg||$g),string:new Vd}},Fe.prototype.delete=function(i){return i=gi(this,i).delete(i),this.size-=i?1:0,i},Fe.prototype.get=function(i){return gi(this,i).get(i)},Fe.prototype.has=function(i){return gi(this,i).has(i)},Fe.prototype.set=function(i,r){var o=gi(this,i),u=o.size;return o.set(i,r),this.size+=o.size==u?0:1,this};var Zg=Fe;Lf.prototype.add=Lf.prototype.push=function(i){return this.__data__.set(i,"__lodash_hash_undefined__"),this},Lf.prototype.has=function(i){return this.__data__.has(i)};var Yq=function(i,r,o,u){var h=i.length;for(o+=-1;++o<h;)if(r(i[o],o,i))return o;return-1},Iz=function(i){return i!=i},Jz=function(i,r){var o;if(o=!(i==null||!i.length)){if(r==r)t:{o=-1;for(var u=i.length;++o<u;)if(i[o]===r){i=o;break t}i=-1}else i=Yq(i,Iz,0);o=-1<i}return o},Kz=function(i,r,o){for(var u=-1,h=i==null?0:i.length;++u<h;)if(o(r,i[u]))return!0;return!1},Lz=function(i,r){return i.has(r)},uf=oe($b,"Set"),Mz=function(){},el=function(i){var r=-1,o=Array(i.size);return i.forEach(function(u){o[++r]=u}),o},Nz=1/0,Oz=uf&&1/el(new uf([,-0]))[1]==Nz?function(i){return new uf(i)}:Mz,fl=function(i,r,o){var u=-1,h=Jz,E=i.length,v=!0,O=[],C=O;if(o)v=!1,h=Kz;else if(200<=E){if(h=Oz(i))return el(h);v=!1,h=Lz,C=new Lf}else C=O;t:for(;++u<E;){var k=i[u],j=k;if(k=o||k!==0?k:0,v&&j==j){for(var K=C.length;K--;)if(C[K]===j)continue t;O.push(k)}else h(C,j,o)||(C!==O&&C.push(j),O.push(k))}return O},Zq=function(i){for(var r=-1,o=i==null?0:i.length,u={};++r<o;){var h=i[r];u[h[0]]=h[1]}return u},Je=function(i,r){for(var o=-1,u=i==null?0:i.length,h=Array(u);++o<u;)h[o]=r(i[o],o,i);return h};Ge.prototype.clear=function(){this.__data__=new $g,this.size=0},Ge.prototype.delete=function(i){var r=this.__data__;return i=r.delete(i),this.size=r.size,i},Ge.prototype.get=function(i){return this.__data__.get(i)},Ge.prototype.has=function(i){return this.__data__.has(i)},Ge.prototype.set=function(i,r){var o=this.__data__;if(o instanceof $g){var u=o.__data__;if(!Hg||199>u.length)return u.push([i,r]),this.size=++o.size,this;o=this.__data__=new Zg(u)}return o.set(i,r),this.size=o.size,this};var Ie=Ge,su=function(i,r){for(var o=-1,u=i==null?0:i.length;++o<u&&r(i[o],o,i)!==!1;);return i},hi=function(){try{var i=oe(Object,"defineProperty");return i({},"",{}),i}catch{}}(),Ig=function(i,r,o){r=="__proto__"&&hi?hi(i,r,{configurable:!0,enumerable:!0,value:o,writable:!0}):i[r]=o},Pz=Object.prototype.hasOwnProperty,Qm=function(i,r,o){var u=i[r];Pz.call(i,r)&&Gg(u,o)&&(o!==void 0||r in i)||Ig(i,r,o)},Ue=function(i,r,o,u){var h=!o;o||(o={});for(var E=-1,v=r.length;++E<v;){var O=r[E],C=void 0;C===void 0&&(C=i[O]),h?Ig(o,O,C):Qm(o,O,C)}return o},Hc=function(i){return i!=null&&qa(i)=="object"},$q=function(i){return Hc(i)&&me(i)=="[object Arguments]"},ar=Object.prototype,Qz=ar.hasOwnProperty,Rz=ar.propertyIsEnumerable,Vf=$q(function(){return arguments}())?$q:function(i){return Hc(i)&&Qz.call(i,"callee")&&!Rz.call(i,"callee")},ub=Array.isArray,Sz=function(){return!1},Nf=xb(function(i,r){var o=(r=r&&!r.nodeType&&r)&&i&&!i.nodeType&&i;r=o&&o.exports===r?$b.Buffer:void 0,i.exports=(r?r.isBuffer:void 0)||Sz}),Tz=/^(?:0|[1-9]\d*)$/,gl=function(i,r){var o=qa(i);return!!(r=r??9007199254740991)&&(o=="number"||o!="symbol"&&Tz.test(i))&&-1<i&&i%1==0&&i<r},hl=function(i){return typeof i=="number"&&-1<i&&i%1==0&&9007199254740991>=i},Va={};Va["[object Float32Array]"]=Va["[object Float64Array]"]=Va["[object Int8Array]"]=Va["[object Int16Array]"]=Va["[object Int32Array]"]=Va["[object Uint8Array]"]=Va["[object Uint8ClampedArray]"]=Va["[object Uint16Array]"]=Va["[object Uint32Array]"]=!0,Va["[object Arguments]"]=Va["[object Array]"]=Va["[object ArrayBuffer]"]=Va["[object Boolean]"]=Va["[object DataView]"]=Va["[object Date]"]=Va["[object Error]"]=Va["[object Function]"]=Va["[object Map]"]=Va["[object Number]"]=Va["[object Object]"]=Va["[object RegExp]"]=Va["[object Set]"]=Va["[object String]"]=Va["[object WeakMap]"]=!1;var Uz=function(i){return Hc(i)&&hl(i.length)&&!!Va[me(i)]},ii=function(i){return function(r){return i(r)}},vf=xb(function(i,r){var o=r&&!r.nodeType&&r;o=(r=o&&i&&!i.nodeType&&i)&&r.exports===o&&Uq.process;t:{try{var u=r&&r.require&&r.require("util").types;if(u){var h=u;break t}h=o&&o.binding&&o.binding("util");break t}catch{}h=void 0}i.exports=h}),br=vf&&vf.isTypedArray,Ui=br?ii(br):Uz,Vz=Object.prototype.hasOwnProperty,cr=function(i,r){var o=ub(i),u=!o&&Vf(i),h=!o&&!u&&Nf(i),E=!o&&!u&&!h&&Ui(i);if(o=o||u||h||E){u=i.length;for(var v=String,O=-1,C=Array(u);++O<u;)C[O]=v(O);u=C}else u=[];for(var k in v=u.length,i)!r&&!Vz.call(i,k)||o&&(k=="length"||h&&(k=="offset"||k=="parent")||E&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||gl(k,v))||u.push(k);return u},Wz=Object.prototype,il=function(i){var r=i&&i.constructor;return i===(typeof r=="function"&&r.prototype||Wz)},dr=function(i,r){return function(o){return i(r(o))}},Xz=dr(Object.keys,Object),Yz=Object.prototype.hasOwnProperty,ae=function(i){return i!=null&&hl(i.length)&&!jj(i)},Wd=function(i){if(ae(i))i=cr(i);else if(il(i)){var r,o=[];for(r in Object(i))Yz.call(i,r)&&r!="constructor"&&o.push(r);i=o}else i=Xz(i);return i},ou=function(i,r){return i&&Ue(r,Wd(r),i)},Zz=Object.prototype.hasOwnProperty,Of=function(i){if(ae(i))i=cr(i,!0);else if(Gb(i)){var r=il(i),o=[];for(u in i)(u!="constructor"||!r&&Zz.call(i,u))&&o.push(u);i=o}else{var u=[];if(i!=null)for(r in Object(i))u.push(r);i=u}return i},mu=function(i,r){return i&&Ue(r,Of(r),i)},Nm=xb(function(i,r){var o=(r=r&&!r.nodeType&&r)&&i&&!i.nodeType&&i,u=(r=o&&o.exports===r?$b.Buffer:void 0)?r.allocUnsafe:void 0;i.exports=function(h,E){return E?h.slice():(E=h.length,E=u?u(E):new h.constructor(E),h.copy(E),E)}}),Pi=function(i,r){var o=-1,u=i.length;for(r||(r=Array(u));++o<u;)r[o]=i[o];return r},$z=function(i,r){for(var o=-1,u=i==null?0:i.length,h=0,E=[];++o<u;){var v=i[o];r(v,o,i)&&(E[h++]=v)}return E},er=function(){return[]},aA=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols,jl=fr?function(i){return i==null?[]:(i=Object(i),$z(fr(i),function(r){return aA.call(i,r)}))}:er,nu=function(i,r){return Ue(i,jl(i),r)},Ti=function(i,r){for(var o=-1,u=r.length,h=i.length;++o<u;)i[h+o]=r[o];return i},kl=dr(Object.getPrototypeOf,Object),gr=Object.getOwnPropertySymbols?function(i){for(var r=[];i;)Ti(r,jl(i)),i=kl(i);return r}:er,lu=function(i,r){return Ue(i,gr(i),r)},hr=function(i,r,o){return r=r(i),ub(i)?r:Ti(r,o(i))},Qi=function(i){return hr(i,Wd,jl)},Pm=function(i){return hr(i,Of,gr)},ll=oe($b,"DataView"),ml=oe($b,"Promise"),nl=oe($b,"WeakMap"),bA=ne(ll),cA=ne(Hg),dA=ne(ml),eA=ne(uf),fA=ne(nl),pe=me;(ll&&pe(new ll(new ArrayBuffer(1)))!="[object DataView]"||Hg&&pe(new Hg)!="[object Map]"||ml&&pe(ml.resolve())!="[object Promise]"||uf&&pe(new uf)!="[object Set]"||nl&&pe(new nl)!="[object WeakMap]")&&(pe=function(i){var r=me(i);if(i=(i=r=="[object Object]"?i.constructor:void 0)?ne(i):"")switch(i){case bA:return"[object DataView]";case cA:return"[object Map]";case dA:return"[object Promise]";case eA:return"[object Set]";case fA:return"[object WeakMap]"}return r});var Mf=pe,gA=Object.prototype.hasOwnProperty,ku=function(i){var r=i.length,o=new i.constructor(r);return r&&typeof i[0]=="string"&&gA.call(i,"index")&&(o.index=i.index,o.input=i.input),o},ji=$b.Uint8Array,ol=function(i){var r=new i.constructor(i.byteLength);return new ji(r).set(new ji(i)),r},hA=/\w*$/,ir=lc?lc.prototype:void 0,jr=ir?ir.valueOf:void 0,Bn=function(i,r){return r=r?ol(i.buffer):i.buffer,new i.constructor(r,i.byteOffset,i.length)},pu=function(i,r,o){var u=i.constructor;switch(r){case"[object ArrayBuffer]":return ol(i);case"[object Boolean]":case"[object Date]":return new u(+i);case"[object DataView]":return r=o?ol(i.buffer):i.buffer,new i.constructor(r,i.byteOffset,i.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Bn(i,o);case"[object Map]":return new u;case"[object Number]":case"[object String]":return new u(i);case"[object RegExp]":return(r=new i.constructor(i.source,hA.exec(i))).lastIndex=i.lastIndex,r;case"[object Set]":return new u;case"[object Symbol]":return jr?Object(jr.call(i)):{}}},kr=Object.create,iA=function(){function i(){}return function(r){return Gb(r)?kr?kr(r):(i.prototype=r,r=new i,i.prototype=void 0,r):{}}}(),Om=function(i){return typeof i.constructor!="function"||il(i)?{}:iA(kl(i))},jA=function(i){return Hc(i)&&Mf(i)=="[object Map]"},lr=vf&&vf.isMap,ru=lr?ii(lr):jA,kA=function(i){return Hc(i)&&Mf(i)=="[object Set]"},mr=vf&&vf.isSet,qu=mr?ii(mr):kA,Oa={};Oa["[object Arguments]"]=Oa["[object Array]"]=Oa["[object ArrayBuffer]"]=Oa["[object DataView]"]=Oa["[object Boolean]"]=Oa["[object Date]"]=Oa["[object Float32Array]"]=Oa["[object Float64Array]"]=Oa["[object Int8Array]"]=Oa["[object Int16Array]"]=Oa["[object Int32Array]"]=Oa["[object Map]"]=Oa["[object Number]"]=Oa["[object Object]"]=Oa["[object RegExp]"]=Oa["[object Set]"]=Oa["[object String]"]=Oa["[object Symbol]"]=Oa["[object Uint8Array]"]=Oa["[object Uint8ClampedArray]"]=Oa["[object Uint16Array]"]=Oa["[object Uint32Array]"]=!0,Oa["[object Error]"]=Oa["[object Function]"]=Oa["[object WeakMap]"]=!1;var Ke=function(i){return qa(i)=="symbol"||Hc(i)&&me(i)=="[object Symbol]"},lA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mA=/^\w*$/,pl=function(i,r){if(ub(i))return!1;var o=qa(i);return!(o!="number"&&o!="symbol"&&o!="boolean"&&i!=null&&!Ke(i))||mA.test(i)||!lA.test(i)||r!=null&&i in Object(r)};Ri.Cache=Zg;var nA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oA=/\\(\\)?/g,pA=function(i){var r=(i=Ri(i,function(o){return r.size===500&&r.clear(),o})).cache;return i}(function(i){var r=[];return i.charCodeAt(0)===46&&r.push(""),i.replace(nA,function(o,u,h,E){r.push(h?E.replace(oA,"$1"):u||o)}),r}),nr=lc?lc.prototype:void 0,Sm=nr?nr.toString:void 0,ki=function(i,r){return ub(i)?i:pl(i,r)?[i]:pA(i==null?"":Rm(i))},Jg=function(i){if(typeof i=="string"||Ke(i))return i;var r=i+"";return r=="0"&&1/i==-1/0?"-0":r},li=function(i,r){for(var o=0,u=(r=ki(r,i)).length;i!=null&&o<u;)i=i[Jg(r[o++])];return o&&o==u?i:void 0},rA=function(i,r){if(!(2>(r=ki(r,i)).length)){var o=r,u=0,h=-1,E=-1,v=o.length;for(0>u&&(u=-u>v?0:v+u),0>(h=h>v?v:h)&&(h+=v),v=u>h?0:h-u>>>0,u>>>=0,h=Array(v);++E<v;)h[E]=o[E+u];i=li(i,h)}return(o=i==null)||(o=r==null?0:r.length,o=delete i[Jg(o?r[o-1]:void 0)]),o},or=Function.prototype.toString,sA=Object.prototype.hasOwnProperty,tA=or.call(Object),Cn=function(i){return!(!Hc(i)||me(i)!="[object Object]")&&((i=kl(i))===null||typeof(i=sA.call(i,"constructor")&&i.constructor)=="function"&&i instanceof i&&or.call(i)==tA)},uA=function(i){return Cn(i)?void 0:i},pr=lc?lc.isConcatSpreadable:void 0,uu=function(i){return ub(i)||Vf(i)||!!(pr&&i&&i[pr])},vA=function(i){return i!=null&&i.length?Si(i):[]},wA=function(i,r,o){switch(o.length){case 0:return i.call(r);case 1:return i.call(r,o[0]);case 2:return i.call(r,o[0],o[1]);case 3:return i.call(r,o[0],o[1],o[2])}return i.apply(r,o)},qr=Math.max,rr=function(i,r,o){return r=qr(r===void 0?i.length-1:r,0),function(){for(var u=arguments,h=-1,E=qr(u.length-r,0),v=Array(E);++h<E;)v[h]=u[r+h];for(h=-1,E=Array(r+1);++h<r;)E[h]=u[h];return E[r]=o(v),wA(i,this,E)}},xA=function(i){return function(){return i}},mi=function(i){return i},yA=Date.now,sr=function(i){var r=0,o=0;return function(){var u=yA(),h=16-(u-o);if(o=u,0<h){if(800<=++r)return arguments[0]}else r=0;return i.apply(void 0,arguments)}}(hi?function(i,r){return hi(i,"toString",{configurable:!0,enumerable:!1,value:xA(r),writable:!0})}:mi),ql=function(i){return sr(rr(i,void 0,vA),i+"")}(function(i,r){var o={};if(i==null)return o;var u=!1;r=Je(r,function(E){return E=ki(E,i),u||(u=1<E.length),E}),Ue(i,Pm(i),o),u&&(o=He(o,7,uA));for(var h=r.length;h--;)rA(o,r[h]);return o}),zA=function(i,r,o,u){for(var h=-1,E=i==null?0:i.length;++h<E;){var v=i[h];r(u,v,o(v),i)}return u},An=function(i,r,o){for(var u=-1,h=Object(i),E=(o=o(i)).length;E--;){var v=o[++u];if(r(h[v],v,h)===!1)break}return i},tr=function(i,r){return i&&An(i,r,Wd)},rl=function(i,r){return function(o,u){if(o==null)return o;if(!ae(o))return i(o,u);for(var h=o.length,E=-1,v=Object(o);++E<h&&u(v[E],E,v)!==!1;);return o}}(tr),AA=function(i,r,o,u){return rl(i,function(h,E,v){r(u,h,o(h),v)}),u},ur=function(i,r){for(var o=-1,u=i==null?0:i.length;++o<u;)if(r(i[o],o,i))return!0;return!1},Tm=function(i,r,o,u,h,E){var v=1&o,O=i.length,C=r.length;if(O!=C&&!(v&&C>O))return!1;C=E.get(i);var k=E.get(r);if(C&&k)return C==r&&k==i;C=-1,k=!0;var j=2&o?new Lf:void 0;for(E.set(i,r),E.set(r,i);++C<O;){var K=i[C],$=r[C];if(u)var _e=v?u($,K,C,r,i,E):u(K,$,C,i,r,E);if(_e!==void 0){if(_e)continue;k=!1;break}if(j){if(!ur(r,function(na,_c){if(!j.has(_c)&&(K===na||h(K,na,o,u,E)))return j.push(_c)})){k=!1;break}}else if(K!==$&&!h(K,$,o,u,E)){k=!1;break}}return E.delete(i),E.delete(r),k},BA=function(i){var r=-1,o=Array(i.size);return i.forEach(function(u,h){o[++r]=[h,u]}),o},vr=lc?lc.prototype:void 0,sl=vr?vr.valueOf:void 0,vu=function(i,r,o,u,h,E,v){switch(o){case"[object DataView]":if(i.byteLength!=r.byteLength||i.byteOffset!=r.byteOffset)break;i=i.buffer,r=r.buffer;case"[object ArrayBuffer]":if(i.byteLength!=r.byteLength||!E(new ji(i),new ji(r)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Gg(+i,+r);case"[object Error]":return i.name==r.name&&i.message==r.message;case"[object RegExp]":case"[object String]":return i==r+"";case"[object Map]":var O=BA;case"[object Set]":if(O||(O=el),i.size!=r.size&&!(1&u))break;return(o=v.get(i))?o==r:(u|=2,v.set(i,r),r=Tm(O(i),O(r),u,h,E,v),v.delete(i),r);case"[object Symbol]":if(sl)return sl.call(i)==sl.call(r)}return!1},wu=Object.prototype.hasOwnProperty,Um=Object.prototype.hasOwnProperty,CA=function(i,r,o,u){var h=o.length,E=h;if(i==null)return!E;for(i=Object(i);h--;){var v=o[h];if(v[2]?v[1]!==i[v[0]]:!(v[0]in i))return!1}for(;++h<E;){var O=(v=o[h])[0],C=i[O],k=v[1];if(v[2]){if(C===void 0&&!(O in i))return!1}else{var j;if(v=new Ie,j===void 0?!Le(k,C,3,u,v):!j)return!1}}return!0},DA=function(i){for(var r=Wd(i),o=r.length;o--;){var u=r[o],h=i[u];r[o]=[u,h,h==h&&!Gb(h)]}return r},wr=function(i,r){return function(o){return o!=null&&o[i]===r&&(r!==void 0||i in Object(o))}},EA=function(i){var r=DA(i);return r.length==1&&r[0][2]?wr(r[0][0],r[0][1]):function(o){return o===i||CA(o,i,r)}},FA=function(i,r){return pl(i)&&r==r&&!Gb(r)?wr(Jg(i),r):function(o){var u=o==null?void 0:li(o,i);if((u=u===void 0?void 0:u)===void 0&&u===r){if(u=o!=null){for(var h=-1,E=(u=ki(u=i,o)).length,v=!1;++h<E;){var O=Jg(u[h]);if(!(v=o!=null&&o!=null&&O in Object(o)))break;o=o[O]}v||++h!=E?u=v:u=!!(E=o==null?0:o.length)&&hl(E)&&gl(O,E)&&(ub(o)||Vf(o))}O=u}else O=Le(r,u,3);return O}},GA=function(i){return function(r){return r==null?void 0:r[i]}},HA=function(i){return function(r){return li(r,i)}},wf=function(i){return typeof i=="function"?i:i==null?mi:qa(i)=="object"?ub(i)?FA(i[0],i[1]):EA(i):pl(i)?GA(Jg(i)):HA(i)},tl=function(i,r){return function(o,u){var h={};return(ub(o)?zA:AA)(o,i,wf(u),h)}}(function(i,r,o){Ig(i,o,r)}),md=function(i,r){var o={};return r=wf(r),tr(i,function(u,h,E){Ig(o,h,r(u,h,E))}),o};ea({target:"String",proto:!0,forced:la(function(){var i="".sub('"');return i!==i.toLowerCase()||3<i.split('"').length})},{sub:function(){return"<sub>"+String(Eb(this))+"</sub>"}});var P=Pa,mc=null;try{mc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(i){}Pa.prototype.__isLong__,Object.defineProperty(Pa.prototype,"__isLong__",{value:!0}),Pa.isLong=Hb;var Wm={},Vm={};Pa.fromInt=Xd,Pa.fromNumber=ec,Pa.fromBits=Qa;var ah=Math.pow;Pa.fromString=Vi,Pa.fromValue=vc;var Me=4294967296,Xm=Me*Me,Zm=Xm/2,xr=Xd(16777216),fc=Xd(0);Pa.ZERO=fc;var Yd=Xd(0,!0);Pa.UZERO=Yd;var xf=Xd(1);Pa.ONE=xf;var yr=Xd(1,!0);Pa.UONE=yr;var ul=Xd(-1);Pa.NEG_ONE=ul;var $m=Qa(-1,2147483647,!1);Pa.MAX_VALUE=$m;var Ym=Qa(-1,-1,!0);Pa.MAX_UNSIGNED_VALUE=Ym;var Ib=Qa(0,-2147483648,!1);Pa.MIN_VALUE=Ib;var V=Pa.prototype;V.toInt=function(){return this.unsigned?this.low>>>0:this.low},V.toNumber=function(){return this.unsigned?(this.high>>>0)*Me+(this.low>>>0):this.high*Me+(this.low>>>0)},V.toString=function(i){if(2>(i=i||10)||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Ib)){var r=ec(i),o=this.div(r);return r=o.mul(r).sub(this),o.toString(i)+r.toInt().toString(i)}return"-"+this.neg().toString(i)}o=ec(ah(i,6),this.unsigned),r=this;for(var u="";;){var h=r.div(o),E=(r.sub(h.mul(o)).toInt()>>>0).toString(i);if((r=h).isZero())return E+u;for(;6>E.length;)E="0"+E;u=""+E+u}},V.getHighBits=function(){return this.high},V.getHighBitsUnsigned=function(){return this.high>>>0},V.getLowBits=function(){return this.low},V.getLowBitsUnsigned=function(){return this.low>>>0},V.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ib)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,r=31;0<r&&(i&1<<r)==0;r--);return this.high!=0?r+33:r+1},V.isZero=function(){return this.high===0&&this.low===0},V.eqz=V.isZero,V.isNegative=function(){return!this.unsigned&&0>this.high},V.isPositive=function(){return this.unsigned||0<=this.high},V.isOdd=function(){return(1&this.low)==1},V.isEven=function(){return(1&this.low)==0},V.equals=function(i){return Hb(i)||(i=vc(i)),(this.unsigned===i.unsigned||this.high>>>31!=1||i.high>>>31!=1)&&this.high===i.high&&this.low===i.low},V.eq=V.equals,V.notEquals=function(i){return!this.eq(i)},V.neq=V.notEquals,V.ne=V.notEquals,V.lessThan=function(i){return 0>this.comp(i)},V.lt=V.lessThan,V.lessThanOrEqual=function(i){return 0>=this.comp(i)},V.lte=V.lessThanOrEqual,V.le=V.lessThanOrEqual,V.greaterThan=function(i){return 0<this.comp(i)},V.gt=V.greaterThan,V.greaterThanOrEqual=function(i){return 0<=this.comp(i)},V.gte=V.greaterThanOrEqual,V.ge=V.greaterThanOrEqual,V.compare=function(i){if(Hb(i)||(i=vc(i)),this.eq(i))return 0;var r=this.isNegative(),o=i.isNegative();return r&&!o?-1:!r&&o?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1},V.comp=V.compare,V.negate=function(){return!this.unsigned&&this.eq(Ib)?Ib:this.not().add(xf)},V.neg=V.negate,V.add=function(i){Hb(i)||(i=vc(i));var r=this.high>>>16,o=65535&this.high,u=this.low>>>16,h=i.high>>>16,E=65535&i.high,v=i.low>>>16;return u=(v=((i=(65535&this.low)+(65535&i.low))>>>16)+(u+v))>>>16,Qa((65535&v)<<16|65535&i,(r=((u+=o+E)>>>16)+(r+h)&65535)<<16|65535&u,this.unsigned)},V.subtract=function(i){return Hb(i)||(i=vc(i)),this.add(i.neg())},V.sub=V.subtract,V.multiply=function(i){if(this.isZero())return fc;if(Hb(i)||(i=vc(i)),mc){var r=mc.mul(this.low,this.high,i.low,i.high);return Qa(r,mc.get_high(),this.unsigned)}if(i.isZero())return fc;if(this.eq(Ib))return i.isOdd()?Ib:fc;if(i.eq(Ib))return this.isOdd()?Ib:fc;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(xr)&&i.lt(xr))return ec(this.toNumber()*i.toNumber(),this.unsigned);r=this.high>>>16;var o=65535&this.high,u=this.low>>>16,h=65535&this.low,E=i.high>>>16,v=65535&i.high,O=i.low>>>16,C=h*(i=65535&i.low),k=(C>>>16)+u*i,j=k>>>16;j+=(k=(65535&k)+h*O)>>>16;var K=(j+=o*i)>>>16;return Qa((65535&k)<<16|65535&C,(K=(K+=(j=(65535&j)+u*O)>>>16)+((j=(65535&j)+h*v)>>>16)+(r*i+o*O+u*v+h*E)&65535)<<16|65535&j,this.unsigned)},V.mul=V.multiply,V.divide=function(i){if(Hb(i)||(i=vc(i)),i.isZero())throw Error("division by zero");if(mc)return this.unsigned||this.high!==-2147483648||i.low!==-1||i.high!==-1?Qa(i=(this.unsigned?mc.div_u:mc.div_s)(this.low,this.high,i.low,i.high),mc.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Yd:fc;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return Yd;if(i.gt(this.shru(1)))return yr;var r=Yd}else{if(this.eq(Ib)){if(i.eq(xf)||i.eq(ul))return Ib;if(i.eq(Ib))return xf;var o=this.shr(1).div(i).shl(1);if(o.eq(fc))return i.isNegative()?xf:ul;var u=this.sub(i.mul(o));return o.add(u.div(i))}if(i.eq(Ib))return this.unsigned?Yd:fc;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();r=fc}for(u=this;u.gte(i);){o=Math.max(1,Math.floor(u.toNumber()/i.toNumber()));var h=Math.ceil(Math.log(o)/Math.LN2);h=48>=h?1:ah(2,h-48);for(var E=ec(o),v=E.mul(i);v.isNegative()||v.gt(u);)v=(E=ec(o-=h,this.unsigned)).mul(i);E.isZero()&&(E=xf),r=r.add(E),u=u.sub(v)}return r},V.div=V.divide,V.modulo=function(i){return Hb(i)||(i=vc(i)),mc?Qa(i=(this.unsigned?mc.rem_u:mc.rem_s)(this.low,this.high,i.low,i.high),mc.get_high(),this.unsigned):this.sub(this.div(i).mul(i))},V.mod=V.modulo,V.rem=V.modulo,V.not=function(){return Qa(~this.low,~this.high,this.unsigned)},V.and=function(i){return Hb(i)||(i=vc(i)),Qa(this.low&i.low,this.high&i.high,this.unsigned)},V.or=function(i){return Hb(i)||(i=vc(i)),Qa(this.low|i.low,this.high|i.high,this.unsigned)},V.xor=function(i){return Hb(i)||(i=vc(i)),Qa(this.low^i.low,this.high^i.high,this.unsigned)},V.shiftLeft=function(i){return Hb(i)&&(i=i.toInt()),(i&=63)==0?this:32>i?Qa(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):Qa(0,this.low<<i-32,this.unsigned)},V.shl=V.shiftLeft,V.shiftRight=function(i){return Hb(i)&&(i=i.toInt()),(i&=63)==0?this:32>i?Qa(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):Qa(this.high>>i-32,0<=this.high?0:-1,this.unsigned)},V.shr=V.shiftRight,V.shiftRightUnsigned=function(i){if(Hb(i)&&(i=i.toInt()),(i&=63)===0)return this;var r=this.high;return 32>i?Qa(this.low>>>i|r<<32-i,r>>>i,this.unsigned):Qa(i===32?r:r>>>i-32,0,this.unsigned)},V.shru=V.shiftRightUnsigned,V.shr_u=V.shiftRightUnsigned,V.toSigned=function(){return this.unsigned?Qa(this.low,this.high,!1):this},V.toUnsigned=function(){return this.unsigned?this:Qa(this.low,this.high,!0)},V.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()},V.toBytesLE=function(){var i=this.high,r=this.low;return[255&r,r>>>8&255,r>>>16&255,r>>>24,255&i,i>>>8&255,i>>>16&255,i>>>24]},V.toBytesBE=function(){var i=this.high,r=this.low;return[i>>>24,i>>>16&255,i>>>8&255,255&i,r>>>24,r>>>16&255,r>>>8&255,255&r]},Pa.fromBytes=function(i,r,o){return o?Pa.fromBytesLE(i,r):Pa.fromBytesBE(i,r)},Pa.fromBytesLE=function(i,r){return new Pa(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,r)},Pa.fromBytesBE=function(i,r){return new Pa(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],r)};var Wi=function(i,r){return(Wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,u){o.__proto__=u}||function(o,u){for(var h in u)u.hasOwnProperty(h)&&(o[h]=u[h])})(i,r)},vl=!1,gc={Promise:void 0,set useDeprecatedSynchronousErrorHandling(i){i?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):vl&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),vl=i},get useDeprecatedSynchronousErrorHandling(){return vl}},ni={closed:!0,next:function(i){},error:function(i){if(gc.useDeprecatedSynchronousErrorHandling)throw i;Oe(i)},complete:function(){}},hc=Array.isArray||function(i){return i&&typeof i.length=="number"},Pf=function(){function i(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(o,u){return u+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return i.prototype=Object.create(Error.prototype),i}(),nb=function(){function i(r){this.closed=!1,this._subscriptions=this._parentOrParents=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}return i.prototype.unsubscribe=function(){if(!this.closed){var r=this._parentOrParents,o=this._ctorUnsubscribe,u=this._unsubscribe,h=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,r instanceof i)r.remove(this);else if(r!==null)for(var E=0;E<r.length;++E)r[E].remove(this);if(Ne(u)){o&&(this._unsubscribe=void 0);try{u.call(this)}catch(O){var v=O instanceof Pf?an(O.errors):[O]}}if(hc(h)){for(E=-1,r=h.length;++E<r;)if(Xi(o=h[E]))try{o.unsubscribe()}catch(O){v=v||[],O instanceof Pf?v=v.concat(an(O.errors)):v.push(O)}}if(v)throw new Pf(v)}},i.prototype.add=function(r){var o=r;if(!r)return i.EMPTY;switch(qa(r)){case"function":o=new i(r);case"object":if(o===this||o.closed||typeof o.unsubscribe!="function")return o;if(this.closed)return o.unsubscribe(),o;o instanceof i||(r=o,(o=new i)._subscriptions=[r]);break;default:throw Error("unrecognized teardown "+r+" added to Subscription.")}if((r=o._parentOrParents)===null)o._parentOrParents=this;else if(r instanceof i){if(r===this)return o;o._parentOrParents=[r,this]}else{if(r.indexOf(this)!==-1)return o;r.push(this)}return(r=this._subscriptions)===null?this._subscriptions=[o]:r.push(o),o},i.prototype.remove=function(r){var o=this._subscriptions;o&&(r=o.indexOf(r))!==-1&&o.splice(r,1)},i.EMPTY=function(r){return r.closed=!0,r}(new i),i}(),oi=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),za=function(i){function r(o,u,h){var E=i.call(this)||this;switch(E.syncErrorValue=null,E.syncErrorThrown=!1,E.syncErrorThrowable=!1,E.isStopped=!1,arguments.length){case 0:E.destination=ni;break;case 1:if(!o){E.destination=ni;break}if(qa(o)==="object"){o instanceof r?(E.syncErrorThrowable=o.syncErrorThrowable,E.destination=o,o.add(E)):(E.syncErrorThrowable=!0,E.destination=new zr(E,o));break}default:E.syncErrorThrowable=!0,E.destination=new zr(E,o,u,h)}return E}return ha(r,i),r.prototype[oi]=function(){return this},r.create=function(o,u,h){return(o=new r(o,u,h)).syncErrorThrowable=!1,o},r.prototype.next=function(o){this.isStopped||this._next(o)},r.prototype.error=function(o){this.isStopped||(this.isStopped=!0,this._error(o))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this))},r.prototype._next=function(o){this.destination.next(o)},r.prototype._error=function(o){this.destination.error(o),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var o=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=o,this},r}(nb),zr=function(i){function r(o,u,h,E){var v=i.call(this)||this;if(v._parentSubscriber=o,o=v,Ne(u))var O=u;else u&&(O=u.next,h=u.error,E=u.complete,u!==ni&&(Ne((o=Object.create(u)).unsubscribe)&&v.add(o.unsubscribe.bind(o)),o.unsubscribe=v.unsubscribe.bind(v)));return v._context=o,v._next=O,v._error=h,v._complete=E,v}return ha(r,i),r.prototype.next=function(o){if(!this.isStopped&&this._next){var u=this._parentSubscriber;gc.useDeprecatedSynchronousErrorHandling&&u.syncErrorThrowable?this.__tryOrSetError(u,this._next,o)&&this.unsubscribe():this.__tryOrUnsub(this._next,o)}},r.prototype.error=function(o){if(!this.isStopped){var u=this._parentSubscriber,h=gc.useDeprecatedSynchronousErrorHandling;if(this._error)h&&u.syncErrorThrowable?this.__tryOrSetError(u,this._error,o):this.__tryOrUnsub(this._error,o),this.unsubscribe();else if(u.syncErrorThrowable)h?(u.syncErrorValue=o,u.syncErrorThrown=!0):Oe(o),this.unsubscribe();else{if(this.unsubscribe(),h)throw o;Oe(o)}}},r.prototype.complete=function(){var o=this;if(!this.isStopped){var u=this._parentSubscriber;if(this._complete){var h=function(){return o._complete.call(o._context)};gc.useDeprecatedSynchronousErrorHandling&&u.syncErrorThrowable?this.__tryOrSetError(u,h):this.__tryOrUnsub(h)}this.unsubscribe()}},r.prototype.__tryOrUnsub=function(o,u){try{o.call(this._context,u)}catch(h){if(this.unsubscribe(),gc.useDeprecatedSynchronousErrorHandling)throw h;Oe(h)}},r.prototype.__tryOrSetError=function(o,u,h){if(!gc.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{u.call(this._context,h)}catch(E){return gc.useDeprecatedSynchronousErrorHandling?(o.syncErrorValue=E,o.syncErrorThrown=!0):Oe(E),!0}return!1},r.prototype._unsubscribe=function(){var o=this._parentSubscriber;this._parentSubscriber=this._context=null,o.unsubscribe()},r}(za),Pe=typeof Symbol=="function"&&Symbol.observable||"@@observable",ua=function(){function i(r){this._isScalar=!1,r&&(this._subscribe=r)}return i.prototype.lift=function(r){var o=new i;return o.source=this,o.operator=r,o},i.prototype.subscribe=function(r,o,u){var h=this.operator;t:{if(r){if(r instanceof za)break t;if(r[oi]){r=r[oi]();break t}}r=r||o||u?new za(r,o,u):new za(ni)}if(h?r.add(h.call(r,this.source)):r.add(this.source||gc.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),gc.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},i.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(o){gc.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=o),Yi(r)?r.error(o):console.warn(o)}},i.prototype.forEach=function(r,o){var u=this;return new(o=cn(o))(function(h,E){var v=u.subscribe(function(O){try{r(O)}catch(C){E(C),v&&v.unsubscribe()}},E,h)})},i.prototype._subscribe=function(r){var o=this.source;return o&&o.subscribe(r)},i.prototype[Pe]=function(){return this},i.prototype.pipe=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return r.length===0?this:bn(r)(this)},i.prototype.toPromise=function(r){var o=this;return new(r=cn(r))(function(u,h){var E;o.subscribe(function(v){return E=v},function(v){return h(v)},function(){return u(E)})})},i.create=function(r){return new i(r)},i}(),Ld=function(){function i(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return i.prototype=Object.create(Error.prototype),i}(),Ar=function(i){function r(o,u){var h=i.call(this)||this;return h.subject=o,h.subscriber=u,h.closed=!1,h}return ha(r,i),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var o=this.subject,u=o.observers;this.subject=null,!u||u.length===0||o.isStopped||o.closed||(o=u.indexOf(this.subscriber))!==-1&&u.splice(o,1)}},r}(nb),Br=function(i){function r(o){var u=i.call(this,o)||this;return u.destination=o,u}return ha(r,i),r}(za),rb=function(i){function r(){var o=i.call(this)||this;return o.observers=[],o.closed=!1,o.isStopped=!1,o.hasError=!1,o.thrownError=null,o}return ha(r,i),r.prototype[oi]=function(){return new Br(this)},r.prototype.lift=function(o){var u=new Cr(this,this);return u.operator=o,u},r.prototype.next=function(o){if(this.closed)throw new Ld;if(!this.isStopped){var u=this.observers,h=u.length;u=u.slice();for(var E=0;E<h;E++)u[E].next(o)}},r.prototype.error=function(o){if(this.closed)throw new Ld;this.hasError=!0,this.thrownError=o,this.isStopped=!0;var u=this.observers,h=u.length;u=u.slice();for(var E=0;E<h;E++)u[E].error(o);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new Ld;this.isStopped=!0;var o=this.observers,u=o.length;o=o.slice();for(var h=0;h<u;h++)o[h].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},r.prototype._trySubscribe=function(o){if(this.closed)throw new Ld;return i.prototype._trySubscribe.call(this,o)},r.prototype._subscribe=function(o){if(this.closed)throw new Ld;return this.hasError?(o.error(this.thrownError),nb.EMPTY):this.isStopped?(o.complete(),nb.EMPTY):(this.observers.push(o),new Ar(this,o))},r.prototype.asObservable=function(){var o=new ua;return o.source=this,o},r.create=function(o,u){return new Cr(o,u)},r}(ua),Cr=function(i){function r(o,u){var h=i.call(this)||this;return h.destination=o,h.source=u,h}return ha(r,i),r.prototype.next=function(o){var u=this.destination;u&&u.next&&u.next(o)},r.prototype.error=function(o){var u=this.destination;u&&u.error&&this.destination.error(o)},r.prototype.complete=function(){var o=this.destination;o&&o.complete&&this.destination.complete()},r.prototype._subscribe=function(o){return this.source?this.source.subscribe(o):nb.EMPTY},r}(rb),xu=function(){function i(r){this.connectable=r}return i.prototype.call=function(r,o){var u=this.connectable;return u._refCount++,r=new IA(r,u),o=o.subscribe(r),r.closed||(r.connection=u.connect()),o},i}(),IA=function(i){function r(o,u){return(o=i.call(this,o)||this).connectable=u,o}return ha(r,i),r.prototype._unsubscribe=function(){var o=this.connectable;if(o){this.connectable=null;var u=o._refCount;0>=u?this.connection=null:(o._refCount=u-1,1<u?this.connection=null:(u=this.connection,o=o._connection,this.connection=null,!o||u&&o!==u||o.unsubscribe()))}else this.connection=null},r}(za),Dr=function(i){function r(o,u){var h=i.call(this)||this;return h.source=o,h.subjectFactory=u,h._refCount=0,h._isComplete=!1,h}return ha(r,i),r.prototype._subscribe=function(o){return this.getSubject().subscribe(o)},r.prototype.getSubject=function(){var o=this._subject;return o&&!o.isStopped||(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var o=this._connection;return o||(this._isComplete=!1,(o=this._connection=new nb).add(this.source.subscribe(new JA(this.getSubject(),this))),o.closed&&(this._connection=null,o=nb.EMPTY)),o},r.prototype.refCount=function(){return dn()(this)},r}(ua),lv=function(){var i=Dr.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:i._subscribe},_isComplete:{value:i._isComplete,writable:!0},getSubject:{value:i.getSubject},connect:{value:i.connect},refCount:{value:i.refCount}}}(),JA=function(i){function r(o,u){return(o=i.call(this,o)||this).connectable=u,o}return ha(r,i),r.prototype._error=function(o){this._unsubscribe(),i.prototype._error.call(this,o)},r.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),i.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var o=this.connectable;if(o){this.connectable=null;var u=o._connection;o._refCount=0,o._subject=null,o._connection=null,u&&u.unsubscribe()}},r}(Br);(function(i){function r(o,u){return(o=i.call(this,o)||this).connectable=u,o}ha(r,i),r.prototype._unsubscribe=function(){var o=this.connectable;if(o){this.connectable=null;var u=o._refCount;0>=u?this.connection=null:(o._refCount=u-1,1<u?this.connection=null:(u=this.connection,o=o._connection,this.connection=null,!o||u&&o!==u||o.unsubscribe()))}else this.connection=null}})(za),function(i){function r(o,u,h,E,v){return(o=i.call(this,o)||this).keySelector=u,o.elementSelector=h,o.durationSelector=E,o.subjectSelector=v,o.groups=null,o.attemptedToUnsubscribe=!1,o.count=0,o}ha(r,i),r.prototype._next=function(o){try{var u=this.keySelector(o)}catch(h){return void this.error(h)}this._group(o,u)},r.prototype._group=function(o,u){var h=this.groups;h||(h=this.groups=new Map);var E=h.get(u);if(this.elementSelector)try{var v=this.elementSelector(o)}catch(O){this.error(O)}else v=o;if(!E&&(E=this.subjectSelector?this.subjectSelector():new rb,h.set(u,E),o=new wl(u,E,this),this.destination.next(o),this.durationSelector)){o=void 0;try{o=this.durationSelector(new wl(u,E))}catch(O){return void this.error(O)}this.add(o.subscribe(new KA(u,E,this)))}E.closed||E.next(v)},r.prototype._error=function(o){var u=this.groups;u&&(u.forEach(function(h,E){h.error(o)}),u.clear()),this.destination.error(o)},r.prototype._complete=function(){var o=this.groups;o&&(o.forEach(function(u,h){u.complete()}),o.clear()),this.destination.complete()},r.prototype.removeGroup=function(o){this.groups.delete(o)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&i.prototype.unsubscribe.call(this))}}(za);var KA=function(i){function r(o,u,h){var E=i.call(this,u)||this;return E.key=o,E.group=u,E.parent=h,E}return ha(r,i),r.prototype._next=function(o){this.complete()},r.prototype._unsubscribe=function(){var o=this.parent,u=this.key;this.key=this.parent=null,o&&o.removeGroup(u)},r}(za),wl=function(i){function r(o,u,h){var E=i.call(this)||this;return E.key=o,E.groupSubject=u,E.refCountSubscription=h,E}return ha(r,i),r.prototype._subscribe=function(o){var u=new nb,h=this.refCountSubscription,E=this.groupSubject;return h&&!h.closed&&u.add(new LA(h)),u.add(E.subscribe(o)),u},r}(ua),LA=function(i){function r(o){var u=i.call(this)||this;return u.parent=o,o.count++,u}return ha(r,i),r.prototype.unsubscribe=function(){var o=this.parent;o.closed||this.closed||(i.prototype.unsubscribe.call(this),--o.count,o.count===0&&o.attemptedToUnsubscribe&&o.unsubscribe())},r}(nb),MA=function(i){function r(o){var u=i.call(this)||this;return u._value=o,u}return ha(r,i),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(o){var u=i.prototype._subscribe.call(this,o);return u&&!u.closed&&o.next(this._value),u},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ld;return this._value},r.prototype.next=function(o){i.prototype.next.call(this,this._value=o)},r}(rb),Kg=function(i){function r(o,u){var h=i.call(this,o,u)||this;return h.scheduler=o,h.work=u,h.pending=!1,h}return ha(r,i),r.prototype.schedule=function(o,u){if(u===void 0&&(u=0),this.closed)return this;this.state=o,o=this.id;var h=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(h,o,u)),this.pending=!0,this.delay=u,this.id=this.id||this.requestAsyncId(h,this.id,u),this},r.prototype.requestAsyncId=function(o,u,h){return h===void 0&&(h=0),setInterval(o.flush.bind(o,this),h)},r.prototype.recycleAsyncId=function(o,u,h){if(h===void 0&&(h=0),h!==null&&this.delay===h&&this.pending===!1)return u;clearInterval(u)},r.prototype.execute=function(o,u){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(o=this._execute(o,u))?o:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},r.prototype._execute=function(o,u){u=!1;var h=void 0;try{this.work(o)}catch(E){u=!0,h=!!E&&E||Error(E)}if(u)return this.unsubscribe(),h},r.prototype._unsubscribe=function(){var o=this.id,u=this.scheduler,h=u.actions,E=h.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,E!==-1&&h.splice(E,1),o!=null&&(this.id=this.recycleAsyncId(u,o,null)),this.delay=null},r}(function(i){function r(o,u){return i.call(this)||this}return ha(r,i),r.prototype.schedule=function(o,u){return this},r}(nb)),NA=function(i){function r(o,u){var h=i.call(this,o,u)||this;return h.scheduler=o,h.work=u,h}return ha(r,i),r.prototype.schedule=function(o,u){return u===void 0&&(u=0),0<u?i.prototype.schedule.call(this,o,u):(this.delay=u,this.state=o,this.scheduler.flush(this),this)},r.prototype.execute=function(o,u){return 0<u||this.closed?i.prototype.execute.call(this,o,u):this._execute(o,u)},r.prototype.requestAsyncId=function(o,u,h){return h===void 0&&(h=0),h!==null&&0<h||h===null&&0<this.delay?i.prototype.requestAsyncId.call(this,o,u,h):o.flush(this)},r}(Kg),xl=function(){function i(r,o){o===void 0&&(o=i.now),this.SchedulerAction=r,this.now=o}return i.prototype.schedule=function(r,o,u){return o===void 0&&(o=0),new this.SchedulerAction(this,r).schedule(u,o)},i.now=function(){return Date.now()},i}(),Lg=function(i){function r(o,u){u===void 0&&(u=xl.now);var h=i.call(this,o,function(){return r.delegate&&r.delegate!==h?r.delegate.now():u()})||this;return h.actions=[],h.active=!1,h.scheduled=void 0,h}return ha(r,i),r.prototype.schedule=function(o,u,h){return u===void 0&&(u=0),r.delegate&&r.delegate!==this?r.delegate.schedule(o,u,h):i.prototype.schedule.call(this,o,u,h)},r.prototype.flush=function(o){var u=this.actions;if(this.active)u.push(o);else{var h;this.active=!0;do if(h=o.execute(o.state,o.delay))break;while(o=u.shift());if(this.active=!1,h){for(;o=u.shift();)o.unsubscribe();throw h}}},r}(xl),Mg=new(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r}(Lg))(NA),Sb=new ua(function(i){return i.complete()}),en=function(i){return function(r){for(var o=0,u=i.length;o<u&&!r.closed;o++)r.next(i[o]);r.complete()}},yl;(function(i){i.NEXT="N",i.ERROR="E",i.COMPLETE="C"})(yl||(yl={}));var yf=function(){function i(r,o,u){this.kind=r,this.value=o,this.error=u,this.hasValue=r==="N"}return i.prototype.observe=function(r){switch(this.kind){case"N":return r.next&&r.next(this.value);case"E":return r.error&&r.error(this.error);case"C":return r.complete&&r.complete()}},i.prototype.do=function(r,o,u){switch(this.kind){case"N":return r&&r(this.value);case"E":return o&&o(this.error);case"C":return u&&u()}},i.prototype.accept=function(r,o,u){return r&&typeof r.next=="function"?this.observe(r):this.do(r,o,u)},i.prototype.toObservable=function(){switch(this.kind){case"N":return ob(this.value);case"E":return ra(this.error);case"C":return Qf()}throw Error("unexpected notification kind value")},i.createNext=function(r){return r!==void 0?new i("N",r):i.undefinedValueNotification},i.createError=function(r){return new i("E",void 0,r)},i.createComplete=function(){return i.completeNotification},i.completeNotification=new i("C"),i.undefinedValueNotification=new i("N",void 0),i}(),Bu=function(){function i(r,o){o===void 0&&(o=0),this.scheduler=r,this.delay=o}return i.prototype.call=function(r,o){return o.subscribe(new Er(r,this.scheduler,this.delay))},i}(),Er=function(i){function r(o,u,h){return h===void 0&&(h=0),(o=i.call(this,o)||this).scheduler=u,o.delay=h,o}return ha(r,i),r.dispatch=function(o){o.notification.observe(o.destination),this.unsubscribe()},r.prototype.scheduleMessage=function(o){this.destination.add(this.scheduler.schedule(r.dispatch,this.delay,new OA(o,this.destination)))},r.prototype._next=function(o){this.scheduleMessage(yf.createNext(o))},r.prototype._error=function(o){this.scheduleMessage(yf.createError(o)),this.unsubscribe()},r.prototype._complete=function(){this.scheduleMessage(yf.createComplete()),this.unsubscribe()},r}(za),OA=function(i,r){this.notification=i,this.destination=r},Te=function(i){function r(o,u,h){o===void 0&&(o=Number.POSITIVE_INFINITY),u===void 0&&(u=Number.POSITIVE_INFINITY);var E=i.call(this)||this;return E.scheduler=h,E._events=[],E._infiniteTimeWindow=!1,E._bufferSize=1>o?1:o,E._windowTime=1>u?1:u,u===Number.POSITIVE_INFINITY?(E._infiniteTimeWindow=!0,E.next=E.nextInfiniteTimeWindow):E.next=E.nextTimeWindow,E}return ha(r,i),r.prototype.nextInfiniteTimeWindow=function(o){if(!this.isStopped){var u=this._events;u.push(o),u.length>this._bufferSize&&u.shift()}i.prototype.next.call(this,o)},r.prototype.nextTimeWindow=function(o){this.isStopped||(this._events.push(new PA(this._getNow(),o)),this._trimBufferThenGetEvents()),i.prototype.next.call(this,o)},r.prototype._subscribe=function(o){var u=this._infiniteTimeWindow,h=u?this._events:this._trimBufferThenGetEvents(),E=this.scheduler,v=h.length;if(this.closed)throw new Ld;if(this.isStopped||this.hasError)var O=nb.EMPTY;else this.observers.push(o),O=new Ar(this,o);if(E&&o.add(o=new Er(o,E)),u)for(u=0;u<v&&!o.closed;u++)o.next(h[u]);else for(u=0;u<v&&!o.closed;u++)o.next(h[u].value);return this.hasError?o.error(this.thrownError):this.isStopped&&o.complete(),O},r.prototype._getNow=function(){return(this.scheduler||Mg).now()},r.prototype._trimBufferThenGetEvents=function(){for(var o=this._getNow(),u=this._bufferSize,h=this._windowTime,E=this._events,v=E.length,O=0;O<v&&!(o-E[O].time<h);)O++;return v>u&&(O=Math.max(O,v-u)),0<O&&E.splice(0,O),E},r}(rb),PA=function(i,r){this.time=i,this.value=r},Sf=function(i){function r(){var o=i!==null&&i.apply(this,arguments)||this;return o.value=null,o.hasNext=!1,o.hasCompleted=!1,o}return ha(r,i),r.prototype._subscribe=function(o){return this.hasError?(o.error(this.thrownError),nb.EMPTY):this.hasCompleted&&this.hasNext?(o.next(this.value),o.complete(),nb.EMPTY):i.prototype._subscribe.call(this,o)},r.prototype.next=function(o){this.hasCompleted||(this.value=o,this.hasNext=!0)},r.prototype.error=function(o){this.hasCompleted||i.prototype.error.call(this,o)},r.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&i.prototype.next.call(this,this.value),i.prototype.complete.call(this)},r}(rb),QA=1,RA=Promise.resolve(),aj={},Fr={setImmediate:function(i){var r=QA++;return aj[r]=!0,RA.then(function(){return fn(r)&&i()}),r},clearImmediate:function(i){fn(i)}},SA=function(i){function r(o,u){var h=i.call(this,o,u)||this;return h.scheduler=o,h.work=u,h}return ha(r,i),r.prototype.requestAsyncId=function(o,u,h){return h===void 0&&(h=0),h!==null&&0<h?i.prototype.requestAsyncId.call(this,o,u,h):(o.actions.push(this),o.scheduled||(o.scheduled=Fr.setImmediate(o.flush.bind(o,null))))},r.prototype.recycleAsyncId=function(o,u,h){if(h===void 0&&(h=0),h!==null&&0<h||h===null&&0<this.delay)return i.prototype.recycleAsyncId.call(this,o,u,h);o.actions.length===0&&(Fr.clearImmediate(u),o.scheduled=void 0)},r}(Kg),kj=new(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.flush=function(o){this.active=!0,this.scheduled=void 0;var u,h=this.actions,E=-1,v=h.length;o=o||h.shift();do if(u=o.execute(o.state,o.delay))break;while(++E<v&&(o=h.shift()));if(this.active=!1,u){for(;++E<v&&(o=h.shift());)o.unsubscribe();throw u}},r}(Lg))(SA),TA=kj,zl=new Lg(Kg),cd=zl,UA=function(i){function r(o,u){var h=i.call(this,o,u)||this;return h.scheduler=o,h.work=u,h}return ha(r,i),r.prototype.requestAsyncId=function(o,u,h){return h===void 0&&(h=0),h!==null&&0<h?i.prototype.requestAsyncId.call(this,o,u,h):(o.actions.push(this),o.scheduled||(o.scheduled=requestAnimationFrame(function(){return o.flush(null)})))},r.prototype.recycleAsyncId=function(o,u,h){if(h===void 0&&(h=0),h!==null&&0<h||h===null&&0<this.delay)return i.prototype.recycleAsyncId.call(this,o,u,h);o.actions.length===0&&(cancelAnimationFrame(u),o.scheduled=void 0)},r}(Kg),Gr=new(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.flush=function(o){this.active=!0,this.scheduled=void 0;var u,h=this.actions,E=-1,v=h.length;o=o||h.shift();do if(u=o.execute(o.state,o.delay))break;while(++E<v&&(o=h.shift()));if(this.active=!1,u){for(;++E<v&&(o=h.shift());)o.unsubscribe();throw u}},r}(Lg))(UA),VA=function(i){function r(o,u){o===void 0&&(o=Hr),u===void 0&&(u=Number.POSITIVE_INFINITY);var h=i.call(this,o,function(){return h.frame})||this;return h.maxFrames=u,h.frame=0,h.index=-1,h}return ha(r,i),r.prototype.flush=function(){for(var o,u,h=this.actions,E=this.maxFrames;(u=h[0])&&u.delay<=E&&(h.shift(),this.frame=u.delay,!(o=u.execute(u.state,u.delay))););if(o){for(;u=h.shift();)u.unsubscribe();throw o}},r.frameTimeFactor=10,r}(Lg),Hr=function(i){function r(o,u,h){h===void 0&&(h=o.index+=1);var E=i.call(this,o,u)||this;return E.scheduler=o,E.work=u,E.index=h,E.active=!0,E.index=o.index=h,E}return ha(r,i),r.prototype.schedule=function(o,u){if(u===void 0&&(u=0),!this.id)return i.prototype.schedule.call(this,o,u);this.active=!1;var h=new r(this.scheduler,this.work);return this.add(h),h.schedule(o,u)},r.prototype.requestAsyncId=function(o,u,h){return h===void 0&&(h=0),this.delay=o.frame+h,(o=o.actions).push(this),o.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(o,u,h){},r.prototype._execute=function(o,u){if(this.active===!0)return i.prototype._execute.call(this,o,u)},r.sortActions=function(o,u){return o.delay===u.delay?o.index===u.index?0:o.index>u.index?1:-1:o.delay>u.delay?1:-1},r}(Kg),Al=function(){function i(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return i.prototype=Object.create(Error.prototype),i}(),eh=function(){function i(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return i.prototype=Object.create(Error.prototype),i}(),Tb=function(){function i(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return i.prototype=Object.create(Error.prototype),i}(),Cu=function(){function i(r,o){this.project=r,this.thisArg=o}return i.prototype.call=function(r,o){return o.subscribe(new WA(r,this.project,this.thisArg))},i}(),WA=function(i){function r(o,u,h){return(o=i.call(this,o)||this).project=u,o.count=0,o.thisArg=h||o,o}return ha(r,i),r.prototype._next=function(o){try{var u=this.project.call(this.thisArg,o,this.count++)}catch(h){return void this.destination.error(h)}this.destination.next(u)},r}(za),Bl=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.notifyNext=function(o,u,h,E,v){this.destination.next(u)},r.prototype.notifyError=function(o,u){this.destination.error(o)},r.prototype.notifyComplete=function(o){this.destination.complete()},r}(za),Hu=function(i){function r(o,u,h){var E=i.call(this)||this;return E.parent=o,E.outerValue=u,E.outerIndex=h,E.index=0,E}return ha(r,i),r.prototype._next=function(o){this.parent.notifyNext(this.outerValue,o,this.outerIndex,this.index++,this)},r.prototype._error=function(o){this.parent.notifyError(o,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(za),XA=function(i){return function(r){return i.then(function(o){r.closed||(r.next(o),r.complete())},function(o){return r.error(o)}).then(null,Oe),r}},xd=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",YA=function(i){return function(r){for(var o=i[xd]();;){var u=void 0;try{u=o.next()}catch(h){return r.error(h),r}if(u.done){r.complete();break}if(r.next(u.value),r.closed)break}return typeof o.return=="function"&&r.add(function(){o.return&&o.return()}),r}},ZA=function(i){return function(r){var o=i[Pe]();if(typeof o.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return o.subscribe(r)}},mn=function(i){return i&&typeof i.length=="number"&&typeof i!="function"},Tf=function(i){if(i&&typeof i[Pe]=="function")return ZA(i);if(mn(i))return en(i);if(kn(i))return XA(i);if(i&&typeof i[xd]=="function")return YA(i);throw i=Xi(i)?"an invalid object":"'"+i+"'",new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Ir={},aB=function(){function i(r){this.resultSelector=r}return i.prototype.call=function(r,o){return o.subscribe(new $A(r,this.resultSelector))},i}(),$A=function(i){function r(o,u){return(o=i.call(this,o)||this).resultSelector=u,o.active=0,o.values=[],o.observables=[],o}return ha(r,i),r.prototype._next=function(o){this.values.push(Ir),this.observables.push(o)},r.prototype._complete=function(){var o=this.observables,u=o.length;if(u===0)this.destination.complete();else{this.toRespond=this.active=u;for(var h=0;h<u;h++)this.add(bj(this,o[h],void 0,h))}},r.prototype.notifyComplete=function(o){--this.active==0&&this.destination.complete()},r.prototype.notifyNext=function(o,u,h){var E=(o=this.values)[h];E=this.toRespond?E===Ir?--this.toRespond:this.toRespond:0,o[h]=u,E===0&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},r.prototype._tryResultSelector=function(o){try{var u=this.resultSelector.apply(this,o)}catch(h){return void this.destination.error(h)}this.destination.next(u)},r}(Bl),nd=function(i){function r(o){var u=i.call(this)||this;return u.parent=o,u}return ha(r,i),r.prototype._next=function(o){this.parent.notifyNext(o)},r.prototype._error=function(o){this.parent.notifyError(o),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(za);(function(i){function r(o,u,h){var E=i.call(this)||this;return E.parent=o,E.outerValue=u,E.outerIndex=h,E}ha(r,i),r.prototype._next=function(o){this.parent.notifyNext(this.outerValue,o,this.outerIndex,this)},r.prototype._error=function(o){this.parent.notifyError(o),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(za);var od=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype.notifyNext=function(o){this.destination.next(o)},r.prototype.notifyError=function(o){this.destination.error(o)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(za);(function(i){function r(){return i!==null&&i.apply(this,arguments)||this}ha(r,i),r.prototype.notifyNext=function(o,u,h,E){this.destination.next(u)},r.prototype.notifyError=function(o){this.destination.error(o)},r.prototype.notifyComplete=function(o){this.destination.complete()}})(za);var Lu=function(){function i(r,o){o===void 0&&(o=Number.POSITIVE_INFINITY),this.project=r,this.concurrent=o}return i.prototype.call=function(r,o){return o.subscribe(new bB(r,this.project,this.concurrent))},i}(),bB=function(i){function r(o,u,h){return h===void 0&&(h=Number.POSITIVE_INFINITY),(o=i.call(this,o)||this).project=u,o.concurrent=h,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return ha(r,i),r.prototype._next=function(o){this.active<this.concurrent?this._tryNext(o):this.buffer.push(o)},r.prototype._tryNext=function(o){var u=this.index++;try{var h=this.project(o,u)}catch(E){return void this.destination.error(E)}this.active++,this._innerSub(h)},r.prototype._innerSub=function(o){var u=new nd(this),h=this.destination;h.add(u),(o=bd(o,u))!==u&&h.add(o)},r.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(o){this.destination.next(o)},r.prototype.notifyComplete=function(){var o=this.buffer;this.active--,0<o.length?this._next(o.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},r}(od),Cl=R.parseFloat,Jr=1/Cl(`	
\v\f\r                　\u2028\u2029\uFEFF-0`)!=-1/0?function(i){i=Oj(String(i));var r=Cl(i);return r===0&&i.charAt(0)=="-"?-0:r}:Cl;ea({global:!0,forced:parseFloat!=Jr},{parseFloat:Jr});var Dl=new ua(Ic),Qu=function(){function i(r,o){this.predicate=r,this.thisArg=o}return i.prototype.call=function(r,o){return o.subscribe(new cB(r,this.predicate,this.thisArg))},i}(),cB=function(i){function r(o,u,h){return(o=i.call(this,o)||this).predicate=u,o.thisArg=h,o.count=0,o}return ha(r,i),r.prototype._next=function(o){try{var u=this.predicate.call(this.thisArg,o,this.count++)}catch(h){return void this.destination.error(h)}u&&this.destination.next(o)},r}(za),Ru=function(){function i(){}return i.prototype.call=function(r,o){return o.subscribe(new dB(r))},i}(),dB=function(i){function r(o){return(o=i.call(this,o)||this).hasFirst=!1,o.observables=[],o.subscriptions=[],o}return ha(r,i),r.prototype._next=function(o){this.observables.push(o)},r.prototype._complete=function(){var o=this.observables,u=o.length;if(u===0)this.destination.complete();else{for(var h=0;h<u&&!this.hasFirst;h++){var E=bj(this,o[h],void 0,h);this.subscriptions&&this.subscriptions.push(E),this.add(E)}this.observables=null}},r.prototype.notifyNext=function(o,u,h){if(!this.hasFirst){for(this.hasFirst=!0,o=0;o<this.subscriptions.length;o++)if(o!==h){var E=this.subscriptions[o];E.unsubscribe(),this.remove(E)}this.subscriptions=null}this.destination.next(u)},r}(Bl),Uu=function(){function i(r){this.resultSelector=r}return i.prototype.call=function(r,o){return o.subscribe(new eB(r,this.resultSelector))},i}(),eB=function(i){function r(o,u,h){return(o=i.call(this,o)||this).resultSelector=u,o.iterators=[],o.active=0,o.resultSelector=typeof u=="function"?u:void 0,o}return ha(r,i),r.prototype._next=function(o){var u=this.iterators;hc(o)?u.push(new fB(o)):typeof o[xd]=="function"?u.push(new gB(o[xd]())):u.push(new hB(this.destination,this,o))},r.prototype._complete=function(){var o=this.iterators,u=o.length;if(this.unsubscribe(),u===0)this.destination.complete();else{this.active=u;for(var h=0;h<u;h++){var E=o[h];E.stillUnsubscribed?this.destination.add(E.subscribe()):this.active--}}},r.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},r.prototype.checkIterators=function(){for(var o=this.iterators,u=o.length,h=this.destination,E=0;E<u;E++){var v=o[E];if(typeof v.hasValue=="function"&&!v.hasValue())return}var O=!1,C=[];for(E=0;E<u;E++){var k=(v=o[E]).next();if(v.hasCompleted()&&(O=!0),k.done)return void h.complete();C.push(k.value)}this.resultSelector?this._tryresultSelector(C):h.next(C),O&&h.complete()},r.prototype._tryresultSelector=function(o){try{var u=this.resultSelector.apply(this,o)}catch(h){return void this.destination.error(h)}this.destination.next(u)},r}(za),gB=function(){function i(r){this.iterator=r,this.nextResult=r.next()}return i.prototype.hasValue=function(){return!0},i.prototype.next=function(){var r=this.nextResult;return this.nextResult=this.iterator.next(),r},i.prototype.hasCompleted=function(){var r=this.nextResult;return!(!r||!r.done)},i}(),fB=function(){function i(r){this.array=r,this.length=this.index=0,this.length=r.length}return i.prototype[xd]=function(){return this},i.prototype.next=function(r){r=this.index++;var o=this.array;return r<this.length?{value:o[r],done:!1}:{value:null,done:!0}},i.prototype.hasValue=function(){return this.array.length>this.index},i.prototype.hasCompleted=function(){return this.array.length===this.index},i}(),hB=function(i){function r(o,u,h){return(o=i.call(this,o)||this).parent=u,o.observable=h,o.stillUnsubscribed=!0,o.buffer=[],o.isComplete=!1,o}return ha(r,i),r.prototype[xd]=function(){return this},r.prototype.next=function(){var o=this.buffer;return o.length===0&&this.isComplete?{value:null,done:!0}:{value:o.shift(),done:!1}},r.prototype.hasValue=function(){return 0<this.buffer.length},r.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},r.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(o){this.buffer.push(o),this.parent.checkIterators()},r.prototype.subscribe=function(){return bd(this.observable,new nd(this))},r}(od),iB=Object.freeze({__proto__:null,Observable:ua,ConnectableObservable:Dr,GroupedObservable:wl,observable:Pe,Subject:rb,BehaviorSubject:MA,ReplaySubject:Te,AsyncSubject:Sf,asap:TA,asapScheduler:kj,async:cd,asyncScheduler:zl,queue:Mg,queueScheduler:Mg,animationFrame:Gr,animationFrameScheduler:Gr,VirtualTimeScheduler:VA,VirtualAction:Hr,Scheduler:xl,Subscription:nb,Subscriber:za,Notification:yf,get NotificationKind(){return yl},pipe:Zi,noop:Ic,identity:wd,isObservable:function(i){return!!i&&(i instanceof ua||typeof i.lift=="function"&&typeof i.subscribe=="function")},ArgumentOutOfRangeError:Al,EmptyError:eh,ObjectUnsubscribedError:Ld,UnsubscriptionError:Pf,TimeoutError:Tb,bindCallback:gn,bindNodeCallback:hn,combineLatest:function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var o=r=void 0;return ad(i[i.length-1])&&(o=i.pop()),typeof i[i.length-1]=="function"&&(r=i.pop()),i.length===1&&hc(i[0])&&(i=i[0]),Rf(i,o).lift(new aB(r))},concat:nn,defer:yd,empty:Qf,forkJoin:function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];if(i.length===1){var o=i[0];if(hc(o))return ch(o,null);if(Xi(o)&&Object.getPrototypeOf(o)===Object.prototype)return ch((i=Object.keys(o)).map(function(h){return o[h]}),i)}if(typeof i[i.length-1]=="function"){var u=i.pop();return ch(i=i.length===1&&hc(i[0])?i[0]:i,null).pipe(Ea(function(h){return u.apply(void 0,h)}))}return ch(i,null)},from:Jc,fromEvent:Db,fromEventPattern:pn,generate:function(i,r,o,u,h){if(arguments.length==1){var E=i.initialState;r=i.condition,o=i.iterate;var v=i.resultSelector||wd;h=i.scheduler}else u===void 0||ad(u)?(E=i,v=wd,h=u):(E=i,v=u);return new ua(function(O){var C=E;if(h)return h.schedule(Mu,0,{subscriber:O,iterate:o,condition:r,resultSelector:v,state:C});for(;;){if(r){var k=void 0;try{k=r(C)}catch(j){O.error(j);break}if(!k){O.complete();break}}k=void 0;try{k=v(C)}catch(j){O.error(j);break}if(O.next(k),O.closed)break;try{C=o(C)}catch(j){O.error(j);break}}})},iif:function(i,r,o){return r===void 0&&(r=Sb),o===void 0&&(o=Sb),yd(function(){return i()?r:o})},interval:Qe,merge:Jb,never:function(){return Dl},of:ob,onErrorResumeNext:dj,pairs:function(i,r){return new ua(r?function(o){var u=Object.keys(i),h=new nb;return h.add(r.schedule(Ou,0,{keys:u,index:0,subscriber:o,subscription:h,obj:i})),h}:function(o){for(var u=Object.keys(i),h=0;h<u.length&&!o.closed;h++){var E=u[h];i.hasOwnProperty(E)&&o.next([E,i[E]])}o.complete()})},partition:function(i,r,o){return[yb(r,o)(new ua(Tf(i))),yb(Pu(r,o))(new ua(Tf(i)))]},race:fb,range:function(i,r,o){return i===void 0&&(i=0),new ua(function(u){r===void 0&&(r=i,i=0);var h=0,E=i;if(o)return o.schedule(Su,0,{index:h,count:r,start:i,subscriber:u});for(;;){if(h++>=r){u.complete();break}if(u.next(E++),u.closed)break}})},throwError:ra,timer:dd,using:function(i,r){return new ua(function(o){try{var u=i()}catch(v){return void o.error(v)}try{var h=r(u)}catch(v){return void o.error(v)}var E=(h?Jc(h):Sb).subscribe(o);return function(){E.unsubscribe(),u&&u.unsubscribe()}})},zip:ej,scheduled:ln,EMPTY:Sb,NEVER:Dl,config:gc}),Vu=function(){function i(r,o,u,h){this.bufferTimeSpan=r,this.bufferCreationInterval=o,this.maxBufferSize=u,this.scheduler=h}return i.prototype.call=function(r,o){return o.subscribe(new jB(r,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},i}(),kB=function(){this.buffer=[]},jB=function(i){function r(o,u,h,E,v){if((o=i.call(this,o)||this).bufferTimeSpan=u,o.bufferCreationInterval=h,o.maxBufferSize=E,o.scheduler=v,o.contexts=[],E=o.openContext(),o.timespanOnly=h==null||0>h,o.timespanOnly)o.add(E.closeAction=v.schedule(qn,u,{subscriber:o,context:E,bufferTimeSpan:u}));else{var O={bufferTimeSpan:u,bufferCreationInterval:h,subscriber:o,scheduler:v};o.add(E.closeAction=v.schedule(rn,u,{subscriber:o,context:E})),o.add(v.schedule(Wu,h,O))}return o}return ha(r,i),r.prototype._next=function(o){for(var u,h=this.contexts,E=h.length,v=0;v<E;v++){var O=h[v],C=O.buffer;C.push(o),C.length==this.maxBufferSize&&(u=O)}u&&this.onBufferFull(u)},r.prototype._error=function(o){this.contexts.length=0,i.prototype._error.call(this,o)},r.prototype._complete=function(){for(var o=this.contexts,u=this.destination;0<o.length;){var h=o.shift();u.next(h.buffer)}i.prototype._complete.call(this)},r.prototype._unsubscribe=function(){this.contexts=null},r.prototype.onBufferFull=function(o){if(this.closeContext(o),(o=o.closeAction).unsubscribe(),this.remove(o),!this.closed&&this.timespanOnly){o=this.openContext();var u=this.bufferTimeSpan;this.add(o.closeAction=this.scheduler.schedule(qn,u,{subscriber:this,context:o,bufferTimeSpan:u}))}},r.prototype.openContext=function(){var o=new kB;return this.contexts.push(o),o},r.prototype.closeContext=function(o){this.destination.next(o.buffer);var u=this.contexts;0<=(u?u.indexOf(o):-1)&&u.splice(u.indexOf(o),1)},r}(za),Xu=function(){function i(r){this.selector=r}return i.prototype.call=function(r,o){return o.subscribe(new lB(r,this.selector,this.caught))},i}(),lB=function(i){function r(o,u,h){return(o=i.call(this,o)||this).selector=u,o.caught=h,o}return ha(r,i),r.prototype.error=function(o){if(!this.isStopped){var u=void 0;try{u=this.selector(o,this.caught)}catch(h){return void i.prototype.error.call(this,h)}this._unsubscribeAndRecycle(),o=new nd(this),this.add(o),(u=bd(u,o))!==o&&this.add(u)}},r}(od),Yu=function(){function i(r){this.defaultValue=r}return i.prototype.call=function(r,o){return o.subscribe(new mB(r,this.defaultValue))},i}(),mB=function(i){function r(o,u){return(o=i.call(this,o)||this).defaultValue=u,o.isEmpty=!0,o}return ha(r,i),r.prototype._next=function(o){this.isEmpty=!1,this.destination.next(o)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(za),Zu=function(){function i(r,o){this.delay=r,this.scheduler=o}return i.prototype.call=function(r,o){return o.subscribe(new nB(r,this.delay,this.scheduler))},i}(),nB=function(i){function r(o,u,h){return(o=i.call(this,o)||this).delay=u,o.scheduler=h,o.queue=[],o.active=!1,o.errored=!1,o}return ha(r,i),r.dispatch=function(o){for(var u=o.source,h=u.queue,E=o.scheduler,v=o.destination;0<h.length&&0>=h[0].time-E.now();)h.shift().notification.observe(v);0<h.length?(u=Math.max(0,h[0].time-E.now()),this.schedule(o,u)):(this.unsubscribe(),u.active=!1)},r.prototype._schedule=function(o){this.active=!0,this.destination.add(o.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:o}))},r.prototype.scheduleNotification=function(o){if(this.errored!==!0){var u=this.scheduler;o=new oB(u.now()+this.delay,o),this.queue.push(o),this.active===!1&&this._schedule(u)}},r.prototype._next=function(o){this.scheduleNotification(yf.createNext(o))},r.prototype._error=function(o){this.errored=!0,this.queue=[],this.destination.error(o),this.unsubscribe()},r.prototype._complete=function(){this.scheduleNotification(yf.createComplete()),this.unsubscribe()},r}(za),oB=function(i,r){this.time=i,this.notification=r},$u=function(){function i(r,o){this.keySelector=r,this.flushes=o}return i.prototype.call=function(r,o){return o.subscribe(new pB(r,this.keySelector,this.flushes))},i}(),pB=function(i){function r(o,u,h){return(o=i.call(this,o)||this).keySelector=u,o.values=new Set,h&&o.add(bd(h,new nd(o))),o}return ha(r,i),r.prototype.notifyNext=function(){this.values.clear()},r.prototype.notifyError=function(o){this._error(o)},r.prototype._next=function(o){this.keySelector?this._useKeySelector(o):this._finalizeNext(o,o)},r.prototype._useKeySelector=function(o){var u=this.destination;try{var h=this.keySelector(o)}catch(E){return void u.error(E)}this._finalizeNext(h,o)},r.prototype._finalizeNext=function(o,u){var h=this.values;h.has(o)||(h.add(o),this.destination.next(u))},r}(od),bv=function(){function i(r){this.errorFactory=r}return i.prototype.call=function(r,o){return o.subscribe(new qB(r,this.errorFactory))},i}(),qB=function(i){function r(o,u){return(o=i.call(this,o)||this).errorFactory=u,o.hasValue=!1,o}return ha(r,i),r.prototype._next=function(o){this.hasValue=!0,this.destination.next(o)},r.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var o=void 0;try{o=this.errorFactory()}catch(u){o=u}this.destination.error(o)},r}(za),cv=function(){function i(r){if(this.total=r,0>this.total)throw new Al}return i.prototype.call=function(r,o){return o.subscribe(new rB(r,this.total))},i}(),rB=function(i){function r(o,u){return(o=i.call(this,o)||this).total=u,o.count=0,o}return ha(r,i),r.prototype._next=function(o){var u=this.total,h=++this.count;h<=u&&(this.destination.next(o),h===u&&(this.destination.complete(),this.unsubscribe()))},r}(za),dv=function(){function i(r){this.callback=r}return i.prototype.call=function(r,o){return o.subscribe(new sB(r,this.callback))},i}(),sB=function(i){function r(o,u){return(o=i.call(this,o)||this).add(new nb(u)),o}return ha(r,i),r}(za),fv=function(){function i(){}return i.prototype.call=function(r,o){return o.subscribe(new tB(r))},i}(),tB=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return ha(r,i),r.prototype._next=function(o){},r}(za),gv=function(){function i(r){if(this.total=r,0>this.total)throw new Al}return i.prototype.call=function(r,o){return o.subscribe(new uB(r,this.total))},i}(),uB=function(i){function r(o,u){return(o=i.call(this,o)||this).total=u,o.ring=[],o.count=0,o}return ha(r,i),r.prototype._next=function(o){var u=this.ring,h=this.total,E=this.count++;u.length<h?u.push(o):u[E%h]=o},r.prototype._complete=function(){var o=this.destination,u=this.count;if(0<u)for(var h=this.count>=this.total?this.total:this.count,E=this.ring,v=0;v<h;v++){var O=u++%h;o.next(E[O])}o.complete()},r}(za),hv=function(){function i(r){this.value=r}return i.prototype.call=function(r,o){return o.subscribe(new vB(r,this.value))},i}(),vB=function(i){function r(o,u){return(o=i.call(this,o)||this).value=u,o}return ha(r,i),r.prototype._next=function(o){this.destination.next(this.value)},r}(za),iv=function(){function i(r,o,u){u===void 0&&(u=!1),this.accumulator=r,this.seed=o,this.hasSeed=u}return i.prototype.call=function(r,o){return o.subscribe(new wB(r,this.accumulator,this.seed,this.hasSeed))},i}(),wB=function(i){function r(o,u,h,E){return(o=i.call(this,o)||this).accumulator=u,o._seed=h,o.hasSeed=E,o.index=0,o}return ha(r,i),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(o){this.hasSeed=!0,this._seed=o},enumerable:!0,configurable:!0}),r.prototype._next=function(o){if(this.hasSeed)return this._tryNext(o);this.seed=o,this.destination.next(o)},r.prototype._tryNext=function(o){var u=this.index++;try{var h=this.accumulator(this.seed,o,u)}catch(E){this.destination.error(E)}this.seed=h,this.destination.next(h)},r}(za),mv=function(){function i(r,o){this.notifier=r,this.source=o}return i.prototype.call=function(r,o){return o.subscribe(new xB(r,this.notifier,this.source))},i}(),xB=function(i){function r(o,u,h){return(o=i.call(this,o)||this).notifier=u,o.source=h,o}return ha(r,i),r.prototype.error=function(o){if(!this.isStopped){var u=this.errors,h=this.retries,E=this.retriesSubscription;if(h)this.retriesSubscription=this.errors=void 0;else{u=new rb;try{h=(0,this.notifier)(u)}catch(v){return i.prototype.error.call(this,v)}E=bd(h,new nd(this))}this._unsubscribeAndRecycle(),this.errors=u,this.retries=h,this.retriesSubscription=E,u.next(o)}},r.prototype._unsubscribe=function(){var o=this.errors,u=this.retriesSubscription;o&&(o.unsubscribe(),this.errors=void 0),u&&(u.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},r.prototype.notifyNext=function(){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)},r}(od),pv=function(){function i(r){this.project=r}return i.prototype.call=function(r,o){return o.subscribe(new yB(r,this.project))},i}(),yB=function(i){function r(o,u){return(o=i.call(this,o)||this).project=u,o.index=0,o}return ha(r,i),r.prototype._next=function(o){var u=this.index++;try{var h=this.project(o,u)}catch(E){return void this.destination.error(E)}this._innerSub(h)},r.prototype._innerSub=function(o){var u=this.innerSubscription;u&&u.unsubscribe(),u=new nd(this);var h=this.destination;h.add(u),this.innerSubscription=bd(o,u),this.innerSubscription!==u&&h.add(this.innerSubscription)},r.prototype._complete=function(){var o=this.innerSubscription;o&&!o.closed||i.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&i.prototype._complete.call(this)},r.prototype.notifyNext=function(o){this.destination.next(o)},r}(od),qv=function(){function i(r){this.notifier=r}return i.prototype.call=function(r,o){r=new zB(r);var u=bd(this.notifier,new nd(r));return u&&!r.seenValue?(r.add(u),o.subscribe(r)):r},i}(),zB=function(i){function r(o){return(o=i.call(this,o)||this).seenValue=!1,o}return ha(r,i),r.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},r.prototype.notifyComplete=function(){},r}(od),rv=function(){function i(r,o,u){this.nextOrObserver=r,this.error=o,this.complete=u}return i.prototype.call=function(r,o){return o.subscribe(new AB(r,this.nextOrObserver,this.error,this.complete))},i}(),AB=function(i){function r(o,u,h,E){return(o=i.call(this,o)||this)._tapNext=Ic,o._tapError=Ic,o._tapComplete=Ic,o._tapError=h||Ic,o._tapComplete=E||Ic,Ne(u)?(o._context=o,o._tapNext=u):u&&(o._context=u,o._tapNext=u.next||Ic,o._tapError=u.error||Ic,o._tapComplete=u.complete||Ic),o}return ha(r,i),r.prototype._next=function(o){try{this._tapNext.call(this._context,o)}catch(u){return void this.destination.error(u)}this.destination.next(o)},r.prototype._error=function(o){try{this._tapError.call(this._context,o)}catch(u){return void this.destination.error(u)}this.destination.error(o)},r.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(o){return void this.destination.error(o)}return this.destination.complete()},r}(za),tv={leading:!0,trailing:!1};(function(i){function r(o,u,h,E){var v=i.call(this,o)||this;return v.destination=o,v.durationSelector=u,v._leading=h,v._trailing=E,v._hasValue=!1,v}ha(r,i),r.prototype._next=function(o){this._hasValue=!0,this._sendValue=o,this._throttled||(this._leading?this.send():this.throttle(o))},r.prototype.send=function(){var o=this._sendValue;this._hasValue&&(this.destination.next(o),this.throttle(o)),this._hasValue=!1,this._sendValue=void 0},r.prototype.throttle=function(o){(o=this.tryDurationSelector(o))&&this.add(this._throttled=bd(o,new nd(this)))},r.prototype.tryDurationSelector=function(o){try{return this.durationSelector(o)}catch(u){return this.destination.error(u),null}},r.prototype.throttlingDone=function(){var o=this._throttled,u=this._trailing;o&&o.unsubscribe(),this._throttled=void 0,u&&this.send()},r.prototype.notifyNext=function(){this.throttlingDone()},r.prototype.notifyComplete=function(){this.throttlingDone()}})(od);for(var uv=function(){function i(r,o,u,h){this.duration=r,this.scheduler=o,this.leading=u,this.trailing=h}return i.prototype.call=function(r,o){return o.subscribe(new BB(r,this.duration,this.scheduler,this.leading,this.trailing))},i}(),BB=function(i){function r(o,u,h,E,v){return(o=i.call(this,o)||this).duration=u,o.scheduler=h,o.leading=E,o.trailing=v,o._hasTrailingValue=!1,o._trailingValue=null,o}return ha(r,i),r.prototype._next=function(o){this.throttled?this.trailing&&(this._trailingValue=o,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(vv,this.duration,{subscriber:this})),this.leading?this.destination.next(o):this.trailing&&(this._trailingValue=o,this._hasTrailingValue=!0))},r.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},r.prototype.clearThrottle=function(){var o=this.throttled;o&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),o.unsubscribe(),this.remove(o),this.throttled=null)},r}(za),xv=function(){function i(r,o,u,h){this.waitFor=r,this.absoluteTimeout=o,this.withObservable=u,this.scheduler=h}return i.prototype.call=function(r,o){return o.subscribe(new CB(r,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},i}(),CB=function(i){function r(o,u,h,E,v){return(o=i.call(this,o)||this).absoluteTimeout=u,o.waitFor=h,o.withObservable=E,o.scheduler=v,o.scheduleTimeout(),o}return ha(r,i),r.dispatchTimeout=function(o){var u=o.withObservable;o._unsubscribeAndRecycle(),o.add(bd(u,new nd(o)))},r.prototype.scheduleTimeout=function(){var o=this.action;o?this.action=o.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(r.dispatchTimeout,this.waitFor,this))},r.prototype._next=function(o){this.absoluteTimeout||this.scheduleTimeout(),i.prototype._next.call(this,o)},r.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},r}(od),zv=function(){function i(r,o){this.observables=r,this.project=o}return i.prototype.call=function(r,o){return o.subscribe(new DB(r,this.observables,this.project))},i}(),DB=function(i){function r(o,u,h){(o=i.call(this,o)||this).observables=u,o.project=h,o.toRespond=[],h=u.length,o.values=Array(h);for(var E=0;E<h;E++)o.toRespond.push(E);for(E=0;E<h;E++)o.add(bj(o,u[E],void 0,E));return o}return ha(r,i),r.prototype.notifyNext=function(o,u,h){this.values[h]=u,0<(o=this.toRespond).length&&(h=o.indexOf(h))!==-1&&o.splice(h,1)},r.prototype.notifyComplete=function(){},r.prototype._next=function(o){this.toRespond.length===0&&(o=[o].concat(this.values),this.project?this._tryProject(o):this.destination.next(o))},r.prototype._tryProject=function(o){try{var u=this.project.apply(this,o)}catch(h){return void this.destination.error(h)}this.destination.next(u)},r}(Bl),Kr=xb(function(i){var r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(r){var o=new Uint8Array(16);i.exports=function(){return r(o),o}}else{var u=Array(16);i.exports=function(){for(var h,E=0;16>E;E++)(3&E)==0&&(h=4294967296*Math.random()),u[E]=h>>>((3&E)<<3)&255;return u}}}),zb=[],pi=0;256>pi;++pi)zb[pi]=(pi+256).toString(16).substr(1);var Lr=function(i,r){return r=r||0,[zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],"-",zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]],zb[i[r++]]].join("")},Ng=function(i,r,o){if(o=r&&o||0,typeof i=="string"&&(r=i==="binary"?Array(16):null,i=null),(i=(i=i||{}).random||(i.rng||Kr)())[6]=15&i[6]|64,i[8]=63&i[8]|128,r)for(var u=0;16>u;++u)r[o+u]=i[u];return r||Lr(i)},Og=Ng(),gj=!1,yn=new AbortController,pd,Md,El,Fl,Nd,qe,Fc,re,nc,Gl,qd,se,rd,sd,td,zf;(function(i){i[i.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",i[i.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",i[i.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",i[i.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",i[i.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",i[i.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",i[i.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(pd||(pd={})),function(i){i[i.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",i[i.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",i[i.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",i[i.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",i[i.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",i[i.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Md||(Md={})),function(i){i[i.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(El||(El={})),function(i){i[i.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Fl||(Fl={})),function(i){i[i.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",i[i.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",i[i.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",i[i.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",i[i.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",i[i.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(Nd||(Nd={})),function(i){i[i.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",i[i.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",i[i.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",i[i.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",i[i.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(qe||(qe={})),function(i){i[i.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",i[i.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",i[i.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",i[i.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",i[i.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",i[i.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",i[i.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",i[i.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",i[i.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",i[i.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",i[i.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(Fc||(Fc={})),function(i){i[i.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",i[i.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",i[i.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",i[i.LEAVE_CHANNEL_ERR_KICKED=4]="LEAVE_CHANNEL_ERR_KICKED",i[i.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(re||(re={})),function(i){i[i.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",i[i.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",i[i.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",i[i.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",i[i.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",i[i.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",i[i.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",i[i.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",i[i.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",i[i.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",i[i.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(nc||(nc={})),function(i){i[i.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Gl||(Gl={})),function(i){i[i.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",i[i.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",i[i.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",i[i.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",i[i.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",i[i.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",i[i.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(qd||(qd={})),function(i){i[i.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",i[i.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(se||(se={})),function(i){i[i.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",i[i.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",i[i.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",i[i.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",i[i.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",i[i.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",i[i.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",i[i.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(rd||(rd={})),function(i){i[i.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",i[i.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(i){i[i.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",i[i.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",i[i.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",i[i.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",i[i.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",i[i.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",i[i.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(td||(td={})),function(i){i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",i[i.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(zf||(zf={}));var oc=pd.ATTRIBUTE_OPERATION_ERR_FAILURE,gb=pd.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,Ye=pd.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;pd.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Mr=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,pc=pd.ATTRIBUTE_OPERATION_ERR_TIMEOUT,qc=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,qi=Md.CHANNEL_MESSAGE_ERR_FAILURE,Hl=Md.CHANNEL_MESSAGE_ERR_TIMEOUT,Nr=Md.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Il=Md.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,EB=Md.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,Jl=Md.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,FB=El.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Or=Fl.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Pr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Qr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,GB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var HB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,IB=Nd.GET_MEMBERS_ERR_FAILURE,JB=Nd.GET_MEMBERS_ERR_REJECTED;Nd.GET_MEMBERS_ERR_TIMEOUT,Nd.GET_MEMBERS_ERR_TOO_OFTEN;var KB=Nd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,LB=Nd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,Xc=qe.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,MB=qe.INVITATION_API_CALL_ERR_NOT_STARTED,ri=qe.INVITATION_API_CALL_ERR_ALREADY_END,Rr=qe.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,NB=qe.INVITATION_API_CALL_ERR_ALREADY_SENT,Sr=Fc.JOIN_CHANNEL_ERR_FAILURE;Fc.JOIN_CHANNEL_ERR_REJECTED;var OB=Fc.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Tr=Fc.JOIN_CHANNEL_TIMEOUT,Ur=Fc.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Vr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED;Fc.JOIN_CHANNEL_ERR_TOO_OFTEN;var Wr=Fc.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Xr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Yr=re.LEAVE_CHANNEL_ERR_FAILURE,Zr=re.LEAVE_CHANNEL_ERR_REJECTED,PB=re.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,QB=re.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,RB=re.LEAVE_CHANNEL_ERR_KICKED,$r=nc.LOGIN_ERR_UNKNOWN,Pg=nc.LOGIN_ERR_REJECTED,si=nc.LOGIN_ERR_INVALID_ARGUMENT,as=nc.LOGIN_ERR_INVALID_APP_ID,bs=nc.LOGIN_ERR_INVALID_TOKEN,ti=nc.LOGIN_ERR_TOKEN_EXPIRED;nc.LOGIN_ERR_NOT_AUTHORIZED;var SB=nc.LOGIN_ERR_ALREADY_LOGIN,TB=nc.LOGIN_ERR_TIMEOUT,UB=nc.LOGIN_ERR_TOO_OFTEN,cs=Gl.LOGOUT_ERR_USER_NOT_LOGGED_IN,ds=qd.PEER_MESSAGE_ERR_FAILURE,Kl=qd.PEER_MESSAGE_ERR_TIMEOUT,es=qd.PEER_MESSAGE_ERR_TOO_OFTEN,fs=qd.PEER_MESSAGE_ERR_INVALID_USERID,bg=qd.PEER_MESSAGE_ERR_INVALID_MESSAGE,Ll=qd.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN;qd.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE;var gs=se.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;se.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var VB=se.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;se.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var WB=se.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,Ml=rd.RENEW_TOKEN_ERR_FAILURE,XB=rd.RENEW_TOKEN_ERR_INVALID_ARGUMENT;rd.RENEW_TOKEN_ERR_REJECTED,rd.RENEW_TOKEN_ERR_TOO_OFTEN;var YB=rd.RENEW_TOKEN_ERR_TOKEN_EXPIRED,ZB=rd.RENEW_TOKEN_ERR_INVALID_TOKEN,hs=rd.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,is=td.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,Qg=td.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;td.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var $B=td.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;td.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var js=td.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,Nl=td.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var aC=function(i,r){var o;return rl(i,function(u,h,E){return!(o=r(u,h,E))}),!!o},ui=function(i,r,o){if(!Gb(o))return!1;var u=qa(r);return!!(u=="number"?ae(o)&&gl(r,o.length):u=="string"&&r in o)&&Gg(o[r],i)},Ol=function(i,r,o){var u=ub(i)?ur:aC;return u(i,wf(r))},bC=function(i,r){var o=-1,u=ae(i)?Array(i.length):[];return rl(i,function(h,E,v){u[++o]=r(h,E,v)}),u},cC=function(i,r){var o=i.length;for(i.sort(r);o--;)i[o]=i[o].value;return i},dC=function(i,r,o){r=r.length?Je(r,function(h){return ub(h)?function(E){return li(E,h.length===1?h[0]:h)}:h}):[mi];var u=-1;return r=Je(r,ii(wf)),i=bC(i,function(h,E,v){return{criteria:Je(r,function(O){return O(h)}),index:++u,value:h}}),cC(i,function(h,E){t:{for(var v=-1,O=h.criteria,C=E.criteria,k=O.length,j=o.length;++v<k;){e:{var K=O[v],$=C[v];if(K!==$){var _e=K!==void 0,na=K===null,_c=K==K,_a=Ke(K),_s=$!==void 0,_h=$===null,_f=$==$,E_=Ke($);if(!_h&&!E_&&!_a&&K>$||_a&&_s&&_f&&!_h&&!E_||na&&_s&&_f||!_e&&_f||!_c){K=1;break e}if(!na&&!_a&&!E_&&K<$||E_&&_e&&_c&&!na&&!_a||_h&&_e&&_c||!_s&&_c||!_f){K=-1;break e}}K=0}if(K){h=v>=j?K:K*(o[v]=="desc"?-1:1);break t}}h=h.index-E.index}return h})},ks=function(i,r){return sr(rr(i,r,mi),i+"")},ls=ks(function(i,r){if(i==null)return[];var o=r.length;return 1<o&&ui(i,r[0],r[1])?r=[]:2<o&&ui(r[0],r[1],r[2])&&(r=[r[0]]),dC(i,Si(r),[])}),ms=function(i){if(i.__esModule)return i;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(o){var u=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(r,o,u.get?u:{enumerable:!0,get:function(){return i[o]}})}),r}(iB),ns=xb(function(i,r){Object.defineProperty(r,"__esModule",{value:!0});var o=[],u=function(h,E){return new WebSocket(h,E)};r.normalClosureMessage="Normal closure",r.default=function(h,E){var v=(E=E===void 0?{protocols:o,makeWebSocket:u}:E).protocols,O=v===void 0?o:v,C=(E=E.makeWebSocket)===void 0?u:E;return new ms.Observable(function(k){var j,K=new ms.Subject,$=C(h,O),_e=!1,na=!1,_c=function(_a){if(j)throw _e=!0,_a=Error("Web socket message factory function called more than once"),k.error(_a),_a;return j=_a.subscribe(function(_s){$.send(_s)}),K};return $.onopen=function(){na?(_e=!0,$.close()):k.next(_c)},$.onmessage=function(_a){K.next(_a.data)},$.onerror=function(_a){_e=!0,k.error(Error(_a.message))},$.onclose=function(_a){_e||(_e=!0,na?(k.complete(),K.complete()):k.error(Error(_a.code===1e3?r.normalClosureMessage:_a.reason)))},function(){na=!0,j&&j.unsubscribe(),_e||(_e=!0,$.close())}})}});(function(i){i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")&&i.default})(ns);var ij=function(i,r,o){(o===void 0||Gg(i[r],o))&&(o!==void 0||r in i)||Ig(i,r,o)},hj=function(i,r){if((r!=="constructor"||typeof i[r]!="function")&&r!="__proto__")return i[r]},eC=function(i){return ks(function(r,o){var u=-1,h=o.length,E=1<h?o[h-1]:void 0,v=2<h?o[2]:void 0;for(E=3<i.length&&typeof E=="function"?(h--,E):void 0,v&&ui(o[0],o[1],v)&&(E=3>h?void 0:E,h=1),r=Object(r);++u<h;)(v=o[u])&&i(r,v,u,E);return r})}(function(i,r,o,u){zn(i,r,o,u)}),fC=Math.floor,gC=Math.random,os=function(i,r){return i+fC(gC()*(r-i+1))},ps=function(i){var r=i.length;return r?i[os(0,r-1)]:void 0},hC=function(i,r){return Je(r,function(o){return i[o]})},zj=function(i){return i==null?[]:hC(i,Wd(i))},iC=function(i){return ps(zj(i))},On=function(i){return(ub(i)?ps:iC)(i)},Dn=[],En=function(i,r){return new WebSocket(i,r)},jC=Math.floor;ea({target:"Number",stat:!0},{isInteger:function(i){return!xa(i)&&isFinite(i)&&jC(i)===i}}),Sp("from",sk,rk);var kC=function(i,r){for(var o=Array(arguments.length-1),u=0,h=2,E=!0;h<arguments.length;)o[u++]=arguments[h++];return new Promise(function(v,O){o[u]=function(C){if(E)if(E=!1,C)O(C);else{for(var k=Array(arguments.length-1),j=0;j<k.length;)k[j++]=arguments[j];v.apply(null,k)}};try{i.apply(r||null,o)}catch(C){E&&(E=!1,O(C))}})},lC=xb(function(i,r){r.length=function(h){var E=h.length;if(!E)return 0;for(var v=0;1<--E%4&&h.charAt(E)==="=";)++v;return Math.ceil(3*h.length)/4-v};var o=Array(64),u=Array(123);for(i=0;64>i;)u[o[i]=26>i?i+65:52>i?i+71:62>i?i-4:i-59|43]=i++;r.encode=function(h,E,v){for(var O,C=null,k=[],j=0,K=0;E<v;){var $=h[E++];switch(K){case 0:k[j++]=o[$>>2],O=(3&$)<<4,K=1;break;case 1:k[j++]=o[O|$>>4],O=(15&$)<<2,K=2;break;case 2:k[j++]=o[O|$>>6],k[j++]=o[63&$],K=0}8191<j&&((C||(C=[])).push(String.fromCharCode.apply(String,k)),j=0)}return K&&(k[j++]=o[O],k[j++]=61,K===1&&(k[j++]=61)),C?(j&&C.push(String.fromCharCode.apply(String,k.slice(0,j))),C.join("")):String.fromCharCode.apply(String,k.slice(0,j))},r.decode=function(h,E,v){for(var O,C=v,k=0,j=0;j<h.length;){var K=h.charCodeAt(j++);if(K===61&&1<k)break;if((K=u[K])===void 0)throw Error("invalid encoding");switch(k){case 0:O=K,k=1;break;case 1:E[v++]=O<<2|(48&K)>>4,O=K,k=2;break;case 2:E[v++]=(15&O)<<4|(60&K)>>2,O=K,k=3;break;case 3:E[v++]=(3&O)<<6|K,k=0}}if(k===1)throw Error("invalid encoding");return v-C},r.test=function(h){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(h)}});hh.prototype.on=function(i,r,o){return(this._listeners[i]||(this._listeners[i]=[])).push({fn:r,ctx:o||this}),this},hh.prototype.off=function(i,r){if(i===void 0)this._listeners={};else if(r===void 0)this._listeners[i]=[];else{i=this._listeners[i];for(var o=0;o<i.length;)i[o].fn===r?i.splice(o,1):++o}return this},hh.prototype.emit=function(i){var r=this._listeners[i];if(r){for(var o=[],u=1;u<arguments.length;)o.push(arguments[u++]);for(u=0;u<r.length;)r[u].fn.apply(r[u++].ctx,o)}return this};var mC=Fn(Fn),nC=function(c){try{var b=eval("quire".replace(/^/,"re"))(c);if(b&&(b.length||Object.keys(b).length))return b}catch(i){}return null},oC=xb(function(i,r){r.length=function(o){for(var u,h=0,E=0;E<o.length;++E)128>(u=o.charCodeAt(E))?h+=1:2048>u?h+=2:(64512&u)==55296&&(64512&o.charCodeAt(E+1))==56320?(++E,h+=4):h+=3;return h},r.read=function(o,u,h){if(1>h-u)return"";for(var E,v=null,O=[],C=0;u<h;)128>(E=o[u++])?O[C++]=E:191<E&&224>E?O[C++]=(31&E)<<6|63&o[u++]:239<E&&365>E?(E=((7&E)<<18|(63&o[u++])<<12|(63&o[u++])<<6|63&o[u++])-65536,O[C++]=55296+(E>>10),O[C++]=56320+(1023&E)):O[C++]=(15&E)<<12|(63&o[u++])<<6|63&o[u++],8191<C&&((v||(v=[])).push(String.fromCharCode.apply(String,O)),C=0);return v?(C&&v.push(String.fromCharCode.apply(String,O.slice(0,C))),v.join("")):String.fromCharCode.apply(String,O.slice(0,C))},r.write=function(o,u,h){for(var E,v,O=h,C=0;C<o.length;++C)128>(E=o.charCodeAt(C))?u[h++]=E:(2048>E?u[h++]=E>>6|192:((64512&E)==55296&&(64512&(v=o.charCodeAt(C+1)))==56320?(E=65536+((1023&E)<<10)+(1023&v),++C,u[h++]=E>>18|240,u[h++]=E>>12&63|128):u[h++]=E>>12|224,u[h++]=E>>6&63|128),u[h++]=63&E|128);return h-O}}),pC=function(i,r,o){var u=o||8192,h=u>>>1,E=null,v=u;return function(O){return 1>O||O>h?i(O):(v+O>u&&(E=i(u),v=0),O=r.call(E,v,v+=O),7&v&&(v=1+(7|v)),O)}},te=vb.zero=new vb(0,0);te.toNumber=function(){return 0},te.zzEncode=te.zzDecode=function(){return this},te.length=function(){return 1};var qC=vb.zeroHash="\0\0\0\0\0\0\0\0";vb.fromNumber=function(i){if(i===0)return te;var r=0>i;r&&(i=-i);var o=i>>>0;return i=(i-o)/4294967296>>>0,r&&(i=~i>>>0,o=~o>>>0,4294967295<++o&&(o=0,4294967295<++i&&(i=0))),new vb(o,i)},vb.from=function(i){if(typeof i=="number")return vb.fromNumber(i);if(pa.isString(i)){if(!pa.Long)return vb.fromNumber(parseInt(i,10));i=pa.Long.fromString(i)}return i.low||i.high?new vb(i.low>>>0,i.high>>>0):te},vb.prototype.toNumber=function(i){if(!i&&this.hi>>>31){i=1+~this.lo>>>0;var r=~this.hi>>>0;return i||(r=r+1>>>0),-(i+4294967296*r)}return this.lo+4294967296*this.hi},vb.prototype.toLong=function(i){return pa.Long?new pa.Long(0|this.lo,0|this.hi,!!i):{low:0|this.lo,high:0|this.hi,unsigned:!!i}};var Od=String.prototype.charCodeAt;vb.fromHash=function(i){return i===qC?te:new vb((Od.call(i,0)|Od.call(i,1)<<8|Od.call(i,2)<<16|Od.call(i,3)<<24)>>>0,(Od.call(i,4)|Od.call(i,5)<<8|Od.call(i,6)<<16|Od.call(i,7)<<24)>>>0)},vb.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},vb.prototype.zzEncode=function(){var i=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^i)>>>0,this.lo=(this.lo<<1^i)>>>0,this},vb.prototype.zzDecode=function(){var i=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^i)>>>0,this.hi=(this.hi>>>1^i)>>>0,this},vb.prototype.length=function(){var i=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,o=this.hi>>>24;return o===0?r===0?16384>i?128>i?1:2:2097152>i?3:4:16384>r?128>r?5:6:2097152>r?7:8:128>o?9:10};var pa=xb(function(i,r){function o(h,E,v){for(var O=Object.keys(E),C=0;C<O.length;++C)h[O[C]]!==void 0&&v||(h[O[C]]=E[O[C]]);return h}function u(h){function E(v,O){if(!(this instanceof E))return new E(v,O);Object.defineProperty(this,"message",{get:function(){return v}}),Error.captureStackTrace?Error.captureStackTrace(this,E):Object.defineProperty(this,"stack",{value:Error().stack||""}),O&&o(this,O)}return(E.prototype=Object.create(Error.prototype)).constructor=E,Object.defineProperty(E.prototype,"name",{get:function(){return h}}),E.prototype.toString=function(){return this.name+": "+this.message},E}r.asPromise=kC,r.base64=lC,r.EventEmitter=hh,r.float=mC,r.inquire=nC,r.utf8=oC,r.pool=pC,r.LongBits=vb,r.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),r.global=r.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h},r.isString=function(h){return typeof h=="string"||h instanceof String},r.isObject=function(h){return h&&qa(h)==="object"},r.isset=r.isSet=function(h,E){var v=h[E];return!(v==null||!h.hasOwnProperty(E))&&(qa(v)!=="object"||0<(Array.isArray(v)?v.length:Object.keys(v).length))},r.Buffer=function(){try{var h=r.inquire("buffer").Buffer;return h.prototype.utf8Write?h:null}catch{return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(h){return typeof h=="number"?r.Buffer?r._Buffer_allocUnsafe(h):new r.Array(h):r.Buffer?r._Buffer_from(h):typeof Uint8Array>"u"?h:new Uint8Array(h)},r.Array=typeof Uint8Array<"u"?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(h){return h?r.LongBits.from(h).toHash():r.LongBits.zeroHash},r.longFromHash=function(h,E){return h=r.LongBits.fromHash(h),r.Long?r.Long.fromBits(h.lo,h.hi,E):h.toNumber(!!E)},r.merge=o,r.lcFirst=function(h){return h.charAt(0).toLowerCase()+h.substring(1)},r.newError=u,r.ProtocolError=u("ProtocolError"),r.oneOfGetter=function(h){for(var E={},v=0;v<h.length;++v)E[h[v]]=1;return function(){for(var O=Object.keys(this),C=O.length-1;-1<C;--C)if(E[O[C]]===1&&this[O[C]]!==void 0&&this[O[C]]!==null)return O[C]}},r.oneOfSetter=function(h){return function(E){for(var v=0;v<h.length;++v)h[v]!==E&&delete this[h[v]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var h=r.Buffer;h?(r._Buffer_from=h.from!==Uint8Array.from&&h.from||function(E,v){return new h(E,v)},r._Buffer_allocUnsafe=h.allocUnsafe||function(E){return new h(E)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}),qj=Aa,Pl,vi=pa.LongBits,qs=pa.base64,rs=pa.utf8,ss=function(){return pa.Buffer?function(){return(Aa.create=function(){return new Pl})()}:function(){return new Aa}};Aa.create=ss(),Aa.alloc=function(i){return new pa.Array(i)},pa.Array!==Array&&(Aa.alloc=pa.pool(Aa.alloc,pa.Array.prototype.subarray)),Aa.prototype._push=function(i,r,o){return this.tail=this.tail.next=new Wf(i,r,o),this.len+=r,this},nj.prototype=Object.create(Wf.prototype),nj.prototype.fn=function(i,r,o){for(;127<i;)r[o++]=127&i|128,i>>>=7;r[o]=i},Aa.prototype.uint32=function(i){return this.len+=(this.tail=this.tail.next=new nj(128>(i>>>=0)?1:16384>i?2:2097152>i?3:268435456>i?4:5,i)).len,this},Aa.prototype.int32=function(i){return 0>i?this._push(oj,10,vi.fromNumber(i)):this.uint32(i)},Aa.prototype.sint32=function(i){return this.uint32((i<<1^i>>31)>>>0)},Aa.prototype.uint64=function(i){return i=vi.from(i),this._push(oj,i.length(),i)},Aa.prototype.int64=Aa.prototype.uint64,Aa.prototype.sint64=function(i){return i=vi.from(i).zzEncode(),this._push(oj,i.length(),i)},Aa.prototype.bool=function(i){return this._push(mj,1,i?1:0)},Aa.prototype.fixed32=function(i){return this._push(pj,4,i>>>0)},Aa.prototype.sfixed32=Aa.prototype.fixed32,Aa.prototype.fixed64=function(i){return i=vi.from(i),this._push(pj,4,i.lo)._push(pj,4,i.hi)},Aa.prototype.sfixed64=Aa.prototype.fixed64,Aa.prototype.float=function(i){return this._push(pa.float.writeFloatLE,4,i)},Aa.prototype.double=function(i){return this._push(pa.float.writeDoubleLE,8,i)};var rC=pa.Array.prototype.set?function(i,r,o){r.set(i,o)}:function(i,r,o){for(var u=0;u<i.length;++u)r[o+u]=i[u]};Aa.prototype.bytes=function(i){var r=i.length>>>0;if(!r)return this._push(mj,1,0);if(pa.isString(i)){var o=Aa.alloc(r=qs.length(i));qs.decode(i,o,0),i=o}return this.uint32(r)._push(rC,r,i)},Aa.prototype.string=function(i){var r=rs.length(i);return r?this.uint32(r)._push(rs.write,r,i):this._push(mj,1,0)},Aa.prototype.fork=function(){return this.states=new Cv(this),this.head=this.tail=new Wf(lj,0,0),this.len=0,this},Aa.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Wf(lj,0,0),this.len=0),this},Aa.prototype.ldelim=function(){var i=this.head,r=this.tail,o=this.len;return this.reset().uint32(o),o&&(this.tail.next=i.next,this.tail=r,this.len+=o),this},Aa.prototype.finish=function(){for(var i=this.head.next,r=this.constructor.alloc(this.len),o=0;i;)i.fn(i.val,r,o),o+=i.len,i=i.next;return r},Aa._configure=function(i){Pl=i,Aa.create=ss(),Pl._configure()},(Lc.prototype=Object.create(qj.prototype)).constructor=Lc,Lc._configure=function(){Lc.alloc=pa._Buffer_allocUnsafe,Lc.writeBytesBuffer=pa.Buffer&&pa.Buffer.prototype instanceof Uint8Array&&pa.Buffer.prototype.set.name==="set"?function(i,r,o){r.set(i,o)}:function(i,r,o){if(i.copy)i.copy(r,o,0,i.length);else for(var u=0;u<i.length;)r[o++]=i[u++]}},Lc.prototype.bytes=function(i){pa.isString(i)&&(i=pa._Buffer_from(i,"base64"));var r=i.length>>>0;return this.uint32(r),r&&this._push(Lc.writeBytesBuffer,r,i),this},Lc.prototype.string=function(i){var r=pa.Buffer.byteLength(i);return this.uint32(r),r&&this._push(Dv,r,i),this},Lc._configure();var sj=ib,Ql,Kn=pa.LongBits,sC=pa.utf8,ts=typeof Uint8Array<"u"?function(i){if(i instanceof Uint8Array||Array.isArray(i))return new ib(i);throw Error("illegal buffer")}:function(i){if(Array.isArray(i))return new ib(i);throw Error("illegal buffer")},us=function(){return pa.Buffer?function(i){return(ib.create=function(r){return pa.Buffer.isBuffer(r)?new Ql(r):ts(r)})(i)}:ts};ib.create=us(),ib.prototype._slice=pa.Array.prototype.subarray||pa.Array.prototype.slice,ib.prototype.uint32=function(){var i=4294967295;return function(){if(i=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(i=(i|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(i=(i|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(i=(i|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(i=(i|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return i;if((this.pos+=5)>this.len)throw this.pos=this.len,wc(this,10);return i}}(),ib.prototype.int32=function(){return 0|this.uint32()},ib.prototype.sint32=function(){var i=this.uint32();return i>>>1^-(1&i)|0},ib.prototype.bool=function(){return this.uint32()!==0},ib.prototype.fixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return ih(this.buf,this.pos+=4)},ib.prototype.sfixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return 0|ih(this.buf,this.pos+=4)},ib.prototype.float=function(){if(this.pos+4>this.len)throw wc(this,4);var i=pa.float.readFloatLE(this.buf,this.pos);return this.pos+=4,i},ib.prototype.double=function(){if(this.pos+8>this.len)throw wc(this,4);var i=pa.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,i},ib.prototype.bytes=function(){var i=this.uint32(),r=this.pos,o=this.pos+i;if(o>this.len)throw wc(this,i);return this.pos+=i,Array.isArray(this.buf)?this.buf.slice(r,o):r===o?new this.buf.constructor(0):this._slice.call(this.buf,r,o)},ib.prototype.string=function(){var i=this.bytes();return sC.read(i,0,i.length)},ib.prototype.skip=function(i){if(typeof i=="number"){if(this.pos+i>this.len)throw wc(this,i);this.pos+=i}else do if(this.pos>=this.len)throw wc(this);while(128&this.buf[this.pos++]);return this},ib.prototype.skipType=function(i){switch(i){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(i=7&this.uint32())!=4;)this.skipType(i);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+i+" at offset "+this.pos)}return this},ib._configure=function(i){Ql=i,ib.create=us(),Ql._configure();var r=pa.Long?"toLong":"toNumber";pa.merge(ib.prototype,{int64:function(){return rj.call(this)[r](!1)},uint64:function(){return rj.call(this)[r](!0)},sint64:function(){return rj.call(this).zzDecode()[r](!1)},fixed64:function(){return Ln.call(this)[r](!0)},sfixed64:function(){return Ln.call(this)[r](!1)}})},(be.prototype=Object.create(sj.prototype)).constructor=be,be._configure=function(){pa.Buffer&&(be.prototype._slice=pa.Buffer.prototype.slice)},be.prototype.string=function(){var i=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+i,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+i,this.len))},be._configure(),(Xf.prototype=Object.create(pa.EventEmitter.prototype)).constructor=Xf,Xf.prototype.rpcCall=function i(r,o,u,h,E){if(!h)throw TypeError("request must be specified");var v=this;if(!E)return pa.asPromise(i,v,r,o,u,h);if(v.rpcImpl)try{return v.rpcImpl(r,o[v.requestDelimited?"encodeDelimited":"encode"](h).finish(),function(O,C){if(O)return v.emit("error",O,r),E(O);if(C!==null){if(!(C instanceof u))try{C=u[v.responseDelimited?"decodeDelimited":"decode"](C)}catch(k){return v.emit("error",k,r),E(k)}return v.emit("data",C,r),E(null,C)}v.end(!0)})}catch(O){v.emit("error",O,r),setTimeout(function(){E(O)},0)}else setTimeout(function(){E(Error("already ended"))},0)},Xf.prototype.end=function(i){return this.rpcImpl&&(i||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var tC=xb(function(i,r){r.Service=Xf}),uC={},Gc=xb(function(i,r){function o(){u.util._configure(),u.Writer._configure(u.BufferWriter),u.Reader._configure(u.BufferReader)}var u=r;u.build="minimal",u.Writer=qj,u.BufferWriter=Lc,u.Reader=sj,u.BufferReader=be,u.util=pa,u.rpc=tC,u.roots=uC,u.configure=o,o()});Gc.util.Long=P,Gc.configure();var M=Gc.Reader,ia=Gc.Writer,D=Gc.util,I=Gc.roots.default||(Gc.roots.default={}),vC=I.URI=function(){var i={},r=Object.create(i);return r[i[0]="Unknown"]=0,r[i[1]="PingUri"]=1,r[i[2]="PongUri"]=2,r[i[11]="UserJoinUri"]=11,r[i[12]="UserRespUri"]=12,r[i[15]="UserTicketNearlyExpireUri"]=15,r[i[16]="UserRenewTokenReqUri"]=16,r[i[17]="UserRenewTokenRespUri"]=17,r[i[21]="UserQuitUri"]=21,r[i[22]="UserDropUri"]=22,r[i[31]="GroupEnterUri"]=31,r[i[32]="GroupLeaveUri"]=32,r[i[33]="GroupReplyUri"]=33,r[i[35]="GroupDropUri"]=35,r[i[36]="GroupEnterNoticeUri"]=36,r[i[37]="GroupLeaveNoticeUri"]=37,r[i[38]="GroupEventNoticeUri"]=38,r[i[39]="GroupCountNoticeUri"]=39,r[i[41]="UserStatusListUri"]=41,r[i[42]="UserStatusResultUri"]=42,r[i[51]="GroupStatusListUri"]=51,r[i[52]="GroupStatusResultUri"]=52,r[i[55]="GroupAllUsersListUri"]=55,r[i[56]="GroupAllUsersResultUri"]=56,r[i[100]="MessageUri"]=100,r[i[101]="AckUri"]=101,r[i[201]="UserJoinNoticeUri"]=201,r[i[202]="UserQuitNoticeUri"]=202,r[i[203]="UserWaitNoticeUri"]=203,r[i[301]="UserAttributeGetUri"]=301,r[i[302]="UserAttributeRetUri"]=302,r[i[303]="UserAttributeSetUri"]=303,r[i[304]="UserAttributeModUri"]=304,r[i[305]="UserAttributeDelUri"]=305,r[i[307]="UserAttributeRspUri"]=307,r[i[308]="UserAttributeErrUri"]=308,r[i[311]="UserAttributeKeysGetUri"]=311,r[i[312]="UserAttributeKeysRetUri"]=312,r[i[351]="GroupAttributeGetUri"]=351,r[i[352]="GroupAttributeRetUri"]=352,r[i[353]="GroupAttributeSetUri"]=353,r[i[354]="GroupAttributeModUri"]=354,r[i[355]="GroupAttributeDelUri"]=355,r[i[356]="GroupAttributeAltUri"]=356,r[i[357]="GroupAttributeRspUri"]=357,r[i[358]="GroupAttributeErrUri"]=358,r[i[361]="GroupAttributeKeysGetUri"]=361,r[i[362]="GroupAttributeKeysRetUri"]=362,r[i[401]="SubscribeUserStatusUri"]=401,r[i[402]="UnsubscribeUserStatusUri"]=402,r[i[499]="SubscribeResponseUri"]=499,r}(),wi=I.Wrapper=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.uri=0,i.prototype.data=D.newBuffer([]),i.encode=function(r,o){return o||(o=ia.create()),r.uri!=null&&Object.hasOwnProperty.call(r,"uri")&&o.uint32(8).int32(r.uri),r.data!=null&&Object.hasOwnProperty.call(r,"data")&&o.uint32(18).bytes(r.data),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.Wrapper;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.uri=r.int32();break;case 2:u.data=r.bytes();break;default:r.skipType(7&h)}}return u},i}(),wC=I.Ping=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&o.uint32(16).uint64(r.ms),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.Ping;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.ms=r.uint64();break;default:r.skipType(7&h)}}return u},i}(),xC=I.Pong=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&o.uint32(16).uint64(r.ms),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.Pong;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.ms=r.uint64();break;default:r.skipType(7&h)}}return u},i}(),yC=I.UserJoin=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.opt=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.ticket="",i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.opt!=null&&Object.hasOwnProperty.call(r,"opt")&&o.uint32(16).uint64(r.opt),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(24).uint64(r.instance),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(34).string(r.account),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&o.uint32(42).string(r.ticket),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserJoin;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.opt=r.uint64();break;case 3:u.instance=r.uint64();break;case 4:u.account=r.string();break;case 5:u.ticket=r.string();break;default:r.skipType(7&h)}}return u},i}(),zC=I.UserResp=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(24).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserResp;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),AC=I.UserQuit=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.encode=function(r,o){return o||(o=ia.create()),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserQuit;r.pos<o;){var h=r.uint32();r.skipType(7&h)}return u},i}(),BC=I.UserDrop=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(8).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserDrop;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),CC=I.UserTicketNearlyExpire=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.expireTs=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.ticket="",i.encode=function(r,o){return o||(o=ia.create()),r.expireTs!=null&&Object.hasOwnProperty.call(r,"expireTs")&&o.uint32(8).uint64(r.expireTs),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&o.uint32(18).string(r.ticket),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserTicketNearlyExpire;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.expireTs=r.uint64();break;case 2:u.ticket=r.string();break;default:r.skipType(7&h)}}return u},i}(),DC=I.UserRenewTokenReq=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.ticket="",i.encode=function(r,o){return o||(o=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(16).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(26).string(r.account),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&o.uint32(34).string(r.ticket),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserRenewTokenReq;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.account=r.string();break;case 4:u.ticket=r.string();break;default:r.skipType(7&h)}}return u},i}(),EC=I.UserRenewTokenResp=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(16).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserRenewTokenResp;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),FC=I.GroupEnter=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupEnter;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;default:r.skipType(7&h)}}return u},i}(),GC=I.GroupLeave=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.account="",i.encode=function(r,o){return o||(o=ia.create()),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(10).string(r.account),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupLeave;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.account=r.string();break;default:r.skipType(7&h)}}return u},i}(),HC=I.GroupReply=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(24).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupReply;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),vs=I.GroupLeaveNotice=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.prototype.group="",i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.size=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&o.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&o.uint32(40).uint32(r.size),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupLeaveNotice;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.user=r.string();break;case 3:u.group=r.string();break;case 4:u.instance=r.uint64();break;case 5:u.size=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),ws=I.GroupEnterNotice=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.prototype.group="",i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.size=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&o.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&o.uint32(40).uint32(r.size),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupEnterNotice;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.user=r.string();break;case 3:u.group=r.string();break;case 4:u.instance=r.uint64();break;case 5:u.size=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),xs=I.Message=function(){function i(r){if(this.MiscMap={},r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.options=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.src="",i.prototype.dst="",i.prototype.payload=D.newBuffer([]),i.prototype.MiscMap=D.emptyObject,i.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,o){if(o||(o=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&o.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&o.uint32(24).uint64(r.sequence),r.options!=null&&Object.hasOwnProperty.call(r,"options")&&o.uint32(32).uint64(r.options),r.src!=null&&Object.hasOwnProperty.call(r,"src")&&o.uint32(42).string(r.src),r.dst!=null&&Object.hasOwnProperty.call(r,"dst")&&o.uint32(50).string(r.dst),r.payload!=null&&Object.hasOwnProperty.call(r,"payload")&&o.uint32(58).bytes(r.payload),r.MiscMap!=null&&Object.hasOwnProperty.call(r,"MiscMap"))for(var u=Object.keys(r.MiscMap),h=0;h<u.length;++h)o.uint32(66).fork().uint32(10).string(u[h]).uint32(18).bytes(r.MiscMap[u[h]]).ldelim();return r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&o.uint32(72).uint64(r.ms),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u,h,E=new I.Message;r.pos<o;)switch(u=r.uint32(),u>>>3){case 1:E.instance=r.uint64();break;case 2:E.dialogue=r.uint64();break;case 3:E.sequence=r.uint64();break;case 4:E.options=r.uint64();break;case 5:E.src=r.string();break;case 6:E.dst=r.string();break;case 7:E.payload=r.bytes();break;case 8:E.MiscMap===D.emptyObject&&(E.MiscMap={});var v=r.uint32()+r.pos;for(u="",h=[];r.pos<v;){var O=r.uint32();switch(O>>>3){case 1:u=r.string();break;case 2:h=r.bytes();break;default:r.skipType(7&O)}}E.MiscMap[u]=h;break;case 9:E.ms=r.uint64();break;default:r.skipType(7&u)}return E},i}(),ys=I.Ack=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&o.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&o.uint32(24).uint64(r.sequence),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(32).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.Ack;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.instance=r.uint64();break;case 2:u.dialogue=r.uint64();break;case 3:u.sequence=r.uint64();break;case 4:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),IC=I.GroupDrop=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.account="",i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(10).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(16).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupDrop;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.account=r.string();break;case 2:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),JC=I.GroupAllUsersList=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.pageSize=0,i.prototype.pageNumber=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&o.uint32(24).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&o.uint32(32).uint32(r.pageNumber),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAllUsersList;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.pageSize=r.uint32();break;case 4:u.pageNumber=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),KC=I.GroupAllUsersResult=function(){function i(r){if(this.memberInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.totalSize=0,i.prototype.pageSize=0,i.prototype.pageNumber=0,i.prototype.memberInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),r.totalSize!=null&&Object.hasOwnProperty.call(r,"totalSize")&&o.uint32(24).uint32(r.totalSize),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&o.uint32(32).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&o.uint32(40).uint32(r.pageNumber),r.memberInfos!=null&&r.memberInfos.length)for(var u=0;u<r.memberInfos.length;++u)I.GroupAllUsersResult.MemberInfo.encode(r.memberInfos[u],o.uint32(50).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAllUsersResult;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.totalSize=r.uint32();break;case 4:u.pageSize=r.uint32();break;case 5:u.pageNumber=r.uint32();break;case 6:u.memberInfos&&u.memberInfos.length||(u.memberInfos=[]),u.memberInfos.push(I.GroupAllUsersResult.MemberInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.MemberInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(o,u){return u||(u=ia.create()),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&u.uint32(10).string(o.account),o.ts!=null&&Object.hasOwnProperty.call(o,"ts")&&u.uint32(16).uint32(o.ts),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.GroupAllUsersResult.MemberInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.account=o.string();break;case 2:h.ts=o.uint32();break;default:o.skipType(7&E)}}return h},r}(),i}(),LC=I.UserStatusList=function(){function i(r){if(this.users=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.users=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var u=0;u<r.users.length;++u)o.uint32(18).string(r.users[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserStatusList;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.users&&u.users.length||(u.users=[]),u.users.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),MC=I.UserStatusResult=function(){function i(r){if(this.userInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.userInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.userInfos!=null&&r.userInfos.length)for(var u=0;u<r.userInfos.length;++u)I.UserStatusResult.UserStatusInfo.encode(r.userInfos[u],o.uint32(18).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserStatusResult;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.userInfos&&u.userInfos.length||(u.userInfos=[]),u.userInfos.push(I.UserStatusResult.UserStatusInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.UserStatusInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(o,u){return u||(u=ia.create()),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&u.uint32(10).string(o.account),o.ts!=null&&Object.hasOwnProperty.call(o,"ts")&&u.uint32(16).uint32(o.ts),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.UserStatusResult.UserStatusInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.account=o.string();break;case 2:h.ts=o.uint32();break;default:o.skipType(7&E)}}return h},r}(),i}(),NC=I.UserAttributeGet=function(){function i(r){if(this.attributes=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributes=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)o.uint32(26).string(r.attributes[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeGet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),OC=I.UserAttributeRet=function(){function i(r){if(this.attributeInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.UserAttributeRet.AttributeInfo.encode(r.attributeInfos[u],o.uint32(18).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeRet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.UserAttributeRet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.AttributeInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(o,u){return u||(u=ia.create()),o.key!=null&&Object.hasOwnProperty.call(o,"key")&&u.uint32(10).string(o.key),o.value!=null&&Object.hasOwnProperty.call(o,"value")&&u.uint32(18).string(o.value),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.UserAttributeRet.AttributeInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.key=o.string();break;case 2:h.value=o.string();break;default:o.skipType(7&E)}}return h},r}(),i}(),PC=I.UserAttributeSet=function(){function i(r){if(this.attributeInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.UserAttributeSet.AttributeInfo.encode(r.attributeInfos[u],o.uint32(26).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeSet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.UserAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.AttributeInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(o,u){return u||(u=ia.create()),o.key!=null&&Object.hasOwnProperty.call(o,"key")&&u.uint32(10).string(o.key),o.value!=null&&Object.hasOwnProperty.call(o,"value")&&u.uint32(18).string(o.value),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.UserAttributeSet.AttributeInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.key=o.string();break;case 2:h.value=o.string();break;default:o.skipType(7&E)}}return h},r}(),i}(),QC=I.UserAttributeMod=function(){function i(r){if(this.attributeInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.UserAttributeMod.AttributeInfo.encode(r.attributeInfos[u],o.uint32(26).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeMod;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.UserAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.AttributeInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(o,u){return u||(u=ia.create()),o.key!=null&&Object.hasOwnProperty.call(o,"key")&&u.uint32(10).string(o.key),o.value!=null&&Object.hasOwnProperty.call(o,"value")&&u.uint32(18).string(o.value),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.UserAttributeMod.AttributeInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.key=o.string();break;case 2:h.value=o.string();break;default:o.skipType(7&E)}}return h},r}(),i}(),RC=I.UserAttributeDel=function(){function i(r){if(this.attributes=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.prototype.attributes=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)o.uint32(26).string(r.attributes[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeDel;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;case 3:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),SC=I.UserAttributeErr=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(16).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeErr;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),TC=I.UserAttributeKeysGet=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.account="",i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&o.uint32(18).string(r.account),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeKeysGet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.account=r.string();break;default:r.skipType(7&h)}}return u},i}(),UC=I.UserAttributeKeysRet=function(){function i(r){if(this.keys=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.keys=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var u=0;u<r.keys.length;++u)o.uint32(18).string(r.keys[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeKeysRet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.keys&&u.keys.length||(u.keys=[]),u.keys.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),VC=I.UserAttributeRsp=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserAttributeRsp;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;default:r.skipType(7&h)}}return u},i}(),WC=I.GroupStatusList=function(){function i(r){if(this.groups=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.groups=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.groups!=null&&r.groups.length)for(var u=0;u<r.groups.length;++u)o.uint32(18).string(r.groups[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupStatusList;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.groups&&u.groups.length||(u.groups=[]),u.groups.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),XC=I.GroupStatusResult=function(){function i(r){if(this.groupInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.groupInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.groupInfos!=null&&r.groupInfos.length)for(var u=0;u<r.groupInfos.length;++u)I.GroupStatusResult.GroupInfo.encode(r.groupInfos[u],o.uint32(18).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupStatusResult;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.groupInfos&&u.groupInfos.length||(u.groupInfos=[]),u.groupInfos.push(I.GroupStatusResult.GroupInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.GroupInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.group="",r.prototype.memberCount=0,r.encode=function(o,u){return u||(u=ia.create()),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&u.uint32(10).string(o.group),o.memberCount!=null&&Object.hasOwnProperty.call(o,"memberCount")&&u.uint32(16).uint32(o.memberCount),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.GroupStatusResult.GroupInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.group=o.string();break;case 2:h.memberCount=o.uint32();break;default:o.skipType(7&E)}}return h},r}(),i}(),YC=I.GroupCountNotice=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.size=0,i.encode=function(r,o){return o||(o=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(16).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(26).string(r.group),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&o.uint32(32).uint32(r.size),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupCountNotice;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.group=r.string();break;case 4:u.size=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),ZC=I.GroupAttributeGet=function(){function i(r){if(this.attributes=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.attributes=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)o.uint32(26).string(r.attributes[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeGet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),$C=I.GroupAttributeRet=function(){function i(r){if(this.attributeMaps=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.attributeMaps=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.attributeMaps!=null&&r.attributeMaps.length)for(var u=0;u<r.attributeMaps.length;++u)I.GroupAttributeRet.AttributeMap.encode(r.attributeMaps[u],o.uint32(18).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeRet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.attributeMaps&&u.attributeMaps.length||(u.attributeMaps=[]),u.attributeMaps.push(I.GroupAttributeRet.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.AttributeMap=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,r.encode=function(o,u){return u||(u=ia.create()),o.key!=null&&Object.hasOwnProperty.call(o,"key")&&u.uint32(10).string(o.key),o.value!=null&&Object.hasOwnProperty.call(o,"value")&&u.uint32(18).string(o.value),o.origin!=null&&Object.hasOwnProperty.call(o,"origin")&&u.uint32(26).string(o.origin),o.ms!=null&&Object.hasOwnProperty.call(o,"ms")&&u.uint32(32).uint64(o.ms),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.GroupAttributeRet.AttributeMap;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.key=o.string();break;case 2:h.value=o.string();break;case 3:h.origin=o.string();break;case 4:h.ms=o.uint64();break;default:o.skipType(7&E)}}return h},r}(),i}(),aD=I.GroupAttributeSet=function(){function i(r){if(this.attributeInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.broadcast=!1,i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&o.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.GroupAttributeSet.AttributeInfo.encode(r.attributeInfos[u],o.uint32(34).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeSet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.broadcast=r.bool();break;case 4:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.GroupAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.AttributeInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(o,u){return u||(u=ia.create()),o.key!=null&&Object.hasOwnProperty.call(o,"key")&&u.uint32(10).string(o.key),o.value!=null&&Object.hasOwnProperty.call(o,"value")&&u.uint32(18).string(o.value),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.GroupAttributeSet.AttributeInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.key=o.string();break;case 2:h.value=o.string();break;default:o.skipType(7&E)}}return h},r}(),i}(),bD=I.GroupAttributeMod=function(){function i(r){if(this.attributeInfos=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.broadcast=!1,i.prototype.attributeInfos=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&o.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var u=0;u<r.attributeInfos.length;++u)I.GroupAttributeMod.AttributeInfo.encode(r.attributeInfos[u],o.uint32(34).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeMod;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.broadcast=r.bool();break;case 4:u.attributeInfos&&u.attributeInfos.length||(u.attributeInfos=[]),u.attributeInfos.push(I.GroupAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.AttributeInfo=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.key="",r.prototype.value="",r.encode=function(o,u){return u||(u=ia.create()),o.key!=null&&Object.hasOwnProperty.call(o,"key")&&u.uint32(10).string(o.key),o.value!=null&&Object.hasOwnProperty.call(o,"value")&&u.uint32(18).string(o.value),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.GroupAttributeMod.AttributeInfo;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.key=o.string();break;case 2:h.value=o.string();break;default:o.skipType(7&E)}}return h},r}(),i}(),cD=I.GroupAttributeDel=function(){function i(r){if(this.attributes=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.broadcast=!1,i.prototype.attributes=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&o.uint32(24).bool(r.broadcast),r.attributes!=null&&r.attributes.length)for(var u=0;u<r.attributes.length;++u)o.uint32(34).string(r.attributes[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeDel;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.broadcast=r.bool();break;case 4:u.attributes&&u.attributes.length||(u.attributes=[]),u.attributes.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),dD=I.GroupAttributeAlt=function(){function i(r){if(this.attributeMaps=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.attributeMaps=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(24).uint64(r.instance),r.attributeMaps!=null&&r.attributeMaps.length)for(var u=0;u<r.attributeMaps.length;++u)I.GroupAttributeAlt.AttributeMap.encode(r.attributeMaps[u],o.uint32(34).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeAlt;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;case 3:u.instance=r.uint64();break;case 4:u.attributeMaps&&u.attributeMaps.length||(u.attributeMaps=[]),u.attributeMaps.push(I.GroupAttributeAlt.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.AttributeMap=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,r.encode=function(o,u){return u||(u=ia.create()),o.key!=null&&Object.hasOwnProperty.call(o,"key")&&u.uint32(10).string(o.key),o.value!=null&&Object.hasOwnProperty.call(o,"value")&&u.uint32(18).string(o.value),o.origin!=null&&Object.hasOwnProperty.call(o,"origin")&&u.uint32(26).string(o.origin),o.ms!=null&&Object.hasOwnProperty.call(o,"ms")&&u.uint32(32).uint64(o.ms),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.GroupAttributeAlt.AttributeMap;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.key=o.string();break;case 2:h.value=o.string();break;case 3:h.origin=o.string();break;case 4:h.ms=o.uint64();break;default:o.skipType(7&E)}}return h},r}(),i}(),eD=I.GroupAttributeRsp=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeRsp;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;default:r.skipType(7&h)}}return u},i}(),fD=I.GroupAttributeErr=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.code=0,i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(16).uint32(r.code),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeErr;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.code=r.uint32();break;default:r.skipType(7&h)}}return u},i}(),gD=I.GroupAttributeKeysGet=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.group="",i.encode=function(r,o){return o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&o.uint32(18).string(r.group),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeKeysGet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.group=r.string();break;default:r.skipType(7&h)}}return u},i}(),hD=I.GroupAttributeKeysRet=function(){function i(r){if(this.keys=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.keys=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var u=0;u<r.keys.length;++u)o.uint32(18).string(r.keys[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.GroupAttributeKeysRet;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.keys&&u.keys.length||(u.keys=[]),u.keys.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),iD=I.SubscribeUserStatus=function(){function i(r){if(this.users=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.users=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var u=0;u<r.users.length;++u)o.uint32(18).string(r.users[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.SubscribeUserStatus;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.users&&u.users.length||(u.users=[]),u.users.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),jD=I.UnsubscribeUserStatus=function(){function i(r){if(this.users=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.users=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var u=0;u<r.users.length;++u)o.uint32(18).string(r.users[u]);return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UnsubscribeUserStatus;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.users&&u.users.length||(u.users=[]),u.users.push(r.string());break;default:r.skipType(7&h)}}return u},i}(),kD=I.UserJoinNotice=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.encode=function(r,o){return o||(o=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&o.uint32(26).string(r.user),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserJoinNotice;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.user=r.string();break;default:r.skipType(7&h)}}return u},i}(),lD=I.UserQuitNotice=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.encode=function(r,o){return o||(o=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&o.uint32(26).string(r.user),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserQuitNotice;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.user=r.string();break;default:r.skipType(7&h)}}return u},i}(),mD=I.UserWaitNotice=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.user="",i.encode=function(r,o){return o||(o=ia.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&o.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&o.uint32(26).string(r.user),o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.UserWaitNotice;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.instance=r.uint64();break;case 2:u.seq=r.uint64();break;case 3:u.user=r.string();break;default:r.skipType(7&h)}}return u},i}(),nD=I.SubscribeResponse=function(){function i(r){if(this.errors=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,i.prototype.errors=D.emptyArray,i.encode=function(r,o){if(o||(o=ia.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&o.uint32(8).uint64(r.seq),r.errors!=null&&r.errors.length)for(var u=0;u<r.errors.length;++u)I.SubscribeResponse.SubscribeErrorsType.encode(r.errors[u],o.uint32(18).fork()).ldelim();return o},i.decode=function(r,o){r instanceof M||(r=M.create(r)),o=o===void 0?r.len:r.pos+o;for(var u=new I.SubscribeResponse;r.pos<o;){var h=r.uint32();switch(h>>>3){case 1:u.seq=r.uint64();break;case 2:u.errors&&u.errors.length||(u.errors=[]),u.errors.push(I.SubscribeResponse.SubscribeErrorsType.decode(r,r.uint32()));break;default:r.skipType(7&h)}}return u},i.SubscribeErrorsType=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.account="",r.prototype.code=0,r.encode=function(o,u){return u||(u=ia.create()),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&u.uint32(10).string(o.account),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&u.uint32(16).uint32(o.code),u},r.decode=function(o,u){o instanceof M||(o=M.create(o)),u=u===void 0?o.len:o.pos+u;for(var h=new I.SubscribeResponse.SubscribeErrorsType;o.pos<u;){var E=o.uint32();switch(E>>>3){case 1:h.account=o.string();break;case 2:h.code=o.uint32();break;default:o.skipType(7&E)}}return h},r}(),i}(),oD=Object.freeze({__proto__:null,URI:vC,Wrapper:wi,Ping:wC,Pong:xC,UserJoin:yC,UserResp:zC,UserQuit:AC,UserDrop:BC,UserTicketNearlyExpire:CC,UserRenewTokenReq:DC,UserRenewTokenResp:EC,GroupEnter:FC,GroupLeave:GC,GroupReply:HC,GroupLeaveNotice:vs,GroupEnterNotice:ws,Message:xs,Ack:ys,GroupDrop:IC,GroupAllUsersList:JC,GroupAllUsersResult:KC,UserStatusList:LC,UserStatusResult:MC,UserAttributeGet:NC,UserAttributeRet:OC,UserAttributeSet:PC,UserAttributeMod:QC,UserAttributeDel:RC,UserAttributeErr:SC,UserAttributeKeysGet:TC,UserAttributeKeysRet:UC,UserAttributeRsp:VC,GroupStatusList:WC,GroupStatusResult:XC,GroupCountNotice:YC,GroupAttributeGet:ZC,GroupAttributeRet:$C,GroupAttributeSet:aD,GroupAttributeMod:bD,GroupAttributeDel:cD,GroupAttributeAlt:dD,GroupAttributeRsp:eD,GroupAttributeErr:fD,GroupAttributeKeysGet:gD,GroupAttributeKeysRet:hD,SubscribeUserStatus:iD,UnsubscribeUserStatus:jD,UserJoinNotice:kD,UserQuitNotice:lD,UserWaitNotice:mD,SubscribeResponse:nD,default:I}),pD=Math.ceil,zs=function(i){return function(r,o,u){var h=(r=String(Eb(r))).length;return u=u===void 0?" ":String(u),(o=Ma(o))<=h||u==""?r:(o-=h,(h=Yo.call(u,pD(o/u.length))).length>o&&(h=h.slice(0,o)),i?r+h:h+r)}},qD=zs(!1),rD=zs(!0),As=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(df);ea({target:"String",proto:!0,forced:As},{padEnd:function(i){return rD(this,i,1<arguments.length?arguments[1]:void 0)}});var sD=eg,Bs=function(i){return function(r){r=Mb(r);for(var o,u=ed(r),h=u.length,E=0,v=[];h>E;)o=u[E++],wa&&!sD.call(r,o)||v.push(i?[o,r[o]]:r[o]);return v}},tD=Bs(!0),uD=Bs(!1);ea({target:"Object",stat:!0},{entries:function(i){return tD(i)}});var vD=dc.f,Cs="".endsWith,wD=Math.min,Ds=Qk("endsWith"),xD=!Ds&&!!function(){var i=vD(String.prototype,"endsWith");return i&&!i.writable}();ea({target:"String",proto:!0,forced:!xD&&!Ds},{endsWith:function(i){var r=String(Eb(this));Pk(i);var o=1<arguments.length?arguments[1]:void 0,u=Ma(r.length);return o=o===void 0?u:wD(Ma(o),u),u=String(i),Cs?Cs.call(r,u,o):r.slice(o-u.length,o)===u}}),Bh("match",1,function(i,r,o){return[function(u){var h=Eb(this),E=u==null?void 0:u[i];return E!==void 0?E.call(u,h):new RegExp(u)[i](String(h))},function(u){var h=o(r,u,this);if(h.done)return h.value;if(u=Ia(u),h=String(this),!u.global)return ef(u,h);var E=u.unicode;u.lastIndex=0;for(var v,O=[],C=0;(v=ef(u,h))!==null;)v=String(v[0]),O[C]=v,v===""&&(u.lastIndex=Mj(h,Ma(u.lastIndex),E)),C++;return C===0?null:O}]});var yD=dc.f,Es="".startsWith,zD=Math.min,Fs=Qk("startsWith"),AD=!Fs&&!!function(){var i=yD(String.prototype,"startsWith");return i&&!i.writable}();ea({target:"String",proto:!0,forced:!AD&&!Fs},{startsWith:function(i){var r=String(Eb(this));Pk(i);var o=Ma(zD(1<arguments.length?arguments[1]:void 0,r.length)),u=String(i);return Es?Es.call(r,u,o):r.slice(o,o+u.length)===u}});var Wn=function(i){var r=/(%?)(%([jds]))/g,o=Array.prototype.slice.call(arguments,1);return o.length&&(i=i.replace(r,function(u,h,E,v){switch(E=o.shift(),v){case"s":E=""+E;break;case"d":E=Number(E);break;case"j":E=JSON.stringify(E)}return h?(o.unshift(E),u):E})),o.length&&(i+=" "+o.join(" ")),""+(i=i.replace(/%{2,2}/g,"%"))},BD=/\s/,CD=/^\s+/,Gs=NaN,DD=/^[-+]0x[0-9a-f]+$/i,ED=/^0b[01]+$/i,FD=/^0o[0-7]+$/i,GD=parseInt,xi=function(i){if(typeof i=="number")return i;if(Ke(i))return Gs;if(Gb(i)&&(i=typeof i.valueOf=="function"?i.valueOf():i,i=Gb(i)?i+"":i),typeof i!="string")return i===0?i:+i;if(i){for(var r=i.slice,o=i.length;o--&&BD.test(i.charAt(o)););i=r.call(i,0,o+1).replace(CD,"")}return(r=ED.test(i))||FD.test(i)?GD(i.slice(2),r?2:8):DD.test(i)?Gs:+i},HD=Math.max,ID=Math.min,JD=function(i,r,o){function u(_h){var _f=C,E_=k;return C=k=void 0,_e=_h,j=i.apply(E_,_f)}function h(_h){var _f=_h-$;return _h-=_e,$===void 0||_f>=r||0>_f||_c&&_h>=_s}function E(){var _h=$b.Date.now();if(h(_h))return v(_h);var _f=setTimeout,E_=_h-_e;_h=r-(_h-$),E_=_c?ID(_h,_s-E_):_h,K=_f(E,E_)}function v(_h){return K=void 0,_a&&C?u(_h):(C=k=void 0,j)}function O(){var _h=$b.Date.now(),_f=h(_h);if(C=arguments,k=this,$=_h,_f){if(K===void 0)return _e=_h=$,K=setTimeout(E,r),na?u(_h):j;if(_c)return clearTimeout(K),K=setTimeout(E,r),u($)}return K===void 0&&(K=setTimeout(E,r)),j}var C,k,j,K,$,_e=0,na=!1,_c=!1,_a=!0;if(typeof i!="function")throw new TypeError("Expected a function");if(r=xi(r)||0,Gb(o)){na=!!o.leading;var _s=(_c="maxWait"in o)?HD(xi(o.maxWait)||0,r):_s;_a="trailing"in o?!!o.trailing:_a}return O.cancel=function(){K!==void 0&&clearTimeout(K),_e=0,C=$=k=K=void 0},O.flush=function(){return K===void 0?j:v($b.Date.now())},O},KD=Math.max,LD=Math.min,Hs=1/0,Rl=function(i){return i?(i=xi(i))===Hs||i===-1/0?17976931348623157e292*(0>i?-1:1):i==i?i:0:i===0?i:0},Is=function(i,r,o){return r=Rl(r),o===void 0?(o=r,r=0):o=Rl(o),(i=xi(i))>=LD(r,o)&&i<KD(r,o)},ac=Gc.Writer,H=Gc.util,Pb=Gc.roots.default||(Gc.roots.default={}),MD=Pb.Session=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.appId="",i.prototype.ver="",i.prototype.buildno=0,i.prototype.installId="",i.prototype.os=0,i.prototype.did="",i.prototype.index=null,i.prototype.token="",i.prototype.version=0,i.prototype.subVersion=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.appId!=null&&Object.hasOwnProperty.call(r,"appId")&&o.uint32(42).string(r.appId),r.ver!=null&&Object.hasOwnProperty.call(r,"ver")&&o.uint32(50).string(r.ver),r.buildno!=null&&Object.hasOwnProperty.call(r,"buildno")&&o.uint32(56).int32(r.buildno),r.installId!=null&&Object.hasOwnProperty.call(r,"installId")&&o.uint32(66).string(r.installId),r.os!=null&&Object.hasOwnProperty.call(r,"os")&&o.uint32(128).int32(r.os),r.did!=null&&Object.hasOwnProperty.call(r,"did")&&o.uint32(138).string(r.did),r.index!=null&&Object.hasOwnProperty.call(r,"index")&&Pb.Session.CommonIndex.encode(r.index,o.uint32(162).fork()).ldelim(),r.token!=null&&Object.hasOwnProperty.call(r,"token")&&o.uint32(170).string(r.token),r.version!=null&&Object.hasOwnProperty.call(r,"version")&&o.uint32(176).int32(r.version),r.subVersion!=null&&Object.hasOwnProperty.call(r,"subVersion")&&o.uint32(184).int32(r.subVersion),o},i.CommonIndex=function(){function r(o){if(o)for(var u=Object.keys(o),h=0;h<u.length;++h)o[u[h]]!=null&&(this[u[h]]=o[u[h]])}return r.prototype.index1="",r.prototype.index2="",r.prototype.index3="",r.encode=function(o,u){return u||(u=ac.create()),o.index1!=null&&Object.hasOwnProperty.call(o,"index1")&&u.uint32(10).string(o.index1),o.index2!=null&&Object.hasOwnProperty.call(o,"index2")&&u.uint32(18).string(o.index2),o.index3!=null&&Object.hasOwnProperty.call(o,"index3")&&u.uint32(26).string(o.index3),u},r}(),i}(),ND=Pb.ApEvent=function(){function i(r){if(this.linkServerList=[],r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.apAddr="",i.prototype.linkServerList=H.emptyArray,i.prototype.errCode=0,i.prototype.serverErrCode=0,i.prototype.isp="",i.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.envId=0,i.prototype.flag=0,i.prototype.area="",i.encode=function(r,o){if(o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.apAddr!=null&&Object.hasOwnProperty.call(r,"apAddr")&&o.uint32(50).string(r.apAddr),r.linkServerList!=null&&r.linkServerList.length)for(var u=0;u<r.linkServerList.length;++u)o.uint32(58).string(r.linkServerList[u]);return r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&o.uint32(72).int32(r.errCode),r.serverErrCode!=null&&Object.hasOwnProperty.call(r,"serverErrCode")&&o.uint32(80).int32(r.serverErrCode),r.isp!=null&&Object.hasOwnProperty.call(r,"isp")&&o.uint32(90).string(r.isp),r.opId!=null&&Object.hasOwnProperty.call(r,"opId")&&o.uint32(96).int64(r.opId),r.envId!=null&&Object.hasOwnProperty.call(r,"envId")&&o.uint32(104).int32(r.envId),r.flag!=null&&Object.hasOwnProperty.call(r,"flag")&&o.uint32(112).int32(r.flag),r.area!=null&&Object.hasOwnProperty.call(r,"area")&&o.uint32(122).string(r.area),o},i}(),OD=Pb.ApRequest=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.apAddr="",i.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.envId=0,i.prototype.flag=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.apAddr!=null&&Object.hasOwnProperty.call(r,"apAddr")&&o.uint32(42).string(r.apAddr),r.opId!=null&&Object.hasOwnProperty.call(r,"opId")&&o.uint32(48).int64(r.opId),r.envId!=null&&Object.hasOwnProperty.call(r,"envId")&&o.uint32(56).int32(r.envId),r.flag!=null&&Object.hasOwnProperty.call(r,"flag")&&o.uint32(64).int32(r.flag),o},i}(),PD=Pb.LinkLoginRequest=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.destServerIp="",i.prototype.linkId=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.destServerIp!=null&&Object.hasOwnProperty.call(r,"destServerIp")&&o.uint32(42).string(r.destServerIp),r.linkId!=null&&Object.hasOwnProperty.call(r,"linkId")&&o.uint32(48).int32(r.linkId),o},i}(),QD=Pb.Link=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.ec=0,i.prototype.sc=0,i.prototype.destServerIp="",i.prototype.ackedServerIp="",i.prototype.responseTime=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.ec!=null&&Object.hasOwnProperty.call(r,"ec")&&o.uint32(40).int32(r.ec),r.sc!=null&&Object.hasOwnProperty.call(r,"sc")&&o.uint32(48).int32(r.sc),r.destServerIp!=null&&Object.hasOwnProperty.call(r,"destServerIp")&&o.uint32(58).string(r.destServerIp),r.ackedServerIp!=null&&Object.hasOwnProperty.call(r,"ackedServerIp")&&o.uint32(66).string(r.ackedServerIp),r.responseTime!=null&&Object.hasOwnProperty.call(r,"responseTime")&&o.uint32(72).int32(r.responseTime),o},i}(),RD=Pb.Logout=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),o},i}(),SD=Pb.KickedOff=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.linkId=0,i.prototype.code=0,i.prototype.server="",i.prototype.serverCode=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.linkId!=null&&Object.hasOwnProperty.call(r,"linkId")&&o.uint32(48).int32(r.linkId),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&o.uint32(56).int32(r.code),r.server!=null&&Object.hasOwnProperty.call(r,"server")&&o.uint32(66).string(r.server),r.serverCode!=null&&Object.hasOwnProperty.call(r,"serverCode")&&o.uint32(72).int32(r.serverCode),o},i}(),TD=Pb.ChnJoin=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.cname="",i.prototype.errCode=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&o.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&o.uint32(56).int32(r.errCode),o},i}(),UD=Pb.ChnJoinRes=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.cname="",i.prototype.errCode=0,i.prototype.serverErrCode=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&o.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&o.uint32(56).int32(r.errCode),r.serverErrCode!=null&&Object.hasOwnProperty.call(r,"serverErrCode")&&o.uint32(64).int32(r.serverErrCode),o},i}(),VD=Pb.ChnLeave=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.cname="",i.prototype.errCode=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&o.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&o.uint32(56).int32(r.errCode),o},i}(),WD=Pb.ConnectionStateChange=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.sid="",i.prototype.userId="",i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.oldState=0,i.prototype.newState=0,i.prototype.reason=0,i.prototype.reconnId=0,i.encode=function(r,o){return o||(o=ac.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&o.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&o.uint32(32).int64(r.elapse),r.oldState!=null&&Object.hasOwnProperty.call(r,"oldState")&&o.uint32(40).int32(r.oldState),r.newState!=null&&Object.hasOwnProperty.call(r,"newState")&&o.uint32(48).int32(r.newState),r.reason!=null&&Object.hasOwnProperty.call(r,"reason")&&o.uint32(56).int32(r.reason),r.reconnId!=null&&Object.hasOwnProperty.call(r,"reconnId")&&o.uint32(64).int32(r.reconnId),o},i}(),Js=Pb.RtmSdkMessageCount=function(){function i(r){if(r)for(var o=Object.keys(r),u=0;u<o.length;++u)r[o[u]]!=null&&(this[o[u]]=r[o[u]])}return i.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.vid=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.sid="",i.prototype.messagecategory=0,i.prototype.reportsequence=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.sentcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.receivedcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.peerackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.norecipientackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.acktimeoutcount=H.Long?H.Long.fromBits(0,0,!1):0,i.prototype.apimajorversion=0,i.prototype.apiminorversion=0,i.prototype.os=0,i.prototype.toooftencount=0,i.prototype.receiverofflinecount=0,i.prototype.invalidmessagecount=0,i.prototype.unknowerrorcount=0,i.prototype.servercachedcount=0,i.prototype.timeoutcount=0,i.prototype.successcount=0,i.prototype.userid="",i.encode=function(r,o){return o||(o=ac.create()),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&o.uint32(8).int64(r.lts),r.vid!=null&&Object.hasOwnProperty.call(r,"vid")&&o.uint32(16).int64(r.vid),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&o.uint32(26).string(r.sid),r.messagecategory!=null&&Object.hasOwnProperty.call(r,"messagecategory")&&o.uint32(32).int32(r.messagecategory),r.reportsequence!=null&&Object.hasOwnProperty.call(r,"reportsequence")&&o.uint32(40).int64(r.reportsequence),r.sentcount!=null&&Object.hasOwnProperty.call(r,"sentcount")&&o.uint32(48).int64(r.sentcount),r.receivedcount!=null&&Object.hasOwnProperty.call(r,"receivedcount")&&o.uint32(56).int64(r.receivedcount),r.peerack10mscount!=null&&Object.hasOwnProperty.call(r,"peerack10mscount")&&o.uint32(64).int64(r.peerack10mscount),r.peerack25mscount!=null&&Object.hasOwnProperty.call(r,"peerack25mscount")&&o.uint32(72).int64(r.peerack25mscount),r.peerack50mscount!=null&&Object.hasOwnProperty.call(r,"peerack50mscount")&&o.uint32(80).int64(r.peerack50mscount),r.peerack75mscount!=null&&Object.hasOwnProperty.call(r,"peerack75mscount")&&o.uint32(88).int64(r.peerack75mscount),r.peerack100mscount!=null&&Object.hasOwnProperty.call(r,"peerack100mscount")&&o.uint32(96).int64(r.peerack100mscount),r.peerack150mscount!=null&&Object.hasOwnProperty.call(r,"peerack150mscount")&&o.uint32(104).int64(r.peerack150mscount),r.peerack200mscount!=null&&Object.hasOwnProperty.call(r,"peerack200mscount")&&o.uint32(112).int64(r.peerack200mscount),r.peerack250mscount!=null&&Object.hasOwnProperty.call(r,"peerack250mscount")&&o.uint32(120).int64(r.peerack250mscount),r.peerack300mscount!=null&&Object.hasOwnProperty.call(r,"peerack300mscount")&&o.uint32(128).int64(r.peerack300mscount),r.peerack400mscount!=null&&Object.hasOwnProperty.call(r,"peerack400mscount")&&o.uint32(136).int64(r.peerack400mscount),r.peerack500mscount!=null&&Object.hasOwnProperty.call(r,"peerack500mscount")&&o.uint32(144).int64(r.peerack500mscount),r.peerack600mscount!=null&&Object.hasOwnProperty.call(r,"peerack600mscount")&&o.uint32(152).int64(r.peerack600mscount),r.peerack800mscount!=null&&Object.hasOwnProperty.call(r,"peerack800mscount")&&o.uint32(160).int64(r.peerack800mscount),r.peerack1000mscount!=null&&Object.hasOwnProperty.call(r,"peerack1000mscount")&&o.uint32(168).int64(r.peerack1000mscount),r.peerack2000mscount!=null&&Object.hasOwnProperty.call(r,"peerack2000mscount")&&o.uint32(176).int64(r.peerack2000mscount),r.peerack3000mscount!=null&&Object.hasOwnProperty.call(r,"peerack3000mscount")&&o.uint32(184).int64(r.peerack3000mscount),r.peerack5000mscount!=null&&Object.hasOwnProperty.call(r,"peerack5000mscount")&&o.uint32(192).int64(r.peerack5000mscount),r.peerack7000mscount!=null&&Object.hasOwnProperty.call(r,"peerack7000mscount")&&o.uint32(200).int64(r.peerack7000mscount),r.peerackslowcount!=null&&Object.hasOwnProperty.call(r,"peerackslowcount")&&o.uint32(208).int64(r.peerackslowcount),r.norecipientack10mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack10mscount")&&o.uint32(216).int64(r.norecipientack10mscount),r.norecipientack25mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack25mscount")&&o.uint32(224).int64(r.norecipientack25mscount),r.norecipientack50mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack50mscount")&&o.uint32(232).int64(r.norecipientack50mscount),r.norecipientack75mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack75mscount")&&o.uint32(240).int64(r.norecipientack75mscount),r.norecipientack100mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack100mscount")&&o.uint32(248).int64(r.norecipientack100mscount),r.norecipientack150mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack150mscount")&&o.uint32(256).int64(r.norecipientack150mscount),r.norecipientack200mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack200mscount")&&o.uint32(264).int64(r.norecipientack200mscount),r.norecipientack250mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack250mscount")&&o.uint32(272).int64(r.norecipientack250mscount),r.norecipientack300mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack300mscount")&&o.uint32(280).int64(r.norecipientack300mscount),r.norecipientack400mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack400mscount")&&o.uint32(288).int64(r.norecipientack400mscount),r.norecipientack500mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack500mscount")&&o.uint32(296).int64(r.norecipientack500mscount),r.norecipientack600mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack600mscount")&&o.uint32(304).int64(r.norecipientack600mscount),r.norecipientack800mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack800mscount")&&o.uint32(312).int64(r.norecipientack800mscount),r.norecipientack1000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack1000mscount")&&o.uint32(320).int64(r.norecipientack1000mscount),r.norecipientack2000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack2000mscount")&&o.uint32(328).int64(r.norecipientack2000mscount),r.norecipientack3000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack3000mscount")&&o.uint32(336).int64(r.norecipientack3000mscount),r.norecipientack5000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack5000mscount")&&o.uint32(344).int64(r.norecipientack5000mscount),r.norecipientack7000mscount!=null&&Object.hasOwnProperty.call(r,"norecipientack7000mscount")&&o.uint32(352).int64(r.norecipientack7000mscount),r.norecipientackslowcount!=null&&Object.hasOwnProperty.call(r,"norecipientackslowcount")&&o.uint32(360).int64(r.norecipientackslowcount),r.acktimeoutcount!=null&&Object.hasOwnProperty.call(r,"acktimeoutcount")&&o.uint32(368).int64(r.acktimeoutcount),r.apimajorversion!=null&&Object.hasOwnProperty.call(r,"apimajorversion")&&o.uint32(376).int32(r.apimajorversion),r.apiminorversion!=null&&Object.hasOwnProperty.call(r,"apiminorversion")&&o.uint32(384).int32(r.apiminorversion),r.os!=null&&Object.hasOwnProperty.call(r,"os")&&o.uint32(392).int32(r.os),r.toooftencount!=null&&Object.hasOwnProperty.call(r,"toooftencount")&&o.uint32(400).int32(r.toooftencount),r.receiverofflinecount!=null&&Object.hasOwnProperty.call(r,"receiverofflinecount")&&o.uint32(408).int32(r.receiverofflinecount),r.invalidmessagecount!=null&&Object.hasOwnProperty.call(r,"invalidmessagecount")&&o.uint32(416).int32(r.invalidmessagecount),r.unknowerrorcount!=null&&Object.hasOwnProperty.call(r,"unknowerrorcount")&&o.uint32(424).int32(r.unknowerrorcount),r.servercachedcount!=null&&Object.hasOwnProperty.call(r,"servercachedcount")&&o.uint32(432).int32(r.servercachedcount),r.timeoutcount!=null&&Object.hasOwnProperty.call(r,"timeoutcount")&&o.uint32(440).int32(r.timeoutcount),r.successcount!=null&&Object.hasOwnProperty.call(r,"successcount")&&o.uint32(448).int32(r.successcount),r.userid!=null&&Object.hasOwnProperty.call(r,"userid")&&o.uint32(458).string(r.userid),o},i}(),Iv=Object.freeze({__proto__:null,Session:MD,ApEvent:ND,ApRequest:OD,LinkLoginRequest:PD,Link:QD,Logout:RD,KickedOff:SD,ChnJoin:TD,ChnJoinRes:UD,ChnLeave:VD,ConnectionStateChange:WD,RtmSdkMessageCount:Js,default:Pb}),XD=la(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});ea({target:"Date",proto:!0,forced:XD},{toJSON:function(i){i=pb(this);var r=Oc(i);return typeof r!="number"||isFinite(r)?i.toISOString():null}}),ea({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var Ev=Object.prototype.hasOwnProperty,Ks=function(i,r,o){return JSON.stringify(Mn(i),r,o)};Ks.ensureProperties=Mn;var YD=function(i,r){r=r||{};var o=qa(i);if(o==="string"&&0<i.length)return Fv(i);if(o==="number"&&isFinite(i))return r.long?i=864e5<=(r=Math.abs(i))?jh(i,r,864e5,"day"):36e5<=r?jh(i,r,36e5,"hour"):6e4<=r?jh(i,r,6e4,"minute"):1e3<=r?jh(i,r,1e3,"second"):i+" ms":i=864e5<=(r=Math.abs(i))?Math.round(i/864e5)+"d":36e5<=r?Math.round(i/36e5)+"h":6e4<=r?Math.round(i/6e4)+"m":1e3<=r?Math.round(i/1e3)+"s":i+"ms",i;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(i))},ZD=function(i){function r(h){function E(){for(var C=arguments.length,k=Array(C),j=0;j<C;j++)k[j]=arguments[j];if(E.enabled){C=Number(new Date),E.diff=C-(v||C),E.prev=v,v=E.curr=C,k[0]=r.coerce(k[0]),typeof k[0]!="string"&&k.unshift("%O");var K=0;k[0]=k[0].replace(/%([a-zA-Z%])/g,function($,_e){return $==="%%"?"%":(K++,typeof(_e=r.formatters[_e])=="function"&&($=_e.call(E,k[K]),k.splice(K,1),K--),$)}),r.formatArgs.call(E,k),(E.log||r.log).apply(E,k)}}var v,O=null;return E.namespace=h,E.useColors=r.useColors(),E.color=r.selectColor(h),E.extend=o,E.destroy=r.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:function(){return O===null?r.enabled(h):O},set:function(C){O=C}}),typeof r.init=="function"&&r.init(E),E}function o(h,E){return(h=r(this.namespace+(E===void 0?":":E)+h)).log=this.log,h}function u(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(h){return h instanceof Error?h.stack||h.message:h},r.disable=function(){var h=[].concat(Z(r.names.map(u)),Z(r.skips.map(u).map(function(E){return"-"+E}))).join(",");return r.enable(""),h},r.enable=function(h){r.save(h),r.names=[],r.skips=[];var E,v=(typeof h=="string"?h:"").split(/[\s,]+/),O=v.length;for(E=0;E<O;E++)v[E]&&((h=v[E].replace(/\*/g,".*?"))[0]==="-"?r.skips.push(new RegExp("^"+h.substr(1)+"$")):r.names.push(new RegExp("^"+h+"$")))},r.enabled=function(h){if(h[h.length-1]==="*")return!0;var E,v=0;for(E=r.skips.length;v<E;v++)if(r.skips[v].test(h))return!1;for(v=0,E=r.names.length;v<E;v++)if(r.names[v].test(h))return!0;return!1},r.humanize=YD,r.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(i).forEach(function(h){r[h]=i[h]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(h){for(var E=0,v=0;v<h.length;v++)E=(E<<5)-E+h.charCodeAt(v),E|=0;return r.colors[Math.abs(E)%r.colors.length]},r.enable(r.load()),r},Ls=xb(function(i,r){r.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),this.useColors){var E="color: "+this.color;h.splice(1,0,E,"color: inherit");var v=0,O=0;h[0].replace(/%[a-zA-Z%]/g,function(C){C!=="%%"&&(v++,C==="%c"&&(O=v))}),h.splice(O,0,E)}},r.save=function(h){try{h?r.storage.setItem("debug",h):r.storage.removeItem("debug")}catch{}},r.load=function(){try{var h=r.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h=define_process_env_default.DEBUG),h},r.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var o=localStorage;break t}catch{}o=void 0}var u;r.storage=o,r.destroy=(u=!1,function(){u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),r.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),r.log=console.debug||console.log||function(){},i.exports=ZD(r),i.exports.formatters.j=function(h){try{return JSON.stringify(h)}catch(E){return"[UnexpectedJSONParseError]: "+E.message}}}),Ms=Ls("RTM:DEBUG"),Af;Ms.enabled=!1,function(i){i[i.Uploading=0]="Uploading",i[i.Free=1]="Free"}(Af||(Af={}));var $D=function(){function i(r){va(this,i),x(this,"uploadRequest",void 0),x(this,"uploadState",void 0),x(this,"uploadResendCount",void 0),x(this,"LogCache",void 0),x(this,"LogsToPost",void 0),x(this,"processId",void 0),x(this,"sdkVersion",void 0),x(this,"logId",void 0),x(this,"rtmConfig",void 0),this.processId=r.processId,this.sdkVersion=r.sdkVersion,this.rtmConfig=r.rtmConfig,this.uploadRequest=r.uploadRequest,this.uploadState=Af.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return eb(i,[{key:"upload",value:function(r){this.LogCache.push(r),this.uploadState===Af.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(r){var o=this;this.uploadState=Af.Uploading,setTimeout(ma(N.mark(function u(){var h,E,v;return N.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return h={sdk_version:o.sdkVersion,process_id:o.processId,payload:JSON.stringify(r)},O.prev=1,O.next=4,o.uploadRequest(h,(E=o.rtmConfig.enableCloudProxy)!==null&&E!==void 0&&E);case 4:if(!gj){O.next=6;break}throw Error("RTM is busy");case 6:O.next=13;break;case 8:return O.prev=8,O.t0=O.catch(1),v=2>o.uploadResendCount++?2e3:1e4,setTimeout(function(){return o.postLog(o.LogsToPost)},v),O.abrupt("return");case 13:if(Ms('The logs uploaded for "process-'.concat(Og,'"')),o.LogCache.length!==0){O.next=17;break}return o.uploadState=Af.Free,O.abrupt("return");case 17:o.uploadResendCount=0,o.LogsToPost=40>o.LogCache.length?o.LogCache.splice(0,o.LogCache.length):o.LogCache.splice(0,40),o.postLog(o.LogsToPost);case 20:case"end":return O.stop()}},u,null,[[1,8]])})),ue.getParameter("LOG_UPLOAD_INTERVAL"))}}]),i}(),Ns=function(i,r,o,u,h,E,v,O){var C=0;for(v=!!v&&Dd(v,O,3);C<u;){if(C in o){if(O=v?v(o[C],C,r):o[C],0<E&&Ed(O))h=Ns(i,r,O,Ma(O.length),h,E-1)-1;else{if(9007199254740991<=h)throw TypeError("Exceed the acceptable array length");i[h]=O}h++}C++}return h},aE=Ns;ea({target:"Array",proto:!0},{flat:function(){var i=arguments.length?arguments[0]:void 0,r=pb(this),o=Ma(r.length),u=Dh(r,0);return u.length=aE(u,r,r,o,0,i===void 0?1:yc(i)),u}}),ea({target:"Object",stat:!0},{values:function(i){return uD(i)}});var ud=function(i){function r(u,h){return va(this,r),x(z(u=o.call(this,Vn(u,h))),"originalError",void 0),x(z(u),"code",void 0),x(z(u),"serverCode",void 0),typeof h=="number"?u.code=h:typeof h=="string"?u.name=h:h!==void 0&&(h.originalError&&(u.originalError=h.originalError),h.code!==void 0&&(u.code=h.code),h.serverCode!==void 0&&(u.serverCode=h.serverCode)),u}Ga(r,i);var o=Ha(r);return r}(Kf(Error)),rc=function(i){function r(u,h){return va(this,r),x(z(u=o.call(this,Vn(u,h))),"name","RtmInternalError"),x(z(u),"code",void 0),u.code=h,u}Ga(r,i);var o=Ha(r);return r}(Kf(Error)),yi=function(){return function(i){function r(u){va(this,r);var h=Object.keys(u);return o.call(this,u[h[0]],h[0])}Ga(r,i);var o=Ha(r);return r}(rc)},mb=yi(),Ub=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmTimeoutError"),u}Ga(r,i);var o=Ha(r);return r}(ud),ca=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmInvalidArgumentError"),u}Ga(r,i);var o=Ha(r);return r}(ud),da=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmInvalidStatusError"),u}Ga(r,i);var o=Ha(r);return r}(ud),ic=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmLimitExceededError"),u}Ga(r,i);var o=Ha(r);return r}(ud),bE=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmInvokeTooOftenError"),u}Ga(r,i);var o=Ha(r);return r}(ud),Ja=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmUnavailableError"),x(z(u),"serverCode",void 0),x(z(u),"statusCode",void 0),u}Ga(r,i);var o=Ha(r);return r}(ud),Bf=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmUnauthenticatedError"),x(z(u),"serverCode",void 0),u}Ga(r,i);var o=Ha(r);return r}(ud),ve=function(i){function r(){va(this,r);for(var u=arguments.length,h=Array(u),E=0;E<u;E++)h[E]=arguments[E];return x(z(u=o.call.apply(o,[this].concat(h))),"name","RtmUnknownError"),u}Ga(r,i);var o=Ha(r);return r}(ud),Ab=function(i){return i instanceof Ub||i instanceof Tb},Na=function(i){return i instanceof ud},we=function(i,r,o){return['Executing "%s.%s" timed out after %ds',i,r,o/1e3]},cE=["CODE"],bc,Pd,S;(function(i){i.CHINA="CN",i.ASIA="AS",i.NORTH_AMERICA="NA",i.EUROPE="EU",i.JAPAN="JP",i.INDIA="IN",i.OCEANIA="OC",i.SOUTH_AMERICA="SA",i.AFRICA="AF",i.OVERSEA="OVERSEA",i.GLOBAL="GLOBAL"})(S||(S={}));var dE={CN:S.CHINA,NA:S.NORTH_AMERICA,EU:S.EUROPE,AS:S.ASIA,JP:S.JAPAN,IN:S.INDIA,GLOB:S.GLOBAL,AF:S.AFRICA,OC:S.OVERSEA,OVS:S.OVERSEA,SA:S.SOUTH_AMERICA},kh=$n((bc={},x(bc,S.ASIA,{CODE:S.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.NORTH_AMERICA,{CODE:S.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.EUROPE,{CODE:S.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.JAPAN,{CODE:S.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.INDIA,{CODE:S.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OVERSEA,{CODE:S.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),x(bc,S.GLOBAL,{CODE:S.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OCEANIA,{CODE:S.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.SOUTH_AMERICA,{CODE:S.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.AFRICA,{CODE:S.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.CHINA,{CODE:S.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),bc)),Zf=(Pd={},x(Pd,S.ASIA,[S.CHINA,S.JAPAN,S.INDIA]),x(Pd,S.EUROPE,[]),x(Pd,S.NORTH_AMERICA,[]),x(Pd,S.SOUTH_AMERICA,[]),x(Pd,S.OCEANIA,[]),x(Pd,S.AFRICA,[]),Pd),Os=[S.OVERSEA,S.GLOBAL,S.CHINA,S.NORTH_AMERICA,S.EUROPE,S.ASIA,S.JAPAN,S.INDIA,S.OCEANIA,S.SOUTH_AMERICA,S.AFRICA],Nn=function(i){return Object.values(Zf).flat().includes(i)},Hv=function(i){var r;return(r=qh(Zf).find(function(o){return(o=$a(o,2))[0],o[1].includes(i)}))===null||r===void 0?void 0:r[0]},eE=function(i){return i.sort(function(r,o){return Os.indexOf(r)-Os.indexOf(o)})},Ve=function(i){var r=new Set;if((i=eE(i).slice(0,3).map(function(o){var u=kh[o];if(u===void 0)throw new rc("invalid area key");return o=u.CODE,u=Ki(u,cE),r.add(o),u})).length===0)throw new rc("areas cannot be empty");return Wa({CODES:r},i.reduce(function(o,u){for(var h=0,E=qh(o);h<E.length;h++){var v=$a(E[h],2),O=v[0];v=v[1],o[O]=Array.from(new Set([].concat(Z(u[O]),Z(v))))}return o}))},fa,Ps=function(){var i=ma(N.mark(function r(o,u){var h,E,v,O,C,k=arguments;return N.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!(2<(E=2<k.length&&k[2]!==void 0?k[2]:0))){j.next=3;break}return j.abrupt("return");case 3:return v={withCredentials:!0,body:o,timeout:2e4},O=0<E?(fa==null?void 0:fa.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(fa==null?void 0:fa.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",C=u?"https://".concat((h=fa==null?void 0:fa.PROXY_NGINX[0])!==null&&h!==void 0?h:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(O,"&p=443&d=upload/v1"):"https://".concat(O,"/upload/v1"),j.next=8,lh(C,v).catch(function(K){return Ps(o,u,E+1)});case 8:case"end":return j.stop()}},r)}));return function(r,o){return i.apply(this,arguments)}}(),Qs=new $D({processId:"process-".concat(Og),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.5.1-0-g5bbbcd72"),uploadRequest:Ps,rtmConfig:{}}),Sl="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Rs="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Ss=["serverReceivedTs","hasPeerReceived","messageType","enableNotificationToChannelMembers","lastUpdateTs"],fE="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),We=function(i){if(typeof i=="string")return La(i);if(Array.isArray(i)&&i.every(function(E){return typeof E=="string"}))return i.map(function(E){return La(E)});if(!Mm(i)){for(var r={},o=0;o<Ss.length;o++){var u=Ss[o];u in i&&(r[u]=i[u])}if(0<Object.keys(r).length)return r;if(5>Object.keys(i).length){for(o=0,i=Object.entries(i);o<i.length;o++){var h=$a(i[o],2);u=h[0],h=h[1],Sl.includes(u)?r[u]="[Hidden Info]":r[La(u)]=typeof h=="string"?La(h):"[Sensitive Info]"}return r}return"[Sensitive Info]"}return i},Ts=function(i){return qa(i)==="object"?De(i)?Zn(He(i,5),Sl,Rs):i.constructor&&i.constructor.name:i},Us=function(i,r){return i instanceof Error?i.message:typeof i!="string"?JSON.stringify(Zn(He(i,5),Sl,Rs)):(r=r.map(function(o){return o instanceof Error?o.message:qa(o)==="object"?Ks(Array.isArray(o)?o.map(Ts):Ts(o)):o}),Wn.apply(void 0,[i.replace(/%[%Oo]/g,function(o){return o==="%%"?"%":o==="%o"||o==="%O"?"%s":o})].concat(Z(r))))},gE=1,Vs=function(i,r,o){var u=Ls(i);return u.enabled=!0,u.log=o,u.useColors=!1,function(h){for(var E=arguments.length,v=Array(1<E?E-1:0),O=1;O<E;O++)v[O-1]=arguments[O];if(r.enableLogUpload){E=oh(h);var C=Us(E,v);Qs.upload({log_item_id:"".concat(gE++),log_level:i,payload_str:"[".concat(hE(),"] ").concat(i," - ").concat(256<C.length?C.slice(0,256):C)})}switch(E=function(k){var j=C||Us(oh(h),v),K=Ec.LOG_HANDLER;typeof K=="function"&&K({level:k,message:j}),u(j)},i){case"RTM:INFO":r.logFilter.info&&E("log");break;case"RTM:WARN":r.logFilter.warn&&E("warning");break;case"RTM:ERROR":r.logFilter.error&&E("error");break;case"RTM:TRACK":r.logFilter.track&&E("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":r.logFilter.debug&&E("debug");break;case"RTM:DEBUG":r.logFilter.debug&&E("debug")}}},Tl,Ws=function(i){return function(r){var o=Tl===1||i===void 0?"":"Ins#".concat(i," ");return"".concat(o).concat(r)}},Ul=function(i,r,o){var u=Ws(Tl);return Vs("RTM:".concat(r),o,function(h){return i(u(h))})},sc=function(){return function(i){function r(u,h){var E=2<arguments.length&&arguments[2]!==void 0&&arguments[2];va(this,r);var v=o.call(this);if(x(z(v),"logError",void 0),x(z(v),"invokeTracker",void 0),x(z(v),"resultTracker",void 0),x(z(v),"errorTracker",void 0),x(z(v),"eventTracker",void 0),x(z(v),"info",void 0),x(z(v),"warn",void 0),x(z(v),"log",void 0),x(z(v),"genLogger",void 0),x(z(v),"loggerId",void 0),x(z(v),"logger",void 0),x(z(v),"name",void 0),v.logger=u,v.name=h,v.loggerId=u.loggerId,v.info=u.info,v.warn=u.warn,v.logError=u.logError,v.genLogger=u.genLogger,v.log=u.genLogger("RTM:DEBUG","<".concat(h,"> ")),v.invokeTracker=u.genTracker("Invoke"),v.eventTracker=u.genTracker("Event"),v.resultTracker=u.genTracker("Result"),v.errorTracker=u.genTracker("Error"),E){var O=v.emit.bind(z(v));v.emit=function(){for(var C=arguments.length,k=Array(C),j=0;j<C;j++)k[j]=arguments[j];C=k[0],j=k.slice(1);var K=fE.includes(C);v.eventTracker.apply(v,["%s: ".concat(0<j.length?"%s emitted with args: ".concat(j.map(function(){return"%o"})):"%s emitted"),h,C].concat(Z(K?j.map(We):j)));try{O.apply(void 0,k)}catch($){v.logError("Caught in the callback function of the event %s",C,$)}}}return v}Ga(r,i);var o=Ha(r);return r}(Ba)},iE=function(i){return Ul(console.log.bind(console),"INFO",i)},jE=function(i){return Ul(console.warn.bind(console),"WARN",i)},kE=function(i){return Ul(console.error.bind(console),"ERROR",i)},Xs=function(i,r){return function(o){var u=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",h=Ws(i),E=console.debug.bind(console),v=Vs(o,r,function(O){return E(h(O))});return function(O){for(var C=arguments.length,k=Array(1<C?C-1:0),j=1;j<C;j++)k[j-1]=arguments[j];return v.apply(void 0,[u+O].concat(k))}}},lE=function(i,r){return function(o){return Xs(i,r)("RTM:TRACK","[".concat(o,"] "))}},Jv=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510}}),Ka;(function(i){i[i.ChannelSMsg=1]="ChannelSMsg",i[i.ChannelRMsg=2]="ChannelRMsg",i[i.P2pSMsgOfflineFlag=3]="P2pSMsgOfflineFlag",i[i.P2pRMsgOfflineFlag=4]="P2pRMsgOfflineFlag",i[i.P2pSMsgNoOfflineFlag=5]="P2pSMsgNoOfflineFlag",i[i.P2pRMsgNoOfflineFlag=6]="P2pRMsgNoOfflineFlag",i[i.P2pCallInvitation=7]="P2pCallInvitation",i[i.P2pCallCancellation=8]="P2pCallCancellation",i[i.P2pCallAcceptance=9]="P2pCallAcceptance",i[i.P2pCallRefusal=10]="P2pCallRefusal"})(Ka||(Ka={}));var zi=function(i){function r(u,h,E){return va(this,r),x(z(h=o.call(this,h,"MessageReport")),"messagecount",h.getInitMessageCount()),x(z(h),"context",void 0),x(z(h),"rtmMessageCategory",void 0),x(z(h),"seq",P.fromNumber(1,!0)),h.context=u,h.rtmMessageCategory=E,h}Ga(r,i);var o=Ha(r);return eb(r,[{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1)}},{key:"getInitMessageCount",value:function(){return{peerack10mscount:P.fromNumber(0),peerack25mscount:P.fromNumber(0),peerack50mscount:P.fromNumber(0),peerack75mscount:P.fromNumber(0),peerack100mscount:P.fromNumber(0),peerack150mscount:P.fromNumber(0),peerack200mscount:P.fromNumber(0),peerack250mscount:P.fromNumber(0),peerack300mscount:P.fromNumber(0),peerack400mscount:P.fromNumber(0),peerack500mscount:P.fromNumber(0),peerack600mscount:P.fromNumber(0),peerack800mscount:P.fromNumber(0),peerack1000mscount:P.fromNumber(0),peerack2000mscount:P.fromNumber(0),peerack3000mscount:P.fromNumber(0),peerack5000mscount:P.fromNumber(0),peerack7000mscount:P.fromNumber(0),peerackslowcount:P.fromNumber(0),norecipientack10mscount:P.fromNumber(0),norecipientack25mscount:P.fromNumber(0),norecipientack50mscount:P.fromNumber(0),norecipientack75mscount:P.fromNumber(0),norecipientack100mscount:P.fromNumber(0),norecipientack150mscount:P.fromNumber(0),norecipientack200mscount:P.fromNumber(0),norecipientack250mscount:P.fromNumber(0),norecipientack300mscount:P.fromNumber(0),norecipientack400mscount:P.fromNumber(0),norecipientack500mscount:P.fromNumber(0),norecipientack600mscount:P.fromNumber(0),norecipientack800mscount:P.fromNumber(0),norecipientack1000mscount:P.fromNumber(0),norecipientack2000mscount:P.fromNumber(0),norecipientack3000mscount:P.fromNumber(0),norecipientack5000mscount:P.fromNumber(0),norecipientack7000mscount:P.fromNumber(0),norecipientackslowcount:P.fromNumber(0),sentcount:P.fromNumber(0),receivedcount:P.fromNumber(0),acktimeoutcount:P.fromNumber(0),toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0}}},{key:"updatePeerAckCount",value:function(u){u/=2;for(var h=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],E=0;E<h.length;E++){var v,O=h[E];if(Is(u,O[0],O[1]))O="peerack".concat(O[1],"mscount"),this.messagecount[O]=(v=this.messagecount[O])===null||v===void 0?void 0:v.add(1);else if(7e3<u){var C;this.messagecount.peerackslowcount=(C=this.messagecount.peerackslowcount)===null||C===void 0?void 0:C.add(1)}}}},{key:"updateNorecipientackCount",value:function(u){u/=2;for(var h=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],E=0;E<h.length;E++){var v,O=h[E];if(Is(u,O[0],O[1]))O="norecipientack".concat(O[1],"mscount"),this.messagecount[O]=(v=this.messagecount[O])===null||v===void 0?void 0:v.add(1);else if(7e3<u){var C;this.messagecount.norecipientackslowcount=(C=this.messagecount.norecipientackslowcount)===null||C===void 0?void 0:C.add(1)}}}},{key:"updateCommonCount",value:function(u){var h=this.messagecount[u];P.isLong(h)?this.messagecount[u]=h.add(1):this.messagecount[u]=h+1}},{key:"report",value:function(){var u,h;bb("RtmSdkMessageCount",new Js(Wa(Wa({},this.messagecount),{},{vid:P.fromString((u=this.context.vid)!==null&&u!==void 0?u:"0"),os:7,lts:P.fromNumber(Date.now()),sid:this.context.sid,reportsequence:this.incGetSeq(),apimajorversion:4,apiminorversion:18,userid:this.context.uid,messagecategory:this.rtmMessageCategory})),(h=this.context.config.enableCloudProxy)!==null&&h!==void 0&&h),this.messagecount=Wa(Wa({},this.messagecount),{},{toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0})}}]),r}(sc()),Un=new Map,hE=function(){var i=new Date;return"".concat(i.toISOString().split("T")[1].replace(/\..+/,""),".").concat(i.getMilliseconds())},Yf=Object.keys,qh=Object.entries.bind(Object),oh=function(i){return typeof i=="string"?i.endsWith(".")?i:"".concat(i,"."):i},yj=I.URI,Nv=wi,mE=Ki(oD,["Wrapper"]),bo=ql(mE,"URI"),Ys=function(i,r){var o=-1,u=i.length,h=u-1;for(r=r===void 0?u:r;++o<r;){var E=i[u=os(o,h)];i[u]=i[o],i[o]=E}return i.length=r,i},nE=function(i){return Ys(Pi(i))},oE=function(i){return Ys(zj(i))},Cf=function(i){return(ub(i)?nE:oE)(i)},Df={0:9591,1:9593},xe=function(i){return"https://".concat(i,"/api/v1")},pE=ob.apply(void 0,Z(Cf(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map(xe)))),qE=ob.apply(void 0,Z(Cf(["ap-web-1.agora.io","ap-web-2.agora.io"].map(xe)))),rE=ob.apply(void 0,Z(Cf(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map(xe)))),sE=ob.apply(void 0,Z(Cf(["ap-web-3.agora.io","ap-web-4.agora.io"].map(xe)))),Zs=yi(),Vl=function(i){function r(u,h,E,v,O,C){var k,j;va(this,r);var K=o.call(this,O,uj("Socket-",O.loggerId));if(x(z(K),"isActiveClose",!1),x(z(K),"loggedIn",!1),x(z(K),"useNewDomain",void 0),x(z(K),"receivedPacket",new rb),x(z(K),"open$",void 0),x(z(K),"input$",new rb),x(z(K),"userJoin$",new rb),x(z(K),"attemptsSinceLastError",0),x(z(K),"message$",new rb),x(z(K),"socket$",void 0),x(z(K),"toClose",new rb),x(z(K),"toReconnect",new rb),x(z(K),"sendLogger",void 0),x(z(K),"receiveLogger",void 0),x(z(K),"ip",void 0),x(z(K),"env",void 0),x(z(K),"ticket",void 0),x(z(K),"context",void 0),x(z(K),"getDomain",function(){return co(K.ip,K.useNewDomain)}),x(z(K),"socketReconnector",function(na){var _c=function(_a){return K.attemptsSinceLastError+=1,K.warn("The %s of Env %d reconnecting %s",K.name,K.env,_a.message),dd(3e3)};return na.pipe(ab(function(_a){return K.log("socket connection closed"),K.loggedIn=!1,2<=K.attemptsSinceLastError?(K.warn("socket connection failure"),K.emit("connectionFailure"),K.close(),ra(_a)):K.isActiveClose?Sb:(K.emit("reconnect"),K.useNewDomain=!K.useNewDomain,ra(_a))}),Re(function(_a){return _a.pipe(Kb(_c))}))}),K.ip=u,K.env=h,K.ticket=E,K.context=v,K.useNewDomain=C??.5<=Math.random(),K.sendLogger=K.genLogger("RTM:MSG:SEND"),K.receiveLogger=K.genLogger("RTM:MSG:RECV"),h!==0&&h!==1)throw new Zs({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});var $=Df[h];K.log("Opening websocket address %s for the Env %d",K.ip,K.env),bb("LinkLoginRequest",{sid:K.context.sid,userId:K.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(K.context.startTime),destServerIp:K.ip,linkId:K.env},(k=K.context.config.enableCloudProxy||K.context.socketUseProxy)!==null&&k!==void 0&&k),bb("LinkLoginRequest",{sid:K.context.sid,userId:K.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(K.context.startTime),destServerIp:K.ip,linkId:K.env},(j=K.context.config.enableCloudProxy||K.context.socketUseProxy)!==null&&j!==void 0&&j);var _e=Jb(K.input$,K.userJoin$.pipe(Av(2)),K.message$).pipe(Ea(function(na){return wi.encode(na).finish()}));return u=Jb(Bv("",{protocols:[],makeWebSocket:function(){if(K.context.config.enableCloudProxy||K.context.socketUseProxy){if(K.context.cloudProxyServers.length===0)throw K.logError("No cloud proxy server to connect"),new Ja;var na=K.context.cloudProxyServers;na=Xe(na="wss://".concat(co(On(na),!1),"/"),"sid",K.context.sid),na=Xe(na,"remote_port",$.toString()),na=Xe(na,"remote_ip",K.ip),na=Xe(na,"token",K.context.key),na=new WebSocket(na)}else na=new WebSocket("wss://".concat(K.getDomain(),":").concat($));return na.binaryType="arraybuffer",na}}),K.toReconnect),K.socket$=fb(u,Dl.pipe(Lb(7e3),ab(function(na){return Ab(na)&&K.warn("socket open timed out"),ra(na)}))).pipe(Ea(function(na){if(na instanceof Error)throw K.warn("Env_%d: Force reconnect the socket",K.env),na;return na(_e).pipe(Ea(function(_c){return wi.decode(new Uint8Array(_c))}))}),K.socketReconnector),K.open$=K.socket$.pipe(sa(function(na){K.log("Websocket opened",K.name),na.subscribe(function(_c){var _a=_c.data;_c=yj[_c.uri].slice(0,-3),_a=bo[_c].decode(_a);var _s=eC({},ql(_a,"toJSON"),function(y_,F_){return F_ instanceof P?Tn(F_):F_}),_h=!1;if((_a instanceof ws||_a instanceof vs)&&_a.instance.lessThanOrEqual(4294967295)&&(_h=!0),_a instanceof xs||_a instanceof ys){var _f=_a.instance,E_=_a.sequence;(_a.dialogue.lessThanOrEqual(4294967295)||_f.lessThanOrEqual(4294967295)||E_.lessThan(1))&&(_h=!0)}_h?K.warn("Env_%d: Illegal %s, abandoned %o",K.env,_c,_s):(_c!=="Pong"&&K.receiveLogger("Env_%d: %s %o",K.env,_c,_s),K.receivedPacket.next([_c,_a]))},function(){})}),Uf(void 0),Kc(K.toClose),Se()),K}Ga(r,i);var o=Ha(r);return eb(r,[{key:"address",get:function(){return"".concat(this.ip,":").concat(Df[this.env])}},{key:"sendPacket",value:function(u,h){if(u!=="Ping"){var E=md(h,function(v){return v instanceof P?Tn(v):v});this.sendLogger("Env_%d: %s %o",this.env,u,E)}h=Mv(u,h),u==="UserJoin"?this.userJoin$.next(h):u==="Message"?this.message$.next(h):this.input$.next(h)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(u){return this.receivedPacket.pipe(yb(function(h){return $a(h,1)[0]===u}),Ea(function(h){return $a(h,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Zs({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),r}(sc());ea({target:"String",proto:!0,forced:As},{padStart:function(i){return qD(this,i,1<arguments.length?arguments[1]:void 0)}});var tE=function(i){var r=Yf(kh);i=Lv(i);for(var o=0;o<r.length;o++){var u=kh[r[o]];if(u!=null&&u.AP_DOMAINS.includes(i)||u!=null&&u.AP_BACKUP_DOMAINS.includes(i)||u!=null&&u.PROXY_AP.includes(i))return[u.CODE]}return[S.CHINA,S.GLOBAL]},uE={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},$s={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},vE=[100,101,102],Ai=/web-(\d)/,at=function(i){function r(u,h){var E=2<arguments.length&&arguments[2]!==void 0&&arguments[2];va(this,r);var v=o.call(this,h,"AccessPoint");return x(z(v),"handleUniLbsError",function(O,C){var k=O;if(4<O.toString().length){var j=O.toString().padStart(8,"0"),K=parseInt(j.slice(0,4),10);if(j=parseInt(j.slice(4,8),10),K===201)k=j;else if(K===101&&!vE.includes(j))return ra(Error("service is currently unavailable"))}if(K=k.toString(),!Object.keys($s).includes(K))return(O=new Ja(["Login is rejected by the server. The response code is %d",O],Pg)).serverCode=k,ra(O);switch(K=$s[K],k=uE[K],K){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(C=new Bf(k,as)).serverCode=O,ra(C);case"INVALID_USER_ID":return(C=new Bf(k,si)).serverCode=O,ra(C);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(C=new Bf(k,ti)).serverCode=O,ra(C);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(C=new Bf(k,bs)).serverCode=O,ra(C);case"CANNOT_MEET_AREA_DEMAND":return(C=tE(C)).forEach(function($){return v.failedAreas.add($)}),v.failedAreas.size===(fa===void 0?2:fa.CODES.size)?((C=new ca(k,Pg)).serverCode=O,ra(C)):ra(Error("ap ".concat(C.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(C=new Ja(k,Pg)).serverCode=O,ra(C);default:return ra(Rn("ApResErrType",K))}}),x(z(v),"getApEdgeInfo$",void 0),x(z(v),"getApEdgeInfoEndFirst$",void 0),x(z(v),"apFinish$",new rb),x(z(v),"retryCount",0),x(z(v),"failedAreas",new Set),x(z(v),"usedUrl",[]),x(z(v),"newDomainUsed",!1),x(z(v),"backupNewDomainUsed",!1),x(z(v),"genUrl",function(){return fa===void 0?ej.apply(void 0,Z(Cf([pE,qE]))).pipe(fj(function(O){return ob.apply(void 0,Z(O))})):ob.apply(void 0,Z(fa.AP_DOMAINS.slice(0,3).map(xe)))}),x(z(v),"genBackupUrl",function(){return fa===void 0?ej.apply(void 0,Z(Cf([rE,sE]))).pipe(fj(function(O){return ob.apply(void 0,Z(O))})):ob.apply(void 0,Z(fa.AP_BACKUP_DOMAINS.slice(0,3).map(xe)))}),x(z(v),"getApUrl$",function(O){var C,k;return v.genUrl().pipe(yb(function(j){return(!v.newDomainUsed||!j.includes("sd-rtn.com"))&&(j.includes("sd-rtn.com")&&(v.newDomainUsed=!0),!Ol(v.usedUrl,function(K){var $;return K===(($=j.match(Ai))===null||$===void 0?void 0:$[1])}))}),sa(function(j){var K;fa===void 0&&typeof(j=(K=j.match(Ai))===null||K===void 0?void 0:K[1])=="string"&&v.usedUrl.push(j)}),hb(O?Math.max(Ec.RECONNECTING_AP_NUM,(C=fa==null?void 0:fa.CODES.size)!==null&&C!==void 0?C:0):(k=fa==null?void 0:fa.CODES.size)!==null&&k!==void 0?k:2),$d(function(){return r.runOutOfUrlSymbol}),ab(function(j,K){return v.newDomainUsed=!1,j===r.runOutOfUrlSymbol?(v.usedUrl=[],K):ra(j)}))}),x(z(v),"getBackupApUrl$",function(O){var C,k;return v.genBackupUrl().pipe(yb(function(j){return(!v.backupNewDomainUsed||!j.includes("sd-rtn.com"))&&(j.includes("sd-rtn.com")&&(v.backupNewDomainUsed=!0),!Ol(v.usedUrl,function(K){var $;return K===(($=j.match(Ai))===null||$===void 0?void 0:$[1])}))}),sa(function(j){var K;fa===void 0&&typeof(j=(K=j.match(Ai))===null||K===void 0?void 0:K[1])=="string"&&v.usedUrl.push(j)}),hb(O?Math.max(Ec.RECONNECTING_AP_NUM,(C=fa==null?void 0:fa.CODES.size)!==null&&C!==void 0?C:0):(k=fa==null?void 0:fa.CODES.size)!==null&&k!==void 0?k:2),$d(function(){return r.runOutOfUrlSymbol}),ab(function(j,K){return v.backupNewDomainUsed=!1,j===r.runOutOfUrlSymbol?(v.usedUrl=[],K):ra(j)}))}),x(z(v),"getProxyApUrl$",function(O){var C,k;return ob.apply(void 0,Z(((fa==null?void 0:fa.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map(xe))).pipe(hb(O?Math.max(Ec.RECONNECTING_AP_NUM,(C=fa==null?void 0:fa.CODES.size)!==null&&C!==void 0?C:0):(k=fa==null?void 0:fa.CODES.size)!==null&&k!==void 0?k:2))}),x(z(v),"context",void 0),x(z(v),"fetchCloudProxy",function(O,C){var k=uj("AP-",v.loggerId);v.log("The AccessPoint requests %s(%s)",O,k);var j,K=new AbortController;return v.apFinish$.pipe(hb(1)).subscribe(function(){return K.abort()}),yd(ma(N.mark(function $(){var _e,na;return N.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:return na=mh(0,Number.MAX_SAFE_INTEGER),v.log("%s request opid: %d",k,na),bb("ApRequest",{sid:v.context.sid,userId:v.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(v.context.startTime),apAddr:O,opId:P.fromNumber(na),envId:0,flag:128},(_e=v.context.config.enableCloudProxy)!==null&&_e!==void 0&&_e),_c.abrupt("return",lh(O,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:v.context.sid,opid:na,appid:v.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:C??v.context.key,cname:v.context.uid,uid:0,detail:Wa({},fa===void 0?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map(function(_a){return _a===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):_a}).join(","),12:"1"})}}]},signal:K.signal}));case 4:case"end":return _c.stop()}},$)}))).pipe(ab(function($){return $.name!=="AbortError"&&(v.logError($),v.warn("The AP server %s request failure",O,$)),Sb}),Cb((j=ma(N.mark(function $(_e){var na,_c,_a,_s,_h,_f,E_,y_,F_,w_,W_,_S,o_,b_,h_,B_,e_,r_,_p;return N.wrap(function(c_){for(;;)switch(c_.prev=c_.next){case 0:if(na=_e.responseText,_c=JSON.parse(na),v.log("The %s response is %o",k,_c),((_a=_c.response_body)===void 0||_a.length===0||_a.some(function(v_){var q_;return((q_=v_.buffer)===null||q_===void 0?void 0:q_.code)===void 0||v_.uri!==23}))&&ra(new Ja("cloud proxy response_body not valid",Pg)),(_s=_a.filter(function(v_){return v_.buffer.code!==0})).length===0){c_.next=14;break}if((_h=_s.find(function(v_){return v_.buffer.flag===128}))===void 0){c_.next=12;break}return c_.abrupt("return",v.handleUniLbsError(_h.buffer.code,O));case 12:return v.logError("cloud proxy error response"),c_.abrupt("return",v.handleUniLbsError(_s[0].buffer.code,O));case 14:for(_f=[],E_=0;E_<_a.length;E_++)if(((w_=_a[E_])==null||(y_=w_.buffer)===null||y_===void 0?void 0:y_.flag)===262144)(W_=w_.buffer)===null||W_===void 0||(_S=W_.edges_services)===null||_S===void 0||(o_=_S.forEach)===null||o_===void 0||o_.call(_S,function(v_){Pn(v_=v_.ip)&&v.context.cloudProxyServers.indexOf(v_)===-1&&(v.log("got cloud proxy server: %s",v_),v.context.cloudProxyServers.push(v_))});else if((w_==null||(F_=w_.buffer)===null||F_===void 0?void 0:F_.flag)===128){for(e_=function(v_,q_){var _u=q_[v_];_f.some(function(S_){return S_.ip===_u.ip})||_f.push({ip:_u.ip,ticket:w_.buffer.cert})},r_=0,_p=w_.buffer.edges_services;r_<_p.length;r_++)e_(r_,_p);v.context.rtmArea=(b_=(h_=w_.buffer)===null||h_===void 0||(B_=h_.detail)===null||B_===void 0?void 0:B_[9])!==null&&b_!==void 0?b_:""}return c_.abrupt("return",ob.apply(void 0,Z(_f).concat([Mg])));case 19:case"end":return c_.stop()}},$)})),function($){return j.apply(this,arguments)})),ab(function($){return Na($)?ra($):Sb}),bh(),yb(function($){return $!==void 0&&typeof $.ip=="string"&&typeof $.ticket=="string"&&Pn($.ip)}))}),x(z(v),"fetchAp",function(O,C){var k=uj("AP-",v.loggerId);v.log("The AccessPoint requests %s(%s)",O,k);var j=new AbortController;v.apFinish$.pipe(hb(1)).subscribe(function(){return j.abort()});var K,$=mh(0,Number.MAX_SAFE_INTEGER);return yd(ma(N.mark(function _e(){var na;return N.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:return v.log("%s request opid: %d",k,$),bb("ApRequest",{sid:v.context.sid,userId:v.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(v.context.startTime),apAddr:O,opId:P.fromNumber($),envId:0,flag:128},(na=v.context.config.enableCloudProxy)!==null&&na!==void 0&&na),_c.abrupt("return",lh(O,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:$,key:C||v.context.key,cname:v.context.uid,detail:Wa({},fa===void 0?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map(function(_a){return _a===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):_a}).join(","),12:"1"}),uid:0,sid:v.context.sid},signal:j.signal}));case 3:case"end":return _c.stop()}},_e)}))).pipe(ab(function(_e){return _e.name!=="AbortError"&&(v.logError(_e),v.warn("The AP server %s request failure",O,_e)),Sb}),Cb((K=ma(N.mark(function _e(na){var _c,_a,_s,_h,_f,E_,y_,F_;return N.wrap(function(w_){for(;;)switch(w_.prev=w_.next){case 0:if(_a=na.responseText,_s=JSON.parse(_a),v.log("The %s response is %o",k,_s),_f=(_h=_s).code,E_=_h.addresses,y_=_h.detail,v.context.vid=y_[8],bb("ApEvent",{sid:v.context.sid,userId:v.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(v.context.startTime),apAddr:O,linkServerList:E_.map(function(W_){return W_.ip}),serverErrCode:_f,flag:128,envId:0,opId:P.fromNumber($),errCode:0,area:y_[9],isp:y_[2]},(_c=v.context.config.enableCloudProxy)!==null&&_c!==void 0&&_c),v.info(_s),_f===0){w_.next=9;break}return w_.abrupt("return",v.handleUniLbsError(_f,O));case 9:if(F_=E_,F_.length!==0){w_.next=14;break}return w_.abrupt("return",ra(Error("No available edge address to connect")));case 14:return v.context.rtmArea=y_==null?void 0:y_[9],w_.abrupt("return",ob.apply(void 0,Z(F_).concat([Mg])));case 16:case"end":return w_.stop()}},_e)})),function(_e){return K.apply(this,arguments)})),bh(),ab(function(_e){return Na(_e)?ra(_e):Sb}),yb(function(_e){return _e!==void 0&&typeof _e.ip=="string"&&typeof _e.ticket=="string"}))}),v.context=u,v.getApEdgeInfoEndFirst$=function(){var O=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return dd(0,O||E?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(1),sa(function(){v.retryCount+=1}),Cb(function(){return v.context.config.enableCloudProxy||v.context.socketUseProxy?v.getProxyApUrl$(O||E):(4<=v.retryCount&&(v.retryCount=0),3>=v.retryCount?v.getApUrl$(O||E):v.getBackupApUrl$(O||E))}),Cb(function(C){return v.context.config.enableCloudProxy||v.context.socketUseProxy?v.fetchCloudProxy(C):v.fetchAp(C)}),ab(function(C){return C instanceof Tb&&v.warn("AP request timeout"),ra(C)}),tn(function(C){return C.ip}),Kc(v.apFinish$))},v.getApEdgeInfo$=function(O){return dd(0,O||E?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(8),sa(function(){v.retryCount+=1}),Cb(function(){return v.context.config.enableCloudProxy||v.context.socketUseProxy?v.getProxyApUrl$(O||E):3>=v.retryCount?v.getApUrl$(O||E):v.getBackupApUrl$(O||E)}),Cb(function(C){return(v.context.config.enableCloudProxy||v.context.socketUseProxy?v.fetchCloudProxy(C):v.fetchAp(C)).pipe()}),ab(function(C){return C instanceof Tb&&v.warn("AP request timeout"),ra(C)}),tn(function(C){return C.ip}),Kc(v.apFinish$))},v}Ga(r,i);var o=Ha(r);return eb(r,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),r}(sc());x(at,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var bt=yi(),ct=function(i){function r(u,h,E){va(this,r);var v=o.call(this,h,"Connection");x(z(v),"apClient",void 0),x(z(v),"lastOpenSockets",[new Te(1),new Te(1)]),x(z(v),"curOpenSockets",[void 0,void 0]),x(z(v),"ipIterator",0),x(z(v),"loginSocketOpenFailureCount",0),x(z(v),"firstEnv",.5<=Math.random()?1:0),x(z(v),"firstSocketOpener",void 0),x(z(v),"secondSocketOpener",void 0),x(z(v),"firstOpenKeeperSubject",new rb),x(z(v),"secondOpenKeeperSubject",new rb),x(z(v),"blacklistedIP",{}),x(z(v),"edgeInfoReplayed",void 0),x(z(v),"firstEnvOpenSocket",void 0),x(z(v),"firstOpenKeeperSub",void 0),x(z(v),"secondOpenKeeperSub",void 0),x(z(v),"context",void 0),x(z(v),"logger",void 0),v.context=u,v.logger=h,v.apClient=new at(v.context,h),v.apClient.apFinish$.subscribe(function(){v.log("Ap client fetch finished")});var O,C=[];return v.edgeInfoReplayed=v.apClient.getApEdgeInfo$(E).pipe(Re(function(k){return k.pipe(sa(function(j){if(Na(j))throw j}),Zd(E?ue.getParameter("RECONNECTING_AP_INTERVAL"):900),Kc(dd(2e4)))}),yb(function(k){var j;return!Ol(C,k)&&1>=((j=v.blacklistedIP[k.ip])!==null&&j!==void 0?j:0)}),$d(function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),sa(function(k){C.push(k),v.log("An edge info got %o",k)}),sa({error:function(k){v.emit("connectionInitFailure",k)}}),fh(function(){v.apClient.clearUp()}),wn()),v.firstEnvOpenSocket=v.edgeInfoReplayed.pipe(Cb(function(k){if(k===void 0)return ra(Error("Invalid edge info"));var j=new Vl(k.ip,v.firstEnv,k.ticket,v.context,h,O);if(v.firstEnv=v.firstEnv===1?0:1,j.once("connectionFailure",function(){return v.onSocketConnectionFailure(j)}),!E&&Ec.ENABLE_EDGE_AUTO_FALLBACK&&!v.context.config.enableCloudProxy){var K,$=Date.now();j.on("reconnect",function(){var _e;v.loginSocketOpenFailureCount+=1,(_e=K)!==null&&_e!==void 0||(K=Date.now()-$),500>K&&1<v.loginSocketOpenFailureCount&&(v.context.socketUseProxy=!0)})}return O=!j.useNewDomain,j.open$.pipe(Uf(j))}),sa(function(k){v.log("The websocket of ENV_%d opened to %s:%d",k.env,k.ip,Df[k.env]),v.curOpenSockets[k.env]=k,v.lastOpenSockets[k.env].next(k),v.firstEnv=k.env,v.openSecondSocket(k.env,k.ip,k.useNewDomain)}),hb(1),Se()),v.firstSocketOpener=v.firstEnvOpenSocket.pipe(Cb(function(k){return k.open$.pipe(sa(function(){v.log("The websocket of first ENV_%d re-opened to %s:%d",k.env,k.ip,Df[k.env]),v.curOpenSockets[k.env]=k,v.lastOpenSockets[k.env].next(k)}))})),u=v.firstOpenKeeperSubject.pipe(Kb(wd)),v.firstOpenKeeperSub=u.subscribe({error:v.logError}),v}Ga(r,i);var o=Ha(r);return eb(r,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(u,h){if(![0,1].includes(u))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});var E=u===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var v=this.curOpenSockets[u];this.curOpenSockets[u]=void 0,v&&(v.isActiveClose=!0,setTimeout(function(){v.close()},h)),E!==void 0&&setTimeout(function(){E==null||E.unsubscribe()},h)}},{key:"waitClosing",value:function(u){var h=this;return u.isActiveClose=!0,u.open$.pipe(ev(),ab(function(E){return E.message===ns.normalClosureMessage?Sb:ra(E)}),Lb(5e3),ab(function(E){return E instanceof Tb?(h.warn("Force closing the ENV_%d connection",u.env),Sb):ra(E)}))}},{key:"onSocketConnectionFailure",value:function(u){var h=[0,1].filter(function(E){return E!==u.env})[0];(h=this.curOpenSockets[h])&&h.loggedIn?this.reopenSocketWithApRequest(u.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(u,h,E){var v=this,O=u===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(vn(function(C,k){return[].concat(Z(C),[k])},[]),Ea(function(C){return ls(C,function(k){return Sn(h,k.ip)}).slice(-1)[0]}),hb(1),Cb(function(C){if(C===void 0)return ra(Error("Invalid edge info"));var k=new Vl(C.ip,O,C.ticket,v.context,v.logger,E);return k.on("connectionFailure",function(){return v.onSocketConnectionFailure(k)}),k.open$.pipe(sa(function(){v.lastOpenSockets[O].next(k),v.curOpenSockets[O]=k}))}),Se()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Kb(wd)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(u){var h=this,E=[0,1].filter(function(C){return C!==u})[0];if((E=this.curOpenSockets[E])!==void 0){var v,O=E.ip;E=this.apClient.getApEdgeInfoEndFirst$(!0).pipe($d(function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),Re(function(C){return C.pipe(sa(function(k){if(k.code===ti)h.emit("tokenExpired"),h.apClient.apFinish$.next(void 0);else if(Na(k))throw k}),Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")),Kc(dd(15e3)))}),sa(function(C){h.log("An edge info got %o",C)}),fh(function(){h.apClient.clearUp()})).pipe(vn(function(C,k){return[].concat(Z(C),[k])},[]),Ea(function(C){return(C=ls(C,function(k){return Sn(O,k.ip)})).length-1>=h.ipIterator?C.slice(-h.ipIterator++-1)[0]:(h.ipIterator=0,C.slice(-1)[0])}),$d(),Cb(function(C){if(C===void 0)return ra(Error("Invalid edge info"));var k=new Vl(C.ip,u,C.ticket,h.context,h.logger,v);return k.on("connectionFailure",function(){return h.onSocketConnectionFailure(k)}),v=!k.useNewDomain,k.open$.pipe(Uf(k))}),sa(function(C){h.log("The websocket of ENV_%d re-opened to %s:%d using ap",C.env,C.ip,Df[C.env]),h.curOpenSockets[u]=C,h.lastOpenSockets[u].next(C)}),Cb(function(C){return C.open$.pipe(sa(function(){h.log("The websocket of ENV_%d re-opened to %s:%d",C.env,C.ip,Df[C.env]),h.curOpenSockets[u]=C,h.lastOpenSockets[u].next(C)}))}),Se()),u===this.firstEnv?this.firstOpenKeeperSubject.next(E):this.secondOpenKeeperSubject.next(E)}}}]),r}(sc()),xE=function(i){function r(u,h,E){return va(this,r),x(z(E=o.call(this,E,"Context")),"_token",void 0),x(z(E),"config",void 0),x(z(E),"_uid",void 0),x(z(E),"_sid",void 0),x(z(E),"_vid",void 0),x(z(E),"_startTime",void 0),x(z(E),"_area","CN"),x(z(E),"_socketUseProxy",!1),x(z(E),"appId",void 0),x(z(E),"enableCloudProxy",!1),x(z(E),"cloudProxyServers",[]),E.appId=u,E.config=h,E}Ga(r,i);var o=Ha(r);return eb(r,[{key:"socketUseProxy",get:function(){return this._socketUseProxy&&Ec.ENABLE_EDGE_AUTO_FALLBACK},set:function(u){this.log("socketUseProxy is set to %s",u),this._socketUseProxy=u}},{key:"token",set:function(u){this._token=typeof u=="string"&&u?u:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new rc("Cannot get illegal uid")},set:function(u){if(this.log("The user ID is set to %s",La(u)),!Ta(u))throw new rc;this._uid=u}},{key:"vid",get:function(){if(typeof this._vid=="string"&&this._vid)return this._vid;throw new rc("Cannot get illegal vid")},set:function(u){this._vid=u}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new rc("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new rc("Cannot get illegal sid")},set:function(u){if(this.log("sid is set to %s",u),typeof u!="string"||!u)throw new rc;this._sid=u}},{key:"startTime",get:function(){if(typeof this._startTime=="number"&&this._startTime)return this._startTime;throw new rc("Cannot get illegal startTime")},set:function(u){if(this.log("startTime is set to %s",u),typeof u!="number"||!u)throw new rc;this._startTime=u}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new rc("Cannot get illegal area")},set:function(u){this.log("area is set to %s",u),typeof u=="string"&&u?this._area=u:this.warn("set area failed")}}]),r}(sc());Sp("of",function(){for(var i=0,r=arguments.length,o=new(qf(this))(r);r>i;)o[i]=arguments[i++];return o},rk);var yE=Math.max,Pv=function(i,r,o){var u=Object(i);if(!ae(i)){var h=wf(r);i=Wd(i),r=function(E){return h(u[E],E,u)}}return-1<(r=function(E,v,O){var C=E==null?0:E.length;if(!C)return-1;if(O==null)O=0;else{var k=(O=Rl(O))%1;O=O==O?k?O-k:O:0}return 0>O&&(O=yE(C+O,0)),Yq(E,wf(v),O)}(i,r,o))?u[h?i[r]:r]:void 0},Ov=function(i,r){return i&&i.length?fl(i,void 0,typeof r=="function"?r:void 0):[]},dt=function(){function i(){va(this,i),x(this,"size",0),x(this,"fields",new Map)}return eb(i,[{key:"define",value:function(r,o,u){if(this.size+=u,64<this.size)throw new RangeError("the struct over 64 bits is not supported");th(o={val:0,isNumber:o==="number",isBoolean:o==="boolean",oneof:o==="number"||o==="boolean"?void 0:o,len:u}),this.fields.set(r,o)}},{key:"set",value:function(r,o){if(!(r=this.fields.get(r)))throw Error("field not found");var u=r.oneof;if(!P.isLong(o)&&typeof o!="number")if(typeof o=="boolean")o=o?1:0;else{if(u===void 0)throw Error("invalid field type");if((o=u[o])===void 0)throw Error("field type not found")}th(r,o),r.val=o}},{key:"toNumber",value:function(){for(var r=0,o=0,u=0,h=Array.from(this.fields);u<h.length;u++){var E=$a(h[u],2)[1],v=E.len;(E=E.val)!==void 0&&(r+=P.fromValue(E).shiftLeft(o).toNumber(),o+=v)}return r}},{key:"toLong",value:function(){for(var r=P.fromNumber(0,!0),o=0,u=0,h=Array.from(this.fields);u<h.length;u++){var E=$a(h[u],2)[1],v=E.len;(E=E.val)!==void 0&&(r=P.fromValue(E).shiftLeft(o).add(r),o+=v)}return r}},{key:"assert",value:function(r,o){function u(v){if(!P.isLong(v)&&typeof v!="number")if(typeof v=="boolean")v=v?1:0;else{if(E===void 0)throw Error("invalid field type");if((v=E[v])===void 0)throw Error("field type not found")}return th(h,v),sh(v,h.val)}var h=this.fields.get(r);if(!h)throw Error("field not found");var E=h.oneof;if(!Array.isArray(o))return u(o);if(o.length===1)return u(o[0]);if(o.every(function(v){return typeof v=="string"})&&E!==void 0)return o.some(function(v){return u(v)});throw Error("invalid valueTypes")}},{key:"from",value:function(r){r=P.fromValue(r);for(var o=0,u=0,h=Array.from(this.fields);u<h.length;u++){var E=$a(h[u],2)[1],v=E.len,O=P.fromNumber(Math.pow(2,v)-1,!0).shiftLeft(o);th(E,O=r.and(O).shiftRightUnsigned(o)),E.val=O,o+=v}}},{key:"typeOf",value:function(r){if((r=this.fields.get(r))!==void 0){var o=r.oneof;if(r=r.val,o!==void 0){var u=0;for(o=Object.entries(o);u<o.length;u++){var h=$a(o[u],2),E=h[0];if(sh(r,h[1]))return E}}}throw new TypeError("can only get type of oneof type")}}]),i}(),et=function(i){function r(u){va(this,r);var h=o.call(this);return h.define("Rejoin","boolean",1),h.define("Unused","number",31),h.define("Platform","number",8),h.define("Version","number",12),h.define("Subversion","number",12),h.set("Platform",7),h.set("Version",4),h.set("Subversion",18),h.set("Rejoin",u),h}Ga(r,i);var o=Ha(r);return r}(dt),zE=Wa(Wa({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),ft={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},AE=Wa(Wa({},zE),ft),BE={Uncompressed:0,Zlib:1},Ef=function(i){function r(u){va(this,r);var h=o.call(this);if(h.define("MessageType",AE,8),h.define("BroadcastJumps","number",2),h.define("ToCache","boolean",1),h.define("FromCache","boolean",1),h.define("CompressionMethod",BE,2),h.define("IterationNumber","number",4),h.define("BufferedMessage","boolean",1),h.define("ToArchive","boolean",1),h.define("FromArchive","boolean",1),typeof u=="number"||P.isLong(u))h.from(u);else if(u!==void 0){var E=0;for(u=qh(u);E<u.length;E++){var v=$a(u[E],2);h.set(v[0],v[1])}}return h}Ga(r,i);var o=Ha(r);return eb(r,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(u){var h=this;return u!==void 0?this.assert("MessageType",u):Yf(ft).some(function(E){return h.assert("MessageType",E)})}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),r}(dt),CE=function(i){function r(u){return va(this,r),x(z(u=o.call(this,u,"ChatManager")),"dialogueLru",new xz(void 0,{maxlen:1e4,ttl:1e4})),u}Ga(r,i);var o=Ha(r);return eb(r,[{key:"getChatInfo",value:function(u){var h=this.dialogueLru.get(u);if(this.dialogueLru.prune(),h){var E=h.dialogue,v={dialogue:E,sequence:h=h.sequence.add(1)};return this.dialogueLru.set(u,{dialogue:E,sequence:h}),v}return E={dialogue:nh(),sequence:P.fromNumber(1,!0)},this.dialogueLru.set(u,E),E}}]),r}(sc()),G={};qa(module)=="object"&&(module.exports=G),G.parse=function(i,r){var o,u=G.bin.readUshort,h=G.bin.readUint,E={};for(o=(i=new Uint8Array(i)).length-4;h(i,o)!=101010256;)o--;var v=u(i,o=o+4+4);u(i,o+=2),h(i,o+=2),o=h(i,o+=4);for(var O=0;O<v;O++){h(i,o),o+=4,o+=4,o+=4,h(i,o+=4);var C=h(i,o+=4),k=h(i,o+=4),j=u(i,o+=4),K=u(i,o+2),$=u(i,o+4);o+=6;var _e=h(i,o+=8);o+=4,o+=j+K+$,G._readLocal(i,_e,E,C,k,r)}return E},G._readLocal=function(i,r,o,u,h,E){var v=G.bin.readUshort,O=G.bin.readUint;O(i,r),v(i,r+=4),v(i,r+=2);var C=v(i,r+=2);O(i,r+=2),O(i,r+=4),O=v(i,r=r+4+8);var k=v(i,r+=2);if(r+=2,v=G.bin.readUTF8(i,r,O),r=r+O+k,E)o[v]={size:h,csize:u};else if(i=new Uint8Array(i.buffer,r),C==0)o[v]=new Uint8Array(i.buffer.slice(r,r+u));else{if(C!=8)throw"unknown compression method: "+C;r=new Uint8Array(h),G.inflateRaw(i,r),o[v]=r}},G.inflateRaw=function(i,r){return G.F.inflate(i,r)},G.inflate=function(i,r){return i[0],i[1],G.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-2),r)},G.deflate=function(i,r){r==null&&(r={level:6});var o=0,u=new Uint8Array(50+Math.floor(1.1*i.length));return u[o]=120,u[o+1]=156,o=G.F.deflateRaw(i,u,o+2,r.level),i=G.adler(i,0,i.length),u[o+0]=i>>>24&255,u[o+1]=i>>>16&255,u[o+2]=i>>>8&255,u[o+3]=i>>>0&255,new Uint8Array(u.buffer,0,o+4)},G.deflateRaw=function(i,r){r==null&&(r={level:6});var o=new Uint8Array(50+Math.floor(1.1*i.length)),u=G.F.deflateRaw(i,o,u,r.level);return new Uint8Array(o.buffer,0,u)},G.encode=function(i,r){r==null&&(r=!1);var o,u=0,h=G.bin.writeUint,E=G.bin.writeUshort,v={};for(o in i){var O=!G._noNeed(o)&&!r,C=i[o],k=G.crc.crc(C,0,C.length);v[o]={cpr:O,usize:C.length,crc:k,file:O?G.deflateRaw(C):C}}for(o in v)u+=v[o].file.length+30+46+2*G.bin.sizeUTF8(o);for(o in i=new Uint8Array(u+22),r=0,C=[],v)k=v[o],C.push(r),r=G._writeHeader(i,r,o,k,0);for(o in u=0,O=r,v)k=v[o],C.push(r),r=G._writeHeader(i,r,o,k,1,C[u++]);return v=r-O,h(i,r,101010256),E(i,r=r+4+4,u),E(i,r+=2,u),h(i,r+=2,v),h(i,r+4,O),i.buffer},G._noNeed=function(i){return i=i.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(i)!=-1},G._writeHeader=function(i,r,o,u,h,E){var v=G.bin.writeUint,O=G.bin.writeUshort,C=u.file;return v(i,r,h==0?67324752:33639248),r+=4,h==1&&(r+=2),O(i,r,20),O(i,r+=2,0),O(i,r+=2,u.cpr?8:0),v(i,r+=2,0),v(i,r+=4,u.crc),v(i,r+=4,C.length),v(i,r+=4,u.usize),O(i,r+=4,G.bin.sizeUTF8(o)),O(i,r+=2,0),r+=2,h==1&&(v(i,r=r+2+2+6,E),r+=4),r+=o=G.bin.writeUTF8(i,r,o),h==0&&(i.set(C,r),r+=C.length),r},G.crc={table:function(){for(var i=new Uint32Array(256),r=0;256>r;r++){for(var o=r,u=0;8>u;u++)o=1&o?3988292384^o>>>1:o>>>1;i[r]=o}return i}(),update:function(i,r,o,u){for(var h=0;h<u;h++)i=G.crc.table[255&(i^r[o+h])]^i>>>8;return i},crc:function(i,r,o){return 4294967295^G.crc.update(4294967295,i,r,o)}},G.adler=function(i,r,o){var u=1,h=0,E=r;for(r+=o;E<r;){for(o=Math.min(E+5552,r);E<o;)h+=u+=i[E++];u%=65521,h%=65521}return h<<16|u},G.bin={readUshort:function(i,r){return i[r]|i[r+1]<<8},writeUshort:function(i,r,o){i[r]=255&o,i[r+1]=o>>8&255},readUint:function(i,r){return 16777216*i[r+3]+(i[r+2]<<16|i[r+1]<<8|i[r])},writeUint:function(i,r,o){i[r]=255&o,i[r+1]=o>>8&255,i[r+2]=o>>16&255,i[r+3]=o>>24&255},readASCII:function(i,r,o){for(var u="",h=0;h<o;h++)u+=String.fromCharCode(i[r+h]);return u},writeASCII:function(i,r,o){for(var u=0;u<o.length;u++)i[r+u]=o.charCodeAt(u)},pad:function(i){return 2>i.length?"0"+i:i},readUTF8:function(i,r,o){for(var u,h="",E=0;E<o;E++)h+="%"+G.bin.pad(i[r+E].toString(16));try{u=decodeURIComponent(h)}catch{return G.bin.readASCII(i,r,o)}return u},writeUTF8:function(i,r,o){for(var u=o.length,h=0,E=0;E<u;E++){var v=o.charCodeAt(E);if((4294967168&v)==0)i[r+h]=v,h++;else if((4294965248&v)==0)i[r+h]=192|v>>6,i[r+h+1]=128|v>>0&63,h+=2;else if((4294901760&v)==0)i[r+h]=224|v>>12,i[r+h+1]=128|v>>6&63,i[r+h+2]=128|v>>0&63,h+=3;else{if((4292870144&v)!=0)throw"e";i[r+h]=240|v>>18,i[r+h+1]=128|v>>12&63,i[r+h+2]=128|v>>6&63,i[r+h+3]=128|v>>0&63,h+=4}}return h},sizeUTF8:function(i){for(var r=i.length,o=0,u=0;u<r;u++){var h=i.charCodeAt(u);if((4294967168&h)==0)o++;else if((4294965248&h)==0)o+=2;else if((4294901760&h)==0)o+=3;else{if((4292870144&h)!=0)throw"e";o+=4}}return o}},G.F={},G.F.deflateRaw=function(i,r,o,u){var h=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][u],E=G.F.U,v=G.F._goodIndex;G.F._hash;var O=G.F._putsE,C=0;o<<=3;var k=0,j=i.length;if(u==0){for(;C<j;){var K=Math.min(65535,j-C);O(r,o,C+K==j?1:0),o=G.F._copyExact(i,C,K,r,o+8),C+=K}return o>>>3}O=E.lits,u=E.strt;var $=E.prev,_e=0,na=0,_c=0,_a=0,_s=0;for(2<j&&(u[_s=G.F._hash(i,0)]=0),C=0;C<j;C++){if(K=_s,C+1<j-2){_s=G.F._hash(i,C+1);var _h=C+1&32767;$[_h]=u[_s],u[_s]=_h}if(k<=C){if((14e3<_e||26697<na)&&100<j-C&&(k<C&&(O[_e]=C-k,_e+=2,k=C),o=G.F._writeBlock(C==j-1||k==j?1:0,O,_e,_a,i,_c,C-_c,r,o),_e=na=_a=0,_c=C),_h=0,C<j-2&&(_h=G.F._bestMatch(i,C,$,K,Math.min(h[2],j-C),h[3])),_h!=0){K=_h>>>16,_h&=65535;var _f=v(K,E.of0);E.lhst[257+_f]++;var E_=v(_h,E.df0);E.dhst[E_]++,_a+=E.exb[_f]+E.dxb[E_],O[_e]=K<<23|C-k,O[_e+1]=_h<<16|_f<<8|E_,_e+=2,k=C+K}else E.lhst[i[C]]++;na++}}for(_c==C&&i.length!=0||(k<C&&(O[_e]=C-k,_e+=2),o=G.F._writeBlock(1,O,_e,_a,i,_c,C-_c,r,o));(7&o)!=0;)o++;return o>>>3},G.F._bestMatch=function(i,r,o,u,h,E){var v=32767&r,O=o[v],C=v-O+32768&32767;if(O==v||u!=G.F._hash(i,r-C))return 0;for(var k=u=0,j=Math.min(32767,r);C<=j&&--E!=0&&O!=v;){if((u==0||i[r+u]==i[r+u-C])&&(v=G.F._howLong(i,r,C))>u){if(k=C,(u=v)>=h)break;C+2<v&&(v=C+2);for(var K=0,$=0;$<v-2;$++){var _e=r-C+$+32768&32767,na=_e-o[_e]+32768&32767;na>K&&(K=na,O=_e)}}C+=(v=O)-(O=o[v])+32768&32767}return u<<16|k},G.F._howLong=function(i,r,o){if(i[r]!=i[r-o]||i[r+1]!=i[r+1-o]||i[r+2]!=i[r+2-o])return 0;var u=r,h=Math.min(i.length,r+258);for(r+=3;r<h&&i[r]==i[r-o];)r++;return r-u},G.F._hash=function(i,r){return(i[r]<<8|i[r+1])+(i[r+2]<<4)&65535},G.saved=0,G.F._writeBlock=function(i,r,o,u,h,E,v,O,C){var k=G.F.U,j=G.F._putsF,K=G.F._putsE;k.lhst[256]++;var $=G.F.getTrees(),_e=$[0],na=$[1],_c=$[2],_a=$[3],_s=$[4],_h=$[5],_f=$[6];$=$[7];var E_=32+((C+3&7)==0?0:8-(C+3&7))+(v<<3),y_=u+G.F.contSize(k.fltree,k.lhst)+G.F.contSize(k.fdtree,k.dhst);u=u+G.F.contSize(k.ltree,k.lhst)+G.F.contSize(k.dtree,k.dhst),u+=14+3*_h+G.F.contSize(k.itree,k.ihst)+(2*k.ihst[16]+3*k.ihst[17]+7*k.ihst[18]);for(var F_=0;286>F_;F_++)k.lhst[F_]=0;for(F_=0;30>F_;F_++)k.dhst[F_]=0;for(F_=0;19>F_;F_++)k.ihst[F_]=0;if(E_=E_<y_&&E_<u?0:y_<u?1:2,j(O,C,i),j(O,C+1,E_),C+=3,E_==0){for(;(7&C)!=0;)C++;C=G.F._copyExact(h,E,v,O,C)}else{if(E_==1)var w_=k.fltree,W_=k.fdtree;if(E_==2){for(G.F.makeCodes(k.ltree,_e),G.F.revCodes(k.ltree,_e),G.F.makeCodes(k.dtree,na),G.F.revCodes(k.dtree,na),G.F.makeCodes(k.itree,_c),G.F.revCodes(k.itree,_c),w_=k.ltree,W_=k.dtree,K(O,C,_a-257),K(O,C+=5,_s-1),K(O,C+=5,_h-4),C+=4,i=0;i<_h;i++)K(O,C+3*i,k.itree[1+(k.ordr[i]<<1)]);C=G.F._codeTiny(_f,k.itree,O,C+3*_h),C=G.F._codeTiny($,k.itree,O,C)}for(_h=0;_h<o;_h+=2){for(_f=(i=r[_h])>>>23,i=E+(8388607&i);E<i;)C=G.F._writeLit(h[E++],w_,O,C);_f!=0&&(i=(_e=r[_h+1])>>16,v=_e>>8&255,_e&=255,K(O,C=G.F._writeLit(257+v,w_,O,C),_f-k.of0[v]),C+=k.exb[v],j(O,C=G.F._writeLit(_e,W_,O,C),i-k.df0[_e]),C+=k.dxb[_e],E+=_f)}C=G.F._writeLit(256,w_,O,C)}return C},G.F._copyExact=function(i,r,o,u,h){var E=h>>>3;return u[E]=o,u[E+1]=o>>>8,u[E+2]=255-u[E],u[E+3]=255-u[E+1],E+=4,u.set(new Uint8Array(i.buffer,r,o),E),h+(o+4<<3)},G.F.getTrees=function(){for(var i=G.F.U,r=G.F._hufTree(i.lhst,i.ltree,15),o=G.F._hufTree(i.dhst,i.dtree,15),u=[],h=G.F._lenCodes(i.ltree,u),E=[],v=G.F._lenCodes(i.dtree,E),O=0;O<u.length;O+=2)i.ihst[u[O]]++;for(O=0;O<E.length;O+=2)i.ihst[E[O]]++;O=G.F._hufTree(i.ihst,i.itree,7);for(var C=19;4<C&&i.itree[1+(i.ordr[C-1]<<1)]==0;)C--;return[r,o,O,h,v,C,u,E]},G.F.getSecond=function(i){for(var r=[],o=0;o<i.length;o+=2)r.push(i[o+1]);return r},G.F.nonZero=function(i){for(var r="",o=0;o<i.length;o+=2)i[o+1]!=0&&(r+=(o>>1)+",");return r},G.F.contSize=function(i,r){for(var o=0,u=0;u<r.length;u++)o+=r[u]*i[1+(u<<1)];return o},G.F._codeTiny=function(i,r,o,u){for(var h=0;h<i.length;h+=2){var E=i[h],v=i[h+1];u=G.F._writeLit(E,r,o,u);var O=E==16?2:E==17?3:7;15<E&&(G.F._putsE(o,u,v,O),u+=O)}return u},G.F._lenCodes=function(i,r){for(var o=i.length;o!=2&&i[o-1]==0;)o-=2;for(var u=0;u<o;u+=2){var h=i[u+1],E=u+3<o?i[u+3]:-1,v=u+5<o?i[u+5]:-1,O=u==0?-1:i[u-1];if(h==0&&E==h&&v==h){for(E=u+5;E+2<o&&i[E+2]==h;)E+=2;11>(h=Math.min(E+1-u>>>1,138))?r.push(17,h-3):r.push(18,h-11),u+=2*h-2}else if(h==O&&E==h&&v==h){for(E=u+5;E+2<o&&i[E+2]==h;)E+=2;h=Math.min(E+1-u>>>1,6),r.push(16,h-3),u+=2*h-2}else r.push(h,0)}return o>>>1},G.F._hufTree=function(i,r,o){var u=[],h=i.length,E=r.length,v=0;for(v=0;v<E;v+=2)r[v]=0,r[v+1]=0;for(v=0;v<h;v++)i[v]!=0&&u.push({lit:v,f:i[v]});if(i=u.length,h=u.slice(0),i==0)return 0;if(i==1)return r[1+((o=u[0].lit)<<1)]=1,r[1+((o==0?1:0)<<1)]=1;u.sort(function(j,K){return j.f-K.f}),v=u[0],E=u[1];var O=0,C=1,k=2;for(u[0]={lit:-1,f:v.f+E.f,l:v,r:E,d:0};C!=i-1;)v=O!=C&&(k==i||u[O].f<u[k].f)?u[O++]:u[k++],E=O!=C&&(k==i||u[O].f<u[k].f)?u[O++]:u[k++],u[C++]={lit:-1,f:v.f+E.f,l:v,r:E};for((u=G.F.setDepth(u[C-1],0))>o&&(G.F.restrictDepth(h,o,u),u=o),v=0;v<i;v++)r[1+(h[v].lit<<1)]=h[v].d;return u},G.F.setDepth=function(i,r){return i.lit!=-1?i.d=r:Math.max(G.F.setDepth(i.l,r+1),G.F.setDepth(i.r,r+1))},G.F.restrictDepth=function(i,r,o){var u=0,h=1<<o-r,E=0;for(i.sort(function(O,C){return C.d==O.d?O.f-C.f:C.d-O.d}),u=0;u<i.length&&i[u].d>r;u++){var v=i[u].d;i[u].d=r,E+=h-(1<<o-v)}for(E>>>=o-r;0<E;)(v=i[u].d)<r?(i[u].d++,E-=1<<r-v-1):u++;for(;0<=u;u--)i[u].d==r&&0>E&&(i[u].d--,E++);E!=0&&console.log("debt left")},G.F._goodIndex=function(i,r){var o=0;return r[16|o]<=i&&(o|=16),r[8|o]<=i&&(o|=8),r[4|o]<=i&&(o|=4),r[2|o]<=i&&(o|=2),r[1|o]<=i&&(o|=1),o},G.F._writeLit=function(i,r,o,u){return G.F._putsF(o,u,r[i<<1]),u+r[1+(i<<1)]},G.F.inflate=function(i,r){var o=Uint8Array;if(i[0]==3&&i[1]==0)return r||new o(0);var u=G.F,h=u._bitsF,E=u._bitsE,v=u._decodeTiny,O=u.makeCodes,C=u.codes2map,k=u._get17,j=u.U,K=r==null;K&&(r=new o(i.length>>>2<<3));for(var $,_e,na,_c,_a=0,_s=0,_h=_e=0,_f=0;_a==0;)if(_a=h(i,_f,1),$=h(i,_f+1,2),_f+=3,$==0)(7&_f)!=0&&(_f+=8-(7&_f)),$=i[(_f=4+(_f>>>3))-4]|i[_f-3]<<8,K&&(r=G.F._check(r,_h+$)),r.set(new o(i.buffer,i.byteOffset+_f,$),_h),_f=_f+$<<3,_h+=$;else{if(K&&(r=G.F._check(r,_h+131072)),$==1&&(na=j.flmap,_c=j.fdmap,_s=511,_e=31),$==2){for(_e=E(i,_f,5)+257,$=E(i,_f+5,5)+1,na=E(i,_f+10,4)+4,_f+=14,_c=0;38>_c;_c+=2)j.itree[_c]=0,j.itree[_c+1]=0;for(_s=1,_c=0;_c<na;_c++){var E_=E(i,_f+3*_c,3);j.itree[1+(j.ordr[_c]<<1)]=E_,E_>_s&&(_s=E_)}_f+=3*na,O(j.itree,_s),C(j.itree,_s,j.imap),na=j.lmap,_c=j.dmap,_f=v(j.imap,(1<<_s)-1,_e+$,i,_f,j.ttree),_s=(1<<(E_=u._copyOut(j.ttree,0,_e,j.ltree)))-1,_e=(1<<($=u._copyOut(j.ttree,_e,$,j.dtree)))-1,O(j.ltree,E_),C(j.ltree,E_,na),O(j.dtree,$),C(j.dtree,$,_c)}for(;;)if(_f+=15&($=na[k(i,_f)&_s]),(E_=$>>>4)>>>8==0)r[_h++]=E_;else{if(E_==256)break;$=_h+E_-254,264<E_&&($=_h+((E_=j.ldef[E_-257])>>>3)+E(i,_f,7&E_),_f+=7&E_),_f+=15&(E_=_c[k(i,_f)&_e]);var y_=((E_=j.ddef[E_>>>4])>>>4)+h(i,_f,15&E_);for(_f+=15&E_,K&&(r=G.F._check(r,_h+131072));_h<$;)r[_h]=r[_h++-y_],r[_h]=r[_h++-y_],r[_h]=r[_h++-y_],r[_h]=r[_h++-y_];_h=$}}return r.length==_h?r:r.slice(0,_h)},G.F._check=function(i,r){var o=i.length;return r<=o?i:((r=new Uint8Array(Math.max(o<<1,r))).set(i,0),r)},G.F._decodeTiny=function(i,r,o,u,h,E){for(var v=G.F._bitsE,O=G.F._get17,C=0;C<o;){var k=i[O(u,h)&r];h+=15&k;var j=k>>>4;if(15>=j)E[C]=j,C++;else{var K=k=0;for(j==16?(K=3+v(u,h,2),h+=2,k=E[C-1]):j==17?(K=3+v(u,h,3),h+=3):j==18&&(K=11+v(u,h,7),h+=7),j=C+K;C<j;)E[C]=k,C++}}return h},G.F._copyOut=function(i,r,o,u){for(var h=0,E=0,v=u.length>>>1;E<o;){var O=i[E+r];u[E<<1]=0,u[1+(E<<1)]=O,O>h&&(h=O),E++}for(;E<v;)u[E<<1]=0,u[1+(E<<1)]=0,E++;return h},G.F.makeCodes=function(i,r){var o,u,h=G.F.U,E=i.length,v=h.bl_count;for(o=0;o<=r;o++)v[o]=0;for(o=1;o<E;o+=2)v[i[o]]++;for(h=h.next_code,o=0,v[0]=0,u=1;u<=r;u++)o=o+v[u-1]<<1,h[u]=o;for(r=0;r<E;r+=2)(v=i[r+1])!=0&&(i[r]=h[v],h[v]++)},G.F.codes2map=function(i,r,o){for(var u=i.length,h=G.F.U.rev15,E=0;E<u;E+=2)if(i[E+1]!=0){var v=i[E+1],O=E>>1<<4|v,C=r-v;for(C=(v=i[E]<<C)+(1<<C);v!=C;)o[h[v]>>>15-r]=O,v++}},G.F.revCodes=function(i,r){for(var o=G.F.U.rev15,u=15-r,h=0;h<i.length;h+=2)i[h]=o[i[h]<<r-i[h+1]]>>>u},G.F._putsE=function(i,r,o){o<<=7&r,i[r>>>=3]|=o,i[r+1]|=o>>>8},G.F._putsF=function(i,r,o){o<<=7&r,i[r>>>=3]|=o,i[r+1]|=o>>>8,i[r+2]|=o>>>16},G.F._bitsE=function(i,r,o){return(i[r>>>3]|i[1+(r>>>3)]<<8)>>>(7&r)&(1<<o)-1},G.F._bitsF=function(i,r,o){return(i[r>>>3]|i[1+(r>>>3)]<<8|i[2+(r>>>3)]<<16)>>>(7&r)&(1<<o)-1},G.F._get17=function(i,r){return(i[r>>>3]|i[1+(r>>>3)]<<8|i[2+(r>>>3)]<<16)>>>(7&r)},G.F._get25=function(i,r){return(i[r>>>3]|i[1+(r>>>3)]<<8|i[2+(r>>>3)]<<16|i[3+(r>>>3)]<<24)>>>(7&r)},G.F.U=function(){var i=Uint16Array,r=Uint32Array;return{next_code:new i(16),bl_count:new i(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new i(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new i(512),fltree:[],fdmap:new i(32),fdtree:[],lmap:new i(32768),ltree:[],ttree:[],dmap:new i(32768),dtree:[],imap:new i(512),itree:[],rev15:new i(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new i(65536),prev:new i(32768)}}(),function(){function i(h,E,v){for(;E--!=0;)h.push(0,v)}for(var r=G.F.U,o=0;32768>o;o++){var u=o;u=(4278255360&(u=(4042322160&(u=(3435973836&(u=(2863311530&u)>>>1|(1431655765&u)<<1))>>>2|(858993459&u)<<2))>>>4|(252645135&u)<<4))>>>8|(16711935&u)<<8,r.rev15[o]=(u>>>16|u<<16)>>>17}for(o=0;32>o;o++)r.ldef[o]=r.of0[o]<<3|r.exb[o],r.ddef[o]=r.df0[o]<<4|r.dxb[o];i(r.fltree,144,8),i(r.fltree,112,9),i(r.fltree,24,7),i(r.fltree,8,8),G.F.makeCodes(r.fltree,9),G.F.codes2map(r.fltree,9,r.flmap),G.F.revCodes(r.fltree,9),i(r.fdtree,32,5),G.F.makeCodes(r.fdtree,5),G.F.codes2map(r.fdtree,5,r.fdmap),G.F.revCodes(r.fdtree,5),i(r.itree,19,0),i(r.ltree,286,0),i(r.dtree,30,0),i(r.ttree,320,0)}();var DE=Array.isArray||function(i){return i&&typeof i.length=="number"},EE=Object.defineProperty({isArray:DE},"__esModule",{value:!0}),FE=Object.defineProperty({isObject:function(i){return i!==null&&qa(i)==="object"}},"__esModule",{value:!0}),GE=Object.defineProperty({isFunction:function(i){return typeof i=="function"}},"__esModule",{value:!0}),HE=function(){function i(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(o,u){return u+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return i.prototype=Object.create(Error.prototype),i}(),uh=Object.defineProperty({UnsubscriptionError:HE},"__esModule",{value:!0}),IE=function(){function i(o){this.closed=!1,this._subscriptions=this._parentOrParents=null,o&&(this._ctorUnsubscribe=!0,this._unsubscribe=o)}var r;return i.prototype.unsubscribe=function(){if(!this.closed){var o=this._parentOrParents,u=this._ctorUnsubscribe,h=this._unsubscribe,E=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,o instanceof i)o.remove(this);else if(o!==null)for(var v=0;v<o.length;++v)o[v].remove(this);if(GE.isFunction(h)){u&&(this._unsubscribe=void 0);try{h.call(this)}catch(C){var O=C instanceof uh.UnsubscriptionError?eo(C.errors):[C]}}if(EE.isArray(E)){for(v=-1,o=E.length;++v<o;)if(u=E[v],FE.isObject(u))try{u.unsubscribe()}catch(C){O=O||[],C instanceof uh.UnsubscriptionError?O=O.concat(eo(C.errors)):O.push(C)}}if(O)throw new uh.UnsubscriptionError(O)}},i.prototype.add=function(o){var u=o;if(!o)return i.EMPTY;switch(qa(o)){case"function":u=new i(o);case"object":if(u===this||u.closed||typeof u.unsubscribe!="function")return u;if(this.closed)return u.unsubscribe(),u;u instanceof i||(o=u,(u=new i)._subscriptions=[o]);break;default:throw Error("unrecognized teardown "+o+" added to Subscription.")}if((o=u._parentOrParents)===null)u._parentOrParents=this;else if(o instanceof i){if(o===this)return u;u._parentOrParents=[o,this]}else{if(o.indexOf(this)!==-1)return u;o.push(this)}return(o=this._subscriptions)===null?this._subscriptions=[u]:o.push(u),u},i.prototype.remove=function(o){var u=this._subscriptions;u&&(o=u.indexOf(o))!==-1&&u.splice(o,1)},i.EMPTY=((r=new i).closed=!0,r),i}(),JE=Object.defineProperty({Subscription:IE},"__esModule",{value:!0}),KE=Ya&&Ya.__extends||function(){var i=function(r,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,h){u.__proto__=h}||function(u,h){for(var E in h)h.hasOwnProperty(E)&&(u[E]=h[E])})(r,o)};return function(r,o){function u(){this.constructor=r}i(r,o),r.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),LE=function(i){function r(o,u){return i.call(this)||this}return KE(r,i),r.prototype.schedule=function(o,u){return this},r}(JE.Subscription),ME=Object.defineProperty({Action:LE},"__esModule",{value:!0}),NE=Ya&&Ya.__extends||function(){var i=function(r,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,h){u.__proto__=h}||function(u,h){for(var E in h)h.hasOwnProperty(E)&&(u[E]=h[E])})(r,o)};return function(r,o){function u(){this.constructor=r}i(r,o),r.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),gt=function(i){function r(o,u){var h=i.call(this,o,u)||this;return h.scheduler=o,h.work=u,h.pending=!1,h}return NE(r,i),r.prototype.schedule=function(o,u){if(u===void 0&&(u=0),this.closed)return this;this.state=o,o=this.id;var h=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(h,o,u)),this.pending=!0,this.delay=u,this.id=this.id||this.requestAsyncId(h,this.id,u),this},r.prototype.requestAsyncId=function(o,u,h){return h===void 0&&(h=0),setInterval(o.flush.bind(o,this),h)},r.prototype.recycleAsyncId=function(o,u,h){if(h===void 0&&(h=0),h!==null&&this.delay===h&&this.pending===!1)return u;clearInterval(u)},r.prototype.execute=function(o,u){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(o=this._execute(o,u))?o:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},r.prototype._execute=function(o,u){u=!1;var h=void 0;try{this.work(o)}catch(E){u=!0,h=!!E&&E||Error(E)}if(u)return this.unsubscribe(),h},r.prototype._unsubscribe=function(){var o=this.id,u=this.scheduler,h=u.actions,E=h.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,E!==-1&&h.splice(E,1),o!=null&&(this.id=this.recycleAsyncId(u,o,null)),this.delay=null},r}(ME.Action),OE=function(){function i(r,o){o===void 0&&(o=i.now),this.SchedulerAction=r,this.now=o}return i.prototype.schedule=function(r,o,u){return o===void 0&&(o=0),new this.SchedulerAction(this,r).schedule(u,o)},i.now=function(){return Date.now()},i}(),ht=Object.defineProperty({Scheduler:OE},"__esModule",{value:!0}),PE=Ya&&Ya.__extends||function(){var i=function(r,o){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,h){u.__proto__=h}||function(u,h){for(var E in h)h.hasOwnProperty(E)&&(u[E]=h[E])})(r,o)};return function(r,o){function u(){this.constructor=r}i(r,o),r.prototype=o===null?Object.create(o):(u.prototype=o.prototype,new u)}}(),it=function(i){function r(o,u){u===void 0&&(u=ht.Scheduler.now);var h=i.call(this,o,function(){return r.delegate&&r.delegate!==h?r.delegate.now():u()})||this;return h.actions=[],h.active=!1,h.scheduled=void 0,h}return PE(r,i),r.prototype.schedule=function(o,u,h){return u===void 0&&(u=0),r.delegate&&r.delegate!==this?r.delegate.schedule(o,u,h):i.prototype.schedule.call(this,o,u,h)},r.prototype.flush=function(o){var u=this.actions;if(this.active)u.push(o);else{var h;this.active=!0;do if(h=o.execute(o.state,o.delay))break;while(o=u.shift());if(this.active=!1,h){for(;o=u.shift();)o.unsubscribe();throw h}}},r}(ht.Scheduler),QE=Fa("iterator"),Wl=!la(function(){var i=new URL("b?a=1&b=2&c=3","http://a"),r=i.searchParams,o="";return i.pathname="c%20d",r.forEach(function(u,h){r.delete("b"),o+=h+u}),!r.sort||i.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[QE]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),RE=/[^\0-\u007E]/,SE=/[.\u3002\uFF0E\uFF61]/g,Ff=Math.floor,Xl=String.fromCharCode,jt=function(i){var r=lg(i);if(typeof r!="function")throw TypeError(String(i)+" is not iterable");return Ia(r.call(i))},kt=Pc("fetch"),Yl=Pc("Headers"),TE=Fa("iterator"),lt=cb.set,cc=cb.getterFor("URLSearchParams"),UE=cb.getterFor("URLSearchParamsIterator"),VE=/\+/g,mt=Array(4),WE=function(i){try{return decodeURIComponent(i)}catch{return i}},nt=function(i){var r=i.replace(VE," ");i=4;try{return decodeURIComponent(r)}catch{for(;i;){var o=r.replace,u=i--;u=mt[u-1]||(mt[u-1]=RegExp("((?:%[\\da-f]{2}){"+u+"})","gi")),r=o.call(r,u,WE)}return r}},ot=/[!'()~]|%20/g,XE={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pt=function(i){return XE[i]},qt=function(i,r){if(r){r=r.split("&");for(var o,u=0;u<r.length;)(o=r[u++]).length&&(o=o.split("="),i.push({key:nt(o.shift()),value:nt(o.join("="))}))}},YE=function(i){this.entries.length=0,qt(this.entries,i)},Gf=function(i,r){if(i<r)throw TypeError("Not enough arguments")},Zl=Wo(function(i,r){lt(this,{type:"URLSearchParamsIterator",iterator:jt(cc(i).entries),kind:r})},"Iterator",function(){var i=UE(this),r=i.kind,o=(i=i.iterator.next()).value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i}),Rg=function(){Ac(this,Rg,"URLSearchParams");var i,r,o,u=0<arguments.length?arguments[0]:void 0,h=[];if(lt(this,{type:"URLSearchParams",entries:h,updateURL:function(){},updateSearchParams:YE}),u!==void 0)if(xa(u)){var E=lg(u);if(typeof E=="function")for(u=E.call(u),E=u.next;!(i=E.call(u)).done;){var v=(i=jt(Ia(i.value))).next;if((r=v.call(i)).done||(o=v.call(i)).done||!v.call(i).done)throw TypeError("Expected sequence with length 2");h.push({key:r.value+"",value:o.value+""})}else for(i in u)ka(u,i)&&h.push({key:i,value:u[i]+""})}else qt(h,typeof u=="string"?u.charAt(0)==="?"?u.slice(1):u:u+"")},Bi=Rg.prototype;kf(Bi,{append:function(i,r){Gf(arguments.length,2);var o=cc(this);o.entries.push({key:i+"",value:r+""}),o.updateURL()},delete:function(i){Gf(arguments.length,1);for(var r=cc(this),o=r.entries,u=i+"",h=0;h<o.length;)o[h].key===u?o.splice(h,1):h++;r.updateURL()},get:function(i){Gf(arguments.length,1);for(var r=cc(this).entries,o=i+"",u=0;u<r.length;u++)if(r[u].key===o)return r[u].value;return null},getAll:function(i){Gf(arguments.length,1);for(var r=cc(this).entries,o=i+"",u=[],h=0;h<r.length;h++)r[h].key===o&&u.push(r[h].value);return u},has:function(i){Gf(arguments.length,1);for(var r=cc(this).entries,o=i+"",u=0;u<r.length;)if(r[u++].key===o)return!0;return!1},set:function(i,r){Gf(arguments.length,1);for(var o,u=cc(this),h=u.entries,E=!1,v=i+"",O=r+"",C=0;C<h.length;C++)(o=h[C]).key===v&&(E?h.splice(C--,1):(E=!0,o.value=O));E||h.push({key:v,value:O}),u.updateURL()},sort:function(){var i,r,o=cc(this),u=o.entries,h=u.slice();for(r=u.length=0;r<h.length;r++){var E=h[r];for(i=0;i<r;i++)if(u[i].key>E.key){u.splice(i,0,E);break}i===r&&u.push(E)}o.updateURL()},forEach:function(i){for(var r,o=cc(this).entries,u=Dd(i,1<arguments.length?arguments[1]:void 0,3),h=0;h<o.length;)u((r=o[h++]).value,r.key,this)},keys:function(){return new Zl(this,"keys")},values:function(){return new Zl(this,"values")},entries:function(){return new Zl(this,"entries")}},{enumerable:!0}),Za(Bi,TE,Bi.entries),Za(Bi,"toString",function(){for(var i,r=cc(this).entries,o=[],u=0;u<r.length;)i=r[u++],o.push(encodeURIComponent(i.key).replace(ot,pt)+"="+encodeURIComponent(i.value).replace(ot,pt));return o.join("&")},{enumerable:!0}),zc(Rg,"URLSearchParams"),ea({global:!0,forced:!Wl},{URLSearchParams:Rg}),Wl||typeof kt!="function"||typeof Yl!="function"||ea({global:!0,enumerable:!0,forced:!0},{fetch:function(i){var r=[i];if(1<arguments.length){var o=arguments[1];if(xa(o)){var u=o.body;if(jf(u)==="URLSearchParams"){var h=o.headers?new Yl(o.headers):new Yl;h.has("content-type")||h.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),o=jc(o,{body:Nc(0,String(u)),headers:Nc(0,h)})}}r.push(o)}return kt.apply(this,r)}});var Sg=R.URL,ZE=Rg,$E=cb.set,db=cb.getterFor("URL"),aF=Math.floor,rt=Math.pow,st=/[A-Za-z]/,bF=/[\d+-.A-Za-z]/,$l=/\d/,cF=/^(0x|0X)/,dF=/^[0-7]+$/,eF=/^\d+$/,tt=/^[\dA-Fa-f]+$/,fF=/[\0\t\n\r #%/:?@[\\]]/,gF=/[\0\t\n\r #/:?@[\\]]/,hF=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,iF=/[\t\n\r]/g,am=function(i,r){var o;if(r.charAt(0)=="["){if(r.charAt(r.length-1)!="]")return"Invalid host";var u=jF(r.slice(1,-1));if(!u)return"Invalid host"}else if(wb(i)){for(u=[],r=r.toLowerCase().replace(SE,".").split("."),o=0;o<r.length;o++){var h=r[o],E=u,v=E.push;if(RE.test(h)){var O=h;h=[];var C=O;O=[];for(var k=0,j=C.length;k<j;){var K=C.charCodeAt(k++);if(55296<=K&&56319>=K&&k<j){var $=C.charCodeAt(k++);(64512&$)==56320?O.push(((1023&K)<<10)+(1023&$)+65536):(O.push(K),k--)}else O.push(K)}k=O.length,j=128;var _e=0,na=72;for(C=0;C<O.length;C++){var _c=O[C];128>_c&&h.push(Xl(_c))}for(($=K=h.length)&&h.push("-");$<k;){var _a=2147483647;for(C=0;C<O.length;C++)(_c=O[C])>=j&&_c<_a&&(_a=_c);var _s=$+1;if(_a-j>Ff((2147483647-_e)/_s))throw RangeError("Overflow: input needs wider integers to process");for(_e+=(_a-j)*_s,j=_a,C=0;C<O.length;C++){if((_c=O[C])<j&&2147483647<++_e)throw RangeError("Overflow: input needs wider integers to process");if(_c==j){var _h=_e;for(_c=36;!(_h<(_a=_c<=na?1:_c>=na+26?26:_c-na));_c+=36){var _f=36-_a,E_=h;_a+=(_h-=_a)%_f,E_.push.call(E_,Xl(_a+22+75*(26>_a))),_h=Ff(_h/_f)}for(h.push(Xl(_h+22+75*(26>_h))),na=_s,_c=0,_e=$==K?Ff(_e/700):_e>>1,_e+=Ff(_e/na);455<_e;_c+=36)_e=Ff(_e/35);na=Ff(_c+36*_e/(_e+38)),_e=0,++$}}++_e,++j}h="xn--"+h.join("")}v.call(E,h)}if(r=u.join("."),fF.test(r)||(u=kF(r))===null)return"Invalid host"}else{if(gF.test(r))return"Invalid host";for(u="",r=ge(r),o=0;o<r.length;o++)u+=Qd(r[o],Ci)}i.host=u},kF=function(i){var r,o=i.split(".");o.length&&o[o.length-1]==""&&o.pop();var u=o.length;if(4<u)return i;var h=[];for(r=0;r<u;r++){var E=o[r];if(E=="")return i;var v=10;if(1<E.length&&E.charAt(0)=="0"&&(v=cF.test(E)?16:8,E=E.slice(v==8?1:2)),E==="")E=0;else{if(!(v==10?eF:v==8?dF:tt).test(E))return i;E=parseInt(E,v)}h.push(E)}for(r=0;r<u;r++)if(E=h[r],r==u-1){if(E>=rt(256,5-u))return null}else if(255<E)return null;for(i=h.pop(),r=0;r<h.length;r++)i+=h[r]*rt(256,3-r);return i},jF=function(i){var r,o,u=[0,0,0,0,0,0,0,0],h=0,E=null,v=0,O=function(){return i.charAt(v)};if(O()==":"){if(i.charAt(1)!=":")return;v+=2,E=++h}for(;O();){if(h==8)return;if(O()==":"){if(E!==null)return;v++,E=++h}else{for(r=o=0;4>o&&tt.test(O());)r=16*r+parseInt(O(),16),v++,o++;if(O()=="."){if(o==0||(v-=o,6<h))return;for(r=0;O();){if(o=null,0<r){if(!(O()=="."&&4>r))return;v++}if(!$l.test(O()))return;for(;$l.test(O());){var C=parseInt(O(),10);if(o===null)o=C;else{if(o==0)return;o=10*o+C}if(255<o)return;v++}u[h]=256*u[h]+o,++r!=2&&r!=4||h++}if(r!=4)return;break}if(O()==":"){if(v++,!O())return}else if(O())return;u[h++]=r}}if(E!==null)for(O=h-E,h=7;h!=0&&0<O;)r=u[h],u[h--]=u[E+O-1],u[E+--O]=r;else if(h!=8)return;return u},Tg=function(i){var r,o;if(typeof i=="number"){var u=[];for(r=0;4>r;r++)u.unshift(i%256),i=aF(i/256);return u.join(".")}if(typeof i=="object"){u="",r=null;for(var h=1,E=null,v=0,O=0;8>O;O++)i[O]!==0?(v>h&&(r=E,h=v),E=null,v=0):(E===null&&(E=O),++v);for(v>h&&(r=E),h=r,r=0;8>r;r++)o&&i[r]===0||(o&&(o=!1),h===r?(u+=r?":":"::",o=!0):(u+=i[r].toString(16),7>r&&(u+=":")));return"["+u+"]"}return i},Ci={},ut=Bg({},Ci,{" ":1,'"':1,"<":1,">":1,"`":1}),vt=Bg({},ut,{"#":1,"?":1,"{":1,"}":1}),bm=Bg({},vt,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qd=function(i,r){var o=uw(i,0);return 32<o&&127>o&&!ka(r,i)?i:encodeURIComponent(i)},Di={ftp:21,file:null,http:80,https:443,ws:80,wss:443},wb=function(i){return ka(Di,i.scheme)},cm=function(i){return!i.host||i.cannotBeABaseURL||i.scheme=="file"},Ug=function(i,r){var o;return i.length==2&&st.test(i.charAt(0))&&((o=i.charAt(1))==":"||!r&&o=="|")},wt=function(i){var r;return 1<i.length&&Ug(i.slice(0,2))&&(i.length==2||(r=i.charAt(2))==="/"||r==="\\"||r==="?"||r==="#")},xt=function(i){var r=i.path,o=r.length;!o||i.scheme=="file"&&o==1&&Ug(r[0],!0)||r.pop()},dm={},yt={},em={},zt={},At={},fm={},Bt={},Ct={},Ei={},Fi={},gm={},hm={},im={},jm={},Dt={},km={},Vg={},Yc={},Et={},ye={},vd={},Zc=function(i,r,o,u){var h=o||dm,E=0,v="",O=!1,C=!1,k=!1;for(o||(i.scheme="",i.username="",i.password="",i.host=null,i.port=null,i.path=[],i.query=null,i.fragment=null,i.cannotBeABaseURL=!1,r=r.replace(hF,"")),r=r.replace(iF,""),r=ge(r);E<=r.length;){var j=r[E];switch(h){case dm:if(!j||!st.test(j)){if(o)return"Invalid scheme";h=em;continue}v+=j.toLowerCase(),h=yt;break;case yt:if(j&&(bF.test(j)||j=="+"||j=="-"||j=="."))v+=j.toLowerCase();else{if(j!=":"){if(o)return"Invalid scheme";v="",h=em,E=0;continue}if(o&&(wb(i)!=ka(Di,v)||v=="file"&&(i.username!=""||i.password!=""||i.port!==null)||i.scheme=="file"&&!i.host))return;if(i.scheme=v,o)return void(wb(i)&&Di[i.scheme]==i.port&&(i.port=null));v="",i.scheme=="file"?h=jm:wb(i)&&u&&u.scheme==i.scheme?h=zt:wb(i)?h=Ct:r[E+1]=="/"?(h=At,E++):(i.cannotBeABaseURL=!0,i.path.push(""),h=Et)}break;case em:if(!u||u.cannotBeABaseURL&&j!="#")return"Invalid scheme";if(u.cannotBeABaseURL&&j=="#"){i.scheme=u.scheme,i.path=u.path.slice(),i.query=u.query,i.fragment="",i.cannotBeABaseURL=!0,h=vd;break}h=u.scheme=="file"?jm:fm;continue;case zt:if(j!="/"||r[E+1]!="/"){h=fm;continue}h=Ei,E++;break;case At:if(j=="/"){h=Fi;break}h=Yc;continue;case fm:if(i.scheme=u.scheme,j==null)i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.query=u.query;else if(j=="/"||j=="\\"&&wb(i))h=Bt;else if(j=="?")i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.query="",h=ye;else{if(j!="#"){i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.path.pop(),h=Yc;continue}i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,i.path=u.path.slice(),i.query=u.query,i.fragment="",h=vd}break;case Bt:if(!wb(i)||j!="/"&&j!="\\"){if(j!="/"){i.username=u.username,i.password=u.password,i.host=u.host,i.port=u.port,h=Yc;continue}h=Fi}else h=Ei;break;case Ct:if(h=Ei,j!="/"||v.charAt(E+1)!="/")continue;E++;break;case Ei:if(j!="/"&&j!="\\"){h=Fi;continue}break;case Fi:if(j=="@"){for(O&&(v="%40"+v),O=!0,v=ge(v),j=0;j<v.length;j++){var K=v[j];K!=":"||k?(K=Qd(K,bm),k?i.password+=K:i.username+=K):k=!0}v=""}else if(j==null||j=="/"||j=="?"||j=="#"||j=="\\"&&wb(i)){if(O&&v=="")return"Invalid authority";E-=ge(v).length+1,v="",h=gm}else v+=j;break;case gm:case hm:if(o&&i.scheme=="file"){h=km;continue}if(j!=":"||C){if(j==null||j=="/"||j=="?"||j=="#"||j=="\\"&&wb(i)){if(wb(i)&&v=="")return"Invalid host";if(o&&v==""&&(i.username!=""||i.password!=""||i.port!==null))return;if(h=am(i,v))return h;if(v="",h=Vg,o)return;continue}j=="["?C=!0:j=="]"&&(C=!1),v+=j}else{if(v=="")return"Invalid host";if(h=am(i,v))return h;if(v="",h=im,o==hm)return}break;case im:if(!$l.test(j)){if(j==null||j=="/"||j=="?"||j=="#"||j=="\\"&&wb(i)||o){if(v!=""){if(65535<(h=parseInt(v,10)))return"Invalid port";i.port=wb(i)&&h===Di[i.scheme]?null:h,v=""}if(o)return;h=Vg;continue}return"Invalid port"}v+=j;break;case jm:if(i.scheme="file",j=="/"||j=="\\")h=Dt;else{if(!u||u.scheme!="file"){h=Yc;continue}if(j==null)i.host=u.host,i.path=u.path.slice(),i.query=u.query;else if(j=="?")i.host=u.host,i.path=u.path.slice(),i.query="",h=ye;else{if(j!="#"){wt(r.slice(E).join(""))||(i.host=u.host,i.path=u.path.slice(),xt(i)),h=Yc;continue}i.host=u.host,i.path=u.path.slice(),i.query=u.query,i.fragment="",h=vd}}break;case Dt:if(j=="/"||j=="\\"){h=km;break}u&&u.scheme=="file"&&!wt(r.slice(E).join(""))&&(Ug(u.path[0],!0)?i.path.push(u.path[0]):i.host=u.host),h=Yc;continue;case km:if(j==null||j=="/"||j=="\\"||j=="?"||j=="#"){if(!o&&Ug(v))h=Yc;else{if(v==""){if(i.host="",o)return}else{if(h=am(i,v))return h;if(i.host=="localhost"&&(i.host=""),o)return;v=""}h=Vg}continue}v+=j;break;case Vg:if(wb(i)){if(h=Yc,j!="/"&&j!="\\")continue}else if(o||j!="?")if(o||j!="#"){if(j!=null&&(h=Yc,j!="/"))continue}else i.fragment="",h=vd;else i.query="",h=ye;break;case Yc:if(j==null||j=="/"||j=="\\"&&wb(i)||!o&&(j=="?"||j=="#")){if((K=(K=v).toLowerCase())===".."||K==="%2e."||K===".%2e"||K==="%2e%2e"?(xt(i),j=="/"||j=="\\"&&wb(i)||i.path.push("")):v==="."||v.toLowerCase()==="%2e"?j=="/"||j=="\\"&&wb(i)||i.path.push(""):(i.scheme=="file"&&!i.path.length&&Ug(v)&&(i.host&&(i.host=""),v=v.charAt(0)+":"),i.path.push(v)),v="",i.scheme=="file"&&(j==null||j=="?"||j=="#"))for(;1<i.path.length&&i.path[0]==="";)i.path.shift();j=="?"?(i.query="",h=ye):j=="#"&&(i.fragment="",h=vd)}else v+=Qd(j,vt);break;case Et:j=="?"?(i.query="",h=ye):j=="#"?(i.fragment="",h=vd):j!=null&&(i.path[0]+=Qd(j,Ci));break;case ye:o||j!="#"?j!=null&&(j=="'"&&wb(i)?i.query+="%27":i.query=j=="#"?i.query+"%23":i.query+Qd(j,Ci)):(i.fragment="",h=vd);break;case vd:j!=null&&(i.fragment+=Qd(j,ut))}E++}},Rd=function(i){var r=Ac(this,Rd,"URL"),o=1<arguments.length?arguments[1]:void 0,u=String(i),h=$E(r,{type:"URL"});if(o!==void 0){if(o instanceof Rd)var E=db(o);else if(o=Zc(E={},String(o)))throw TypeError(o)}if(o=Zc(h,u,null,E))throw TypeError(o);var v=h.searchParams=new ZE;(u=cc(v)).updateSearchParams(h.query),u.updateURL=function(){h.query=String(v)||null},wa||(r.href=Gi.call(r),r.origin=Ft.call(r),r.protocol=Gt.call(r),r.username=Ht.call(r),r.password=It.call(r),r.host=Jt.call(r),r.hostname=Kt.call(r),r.port=Lt.call(r),r.pathname=Mt.call(r),r.search=Nt.call(r),r.searchParams=Ot.call(r),r.hash=Pt.call(r))},lm=Rd.prototype,Gi=function(){var i=db(this),r=i.scheme,o=i.username,u=i.password,h=i.host,E=i.port,v=i.path,O=i.query,C=i.fragment,k=r+":";return h!==null?(k+="//",i.username==""&&i.password==""||(k+=o+(u?":"+u:"")+"@"),k+=Tg(h),E!==null&&(k+=":"+E)):r=="file"&&(k+="//"),k+=i.cannotBeABaseURL?v[0]:v.length?"/"+v.join("/"):"",O!==null&&(k+="?"+O),C!==null&&(k+="#"+C),k},Ft=function(){var i=db(this),r=i.scheme,o=i.port;if(r=="blob")try{return new Rd(r.path[0]).origin}catch{return"null"}return r!="file"&&wb(i)?r+"://"+Tg(i.host)+(o!==null?":"+o:""):"null"},Gt=function(){return db(this).scheme+":"},Ht=function(){return db(this).username},It=function(){return db(this).password},Jt=function(){var i=db(this),r=i.host;return i=i.port,r===null?"":i===null?Tg(r):Tg(r)+":"+i},Kt=function(){var i=db(this).host;return i===null?"":Tg(i)},Lt=function(){var i=db(this).port;return i===null?"":String(i)},Mt=function(){var i=db(this),r=i.path;return i.cannotBeABaseURL?r[0]:r.length?"/"+r.join("/"):""},Nt=function(){var i=db(this).query;return i?"?"+i:""},Ot=function(){return db(this).searchParams},Pt=function(){var i=db(this).fragment;return i?"#"+i:""},tc=function(i,r){return{get:i,set:r,configurable:!0,enumerable:!0}};if(wa&&To(lm,{href:tc(Gi,function(i){var r=db(this);if(i=Zc(r,String(i)))throw TypeError(i);cc(r.searchParams).updateSearchParams(r.query)}),origin:tc(Ft),protocol:tc(Gt,function(i){var r=db(this);Zc(r,String(i)+":",dm)}),username:tc(Ht,function(i){var r=db(this);if(i=ge(String(i)),!cm(r)){r.username="";for(var o=0;o<i.length;o++)r.username+=Qd(i[o],bm)}}),password:tc(It,function(i){var r=db(this);if(i=ge(String(i)),!cm(r)){r.password="";for(var o=0;o<i.length;o++)r.password+=Qd(i[o],bm)}}),host:tc(Jt,function(i){var r=db(this);r.cannotBeABaseURL||Zc(r,String(i),gm)}),hostname:tc(Kt,function(i){var r=db(this);r.cannotBeABaseURL||Zc(r,String(i),hm)}),port:tc(Lt,function(i){var r=db(this);cm(r)||((i=String(i))==""?r.port=null:Zc(r,i,im))}),pathname:tc(Mt,function(i){var r=db(this);r.cannotBeABaseURL||(r.path=[],Zc(r,i+"",Vg))}),search:tc(Nt,function(i){var r=db(this);(i=String(i))==""?r.query=null:(i.charAt(0)=="?"&&(i=i.slice(1)),r.query="",Zc(r,i,ye)),cc(r.searchParams).updateSearchParams(r.query)}),searchParams:tc(Ot),hash:tc(Pt,function(i){var r=db(this);(i=String(i))==""?r.fragment=null:(i.charAt(0)=="#"&&(i=i.slice(1)),r.fragment="",Zc(r,i,vd))})}),Za(lm,"toJSON",function(){return Gi.call(this)},{enumerable:!0}),Za(lm,"toString",function(){return Gi.call(this)},{enumerable:!0}),Sg){var Qt=Sg.createObjectURL,Rt=Sg.revokeObjectURL;Qt&&Za(Rd,"createObjectURL",function(i){return Qt.apply(Sg,arguments)}),Rt&&Za(Rd,"revokeObjectURL",function(i){return Rt.apply(Sg,arguments)})}zc(Rd,"URL"),ea({global:!0,forced:!Wl,sham:!wa},{URL:Rd});var lF=new Blob(["var fakeIdToId = {};onmessage = function (event) {	var data = event.data,		name = data.name,		fakeId = data.fakeId,		time;	if(data.hasOwnProperty('time')) {		time = data.time;	}	switch (name) {		case 'setInterval':			fakeIdToId[fakeId] = setInterval(function () {				postMessage({fakeId: fakeId});			}, time);			break;		case 'clearInterval':			if (fakeIdToId.hasOwnProperty (fakeId)) {				clearInterval(fakeIdToId[fakeId]);				delete fakeIdToId[fakeId];			}			break;	}}"]),mF=window.URL.createObjectURL(lF),Ze={},dg=0,Aj=new Worker(mF);Aj.onmessage=function(i){if(i=i.data.fakeId,Ze.hasOwnProperty(i)){var r=Ze[i];i=r.callback,r=r.parameters,i.apply(window,r)}};var nF=function(i){function r(){return va(this,r),o.apply(this,arguments)}Ga(r,i);var o=Ha(r);return eb(r,[{key:"requestAsyncId",value:function(u,h){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;return Qv(u.flush.bind(u,this),E)}},{key:"recycleAsyncId",value:function(u,h){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if(E!==null&&this.delay===E&&this.pending===!1)return h;Ze.hasOwnProperty(h)&&(delete Ze[h],Aj.postMessage({name:"clearInterval",fakeId:h}))}}]),r}(gt),oF=new it(nF),pF=["group"],mm=G.inflate,St=G.deflate,Tt=function(i){function r(h,E,v,O){va(this,r);var C=u.call(this,O,"Session");return x(z(C),"lastNoticeTicket",""),x(z(C),"chatManager",void 0),x(z(C),"usedChannelIds",[]),x(z(C),"msgDedupLru",new Wc(void 0,{maxlen:200})),x(z(C),"startTime",Date.now()),x(z(C),"seq",P.fromNumber(1,!0)),x(z(C),"userJoinOptions",new et(!1)),x(z(C),"seqSentStatuses",[!1,!1]),x(z(C),"dialogueSequenceLru",new Wc(void 0,{maxlen:1e4})),x(z(C),"loggedOut",!1),x(z(C),"messageSentTimes",[]),x(z(C),"curLoginSockets",[void 0,void 0]),x(z(C),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),x(z(C),"lastLoginSockets",[new Te(1),new Te(1)]),x(z(C),"dialPendingMsgSubjectMap",new Map),x(z(C),"context",void 0),x(z(C),"connection",void 0),x(z(C),"instanceId",void 0),x(z(C),"lastPingTime",void 0),x(z(C),"chanelStringMessageReport",void 0),x(z(C),"chanelRawMessageReport",void 0),x(z(C),"p2pSMsgNoOfflineReport",void 0),x(z(C),"p2pRMsgNoOfflineReport",void 0),x(z(C),"registerSocketsFailureListener",function(){C.connection.once("socketsFailure",function(){C.log("socketsFailure, creating a new connection"),yd(function(){return C.connection.removeAllListeners(),C.connection=new ct(C.context,C.logger,!0),C.loginHandler(15e3,!0)}).pipe(Re(function(k){return k.pipe(Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")))}),Kc(C.connection.apClient.apFinish$)).subscribe(function(){C.log("new connection connected")})}),C.connection.listenerCount("tokenExpired")===0&&C.connection.on("tokenExpired",function(){C.emit("tokenExpired")})}),C.context=h,C.context.startTime=C.startTime,C.connection=E,C.instanceId=v,C.chatManager=new CE(O),C.lastPingTime=[0,0],C.setMaxListeners(512),C.log("The instanceId is %s",C.instanceId.toString()),C.chanelStringMessageReport=new zi(h,O,Ka.ChannelSMsg),C.chanelRawMessageReport=new zi(h,O,Ka.ChannelRMsg),C.p2pSMsgNoOfflineReport=new zi(h,O,Ka.P2pSMsgNoOfflineFlag),C.p2pRMsgNoOfflineReport=new zi(h,O,Ka.P2pRMsgNoOfflineFlag),C}Ga(r,i);var o,u=Ha(r);return eb(r,[{key:"loginHandler",value:function(){var h=this,E=0<arguments.length&&arguments[0]!==void 0?arguments[0]:12e3,v=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&v)throw new da("Already logged out, request ignored");v&&this.registerSocketsFailureListener(),this.connection.initConnection();var O=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),C=Date.now();return O.forEach(function(k,j){var K=h.loginSocketSubs[j].login;K!==void 0&&K.unsubscribe(),h.loginSocketSubs[j].login=k.pipe(sa(function($){var _e;h.curLoginSockets[j]=$;var na=Date.now();bb("Link",{ackedServerIp:$.address,destServerIp:$.ip,ec:0,sc:0,elapse:Xa(h.startTime),lts:P.fromNumber(na),responseTime:na-C,sid:sb(h.instanceId),userId:h.context.uid},(_e=h.context.config.enableCloudProxy)!==null&&_e!==void 0&&_e),h.emit("userJoined",$.env),v&&h.connection.apClient.apFinish$.next(void 0)})).subscribe(h.lastLoginSockets[j])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Jb.apply(void 0,Z(O).concat([Db(this.connection,"connectionInitFailure").pipe(sa(function(k){throw Na(k)||Ab(k)?k:new Ja("Login failure",{code:$r,originalError:k})}))])).pipe(hb(1),Lb(E),ab(function(k){return k instanceof Tb&&h.warn("Client login timeout"),k&&k.code===ti&&(h.connection.emit("tokenExpired"),h.connection.apClient.apFinish$.next(void 0)),h.clearSockets(0,v),ra(k)}),sa(function(){v||h.registerSocketsFailureListener()}),fh(function(){v||h.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:(o=ma(N.mark(function h(){var E,v,O,C=this;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),E=this.getLoginSockets(),v=E.map(function(j){return j.sendPacket("UserQuit",{}),C.connection.waitClosing(j)}),this.clearSockets(5e3),O=E.map(function(j){return j.env}),[0,1].filter(function(j){return!O.includes(j)}).forEach(function(j){C.connection.closeSocket(j,0)}),k.abrupt("return",Jb.apply(void 0,Z(v)).toPromise());case 9:case"end":return k.stop()}},h,this)})),function(){return o.apply(this,arguments)})},{key:"requestChannelJoin",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j=this;return N.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(this.getLoginSockets().length!==0){K.next=2;break}throw new da("Client is not logged in. Cannot join the channel",Wr);case 2:return O=Db(this,"channelLeft").pipe(yb(function($){return v===$}),hb(1)),C=this.incGetSeq(),(k=this.lastLoginSockets.map(function($){return $.pipe(Kb(function(_e,na){na!==0&&j.incSeqIfNeeded(_e.env);var _c=na===0?C:j.seq;return _e.sendPacket("GroupEnter",{account:v,seq:_c}),_e.fromReceived("GroupReply").pipe(Ca(function(_a){return _c.eq(_a.seq)}),sa(function(_a){if((_a=_a.code)!==0)throw new Ja(["Channel join failure. The response code is %d",_a],Sr)}))}),Kc(O),Se())})).forEach(function($,_e){var na=function(){return j.loginSocketSubs[_e].channels.delete(v)};j.loginSocketSubs[_e].channels.set(v,$.subscribe({error:na,complete:na}))}),K.next=8,Jb.apply(void 0,Z(k)).pipe(hb(1),Lb(1e4),ab(function($){return $ instanceof Tb&&j.warn("Channel join timeout"),ra($)})).toPromise();case 8:case"end":return K.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(h){this.getLoginSockets().forEach(function(E){E.sendPacket("GroupLeave",{account:h})})}},{key:"requestUpdateEdgeTicket",value:function(h){var E=this,v=this.getLoginSockets();if(v.length===0)throw new da("Client is not logged in. Cannot renew token",hs);var O=this.incGetSeq();return v.forEach(function(C){C.sendPacket("UserRenewTokenReq",{instance:E.instanceId,seq:O,account:E.context.uid,ticket:h})}),fb.apply(void 0,[r.genTimeoutError(Ml)].concat(Z(v.map(function(C){return C.fromReceived("UserRenewTokenResp").pipe(Ca(function(k){var j=k.code;return O.eq(k.seq)&&j===0}))}))))}},{key:"requestChannelMemberList",value:function(h){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in. Cannot get the channel members",JB);var v=this.incGetSeq();return E.forEach(function(O){O.sendPacket("GroupAllUsersList",{group:h,pageNumber:0,pageSize:200,seq:v})}),fb.apply(void 0,[r.genTimeoutError(Qr)].concat(Z(E.map(function(O){return O.fromReceived("GroupAllUsersResult").pipe(Ca(function(C){var k=C.seq;return C.group===h&&v.eq(k)}))}))))}},{key:"requestPeersOnlineStatus",value:function(h){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return E.forEach(function(O){O.sendPacket("UserStatusList",{users:h,seq:v})}),fb.apply(void 0,[r.genTimeoutError(VB)].concat(Z(E.map(function(O){return O.fromReceived("UserStatusResult").pipe(Ca(function(C){return v.eq(C.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(h,E){var v=this,O=this.getLoginSockets();if(O.length===0)throw new da("Client is not logged in");var C=this.incGetSeq();return O.forEach(function(k,j){E!==void 0&&j!==E||k.sendPacket("UserAttributeSet",{account:v.context.uid,attributeInfos:Object.entries(h).map(function(K){return{key:(K=$a(K,2))[0],value:K[1]}}),seq:C})}),fb.apply(void 0,Z(O.map(function(k){return k.fromReceived("UserAttributeErr").pipe(Ca(function(j){return C.eq(j.seq)}),Ea(function(j){throw new Ja(["The user attributes set failure, code %d",j.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(O.map(function(k){return k.fromReceived("UserAttributeRsp").pipe(Ca(function(j){return C.eq(j.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(h,E,v){var O=this.getLoginSockets();if(O.length===0)throw new da("Client is not logged in");var C=this.incGetSeq();return O.forEach(function(k){k.sendPacket("GroupAttributeSet",{broadcast:v,group:h,attributeInfos:Object.entries(E).map(function(j){return{key:(j=$a(j,2))[0],value:j[1]}}),seq:C})}),fb.apply(void 0,Z(O.map(function(k){return k.fromReceived("GroupAttributeErr").pipe(Ca(function(j){return C.eq(j.seq)}),Ea(function(j){throw new Ja(["The group attributes set failure, code %d",j.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(O.map(function(k){return k.fromReceived("GroupAttributeRsp").pipe(Ca(function(j){return C.eq(j.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(h){var E=this,v=this.getLoginSockets();if(v.length===0)throw new da("Client is not logged in");var O=this.incGetSeq();return v.forEach(function(C){C.sendPacket("UserAttributeMod",{account:E.context.uid,attributeInfos:Object.entries(h).map(function(k){return{key:(k=$a(k,2))[0],value:k[1]}}),seq:O})}),fb.apply(void 0,Z(v.map(function(C){return C.fromReceived("UserAttributeErr").pipe(Ca(function(k){return O.eq(k.seq)}),Ea(function(k){throw new Ja(["The user attributes add or update failure, code %d",k.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(v.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(Ca(function(k){return O.eq(k.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(h,E,v){var O=this.getLoginSockets();if(O.length===0)throw new da("Client is not logged in");var C=this.incGetSeq();return O.forEach(function(k){k.sendPacket("GroupAttributeMod",{broadcast:v,group:h,attributeInfos:Object.entries(E).map(function(j){return{key:(j=$a(j,2))[0],value:j[1]}}),seq:C})}),fb.apply(void 0,Z(O.map(function(k){return k.fromReceived("GroupAttributeErr").pipe(Ca(function(j){return C.eq(j.seq)}),Ea(function(j){throw new Ja(["The group attributes add or update failure, code %d",j.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(O.map(function(k){return k.fromReceived("GroupAttributeRsp").pipe(Ca(function(j){return C.eq(j.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(h){var E=this,v=this.getLoginSockets();if(v.length===0)throw new da("Client is not logged in");var O=this.incGetSeq();return v.forEach(function(C){C.sendPacket("UserAttributeDel",{account:E.context.uid,attributes:h,seq:O})}),fb.apply(void 0,Z(v.map(function(C){return C.fromReceived("UserAttributeErr").pipe(Ca(function(k){return O.eq(k.seq)}),Ea(function(k){throw new Ja(["The user attributes delete failure, code %d",k.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(v.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(Ca(function(k){return O.eq(k.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(h,E,v){var O=this.getLoginSockets();if(O.length===0)throw new da("Client is not logged in");var C=this.incGetSeq();return O.forEach(function(k){k.sendPacket("GroupAttributeDel",{group:h,broadcast:v,attributes:E,seq:C})}),fb.apply(void 0,Z(O.map(function(k){return k.fromReceived("GroupAttributeErr").pipe(Ca(function(j){return C.eq(j.seq)}),Ea(function(j){throw new Ja(["The channel attributes delete failure, code %d",j.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(O.map(function(k){return k.fromReceived("GroupAttributeRsp").pipe(Ca(function(j){return C.eq(j.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var h=this,E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return E.forEach(function(O){O.sendPacket("UserAttributeSet",{account:h.context.uid,seq:v,attributeInfos:[]})}),fb.apply(void 0,Z(E.map(function(O){return O.fromReceived("UserAttributeErr").pipe(Ca(function(C){return v.eq(C.seq)}),Ea(function(C){throw new Ja(["The user attributes clear failure, code %d",C.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(E.map(function(O){return O.fromReceived("UserAttributeRsp").pipe(Ca(function(C){return v.eq(C.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(h,E){var v=this.getLoginSockets();if(v.length===0)throw new da("Client is not logged in");var O=this.incGetSeq();return v.forEach(function(C){C.sendPacket("GroupAttributeSet",{group:h,seq:O,attributeInfos:[],broadcast:E})}),fb.apply(void 0,Z(v.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(Ca(function(k){return O.eq(k.seq)}),Ea(function(k){throw new Ja(["The channel attributes clear failure, code %d",k.code],oc)}))})).concat([r.genTimeoutError(pc)],Z(v.map(function(C){return C.fromReceived("GroupAttributeRsp").pipe(Ca(function(k){return O.eq(k.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(h,E){var v=this.getLoginSockets();if(v.length===0)throw new da("Client is not logged in");var O=this.incGetSeq();return v.forEach(function(C){C.sendPacket("UserAttributeGet",{account:h,seq:O,attributes:E})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(v.map(function(C){return C.fromReceived("UserAttributeErr").pipe(Ca(function(k){return O.eq(k.seq)}),Ea(function(k){throw(k=k.code)===10008?new Ja("The user requested is not online",Mr):new ve(["User attribute operation unknown error code: %d",k],oc)}))})),Z(v.map(function(C){return C.fromReceived("UserAttributeRet").pipe(Ca(function(k){return O.eq(k.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(h,E){var v=this.getLoginSockets();if(v.length===0)throw new da("Client is not logged in");var O=this.incGetSeq();return v.forEach(function(C){C.sendPacket("GroupAttributeGet",{group:h,seq:O,attributes:E})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(v.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(Ca(function(k){return O.eq(k.seq)}),Ea(function(k){throw new Ja(["The channel attributes get failure, code %d",k.code],oc)}))})),Z(v.map(function(C){return C.fromReceived("GroupAttributeRet").pipe(Ca(function(k){return O.eq(k.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(h){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return E.forEach(function(O){O.sendPacket("UserAttributeKeysGet",{account:h,seq:v})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(E.map(function(O){return O.fromReceived("UserAttributeErr").pipe(Ca(function(C){return v.eq(C.seq)}),Ea(function(C){throw(C=C.code)===10008?new Ja("The user requested is not online",Mr):new ve(["User attribute operation unknown error code: %d",C],oc)}))})),Z(E.map(function(O){return O.fromReceived("UserAttributeKeysRet").pipe(Ca(function(C){return v.eq(C.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(h){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return E.forEach(function(O){O.sendPacket("GroupAttributeKeysGet",{group:h,seq:v})}),fb.apply(void 0,[r.genTimeoutError(pc)].concat(Z(E.map(function(O){return O.fromReceived("GroupAttributeErr").pipe(Ca(function(C){return v.eq(C.seq)}),Ea(function(C){throw new ve(["Channel attribute operation unknown error code: %d",C.code],oc)}))})),Z(E.map(function(O){return O.fromReceived("GroupAttributeKeysRet").pipe(Ca(function(C){return v.eq(C.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(h){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return E.forEach(function(O){O.sendPacket("GroupStatusList",{groups:h,seq:v})}),fb.apply(void 0,[r.genTimeoutError(Qr)].concat(Z(E.map(function(O){return O.fromReceived("GroupStatusResult").pipe(Ca(function(C){return v.eq(C.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(h){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();return E.forEach(function(O){O.sendPacket("SubscribeUserStatus",{seq:v,users:h})}),fb.apply(void 0,[r.genTimeoutError($B)].concat(Z(E.map(function(O){return O.fromReceived("SubscribeResponse").pipe(Ca(function(C){return v.eq(C.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(h){var E=this.getLoginSockets();if(E.length===0)throw new da("Client is not logged in");var v=this.incGetSeq();E.forEach(function(O){O.sendPacket("UnsubscribeUserStatus",{seq:v,users:h})})}},{key:"sendInvitationMessage",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K,$,_e,na,_c,_a,_s,_h,_f=this;return N.wrap(function(E_){for(;;)switch(E_.prev=E_.next){case 0:if(O=v.peerId,C=v.callId,k=v.extra,j=v.isAcceptAck,K=v.channelId,$=v.type,_e={callId:C},j===void 0){E_.next=6;break}if($==="CallAccept"){E_.next=5;break}throw Error("invalid invitation type");case 5:_e.type=j?"ack":"request";case 6:return _e.channel=K,($==="CallInvite"||$==="CallCancel"||$==="CallReject"||$==="CallAccept"&&j===!1)&&k!==void 0&&(_e.extra=k),na=nh(),this.log("The sent invitation body is %o",_e),_c=function(y_){return{MiscMap:{},sequence:P.fromNumber(1),dialogue:na,instance:_f.instanceId,dst:O,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:y_,MessageType:$}).toLong(),payload:new TextEncoder().encode(JSON.stringify(_e)),src:_f.context.uid}},E_.next=14,Jc(this.sendMessageToRetry(_c,!0)).pipe(Lb(1e4),ab(function(y_){return y_ instanceof Tb&&_f.warn("Send invitation timeout"),ra(y_)})).toPromise();case 14:return _a=E_.sent,_s=_a.code,_h=_a.retryTimes,E_.abrupt("return",{hasPeerReceived:_s===0,hasReSent:_h!==0});case 18:case"end":return E_.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var h=ma(N.mark(function E(v,O,C,k,j){var K,$,_e,na,_c,_a,_s,_h,_f,E_,y_,F_=this;return N.wrap(function(w_){for(;;)switch(w_.prev=w_.next){case 0:if(K=Date.now(),$=k?Ka.P2pRMsgNoOfflineFlag:Ka.ChannelRMsg,Ta(C)&&v instanceof Uint8Array&&typeof O=="string"){w_.next=4;break}throw new ca("The send message arguments are not valid",k?fs:qi);case 4:if(!(32768<v.byteLength+new Blob([O]).size)){w_.next=8;break}throw this.emit("messageCount",{messageCategory:$,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:$,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",k?bg:Il);case 8:return _e=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=v.byteLength,na=this.chatManager.getChatInfo(C),_c=na.dialogue,_a=na.sequence,_s=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(_s,"-").concat(_c,"#").concat(_a,'"'),_e?" compressed":"",k?"peer":"channel",La(C)),_h=function(W_){return{MiscMap:{description:new TextEncoder().encode(O)},sequence:_a,dialogue:_c,instance:_s,dst:C,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:W_,CompressionMethod:_e?"Zlib":"Uncompressed",MessageType:k?"PeerRawMessage":"ChannelRawMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:_e?St(v):v,src:F_.context.uid}},w_.next=15,Jc(this.sendMessageToRetry(_h,!0)).pipe(Lb(j===void 0?1e4:j),ab(function(W_){return W_ instanceof Tb&&F_.warn("Send message timeout"),ra(W_)})).toPromise();case 15:return _f=w_.sent,E_=_f.code,y_=E_===0,this.emit("messageCount",{messageCategory:$,type:"common",key:"sentcount"}),y_&&(this.emit("messageCount",{messageCategory:$,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:$,type:k?"peer":"recipient",delay:Xa(K).toNumber()})),w_.abrupt("return",{hasPeerReceived:y_});case 21:case"end":return w_.stop()}},E,this)}));return function(E,v,O,C,k){return h.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var h=ma(N.mark(function E(v,O,C,k){var j,K,$,_e,na,_c,_a,_s,_h,_f,E_,y_,F_=this;return N.wrap(function(w_){for(;;)switch(w_.prev=w_.next){case 0:if(j=Date.now(),K=C?Ka.P2pSMsgNoOfflineFlag:Ka.ChannelSMsg,Ta(O)){w_.next=4;break}throw new ca("The send message arguments are not valid",C?fs:qi);case 4:if(!(32768<new Blob([v]).size)){w_.next=8;break}throw this.emit("messageCount",{messageCategory:K,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:K,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",C?bg:Il);case 8:return $=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([v]).size,_e=this.chatManager.getChatInfo(O),na=_e.dialogue,_c=_e.sequence,_a=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(_a,"-").concat(na,"#").concat(_c,'"'),$?" compressed":"",C?"peer":"channel",La(O)),_s=new TextEncoder().encode(v),_h=function(W_){return{MiscMap:{},sequence:_c,dialogue:na,instance:_a,dst:O,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:W_,CompressionMethod:$?"Zlib":"Uncompressed",MessageType:C?"PeerTextMessage":"ChannelTextMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:$?St(_s):_s,src:F_.context.uid}},w_.next=16,Jc(this.sendMessageToRetry(_h,!0)).pipe(Lb(k===void 0?1e4:k),ab(function(W_){return W_ instanceof Tb&&(F_.emit("messageCount",{messageCategory:K,type:"common",key:"sentcount"}),F_.emit("messageCount",{messageCategory:K,type:"common",key:"timeoutcount"}),F_.warn("Send message timeout")),ra(W_)})).toPromise();case 16:return _f=w_.sent,E_=_f.code,y_=E_===0,this.emit("messageCount",{messageCategory:K,type:"common",key:"sentcount"}),y_&&(this.emit("messageCount",{messageCategory:K,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:K,type:C?"peer":"recipient",delay:Xa(j).toNumber()})),w_.abrupt("return",{hasPeerReceived:y_});case 22:case"end":return w_.stop()}},E,this)}));return function(E,v,O,C){return h.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(h,E){Object.entries(this.loginSocketSubs[h]).forEach(function(v){var O=(v=$a(v,2))[1];v[0]==="channels"&&E||(Array.isArray(O)||O instanceof Map?O.forEach(function(C){return C.unsubscribe()}):O&&O.unsubscribe())}),this.loginSocketSubs[h]={channels:E?this.loginSocketSubs[h].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var h=ma(N.mark(function E(v,O){var C,k,j,K,$,_e,na,_c,_a,_s=this,_h=arguments;return N.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:if(C=2<_h.length&&_h[2]!==void 0?_h[2]:0,this.log("Attempt to send the message ".concat(O?" with retrying, %o":"without retrying"),{retryTimes:C}),(k=this.getLoginSockets()).length!==0){_f.next=5;break}throw Error("no logged-in sockets");case 5:return j=v(C),k.forEach(function(E_){E_.sendPacket("Message",j)}),K=j.dialogue,$=j.sequence,_e=j.instance,na=k.map(function(E_){return E_.fromReceived("Ack").pipe(yb(function(y_){return K.eq(y_.dialogue)&&$.eq(y_.sequence)&&_e.eq(y_.instance)}))}),_f.prev=9,_f.next=12,Jb.apply(void 0,Z(na)).pipe(Lb(6e3),ab(function(E_){return Ab(E_)&&_s.warn("Message send timeout, retry times %d",C),ra(E_)}),hb(1)).toPromise();case 12:return _c=_f.sent,_a=_c.code,this.log("The message has been acked, %o",{code:_a}),_f.abrupt("return",{code:_a,retryTimes:C});case 18:if(_f.prev=18,_f.t0=_f.catch(9),!(_f.t0 instanceof Tb&&O)){_f.next=22;break}return _f.abrupt("return",this.sendMessageToRetry(v,!1,C+1));case 22:throw _f.t0;case 23:case"end":return _f.stop()}},E,this,[[9,18]])}));return function(E,v){return h.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var h=this;this.lastLoginSockets.map(function(E){return E.pipe(Kb(function(v){return dd(0,2500,Ce()?void 0:oF).pipe(sa(function(){h.sendPing(v)}))}))}).forEach(function(E,v){var O=h.loginSocketSubs[v].keepAlive;O!==void 0&&O.unsubscribe(),h.loginSocketSubs[v].keepAlive=E.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var h=this;this.lastLoginSockets.map(function(E){return E.pipe(Kb(function(v){var O,C=!1,k=v.userJoin$.pipe(sa(function(){C=!0})),j=v.input$.pipe(sa(function(K){yj[K.uri].slice(0,-3)!=="Ping"&&(C=!1)}));return Jb(dd(6e3,1e4).pipe(yv(v.receivedPacket),sa(function(K){K=$a(K,2),K=$a(K[1],2)[1],O!==K||C||v.forceReconnect(),O=K})),k,j)}))}).forEach(function(E,v){var O=h.loginSocketSubs[v].keepAliveReconnector;O!==void 0&&O.unsubscribe(),h.loginSocketSubs[v].keepAliveReconnector=E.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var h=this;fb.apply(void 0,Z(this.lastLoginSockets.map(function(O){return O.pipe(Kb(function(C){return C.fromReceived("UserTicketNearlyExpire").pipe(sv(5e3),sa(h.onUserTicketNearlyExpire(C)))}))}))).subscribe();var E=Db(this,"messageCount"),v=E.pipe(yb(function(O){return O.messageCategory===Ka.ChannelSMsg}));v.subscribe(function(O){return h.updateMessageCount(O)}),v.pipe(dh(6e3)).subscribe(function(O){O.length&&h.chanelStringMessageReport.report()}),Jb(ob(void 0),v).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){h.chanelStringMessageReport.report()}),(v=E.pipe(yb(function(O){return O.messageCategory===Ka.ChannelRMsg}))).subscribe(function(O){return h.updateMessageCount(O)}),v.pipe(dh(6e3)).subscribe(function(O){O.length&&h.chanelRawMessageReport.report()}),Jb(ob(void 0),v).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){h.chanelRawMessageReport.report()}),(v=E.pipe(yb(function(O){return O.messageCategory===Ka.P2pSMsgNoOfflineFlag}))).subscribe(function(O){return h.updateMessageCount(O)}),v.pipe(dh(6e3)).subscribe(function(O){O.length&&h.p2pSMsgNoOfflineReport.report()}),Jb(ob(void 0),v).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){h.p2pSMsgNoOfflineReport.report()}),(E=E.pipe(yb(function(O){return O.messageCategory===Ka.P2pRMsgNoOfflineFlag}))).subscribe(function(O){return h.updateMessageCount(O)}),E.pipe(dh(6e3)).subscribe(function(O){O.length&&h.p2pRMsgNoOfflineReport.report()}),Jb(ob(void 0),E).pipe(Kb(function(){return Qe(36e5)})).subscribe(function(){h.p2pSMsgNoOfflineReport.report()}),this.lastLoginSockets.map(function(O){return O.pipe(Kb(function(C){return Jb(Db(C,"reconnect").pipe(sa(h.onSocketReconnect(C))),C.fromReceived("Message").pipe(sa(h.onMessage(C))),C.fromReceived("GroupEnterNotice").pipe(sa(h.onGroupEnterNotice())),C.fromReceived("GroupLeaveNotice").pipe(sa(h.onGroupLeaveNotice())),C.fromReceived("GroupCountNotice").pipe(sa(h.onGroupCountNotice())),C.fromReceived("GroupAttributeAlt").pipe(sa(h.onGroupAttributeAlt())),C.fromReceived("UserJoinNotice").pipe(sa(h.onUserNotice(ta.PeerOnlineState.ONLINE))),C.fromReceived("UserQuitNotice").pipe(sa(h.onUserNotice(ta.PeerOnlineState.OFFLINE))),C.fromReceived("UserWaitNotice").pipe(sa(h.onUserNotice(ta.PeerOnlineState.UNREACHABLE))),C.fromReceived("Pong").pipe(sa(h.onPong())),C.fromReceived("UserDrop").pipe(sa(h.onUserDrop(C))),C.fromReceived("GroupDrop").pipe(sa(h.onGroupDrop()))).pipe(Uf(void 0))}))}).forEach(function(O,C){h.loginSocketSubs[C].receivers.push(O.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(h,E,v){var O=this;return nn(yd(function(){O.userJoinOptions=new et(E),h.sendPacket("UserJoin",{account:O.context.uid,instance:O.instanceId,opt:O.userJoinOptions.toLong(),seq:v,ticket:h.ticket})}),h.fromReceived("UserResp").pipe(Ca(function(C){return v.eq(C.seq)}),sa(function(C){if((C=C.code)!==0)throw O.clearSockets(),O.logError("Connected to gateway success but the Rtm server rejected login"),new Ja(["Login failure. The response code from the RTM service is %d",C],Pg);h.attemptsSinceLastError=0,h.loggedIn=!0,O.log("ENV_%d logged in",h.env)}),Uf(h),Lb(6e3))).pipe(yb(function(C){return C!==void 0}),ab(function(C){return C instanceof Tb&&O.warn("Login response timeout, rejoin: %s",E),O.clearSockets(),C.name="loginRespTimeout",O.emit("banEdgeIP",h.ip),ra(C)}))}},{key:"getSocketLoginObservables",value:function(h,E){var v=this;return h.map(function(O){return O.pipe(Kb(function(C,k){return v.incSeqIfNeeded(C.env),v.requestSocketLogin(C,k!==0,k===0?E:v.seq)}),Se())})}},{key:"incSeqIfNeeded",value:function(h){if(![0,1].includes(h))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[h]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[h]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var h=this.curLoginSockets,E=-1,v=h==null?0:h.length,O=0,C=[];++E<v;){var k=h[E];k&&(C[O++]=k)}return C}},{key:"emitMessage",value:function(h,E){var v,O=h.options,C=h.payload,k=h.src,j=h.dst,K=h.instance,$=h.dialogue,_e=h.sequence,na=h.ms,_c=h.MiscMap;this.dialogueSequenceLru.set($.toString(),_e),K="".concat(K,"-").concat($,"#").concat(_e),this.msgDedupLru.has(K)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",E,K):(this.msgDedupLru.set(K,void 0),O=new Ef(O),this.lastLoginSockets.forEach((v=ma(N.mark(function _a(_s){var _h;return N.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:return _f.next=2,_s.pipe(hb(1)).toPromise();case 2:_h=_f.sent,r.sendMessageAck(h,_h);case 4:case"end":return _f.stop()}},_a)})),function(_a){return v.apply(this,arguments)})),E=O.isZlibCompressed(),O.isInvitation()?(j=cg(E?mm(ao(C,Uint8Array.of(0,0,0,0))):C),j=JSON.parse(j),this.log("The received invitation body is %o",j),this.emit("invitationMessage",{body:j,type:O.getInvitationType(),peerId:k,serverReceivedTs:na.toNumber()})):O.isTextMessage()?(_c=O.isPeerTextMessage(),C=cg(E?mm(ao(C,Uint8Array.of(0,0,0,0))):C),this.info("Received a %s %s text message from %s to %s, %s",E?" compressed":"",_c?"peer":"channel",La(k),La(j),K),_c?(k={text:C,peerId:k,properties:{serverReceivedTs:na.toNumber()}},this.emit("peerTextMessage",k),this.emit("messageCount",{messageCategory:Ka.P2pSMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelTextMessage",{channelId:j,memberId:k,text:C,properties:{serverReceivedTs:na.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelSMsg,type:"common",key:"receivedcount"}))):O.isRawMessage()&&(O=O.isRawPeerMessage(),_c=(_c=_c.description)===void 0?"":cg(_c),C=E?mm(C):C,this.info("Received a %s %s raw message from %s to %s, %s",E?" compressed":"",O?"peer":"channel",La(k),La(j),K),O?(k={desc:_c,raw:C,peerId:k,properties:{serverReceivedTs:na.toNumber()}},this.emit("peerRawMessage",k),this.emit("messageCount",{messageCategory:Ka.P2pRMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelRawMessage",{desc:_c,raw:C,channelId:j,memberId:k,properties:{serverReceivedTs:na.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelRMsg,type:"common",key:"receivedcount"}))))}},{key:"onSocketReconnect",value:function(h){var E=this;return function(){var v=[0,1].filter(function(O){return O!==h.env})[0];(v=E.connection.curOpenSockets[v])&&!v.loggedIn&&E.emit("connectionLost")}}},{key:"onUserTicketNearlyExpire",value:function(h){var E=this;return function(v){(v=v.ticket)!==E.lastNoticeTicket&&v===h.ticket?(E.lastNoticeTicket=v,E.emit("tokenPrivilegeWillExpire")):E.requestUpdateEdgeTicket(h.ticket).toPromise()}}},{key:"onGroupDrop",value:function(){var h=this;return function(E){var v,O=E.account;bb("ChnLeave",{cname:O,lts:P.fromNumber(Date.now()),elapse:Xa(h.startTime),errCode:RB,sid:sb(h.instanceId),userId:h.context.uid},(v=h.context.config.enableCloudProxy)!==null&&v!==void 0&&v),[0,1].forEach(function(C){return h.loginSocketSubs[C].channels.delete(O)}),h.logError("the user is kicked out of the current channel")}}},{key:"onUserDrop",value:function(h){var E=this;return function(v){var O;v=v.code,bb("KickedOff",{code:0,elapse:Xa(E.startTime),linkId:parseInt(h.name.split("-")[1],10),lts:P.fromNumber(Date.now()),server:h.address,serverCode:v,sid:sb(E.instanceId),userId:E.context.uid},(O=E.context.config.enableCloudProxy)!==null&&O!==void 0&&O),v===10006||v===10001?E.warn("Login too often and kicked off, reconnect and login"):v===10009?(E.warn("The instance ID conflicts, reconnecting"),E.instanceId=nh(),E.context.sid=sb(E.instanceId),E.emit("instanceChanged",E.instanceId)):[2,11,14,15,16].includes(v)&&(E.emit("userDrop",v),E.clearSockets())}}},{key:"clearSockets",value:function(){var h=this,E=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,v=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(O){h.cleanLoginSubs(O,v),h.connection.closeSocket(O,E)})}},{key:"onMessage",value:function(h){var E=this;return function(v){var O=v.dialogue,C=v.instance,k=v.sequence,j=v.options;if(v.src===E.context.uid)E.log("The message is from the local account, ignored");else{var K=O.toString(),$=E.dialPendingMsgSubjectMap.get(K);if(O="".concat(C,"-").concat(O,"#").concat(k),$)$.next(v),E.log("Env_%d: The dialogue has pending messages, next: %s",h.env,O);else{var _e=E.dialogueSequenceLru.get(K);if($=!_e&&k.eq(1),C=_e!==void 0&&k.sub(_e).eq(1),$||C)E.emitMessage(v,h.env);else{if(_e){if(k.lte(_e))return;E.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",h.env,O)}else E.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",h.env,O);k=new rb,E.dialPendingMsgSubjectMap.set(K,k);var na=k.pipe(Au(zl),gh(function(_c,_a){return[].concat(Z(_c),[_a])},[]),Ea(function(_c){return Z(_c).sort(function(_a,_s){return _a=_a.sequence,_s=_s.sequence,_a.eq(_s)?0:_a.gt(_s)?1:-1})}),wn(1));j=!(j=new Ef(j)).isFromCache()&&!j.isBufferedMessage(),na.pipe(Kc(dd(j?750:1500)),Ca(function(_c){if(2>_c.length)return!1;for(var _a=_e===void 0?P.fromNumber(1,!0):_e.add(1),_s=0;_s<_c.length;_a=_a.add(1),_s++)if(!_c[_s].sequence.eq(_a))return!1;return!0}),fh(function(){E.dialPendingMsgSubjectMap.delete(K)})).subscribe(function(_c){_c.forEach(function(_a){E.emitMessage(_a,h.env),E.log("Env_%d: The message queue has fully ordered, emitting: %s",h.env,"".concat(_a.instance,"-").concat(_a.dialogue,"#").concat(_a.sequence))})},function(_c){_c instanceof eh&&na.pipe(hb(1)).subscribe(function(_a){return _a.forEach(function(_s){E.log("Env_%d: The message pending queue expired, emitting: %s",h.env,"".concat(_s.instance,"-").concat(_s.dialogue,"#").concat(_s.sequence)),E.emitMessage(_s,h.env)})})}),k.next(v)}}}}}},{key:"onPong",value:function(){var h=this;return function(){document.hidden&&h.getLoginSockets().forEach(function(E){h.sendPing(E)})}}},{key:"onGroupEnterNotice",value:function(){var h=this;return function(E){h.emit("memberNotice",{channelId:E.group,seq:E.seq,instance:E.instance,memberId:E.user,type:"MemberJoined",size:E.size})}}},{key:"onGroupLeaveNotice",value:function(){var h=this;return function(E){h.emit("memberNotice",{channelId:E.group,seq:E.seq,instance:E.instance,memberId:E.user,type:"MemberLeft",size:E.size})}}},{key:"onGroupCountNotice",value:function(){var h=this;return function(E){h.emit("memberNotice",{channelId:E.group,seq:E.seq,instance:E.instance,type:"MemberCountUpdated",size:E.size})}}},{key:"onGroupAttributeAlt",value:function(){var h=this;return function(E){var v=E.group;E=Ki(E,pF),h.emit("channelAttributesUpdated",Wa({channelId:v},E))}}},{key:"onUserNotice",value:function(h){var E=this;return function(v){E.emit("peerOnlineStatusChanged",{peerId:v.user,instance:v.instance,seq:v.seq,state:h})}}},{key:"sendPing",value:function(h){2500>=Date.now()-this.lastPingTime[h.env]||(this.incSeqIfNeeded(h.env),h.sendPacket("Ping",{ms:P.fromNumber(Date.now(),!0),seq:this.seq}),this.lastPingTime[h.env]=Date.now())}},{key:"updateMessageCount",value:function(h){var E,v=(E={},x(E,Ka.ChannelRMsg,this.chanelRawMessageReport),x(E,Ka.ChannelSMsg,this.chanelStringMessageReport),x(E,Ka.P2pRMsgNoOfflineFlag,this.p2pRMsgNoOfflineReport),x(E,Ka.P2pSMsgNoOfflineFlag,this.p2pSMsgNoOfflineReport),x(E,3,void 0),x(E,4,void 0),x(E,7,void 0),x(E,8,void 0),x(E,9,void 0),x(E,10,void 0),E)[h.messageCategory];h.type==="common"?v==null||v.updateCommonCount(h.key):h.type==="peer"?v==null||v.updatePeerAckCount(h.delay):v==null||v.updateNorecipientackCount(h.delay)}}],[{key:"sendMessageAck",value:function(h,E){var v=new Ef(h.options);(v.isInvitation()||v.isPeerMessage())&&E.sendPacket("Ack",{code:0,dialogue:h.dialogue,instance:h.instance,sequence:h.sequence})}}]),r}(sc());x(Tt,"genTimeoutError",function(i,r){return ob(void 0).pipe(Zd(r===void 0?1e4:r),Ea(function(){throw new Ub(["Request timed out after %ds",(r===void 0?1e4:r)/1e3],i)}))});var Ut,nm,om=0,pm=0;Ng.v1=function(i,r,o){o=r&&o||0;var u=r||[],h=(i=i||{}).node||Ut,E=i.clockseq!==void 0?i.clockseq:nm;if(h==null||E==null){var v=Kr();h==null&&(h=Ut=[1|v[0],v[1],v[2],v[3],v[4],v[5]]),E==null&&(E=nm=16383&(v[6]<<8|v[7]))}v=i.msecs!==void 0?i.msecs:new Date().getTime();var O=i.nsecs!==void 0?i.nsecs:pm+1,C=v-om+(O-pm)/1e4;if(0>C&&i.clockseq===void 0&&(E=E+1&16383),(0>C||v>om)&&i.nsecs===void 0&&(O=0),1e4<=O)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(om=v,pm=O,nm=E,i=(1e4*(268435455&(v+=122192928e5))+O)%4294967296,u[o++]=i>>>24&255,u[o++]=i>>>16&255,u[o++]=i>>>8&255,u[o++]=255&i,i=v/4294967296*1e4&268435455,u[o++]=i>>>8&255,u[o++]=255&i,u[o++]=i>>>24&15|16,u[o++]=i>>>16&255,u[o++]=E>>>8|128,u[o++]=255&E,E=0;6>E;++E)u[o+E]=h[E];return r||Lr(u)},Ng.v4=Ng;var qm=yi(),Sd,Hf=ta.LocalInvitationFailureReason,Sa=ta.LocalInvitationState,qF=(Sd=function(i){function r(u,h,E){va(this,r);var v=o.call(this,E,"RtmLocalInvitation",!0);return x(z(v),"state",Sa.IDLE),x(z(v),"localInvitationEnd$",fb(Db(z(v),"LocalInvitationAccepted"),Db(z(v),"LocalInvitationRefused"),Db(z(v),"LocalInvitationFailure"),Db(z(v),"LocalInvitationCanceled")).pipe(hb(1))),x(z(v),"callId",Ng.v4()),x(z(v),"_content",""),x(z(v),"_channelId",""),x(z(v),"_response",""),x(z(v),"calleeId",void 0),x(z(v),"logger",void 0),x(z(v),"getSession",void 0),v.calleeId=u,v.getSession=h,v.logger=E,v}Ga(r,i);var o=Ha(r);return eb(r,[{key:"channelId",get:function(){return this._channelId},set:function(u){this.state!==Sa.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=u)}},{key:"content",get:function(){return this._content},set:function(u){this.log("set content for %s",this.callId),this._content=u}},{key:"response",get:function(){return this._response},set:function(u){throw new ca('Cannot set the "response" of the LocalInvitation instance.',Xc)}},{key:"send",value:function(){var u,h=this;if(this.state===Sa.SENT_TO_REMOTE||this.state===Sa.RECEIVED_BY_REMOTE)throw new da("The local invitation send failure. The call invitation has already been sent.",NB);if(this.isLocalInvitationEnd())throw new da("The local invitation send failure. The call invitation has ended.",ri);if(0<this._channelId.length&&!Ta(this._channelId))throw new ca("Illegal invitation channel ID",Xc);if(!Ta(this.calleeId))throw new ca("Illegal invitation callee user ID",Xc);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',Xc);this.state=Sa.SENT_TO_REMOTE,yd(ma(N.mark(function E(){var v,O,C;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,h.getSession().sendInvitationMessage({peerId:h.calleeId,callId:h.callId,extra:h._content,type:"CallInvite",channelId:h._channelId});case 2:if(v=k.sent,O=v.hasPeerReceived,C=v.hasReSent,!h.isLocalInvitationEnd()){k.next=7;break}throw new Ub("send invitation timeout");case 7:if(h.log("The local invitation has sent to the callee"),O||C){k.next=11;break}throw u=new qm({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(O){k.next=14;break}throw u=new qm({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return k.stop()}},E)}))).pipe(Re(function(E){return E.pipe(sa(function(v){if(!(v instanceof qm))throw v}),Zd(2e3))}),Lb(3e4),ab(function(E){return Ab(E)&&h.warn("local invitation ack timed out"),ra(E)}),Kc(this.localInvitationEnd$)).subscribe({next:function(){h.state===Sa.RECEIVED_BY_REMOTE?h.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):h.state!==Sa.SENT_TO_REMOTE?h.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(h.info("The peer received the local invitation %s.",h.callId),h.state=Sa.RECEIVED_BY_REMOTE,h.emit("LocalInvitationReceivedByPeer"),h.localInvitationEnd$.pipe(Lb(6e4),ab(function(E){return Ab(E)&&h.warn("local invitation expired"),ra(E)})).subscribe({error:function(){h.state=Sa.FAILURE,h.emit("LocalInvitationFailure",Hf.INVITATION_EXPIRE)}}))},error:function(E){h.isLocalInvitationEnd()?h.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(h.state=Sa.FAILURE,Ab(E)&&u?u.code==="PEER_NOT_ONLINE"?h.emit("LocalInvitationFailure",Hf.PEER_OFFLINE):u.code==="RESENT_AND_OFFLINE"&&h.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):Ab(E)?h.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):E.name==="RtmInvalidStatusError"?h.emit("LocalInvitationFailure",Hf.NOT_LOGGEDIN):h.emit("LocalInvitationFailure",Hf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new da("The local invitation cancel failure",ri);if(this.state===Sa.IDLE)throw new da("The local invitation has not been sent",MB);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',Xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Sa.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(u){if(this.isLocalInvitationEnd()&&this.state!==Sa.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Sa.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Sa.ACCEPTED_BY_REMOTE,this._response=u,this.emit("LocalInvitationAccepted",u))}}},{key:"onRefuseReceived",value:function(u){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote refuse it?");this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=u,this.state=Sa.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",u)}}},{key:"isLocalInvitationEnd",value:function(){return[Sa.CANCELED,Sa.FAILURE,Sa.ACCEPTED_BY_REMOTE,Sa.REFUSED_BY_REMOTE].includes(this.state)}}]),r}(sc()),Da(Sd.prototype,"send",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"send"),Sd.prototype),Da(Sd.prototype,"cancel",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"cancel"),Sd.prototype),Sd),Hi=ta.RemoteInvitationFailureReason,Fb=ta.RemoteInvitationState,rF=function(i){function r(u){var h=u.invitationChannel,E=u.extraContent,v=u.callId,O=u.callerId,C=u.logger;u=u.getSession,va(this,r);var k=o.call(this,C,"RtmRemoteInvitation",!0);return x(z(k),"state",Fb.INVITATION_RECEIVED),x(z(k),"remoteInvitationEnd$",fb(Db(z(k),"RemoteInvitationCanceled"),Db(z(k),"RemoteInvitationRefused"),Db(z(k),"RemoteInvitationAccepted"),Db(z(k),"RemoteInvitationFailure")).pipe(hb(1))),x(z(k),"callerId",void 0),x(z(k),"callId",void 0),x(z(k),"_getSession",void 0),x(z(k),"logger",void 0),x(z(k),"_content",void 0),x(z(k),"_channelId",void 0),x(z(k),"_response",""),k._channelId=h,k._content=E,k.callId=v,k.callerId=O,k._getSession=u,k.logger=C,k.remoteInvitationEnd$.pipe(Lb(6e4),ab(function(j){return Ab(j)&&k.warn("Remote invitation expired"),ra(j)})).subscribe({error:function(){k.state=Fb.FAILURE,k.emit("RemoteInvitationFailure",Hi.INVITATION_EXPIRE)}}),k}Ga(r,i);var o=Ha(r);return eb(r,[{key:"channelId",get:function(){return this._channelId},set:function(u){throw new ca('Cannot set the "response" of the RemoteInvitation instance.',Xc)}},{key:"content",get:function(){return this._content},set:function(u){throw new ca('Cannot set the "content" of the RemoteInvitation instance.',Xc)}},{key:"response",get:function(){return this._response},set:function(u){this._response=u}},{key:"accept",value:function(){var u,h=this;if(this.isRemoteInvitationEnd())throw new da("The local invitation has ended. Cannot accept.",ri);if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',Xc);this.state=Fb.ACCEPT_SENT_TO_LOCAL,Jb(Qe(1e3).pipe(Cb(function(){return yd(ma(N.mark(function E(){return N.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",h._getSession().sendInvitationMessage({peerId:h.callerId,callId:h.callId,extra:h.response,type:"CallAccept",isAcceptAck:!1,channelId:h.channelId}));case 1:case"end":return v.stop()}},E)})))}),yb(function(E){return u=E.hasPeerReceived}),hb(1)),Db(this,"RemoteInvitationAccepted")).pipe(Lb(5e3),Kc(this.remoteInvitationEnd$)).subscribe({error:function(E){if(h.logError(E),h.state=Fb.FAILURE,Ab(E))switch(u){case void 0:case!0:return void h.emit("RemoteInvitationFailure",Hi.ACCEPT_FAILURE);case!1:return void h.emit("RemoteInvitationFailure",Hi.PEER_OFFLINE)}h.emit("RemoteInvitationFailure",Hi.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(this.isRemoteInvitationEnd())throw new da("The invitation is end. Cannot refuse",ri);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',Xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=Fb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(u){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===Fb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=u,this.state=Fb.CANCELED,this.emit("RemoteInvitationCanceled",u))}},{key:"onAcceptAckReceived",value:function(){this.state!==Fb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=Fb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[Fb.ACCEPTED,Fb.REFUSED,Fb.CANCELED,Fb.FAILURE].includes(this.state)}}]),r}(sc()),sF=function(i){function r(u,h){va(this,r);var E=o.call(this,h,"InvitationManager");return x(z(E),"getSession",void 0),x(z(E),"invitationDispatcher",new Ba.EventEmitter),x(z(E),"outgoingLocalInvitations",new Map),x(z(E),"receivedRemoteInvitations",new Wc(void 0,{maxlen:1e4})),x(z(E),"logger",void 0),E.getSession=fo(u),E.logger=h,E.invitationDispatcher.on("remoteInvitationToManager",function(v){var O=v.callId,C=v.extra,k=v.callerId;v=v.channelId,E.receivedRemoteInvitations.has(O)||((C=new rF({callerId:k,callId:O,getSession:E.getSession,logger:h,extraContent:C,invitationChannel:v})).remoteInvitationEnd$.subscribe(function(){E.receivedRemoteInvitations.delete(O)}),E.receivedRemoteInvitations.set(O,C),E.emit("remoteInvitationInstance",C))}),E.invitationDispatcher.on("acceptAckToRemoteInvitation",function(v){(v=E.receivedRemoteInvitations.get(v.callId))&&v.onAcceptAckReceived()}),E.invitationDispatcher.on("cancelToRemoteInvitation",function(v){var O=v.extra;(v=E.receivedRemoteInvitations.get(v.callId))&&v.onCancelReceived(O)}),E.invitationDispatcher.on("acceptToLocalInvitation",function(v){var O=v.extra;(v=E.outgoingLocalInvitations.get(v.callId))&&v.onAcceptReceived(O)}),E.invitationDispatcher.on("refuseToLocalInvitation",function(v){var O=v.extra;(v=E.outgoingLocalInvitations.get(v.callId))&&v.onRefuseReceived(O)}),E}Ga(r,i);var o=Ha(r);return eb(r,[{key:"invitationMessageHandler",value:function(u){var h=u.body,E=h.callId,v=h.extra;v=v===void 0?"":v;var O=h.type,C=(h=h.channel)===void 0?"":h,k=u.type;switch(h=u.peerId,u=u.serverReceivedTs,k){case"CallAccept":O==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:E}):O==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:E,extra:v});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:E,callerId:h,extra:v,channelId:C});break;case"CallCancel":if(E==="0"){E="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(C,"_").concat(v),this.getSession().emit("peerTextMessage",{peerId:h,properties:{serverReceivedTs:u},text:E});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:E,extra:v});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:E,extra:v});break;default:throw Rn("invitationType",k)}}},{key:"genLocalInvitation",value:function(u){var h=this,E=new qF(u,this.getSession,this.logger);return E.localInvitationEnd$.subscribe(function(){h.outgoingLocalInvitations.delete(E.callId)}),this.outgoingLocalInvitations.set(E.callId,E),E}}]),r}(sc()),tF=function(i,r,o){var u=!0,h=!0;if(typeof i!="function")throw new TypeError("Expected a function");return Gb(o)&&(u="leading"in o?!!o.leading:u,h="trailing"in o?!!o.trailing:h),JD(i,r,{leading:u,maxWait:r,trailing:h})},Qb,If;(function(i){i[i.JOINED=0]="JOINED",i[i.LEFT=1]="LEFT"})(If||(If={}));var Ii=ta.ConnectionState,uF=(Qb=function(i){function r(h,E,v,O){va(this,r);var C=u.call(this,O,"RtmChannel",!0);return x(z(C),"onMemberCountUpdated",tF(function(k){k!==C.memberCount&&(C.memberCount=k,C.emit("MemberCountUpdated",k))},1e3)),x(z(C),"getSession",void 0),x(z(C),"memberCount",0),x(z(C),"joinState","LEFT"),x(z(C),"joinPromise",void 0),x(z(C),"memberJoinedLru",new Wc(void 0,{maxlen:1e4})),x(z(C),"memberLeftLru",new Wc(void 0,{maxlen:1e4})),x(z(C),"memberJoinStateLru",new Wc(void 0,{maxlen:1e4})),x(z(C),"attributesSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(C),"channelId",void 0),x(z(C),"client",void 0),x(z(C),"onChannelMemberCountUpdated",function(k,j){C.channelId===k&&C.onMemberCountUpdated(j)}),x(z(C),"onLogout",function(){try{C.clearChannel(C.getSession())}catch{}}),x(z(C),"onAttributesUpdated",function(k){var j=k.channelId,K=k.attributeMaps,$=k.seq;k=k.instance.toString();var _e=C.attributesSeqLru.get(k);if((!_e||$.greaterThan(_e))&&(C.attributesSeqLru.set(k,$),j===C.channelId)){for(j={},$=0;$<K.length;$++){var na=K[$];k=na.key,_e=na.ms;var _c=na.value;if(na=na.origin,typeof k!="string"||!P.isLong(_e)||typeof _c!="string"||!Ta(na))break;j[k]={value:_c,lastUpdateUserId:na,lastUpdateTs:_e.toNumber()}}C.emit("AttributesUpdated",j)}}),x(z(C),"onChannelTextMessage",function(k){var j=k.memberId,K=k.text,$=k.properties;k.channelId===C.channelId&&C.emit("ChannelMessage",{text:K,messageType:ta.MessageType.TEXT},j,$)}),x(z(C),"onChannelRawMessage",function(k){var j=k.desc,K=k.raw,$=k.memberId,_e=k.properties;k.channelId===C.channelId&&C.emit("ChannelMessage",{messageType:ta.MessageType.RAW,rawMessage:K,description:j},$,_e)}),x(z(C),"onMemberNotice",function(k){var j=k.memberId,K=k.type,$=k.size;if(k.channelId===C.channelId){var _e=k.instance.toString();k=k.seq.toString();var na={MemberLeft:C.memberLeftLru,MemberJoined:C.memberJoinedLru,MemberCountUpdated:void 0}[K];if(na){if(na.has(_e+k))return void C.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",K,k,La(C.channelId),La(j||""));if(na.set(_e+k,void 0),typeof j!="string")return;if(j!==C.getSession().context.uid&&((_e=C.memberJoinStateLru.get(j))===If.JOINED&&K==="MemberJoined"||_e===If.LEFT&&K==="MemberLeft"))return void C.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",K,k,La(C.channelId),La(j||""));C.memberJoinStateLru.set(j,K==="MemberJoined"?If.JOINED:If.LEFT)}C.info("Channel %s - %s, memberId: %s",K,La(C.channelId),K==="MemberCountUpdated"?"[unknown]":La(j||"")),_e=j===C.getSession().context.uid,K==="MemberLeft"&&Ta(j)||K==="MemberJoined"&&Ta(j)?(_e||C.emit(K,j),C.onMemberCountUpdated($)):K==="MemberCountUpdated"&&typeof $=="number"&&C.onMemberCountUpdated($)}}),C.getSession=fo(E),C.channelId=h,C.client=v,C.info("A channel created, id %s",La(h)),C}Ga(r,i);var o,u=Ha(r);return eb(r,[{key:"join",value:(o=ma(N.mark(function h(){var E,v,O,C,k,j,K,$=this;return N.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:_e.prev=0,E=this.getSession(),_e.next=7;break;case 4:throw _e.prev=4,_e.t0=_e.catch(0),new da("The client is not logged in. Cannot do the operation",Wr);case 7:if(_e.prev=7,Ta(this.channelId)){_e.next=10;break}throw new ca(["The %s in the arguments is invalid","channelId"],OB);case 10:if(this.joinState==="LEFT"){_e.next=13;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:E.context.uid,elapse:Xa(E.startTime),errCode:Vr,sid:sb(E.instanceId)},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),new da("The channel has joined. Cannot rejoin",Vr);case 13:if(!E.usedChannelIds.includes(this.channelId)){_e.next=16;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:E.context.uid,elapse:Xa(E.startTime),errCode:Xr,sid:sb(E.instanceId)},(k=this.client.context.config.enableCloudProxy)!==null&&k!==void 0&&k),new da("A channel of the same channel ID has already joined. Cannot rejoin",Xr);case 16:if(!(20<=E.usedChannelIds.length)){_e.next=19;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:E.context.uid,elapse:Xa(E.startTime),errCode:Ur,sid:sb(E.instanceId)},(j=this.client.context.config.enableCloudProxy)!==null&&j!==void 0&&j),new ic("The joined channels has exceeded the limit of 20",Ur);case 19:return bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:E.context.uid,elapse:Xa(E.startTime),errCode:0,sid:sb(E.instanceId)},(v=this.client.context.config.enableCloudProxy)!==null&&v!==void 0&&v),this.log("Joining the channel %s",La(this.channelId)),this.joinState="JOINING",E.usedChannelIds.push(this.channelId),this.joinPromise=E.requestChannelJoin(this.channelId).then(function(){$.joinState="JOINED"}),_e.next=26,this.joinPromise;case 26:bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(E.startTime),errCode:0,sid:sb(E.instanceId),serverErrCode:0,userId:E.context.uid},(O=this.client.context.config.enableCloudProxy)!==null&&O!==void 0&&O),this.info("The channel %s joined successfully",La(this.channelId)),E.on("channelTextMessage",this.onChannelTextMessage),E.on("channelRawMessage",this.onChannelRawMessage),E.on("memberNotice",this.onMemberNotice),E.on("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.on("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.once("LOGOUT",this.onLogout),_e.next=46;break;case 36:if(_e.prev=36,_e.t1=_e.catch(7),this.joinState==="JOINING"&&(this.joinState="LEFT"),this.logError(_e.t1),!Na(_e.t1)){_e.next=42;break}throw _e.t1;case 42:if(!Ab(_e.t1)){_e.next=45;break}throw bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(E.startTime),errCode:Tr,sid:sb(E.instanceId),serverErrCode:0,userId:E.context.uid},(K=this.client.context.config.enableCloudProxy)!==null&&K!==void 0&&K),new Ub(["Join channel %s timed out",La(this.channelId)],Tr);case 45:throw new ve(["The channel %s join failure",La(this.channelId)],{code:Sr,originalError:_e.t1});case 46:case"end":return _e.stop()}},h,this,[[0,4],[7,36]])})),function(){return o.apply(this,arguments)})},{key:"leave",value:function(){var h=ma(N.mark(function E(){var v,O,C,k;return N.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:j.prev=0,O=this.getSession(),j.next=7;break;case 4:throw j.prev=4,j.t0=j.catch(0),new da("The client is not logged in. Cannot do the operation",QB);case 7:if(this.joinState!=="LEFT"){j.next=9;break}throw new da("The channel does not join. Cannot do the operation",PB);case 9:return j.prev=9,O.requestChannelLeave(this.channelId),j.next=13,this.clearChannel(O);case 13:j.next=24;break;case 15:if(j.prev=15,j.t1=j.catch(9),this.logError(j.t1),!Na(j.t1)){j.next=22;break}throw j.t1.code===void 0&&(j.t1.code=Zr),bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(O.startTime),errCode:Zr,sid:sb(O.instanceId),userId:O.context.uid},(k=this.client.context.config.enableCloudProxy)!==null&&k!==void 0&&k),j.t1;case 22:throw bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(O.startTime),errCode:Yr,sid:sb(O.instanceId),userId:O.context.uid},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),new ve("The channel leave failure",{code:Yr,originalError:j.t1});case 24:bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(O.startTime),errCode:0,sid:sb(O.instanceId),userId:O.context.uid},(v=this.client.context.config.enableCloudProxy)!==null&&v!==void 0&&v);case 25:case"end":return j.stop()}},E,this,[[0,4],[9,15]])}));return function(){return h.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var h=ma(N.mark(function E(v){var O,C=this;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(Xn(v,Il),this.client.connectionState!==Ii.CONNECTED||this.joinState==="JOINED"){k.next=3;break}throw new da("The channel does not join. Cannot do the operation",EB);case 3:if(this.client.connectionState!==Ii.RECONNECTING){k.next=8;break}return O=Date.now(),k.next=7,new Promise(function(j,K){var $,_e=($=ma(N.mark(function _c(){var _a;return N.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:return _a=Date.now()-O,_s.prev=1,_s.next=4,ph({message:v,peerId:C.channelId,toPeer:!1,session:C.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:_a,logger:C.logger});case 4:j(),_s.next=12;break;case 7:_s.prev=7,_s.t0=_s.catch(1),Ab(_s.t0)&&K(new Ub(we(C.name,"sendMessageToPeer",1e4),Hl)),Na(_s.t0)&&K(_s.t0),K(new Ja("Channel message send failure",{code:qi,originalError:_s.t0}));case 12:return _s.prev=12,clearTimeout(na),_s.finish(12);case 15:case"end":return _s.stop()}},_c,null,[[1,7,12,15]])})),function(){return $.apply(this,arguments)});C.client.internalEmitter.once("RECONNECTED",_e);var na=setTimeout(function(){C.client.internalEmitter.off("RECONNECTED",_e),K(new Ub(we(C.name,"sendMessageToPeer",1e4),Hl))},9e3)});case 7:return k.abrupt("return");case 8:if(this.client.connectionState===Ii.CONNECTED){k.next=10;break}throw new da("The client is not logged in. Cannot do the operation",Jl);case 10:return k.prev=10,k.next=13,ph({message:v,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:0,logger:this.logger});case 13:k.next=23;break;case 15:if(k.prev=15,k.t0=k.catch(10),!Ab(k.t0)){k.next=19;break}throw new Ub(we(this.name,"sendMessage",1e4),Hl);case 19:if(!Na(k.t0)){k.next=22;break}throw this.logError(k.t0),k.t0;case 22:throw new ve("The channel message send failure",qi);case 23:case"end":return k.stop()}},E,this,[[10,15]])}));return function(E){return h.apply(this,arguments)}}()},{key:"getMembers",value:function(){var h=ma(N.mark(function E(){var v,O;return N.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(C.prev=0,this.client.connectionState===Ii.CONNECTED){C.next=3;break}throw new da("The client is not logged in. Cannot do the operation",LB);case 3:if(this.joinState==="JOINED"){C.next=5;break}throw new da("The channel does not join. Cannot do the operation",KB);case 5:return v=this.getSession().requestChannelMemberList(this.channelId),C.next=8,v.pipe(Ea(function(k){return k.memberInfos.map(function(j){return j.account})})).toPromise();case 8:return O=C.sent,this.info("Channel %s - get members success, %o",La(this.channelId),O.map(La)),C.abrupt("return",O);case 13:if(C.prev=13,C.t0=C.catch(0),!Na(C.t0)){C.next=18;break}throw this.logError(C.t0),C.t0;case 18:throw new ve("The channel members get failure",IB);case 19:case"end":return C.stop()}},E,this,[[0,13]])}));return function(){return h.apply(this,arguments)}}()},{key:"clearChannel",value:function(){var h=ma(N.mark(function E(v){var O=this;return N.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v.emit("channelLeft",this.channelId),this.joinState!=="JOINING"){C.next=4;break}return C.next=4,this.joinPromise;case 4:this.joinState="LEFT",this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,v.removeListener("channelTextMessage",this.onChannelTextMessage),v.removeListener("channelRawMessage",this.onChannelRawMessage),v.removeListener("memberNotice",this.onMemberNotice),v.removeListener("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.removeListener("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.removeListener("LOGOUT",this.onLogout),v.usedChannelIds=v.usedChannelIds.filter(function(k){return k!==O.channelId});case 17:case"end":return C.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()}]),r}(sc()),Da(Qb.prototype,"join",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"join"),Qb.prototype),Da(Qb.prototype,"leave",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"leave"),Qb.prototype),Da(Qb.prototype,"sendMessage",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"sendMessage"),Qb.prototype),Da(Qb.prototype,"getMembers",[jb],Object.getOwnPropertyDescriptor(Qb.prototype,"getMembers"),Qb.prototype),Qb),W,Rb=ta.ConnectionChangeReason,oa=ta.ConnectionState,Vt={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},vF={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8,TOKEN_EXPIRED:9},wF=(W=function(i){function r(h,E,v,O){va(this,r);var C=u.call(this,E,"RtmClient",!0);return x(z(C),"connectionState",oa.DISCONNECTED),x(z(C),"internalEmitter",new Ba),x(z(C),"context",void 0),x(z(C),"attributes",{}),x(z(C),"loginPromise",void 0),x(z(C),"attributeDrafts",new Set),x(z(C),"session",void 0),x(z(C),"lastLoginTime",void 0),x(z(C),"reconnId",0),x(z(C),"channelAttributesCacheLru",new Wc(void 0,{maxlen:1e4})),x(z(C),"invitationManager",void 0),x(z(C),"subscribedPeerStatusCache",{}),x(z(C),"pendingPeerStatusSubCount",0),x(z(C),"peerStatusSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(C),"peerUnreachableTimers",{}),x(z(C),"setParameters",void 0),x(z(C),"updateConfig",void 0),x(z(C),"blacklistedIP",{}),x(z(C),"TokenPrivilegeWillExpireHandler",function(){C.emit("TokenPrivilegeWillExpire")}),x(z(C),"userDropHandler",function(k){if(C.connectionState!==oa.ABORTED)switch(k){case 2:C.logError("Server banned because of token is expired"),C.onConnectionStateChanged(oa.ABORTED,Rb.TOKEN_EXPIRED),C.emit("TokenExpired");break;case 11:C.logError("Kicked off by remote session"),C.onConnectionStateChanged(oa.ABORTED,Rb.REMOTE_LOGIN);break;case 14:case 15:case 16:C.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[k])),C.onConnectionStateChanged(oa.ABORTED,Rb.BANNED_BY_SERVER);break;default:C.logError("User kicked off for unknown code: ".concat(k)),C.onConnectionStateChanged(oa.ABORTED,Rb.INTERRUPTED)}}),C.context=new xE(h,v,E),C.context.config=v,C.setParameters=O.bind(z(C)),C.updateConfig=O.bind(z(C)),C.invitationManager=new sF(function(){return C.session},E),C.invitationManager.on("remoteInvitationInstance",function(k){C.emit("RemoteInvitationReceived",k)}),C.setMaxListeners(512),C.internalEmitter.setMaxListeners(512),C}Ga(r,i);var o,u=Ha(r);return eb(r,[{key:"renewToken",value:(o=ma(N.mark(function h(E){var v,O,C,k,j=this;return N.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(typeof E=="string"&&E.length!==0){K.next=2;break}throw new ca("Invalid argument",XB);case 2:if(this.connectionState!==oa.ABORTED){K.next=5;break}return K.next=5,new Promise(function(){});case 5:if(this.connectionState===oa.CONNECTED||this.connectionState===oa.RECONNECTING){K.next=7;break}throw new da("The client is not logged in",hs);case 7:if(this.session!==void 0){K.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return K.prev=9,v=this.context.token,this.context.token=E,K.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe($d(function(){return Error("No available edge address to connect")}),Re(function($){return $.pipe(sa(function(_e){if(Na(_e))throw _e}),Zd(2500),hb(4))}),hb(1),Lb(2e4),ab(function($){return Ab($)&&j.warn("renewToken timed out"),ra($)})).toPromise();case 14:O=K.sent,C=O.ticket,K.next=27;break;case 18:if(K.prev=18,K.t0=K.catch(9),this.context.token=v,K.t0.code!==as&&K.t0.code!==bs){K.next=23;break}throw new Bf("Invalid token",ZB);case 23:if(K.t0.code!==ti){K.next=25;break}throw new Bf("The token expired",YB);case 25:if(!Ab(K.t0)){K.next=27;break}throw new Ub("Renew token timed out",Ml);case 27:k=this.session,this.session.requestUpdateEdgeTicket(C).toPromise().then(function($){if($.code!==0)throw new Ja(["RenewToken failure. The response code is %d",$.code],Ml);k.curLoginSockets.filter(function(_e){return _e!==void 0}).forEach(function(_e){return _e.ticket=C})});case 29:case"end":return K.stop()}},h,this,[[9,18]])})),function(h){return o.apply(this,arguments)})},{key:"queryPeersOnlineStatus",value:function(){var h=ma(N.mark(function E(v){var O,C,k=this;return N.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.connectionState===oa.CONNECTED){j.next=2;break}throw new da("The client is not logged in",WB);case 2:if(this.session!==void 0){j.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(v)||v.length===0||v.some(function(K){return!Ta(K)})||256<v.length)){j.next=6;break}throw new ca("invalid arguments",gs);case 6:return j.next=8,this.session.requestPeersOnlineStatus(v).toPromise();case 8:return O=j.sent,C=md(tl(O.userInfos,"account"),function(K){return!!K.ts}),Object.keys(C).forEach(function(K){if(K in k.subscribedPeerStatusCache&&k.subscribedPeerStatusCache[K]!==ta.PeerOnlineState.UNREACHABLE){var $=C[K]?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE;k.emit("PeersOnlineStatusChanged",x({},K,$)),k.subscribedPeerStatusCache[K]=$}}),j.abrupt("return",C);case 12:case"end":return j.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K,$,_e,na,_c;return N.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(this.connectionState===oa.CONNECTED){_a.next=2;break}throw new da("The client is not logged in",HB);case 2:if(this.session!==void 0){_a.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(v)&&v.every(function(_s){return typeof _s=="string"})&&v.length!==0){_a.next=6;break}throw new ca("Invalid arguments: channelIds",Pr);case 6:if(!(32<v.length)){_a.next=8;break}throw new ca("getChannelMemberCount exceed limit of 32 channelIds",GB);case 8:O=0;case 9:if(!(O<v.length)){_a.next=16;break}if(Ta(C=v[O])){_a.next=13;break}throw new ca(["getChannelMemberCount channel id %s is invalid",C],Pr);case 13:O++,_a.next=9;break;case 16:return _a.next=18,this.session.requestGetChannelMemberCount(v).toPromise();case 18:for(k=_a.sent,j=k.groupInfos,K={},$=0;$<j.length;$++)_e=j[$],na=_e.group,_c=_e.memberCount,Ta(na)&&typeof _c=="number"&&(this.internalEmitter.emit("channelMemberCountUpdated",na,_c),K[na]=_c);return _a.abrupt("return",K);case 23:case"end":return _a.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var h=ma(N.mark(function E(v){var O,C;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(ag({attributes:v,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){k.next=3;break}throw new da("The client is not logged in",qc);case 3:if(this.session!==void 0){k.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return O=this.session.requestSetLocalUserAttributes(v).toPromise(),C={attribute:v,promise:O},this.attributeDrafts.add(C),k.prev=8,k.next=11,O;case 11:this.attributes=v,k.next=19;break;case 14:if(k.prev=14,k.t0=k.catch(8),!Na(k.t0)){k.next=18;break}throw k.t0;case 18:throw new ca("arguments is not valid",gb);case 19:return k.prev=19,this.attributeDrafts.delete(C),k.finish(19);case 22:case"end":return k.stop()}},E,this,[[8,14,19,22]])}));return function(E){return h.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var h=ma(N.mark(function E(v,O){var C,k,j,K,$,_e=arguments;return N.wrap(function(na){for(;;)switch(na.prev=na.next){case 0:if(C=2<_e.length&&_e[2]!==void 0?_e[2]:{},k=C.enableNotificationToChannelMembers,j=k!==void 0&&k,ag({attributes:O,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){na.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){na.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return K=this.session.requestSetChannelAttributes(v,O,j).toPromise(),na.prev=7,na.next=10,K;case 10:$=md(O,function(_c){return new Blob([_c]).size}),this.channelAttributesCacheLru.set(v,$),na.next=19;break;case 14:if(na.prev=14,na.t0=na.catch(7),!Na(na.t0)){na.next=18;break}throw na.t0;case 18:throw new ca("arguments is not valid",gb);case 19:case"end":return na.stop()}},E,this,[[7,14]])}));return function(E,v){return h.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var h=ma(N.mark(function E(v){var O,C,k;return N.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(O=Wa(Wa({},this.attributes),v),ag({attributes:v,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),ag({attributes:O,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){j.next=5;break}throw new da("The client is not logged in",qc);case 5:if(this.session!==void 0){j.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return C=this.session.requestAddOrUpdateLocalUserAttributes(v).toPromise(),k={attribute:O,promise:C},this.attributeDrafts.add(k),j.prev=10,j.next=13,C;case 13:this.attributes=O,j.next=21;break;case 16:if(j.prev=16,j.t0=j.catch(10),!Na(j.t0)){j.next=20;break}throw j.t0;case 20:throw new ca("arguments is not valid",gs);case 21:return j.prev=21,this.attributeDrafts.delete(k),j.finish(21);case 24:case"end":return j.stop()}},E,this,[[10,16,21,24]])}));return function(E){return h.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var h=ma(N.mark(function E(v,O){var C,k,j,K,$,_e,na,_c=arguments;return N.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(C=2<_c.length&&_c[2]!==void 0?_c[2]:{},k=C.enableNotificationToChannelMembers,j=k!==void 0&&k,K=this.channelAttributesCacheLru.get(v,{}),$=md(O,function(_s){return new Blob([_s]).size}),_e=Wa(Wa({},K),$),ag({attributes:O,attrSizeMap:_e,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){_a.next=7;break}throw new da("The client is not logged in",qc);case 7:if(this.session!==void 0){_a.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return na=this.session.requestAddOrUpdateChannelAttributes(v,O,j).toPromise(),_a.prev=10,_a.next=13,na;case 13:this.channelAttributesCacheLru.set(v,_e),_a.next=21;break;case 16:if(_a.prev=16,_a.t0=_a.catch(10),!Na(_a.t0)){_a.next=20;break}throw _a.t0;case 20:throw new ca("arguments is not valid",gb);case 21:case"end":return _a.stop()}},E,this,[[10,16]])}));return function(E,v){return h.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j;return N.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(Array.isArray(v)&&v.length!==0&&!v.some(function($){return $.length===0})){K.next=2;break}throw new da("arguments is not valid",gb);case 2:if(this.connectionState===oa.CONNECTED){K.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){K.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return O=this.session.requestDeleteLocalUserAttributesByKeys(v).toPromise(),C={attribute:ql(this.attributes,v),promise:O},this.attributeDrafts.add(C),K.prev=9,K.next=12,O;case 12:for(k=0;k<v.length;k++)j=v[k],delete this.attributes[j];K.next=20;break;case 15:if(K.prev=15,K.t0=K.catch(9),!Na(K.t0)){K.next=19;break}throw K.t0;case 19:throw new ca("arguments is not valid",gb);case 20:return K.prev=20,this.attributeDrafts.delete(C),K.finish(20);case 23:case"end":return K.stop()}},E,this,[[9,15,20,23]])}));return function(E){return h.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var h=ma(N.mark(function E(v,O){var C,k,j,K,$,_e,na,_c=arguments;return N.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(C=2<_c.length&&_c[2]!==void 0?_c[2]:{},k=C.enableNotificationToChannelMembers,j=k!==void 0&&k,Array.isArray(O)&&O.length!==0&&Ta(v)&&!O.some(function(_s){return _s.length===0||512<_s.length})){_a.next=3;break}throw new da("arguments is not valid",gb);case 3:if(this.connectionState===oa.CONNECTED){_a.next=5;break}throw new da("The client is not logged in",qc);case 5:if(this.session!==void 0){_a.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return K=this.session.requestDeleteChannelAttributesByKeys(v,O,j).toPromise(),_a.prev=8,_a.next=11,K;case 11:if($=this.channelAttributesCacheLru.get(v))for(_e=0;_e<O.length;_e++)na=O[_e],delete $[na];_a.next=20;break;case 15:if(_a.prev=15,_a.t0=_a.catch(8),!Na(_a.t0)){_a.next=19;break}throw _a.t0;case 19:throw new ca("arguments is not valid",gb);case 20:case"end":return _a.stop()}},E,this,[[8,15]])}));return function(E,v){return h.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var h=ma(N.mark(function E(){var v,O;return N.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.connectionState===oa.CONNECTED){C.next=2;break}throw new da("The client is not logged in",qc);case 2:if(this.session!==void 0){C.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return v=this.session.requestClearLocalUserAttributes().toPromise(),O={attribute:{},promise:v},this.attributeDrafts.add(O),C.prev=7,C.next=10,v;case 10:this.attributes={},C.next=18;break;case 13:if(C.prev=13,C.t0=C.catch(7),!Na(C.t0)){C.next=17;break}throw C.t0;case 17:throw new ca("arguments is not valid",gb);case 18:return C.prev=18,this.attributeDrafts.delete(O),C.finish(18);case 21:case"end":return C.stop()}},E,this,[[7,13,18,21]])}));return function(){return h.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K=arguments;return N.wrap(function($){for(;;)switch($.prev=$.next){case 0:if(O=1<K.length&&K[1]!==void 0?K[1]:{},C=O.enableNotificationToChannelMembers,k=C!==void 0&&C,this.connectionState===oa.CONNECTED){$.next=3;break}throw new da("The client is not logged in",qc);case 3:if(this.session!==void 0){$.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return j=this.session.requestClearChannelAttributes(v,k).toPromise(),$.prev=6,$.next=9,j;case 9:this.channelAttributesCacheLru.delete(v),$.next=17;break;case 12:if($.prev=12,$.t0=$.catch(6),!Na($.t0)){$.next=16;break}throw $.t0;case 16:throw new ca("arguments is not valid",gb);case 17:case"end":return $.stop()}},E,this,[[6,12]])}));return function(E){return h.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var h=ma(N.mark(function E(v){var O,C,k;return N.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(Ta(v)){j.next=2;break}throw new ca("Not a valid user ID",gb);case 2:if(this.connectionState===oa.CONNECTED){j.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){j.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return j.prev=6,j.next=9,this.session.requestGetUserAttributeKeys(v).toPromise();case 9:return O=j.sent,C=O.keys,j.next=13,this.session.requestGetUserAttributesByKeys(v,C.slice(0,512)).toPromise();case 13:k=j.sent,j.next=21;break;case 16:if(j.prev=16,j.t0=j.catch(6),!Na(j.t0)){j.next=20;break}throw j.t0;case 20:throw new ca("arguments is not valid",gb);case 21:return j.abrupt("return",Zq(k.attributeInfos.map(function(K){return[K.key,K.value]})));case 22:case"end":return j.stop()}},E,this,[[6,16]])}));return function(E){return h.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K,$,_e,na,_c,_a,_s;return N.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(Ta(v)){_h.next=2;break}throw new ca("Not a valid channel ID",gb);case 2:if(this.connectionState===oa.CONNECTED){_h.next=4;break}throw new da("The client is not logged in",qc);case 4:if(this.session!==void 0){_h.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _h.prev=6,_h.next=9,this.session.requestGetChannelAttributesKeys(v).toPromise();case 9:return O=_h.sent,C=O.keys,_h.next=13,this.session.requestGetChannelAttributesByKeys(v,C).toPromise();case 13:k=_h.sent,j=k.attributeMaps,_h.next=22;break;case 17:if(_h.prev=17,_h.t0=_h.catch(6),!Na(_h.t0)){_h.next=21;break}throw _h.t0;case 21:throw new ca("arguments is not valid",gb);case 22:K={},$=0;case 24:if(!($<j.length)){_h.next=32;break}if(_e=j[$],na=_e.key,_c=_e.ms,_a=_e.value,_s=_e.origin,typeof na=="string"&&P.isLong(_c)&&typeof _a=="string"&&Ta(_s)){_h.next=28;break}return _h.abrupt("break",32);case 28:K[na]={value:_a,lastUpdateUserId:_s,lastUpdateTs:_c.toNumber()};case 29:$++,_h.next=24;break;case 32:return this.channelAttributesCacheLru.set(v,md(K,function(_f){return new Blob([_f.value]).size})),_h.abrupt("return",K);case 34:case"end":return _h.stop()}},E,this,[[6,17]])}));return function(E){return h.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var h=ma(N.mark(function E(v,O){var C,k,j,K,$,_e,na,_c,_a,_s;return N.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(this.connectionState===oa.CONNECTED){_h.next=2;break}throw new da("The client is not logged in",qc);case 2:if(this.session!==void 0){_h.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(v,O),_h.prev=5,_h.next=8,this.session.requestGetChannelAttributesByKeys(v,O).toPromise();case 8:C=_h.sent,k=C.attributeMaps,_h.next=17;break;case 12:if(_h.prev=12,_h.t0=_h.catch(5),!Na(_h.t0)){_h.next=16;break}throw _h.t0;case 16:throw new ca("arguments is not valid",gb);case 17:j={},K=this.channelAttributesCacheLru.get(v,{}),$=0;case 20:if(!($<k.length)){_h.next=29;break}if(_e=k[$],na=_e.key,_c=_e.ms,_a=_e.value,_s=_e.origin,typeof na=="string"&&P.isLong(_c)&&typeof _a=="string"&&Ta(_s)){_h.next=24;break}return _h.abrupt("break",29);case 24:K[na]=new Blob([_a]).size,j[na]={value:_a,lastUpdateUserId:_s,lastUpdateTs:_c.toNumber()};case 26:$++,_h.next=20;break;case 29:return this.channelAttributesCacheLru.set(v,K),_h.abrupt("return",j);case 31:case"end":return _h.stop()}},E,this,[[5,12]])}));return function(E,v){return h.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var h=ma(N.mark(function E(v,O){var C;return N.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.connectionState===oa.CONNECTED){k.next=2;break}throw new da("The client is not logged in",qc);case 2:if(this.session!==void 0){k.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(v,O),k.prev=5,k.next=8,this.session.requestGetUserAttributesByKeys(v,O).toPromise();case 8:C=k.sent,k.next=16;break;case 11:if(k.prev=11,k.t0=k.catch(5),!Na(k.t0)){k.next=15;break}throw k.t0;case 15:throw new ca("arguments is not valid",gb);case 16:return k.abrupt("return",Zq(C.attributeInfos.map(function(j){return[j.key,j.value]})));case 17:case"end":return k.stop()}},E,this,[[5,11]])}));return function(E,v){return h.apply(this,arguments)}}()},{key:"login",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K;return N.wrap(function($){for(;;)switch($.prev=$.next){case 0:if(xn(!0),C=nh(),k=v.token,v.token===this.context.appId&&(k=void 0),bb("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:Xa(this.session&&this.session.startTime),index:{index1:v.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},installId:Og,lts:P.fromNumber(Date.now()),os:7,sid:sb(C),token:k||"",userId:v.uid,ver:"1.5.1",buildno:418,subVersion:18,version:4},(O=this.context.config.enableCloudProxy)!==null&&O!==void 0&&O,!0),De(v)&&Ta(v.uid)){$.next=7;break}throw new ca("not a valid user id",si);case 7:if(typeof k!="string"||!k){$.next=11;break}this.context.token=k,$.next=13;break;case 11:if(typeof k=="string"||k==null){$.next=13;break}throw new ca('The "token" is not a valid string.',si);case 13:return j=Date.now(),this.context.sid=sb(C),this.loginPromise=this.loginImpl({uid:v.uid,instanceId:C}),this.info("RTM Client logging in as ".concat(La(v.uid))),$.prev=17,$.next=20,this.loginPromise;case 20:$.next=28;break;case 22:throw $.prev=22,$.t0=$.catch(17),Na($.t0)&&bb("Link",{ackedServerIp:"",destServerIp:"",ec:$.t0.code||1,sc:$.t0.serverCode,elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),responseTime:Date.now()-j,sid:sb(C),userId:v.uid},(K=this.context.config.enableCloudProxy)!==null&&K!==void 0&&K),this.context.token=void 0,this.context.socketUseProxy=!1,$.t0;case 28:return $.prev=28,this.loginPromise=void 0,$.finish(28);case 31:this.context.socketUseProxy&&this.emit("FallbackProxyConnected"),xn(!1);case 33:case"end":return $.stop()}},E,this,[[17,22,28,31]])}));return function(E){return h.apply(this,arguments)}}()},{key:"logout",value:function(){var h=ma(N.mark(function E(){var v;return N.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(!this.loginPromise){O.next=3;break}return O.next=3,this.loginPromise;case 3:if(this.connectionState!==oa.DISCONNECTED){O.next=6;break}throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);case 6:if(this.internalEmitter.emit("LOGOUT"),this.connectionState!==oa.ABORTED){O.next=11;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),O.abrupt("return");case 11:if(this.session!==void 0){O.next=14;break}return this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),O.abrupt("return");case 14:return bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},(v=this.context.config.enableCloudProxy)!==null&&v!==void 0&&v),O.next=17,this.session.logoutHandler();case 17:this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),this.log("Log out success");case 19:case"end":return O.stop()}},E,this)}));return function(){return h.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var h,E=this;if(this.connectionState===oa.DISCONNECTED)throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);this.connectionState===oa.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},(h=this.context.config.enableCloudProxy)!==null&&h!==void 0&&h),this.session.logoutHandler().then(function(){E.log("Log out success")})),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var h=ma(N.mark(function E(v,O){var C,k,j=this;return N.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(Xn(v,bg),C=v.messageType==="TEXT"?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag,this.connectionState!==oa.RECONNECTING){K.next=5;break}return k=Date.now(),K.abrupt("return",new Promise(function($,_e){var na,_c=(na=ma(N.mark(function _s(){var _h;return N.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:if(j.session!==void 0){_f.next=2;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return _h=Date.now()-k,_f.prev=3,_f.t0=$,_f.next=7,ph({message:v,peerId:O,toPeer:!0,session:j.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:_h,logger:j.logger});case 7:_f.t1=_f.sent,(0,_f.t0)(_f.t1),_f.next=18;break;case 11:_f.prev=11,_f.t2=_f.catch(3),Ab(_f.t2)&&(j.session.emit("messageCount",{messageCategory:C,type:"common",key:"sentcount"}),j.session.emit("messageCount",{messageCategory:C,type:"common",key:"timeoutcount"}),_e(new Ub(we(j.name,"sendMessageToPeer",1e4),Kl))),Na(_f.t2)&&_e(_f.t2),j.session.emit("messageCount",{messageCategory:C,type:"common",key:"sentcount"}),j.session.emit("messageCount",{messageCategory:C,type:"common",key:"unknowerrorcount"}),_e(new Ja("Peer-to-peer message send failure",{code:ds,originalError:_f.t2}));case 18:return _f.prev=18,clearTimeout(_a),_f.finish(18);case 21:case"end":return _f.stop()}},_s,null,[[3,11,18,21]])})),function(){return na.apply(this,arguments)});j.internalEmitter.once("RECONNECTED",_c);var _a=setTimeout(function(){j.internalEmitter.off("RECONNECTED",_c),_e(new Ub(we(j.name,"sendMessageToPeer",1e4),Kl))},9e3)}));case 5:if(this.connectionState===oa.CONNECTED){K.next=7;break}throw new da("Failed to send the peer-to-peer message. The client is not logged in",Ll);case 7:if(this.session!==void 0){K.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return K.prev=9,K.next=12,ph({message:v,peerId:O,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:0,logger:this.logger});case 12:return K.abrupt("return",K.sent);case 15:if(K.prev=15,K.t0=K.catch(9),!Ab(K.t0)){K.next=21;break}throw this.session.emit("messageCount",{messageCategory:C,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:C,type:"common",key:"timeoutcount"}),new Ub(we(this.name,"sendMessageToPeer",1e4),Kl);case 21:if(!Na(K.t0)){K.next=23;break}throw K.t0;case 23:throw this.session.emit("messageCount",{messageCategory:C,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:C,type:"common",key:"unknowerrorcount"}),new Ja("Peer-to-peer message send failure",{code:ds,originalError:K.t0});case 26:case"end":return K.stop()}},E,this,[[9,15]])}));return function(E,v){return h.apply(this,arguments)}}()},{key:"createChannel",value:function(h){var E=this;if(!Ta(h))throw new ca(["The %s in the arguments is invalid",Object.keys({channelId:h})[0]],FB);return new uF(h,function(){return E.session},this,this.logger)}},{key:"createLocalInvitation",value:function(h){if(!Ta(h))throw new ca(["The %s in the arguments is invalid",Object.keys({calleeId:h})[0]],Xc);return this.invitationManager.genLocalInvitation(h)}},{key:"subscribePeersOnlineStatus",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K,$,_e,na,_c,_a,_s,_h,_f,E_=this;return N.wrap(function(y_){for(;;)switch(y_.prev=y_.next){case 0:if(this.connectionState===oa.CONNECTED){y_.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(this.session!==void 0){y_.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(v)&&v.length!==0){y_.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:O=0;case 7:if(!(O<v.length)){y_.next=14;break}if(Ta(C=v[O])){y_.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",C],Qg);case 11:O++,y_.next=7;break;case 14:if(!(512<(k=v&&v.length?fl(v):[]).length+Object.keys(this.subscribedPeerStatusCache).length+this.pendingPeerStatusSubCount)){y_.next=17;break}throw new ic("Subscribed peers overflows",js);case 17:return this.pendingPeerStatusSubCount+=k.length,y_.next=20,this.session.requestSubscribePeersOnlineStatus(k).toPromise();case 20:j=y_.sent,K=j.errors,this.pendingPeerStatusSubCount-=k.length,$=[],_e=[],na=0;case 26:if(!(na<K.length)){y_.next=34;break}if(_c=K[na],_a=_c.code,typeof(_s=_c.account)=="string"){y_.next=30;break}throw new Ja("Returned account is invalid",is);case 30:_a!==0&&$.push(_s);case 31:na++,y_.next=26;break;case 34:for(_h=0;_h<k.length;_h++)_f=k[_h],$.includes(_f)||(_e.push(_f),this.subscribedPeerStatusCache[_f]=void 0);if(this.session.requestPeersOnlineStatus(_e).pipe(Ea(function(F_){return md(tl(F_.userInfos,"account"),function(w_){return!!w_.ts})})).subscribe(function(F_){F_=md(F_,function(w_,W_){return w_=w_?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,E_.subscribedPeerStatusCache[W_]=w_}),E_.emit("PeersOnlineStatusChanged",F_)}),$.length===0){y_.next=38;break}throw new Ja("Subscription failed",is);case 38:case"end":return y_.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K;return N.wrap(function($){for(;;)switch($.prev=$.next){case 0:if(this.connectionState===oa.CONNECTED){$.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(this.session!==void 0){$.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(v)&&v.length!==0){$.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:O=0;case 7:if(!(O<v.length)){$.next=14;break}if(Ta(C=v[O])){$.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",C],Qg);case 11:O++,$.next=7;break;case 14:if(!(512<v.length)){$.next=16;break}throw new ic("Unsubscribed peers overflows",js);case 16:for(k=v&&v.length?fl(v):[],this.session.requestUnsubscribePeersOnlineStatus(k),j=0;j<k.length;j++)K=k[j],delete this.subscribedPeerStatusCache[K];case 19:case"end":return $.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var h=ma(N.mark(function E(v){return N.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:if(this.connectionState===oa.CONNECTED){O.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(v!==ta.PeerSubscriptionOption.ONLINE_STATUS){O.next=4;break}return O.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new ca("Subscription option not supported",Qg);case 5:case"end":return O.stop()}},E,this)}));return function(E){return h.apply(this,arguments)}}()},{key:"createMessage",value:function(h){return h}},{key:"loginImpl",value:function(){var h=ma(N.mark(function E(v){var O,C,k,j,K,$,_e,na,_c=this;return N.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(O=v.uid,C=v.instanceId,k=v.forceLoginTime,j=k===void 0?0:k,K=C,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){_a.next=4;break}throw new bE(["The frequency of login exceeded the limit of %d queries per second",2],UB);case 4:if(this.connectionState===oa.DISCONNECTED||j!==0){_a.next=6;break}throw new da("The SDK is either logging in or has logged in the Agora RTM system",SB);case 6:_a.prev=6,this.context.uid=O,_a.next=13;break;case 10:throw _a.prev=10,_a.t0=_a.catch(6),new ca(["The %s in the arguments is invalid",Object.keys({uid:O})[0]],si);case 13:return j===0&&this.onConnectionStateChanged(oa.CONNECTING,Rb.LOGIN),($=new ct(this.context,this.logger,!1)).blacklistedIP=this.blacklistedIP,this.session=_e=new Tt(this.context,$,K,this.logger),na=function(){_c.connectionState===oa.CONNECTED&&(_c.onConnectionStateChanged(oa.RECONNECTING,Rb.INTERRUPTED),_c.session)&&_c.session.once("userJoined",function(){_c.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS)})},_e.on("connectionLost",na),_e.on("tokenExpired",function(){_c.emit("TokenExpired")}),_e.on("tokenPrivilegeWillExpire",this.TokenPrivilegeWillExpireHandler),_e.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(_s){_c.emit("MessageFromPeer",{text:_s.text,messageType:ta.MessageType.TEXT},_s.peerId,_s.properties)}),this.session.on("peerRawMessage",function(_s){_c.emit("MessageFromPeer",{rawMessage:_s.raw,description:_s.desc,messageType:ta.MessageType.RAW},_s.peerId,_s.properties)}),_e.on("instanceChanged",function(_s){return K=_s}),_e.on("peerOnlineStatusChanged",function(_s){var _h=_s.instance.toString()+_s.state,_f=_c.peerStatusSeqLru.get(_h);!_f||_s.seq.greaterThan(_f)?(_c.peerStatusSeqLru.set(_h,_s.seq),_s.state!==_c.subscribedPeerStatusCache[_s.peerId]&&_c.emit("PeersOnlineStatusChanged",x({},_s.peerId,_s.state)),_c.subscribedPeerStatusCache[_s.peerId]=_s.state,clearTimeout(_c.peerUnreachableTimers[_h]),_s.state===ta.PeerOnlineState.UNREACHABLE&&(_c.peerUnreachableTimers[_h]=setTimeout(function(){_c.subscribedPeerStatusCache[_s.peerId]===ta.PeerOnlineState.UNREACHABLE&&(_c.subscribedPeerStatusCache[_s.peerId]=ta.PeerOnlineState.ONLINE,_c.emit("PeersOnlineStatusChanged",x({},_s.peerId,ta.PeerOnlineState.ONLINE)))},3e4))):_c.log("peerOnlineStatusChanged dedup for %s, %d",_h,_s.seq.toNumber())}),_e.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),_e.on("channelAttributesUpdated",function(_s){var _h=_s.channelId;_s=_s.attributeMaps;for(var _f={},E_=0;E_<_s.length;E_++){var y_=_s[E_],F_=y_.key,w_=y_.ms,W_=y_.value;if(y_=y_.origin,typeof F_!="string"||!P.isLong(w_)||typeof W_!="string"||!Ta(y_))break;_f[F_]=new Blob([W_]).size}_c.channelAttributesCacheLru.set(_h,_f)}),_e.on("userJoined",function(_s){if(Object.keys(_c.attributes).length!==0){if(_c.session===void 0)return;_c.session.requestSetLocalUserAttributes(_c.attributes,_s).toPromise()}if(_c.attributeDrafts.size!==0)for(var _h=function(y_,F_){var w_=(y_=F_[y_]).attribute;y_.promise.then(function(){_c.session!==void 0&&_c.session.requestSetLocalUserAttributes(w_,_s).toPromise()})},_f=0,E_=Array.from(_c.attributeDrafts);_f<E_.length;_f++)_h(_f,E_);Object.keys(_c.subscribedPeerStatusCache).length!==0&&_e.requestSubscribePeersOnlineStatus(Object.keys(_c.subscribedPeerStatusCache))}),_e.on("banEdgeIP",function(_s){_c.banIP(_s)}),this.lastLoginTime=Date.now(),_a.prev=32,_a.next=35,_e.loginHandler().toPromise();case 35:_a.next=53;break;case 37:if(_a.prev=37,_a.t1=_a.catch(32),!(_a.t1.name==="loginRespTimeout"&&2>j)){_a.next=46;break}return _e.removeAllListeners(),_a.next=43,this.loginImpl({uid:O,instanceId:C,forceLoginTime:j+1});case 43:return _a.abrupt("return");case 46:if(!Ab(_a.t1)){_a.next=49;break}throw this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_TIMEOUT),new Ub(we(this.name,"login",12e3),TB);case 49:if(this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_FAILURE),!Na(_a.t1)){_a.next=52;break}throw _a.t1;case 52:throw new Ja("Login failure",{code:$r,originalError:_a.t1});case 53:this.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS);case 54:case"end":return _a.stop()}},E,this,[[6,10],[32,37]])}));return function(E){return h.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(h,E){var v,O=this;h===oa.RECONNECTING&&(this.reconnId+=1),bb("ConnectionStateChange",{elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),newState:Vt[h],oldState:Vt[this.connectionState],reason:vF[E],sid:sb(this.session&&this.session.instanceId||P.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(v=this.context.config.enableCloudProxy)!==null&&v!==void 0&&v),this.connectionState===oa.RECONNECTING&&h===oa.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(Ea(function(C){return md(tl(C.userInfos,"account"),function(k){return!!k.ts})})).subscribe(function(C){C=md(C,function(k,j){return k=k?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,O.subscribedPeerStatusCache[j]=k}),O.emit("PeersOnlineStatusChanged",C)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=h,h!==oa.ABORTED&&h!==oa.DISCONNECTED||(this.pendingPeerStatusSubCount=this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.emit("ConnectionStateChanged",h,E)}},{key:"banIP",value:function(h){var E;this.log("ip banned",h);var v=(E=this.blacklistedIP[h])!==null&&E!==void 0?E:0;this.blacklistedIP[h]=v+1}}]),r}(sc()),Da(W.prototype,"renewToken",[jb],Object.getOwnPropertyDescriptor(W.prototype,"renewToken"),W.prototype),Da(W.prototype,"queryPeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersOnlineStatus"),W.prototype),Da(W.prototype,"getChannelMemberCount",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelMemberCount"),W.prototype),Da(W.prototype,"setLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setLocalUserAttributes"),W.prototype),Da(W.prototype,"setChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setChannelAttributes"),W.prototype),Da(W.prototype,"addOrUpdateLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateLocalUserAttributes"),W.prototype),Da(W.prototype,"addOrUpdateChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateChannelAttributes"),W.prototype),Da(W.prototype,"deleteLocalUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteLocalUserAttributesByKeys"),W.prototype),Da(W.prototype,"deleteChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteChannelAttributesByKeys"),W.prototype),Da(W.prototype,"clearLocalUserAttributes",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"clearLocalUserAttributes"),W.prototype),Da(W.prototype,"clearChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"clearChannelAttributes"),W.prototype),Da(W.prototype,"getUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributes"),W.prototype),Da(W.prototype,"getChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributes"),W.prototype),Da(W.prototype,"getChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributesByKeys"),W.prototype),Da(W.prototype,"getUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributesByKeys"),W.prototype),Da(W.prototype,"login",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"login"),W.prototype),Da(W.prototype,"logout",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logout"),W.prototype),Da(W.prototype,"logoutSync",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logoutSync"),W.prototype),Da(W.prototype,"sendMessageToPeer",[jb],Object.getOwnPropertyDescriptor(W.prototype,"sendMessageToPeer"),W.prototype),Da(W.prototype,"createChannel",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createChannel"),W.prototype),Da(W.prototype,"createLocalInvitation",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createLocalInvitation"),W.prototype),Da(W.prototype,"subscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"subscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"unsubscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"unsubscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"queryPeersBySubscriptionOption",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersBySubscriptionOption"),W.prototype),Da(W.prototype,"createMessage",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"createMessage"),W.prototype),W),rm,sm,tm,um,Wt=(rm=/Chrome\/([0-9.]+)/.exec((tm=window)===null||tm===void 0||(um=tm.navigator)===null||um===void 0?void 0:um.userAgent))===null||rm===void 0||(sm=rm[1])===null||sm===void 0?void 0:sm.split(".")[0];if(Wt&&88<=parseInt(Wt,10)&&!Ce()){var vm,ze=document.createElement("video"),Ae=document.createElement("canvas");ze.setAttribute("style","display:none"),ze.setAttribute("muted",""),ze.muted=!0,ze.setAttribute("autoplay",""),ze.autoplay=!0,ze.setAttribute("playsinline",""),Ae.setAttribute("style","display:none"),Ae.setAttribute("width","1"),Ae.setAttribute("height","1"),(vm=Ae.getContext("2d"))===null||vm===void 0||vm.fillRect(0,0,1,1),ze.srcObject=Ae==null?void 0:Ae.captureStream()}var Xt={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},Yt={enableLogUpload:!1,logFilter:Xt.LOG_FILTER_INFO,enableCloudProxy:!1},ue=Wa(Wa({createInstance:function(i){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},o=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(i))throw new ca(["The %s in the arguments is invalid",Object.keys({appId:i})[0]],Or);var u=Object.keys(r).filter(function(j){return!(j in Yt)});if(u.length!==0)throw new ca("Invalid RTM config: ".concat(u.join(", ")),Or);var h=Wa(Wa({},Yt),r);if(o!==void 0&&(!Array.isArray(o)||o.length===0))throw new ca("Invalid area config");if(o!=null){if(!o.every(function(j){return j in ta.LegacyAreaCode}))throw new ca("Invalid area codes: ".concat(o.filter(function(j){return!(j in ta)}).join(", ")));fa=Ve(o.map(function(j){return dE[j]}))}o=Tl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var E=iE(h);u=jE(h);var v=kE(h),O=lE(o,h),C=Xs(o,h),k=C("RTM:DEBUG","<Entry> ");return Qs.rtmConfig=h,E("The Agora RTM Web SDK version is %s","1.5.1"),r.enableCloudProxy&&E("RTM cloud proxy enabled"),r.enableLogUpload&&E("Log upload enabled"),fa&&k("Area is set to %s",Array.from(fa.CODES).map(function(j){return Yf(S).find(function(K){return S[K]===j})}).join(", ")),k("Creating an RtmClient instance"),k('The Git commit ID is "'.concat("v1.5.1-0-g5bbbcd72",'"')),k("The App ID is %s",Yn(i,4,10,"*".repeat(6))),E("The process ID is %s",Og),k("The build is %s","v1.5.1-0-g5bbbcd72"),k("NODE_ENV is %s","production"),new wF(i,{genLogger:C,genTracker:O,info:E,warn:u,logError:v,loggerId:o},h,function(j){for(var K=0,$=Yf(j);K<$.length;K++){var _e=$[K];try{var na=j[_e];na!=null&&(j.enableCloudProxy&&E("RTM cloud proxy enabled"),j.enableLogUpload&&E("Log upload enabled"),h[_e]=na)}catch{throw new ca(["The %s in the arguments is invalid",_e],void 0)}}})},BUILD:"v1.5.1-0-g5bbbcd72",VERSION:"1.5.1",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:Og,ConnectionChangeReason:ta.ConnectionChangeReason,ConnectionState:ta.ConnectionState,LocalInvitationFailureReason:ta.LocalInvitationFailureReason,LocalInvitationState:ta.LocalInvitationState,RemoteInvitationFailureReason:ta.RemoteInvitationFailureReason,RemoteInvitationState:ta.RemoteInvitationState,MessageType:ta.MessageType,PeerOnlineState:ta.PeerOnlineState,PeerSubscriptionOption:ta.PeerSubscriptionOption},Xt),{},{setParameter:function(i,r){Object.keys(Ec).includes(i)&&(Ec[i]=r)},getParameter:function(i){return Ec[i]},setArea:function(i){var r=i.areaCodes;if(i=i.excludedArea,!Array.isArray(r)||r.length===0||!r.every(function(o){return o in ta.AreaCode}))throw new ca("Invalid area config");if(i!==void 0&&i===ta.AreaCode.GLOBAL)throw new ca("Excluded area cannot be global");if(i===void 0)fa=Ve(r.map(function(o){return S[o]}));else{if(r.includes(i))throw new ca("Excluded area cannot be in areaCodes");if(!(i in S))throw new ca("Invalid excludedArea:",i);fa=Gv({areas:r.map(function(o){return S[o]}),excludedArea:S[i]})}}});return ue})}(agoraRtmSdk$1,agoraRtmSdk$1.exports)),agoraRtmSdk$1.exports}var agoraRtmSdkExports=requireAgoraRtmSdk(),AgoraRTC_NProduction$1={exports:{}},AgoraRTC_NProduction=AgoraRTC_NProduction$1.exports,hasRequiredAgoraRTC_NProduction;function requireAgoraRTC_NProduction(){return hasRequiredAgoraRTC_NProduction||(hasRequiredAgoraRTC_NProduction=1,function(i,r){(function(o,u){i.exports=u()})(AgoraRTC_NProduction,function(){function o(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(a){if(a!=="default"&&!(a in t)){var s=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(t,a,s.get?s:{enumerable:!0,get:function(){return n[a]}})}})}),Object.freeze(t)}var u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{};function h(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var E=function(t){try{return!!t()}catch{return!0}},v=!E(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),O=v,C=Function.prototype,k=C.call,j=O&&C.bind.bind(k,k),K=O?j:function(t){return function(){return k.apply(t,arguments)}},$=K({}.isPrototypeOf),_e=function(t){return t&&t.Math==Math&&t},na=_e(typeof globalThis=="object"&&globalThis)||_e(typeof window=="object"&&window)||_e(typeof self=="object"&&self)||_e(typeof u=="object"&&u)||function(){return this}()||u||Function("return this")(),_c=v,_a=Function.prototype,_s=_a.apply,_h=_a.call,_f=typeof Reflect=="object"&&Reflect.apply||(_c?_h.bind(_s):function(){return _h.apply(_s,arguments)}),E_=K,y_=E_({}.toString),F_=E_("".slice),w_=function(t){return F_(y_(t),8,-1)},W_=w_,_S=K,o_=function(t){if(W_(t)==="Function")return _S(t)},b_=typeof document=="object"&&document.all,h_={all:b_,IS_HTMLDDA:b_===void 0&&b_!==void 0},B_=h_.all,e_=h_.IS_HTMLDDA?function(t){return typeof t=="function"||t===B_}:function(t){return typeof t=="function"},r_={},_p=!E(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),c_=v,v_=Function.prototype.call,q_=c_?v_.bind(v_):function(){return v_.apply(v_,arguments)},_u={},S_={}.propertyIsEnumerable,P_=Object.getOwnPropertyDescriptor,G_=P_&&!S_.call({1:2},1);_u.f=G_?function(t){var e=P_(this,t);return!!e&&e.enumerable}:S_;var lb,kS,Z_=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},$S=E,FS=w_,t0=Object,WO=K("".split),YO=$S(function(){return!t0("z").propertyIsEnumerable(0)})?function(t){return FS(t)=="String"?WO(t,""):t0(t)}:t0,PI=function(t){return t==null},w3=PI,I3=TypeError,OL=function(t){if(w3(t))throw I3("Can't call method on "+t);return t},pK=YO,mO=OL,MI=function(t){return pK(mO(t))},N3=e_,T6=h_.all,SR=h_.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:N3(t)||t===T6}:function(t){return typeof t=="object"?t!==null:N3(t)},v0={},qM=v0,D3=na,fK=e_,wL=function(t){return fK(t)?t:void 0},vT=function(t,e){return arguments.length<2?wL(qM[t])||wL(D3[t]):qM[t]&&qM[t][e]||D3[t]&&D3[t][e]},FR=typeof navigator<"u"&&String(navigator.userAgent)||"",e0=na,k3=FR,R6=e0.process,A6=e0.Deno,JP=R6&&R6.versions||A6&&A6.version,ZP=JP&&JP.v8;ZP&&(kS=(lb=ZP.split("."))[0]>0&&lb[0]<4?1:+(lb[0]+lb[1])),!kS&&k3&&(!(lb=k3.match(/Edge\/(\d+)/))||lb[1]>=74)&&(lb=k3.match(/Chrome\/(\d+)/))&&(kS=+lb[1]);var y0=kS,QP=y0,$P=E,mK=na.String,xN=!!Object.getOwnPropertySymbols&&!$P(function(){var t=Symbol();return!mK(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&QP&&QP<41}),L3=xN&&!Symbol.sham&&typeof Symbol.iterator=="symbol",P3=vT,t1=e_,EK=$,C6=Object,IL=L3?function(t){return typeof t=="symbol"}:function(t){var e=P3("Symbol");return t1(e)&&EK(e.prototype,C6(t))},M3=String,xI=function(t){try{return M3(t)}catch{return"Object"}},O6=e_,gK=xI,UI=TypeError,hT=function(t){if(O6(t))return t;throw UI(gK(t)+" is not a function")},n0=hT,NL=PI,DL=function(t,e){var n=t[e];return NL(n)?void 0:n0(n)},w6=q_,I6=e_,x3=SR,e1=TypeError,zM={exports:{}},UN=na,kL=Object.defineProperty,n1=function(t,e){try{kL(UN,t,{value:e,configurable:!0,writable:!0})}catch{UN[t]=e}return e},jN="__core-js_shared__",eR=na[jN]||n1(jN,{}),U3=eR;(zM.exports=function(t,e){return U3[t]||(U3[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var VN=zM.exports,BN=OL,LL=Object,EO=function(t){return LL(BN(t))},N6=EO,D6=K({}.hasOwnProperty),YT=Object.hasOwn||function(t,e){return D6(N6(t),e)},KM=K,WM=0,XO=Math.random(),j3=KM(1 .toString),YM=function(t){return"Symbol("+(t===void 0?"":t)+")_"+j3(++WM+XO,36)},PL=VN,XM=YT,V3=YM,_K=xN,k6=L3,TR=na.Symbol,JM=PL("wks"),vK=k6?TR.for||TR:TR&&TR.withoutSetter||V3,tT=function(t){return XM(JM,t)||(JM[t]=_K&&XM(TR,t)?TR[t]:vK("Symbol."+t)),JM[t]},L6=q_,r1=SR,P6=IL,N0=DL,B3=function(t,e){var n,a;if(I6(n=t.toString)&&!x3(a=w6(n,t))||I6(n=t.valueOf)&&!x3(a=w6(n,t)))return a;throw e1("Can't convert object to primitive value")},M6=TypeError,F3=tT("toPrimitive"),ML=function(t,e){if(!r1(t)||P6(t))return t;var n,a=N0(t,F3);if(a){if(n=L6(a,t,e),!r1(n)||P6(n))return n;throw M6("Can't convert object to primitive value")}return B3(t)},x6=IL,i1=function(t){var e=ML(t,"string");return x6(e)?e:e+""},FN=SR,G3=na.document,U6=FN(G3)&&FN(G3.createElement),ZM=function(t){return U6?G3.createElement(t):{}},H3=ZM,j6=!_p&&!E(function(){return Object.defineProperty(H3("div"),"a",{get:function(){return 7}}).a!=7}),yK=_p,QM=q_,q3=_u,z3=Z_,xL=MI,UL=i1,V6=YT,K3=j6,W3=Object.getOwnPropertyDescriptor;r_.f=yK?W3:function(t,e){if(t=xL(t),e=UL(e),K3)try{return W3(t,e)}catch{}if(V6(t,e))return z3(!QM(q3.f,t,e),t[e])};var o1=E,JO=e_,Y3=/#|\.prototype\./,ZO=function(t,e){var n=X3[jI(t)];return n==B6||n!=$M&&(JO(e)?o1(e):!!e)},jI=ZO.normalize=function(t){return String(t).replace(Y3,".").toLowerCase()},X3=ZO.data={},$M=ZO.NATIVE="N",B6=ZO.POLYFILL="P",a1=ZO,_x=hT,F6=v,r0=o_(o_.bind),i0=function(t,e){return _x(t),e===void 0?t:F6?r0(t,e):function(){return t.apply(e,arguments)}},GR={},jL=_p&&E(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),bK=SR,J3=String,Z3=TypeError,nR=function(t){if(bK(t))return t;throw Z3(J3(t)+" is not an object")},tU=_p,G6=j6,SK=jL,eU=nR,H6=i1,Q3=TypeError,$3=Object.defineProperty,TK=Object.getOwnPropertyDescriptor,EF="enumerable",_F="configurable",yF="writable";GR.f=tU?SK?function(t,e,n){if(eU(t),e=H6(e),eU(n),typeof t=="function"&&e==="prototype"&&"value"in n&&yF in n&&!n[yF]){var a=TK(t,e);a&&a[yF]&&(t[e]=n.value,n={configurable:_F in n?n[_F]:a[_F],enumerable:EF in n?n[EF]:a[EF],writable:!1})}return $3(t,e,n)}:$3:function(t,e,n){if(eU(t),e=H6(e),eU(n),G6)try{return $3(t,e,n)}catch{}if("get"in n||"set"in n)throw Q3("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var q6=GR,RK=Z_,VI=_p?function(t,e,n){return q6.f(t,e,RK(1,n))}:function(t,e,n){return t[e]=n,t},nU=na,AK=_f,SF=o_,CK=e_,OK=r_.f,wK=a1,GN=v0,IK=i0,VL=VI,z6=YT,NK=function(t){var e=function(n,a,s){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,a)}return new t(n,a,s)}return AK(t,this,arguments)};return e.prototype=t.prototype,e},SS=function(t,e){var n,a,s,d,f,m,_,y,T,w=t.target,L=t.global,B=t.stat,Q=t.proto,X=L?nU:B?nU[w]:(nU[w]||{}).prototype,J=L?GN:GN[w]||VL(GN,w,{})[w],_n=J.prototype;for(d in e)a=!(n=wK(L?d:w+(B?".":"#")+d,t.forced))&&X&&z6(X,d),m=J[d],a&&(_=t.dontCallGetSet?(T=OK(X,d))&&T.value:X[d]),f=a&&_?_:e[d],a&&typeof m==typeof f||(y=t.bind&&a?IK(f,nU):t.wrap&&a?NK(f):Q&&CK(f)?SF(f):f,(t.sham||f&&f.sham||m&&m.sham)&&VL(y,"sham",!0),VL(J,d,y),Q&&(z6(GN,s=w+"Prototype")||VL(GN,s,{}),VL(GN[s],d,f),t.real&&_n&&(n||!_n[d])&&VL(_n,d,f)))},DK=Math.ceil,kK=Math.floor,LK=Math.trunc||function(t){var e=+t;return(e>0?kK:DK)(e)},PK=LK,s1=function(t){var e=+t;return e!=e||e===0?0:PK(e)},c1=s1,MK=Math.max,K6=Math.min,rU=function(t,e){var n=c1(t);return n<0?MK(n+e,0):K6(n,e)},W6=s1,Y6=Math.min,TF=function(t){return t>0?Y6(W6(t),9007199254740991):0},BL=TF,QO=function(t){return BL(t.length)},xK=MI,UK=rU,X6=QO,RF=function(t){return function(e,n,a){var s,d=xK(e),f=X6(d),m=UK(a,f);if(t&&n!=n){for(;f>m;)if((s=d[m++])!=s)return!0}else for(;f>m;m++)if((t||m in d)&&d[m]===n)return t||m||0;return!t&&-1}},HN={includes:RF(!0),indexOf:RF(!1)},u1=HN.includes;SS({target:"Array",proto:!0,forced:E(function(){return!Array(1).includes()})},{includes:function(t){return u1(this,t,arguments.length>1?arguments[1]:void 0)}});var jK=v0,HR=function(t){return jK[t+"Prototype"]},J6=HR("Array").includes,Z6=SR,AF=w_,CF=tT("match"),OF=function(t){var e;return Z6(t)&&((e=t[CF])!==void 0?!!e:AF(t)=="RegExp")},Q6=OF,$6=TypeError,t5={};t5[tT("toStringTag")]="z";var IF=String(t5)==="[object z]",VK=IF,BK=e_,iU=w_,b0=tT("toStringTag"),l1=Object,e5=iU(function(){return arguments}())=="Arguments",Y0=VK?iU:function(t){var e,n,a;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(s,d){try{return s[d]}catch{}}(e=l1(t),b0))=="string"?n:e5?iU(e):(a=iU(e))=="Object"&&BK(e.callee)?"Arguments":a},n5=Y0,r5=String,qR=function(t){if(n5(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return r5(t)},FK=tT("match"),FL=SS,NF=function(t){if(Q6(t))throw $6("The method doesn't accept regular expressions");return t},d1=OL,oU=qR,i5=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[FK]=!1,"/./"[t](e)}catch{}}return!1},qN=K("".indexOf);FL({target:"String",proto:!0,forced:!i5("includes")},{includes:function(t){return!!~qN(oU(d1(this)),oU(NF(t)),arguments.length>1?arguments[1]:void 0)}});var GL=HR("String").includes,aU=$,o5=J6,zN=GL,sU=Array.prototype,cU=String.prototype,a5=function(t){var e=t.includes;return t===sU||aU(sU,t)&&e===sU.includes?o5:typeof t=="string"||t===cU||aU(cU,t)&&e===cU.includes?zN:e},T_=h(a5),GK=hT,HK=EO,s5=YO,c5=QO,DF=TypeError,X0=function(t){return function(e,n,a,s){GK(n);var d=HK(e),f=s5(d),m=c5(d),_=t?m-1:0,y=t?-1:1;if(a<2)for(;;){if(_ in f){s=f[_],_+=y;break}if(_+=y,t?_<0:m<=_)throw DF("Reduce of empty array with no initial value")}for(;t?_>=0:m>_;_+=y)_ in f&&(s=n(s,f[_],_,d));return s}},u5={left:X0(!1)},D0=E,zR=function(t,e){var n=[][t];return!!n&&D0(function(){n.call(null,e||function(){return 1},1)})},J0=typeof process<"u"&&w_(process)=="process",LF=u5.left;SS({target:"Array",proto:!0,forced:!J0&&y0>79&&y0<83||!zR("reduce")},{reduce:function(t){var e=arguments.length;return LF(this,t,e,e>1?arguments[1]:void 0)}});var uU=HR("Array").reduce,lU=$,PF=uU,BI=Array.prototype,l5=function(t){var e=t.reduce;return t===BI||lU(BI,t)&&e===BI.reduce?PF:e},h1=l5,LR=h(h1),qK=w_,RR=Array.isArray||function(t){return qK(t)=="Array"},MF=SS,$O=RR,d5=K([].reverse),p1=[1,2];MF({target:"Array",proto:!0,forced:String(p1)===String(p1.reverse())},{reverse:function(){return $O(this)&&(this.length=this.length),d5(this)}});var KN=HR("Array").reverse,xF=$,UF=KN,FI=Array.prototype,HL=function(t){var e=t.reverse;return t===FI||xF(FI,t)&&e===FI.reverse?UF:e},f1=HL,m1=h(f1),k0=YM,S0=VN("keys"),gO=function(t){return S0[t]||(S0[t]=k0(t))},_w=!E(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),tI=YT,WN=e_,h5=EO,VF=_w,dU=gO("IE_PROTO"),AR=Object,HT=AR.prototype,XS=VF?AR.getPrototypeOf:function(t){var e=h5(t);if(tI(e,dU))return e[dU];var n=e.constructor;return WN(n)&&e instanceof n?n.prototype:e instanceof AR?HT:null},YN=K,_O=hT,BF=e_,XN=String,p5=TypeError,f5=function(t,e,n){try{return YN(_O(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},E1=nR,g1=function(t){if(typeof t=="object"||BF(t))return t;throw p5("Can't set "+XN(t)+" as a prototype")},m5=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=f5(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(a,s){return E1(a),g1(s),e?t(a,s):a.__proto__=s,a}}():void 0),GI={},qL={},eI=YT,nI=MI,HI=HN.indexOf,rI=qL,hU=K([].push),pU=function(t,e){var n,a=nI(t),s=0,d=[];for(n in a)!eI(rI,n)&&eI(a,n)&&hU(d,n);for(;e.length>s;)eI(a,n=e[s++])&&(~HI(d,n)||hU(d,n));return d},JN=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],fU=pU,ZN=JN.concat("length","prototype");GI.f=Object.getOwnPropertyNames||function(t){return fU(t,ZN)};var rR={};rR.f=Object.getOwnPropertySymbols;var mU=vT,E5=GI,zK=rR,KK=nR,WK=K([].concat),dR=mU("Reflect","ownKeys")||function(t){var e=E5.f(KK(t)),n=zK.f;return n?WK(e,n(t)):e},EU=YT,_1=dR,v1=r_,FF=GR,qI={},zL=pU,YK=JN,y1=Object.keys||function(t){return zL(t,YK)},XK=_p,g5=jL,QN=GR,GF=nR,gU=MI,_5=y1;qI.f=XK&&!g5?Object.defineProperties:function(t,e){GF(t);for(var n,a=gU(e),s=_5(e),d=s.length,f=0;d>f;)QN.f(t,n=s[f++],a[n]);return t};var zI,HF=vT("document","documentElement"),_U=nR,zF=qI,KF=JN,vU=qL,v5=HF,b1=ZM,yU="prototype",bU="script",iI=gO("IE_PROTO"),S1=function(){},SU=function(t){return"<"+bU+">"+t+"</"+bU+">"},oI=function(t){t.write(SU("")),t.close();var e=t.parentWindow.Object;return t=null,e},Z0=function(){try{zI=new ActiveXObject("htmlfile")}catch{}var t,e,n;Z0=typeof document<"u"?document.domain&&zI?oI(zI):(e=b1("iframe"),n="java"+bU+":",e.style.display="none",v5.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(SU("document.F=Object")),t.close(),t.F):oI(zI);for(var a=KF.length;a--;)delete Z0[yU][KF[a]];return Z0()};vU[iI]=!0;var aI=Object.create||function(t,e){var n;return t!==null?(S1[yU]=_U(t),n=new S1,S1[yU]=null,n[iI]=t):n=Z0(),e===void 0?n:zF.f(n,e)},WF=SR,YF=VI,KL=Error,T1=K("".replace),y5=String(KL("zxcasd").stack),XF=/\n\s*at [^:]*:[^\n]*/,WL=XF.test(y5),TU=Z_,b5=!E(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",TU(1,7)),t.stack!==7)}),JF=VI,ZF=function(t,e){if(WL&&typeof t=="string"&&!KL.prepareStackTrace)for(;e--;)t=T1(t,XF,"");return t},KI=b5,CS=Error.captureStackTrace,KS={},iR=KS,RU=tT("iterator"),YL=Array.prototype,WI=function(t){return t!==void 0&&(iR.Array===t||YL[RU]===t)},AU=Y0,XL=DL,JL=PI,JK=KS,XT=tT("iterator"),ZL=function(t){if(!JL(t))return XL(t,XT)||XL(t,"@@iterator")||JK[AU(t)]},QF=q_,S5=hT,T5=nR,ZK=xI,$F=ZL,tG=TypeError,R1=function(t,e){var n=arguments.length<2?$F(t):e;if(S5(n))return T5(QF(n,t));throw tG(ZK(t)+" is not iterable")},o0=q_,JT=nR,eG=DL,QL=function(t,e,n){var a,s;JT(t);try{if(!(a=eG(t,"return"))){if(e==="throw")throw n;return n}a=o0(a,t)}catch(d){s=!0,a=d}if(e==="throw")throw n;if(s)throw a;return JT(a),n},CU=i0,nG=q_,sI=nR,OU=xI,rG=WI,iG=QO,oG=$,R5=R1,A5=ZL,aG=QL,C5=TypeError,A1=function(t,e){this.stopped=t,this.result=e},wU=A1.prototype,$L=function(t,e,n){var a,s,d,f,m,_,y,T=n&&n.that,w=!(!n||!n.AS_ENTRIES),L=!(!n||!n.IS_RECORD),B=!(!n||!n.IS_ITERATOR),Q=!(!n||!n.INTERRUPTED),X=CU(e,T),J=function(_r){return a&&aG(a,"normal",_r),new A1(!0,_r)},_n=function(_r){return w?(sI(_r),Q?X(_r[0],_r[1],J):X(_r[0],_r[1])):Q?X(_r,J):X(_r)};if(L)a=t.iterator;else if(B)a=t;else{if(!(s=A5(t)))throw C5(OU(t)+" is not iterable");if(rG(s)){for(d=0,f=iG(t);f>d;d++)if((m=_n(t[d]))&&oG(wU,m))return m;return new A1(!1)}a=R5(t,s)}for(_=L?t.next:a.next;!(y=nG(_,a)).done;){try{m=_n(y.value)}catch(_r){aG(a,"throw",_r)}if(typeof m=="object"&&m&&oG(wU,m))return m}return new A1(!1)},QK=qR,O5=SS,w5=$,I5=XS,tP=m5,N5=function(t,e,n){for(var a=_1(e),s=FF.f,d=v1.f,f=0;f<a.length;f++){var m=a[f];EU(t,m)||n&&EU(n,m)||s(t,m,d(e,m))}},sG=aI,IU=VI,NU=Z_,D5=function(t,e){WF(e)&&"cause"in e&&YF(t,"cause",e.cause)},$K=function(t,e,n,a){KI&&(CS?CS(t,e):JF(t,"stack",ZF(n,a)))},k5=$L,eP=function(t,e){return t===void 0?arguments.length<2?"":e:QK(t)},DU=tT("toStringTag"),C1=Error,kU=[].push,vO=function(t,e){var n,a=w5(LU,this);tP?n=tP(C1(),a?I5(this):LU):(n=a?this:sG(LU),IU(n,DU,"Error")),e!==void 0&&IU(n,"message",eP(e)),$K(n,vO,n.stack,1),arguments.length>2&&D5(n,arguments[2]);var s=[];return k5(t,kU,{that:s}),IU(n,"errors",s),n};tP?tP(vO,C1):N5(vO,C1,{name:!0});var LU=vO.prototype=sG(C1.prototype,{constructor:NU(1,vO),message:NU(1,""),name:NU(1,"AggregateError")});O5({global:!0},{AggregateError:vO});var O1,nP,w1,L5=e_,cG=na.WeakMap,uG=L5(cG)&&/native code/.test(String(cG)),lG=na,P5=SR,dG=VI,PU=YT,MU=eR,tW=gO,hG=qL,pG="Object already initialized",xU=lG.TypeError,fG=lG.WeakMap;if(uG||MU.state){var Q0=MU.state||(MU.state=new fG);Q0.get=Q0.get,Q0.has=Q0.has,Q0.set=Q0.set,O1=function(t,e){if(Q0.has(t))throw xU(pG);return e.facade=t,Q0.set(t,e),e},nP=function(t){return Q0.get(t)||{}},w1=function(t){return Q0.has(t)}}else{var $N=tW("state");hG[$N]=!0,O1=function(t,e){if(PU(t,$N))throw xU(pG);return e.facade=t,dG(t,$N,e),e},nP=function(t){return PU(t,$N)?t[$N]:{}},w1=function(t){return PU(t,$N)}}var _D,M5,mG,$0={set:O1,get:nP,has:w1,enforce:function(t){return w1(t)?nP(t):O1(t,{})},getterFor:function(t){return function(e){var n;if(!P5(e)||(n=nP(e)).type!==t)throw xU("Incompatible receiver, "+t+" required");return n}}},I1=_p,UU=YT,EG=Function.prototype,x5=I1&&Object.getOwnPropertyDescriptor,N1=UU(EG,"name"),gG={PROPER:N1&&(function(){}).name==="something",CONFIGURABLE:N1&&(!I1||I1&&x5(EG,"name").configurable)},U5=VI,YI=function(t,e,n,a){return a&&a.enumerable?t[e]=n:U5(t,e,n),t},rP=E,D1=e_,jU=SR,k1=aI,L1=XS,j5=YI,VU=tT("iterator"),_k=!1;[].keys&&("next"in(mG=[].keys())?(M5=L1(L1(mG)))!==Object.prototype&&(_D=M5):_k=!0);var V5=!jU(_D)||rP(function(){var t={};return _D[VU].call(t)!==t});D1((_D=V5?{}:k1(_D))[VU])||j5(_D,VU,function(){return this});var T0={IteratorPrototype:_D,BUGGY_SAFARI_ITERATORS:_k},yO=Y0,XI=IF?{}.toString:function(){return"[object "+yO(this)+"]"},B5=IF,JI=GR.f,cI=VI,hR=YT,BU=XI,FU=tT("toStringTag"),bO=function(t,e,n,a){if(t){var s=n?t:t.prototype;hR(s,FU)||JI(s,FU,{configurable:!0,value:e}),a&&!B5&&cI(s,"toString",BU)}},F5=T0.IteratorPrototype,G5=aI,tL=Z_,GU=bO,H5=KS,q5=function(){return this},HU=function(t,e,n,a){var s=e+" Iterator";return t.prototype=G5(F5,{next:tL(+!a,n)}),GU(t,s,!1,!0),H5[s]=q5,t},qU=SS,z5=q_,_G=gG,K5=HU,W5=XS,eW=bO,vG=YI,pR=KS,CR=T0,Y5=_G.PROPER,P1=CR.BUGGY_SAFARI_ITERATORS,zU=tT("iterator"),yG="keys",M1="values",x1="entries",bG=function(){return this},SG=function(t,e,n,a,s,d,f){K5(n,e,a);var m,_,y,T=function(_n){if(_n===s&&X)return X;if(!P1&&_n in B)return B[_n];switch(_n){case yG:case M1:case x1:return function(){return new n(this,_n)}}return function(){return new n(this)}},w=e+" Iterator",L=!1,B=t.prototype,Q=B[zU]||B["@@iterator"]||s&&B[s],X=!P1&&Q||T(s),J=e=="Array"&&B.entries||Q;if(J&&(m=W5(J.call(new t)))!==Object.prototype&&m.next&&(eW(m,w,!0,!0),pR[w]=bG),Y5&&s==M1&&Q&&Q.name!==M1&&(L=!0,X=function(){return z5(Q,this)}),s)if(_={values:T(M1),keys:d?X:T(yG),entries:T(x1)},f)for(y in _)(P1||L||!(y in B))&&vG(B,y,_[y]);else qU({target:e,proto:!0,forced:P1||L},_);return f&&B[zU]!==X&&vG(B,zU,X,{}),pR[e]=X,_},KU=function(t,e){return{value:t,done:e}},X5=MI,WU=KS,YU=$0;GR.f;var TG=SG,RG=KU,XU="Array Iterator",JU=YU.set,AG=YU.getterFor(XU);TG(Array,"Array",function(t,e){JU(this,{type:XU,target:X5(t),index:0,kind:e})},function(){var t=AG(this),e=t.target,n=t.kind,a=t.index++;return!e||a>=e.length?(t.target=void 0,RG(void 0,!0)):RG(n=="keys"?a:n=="values"?e[a]:[a,e[a]],!1)},"values"),WU.Arguments=WU.Array;var J5=GR,iP=function(t,e,n){return J5.f(t,e,n)},Z5=vT,uI=iP,CG=_p,Q5=tT("species"),$5=$,lI=TypeError,ZU=function(t,e){if($5(e,t))return t;throw lI("Incorrect invocation")},QU=e_,eL=eR,xT=K(Function.toString);QU(eL.inspectSource)||(eL.inspectSource=function(t){return xT(t)});var t4=eL.inspectSource,nW=K,e4=E,oP=e_,ZI=Y0,n4=t4,OG=function(){},U1=[],_A=vT("Reflect","construct"),$U=/^\s*(?:class|function)\b/,wG=nW($U.exec),r4=!$U.exec(OG),nL=function(t){if(!oP(t))return!1;try{return _A(OG,U1,t),!0}catch{return!1}},_j=function(t){if(!oP(t))return!1;switch(ZI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return r4||!!wG($U,n4(t))}catch{return!0}};_j.sham=!0;var QI,rL,SO,UT,aP=!_A||e4(function(){var t;return nL(nL.call)||!nL(Object)||!nL(function(){t=!0})||t})?_j:nL,i4=aP,vR=xI,rW=TypeError,IG=nR,o4=function(t){if(i4(t))return t;throw rW(vR(t)+" is not a constructor")},PT=PI,a0=tT("species"),qA=function(t,e){var n,a=IG(t).constructor;return a===void 0||PT(n=IG(a)[a0])?e:o4(n)},j1=K([].slice),a4=TypeError,sP=function(t,e){if(t<e)throw a4("Not enough arguments");return t},$j=/(?:ipad|iphone|ipod).*applewebkit/i.test(FR),DT=na,_C=_f,s4=i0,s0=e_,c4=YT,dI=E,$I=HF,tN=j1,tV=ZM,NG=sP,TO=$j,u4=J0,eN=DT.setImmediate,iL=DT.clearImmediate,V1=DT.process,nN=DT.Dispatch,l4=DT.Function,DG=DT.MessageChannel,B1=DT.String,eV=0,rN={},kG="onreadystatechange";dI(function(){QI=DT.location});var LG=function(t){if(c4(rN,t)){var e=rN[t];delete rN[t],e()}},PG=function(t){return function(){LG(t)}},cT=function(t){LG(t.data)},yT=function(t){DT.postMessage(B1(t),QI.protocol+"//"+QI.host)};eN&&iL||(eN=function(t){NG(arguments.length,1);var e=s0(t)?t:l4(t),n=tN(arguments,1);return rN[++eV]=function(){_C(e,void 0,n)},rL(eV),eV},iL=function(t){delete rN[t]},u4?rL=function(t){V1.nextTick(PG(t))}:nN&&nN.now?rL=function(t){nN.now(PG(t))}:DG&&!TO?(UT=(SO=new DG).port2,SO.port1.onmessage=cT,rL=s4(UT.postMessage,UT)):DT.addEventListener&&s0(DT.postMessage)&&!DT.importScripts&&QI&&QI.protocol!=="file:"&&!dI(yT)?(rL=yT,DT.addEventListener("message",cT,!1)):rL=kG in tV("script")?function(t){$I.appendChild(tV("script"))[kG]=function(){$I.removeChild(this),LG(t)}}:function(t){setTimeout(PG(t),0)});var OS={set:eN,clear:iL},GS=function(){this.head=null,this.tail=null};GS.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var WS,KR,RO,iN,nV,AO=GS,qT=/ipad|iphone|ipod/i.test(FR)&&typeof Pebble<"u",oN=/web0s(?!.*chrome)/i.test(FR),R0=na,rV=i0,L0=r_.f,aN=OS.set,F1=AO,c0=$j,MG=qT,xG=oN,cP=J0,G1=R0.MutationObserver||R0.WebKitMutationObserver,hI=R0.document,yR=R0.process,tO=R0.Promise,oL=L0(R0,"queueMicrotask"),sN=oL&&oL.value;if(!sN){var uP=new F1,lP=function(){var t,e;for(cP&&(t=yR.domain)&&t.exit();e=uP.get();)try{e()}catch(n){throw uP.head&&WS(),n}t&&t.enter()};c0||cP||xG||!G1||!hI?!MG&&tO&&tO.resolve?((iN=tO.resolve(void 0)).constructor=tO,nV=rV(iN.then,iN),WS=function(){nV(lP)}):cP?WS=function(){yR.nextTick(lP)}:(aN=rV(aN,R0),WS=function(){aN(lP)}):(KR=!0,RO=hI.createTextNode(""),new G1(lP).observe(RO,{characterData:!0}),WS=function(){RO.data=KR=!KR}),sN=function(t){uP.head||WS(),uP.add(t)}}var UG=sN,CO=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},pI=na.Promise,u0=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",d4=!u0&&!J0&&typeof window=="object"&&typeof document=="object",A0=na,dP=pI,h4=e_,iW=a1,cN=t4,iV=tT,jG=d4,hP=u0,oV=y0,VG=dP&&dP.prototype,p4=iV("species"),aV=h4(A0.PromiseRejectionEvent),BG=iW("Promise",function(){var t=cN(dP),e=t!==String(dP);if(!e&&oV===66||!VG.catch||!VG.finally)return!0;if(!oV||oV<51||!/native code/.test(t)){var n=new dP(function(s){s(1)}),a=function(s){s(function(){},function(){})};if((n.constructor={})[p4]=a,!(n.then(function(){})instanceof a))return!0}return!e&&(jG||hP)&&!aV}),H1={CONSTRUCTOR:BG,REJECTION_EVENT:aV},OO={},f4=hT,m4=TypeError,E4=function(t){var e,n;this.promise=new t(function(a,s){if(e!==void 0||n!==void 0)throw m4("Bad Promise constructor");e=a,n=s}),this.resolve=f4(e),this.reject=f4(n)};OO.f=function(t){return new E4(t)};var uN,q1,g4=SS,z1=J0,fI=na,pP=q_,_4=YI,v4=bO,sV=function(t){var e=Z5(t);CG&&e&&!e[Q5]&&uI(e,Q5,{configurable:!0,get:function(){return this}})},y4=hT,cV=e_,bT=SR,FG=ZU,oW=qA,GG=OS.set,HG=UG,aW=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},sW=CO,uV=AO,aL=$0,K1=pI,W1=H1,lV=OO,wO="Promise",eO=W1.CONSTRUCTOR,Y1=W1.REJECTION_EVENT,qG=aL.getterFor(wO),b4=aL.set,S4=K1&&K1.prototype,fP=K1,dV=S4,T4=fI.TypeError,X1=fI.document,hV=fI.process,pV=lV.f,cW=pV,zG=!!(X1&&X1.createEvent&&fI.dispatchEvent),fV="unhandledrejection",R4=function(t){var e;return!(!bT(t)||!cV(e=t.then))&&e},A4=function(t,e){var n,a,s,d=e.value,f=e.state==1,m=f?t.ok:t.fail,_=t.resolve,y=t.reject,T=t.domain;try{m?(f||(e.rejection===2&&KG(e),e.rejection=1),m===!0?n=d:(T&&T.enter(),n=m(d),T&&(T.exit(),s=!0)),n===t.promise?y(T4("Promise-chain cycle")):(a=R4(n))?pP(a,n,_,y):_(n)):y(d)}catch(w){T&&!s&&T.exit(),y(w)}},mP=function(t,e){t.notified||(t.notified=!0,HG(function(){for(var n,a=t.reactions;n=a.get();)A4(n,t);t.notified=!1,e&&!t.rejection&&O4(t)}))},C4=function(t,e,n){var a,s;zG?((a=X1.createEvent("Event")).promise=e,a.reason=n,a.initEvent(t,!1,!0),fI.dispatchEvent(a)):a={promise:e,reason:n},!Y1&&(s=fI["on"+t])?s(a):t===fV&&aW("Unhandled promise rejection",n)},O4=function(t){pP(GG,fI,function(){var e,n=t.facade,a=t.value;if(LS(t)&&(e=sW(function(){z1?hV.emit("unhandledRejection",a,n):C4(fV,n,a)}),t.rejection=z1||LS(t)?2:1,e.error))throw e.value})},LS=function(t){return t.rejection!==1&&!t.parent},KG=function(t){pP(GG,fI,function(){var e=t.facade;z1?hV.emit("rejectionHandled",e):C4("rejectionhandled",e,t.value)})},mI=function(t,e,n){return function(a){t(e,a,n)}},lN=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,mP(t,!0))},mV=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw T4("Promise can't be resolved itself");var a=R4(e);a?HG(function(){var s={done:!1};try{pP(a,e,mI(mV,s,t),mI(lN,s,t))}catch(d){lN(s,d,t)}}):(t.value=e,t.state=1,mP(t,!1))}catch(s){lN({done:!1},s,t)}}};eO&&(dV=(fP=function(t){FG(this,dV),y4(t),pP(uN,this);var e=qG(this);try{t(mI(mV,e),mI(lN,e))}catch(n){lN(e,n)}}).prototype,(uN=function(t){b4(this,{type:wO,done:!1,notified:!1,parent:!1,reactions:new uV,rejection:!1,state:0,value:void 0})}).prototype=_4(dV,"then",function(t,e){var n=qG(this),a=pV(oW(this,fP));return n.parent=!0,a.ok=!cV(t)||t,a.fail=cV(e)&&e,a.domain=z1?hV.domain:void 0,n.state==0?n.reactions.add(a):HG(function(){A4(a,n)}),a.promise}),q1=function(){var t=new uN,e=qG(t);this.promise=t,this.resolve=mI(mV,e),this.reject=mI(lN,e)},lV.f=pV=function(t){return t===fP||t===void 0?new q1(t):cW(t)}),g4({global:!0,wrap:!0,forced:eO},{Promise:fP}),v4(fP,wO,!1,!0),sV(wO);var EV=tT("iterator"),EP=!1;try{var gV=0,sL={next:function(){return{done:!!gV++}},return:function(){EP=!0}};sL[EV]=function(){return this},Array.from(sL,function(){throw 2})}catch{}var w4=pI,uW=function(t,e){if(!EP)return!1;var n=!1;try{var a={};a[EV]=function(){return{next:function(){return{done:n=!0}}}},t(a)}catch{}return n},_V=H1.CONSTRUCTOR||!uW(function(t){w4.all(t).then(void 0,function(){})}),I4=q_,N4=hT,vV=OO,pT=CO,WG=$L;SS({target:"Promise",stat:!0,forced:_V},{all:function(t){var e=this,n=vV.f(e),a=n.resolve,s=n.reject,d=pT(function(){var f=N4(e.resolve),m=[],_=0,y=1;WG(t,function(T){var w=_++,L=!1;y++,I4(f,e,T).then(function(B){L||(L=!0,m[w]=B,--y||a(m))},s)}),--y||a(m)});return d.error&&s(d.value),n.promise}});var OR=SS,lW=H1.CONSTRUCTOR;pI&&pI.prototype,OR({target:"Promise",proto:!0,forced:lW,real:!0},{catch:function(t){return this.then(void 0,t)}});var YG=q_,XG=hT,yV=OO,D4=CO,k4=$L;SS({target:"Promise",stat:!0,forced:_V},{race:function(t){var e=this,n=yV.f(e),a=n.reject,s=D4(function(){var d=XG(e.resolve);k4(t,function(f){YG(d,e,f).then(n.resolve,a)})});return s.error&&a(s.value),n.promise}});var JG=q_,ZG=OO;SS({target:"Promise",stat:!0,forced:H1.CONSTRUCTOR},{reject:function(t){var e=ZG.f(this);return JG(e.reject,void 0,t),e.promise}});var dW=nR,L4=SR,hW=OO,QG=function(t,e){if(dW(t),L4(e)&&e.constructor===t)return e;var n=hW.f(t);return(0,n.resolve)(e),n.promise},pW=SS,fW=pI,dN=H1.CONSTRUCTOR,P4=QG,$G=vT("Promise"),mW=!dN;pW({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return P4(mW&&this===$G?fW:this,t)}});var EW=q_,t2=hT,gW=OO,nO=CO,e2=$L;SS({target:"Promise",stat:!0,forced:_V},{allSettled:function(t){var e=this,n=gW.f(e),a=n.resolve,s=n.reject,d=nO(function(){var f=t2(e.resolve),m=[],_=0,y=1;e2(t,function(T){var w=_++,L=!1;y++,EW(f,e,T).then(function(B){L||(L=!0,m[w]={status:"fulfilled",value:B},--y||a(m))},function(B){L||(L=!0,m[w]={status:"rejected",reason:B},--y||a(m))})}),--y||a(m)});return d.error&&s(d.value),n.promise}});var M4=q_,x4=hT,J1=vT,P0=OO,U4=CO,bV=$L,IO="No one promise resolved";SS({target:"Promise",stat:!0,forced:_V},{any:function(t){var e=this,n=J1("AggregateError"),a=P0.f(e),s=a.resolve,d=a.reject,f=U4(function(){var m=x4(e.resolve),_=[],y=0,T=1,w=!1;bV(t,function(L){var B=y++,Q=!1;T++,M4(m,e,L).then(function(X){Q||w||(w=!0,s(X))},function(X){Q||w||(Q=!0,_[B]=X,--T||d(new n(_,IO)))})}),--T||d(new n(_,IO))});return f.error&&d(f.value),a.promise}});var _W=SS,n2=pI,gP=E,j4=vT,vW=e_,yW=qA,V4=QG,bW=n2&&n2.prototype;_W({target:"Promise",proto:!0,real:!0,forced:!!n2&&gP(function(){bW.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=yW(this,j4("Promise")),n=vW(t);return this.then(n?function(a){return V4(e,t()).then(function(){return a})}:t,n?function(a){return V4(e,t()).then(function(){throw a})}:t)}});var r2=K,SW=s1,TW=qR,B4=OL,_P=r2("".charAt),vP=r2("".charCodeAt),F4=r2("".slice),G4=function(t){return function(e,n){var a,s,d=TW(B4(e)),f=SW(n),m=d.length;return f<0||f>=m?t?"":void 0:(a=vP(d,f))<55296||a>56319||f+1===m||(s=vP(d,f+1))<56320||s>57343?t?_P(d,f):a:t?F4(d,f,f+2):s-56320+(a-55296<<10)+65536}},hN={codeAt:G4(!1),charAt:G4(!0)},Z1=hN.charAt,H4=qR,Q1=$0,i2=SG,SV=KU,$1="String Iterator",q4=Q1.set,z4=Q1.getterFor($1);i2(String,"String",function(t){q4(this,{type:$1,string:H4(t),index:0})},function(){var t,e=z4(this),n=e.string,a=e.index;return a>=n.length?SV(void 0,!0):(t=Z1(n,a),e.index+=t.length,SV(t,!1))});var RW=v0.Promise,K4={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},tM=na,AW=Y0,CW=VI,W4=KS,eM=tT("toStringTag");for(var yP in K4){var TV=tM[yP],o2=TV&&TV.prototype;o2&&AW(o2)!==eM&&CW(o2,eM,yP),W4[yP]=W4.Array}var bP=RW,A_=h(bP),Y4=HR("Array").values,X4=Y0,J4=YT,Z4=$,a2=Y4,RV=Array.prototype,AV={DOMTokenList:!0,NodeList:!0},OW=function(t){var e=t.values;return t===RV||Z4(RV,t)&&e===RV.values||J4(AV,X4(t))?a2:e},l0=h(OW),s2=E,c2=tT("iterator"),SP=!s2(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),a="";return t.pathname="c%20d",e.forEach(function(s,d){e.delete("b"),a+=d+s}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[c2]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||a!=="a1c3"||new URL("http://x",void 0).host!=="x"}),u2=YI,Q4=i1,l2=GR,pN=Z_,rO=function(t,e,n){var a=Q4(e);a in t?l2.f(t,a,pN(0,n)):t[a]=n},EI=rU,nM=QO,rM=rO,fN=Array,wW=Math.max,CV=function(t,e,n){for(var a=nM(t),s=EI(e,a),d=EI(n===void 0?a:n,a),f=fN(wW(d-s,0)),m=0;s<d;s++,m++)rM(f,m,t[s]);return f.length=m,f},TP=CV,IW=Math.floor,OV=function(t,e){var n=t.length,a=IW(n/2);return n<8?wV(t,e):$4(t,OV(TP(t,0,a),e),OV(TP(t,a),e),e)},wV=function(t,e){for(var n,a,s=t.length,d=1;d<s;){for(a=d,n=t[d];a&&e(t[a-1],n)>0;)t[a]=t[--a];a!==d++&&(t[a]=n)}return t},$4=function(t,e,n,a){for(var s=e.length,d=n.length,f=0,m=0;f<s||m<d;)t[f+m]=f<s&&m<d?a(e[f],n[m])<=0?e[f++]:n[m++]:f<s?e[f++]:n[m++];return t},tH=OV,RP=SS,gI=na,iM=q_,d0=K,mN=_p,oM=SP,d2=YI,NW=iP,IV=function(t,e,n){for(var a in e)n&&n.unsafe&&t[a]?t[a]=e[a]:u2(t,a,e[a],n);return t},l=bO,p=HU,g=$0,A=ZU,U=e_,q=YT,_o=i0,ba=Y0,wE=nR,p_=SR,R_=qR,x_=aI,m_=Z_,g_=R1,fS=ZL,tS=sP,fT=tH,a_=tT("iterator"),n_="URLSearchParams",d_=n_+"Iterator",L_=g.set,J_=g.getterFor(n_),PS=g.getterFor(d_),_b=Object.getOwnPropertyDescriptor,aS=function(t){if(!mN)return gI[t];var e=_b(gI,t);return e&&e.value},fR=aS("fetch"),HS=aS("Request"),M0=aS("Headers"),h2=HS&&HS.prototype,iX=M0&&M0.prototype,Tat=gI.RegExp,Rat=gI.TypeError,oX=gI.decodeURIComponent,Aat=gI.encodeURIComponent,Cat=d0("".charAt),aX=d0([].join),aM=d0([].push),DW=d0("".replace),Oat=d0([].shift),sX=d0([].splice),cX=d0("".split),wat=d0("".slice),Iat=/\+/g,uX=Array(4),Nat=function(t){return uX[t-1]||(uX[t-1]=Tat("((?:%[\\da-f]{2}){"+t+"})","gi"))},Dat=function(t){try{return oX(t)}catch{return t}},lX=function(t){var e=DW(t,Iat," "),n=4;try{return oX(e)}catch{for(;n;)e=DW(e,Nat(n--),Dat);return e}},kat=/[!'()~]|%20/g,Lat={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Pat=function(t){return Lat[t]},dX=function(t){return DW(Aat(t),kat,Pat)},kW=p(function(t,e){L_(this,{type:d_,iterator:g_(J_(t).entries),kind:e})},"Iterator",function(){var t=PS(this),e=t.kind,n=t.iterator.next(),a=n.value;return n.done||(n.value=e==="keys"?a.key:e==="values"?a.value:[a.key,a.value]),n},!0),hX=function(t){this.entries=[],this.url=null,t!==void 0&&(p_(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Cat(t,0)==="?"?wat(t,1):t:R_(t)))};hX.prototype={type:n_,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,a,s,d,f,m,_=fS(t);if(_)for(n=(e=g_(t,_)).next;!(a=iM(n,e)).done;){if(d=(s=g_(wE(a.value))).next,(f=iM(d,s)).done||(m=iM(d,s)).done||!iM(d,s).done)throw Rat("Expected sequence with length 2");aM(this.entries,{key:R_(f.value),value:R_(m.value)})}else for(var y in t)q(t,y)&&aM(this.entries,{key:y,value:R_(t[y])})},parseQuery:function(t){if(t)for(var e,n,a=cX(t,"&"),s=0;s<a.length;)(e=a[s++]).length&&(n=cX(e,"="),aM(this.entries,{key:lX(Oat(n)),value:lX(aX(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],a=0;a<e.length;)t=e[a++],aM(n,dX(t.key)+"="+dX(t.value));return aX(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var eH=function(){A(this,NV);var t=L_(this,new hX(arguments.length>0?arguments[0]:void 0));mN||(this.size=t.entries.length)},NV=eH.prototype;if(IV(NV,{append:function(t,e){var n=J_(this);tS(arguments.length,2),aM(n.entries,{key:R_(t),value:R_(e)}),mN||this.length++,n.updateURL()},delete:function(t){for(var e=J_(this),n=tS(arguments.length,1),a=e.entries,s=R_(t),d=n<2?void 0:arguments[1],f=d===void 0?d:R_(d),m=0;m<a.length;){var _=a[m];if(_.key!==s||f!==void 0&&_.value!==f)m++;else if(sX(a,m,1),f!==void 0)break}mN||(this.size=a.length),e.updateURL()},get:function(t){var e=J_(this).entries;tS(arguments.length,1);for(var n=R_(t),a=0;a<e.length;a++)if(e[a].key===n)return e[a].value;return null},getAll:function(t){var e=J_(this).entries;tS(arguments.length,1);for(var n=R_(t),a=[],s=0;s<e.length;s++)e[s].key===n&&aM(a,e[s].value);return a},has:function(t){for(var e=J_(this).entries,n=tS(arguments.length,1),a=R_(t),s=n<2?void 0:arguments[1],d=s===void 0?s:R_(s),f=0;f<e.length;){var m=e[f++];if(m.key===a&&(d===void 0||m.value===d))return!0}return!1},set:function(t,e){var n=J_(this);tS(arguments.length,1);for(var a,s=n.entries,d=!1,f=R_(t),m=R_(e),_=0;_<s.length;_++)(a=s[_]).key===f&&(d?sX(s,_--,1):(d=!0,a.value=m));d||aM(s,{key:f,value:m}),mN||(this.size=s.length),n.updateURL()},sort:function(){var t=J_(this);fT(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=J_(this).entries,a=_o(t,arguments.length>1?arguments[1]:void 0),s=0;s<n.length;)a((e=n[s++]).value,e.key,this)},keys:function(){return new kW(this,"keys")},values:function(){return new kW(this,"values")},entries:function(){return new kW(this,"entries")}},{enumerable:!0}),d2(NV,a_,NV.entries,{}),d2(NV,"toString",function(){return J_(this).serialize()},{enumerable:!0}),mN&&NW(NV,"size",{get:function(){return J_(this).entries.length},configurable:!0,enumerable:!0}),l(eH,n_),RP({global:!0,forced:!oM},{URLSearchParams:eH}),!oM&&U(M0)){var Mat=d0(iX.has),xat=d0(iX.set),pX=function(t){if(p_(t)){var e,n=t.body;if(ba(n)===n_)return e=t.headers?new M0(t.headers):new M0,Mat(e,"content-type")||xat(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),x_(t,{body:m_(0,R_(n)),headers:m_(0,e)})}return t};if(U(fR)&&RP({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return fR(t,arguments.length>1?pX(arguments[1]):{})}}),U(HS)){var LW=function(t){return A(this,h2),new HS(t,arguments.length>1?pX(arguments[1]):{})};h2.constructor=LW,LW.prototype=h2,RP({global:!0,dontCallGetSet:!0,forced:!0},{Request:LW})}}var NO,Uat={URLSearchParams:eH,getState:J_},jat=v0.URLSearchParams,fX=_p,Vat=K,Bat=q_,Fat=E,PW=y1,Gat=rR,Hat=_u,qat=EO,zat=YO,DV=Object.assign,mX=Object.defineProperty,Kat=Vat([].concat),Wat=!DV||Fat(function(){if(fX&&DV({b:1},DV(mX({},"a",{enumerable:!0,get:function(){mX(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),a="abcdefghijklmnopqrst";return t[n]=7,a.split("").forEach(function(s){e[s]=s}),DV({},t)[n]!=7||PW(DV({},e)).join("")!=a})?function(t,e){for(var n=qat(t),a=arguments.length,s=1,d=Gat.f,f=Hat.f;a>s;)for(var m,_=zat(arguments[s++]),y=d?Kat(PW(_),d(_)):PW(_),T=y.length,w=0;T>w;)m=y[w++],fX&&!Bat(f,_,m)||(n[m]=_[m]);return n}:DV,Yat=nR,Xat=QL,Jat=i0,Zat=q_,Qat=EO,$at=function(t,e,n,a){try{return a?e(Yat(n)[0],n[1]):e(n)}catch(s){Xat(t,"throw",s)}},tst=WI,est=aP,nst=QO,EX=rO,rst=R1,ist=ZL,gX=Array,sM=K,MW=2147483647,ost=/[^\0-\u007E]/,_X=/[.\u3002\uFF0E\uFF61]/g,vX="Overflow: input needs wider integers to process",yX=RangeError,ast=sM(_X.exec),kV=Math.floor,xW=String.fromCharCode,bX=sM("".charCodeAt),SX=sM([].join),AP=sM([].push),sst=sM("".replace),cst=sM("".split),ust=sM("".toLowerCase),TX=function(t){return t+22+75*(t<26)},lst=function(t,e,n){var a=0;for(t=n?kV(t/700):t>>1,t+=kV(t/e);t>455;)t=kV(t/35),a+=36;return kV(a+36*t/(t+38))},dst=function(t){var e=[];t=function(_n){for(var _r=[],ya=0,_l=_n.length;ya<_l;){var _d=bX(_n,ya++);if(_d>=55296&&_d<=56319&&ya<_l){var tu=bX(_n,ya++);(64512&tu)==56320?AP(_r,((1023&_d)<<10)+(1023&tu)+65536):(AP(_r,_d),ya--)}else AP(_r,_d)}return _r}(t);var n,a,s=t.length,d=128,f=0,m=72;for(n=0;n<t.length;n++)(a=t[n])<128&&AP(e,xW(a));var _=e.length,y=_;for(_&&AP(e,"-");y<s;){var T=MW;for(n=0;n<t.length;n++)(a=t[n])>=d&&a<T&&(T=a);var w=y+1;if(T-d>kV((MW-f)/w))throw yX(vX);for(f+=(T-d)*w,d=T,n=0;n<t.length;n++){if((a=t[n])<d&&++f>MW)throw yX(vX);if(a==d){for(var L=f,B=36;;){var Q=B<=m?1:B>=m+26?26:B-m;if(L<Q)break;var X=L-Q,J=36-Q;AP(e,xW(TX(Q+X%J))),L=kV(X/J),B+=36}AP(e,xW(TX(L))),m=lst(f,w,y==_),f=0,y++}}f++,d++}return SX(e,"")},hst=SS,UW=_p,pst=SP,jW=na,RX=i0,DO=K,nH=YI,kO=iP,fst=ZU,VW=YT,BW=Wat,LV=function(t){var e=Qat(t),n=est(this),a=arguments.length,s=a>1?arguments[1]:void 0,d=s!==void 0;d&&(s=Jat(s,a>2?arguments[2]:void 0));var f,m,_,y,T,w,L=ist(e),B=0;if(!L||this===gX&&tst(L))for(f=nst(e),m=n?new this(f):gX(f);f>B;B++)w=d?s(e[B],B):e[B],EX(m,B,w);else for(T=(y=rst(e,L)).next,m=n?new this:[];!(_=Zat(T,y)).done;B++)w=d?$at(y,s,[_.value,B],!0):_.value,EX(m,B,w);return m.length=B,m},_I=CV,mst=hN.codeAt,Est=function(t){var e,n,a=[],s=cst(sst(ust(t),_X,"."),".");for(e=0;e<s.length;e++)n=s[e],AP(a,ast(ost,n)?"xn--"+dst(n):n);return SX(a,".")},cL=qR,gst=bO,_st=sP,AX=Uat,CX=$0,vst=CX.set,rH=CX.getterFor("URL"),yst=AX.URLSearchParams,bst=AX.getState,p2=jW.URL,FW=jW.TypeError,iH=jW.parseInt,Sst=Math.floor,OX=Math.pow,LO=DO("".charAt),vI=DO(/./.exec),f2=DO([].join),Tst=DO(1 .toString),Rst=DO([].pop),PV=DO([].push),GW=DO("".replace),Ast=DO([].shift),Cst=DO("".split),m2=DO("".slice),oH=DO("".toLowerCase),Ost=DO([].unshift),HW="Invalid scheme",cM="Invalid host",wX="Invalid port",IX=/[a-z]/i,wst=/[\d+-.a-z]/i,qW=/\d/,Ist=/^0x/i,Nst=/^[0-7]+$/,Dst=/^\d+$/,NX=/^[\da-f]+$/i,kst=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Lst=/[\0\t\n\r #/:<>?@[\\\]^|]/,Pst=/^[\u0000-\u0020]+/,Mst=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,xst=/[\t\n\r]/g,E2=function(t){var e,n,a,s;if(typeof t=="number"){for(e=[],n=0;n<4;n++)Ost(e,t%256),t=Sst(t/256);return f2(e,".")}if(typeof t=="object"){for(e="",a=function(d){for(var f=null,m=1,_=null,y=0,T=0;T<8;T++)d[T]!==0?(y>m&&(f=_,m=y),_=null,y=0):(_===null&&(_=T),++y);return y>m&&(f=_,m=y),f}(t),n=0;n<8;n++)s&&t[n]===0||(s&&(s=!1),a===n?(e+=n?":":"::",s=!0):(e+=Tst(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},aH={},DX=BW({},aH,{" ":1,'"':1,"<":1,">":1,"`":1}),kX=BW({},DX,{"#":1,"?":1,"{":1,"}":1}),zW=BW({},kX,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),CP=function(t,e){var n=mst(t,0);return n>32&&n<127&&!VW(e,t)?t:encodeURIComponent(t)},sH={ftp:21,file:null,http:80,https:443,ws:80,wss:443},g2=function(t,e){var n;return t.length==2&&vI(IX,LO(t,0))&&((n=LO(t,1))==":"||!e&&n=="|")},LX=function(t){var e;return t.length>1&&g2(m2(t,0,2))&&(t.length==2||(e=LO(t,2))==="/"||e==="\\"||e==="?"||e==="#")},Ust=function(t){return t==="."||oH(t)==="%2e"},KW={},PX={},WW={},MX={},xX={},YW={},UX={},jX={},cH={},uH={},XW={},JW={},ZW={},QW={},VX={},$W={},MV={},EN={},BX={},uM={},uL={},tY=function(t,e,n){var a,s,d,f=cL(t);if(e){if(s=this.parse(f))throw FW(s);this.searchParams=null}else{if(n!==void 0&&(a=new tY(n,!0)),s=this.parse(f,null,a))throw FW(s);(d=bst(new yst)).bindURL(this),this.searchParams=d}};tY.prototype={type:"URL",parse:function(t,e,n){var a,s,d,f,m,_=this,y=e||KW,T=0,w="",L=!1,B=!1,Q=!1;for(t=cL(t),e||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,t=GW(t,Pst,""),t=GW(t,Mst,"$1")),t=GW(t,xst,""),a=LV(t);T<=a.length;){switch(s=a[T],y){case KW:if(!s||!vI(IX,s)){if(e)return HW;y=WW;continue}w+=oH(s),y=PX;break;case PX:if(s&&(vI(wst,s)||s=="+"||s=="-"||s=="."))w+=oH(s);else{if(s!=":"){if(e)return HW;w="",y=WW,T=0;continue}if(e&&(_.isSpecial()!=VW(sH,w)||w=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=w,e)return void(_.isSpecial()&&sH[_.scheme]==_.port&&(_.port=null));w="",_.scheme=="file"?y=QW:_.isSpecial()&&n&&n.scheme==_.scheme?y=MX:_.isSpecial()?y=jX:a[T+1]=="/"?(y=xX,T++):(_.cannotBeABaseURL=!0,PV(_.path,""),y=BX)}break;case WW:if(!n||n.cannotBeABaseURL&&s!="#")return HW;if(n.cannotBeABaseURL&&s=="#"){_.scheme=n.scheme,_.path=_I(n.path),_.query=n.query,_.fragment="",_.cannotBeABaseURL=!0,y=uL;break}y=n.scheme=="file"?QW:YW;continue;case MX:if(s!="/"||a[T+1]!="/"){y=YW;continue}y=cH,T++;break;case xX:if(s=="/"){y=uH;break}y=EN;continue;case YW:if(_.scheme=n.scheme,s==NO)_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=_I(n.path),_.query=n.query;else if(s=="/"||s=="\\"&&_.isSpecial())y=UX;else if(s=="?")_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=_I(n.path),_.query="",y=uM;else{if(s!="#"){_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=_I(n.path),_.path.length--,y=EN;continue}_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,_.path=_I(n.path),_.query=n.query,_.fragment="",y=uL}break;case UX:if(!_.isSpecial()||s!="/"&&s!="\\"){if(s!="/"){_.username=n.username,_.password=n.password,_.host=n.host,_.port=n.port,y=EN;continue}y=uH}else y=cH;break;case jX:if(y=cH,s!="/"||LO(w,T+1)!="/")continue;T++;break;case cH:if(s!="/"&&s!="\\"){y=uH;continue}break;case uH:if(s=="@"){L&&(w="%40"+w),L=!0,d=LV(w);for(var X=0;X<d.length;X++){var J=d[X];if(J!=":"||Q){var _n=CP(J,zW);Q?_.password+=_n:_.username+=_n}else Q=!0}w=""}else if(s==NO||s=="/"||s=="?"||s=="#"||s=="\\"&&_.isSpecial()){if(L&&w=="")return"Invalid authority";T-=LV(w).length+1,w="",y=XW}else w+=s;break;case XW:case JW:if(e&&_.scheme=="file"){y=$W;continue}if(s!=":"||B){if(s==NO||s=="/"||s=="?"||s=="#"||s=="\\"&&_.isSpecial()){if(_.isSpecial()&&w=="")return cM;if(e&&w==""&&(_.includesCredentials()||_.port!==null))return;if(f=_.parseHost(w))return f;if(w="",y=MV,e)return;continue}s=="["?B=!0:s=="]"&&(B=!1),w+=s}else{if(w=="")return cM;if(f=_.parseHost(w))return f;if(w="",y=ZW,e==JW)return}break;case ZW:if(!vI(qW,s)){if(s==NO||s=="/"||s=="?"||s=="#"||s=="\\"&&_.isSpecial()||e){if(w!=""){var _r=iH(w,10);if(_r>65535)return wX;_.port=_.isSpecial()&&_r===sH[_.scheme]?null:_r,w=""}if(e)return;y=MV;continue}return wX}w+=s;break;case QW:if(_.scheme="file",s=="/"||s=="\\")y=VX;else{if(!n||n.scheme!="file"){y=EN;continue}if(s==NO)_.host=n.host,_.path=_I(n.path),_.query=n.query;else if(s=="?")_.host=n.host,_.path=_I(n.path),_.query="",y=uM;else{if(s!="#"){LX(f2(_I(a,T),""))||(_.host=n.host,_.path=_I(n.path),_.shortenPath()),y=EN;continue}_.host=n.host,_.path=_I(n.path),_.query=n.query,_.fragment="",y=uL}}break;case VX:if(s=="/"||s=="\\"){y=$W;break}n&&n.scheme=="file"&&!LX(f2(_I(a,T),""))&&(g2(n.path[0],!0)?PV(_.path,n.path[0]):_.host=n.host),y=EN;continue;case $W:if(s==NO||s=="/"||s=="\\"||s=="?"||s=="#"){if(!e&&g2(w))y=EN;else if(w==""){if(_.host="",e)return;y=MV}else{if(f=_.parseHost(w))return f;if(_.host=="localhost"&&(_.host=""),e)return;w="",y=MV}continue}w+=s;break;case MV:if(_.isSpecial()){if(y=EN,s!="/"&&s!="\\")continue}else if(e||s!="?")if(e||s!="#"){if(s!=NO&&(y=EN,s!="/"))continue}else _.fragment="",y=uL;else _.query="",y=uM;break;case EN:if(s==NO||s=="/"||s=="\\"&&_.isSpecial()||!e&&(s=="?"||s=="#")){if((m=oH(m=w))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),s=="/"||s=="\\"&&_.isSpecial()||PV(_.path,"")):Ust(w)?s=="/"||s=="\\"&&_.isSpecial()||PV(_.path,""):(_.scheme=="file"&&!_.path.length&&g2(w)&&(_.host&&(_.host=""),w=LO(w,0)+":"),PV(_.path,w)),w="",_.scheme=="file"&&(s==NO||s=="?"||s=="#"))for(;_.path.length>1&&_.path[0]==="";)Ast(_.path);s=="?"?(_.query="",y=uM):s=="#"&&(_.fragment="",y=uL)}else w+=CP(s,kX);break;case BX:s=="?"?(_.query="",y=uM):s=="#"?(_.fragment="",y=uL):s!=NO&&(_.path[0]+=CP(s,aH));break;case uM:e||s!="#"?s!=NO&&(s=="'"&&_.isSpecial()?_.query+="%27":_.query+=s=="#"?"%23":CP(s,aH)):(_.fragment="",y=uL);break;case uL:s!=NO&&(_.fragment+=CP(s,DX))}T++}},parseHost:function(t){var e,n,a;if(LO(t,0)=="["){if(LO(t,t.length-1)!="]"||(e=function(s){var d,f,m,_,y,T,w,L=[0,0,0,0,0,0,0,0],B=0,Q=null,X=0,J=function(){return LO(s,X)};if(J()==":"){if(LO(s,1)!=":")return;X+=2,Q=++B}for(;J();){if(B==8)return;if(J()!=":"){for(d=f=0;f<4&&vI(NX,J());)d=16*d+iH(J(),16),X++,f++;if(J()=="."){if(f==0||(X-=f,B>6))return;for(m=0;J();){if(_=null,m>0){if(!(J()=="."&&m<4))return;X++}if(!vI(qW,J()))return;for(;vI(qW,J());){if(y=iH(J(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;X++}L[B]=256*L[B]+_,++m!=2&&m!=4||B++}if(m!=4)return;break}if(J()==":"){if(X++,!J())return}else if(J())return;L[B++]=d}else{if(Q!==null)return;X++,Q=++B}}if(Q!==null)for(T=B-Q,B=7;B!=0&&T>0;)w=L[B],L[B--]=L[Q+T-1],L[Q+--T]=w;else if(B!=8)return;return L}(m2(t,1,-1)),!e))return cM;this.host=e}else if(this.isSpecial()){if(t=Est(t),vI(kst,t)||(e=function(s){var d,f,m,_,y,T,w,L=Cst(s,".");if(L.length&&L[L.length-1]==""&&L.length--,(d=L.length)>4)return s;for(f=[],m=0;m<d;m++){if((_=L[m])=="")return s;if(y=10,_.length>1&&LO(_,0)=="0"&&(y=vI(Ist,_)?16:8,_=m2(_,y==8?1:2)),_==="")T=0;else{if(!vI(y==10?Dst:y==8?Nst:NX,_))return s;T=iH(_,y)}PV(f,T)}for(m=0;m<d;m++)if(T=f[m],m==d-1){if(T>=OX(256,5-d))return null}else if(T>255)return null;for(w=Rst(f),m=0;m<f.length;m++)w+=f[m]*OX(256,3-m);return w}(t),e===null))return cM;this.host=e}else{if(vI(Lst,t))return cM;for(e="",n=LV(t),a=0;a<n.length;a++)e+=CP(n[a],aH);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return VW(sH,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&g2(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,a=t.password,s=t.host,d=t.port,f=t.path,m=t.query,_=t.fragment,y=e+":";return s!==null?(y+="//",t.includesCredentials()&&(y+=n+(a?":"+a:"")+"@"),y+=E2(s),d!==null&&(y+=":"+d)):e=="file"&&(y+="//"),y+=t.cannotBeABaseURL?f[0]:f.length?"/"+f2(f,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(t){var e=this.parse(t);if(e)throw FW(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new xV(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+E2(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(cL(t)+":",KW)},getUsername:function(){return this.username},setUsername:function(t){var e=LV(cL(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=CP(e[n],zW)}},getPassword:function(){return this.password},setPassword:function(t){var e=LV(cL(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=CP(e[n],zW)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?E2(t):E2(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,XW)},getHostname:function(){var t=this.host;return t===null?"":E2(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,JW)},getPort:function(){var t=this.port;return t===null?"":cL(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=cL(t))==""?this.port=null:this.parse(t,ZW))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+f2(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,MV))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=cL(t))==""?this.query=null:(LO(t,0)=="?"&&(t=m2(t,1)),this.query="",this.parse(t,uM)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=cL(t))!=""?(LO(t,0)=="#"&&(t=m2(t,1)),this.fragment="",this.parse(t,uL)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var xV=function(t){var e=fst(this,C0),n=_st(arguments.length,1)>1?arguments[1]:void 0,a=vst(e,new tY(t,!1,n));UW||(e.href=a.serialize(),e.origin=a.getOrigin(),e.protocol=a.getProtocol(),e.username=a.getUsername(),e.password=a.getPassword(),e.host=a.getHost(),e.hostname=a.getHostname(),e.port=a.getPort(),e.pathname=a.getPathname(),e.search=a.getSearch(),e.searchParams=a.getSearchParams(),e.hash=a.getHash())},C0=xV.prototype,PO=function(t,e){return{get:function(){return rH(this)[t]()},set:e&&function(n){return rH(this)[e](n)},configurable:!0,enumerable:!0}};if(UW&&(kO(C0,"href",PO("serialize","setHref")),kO(C0,"origin",PO("getOrigin")),kO(C0,"protocol",PO("getProtocol","setProtocol")),kO(C0,"username",PO("getUsername","setUsername")),kO(C0,"password",PO("getPassword","setPassword")),kO(C0,"host",PO("getHost","setHost")),kO(C0,"hostname",PO("getHostname","setHostname")),kO(C0,"port",PO("getPort","setPort")),kO(C0,"pathname",PO("getPathname","setPathname")),kO(C0,"search",PO("getSearch","setSearch")),kO(C0,"searchParams",PO("getSearchParams")),kO(C0,"hash",PO("getHash","setHash"))),nH(C0,"toJSON",function(){return rH(this).serialize()},{enumerable:!0}),nH(C0,"toString",function(){return rH(this).serialize()},{enumerable:!0}),p2){var FX=p2.createObjectURL,GX=p2.revokeObjectURL;FX&&nH(xV,"createObjectURL",RX(FX,p2)),GX&&nH(xV,"revokeObjectURL",RX(GX,p2))}gst(xV,"URL"),hst({global:!0,forced:!pst,sham:!UW},{URL:xV});var jst=SS,Vst=E,Bst=sP,HX=qR,Fst=SP,qX=vT("URL");jst({target:"URL",stat:!0,forced:!(Fst&&Vst(function(){qX.canParse()}))},{canParse:function(t){var e=Bst(arguments.length,1),n=HX(t),a=e<2||arguments[1]===void 0?void 0:HX(arguments[1]);try{return!!new qX(n,a)}catch{return!1}}});var lH=h(v0.URL);let zX=!0,KX=!0;function dH(t,e,n){const a=t.match(e);return a&&a.length>=n&&parseInt(a[n],10)}function lM(t,e,n){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,s=a.addEventListener;a.addEventListener=function(f,m){if(f!==e)return s.apply(this,arguments);const _=y=>{const T=n(y);T&&(m.handleEvent?m.handleEvent(T):m(T))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(m,_),s.apply(this,[f,_])};const d=a.removeEventListener;a.removeEventListener=function(f,m){if(f!==e||!this._eventMap||!this._eventMap[e])return d.apply(this,arguments);if(!this._eventMap[e].has(m))return d.apply(this,arguments);const _=this._eventMap[e].get(m);return this._eventMap[e].delete(m),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[f,_])},Object.defineProperty(a,"on"+e,{get(){return this["_on"+e]},set(f){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),f&&this.addEventListener(e,this["_on"+e]=f)},enumerable:!0,configurable:!0})}function Gst(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(zX=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Hst(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(KX=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function WX(){if(typeof window=="object"){if(zX)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function eY(t,e){KX&&console.warn(t+" is deprecated, please use "+e+" instead.")}function YX(t){return Object.prototype.toString.call(t)==="[object Object]"}function XX(t){var e;return YX(t)?LR(e=Object.keys(t)).call(e,function(n,a){const s=YX(t[a]),d=s?XX(t[a]):t[a],f=s&&!Object.keys(d).length;return d===void 0||f?n:Object.assign(n,{[a]:d})},{}):t}function nY(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(a=>{a.endsWith("Id")?nY(t,t.get(e[a]),n):a.endsWith("Ids")&&e[a].forEach(s=>{nY(t,t.get(s),n)})}))}function JX(t,e,n){const a=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const d=[];return t.forEach(f=>{f.type==="track"&&f.trackIdentifier===e.id&&d.push(f)}),d.forEach(f=>{t.forEach(m=>{m.type===a&&m.trackId===f.id&&nY(t,m,s)})}),s}const ZX=WX;function QX(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const a=function(f){if(typeof f!="object"||f.mandatory||f.optional)return f;const m={};return Object.keys(f).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof f[_]=="object"?f[_]:{ideal:f[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const T=function(w,L){return w?w+L.charAt(0).toUpperCase()+L.slice(1):L==="deviceId"?"sourceId":L};if(y.ideal!==void 0){m.optional=m.optional||[];let w={};typeof y.ideal=="number"?(w[T("min",_)]=y.ideal,m.optional.push(w),w={},w[T("max",_)]=y.ideal,m.optional.push(w)):(w[T("",_)]=y.ideal,m.optional.push(w))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[T("",_)]=y.exact):["min","max"].forEach(w=>{y[w]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[T(w,_)]=y[w])})}),f.advanced&&(m.optional=(m.optional||[]).concat(f.advanced)),m},s=function(f,m){if(e.version>=61)return m(f);if((f=JSON.parse(JSON.stringify(f)))&&typeof f.audio=="object"){const _=function(y,T,w){T in y&&!(w in y)&&(y[w]=y[T],delete y[T])};_((f=JSON.parse(JSON.stringify(f))).audio,"autoGainControl","googAutoGainControl"),_(f.audio,"noiseSuppression","googNoiseSuppression"),f.audio=a(f.audio)}if(f&&typeof f.video=="object"){let _=f.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=e.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||y)){let T;if(delete f.video.facingMode,_.exact==="environment"||_.ideal==="environment"?T=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(T=["front"]),T)return n.mediaDevices.enumerateDevices().then(w=>{let L=(w=w.filter(B=>B.kind==="videoinput")).find(B=>T.some(Q=>{var X;return T_(X=B.label.toLowerCase()).call(X,Q)}));return!L&&w.length&&T_(T).call(T,"back")&&(L=w[w.length-1]),L&&(f.video.deviceId=_.exact?{exact:L.deviceId}:{ideal:L.deviceId}),f.video=a(f.video),ZX("chrome: "+JSON.stringify(f)),m(f)})}f.video=a(f.video)}return ZX("chrome: "+JSON.stringify(f)),m(f)},d=function(f){return e.version>=64?f:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[f.name]||f.name,message:f.message,constraint:f.constraint||f.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(f,m,_){s(f,y=>{n.webkitGetUserMedia(y,m,T=>{_&&_(d(T))})})}).bind(n),n.mediaDevices.getUserMedia){const f=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(m){return s(m,_=>f(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(T=>{T.stop()}),new DOMException("","NotFoundError");return y},y=>A_.reject(d(y))))}}}function $X(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function tJ(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",a=>{let s;s=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=s,d.transceiver={receiver:s},d.streams=[n.stream],this.dispatchEvent(d)}),n.stream.getTracks().forEach(a=>{let s;s=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(f=>f.track&&f.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=s,d.transceiver={receiver:s},d.streams=[n.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else lM(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function eJ(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=s.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(f,m){let _=s.apply(this,arguments);return _||(_=e(this,f),this._senders.push(_)),_};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(f){d.apply(this,arguments);const m=this._senders.indexOf(f);m!==-1&&this._senders.splice(m,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(d=>{this._senders.push(e(this,d))})};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],a.apply(this,[s]),s.getTracks().forEach(d=>{const f=this._senders.find(m=>m.track===d);f&&this._senders.splice(this._senders.indexOf(f),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(a=>a._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function nJ(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,a,s]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const d=function(m){const _={};return m.result().forEach(y=>{const T={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(w=>{T[w]=y.stat(w)}),_[T.id]=T}),_},f=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){a(f(d(_)))};return e.apply(this,[m,n])}return new A_((m,_)=>{e.apply(this,[function(y){m(f(d(y)))},_])}).then(a,s)}}function rJ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(d=>d._pc=this),s});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=a.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(d=>JX(d,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=n.apply(this,[]);return a.forEach(s=>s._pc=this),a}),lM(t,"track",a=>(a.receiver._pc=a.srcElement,a)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(s=>JX(s,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let a,s,d;return this.getSenders().forEach(f=>{f.track===n&&(a?d=!0:a=f)}),this.getReceivers().forEach(f=>(f.track===n&&(s?d=!0:s=f),f.track===n)),d||a&&s?A_.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():s?s.getStats():A_.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function iJ(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,f){if(!f)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=e.apply(this,arguments);return this._shimmedLocalStreams[f.id]?this._shimmedLocalStreams[f.id].indexOf(m)===-1&&this._shimmedLocalStreams[f.id].push(m):this._shimmedLocalStreams[f.id]=[f,m],m};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(_=>{if(this.getSenders().find(T=>T.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const f=this.getSenders();n.apply(this,arguments);const m=this.getSenders().filter(_=>f.indexOf(_)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(f=>{const m=this._shimmedLocalStreams[f].indexOf(d);m!==-1&&this._shimmedLocalStreams[f].splice(m,1),this._shimmedLocalStreams[f].length===1&&delete this._shimmedLocalStreams[f]}),s.apply(this,arguments)}}function oJ(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return iJ(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const _=n.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(w=>w.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new t.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}a.apply(this,[_])};const s=t.RTCPeerConnection.prototype.removeStream;function d(_,y){let T=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const L=_._reverseStreams[w],B=_._streams[L.id];T=T.replace(new RegExp(B.id,"g"),L.id)}),new RTCSessionDescription({type:y.type,sdp:T})}t.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},t.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const T=[].slice.call(arguments,1);if(T.length!==1||!T[0].getTracks().find(B=>B===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(B=>B.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const L=this._streams[y.id];if(L)L.addTrack(_),A_.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const B=new t.MediaStream([_]);this._streams[y.id]=B,this._reverseStreams[B.id]=y,this.addStream(B)}return this.getSenders().find(B=>B.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=t.RTCPeerConnection.prototype[_],T={[_](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[L=>{const B=d(this,L);w[0].apply(null,[B])},L=>{w[1]&&w[1].apply(null,L)},arguments[2]]):y.apply(this,arguments).then(L=>d(this,L))}};t.RTCPeerConnection.prototype[_]=T[_]});const f=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let T=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const L=_._reverseStreams[w],B=_._streams[L.id];T=T.replace(new RegExp(L.id,"g"),B.id)}),new RTCSessionDescription({type:y.type,sdp:T})}(this,arguments[0]),f.apply(this,arguments)):f.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:d(this,_)}}),t.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(T=>{this._streams[T].getTracks().find(w=>_.track===w)&&(y=this._streams[T])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function rY(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const a=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function aJ(t,e){lM(t,"negotiationneeded",n=>{const a=n.target;if(!(e.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return n})}var sJ=Object.freeze({__proto__:null,fixNegotiationNeeded:aJ,shimAddTrackRemoveTrack:oJ,shimAddTrackRemoveTrackWithNative:iJ,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(a=>{const s=n.video&&n.video.width,d=n.video&&n.video.height,f=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:f||3}},s&&(n.video.mandatory.maxWidth=s),d&&(n.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:eJ,shimGetStats:nJ,shimGetUserMedia:QX,shimMediaStream:$X,shimOnTrack:tJ,shimPeerConnection:rY,shimSenderReceiverGetStats:rJ});function cJ(t,e){const n=t&&t.navigator,a=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,d,f){eY("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(d,f)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(f,m,_){m in f&&!(_ in f)&&(f[_]=f[m],delete f[m])},d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(f){return typeof f=="object"&&typeof f.audio=="object"&&(f=JSON.parse(JSON.stringify(f)),s(f.audio,"autoGainControl","mozAutoGainControl"),s(f.audio,"noiseSuppression","mozNoiseSuppression")),d(f)},a&&a.prototype.getSettings){const f=a.prototype.getSettings;a.prototype.getSettings=function(){const m=f.apply(this,arguments);return s(m,"mozAutoGainControl","autoGainControl"),s(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const f=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),s(m,"autoGainControl","mozAutoGainControl"),s(m,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[m])}}}}function uJ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function iY(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const d=t.RTCPeerConnection.prototype[s],f={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=f[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,d,f]=arguments;return a.apply(this,[s||null]).then(m=>{if(e.version<53&&!d)try{m.forEach(_=>{_.type=n[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,T)=>{m.set(T,Object.assign({},y,{type:n[y.type]||y.type}))})}return m}).then(d,f)}}function lJ(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(s=>s._pc=this),a});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):A_.resolve(new Map)}}function dJ(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(a=>a._pc=this),n}),lM(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function hJ(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){eY("removeStream","removeTrack"),this.getSenders().forEach(n=>{var a;n.track&&T_(a=e.getTracks()).call(a,n.track)&&this.removeTrack(n)})})}function pJ(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function fJ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const a=n.length>0;a&&n.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(a){const{sender:d}=s,f=d.getParameters();(!("encodings"in f)||f.encodings.length===1&&Object.keys(f.encodings[0]).length===0)&&(f.encodings=n,d.sendEncodings=n,this.setParametersPromises.push(d.setParameters(f).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return s})}function mJ(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function EJ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?A_.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function gJ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?A_.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var _J=Object.freeze({__proto__:null,shimAddTransceiver:fJ,shimCreateAnswer:gJ,shimCreateOffer:EJ,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,A_.reject(a)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:mJ,shimGetUserMedia:cJ,shimOnTrack:uJ,shimPeerConnection:iY,shimRTCDataChannel:pJ,shimReceiverGetStats:dJ,shimRemoveStream:hJ,shimSenderGetStats:lJ});function vJ(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var a;this._localStreams||(this._localStreams=[]),T_(a=this._localStreams).call(a,n)||this._localStreams.push(n),n.getAudioTracks().forEach(s=>e.call(this,s,n)),n.getVideoTracks().forEach(s=>e.call(this,s,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var a=arguments.length,s=new Array(a>1?a-1:0),d=1;d<a;d++)s[d-1]=arguments[d];return s&&s.forEach(f=>{var m;this._localStreams?T_(m=this._localStreams).call(m,f)||this._localStreams.push(f):this._localStreams=[f]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const a=e.getTracks();this.getSenders().forEach(s=>{T_(a).call(a,s.track)&&this.removeTrack(s)})})}}function yJ(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(s=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),T_(d=this._remoteStreams).call(d,s))return;this._remoteStreams.push(s);const f=new Event("addstream");f.stream=s,this.dispatchEvent(f)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const d=new Event("addstream");d.stream=s,n.dispatchEvent(d)})}),e.apply(n,arguments)}}}function bJ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,a=e.createAnswer,s=e.setLocalDescription,d=e.setRemoteDescription,f=e.addIceCandidate;e.createOffer=function(_,y){const T=arguments.length>=2?arguments[2]:arguments[0],w=n.apply(this,[T]);return y?(w.then(_,y),A_.resolve()):w},e.createAnswer=function(_,y){const T=arguments.length>=2?arguments[2]:arguments[0],w=a.apply(this,[T]);return y?(w.then(_,y),A_.resolve()):w};let m=function(_,y,T){const w=s.apply(this,[_]);return T?(w.then(y,T),A_.resolve()):w};e.setLocalDescription=m,m=function(_,y,T){const w=d.apply(this,[_]);return T?(w.then(y,T),A_.resolve()):w},e.setRemoteDescription=m,m=function(_,y,T){const w=f.apply(this,[_]);return T?(w.then(y,T),A_.resolve()):w},e.addIceCandidate=m}function SJ(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,a=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>a(TJ(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,a,s){e.mediaDevices.getUserMedia(n).then(a,s)}).bind(e))}function TJ(t){return t&&t.video!==void 0?Object.assign({},t,{video:XX(t.video)}):t}function RJ(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,a){if(n&&n.iceServers){const s=[];for(let d=0;d<n.iceServers.length;d++){let f=n.iceServers[d];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(eY("RTCIceServer.url","RTCIceServer.urls"),f=JSON.parse(JSON.stringify(f)),f.urls=f.url,delete f.url,s.push(f)):s.push(n.iceServers[d])}n.iceServers=s}return new e(n,a)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function AJ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function CJ(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(d=>d.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function OJ(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var wJ=Object.freeze({__proto__:null,shimAudioContext:OJ,shimCallbacksAPI:bJ,shimConstraints:TJ,shimCreateOfferLegacy:CJ,shimGetUserMedia:SJ,shimLocalStreamsAPI:vJ,shimRTCIceServerUrls:RJ,shimRemoteStreamsAPI:yJ,shimTrackEventTransceiver:AJ}),IJ=`	
\v\f\r                　\u2028\u2029\uFEFF`,qst=OL,zst=qR,oY=IJ,NJ=K("".replace),Kst=RegExp("^["+oY+"]+"),Wst=RegExp("(^|[^"+oY+"])["+oY+"]+$"),Yst=function(t){return function(e){var n=zst(qst(e));return 1&t&&(n=NJ(n,Kst,"")),2&t&&(n=NJ(n,Wst,"$1")),n}},Xst={trim:Yst(3)},Jst=gG.PROPER,Zst=E,DJ=IJ,Qst=Xst.trim;SS({target:"String",proto:!0,forced:function(t){return Zst(function(){return!!DJ[t]()||"​᠎"[t]()!=="​᠎"||Jst&&DJ[t].name!==t})}("trim")},{trim:function(){return Qst(this)}});var $st=HR("String").trim,tct=$,ect=$st,aY=String.prototype,nct=function(t){var e=t.trim;return typeof t=="string"||t===aY||tct(aY,t)&&e===aY.trim?ect:e},wR=h(nct),kJ={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(a=>a.trim())},e.splitSections=function(n){return n.split(`
m=`).map((a,s)=>(s>0?"m="+a:a).trim()+`\r
`)},e.getDescription=function(n){const a=e.splitSections(n);return a&&a[0]},e.getMediaSections=function(n){const a=e.splitSections(n);return a.shift(),a},e.matchPrefix=function(n,a){return e.splitLines(n).filter(s=>s.indexOf(a)===0)},e.parseCandidate=function(n){let a;a=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const s={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":s.relatedAddress=a[d+1];break;case"rport":s.relatedPort=parseInt(a[d+1],10);break;case"tcptype":s.tcpType=a[d+1];break;case"ufrag":s.ufrag=a[d+1],s.usernameFragment=a[d+1];break;default:s[a[d]]===void 0&&(s[a[d]]=a[d+1])}return s},e.writeCandidate=function(n){const a=[];a.push(n.foundation);const s=n.component;s==="rtp"?a.push(1):s==="rtcp"?a.push(2):a.push(s),a.push(n.protocol.toUpperCase()),a.push(n.priority),a.push(n.address||n.ip),a.push(n.port);const d=n.type;return a.push("typ"),a.push(d),d!=="host"&&n.relatedAddress&&n.relatedPort&&(a.push("raddr"),a.push(n.relatedAddress),a.push("rport"),a.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(a.push("ufrag"),a.push(n.usernameFragment||n.ufrag)),"candidate:"+a.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let a=n.substring(9).split(" ");const s={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),s.name=a[0],s.clockRate=parseInt(a[1],10),s.channels=a.length===3?parseInt(a[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let a=n.payloadType;n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+a+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const a=n.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const a={};let s;const d=n.substring(n.indexOf(" ")+1).split(";");for(let f=0;f<d.length;f++)s=d[f].trim().split("="),a[s[0].trim()]=s[1];return a},e.writeFmtp=function(n){let a="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const d=[];Object.keys(n.parameters).forEach(f=>{n.parameters[f]!==void 0?d.push(f+"="+n.parameters[f]):d.push(f)}),a+="a=fmtp:"+s+" "+d.join(";")+`\r
`}return a},e.parseRtcpFb=function(n){const a=n.substring(n.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},e.writeRtcpFb=function(n){let a="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+s+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},e.parseSsrcMedia=function(n){const a=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,a),10)},d=n.indexOf(":",a);return d>-1?(s.attribute=n.substring(a+1,d),s.value=n.substring(d+1)):s.attribute=n.substring(a+1),s},e.parseSsrcGroup=function(n){const a=n.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(s=>parseInt(s,10))}},e.getMid=function(n){const a=e.matchPrefix(n,"a=mid:")[0];if(a)return a.substring(6)},e.parseFingerprint=function(n){const a=n.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},e.getDtlsParameters=function(n,a){return{role:"auto",fingerprints:e.matchPrefix(n+a,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,a){let s="a=setup:"+a+`\r
`;return n.fingerprints.forEach(d=>{s+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),s},e.parseCryptoLine=function(n){const a=n.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const a=n.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,a){return e.matchPrefix(n+a,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,a){const s=e.matchPrefix(n+a,"a=ice-ufrag:")[0],d=e.matchPrefix(n+a,"a=ice-pwd:")[0];return s&&d?{usernameFragment:s.substring(12),password:d.substring(10)}:null},e.writeIceParameters=function(n){let a="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(a+=`a=ice-lite\r
`),a},e.parseRtpParameters=function(n){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");a.profile=s[2];for(let f=3;f<s.length;f++){const m=s[f],_=e.matchPrefix(n,"a=rtpmap:"+m+" ")[0];if(_){const y=e.parseRtpMap(_),T=e.matchPrefix(n,"a=fmtp:"+m+" ");switch(y.parameters=T.length?e.parseFmtp(T[0]):{},y.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+m+" ").map(e.parseRtcpFb),a.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(y.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(f=>{a.headerExtensions.push(e.parseExtmap(f))});const d=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return a.codecs.forEach(f=>{d.forEach(m=>{f.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||f.rtcpFeedback.push(m)})}),a},e.writeRtpDescription=function(n,a){let s="";s+="m="+n+" ",s+=a.codecs.length>0?"9":"0",s+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=a.codecs.map(f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(f=>{s+=e.writeRtpMap(f),s+=e.writeFmtp(f),s+=e.writeRtcpFb(f)});let d=0;return a.codecs.forEach(f=>{f.maxptime>d&&(d=f.maxptime)}),d>0&&(s+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(f=>{s+=e.writeExtmap(f)}),s},e.parseRtpEncodingParameters=function(n){const a=[],s=e.parseRtpParameters(n),d=s.fecMechanisms.indexOf("RED")!==-1,f=s.fecMechanisms.indexOf("ULPFEC")!==-1,m=e.matchPrefix(n,"a=ssrc:").map(L=>e.parseSsrcMedia(L)).filter(L=>L.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const T=e.matchPrefix(n,"a=ssrc-group:FID").map(L=>L.substring(17).split(" ").map(B=>parseInt(B,10)));T.length>0&&T[0].length>1&&T[0][0]===_&&(y=T[0][1]),s.codecs.forEach(L=>{if(L.name.toUpperCase()==="RTX"&&L.parameters.apt){let B={ssrc:_,codecPayloadType:parseInt(L.parameters.apt,10)};_&&y&&(B.rtx={ssrc:y}),a.push(B),d&&(B=JSON.parse(JSON.stringify(B)),B.fec={ssrc:_,mechanism:f?"red+ulpfec":"red"},a.push(B))}}),a.length===0&&_&&a.push({ssrc:_});let w=e.matchPrefix(n,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,a.forEach(L=>{L.maxBitrate=w})),a},e.parseRtcpParameters=function(n){const a={},s=e.matchPrefix(n,"a=ssrc:").map(m=>e.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];s&&(a.cname=s.value,a.ssrc=s.ssrc);const d=e.matchPrefix(n,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const f=e.matchPrefix(n,"a=rtcp-mux");return a.mux=f.length>0,a},e.writeRtcpParameters=function(n){let a="";return n.reducedSize&&(a+=`a=rtcp-rsize\r
`),n.mux&&(a+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(a+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),a},e.parseMsid=function(n){let a;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return a=s[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},e.parseSctpDescription=function(n){const a=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let d;s.length>0&&(d=parseInt(s[0].substring(19),10)),isNaN(d)&&(d=65536);const f=e.matchPrefix(n,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const m=e.matchPrefix(n,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:d}}},e.writeSctpDescription=function(n,a){let s=[];return s=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&s.push("a=max-message-size:"+a.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,a,s){let d;const f=a!==void 0?a:2;return d=n||e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+d+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,a){const s=e.splitLines(n);for(let d=0;d<s.length;d++)switch(s[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[d].substring(2)}return a?e.getDirection(a):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const a=e.splitLines(n)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.parseOLine=function(n){const a=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const a=e.splitLines(n);for(let s=0;s<a.length;s++)if(a[s].length<2||a[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(kJ);var LJ=kJ.exports,UV=h(LJ),rct=o({__proto__:null,default:UV},[LJ]);function hH(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const a=new e(n),s=UV.parseCandidate(n.candidate),d=Object.assign(a,s);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,lM(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function sY(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||lM(t,"icecandidate",e=>{if(e.candidate){const n=UV.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function pH(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(m){if(!m||!m.sdp)return!1;const _=UV.splitSections(m.sdp);return _.shift(),_.some(y=>{const T=UV.parseMLine(y);return T&&T.kind==="application"&&T.protocol.indexOf("SCTP")!==-1})},a=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},s=function(m){let _=65536;return e.browser==="firefox"&&(_=e.version<57?m===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),_},d=function(m,_){let y=65536;e.browser==="firefox"&&e.version===57&&(y=65535);const T=UV.matchPrefix(m.sdp,"a=max-message-size:");return T.length>0?y=parseInt(T[0].substr(19),10):e.browser==="firefox"&&_!==-1&&(y=2147483637),y},f=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const m=a(arguments[0]),_=s(m),y=d(arguments[0],m);let T;T=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>T}),this._sctp=w}return f.apply(this,arguments)}}function fH(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(a,s){const d=a.send;a.send=function(){const f=arguments[0],m=f.length||f.size||f.byteLength;if(a.readyState==="open"&&s.sctp&&m>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=n.apply(this,arguments);return e(a,this),a},lM(t,"datachannel",a=>(e(a.channel,a.target),a))}function cY(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const a=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const d=s.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const f=new Event("connectionstatechange",s);d.dispatchEvent(f)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function uY(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=a.sdp.split(`
`).filter(d=>wR(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:s}):a.sdp=s}return n.apply(this,arguments)}}function mH(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?A_.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),A_.resolve())})}function EH(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return n.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?n.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var ict=Object.freeze({__proto__:null,removeExtmapAllowMixed:uY,shimAddIceCandidateNullOrEmpty:mH,shimConnectionState:cY,shimMaxMessageSize:pH,shimParameterlessSetLocalDescription:EH,shimRTCIceCandidate:hH,shimRTCIceCandidateRelayProtocol:sY,shimSendThrowTypeError:fH});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=WX,a=function(d){const f={browser:null,version:null};if(d===void 0||!d.navigator)return f.browser="Not a browser.",f;const{navigator:m}=d;if(m.mozGetUserMedia)f.browser="firefox",f.version=dH(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)f.browser="chrome",f.version=dH(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return f.browser="Not a supported browser.",f;f.browser="safari",f.version=dH(m.userAgent,/AppleWebKit\/(\d+)\./,1),f.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return f}(t),s={browserDetails:a,commonShim:ict,extractVersion:dH,disableLog:Gst,disableWarnings:Hst,sdp:rct};switch(a.browser){case"chrome":if(!sJ||!rY||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(a.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=sJ,mH(t,a),EH(t),QX(t,a),$X(t),rY(t,a),tJ(t),oJ(t,a),eJ(t),nJ(t),rJ(t),aJ(t,a),hH(t),sY(t),cY(t),pH(t,a),fH(t),uY(t,a);break;case"firefox":if(!_J||!iY||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=_J,mH(t,a),EH(t),cJ(t,a),iY(t,a),uJ(t),hJ(t),lJ(t),dJ(t),pJ(t),fJ(t),mJ(t),EJ(t),gJ(t),hH(t),cY(t),pH(t,a),fH(t);break;case"safari":if(!wJ||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=wJ,mH(t,a),EH(t),RJ(t),CJ(t),bJ(t),vJ(t),yJ(t),AJ(t),SJ(t),OJ(t),hH(t),sY(t),pH(t,a),fH(t),uY(t,a);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var PJ=xI,oct=TypeError,MJ=FR.match(/firefox\/(\d+)/i),act=!!MJ&&+MJ[1],sct=/MSIE|Trident/.test(FR),xJ=FR.match(/AppleWebKit\/(\d+)\./),cct=!!xJ&&+xJ[1],uct=SS,UJ=K,lct=hT,dct=EO,jJ=QO,hct=function(t,e){if(!delete t[e])throw oct("Cannot delete property "+PJ(e)+" of "+PJ(t))},VJ=qR,lY=E,pct=tH,fct=zR,BJ=act,mct=sct,FJ=y0,GJ=cct,OP=[],HJ=UJ(OP.sort),Ect=UJ(OP.push),gct=lY(function(){OP.sort(void 0)}),_ct=lY(function(){OP.sort(null)}),vct=fct("sort"),qJ=!lY(function(){if(FJ)return FJ<70;if(!(BJ&&BJ>3)){if(mct)return!0;if(GJ)return GJ<603;var t,e,n,a,s="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(a=0;a<47;a++)OP.push({k:e+a,v:n})}for(OP.sort(function(d,f){return f.v-d.v}),a=0;a<OP.length;a++)e=OP[a].k.charAt(0),s.charAt(s.length-1)!==e&&(s+=e);return s!=="DGBEFHACIJK"}});uct({target:"Array",proto:!0,forced:gct||!_ct||!vct||!qJ},{sort:function(t){t!==void 0&&lct(t);var e=dct(this);if(qJ)return t===void 0?HJ(e):HJ(e,t);var n,a,s=[],d=jJ(e);for(a=0;a<d;a++)a in e&&Ect(s,e[a]);for(pct(s,function(f){return function(m,_){return _===void 0?-1:m===void 0?1:f!==void 0?+f(m,_)||0:VJ(m)>VJ(_)?1:-1}}(t)),n=jJ(s),a=0;a<n;)e[a]=s[a++];for(;a<d;)hct(e,a++);return e}});var yct=HR("Array").sort,bct=$,Sct=yct,dY=Array.prototype,Tct=function(t){var e=t.sort;return t===dY||bct(dY,t)&&e===dY.sort?Sct:e},_2=h(Tct),hY=na;SS({global:!0,forced:hY.globalThis!==hY},{globalThis:hY});var zJ=h(na),pY={exports:{}};(function(t,e){(function(n,a){var s="function",d="undefined",f="object",m="string",_="major",y="model",T="name",w="type",L="vendor",B="version",Q="architecture",X="console",J="mobile",_n="tablet",_r="smarttv",ya="wearable",_l="embedded",_d="Amazon",tu="Apple",_g="ASUS",l_="BlackBerry",O_="Browser",N_="Chrome",iS="Firefox",oS="Google",jS="Huawei",gT="LG",lT="Microsoft",$R="Motorola",i_="Opera",__="Samsung",j_="Sharp",s_="Sony",Y="Xiaomi",ga="Zebra",ja="Facebook",f_="Chromium OS",_v="Mac OS",NS=function(NT){for(var GT={},YS=0;YS<NT.length;YS++)GT[NT[YS].toUpperCase()]=NT[YS];return GT},FT=function(NT,GT){return typeof NT===m&&g0(GT).indexOf(g0(NT))!==-1},g0=function(NT){return NT.toLowerCase()},CL=function(NT,GT){if(typeof NT===m)return NT=NT.replace(/^\s\s*/,""),typeof GT===d?NT:NT.substring(0,350)},FM=function(NT,GT){for(var YS,I0,MN,_T,gS,_0,XP=0;XP<GT.length&&!gS;){var LI=GT[XP],yat=GT[XP+1];for(YS=I0=0;YS<LI.length&&!gS&&LI[YS];)if(gS=LI[YS++].exec(NT))for(MN=0;MN<yat.length;MN++)_0=gS[++I0],typeof(_T=yat[MN])===f&&_T.length>0?_T.length===2?typeof _T[1]==s?this[_T[0]]=_T[1].call(this,_0):this[_T[0]]=_T[1]:_T.length===3?typeof _T[1]!==s||_T[1].exec&&_T[1].test?this[_T[0]]=_0?_0.replace(_T[1],_T[2]):a:this[_T[0]]=_0?_T[1].call(this,_0,_T[2]):a:_T.length===4&&(this[_T[0]]=_0?_T[3].call(this,_0.replace(_T[1],_T[2])):a):this[_T]=_0||a;XP+=2}},b6=function(NT,GT){for(var YS in GT)if(typeof GT[YS]===f&&GT[YS].length>0){for(var I0=0;I0<GT[YS].length;I0++)if(FT(GT[YS][I0],NT))return YS==="?"?a:YS}else if(FT(GT[YS],NT))return YS==="?"?a:YS;return NT},dK={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},hK={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[B,[T,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[B,[T,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[T,B],[/opios[\/ ]+([\w\.]+)/i],[B,[T,i_+" Mini"]],[/\bopr\/([\w\.]+)/i],[B,[T,i_]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[T,B],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[B,[T,"UC"+O_]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[B,[T,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[B,[T,"WeChat"]],[/konqueror\/([\w\.]+)/i],[B,[T,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[B,[T,"IE"]],[/yabrowser\/([\w\.]+)/i],[B,[T,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[T,/(.+)/,"$1 Secure "+O_],B],[/\bfocus\/([\w\.]+)/i],[B,[T,iS+" Focus"]],[/\bopt\/([\w\.]+)/i],[B,[T,i_+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[B,[T,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[B,[T,"Dolphin"]],[/coast\/([\w\.]+)/i],[B,[T,i_+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[B,[T,"MIUI "+O_]],[/fxios\/([-\w\.]+)/i],[B,[T,iS]],[/\bqihu|(qi?ho?o?|360)browser/i],[[T,"360 "+O_]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[T,/(.+)/,"$1 "+O_],B],[/(comodo_dragon)\/([\w\.]+)/i],[[T,/_/g," "],B],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[T,B],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[T],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[T,ja],B],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[T,B],[/\bgsa\/([\w\.]+) .*safari\//i],[B,[T,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[B,[T,N_+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[T,N_+" WebView"],B],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[B,[T,"Android "+O_]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[T,B],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[B,[T,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[B,T],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[T,[B,b6,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[T,B],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[T,"Netscape"],B],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[B,[T,iS+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[T,B],[/(cobalt)\/([\w\.]+)/i],[T,[B,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[Q,"amd64"]],[/(ia32(?=;))/i],[[Q,g0]],[/((?:i[346]|x)86)[;\)]/i],[[Q,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[Q,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[Q,"armhf"]],[/windows (ce|mobile); ppc;/i],[[Q,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[Q,/ower/,"",g0]],[/(sun4\w)[;\)]/i],[[Q,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[Q,g0]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[L,__],[w,_n]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[L,__],[w,J]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[L,tu],[w,J]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[L,tu],[w,_n]],[/(macintosh);/i],[y,[L,tu]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[L,j_],[w,J]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[L,jS],[w,_n]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[L,jS],[w,J]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[L,Y],[w,J]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[L,Y],[w,_n]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[L,"OPPO"],[w,J]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[L,"Vivo"],[w,J]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[L,"Realme"],[w,J]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[L,$R],[w,J]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[L,$R],[w,_n]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[L,gT],[w,_n]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[L,gT],[w,J]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[L,"Lenovo"],[w,_n]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[L,"Nokia"],[w,J]],[/(pixel c)\b/i],[y,[L,oS],[w,_n]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[L,oS],[w,J]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[L,s_],[w,J]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[L,s_],[w,_n]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[L,"OnePlus"],[w,J]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[L,_d],[w,_n]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[L,_d],[w,J]],[/(playbook);[-\w\),; ]+(rim)/i],[y,L,[w,_n]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[L,l_],[w,J]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[L,_g],[w,_n]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[L,_g],[w,J]],[/(nexus 9)/i],[y,[L,"HTC"],[w,_n]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[L,[y,/_/g," "],[w,J]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[L,"Acer"],[w,_n]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[L,"Meizu"],[w,J]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[L,y,[w,J]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[L,y,[w,_n]],[/(surface duo)/i],[y,[L,lT],[w,_n]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[L,"Fairphone"],[w,J]],[/(u304aa)/i],[y,[L,"AT&T"],[w,J]],[/\bsie-(\w*)/i],[y,[L,"Siemens"],[w,J]],[/\b(rct\w+) b/i],[y,[L,"RCA"],[w,_n]],[/\b(venue[\d ]{2,7}) b/i],[y,[L,"Dell"],[w,_n]],[/\b(q(?:mv|ta)\w+) b/i],[y,[L,"Verizon"],[w,_n]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[L,"Barnes & Noble"],[w,_n]],[/\b(tm\d{3}\w+) b/i],[y,[L,"NuVision"],[w,_n]],[/\b(k88) b/i],[y,[L,"ZTE"],[w,_n]],[/\b(nx\d{3}j) b/i],[y,[L,"ZTE"],[w,J]],[/\b(gen\d{3}) b.+49h/i],[y,[L,"Swiss"],[w,J]],[/\b(zur\d{3}) b/i],[y,[L,"Swiss"],[w,_n]],[/\b((zeki)?tb.*\b) b/i],[y,[L,"Zeki"],[w,_n]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[L,"Dragon Touch"],y,[w,_n]],[/\b(ns-?\w{0,9}) b/i],[y,[L,"Insignia"],[w,_n]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[L,"NextBook"],[w,_n]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[L,"Voice"],y,[w,J]],[/\b(lvtel\-)?(v1[12]) b/i],[[L,"LvTel"],y,[w,J]],[/\b(ph-1) /i],[y,[L,"Essential"],[w,J]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[L,"Envizen"],[w,_n]],[/\b(trio[-\w\. ]+) b/i],[y,[L,"MachSpeed"],[w,_n]],[/\btu_(1491) b/i],[y,[L,"Rotor"],[w,_n]],[/(shield[\w ]+) b/i],[y,[L,"Nvidia"],[w,_n]],[/(sprint) (\w+)/i],[L,y,[w,J]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[L,lT],[w,J]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[L,ga],[w,_n]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[L,ga],[w,J]],[/smart-tv.+(samsung)/i],[L,[w,_r]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[L,__],[w,_r]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[L,gT],[w,_r]],[/(apple) ?tv/i],[L,[y,tu+" TV"],[w,_r]],[/crkey/i],[[y,N_+"cast"],[L,oS],[w,_r]],[/droid.+aft(\w)( bui|\))/i],[y,[L,_d],[w,_r]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[L,j_],[w,_r]],[/(bravia[\w ]+)( bui|\))/i],[y,[L,s_],[w,_r]],[/(mitv-\w{5}) bui/i],[y,[L,Y],[w,_r]],[/Hbbtv.*(technisat) (.*);/i],[L,y,[w,_r]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[L,CL],[y,CL],[w,_r]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,_r]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[L,y,[w,X]],[/droid.+; (shield) bui/i],[y,[L,"Nvidia"],[w,X]],[/(playstation [345portablevi]+)/i],[y,[L,s_],[w,X]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[L,lT],[w,X]],[/((pebble))app/i],[L,y,[w,ya]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[L,tu],[w,ya]],[/droid.+; (glass) \d/i],[y,[L,oS],[w,ya]],[/droid.+; (wt63?0{2,3})\)/i],[y,[L,ga],[w,ya]],[/(quest( 2| pro)?)/i],[y,[L,ja],[w,ya]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[L,[w,_l]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[w,J]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[w,_n]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,_n]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,J]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[L,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[B,[T,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[B,[T,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[T,B],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[B,T]],os:[[/microsoft (windows) (vista|xp)/i],[T,B],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[T,[B,b6,dK]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,"Windows"],[B,b6,dK]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[B,/_/g,"."],[T,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[T,_v],[B,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[B,T],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[T,B],[/\(bb(10);/i],[B,[T,l_]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[B,[T,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[B,[T,iS+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[B,[T,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[B,[T,"watchOS"]],[/crkey\/([\d\.]+)/i],[B,[T,N_+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[T,f_],B],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[T,B],[/(sunos) ?([\w\.\d]*)/i],[[T,"Solaris"],B],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[T,B]]},fO=function(NT,GT){if(typeof NT===f&&(GT=NT,NT=a),!(this instanceof fO))return new fO(NT,GT).getResult();var YS=typeof n!==d&&n.navigator?n.navigator:a,I0=NT||(YS&&YS.userAgent?YS.userAgent:""),MN=YS&&YS.userAgentData?YS.userAgentData:a,_T=GT?function(gS,_0){var XP={};for(var LI in gS)_0[LI]&&_0[LI].length%2==0?XP[LI]=_0[LI].concat(gS[LI]):XP[LI]=gS[LI];return XP}(hK,GT):hK;return this.getBrowser=function(){var gS={};return gS[T]=a,gS[B]=a,FM.call(gS,I0,_T.browser),gS[_]=function(_0){return typeof _0===m?_0.replace(/[^\d\.]/g,"").split(".")[0]:a}(gS[B]),YS&&YS.brave&&typeof YS.brave.isBrave==s&&(gS[T]="Brave"),gS},this.getCPU=function(){var gS={};return gS[Q]=a,FM.call(gS,I0,_T.cpu),gS},this.getDevice=function(){var gS={};return gS[L]=a,gS[y]=a,gS[w]=a,FM.call(gS,I0,_T.device),!gS[w]&&MN&&MN.mobile&&(gS[w]=J),gS[y]=="Macintosh"&&YS&&typeof YS.standalone!==d&&YS.maxTouchPoints&&YS.maxTouchPoints>2&&(gS[y]="iPad",gS[w]=_n),gS},this.getEngine=function(){var gS={};return gS[T]=a,gS[B]=a,FM.call(gS,I0,_T.engine),gS},this.getOS=function(){var gS={};return gS[T]=a,gS[B]=a,FM.call(gS,I0,_T.os),!gS[T]&&MN&&MN.platform!="Unknown"&&(gS[T]=MN.platform.replace(/chrome os/i,f_).replace(/macos/i,_v)),gS},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return I0},this.setUA=function(gS){return I0=typeof gS===m&&gS.length>350?CL(gS,350):gS,this},this.setUA(I0),this};fO.VERSION="0.7.34",fO.BROWSER=NS([T,B,_]),fO.CPU=NS([Q]),fO.DEVICE=NS([y,L,w,X,J,_r,_n,ya,_l]),fO.ENGINE=fO.OS=NS([T,B]),t.exports&&(e=t.exports=fO),e.UAParser=fO;var YP=typeof n!==d&&(n.jQuery||n.Zepto);if(YP&&!YP.ua){var GM=new fO;YP.ua=GM.getResult(),YP.ua.get=function(){return GM.getUA()},YP.ua.set=function(NT){GM.setUA(NT);var GT=GM.getResult();for(var YS in GT)YP.ua[YS]=GT[YS]}}})(typeof window=="object"?window:u)})(pY,pY.exports);var Rct=h(pY.exports),Act=Y0,Cct=YT,Oct=PI,wct=KS,Ict=tT("iterator"),Nct=Object,Dct=function(t){if(Oct(t))return!1;var e=Nct(t);return e[Ict]!==void 0||"@@iterator"in e||Cct(wct,Act(e))},kct=h(Dct),KJ=OS.clear;SS({global:!0,bind:!0,forced:na.clearImmediate!==KJ},{clearImmediate:KJ});var Lct=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",WJ=na,Pct=_f,Mct=e_,xct=Lct,Uct=FR,jct=j1,Vct=sP,Bct=WJ.Function,Fct=/MSIE .\./.test(Uct)||xct&&function(){var t=WJ.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Gct=SS,YJ=na,XJ=OS.set,Hct=function(t,e){var n=1;return Fct?function(a,s){var d=Vct(arguments.length,1)>n,f=Mct(a)?a:Bct(a),m=d?jct(arguments,n):[],_=d?function(){Pct(f,this,m)}:f;return t(_)}:t},JJ=YJ.setImmediate?Hct(XJ):XJ;Gct({global:!0,bind:!0,forced:YJ.setImmediate!==JJ},{setImmediate:JJ});var ZJ=h(v0.setImmediate),qct=SS,zct=UG,Kct=hT,Wct=sP,Yct=J0,Xct=na.process;qct({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){Wct(arguments.length,1),Kct(t);var e=Yct&&Xct.domain;zct(e?e.bind(t):t)}});var QJ=h(v0.queueMicrotask);function $J(t,e){return function(){return t.apply(e,arguments)}}const{toString:Jct}=Object.prototype,{getPrototypeOf:fY}=Object,gH=(mY=Object.create(null),t=>{const e=Jct.call(t);return mY[e]||(mY[e]=e.slice(8,-1).toLowerCase())});var mY;const yI=t=>(t=t.toLowerCase(),e=>gH(e)===t),_H=t=>e=>typeof e===t,{isArray:jV}=Array,v2=_H("undefined"),tZ=yI("ArrayBuffer"),Zct=_H("string"),iO=_H("function"),eZ=_H("number"),vH=t=>t!==null&&typeof t=="object",yH=t=>{if(gH(t)!=="object")return!1;const e=fY(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||kct(t))},Qct=yI("Date"),$ct=yI("File"),tut=yI("Blob"),eut=yI("FileList"),nut=yI("URLSearchParams"),[rut,iut,out,aut]=["ReadableStream","Request","Response","Headers"].map(yI);function y2(t,e){let n,a,{allOwnKeys:s=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),jV(t))for(n=0,a=t.length;n<a;n++)e.call(null,t[n],n,t);else{const d=s?Object.getOwnPropertyNames(t):Object.keys(t),f=d.length;let m;for(n=0;n<f;n++)m=d[n],e.call(null,t[m],m,t)}}function nZ(t,e){e=e.toLowerCase();const n=Object.keys(t);let a,s=n.length;for(;s-- >0;)if(a=n[s],e===a.toLowerCase())return a;return null}const dM=zJ!==void 0?zJ:typeof self<"u"?self:typeof window<"u"?window:commonjsGlobal,rZ=t=>!v2(t)&&t!==dM,sut=(EY=typeof Uint8Array<"u"&&fY(Uint8Array),t=>EY&&t instanceof EY);var EY;const cut=yI("HTMLFormElement"),iZ=(t=>{let{hasOwnProperty:e}=t;return(n,a)=>e.call(n,a)})(Object.prototype),uut=yI("RegExp"),oZ=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),a={};y2(n,(s,d)=>{let f;(f=e(s,d,t))!==!1&&(a[d]=f||s)}),Object.defineProperties(t,a)},gY="abcdefghijklmnopqrstuvwxyz",aZ="0123456789",sZ={DIGIT:aZ,ALPHA:gY,ALPHA_DIGIT:gY+gY.toUpperCase()+aZ},lut=yI("AsyncFunction"),cZ=(uZ=typeof ZJ=="function",lZ=iO(dM.postMessage),uZ?ZJ:lZ?(_Y="axios@".concat(Math.random()),bH=[],dM.addEventListener("message",t=>{let{source:e,data:n}=t;e===dM&&n===_Y&&bH.length&&bH.shift()()},!1),t=>{bH.push(t),dM.postMessage(_Y,"*")}):t=>setTimeout(t));var uZ,lZ,_Y,bH;const dut=QJ!==void 0?QJ.bind(dM):typeof process<"u"&&process.nextTick||cZ;var C_={isArray:jV,isArrayBuffer:tZ,isBuffer:function(t){return t!==null&&!v2(t)&&t.constructor!==null&&!v2(t.constructor)&&iO(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||iO(t.append)&&((e=gH(t))==="formdata"||e==="object"&&iO(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&tZ(t.buffer),e},isString:Zct,isNumber:eZ,isBoolean:t=>t===!0||t===!1,isObject:vH,isPlainObject:yH,isReadableStream:rut,isRequest:iut,isResponse:out,isHeaders:aut,isUndefined:v2,isDate:Qct,isFile:$ct,isBlob:tut,isRegExp:uut,isFunction:iO,isStream:t=>vH(t)&&iO(t.pipe),isURLSearchParams:nut,isTypedArray:sut,isFileList:eut,forEach:y2,merge:function t(){const{caseless:e}=rZ(this)&&this||{},n={},a=(s,d)=>{const f=e&&nZ(n,d)||d;yH(n[f])&&yH(s)?n[f]=t(n[f],s):yH(s)?n[f]=t({},s):jV(s)?n[f]=s.slice():n[f]=s};for(let s=0,d=arguments.length;s<d;s++)arguments[s]&&y2(arguments[s],a);return n},extend:function(t,e,n){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return y2(e,(s,d)=>{n&&iO(s)?t[d]=$J(s,n):t[d]=s},{allOwnKeys:a}),t},trim:t=>wR(t)?wR(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,a)=>{t.prototype=Object.create(e.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,a)=>{let s,d,f;const m={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),d=s.length;d-- >0;)f=s[d],a&&!a(f,t,e)||m[f]||(e[f]=t[f],m[f]=!0);t=n!==!1&&fY(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:gH,kindOfTest:yI,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const a=t.indexOf(e,n);return a!==-1&&a===n},toArray:t=>{if(!t)return null;if(jV(t))return t;let e=t.length;if(!eZ(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let a;for(;(a=n.next())&&!a.done;){const s=a.value;e.call(t,s[0],s[1])}},matchAll:(t,e)=>{let n;const a=[];for(;(n=t.exec(e))!==null;)a.push(n);return a},isHTMLForm:cut,hasOwnProperty:iZ,hasOwnProp:iZ,reduceDescriptors:oZ,freezeMethods:t=>{oZ(t,(e,n)=>{if(iO(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const a=t[n];iO(a)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},a=s=>{s.forEach(d=>{n[d]=!0})};return jV(t)?a(t):a(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,a){return n.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:nZ,global:dM,isContextDefined:rZ,ALPHABET:sZ,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sZ.ALPHA_DIGIT,n="";const{length:a}=e;for(;t--;)n+=e[Math.random()*a|0];return n},isSpecCompliantForm:function(t){return!!(t&&iO(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(a,s)=>{if(vH(a)){if(e.indexOf(a)>=0)return;if(!("toJSON"in a)){e[s]=a;const d=jV(a)?[]:{};return y2(a,(f,m)=>{const _=n(f,s+1);!v2(_)&&(d[m]=_)}),e[s]=void 0,d}}return a};return n(t,0)},isAsyncFn:lut,isThenable:t=>t&&(vH(t)||iO(t))&&iO(t.then)&&iO(t.catch),setImmediate:cZ,asap:dut};function wS(t,e,n,a,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),a&&(this.request=a),s&&(this.response=s,this.status=s.status?s.status:null)}C_.inherits(wS,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C_.toJSONObject(this.config),code:this.code,status:this.status}}});const dZ=wS.prototype,hZ={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{hZ[t]={value:t}}),Object.defineProperties(wS,hZ),Object.defineProperty(dZ,"isAxiosError",{value:!0}),wS.from=(t,e,n,a,s,d)=>{const f=Object.create(dZ);return C_.toFlatObject(t,f,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),wS.call(f,t.message,e,n,a,s),f.cause=t,f.name=t.name,d&&Object.assign(f,d),f};function vY(t){return C_.isPlainObject(t)||C_.isArray(t)}function pZ(t){return C_.endsWith(t,"[]")?t.slice(0,-2):t}function fZ(t,e,n){return t?t.concat(e).map(function(a,s){return a=pZ(a),!n&&s?"["+a+"]":a}).join(n?".":""):e}const hut=C_.toFlatObject(C_,{},null,function(t){return/^is[A-Z]/.test(t)});function SH(t,e,n){if(!C_.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const a=(n=C_.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(L,B){return!C_.isUndefined(B[L])})).metaTokens,s=n.visitor||y,d=n.dots,f=n.indexes,m=(n.Blob||typeof Blob<"u"&&Blob)&&C_.isSpecCompliantForm(e);if(!C_.isFunction(s))throw new TypeError("visitor must be a function");function _(L){if(L===null)return"";if(C_.isDate(L))return L.toISOString();if(!m&&C_.isBlob(L))throw new wS("Blob is not supported. Use a Buffer instead.");return C_.isArrayBuffer(L)||C_.isTypedArray(L)?m&&typeof Blob=="function"?new Blob([L]):Buffer.from(L):L}function y(L,B,Q){let X=L;if(L&&!Q&&typeof L=="object"){if(C_.endsWith(B,"{}"))B=a?B:B.slice(0,-2),L=JSON.stringify(L);else if(C_.isArray(L)&&function(J){return C_.isArray(J)&&!J.some(vY)}(L)||(C_.isFileList(L)||C_.endsWith(B,"[]"))&&(X=C_.toArray(L)))return B=pZ(B),X.forEach(function(J,_n){!C_.isUndefined(J)&&J!==null&&e.append(f===!0?fZ([B],_n,d):f===null?B:B+"[]",_(J))}),!1}return!!vY(L)||(e.append(fZ(Q,B,d),_(L)),!1)}const T=[],w=Object.assign(hut,{defaultVisitor:y,convertValue:_,isVisitable:vY});if(!C_.isObject(t))throw new TypeError("data must be an object");return function L(B,Q){if(!C_.isUndefined(B)){if(T.indexOf(B)!==-1)throw Error("Circular reference detected in "+Q.join("."));T.push(B),C_.forEach(B,function(X,J){(!(C_.isUndefined(X)||X===null)&&s.call(e,X,C_.isString(J)?wR(J).call(J):J,Q,w))===!0&&L(X,Q?Q.concat(J):[J])}),T.pop()}}(t),e}function mZ(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function yY(t,e){this._pairs=[],t&&SH(t,this,e)}const EZ=yY.prototype;function put(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function gZ(t,e,n){if(!e)return t;const a=n&&n.encode||put;C_.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let d;if(d=s?s(e,n):C_.isURLSearchParams(e)?e.toString():new yY(e,n).toString(a),d){const f=t.indexOf("#");f!==-1&&(t=t.slice(0,f)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}EZ.append=function(t,e){this._pairs.push([t,e])},EZ.toString=function(t){const e=t?function(n){return t.call(this,n,mZ)}:mZ;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var _Z=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){C_.forEach(this.handlers,function(e){e!==null&&t(e)})}},vZ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yZ={exports:{}},fut=SS,mut=_p,bZ=GR.f;fut({target:"Object",stat:!0,forced:Object.defineProperty!==bZ,sham:!mut},{defineProperty:bZ});var SZ=v0.Object,Eut=yZ.exports=function(t,e,n){return SZ.defineProperty(t,e,n)};SZ.defineProperty.sham&&(Eut.sham=!0);var TZ=h(yZ.exports),gut=TypeError,RZ=RR,_ut=aP,vut=SR,yut=tT("species"),AZ=Array,but=function(t){var e;return RZ(t)&&(e=t.constructor,(_ut(e)&&(e===AZ||RZ(e.prototype))||vut(e)&&(e=e[yut])===null)&&(e=void 0)),e===void 0?AZ:e},CZ=function(t,e){return new(but(t))(e===0?0:e)},Sut=E,Tut=y0,Rut=tT("species"),OZ=function(t){return Tut>=51||!Sut(function(){var e=[];return(e.constructor={})[Rut]=function(){return{foo:1}},e[t](Boolean).foo!==1})},Aut=SS,Cut=E,Out=RR,wut=SR,Iut=EO,Nut=QO,wZ=function(t){if(t>9007199254740991)throw gut("Maximum allowed index exceeded");return t},IZ=rO,Dut=CZ,kut=OZ,Lut=y0,NZ=tT("isConcatSpreadable"),Put=Lut>=51||!Cut(function(){var t=[];return t[NZ]=!1,t.concat()[0]!==t}),Mut=function(t){if(!wut(t))return!1;var e=t[NZ];return e!==void 0?!!e:Out(t)};Aut({target:"Array",proto:!0,forced:!Put||!kut("concat")},{concat:function(t){var e,n,a,s,d,f=Iut(this),m=Dut(f,0),_=0;for(e=-1,a=arguments.length;e<a;e++)if(Mut(d=e===-1?f:arguments[e]))for(s=Nut(d),wZ(_+s),n=0;n<s;n++,_++)n in d&&IZ(m,_,d[n]);else wZ(_+1),IZ(m,_++,d);return m.length=_,m}});var DZ={},xut=w_,Uut=MI,kZ=GI.f,jut=CV,LZ=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];DZ.f=function(t){return LZ&&xut(t)=="Window"?function(e){try{return kZ(e)}catch{return jut(LZ)}}(t):kZ(Uut(t))};var VV={},Vut=tT;VV.f=Vut;var PZ=v0,But=YT,Fut=VV,Gut=GR.f,oR=function(t){var e=PZ.Symbol||(PZ.Symbol={});But(e,t)||Gut(e,t,{value:Fut.f(t)})},Hut=q_,qut=vT,zut=tT,Kut=YI,MZ=function(){var t=qut("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,a=zut("toPrimitive");e&&!e[a]&&Kut(e,a,function(s){return Hut(n,this)},{})},Wut=i0,Yut=YO,Xut=EO,Jut=QO,Zut=CZ,xZ=K([].push),Qut=function(t){var e=t==1,n=t==2,a=t==3,s=t==4,d=t==6,f=t==7,m=t==5||d;return function(_,y,T,w){for(var L,B,Q=Xut(_),X=Yut(Q),J=Wut(y,T),_n=Jut(X),_r=0,ya=w||Zut,_l=e?ya(_,_n):n||f?ya(_,0):void 0;_n>_r;_r++)if((m||_r in X)&&(B=J(L=X[_r],_r,Q),t))if(e)_l[_r]=B;else if(B)switch(t){case 3:return!0;case 5:return L;case 6:return _r;case 2:xZ(_l,L)}else switch(t){case 4:return!1;case 7:xZ(_l,L)}return d?-1:a||s?s:_l}},UZ={forEach:Qut(0)},TH=SS,bY=na,SY=q_,$ut=K,BV=_p,FV=xN,tlt=E,PR=YT,elt=$,TY=nR,RH=MI,RY=i1,nlt=qR,AY=Z_,b2=aI,jZ=y1,rlt=GI,VZ=DZ,ilt=rR,BZ=r_,FZ=GR,olt=qI,GZ=_u,HZ=YI,alt=iP,CY=VN,qZ=qL,zZ=YM,slt=tT,clt=VV,ult=oR,llt=MZ,dlt=bO,KZ=$0,AH=UZ.forEach,x0=gO("hidden"),CH="Symbol",S2="prototype",hlt=KZ.set,WZ=KZ.getterFor(CH),bI=Object[S2],hM=bY.Symbol,OH=hM&&hM[S2],plt=bY.TypeError,OY=bY.QObject,YZ=BZ.f,pM=FZ.f,XZ=VZ.f,flt=GZ.f,JZ=$ut([].push),lL=CY("symbols"),T2=CY("op-symbols"),mlt=CY("wks"),wY=!OY||!OY[S2]||!OY[S2].findChild,IY=BV&&tlt(function(){return b2(pM({},"a",{get:function(){return pM(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var a=YZ(bI,e);a&&delete bI[e],pM(t,e,n),a&&t!==bI&&pM(bI,e,a)}:pM,NY=function(t,e){var n=lL[t]=b2(OH);return hlt(n,{type:CH,tag:t,description:e}),BV||(n.description=e),n},wH=function(t,e,n){t===bI&&wH(T2,e,n),TY(t);var a=RY(e);return TY(n),PR(lL,a)?(n.enumerable?(PR(t,x0)&&t[x0][a]&&(t[x0][a]=!1),n=b2(n,{enumerable:AY(0,!1)})):(PR(t,x0)||pM(t,x0,AY(1,{})),t[x0][a]=!0),IY(t,a,n)):pM(t,a,n)},DY=function(t,e){TY(t);var n=RH(e),a=jZ(n).concat(tQ(n));return AH(a,function(s){BV&&!SY(ZZ,n,s)||wH(t,s,n[s])}),t},ZZ=function(t){var e=RY(t),n=SY(flt,this,e);return!(this===bI&&PR(lL,e)&&!PR(T2,e))&&(!(n||!PR(this,e)||!PR(lL,e)||PR(this,x0)&&this[x0][e])||n)},QZ=function(t,e){var n=RH(t),a=RY(e);if(n!==bI||!PR(lL,a)||PR(T2,a)){var s=YZ(n,a);return!s||!PR(lL,a)||PR(n,x0)&&n[x0][a]||(s.enumerable=!0),s}},$Z=function(t){var e=XZ(RH(t)),n=[];return AH(e,function(a){PR(lL,a)||PR(qZ,a)||JZ(n,a)}),n},tQ=function(t){var e=t===bI,n=XZ(e?T2:RH(t)),a=[];return AH(n,function(s){!PR(lL,s)||e&&!PR(bI,s)||JZ(a,lL[s])}),a};FV||(hM=function(){if(elt(OH,this))throw plt("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?nlt(arguments[0]):void 0,e=zZ(t),n=function(a){this===bI&&SY(n,T2,a),PR(this,x0)&&PR(this[x0],e)&&(this[x0][e]=!1),IY(this,e,AY(1,a))};return BV&&wY&&IY(bI,e,{configurable:!0,set:n}),NY(e,t)},HZ(OH=hM[S2],"toString",function(){return WZ(this).tag}),HZ(hM,"withoutSetter",function(t){return NY(zZ(t),t)}),GZ.f=ZZ,FZ.f=wH,olt.f=DY,BZ.f=QZ,rlt.f=VZ.f=$Z,ilt.f=tQ,clt.f=function(t){return NY(slt(t),t)},BV&&alt(OH,"description",{configurable:!0,get:function(){return WZ(this).description}})),TH({global:!0,wrap:!0,forced:!FV,sham:!FV},{Symbol:hM}),AH(jZ(mlt),function(t){ult(t)}),TH({target:CH,stat:!0,forced:!FV},{useSetter:function(){wY=!0},useSimple:function(){wY=!1}}),TH({target:"Object",stat:!0,forced:!FV,sham:!BV},{create:function(t,e){return e===void 0?b2(t):DY(b2(t),e)},defineProperty:wH,defineProperties:DY,getOwnPropertyDescriptor:QZ}),TH({target:"Object",stat:!0,forced:!FV},{getOwnPropertyNames:$Z}),llt(),dlt(hM,CH),qZ[x0]=!0;var eQ=xN&&!!Symbol.for&&!!Symbol.keyFor,Elt=SS,glt=vT,_lt=YT,vlt=qR,nQ=VN,ylt=eQ,kY=nQ("string-to-symbol-registry"),blt=nQ("symbol-to-string-registry");Elt({target:"Symbol",stat:!0,forced:!ylt},{for:function(t){var e=vlt(t);if(_lt(kY,e))return kY[e];var n=glt("Symbol")(e);return kY[e]=n,blt[n]=e,n}});var Slt=SS,Tlt=YT,Rlt=IL,Alt=xI,Clt=eQ,rQ=VN("symbol-to-string-registry");Slt({target:"Symbol",stat:!0,forced:!Clt},{keyFor:function(t){if(!Rlt(t))throw TypeError(Alt(t)+" is not a symbol");if(Tlt(rQ,t))return rQ[t]}});var iQ=RR,Olt=e_,oQ=w_,wlt=qR,aQ=K([].push),Ilt=SS,sQ=vT,cQ=_f,Nlt=q_,R2=K,uQ=E,lQ=e_,dQ=IL,hQ=j1,Dlt=function(t){if(Olt(t))return t;if(iQ(t)){for(var e=t.length,n=[],a=0;a<e;a++){var s=t[a];typeof s=="string"?aQ(n,s):typeof s!="number"&&oQ(s)!="Number"&&oQ(s)!="String"||aQ(n,wlt(s))}var d=n.length,f=!0;return function(m,_){if(f)return f=!1,_;if(iQ(this))return _;for(var y=0;y<d;y++)if(n[y]===m)return _}}},klt=xN,Llt=String,wP=sQ("JSON","stringify"),IH=R2(/./.exec),pQ=R2("".charAt),Plt=R2("".charCodeAt),Mlt=R2("".replace),xlt=R2(1 .toString),Ult=/[\uD800-\uDFFF]/g,fQ=/^[\uD800-\uDBFF]$/,mQ=/^[\uDC00-\uDFFF]$/,EQ=!klt||uQ(function(){var t=sQ("Symbol")();return wP([t])!="[null]"||wP({a:t})!="{}"||wP(Object(t))!="{}"}),gQ=uQ(function(){return wP("\uDF06\uD834")!=='"\\udf06\\ud834"'||wP("\uDEAD")!=='"\\udead"'}),jlt=function(t,e){var n=hQ(arguments),a=Dlt(e);if(lQ(a)||t!==void 0&&!dQ(t))return n[1]=function(s,d){if(lQ(a)&&(d=Nlt(a,this,Llt(s),d)),!dQ(d))return d},cQ(wP,null,n)},Vlt=function(t,e,n){var a=pQ(n,e-1),s=pQ(n,e+1);return IH(fQ,t)&&!IH(mQ,s)||IH(mQ,t)&&!IH(fQ,a)?"\\u"+xlt(Plt(t,0),16):t};wP&&Ilt({target:"JSON",stat:!0,forced:EQ||gQ},{stringify:function(t,e,n){var a=hQ(arguments),s=cQ(EQ?jlt:wP,null,a);return gQ&&typeof s=="string"?Mlt(s,Ult,Vlt):s}});var _Q=rR,Blt=EO;SS({target:"Object",stat:!0,forced:!xN||E(function(){_Q.f(1)})},{getOwnPropertySymbols:function(t){var e=_Q.f;return e?e(Blt(t)):[]}}),oR("asyncIterator"),oR("hasInstance"),oR("isConcatSpreadable"),oR("iterator"),oR("match"),oR("matchAll"),oR("replace"),oR("search"),oR("species"),oR("split");var Flt=MZ;oR("toPrimitive"),Flt();var Glt=vT,Hlt=bO;oR("toStringTag"),Hlt(Glt("Symbol"),"Symbol"),oR("unscopables"),bO(na.JSON,"JSON",!0);var qlt=v0.Symbol,zlt=tT,Klt=GR.f,vQ=zlt("metadata"),yQ=Function.prototype;yQ[vQ]===void 0&&Klt(yQ,vQ,{value:null}),oR("dispose"),oR("metadata");var Wlt=qlt;oR("asyncDispose");var Ylt=K,LY=vT("Symbol"),Xlt=LY.keyFor,Jlt=Ylt(LY.prototype.valueOf),bQ=LY.isRegisteredSymbol||function(t){try{return Xlt(Jlt(t))!==void 0}catch{return!1}};SS({target:"Symbol",stat:!0},{isRegisteredSymbol:bQ});for(var Zlt=VN,SQ=vT,Qlt=K,$lt=IL,tdt=tT,NH=SQ("Symbol"),TQ=NH.isWellKnownSymbol,RQ=SQ("Object","getOwnPropertyNames"),edt=Qlt(NH.prototype.valueOf),AQ=Zlt("wks"),PY=0,CQ=RQ(NH),ndt=CQ.length;PY<ndt;PY++)try{var OQ=CQ[PY];$lt(NH[OQ])&&tdt(OQ)}catch{}var wQ=function(t){if(TQ&&TQ(t))return!0;try{for(var e=edt(t),n=0,a=RQ(AQ),s=a.length;n<s;n++)if(AQ[a[n]]==e)return!0}catch{}return!1};SS({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:wQ}),oR("matcher"),oR("observable"),SS({target:"Symbol",stat:!0},{isRegistered:bQ}),SS({target:"Symbol",stat:!0,forced:!0},{isWellKnown:wQ}),oR("metadataKey"),oR("patternMatch"),oR("replaceAll");var GV=h(Wlt),IQ=h(VV.f("iterator"));function A2(t){return A2=typeof GV=="function"&&typeof IQ=="symbol"?function(e){return typeof e}:function(e){return e&&typeof GV=="function"&&e.constructor===GV&&e!==GV.prototype?"symbol":typeof e},A2(t)}var rdt=h(VV.f("toPrimitive"));function idt(t){var e=function(n,a){if(A2(n)!=="object"||n===null)return n;var s=n[rdt];if(s!==void 0){var d=s.call(n,a);if(A2(d)!=="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(n)}(t,"string");return A2(e)==="symbol"?e:String(e)}function _t(t,e,n){return(e=idt(e))in t?TZ(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var NQ=h(jat),odt={isBrowser:!0,classes:{URLSearchParams:NQ!==void 0?NQ:yY,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const MY=typeof window<"u"&&typeof document<"u",xY=typeof navigator=="object"&&navigator||void 0,adt=MY&&(!xY||["ReactNative","NativeScript","NS"].indexOf(xY.product)<0),sdt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",cdt=MY&&window.location.href||"http://localhost";function DQ(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function kQ(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?DQ(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):DQ(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}var h0=kQ(kQ({},Object.freeze({__proto__:null,hasBrowserEnv:MY,hasStandardBrowserEnv:adt,hasStandardBrowserWebWorkerEnv:sdt,navigator:xY,origin:cdt})),odt),udt=nR,ldt=q_,ddt=YT,hdt=$,pdt=function(){var t=udt(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},LQ=RegExp.prototype,PQ=function(t){var e=t.flags;return e!==void 0||"flags"in LQ||ddt(t,"flags")||!hdt(LQ,t)?e:ldt(pdt,t)},fdt=hN.charAt,MQ=q_,mdt=nR,Edt=e_,gdt=w_,_dt=/./.exec,vdt=TypeError,ydt=SS,xQ=q_,UQ=o_,bdt=HU,DH=KU,jQ=OL,VQ=TF,C2=qR,Sdt=nR,Tdt=PI,Rdt=w_,Adt=OF,BQ=PQ,Cdt=DL,Odt=E,wdt=qA,Idt=function(t,e,n){return e+(n?fdt(t,e).length:1)},Ndt=function(t,e){var n=t.exec;if(Edt(n)){var a=MQ(n,t,e);return a!==null&&mdt(a),a}if(gdt(t)==="RegExp")return MQ(_dt,t,e);throw vdt("RegExp#exec called on incompatible receiver")},FQ=$0,Ddt=tT("matchAll"),GQ="RegExp String",HQ=GQ+" Iterator",kdt=FQ.set,Ldt=FQ.getterFor(HQ),Pdt=TypeError,UY=UQ("".indexOf),kH=UQ("".matchAll),jY=!!kH&&!Odt(function(){kH("a",/./)}),Mdt=bdt(function(t,e,n,a){kdt(this,{type:HQ,regexp:t,string:e,global:n,unicode:a,done:!1})},GQ,function(){var t=Ldt(this);if(t.done)return DH(void 0,!0);var e=t.regexp,n=t.string,a=Ndt(e,n);return a===null?(t.done=!0,DH(void 0,!0)):t.global?(C2(a[0])===""&&(e.lastIndex=Idt(n,VQ(e.lastIndex),t.unicode)),DH(a,!1)):(t.done=!0,DH(a,!1))}),qQ=function(t){var e,n,a,s=Sdt(this),d=C2(t),f=wdt(s,RegExp),m=C2(BQ(s));return e=new f(f===RegExp?s.source:s,m),n=!!~UY(m,"g"),a=!!~UY(m,"u"),e.lastIndex=VQ(s.lastIndex),new Mdt(e,d,n,a)};ydt({target:"String",proto:!0,forced:jY},{matchAll:function(t){var e,n,a,s,d=jQ(this);if(Tdt(t)){if(jY)return kH(d,t)}else{if(Adt(t)&&(e=C2(jQ(BQ(t))),!~UY(e,"g")))throw Pdt("`.matchAll` does not allow non-global regexes");if(jY)return kH(d,t);if((a=Cdt(t,Ddt))===void 0&&Rdt(t)=="RegExp"&&(a=qQ),a)return xQ(a,t,d)}return n=C2(d),s=new RegExp(t,"g"),xQ(qQ,s,n)}});var xdt=HR("String").matchAll,Udt=$,jdt=xdt,VY=String.prototype,Vdt=function(t){var e=t.matchAll;return typeof t=="string"||t===VY||Udt(VY,t)&&e===VY.matchAll?jdt:e},Bdt=h(Vdt);function zQ(t){function e(n,a,s,d){let f=n[d++];if(f==="__proto__")return!0;const m=Number.isFinite(+f),_=d>=n.length;return f=!f&&C_.isArray(s)?s.length:f,_?(C_.hasOwnProp(s,f)?s[f]=[s[f],a]:s[f]=a,!m):(s[f]&&C_.isObject(s[f])||(s[f]=[]),e(n,a,s[f],d)&&C_.isArray(s[f])&&(s[f]=function(y){const T={},w=Object.keys(y);let L;const B=w.length;let Q;for(L=0;L<B;L++)Q=w[L],T[Q]=y[Q];return T}(s[f])),!m)}if(C_.isFormData(t)&&C_.isFunction(t.entries)){const n={};return C_.forEachEntry(t,(a,s)=>{e(function(d){return Bdt(C_).call(C_,/\w+|\[(\w*)]/g,d).map(f=>f[0]==="[]"?"":f[1]||f[0])}(a),s,n,0)}),n}return null}const BY={transitional:vZ,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",a=n.indexOf("application/json")>-1,s=C_.isObject(t);if(s&&C_.isHTMLForm(t)&&(t=new FormData(t)),C_.isFormData(t))return a?JSON.stringify(zQ(t)):t;if(C_.isArrayBuffer(t)||C_.isBuffer(t)||C_.isStream(t)||C_.isFile(t)||C_.isBlob(t)||C_.isReadableStream(t))return t;if(C_.isArrayBufferView(t))return t.buffer;if(C_.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(f,m){return SH(f,new h0.classes.URLSearchParams,Object.assign({visitor:function(_,y,T,w){return h0.isNode&&C_.isBuffer(_)?(this.append(y,_.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((d=C_.isFileList(t))||n.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return SH(d?{"files[]":t}:t,f&&new f,this.formSerializer)}}return s||a?(e.setContentType("application/json",!1),function(f,m,_){if(C_.isString(f))try{return(m||JSON.parse)(f),wR(C_).call(C_,f)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(f)}(t)):t}],transformResponse:[function(t){const e=this.transitional||BY.transitional,n=e&&e.forcedJSONParsing,a=this.responseType==="json";if(C_.isResponse(t)||C_.isReadableStream(t))return t;if(t&&C_.isString(t)&&(n&&!this.responseType||a)){const s=!(e&&e.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(d){if(s)throw d.name==="SyntaxError"?wS.from(d,wS.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:h0.classes.FormData,Blob:h0.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C_.forEach(["delete","get","head","post","put","patch"],t=>{BY.headers[t]={}});var FY=BY;const Fdt=C_.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),KQ=Symbol("internals");function O2(t){var e;return t&&wR(e=String(t)).call(e).toLowerCase()}function LH(t){return t===!1||t==null?t:C_.isArray(t)?t.map(LH):String(t)}function GY(t,e,n,a,s){return C_.isFunction(a)?a.call(this,e,n):(s&&(e=n),C_.isString(e)?C_.isString(a)?e.indexOf(a)!==-1:C_.isRegExp(a)?a.test(e):void 0:void 0)}class PH{constructor(e){e&&this.set(e)}set(e,n,a){const s=this;function d(_,y,T){const w=O2(y);if(!w)throw new Error("header name must be a non-empty string");const L=C_.findKey(s,w);(!L||s[L]===void 0||T===!0||T===void 0&&s[L]!==!1)&&(s[L||y]=LH(_))}const f=(_,y)=>C_.forEach(_,(T,w)=>d(T,w,y));if(C_.isPlainObject(e)||e instanceof this.constructor)f(e,n);else if(C_.isString(e)&&(e=wR(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(wR(m=e).call(m)))f((_=>{const y={};let T,w,L;return _&&_.split(`
`).forEach(function(B){var Q,X;L=B.indexOf(":"),T=wR(Q=B.substring(0,L)).call(Q).toLowerCase(),w=wR(X=B.substring(L+1)).call(X),!T||y[T]&&Fdt[T]||(T==="set-cookie"?y[T]?y[T].push(w):y[T]=[w]:y[T]=y[T]?y[T]+", "+w:w)}),y})(e),n);else if(C_.isHeaders(e))for(const[_,y]of e.entries())d(y,_,a);else e!=null&&d(n,e,a);var m;return this}get(e,n){if(e=O2(e)){const a=C_.findKey(this,e);if(a){const s=this[a];if(!n)return s;if(n===!0)return function(d){const f=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(d);)f[_[1]]=_[2];return f}(s);if(C_.isFunction(n))return n.call(this,s,a);if(C_.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=O2(e)){const a=C_.findKey(this,e);return!(!a||this[a]===void 0||n&&!GY(0,this[a],a,n))}return!1}delete(e,n){const a=this;let s=!1;function d(f){if(f=O2(f)){const m=C_.findKey(a,f);!m||n&&!GY(0,a[m],m,n)||(delete a[m],s=!0)}}return C_.isArray(e)?e.forEach(d):d(e),s}clear(e){const n=Object.keys(this);let a=n.length,s=!1;for(;a--;){const d=n[a];e&&!GY(0,this[d],d,e,!0)||(delete this[d],s=!0)}return s}normalize(e){const n=this,a={};return C_.forEach(this,(s,d)=>{var f;const m=C_.findKey(a,d);if(m)return n[m]=LH(s),void delete n[d];const _=e?function(y){return wR(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(T,w,L)=>w.toUpperCase()+L)}(d):wR(f=String(d)).call(f);_!==d&&delete n[d],n[_]=LH(s),a[_]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return C_.forEach(this,(a,s)=>{a!=null&&a!==!1&&(n[s]=e&&C_.isArray(a)?a.join(", "):a)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,a]=e;return n+": "+a}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var a=arguments.length,s=new Array(a>1?a-1:0),d=1;d<a;d++)s[d-1]=arguments[d];return s.forEach(f=>n.set(f)),n}static accessor(e){const n=(this[KQ]=this[KQ]={accessors:{}}).accessors,a=this.prototype;function s(d){const f=O2(d);n[f]||(function(m,_){const y=C_.toCamelCase(" "+_);["get","set","has"].forEach(T=>{Object.defineProperty(m,T+y,{value:function(w,L,B){return this[T].call(this,_,w,L,B)},configurable:!0})})}(a,d),n[f]=!0)}return C_.isArray(e)?e.forEach(s):s(e),this}}PH.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),C_.reduceDescriptors(PH.prototype,(t,e)=>{let{value:n}=t,a=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[a]=s}}}),C_.freezeMethods(PH);var SI=PH;function HY(t,e){const n=this||FY,a=e||n,s=SI.from(a.headers);let d=a.data;return C_.forEach(t,function(f){d=f.call(n,d,s.normalize(),e?e.status:void 0)}),s.normalize(),d}function WQ(t){return!(!t||!t.__CANCEL__)}function HV(t,e,n){wS.call(this,t??"canceled",wS.ERR_CANCELED,e,n),this.name="CanceledError"}function YQ(t,e,n){const a=n.config.validateStatus;n.status&&a&&!a(n.status)?e(new wS("Request failed with status code "+n.status,[wS.ERR_BAD_REQUEST,wS.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}C_.inherits(HV,wS,{__CANCEL__:!0});const MH=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const s=function(d,f){d=d||10;const m=new Array(d),_=new Array(d);let y,T=0,w=0;return f=f!==void 0?f:1e3,function(L){const B=Date.now(),Q=_[w];y||(y=B),m[T]=L,_[T]=B;let X=w,J=0;for(;X!==T;)J+=m[X++],X%=d;if(T=(T+1)%d,T===w&&(w=(w+1)%d),B-y<f)return;const _n=Q&&B-Q;return _n?Math.round(1e3*J/_n):void 0}}(50,250);return function(d,f){let m,_,y=0,T=1e3/f;const w=function(L){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),d.apply(null,L)};return[function(){const L=Date.now(),B=L-y;for(var Q=arguments.length,X=new Array(Q),J=0;J<Q;J++)X[J]=arguments[J];B>=T?w(X,L):(m=X,_||(_=setTimeout(()=>{_=null,w(m)},T-B)))},()=>m&&w(m)]}(d=>{const f=d.loaded,m=d.lengthComputable?d.total:void 0,_=f-a,y=s(_);a=f,t({loaded:f,total:m,progress:m?f/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&f<=m?(m-f)/y:void 0,event:d,lengthComputable:m!=null,[e?"download":"upload"]:!0})},n)},XQ=(t,e)=>{const n=t!=null;return[a=>e[0]({lengthComputable:n,total:t,loaded:a}),e[1]]},JQ=t=>function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return C_.asap(()=>t(...n))};var Gdt=h0.hasStandardBrowserEnv?((t,e)=>n=>(n=new lH(n,h0.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new lH(h0.origin),h0.navigator&&/(msie|trident)/i.test(h0.navigator.userAgent)):()=>!0,Hdt=h0.hasStandardBrowserEnv?{write(t,e,n,a,s,d){const f=[t+"="+encodeURIComponent(e)];C_.isNumber(n)&&f.push("expires="+new Date(n).toGMTString()),C_.isString(a)&&f.push("path="+a),C_.isString(s)&&f.push("domain="+s),d===!0&&f.push("secure"),document.cookie=f.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function ZQ(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,a){return a?n.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):n}(t,e):e}function QQ(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}const $Q=t=>t instanceof SI?function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?QQ(Object(a),!0).forEach(function(s){_t(e,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):QQ(Object(a)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(a,s))})}return e}({},t):t;function fM(t,e){e=e||{};const n={};function a(y,T,w,L){return C_.isPlainObject(y)&&C_.isPlainObject(T)?C_.merge.call({caseless:L},y,T):C_.isPlainObject(T)?C_.merge({},T):C_.isArray(T)?T.slice():T}function s(y,T,w,L){return C_.isUndefined(T)?C_.isUndefined(y)?void 0:a(void 0,y,0,L):a(y,T,0,L)}function d(y,T){if(!C_.isUndefined(T))return a(void 0,T)}function f(y,T){return C_.isUndefined(T)?C_.isUndefined(y)?void 0:a(void 0,y):a(void 0,T)}function m(y,T,w){return w in e?a(y,T):w in t?a(void 0,y):void 0}const _={url:d,method:d,data:d,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,withXSRFToken:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:m,headers:(y,T,w)=>s($Q(y),$Q(T),0,!0)};return C_.forEach(Object.keys(Object.assign({},t,e)),function(y){const T=_[y]||s,w=T(t[y],e[y],y);C_.isUndefined(w)&&T!==m||(n[y]=w)}),n}var t$=t=>{const e=fM({},t);let n,{data:a,withXSRFToken:s,xsrfHeaderName:d,xsrfCookieName:f,headers:m,auth:_}=e;if(e.headers=m=SI.from(m),e.url=gZ(ZQ(e.baseURL,e.url),t.params,t.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),C_.isFormData(a)){if(h0.hasStandardBrowserEnv||h0.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((n=m.getContentType())!==!1){const[y,...T]=n?n.split(";").map(w=>wR(w).call(w)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...T].join("; "))}}if(h0.hasStandardBrowserEnv&&(s&&C_.isFunction(s)&&(s=s(e)),s||s!==!1&&Gdt(e.url))){const y=d&&f&&Hdt.read(f);y&&m.set(d,y)}return e},qdt=typeof XMLHttpRequest<"u"&&function(t){return new A_(function(e,n){const a=t$(t);let s=a.data;const d=SI.from(a.headers).normalize();let f,m,_,y,T,{responseType:w,onUploadProgress:L,onDownloadProgress:B}=a;function Q(){y&&y(),T&&T(),a.cancelToken&&a.cancelToken.unsubscribe(f),a.signal&&a.signal.removeEventListener("abort",f)}let X=new XMLHttpRequest;function J(){if(!X)return;const _r=SI.from("getAllResponseHeaders"in X&&X.getAllResponseHeaders());YQ(function(ya){e(ya),Q()},function(ya){n(ya),Q()},{data:w&&w!=="text"&&w!=="json"?X.response:X.responseText,status:X.status,statusText:X.statusText,headers:_r,config:t,request:X}),X=null}X.open(a.method.toUpperCase(),a.url,!0),X.timeout=a.timeout,"onloadend"in X?X.onloadend=J:X.onreadystatechange=function(){X&&X.readyState===4&&(X.status!==0||X.responseURL&&X.responseURL.indexOf("file:")===0)&&setTimeout(J)},X.onabort=function(){X&&(n(new wS("Request aborted",wS.ECONNABORTED,t,X)),X=null)},X.onerror=function(){n(new wS("Network Error",wS.ERR_NETWORK,t,X)),X=null},X.ontimeout=function(){let _r=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const ya=a.transitional||vZ;a.timeoutErrorMessage&&(_r=a.timeoutErrorMessage),n(new wS(_r,ya.clarifyTimeoutError?wS.ETIMEDOUT:wS.ECONNABORTED,t,X)),X=null},s===void 0&&d.setContentType(null),"setRequestHeader"in X&&C_.forEach(d.toJSON(),function(_r,ya){X.setRequestHeader(ya,_r)}),C_.isUndefined(a.withCredentials)||(X.withCredentials=!!a.withCredentials),w&&w!=="json"&&(X.responseType=a.responseType),B&&([_,T]=MH(B,!0),X.addEventListener("progress",_)),L&&X.upload&&([m,y]=MH(L),X.upload.addEventListener("progress",m),X.upload.addEventListener("loadend",y)),(a.cancelToken||a.signal)&&(f=_r=>{X&&(n(!_r||_r.type?new HV(null,t,X):_r),X.abort(),X=null)},a.cancelToken&&a.cancelToken.subscribe(f),a.signal&&(a.signal.aborted?f():a.signal.addEventListener("abort",f)));const _n=function(_r){const ya=/^([-+\w]{1,25})(:?\/\/|:)/.exec(_r);return ya&&ya[1]||""}(a.url);_n&&h0.protocols.indexOf(_n)===-1?n(new wS("Unsupported protocol "+_n+":",wS.ERR_BAD_REQUEST,t)):X.send(s||null)})},zdt=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let a,s=new AbortController;const d=function(y){if(!a){a=!0,m();const T=y instanceof Error?y:this.reason;s.abort(T instanceof wS?T:new HV(T instanceof Error?T.message:T))}};let f=e&&setTimeout(()=>{f=null,d(new wS("timeout ".concat(e," of ms exceeded"),wS.ETIMEDOUT))},e);const m=()=>{t&&(f&&clearTimeout(f),f=null,t.forEach(y=>{y.unsubscribe?y.unsubscribe(d):y.removeEventListener("abort",d)}),t=null)};t.forEach(y=>y.addEventListener("abort",d));const{signal:_}=s;return _.unsubscribe=()=>C_.asap(m),_}},Kdt=bP,Wdt=OO;SS({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=Wdt.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Ydt=OO,Xdt=CO;SS({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=Ydt.f(this),n=Xdt(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var qY=h(Kdt),e$=VV.f("asyncIterator"),Jdt=h(e$);function zY(t,e){this.v=t,this.k=e}function w2(t){var e,n;function a(d,f){try{var m=t[d](f),_=m.value,y=_ instanceof zY;qY.resolve(y?_.v:_).then(function(T){if(y){var w=d==="return"?"return":"next";if(!_.k||T.done)return a(w,T);T=t[w](T).value}s(m.done?"return":"normal",T)},function(T){a("throw",T)})}catch(T){s("throw",T)}}function s(d,f){switch(d){case"return":e.resolve({value:f,done:!0});break;case"throw":e.reject(f);break;default:e.resolve({value:f,done:!1})}(e=e.next)?a(e.key,e.arg):n=null}this._invoke=function(d,f){return new qY(function(m,_){var y={key:d,arg:f,resolve:m,reject:_,next:null};n?n=n.next=y:(e=n=y,a(d,f))})},typeof t.return!="function"&&(this.return=void 0)}function oO(t){return function(){return new w2(t.apply(this,arguments))}}function uS(t){return new zY(t,0)}function xH(t){var e={},n=!1;function a(s,d){return n=!0,{done:!1,value:new zY(d=new qY(function(f){f(t[s](d))}),1)}}return e[GV!==void 0&&IQ||"@@iterator"]=function(){return this},e.next=function(s){return n?(n=!1,s):a("next",s)},typeof t.throw=="function"&&(e.throw=function(s){if(n)throw n=!1,s;return a("throw",s)}),typeof t.return=="function"&&(e.return=function(s){return n?(n=!1,s):a("return",s)}),e}w2.prototype[typeof GV=="function"&&Jdt||"@@asyncIterator"]=function(){return this},w2.prototype.next=function(t){return this._invoke("next",t)},w2.prototype.throw=function(t){return this._invoke("throw",t)},w2.prototype.return=function(t){return this._invoke("return",t)};var KY=h(e$);function WY(t){var e,n,a,s=2;for(typeof Symbol<"u"&&(n=KY,a=Symbol.iterator);s--;){if(n&&(e=t[n])!=null)return e.call(t);if(a&&(e=t[a])!=null)return new UH(e.call(t));n="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function UH(t){function e(n){if(Object(n)!==n)return A_.reject(new TypeError(n+" is not an object."));var a=n.done;return A_.resolve(n.value).then(function(s){return{value:s,done:a}})}return UH=function(n){this.s=n,this.n=n.next},UH.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var a=this.s.return;return a===void 0?A_.resolve({value:n,done:!0}):e(a.apply(this.s,arguments))},throw:function(n){var a=this.s.return;return a===void 0?A_.reject(n):e(a.apply(this.s,arguments))}},new UH(t)}const Zdt=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let a,s=0;for(;s<n;)a=s+e,yield t.slice(s,a),s=a},Qdt=function(){var t=oO(function*(e,n){var a,s=!1,d=!1;try{for(var f,m=WY($dt(e));s=!(f=yield uS(m.next())).done;s=!1){const _=f.value;yield*xH(WY(Zdt(_,n)))}}catch(_){d=!0,a=_}finally{try{s&&m.return!=null&&(yield uS(m.return()))}finally{if(d)throw a}}});return function(e,n){return t.apply(this,arguments)}}(),$dt=function(){var t=oO(function*(e){if(e[KY])return void(yield*xH(WY(e)));const n=e.getReader();try{for(;;){const{done:a,value:s}=yield uS(n.read());if(a)break;yield s}}finally{yield uS(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),n$=(t,e,n,a)=>{const s=Qdt(t,e);let d,f=0,m=_=>{d||(d=!0,a&&a(_))};return new ReadableStream({async pull(_){try{const{done:y,value:T}=await s.next();if(y)return m(),void _.close();let w=T.byteLength;if(n){let L=f+=w;n(L)}_.enqueue(new Uint8Array(T))}catch(y){throw m(y),y}},cancel:_=>(m(_),s.return())},{highWaterMark:2})};function r$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function i$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?r$(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r$(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}const jH=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",o$=jH&&typeof ReadableStream=="function",tht=jH&&(typeof TextEncoder=="function"?(a$=new TextEncoder,t=>a$.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var a$;const s$=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];return!!t(...n)}catch{return!1}},eht=o$&&s$(()=>{let t=!1;const e=new Request(h0.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),YY=o$&&s$(()=>C_.isReadableStream(new Response("").body)),VH={stream:YY&&(t=>t.body)};var c$;jH&&(c$=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!VH[t]&&(VH[t]=C_.isFunction(c$[t])?e=>e[t]():(e,n)=>{throw new wS("Response type '".concat(t,"' is not supported"),wS.ERR_NOT_SUPPORT,n)})}));const nht=async(t,e)=>{const n=C_.toFiniteNumber(t.getContentLength());return n??(async a=>a==null?0:C_.isBlob(a)?a.size:C_.isSpecCompliantForm(a)?(await new Request(h0.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:C_.isArrayBufferView(a)||C_.isArrayBuffer(a)?a.byteLength:(C_.isURLSearchParams(a)&&(a+=""),C_.isString(a)?(await tht(a)).byteLength:void 0))(e)};var rht=jH&&(async t=>{let{url:e,method:n,data:a,signal:s,cancelToken:d,timeout:f,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:T,withCredentials:w="same-origin",fetchOptions:L}=t$(t);y=y?(y+"").toLowerCase():"text";let B,Q=zdt([s,d&&d.toAbortSignal()],f);const X=Q&&Q.unsubscribe&&(()=>{Q.unsubscribe()});let J;try{if(_&&eht&&n!=="get"&&n!=="head"&&(J=await nht(T,a))!==0){let _d,tu=new Request(e,{method:"POST",body:a,duplex:"half"});if(C_.isFormData(a)&&(_d=tu.headers.get("content-type"))&&T.setContentType(_d),tu.body){const[_g,l_]=XQ(J,MH(JQ(_)));a=n$(tu.body,65536,_g,l_)}}C_.isString(w)||(w=w?"include":"omit");const _n="credentials"in Request.prototype;B=new Request(e,i$(i$({},L),{},{signal:Q,method:n.toUpperCase(),headers:T.normalize().toJSON(),body:a,duplex:"half",credentials:_n?w:void 0}));let _r=await fetch(B);const ya=YY&&(y==="stream"||y==="response");if(YY&&(m||ya&&X)){const _d={};["status","statusText","headers"].forEach(O_=>{_d[O_]=_r[O_]});const tu=C_.toFiniteNumber(_r.headers.get("content-length")),[_g,l_]=m&&XQ(tu,MH(JQ(m),!0))||[];_r=new Response(n$(_r.body,65536,_g,()=>{l_&&l_(),X&&X()}),_d)}y=y||"text";let _l=await VH[C_.findKey(VH,y)||"text"](_r,t);return!ya&&X&&X(),await new A_((_d,tu)=>{YQ(_d,tu,{data:_l,headers:SI.from(_r.headers),status:_r.status,statusText:_r.statusText,config:t,request:B})})}catch(_n){throw X&&X(),_n&&_n.name==="TypeError"&&/fetch/i.test(_n.message)?Object.assign(new wS("Network Error",wS.ERR_NETWORK,t,B),{cause:_n.cause||_n}):wS.from(_n,_n&&_n.code,t,B)}});const XY={http:null,xhr:qdt,fetch:rht};C_.forEach(XY,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const u$=t=>"- ".concat(t),iht=t=>C_.isFunction(t)||t===null||t===!1;var l$={getAdapter:t=>{t=C_.isArray(t)?t:[t];const{length:e}=t;let n,a;const s={};for(let d=0;d<e;d++){let f;if(n=t[d],a=n,!iht(n)&&(a=XY[(f=String(n)).toLowerCase()],a===void 0))throw new wS("Unknown adapter '".concat(f,"'"));if(a)break;s[f||"#"+d]=a}if(!a){const d=Object.entries(s).map(f=>{let[m,_]=f;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new wS("There is no suitable adapter to dispatch the request "+(e?d.length>1?`since :
`+d.map(u$).join(`
`):" "+u$(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:XY};function JY(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new HV(null,t)}function d$(t){return JY(t),t.headers=SI.from(t.headers),t.data=HY.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),l$.getAdapter(t.adapter||FY.adapter)(t).then(function(e){return JY(t),e.data=HY.call(t,t.transformResponse,e),e.headers=SI.from(e.headers),e},function(e){return WQ(e)||(JY(t),e&&e.response&&(e.response.data=HY.call(t,t.transformResponse,e.response),e.response.headers=SI.from(e.response.headers))),A_.reject(e)})}const h$="1.7.9",BH={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{BH[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const p$={};BH.transitional=function(t,e,n){function a(s,d){return"[Axios v"+h$+"] Transitional option '"+s+"'"+d+(n?". "+n:"")}return(s,d,f)=>{if(t===!1)throw new wS(a(d," has been removed"+(e?" in "+e:"")),wS.ERR_DEPRECATED);return e&&!p$[d]&&(p$[d]=!0,console.warn(a(d," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(s,d,f)}},BH.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var FH={assertOptions:function(t,e,n){if(typeof t!="object")throw new wS("options must be an object",wS.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let s=a.length;for(;s-- >0;){const d=a[s],f=e[d];if(f){const m=t[d],_=m===void 0||f(m,d,t);if(_!==!0)throw new wS("option "+d+" must be "+_,wS.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new wS("Unknown option "+d,wS.ERR_BAD_OPTION)}},validators:BH};const gN=FH.validators;let GH=class{constructor(t){this.defaults=t,this.interceptors={request:new _Z,response:new _Z}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const s=a.stack?a.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=fM(this.defaults,e);const{transitional:n,paramsSerializer:a,headers:s}=e;n!==void 0&&FH.assertOptions(n,{silentJSONParsing:gN.transitional(gN.boolean),forcedJSONParsing:gN.transitional(gN.boolean),clarifyTimeoutError:gN.transitional(gN.boolean)},!1),a!=null&&(C_.isFunction(a)?e.paramsSerializer={serialize:a}:FH.assertOptions(a,{encode:gN.function,serialize:gN.function},!0)),FH.assertOptions(e,{baseUrl:gN.spelling("baseURL"),withXsrfToken:gN.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let d=s&&C_.merge(s.common,s[e.method]);s&&C_.forEach(["delete","get","head","post","put","patch","common"],B=>{delete s[B]}),e.headers=SI.concat(d,s);const f=[];let m=!0;this.interceptors.request.forEach(function(B){typeof B.runWhen=="function"&&B.runWhen(e)===!1||(m=m&&B.synchronous,f.unshift(B.fulfilled,B.rejected))});const _=[];let y;this.interceptors.response.forEach(function(B){_.push(B.fulfilled,B.rejected)});let T,w=0;if(!m){const B=[d$.bind(this),void 0];for(B.unshift.apply(B,f),B.push.apply(B,_),T=B.length,y=A_.resolve(e);w<T;)y=y.then(B[w++],B[w++]);return y}T=f.length;let L=e;for(w=0;w<T;){const B=f[w++],Q=f[w++];try{L=B(L)}catch(X){Q.call(this,X);break}}try{y=d$.call(this,L)}catch(B){return A_.reject(B)}for(w=0,T=_.length;w<T;)y=y.then(_[w++],_[w++]);return y}getUri(t){return gZ(ZQ((t=fM(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};C_.forEach(["delete","get","head","options"],function(t){GH.prototype[t]=function(e,n){return this.request(fM(n||{},{method:t,url:e,data:(n||{}).data}))}}),C_.forEach(["post","put","patch"],function(t){function e(n){return function(a,s,d){return this.request(fM(d||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:s}))}}GH.prototype[t]=e(),GH.prototype[t+"Form"]=e(!0)});var HH=GH;class ZY{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new A_(function(s){n=s});const a=this;this.promise.then(s=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](s);a._listeners=null}),this.promise.then=s=>{let d;const f=new A_(m=>{a.subscribe(m),d=m}).then(s);return f.cancel=function(){a.unsubscribe(d)},f},e(function(s,d,f){a.reason||(a.reason=new HV(s,d,f),n(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=a=>{e.abort(a)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new ZY(function(a){e=a}),cancel:e}}}var oht=ZY;const QY={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(QY).forEach(t=>{let[e,n]=t;QY[n]=e});var aht=QY;const bR=function t(e){const n=new HH(e),a=$J(HH.prototype.request,n);return C_.extend(a,HH.prototype,n,{allOwnKeys:!0}),C_.extend(a,n,null,{allOwnKeys:!0}),a.create=function(s){return t(fM(e,s))},a}(FY);bR.Axios=HH,bR.CanceledError=HV,bR.CancelToken=oht,bR.isCancel=WQ,bR.VERSION=h$,bR.toFormData=SH,bR.AxiosError=wS,bR.Cancel=bR.CanceledError,bR.all=function(t){return A_.all(t)},bR.spread=function(t){return function(e){return t.apply(null,e)}},bR.isAxiosError=function(t){return C_.isObject(t)&&t.isAxiosError===!0},bR.mergeConfig=fM,bR.AxiosHeaders=SI,bR.formToJSON=t=>zQ(C_.isHTMLForm(t)?new FormData(t):t),bR.getAdapter=l$.getAdapter,bR.HttpStatusCode=aht,bR.default=bR;var WR=bR;const sht=()=>{};function I2(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:sht};return t.promise=new A_((e,n)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(a))}}),t}const qH=new Map,zH=new Map,_N=new Map;let jT=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),mS=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const f$=new Rct;let TI=f$.getResult(),$Y=null;function lS(t){if(!$Y){TI=f$.getResult();const e=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return mS.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return mS.CHROME;case"Safari":case"Mobile Safari":return mS.SAFARI;case"Edge":return mS.EDGE;case"Firefox":return mS.FIREFOX;case"QQ":case"QQBrowser":return mS.QQ;case"Opera":return mS.OPERA;case"WeChat":return mS.WECHAT;default:return m.browser.name||""}}(TI),n=m$(TI),a=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(TI),s=TI.os.version,d=m$(TI,!1),f=TI.device.type;if(!(e&&n&&a&&s))return{name:e,version:n,os:a,osVersion:s,browserVersion:d,deviceType:f};$Y={name:e,version:n,os:a,osVersion:s,browserVersion:d,deviceType:f}}return $Y}function m$(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function KH(){return lS().os}function E$(){const t=lS();return"".concat(t.os," ").concat(t.osVersion)}function WH(){const t=lS();return!!(TI.engine.name==="WebKit"&&t.os===jT.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==mS.SAFARI||MR()&&t.name!==mS.SAFARI)}function dL(){return lS().name===mS.CHROME}function aR(){return lS().name===mS.SAFARI}function g$(){return lS().name===mS.EDGE}function rT(){return lS().name===mS.FIREFOX}function MR(){return lS().os===jT.IOS}function N2(t){const e=lS();return!(e.name!==mS.CHROME||!e.osVersion)&&Number(e.version)>=t}function _$(t){const e=lS();return!(e.name!==mS.CHROME||!e.osVersion)&&Number(e.version)<t}function t7(t,e,n){const a=lS();return!(a.name!==t||!a.osVersion)&&(n?Number(a.version)>=e&&Number(a.version)<=n:Number(a.version)===e)}function e7(t){const e=lS();return!(e.name!==mS.EDGE||!e.osVersion)&&Number(e.version)>=t}function v$(t){const e=lS();return!(e.name!==mS.SAFARI||!e.osVersion)&&Number(e.version)>=t}function y$(t,e,n){const a=lS();if(a.os!==jT.IOS||!a.osVersion)return!1;const s=a.osVersion.split(".");return e&&Number(s[0])===t&&Number(s[1])<e||Number(s[0])<t}function b$(t,e,n){const a=lS();if(a.name!==mS.SAFARI||!a.osVersion||!a.browserVersion)return!1;const s=a.browserVersion.split(".");return n?e&&Number(s[0])===t&&Number(s[1])<e||Number(s[0])<t:e?Number(s[0])===t&&Number(s[1])<=e||Number(s[0])<t:Number(s[0])<=t}function n7(t){const e=lS();return!(e.name!==mS.OPERA||!e.osVersion)&&Number(e.version)>=t}function S$(){const t=lS();if(t.os!==jT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function qV(){const t=lS();if(t.os!==jT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function r7(){const t=lS();if(t.os!==jT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function T$(){const t=lS();if(t.os!==jT.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function MO(){return aR()&&navigator.maxTouchPoints>0}function R$(){return lS().name===mS.WECHAT}function A$(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function i7(){const t=KH();return function(){const{deviceType:e}=lS();return e==="mobile"||e==="tablet"}()||t===jT.ANDROID||t===jT.IOS||t===jT.HARMONY_OS}function hL(){const t=lS();return t.name!==mS.EDGE&&t.name!==mS.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function YH(){return KH()===jT.ANDROID}function D2(){const t=lS();return YH()&&(t.name===mS.CHROME||t.name===mS.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function C$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function D_(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?C$(Object(n),!0).forEach(function(a){$_(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C$(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function $_(t,e,n){return(e=function(a){var s=function(d,f){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var _=m.call(d,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof s=="symbol"?s:String(s)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let _i=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),t_=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),$_(this,"code",void 0),$_(this,"message",void 0),$_(this,"data",void 0),$_(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function pL(t,e){if(typeof t!="boolean")throw new t_(_i.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function MT(t,e,n){if(!T_(n).call(n,t))throw new t_(_i.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function IS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(t))throw new t_(_i.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(a,"]. integer only"))}function o7(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new t_(_i.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&IS(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&IS(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&IS(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&IS(t.ideal,"".concat(e,".ideal"),1,1/0)}else IS(t,e,1,1/0)}function ZT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new t_(_i.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!O$(t,n,a,s))throw new t_(_i.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(a,"].").concat(s?" ASCII characters only.":""))}function fL(t,e){if(!Array.isArray(t))throw new t_(_i.INVALID_PARAMS,"".concat(e," should be an array"))}function iT(t){return t==null}function O$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!a||function(s){if(typeof s!="string")return!1;for(let d=0;d<s.length;d+=1){const f=s.charCodeAt(d);if(f<0||f>255)return!1}return!0}(t))}var k2=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(k2||{}),a7=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(a7||{});const w$=new class{constructor(){$_(this,"_clientSize",null),$_(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),$_(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),$_(this,"getStyle",t=>window.getComputedStyle(t,null)),$_(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const a=this.getStyle(t),{display:s,visibility:d,opacity:f,filter:m}=a;return(s==="none"||T_(e=["hidden","collapse"]).call(e,d)||Number(f)<.1)&&(n=!1),!!n&&(m&&m.split(" ").filter(_=>{var y;const T=_.split("(")[0];return T_(y=["brightness","blur","opacity"]).call(y,T)}).map(_=>{const[y,T]=_.split(/\(|\)/);return[y,Number(T.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,T]=_;switch(y){case"brightness":(T<.1||T>3)&&(n=!1);break;case"blur":T>3&&(n=!1);break;case"opacity":T<.1&&(n=!1)}}),n)}),$_(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,a=!0;const s=f=>e(f);let d=t;for(;d&&a;)s(d)||(n=!1,a=!1),d=d.parentElement,d||(a=!1);return n}),$_(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),$_(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:a,right:s,top:d,bottom:f}=t.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:e,height:n,left:a,right:s,top:d,bottom:f,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),$_(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),$_(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),$_(this,"checkCoverForAPoint",(t,e,n)=>{const a=this.elementFromPoint(t,e);return a!==null&&a!==n}),$_(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:a}=this._clientSize,s=t/6,d=e/6,f=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const T=(n*m+(_===0?.1:_===4?(s*_*m-1e5)/m:s*_)*m)/m,w=(a*m+(y===0?.1:y===4?(d*y*m-1e5)/m:d*y)*m)/m;f.push({x:T,y:w})}return[...f]}),$_(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),$_(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),$_(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:a,clientHeight:s,clientWidth:d,clientMin:f}=this._clientSize;let m,_,y,T;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(e<0)return!1;if(_=e<d?e:d,n<0)y=0;else{if(!(n<s))return!1;y=n}if(a<0)return!1;T=a<s?a:s;const w=_-m,L=T-y;return this.checkSizeIsVisible(w,L,f)}),$_(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),$_(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(k2.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(k2.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(k2.SIZE)}}return this.returnHiddenResult(k2.STYLE)}return this.returnHiddenResult(a7.UNMOUNTED)}return this.returnHiddenResult(a7.INVALID_HTML_ELEMENT)}),$_(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function s7(t){return new TextEncoder().encode(t)}const I$=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},c7=async t=>function(e,n){let a="";return new Uint8Array(e).forEach(s=>{a+=s.toString(n).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",s7(t)),16);let eT=class{constructor(){$_(this,"_events",{}),$_(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],a=this._indexOfListener(n,e);a!==-1&&n.splice(a,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(d=>d);for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];for(let d=0;d<e.length;d+=1){const f=e[d];f.once&&this.off(t,f.listener),f.listener.apply(this,a||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];[...this._events[t]||[]].forEach(s=>{s.once&&this.off(t,s.listener);try{s.listener.apply(this,n)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},L2=null;function N$(){if(L2)return L2;if(window.electron)return L2=window.electron;if(!window.require)return null;try{return L2=window.require("electron"),L2}catch{return null}}let OT=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),oT=function(t){return t.TRACER="tracer",t}({});function D$(t){return IS(t.timeout,"config.timeout",0,1e5),IS(t.timeoutFactor,"config.timeoutFactor",0,100,!1),IS(t.maxRetryCount,"config.maxRetryConfig",0,1/0),IS(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let cht=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),vS=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function P2(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function k$(t){return ZT(t.turnServerURL,"turnServerURL"),ZT(t.username,"username"),ZT(t.password,"password"),t.udpport&&IS(t.udpport,"udpport",1,99999,!0),t.forceturn&&pL(t.forceturn,"forceturn"),t.security&&pL(t.security,"security"),t.tcpport&&IS(t.tcpport,"tcpport",1,99999,!0),!0}function u7(t){return t.level!==void 0&&MT(t.level,"level",[1,2,3]),t.delay!==void 0&&IS(t.delay,"delay",0,3e3,!0),!0}let eS=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),sR=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),O0=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),zV=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function cR(t,e){for(var n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];return t.getListeners(e).length===0?A_.reject(new t_(_i.UNEXPECTED_ERROR,"can not emit promise")):new A_((d,f)=>{t.emit(e,...a,d,f)})}function MS(t,e){if(t.getListeners(e).length===0)return A_.resolve();for(var n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];return cR(t,e,...a)}function U0(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,a=new Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];return M2(t,e,...a)}function M2(t,e){let n=null,a=null;for(var s=arguments.length,d=new Array(s>2?s-2:0),f=2;f<s;f++)d[f-2]=arguments[f];if(t.emit(e,...d,m=>{n=m},m=>{a=m}),a!==null)throw a;if(n===null)throw new t_(_i.UNEXPECTED_ERROR,"handler is not sync");return n}const ST=new class extends eT{set networkState(t){this.emit(zV.NETWORK_STATE_CHANGE,t,this._networkState),t===O0.ONLINE?this.emit(zV.ONLINE):t===O0.OFFLINE&&(this.onlineWaiter=new A_(e=>{this.once(zV.ONLINE,()=>{this.onlineWaiter=void 0,e(O0.ONLINE)})}),this.emit(zV.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===O0.ONLINE}constructor(){super(),$_(this,"_moduleName","network-indicator"),$_(this,"_networkState",O0.ONLINE),$_(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=O0.ONLINE}),window.addEventListener("offline",()=>{this.networkState=O0.OFFLINE})}};function XH(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function KV(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function JH(t){A_!==void 0?A_.resolve().then(t):setTimeout(t,0)}function aT(t){return JSON.parse(JSON.stringify(t))}function mM(t){try{return aT(t)}catch{return t}}const L$={};function IP(t,e){L$[e]||(L$[e]=!0,t())}function EM(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let a=0;a<e.length;a+=1)n[a]=e.charCodeAt(a);return n}function NP(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function P$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const a=new Uint8Array(e);a.set(n),n=a}return n}function M$(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const a=LR(e).call(e,(f,m)=>f+m.length,0),s=new Uint8Array(new ArrayBuffer(a));let d=0;return e.forEach(f=>{s.set(f,d),d+=f.length}),s}function vN(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function x$(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?vN(n):n.size}),e+138}function uht(t){const e=new t_(_i.TIMEOUT,"timeout");return new A_((n,a)=>{window.setTimeout(()=>a(e),t)})}function QT(t){return new A_(e=>{window.setTimeout(e,t)})}function xS(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+xS(t-n.length,"")}function gM(){return xS(32,"").toUpperCase()}const ZH=()=>{},U$=new class{constructor(){$_(this,"fnMap",new Map)}throttleByKey(t,e,n,a){for(var s=arguments.length,d=new Array(s>4?s-4:0),f=4;f<s;f++)d[f-4]=arguments[f];if(this.fnMap.has(e)){const m=this.fnMap.get(e);if(m.threshold!==n){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(e);y&&y.fn(...y.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:_,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(e,D_(D_({},m),{},{fn:t,args:d,skipFn:a}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(e);_&&_.fn(..._.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:m,args:d,skipFn:a})}}},j$=U$.throttleByKey.bind(U$);function V$(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function l7(t,e){if(!V$(t)||!V$(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let a=0;a<e.length;a++)n[a]=l7(t[a],e[a]);return n}{const n=D_({},t);for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(Object.prototype.hasOwnProperty.call(t,a)?n[a]=l7(t[a],e[a]):n[a]=e[a]);return n}}function B$(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let a=0;for(;t>0&&(n[a]=255&t,t>>=8,a++,a!==e););return n}function d7(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function F$(t){const e="0123456789abcdef";function n(ya){let _l,_d="";for(_l=0;_l<=3;_l++)_d+=e.charAt(ya>>8*_l+4&15)+e.charAt(ya>>8*_l&15);return _d}function a(ya,_l){const _d=(65535&ya)+(65535&_l);return(ya>>16)+(_l>>16)+(_d>>16)<<16|65535&_d}function s(ya,_l,_d,tu,_g,l_){return a(function(O_,N_){return O_<<N_|O_>>>32-N_}(a(a(_l,ya),a(tu,l_)),_g),_d)}function d(ya,_l,_d,tu,_g,l_,O_){return s(_l&_d|~_l&tu,ya,_l,_g,l_,O_)}function f(ya,_l,_d,tu,_g,l_,O_){return s(_l&tu|_d&~tu,ya,_l,_g,l_,O_)}function m(ya,_l,_d,tu,_g,l_,O_){return s(_l^_d^tu,ya,_l,_g,l_,O_)}function _(ya,_l,_d,tu,_g,l_,O_){return s(_d^(_l|~tu),ya,_l,_g,l_,O_)}const y=function(ya){let _l;const _d=1+(ya.length+8>>6),tu=new Array(16*_d);for(_l=0;_l<16*_d;_l++)tu[_l]=0;for(_l=0;_l<ya.length;_l++)tu[_l>>2]|=ya.charCodeAt(_l)<<_l%4*8;return tu[_l>>2]|=128<<_l%4*8,tu[16*_d-2]=8*ya.length,tu}(t);let T,w,L,B,Q,X=1732584193,J=-271733879,_n=-1732584194,_r=271733878;for(T=0;T<y.length;T+=16)w=X,L=J,B=_n,Q=_r,X=d(X,J,_n,_r,y[T+0],7,-680876936),_r=d(_r,X,J,_n,y[T+1],12,-389564586),_n=d(_n,_r,X,J,y[T+2],17,606105819),J=d(J,_n,_r,X,y[T+3],22,-1044525330),X=d(X,J,_n,_r,y[T+4],7,-176418897),_r=d(_r,X,J,_n,y[T+5],12,1200080426),_n=d(_n,_r,X,J,y[T+6],17,-1473231341),J=d(J,_n,_r,X,y[T+7],22,-45705983),X=d(X,J,_n,_r,y[T+8],7,1770035416),_r=d(_r,X,J,_n,y[T+9],12,-1958414417),_n=d(_n,_r,X,J,y[T+10],17,-42063),J=d(J,_n,_r,X,y[T+11],22,-1990404162),X=d(X,J,_n,_r,y[T+12],7,1804603682),_r=d(_r,X,J,_n,y[T+13],12,-40341101),_n=d(_n,_r,X,J,y[T+14],17,-1502002290),J=d(J,_n,_r,X,y[T+15],22,1236535329),X=f(X,J,_n,_r,y[T+1],5,-165796510),_r=f(_r,X,J,_n,y[T+6],9,-1069501632),_n=f(_n,_r,X,J,y[T+11],14,643717713),J=f(J,_n,_r,X,y[T+0],20,-373897302),X=f(X,J,_n,_r,y[T+5],5,-701558691),_r=f(_r,X,J,_n,y[T+10],9,38016083),_n=f(_n,_r,X,J,y[T+15],14,-660478335),J=f(J,_n,_r,X,y[T+4],20,-405537848),X=f(X,J,_n,_r,y[T+9],5,568446438),_r=f(_r,X,J,_n,y[T+14],9,-1019803690),_n=f(_n,_r,X,J,y[T+3],14,-187363961),J=f(J,_n,_r,X,y[T+8],20,1163531501),X=f(X,J,_n,_r,y[T+13],5,-1444681467),_r=f(_r,X,J,_n,y[T+2],9,-51403784),_n=f(_n,_r,X,J,y[T+7],14,1735328473),J=f(J,_n,_r,X,y[T+12],20,-1926607734),X=m(X,J,_n,_r,y[T+5],4,-378558),_r=m(_r,X,J,_n,y[T+8],11,-2022574463),_n=m(_n,_r,X,J,y[T+11],16,1839030562),J=m(J,_n,_r,X,y[T+14],23,-35309556),X=m(X,J,_n,_r,y[T+1],4,-1530992060),_r=m(_r,X,J,_n,y[T+4],11,1272893353),_n=m(_n,_r,X,J,y[T+7],16,-155497632),J=m(J,_n,_r,X,y[T+10],23,-1094730640),X=m(X,J,_n,_r,y[T+13],4,681279174),_r=m(_r,X,J,_n,y[T+0],11,-358537222),_n=m(_n,_r,X,J,y[T+3],16,-722521979),J=m(J,_n,_r,X,y[T+6],23,76029189),X=m(X,J,_n,_r,y[T+9],4,-640364487),_r=m(_r,X,J,_n,y[T+12],11,-421815835),_n=m(_n,_r,X,J,y[T+15],16,530742520),J=m(J,_n,_r,X,y[T+2],23,-995338651),X=_(X,J,_n,_r,y[T+0],6,-198630844),_r=_(_r,X,J,_n,y[T+7],10,1126891415),_n=_(_n,_r,X,J,y[T+14],15,-1416354905),J=_(J,_n,_r,X,y[T+5],21,-57434055),X=_(X,J,_n,_r,y[T+12],6,1700485571),_r=_(_r,X,J,_n,y[T+3],10,-1894986606),_n=_(_n,_r,X,J,y[T+10],15,-1051523),J=_(J,_n,_r,X,y[T+1],21,-2054922799),X=_(X,J,_n,_r,y[T+8],6,1873313359),_r=_(_r,X,J,_n,y[T+15],10,-30611744),_n=_(_n,_r,X,J,y[T+6],15,-1560198380),J=_(J,_n,_r,X,y[T+13],21,1309151649),X=_(X,J,_n,_r,y[T+4],6,-145523070),_r=_(_r,X,J,_n,y[T+11],10,-1120210379),_n=_(_n,_r,X,J,y[T+2],15,718787259),J=_(J,_n,_r,X,y[T+9],21,-343485551),X=a(X,w),J=a(J,L),_n=a(_n,B),_r=a(_r,Q);return n(X)+n(J)+n(_n)+n(_r)}let lht=1,G$=console,mR=class{static setLogger(t){G$=t}constructor(t,e){$_(this,"id",void 0),$_(this,"lockingPromise",A_.resolve()),$_(this,"locks",0),$_(this,"name",""),$_(this,"lockId",void 0),this.lockId=lht++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");G$.debug("".concat(n," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new A_(s=>{e=()=>{this.locks-=1,this.logger("unlocked",t),s()}}),a=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),a}};function WV(t,e){return function(n,a,s){const d=s.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const f=this[e];if(!f)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const m=await f.lock("From ".concat(t,".").concat(a));try{for(var _=arguments.length,y=new Array(_),T=0;T<_;T++)y[T]=arguments[T];return await d.apply(this,y)}finally{m()}},s}}const wT={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function h7(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function RI(t,e,n,a){const s=Object.assign({},wT,a);let d=s.timeout;const f=async()=>{await function(y){return new A_(T=>{window.setTimeout(T,y)})}(d),d*=s.timeoutFactor,d=Math.min(s.maxRetryTimeout,d)};let m=!1;const _=new A_(async(y,T)=>{e=e||(()=>!1),n=n||(()=>!0);for(let w=0;w<s.maxRetryCount;w+=1){if(m)return T(new t_(_i.OPERATION_ABORTED));try{const L=await t();if(!e(L,w)||w+1===s.maxRetryCount)return y(L);await f()}catch(L){if(!n(L,w)||w+1===s.maxRetryCount)return T(L);await f()}}});return _.cancel=()=>m=!0,_}let QH,H$=class{constructor(t){$_(this,"input",[]),$_(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:LR(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},$H=0,p7=0;function f7(t,e,n,a){return new A_((s,d)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),$H+=vN(e.data)):n&&(e.data.size?$H+=e.data.size:e.data instanceof FormData?$H+=x$(e.data):$H+=vN(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,WR.request(e).then(f=>{typeof f.data=="string"?p7+=vN(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?p7+=f.data.byteLength:p7+=vN(JSON.stringify(f.data)),s(f.data)}).catch(f=>{WR.isCancel(f)?d(new t_(_i.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?d(new t_(_i.NETWORK_TIMEOUT,f.message)):f.response?d(new t_(_i.NETWORK_RESPONSE_ERROR,f.response.status)):d(new t_(_i.NETWORK_ERROR,f.message))})})}async function dht(t,e){const n=new Blob([e.data],{type:"buffer"});return await f7(t,D_(D_({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const q$=()=>window.isSecureContext!==void 0;function xO(t){if(Array.isArray(t))return t.map(n=>n);if(!z$(t))return t;const e={};for(const n in t){const a=t[n];z$(a)||Array.isArray(a)?e[n]=xO(a):e[n]=a}return e}function z$(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let m7=class{constructor(t){$_(this,"input",[]),$_(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const yN={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},x2={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:yN,remoteCandidate:yN},updateInterval:0},K$={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},W$={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Y$={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},X$={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let E7=class{constructor(t,e){$_(this,"onFirstVideoReceived",void 0),$_(this,"onFirstVideoDecoded",void 0),$_(this,"onFirstAudioReceived",void 0),$_(this,"onFirstVideoDecodedTimeout",void 0),$_(this,"onFirstAudioDecoded",void 0),$_(this,"onSelectedLocalCandidateChanged",void 0),$_(this,"onSelectedRemoteCandidateChanged",void 0),$_(this,"videoIsReady",!1),$_(this,"videoIsReady2",{}),$_(this,"pc",void 0),$_(this,"options",void 0),$_(this,"intervalTimer",void 0),$_(this,"stats",xO(x2)),$_(this,"isFirstVideoReceived",{}),$_(this,"isFirstVideoDecoded",{}),$_(this,"isFirstAudioReceived",{}),$_(this,"isFirstAudioDecoded",{}),$_(this,"isFirstVideoDecodedTimeout",{}),$_(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new A_(t=>{t({local:D_({},yN),remote:D_({},yN)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,s=0,d=0,f=0;for(const m of n)t[m].forEach((_,y)=>{if(!this.lossRateWindowStats[e-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const T=this.lossRateWindowStats[e-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,w=this.lossRateWindowStats[e-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(a+=T,d+=w):(s+=T,f+=w),Number.isNaN(T)||Number.isNaN(T)?_.packetLostRate=0:_.packetLostRate=T<=0||w<=0?0:w/(T+w)});t.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),t.recvPacketLossRate=s<=0||f<=0?0:f/(s+f)}},hht=class extends E7{constructor(){super(...arguments),$_(this,"_stats",x2),$_(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=xO(x2);const n=e.filter(s=>s.type==="ssrc");this.processSSRCStats(n);const a=e.find(s=>s.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const a=T_(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const s=xO(W$);s.codec=e.googCodecName,s.adaptionChangeReason="none",e.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(e.googAvgEncodeMs),s.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},s.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},s.firsCount=Number(e.googFirReceived),s.nacksCount=Number(e.googNacksReceived),s.plisCount=Number(e.googPlisReceived),s.frameCount=Number(e.framesEncoded),s.bytes=Number(e.bytesSent),s.packets=Number(e.packetsSent),s.packetsLost=Number(e.packetsLost),s.ssrc=Number(e.ssrc),s.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=xO(K$),d=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(s.codec=e.googCodecName,s.targetDelayMs=Number(e.googTargetDelayMs),s.renderDelayMs=Number(e.googRenderDelayMs),s.currentDelayMs=Number(e.googCurrentDelayMs),s.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),s.decodeMs=Number(e.googDecodeMs),s.maxDecodeMs=Number(e.googMaxDecodeMs),s.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},s.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},s.decodeFrameRate=Number(e.googFrameRateDecoded),s.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},s.jitterBufferMs=Number(e.googJitterBufferMs),s.firsCount=Number(e.googFirsSent),s.nacksCount=Number(e.googNacksSent),s.plisCount=Number(e.googPlisSent),s.framesDecodeCount=Number(e.framesDecoded),s.bytes=Number(e.bytesReceived),s.packets=Number(e.packetsReceived),s.packetsLost=Number(e.packetsLost),s.ssrc=Number(e.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),d){const f=d.stats,m=Date.now()-d.lts;s.framesDecodeFreezeTime=f.framesDecodeFreezeTime,s.framesDecodeInterval=f.framesDecodeInterval,s.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(d.lts=Date.now(),s.framesDecodeInterval=m,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):s.framesDecodeCount<d.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:D_({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=xO(X$);s.codec=e.googCodecName,s.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,s.decodingCNG=Number(e.googDecodingCNG),s.decodingCTN=Number(e.googDecodingCTN),s.decodingCTSG=Number(e.googDecodingCTSG),s.decodingNormal=Number(e.googDecodingNormal),s.decodingPLC=Number(e.googDecodingPLC),s.decodingPLCCNG=Number(e.googDecodingPLCCNG),s.expandRate=Number(e.googExpandRate),s.accelerateRate=Number(e.googAccelerateRate),s.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),s.speechExpandRate=Number(e.googSpeechExpandRate),s.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),s.jitterBufferMs=Number(e.googJitterBufferMs),s.jitterMs=Number(e.googJitterReceived),s.bytes=Number(e.bytesReceived),s.packets=Number(e.packetsReceived),s.packetsLost=Number(e.packetsLost),s.ssrc=Number(e.ssrc),s.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),s.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=xO(Y$);s.codec=e.googCodecName,s.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,s.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(e.bytesSent),s.packets=Number(e.packetsSent),s.packetsLost=Number(e.packetsLost),s.ssrc=Number(e.ssrc),s.rttMs=Number(e.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new A_((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const a={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(s=>{a[s]=n.stat(s)}),e.push(a)}),e}},U2=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),_q=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),g7=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),j0=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var YV=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(YV||{});function j2(t,e,n,a){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:YV.kNone;if(!e)return;const d=Number(e[n]);if(typeof d!="number")return;const f=Number(e[a]);if(typeof f!="number")return;if(!t)return f?d/f*s:void 0;const m=Number(t[n]);if(typeof m!="number")return;const _=Number(t[a]);if(typeof _!="number")return;const y=f-_;return y?(d-m)/y*s:void 0}let J$=class extends E7{constructor(){super(...arguments),$_(this,"_stats",x2),$_(this,"report",void 0),$_(this,"lastDecodeVideoReceiverStats",new Map),$_(this,"lastVideoFramesRecv",new Map),$_(this,"lastVideoFramesSent",new Map),$_(this,"lastVideoFramesDecode",new Map),$_(this,"lastVideoFramesOutput",new Map),$_(this,"lastVideoJBDelay",new Map),$_(this,"lastAudioJBDelay",new Map),$_(this,"mediaBytesSent",new Map),$_(this,"mediaBytesRetransmit",new Map),$_(this,"mediaBytesTargetEncode",new Map),$_(this,"lastDecodeAudioReceiverStats",new Map),$_(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=xO(x2),this.report.forEach(t=>{switch(t.type){case j0.OUTBOUND:case j0.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,a=!e&&!("frameWidth"in t);t.type===j0.OUTBOUND?e==="audio"||a?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===j0.INBOUND&&(e==="audio"||a?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case j0.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case j0.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:D_({},yN),remote:D_({},yN)};return t.forEach(n=>{let a;if(n.type===j0.TRANSPORT&&(a=t.get(n.selectedCandidatePairId)),n.type===j0.CANDIDATE_PAIR&&n.selected&&(a=n),a){const s=(d,f)=>{d.type=f.type,d.id=f.id,f.address&&(d.address=f.address),f.candidateType&&(d.candidateType=f.candidateType),f.port&&(d.port=f.port),f.priority&&(d.priority=f.priority),f.protocol&&(d.protocol=f.protocol),f.relayProtocol&&(d.relayProtocol=f.relayProtocol)};if(a.localCandidateId){const d=t.get(a.localCandidateId);d&&s(e.local,d)}if(a.remoteCandidateId){const d=t.get(a.remoteCandidateId);d&&s(e.remote,d)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===j0.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===j0.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===j0.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(D_({},e),D_({},this.stats.selectedCandidatePair.localCandidate)),t.type===j0.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(D_({},e),D_({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(a=>a.ssrc===t.ssrc);e||(e=xO(X$),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=j2(n,e,"totalProcessingDelay","jitterBufferEmittedCount",YV.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,D_({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(f=>f.ssrc===t.ssrc);e||(e=xO(K$),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),a=this.lastVideoFramesDecode.get(e.ssrc),s=this.lastVideoFramesOutput.get(e.ssrc),d=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const f=e.decodedFrame?e.decodedFrame.width:0,m=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,f,m),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const f=n.stats,m=d-n.lts;e.framesDecodeFreezeTime=f.framesDecodeFreezeTime,e.framesDecodeInterval=f.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=m,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<f.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=j2(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=j2(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",YV.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=j2(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",YV.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=j2(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",YV.kMillisecondsFromSeconds),a&&d-a.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:d,rate:e.decodeFrameRate})):a?e.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:d,rate:0}),e.framesDroppedCount&&t.framesReceived&&(s&&d-s.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-s.count)/((d-s.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:d,rate:Math.max(e.outputFrameRate,0)})):s?e.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:D_({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);e||(e=xO(W$),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const a=new m7(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const s=new m7(10);s.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,s)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const s=new m7(10);s.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,s)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const s=t.framesEncoded-a.lastFrameCount,d=t.totalEncodeTime-a.lastEncoderTime;e.avgEncodeMs=1e3*d/s}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const a=this.findRemoteStatsId(t.ssrc,j0.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=xO(Y$),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,j0.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const a=Array.from(l0(n=this.report).call(n)).find(s=>s.type===e&&s.ssrc===t);return a?a.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var a,s,d,f;const m=e?this.report.get(e):void 0,_=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof _!="number")return;let y=(s=m==null?void 0:m.frameWidth)!==null&&s!==void 0?s:t.frameWidth,T=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,w=(f=m==null?void 0:m.framesPerSecond)!==null&&f!==void 0?f:t.framesPerSecond;if(typeof y=="number"&&typeof T=="number"||(y=0,T=0),w==null){const L=Date.now(),B=this.lastVideoFramesSent.get(n.ssrc);B&&L-B.lts>=800?(w=Math.round((_-B.count)/((L-B.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:_,lts:L,rate:w})):B?w=B.rate:this.lastVideoFramesSent.set(n.ssrc,{count:_,lts:L,rate:0})}n.sentFrame={width:y,height:T,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(t,e,n){var a,s,d,f,m;const _=e?this.report.get(e):void 0,y=(a=_==null?void 0:_.framesReceived)!==null&&a!==void 0?a:t.framesReceived,T=(s=_==null?void 0:_.frameWidth)!==null&&s!==void 0?s:t.frameWidth,w=(d=_==null?void 0:_.frameHeight)!==null&&d!==void 0?d:t.frameHeight,L=(f=_==null?void 0:_.jitterBufferDelay)!==null&&f!==void 0?f:t.jitterBufferDelay,B=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof y=="number"){const Q=this.lastVideoFramesRecv.get(n.ssrc),X=Date.now();n.framesReceivedCount=y;let J=0;Q&&X-Q.lts>=800?(J=Math.round((y-Q.count)/((X-Q.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:y,lts:X,rate:J})):Q?J=Q.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:y,lts:X,rate:0}),n.receivedFrame={width:T||0,height:w||0,frameRate:J||0},n.decodedFrame={width:T||0,height:w||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:T||0,height:w||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(L&&B){const Q=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let X=Q.jitterBufferMs;const J=B-Q.jitterBufferEmittedCount;J>0&&(X=1e3*(L-Q.jitterBufferDelay)/J),n.jitterBufferMs=X,n.currentDelayMs=Math.round(X),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:L,jitterBufferEmittedCount:B,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var a,s,d,f;const m=e?this.report.get(e):void 0,_=(a=(s=m==null?void 0:m.echoReturnLoss)!==null&&s!==void 0?s:t.echoReturnLoss)!==null&&a!==void 0?a:0,y=(d=(f=m==null?void 0:m.echoReturnLossEnhancement)!==null&&f!==void 0?f:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;n.aecReturnLoss=_,n.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(t,e,n){var a,s,d,f,m,_,y;const T=e?this.report.get(e):void 0,w=(a=T==null?void 0:T.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,L=(s=T==null?void 0:T.totalSamplesReceived)!==null&&s!==void 0?s:t.totalSamplesReceived,B=(d=T==null?void 0:T.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,Q=(f=T==null?void 0:T.jitterBufferEmittedCount)!==null&&f!==void 0?f:t.jitterBufferEmittedCount,X=(m=T==null?void 0:T.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,J=(_=T==null?void 0:T.totalSamplesDuration)!==null&&_!==void 0?_:t==null?void 0:t.totalSamplesDuration,_n=(y=T==null?void 0:T.concealedSamples)!==null&&y!==void 0?y:t.concealedSamples;if(typeof L=="number"&&(n.totalSamplesReceived=L),w&&L&&(n.accelerateRate=w/L),B&&Q){const ya=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _l=ya.jitterBufferMs;const _d=Q-ya.jitterBufferEmittedCount;_d>0&&(_l=1e3*(B-ya.jitterBufferDelay)/_d),n.jitterBufferMs=Math.round(_l),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:B,jitterBufferEmittedCount:Q,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=X;let _r=1920;J&&L&&(_r=L/J/50,n.receivedFrames=Math.round(L/_r)),_n&&(n.droppedFrames=Math.round(_n/_r))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(s=>{t+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{e=e===null?s.diffMean():e+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()});const a=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},pht=class extends E7{updateStats(){return A_.resolve()}};function _7(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const f=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return f&&f[0]?Number(f[0].split("/")[1]):null}();return d?d<76?new hht(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:a,firstVideoDecodedTimeout:s}):new J$(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:a,firstVideoDecodedTimeout:s}):function(f){if(!window.RTCStatsReport)return!1;const m=f.getStats();return!!(m instanceof A_||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(t)?new J$(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:a,firstVideoDecodedTimeout:s}):new pht(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:a,firstVideoDecodedTimeout:s})}const Z$="websdk_ng_install_id";function v7(){try{if(aa("INSTALL_ID"))return aa("INSTALL_ID");let t=window.localStorage.getItem(Z$);return t||(t=gM(),window.localStorage.setItem(Z$,t)),RS("INSTALL_ID",t),t}catch{return}}const aO=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],a=e[2];return"".concat(n,".").concat(a)}return"4.0.0.999"}("4.23.2"),y7=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let _M=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const uR=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const a=n.join(""),s=[];for(let m=0;m<6;m++)s.push("1");const d=s.join(""),f={};return f[t]=a,f[e]=d,Object.assign(f,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=uR;const t8={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},b7={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},S7="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",T7={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},qS=D_(D_(D_({},T7),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:b7,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},t8),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function RS(t,e,n){var a,s,d;T_(a=Object.keys(qS)).call(a,t)&&(!n&&T_(s=Object.keys(AI)).call(s,t)||(qS[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||e!==!0||(qS.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(qS.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&e&&(d=!!e,qS.USE_NEW_NETWORK_CONFIG=d,d&&(qS.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],qS.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],qS.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],qS.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],qS.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",qS.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",qS.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(qS.ENABLE_INSTANT_VIDEO=!0,qS.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(qS.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(qS.NEW_TURN_MODE||(qS.NEW_TURN_MODE=4))))}function aa(t){return qS[t]}y7||(qS.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],qS.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],qS.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],qS.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],qS.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],qS.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],qS.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",qS.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",qS.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",qS.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",qS.AREAS=["NORTH_AMERICA","OVERSEA"]);let Q$=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const AI={};var nS=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(nS||{});let e8=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const $$=128,fht=96,ttt=1e3,XV=10;let mht=0;var ett=(()=>{var t={8:(a,s,d)=>{d.r(s),d.d(s,{Parser:()=>O_,Printer:()=>gT,parse:()=>__,print:()=>j_});const f=`
`,m="".concat("\r").concat(f),_=" ";let y;function T(s_){return s_>="0"&&s_<="9"}function w(s_){return s_>="!"&&s_<="~"}function L(s_){return w(s_)||s_>=""&&s_<="ÿ"}function B(s_){return s_==="!"||s_>="#"&&s_<="'"||s_>="*"&&s_<="+"||s_>="-"&&s_<="."||s_>="0"&&s_<="9"||s_>="A"&&s_<="Z"||s_>="^"&&s_<="~"}function Q(s_){return s_>="1"&&s_<="9"}function X(s_){return s_>="A"&&s_<="Z"||s_>="a"&&s_<="z"}function J(s_){return s_==="d"||s_==="h"||s_==="m"||s_==="s"}function _n(s_){return s_>""&&s_<"	"||s_>"\v"&&s_<"\f"||s_>""&&s_<"ÿ"}function _r(s_){return X(s_)||T(s_)||s_==="+"||s_==="/"}function ya(s_){return T(s_)||X(s_)||s_==="+"||s_==="/"||s_==="-"||s_==="_"}function _l(s_){return X(s_)||T(s_)||s_==="+"||s_==="/"}function _d(s_,Y){var ga=Object.keys(s_);if(Object.getOwnPropertySymbols){var ja=Object.getOwnPropertySymbols(s_);Y&&(ja=ja.filter(function(f_){return Object.getOwnPropertyDescriptor(s_,f_).enumerable})),ga.push.apply(ga,ja)}return ga}function tu(s_){for(var Y=1;Y<arguments.length;Y++){var ga=arguments[Y]!=null?arguments[Y]:{};Y%2?_d(Object(ga),!0).forEach(function(ja){_g(s_,ja,ga[ja])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s_,Object.getOwnPropertyDescriptors(ga)):_d(Object(ga)).forEach(function(ja){Object.defineProperty(s_,ja,Object.getOwnPropertyDescriptor(ga,ja))})}return s_}function _g(s_,Y,ga){return Y in s_?Object.defineProperty(s_,Y,{value:ga,enumerable:!0,configurable:!0,writable:!0}):s_[Y]=ga,s_}(function(s_){s_.VERSION="v",s_.ORIGIN="o",s_.SESSION_NAME="s",s_.INFORMATION="i",s_.URI="u",s_.EMAIL="e",s_.PHONE="p",s_.CONNECTION="c",s_.BANDWIDTH="b",s_.TIME="t",s_.REPEAT="r",s_.ZONE_ADJUSTMENTS="z",s_.KEY="k",s_.ATTRIBUTE="a",s_.MEDIA="m"})(y||(y={}));class l_{consumeText(Y,ga){let ja=ga;for(;ja<Y.length;){const f_=Y[ja];if(f_==="\0"||f_==="\r"||f_===f)break;ja+=1}if(ja-ga==0)throw new Error("Invalid text, at ".concat(Y));return ja}consumeUnicastAddress(Y,ga,ja){return this.consumeTill(Y,ga,_)}consumeOneOrMore(Y,ga,ja){let f_=ga;for(;ja(Y[f_]);)f_++;if(f_-ga==0)throw new Error("Invalid rule at ".concat(ga,"."));return f_}consumeSpace(Y,ga){if(Y[ga]===_)return ga+1;throw new Error("Invalid space at ".concat(ga,"."))}consumeIP4Address(Y,ga){let ja=ga;for(let f_=0;f_<4;f_++)if(ja=this.consumeDecimalUChar(Y,ja),f_!==3){if(Y[ja]!==".")throw new Error("Invalid IP4 address.");ja++}return ja}consumeDecimalUChar(Y,ga){let ja=ga;for(let _v=0;_v<3&&T(Y[ja]);_v++,ja++);if(ja-ga==0)throw new Error("Invalid decimal uchar.");const f_=parseInt(Y.slice(ga,ja));if(f_>=0&&f_<=255)return ja;throw new Error("Invalid decimal uchar")}consumeIP6Address(Y,ga){let ja=this.consumeHexpart(Y,ga);return Y[ja]===":"&&(ja+=1,ja=this.consumeIP4Address(Y,ja)),ja}consumeHexpart(Y,ga){let ja=ga;if(Y[ja]===":"&&Y[ja+1]===":"){ja+=2;try{ja=this.consumeHexseq(Y,ja)}catch{}return ja}if(ja=this.consumeHexseq(Y,ja),Y[ja]===":"&&Y[ja+1]===":"){ja+=2;try{ja=this.consumeHexseq(Y,ja)}catch{}return ja}return ja}consumeHexseq(Y,ga){let ja=ga;for(;ja=this.consumeHex4(Y,ja),Y[ja]===":"&&Y[ja+1]!==":";)ja+=1;return ja}consumeHex4(Y,ga){let ja=0;for(;ja<4;ja++)if(!((f_=Y[ga+ja])>="0"&&f_<="9"||f_>="a"&&f_<="f"||f_>="A"&&f_<="F")){if(ja===0)throw new Error("Invalid hex 4");break}var f_;return ga+ja}consumeFQDN(Y,ga){let ja=ga;for(;T(Y[ja])||X(Y[ja])||Y[ja]==="-"||Y[ja]===".";)ja+=1;if(ja-ga<4)throw new Error("Invalid FQDN");return ja}consumeExtnAddr(Y,ga){return this.consumeOneOrMore(Y,ga,L)}consumeMulticastAddress(Y,ga,ja){switch(ja){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(Y,ga);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(Y,ga);default:try{return this.consumeFQDN(Y,ga)}catch{return this.consumeExtnAddr(Y,ga)}}}consumeIP6MulticastAddress(Y,ga){const ja=this.consumeHexpart(Y,ga);return Y[ja]==="/"?this.consumeInteger(Y,ja+1):ja}consumeIP4MulticastAddress(Y,ga){let ja=ga+3;const f_=Y.slice(ga,ja),_v=parseInt(f_);if(_v<224||_v>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let NS=0;NS<3;NS++){if(Y[ja]!==".")throw new Error("Invalid IP4 multicast address.");ja+=1,ja=this.consumeDecimalUChar(Y,ja)}return Y[ja]==="/"&&(ja+=1),ja=this.consumeTTL(Y,ja),Y[ja]==="/"&&(ja=this.consumeInteger(Y,ja)),ja}consumeInteger(Y,ga){if(!Q(Y[ga]))throw new Error("Invalid integer.");for(ga+=1;T(Y[ga]);)ga+=1;return ga}consumeTTL(Y,ga){if(Y[ga]==="0")return ga+1;if(!Q(Y[ga]))throw new Error("Invalid TTL.");ga+=1;for(let ja=0;ja<2&&T(Y[ga]);ja++)ga+=1;return ga}consumeToken(Y,ga){return this.consumeOneOrMore(Y,ga,B)}consumeTime(Y,ga){let ja=ga;if(Y[ja]==="0")return ja+1;for(Q(Y[ja])&&(ja+=1);T(Y[ja]);)ja++;if(ja-ga<10)throw new Error("Invalid time");return ja}consumeAddress(Y,ga){return this.consumeTill(Y,ga,_)}consumeTypedTime(Y,ga){let ja=ga;return ja=this.consumeOneOrMore(Y,ja,T),J(Y[ja])?ja+1:ja}consumeRepeatInterval(Y,ga){if(!Q(Y[ga]))throw new Error("Invalid repeat interval");for(ga+=1;T(Y[ga]);)ga+=1;return J(Y[ga])&&(ga+=1),ga}consumePort(Y,ga){return this.consumeOneOrMore(Y,ga,T)}consume(Y,ga,ja){for(let f_=0;f_<ja.length;f_++){if(ga+f_>=Y.length)throw new Error("consume exceeding value length");if(Y[ga+f_]!==ja[f_])throw new Error("consume ".concat(ja," failed at ").concat(f_))}return ga+ja.length}consumeTill(Y,ga,ja){let f_=ga;for(;f_<Y.length&&(typeof ja!="string"||Y[f_]!==ja)&&(typeof ja!="function"||!ja(Y[f_]));)f_++;return f_}}class O_ extends l_{constructor(){super(),_g(this,"records",[]),_g(this,"currentLine",0)}parse(Y){const ga=this.probeEOL(Y);this.records=Y.split(ga).filter(GM=>!!wR(GM).call(GM)).map(this.parseLine),this.currentLine=0;const ja=this.parseVersion(),f_=this.parseOrigin(),_v=this.parseSessionName(),NS=this.parseInformation(),FT=this.parseUri(),g0=this.parseEmail(),CL=this.parsePhone(),FM=this.parseConnection(),b6=this.parseBandWidth(),dK=this.parseTimeFields(),hK=this.parseKey(),fO=this.parseSessionAttribute(),YP=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ja,origin:f_,sessionName:_v,information:NS,uri:FT,emails:g0,phones:CL,connection:FM,bandwidths:b6,timeFields:dK,key:hK,attributes:fO,mediaDescriptions:YP}}getCurrentRecord(){const Y=this.records[this.currentLine];if(!Y)throw new Error("Record doesn't exit.");return Y}probeEOL(Y){for(let ga=0;ga<Y.length;ga++)if(Y[ga]===f)return Y[ga-1]==="\r"?m:f;throw new Error("Invalid newline character.")}parseLine(Y,ga){if(Y.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ja=Y[0];if(Y[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ja,value:Y.slice(2),line:ga,cur:0}}parseSessionAttribute(){const Y=new iS;for(;this.currentLine<this.records.length;){const ga=this.getCurrentRecord();if(ga.type!==y.ATTRIBUTE)break;const ja={attField:this.extractOneOrMore(ga,f_=>B(f_)&&f_!==":"),_cur:0};ga.value[ga.cur]===":"&&(ga.cur+=1,ja.attValue=this.extractOneOrMore(ga,_n)),Y.parse(ja),this.currentLine++}return Y.digest()}parseMediaAttributes(Y){const ga=new oS(Y);for(;this.currentLine<this.records.length;){const ja=this.getCurrentRecord();if(ja.type!==y.ATTRIBUTE)break;const f_={attField:this.extractOneOrMore(ja,_v=>B(_v)&&_v!==":"),_cur:0};ja.value[ja.cur]===":"&&(ja.cur+=1,f_.attValue=this.extractOneOrMore(ja,_n)),ga.parse(f_),this.currentLine++}return ga.digest()}parseKey(){const Y=this.getCurrentRecord();if(Y.type===y.KEY){if(Y.value==="prompt"||Y.value==="clear:"||Y.value==="base64:"||Y.value==="uri:")return Y.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const Y=this.getCurrentRecord();if(Y.type===y.ZONE_ADJUSTMENTS){const ga=[];for(;;)try{const ja=this.extract(Y,this.consumeTime);this.consumeSpaceForRecord(Y);let f_=!1;Y.value[Y.cur]==="-"&&(f_=!0,Y.cur+=1);const _v=this.extract(Y,this.consumeTypedTime);ga.push({time:ja,typedTime:_v,back:f_})}catch{break}if(ga.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ga}return[]}parseRepeat(){const Y=[];for(;;){const ga=this.getCurrentRecord();if(ga.type!==y.REPEAT)break;{const ja=this.extract(ga,this.consumeRepeatInterval),f_=this.parseTypedTime(ga);Y.push({repeatInterval:ja,typedTimes:f_}),this.currentLine++}}return Y}parseTypedTime(Y){const ga=[];for(;;)try{this.consumeSpaceForRecord(Y),ga.push(this.extract(Y,this.consumeTypedTime))}catch{break}if(ga.length===0)throw new Error("Invalid typed time.");return ga}parseTime(){const Y=this.getCurrentRecord(),ga=this.extract(Y,this.consumeTime);this.consumeSpaceForRecord(Y);const ja=this.extract(Y,this.consumeTime);return this.currentLine++,{startTime:ga,stopTime:ja}}parseBandWidth(){const Y=[];for(;this.currentLine<this.records.length;){const ga=this.getCurrentRecord();if(ga.type!==y.BANDWIDTH)break;{const ja=this.extractOneOrMore(ga,B);if(ga.value[ga.cur]!==":")throw new Error("Invalid bandwidth field.");ga.cur++;const f_=this.extractOneOrMore(ga,T);Y.push({bwtype:ja,bandwidth:f_}),this.currentLine++}}return Y}parseVersion(){const Y=this.getCurrentRecord();if(Y.type!==y.VERSION)throw new Error("first sdp record must be version");const ga=Y.value.slice(0,this.consumeOneOrMore(Y.value,0,T));if(ga.length!==Y.value.length)throw new Error('invalid proto version, "v='.concat(Y.value,'"'));return this.currentLine++,ga}parseOrigin(){const Y=this.getCurrentRecord();if(Y.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const ga=this.extractOneOrMore(Y,L);this.consumeSpaceForRecord(Y);const ja=this.extractOneOrMore(Y,T);this.consumeSpaceForRecord(Y);const f_=this.extractOneOrMore(Y,T);this.consumeSpaceForRecord(Y);const _v=this.extractOneOrMore(Y,B);this.consumeSpaceForRecord(Y);const NS=this.extractOneOrMore(Y,B);this.consumeSpaceForRecord(Y);const FT=this.extract(Y,this.consumeUnicastAddress);return this.currentLine++,{username:ga,sessId:ja,sessVersion:f_,nettype:_v,addrtype:NS,unicastAddress:FT}}parseSessionName(){const Y=this.getCurrentRecord();if(Y.type===y.SESSION_NAME){const ga=this.extract(Y,this.consumeText);return this.currentLine++,ga}}parseInformation(){const Y=this.getCurrentRecord();if(Y.type!==y.INFORMATION)return;const ga=this.extract(Y,this.consumeText);return this.currentLine++,ga}parseUri(){const Y=this.getCurrentRecord();if(Y.type===y.URI)return this.currentLine++,Y.value}parseEmail(){const Y=[];for(;;){const ga=this.getCurrentRecord();if(ga.type!==y.EMAIL)break;Y.push(ga.value),this.currentLine++}return Y}parsePhone(){const Y=[];for(;;){const ga=this.getCurrentRecord();if(ga.type!==y.PHONE)break;Y.push(ga.value),this.currentLine++}return Y}parseConnection(){const Y=this.getCurrentRecord();if(Y.type===y.CONNECTION){const ga=this.extractOneOrMore(Y,B);this.consumeSpaceForRecord(Y);const ja=this.extractOneOrMore(Y,B);this.consumeSpaceForRecord(Y);const f_=this.extract(Y,this.consumeAddress);return this.currentLine++,{nettype:ga,addrtype:ja,address:f_}}}parseMedia(){const Y=this.getCurrentRecord(),ga=this.extract(Y,this.consumeToken);this.consumeSpaceForRecord(Y);let ja=this.extract(Y,this.consumePort);Y.value[Y.cur]==="/"&&(Y.cur+=1,ja+=this.extract(Y,this.consumeInteger)),this.consumeSpaceForRecord(Y);const f_=[];for(f_.push(this.extract(Y,this.consumeToken));Y.value[Y.cur]==="/";)Y.cur+=1,f_.push(this.extract(Y,this.consumeToken));if(f_.length===0)throw new Error("Invalid proto");const _v=this.parseFmt(Y);return this.currentLine++,{mediaType:ga,port:ja,protos:f_,fmts:_v}}parseTimeFields(){const Y=[];for(;this.getCurrentRecord().type===y.TIME;){const ga=this.parseTime(),ja=this.parseRepeat(),f_=this.parseZone();Y.push({time:ga,repeats:ja,zones:f_})}return Y}parseMediaDescription(){const Y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const ga=this.parseMedia(),ja=this.parseInformation(),f_=this.parseConnections(),_v=this.parseBandWidth(),NS=this.parseKey(),FT=this.parseMediaAttributes(ga);Y.push({media:ga,information:ja,connections:f_,bandwidths:_v,key:NS,attributes:FT})}return Y}parseConnections(){const Y=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)Y.push(this.parseConnection());return Y}parseFmt(Y){const ga=[];for(;;)try{this.consumeSpaceForRecord(Y),ga.push(this.extract(Y,this.consumeToken))}catch{break}if(ga.length===0)throw new Error("Invalid fmts");return ga}extract(Y,ga){for(var ja=arguments.length,f_=new Array(ja>2?ja-2:0),_v=2;_v<ja;_v++)f_[_v-2]=arguments[_v];const NS=ga.call(this,Y.value,Y.cur,...f_),FT=Y.value.slice(Y.cur,NS);return Y.cur=NS,FT}extractOneOrMore(Y,ga){const ja=this.consumeOneOrMore(Y.value,Y.cur,ga),f_=Y.value.slice(Y.cur,ja);return Y.cur=ja,f_}consumeSpaceForRecord(Y){if(Y.value[Y.cur]!==_)throw new Error("Invalid space at ".concat(Y.cur,"."));Y.cur+=1}}class N_ extends l_{constructor(){super(...arguments),_g(this,"attributes",void 0),_g(this,"digested",!1)}extractOneOrMore(Y,ga,ja){const f_=this.consumeOneOrMore(Y.attValue,Y._cur,ga),_v=Y.attValue.slice(Y._cur,f_),[NS,FT]=ja||[];if(typeof NS=="number"&&_v.length<NS)throw new Error("error in length, should be more or equal than ".concat(NS," characters."));if(typeof FT=="number"&&_v.length>FT)throw new Error("error in length, should be less or equal than ".concat(FT," characters."));return Y._cur=f_,_v}consumeAttributeSpace(Y){if(Y.attValue[Y._cur]!==_)throw new Error("Invalid space at ".concat(Y._cur,"."));Y._cur+=1}extract(Y,ga){if(!Y.attValue)throw new Error("Nothing to extract from attValue.");for(var ja=arguments.length,f_=new Array(ja>2?ja-2:0),_v=2;_v<ja;_v++)f_[_v-2]=arguments[_v];const NS=ga.call(this,Y.attValue,Y._cur,...f_),FT=Y.attValue.slice(Y._cur,NS);return Y._cur=NS,FT}atEnd(Y){if(!Y.attValue)throw new Error;return Y._cur>=Y.attValue.length}peekChar(Y){if(!Y.attValue)throw new Error;return Y.attValue[Y._cur]}peek(Y,ga){if(!Y.attValue)throw new Error;for(let ja=0;ja<ga.length;ja++)if(ga[ja]!==Y.attValue[Y._cur+ja])return!1;return!0}parseIceUfrag(Y){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(Y,_r,[4,256])}parseIcePwd(Y){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(Y,_r,[22,256])}parseIceOptions(Y){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ga=[];for(;!this.atEnd(Y);){ga.push(this.extractOneOrMore(Y,_r));try{this.consumeAttributeSpace(Y)}catch(ja){if(this.atEnd(Y))break;throw ja}}this.attributes.iceOptions=ga}parseFingerprint(Y){const ga=this.extract(Y,this.consumeToken);this.consumeAttributeSpace(Y);const ja=this.extract(Y,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ga,fingerprint:ja})}parseExtmap(Y){const ga=this.extractOneOrMore(Y,T);let ja;this.peekChar(Y)==="/"&&(this.extract(Y,this.consume,"/"),ja=this.extract(Y,this.consumeToken)),this.consumeAttributeSpace(Y);const f_=this.extract(Y,this.consumeTill,_),_v=tu(tu({entry:parseInt(ga,10)},ja&&{direction:ja}),{},{extensionName:f_});this.peekChar(Y)===_&&(this.consumeAttributeSpace(Y),_v.extensionAttributes=this.extract(Y,this.consumeTill)),this.attributes.extmaps.push(_v)}parseSetup(Y){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ga=this.extract(Y,this.consumeTill);if(ga!=="active"&&ga!=="passive"&&ga!=="actpass"&&ga!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ga}}class iS extends N_{constructor(){super(...arguments),_g(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(Y){if(this.digested)throw new Error("already digested");try{switch(Y.attField){case"group":this.parseGroup(Y);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(Y);break;case"ice-pwd":this.parseIcePwd(Y);break;case"ice-options":this.parseIceOptions(Y);break;case"fingerprint":this.parseFingerprint(Y);break;case"setup":this.parseSetup(Y);break;case"tls-id":this.parseTlsId(Y);break;case"identity":this.parseIdentity(Y);break;case"extmap":this.parseExtmap(Y);break;case"msid-semantic":this.parseMsidSemantic(Y);break;default:Y.ignored=!0,this.attributes.unrecognized.push(Y)}}catch(ga){throw console.error("parsing session attribute ".concat(Y.attField,' error, "a=').concat(Y.attField,":").concat(Y.attValue,'"')),ga}if(!Y.ignored&&Y.attValue&&!this.atEnd(Y))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(Y){const ga=this.extract(Y,this.consumeToken),ja=[];for(;!this.atEnd(Y)&&this.peekChar(Y)===_;)this.consumeAttributeSpace(Y),ja.push(this.extract(Y,this.consumeToken));this.attributes.groups.push({semantic:ga,identificationTag:ja})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(Y){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(Y,ya)}parseIdentity(Y){const ga=this.extractOneOrMore(Y,_l),ja=[];for(;!this.atEnd(Y)&&this.peekChar(Y)===_;){this.consumeAttributeSpace(Y);const f_=this.extract(Y,this.consumeToken);this.extract(Y,this.consume,"=");const _v=this.extractOneOrMore(Y,NS=>NS!==_&&_n(NS));ja.push({name:f_,value:_v})}this.attributes.identities.push({assertionValue:ga,extensions:ja})}parseMsidSemantic(Y){this.peekChar(Y)===_&&this.consumeAttributeSpace(Y);const ga={semantic:this.extract(Y,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(Y)}catch{break}if(this.peekChar(Y)==="*"){this.extract(Y,this.consume,"*"),ga.applyForAll=!0;break}{const ja=this.extract(Y,this.consumeTill,_);ga.identifierList.push(ja)}}this.attributes.msidSemantic=ga}}class oS extends N_{constructor(Y){super(),_g(this,"attributes",void 0),Y.protos.indexOf("RTP")!==-1||Y.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(Y){if(this.digested)throw new Error("already digested");try{switch(Y.attField){case"extmap":this.parseExtmap(Y);break;case"setup":this.parseSetup(Y);break;case"ice-ufrag":this.parseIceUfrag(Y);break;case"ice-pwd":this.parseIcePwd(Y);break;case"ice-options":this.parseIceOptions(Y);break;case"candidate":this.parseCandidate(Y);break;case"remote-candidate":this.parseRemoteCandidate(Y);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(Y);break;case"rtpmap":this.parseRtpmap(Y);break;case"ptime":this.parsePtime(Y);break;case"maxptime":this.parseMaxPtime(Y);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(Y);break;case"ssrc":this.parseSSRC(Y);break;case"fmtp":this.parseFmtp(Y);break;case"rtcp-fb":this.parseRtcpFb(Y);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(Y);break;case"mid":this.parseMid(Y);break;case"msid":this.parseMsid(Y);break;case"imageattr":this.parseImageAttr(Y);break;case"rid":this.parseRid(Y);break;case"simulcast":this.parseSimulcast(Y);break;case"sctp-port":this.parseSctpPort(Y);break;case"max-message-size":this.parseMaxMessageSize(Y);break;case"ssrc-group":this.parseSSRCGroup(Y);break;default:Y.ignored=!0,this.attributes.unrecognized.push(Y)}}catch(ga){throw console.error("parsing media attribute ".concat(Y.attField,' error, "a=').concat(Y.attField,":").concat(Y.attValue,'"')),ga}if(!Y.ignored&&Y.attValue&&!this.atEnd(Y))throw new Error("attribute parsing error")}parseCandidate(Y){const ga=this.extractOneOrMore(Y,_r,[1,32]);this.consumeAttributeSpace(Y);const ja=this.extractOneOrMore(Y,T,[1,5]);this.consumeAttributeSpace(Y);const f_=this.extract(Y,this.consumeToken);this.consumeAttributeSpace(Y);const _v=this.extractOneOrMore(Y,T,[1,10]);this.consumeAttributeSpace(Y);const NS=this.extract(Y,this.consumeAddress);this.consumeAttributeSpace(Y);const FT=this.extract(Y,this.consumePort);this.consumeAttributeSpace(Y),this.extract(Y,this.consume,"typ"),this.consumeAttributeSpace(Y);const g0={foundation:ga,componentId:ja,transport:f_,priority:_v,connectionAddress:NS,port:FT,type:this.extract(Y,this.consumeToken),extension:{}};for(this.peek(Y," raddr")&&(this.extract(Y,this.consume," raddr"),this.consumeAttributeSpace(Y),g0.relAddr=this.extract(Y,this.consumeAddress)),this.peek(Y," rport")&&(this.extract(Y,this.consume," rport"),this.consumeAttributeSpace(Y),g0.relPort=this.extract(Y,this.consumePort));this.peekChar(Y)===_;){this.consumeAttributeSpace(Y);const CL=this.extract(Y,this.consumeToken);this.consumeAttributeSpace(Y),g0.extension[CL]=this.extractOneOrMore(Y,w)}this.attributes.candidates.push(g0)}parseRemoteCandidate(Y){const ga=[];for(;;){const ja=this.extractOneOrMore(Y,T,[1,5]);this.consumeAttributeSpace(Y);const f_=this.extract(Y,this.consumeAddress);this.consumeAttributeSpace(Y);const _v=this.extract(Y,this.consumePort);ga.push({componentId:ja,connectionAddress:f_,port:_v});try{this.consumeAttributeSpace(Y)}catch{break}}this.attributes.remoteCandidatesList.push(ga)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(Y){const ga=this.extract(Y,this.consumeToken);this.consumeAttributeSpace(Y);const ja=this.extract(Y,this.consumeTill,"/");this.extract(Y,this.consume,"/");const f_={encodingName:ja,clockRate:this.extractOneOrMore(Y,T)};this.atEnd(Y)||this.peekChar(Y)!=="/"||(this.extract(Y,this.consume,"/"),f_.encodingParameters=parseInt(this.extract(Y,this.consumeTill),10));const _v=this.attributes.payloads.find(NS=>NS.payloadType===parseInt(ga,10));_v?_v.rtpMap=f_:this.attributes.payloads.push({payloadType:parseInt(ga,10),rtpMap:f_,rtcpFeedbacks:[]})}parsePtime(Y){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(Y,this.consumeTill)}parseMaxPtime(Y){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(Y,this.consumeTill)}parseDirection(Y){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=Y.attField}parseSSRC(Y){const ga=this.extractOneOrMore(Y,T);this.consumeAttributeSpace(Y);const ja=this.extract(Y,this.consumeTill,":");let f_;this.peekChar(Y)===":"&&(this.extract(Y,this.consume,":"),f_=this.extract(Y,this.consumeTill));const _v=this.attributes.ssrcs.find(NS=>NS.ssrcId===parseInt(ga,10));_v?_v.attributes[ja]=f_:this.attributes.ssrcs.push({ssrcId:parseInt(ga,10),attributes:{[ja]:f_}})}parseFmtp(Y){const ga=this.extract(Y,this.consumeTill,_);this.consumeAttributeSpace(Y);const ja=this.extract(Y,this.consumeTill),f_={};ja.split(";").forEach(NS=>{let[FT,g0]=NS.split("=");FT=wR(FT).call(FT);const CL=typeof g0=="string"?wR(g0).call(g0):null;typeof FT=="string"&&FT.length>0&&(f_[FT]=CL)});const _v=this.attributes.payloads.find(NS=>NS.payloadType===parseInt(ga,10));_v?_v.fmtp={parameters:f_}:this.attributes.payloads.push({payloadType:parseInt(ga,10),rtcpFeedbacks:[],fmtp:{parameters:f_}})}parseFmtParameters(Y){const ga={},ja=this.extract(Y,this.consumeTill,"=");Y._cur++;const f_=this.extract(Y,this.consumeTill,";");for(ga[ja]=f_;Y.attValue[Y._cur]===";";){const _v=this.extract(Y,this.consumeTill,"=");Y._cur++;const NS=this.extract(Y,this.consumeTill,";");ga[_v]=NS}return ga}parseRtcpFb(Y){let ga="";ga=this.peekChar(Y)==="*"?this.extract(Y,this.consume,"*"):this.extract(Y,this.consumeTill,_),this.consumeAttributeSpace(Y);const ja=this.extract(Y,this.consumeTill,_);let f_;if(ja==="trr-int")f_={type:ja,interval:this.extract(Y,this.consumeTill)};else{const _v={type:ja};this.peekChar(Y)===_&&(this.consumeAttributeSpace(Y),_v.parameter=this.extract(Y,this.consumeToken),this.peekChar(Y)===_&&(_v.additional=this.extract(Y,this.consumeTill))),f_=_v}if(ga==="*")this.attributes.rtcpFeedbackWildcards.push(f_);else{const _v=this.attributes.payloads.find(NS=>NS.payloadType===parseInt(ga,10));_v?_v.rtcpFeedbacks.push(f_):this.attributes.payloads.push({payloadType:parseInt(ga,10),rtcpFeedbacks:[f_]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(Y){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ga={port:this.extract(Y,this.consumePort)};this.peekChar(Y)===_&&(this.consumeAttributeSpace(Y),ga.netType=this.extractOneOrMore(Y,B),this.consumeAttributeSpace(Y),ga.addressType=this.extractOneOrMore(Y,B),this.consumeAttributeSpace(Y),ga.address=this.extract(Y,this.consumeAddress)),this.attributes.rtcp=ga}parseMsid(Y){const ga={id:this.extractOneOrMore(Y,B,[1,64])};this.peekChar(Y)===_&&(this.consumeAttributeSpace(Y),ga.appdata=this.extractOneOrMore(Y,B,[1,64])),this.attributes.msids.push(ga)}parseImageAttr(Y){this.attributes.imageattr.push(Y.attValue)}parseRid(Y){const ga=this.extractOneOrMore(Y,f_=>X(f_)||T(f_)||f_==="_"||f_==="-");this.consumeAttributeSpace(Y);const ja={id:ga,direction:this.extract(Y,this.consumeToken),params:[]};if(this.peekChar(Y)===_){if(this.consumeAttributeSpace(Y),this.peek(Y,"pt=")){this.extract(Y,this.consume,"pt=");const f_=[];for(;;){const _v=this.extract(Y,this.consumeToken);f_.push(_v);try{this.extract(Y,this.consume,",")}catch{break}}ja.payloads=f_,this.peekChar(Y)===_&&this.extract(Y,this.consume,_)}for(;;){const f_=this.extract(Y,this.consumeToken);switch(f_){case"depend":{const _v={type:f_,rids:this.extract(Y,this.consume,"=").split(",")};ja.params.push(_v);break}default:{const _v={type:f_};this.peekChar(Y)==="="&&(this.extract(Y,this.consume,"="),_v.val=this.extract(Y,this.consumeTill,";")),ja.params.push(_v)}}try{this.extract(Y,this.consume,";")}catch{break}}}this.attributes.rids.push(ja)}parseSimulcast(Y){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=Y.attValue,this.extract(Y,this.consumeTill)}parseSctpPort(Y){this.attributes.sctpPort=this.extractOneOrMore(Y,T,[1,5])}parseMaxMessageSize(Y){this.attributes.maxMessageSize=this.extractOneOrMore(Y,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(Y){this.attributes.mid=this.extract(Y,this.consumeToken)}parseSSRCGroup(Y){const ga=this.extract(Y,this.consumeToken),ja=[];for(;;)try{this.consumeAttributeSpace(Y);const f_=this.extract(Y,this.consumeInteger);ja.push(parseInt(f_,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ga,ssrcIds:ja})}}function jS(s_,Y,ga){return Y in s_?Object.defineProperty(s_,Y,{value:ga,enumerable:!0,configurable:!0,writable:!0}):s_[Y]=ga,s_}class gT{constructor(){jS(this,"eol",m)}print(Y,ga){let ja="";return ga&&(this.eol=ga),ja+=this.printVersion(Y.version),ja+=this.printOrigin(Y.origin),ja+=this.printSessionName(Y.sessionName),ja+=this.printInformation(Y.information),ja+=this.printUri(Y.uri),ja+=this.printEmail(Y.emails),ja+=this.printPhone(Y.phones),ja+=this.printConnection(Y.connection),ja+=this.printBandwidth(Y.bandwidths),ja+=this.printTimeFields(Y.timeFields),ja+=this.printKey(Y.key),ja+=this.printSessionAttributes(Y.attributes),ja+=this.printMediaDescription(Y.mediaDescriptions),ja}printVersion(Y){return"v=".concat(Y).concat(this.eol)}printOrigin(Y){return"o=".concat(Y.username," ").concat(Y.sessId," ").concat(Y.sessVersion," ").concat(Y.nettype," ").concat(Y.addrtype," ").concat(Y.unicastAddress).concat(this.eol)}printSessionName(Y){return Y?"s=".concat(Y).concat(this.eol):""}printInformation(Y){return Y?"i=".concat(Y).concat(this.eol):""}printUri(Y){return Y?"u=".concat(Y).concat(this.eol):""}printEmail(Y){let ga="";for(const ja of Y)ga+="e=".concat(ja).concat(this.eol);return ga}printPhone(Y){let ga="";for(const ja of Y)ga+="e=".concat(ja).concat(this.eol);return ga}printConnection(Y){return Y?"c=".concat(Y.nettype," ").concat(Y.addrtype," ").concat(Y.address).concat(this.eol):""}printBandwidth(Y){let ga="";for(const ja of Y)ga+="b=".concat(ja.bwtype,":").concat(ja.bandwidth).concat(this.eol);return ga}printTimeFields(Y){let ga="";for(const ja of Y){ga+="t=".concat(ja.time.startTime," ").concat(ja.time.startTime).concat(this.eol);for(const f_ of ja.repeats)ga+="r=".concat(f_.repeatInterval," ").concat(f_.typedTimes.join(" ")).concat(this.eol);ja.zoneAdjustments&&(ga+="z=",ga+="z=".concat(ja.zoneAdjustments.map(f_=>"".concat(f_.time," ").concat(f_.back?"-":""," ").concat(f_.typedTime)).join(" ")).concat(this.eol),ga+=this.eol)}return ga}printKey(Y){return Y?"k=".concat(Y).concat(this.eol):""}printAttributes(Y){let ga="";for(const ja of Y)ga+="a=".concat(ja.attField).concat(ja.attValue?":".concat(ja.attValue):"").concat(this.eol);return ga}printMediaDescription(Y){let ga="";for(const ja of Y)ga+=this.printMedia(ja.media),ga+=this.printInformation(ja.information),ga+=this.printConnections(ja.connections),ga+=this.printBandwidth(ja.bandwidths),ga+=this.printKey(ja.key),ga+=this.printMediaAttributes(ja);return ga}printConnections(Y){let ga="";for(const ja of Y)ga+=this.printConnection(ja);return ga}printMedia(Y){return"m=".concat(Y.mediaType," ").concat(Y.port," ").concat(Y.protos.join("/")," ").concat(Y.fmts.join(" ")).concat(this.eol)}printSessionAttributes(Y){return new $R(this.eol).print(Y)}printMediaAttributes(Y){return new i_(this.eol).print(Y)}}class lT{constructor(Y){jS(this,"eol",void 0),this.eol=Y}printIceUfrag(Y){return Y===void 0?"":"a=ice-ufrag:".concat(Y).concat(this.eol)}printIcePwd(Y){return Y===void 0?"":"a=ice-pwd:".concat(Y).concat(this.eol)}printIceOptions(Y){return Y===void 0?"":"a=ice-options:".concat(Y.join(_)).concat(this.eol)}printFingerprints(Y){return Y.length>0?Y.map(ga=>"a=fingerprint:".concat(ga.hashFunction).concat(_).concat(ga.fingerprint)).join(this.eol)+this.eol:""}printExtmap(Y){return Y.map(ga=>"a=extmap:".concat(ga.entry).concat(ga.direction?"/".concat(ga.direction):"").concat(_).concat(ga.extensionName).concat(ga.extensionAttributes?"".concat(_).concat(ga.extensionAttributes):"").concat(this.eol)).join("")}printSetup(Y){return Y===void 0?"":"a=setup:".concat(Y).concat(this.eol)}printUnrecognized(Y){return Y.map(ga=>"a=".concat(ga.attField).concat(ga.attValue?":".concat(ga.attValue):"").concat(this.eol)).join("")}}class $R extends lT{print(Y){let ga="";return ga+=this.printGroups(Y.groups),ga+=this.printMsidSemantic(Y.msidSemantic),ga+=this.printIceLite(Y.iceLite),ga+=this.printIceUfrag(Y.iceUfrag),ga+=this.printIcePwd(Y.icePwd),ga+=this.printIceOptions(Y.iceOptions),ga+=this.printFingerprints(Y.fingerprints),ga+=this.printSetup(Y.setup),ga+=this.printTlsId(Y.tlsId),ga+=this.printIdentity(Y.identities),ga+=this.printExtmap(Y.extmaps),ga+=this.printUnrecognized(Y.unrecognized),ga}printGroups(Y){let ga="";return Y.length>0&&(ga+=Y.map(ja=>"a=group:".concat(ja.semantic).concat(ja.identificationTag.map(f_=>"".concat(_).concat(f_)).join("")).concat(this.eol)).join("")),ga}printIceLite(Y){return Y===void 0?"":"a=ice-lite"+this.eol}printTlsId(Y){return Y?"a=tls-id:".concat(Y).concat(this.eol):""}printIdentity(Y){return Y.length===0?"":Y.map(ga=>"a=identity:".concat(ga.assertionValue).concat(ga.extensions.map(ja=>"".concat(_).concat(ja.name).concat(ja.value?"=".concat(ja.value):"")))).join(this.eol)+this.eol}printMsidSemantic(Y){if(!Y)return"";let ga="a=msid-semantic:".concat(Y.semantic);return Y.applyForAll?ga+="".concat(_,"*"):Y.identifierList.length>0&&(ga+=Y.identifierList.map(ja=>"".concat(_).concat(ja))),ga+this.eol}}class i_ extends lT{print(Y){const ga=Y.attributes;let ja="";return ja+=this.printRTCP(ga.rtcp),ja+=this.printIceUfrag(ga.iceUfrag),ja+=this.printIcePwd(ga.icePwd),ja+=this.printIceOptions(ga.iceOptions),ja+=this.printCandidates(ga.candidates),ja+=this.printRemoteCandidatesList(ga.remoteCandidatesList),ja+=this.printEndOfCandidates(ga.endOfCandidates),ja+=this.printFingerprints(ga.fingerprints),ja+=this.printSetup(ga.setup),ja+=this.printMid(ga.mid),ja+=this.printExtmap(ga.extmaps),ja+=this.printRTPRelated(ga),ja+=this.printPtime(ga.ptime),ja+=this.printMaxPtime(ga.maxPtime),ja+=this.printDirection(ga.direction),ja+=this.printSSRCGroups(ga.ssrcGroups),ja+=this.printSSRC(ga.ssrcs),ja+=this.printRTCPMux(ga.rtcpMux),ja+=this.printRTCPMuxOnly(ga.rtcpMuxOnly),ja+=this.printRTCPRsize(ga.rtcpRsize),ja+=this.printMSId(ga.msids),ja+=this.printImageattr(ga.imageattr),ja+=this.printRid(ga.rids),ja+=this.printSimulcast(ga.simulcast),ja+=this.printSCTPPort(ga.sctpPort),ja+=this.printMaxMessageSize(ga.maxMessageSize),ja+=this.printUnrecognized(ga.unrecognized),ja}printCandidates(Y){return Y.map(ga=>"a=candidate:".concat(ga.foundation).concat(_).concat(ga.componentId).concat(_).concat(ga.transport).concat(_).concat(ga.priority).concat(_).concat(ga.connectionAddress).concat(_).concat(ga.port).concat(_,"typ").concat(_).concat(ga.type).concat(ga.relAddr?"".concat(_,"raddr").concat(_).concat(ga.relAddr):"").concat(ga.relPort?"".concat(_,"rport").concat(_).concat(ga.relPort):"").concat(Object.keys(ga.extension).map(ja=>"".concat(_).concat(ja).concat(_).concat(ga.extension[ja])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(Y){return Y.map(ga=>"a=remote-candidates:".concat(ga.join(_)).concat(this.eol)).join("")}printEndOfCandidates(Y){return Y===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(Y){if(!Y.payloads)return"";const ga=Y.payloads;let ja="";ja+=Y.rtcpFeedbackWildcards.map(f_=>this.printRTCPFeedback("*",f_)).join("");for(const f_ of ga)ja+=this.printRtpMap(f_.payloadType,f_.rtpMap),ja+=this.printFmtp(f_.payloadType,f_.fmtp),ja+=f_.rtcpFeedbacks.map(_v=>this.printRTCPFeedback(f_.payloadType,_v)).join("");return ja}printFmtp(Y,ga){if(!ga)return"";const ja=Object.keys(ga.parameters);return ja.length===1&&ga.parameters[ja[0]]===null?"a=fmtp:".concat(Y).concat(_).concat(ja[0]).concat(this.eol):"a=fmtp:".concat(Y).concat(_).concat(Object.keys(ga.parameters).map(f_=>"".concat(f_,"=").concat(ga.parameters[f_])).join(";")).concat(this.eol)}printRtpMap(Y,ga){return ga?"a=rtpmap:".concat(Y).concat(_).concat(ga.encodingName,"/").concat(ga.clockRate).concat(ga.encodingParameters?"/".concat(ga.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(Y,ga){let ja="a=rtcp-fb:".concat(Y).concat(_),f_=ga;return f_.type==="trr-int"?ja+="ttr-int".concat(_).concat(f_.interval):(ja+="".concat(f_.type),f_.parameter&&(ja+="".concat(_).concat(f_.parameter),f_.additional&&(ja+="".concat(_).concat(f_.additional)))),ja+this.eol}printPtime(Y){return Y===void 0?"":"a=ptime:".concat(Y).concat(this.eol)}printMaxPtime(Y){return Y===void 0?"":"a=maxptime:".concat(Y).concat(this.eol)}printDirection(Y){return Y===void 0?"":"a=".concat(Y).concat(this.eol)}printSSRC(Y){return Y.map(ga=>Object.keys(ga.attributes).map(ja=>"a=ssrc:".concat(ga.ssrcId.toString(10)).concat(_).concat(ja).concat(ga.attributes[ja]?":".concat(ga.attributes[ja]):"").concat(this.eol)).join("")).join("")}printRTCPMux(Y){return Y===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(Y){return Y===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(Y){return Y===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(Y){if(Y===void 0)return"";let ga="a=rtcp:".concat(Y.port);return Y.netType&&(ga+="".concat(_).concat(Y.netType)),Y.addressType&&(ga+="".concat(_).concat(Y.addressType)),Y.address&&(ga+="".concat(_).concat(Y.address)),ga+this.eol}printMSId(Y){return Y.map(ga=>"a=msid:".concat(ga.id).concat(ga.appdata?"".concat(_).concat(ga.appdata):"").concat(this.eol)).join("")}printImageattr(Y){return Y.map(ga=>"a=imageattr:".concat(ga).concat(this.eol)).join("")}printRid(Y){return Y.map(ga=>{let ja="a=rid:".concat(ga.id).concat(_).concat(ga.direction);return ga.payloads&&(ja+="".concat(_,"pt=").concat(ga.payloads.join(","))),ga.params.length>0&&(ja+="".concat(_).concat(ga.params.map(f_=>f_.type==="depend"?"depend=".concat(f_.rids.join(",")):"".concat(f_.type,"=").concat(f_.val)).join(";"))),ja+this.eol}).join("")}printSimulcast(Y){return Y===void 0?"":"a=simulcast:".concat(Y).concat(this.eol)}printSCTPPort(Y){return Y===void 0?"":"a=sctp-port:".concat(Y).concat(this.eol)}printMaxMessageSize(Y){return Y===void 0?"":"a=max-message-size:".concat(Y).concat(this.eol)}printMid(Y){return Y===void 0?"":"a=mid:".concat(Y).concat(this.eol)}printSSRCGroups(Y){return Y.map(ga=>"a=ssrc-group:".concat(ga.semantic).concat(ga.ssrcIds.map(ja=>"".concat(_).concat(ja.toString(10))).join("")).concat(this.eol)).join("")}}function __(s_){return new O_().parse(s_)}function j_(s_,Y){return new gT().print(s_,Y)}}},e={};function n(a){if(e[a])return e[a].exports;var s=e[a]={exports:{}};return t[a](s,s.exports,n),s.exports}return n.d=(a,s)=>{for(var d in s)n.o(s,d)&&!n.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:s[d]})},n.o=(a,s)=>Object.prototype.hasOwnProperty.call(a,s),n.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n(8)})();function p0(t){return ett.parse(t)}function DP(t,e){return ett.print(t,e)}var Eht=HR("Array").keys,ght=Y0,_ht=YT,vht=$,yht=Eht,R7=Array.prototype,bht={DOMTokenList:!0,NodeList:!0},Sht=function(t){var e=t.keys;return t===R7||vht(R7,t)&&e===R7.keys||_ht(bht,ght(t))?yht:e},V0=h(Sht);function ntt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function _y(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ntt(Object(n),!0).forEach(function(a){sT(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ntt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function sT(t,e,n){return(e=function(a){var s=function(d,f){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var _=m.call(d,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof s=="symbol"?s:String(s)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const rtt=new class extends eT{constructor(){super(...arguments),sT(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class Tht{constructor(e){sT(this,"logger",void 0),sT(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function A7(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function itt(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const sO={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},n8=Date.now(),V2=t=>{for(const e in sO)if(Object.prototype.hasOwnProperty.call(sO,e)&&sO[e]===t)return e;return"DEFAULT"},F=new class{constructor(){sT(this,"proxyServerURL",void 0),sT(this,"logLevel",sO.DEBUG),sT(this,"uploadState","collecting"),sT(this,"uploadLogWaitingList",[]),sT(this,"uploadLogUploadingList",[]),sT(this,"uploadErrorCount",0),sT(this,"currentLogID",0),sT(this,"url",void 0),sT(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const a=[sO.DEBUG].concat(e);this.log.apply(this,a)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const a=[sO.INFO].concat(e);this.log.apply(this,a)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const a=[sO.WARNING].concat(e);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const a=[sO.ERROR].concat(e);this.log.apply(this,a)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const a=[sO.DEBUG].concat(e);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){RS("UPLOAD_LOG",!0)}disableLogUpload(){RS("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new Tht(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-n8<100)return void setTimeout(()=>{this.log(...e)},Date.now()-n8);const a=Math.max(0,Math.min(4,e[0]));if(e[0]=A7()+" Agora-SDK [".concat(V2(a),"]:"),this.appendLogToWaitingList(a,...e),a<this.logLevel)return;const s=A7()+" %cAgora-SDK [".concat(V2(a),"]:");let d=[];if(!aa("USE_NEW_LOG"))switch(a){case sO.DEBUG:d=[s,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,d);break;case sO.INFO:d=[s,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,d);break;case sO.WARNING:d=[s,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,d);break;case sO.ERROR:d=[s,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-n8<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-n8);const a=Math.max(0,Math.min(4,e[0]));e[0]=A7()+" Agora-SDK [".concat(V2(a),"]:"),this.appendLogToWaitingList(a,...e)}appendLogToWaitingList(t){if(!aa("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];Array.isArray(n[0])?n[0][0]=itt()+" Agora-SDK [".concat(V2(t),"]:"):n[0]=itt()+" Agora-SDK [".concat(V2(t),"]:");let s="";n.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),s+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:aO,process_id:aa("PROCESS_ID"),payload:JSON.stringify(t)};return RI(async()=>{const n=await WR.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(aa("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(aa("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=n,a}},()=>(this.uploadLogUploadingList=[],!1),n=>{const a={status:-1,message:n.message,errorRange:t.map(s=>s.log_item_id)};return n.response?(a.status=n.response.status,a.data=n.response.data,a.headers=n.response.headers):n.request&&(a.status=n.request.status),rtt.reportLogUploadError(a),!0},{timeout:aa("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:aa("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,aa("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),aa("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),aa("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),aa("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var ott;function Rht(t){return ZT(t.reportId,"params.reportId",0,100,!1),ZT(t.category,"params.category",0,100,!1),ZT(t.event,"params.event",0,100,!1),ZT(t.label,"params.label",0,100,!1),IS(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(ott={}).FREE="free",ott.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Aht={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let VT=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),JS=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Cht=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function K_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,a){const s=a.value;if(typeof s=="function"){const d=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);a.value=function(){for(var f,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let T=_;if(t.argsMap)try{T=t.argsMap(this,..._)}catch(L){F.warning(L),T=[]}try{JSON.stringify(T)}catch{F.warning("arguments for method ".concat(d,".").concat(String(n)," not serializable for apiInvoke.")),T=[]}const w=(t.report||V_).reportApiInvoke(this._sessionId||null,{id:this._clientId||((f=this.store)===null||f===void 0?void 0:f.clientId)||this._ID,name:"".concat(d,".").concat(String(n)),options:T,tag:oT.TRACER,reportResult:t.reportResult},t.throttleTime);try{const L=s.apply(this,_);return L instanceof A_?L.then(B=>(w.onSuccess(t.reportResult&&B),B)).catch(B=>{throw w.onError(B),B}):(w.onSuccess(t.reportResult&&L),L)}catch(L){throw w.onError(L),L}}}return a}}const V_=new class{constructor(){sT(this,"baseInfoMap",new Map),sT(this,"proxyServer",void 0),sT(this,"eventUploadTimer",void 0),sT(this,"setSessionIdTimer",void 0),sT(this,"url",void 0),sT(this,"sids",new Set),sT(this,"backupUrl",void 0),sT(this,"_appId",void 0),sT(this,"_aid",0),sT(this,"keyEventUploadPendingItems",[]),sT(this,"normalEventUploadPendingItems",[]),sT(this,"apiInvokeUploadPendingItems",[]),sT(this,"apiInvokeCount",0),sT(this,"apiInvokeLoggedCount",0),sT(this,"ltsList",[]),sT(this,"lastSendNormalEventTime",Date.now()),sT(this,"customReportCounterTimer",void 0),sT(this,"customReportCount",0),sT(this,"extApiInvoke",async t=>{for(const e of t){const n=_y(_y({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:oT.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),aa("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),aa("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,a]=e;return n+a}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const a=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,d=!!aa("SHOW_REPORT_INVOKER_LOG"),f=!!aa("SHOW_REPORT_USER_INVOKER_LOG"),m=d||f&&e.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(B,Q){if(m){let X="[apiInvoke-".concat(_,"]");e.id&&(X+="[".concat(e.id,"]")),e.name&&(X+="[".concat(e.name,"]")),F.info("".concat(X," ").concat(B),B==="start"?e.options:Q||"")}}const T=()=>({tag:e.tag,invokeId:s,sid:t,name:e.name,apiInvokeTime:a,options:e.options,states:e.states||null});y("start");let w=!1;QT(e.timeout).then(()=>{w||(this.sendApiInvoke(_y(_y({},T()),{},{error:_i.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const L=new t_(_i.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:B=>{const Q=()=>{if(w)throw L;return w=!0,this.sendApiInvoke(_y(_y({},T()),{},{success:!0},e.reportResult&&{result:B})),y("onSuccess"),B};return n?j$(Q,e.name+"Success",n,()=>w=!0):Q()},onError:B=>{const Q=()=>{if(w)throw B;w=!0,this.sendApiInvoke(_y(_y({},T()),{},{success:!1,error:B})),y("onFailure",B.toString())};return n?j$(Q,e.name+"Error",n,()=>w=!0):Q()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),a=this.createBaseInfo(t,n);a.cname=e.cname;const s=Object.assign({},{willUploadConsoleLog:aa("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:y7?"global":"oversea",areas:aa("AREAS")&&aa("AREAS").join(",")},e.extend),{stringUid:d,channelProfile:f,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:T}=e,w=Date.now(),L=_y(_y({},a),{},{eventType:VT.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:S7,lts:w,elapse:w-n,extend:JSON.stringify(s),mode:e.mode,process:aa("PROCESS_ID"),appType:aa("APP_TYPE"),success:!0,version:aO,stringUid:d,channelProfile:f,channelMode:m,isABTestSuccess:_,lsid:y,clientType:T_(B=window.navigator.userAgent).call(B,"AgoraWebView")?42:20,clientRole:T,serviceId:aa("PROCESS_ID"),extensionID:aa("PLUGIN_INFO").join(",")||""});var B;this.send({type:JS.SESSION,data:L},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y({},a),{},{role:e.role,eventType:VT.JOIN_CHOOSE_SERVER,lts:s,eventElapse:e.elapse||s-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:s-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:JS.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y({},a),{},{eventType:VT.REQ_USER_ACCOUNT,lts:s,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||s-n.startTime,eventElapse:s-e.lts,extend:JSON.stringify(e.extend)});this.send({type:JS.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info;e.vid&&(a.vid=e.vid),a.uid=e.uid,a.cid=e.cid;const s=Date.now(),{firstSuccess:d,avoidJoinStartTime:f,addr:m,isProxy:_}=e,y=s-(d&&f?f:n.startTime),T=_y(_y({},a),{},{eventType:VT.JOIN_GATEWAY,lts:s,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:y,eventElapse:s-e.lts,firstSuccess:d,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:v7(),isABTestSuccess:e.isABTestSuccess?1:0}),w=T.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=s),d)this.send({type:JS.JOIN_GATEWAY,data:T},!0);else{let L;if(m)if(_){const Q=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),X=m.match(/p=[0-9]{1,6}/g);L={isSuccess:w,gatewayIp:Q&&Q.length?Q[0].split("=")[1].replace(/-/g,"."):"",port:X&&X.length?X[0].split("=")[1]:"",isProxy:_?1:0}}else{const Q=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),X=m.match(/(:|p=)[0-9]{1,6}/g);L={isSuccess:w,gatewayIp:Q&&Q.length?Q[0].split("//")[1].replace(/-/g,"."):"",port:X&&X.length?X[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else L={isSuccess:w,gatewayIp:"",port:"",isProxy:_?1:0};delete T.success,delete T.eventType,delete T.firstSuccess,T.vid=Number(T.vid);const B=Object.assign({},T,L,{eventType:VT.REJOIN_GATEWAY});this.send({type:JS.RE_JOIN_GATEWAY,data:B},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=Date.now(),s=_y(_y({},n.info),{},{lts:a,timeout:e,elapse:a-n.startTime});this.send({type:JS.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y({},a),{},{eventType:VT.PUBLISH,lts:s,eventElapse:e.eventElapse,elapse:s-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:JS.PUBLISH,data:d},!0)}subscribe(t,e,n){const a=this.baseInfoMap.get(t);if(!a)return;const s=a.info,d=Date.now(),f=_y(_y({},s),{},{eventType:VT.SUBSCRIBE,lts:d,eventElapse:e.eventElapse,elapse:d-a.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?f.peerSuid=e.peerid:f.peer=e.peerid,this.send({type:JS.SUBSCRIBE,data:f},!0)}wsCompressorInit(t){var e;const n=[...V0(e=this.baseInfoMap).call(e)],a=n.length?n[0]:"UnableToGetSid",s=this.baseInfoMap.get(a);if(!s)return;const d=s.info,f=Date.now(),m=_y(_y({},d),{},{eventType:VT.WS_COMPRESSOR_INIT,lts:f,eventElapse:t.eventElapse,elapse:f-s.startTime,status:t.status?1:2});this.send({type:JS.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,e,n,a){const s=this.baseInfoMap.get(t);if(!s)return;const d=s.info,f=Date.now(),m=_y(_y(_y({},d),a),{},{elapse:f-s.startTime,eventType:e,lts:f,firstDecodeFrame:Math.max((a.firstFrame||f)-s.startTime,0),apEnd:Math.max(a.apEnd-s.startTime,0),apStart:Math.max(a.apStart-s.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-s.startTime,0),joinGwStart:Math.max(a.joinGwStart-s.startTime,0),pcEnd:Math.max(a.pcEnd-s.startTime,0),pcStart:Math.max(a.pcStart-s.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-s.startTime,0),subscriberStart:Math.max(a.subscriberStart-s.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-s.startTime,0)});this.send({type:n,data:m},!0)}firstRemoteFrame(t,e,n,a){const s=this.baseInfoMap.get(t);if(!s)return;const d=s.info,f=Date.now(),m=_y(_y(_y({},d),a),{},{elapse:f-s.startTime,eventType:e,lts:f});this.send({type:n,data:m},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y(_y({},a),e),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:s-n.startTime,eventType:VT.AB_TEST,lts:s});this.send({type:JS.AB_TEST,data:d},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y(_y({},a),e),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:s-n.startTime,eventType:VT.PC_STATS,lts:s,preallocation:e.preallocation?1:0});this.send({type:JS.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y(_y({},a),e),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:VT.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:JS.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,e,n,a){const s=this.baseInfoMap.get(t);if(!s)return;const d=s.info,f=Date.now(),m=_y(_y(_y({},d),a),{},{eventType:e,lts:f});this.send({type:n,data:m},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y({},a),{},{eventType:VT.STREAM_SWITCH,lts:s,isDual:e.isdual,elapse:s-n.startTime,success:e.succ});this.send({type:JS.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y({},a),{},{eventType:VT.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-e.lts,elapse:s-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:JS.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y({},a),{},{eventType:VT.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-e.lts,elapse:s-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:JS.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?F.debug("reportProxyServerurl: ".concat(t)):F.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y({},a),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:s,elapse:s-n.startTime,joinChannelSuccessElapse:s-(n.lastJoinSuccessTime||s),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:JS.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now();(function(d,f,m){const _=d[f];if(!_||typeof _!="string")return[d];d[f]="";const y=vN(JSON.stringify(d));let T=0;const w=[];let L=0;for(let B=0;B<_.length;B++)L+=_.charCodeAt(B)<=127?1:3,L<=m-y||(w[w.length]=D_(D_({},d),{},{[f]:_.substring(T,B)}),T=B,L=_.charCodeAt(B)<=127?1:3);return T!==_.length-1&&(w[w.length]=D_(D_({},d),{},{[f]:_.substring(T)})),w})(_y(_y(_y({},a),e),{},{elapse:s-n.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:JS.WORKER_EVENT,data:d},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y(_y({},a),e),{},{elapse:s-n.startTime,lts:s});this.send({type:JS.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y(_y({},a),e),{},{elapse:s-n.startTime,lts:s,extend:e.extend||void 0});this.send({type:JS.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const a=n.info,s=Date.now(),d=_y(_y(_y({},a),e),{},{elapse:s-n.startTime,lts:s});this.send({type:JS.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>aa("CUSTOM_REPORT_LIMIT"))throw new t_(_i.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),a=e.map(s=>({type:JS.USER_ANALYTICS,data:_y(_y({sid:t},s),{},{lts:n})}));try{aa("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(s){throw F.error("send custom report message failed",s.toString()),new t_(_i.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(t){const e=aa("NOT_REPORT_EVENT");if(t.tag&&T_(e)&&T_(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:s,cid:d}=n.info;let f;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof t_){const{code:_,message:y}=t.error;f=_||y||t.error.toString()}else f=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:d,uid:s,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?f:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:JS.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>aa("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],a=[];for(;t.length;){const d=t.shift();n.length<20?n.push(d):a.push(d)}t.push(...a);for(const d of[...n]){var s;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),_2(s=this.ltsList).call(s,(f,m)=>f-m))}return e||(this.lastSendNormalEventTime=Date.now()),aa("ENABLE_EVENT_REPORT")&&n.length&&(aa("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((d=>f=>{aa("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>aa("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-aa("NORMAL_EVENT_QUEUE_CAPACITY")),F.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){ST.networkState===O0.OFFLINE&&await A_.race([ST.onlineWaiter,QT(2*wT.maxRetryTimeout)]);const e=s=>{let d=new Uint8Array;return s.forEach(f=>{const m=s7(JSON.stringify(f.data)),_=new ArrayBuffer(5),y=(w=>{let L=0;return Object.entries(JS).forEach(B=>{let[Q,X]=B;X===w.type&&(L=Cht[Q])}),L})(f),T=new DataView(_);T.setUint16(0,m.byteLength,!0),T.setUint8(2,255&y),T.setUint8(3,y>>>8&255),T.setUint8(4,y>>>16&255),d=I$(d,new Uint8Array(_)),d=I$(d,m)}),d},n="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aa("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(aa("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let s=0;s<2;s+=1){s===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aa("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(aa("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await f7(a,{timeout:1e4,data:e(t),headers:_y(_y({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(s===1)throw d;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(t[0]),a=n?void 0:this._aid,s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:n,aid:a};ST.networkState===O0.OFFLINE&&await A_.race([ST.onlineWaiter,QT(2*wT.maxRetryTimeout)]);const d=e?"/events/proto-raws":"/events/messages";let f=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aa("EVENT_REPORT_DOMAIN"),"&p=").concat(aa("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(aa("EVENT_REPORT_DOMAIN"),":").concat(aa("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(f=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(aa("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(aa("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(aa("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(aa("STATS_COLLECTOR_PORT")).concat(d)));try{e?await dht(f,{timeout:1e4,data:s}):await f7(f,{timeout:1e4,data:s})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(t,e){const n=Object.assign({},Aht);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),a=n[n.length-1];a&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:a,tag:oT.TRACER}).onSuccess()}};rtt.on("REPORT_LOG_UPLOAD",t=>{t.networkState=ST.networkState,V_.reportApiInvoke(null,{name:"logUploadError",options:t,tag:oT.TRACER}).onSuccess("logUploadError")});class _E extends t_{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),sT(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,F)}throw(){super.throw(F)}}const $T={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function pS(){return $T}function att(){return"setSinkId"in HTMLAudioElement.prototype&&(!aa("RESTRICTION_SET_PLAYBACK_DEVICE")||(dL()||g$())&&!i7())}function stt(){return!$T.supportUnifiedPlan||aa("CHROME_FORCE_PLAN_B")&&hL()}let tR=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function JV(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function dS(t,e,n,a,s){return{width:t,height:e,frameRate:n,bitrateMin:a,bitrateMax:s}}function UO(t,e,n,a,s){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:a,bitrateMax:s}}function C7(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const Oht={"90p":dS(160,90),"90p_1":dS(160,90),"120p":dS(160,120,15,30,65),"120p_1":dS(160,120,15,30,65),"120p_3":dS(120,120,15,30,50),"120p_4":dS(212,120),"180p":dS(320,180,15,30,140),"180p_1":dS(320,180,15,30,140),"180p_3":dS(180,180,15,30,100),"180p_4":dS(240,180,15,30,120),"240p":dS(320,240,15,40,200),"240p_1":dS(320,240,15,40,200),"240p_3":dS(240,240,15,40,140),"240p_4":dS(424,240,15,40,220),"360p":dS(640,360,15,80,400),"360p_1":dS(640,360,15,80,400),"360p_3":dS(360,360,15,80,260),"360p_4":dS(640,360,30,80,600),"360p_6":dS(360,360,30,80,400),"360p_7":dS(480,360,15,80,320),"360p_8":dS(480,360,30,80,490),"360p_9":dS(640,360,15,80,800),"360p_10":dS(640,360,24,80,800),"360p_11":dS(640,360,24,80,1e3),"480p":dS(640,480,15,100,500),"480p_1":dS(640,480,15,100,500),"480p_2":dS(640,480,30,100,1e3),"480p_3":dS(480,480,15,100,400),"480p_4":dS(640,480,30,100,750),"480p_6":dS(480,480,30,100,600),"480p_8":dS(848,480,15,100,610),"480p_9":dS(848,480,30,100,930),"480p_10":dS(640,480,10,100,400),"720p":dS(1280,720,15,120,1130),"720p_auto":dS(1280,720,30,900,3e3),"720p_1":dS(1280,720,15,120,1130),"720p_2":dS(1280,720,30,120,2e3),"720p_3":dS(1280,720,30,120,1710),"720p_5":dS(960,720,15,120,910),"720p_6":dS(960,720,30,120,1380),"1080p":dS(1920,1080,15,120,2080),"1080p_1":dS(1920,1080,15,120,2080),"1080p_2":dS(1920,1080,30,120,3e3),"1080p_3":dS(1920,1080,30,120,3150),"1080p_5":dS(1920,1080,60,120,4780),"1440p":dS(2560,1440,30,120,4850),"1440p_1":dS(2560,1440,30,120,4850),"1440p_2":dS(2560,1440,60,120,7350),"4k":dS(3840,2160,30,120,8910),"4k_1":dS(3840,2160,30,120,8910),"4k_3":dS(3840,2160,60,120,13500)},wht={"480p":UO(640,480,5),"480p_1":UO(640,480,5),"480p_2":UO(640,480,30),"480p_3":UO(640,480,15),"720p":UO(1280,720,5),"720p_auto":dS(1280,720,30,900,3e3),"720p_1":UO(1280,720,5),"720p_2":UO(1280,720,30),"720p_3":UO(1280,720,15),"1080p":UO(1920,1080,5),"1080p_1":UO(1920,1080,5),"1080p_2":UO(1920,1080,30),"1080p_3":UO(1920,1080,15)},Iht={"1SL1TL":C7(1,1),"3SL3TL":C7(3,3),"2SL3TL":C7(2,3)};function bN(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Oht[t]):t}function O7(t){return typeof t=="string"?Object.assign({},wht[t]):t}function r8(t){return typeof t=="string"?Object.assign({},Iht[t]):t}const Nht={speech_low_quality:JV(16e3,!1),speech_standard:JV(32e3,!1,18),music_standard:JV(48e3,!1),standard_stereo:JV(48e3,!0,56),high_quality:JV(48e3,!1,128),high_quality_stereo:JV(48e3,!0,192)};function i8(t){return typeof t=="string"?Object.assign({},Nht[t]):t}const ZV=[];function ctt(t){return MT(t,"mediaSource",["screen","window","application"]),!0}let M_=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),US=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),QV=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Dht=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),kht=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),vM=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),$V=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),_B=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),t3=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),B0=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const w7={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},I7={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},utt={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Lht={uplinkNetworkQuality:0,downlinkNetworkQuality:0},ltt={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let xR=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),F0=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),B2=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),yM=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),IR=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),SN=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const N7={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let o8=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function dtt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function ZS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dtt(Object(n),!0).forEach(function(a){_m(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dtt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function _m(t,e,n){return(e=function(a){var s=function(d,f){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var _=m.call(d,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof s=="symbol"?s:String(s)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hS(t,e,n,a,s){var d,f,m={};return Object.keys(a).forEach(function(_){m[_]=a[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=LR(d=m1(f=n.slice()).call(f)).call(d,function(_,y){return y(t,e,_)||_},m),s&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(s):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,e,m),m=null),m}class htt extends eT{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(vM.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),_m(this,"trackMediaType",void 0),_m(this,"_ID",void 0),_m(this,"_rtpTransceiver",void 0),_m(this,"_lowRtpTransceiver",void 0),_m(this,"_hints",[]),_m(this,"_isClosed",!1),_m(this,"_originMediaStreamTrack",void 0),_m(this,"mediaStreamTrack",void 0),_m(this,"_external",{}),this._ID=n||xS(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(a){T_(ZV).call(ZV,a)||ZV.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||IP(()=>{var n;V_.reportApiInvoke(null,{name:OT.GET_MEDIA_STREAM_TRACK,options:[],tag:oT.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===QV.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=ZV.indexOf(e);n!==-1&&ZV.splice(n,1)}(this),this.emit($V.CLOSED),this.removeAllListeners(vM.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===QV.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(vM.TRANSCEIVER_UPDATED,e,n)}}class e3 extends htt{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),_m(this,"_enabled",!0),_m(this,"_muted",!1),_m(this,"_isExternalTrack",!1),_m(this,"_isClosed",!1),_m(this,"_enabledMutex",void 0),_m(this,"processor",void 0),_m(this,"_processorContext",void 0),_m(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new mR("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,F.debug("[".concat(this.getTrackId(),"] close")),this.emit(M_.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await MS(this,M_.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){F.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($V.TRACK_ENDED)}stateCheck(e,n){if(F.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),pL(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new t_(_i.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",F);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new t_(_i.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",F)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():A_.resolve([])}}const ptt=window.AudioContext||window.webkitAudioContext;let G0=null;const AS=new class extends eT{constructor(){super(...arguments),_m(this,"prevState",void 0),_m(this,"curState",void 0),_m(this,"currentTime",void 0),_m(this,"currentTimeStuckAt",void 0),_m(this,"interruptDetectorTrack",void 0),_m(this,"onLocalAudioTrackMute",()=>{F.info("ios15-interruption-start"),this.emit(tR.IOS_15_16_INTERRUPTION_START)}),_m(this,"onLocalAudioTrackUnmute",async()=>{F.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?F.info("ios15-interruption-end-canceled"):(G0&&await G0.suspend(),this.emit(tR.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){F.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){F.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function n3(){if(!G0){if(function(){if(!ptt)return void F.error("your browser is not support web audio");F.info("create audio context");const t=ZS({},aa("WEBAUDIO_INIT_OPTIONS"));F.debug("audio context init option:",JSON.stringify(t)),G0=new ptt(t),AS.curState=G0.state,G0.onstatechange=()=>{AS.prevState=AS.curState,AS.curState=G0?G0.state:void 0;const{prevState:e,curState:n}=AS,a=n==="running",s=n==="interrupted",d=e==="running",f=e==="suspended",m=e==="interrupted",_=lS().osVersion;(MR()||MO())&&d&&s&&(F.info("ios".concat(_,"-interruption-start")),AS.emit(tR.IOS_INTERRUPTION_START)),(MR()||MO())&&(f||m)&&a&&(F.info("ios".concat(_,"-interruption-end")),AS.emit(tR.IOS_INTERRUPTION_END)),e!==n&&AS.emit(tR.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=G0)===null||e===void 0?void 0:e.currentTime;AS.currentTime!==n?(AS.currentTimeStuckAt&&(F.debug("AudioContext current time resume at ".concat(n)),AS.currentTimeStuckAt=void 0),AS.currentTime=n):(n!==AS.currentTimeStuckAt&&(V_.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:oT.TRACER}).onSuccess(),F.warning("AudioContext current time stuck at ".concat(n))),AS.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,s=!1,d=!1,f=!1;function m(X){e.state==="running"?_(!1):MR()||MO()?e.state==="suspended"&&(_(!0),X&&e.resume().then(y,y)):e.state!=="closed"&&(_(!0),X&&e.resume().then(y,y))}function _(X){if(s!==X){s=X;for(let J=0,_n=n;J<_n.length;J+=1){const _r=_n[J];X?window.addEventListener(_r,T,{capture:!0,passive:!0}):window.removeEventListener(_r,T,{capture:!0,passive:!0})}}}function y(){m(!1)}function T(){m(!0)}function w(X){if(!f)if(a.paused)if(X){let J;L(!1),f=!0;try{J=a.play(),J?J.then(B,B):(a.addEventListener("playing",B),a.addEventListener("abort",B),a.addEventListener("error",B))}catch{B()}}else L(!0);else L(!1)}function L(X){if(d!==X){d=X;for(let J=0,_n=n;J<_n.length;J++){const _r=_n[J];X?window.addEventListener(_r,Q,{capture:!0,passive:!0}):window.removeEventListener(_r,Q,{capture:!0,passive:!0})}}}function B(){a.removeEventListener("playing",B),a.removeEventListener("abort",B),a.removeEventListener("error",B),f=!1,w(!1)}function Q(){w(!0)}if(MR()){const X=e.createMediaStreamDestination(),J=document.createElement("div");J.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=J.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=X.stream,w(!0)}AS.on(tR.STATE_CHANGE,function(){m(!0)}),m(!1)}(G0)}(),!G0)throw new t_(_i.NOT_SUPPORTED,"can not create audio context");return G0}return G0}function bM(t){if(function(){if(D7!==null)return D7;const a=n3(),s=a.createBufferSource(),d=a.createGain(),f=a.createGain();s.connect(d),s.connect(f),s.disconnect(d);let m=!1;try{s.disconnect(d)}catch{m=!0}return s.disconnect(),D7=m,m}())return;const e=t.connect,n=t.disconnect;t.connect=(a,s,d)=>{var f;return t._inputNodes||(t._inputNodes=[]),T_(f=t._inputNodes).call(f,a)||(a instanceof AudioNode?(t._inputNodes.push(a),e.call(t,a,s,d)):e.call(t,a,s)),t},t.disconnect=(a,s,d)=>{n.call(t),a?XH(t._inputNodes,a):t._inputNodes=[];for(const f of t._inputNodes)e.call(t,f)}}let D7=null;function k7(t,e){let n=!1;const a=1/e;if(aa("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{n?window.clearInterval(s):t(performance.now()/1e3)},1e3*a)}else{const s=n3();let d=s.createGain();d.gain.value=0,d.connect(s.destination);const f=()=>{if(n)return void(d=null);const m=s.createOscillator();m.onended=f,m.connect(d),m.start(0),m.stop(s.currentTime+a),t(s.currentTime)};f()}return()=>{n=!0}}class ftt{constructor(){_m(this,"context",void 0),_m(this,"analyserNode",void 0),_m(this,"sourceNode",void 0),this.context=n3(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||MR()||MO()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let s=0;s<e.length;++s)e[s]=a[s]/128-1}const n=LR(e).call(e,(a,s)=>a+s*s,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{F.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class mtt extends eT{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),_m(this,"outputNode",void 0),_m(this,"outputTrack",void 0),_m(this,"isPlayed",!1),_m(this,"sourceNode",void 0),_m(this,"context",void 0),_m(this,"audioBufferNode",void 0),_m(this,"destNode",void 0),_m(this,"audioOutputLevel",0),_m(this,"volumeLevelAnalyser",void 0),_m(this,"_processedNode",void 0),_m(this,"playNode",void 0),_m(this,"isDestroyed",!1),_m(this,"onNoAudioInput",void 0),_m(this,"isNoAudioInput",!1),_m(this,"_noAudioInputCount",0),this.context=n3(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),bM(this.outputNode),this.volumeLevelAnalyser=new ftt}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(B0.ON_AUDIO_BUFFER,function(a){for(let s=0;s<a.outputBuffer.numberOfChannels;s+=1){const d=a.outputBuffer.getChannelData(s);for(let f=0;f<d.length;f+=1)d[f]=0}return a.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!pS().webAudioMediaStreamDest)throw new t_(_i.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&JH(()=>{AS.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;MR()||MO()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let a;n.getFloatTimeDomainData?(a=new Float32Array(n.fftSize),n.getFloatTimeDomainData(a)):(a=new Uint8Array(n.fftSize),n.getByteTimeDomainData(a));let s=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await QT(200),await this.checkHasAudioInput(e?e+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Ett extends mtt{get isFreeze(){return!1}constructor(e,n,a){var s;if(super(),_m(this,"sourceNode",void 0),_m(this,"track",void 0),_m(this,"clonedTrack",void 0),_m(this,"audioElement",void 0),_m(this,"isCurrentTrackCloned",!1),_m(this,"isRemoteTrack",!1),_m(this,"originVolumeLevelAnalyser",void 0),_m(this,"rebuildWebAudio",async()=>{if(F.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void F.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>F.info("resume success")),F.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),bM(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),bM(this.outputNode),this.emit(B0.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new t_(_i.UNEXPECTED_ERROR);this.track=e;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(d),bM(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,F.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));bM(_),this.originVolumeLevelAnalyser=new ftt,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const f=lS();n&&f.os===jT.IOS&&Number((s=f.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(AS.on(tR.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),bM(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(B0.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),AS.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),F.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([n]));bM(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function gtt(t,e,n){const a=(d,f)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||f:d:f,s={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(e.height,1080),maxWidth:a(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(s.video.mandatory.maxFrameRate=e.frameRate.max,s.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(s.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function Pht(t,e){const n=await _tt(t.mediaSource),{sourceId:a,audio:s}=await function(d){let f=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new A_((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const T=document.createElement("div");T.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const L=document.createElement("div");L.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const B=document.createElement("div");B.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const Q=document.createElement("button");Q.innerHTML="cancel",Q.setAttribute("style","width: 85px;"),Q.onclick=()=>{document.body.removeChild(_n);const _r=new Error("NotAllowedError");_r.name="NotAllowedError",_(_r)};let X=f;const J=document.createElement("div");if(f){const _r=document.createElement("input");_r.setAttribute("type","checkbox");const ya=document.createElement("span");_r.setAttribute("style","margin-right: 6px;"),ya.innerText="Share audio",_r.checked=X,_r.onchange=()=>{X=_r.checked},J.appendChild(_r),J.appendChild(ya)}B.appendChild(J),B.appendChild(Q),T.appendChild(w),T.appendChild(L),T.appendChild(B);const _n=document.createElement("div");_n.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_n.appendChild(y),_n.appendChild(T),document.body.appendChild(_n),d.map(_r=>{if(_r.id){const ya=document.createElement("div");ya.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _l=_r.thumbnail;try{const{width:_d}=_l.getSize();_d>1920&&(_l=_l.resize({width:1920}))}catch(_d){throw _d&&_d.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_d}ya.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_l.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+_r.name.replace(/[\u00A0-\u9999<>\&]/g,function(_d){return"&#"+_d.charCodeAt(0)+";"})+"</span>",ya.onclick=()=>{document.body.removeChild(_n),m({sourceId:_r.id,audio:X})},L.appendChild(ya)}})})}(n,e);return await gtt(a,t,s)}async function _tt(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=N$();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new t_(_i.ELECTRON_IS_NULL);let a=null;try{var s;a=((s=n.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{a=null}a&&a.then||(a=new A_((d,f)=>{n.desktopCapturer.getSources({types:e},(m,_)=>{m?f(m):d(_)})}));try{return await a}catch(d){throw new t_(_i.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const L7=new mR("safari");let vtt=!1,ytt=!1;async function H0(t,e){let n=0,a=null;for(;n<2;)try{a=await Mht(t,e,n>0);break}catch(s){if(s instanceof t_)throw F.error("[".concat(e,"] ").concat(s.toString())),s;const d=a8(s.name||s.code||s,s.message);if(d.code===_i.MEDIA_OPTION_INVALID){F.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await QT(500);continue}throw F.error("[".concat(e,"] ").concat(d.toString())),d}if(!a)throw new t_(_i.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function Mht(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new t_(_i.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=pS(),s=new MediaStream;if(t.audioSource&&s.addTrack(t.audioSource),t.videoSource&&s.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return F.debug("Using Video Source/ Audio Source"),s;if(t.screen)if(N$())t.screen.sourceId?r3(s,await gtt(t.screen.sourceId,t.screen,!!t.screenAudio)):r3(s,await Pht(t.screen,!!t.screenAudio));else if(dL()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new t_(_i.NOT_SUPPORTED,"This browser does not support screen sharing");F.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const L=await(f=t.screen.extensionId,m=e,new A_((B,Q)=>{try{chrome.runtime.sendMessage(f,{getStream:!0},X=>{if(!X||!X.streamId)return F.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),X),void Q(new t_(_i.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));B(X.streamId)})}catch(X){F.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(f,")"),X.toString()),Q(new t_(_i.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=L,r3(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var d;t.screen.mediaSource&&ctt(t.screen.mediaSource);const L={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:B,surfaceSwitching:Q,systemAudio:X,preferCurrentTab:J}=t.screen,_n={selfBrowserSurface:B,surfaceSwitching:Q,systemAudio:X,preferCurrentTab:J};!B&&delete _n.selfBrowserSurface,!Q&&delete _n.surfaceSwitching,!X&&delete _n.systemAudio,!J&&delete _n.preferCurrentTab,F.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:L,audio:t.screenAudio,controls:_n})),r3(s,await navigator.mediaDevices.getDisplayMedia(ZS({video:L,audio:t.screenAudio},_n)))}else{if(!rT())throw F.error("[".concat(e,"] This browser does not support screenSharing")),new t_(_i.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&ctt(t.screen.mediaSource);const L={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};F.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(L))),r3(s,await navigator.mediaDevices.getUserMedia(L))}}var f,m;if(!t.video&&!t.audio)return s;let _={video:t.video,audio:t.audio},y=aa("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=l7(_,y)}catch{}F.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(_)),lS();let T,w=null;(aR()||MR()||WH())&&(w=await L7.lock());try{T=await navigator.mediaDevices.getUserMedia(_)}catch(L){throw w&&w(),L}return _.audio&&(vtt=!0),_.video&&(ytt=!0),r3(s,T),w&&w(),s}function a8(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new t_(_i.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new t_(_i.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new t_(_i.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new t_(_i.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new t_(_i.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new t_(_i.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return F.error("getUserMedia unexpected error",t),new t_(_i.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function r3(t,e){const n=t.getVideoTracks()[0],a=t.getAudioTracks()[0],s=e.getVideoTracks()[0],d=e.getAudioTracks()[0];d&&(a&&t.removeTrack(a),t.addTrack(d)),s&&(n&&t.removeTrack(n),t.addTrack(s))}const q0=new class extends eT{get state(){return this._state}set state(t){t!==this._state&&(this.emit(yM.STATE_CHANGE,t),this._state=t)}constructor(){super(),_m(this,"_state",B2.IDLE),_m(this,"isAccessMicrophonePermission",!1),_m(this,"isAccessCameraPermission",!1),_m(this,"lastAccessMicrophonePermission",!1),_m(this,"lastAccessCameraPermission",!1),_m(this,"checkdeviceMatched",!1),_m(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(aa("ENUMERATE_DEVICES_INTERVAL")||(YH()||KH()===jT.HARMONY_OS)&&hL())&&this.updateDevicesInfo()},aa("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>F.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new t_(_i.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&t,f=!this.isAccessCameraPermission&&e;s.audio&&(d=!1),s.video&&(f=!1);let m=null,_=null,y=null;if(!n&&(d||f)){if(L7.isLocked&&(F.debug("[device manager] wait GUM lock"),(await L7.lock())(),F.debug("[device manager] GUM unlock")),vtt&&(d=!1,this.isAccessMicrophonePermission=!0),ytt&&(f=!1,this.isAccessCameraPermission=!0),F.debug("[device manager] check media device permissions",t,e,d,f),d&&f){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(T){const w=a8(T.name||T.code||T,T.message);if(w.code===_i.PERMISSION_DENIED)throw w;F.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(T){const w=a8(T.name||T.code||T,T.message);if(w.code===_i.PERMISSION_DENIED)throw w;F.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(f){try{_=await navigator.mediaDevices.getUserMedia({video:e})}catch(T){const w=a8(T.name||T.code||T,T.message);if(w.code===_i.PERMISSION_DENIED)throw w;F.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}F.debug("[device manager] mic permission",t,"cam permission",e)}try{const T=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),y&&y.getTracks().forEach(w=>w.stop()),m=null,_=null,y=null,T}catch(T){return m&&m.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),y&&y.getTracks().forEach(w=>w.stop()),m=null,_=null,y=null,new t_(_i.ENUMERATE_DEVICES_FAILED,T.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new t_(_i.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=B2.INITING;try{await this.updateDevicesInfo(),this.state=B2.INITEND}catch(t){throw F.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=B2.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new t_(_i.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=t.find(f=>f.kind==="audioinput"&&f.deviceId==="default"),d=t.find(f=>f.kind==="audiooutput"&&f.deviceId==="default");s&&d?d.groupId===s.groupId?F.debug("[device-check] default input ".concat(s.label," and output ").concat(d.label," is the same group")):F.debug("[device-check] default input ".concat(s.label," and output ").concat(d.label," is not the same group")):F.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(s=>{if(!s.deviceId)return;const d=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const f={initAt:e,updateAt:e,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),f),n.push(f)}d&&(d.updateAt=e)}),this.deviceInfoMap.forEach((s,d)=>{s.state==="ACTIVE"&&s.updateAt!==e&&(s.state="INACTIVE",n.push(s))}),this.state!==B2.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(yM.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(yM.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(yM.PLAYOUT_DEVICE_CHANGED,s)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(s=>s.kind==="audioinput"),n=t.filter(s=>s.kind==="videoinput"),a={audio:!1,video:!1};for(const s of e)if(s.label&&s.deviceId){a.audio=!0;break}for(const s of n)if(s.label&&s.deviceId){a.video=!0;break}return a}};let P7=!1;const z0=new class extends eT{constructor(){super(...arguments),_m(this,"onAutoplayFailed",void 0),_m(this,"onAudioAutoplayFailed",void 0)}};function btt(){if(lS(),!P7){const t=e=>{e.preventDefault(),P7=!1,D2()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};P7=!0,D2()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),F.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),z0.onAutoplayFailed?z0.onAutoplayFailed():z0.onAudioAutoplayFailed?F.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):F.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),z0.emit("autoplay-failed")}}function Stt(t,e,n,a){if(!t)return;const s=V_.getBaseInfoBySessionId(t);if(!s)return;const d=s.info,f=Date.now(),m=ZS(ZS({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:f,elapse:f-s.startTime,cbRegistered:z0.onAutoplayFailed||z0.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:a,extend:void 0});V_.send({type:JS.AUTOPLAY_FAILED,data:m},!0)}const xht=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],YR=new class{constructor(){_m(this,"onAutoplayFailed",void 0),_m(this,"elementMap",new Map),_m(this,"elementStateMap",new Map),_m(this,"elementsNeedToResume",[]),_m(this,"sinkIdMap",new Map),_m(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,a]=e;const s=this.elementStateMap.get(n),d=a.srcObject.getAudioTracks()[0],f=d&&d.readyState;if(F.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(f," ").concat(t)),f==="live"){if(t)return a.pause(),void a.play();if(AS.curState==="running")return qV()?(a.pause(),void a.play()):void(s&&s==="paused"&&a.play())}})}),_m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const a=n.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(F.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),AS.on(tR.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),AS.on(tR.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),AS.on(tR.STATE_CHANGE,()=>{MR()&&AS.prevState==="suspended"&&AS.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(a){throw new t_(_i.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,e,n,a){if(this.elementMap.has(e))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,s),this.elementMap.set(e,s),this.elementStateMap.set(e,IR.INIT),this.setVolume(e,n);const d=this.sinkIdMap.get(e);if(d)try{s.setSinkId(d).catch(m=>{F.warning("[".concat(e,"] set sink id failed"),m.toString())})}catch(m){F.warning("[".concat(e,"] set sink id failed"),m.toString())}const f=s.play();f&&f.then&&f.catch(m=>{a&&Stt(a,"audio",m.message,e),F.warning("audio element play warning",m.toString()),this.elementMap.has(e)&&m.name==="NotAllowedError"&&(F.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),JH(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),btt()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){xht.forEach(n=>{e.addEventListener(n,a=>{const s=this.elementStateMap.get(t),d=a.type==="pause"?"paused":a.type;if(F.debug("[".concat(t,"] audio-element-status change ").concat(s," => ").concat(d)),a.type==="error"){const f=e==null?void 0:e.error;f&&F.error("[".concat(t,"] media error, code: ").concat(f.code,", message: ").concat(f.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{F.debug("Auto resume audio element success")}).catch(n=>{F.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new A_(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{D2()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function mT(){return function(t,e,n){const a=n.value;return typeof a=="function"&&(n.value=function(){this._isClosed&&new t_(_i.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",F);for(var s=arguments.length,d=new Array(s),f=0;f<s;f++)d[f]=arguments[f];const m=a.apply(this,d);return m instanceof A_?new A_((_,y)=>{m.then(_).catch(y)}):m}),n}}class Ttt extends eT{constructor(e){super(),_m(this,"name","VideoProcessorDestination"),_m(this,"ID","0"),_m(this,"_source",void 0),_m(this,"videoContext",void 0),_m(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new t_(_i.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new t_(_i.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(xR.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(xR.ON_TRACK,void 0)}}class Rtt extends eT{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),_m(this,"constraintsMap",new Map),_m(this,"statsRegistry",[]),_m(this,"usageRegistry",[]),_m(this,"trackId",void 0),_m(this,"direction",void 0),_m(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await cR(this,F0.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var a;return F.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),MS(this,F0.REQUEST_UPDATE_CONSTRAINTS,Array.from(l0(a=this.constraintsMap).call(a)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return F.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),MS(this,F0.REQUEST_UPDATE_CONSTRAINTS,Array.from(l0(n=this.constraintsMap).call(n)))}registerStats(e,n,a){this.statsRegistry.find(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:a})}unregisterStats(e,n){const a=this.statsRegistry.findIndex(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===n);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:a,type:s,cb:d}of this.statsRegistry)try{const f=d();e.push({processorID:n,processorName:a,type:s,stats:f})}catch(f){F.error(new t_(_i.UNEXPECTED_ERROR,f.message))}return e}registerUsage(e,n){this.usageRegistry.find(a=>a.processorID===e.ID&&a.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(a=>a.processorID===e.ID&&a.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let a=n();a instanceof A_&&(a=await a),e.push(ZS(ZS({},a),{},{direction:this.direction}))}catch(a){F.error("gather extension usage error",a)}return e}getDirection(){return this.direction}}class Att extends eT{constructor(e){super(),_m(this,"name","AudioProcessorDestination"),_m(this,"ID","0"),_m(this,"inputTrack",void 0),_m(this,"inputNode",void 0),_m(this,"audioProcessorContext",void 0),_m(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new t_(_i.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new t_(_i.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(xR.ON_TRACK,void 0),this.emit(xR.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(xR.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(xR.ON_NODE,this.inputNode))}}class Ctt extends eT{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,a){super(),_m(this,"constraintsMap",new Map),_m(this,"statsRegistry",[]),_m(this,"audioContext",void 0),_m(this,"trackId",void 0),_m(this,"direction",void 0),_m(this,"usageRegistry",[]),_m(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=a}async getConstraints(){return cR(this,F0.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var a;return F.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),MS(this,F0.REQUEST_UPDATE_CONSTRAINTS,Array.from(l0(a=this.constraintsMap).call(a)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),MS(this,F0.REQUEST_UPDATE_CONSTRAINTS,Array.from(l0(n=this.constraintsMap).call(n)))}registerStats(e,n,a){this.statsRegistry.find(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:a})}unregisterStats(e,n){const a=this.statsRegistry.findIndex(s=>s.processorID===e.ID&&s.processorName===e.name&&s.type===n);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:a,type:s,cb:d}of this.statsRegistry)try{const f=d();e.push({processorID:n,processorName:a,type:s,stats:f})}catch(f){F.error(new t_(_i.UNEXPECTED_ERROR,f.message))}return e}registerUsage(e,n){this.usageRegistry.find(a=>a.processorID===e.ID&&a.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(a=>a.processorID===e.ID&&a.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let a=n();a instanceof A_&&(a=await a),e.push(ZS(ZS({},a),{},{direction:this.direction}))}catch(a){F.error("gather extension usage error",a)}return e}getDirection(){return this.direction}}class M7 extends eT{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),_m(this,"context",void 0),_m(this,"processSourceNode",void 0),_m(this,"outputTrack",void 0),_m(this,"processedNode",void 0),_m(this,"clonedTrack",void 0),_m(this,"outputNode",void 0),this.outputNode=new Uht}setVolume(){}createOutputTrack(){throw new t_(_i.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Uht{disconnect(){}connect(){}}function Ott(t){return new A_((e,n)=>{let a=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const d=MR()?"canplay":"playing";s.addEventListener(d,()=>{const f=s.videoWidth,m=s.videoHeight;!f&&rT()||(a=!0,s.srcObject=null,s.remove(),e([f,m]))}),s.srcObject=new MediaStream([t]),s.play().catch(ZH),setTimeout(()=>{a||(s.srcObject=null,s.remove(),e([s.videoWidth,s.videoHeight]))},4e3)})}function s8(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=bN(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!A$()&&n.frameRate&&(e.frameRate=n.frameRate),g$()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),rT()&&(e.frameRate={ideal:30,max:30}),e}function wtt(t){const e={};return A$()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,dL()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function Itt(t){const e=wtt(t);if(t.encoderConfig){const n=i8(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),YH()&&(e.sampleRate=void 0),e}const jht=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:a,height:s}=t.getMediaStreamTrackSettings();let{frameRate:d=n,width:f=a,height:m=s}=e;if(!d||!f||!m)return;f=d7(f),m=d7(m),d=d7(d);const{max:_,min:y}=function(B,Q,X){const J=200*Math.pow(X/15,.6)*Math.pow(B*Q/640/360,.75);return{min:Math.floor(J),max:Math.floor(4*J)}}(f,m,d),{bitrateMax:T,bitrateMin:w}=e||{};T||F.debug("calculate bitrate: [w: ".concat(f,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(T,", brMin: ").concat(w,"]"));const{maxFramerate:L}=aa("ENCODER_CONFIG_LIMIT");return L&&typeof L=="number"&&(d=Math.min(d,L)),{frameRate:d,bitrateMax:T||_,bitrateMin:w||y,scaleResolutionDownBy:1,scale:0}},Ntt=async(t,e,n)=>await(async(a,s,d)=>{const f=function(y){const T=[];for(let w=0;w<y.length;w+=2)T.push(parseInt(y.slice(w,w+2),16));return Uint8Array.from(T)}(F$(""+s+d)).slice(0,16),m=f.slice(0,12),_=await window.crypto.subtle.importKey("raw",f,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,a))})(t.buffer,e,n),x7=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new A_((n,a)=>{e.toBlob(async s=>{if(e.remove(),s){const d=await Dtt(s);n({buffer:d,width:e.width,height:e.height})}else a(new t_(_i.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Dtt=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var ktt,Ltt,Ptt,Mtt,xtt,Utt,jtt,Vtt,Btt,Ftt,Gtt,Htt,qtt,ztt,Ktt,Wtt,Ytt,Xtt,nT,Jtt,Ztt,Qtt,$tt,tet,eet,TN,net,ret,iet,oet,aet,set,cet,uet,det,het,pet,fet,met,lR;let uT=(ktt=K_({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Ltt=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Ptt=mT(),Mtt=WV("LocalAudioTrack","_enabledMutex"),xtt=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Utt=mT(),jtt=WV("LocalAudioTrack","_enabledMutex"),Vtt=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Btt=mT(),Ftt=mT(),Gtt=mT(),Htt=K_({argsMap:t=>[t.getTrackId()]}),qtt=mT(),ztt=K_({argsMap:t=>[t.getTrackId()]}),Ktt=mT(),Wtt=K_({argsMap:t=>[t.getTrackId()]}),Ytt=K_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Xtt=K_({argsMap:t=>[t.getTrackId()]}),hS((nT=class extends e3{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?YR.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,a){super(t,n),_m(this,"trackMediaType",t3.AUDIO),_m(this,"_encoderConfig",void 0),_m(this,"_trackSource",void 0),_m(this,"metadata",[]),_m(this,"_enabled",!0),_m(this,"_volume",100),_m(this,"_useAudioElement",!0),_m(this,"_bypassWebAudio",!1),_m(this,"processor",void 0),_m(this,"_processorContext",void 0),_m(this,"_processorDestination",void 0),_m(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!a,this._trackSource=new M7,aa("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),aa("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),aR()&&!G0?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){IS(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&YR.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void F.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,MS(this,M_.NEED_REPLACE_TRACK,this).then(()=>{F.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{F.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!att())throw new t_(_i.NOT_SUPPORTED,"your browser does not support setting the audio output device");await YR.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await MS(this,M_.NEED_ENABLE_TRACK,this),F.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw n||(this._enabled=!1),F.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await MS(this,M_.NEED_DISABLE_TRACK,this)}catch(a){throw n||(this._enabled=!0),F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,F.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await MS(this,M_.NEED_MUTE_TRACK,this):await MS(this,M_.NEED_UNMUTE_TRACK,this))}getStats(){return IP(()=>{F.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),U0(this,M_.GET_STATS)||ZS({},w7)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(B0.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(B0.ON_AUDIO_BUFFER),this._source.on(B0.ON_AUDIO_BUFFER,n=>t(n))}play(){F.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(F.debug("[".concat(this.getTrackId(),"] start audio playback in element")),YR.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){F.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?YR.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];F.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&YR.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await MS(this,M_.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return A_.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new t_(_i.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new t_(_i.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(xR.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await MS(this,M_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await MS(this,M_.NEED_REPLACE_TRACK,this))}),t.on(xR.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(xR.ON_TRACK),t.removeAllListeners(xR.ON_NODE)}bindProcessorContextEvents(t){t.on(F0.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(F0.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof M7&&(this._trackSource=new Ett(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Ctt(this._source.context,this.getTrackId(),"local"),e=new Att(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(B0.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(YR.stop(this.getTrackId()),this._source.play()),MS(this,M_.NEED_REPLACE_MIXING_TRACK,this).then(()=>{F.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{F.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[ktt],Object.getOwnPropertyDescriptor(nT.prototype,"setVolume"),nT.prototype),hS(nT.prototype,"setPlaybackDevice",[Ltt,Ptt],Object.getOwnPropertyDescriptor(nT.prototype,"setPlaybackDevice"),nT.prototype),hS(nT.prototype,"setEnabled",[Mtt,xtt,Utt],Object.getOwnPropertyDescriptor(nT.prototype,"setEnabled"),nT.prototype),hS(nT.prototype,"setMuted",[jtt,Vtt,Btt],Object.getOwnPropertyDescriptor(nT.prototype,"setMuted"),nT.prototype),hS(nT.prototype,"getStats",[Ftt],Object.getOwnPropertyDescriptor(nT.prototype,"getStats"),nT.prototype),hS(nT.prototype,"setAudioFrameCallback",[Gtt],Object.getOwnPropertyDescriptor(nT.prototype,"setAudioFrameCallback"),nT.prototype),hS(nT.prototype,"play",[Htt,qtt],Object.getOwnPropertyDescriptor(nT.prototype,"play"),nT.prototype),hS(nT.prototype,"stop",[ztt,Ktt],Object.getOwnPropertyDescriptor(nT.prototype,"stop"),nT.prototype),hS(nT.prototype,"close",[Wtt],Object.getOwnPropertyDescriptor(nT.prototype,"close"),nT.prototype),hS(nT.prototype,"pipe",[Ytt],Object.getOwnPropertyDescriptor(nT.prototype,"pipe"),nT.prototype),hS(nT.prototype,"unpipe",[Xtt],Object.getOwnPropertyDescriptor(nT.prototype,"unpipe"),nT.prototype),nT),c8=(Jtt=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Ztt=mT(),Qtt=WV("MicrophoneAudioTrack","_enabledMutex"),$tt=K_({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),tet=mT(),eet=K_({argsMap:t=>[t.getTrackId()]}),hS((TN=class extends uT{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,a){super(t,e.encoderConfig?i8(e.encoderConfig):{},a,aa("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),_m(this,"_config",void 0),_m(this,"_deviceName","default"),_m(this,"_constraints",void 0),_m(this,"_originalConstraints",void 0),_m(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(qV()||r7())&&AS.bindInterruptDetectorTrack(this)}async setDevice(t){if(F.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await q0.getDeviceById(t),n={};n.audio=ZS({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await H0(n,this.getTrackId())}catch(s){throw F.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),a=await H0({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await q0.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}F.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return F.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),t),aa("AUTO_RESET_AUDIO_ROUTE")&&(MR()||MO())){const f=navigator.audioSession;f&&(t||(f.type="playback"),f.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),n||(this._enabled=!1);try{await MS(this,M_.NEED_DISABLE_TRACK,this)}catch(f){throw F.error("[".concat(this.getTrackId(),"] setEnabled false failed"),f.toString()),f}return}const s=ZS({},this._constraints),d=q0.searchDeviceIdByName(this._deviceName);d&&!s.deviceId&&(s.deviceId=d);try{n||(this._enabled=!0);const f=await H0({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(f.getAudioTracks()[0],!1),await MS(this,M_.NEED_ENABLE_TRACK,this)}catch(f){throw n||(this._enabled=!1),F.error("[".concat(this.getTrackId(),"] setEnabled true failed"),f.toString()),f}F.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(qV()||r7())&&AS.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((MR()||MO())&&this._enabled&&!this._isClosed&&AS.duringInterruption){const t=async()=>{AS.off(tR.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};AS.on(tR.IOS_INTERRUPTION_END,t)}else F.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($V.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=q0.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const a=await H0({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(F0.REQUEST_UPDATE_CONSTRAINTS,async(e,n,a)=>{try{const s=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(s),n()}catch(s){a(s)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(F0.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Jtt,Ztt],Object.getOwnPropertyDescriptor(TN.prototype,"setDevice"),TN.prototype),hS(TN.prototype,"setEnabled",[Qtt,$tt,tet],Object.getOwnPropertyDescriptor(TN.prototype,"setEnabled"),TN.prototype),hS(TN.prototype,"close",[eet],Object.getOwnPropertyDescriptor(TN.prototype,"close"),TN.prototype),TN),Vht=(net=K_({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),ret=mT(),iet=K_({argsMap:t=>[t.getTrackId()]}),oet=mT(),aet=K_({argsMap:t=>[t.getTrackId()]}),set=mT(),cet=K_({argsMap:t=>[t.getTrackId()]}),uet=mT(),det=K_({argsMap:t=>[t.getTrackId()]}),het=mT(),pet=K_({argsMap:t=>[t.getTrackId()]}),fet=K_({argsMap:t=>[t.getTrackId()]}),met=mT(),hS((lR=class extends uT{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,a){super(e.createOutputTrack(),n,a),_m(this,"source",void 0),_m(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(B0.AUDIO_SOURCE_STATE_CHANGE,s=>{this.safeEmit($V.SOURCE_STATE_CHANGE,s)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){IS(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[net,ret],Object.getOwnPropertyDescriptor(lR.prototype,"startProcessAudioBuffer"),lR.prototype),hS(lR.prototype,"pauseProcessAudioBuffer",[iet,oet],Object.getOwnPropertyDescriptor(lR.prototype,"pauseProcessAudioBuffer"),lR.prototype),hS(lR.prototype,"seekAudioBuffer",[aet,set],Object.getOwnPropertyDescriptor(lR.prototype,"seekAudioBuffer"),lR.prototype),hS(lR.prototype,"resumeProcessAudioBuffer",[cet,uet],Object.getOwnPropertyDescriptor(lR.prototype,"resumeProcessAudioBuffer"),lR.prototype),hS(lR.prototype,"stopProcessAudioBuffer",[det,het],Object.getOwnPropertyDescriptor(lR.prototype,"stopProcessAudioBuffer"),lR.prototype),hS(lR.prototype,"close",[pet],Object.getOwnPropertyDescriptor(lR.prototype,"close"),lR.prototype),hS(lR.prototype,"setAudioBufferPlaybackSpeed",[fet,met],Object.getOwnPropertyDescriptor(lR.prototype,"setAudioBufferPlaybackSpeed"),lR.prototype),lR);class kT extends uT{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=n3().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,xS(8,"track-mix-")),_m(this,"trackList",void 0),_m(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(F.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):F.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){F.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}XH(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof kT?n.emit(vM.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class Bht extends mtt{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(B0.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),_m(this,"audioBuffer",void 0),_m(this,"sourceNode",void 0),_m(this,"startPlayTime",0),_m(this,"startPlayOffset",0),_m(this,"pausePlayTime",0),_m(this,"options",void 0),_m(this,"currentLoopCount",0),_m(this,"currentPlaybackSpeed",100),_m(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):F.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Eet=new Map;class U7{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(F.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){_m(this,"trackId",void 0),_m(this,"config",void 0),_m(this,"onFirstVideoFrameDecoded",void 0),_m(this,"onVideoStateChanged",void 0),_m(this,"freezeTimeCounterList",[]),_m(this,"renderFreezeAccTime",0),_m(this,"isKeepLastFrame",!1),_m(this,"timeUpdatedCount",0),_m(this,"freezeTime",0),_m(this,"playbackTime",0),_m(this,"lastTimeUpdatedTime",0),_m(this,"autoplayFailed",!1),_m(this,"videoTrack",void 0),_m(this,"videoElement",void 0),_m(this,"cacheVideoElement",void 0),_m(this,"renderStats",void 0),_m(this,"_videoState",SN.VideoStateStopped),_m(this,"videoElementCheckInterval",void 0),_m(this,"videoElementFreezeTimeout",void 0),_m(this,"_videoElementStatus",IR.NONE),_m(this,"isGettingVideoDimensions",!1),_m(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return F.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),_m(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&AS.curState==="running"&&(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(E$())),T$()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),_m(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=IR.PLAYING;break;case"loadeddata":if(this.videoState=SN.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=IR.CANPLAY;break;case"stalled":this.videoElementStatus=IR.STALLED;break;case"suspend":this.videoElementStatus=IR.SUSPEND;break;case"pause":this.videoElementStatus=IR.PAUSED,MR()||MO()||aR()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=IR.WAITING;break;case"abort":this.videoElementStatus=IR.ABORT;break;case"ended":this.videoElementStatus=IR.ENDED;break;case"emptied":this.videoElementStatus=IR.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=IR.ERROR,F.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const s=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,mL.lastVisibleTime<mL.lastHiddenTime||d<mL.lastHiddenTime||d<mL.lastVisibleTime)return;for(s>aa("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const f=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(f),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),_m(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(E$())),T$()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),AS.on(tR.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),AS.on(tR.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(s=>{e&&Stt(e,"video",s.message,this.trackId),s.name==="NotAllowedError"?(F.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):F.warning("[".concat(this.trackId,"] play warning: "),s)});const a=lS();if((a.name==="Safari"&&Number(a.version)===15||qV())&&n&&n.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(s).catch(s)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return F.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const a=n.getImageData(0,0,e.width,e.height);return e.remove(),a}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const s=a.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,a.width,a.height),new A_((d,f)=>{a.toBlob(async m=>{if(a.remove(),m){const _=await Dtt(m);d({buffer:_,width:a.width,height:a.height})}else f(new t_(_i.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await x7(e)}destroy(){this.renderStats=void 0,AS.off(tR.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),AS.off(tR.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=SN.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=IR.INIT,!this.videoElementCheckInterval&&(get.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)||(this.videoElementStatus=IR.DESTROYED)},1e3),aa("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let d;const f=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",f),this.videoElementFreezeTimeout=window.setTimeout(m,aa("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===SN.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=SN.VideoStateFrozen:document.addEventListener("visibilitychange",f))},_=(y,T)=>{if(this.videoElementStatus===IR.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=T.mediaTime):this.renderStats={lastTs:T.mediaTime,curTs:T.mediaTime,lastRenderNum:0,renderNum:0},d){const B=T.presentationTime-d.presentationTime;this.videoState===SN.VideoStateStarting&&(this.videoState=SN.VideoStateDecoding),this.videoState===SN.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,aa("VIDEO_FREEZE_DURATION"))),B<aa("VIDEO_FREEZE_DURATION")&&this.videoState===SN.VideoStateFrozen&&(this.videoState=SN.VideoStateDecoding),B>aa("VIDEO_FREEZE_DURATION")&&mL.lastVisibleTime>=mL.lastHiddenTime&&d.timestamp>mL.lastVisibleTime&&d.timestamp>mL.lastHiddenTime&&(this.renderFreezeAccTime+=B)}d=ZS(ZS({},T),{},{timestamp:y})}var w,L;aa("ENABLE_VIDEO_FRAME_CALLBACK")&&((w=(L=this.videoElement).requestVideoFrameCallback)===null||w===void 0||w.call(L,_))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),YH()&&!aa("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=lS();a.name==="Safari"&&Number(a.version)===15||qV()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,rT()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,rT()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(d=>{F.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){get.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=IR.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{F.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{F.error(a)}),this.autoplayFailed=!1,D2()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};D2()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),btt()}}const get=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class _et extends U7{constructor(e){super(e),_m(this,"container",void 0),_m(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,a):await x7(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",aa("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var vet,yet,bet,Tet,Ret,Aet,Cet,Oet,wet,Iet,Net,Det,ket,Let,Pet,Met,xet,Uet,jet,Vet,Bet,Fet,Get,Het,sS,qet,zet,Ket,Wet,Yet,Xet,Jet,Zet,K0;let zS=(vet=K_({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),yet=mT(),bet=K_({argsMap:t=>[t.getTrackId()]}),Tet=WV("LocalVideoTrack","_enabledMutex"),Ret=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Aet=mT(),Cet=WV("LocalVideoTrack","_enabledMutex"),Oet=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),wet=mT(),Iet=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Net=mT(),Det=mT(),ket=K_({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),Let=mT(),Pet=mT(),Met=mT(),xet=mT(),Uet=mT(),jet=mT(),Vet=mT(),Bet=K_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Fet=K_({argsMap:t=>[t.getTrackId()]}),Get=K_({argsMap:t=>[t.getTrackId()]}),Het=K_({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),sS=class bat extends e3{get videoHeight(){if(aR()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(aR()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==IR.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,a,s,d,f){if(super(e,d),_m(this,"trackMediaType",t3.VIDEO),_m(this,"_player",void 0),_m(this,"isUseScaleResolutionDownBy",!1),_m(this,"_videoVisibleTimer",null),_m(this,"_previousVideoVisibleStatus",void 0),_m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_m(this,"_encoderConfig",void 0),_m(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),_m(this,"_optimizationMode",void 0),_m(this,"_videoHeight",void 0),_m(this,"_videoWidth",void 0),_m(this,"_forceBitrateLimit",void 0),_m(this,"_enabled",!0),_m(this,"_processorDestination",void 0),_m(this,"_processorContext",void 0),aR()){const{width:m,height:_}=e.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=a,this._optimizationMode=s,this._hints=f||[],this._hints.indexOf(US.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(t7(mS.CHROME,115)&&KH().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&pS().supportWebRTCInsertableStream){const T=new MediaStreamTrackProcessor(_),w=new MediaStreamTrackGenerator({kind:"video"});let L,B,Q=Date.now();const X=()=>{J&&(clearInterval(J),J=void 0),L&&(L.close(),L=void 0),_.stop(),B=void 0,w.removeEventListener("ended",X)};let J=window.setInterval(()=>{if(B&&L&&Date.now()-Q>1e3)try{w.readyState==="live"?B.enqueue(L.clone()):X()}catch{X()}},1e3);const _n=new TransformStream({transform:(_r,ya)=>{w.readyState==="live"?(B=ya,Q=Date.now(),L===void 0?(L=_r,ya.enqueue(_r.clone())):(ya.enqueue(L),L=_r)):_r.close()}});return w.addEventListener("ended",X),T.readable.pipeThrough(_n).pipeTo(w.writable),w}}(e);m&&(F.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}n&&this._hints.indexOf(US.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new Rtt(this.getTrackId(),"local"),this._processorDestination=new Ttt(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const s=document.getElementById(e);s?e=s:(F.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}F.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const a=ZS(ZS(ZS({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(a):(e instanceof HTMLVideoElement?this._player=new U7(a):this._player=new _et(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit($V.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},aa("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,F.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await MS(this,M_.NEED_DISABLE_TRACK,this)}catch(a){throw F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return n||(this._enabled=!1),void F.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await MS(this,M_.NEED_ENABLE_TRACK,this)}catch(a){throw F.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}F.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,F.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await MS(this,M_.NEED_MUTE_TRACK,this):await MS(this,M_.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new t_(_i.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=bN(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const a=s8({encoderConfig:e});(aR()||MR()||MO())&&(a.deviceId=void 0),F.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(s){const d=new t_(_i.UNEXPECTED_ERROR,s.toString());throw F.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=e,this._hints.indexOf(US.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await MS(this,M_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(F)}}getStats(){return IP(()=>{F.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),U0(this,M_.GET_STATS)||ZS({},I7)}async setBeautyEffect(e){F.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await x7(e)}async setBitrateLimit(e){F.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void F.error(_i.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await MS(this,M_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=n,F.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}F.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return F.error(_i.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,F.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){Ott(this._originMediaStreamTrack).then(e=>{let[n,a]=e;this._videoHeight=a,this._videoWidth=n}).catch(ZH)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new t_(_i.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");F.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=bN(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(US.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await MS(this,M_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(F)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:a}=this.getMediaStreamTrackSettings();if(!e||!n||!a)return;const{bitrateMax:s,bitrateMin:d}=this._encoderConfig;if(d==null||s==null){const{max:f,min:m}=function(_,y,T,w,L){const B=aa("BITRATE_ADAPTER_TYPE");if(B==="DEFAULT_BITRATE")return{min:w,max:L};if(L===void 0){var Q;const J=Math.floor(200*Math.pow(T/15,.6)*Math.pow(_*y/640/360,.75));L=B==="STANDARD_BITRATE"?4*J:2*J,w=(Q=w)!==null&&Q!==void 0?Q:J}else{var X;w=(X=w)!==null&&X!==void 0?X:Math.floor(L/10)}return{min:w,max:L}}(e,n,a,d,s);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=f,F.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(a,"] => [brMax: ").concat(f,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const a=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:f}=s;if(this.isPlaying&&d instanceof HTMLVideoElement&&f instanceof HTMLElement){const m=w$.checkOneElementVisible(d),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=V_.reportApiInvoke(null,{tag:oT.TRACER,name:OT.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(a){throw new t_(_i.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new t_(_i.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;e&&(a=ZS(ZS({},a),bN(e))),a=mM(a);const s=xS(8,"track-video-cloned-"),d=new bat(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,mM(this._scalabilityMode),this._optimizationMode,s,mM(this._hints));return e&&a&&d.setEncoderConfiguration(a),F.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),d}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new t_(_i.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new t_(_i.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(IP(()=>{V_.reportApiInvoke(null,{name:OT.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:oT.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!aa("ENABLE_VIDEO_SEI")||!aa("ENABLE_ENCODED_TRANSFORM"))return void F.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new t_(_i.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void F.warning("Video track is not published, SEI can not be send");const a=n.sender.getParameters();if(a.codecs.length===0)return;const s=a.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"?this.safeEmit("sei-to-send",e):F.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(xR.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await MS(this,M_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await MS(this,M_.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(xR.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(F0.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(F0.REQUEST_CONSTRAINTS)}},hS(sS.prototype,"play",[vet,yet],Object.getOwnPropertyDescriptor(sS.prototype,"play"),sS.prototype),hS(sS.prototype,"stop",[bet],Object.getOwnPropertyDescriptor(sS.prototype,"stop"),sS.prototype),hS(sS.prototype,"setEnabled",[Tet,Ret,Aet],Object.getOwnPropertyDescriptor(sS.prototype,"setEnabled"),sS.prototype),hS(sS.prototype,"setMuted",[Cet,Oet,wet],Object.getOwnPropertyDescriptor(sS.prototype,"setMuted"),sS.prototype),hS(sS.prototype,"setEncoderConfiguration",[Iet,Net],Object.getOwnPropertyDescriptor(sS.prototype,"setEncoderConfiguration"),sS.prototype),hS(sS.prototype,"getStats",[Det],Object.getOwnPropertyDescriptor(sS.prototype,"getStats"),sS.prototype),hS(sS.prototype,"setBeautyEffect",[ket,Let],Object.getOwnPropertyDescriptor(sS.prototype,"setBeautyEffect"),sS.prototype),hS(sS.prototype,"getCurrentFrameData",[Pet],Object.getOwnPropertyDescriptor(sS.prototype,"getCurrentFrameData"),sS.prototype),hS(sS.prototype,"getCurrentFrameImage",[Met],Object.getOwnPropertyDescriptor(sS.prototype,"getCurrentFrameImage"),sS.prototype),hS(sS.prototype,"setBitrateLimit",[xet],Object.getOwnPropertyDescriptor(sS.prototype,"setBitrateLimit"),sS.prototype),hS(sS.prototype,"setOptimizationMode",[Uet],Object.getOwnPropertyDescriptor(sS.prototype,"setOptimizationMode"),sS.prototype),hS(sS.prototype,"setScalabiltyMode",[jet],Object.getOwnPropertyDescriptor(sS.prototype,"setScalabiltyMode"),sS.prototype),hS(sS.prototype,"updateMediaStreamTrackResolution",[Vet],Object.getOwnPropertyDescriptor(sS.prototype,"updateMediaStreamTrackResolution"),sS.prototype),hS(sS.prototype,"pipe",[Bet],Object.getOwnPropertyDescriptor(sS.prototype,"pipe"),sS.prototype),hS(sS.prototype,"unpipe",[Fet],Object.getOwnPropertyDescriptor(sS.prototype,"unpipe"),sS.prototype),hS(sS.prototype,"close",[Get],Object.getOwnPropertyDescriptor(sS.prototype,"close"),sS.prototype),hS(sS.prototype,"replaceTrack",[Het],Object.getOwnPropertyDescriptor(sS.prototype,"replaceTrack"),sS.prototype),sS),j7=(qet=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),zet=mT(),Ket=WV("CameraVideoTrack","_enabledMutex"),Wet=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Yet=mT(),Xet=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),Jet=mT(),Zet=K_({argsMap:t=>[t.getTrackId()]}),K0=class Sat extends zS{get __className__(){return"CameraVideoTrack"}constructor(e,n,a,s,d,f){super(e,bN(n.encoderConfig),s,d,f),_m(this,"_config",void 0),_m(this,"_originalConstraints",void 0),_m(this,"_constraints",void 0),_m(this,"_enabled",!0),_m(this,"_deviceName","default"),_m(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(qV()||r7())&&!function(){const m=lS();if(m.os!==jT.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&R$()&&this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=a,this._constraints=a,this._deviceName=e.label,this._encoderConfig=bN(this._config.encoderConfig),AS.on(tR.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),AS.on(tR.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(F.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await q0.getDeviceById(e),a={};a.video=ZS({},this._constraints),a.video.deviceId={exact:e},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await H0(a,this.getTrackId())}catch(d){throw F.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),s=await H0({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await q0.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}F.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){F.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:ZS(ZS({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await H0(n,this.getTrackId())}catch(s){throw F.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),a=await H0({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=ZS({},n.video),F.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await H0({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await MS(this,M_.NEED_ENABLE_TRACK,this)}catch(a){throw F.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),F.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await MS(this,M_.NEED_DISABLE_TRACK,this)}catch(a){throw F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}F.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new t_(_i.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=bN(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const a=aT(this._config);a.encoderConfig=e;const s=s8(a);(aR()||MR()||MO())&&(s.deviceId=void 0),F.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(d){const f=new t_(_i.UNEXPECTED_ERROR,d.toString());throw F.error("[".concat(this.getTrackId(),"] applyConstraints error"),f.toString()),f}this._config=a,this._constraints=s,this._originalConstraints=s,this._encoderConfig=e,this._hints.indexOf(US.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await MS(this,M_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(F)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((MR()||MO())&&this._enabled&&!this._isClosed&&AS.duringInterruption){const e=async()=>{AS.off(tR.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};AS.on(tR.IOS_INTERRUPTION_END,e)}else F.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($V.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,a=q0.searchDeviceIdByName(this._deviceName);if(a&&!n.deviceId&&(n.deviceId={exact:a}),this._enabled){const s=await H0({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),AS.off(tR.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),AS.off(tR.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;e&&(a=ZS(ZS({},a),bN(e))),a=mM(a);const s=xS(8,"track-cam-cloned-"),d=new Sat(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,mM(ZS(ZS({},this._config),{},{encoderConfig:a})),mM(this._constraints),mM(this._scalabilityMode),this._optimizationMode,s);return e&&a&&d.setEncoderConfiguration(a),F.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),d}bindProcessorContextEvents(){this.processorContext.on(F0.REQUEST_UPDATE_CONSTRAINTS,async(e,n,a)=>{try{const s=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(s),n()}catch(s){a(s)}}),this.processorContext.on(F0.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},hS(K0.prototype,"setDevice",[qet,zet],Object.getOwnPropertyDescriptor(K0.prototype,"setDevice"),K0.prototype),hS(K0.prototype,"setEnabled",[Ket,Wet,Yet],Object.getOwnPropertyDescriptor(K0.prototype,"setEnabled"),K0.prototype),hS(K0.prototype,"setEncoderConfiguration",[Xet,Jet],Object.getOwnPropertyDescriptor(K0.prototype,"setEncoderConfiguration"),K0.prototype),hS(K0.prototype,"close",[Zet],Object.getOwnPropertyDescriptor(K0.prototype,"close"),K0.prototype),K0);function V7(t,e,n,a){n.optimizationMode&&(a&&a.width&&a.height?(n.encoderConfig=ZS(ZS({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?F.debug("[".concat(t,"] set content hint to"),n.optimizationMode):F.debug("[".concat(t,"] set content hint failed")))):F.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Qet,$et,tnt,ent,cO,nnt,rnt,int,ont,ant,snt,NR;class cnt extends htt{getUserId(){return this._userId}constructor(e,n,a,s){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(s.clientId,"_").concat(xS(5,""))),_m(this,"_userId",void 0),_m(this,"_uintId",void 0),_m(this,"_isDestroyed",!1),_m(this,"store",void 0),_m(this,"processor",void 0),_m(this,"processorContext",void 0),this._userId=n,this._uintId=a,this.store=s}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,F.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let i3=(Qet=K_({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),$et=K_({argsMap:t=>[t.getTrackId()]}),tnt=K_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),ent=K_({argsMap:t=>[t.getTrackId()]}),hS((cO=class extends cnt{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==IR.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,a){super(t,e,n,a),_m(this,"_videoVisibleTimer",null),_m(this,"_previousVideoVisibleStatus",void 0),_m(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_m(this,"trackMediaType",t3.VIDEO),_m(this,"_videoWidth",void 0),_m(this,"_videoHeight",void 0),_m(this,"_player",void 0),_m(this,"processorDestination",void 0),_m(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Rtt(this.getTrackId(),"remote"),this.processorDestination=new Ttt(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return IP(()=>{F.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),U0(this,M_.GET_STATS)||ZS({},ltt)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(F.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}F.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=ZS(ZS({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new U7(n):this._player=new _et(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(_B.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(_B.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(_B.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},aa("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,F.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Ott(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(ZH)}_updatePlayerSource(){F.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:s,slot:d}=a;if(this.isPlaying&&s instanceof HTMLVideoElement&&d instanceof HTMLElement){const f=w$.checkOneElementVisible(s),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=V_.reportApiInvoke(null,{tag:oT.TRACER,name:OT.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(n){throw new t_(_i.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new t_(_i.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(xR.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(xR.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(vM.SEI_RECEIVED,t)}}).prototype,"play",[Qet],Object.getOwnPropertyDescriptor(cO.prototype,"play"),cO.prototype),hS(cO.prototype,"stop",[$et],Object.getOwnPropertyDescriptor(cO.prototype,"stop"),cO.prototype),hS(cO.prototype,"pipe",[tnt],Object.getOwnPropertyDescriptor(cO.prototype,"pipe"),cO.prototype),hS(cO.prototype,"unpipe",[ent],Object.getOwnPropertyDescriptor(cO.prototype,"unpipe"),cO.prototype),cO),o3=(nnt=K_({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),rnt=K_({argsMap:(t,e)=>[t.getTrackId(),e]}),int=K_({argsMap:t=>[t.getTrackId()]}),ont=K_({argsMap:t=>[t.getTrackId()]}),ant=K_({argsMap:(t,e)=>[t.getTrackId(),e.name]}),snt=K_({argsMap:t=>[t.getTrackId()]}),hS((NR=class extends cnt{get isPlaying(){return this._useAudioElement?YR.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,a){super(t,e,n,a),_m(this,"trackMediaType",t3.AUDIO),_m(this,"_source",void 0),_m(this,"_useAudioElement",!0),_m(this,"_volume",100),_m(this,"processorContext",void 0),_m(this,"processorDestination",void 0),_m(this,"_played",!1),_m(this,"_bypassWebAudio",!1),aa("DISABLE_WEBAUDIO")?(this._source=new M7,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Ett(t,!0),aa("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(B0.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(_B.FIRST_FRAME_DECODED)}),this.processorContext=new Ctt(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Att(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(B0.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(B0.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(B0.ON_AUDIO_BUFFER),this._source.on(B0.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?YR.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!att())throw new t_(_i.NOT_SUPPORTED,"your browser does not support setting the audio output device");await YR.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return IP(()=>{F.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),U0(this,M_.GET_STATS)||ZS({},utt)}play(){F.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(F.debug("[".concat(this.getTrackId(),"] use audio element to play")),YR.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){F.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?YR.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];F.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&YR.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new t_(_i.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new t_(_i.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new t_(_i.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(xR.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(xR.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(xR.ON_TRACK),this.processorDestination.removeAllListeners(xR.ON_NODE)}}).prototype,"setVolume",[nnt],Object.getOwnPropertyDescriptor(NR.prototype,"setVolume"),NR.prototype),hS(NR.prototype,"setPlaybackDevice",[rnt],Object.getOwnPropertyDescriptor(NR.prototype,"setPlaybackDevice"),NR.prototype),hS(NR.prototype,"play",[int],Object.getOwnPropertyDescriptor(NR.prototype,"play"),NR.prototype),hS(NR.prototype,"stop",[ont],Object.getOwnPropertyDescriptor(NR.prototype,"stop"),NR.prototype),hS(NR.prototype,"pipe",[ant],Object.getOwnPropertyDescriptor(NR.prototype,"pipe"),NR.prototype),hS(NR.prototype,"unpipe",[snt],Object.getOwnPropertyDescriptor(NR.prototype,"unpipe"),NR.prototype),NR);const mL=new class extends eT{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),_m(this,"_lastHiddenTime",0),_m(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),F.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class unt extends eT{constructor(e,n){super(),_m(this,"trackMediaType",t3.DATA),_m(this,"_version",1),_m(this,"_type",3),_m(this,"_config",void 0),_m(this,"_originDataChannel",void 0),_m(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),_m(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),_m(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return aa("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new A_((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const a=setTimeout(()=>{var s;n(new t_(_i.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new t_(_i.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new t_(_i.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[o8.OPEN,o8.CLOSE,o8.ERROR].forEach(n=>{const a=()=>{this.emit(n)};this._datachannelEventMap.set(n,a),e.addEventListener(n,a)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[a,s]=n;e.removeEventListener(a,s)}),this._datachannelEventMap.clear()}}class Fht extends unt{constructor(e){super(e),_m(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=n.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(a).getUint8(3);if(s!==this.id)return void(aa("SHOW_DATASTREAM2_LOG")&&F.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let d=n.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(o8.MESSAGE,d)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Ght extends unt{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function u8(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>lH.revokeObjectURL(t),0),new Worker(lH.createObjectURL(t))}const lnt=71,B7=1,F7=2,G7=1,dnt=2;var EL=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(EL||{});function hnt(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==lnt)return;const a=t.getUint16(1),s=B7+F7+a,d=new Uint8Array(t.byteLength-s);d.set(new Uint8Array(t.buffer,s,t.byteLength-s));const f={m:n,tlvLen:a,tlv:[],frame:d};let m=B7+F7;for(;m<s;){const _=t.getUint8(m),y=t.getUint16(m+G7),T=G7+dnt;if(_===EL.AUDIO_LEVEL){let w=t.getUint8(m+T);for(let L=1;L<y;L++)w=w<<8|t.getUint8(m+T+L);f.tlv.push({tag:_,length:y,value:e?127^w>>1:127&w})}else if(_===EL.METADATA||_===EL.AUDIO_64_BIT_PTS){const w=new Uint8Array(y);for(let L=0;L<y;L++)w[L]=t.getUint8(m+T+L);f.tlv.push({tag:_,length:y,value:w})}m+=T+y}return f}const l8=new Map,d8=127,SM=1e-10,H7=139/13,h8=new Map;function q7(t,e,n){const a="".concat(t,"-").concat(e,"-").concat(n);let s=0;return h8.has(a)?s=h8.get(a):(s=Math.log(function(f,m){const _=f-m;m<_&&(m=_);let y=1;for(let T=f,w=1;T>m;T--,w++)y=y*T/w;return y}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,h8.set(a,s)),s<SM&&(s=SM),s}function pnt(t,e,n){const a=e.length,s=t.length/a;let d=!1;for(let f=0,m=0;f<a;f++){let _=0;for(let y=m+s;m<y;m++)t[m]>n&&_++;e[f]!==_&&(e[f]=_,d=!0)}return d}window.cache=h8;let Hht=0;class fnt{constructor(e){_m(this,"id",void 0),_m(this,"immediates",[]),_m(this,"lastNonSilence",-1),_m(this,"immediateSpeechActivityScore",SM),_m(this,"lastLevelChangedTime",Date.now()),_m(this,"levels",[]),_m(this,"longs",[]),_m(this,"longSpeechActivityScore",SM),_m(this,"mediums",[]),_m(this,"mediumSpeechActivityScore",SM),_m(this,"minLevel",0),_m(this,"nextMinLevel",0),_m(this,"nextMinLevelWindowLength",0),_m(this,"energyScore",0),this.id=e||"".concat(Hht++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,a=this.minLevel+H7;let s=!1;for(let d=0;d<e.length;++d){let f=n[d];f<a&&(f=0);const m=Math.floor(f/H7);e[d]!==m&&(e[d]=m,s=!0)}return s}computeLongs(){return pnt(this.mediums,this.longs,4)}computeMediums(){return pnt(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=q7(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=q7(this.longs[0],10,47),this.longSpeechActivityScore>SM&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=q7(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(m1(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let a=e;return e<0&&(a=0),e>d8&&(a=d8),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+H7?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>d8&&(n=d8),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class qht{constructor(e){_m(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class z7{constructor(e,n,a){_m(this,"isDominant",void 0),_m(this,"energyRanking",void 0),_m(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=a}}class zht extends eT{constructor(e){super(),_m(this,"dominantId",null),_m(this,"lastDecisionTime",0),_m(this,"lastLevelChangedTime",0),_m(this,"lastLevelIdleTime",0),_m(this,"relativeSpeechActivities",[]),_m(this,"speakers",new Map),_m(this,"enableSilence",!1),_m(this,"timeoutToSilenceInterval",0),_m(this,"decisionMaker",null),_m(this,"loudest",[]),_m(this,"numLoudestToTrack",3),_m(this,"energyExpireTimeMs",250),_m(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),a!=null&&(this.energyAlphaPct=a),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const a=Date.now(),s=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=s.levelChanged(n,a);return this.updateLoudestList(s,d,a)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new fnt(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,a){const s=e.id===this.dominantId;if(n<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==e;)++_;return new z7(s,_,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new z7(s,0,e.energyScore);const d=a-this.energyExpireTimeMs;let f=0;for(;f<this.loudest.length;){const _=this.loudest[f];if(_.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(f,1);else if(_.id!==e.id)++f;else if(this.loudest.splice(f,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<e.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new z7(s,m,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new qht(this),this.decisionMaker.execute())}makeDecision(e){let n=null,a=null;const s=this.speakers.size;let d=null;if(s===0)d=null;else if(s===1){var f;const m=l0(f=this.speakers).call(f).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(e),e-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const T=this.speakers.entries().next();T.value&&(d=T.value[0],m=T.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(e);const _=this.relativeSpeechActivities;let y=2;for(const T of this.speakers.entries()){const[w,L]=T;if(L===m)continue;L.evaluateSpeechActivityScores(e);for(let J=0;J<_.length;++J){const _n=m==null?SM:m.getSpeechActivityScore(J);_[J]=Math.log(L.getSpeechActivityScore(J)/_n)}const B=_[0],Q=_[1],X=_[2];B>3&&Q>2&&X>0&&Q>y&&(y=Q,d=w)}this.enableSilence&&m!=null&&d===m.id&&e-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(n=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===n||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let a=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):a=n;let s=300-(e-this.lastDecisionTime);return s<=0&&(this.lastDecisionTime=e,this.makeDecision(e),s=300-(Date.now()-e)),s>0&&a>s&&(a=s),a}timeoutIdleLevels(e){const n=[];for(const s of l0(a=this.speakers).call(a)){var a;const d=e-s.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||s.id!==this.dominantId)?n.push(s.id):300<d&&s.levelTimedOut()}n.forEach(s=>this.speakers.delete(s))}}const a3=new Map;let CI=null,p8=null;const mnt=3;let TM=[];const OI=new Map,f8=new Map;class Kht{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){_m(this,"id",void 0),_m(this,"track",void 0),_m(this,"score",0),_m(this,"active",!0),_m(this,"muted",!1),_m(this,"timer",0),_m(this,"actives",0),_m(this,"inactives",0),this.id=e,this.track=n,this.setActive(OI.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:a}=function(){const s=[],d=[];return Array.from(l0(OI).call(OI)).forEach(f=>{f.active?s.push(f):d.push(f)}),{actives:s,inactives:d}}();if(n.length>3){let s;n.forEach(d=>{(!s||s.score>d.score)&&(s=d)}),s&&s.setActive(!1)}if(n.length<3&&a.length>0){let s;a.forEach(d=>{(!s||s.score<d.score)&&d.id!==this.id&&(s=d)}),s&&e&&!this.active&&(s.samples>40&&s.activeRate-this.activeRate>.4?s.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let a;return Array.from(l0(OI).call(OI)).forEach(s=>{!s.active||s.id===n||s.samples<40||(!a||s.score<a.score)&&(a=s)}),a}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let a;return Array.from(l0(OI).call(OI)).forEach(s=>{s.active||s.id===n||s.samples<40||(!a||s.score>a.score)&&(a=s)}),a}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let m8;function Ent(t){const e=OI.get(t);e&&(OI.delete(t),e.clearTimer())}const E8=new Map,Wht=new Map;function Yht(t,e,n){let a=new Uint8Array(t,e,n),s=[],d=0;for(;s.length<n;)d+3<n&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(s.push(a[d],a[d+1],a[d+3]),d+=4):(s.push(a[d]),d++);return new Uint8Array(s)}const g8=new Map,F2=new Map;(function(){const t=lS();$T.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),$T.getStreamFromExtension=t.name===mS.CHROME&&Number(t.version)>34,$T.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),$T.supportMinBitrate=t.name===mS.CHROME||t.name===mS.EDGE,$T.supportSetRtpSenderParameters=function(){const e=lS();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!hL()||!(!aR()&&!WH())||e.name===mS.FIREFOX&&Number(e.version)>=64)}(),t.name===mS.SAFARI&&(Number(t.version)>=14?$T.supportDualStream=!0:$T.supportDualStream=!1),$T.webAudioMediaStreamDest=function(){const e=lS();return!(e.name===mS.SAFARI&&Number(e.version)<12)}(),$T.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",$T.supportWebGL=typeof WebGLRenderingContext<"u",$T.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,hL()||($T.webAudioWithAEC=!0),$T.supportShareAudio=function(){const e=lS();return(e.os===jT.WIN_10||e.os===jT.WIN_81||e.os===jT.WIN_7||e.os===jT.LINUX||e.os===jT.MAC_OS||e.os===jT.CHROMIUM_OS)&&e.name===mS.CHROME&&Number(e.version)>=74}(),$T.supportDataChannel=!!(N2(76)||function(e){const n=lS();return!(n.name!==mS.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||v$(14)),$T.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!rT()&&!!e&&e.prototype.setConfiguration instanceof Function}(),$T.supportWebRTCEncodedTransform=function(){const e=lS();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),$T.supportWebRTCInsertableStream=function(){const e=lS();return(e.name===mS.CHROME||e.name===mS.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),$T.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,$T.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,JH(()=>{$T.supportDualStreamEncoding=function(){const e=lS();return!!aa("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&aa("CHROME_DUAL_STREAM_USE_ENCODING"))}(),F.debug("browser ua: ",navigator.userAgent),F.info("browser info: ",t),F.info("browser compatibility: ",$T)})})();const Xht=["CHINA","GLOBAL"],gnt=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],RM=[],s3=[];function AM(t,e){return!!e&&RM.some(n=>n.uid===t&&n.channelName===e)}function K7(){return s3.length>0}var Jht=UZ.forEach,_nt=zR("forEach")?[].forEach:function(t){return Jht(this,t,arguments.length>1?arguments[1]:void 0)};SS({target:"Array",proto:!0,forced:[].forEach!=_nt},{forEach:_nt});var Zht=HR("Array").forEach,Qht=Y0,$ht=YT,tpt=$,ept=Zht,W7=Array.prototype,npt={DOMTokenList:!0,NodeList:!0},rpt=function(t){var e=t.forEach;return t===W7||tpt(W7,t)&&e===W7.forEach||$ht(npt,Qht(t))?ept:e},ipt=h(rpt),opt=EO,vnt=y1;SS({target:"Object",stat:!0,forced:E(function(){vnt(1)})},{keys:function(t){return vnt(opt(t))}});var ynt=h(v0.Object.keys),apt=h(h1),spt=h(f1),cpt=SS,bnt=RR,upt=aP,lpt=SR,Snt=rU,dpt=QO,hpt=MI,ppt=rO,fpt=tT,mpt=j1,Ept=OZ("slice"),gpt=fpt("species"),Y7=Array,_pt=Math.max;cpt({target:"Array",proto:!0,forced:!Ept},{slice:function(t,e){var n,a,s,d=hpt(this),f=dpt(d),m=Snt(t,f),_=Snt(e===void 0?f:e,f);if(bnt(d)&&(n=d.constructor,(upt(n)&&(n===Y7||bnt(n.prototype))||lpt(n)&&(n=n[gpt])===null)&&(n=void 0),n===Y7||n===void 0))return mpt(d,m,_);for(a=new(n===void 0?Y7:n)(_pt(_-m,0)),s=0;m<_;m++,s++)m in d&&ppt(a,s,d[m]);return a.length=s,a}});var vpt=HR("Array").slice,ypt=$,bpt=vpt,X7=Array.prototype,Spt=function(t){var e=t.slice;return t===X7||ypt(X7,t)&&e===X7.slice?bpt:e},Tpt=h(Spt);function U_(t,e,n,a,s){var d,f,m,_={};return ipt(d=ynt(a)).call(d,function(y){_[y]=a[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=apt(f=spt(m=Tpt(n).call(n)).call(m)).call(f,function(y,T){return T(t,e,y)||y},_),s&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(s):void 0,_.initializer=void 0),_.initializer===void 0&&(TZ(t,e,_),_=null),_}let _8=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),J7=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),jO=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),UR=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),z_=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),VS=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Q_=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),X_=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),G2=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),rS=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),jR=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),kv=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function v8(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw F.error("Invalid Channel Name ".concat(t)),new _E(_i.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function y8(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||O$(t,1,255)))throw new _E(_i.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&F.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let gL=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Rpt={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Z7={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Q7(t,e){ZT(t.url,"".concat(e,".url"),1,1e3,!1),iT(t.x)||IS(t.x,"".concat(e,".x"),0,1e4),iT(t.y)||IS(t.y,"".concat(e,".y"),0,1e4),iT(t.width)||IS(t.width,"".concat(e,".width"),0,1e4),iT(t.height)||IS(t.height,"".concat(e,".height"),0,1e4),iT(t.zOrder)||IS(t.zOrder,"".concat(e,".zOrder"),0,255),iT(t.alpha)||IS(t.alpha,"".concat(e,".alpha"),0,1,!1)}const Apt={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let kP=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),$7=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),LT=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function Tnt(t){if(!t.channelName)throw new _E(_i.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new _E(_i.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ZT(t.token,"info.token",1,2047),y8(t.uid),v8(t.channelName),!0}let VR=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),_L=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),f0=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),c3=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),bS=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),zT=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),b8=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),BT=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),ES=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const Rnt=[ES.AFRICA,ES.ASIA,ES.CHINA,ES.EUROPE,ES.GLOBAL,ES.INDIA,ES.JAPAN,ES.NORTH_AMERICA,ES.OCEANIA,ES.OVERSEA,ES.SOUTH_AMERICA];let ER=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const S8={CHINA:{},ASIA:{CODE:ER.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ER.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ER.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ER.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ER.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ER.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ER.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ER.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ER.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ER.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ER.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ER.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ER.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};y7&&(S8.CHINA={CODE:ER.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let H2=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function Ant(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class Cnt extends eT{constructor(e,n){super(),_t(this,"onICEConnectionStateChange",void 0),_t(this,"onConnectionStateChange",void 0),_t(this,"onDTLSTransportStateChange",void 0),_t(this,"onDTLSTransportError",void 0),_t(this,"onICETransportStateChange",void 0),_t(this,"onFirstAudioReceived",void 0),_t(this,"onFirstVideoReceived",void 0),_t(this,"onFirstAudioDecoded",void 0),_t(this,"onFirstVideoDecoded",void 0),_t(this,"onFirstVideoDecodedTimeout",void 0),_t(this,"onSelectedLocalCandidateChanged",void 0),_t(this,"onSelectedRemoteCandidateChanged",void 0),_t(this,"onICECandidateError",void 0),_t(this,"getLocalVideoStats",void 0)}}class Ont extends Cnt{constructor(e,n){super(e,n),_t(this,"establishPromise",void 0)}}let k_=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),gR=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),vL=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const wnt=["disconnected","failed"];let u_=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),yS=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),H_=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),VO=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),BO=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),KT=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Int=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),RN=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),uO=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),wI=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),u3=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ET=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),l3=function(t){return t.ABORT="abort",t}({}),LP=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Cpt=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Opt={[_8.ACCESS_POINT]:{[UR.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[UR.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[UR.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[UR.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[UR.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[UR.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[UR.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[_8.UNILBS]:{[jO.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[jO.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[jO.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[jO.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[jO.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[jO.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[jO.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[jO.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[jO.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[jO.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[jO.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[jO.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[_8.STRING_UID_ALLOCATOR]:{[J7.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[J7.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[J7.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function d3(t){const e=Opt[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===_8.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const wpt={[z_.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[z_.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[z_.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[z_.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[z_.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[z_.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[z_.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[z_.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[z_.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[z_.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[z_.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[z_.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[z_.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[z_.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[z_.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[z_.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[z_.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[z_.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[z_.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[z_.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[z_.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[z_.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[z_.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[z_.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[z_.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[z_.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[z_.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[z_.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[z_.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[z_.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[z_.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[z_.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[z_.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[z_.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[z_.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[z_.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[z_.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[z_.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[z_.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[z_.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[z_.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[z_.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[z_.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[z_.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[z_.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[z_.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[z_.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[z_.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[z_.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[z_.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[z_.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[z_.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[z_.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[z_.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[z_.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[z_.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[z_.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[z_.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[z_.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[z_.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[z_.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[z_.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[z_.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[z_.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function q2(t){return wpt[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function Nnt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function t9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Nnt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nnt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function Dnt(t,e){if(typeof t=="string")return t;const{proxy:n,host:a,port:s}=t;if(e){const d=aa("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(s)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(s)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(a,"&p=").concat(s):"wss://".concat(a,":").concat(s)}const Ipt=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Npt=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Dpt=/wss:\/\/(.+):([0-9]+)\/?/,kpt=/wss:\/\/(.[^\/]+)\/?/;let Lpt=0;class Ppt{constructor(e,n){_t(this,"id",0),_t(this,"store",void 0),_t(this,"recordIndex",void 0),_t(this,"websockets",[]),_t(this,"try443PortDuration",2e3),_t(this,"forceCloseWSDuration",5e3),_t(this,"try443PortTimeout",null),_t(this,"forceCloseTimeout",null),_t(this,"isTry443PortFailed",!1),_t(this,"isNormalPortFailed",!1),_t(this,"useDoubleDomain",!1),_t(this,"useProxy",!1),_t(this,"startTime",Date.now()),this.id=++Lpt,this.try443PortDuration=aa("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var a=arguments.length,s=new Array(a),d=0;d<a;d++)s[d]=arguments[d];F.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...s)}createWebSocket(e,n,a){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:a});const s=aa("GATEWAY_DOMAINS"),d=Date.now(),f=[],m=s.find(L=>{var B;return T_(B=e.host).call(B,L)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)s.forEach(L=>{_.push(Dnt(t9(t9({},e),{},{host:e.host.replace(m,L)}),n))});else{const L=t9({},e);if(n&&m){const B=s.find(Q=>Q!==m);B&&(L.host=L.host.replace(m,B))}_.push(Dnt(L,n))}try{_.forEach(L=>{const B=new WebSocket(L);B.binaryType="arraybuffer",f.push(B),this.logger("ws is connecting:",B.url)})}catch(L){if(this.logger("ws create failed"),f.forEach(B=>B.close()),f.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,a);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,a);throw new _E(_i.WS_ERR,"init websocket failed! Error: ".concat(L.toString()))}const y=I2();this.store&&this.store.recordJoinChannelService({urls:f.map(L=>L.url),service:"gateway"},this.recordIndex),f.forEach(L=>{L.onopen=()=>{this.logger("onopen: ws ".concat(L.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(B=>{B!==L&&(B.onopen=null,B.onclose=null,B.onmessage=null,B.close(),this.logger("close backup websocket: ".concat(B.url)))}),this.websockets.length=0,y.resolve(L)},L.onclose=B=>{this.logger("onclose: ws ".concat(L.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(L.readyState));const Q=f.every(X=>X.readyState===WebSocket.CLOSED||X.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(Q)),Q&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(B.reason)),y.reject({code:B.code,reason:b8.A_ROUND_WS_FAILED})):!n&&Q&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),n?this.isTry443PortFailed=Q:this.isNormalPortFailed=Q},L.onmessage=B=>this.logger("".concat(L.url," onmessage: ").concat(B.data))}),this.websockets.push(...f);const T=()=>{this.websockets.forEach(L=>L.readyState!==WebSocket.OPEN&&L.close())},w=()=>{if(y.isResolved)return T();lS().os===jT.MAC_OS&&rT()&&T(),this.createWebSocket(e,!0,!0).then(L=>{y.resolve(L)}).catch(L=>{this.isNormalPortFailed&&y.reject(L),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,T()},this.forceCloseWSDuration)};return a||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,T()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(e,n,a,s){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(d){let f,m,_;return[,f,m,_]=d.match(Ipt)||[],f||([,m,_]=d.match(Npt)||[]),m&&_||([,m,_]=d.match(Dpt)||[]),m&&_||([,m]=d.match(kpt)||[]),m||F.warning("un-destructible url: ",d),{proxy:f,host:m,port:_||"443"}}(e)),this.recordIndex=s,this.useProxy=!!e.proxy,a&&this.useProxy&&(F.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(e,!!a,!1).finally(()=>this.clearTimeout())}}function knt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}class Lnt extends eT{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;T_(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(kv.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(kv.CONNECTED):this._state==="closed"?this.emit(kv.CLOSED):this._state==="failed"&&this.emit(kv.FAILED))}resetReconnectCount(e){F.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],f=arguments.length>5?arguments[5]:void 0;super(),_t(this,"connectionID",0),_t(this,"currentURLIndex",0),_t(this,"urls",[]),_t(this,"_reconnectMode","tryNext"),_t(this,"reconnectReason",void 0),_t(this,"_initMutex",void 0),_t(this,"name",void 0),_t(this,"_state","closed"),_t(this,"reconnectInterrupter",void 0),_t(this,"websocket",void 0),_t(this,"retryConfig",void 0),_t(this,"reconnectCount",0),_t(this,"forceCloseTimeout",5e3),_t(this,"onlineReconnectListener",void 0),_t(this,"useCompress",void 0),_t(this,"tryDoubleDomain",!1),_t(this,"use443PortOnly",!1),_t(this,"wsInflateLength",0),_t(this,"wsDeflateLength",0),_t(this,"closeEstablishingWs",()=>{}),_t(this,"store",void 0),_t(this,"joinGatewayRecordIndex",void 0),this.store=f,this.name=e,this.retryConfig=function(w){for(var L=1;L<arguments.length;L++){var B=arguments[L]!=null?arguments[L]:{};L%2?knt(Object(B),!0).forEach(function(Q){_t(w,Q,B[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(B)):knt(Object(B)).forEach(function(Q){Object.defineProperty(w,Q,Object.getOwnPropertyDescriptor(B,Q))})}return w}({},n),this.useCompress=a,this.tryDoubleDomain=s,this.use443PortOnly=d,this._initMutex=new mR("websocket",f?f.clientId:void 0);const{timeout:m,timeoutFactor:_}=n,y=Math.max(300,Math.floor(3*m/5)),T=Math.max(1.2,Math.floor(8*_)/10);O0.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=T),ST.on(zV.NETWORK_STATE_CHANGE,(w,L)=>{w!==L&&(this.resetReconnectCount("network state change: ".concat(L," -> ").concat(w)),w===O0.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=T):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const s=I2(),d=this.urls[this.currentURLIndex];aa("ENABLE_PREALLOC_PC")&&this.emit(Int.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(s.resolve).catch(s.reject),this.once(kv.CLOSED,()=>{s.reject(new t_(_i.WS_DISCONNECT))}),this.once(kv.CONNECTED,s.resolve),await s.promise}catch{}finally{a()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;n?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void F.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),F.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new t_(_i.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(a){throw new t_(_i.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const a=I2();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=T=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),F.debug("[".concat(this.name,"] websocket opened:"),T),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async T=>{var w;if(F.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(T.code,", reason: ").concat(T.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new t_(_i.WS_DISCONNECT,"websocket close: ".concat(T.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=T.reason,this.state="reconnecting");const L=U0(this,kv.WILL_RECONNECT,this.reconnectMode,T.reason)||this.reconnectMode,B=await this.reconnectWithAction(L);if(this.state==="closed")return void F.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!B)return a.reject(new t_(_i.WS_DISCONNECT,"websocket reconnect failed: ".concat(T.code))),this.close(!0);a.resolve()}},f=T=>{this.emit(kv.ON_MESSAGE,T)},m=T=>{F.warn("[".concat(this.connectionID,"] ws open error ").concat(T))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),aa("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=aa("GATEWAY_WSS_ADDRESS")),F.debug("[".concat(this.name,"] start connect, url:"),e);const _=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const T=await this.chooseBestWebsocketConnection(e);this.websocket=T,s&&s(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=f,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(T){const w=this.state==="closed",L=T instanceof t_,B=L&&T.code===_i.WS_ABORT,Q=L&&T.code===_i.WS_ERR,X=L?T.message:T&&(T.reason||T.toString());F.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(X)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:B?"aborted":"error",errors:[T]},_),w||Q?(a.reject(w?new t_(_i.WS_DISCONNECT,"websocket is closed: ".concat(X)):new t_(_i.WS_ERR,"init websocket failed: ".concat(X))),Q&&F.error("[".concat(this.name,"] init websocket failed: ").concat(X))):d&&d(T)}return a.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;F.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||ST.isOnline||!ST.onlineWaiter||(this.onlineReconnectListener=ST.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,n){const f=h7(this.reconnectCount,this.retryConfig);F.debug("[".concat(this.name,"] wait ").concat(f,"ms to reconnect websocket, mode: ").concat(e)),await A_.race([QT(f),this.onlineReconnectListener||new A_(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const s=async(f,m)=>{this.emit(kv.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(f)};try{if(e==="retry")await s(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);F.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await s(this.urls[this.currentURLIndex],e)}else e==="recover"&&(F.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await cR(this,kv.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],e))}catch(f){var d;F.error("[".concat(this.name,"] reconnect failed ").concat(f&&f.toString()));const m=f==null||(d=f.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&T_(m).call(m,"dynamic key expired")?(this.emit(kv.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class e9 extends Lnt{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const a=I2(),s=function(f,m){return new Ppt(f,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{F.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),a.reject(new t_(_i.WS_ABORT,"choose best websocket aborted"))};const d=aa("GATEWAY_DOMAINS");return F.debug("[choose-best-ws] currentDomain: ",e,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class z2 extends Lnt{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new A_((a,s)=>{let d=!1;const f=[];this.closeEstablishingWs=()=>{F.debug("[choose-best-ws] close establishing websockets"),f.forEach(Q=>{Q.onclose=null,Q.onopen=null,Q.onmessage=null,Q.close()}),s(new t_(_i.WS_ABORT,"choose best websocket aborted"))};const m=aa("GATEWAY_DOMAINS");let _;const y=e.indexOf("?h="),T=m.find(Q=>y!==-1?T_(e).call(e,Q,y):T_(e).call(e,Q));F.debug("[choose-best-ws] currentDomain: ",T,", domains: ",m);let w=!this.tryDoubleDomain||!T;if(!w&&T){var L;const Q=Date.now();try{m.forEach(X=>{const J=y===-1?e.replace(T,X):e.substr(0,y)+e.substr(y).replace(T,X),_n=new WebSocket(J);_n.binaryType="arraybuffer",f.push(_n),F.debug("[choose-best-ws] ws is connecting:",_n.url)})}catch{for(F.debug("[choose-best-ws] ws create failed, fallback to single url"),f.forEach(J=>J.close());f.length;)f.pop();w=!0}(L=this.store)===null||L===void 0||L.recordJoinChannelService({urls:f.map(X=>X.url),service:"gateway"},n),f.forEach(X=>{X.onopen=()=>{if(d)return;const J=Date.now()-Q;F.debug("[choose-best-ws] ws open cost ".concat(J,"ms")),f.filter(_n=>_n!==X).forEach(_n=>{F.debug("[choose-best-ws]close backup websocket: ".concat(_n.url)),_n.close()}),d=!0,a(X)},X.onclose=J=>{_=J,!d&&(f.find(_n=>!(_n.readyState===WebSocket.CLOSED||_n.readyState===WebSocket.CLOSING))||(F.debug("[choose-best-ws] all websocket is closed"),d=!0,s(_)))},X.onmessage=J=>{F.debug("[choose-best-ws]".concat(X.url," onmessage: ").concat(J.data))}}),QT(this.forceCloseTimeout).then(()=>{f.forEach(X=>{X.readyState!==WebSocket.OPEN&&X.close()})})}if(w){var B;let Q;F.debug("[choose-best-ws] use single url: ",e),(B=this.store)===null||B===void 0||B.recordJoinChannelService({urls:[e],service:"gateway"},n);try{Q=new WebSocket(e),f.push(Q),Q.binaryType="arraybuffer"}catch(X){const J=new t_(_i.WS_ERR,"init websocket failed! Error: ".concat(X.toString()));return F.error("[".concat(this.name,"]").concat(J)),void s(J)}Q.onopen=()=>{a(Q)},Q.onclose=X=>{s(X)},Q.onmessage=X=>{F.debug("[choose-best-ws]".concat(Q.url," onmessage: ").concat(X.data))},QT(this.forceCloseTimeout).then(()=>{Q&&Q.readyState!==WebSocket.OPEN&&Q.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class Mpt extends eT{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===VS.CONNECTED?this.emit(Q_.WS_CONNECTED):e===VS.RECONNECTING?this.emit(Q_.WS_RECONNECTING,this._websocketReconnectReason):e===VS.CLOSED&&this.emit(Q_.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),_t(this,"_disconnectedReason",void 0),_t(this,"_websocketReconnectReason",void 0),_t(this,"_connectionState",VS.CLOSED),_t(this,"reconnectToken",void 0),_t(this,"websocket",void 0),_t(this,"openConnectionTime",void 0),_t(this,"clientId",void 0),_t(this,"lastMsgTime",Date.now()),_t(this,"uploadCache",[]),_t(this,"uploadCacheInterval",void 0),_t(this,"rttRolling",new H$(5)),_t(this,"pingpongTimer",void 0),_t(this,"wsInflateDataTimer",void 0),_t(this,"pingpongTimeoutCount",0),_t(this,"joinResponse",void 0),_t(this,"multiIpOption",void 0),_t(this,"initError",void 0),_t(this,"spec",void 0),_t(this,"store",void 0),_t(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Q_.ON_BINARY_DATA,a.data);const s=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const d="res-@".concat(s._id);this.emit(d,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===rS.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===rS.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(vS.UID_BANNED);break;case 15:this.close(vS.IP_BANNED);break;case 16:this.close(vS.CHANNEL_BANNED)}if(s._type===rS.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case z_.ERR_LICENSE_MISSING:this.close(vS.LICENSE_MISSING);break;case z_.ERR_LICENSE_EXPIRED:this.close(vS.LICENSE_EXPIRED);break;case z_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(vS.LICENSE_MINUTES_EXCEEDED);break;case z_.ERR_LICENSE_PERIOD_INVALID:this.close(vS.LICENSE_PERIOD_INVALID);break;case z_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(vS.LICENSE_MULTIPLE_SDK_SERVICE);break;case z_.ERR_LICENSE_ILLEGAL:this.close(vS.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new e9("gateway-".concat(this.clientId),this.spec.retryConfig,!0,aa("JOIN_GATEWAY_USE_DUAL_DOMAIN"),aa("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===VS.CONNECTED&&this.reconnect("retry",sR.OFFLINE)})}async request(e,n,a,s){const d=xS(6,""),f={_id:d,_type:e,_message:n},m=this.websocket.connectionID,_=()=>new A_((Q,X)=>{if(this.connectionState===VS.CONNECTED)return Q();const J=()=>{this.off(Q_.WS_CLOSED,_n),Q()},_n=()=>{this.off(Q_.WS_CONNECTED,J),X(new _E(_i.WS_ABORT))};this.once(Q_.WS_CONNECTED,J),this.once(Q_.WS_CLOSED,_n),e!==X_.PUBLISH&&e!==X_.PUBLISH_DATASTREAM&&e!==X_.SUBSCRIBE&&e!==X_.SUBSCRIBE_DATASTREAM&&e!==X_.UNSUBSCRIBE&&e!==X_.UNSUBSCRIBE_DATASTREAM&&e!==X_.UNPUBLISH&&e!==X_.UNPUBLISH_DATASTREAM&&e!==X_.CONTROL&&e!==X_.RESTART_ICE||this.once(Q_.DISCONNECT_P2P,()=>{X(new _E(_i.DISCONNECT_P2P))}),e!==X_.PUBLISH&&e!==X_.RESTART_ICE||this.once(Q_.ABORT_P2P_EXECUTION,()=>{X(new _E(_i.DISCONNECT_P2P))})});if(this.connectionState!==VS.CONNECTING&&this.connectionState!==VS.RECONNECTING||e===X_.JOIN||e===X_.REJOIN||await _(),this.websocket.sendMessage(f,!0),s)return;const y=new A_((Q,X)=>{let J=!1;const _n=(ya,_l)=>{J=!0,Q({isSuccess:ya==="success",message:_l||{}}),this.off(Q_.WS_CLOSED,_r),this.off(Q_.WS_RECONNECTING,_r),this.emit(Q_.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(d),_n);const _r=()=>{X(new _E(_i.WS_ABORT,"type: ".concat(e))),this.off(Q_.WS_CLOSED,_r),this.off(Q_.WS_RECONNECTING,_r),this.off("res-@".concat(d),_n)};this.once(Q_.WS_CLOSED,_r),this.once(Q_.WS_RECONNECTING,_r),QT(aa("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||J||(F.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Q_.REQUEST_TIMEOUT,e,n))})});let T=null;try{T=await y}catch(Q){if(this.connectionState===VS.CLOSED||e===X_.LEAVE)throw new _E(_i.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?Q.throw():e===X_.JOIN||e===X_.REJOIN?null:(await _(),await this.request(e,n))}if(T.isSuccess)return T.message;const w=Number(T.message.error_code||T.message.code),L=q2(w),B=new _E(_i.UNEXPECTED_RESPONSE,"".concat(L.desc,": ").concat(T.message.error_str),{code:w,data:T.message,desc:L.desc});return L.action==="success"?T.message:(F.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(w,", message: ").concat(L.desc,", action: ").concat(L.action)),w===z_.ERR_TOO_MANY_BROADCASTERS?((e===X_.JOIN||e===X_.REJOIN)&&(this.initError=B,this.close()),B.throw()):L.action==="failed"?B.throw():L.action==="quit"?(this.initError=B,this.close(),B.throw()):(w===z_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,F.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sR.MULTI_IP)):this.reconnect(L.action,sR.SERVER_ERROR),e===X_.JOIN||e===X_.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new A_(a=>{const s=d=>{(!n||n(d))&&(this.off(e,s),a(d))};this.on(e,s)})}uploadWRTCStats(e){if(!this.store.sessionId)return void F.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(G2.WRTC_STATS,n)}upload(e,n){const a={_type:e,_message:n};try{this.websocket.sendMessage(a)}catch{const d=aa("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==VS.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},aa("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const a={_type:e,_message:n};this.websocket.sendMessage(a)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new A_((n,a)=>{this.once(Q_.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Q_.WS_CLOSED,s=>a(this.initError||new _E(_i.WS_ABORT,s))),this.connectionState=VS.CONNECTING,this.websocket.init(e).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||vS.LEAVE,this.connectionState=VS.CLOSED,F.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Q_.ABORT_P2P_EXECUTION);const e=await cR(this,Q_.REQUEST_JOIN_INFO),n=await this.request(X_.JOIN,e);if(!n)return this.emit(Q_.REPORT_JOIN_GATEWAY,b8.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Q_.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=VS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new _E(_i.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=M2(this,Q_.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(X_.REJOIN,e);return!!n&&(this.connectionState=VS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(a=>{this.emit(rS.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(rS.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(rS.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(rS.MUTE_AUDIO,{uid:a.uid}):this.emit(rS.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(rS.MUTE_VIDEO,{uid:a.uid}):this.emit(rS.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(rS.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(rS.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(rS.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(rS.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(rS.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){F.debug("[".concat(this.clientId,"] receive notification: "),e);const n=q2(e.code);if(e.code===28&&"detail"in e&&(F.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Q_.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(vS.UID_BANNED),void this.close()):void this.reconnect(n.action,sR.SERVER_ERROR);F.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=aa("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(F.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>aa("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sR.TIMEOUT):this.request(X_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-n;this.rttRolling.add(a),aa("REPORT_STATS")&&this.send(X_.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(G2.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(kv.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Q_.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(kv.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(kv.CLOSED,()=>{this.connectionState=VS.CLOSED}),this.websocket.on(kv.FAILED,()=>{this._disconnectedReason=vS.NETWORK_ERROR,this.connectionState=VS.CLOSED}),this.websocket.on(kv.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===VS.CONNECTED?this.connectionState=VS.RECONNECTING:this.connectionState=VS.CONNECTING}),this.websocket.on(kv.WILL_RECONNECT,(e,n,a)=>{const s=M2(this,Q_.IS_P2P_DISCONNECTED),d=s||e!=="retry";s&&e==="retry"&&(F.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=b8.P2P_DISCONNECTED),d&&(F.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(Q_.REPORT_JOIN_GATEWAY,n||b8.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Q_.DISCONNECT_P2P)),a(e)}),this.websocket.on(kv.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{F.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",sR.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(Q_.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof _E){if(e.code===_i.UNEXPECTED_RESPONSE&&e.data.code===z_.ERR_NO_AUTHORIZED)return this.initError=new _E(_i.TOKEN_EXPIRE,"dynamic key expired"),void this.close(vS.TOKEN_EXPIRE);F.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sR.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(kv.REQUEST_NEW_URLS,(e,n)=>{cR(this,Q_.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(kv.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(rS.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Int.PRE_CONNECT_PC,()=>{this.emit(Q_.PRE_CONNECT_PC)})}}let xpt=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),TT=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function Pnt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function T8(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Pnt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pnt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function PP(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(aa("TURN_DOMAIN")):(F.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function n9(t,e){t.addresses||(t.addresses=[]);const n=function(m,_){if(aa("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(w=>{let{ip:L,port:B}=w;return{address:"".concat(L,":").concat(B)}});const y=aa("GATEWAY_DOMAINS");let T=y[1]&&T_(_).call(_,y[1])?1:0;return m.map(w=>{let{domain_prefix:L,port:B,ip:Q}=w;if(L)return{address:"".concat(L,".").concat(y[T++%y.length],":").concat(B)};const X=/^[\.\:\d]+$/.test(Q),J=X?"".concat(Q.replace(/[^\d]/g,"-"),".").concat(y[T++%y.length],":").concat(B):"".concat(Q,":").concat(B);return X||F.debug("Cannot recognized as ip address: ".concat(Q,", use as host")),{ip:Q,port:B,address:J}})}(t.addresses,e),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let _=0;_<m.length;_++){var s;const y=wR(s=m[_]).call(s);n[_]&&y&&(n[_].ip6=y)}}const d=t.detail&&t.detail.candidate;let f;if(d){const[m,_]=d.split(":");m&&_&&(f={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:n,apGatewayAddress:f,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function w0(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Mnt(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(w0(e.width),"x").concat(w0(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function xnt(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function K2(t,e){let n,a,s;switch(e){case TT.CHOOSE_SERVER:a=4096,s="choose server";break;case TT.CLOUD_PROXY:a=1048576,s="proxy";break;case TT.CLOUD_PROXY_5:a=4194304,s="proxy5";break;case TT.CLOUD_PROXY_FALLBACK:a=4194310,s="proxy fallback";break;default:throw new _E(_i.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(n={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(f=>T8(T8({},f),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:T8(T8({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!n)throw new _E(_i.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function Unt(t,e){return await A_.all(t.addresses.map(async n=>({address:aa("USE_TURN_IP")?n.ip:PP(n.ip),tcpport:n.port,udpport:n.port,username:e&&aa("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():uR.username,password:e&&aa("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await c7(e.toString()):uR.password})))}function r9(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),a=e.videoHeight||n.height,s=e.videoWidth||n.width;return a&&s?Math.max(Math.min(a,s)/Math.min(w0(t.height),w0(t.width)),1):(F.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function MP(t){let{candidateType:e,relayProtocol:n,type:a,address:s,port:d,protocol:f}=t;const m={candidateType:e,relayProtocol:n,protocol:f};if(a!=="local-candidate"){const _=s.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=d}return m}function R8(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:aa("SVC_MODE");if(aa("ENABLE_SVC"))return function(e){return e in _q}(t)?t:_q.L1T3}const jnt={[k_.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[k_.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function A8(t,e,n){e.forEach(a=>{var s;const d=jnt[t].find(m=>{var _;let{key:y}=m;return T_(_=a.extensionName).call(_,y)});if(!d)return;const f=n.find(m=>{let{extensionName:_}=m;return T_(_).call(_,d.key)});f&&T_(s=f.extensionName).call(s,"gdpr_forbidden")&&(a.extensionName=f.extensionName)})}function h3(t,e){e.forEach(n=>{var a;const s=jnt[t].find(d=>{var f;let{key:m}=d;return T_(f=n.extensionName).call(f,m)});T_(a=n.extensionName).call(a,"gdpr_forbidden")&&s&&(n.extensionName=s.extensionName)})}function Vnt(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||T_(t).call(t,"abs-send-time")}function C8(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||T_(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Bnt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function Fnt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Bnt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bnt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function W2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:d,filterAudioFec:f,filterAudioCodec:m,filterVideoCodec:_}=e,{useXR:y}=n;let T=[],w=[],L=[],B=[],Q=!1,X=!1;if(p0(t).mediaDescriptions.forEach(_n=>{a&&a!==_n.attributes.direction||(_n.media.mediaType!=="video"||Q||(w=_n.attributes.payloads,B=_n.attributes.extmaps,Q=!0),_n.media.mediaType!=="audio"||X||(T=_n.attributes.payloads,L=_n.attributes.extmaps,X=!0))}),!B||w.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!L||T.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(w.forEach(_n=>{var _r;(_r=_n.rtpMap)!==null&&_r!==void 0&&_r.clockRate&&(_n.rtpMap.clockRate=parseInt(_n.rtpMap.clockRate)),y&&_n.rtcpFeedbacks.push({type:"rrtr"})}),T.forEach(_n=>{var _r;(_r=_n.rtpMap)!==null&&_r!==void 0&&_r.clockRate&&(_n.rtpMap.clockRate=parseInt(_n.rtpMap.clockRate)),y&&_n.rtcpFeedbacks.push({type:"rrtr"})}),s&&(T=T.filter(_n=>{var _r;return((_r=_n.rtpMap)===null||_r===void 0?void 0:_r.encodingName.toLowerCase())!=="rtx"}),w=w.filter(_n=>{var _r;return((_r=_n.rtpMap)===null||_r===void 0?void 0:_r.encodingName.toLowerCase())!=="rtx"})),d&&(w=w.filter(_n=>{var _r;return!/(red)|(ulpfec)|(flexfec)/i.test(((_r=_n.rtpMap)===null||_r===void 0?void 0:_r.encodingName)||"")})),f&&(T=T.filter(_n=>{var _r;return!/(red)|(ulpfec)|(flexfec)/i.test(((_r=_n.rtpMap)===null||_r===void 0?void 0:_r.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(T=T.filter(_n=>{var _r;return T_(m).call(m,((_r=_n.rtpMap)===null||_r===void 0?void 0:_r.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const _n=w.filter(_r=>{var ya;return T_(_).call(_,((ya=_r.rtpMap)===null||ya===void 0?void 0:ya.encodingName.toLowerCase())||"")});w=_n.concat(s?[]:a9(_n,w))}const J=aa("UNSUPPORTED_VIDEO_CODEC");return J&&J.length>0&&(w=w.filter(_n=>!(_n.rtpMap&&T_(J).call(J,_n.rtpMap.encodingName.toLowerCase())))),{audioCodecs:T,videoCodecs:w,audioExtensions:L,videoExtensions:B}}function xP(t){const e=p0(t);let n,a;for(const s of e.mediaDescriptions){if(!n){const d=s.attributes.iceUfrag,f=s.attributes.icePwd;if(!d||!f)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:d,icePwd:f}}if(!a){const d=s.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&e.attributes.fingerprints.length>0&&(a={fingerprints:e.attributes.fingerprints}),!a||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:a}}function Gnt(t,e){const n=[],a=t.attributes.ssrcGroups.filter(f=>f.semantic==="FID"),s=t.attributes.ssrcGroups.find(f=>f.semantic==="SIM"),d=t.attributes.ssrcs;if(s)s.ssrcIds.forEach(f=>{var m;const _=(m=a.find(y=>y.ssrcIds[0]===f))===null||m===void 0?void 0:m.ssrcIds[1];n.push({ssrcId:f,rtx:e?_:void 0})});else if(a.length>0){const f=a[0].ssrcIds[0],m=a[0].ssrcIds[1];n.push({ssrcId:f,rtx:e?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:d[0].ssrcId})}return n}function Hnt(t,e,n){const{cname:a}=t;let s=[];e&&(s=qnt(e)),s.length===0&&(s=t.iceParameters.candidates.map(T=>({foundation:T.foundation,componentId:"1",transport:T.protocol,priority:T.priority.toString(),connectionAddress:T.ip,port:T.port.toString(),type:T.type,extension:{}})),F.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(T=>({hashFunction:T.algorithm,fingerprint:T.fingerprint}))},f={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=w8(t.rtpCapabilities),y=[];return Array.isArray(n)&&n.length>0&&n.forEach(T=>{y.push({kind:k_.VIDEO,ssrcId:T.v,rtx:T.v_rtx,mslabel:"".concat(T.v,"_").concat(T.a)},{kind:k_.AUDIO,ssrcId:T.a,mslabel:"".concat(T.v,"_").concat(T.a)})}),{dtlsParameters:d,iceParameters:f,candidates:s,rtpCapabilities:_,setup:m,cname:a,preSSRCs:y}}function qnt(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],F.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),F.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function CM(t,e,n){const a=[],s=[];return t.forEach(d=>{let{ssrcId:f,rtx:m}=d;const _=xS(8,"track-"),y={ssrcId:f,attributes:Fnt({label:_,mslabel:n=n||xS(10,""),msid:"".concat(n," ").concat(_)},e&&{cname:e})};if(a.push(y),m!==void 0){const T={ssrcId:m,attributes:Fnt({label:_,mslabel:n,msid:"".concat(n," ").concat(_)},e&&{cname:e})};a.push(T),s.push({semantic:"FID",ssrcIds:[f,m]})}}),t.length>1&&s.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:f}=d;return f})}),{ssrcs:a,ssrcGroups:s}}function p3(t,e){e instanceof uT&&t.attributes.payloads.forEach(n=>{var a;const s=(a=n.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const d=e._encoderConfig;d&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(d.bitrate&&!rT()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function i9(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function o9(t,e){var n;if(!(e instanceof zS&&e._encoderConfig&&e._hints.indexOf(US.SCREEN_TRACK)===-1))return;const a=e._encoderConfig;pS().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach(s=>{var d,f;T_(d=["h264","h265","vp8","vp9","av1"]).call(d,((f=s.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),pS().supportMinBitrate&&!T_(n=e._hints).call(n,US.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach(s=>{var d,f;T_(d=["h264","h265","vp8","vp9","av1"]).call(d,((f=s.rtpMap)===null||f===void 0?void 0:f.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(aa("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function znt(t){if(t.media.mediaType!=="video")return;const e=lS();if(e.name!==mS.SAFARI&&e.os!==jT.IOS)return;const n=t.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function O8(t,e,n){if(!e)return;let a,s;if(t.media.mediaType==="video"?(a=n.videoExtensions,s=n.videoCodecs):(a=n.audioExtensions,s=n.audioCodecs),e.twcc===!0){const d=a.find(f=>C8(f.extensionName));if(d){const f=d.extensionName;t.attributes.extmaps.find(_=>C8(_.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:f}),function(_,y){return y.filter(T=>!!_.find(w=>w.payloadType===T.payloadType&&!!w.rtcpFeedbacks.find(L=>L.type==="transport-cc")))}(s,t.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const d=t.attributes.extmaps.findIndex(f=>C8(f.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(f=>{const m=f.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&f.rtcpFeedbacks.splice(m,1)})}if(e.remb===!0){const d=a.find(f=>Vnt(f.extensionName));if(d){const f=d.extensionName;t.attributes.extmaps.find(_=>_.extensionName===f)||t.attributes.extmaps.push({entry:d.entry,extensionName:f}),function(_,y){return y.filter(T=>!!_.find(w=>w.payloadType===T.payloadType&&!!w.rtcpFeedbacks.find(L=>L.type==="goog-remb")))}(s,t.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const d=t.attributes.extmaps.findIndex(f=>Vnt(f.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(f=>{const m=f.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&f.rtcpFeedbacks.splice(m,1)})}}function Knt(t,e,n){if(rT()||t.media.mediaType!=="video"||!(e instanceof zS)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!aa("SIMULCAST")||n==="vp9"&&aa("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const a=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,s=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===s.ssrcId),f={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:s.ssrcId+m,attributes:aT(s.attributes)}),f.ssrcIds.push(s.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:aT(s.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(f)}async function Wnt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const a=(await n.createOffer()).sdp,{send:s,recv:d,sendrecv:f}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const T=W2(y,m,_,"sendonly"),w=W2(y,m,_,"recvonly"),L={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Q={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(FO(T,w,"videoExtensions",L,B,Q),FO(T,w,"videoCodecs",L,B,Q),FO(T,w,"audioExtensions",L,B,Q),FO(T,w,"audioCodecs",L,B,Q),aa("RAISE_H264_BASELINE_PRIORITY")){const X=[],J=[];Q.videoCodecs.forEach((_n,_r)=>{var ya;if(((ya=_n.rtpMap)===null||ya===void 0?void 0:ya.encodingName.toLocaleLowerCase())==="h264"){var _l,_d;const tu=Q.videoCodecs[_r+1],_g=tu&&Qnt(_n,tu),l_=(_l=_n.fmtp)===null||_l===void 0?void 0:_l.parameters["profile-level-id"],O_=(_d=_n.fmtp)===null||_d===void 0?void 0:_d.parameters["packetization-mode"];!l_||l_!==aa("FIRST_H264_PROFILE_LEVEL_ID")||aa("FIRST_PACKETIZATION_MODE")&&O_!==aa("FIRST_PACKETIZATION_MODE")?_g?J.push([_n,tu]):J.push([_n]):_g?X.push([_n,tu]):X.push([_n])}}),X.length>0&&J.length>0&&(F.debug("raising H264 baseline profile priority"),Q.videoCodecs.forEach((_n,_r)=>{var ya;if(((ya=_n.rtpMap)===null||ya===void 0?void 0:ya.encodingName.toLocaleLowerCase())==="h264"){const _l=Qnt(_n,Q.videoCodecs[_r+1]),_d=X.shift()||J.shift()||[];_d.length>0&&(_l?Q.videoCodecs.splice(_r,2,..._d):Q.videoCodecs.splice(_r,1,..._d))}}),B.videoCodecs=B.videoCodecs.filter(_n=>{var _r,ya;return!(((_r=_n.rtpMap)===null||_r===void 0?void 0:_r.encodingName.toLocaleLowerCase())==="h264"&&((ya=_n.fmtp)===null||ya===void 0?void 0:ya.parameters["profile-level-id"])!==aa("FIRST_H264_PROFILE_LEVEL_ID"))}),aa("FILTER_SEND_H264_BASELINE")&&(L.videoCodecs=L.videoCodecs.filter(_n=>{var _r,ya;return!(((_r=_n.rtpMap)===null||_r===void 0?void 0:_r.encodingName.toLocaleLowerCase())==="h264"&&((ya=_n.fmtp)===null||ya===void 0?void 0:ya.parameters["profile-level-id"])!==aa("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:L,recv:B,sendrecv:Q}}(t,e,a);try{n.close()}catch{}return{send:s,recv:d,sendrecv:f}}function Ynt(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=W2(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(FO(t,e,"videoExtensions",n,a,s),FO(t,e,"videoCodecs",n,a,s),FO(t,e,"audioExtensions",n,a,s),FO(t,e,"audioCodecs",n,a,s),aa("RAISE_H264_BASELINE_PRIORITY")){const d=s.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const f=s.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(f<d){F.debug("raising H264 baseline profile priority");const m=s.videoCodecs[d];s.videoCodecs.splice(d,1),s.videoCodecs.splice(f,0,m)}f!==-1&&(a.videoCodecs=a.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:a,sendrecv:s}}function FO(t,e,n,a,s,d){if(n==="videoExtensions"||n==="audioExtensions"){const f=[];return t[n].forEach(m=>{e[n].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return f.push(y),!0})?d[n].push(m):a[n].push(m)}),void e[n].forEach((m,_)=>{f.indexOf(_)===-1&&s[n].push(m)})}if(n==="videoCodecs"||n==="audioCodecs"){const f=[];return t[n].forEach(m=>{e[n].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return f.push(y),!0})?d[n].push(m):a[n].push(m)}),void e[n].forEach((m,_)=>{f.indexOf(_)===-1&&s[n].push(m)})}}function w8(t){const{send:e,recv:n,sendrecv:a}=t;if(!a){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let s,d;return e?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...e.audioCodecs,...a.audioCodecs],s.videoCodecs=[...e.videoCodecs,...a.videoCodecs],s.audioExtensions=[...e.audioExtensions,...a.audioExtensions],s.videoExtensions=[...e.videoExtensions,...a.videoExtensions]):s=a,n?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...n.audioCodecs,...a.audioCodecs],d.videoCodecs=[...n.videoCodecs,...a.videoCodecs],d.audioExtensions=[...n.audioExtensions,...a.audioExtensions],d.videoExtensions=[...n.videoExtensions,...a.videoExtensions]):d=a,{send:s,recv:d}}function f3(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function Y2(t,e,n,a){let s=[];if(t===k_.VIDEO){if(aa("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(s=e.videoCodecs.filter(d=>{var f;return T_(f=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(f,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===aa("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){let d=[];const f=[],m=[],_=[];if(n.videoCodecs.forEach(y=>{const T=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";T_(T).call(T,a)?d.push(y):T_(T).call(T,"vp9")?f.push(y):T_(T).call(T,"vp8")?m.push(y):T_(T).call(T,"h264")&&_.push(y)}),d.length===0){let y="";f.length!==0?(d=f,y="vp9"):m.length!==0?(d=m,y="vp8"):_.length!==0&&(d=_,y="h264"),F.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}d.length!==0&&(s=e.videoCodecs.filter(y=>d.some(T=>T.payloadType===y.payloadType)))}if(s.length===0&&(F.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),s=e.videoCodecs),aa("USE_PUB_RTX")||aa("USE_SUB_RTX")){const d=a9(s,e.videoCodecs);s=[...s,...d]}}else s=e.audioCodecs.filter(d=>{var f;return T_(f=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(f,a)}),s.length===0&&(F.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),s=e.audioCodecs.filter(d=>{var f;return T_(f=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(f,"opus")}));return s}function a9(t,e){const n=t.map(a=>a.payloadType.toString());return e.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&T_(n).call(n,a.fmtp&&a.fmtp.parameters.apt))}async function X2(t,e,n){const a=e.toString(),s=Jnt(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let f=d.sdp;f=Xnt(f,n||{}),s==null||s(f||""),await t.setLocalDescription({type:"answer",sdp:f})}function Xnt(t,e,n){const a=p0(t),{useXR:s}=e;return a.mediaDescriptions.forEach(d=>{var f;d.attributes.mid&&(Array.isArray(n)&&!T_(n).call(n,d.attributes.mid)||(d.media.mediaType==="audio"&&f3(d),s&&T_(f=["audio","video"]).call(f,d.media.mediaType)&&d.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),DP(a)}function Jnt(t,e,n,a){if(aa("SDP_LOGGING"))return F.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(a,`
`),t),e==="offer"?s=>{Jnt(s,"answer",n==="local"?"remote":"local",a)}:void 0}function Znt(t){const e=aa("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>T_(t).call(t,n))}function Qnt(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function $nt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function lO(t,e){return typeof aa(t)===e?aa(t):void 0}function Upt(){try{const t=aa("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?$nt(Object(a),!0).forEach(function(s){_t(e,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$nt(Object(a)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(a,s))})}return e}({},t)}catch(t){return F.debug("handle gateway attributes failed: ",t),{}}}const trt={};function UP(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&F.debug("install service ".concat(t.name)),trt[t.name]=t}function yL(t){const e=trt[t];if(!e)throw new t_(_i.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function ert(t,e){return yL("DataStream").create(t,e)}function I8(){return yL("InterceptFrame").create()}function nrt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function bL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nrt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nrt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}const s9=new Map;class jpt extends eT{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(zT.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(zT.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){F.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var a,s,d;super(),_t(this,"store",void 0),_t(this,"joinInfo",void 0),_t(this,"key",void 0),_t(this,"ntpOffset",0),_t(this,"signal",void 0),_t(this,"role",void 0),_t(this,"inChannelInfo",{joinAt:null,duration:0}),_t(this,"spec",void 0),_t(this,"_state","DISCONNECTED"),_t(this,"_statsCollector",void 0),_t(this,"_disconnectedReason",void 0),_t(this,"isSignalRecover",!1),_t(this,"hasChangeBGPAddress",!1),_t(this,"trafficStatsInterval",void 0),_t(this,"networkQualityInterval",void 0),_t(this,"_joinGatewayStartTime",0),_t(this,"_signalTimeout",!1),_t(this,"_clientRoleOptions",void 0),_t(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(a={spec:bL(bL({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(s=(d=yL("P2PChannel")).createSubmodule)===null||s===void 0?void 0:s.call(d,a)):new Mpt(bL(bL({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,a){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let d=s9.get(e.cname);if(d||(d=new Map,s9.set(e.cname,d)),this._isProactiveJoin=!0,d.has(e.uid)){const y=new _E(_i.UID_CONFLICT);throw V_.joinGateway(e.sid,{lts:s,succ:!1,ec:y.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),y}d.set(e.uid,!0),this.joinInfo=e,this.key=n;let f=0;this.joinGatewayStartTime=s;const m=e.proxyServer;try{F.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(f));const y=e.gatewayAddrs.map(T=>{let{address:w}=T;const[L,B]=w.split(":"),Q={host:L,port:B};return e.proxyServer&&(Q.proxy=e.proxyServer),Q});f=(await this.signal.init(y)).uid,F.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(f," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw F.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),V_.joinGateway(e.sid,{lts:s,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:e.preload}),d.delete(e.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),F.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{F.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(zT.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(zT.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(zT.NETWORK_QUALITY,{uplinkNetworkQuality:xnt(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:xnt(this._statsCollector.trafficStats.B_dnq)}):this.emit(zT.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),f}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==vS.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==VS.CONNECTED||await function(a,s){return s===1/0?a:A_.race([a,uht(s)])}(this.signal.request(X_.LEAVE,void 0,!0),3e3)}catch(a){F.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(n),n!==vS.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:aa("PUB_EXTEND"),twcc:!!aa("PUBLISH_TWCC"),rtx:!!aa("USE_PUB_RTX")};try{return(await this.signal.request(X_.PUBLISH,s,!0))._message}catch(d){if(a&&d.data&&d.data.code===z_.ERR_PUBLISH_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw d}}async publishDataChannel(e,n,a){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(s=n.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(X_.PUBLISH_DATASTREAM,d,!0)}catch(f){if(a&&f.data&&f.data.code===z_.ERR_PUBLISH_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),f.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw f}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(X_.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(a){F.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await A_.all(e.map(n=>this.signal.request(X_.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){F.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const s={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!aa("SUBSCRIBE_TWCC"),rtx:!!aa("USE_SUB_RTX")||void 0,extend:aa("SUB_EXTEND"),svc:Array.isArray(aa("SVC"))&&aa("SVC").length!==0?aa("SVC"):void 0};try{return await this.signal.request(X_.PRE_SUBSCRIBE,s,!0)}catch(d){if(a&&d.data&&d.data.code===z_.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(e,n,!1);throw d}}async subscribe(e,n,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!aa("SUBSCRIBE_TWCC"),rtx:!!aa("USE_SUB_RTX"),extend:aa("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(aa("SVC"))&&aa("SVC").length!==0?aa("SVC"):void 0};try{return(await this.signal.request(X_.SUBSCRIBE,s,!0))._message}catch(d){if(a&&d.data&&d.data.code===z_.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw d}}async subscribeDataChannel(e,n,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(X_.SUBSCRIBE_DATASTREAM,s,!0)}catch(d){if(a&&d.data&&d.data.code===z_.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw d}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!aa("USE_SUB_RTX"),twcc:!!aa("SUBSCRIBE_TWCC"),svc:Array.isArray(aa("SVC"))&&aa("SVC").length!==0?aa("SVC"):void 0};try{return await this.signal.request(X_.SUBSCRIBE_STREAMS,a,!0)}catch(s){if(n&&s.data&&s.data.code===z_.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw s}}async setVideoProfile(e){const n=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let s=a.frameRate,d=a.width,f=a.height,m=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof f!="number"&&(f=f.exact||f.ideal||f.max||f.min||0,s||(m=!1)),m?{stream_type:0,width:d,height:f,fps:s,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(e);if(n)return this.signal.request(X_.SET_VIDEO_PROFILE,n);F.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(X_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(a){F.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await A_.all(e.map(a=>this.signal.request(X_.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:n},!0)))}catch(a){F.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(e){try{await this.signal.request(X_.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){F.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:a,rtpCapabilities:s}=e;return{gatewayEstablishParams:await this.signal.request(X_.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:a,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(X_.GATEWAY_INFO)}async renewToken(e){await this.signal.request(X_.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),aa("CLIENT_ROLE_OPTIONS")&&(F.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(aa("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},aa("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),aa("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},aa("CLIENT_ROLE_OPTIONS")),F.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(aa("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let a,s=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(X_.SET_CLIENT_ROLE,{role:e,level:s,delay:a,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(X_.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(X_.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(X_.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(X_.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(X_.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),bL({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(X_.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=s9.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let a;return a=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:uR.username,password:uR.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(bL(bL({},uR),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(X_.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===n.peer_uid);a&&a.B_st!==n.B_st&&JH(()=>{this.emit(zT.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new _E(_i.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let a=aa("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}var s;a&&a.length>128&&(a=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(zT.UPDATE_GATEWAY_CONFIG),s=this.store.clientId,T_(s3).call(s3,s)||s3.push(s);const d=!(rT()||_$(87)||stt())&&typeof aa("ENABLE_PRE_SUB")=="boolean"&&aa("ENABLE_PRE_SUB"),f=!stt()&&lO("ENABLE_PREALLOC_PC","boolean"),m=Upt(),_=N2(87)||function(){const T=lS();if(T.name!==mS.SAFARI||!T.browserVersion)return!1;const w=T.browserVersion.split(".");return Number(w[0])>15||Number(w[0])===15&&Number(w[1])>=4}(),y=bL({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:aO,browser:navigator.userAgent,process_id:aa("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:aa("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:bL({enableEncodedTransform:!!aa("ENABLE_AUDIO_METADATA")&&_||!!aa("ENABLE_AUDIO_TOPN")&&t7(mS.CHROME,87,116)||void 0,enableAudioMetadata:!!aa("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!aa("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:aa("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:aa("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:aa("TOPN_SWITCH_HOLD_MS"),topnAudioGain:aa("TOPN_AUDIO_GAIN"),enablePublishedUserList:aa("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:aa("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:lO("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:lO("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:lO("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:aa("USE_PUB_RTX")===!0||aa("USE_SUB_RTX")===!0||void 0,disableFEC:aa("DISABLE_FEC"),enableNTPReport:!!aa("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!aa("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!aa("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:lO("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!aa("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!aa("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:lO("USE_XR","boolean"),enableLossbasedBwe:lO("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!aa("ENABLE_AUT_CC")||void 0,enableCCFallback:lO("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:f,preSubNum:d?lO("PRE_SUB_NUM","number"):void 0,enablePubTWCC:lO("PUBLISH_TWCC","boolean"),enableSubTWCC:lO("SUBSCRIBE_TWCC","boolean"),enablePubRTX:lO("USE_PUB_RTX","boolean"),enableSubRTX:lO("USE_SUB_RTX","boolean"),enableSubSVC:aa("ENABLE_SVC")?aa("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(aa("SVC"))&&aa("SVC").length!==0?aa("SVC"):void 0,enableSvcExtended:aa("ENABLE_SVC")&&Array.isArray(aa("SVC_EXTENDED"))&&aa("SVC_EXTENDED").length!==0?aa("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,aa("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new _E(_i.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Q_.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Q_.WS_RECONNECTING,e=>{this.joinInfo&&V_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||sR.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",V_.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Q_.WS_CLOSED,e=>{let n;switch(e){case vS.LEAVE:n=sR.LEAVE;break;case vS.UID_BANNED:case vS.IP_BANNED:case vS.CHANNEL_BANNED:case vS.SERVER_ERROR:n=sR.SERVER_ERROR;break;case vS.FALLBACK:n=sR.FALLBACK;break;case vS.LICENSE_MISSING:case vS.LICENSE_EXPIRED:case vS.LICENSE_MINUTES_EXCEEDED:case vS.LICENSE_PERIOD_INVALID:case vS.LICENSE_MULTIPLE_SDK_SERVICE:case vS.LICENSE_ILLEGAL:case vS.TOKEN_EXPIRE:n=e;break;default:n=sR.NETWORK_ERROR}F.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+sR.NETWORK_ERROR)),this.joinInfo&&V_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===vS.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==vS.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Q_.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=aa("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(F.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(V_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void F.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));RS("EVENT_REPORT_DOMAIN",e[1]),RS("EVENT_REPORT_BACKUP_DOMAIN",e[1]),RS("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(rS.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(Q_.REQUEST_RECOVER,(e,n,a)=>{if(!this.joinInfo)return a(new _E(_i.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,cR(this,zT.REQUEST_NEW_GATEWAY_LIST).then(n).catch(a)}),this.signal.on(Q_.REQUEST_JOIN_INFO,async(e,n,a)=>{var s;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const d=aT((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(aa("NEW_TURN_MODE")&&d){let y=d.servers,T=d.serversFromGateway;const w=this.signal.currentURLIndex;y.length>0&&(y=[y[w%y.length]],d.servers=y),Array.isArray(T)&&T.length>0&&(T=[T[0]],d.serversFromGateway=T),F.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w))}const{iceParameters:f,dtlsParameters:m,rtpCapabilities:_}=await cR(this,zT.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d});try{e(this.getJoinMessage({ortc:{iceParameters:f,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){n(y)}}),this.signal.on(Q_.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(Q_.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let a,s="";var d;e instanceof _E?(a=((d=e.data)===null||d===void 0?void 0:d.desc)||e.code,s=e.message):a=e,V_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:s,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Q_.IS_P2P_DISCONNECTED,e=>{e(M2(this,zT.IS_P2P_DISCONNECTED))}),this.signal.on(Q_.DISCONNECT_P2P,()=>{this.emit(zT.DISCONNECT_P2P)}),this.signal.on(Q_.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Q_.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Q_.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(zT.JOIN_RESPONSE,e,n)}),this.signal.on(Q_.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=aa("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const a=qnt(e);this.emit(zT.PRE_CONNECT_PC,{candidates:a,fingerprint:n})}}}),this.signal.on(Q_.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof aa("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(aa("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(X_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(a){throw F.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(X_.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(a){throw F.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(X_.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(a){throw F.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(X_.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(a){throw F.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(e){const n={users:e.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(X_.UNSUBSCRIBE_STREAMS,n,!0)}catch(a){throw F.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(e,n){const a={action:e.find(s=>s.stream_type===bS.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(X_.CONTROL,a,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(e,n){const a={action:e.find(s=>s.stream_type===bS.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(X_.CONTROL,a,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(e,n){const a={action:e===k_.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(X_.CONTROL,a,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(e,n){const a={action:e===k_.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(X_.CONTROL,a,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(X_.RESTART_ICE,n,!0)}catch(a){throw F.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||sR.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!aa("GATEWAY_WSS_ADDRESS"))return aa("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(F.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(X_.SET_PARAMETER,{enablePublishAudioFilter:e})}}let N8=0,c9=0;function II(t,e,n,a){return new A_((s,d)=>{e.timeout=e.timeout||aa("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),N8+=vN(e.data)):n&&(e.data.size?N8+=e.data.size:e.data instanceof FormData?N8+=x$(e.data):N8+=vN(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,WR.request(e).then(f=>{typeof f.data=="string"?c9+=vN(f.data):f.data instanceof ArrayBuffer||f.data instanceof Uint8Array?c9+=f.data.byteLength:c9+=vN(JSON.stringify(f.data)),a&&s({data:f.data,headers:f.headers}),s(f.data)}).catch(f=>{WR.isCancel(f)?d(new _E(_i.OPERATION_ABORTED,"cancel token canceled")):f.code==="ECONNABORTED"?d(new _E(_i.NETWORK_TIMEOUT,f.message)):f.response?d(new _E(_i.NETWORK_RESPONSE_ERROR,f.response.status)):d(new _E(_i.NETWORK_ERROR,f.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(i_){var __=0;return function(){return __<i_.length?{done:!1,value:i_[__++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(i_,__,j_){return i_==Array.prototype||i_==Object.prototype||(i_[__]=j_.value),i_},a,s=function(i_){i_=[typeof globalThis=="object"&&globalThis,i_,typeof window=="object"&&window,typeof self=="object"&&self,typeof u=="object"&&u];for(var __=0;__<i_.length;++__){var j_=i_[__];if(j_&&j_.Math==Math)return j_}throw Error("Cannot find global object")}(this);function d(i_,__){if(__)t:{var j_=s;i_=i_.split(".");for(var s_=0;s_<i_.length-1;s_++){var Y=i_[s_];if(!(Y in j_))break t;j_=j_[Y]}(__=__(s_=j_[i_=i_[i_.length-1]]))!=s_&&__!=null&&n(j_,i_,{configurable:!0,writable:!0,value:__})}}function f(i_){return(i_={next:i_})[Symbol.iterator]=function(){return this},i_}function m(i_){var __=typeof Symbol<"u"&&Symbol.iterator&&i_[Symbol.iterator];return __?__.call(i_):{next:e(i_)}}if(d("Symbol",function(i_){function __(Y,ga){this.A=Y,n(this,"description",{configurable:!0,writable:!0,value:ga})}if(i_)return i_;__.prototype.toString=function(){return this.A};var j_="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",s_=0;return function Y(ga){if(this instanceof Y)throw new TypeError("Symbol is not a constructor");return new __(j_+(ga||"")+"_"+s_++,ga)}}),d("Symbol.iterator",function(i_){if(i_)return i_;i_=Symbol("Symbol.iterator");for(var __="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),j_=0;j_<__.length;j_++){var s_=s[__[j_]];typeof s_=="function"&&typeof s_.prototype[i_]!="function"&&n(s_.prototype,i_,{configurable:!0,writable:!0,value:function(){return f(e(this))}})}return i_}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var _;t:{var y={};try{y.__proto__={a:!0},_=y.a;break t}catch{}_=!1}a=_?function(i_,__){if(i_.__proto__=__,i_.__proto__!==__)throw new TypeError(i_+" is not extensible");return i_}:null}var T=a;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function L(i_){if(i_.m)throw new TypeError("Generator is already running");i_.m=!0}function B(i_,__){return i_.h=3,{value:__}}function Q(i_){this.g=new w,this.G=i_}function X(i_,__,j_,s_){try{var Y=__.call(i_.g.j,j_);if(!(Y instanceof Object))throw new TypeError("Iterator result "+Y+" is not an object");if(!Y.done)return i_.g.m=!1,Y;var ga=Y.value}catch(ja){return i_.g.j=null,i_.g.s(ja),J(i_)}return i_.g.j=null,s_.call(i_.g,ga),J(i_)}function J(i_){for(;i_.g.h;)try{var __=i_.G(i_.g);if(__)return i_.g.m=!1,{value:__.value,done:!1}}catch(j_){i_.g.v=void 0,i_.g.s(j_)}if(i_.g.m=!1,i_.g.l){if(__=i_.g.l,i_.g.l=null,__.F)throw __.D;return{value:__.return,done:!0}}return{value:void 0,done:!0}}function _n(i_){this.next=function(__){return i_.o(__)},this.throw=function(__){return i_.s(__)},this.return=function(__){return function(j_,s_){L(j_.g);var Y=j_.g.j;return Y?X(j_,"return"in Y?Y.return:function(ga){return{value:ga,done:!0}},s_,j_.g.return):(j_.g.return(s_),J(j_))}(i_,__)},this[Symbol.iterator]=function(){return this}}function _r(i_,__){return __=new _n(new Q(__)),T&&i_.prototype&&T(__,i_.prototype),__}if(w.prototype.o=function(i_){this.v=i_},w.prototype.s=function(i_){this.l={D:i_,F:!0},this.h=this.C||this.u},w.prototype.return=function(i_){this.l={return:i_},this.h=this.u},Q.prototype.o=function(i_){return L(this.g),this.g.j?X(this,this.g.j.next,i_,this.g.o):(this.g.o(i_),J(this))},Q.prototype.s=function(i_){return L(this.g),this.g.j?X(this,this.g.j.throw,i_,this.g.o):(this.g.s(i_),J(this))},d("Array.prototype.entries",function(i_){return i_||function(){return function(__,j_){__ instanceof String&&(__+="");var s_=0,Y=!1,ga={next:function(){if(!Y&&s_<__.length){var ja=s_++;return{value:j_(ja,__[ja]),done:!1}}return Y=!0,{done:!0,value:void 0}}};return ga[Symbol.iterator]=function(){return ga},ga}(this,function(__,j_){return[__,j_]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ya=function(i_,__){for(var j_=0;j_<i_.length;j_++)__(i_[j_])},_l=function(i_){return i_.replace(/\r?\n|\r/g,`\r
`)},_d=function(i_,__,j_){return __ instanceof Blob?(j_=j_!==void 0?j_+"":typeof __.name=="string"?__.name:"blob",__.name===j_&&Object.prototype.toString.call(__)!=="[object Blob]"||(__=new File([__],j_)),[String(i_),__]):[String(i_),String(__)]},tu=function(i_,__){if(i_.length<__)throw new TypeError(__+" argument required, but only "+i_.length+" present.")},_g=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,l_=_g.FormData,O_=_g.XMLHttpRequest&&_g.XMLHttpRequest.prototype.send,N_=_g.Request&&_g.fetch,iS=_g.navigator&&_g.navigator.sendBeacon,oS=_g.Element&&_g.Element.prototype,jS=_g.Symbol&&Symbol.toStringTag;jS&&(Blob.prototype[jS]||(Blob.prototype[jS]="Blob"),"File"in _g&&!File.prototype[jS]&&(File.prototype[jS]="File"));try{new File([],"")}catch{_g.File=function(__,j_,s_){return __=new Blob(__,s_||{}),Object.defineProperties(__,{name:{value:j_},lastModified:{value:+(s_&&s_.lastModified!==void 0?new Date(s_.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),jS&&Object.defineProperty(__,jS,{value:"File"}),__}}var gT=function(i_){return i_.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},lT=function(i_){this.i=[];var __=this;i_&&ya(i_.elements,function(j_){if(j_.name&&!j_.disabled&&j_.type!=="submit"&&j_.type!=="button"&&!j_.matches("form fieldset[disabled] *"))if(j_.type==="file"){var s_=j_.files&&j_.files.length?j_.files:[new File([],"",{type:"application/octet-stream"})];ya(s_,function(Y){__.append(j_.name,Y)})}else j_.type==="select-multiple"||j_.type==="select-one"?ya(j_.options,function(Y){!Y.disabled&&Y.selected&&__.append(j_.name,Y.value)}):j_.type==="checkbox"||j_.type==="radio"?j_.checked&&__.append(j_.name,j_.value):(s_=j_.type==="textarea"?_l(j_.value):j_.value,__.append(j_.name,s_))})};if((t=lT.prototype).append=function(i_,__,j_){tu(arguments,2),this.i.push(_d(i_,__,j_))},t.delete=function(i_){tu(arguments,1);var __=[];i_=String(i_),ya(this.i,function(j_){j_[0]!==i_&&__.push(j_)}),this.i=__},t.entries=function i_(){var __,j_=this;return _r(i_,function(s_){if(s_.h==1&&(__=0),s_.h!=3)return __<j_.i.length?s_=B(s_,j_.i[__]):(s_.h=0,s_=void 0),s_;__++,s_.h=2})},t.forEach=function(i_,__){tu(arguments,1);for(var j_=m(this),s_=j_.next();!s_.done;s_=j_.next()){var Y=m(s_.value);s_=Y.next().value,Y=Y.next().value,i_.call(__,Y,s_,this)}},t.get=function(i_){tu(arguments,1);var __=this.i;i_=String(i_);for(var j_=0;j_<__.length;j_++)if(__[j_][0]===i_)return __[j_][1];return null},t.getAll=function(i_){tu(arguments,1);var __=[];return i_=String(i_),ya(this.i,function(j_){j_[0]===i_&&__.push(j_[1])}),__},t.has=function(i_){tu(arguments,1),i_=String(i_);for(var __=0;__<this.i.length;__++)if(this.i[__][0]===i_)return!0;return!1},t.keys=function i_(){var __,j_,s_,Y,ga=this;return _r(i_,function(ja){if(ja.h==1&&(__=m(ga),j_=__.next()),ja.h!=3)return j_.done?void(ja.h=0):(s_=j_.value,Y=m(s_),B(ja,Y.next().value));j_=__.next(),ja.h=2})},t.set=function(i_,__,j_){tu(arguments,2),i_=String(i_);var s_=[],Y=_d(i_,__,j_),ga=!0;ya(this.i,function(ja){ja[0]===i_?ga&&(ga=!s_.push(Y)):s_.push(ja)}),ga&&s_.push(Y),this.i=s_},t.values=function i_(){var __,j_,s_,Y,ga=this;return _r(i_,function(ja){if(ja.h==1&&(__=m(ga),j_=__.next()),ja.h!=3)return j_.done?void(ja.h=0):(s_=j_.value,(Y=m(s_)).next(),B(ja,Y.next().value));j_=__.next(),ja.h=2})},lT.prototype._asNative=function(){for(var i_=new l_,__=m(this),j_=__.next();!j_.done;j_=__.next()){var s_=m(j_.value);j_=s_.next().value,s_=s_.next().value,i_.append(j_,s_)}return i_},lT.prototype._blob=function(){var i_="----formdata-polyfill-"+Math.random(),__=[],j_="--"+i_+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(s_,Y){return typeof s_=="string"?__.push(j_+gT(_l(Y))+`"\r
\r
`+_l(s_)+`\r
`):__.push(j_+gT(_l(Y))+'"; filename="'+gT(s_.name)+`"\r
Content-Type: `+(s_.type||"application/octet-stream")+`\r
\r
`,s_,`\r
`)}),__.push("--"+i_+"--"),new Blob(__,{type:"multipart/form-data; boundary="+i_})},lT.prototype[Symbol.iterator]=function(){return this.entries()},lT.prototype.toString=function(){return"[object FormData]"},oS&&!oS.matches&&(oS.matches=oS.matchesSelector||oS.mozMatchesSelector||oS.msMatchesSelector||oS.oMatchesSelector||oS.webkitMatchesSelector||function(i_){for(var __=(i_=(this.document||this.ownerDocument).querySelectorAll(i_)).length;0<=--__&&i_.item(__)!==this;);return-1<__}),jS&&(lT.prototype[jS]="FormData"),O_){var $R=_g.XMLHttpRequest.prototype.setRequestHeader;_g.XMLHttpRequest.prototype.setRequestHeader=function(i_,__){$R.call(this,i_,__),i_.toLowerCase()==="content-type"&&(this.B=!0)},_g.XMLHttpRequest.prototype.send=function(i_){i_ instanceof lT?(i_=i_._blob(),this.B||this.setRequestHeader("Content-Type",i_.type),O_.call(this,i_)):O_.call(this,i_)}}N_&&(_g.fetch=function(i_,__){return __&&__.body&&__.body instanceof lT&&(__.body=__.body._blob()),N_.call(this,i_,__)}),iS&&(_g.navigator.sendBeacon=function(i_,__){return __ instanceof lT&&(__=__._asNative()),iS.call(this,i_,__)}),_g.FormData=lT}})();const J2=()=>{const t=aa("AREAS");return t.length===0&&t.push(ES.GLOBAL),LR(t).call(t,(e,n,a)=>{const s=rrt(n);return s?a===0?s:"".concat(e,",").concat(s):e},"")},rrt=t=>t===ES.OVERSEA?"".concat(ER.ASIA,",").concat(ER.EUROPE,",").concat(ER.AFRICA,",").concat(ER.NORTH_AMERICA,",").concat(ER.SOUTH_AMERICA,",").concat(ER.OCEANIA):ER[t],Vpt=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const a=S8[n],s=Object.keys(a);s&&s.map(d=>{d!=="CODE"&&(e[d]=e[d].concat(a[d]))})}),e},D8={GLOBAL:{ASIA:[ES.CHINA,ES.JAPAN,ES.INDIA,ES.KOREA,ES.HKMC],EUROPE:[],NORTH_AMERICA:[ES.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},k8=Object.keys(D8[ES.GLOBAL]),u9=[ES.CHINA,ES.NORTH_AMERICA,ES.EUROPE,ES.ASIA,ES.JAPAN,ES.INDIA,ES.OCEANIA,ES.SOUTH_AMERICA,ES.AFRICA,ES.KOREA,ES.HKMC,ES.US],Bpt=function(t,e){let n=[];if(T_(t).call(t,ES.GLOBAL)){const d=[ES.GLOBAL,ES.OVERSEA],f=Object.keys(S8);if(e===ES.GLOBAL)throw new _E(_i.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===ES.CHINA)n=[ES.OVERSEA];else if(s=e,T_(k8).call(k8,s)){const m=(a=e,D8[ES.GLOBAL][a]||[]),_=[...d,e,...m];n=f.filter(y=>!T_(_).call(_,y))}else if(function(m){let _=!1;return k8.forEach(y=>{var T;T_(T=D8[ES.GLOBAL][y]).call(T,m)&&(_=!0)}),_}(e)){const m=function(y){let T;return k8.forEach(w=>{var L;T_(L=D8[ES.GLOBAL][w]).call(L,y)&&(T=w)}),T}(e),_=[...d,m,e];n=f.filter(y=>!T_(_).call(_,y))}else n=t;n=function(m){const _=[];return u9.forEach(y=>{T_(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!T_(u9).call(u9,y)))}(n)}else n=t;var a,s;return n};function irt(t){var e,n;if(!t&&T_(e=aa("AREAS")).call(e,ES.EXTENSIONS))return F.debug("update area from ap : reset"),void l9(Xht,!0);if(!T_(n=aa("AREAS")).call(n,ES.GLOBAL)||!t)return;let a=S8.EXTENSIONS;a&&(a={CODE:rrt(ES.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},F.debug("update area from ap success: ".concat(t,",config is "),a),RS("AREAS",[ES.EXTENSIONS],!0),Object.keys(a).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?RS(s,a[s][0]):RS(s,a[s])}))}function l9(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=V_.reportApiInvoke(null,{name:OT.SET_AREA,options:t,tag:oT.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!T_(Rnt).call(Rnt,d))throw new _E(_i.INVALID_PARAMS,"invalid area code")}),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:f}=t;if(!d)throw new _E(_i.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),a=f?Bpt(m,f):m}if(!e){if(AI.AREAS){const d=new _E(_i.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(d),void F.warning("setArea is prohibited because of config-distribute")}if(T_(a).call(a,ES.GLOBAL)&&aa("AREAS")===ES.EXTENSIONS){const d=new _E(_i.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(d),void F.warning("setArea is prohibited because of ap extensions")}}RS("AREAS",a,e);const s=Vpt(a);Object.keys(s).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?RS(d,s[d][0]):RS(d,s[d])}),F.debug("set area success:",a.join(","))}catch(a){throw n.onError(a),a}n.onSuccess()}function ort(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function AN(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ort(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ort(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}let d9=1;function Fpt(t,e,n,a,s){d9+=1;const d={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:d9,requestId:d9,version:aO,cname:n.cname},f={service_name:e,json_body:JSON.stringify(d)};let m,_,y=t[0];return RI(async()=>{m=Date.now();const T=await II(y,{data:f,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,T.code!==0){const B=new _E(_i.UNEXPECTED_RESPONSE,"live streaming ap error, code"+T.code,{retry:!0,responseTime:_});throw F.error(B.toString()),B}const w=JSON.parse(T.json_body);if(w.code!==200){const B=new _E(_i.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:_});throw F.error(B.toString()),B}if(!w.servers||w.servers.length===0){const B=new _E(_i.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:_});throw F.error(B.toString()),B}const L=function(B,Q){return{addressList:B.servers.map(X=>"wss://".concat(X.address.replace(/\./g,"-"),".").concat(aa("WORKER_DOMAIN"),":").concat(X.wss,"?serviceName=").concat(encodeURIComponent(Q))),workerToken:B.workerToken,vid:B.vid}}(w,e);return aa("LIVE_STREAMING_ADDRESS")&&(L.addressList=aa("LIVE_STREAMING_ADDRESS")instanceof Array?aa("LIVE_STREAMING_ADDRESS"):[aa("LIVE_STREAMING_ADDRESS")]),AN(AN({},L),{},{responseTime:_})},(T,w)=>(V_.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(T.addressList),firstSuccess:w===0,responseTime:_,serverIp:t[w%t.length]}),!1),(T,w)=>(V_.apworkerEvent(n.sid,{success:!1,sc:T.data&&T.data.code||200,serviceName:e,responseTime:_,serverIp:t[w%t.length]}),!!(T.code!==_i.OPERATION_ABORTED&&T.code!==_i.UNEXPECTED_RESPONSE||T.data&&T.data.retry)&&(y=t[(w+1)%t.length],!0)),s)}let h9=1;function art(t,e,n,a){let{url:s,areaCode:d}=t;const{clientId:f,sid:m}=e,_=Date.now();let y;const T=e.role,[w,L]=f9(e,d,[TT.CHOOSE_SERVER]);let B=ST.networkState;return RI(async()=>{B&&ST.networkState===O0.OFFLINE&&ST.onlineWaiter&&await A_.race([ST.onlineWaiter,QT(a&&a.maxRetryTimeout||wT.maxRetryTimeout)]),B=ST.networkState;const{data:Q,headers:X}=await II(s,{data:w,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=X.http3==="1"?1:-1,V_.reportResourceTiming(s,m),crt(Q,s,e,_,[TT.CHOOSE_SERVER],y);const J=K2(Q,TT.CHOOSE_SERVER);return p9(J),n9(J,s)},Q=>(Q&&V_.joinChooseServer(m,{role:T,lts:_,succ:!0,csAddr:s,opid:L,serverList:Q.gatewayAddrs.map(X=>X.address),ec:null,cid:Q.cid.toString(),uid:Q.uid.toString(),csIp:Q.csIp,unilbsServerIds:[TT.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:Q.res.detail&&Q.res.detail[38]}),!1),Q=>Q.code!==_i.OPERATION_ABORTED&&(Q.code===_i.CAN_NOT_GET_GATEWAY_SERVER?Q.data.retry:(V_.joinChooseServer(m,{role:T,lts:_,succ:!1,csAddr:s,serverList:null,opid:L,ec:Q.code,csIp:Q.data&&Q.data.csIp,unilbsServerIds:[TT.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:B}),isHttp3:y,corssRegionTagReq:e.apRequestDetail}),F.warning("[".concat(f||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),Q),!0)),a)}function srt(t,e,n,a){let s,{url:d,areaCode:f,serviceIds:m}=t;const _=Date.now(),y=e.role,[T,w]=f9(e,f,m);let L;return RI(async()=>{L&&ST.networkState===O0.OFFLINE&&ST.onlineWaiter&&await A_.race([ST.onlineWaiter,QT(a&&a.maxRetryTimeout||wT.maxRetryTimeout)]),L=ST.networkState;const{data:B,headers:Q}=await II(d,{data:T,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=Q.http3==="1"?1:-1,V_.reportResourceTiming(d,e.sid),crt(B,d,e,_,m,s);const X=K2(B,TT.CHOOSE_SERVER),J=K2(B,e.cloudProxyServer==="proxy5"?TT.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?TT.CLOUD_PROXY:TT.CLOUD_PROXY_FALLBACK);return p9(X),{gatewayInfo:n9(X,d),proxyInfo:J,url:d}},B=>(B.gatewayInfo&&V_.joinChooseServer(e.sid,{role:y,lts:_,succ:!0,csAddr:d,serverList:B.gatewayInfo.gatewayAddrs.map(Q=>Q.address),ec:null,opid:w,cid:B.gatewayInfo.cid.toString(),uid:B.gatewayInfo.uid.toString(),csIp:B.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:s,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:B.gatewayInfo.res.detail&&B.gatewayInfo.res.detail[38]}),B.proxyInfo&&V_.joinWebProxyAP(e.sid,{lts:_,sucess:1,apServerAddr:d,turnServerAddrList:B.proxyInfo.addresses.map(Q=>Q.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:m.toString()}),!1),B=>B.code!==_i.OPERATION_ABORTED&&(B.code===_i.CAN_NOT_GET_GATEWAY_SERVER?B.data.retry:(V_.joinWebProxyAP(e.sid,{lts:_,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:B.code,eventType:e.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:L})}),F.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),B),!0)),a)}const crt=(t,e,n,a,s,d)=>{const{sid:f,clientId:m,cloudProxyServer:_}=n,y=[],T=w=>{w.flag===4096?V_.joinChooseServer(f,{role:n.role,lts:a,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:d,corssRegionTagReq:n.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||V_.joinWebProxyAP(f,{lts:a,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:w.error.code,eventType:_,unilbsServerIds:s.toString()})};if(t.response_body.forEach(w=>{const L=w.buffer.code;if(w.uri===23&&L===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)F.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const B={error:new _E(_i.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:w.buffer.flag};y.push(B),T(B)}if(L!==0){const B=d3(L),Q={error:new _E(_i.CAN_NOT_GET_GATEWAY_SERVER,B.desc,{desc:B.desc,retry:B.retry,csIp:t.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?F.warning(Q.error.toString()):y.push(Q),T(Q)}}),y.length)throw F.warning("[".concat(m||"sid-".concat(f.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(y.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new _E(_i.CAN_NOT_GET_GATEWAY_SERVER,y.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!y.find(w=>w.error.data.retry),csIp:t.detail[502],desc:[...new Set(y.map(w=>{var L;return w==null||(L=w.error)===null||L===void 0||(L=L.data)===null||L===void 0?void 0:L.desc}).filter(w=>!!w))]})},p9=t=>{var e,n,a,s;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new _E(_i.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(aa("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((s=t.detail)===null||s===void 0?void 0:s[23])=="string"?irt(t.detail[23].toLowerCase()):irt()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const f=t.detail[19],m=f==null?void 0:f.split(";");for(let _=0;_<m.length;_++){var d;const y=wR(d=m[_]).call(d);t.addresses[_]&&m&&(t.addresses[_].fingerprint=y)}}if(aa("GATEWAY_ADDRESS")&&aa("GATEWAY_ADDRESS").length>0){F.debug("assign gateway address to",aa("GATEWAY_ADDRESS"));const f=aa("GATEWAY_ADDRESS").map(m=>{var _,y;const T=(_=(y=t.addresses.find(w=>w.ip===m.ip&&w.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:T}});t.addresses=f}},Gpt=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const a=d3(n.buffer.code);throw new _E(_i.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return n.buffer.ticket}throw F.debug("update ticket request received ap response without response body:",e),new _E(_i.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},f9=(t,e,n)=>{const a=Math.floor(Math.random()*1e12),s=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:AN(AN(AN({6:t.stringUid,11:e,12:aa("USE_NEW_TOKEN")?"1":void 0},s?{17:s}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};d.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const f=new FormData;return f.append("request",JSON.stringify(d)),[f,a]},Hpt=(t,e)=>{const n=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(a)),[s,n]};let m3=0;function E3(t){return A_.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const Z2=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:a,allFailedhandler:s,promisesCollector:d}=t,f=0;const m=e;let _,y=0;const T=async()=>{const w=(()=>{const L=f*m,B=L+m;return n.slice(L,B).map(a)})();d&&d.push(...w);try{_=await E3(w)}catch(L){if(y+=m,f++,!(y>=n.length))return void await T();s(L)}w.forEach(L=>L.cancel())};return await T(),_},urt=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:a}=t;const s=e.length;let d=0;const f=async()=>{const m=n(e.shift());try{return await m}catch(_){if(d++,d>=s||a!=null&&a(_))throw _;return f()}};return f()};async function m9(t,e,n,a){return{gatewayInfo:await async function(d,f,m,_){let y=null;const T=[],w=async()=>{const B=aa("WEBCS_DOMAIN").slice(0,aa("AJAX_REQUEST_CONCURRENT")).map(J=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(J+"/api/v2/transpond/webrtc?v=2"):"https://".concat(J,"/api/v2/transpond/webrtc?v=2"),areaCode:J2()})),Q=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:B.map(J=>J.url)}),X=await Z2({fragementLength:aa("FRAGEMENT_LENGTH"),referenceList:B,asyncMapHandler:J=>(F.debug("[".concat(d.clientId,"] Connect to choose_server:"),J.url),art(J,d,f,m)),allFailedhandler:J=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Q),J[0]},promisesCollector:T});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},Q),X},L=async()=>{if(await QT(1e3),y!==null)return y;const B=aa("WEBCS_DOMAIN_BACKUP_LIST").map(J=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(J+"/api/v2/transpond/webrtc?v=2"):"https://".concat(J,"/api/v2/transpond/webrtc?v=2"),areaCode:J2()})),Q=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:B.map(J=>J.url)}),X=await Z2({fragementLength:aa("FRAGEMENT_LENGTH"),referenceList:B,asyncMapHandler:J=>(F.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),J.url),art(J,d,f,m)),allFailedhandler:J=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Q),J[0]},promisesCollector:T});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},Q),X};try{return y=await E3([w(),L()]),T.length&&T.forEach(B=>B.cancel&&typeof B.cancel=="function"&&B.cancel()),y}catch(B){throw B[0]}}(t,e,n,a)}}async function lrt(t,e,n,a,s){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await m9(t,e,n,s);if(aa("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:L,proxyInfo:B}=await prt(t,e,n,s);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:L};const Q=B.map(X=>({turnServerURL:X.address,tcpport:X.tcpport||uR.tcpport,udpport:X.udpport||uR.udpport,username:X.username||uR.username,password:X.password||uR.password,forceturn:!1,security:!0}));if(s.useP2P){var f;const X=(f=t.uid)!==null&&f!==void 0?f:L.uid,J="glb:".concat(X.toString()),_n=await c7(J),_r=B.map(ya=>({turnServerURL:ya.address,tcpport:ya.tcpport||uR.tcpport,udpport:ya.udpport||uR.udpport,username:J,password:_n,forceturn:!1,security:!0}));Q.push(..._r)}return t.turnServer={mode:"manual",servers:Q},{gatewayInfo:L}}return await m9(t,e,n,s)}const{proxyInfo:m,gatewayInfo:_}=await prt(t,e,n,s),y={gatewayInfo:_},T=m.map(L=>({turnServerURL:L.address,tcpport:d==="proxy3"?void 0:L.tcpport?L.tcpport:uR.tcpport,udpport:d==="proxy4"?void 0:L.udpport?L.udpport:uR.udpport,username:L.username||uR.username,password:L.password||uR.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(s.useP2P){var w;const L=(w=t.uid)!==null&&w!==void 0?w:_.uid,B="glb:".concat(L.toString()),Q=await c7(B),X=m.map(J=>({turnServerURL:J.address,tcpport:d==="proxy3"?void 0:J.tcpport||uR.tcpport,udpport:d==="proxy4"?void 0:J.udpport||uR.udpport,username:B,password:Q,forceturn:d!=="proxy4",security:d==="proxy5"}));T.push(...X)}return t.turnServer={mode:"manual",servers:T},F.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),y}async function drt(t,e,n,a,s){const d=aa("ACCOUNT_REGISTER").slice(0,aa("AJAX_REQUEST_CONCURRENT"));let f=[];f=e.proxyServer?d.map(_=>"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1")):d.map(_=>"https://".concat(_,"/api/v1"));const m=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:f});try{const _=await async function(y,T,w,L,B){const Q=Date.now(),X={sid:w.sid,opid:10,appid:w.appId,string_uid:T};let J=y[0];const _n=await RI(()=>II(J+"".concat(J.indexOf("?")===-1?"?":"&","action=stringuid"),{data:X,cancelToken:L,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(_r,ya)=>{if(_r.code===0){if(_r.uid<=0||_r.uid>=Math.pow(2,32))throw F.error("Invalid Uint Uid ".concat(T," => ").concat(_r.uid),_r),V_.reqUserAccount(X.sid,{lts:Q,success:!1,serverAddr:J,stringUid:X.string_uid,uid:_r.uid,errorCode:_i.INVALID_UINT_UID_FROM_STRING_UID,extend:X}),new _E(_i.INVALID_UINT_UID_FROM_STRING_UID);return V_.reqUserAccount(X.sid,{lts:Q,success:!0,serverAddr:J,stringUid:X.string_uid,uid:_r.uid,errorCode:null,extend:X}),!1}const _l=d3(_r.code);return _l.retry&&(J=y[(ya+1)%y.length]),V_.reqUserAccount(X.sid,{lts:Q,success:!1,serverAddr:J,stringUid:X.string_uid,uid:_r.uid,errorCode:_l.desc,extend:X}),_l.retry},(_r,ya)=>_r.code!==_i.OPERATION_ABORTED&&(V_.reqUserAccount(X.sid,{lts:Q,success:!1,serverAddr:J,stringUid:X.string_uid,uid:null,errorCode:_r.code,extend:X}),J=y[(ya+1)%y.length],!0),B);if(_n.code!==0){const _r=d3(_n.code);throw new _E(_i.UNEXPECTED_RESPONSE,_r.desc)}return _n}(f,t,e,n,a);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function qpt(t,e,n){const a=aa("ACCOUNT_REGISTER");let s=[];s=e.proxyServer?a.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await urt({referenceList:s,asyncMapHandler:f=>async function(m,_,y,T){const w=Date.now(),L={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const B=await II(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:L,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(B.code!==0){const Q=d3(B.code);throw new _E(_i.UNEXPECTED_RESPONSE,"preload sua error:".concat(Q.desc),Q)}if(B.uid<=0||B.uid>=Math.pow(2,32))throw new _E(_i.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:m,req:L,uid:B.uid,elapse:Date.now()-w}}catch(B){throw B}}(f,t,e,n),closeFn:f=>f.code===_i.OPERATION_ABORTED||f.code===_i.UNEXPECTED_RESPONSE&&!f.data.retry})}catch(d){throw d}}async function zpt(t,e,n){const a=aa("CDS_AP").slice(0,aa("AJAX_REQUEST_CONCURRENT")).map(_=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),s=a.map(_=>function(y,T,w,L){const B=lS(),Q={flag:64,cipher_method:0,features:AN(AN(AN(AN(AN({install_id:v7(),device:B.name,system:B.os,system_general:navigator.userAgent,vendor:T.appId,version:aO,cname:T.cname,session_id:T.sid,proxyServer:T.proxyServer,sdk_type:xpt.WEB_RTC,browser_name:B.name,browser_version:B.version,user_agent:navigator.userAgent,channel_name:T.cname},T.stringUid&&{string_uid:T.stringUid}),T.uid&&{uid:T.uid+""}),B.os&&{os_name:B.os}),B.osVersion&&{os_version:B.osVersion}),{},{detail:""})};return RI(()=>II(y,{data:Q,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,X=>X.code!==_i.OPERATION_ABORTED,L)}(_,t,e,n));let d=null,f=null,m={};try{d=await E3(s)}catch(_){if(_.code===_i.OPERATION_ABORTED)throw _;f=_}if(s.forEach(_=>_.cancel()),V_.reportApiInvoke(t.sid,{name:OT.REQUEST_CONFIG_DISTRIBUTE,options:{error:f,res:d}}).onSuccess(),d&&d.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,T=Object.keys(y),w={};return T.forEach(L=>{var B;const Q=wR(B=L.slice(4)).call(B),X=JSON.parse(y[L]),J=X[1];w[Q]={tag:X[0]||"",value:J}}),w}(d)}catch{}return m}async function hrt(t,e){const n=aa("WEBCS_DOMAIN").concat(aa("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:J2(),serviceIds:[TT.CHOOSE_SERVER,TT.CLOUD_PROXY_FALLBACK]}));try{return await urt({referenceList:n,asyncMapHandler:s=>async function(d,f,m){let _,{url:y,areaCode:T,serviceIds:w}=d;const L=Date.now(),[B,Q]=f9(f,T,w);let X=ST.networkState;try{X&&ST.networkState===O0.OFFLINE&&ST.onlineWaiter&&await A_.race([ST.onlineWaiter,QT(wT.maxRetryTimeout)]),X=ST.networkState;const{data:J,headers:_n}=await II(y,{data:B,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=_n.http3==="1"?1:-1,(_d=>{const tu=[];if(_d.response_body.forEach(_g=>{const l_=_g.buffer.code;if(_g.uri===23&&l_===0&&!_g.buffer.edges_services)if(_g.buffer.flag===4194310)_g.buffer.edges_services=[];else{const O_={error:new _E(_i.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_d.detail[502]}),flag:_g.buffer.flag};tu.push(O_)}if(l_!==0){const O_=d3(l_),N_={error:new _E(_i.CAN_NOT_GET_GATEWAY_SERVER,O_.desc,{desc:O_.desc,retry:O_.retry,csIp:_d.detail[502]}),flag:_g.buffer.flag};_g.buffer.flag===4194310?F.warning(N_.error.toString()):tu.push(N_)}}),tu.length)throw new _E(_i.CAN_NOT_GET_GATEWAY_SERVER,tu.map(_g=>"flag: ".concat(_g.flag,", message: ").concat(_g.error.message)).join(" | "),{retry:!!tu.find(_g=>_g.error.data.retry),csIp:_d.detail[502],desc:[...new Set(tu.map(_g=>{var l_;return _g==null||(l_=_g.error)===null||l_===void 0||(l_=l_.data)===null||l_===void 0?void 0:l_.desc}).filter(_g=>!!_g))]})})(J);const ya=K2(J,TT.CHOOSE_SERVER),_l=K2(J,TT.CLOUD_PROXY_FALLBACK);return p9(ya),{gatewayInfo:n9(ya,y),proxyInfo:_l,opid:Q,requestTime:L,url:y,isHttp3:_,elapse:Date.now()-L}}catch(J){throw J}}(s,t,e),closeFn:s=>s.code===_i.OPERATION_ABORTED||s.code===_i.CAN_NOT_GET_GATEWAY_SERVER&&!s.data.retry})}catch(a){throw a}}async function prt(t,e,n,a){const s=aa("PROXY_SERVER_TYPE3"),d=(B,Q,X)=>{let J=X||s;return Array.isArray(J)&&(J=Q%2==0?s[1]:s[0]),"https://".concat(J,"/ap/?url=").concat(B)};let f=null;const m=[],_=async()=>{const B=aa("WEBCS_DOMAIN").slice(0,aa("AJAX_REQUEST_CONCURRENT")).map((J,_n)=>{let _r;return _r=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(J,"/api/v2/transpond/webrtc?v=2"),_n,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(J,"/api/v2/transpond/webrtc?v=2"):d("".concat(J,"/api/v2/transpond/webrtc?v=2"),_n),{url:_r,areaCode:J2(),serviceIds:[TT.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?TT.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?TT.CLOUD_PROXY:TT.CLOUD_PROXY_FALLBACK]}}),Q=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:B.map(J=>J.url)}),X=await Z2({fragementLength:aa("FRAGEMENT_LENGTH"),referenceList:B,asyncMapHandler:J=>(F.debug("[".concat(t.clientId,"] Connect to choose_server:"),J.url),srt(J,t,e,n)),allFailedhandler:J=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Q),J[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},Q),X},y=async()=>{if(await QT(1e3),f!==null)return f;const B=aa("WEBCS_DOMAIN_BACKUP_LIST").map((J,_n)=>{let _r;return _r=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(J,"/api/v2/transpond/webrtc?v=2"),_n,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(J,"/api/v2/transpond/webrtc?v=2"):d("".concat(J,"/api/v2/transpond/webrtc?v=2"),_n),{url:_r,areaCode:J2(),serviceIds:[TT.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?TT.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?TT.CLOUD_PROXY:TT.CLOUD_PROXY_FALLBACK]}}),Q=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:B.map(J=>J.url)}),X=await Z2({fragementLength:aa("FRAGEMENT_LENGTH"),referenceList:B,asyncMapHandler:J=>(F.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),J.url),srt(J,t,e,n)),allFailedhandler:J=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Q),J[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},Q),X};let T,w,L;try{({gatewayInfo:T,proxyInfo:w,url:L}=await E3([_(),y()]))}catch(B){throw B[0]}if(m.length&&m.forEach(B=>B.cancel&&typeof B.cancel=="function"&&B.cancel()),!T||!w)throw new _E(_i.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=L,t.cloudProxyServer!=="disabled"&&Array.isArray(s)&&L){const B=/^https?:\/\/(.+?)(\/.*)?$/.exec(L)[1];T_(s).call(s,B)&&(t.proxyServer=B,F.setProxyServer(B),V_.setProxyServer(B))}return f={gatewayInfo:T,proxyInfo:await Unt(w,T.uid)},f}async function Kpt(t,e,n){const a=aa("UAP_AP").slice(0,aa("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),s=a.map(d=>function(f,m,_,y){const T={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:aO,cname:m.cname,uid:m.uid.toString(),requestId:h9,seq:h9};h9+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(T)};return RI(async()=>{const L=await II(f,{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(L.code!==0){const Q=new _E(_i.UNEXPECTED_RESPONSE,"cross channel ap error, code"+L.code,{retry:!0});throw F.error(Q.toString()),Q}const B=JSON.parse(L.json_body);if(B.code!==200){const Q=new _E(_i.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(B.code,", reason: ").concat(B.reason));throw F.error(Q.toString()),Q}if(!B.servers||B.servers.length===0){const Q=new _E(_i.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw F.error(Q.toString()),Q}return{vid:B.vid,workerToken:B.workerToken,addressList:(aa("CHANNEL_MEDIA_RELAY_SERVERS")||B.servers).map(Q=>"wss://".concat(Q.address.replace(/\./g,"-"),".").concat(aa("WORKER_DOMAIN"),":").concat(Q.wss))}},void 0,L=>!!(L.code!==_i.OPERATION_ABORTED&&L.code!==_i.UNEXPECTED_RESPONSE||L.data&&L.data.retry),y)}(d,t,e,n));try{const d=await E3(s);return s.forEach(f=>f.cancel()),d}catch(d){throw d[0]}}async function Wpt(t,e,n){let a=null;const s=[],d=async f=>{const m=aa(f?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return f&&(await QT(1e3),a!==null)?a:await Z2({fragementLength:aa("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(F.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(f?"backup":""," choose_server:"),_),function(y,T,w,L){const[B]=Hpt(T,[TT.CHOOSE_SERVER]);let Q=ST.networkState;return RI(async()=>{Q&&ST.networkState===O0.OFFLINE&&ST.onlineWaiter&&await A_.race([ST.onlineWaiter,QT(L&&L.maxRetryTimeout||wT.maxRetryTimeout)]),Q=ST.networkState;const X=await II(y,{data:B,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return Gpt(X,y)},()=>!1,X=>X.code!==_i.OPERATION_ABORTED&&(X.code===_i.UPDATE_TICKET_FAILED?X.data.retry:(F.warning("[".concat(T.clientId,"] update ticket network error, retry"),X),!0)),L)}(_,t,e,n)),allFailedhandler:_=>{throw _[0]},promisesCollector:s})};try{return a=await E3([d(!1),d(!0)]),s.length&&s.forEach(f=>f.cancel&&typeof f.cancel=="function"&&f.cancel()),a}catch(f){throw f[0]}}function frt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function E9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?frt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):frt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}class Ypt extends eT{get isSuccess(){return!!this.configs}constructor(e,n){super(),_t(this,"configs",void 0),_t(this,"store",void 0),_t(this,"joinInfo",void 0),_t(this,"cancelToken",void 0),_t(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),_t(this,"interval",void 0),_t(this,"mutex",void 0),_t(this,"mutableParamsRead",!1),_t(this,"configCache",{}),_t(this,"limit_bitrate",void 0),this.mutex=new mR("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),aa("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},aa("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,V_.reportApiInvoke(null,{options:void 0,name:OT.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:oT.TRACER}).onSuccess(JSON.stringify(AI))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void F.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await zpt(this.joinInfo,this.cancelToken,this.retryConfig),F.debug("[config-distribute] get config distribute",JSON.stringify(e));const a=function(s){var d;const f=_2(d=Object.keys(s).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(d);for(let y=0;y<f.length;y++)for(let T=f.length-1;T>y;T--){const w=f[T],L=s[w].value;if(typeof L.__priority=="number"){const B=L.__priority,Q=f[T-1],X=s[Q].value;if(typeof X.__priority=="number"){if(!(B>X.__priority))continue;{const J=w;f[T]=f[T-1],f[T-1]=J}}else{const J=w;f[T]=f[T-1],f[T-1]=J}}}const m=Date.now();let _={};return f.forEach(y=>{const T=s[y].value.__expires;T&&T<=m||(_[y]=s[y])}),_}(e);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const s=new _E(_i.NETWORK_RESPONSE_ERROR,a);F.warning("[config-distribute] ".concat(s.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){Ant(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(H2.UPDATE_BITRATE_LIMIT,e):this.emit(H2.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&E9({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},a=Object.keys(e),s=[];a.forEach(d=>{const f=e[d].value;n[d]=f;const m=f.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const _=f.__type,y=e[d].value,T=e[d].tag;let w=0;_?_===Q$.REALTIME&&(w=1):Object.keys(y).some(L=>Object.prototype.hasOwnProperty.call(T7,L)||!K7()&&Object.prototype.hasOwnProperty.call(t8,L)?(w=1,!0):void 0),s.push({tag:T,isApplied:w,feature:d,params:JSON.stringify(f)})}),s.forEach(d=>{let{tag:f,feature:m,params:_,isApplied:y}=d;this.store.sessionId&&V_.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:f,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){F.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(s){const d={};return Object.keys(s).forEach(f=>{const m=s[f].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(T=>{T==="__id"||T==="__type"||T==="__priority"||T==="__expires"||Object.prototype.hasOwnProperty.call(d,T)||(d[T]=E9(E9({value:m[T]},_&&{expires:_}),y&&{type:y}))})}),d}(e);try{var a;const s=(a=n.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete n.LIMIT_BITRATE,s&&Ant(s)&&this.handleBitrateLimit(s),this.limit_bitrate=s,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:T,type:w,expires:L}=m[y];L&&L<=_||((w===Q$.REALTIME||Object.prototype.hasOwnProperty.call(T7,y))&&(AI[y]=T,qS[y]=T,F.debug("Update realtime parameters from config distribute",y,T)),w||K7()||!Object.prototype.hasOwnProperty.call(t8,y)||(AI[y]=T,qS[y]=T,F.debug("Update gateway parameters from config distribute",y,T)))})}catch(_){F.error("Error update config immediately: ".concat(m),_.message)}}(n);const d=JSON.stringify(n),f=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",f),F.debug("Caching global parameters ".concat(d))}catch(s){F.error("Error caching global parameters:",s.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(qS,a)){const{value:s,expires:d}=e[a];if(d&&d<=n)return;(function(f,m){try{return typeof f=="object"&&typeof m=="object"&&JSON.stringify(f)===JSON.stringify(m)}catch{return!1}})(qS[a],s)||(AI[a]=s,qS[a]=s,this.emit(H2.UPDATE_CLIENT_ROLE_OPTIONS,s),F.debug("Updating client role options: ".concat(JSON.stringify(s))))}})}catch(n){F.error("Error handling global parameter config:",n.message)}}}class Xpt extends eT{constructor(){super(...arguments),_t(this,"resultStorage",new Map)}setLocalAudioStats(e,n,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(a,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(a,n))}setLocalVideoStats(e,n,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(a,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(a,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(a))}setRemoteAudioStats(e,n){const a=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const a=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(n))}record(e,n,a){if(aa("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(e);if(s&&(s.result.push(a),s.result.length>=5)){var d;const f=T_(d=s.result).call(d,!0);s.isPrevNormal&&!f&&this.emit("exception",mrt[e],e,n),!s.isPrevNormal&&f&&this.emit("exception",mrt[e]+2e3,e+"_RECOVER",n),s.isPrevNormal=f,s.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof kT&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let a=null;n._encoderConfig&&n._encoderConfig.frameRate&&(a=w0(n._encoderConfig.frameRate));const s=e.captureFrameRate;return!a||!s||!(a>10&&s<5||a<10&&a>=5&&s<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof kT&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const mrt={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},_R=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const a=n[n.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const a=n[n.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function Ert(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function OM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ert(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ert(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}class Q2{constructor(e){_t(this,"store",void 0),_t(this,"onStatsException",void 0),_t(this,"onUploadPublishDuration",void 0),_t(this,"onStatsChanged",void 0),_t(this,"localStats",new Map),_t(this,"remoteStats",new Map),_t(this,"updateStatsInterval",void 0),_t(this,"trafficStats",void 0),_t(this,"trafficStatsPeerList",[]),_t(this,"uplinkStats",void 0),_t(this,"exceptionMonitor",void 0),_t(this,"p2pChannel",void 0),_t(this,"scalabilityMode",_q.L1T1),_t(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new Xpt,this.exceptionMonitor.on("exception",(n,a,s)=>{this.onStatsException&&this.onStatsException(n,a,s)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(u_.LocalAudioTrack)||OM({},w7)}getLocalVideoTrackStats(){return this.localStats.get(u_.LocalVideoTrack)||OM({},I7)}getRemoteAudioTrackStats(e){const n=(d,f)=>{if(!this.trafficStats)return f;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===d);return m&&(f.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),f},a={};if(e){var s;const d=(s=this.remoteStats.get(e))===null||s===void 0?void 0:s.audioStats;d&&(a[e]=n(e,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[f,{audioStats:m}]=d;m&&(a[f]=n(f,m))});return a}getRemoteNetworkQualityStats(e){const n={};if(e){var a;const s=(a=this.remoteStats.get(e))===null||a===void 0?void 0:a.networkStats;s&&(n[e]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[d,{networkStats:f}]=s;f&&(n[d]=f)});return n}getRemoteVideoTrackStats(e){const n=(d,f)=>{if(!this.trafficStats)return f;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===d);return m&&(f.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),f},a={};if(e){var s;const d=(s=this.remoteStats.get(e))===null||s===void 0?void 0:s.videoStats;d&&(a[e]=n(e,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[f,{videoStats:m}]=d;m&&(a[f]=n(f,m))});return a}getRTCStats(){let e=0,n=0,a=0,s=0;const d=this.localStats.get(u_.LocalAudioTrack);d&&(e+=d.sendBytes,n+=d.sendBitrate);const f=this.localStats.get(u_.LocalVideoTrack);f&&(e+=f.sendBytes,n+=f.sendBitrate);const m=this.localStats.get(u_.LocalVideoLowTrack);m&&(e+=m.sendBytes,n+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:T,videoStats:w}=y;T&&(a+=T.receiveBytes,s+=T.receiveBitrate),w&&(a+=w.receiveBytes,s+=w.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:n,SendBytes:e,RecvBytes:a,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var a;const s=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(n.peer_uid),d=s!=null&&s.videoSSRC?_R.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,f=s!=null&&s.audioSSRC?_R.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,d>f?d:f),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&F.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,a){if(!e)return!1;const s=!!a&&n.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||n.framesDecodeCount>a.framesDecodeCount;return s||!d}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[a,s]=n;switch(a){case u_.LocalVideoTrack:case u_.LocalVideoLowTrack:{const f=s,m=OM({},I7),_=e.getStats(),y=e.getLocalMedia(a);if(_){const T=_.videoSend.find(w=>w.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(T){const w=e.getLocalVideoSize(),L=e.getEncoderConfig(u_.LocalVideoTrack);T.codec!=="H264"&&T.codec!=="H265"&&T.codec!=="VP8"&&T.codec!=="VP9"&&T.codec!=="AV1X"&&T.codec!=="AV1"||(m.codecType=T.codec),m.sendBytes=T.bytes,m.sendBitrate=f?8*Math.max(0,m.sendBytes-f.sendBytes):0,T.inputFrame?(m.captureFrameRate=T.inputFrame.frameRate,m.captureResolutionHeight=T.inputFrame.height,m.captureResolutionWidth=T.inputFrame.width):w&&(m.captureResolutionWidth=w.width,m.captureResolutionHeight=w.height),T.sentFrame?(m.sendFrameRate=T.sentFrame.frameRate,m.sendResolutionHeight=T.sentFrame.height,m.sendResolutionWidth=T.sentFrame.width):w&&(m.sendResolutionWidth=w.width,m.sendResolutionHeight=w.height),T.avgEncodeMs&&(m.encodeDelay=T.avgEncodeMs),L&&L.bitrateMax&&(m.targetSendBitrate=1e3*L.bitrateMax),m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.totalDuration=f?f.totalDuration+1:1,m.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(T)&&(m.totalFreezeTime+=1),T.scalabilityMode&&this.scalabilityMode!==T.scalabilityMode&&(F.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(T.scalabilityMode)),this.scalabilityMode=T.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,m),((f==null?void 0:f.sendResolutionWidth)!==m.sendResolutionWidth||(f==null?void 0:f.sendResolutionHeight)!==m.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case u_.LocalAudioTrack:{const f=s,m=OM({},w7),_=e.getStats(),y=e.getLocalMedia(a);if(_){const T=_.audioSend.find(w=>w.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(T){if(T.codec!=="opus"&&T.codec!=="aac"&&T.codec!=="PCMU"&&T.codec!=="PCMA"&&T.codec!=="G722"||(m.codecType=T.codec),T.inputLevel)m.sendVolumeLevel=Math.round(32767*T.inputLevel);else{const w=e.getLocalAudioVolume();w&&(m.sendVolumeLevel=Math.round(32767*w))}m.sendBytes=T.bytes,m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.sendBitrate=f?8*Math.max(0,m.sendBytes-f.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(u_.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var a,s;let[d,{videoStats:f,audioStats:m,videoPcStats:_}]=n;const y=m,T=f,w=_,L=OM({},utt),B=OM({},ltt),Q=OM({},Lht),{audioTrack:X,videoTrack:J,audioSSRC:_n,videoSSRC:_r}=e.getRemoteMedia(d);let ya;ya=this.store.useP2P?e.getStats(!0):e.getStats();const _l=(a=ya)===null||a===void 0?void 0:a.audioRecv.find(l_=>l_.ssrc===_n),_d=(s=ya)===null||s===void 0?void 0:s.videoRecv.find(l_=>l_.ssrc===_r),tu=this.trafficStats&&this.trafficStats.peer_delay.find(l_=>l_.peer_uid===d);if(_l&&(_l.codec!=="opus"&&_l.codec!=="aac"&&_l.codec!=="PCMU"&&_l.codec!=="PCMA"&&_l.codec!=="G722"||(L.codecType=_l.codec),_l.outputLevel?L.receiveLevel=Math.round(32767*_l.outputLevel):X&&(L.receiveLevel=Math.round(32767*X.getVolumeLevel())),L.receiveBytes=_l.bytes,L.receivePackets=_l.packets,L.receivePacketsLost=_l.packetsLost,L.receivePacketsDiscarded=_l.packetsDiscarded,L.packetLossRate=L.receivePacketsLost/(L.receivePackets+L.receivePacketsLost),L.receiveBitrate=y?8*Math.max(0,L.receiveBytes-y.receiveBytes):0,L.totalDuration=y?y.totalDuration+1:1,L.totalFreezeTime=y?y.totalFreezeTime:0,L.freezeRate=L.totalFreezeTime/L.totalDuration,L.receiveDelay=_l.jitterBufferMs,L.totalDuration>10&&Q2.isRemoteAudioFreeze(X)&&(L.totalFreezeTime+=1)),_d){var _g;_d.codec!=="H264"&&_d.codec!=="H265"&&_d.codec!=="VP8"&&_d.codec!=="VP9"&&_d.codec!=="AV1X"&&_d.codec!=="AV1"||(B.codecType=_d.codec),B.receiveBytes=_d.bytes,B.receiveBitrate=T?8*Math.max(0,B.receiveBytes-T.receiveBytes):0,B.decodeFrameRate=_d.decodeFrameRate<0?0:_d.decodeFrameRate,B.renderFrameRate=_d.decodeFrameRate<0?0:_d.decodeFrameRate,_d.outputFrame&&(B.renderFrameRate=_d.outputFrame.frameRate),_d.receivedFrame?(B.receiveFrameRate=_d.receivedFrame.frameRate,B.receiveResolutionHeight=_d.receivedFrame.height,B.receiveResolutionWidth=_d.receivedFrame.width):J&&(B.receiveResolutionHeight=J._videoHeight||0,B.receiveResolutionWidth=J._videoWidth||0),_d.framesRateFirefox!==void 0&&(B.receiveFrameRate=Math.round(_d.framesRateFirefox)),B.receivePackets=_d.packets,B.receivePacketsLost=_d.packetsLost,B.packetLossRate=B.receivePacketsLost/(B.receivePackets+B.receivePacketsLost);const l_=T?T.totalFreezeTime:0,O_=T?T.totalDuration:0;B.totalDuration=T?T.totalDuration+1:1,B.totalFreezeTime=(_g=_d.totalFreezesDuration)!==null&&_g!==void 0?_g:l_||0,B.receiveDelay=_d.jitterBufferMs||0;const N_=!!_r&&e.getRemoteVideoIsReady(_r);_d.totalFreezesDuration===void 0&&J&&N_&&Q2.isRemoteVideoFreeze(J,_d,w)&&(B.totalFreezeTime+=1),B.freezeRate=Math.max(0,Math.min((B.totalFreezeTime-l_)/(B.totalDuration-O_),1))}tu&&(L.end2EndDelay=tu.B_ad,B.end2EndDelay=tu.B_vd,L.transportDelay=tu.B_ed,B.transportDelay=tu.B_ed,L.currentPacketLossRate=tu.B_ealr4/100,B.currentPacketLossRate=tu.B_evlr4/100,Q.uplinkNetworkQuality=tu.B_punq?tu.B_punq:0,Q.downlinkNetworkQuality=tu.B_pdnq?tu.B_pdnq:0),this.remoteStats.set(d,{audioStats:L,videoStats:B,videoPcStats:_d,networkStats:Q}),X&&this.exceptionMonitor.setRemoteAudioStats(X,L),J&&this.exceptionMonitor.setRemoteVideoStats(J,B)})}}class grt{constructor(){_t(this,"destChannelMediaInfos",new Map),_t(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Tnt(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Tnt(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){v8(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function _rt(t){if(!(t instanceof grt))return new _E(_i.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new _E(_i.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new _E(_i.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class jP{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){_t(this,"uid",void 0),_t(this,"_uintid",void 0),_t(this,"_trust_in_room_",!0),_t(this,"_trust_audio_enabled_state_",!0),_t(this,"_trust_video_enabled_state_",!0),_t(this,"_trust_audio_mute_state_",!0),_t(this,"_trust_video_mute_state_",!0),_t(this,"_audio_muted_",!1),_t(this,"_video_muted_",!1),_t(this,"_audio_enabled_",!0),_t(this,"_video_enabled_",!0),_t(this,"_audio_added_",!1),_t(this,"_video_added_",!1),_t(this,"_is_pre_created",!1),_t(this,"_video_pre_subscribed",!1),_t(this,"_audio_pre_subscribed",!1),_t(this,"_trust_video_stream_added_state_",!0),_t(this,"_trust_audio_stream_added_state_",!0),_t(this,"_audioTrack",void 0),_t(this,"_videoTrack",void 0),_t(this,"_dataChannels",[]),_t(this,"_audioSSRC",void 0),_t(this,"_videoSSRC",void 0),_t(this,"_audioOrtc",void 0),_t(this,"_videoOrtc",void 0),_t(this,"_cname",void 0),_t(this,"_rtxSsrcId",void 0),_t(this,"_videoMid",void 0),_t(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function vrt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function yrt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vrt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vrt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}const $2="9",brt=4e4;function Srt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function SL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Srt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Srt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}var g3=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(g3||{});const L8=new Map;function Trt(t,e,n,a){let{scale:s}=t;if(s===0&&a===g3.UP||s>=e.length-1&&a===g3.DOWN)return t;let d=SL(SL({},t),{},{scale:a===g3.DOWN?++s:--s});switch(n){case"maintain-framerate":d=SL(SL({},d),e[s].motion);break;case"maintain-resolution":d=SL(SL({},d),e[s].detail);break;case"balanced":d=SL(SL({},d),e[s].balanced)}return d}function Rrt(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:Art(e)};L8.set(t,n)}else L8.delete(t)}function Art(t){const e=SL({},t),{bitrateMax:n,frameRate:a,scaleResolutionDownBy:s,bitrateMin:d}=e,{MIN_FRAME_RATE:f,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:T,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:L,PERF_SCALE_DOWN_THRESHOLD:B,PERF_SCALE_UP_THRESHOLD:Q,BALANCE_BITRATE_FACTOR:X,BALANCE_FRAMERATE_FACTOR:J,BALANCE_RESOLUTION_FACTOR:_n,MOTION_RESOLUTION_FACTOR:_r,MOTION_BITRATE_FACTOR:ya,DETAIL_FRAMERATE_FACTOR:_l,DETAIL_BITRATE_FACTOR:_d}=b7,tu=Math.min(e.frameRate,m),_g=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(L,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(B,1)*tu),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:n,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:n,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:n,bitrateMin:d}}];for(let l_=1;l_<=_;l_++){const O_={bwe_up:Math.round(Math.pow(w,l_)*n),bwe_down:Math.round(Math.pow(L,l_+1)*n),fps_up:Math.round(Math.pow(Q,l_)*tu),fps_down:Math.round(Math.pow(B,l_+1)*tu)},N_={scaleResolutionDownBy:s/Math.pow(_n,l_),frameRate:Math.max(Math.round(Math.pow(J,l_)*a),f),bitrateMax:Math.max(Math.round(Math.pow(X,l_)*n),T),bitrateMin:Math.max(Math.round(Math.pow(X,l_)*d),y)},iS={scaleResolutionDownBy:s/Math.pow(_r,l_),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(ya,l_)*n),T),bitrateMin:Math.max(Math.round(Math.pow(ya,l_)*d),y)},oS={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_l,l_)*a),f),bitrateMax:Math.max(Math.round(Math.pow(_d,l_)*n),T),bitrateMin:Math.max(Math.round(Math.pow(_d,l_)*d),y)};_g.push({scale:l_,threshold:O_,balanced:N_,motion:iS,detail:oS})}return _g}function Jpt(t,e,n,a,s,d){const f=L8.get(t)||{overUse:0,underUse:0,adaptationList:Art(s)},{adaptationList:m}=f;L8.set(t,f);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=b7,{scale:T}=a;let w,L;return typeof e=="number"&&e>0&&function(B,Q,X,J){if(Q>=X.length)return!1;let{threshold:{fps_down:_n}}=X[Q];return aa("FORCE_AG_HIGH_FRAMERATE")&&J==="maintain-framerate"&&(_n=X[0].threshold.fps_down),B<_n}(e,T,m,d)&&(f.overUse++,L=U2.CPU,f.overUse>_)||typeof n=="number"&&n>0&&function(B,Q,X){if(Q>=X.length)return!1;const{threshold:{bwe_down:J}}=X[Q];return B<J}(n,T,m)&&(f.overUse++,L=U2.BANDWIDTH,f.overUse>_)?(f.overUse=0,f.underUse=0,w=Trt(a,m,d,g3.DOWN),[w,L]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(B,Q,X,J){if(Q===0)return;let{threshold:{fps_up:_n}}=X[Q];return aa("FORCE_AG_HIGH_FRAMERATE")&&J==="maintain-framerate"&&(_n=X[1].threshold.fps_up),B>_n}(e,T,m,d)&&function(B,Q,X){if(Q===0)return;const{threshold:{bwe_up:J}}=X[Q];return B>J}(n,T,m)&&(f.underUse++,f.underUse>y&&(f.overUse=0,f.underUse=0,w=Trt(a,m,d,g3.UP),w.scale===0&&(L=U2.NONE))),[w,L])}function Crt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function g9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Crt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Crt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function Zpt(t){var e;return!!aa("ENABLE_AG_ADAPTATION")&&!!(t instanceof j7||T_(e=t._hints).call(e,US.CUSTOM_TRACK))&&(!!aa("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const a=lS();if(a.os!==jT.IOS||!a.osVersion)return!1;const s=a.osVersion.split(".");return Number(s[0])>=n}(14)&&y$(17,4)||v$(14)&&b$(17,4,!0)))}const P8=new Map;function M8(t,e){const n=P8.get(t);if(n){const{timer:a}=n;window.clearTimeout(a),P8.delete(t)}e.qualityLimitationReason=U2.NONE,Rrt(t)}function Qpt(t,e){var n;let a;switch(e){case u_.LocalAudioTrack:a=bS.Audio;break;case u_.LocalVideoTrack:a=T_(n=t._hints).call(n,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalVideoLowTrack:a=bS.Low}return a}function _9(t){const e=pS();if(t.some(n=>n._bypassWebAudio))throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function v9(t,e){_9(t);const n=new kT;return t.forEach(a=>n.addAudioTrack(a)),n}const $pt=!pS().supportUnifiedPlan||aa("CHROME_FORCE_PLAN_B")&&hL();function x8(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return $pt?(n={spec:e,store:t},yL("PlanBConnection").create(n)):new CN(e,t)}function y9(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function Ort(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(P2(t.turnServer.servers))return!1;if(aa("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var cS;function wrt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function NI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wrt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wrt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}let CN=(cS=class HM extends Ont{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return T_(n=Object.keys(e8)).call(n,e)}))]}constructor(e,n){super(e,n),_t(this,"id",xS(5,"connection-")),_t(this,"store",void 0),_t(this,"peerConnection",void 0),_t(this,"forceTurn",!1),_t(this,"remoteSDP",void 0),_t(this,"initialOffer",void 0),_t(this,"transportEventReceiver",void 0),_t(this,"statsFilter",void 0),_t(this,"extension",{useXR:aa("USE_XR")}),_t(this,"localCapabilities",void 0),_t(this,"remoteCodecs",void 0),_t(this,"localCandidateCount",0),_t(this,"allCandidatesReceived",!1),_t(this,"isPreallocation",!1),_t(this,"preSSRCMap",new Map),_t(this,"dataStreamChannelMap",new Map),_t(this,"establishPromise",void 0),_t(this,"recoveredDataChannelIds",[]),_t(this,"currentDataChannelId",1),_t(this,"supportAV1RtpSpec",!1),_t(this,"mutex",void 0),_t(this,"qualityLimitationReason",U2.NONE),_t(this,"isFirstConnected",!1),this.store=n,this.forceTurn=Ort(e),this.mutex=new mR("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(HM.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=_7(this.peerConnection,aa("STATS_UPDATE_INTERVAL"),void 0,rT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const a=this.peerConnection.getTransceivers().find(s=>s.mid===n);if(a)return{transceiver:a,track:a.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void F.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const a=await this.peerConnection.createOffer(),s=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();s==null||s(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else F.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=xP(a.sdp),d=await Wnt({filterRTX:!aa("USE_PUB_RTX")&&!aa("USE_SUB_RTX"),filterVideoFec:aa("FILTER_VIDEO_FEC"),filterAudioFec:aa("FILTER_AUDIO_FEC"),filterVideoCodec:aa("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=w8(d),this.initialOffer=a,aa("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:_q.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const T=p0(y.sdp).mediaDescriptions[0];if(!T)return;const w=T.attributes.extmaps.find(L=>L.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),w}catch{return}}();var e;m&&(this.supportAV1RtpSpec=!0,(e=d.send)===null||e===void 0||e.videoExtensions.push(m))}let f;return a.sdp&&Znt(a.sdp)&&(f=aT(d),(n=f).send&&(h3(k_.VIDEO,n.send.videoExtensions),h3(k_.AUDIO,n.send.audioExtensions)),n.recv&&(h3(k_.VIDEO,n.recv.videoExtensions),h3(k_.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(h3(k_.VIDEO,n.sendrecv.videoExtensions),h3(k_.AUDIO,n.sendrecv.audioExtensions))),NI(NI({},s),{},{rtpCapabilities:f||d,offerSDP:a.sdp})}catch(a){throw new t_(_i.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&Znt(this.initialOffer.sdp)&&(n=e.rtpCapabilities,a=this.localCapabilities,n.send&&(A8(k_.VIDEO,n.send.videoExtensions,a.send.videoExtensions),A8(k_.AUDIO,n.send.audioExtensions,a.send.audioExtensions)),n.recv&&(A8(k_.VIDEO,n.recv.videoExtensions,a.recv.videoExtensions),A8(k_.AUDIO,n.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return aT(this._localCapabilities)}get rtpCapabilities(){return aT(this._rtpCapabilities)}get candidates(){return aT(this._candidates)}get iceParameters(){return aT(this._iceParameters)}get dtlsParameters(){return aT(this._dtlsParameters)}constructor(y){let T=arguments.length>1&&arguments[1]!==void 0&&arguments[1];_t(this,"sessionDesc",void 0),_t(this,"_localCapabilities",void 0),_t(this,"_rtpCapabilities",void 0),_t(this,"_candidates",void 0),_t(this,"_originCandidates",void 0),_t(this,"_iceParameters",void 0),_t(this,"_isUseExtmapAllowMixed",void 0),_t(this,"_dtlsParameters",void 0),_t(this,"setup",void 0),_t(this,"currentMidIndex",void 0),_t(this,"cname",void 0),_t(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=T,y=aT(y);const{iceParameters:w,dtlsParameters:L,candidates:B,rtpCapabilities:Q,setup:X,localCapabilities:J,cname:_n}=y;this._rtpCapabilities=Q,this._candidates=B,this._originCandidates=aT(B),this._iceParameters=w,this._dtlsParameters=L,this._localCapabilities=J,this.setup=X,this.cname=_n,this.sessionDesc=this.updateRemoteRTPCapabilities(Q),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const T=this.candidates,w=this.dtlsParameters,L=this.iceParameters,B=this.rtpCapabilities.send;let Q=this.sessionDesc.mediaDescriptions.length-1;for(let X=1;X<y;X++){const J=2*X+2e4,_n=2*X+brt,{ssrcs:_r,ssrcGroups:ya}=CM([{ssrcId:J}],this.cname),{ssrcs:_l,ssrcGroups:_d}=CM([{ssrcId:_n,rtx:aa("USE_SUB_RTX")?_n+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:$2,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.videoCodecs.map(tu=>tu.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:T,extmaps:B.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_l,ssrcGroups:_d,rtcpFeedbackWildcards:[],payloads:B.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++Q)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:$2,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.audioCodecs.map(tu=>tu.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:T,extmaps:B.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_r,ssrcGroups:ya,rtcpFeedbackWildcards:[],payloads:B.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++Q)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return DP(this.sessionDesc)}send(y,T,w,L){const{ssrcs:B,ssrcGroups:Q}=CM(T,this.cname,aa("SYNC_GROUP")?w:void 0),X=this.findPreloadMediaDesc(B);if(X){if(rT()&&this.firefoxSsrcMidMap.set(B[0].ssrcId,X.attributes.mid),L&&(L.twcc||L.remb)){const J=this.sessionDesc.mediaDescriptions.indexOf(X);return this.sessionDesc.mediaDescriptions[J]=this.mungSendMediaDesc(X,L),{mid:X.attributes.mid,needExchangeSDP:!0}}return{mid:X.attributes.mid,needExchangeSDP:!1}}{const J=this.findAvailableMediaIndex(y,B);let _n;return J===-1||J===1&&(aR()||function(){const _r=lS();return!(_r.name!==mS.CHROME||!_r.osVersion)&&Number(_r.version)<=90}()||aa("ENABLE_ENCODED_TRANSFORM")&&dL())||J===0&&aa("USE_SUB_RTX")||S$()?(_n=this.createOrRecycleSendMedia(y,B,Q,"sendonly",L),this.updateBundleMids()):(_n=aT(this.sessionDesc.mediaDescriptions[J]),_n.attributes.direction="sendonly",_n.attributes.ssrcs=B,_n.attributes.ssrcGroups=Q,this.sessionDesc.mediaDescriptions[J]=this.mungSendMediaDesc(_n,L)),rT()&&this.firefoxSsrcMidMap.set(B[0].ssrcId,_n.attributes.mid),{mid:_n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:T}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:T}}batchSend(y){const T=y.map(B=>{let{kind:Q,ssrcMsg:X,mslabel:J}=B;return this.send(Q,X,J)}),w=[];let L=!1;return T.forEach(B=>{let{mid:Q,needExchangeSDP:X}=B;X&&(L=!0),w.push(Q)}),{mids:w,needExchangeSDP:L}}stopSending(y){const T=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&y.indexOf(w.attributes.mid)!==-1);if(T.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");T.forEach(w=>{w.attributes.mid==="0"||rT()||S$()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(y){const T=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y);if(!T)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));T.attributes.direction="inactive"}unmute(y){const T=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y);if(!T)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));T.attributes.direction="sendonly"}muteRemote(y){const T=this.sessionDesc.mediaDescriptions.filter(w=>T_(y).call(y,w.attributes.mid||""));if(T.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(y){const T=this.sessionDesc.mediaDescriptions.filter(w=>T_(y).call(y,w.attributes.mid||""));if(T.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(w=>{w.attributes.direction="recvonly"})}receive(y,T,w,L){y.forEach((B,Q)=>{this.createOrRecycleRecvMedia(B,[],"recvonly",T,w,L[Q])}),this.updateBundleMids()}stopReceiving(y){const T=this.sessionDesc.mediaDescriptions.filter(w=>y.indexOf(w.attributes.mid)!==-1);if(T.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");T.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const T=this.sessionDesc||p0((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=y;const L=this.rtpCapabilities.send,B=this.localCapabilities.send;for(const Q of T.mediaDescriptions){if(Q.attributes.iceUfrag=this._iceParameters.iceUfrag,Q.attributes.icePwd=this._iceParameters.icePwd,Q.attributes.fingerprints=this._dtlsParameters.fingerprints,Q.attributes.candidates=this._candidates,Q.attributes.setup=this.setup,Q.media.mediaType==="application"&&(Q.attributes.sctpPort="5000"),Q.media.mediaType==="video"){if(L.videoCodecs.length===0){const X=B.videoCodecs.filter(J=>{var _n,_r;return(_n=J.rtpMap)===null||_n===void 0?void 0:T_(_r=_n.encodingName.toLowerCase()).call(_r,"vp8")})||[B.videoCodecs[0]];Q.media.fmts=X.map(J=>J.payloadType.toString(10)),Q.attributes.payloads=X,Q.attributes.extmaps=[]}else if(Q.media.fmts=L.videoCodecs.map(X=>X.payloadType.toString(10)),Q.attributes.payloads=L.videoCodecs,Q.attributes.extmaps=L.videoExtensions,aa("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:X,ssrcGroups:J}=CM([{ssrcId:brt,rtx:aa("USE_SUB_RTX")?40001:void 0}],this.cname);Q.attributes.ssrcs=X,Q.attributes.ssrcGroups=J}}if(Q.media.mediaType==="audio"){if(L.audioCodecs.length===0){const X=B.audioCodecs.filter(J=>{var _n,_r;return(_n=J.rtpMap)===null||_n===void 0?void 0:T_(_r=_n.encodingName.toLowerCase()).call(_r,"opus")})||[B.audioCodecs[0]];Q.media.fmts=X.map(J=>J.payloadType.toString(10)),Q.attributes.payloads=X,Q.attributes.extmaps=[]}else if(Q.media.fmts=L.audioCodecs.map(X=>X.payloadType.toString(10)),Q.attributes.payloads=L.audioCodecs,Q.attributes.extmaps=L.audioExtensions,f3(Q),aa("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:X,ssrcGroups:J}=CM([{ssrcId:2e4}],this.cname);Q.attributes.ssrcs=X,Q.attributes.ssrcGroups=J}}}return this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const T=this._originCandidates.filter(L=>L.transport==="udp"),w=[];if(T.forEach(L=>{w.push(yrt(yrt({},L),{},{foundation:"tcpcandidate",priority:Number(L.priority)-1+"",transport:"tcp",port:Number(L.port)+90+""}))}),T.length!==0){switch(y){case gR.TCP_RELAY:this._candidates=w;break;case gR.UDP_TCP_RELAY:case gR.RELAY:this._candidates=[...T,...w];break;default:this._candidates=T}for(const L of this.sessionDesc.mediaDescriptions)L.attributes.candidates=this.candidates}}restartICE(y){y=aT(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.iceUfrag=y.iceUfrag,T.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const T=[];for(let w=0;w<y;w++)T.push((this.currentMidIndex+w+1).toString(10));return T}findAvailableMediaIndex(y,T){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const L=w.media.mediaType===y&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(rT()){if(L){const B=this.firefoxSsrcMidMap.get(T[0].ssrcId);return!(B||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!B||B!==w.attributes.mid)}return!1}return L})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),T={media:{mediaType:"application",port:$2,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(T),{mediaDesc:T,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,T,w,L,B,Q){const X=y._mediaStreamTrack.kind,J=this.rtpCapabilities.recv,_n=Y2(X,J,this.localCapabilities.send,X===k_.VIDEO?L:B),_r=X===k_.VIDEO?J.videoExtensions:J.audioExtensions;this.currentMidIndex+=1;const ya="".concat(this.currentMidIndex);let _l={media:{mediaType:X,port:$2,protos:["UDP","TLS","RTP","SAVPF"],fmts:_n.map(tu=>tu.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_r,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_n,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ya)}};_l=this.mungRecvMediaDsec(_l,y,Q);const _d=this.findFirstClosedMedia(X);if(_d){const tu=this.sessionDesc.mediaDescriptions.indexOf(_d);this.sessionDesc.mediaDescriptions[tu]=_l}else this.sessionDesc.mediaDescriptions.push(_l);return _l}updateRemoteCodec(y,T,w){const L=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_l=>_l.rtpMap&&_l.rtpMap.encodingName.toLowerCase()||"").filter(_l=>{var _d;return T_(_d=Object.keys(e8)).call(_d,_l)}))],B=new Set(T);if(L.every(_l=>B.has(_l)))return F.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(T)),!1;const Q=this._rtpCapabilities.recv.videoCodecs.filter(_l=>T.some(_d=>{var tu;return T_(tu=_l.rtpMap&&_l.rtpMap.encodingName.toLowerCase()||"").call(tu,_d)}));if(Q.length===0)return F.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(L," codecs: ").concat(T)),!1;const X=[...new Set(Q.map(_l=>_l.rtpMap&&_l.rtpMap.encodingName.toLowerCase()||""))];let J;if(F.debug("updateRemoteCodec, from ".concat(L," to ").concat(X)),y.length===0)J=this.sessionDesc.mediaDescriptions.filter(_l=>_l.media.mediaType==="video"&&_l.attributes.direction==="recvonly");else if(J=this.sessionDesc.mediaDescriptions.filter(_l=>_l.attributes.mid&&T_(y).call(y,_l.attributes.mid)&&_l.attributes.direction==="recvonly"),J.length!==y.length)return F.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(T)),!1;if(aa("USE_PUB_RTX")||aa("USE_SUB_RTX")){const _l=a9(Q,this.rtpCapabilities.recv.videoCodecs);Q.push(..._l)}this._rtpCapabilities.recv.videoCodecs=Q;const _n=this.localCapabilities.send,_r=this.rtpCapabilities.recv,ya=Y2(k_.VIDEO,_r,_n,w);return J.forEach(_l=>{const _d=ya.map(tu=>tu.payloadType.toString(10));F.debug("updateRemoteCodec mid: ".concat(_l.attributes.mid,", from"),_l.attributes.payloads,"to",ya),_l.attributes.payloads=ya,_l.media.fmts=_d}),!0}createOrRecycleSendMedia(y,T,w,L,B){const Q=this.rtpCapabilities.send,X=y===k_.VIDEO?Q.videoCodecs:Q.audioCodecs,J=y===k_.VIDEO?Q.videoExtensions:Q.audioExtensions;this.currentMidIndex+=1;const _n="".concat(this.currentMidIndex);let _r={media:{mediaType:y,port:$2,protos:["UDP","TLS","RTP","SAVPF"],fmts:X.map(_l=>_l.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:J,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:X,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:L,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_n)}};_r=this.mungSendMediaDesc(_r,B);const ya=this.findFirstClosedMedia(y);if(ya){const _l=this.sessionDesc.mediaDescriptions.indexOf(ya);this.sessionDesc.mediaDescriptions[_l]=_r}else this.sessionDesc.mediaDescriptions.push(_r);return _r}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,T,w){const L=aT(y);return i9(L),p3(L,T),o9(L,T),znt(L),O8(L,w,this.localCapabilities.send),L}mungSendMediaDesc(y,T){const w=aT(y);return O8(w,T,this.localCapabilities.recv),f3(w),w}updateRecvMedia(y,T){const w=this.sessionDesc.mediaDescriptions.findIndex(L=>L.attributes.mid===y);if(w!==-1){const L=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],T);this.sessionDesc.mediaDescriptions[w]=L}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(T=>rT()?T.media.port==="0"&&T.media.mediaType===y:T.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(T=>{var w;return((w=T.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===y[0].ssrcId})}getSSRC(y){var T;return(T=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y))===null||T===void 0?void 0:T.attributes.ssrcs}}(NI(NI({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),d=Xnt(this.initialOffer.sdp,this.extension),f=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),f==null||f(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),aa("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(aa("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const T=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(T)}const{preSSRCs:_}=e;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(T=>({kind:T.kind,ssrcMsg:[{ssrcId:T.ssrcId,rtx:T.rtx}],mslabel:T.mslabel})));y.forEach((T,w)=>{this.preSSRCMap.set(_[w].ssrcId,T)}),await X2(this.peerConnection,this.remoteSDP,this.extension),F.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(s){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}var n,a}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:a}=e;if(Array.isArray(a)&&a.length>0){const{mids:s}=this.remoteSDP.batchSend(a.map(d=>Object.assign({},{kind:d.kind,ssrcMsg:[{ssrcId:d.ssrcId,rtx:d.rtx}],mslabel:d.mslabel})));s.forEach((d,f)=>{this.preSSRCMap.set(a[f].ssrcId,d)})}await X2(this.peerConnection,this.remoteSDP,this.extension),F.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,a){var s=this;return oO(function*(){const d=yield uS(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],m=R8();e.forEach(J=>{const _n=s.peerConnection.addTransceiver(J._mediaStreamTrack,NI({direction:"sendonly"},J.trackMediaType==="video"&&s.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));f.push(_n),J._updateRtpTransceiver(_n)}),rT()&&aa("SIMULCAST")===!0&&(yield uS(s.applySimulcastForFirefox(f,e)));const _=yield uS(s.peerConnection.createOffer()),y=s.remoteSDP.predictReceivingMids(e.length),T=s.mungSendOfferSDP(_.sdp,e,y),w=p0(T),L=y.map(J=>{const _n=w.mediaDescriptions.find(_r=>_r.attributes.mid===J);if(!_n)throw new Error("Cannot extract ssrc from mediaDescription.");return Gnt(_n,aa("USE_PUB_RTX"))});let B;try{B=yield L}catch(J){B=[],s.remoteSDP.receive(e,n,a,B);const _n=s.remoteSDP.toString();throw yield uS(s.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield uS(s.peerConnection.setRemoteDescription({type:"answer",sdp:_n})),yield uS(s.stopSending(y,!0)),J}s.remoteSDP.receive(e,n,a,B);const Q=s.remoteSDP.toString(),X=s.logSDPExchange(T,"offer","local","send");return yield uS(s.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield uS(s.applySimulcastEncodings(f,e)),yield uS(s.applySendEncodings(f,e)),X==null||X(Q),yield uS(s.peerConnection.setRemoteDescription({type:"answer",sdp:Q})),f.map((J,_n)=>{const _r=y[_n];return{localSSRC:L[_n],id:_r,transceiver:J}})}catch(f){throw f instanceof t_?f:new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{d()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(e);if(a&&a.readyState==="open")F.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:aa("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,a)}n.forEach(d=>{d._updateOriginDataChannel(a)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f),F.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else F.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof t_?a:new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof t_?n:new t_(_i.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const a=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(_=>e.indexOf(_.mid)!==-1);if(s.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(_=>{var y;M8(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const d=await this.peerConnection.createOffer(),f=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(e);const m=this.remoteSDP.toString();f==null||f(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(s){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{a&&a()}}async receive(e,n,a,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:d,needExchangeSDP:f}=this.remoteSDP.send(e,n,a,s);f&&(await X2(this.peerConnection,this.remoteSDP,this.extension),F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:a}=this.remoteSDP.batchSend(e);return a&&(await X2(this.peerConnection,this.remoteSDP,this.extension),F.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(s=>{const d=this.peerConnection.getTransceivers().find(f=>f.mid===s);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:s,transceiver:d}})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(d=>{Array.from(this.preSSRCMap.entries()).some(f=>{let[m,_]=f;if(_===d)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();a==null||a(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();a==null||a(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();a==null||a(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&e.indexOf(f.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(f=>{f.direction="inactive"});const a=await this.peerConnection.createOffer(),s=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(e);const d=this.remoteSDP.toString();s==null||s(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&e.indexOf(f.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(f,m)=>{f.direction="sendonly"});const a=await this.peerConnection.createOffer(),s=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();s==null||s(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return oO(function*(){const a=yield uS(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=pS().supportPCSetConfiguration,d=aa("FORCE_TURN_TCP")||n.forceTurn;if(e===gR.RELAY&&!s)return;if(s&&!d){const w=e===gR.RELAY?"relay":"all",L=n.peerConnection.getConfiguration();L.iceTransportPolicy!==w&&(F.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(L.iceTransportPolicy,"] to [").concat(w,"]")),L.iceTransportPolicy=w,n.peerConnection.setConfiguration(L))}n.remoteSDP.updateCandidates(e);const f=yield uS(n.peerConnection.createOffer({iceRestart:!0}));if(!f.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=xP(f.sdp),{remoteIceParameters:_}=yield m.iceParameters;n.remoteSDP.restartICE(_);const y=n.remoteSDP.toString(),T=n.logSDPExchange(f.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield uS(n.peerConnection.setLocalDescription(f)),T==null||T(y),yield uS(n.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(s){F.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(gR.TCP_RELAY),await X2(this.peerConnection,this.remoteSDP,this.extension)}catch(n){F.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{M8(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return NI(NI({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(a.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const d=this.remoteSDP.toString(),f=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),f==null||f(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new t_(_i.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(e,n){const a=this.peerConnection.getTransceivers().filter(s=>s.mid===e);a.length===1&&(this.isVP8Simulcast(n)?rT()||await this.applySimulcastEncodings(a,[n]):await this.applySendEncodings(a,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const a=this.peerConnection.getTransceivers().find(s=>s.mid===n);a&&await a.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:a,remote:s}=n.getSelectedCandidatePair();return{local:NI(NI({},yN),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:NI(NI({},yN),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const a="code: ".concat(e.errorCode,", message: ").concat(e.errorText),s=e.port?"local: ".concat(e.port):"";F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(e.url||"",", host_candidate:").concat(s)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,a)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},aa("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(P2(e.turnServer.servers)?n.iceServers=e.turnServer.servers:aa("NEW_TURN_MODE")&&n.iceServers?(aa("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...HM.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...HM.newTurnServerConfigToIceServers(e.turnServer.servers)),aa("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...HM.turnServerConfigToIceServers(e.turnServer.servers)),aa("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...HM.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),aa("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),aa("ENABLE_ENCODED_TRANSFORM")&&pS().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(a=>{a.security?a.tcpport&&n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(PP(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!aa("FORCE_TURN_TCP")&&n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(a=>{const s=aa("NEW_TURN_MODE");s===1?n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):s===2?n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):s===3?n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(PP(a.turnServerURL),":443?transport=tcp")}):s===4&&(n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(PP(a.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var s;n!=null&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,n.state))},n.onerror=s=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in s?s.error:s)};const a=n.iceTransport;a&&(a.onstatechange=()=>{const s=n==null?void 0:n.iceTransport.state;var d;s&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,s))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:s,remote:d}=a.getSelectedCandidatePair();F.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var a,s;if(n||(n=this.peerConnection.getSenders().find(J=>J.track===e._mediaStreamTrack)),!n)return F.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return F.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!pS().supportSetRtpSenderParameters)return F.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},f={};switch(e._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=function(X,J){return X.getTransceivers().find(_n=>_n.sender.track===J||_n.receiver.track===J)}(this.peerConnection,e._mediaStreamTrack),_=jht(e);if(Zpt(e)&&m&&n&&_&&this.getLocalVideoStats&&T_(a=["vp8","vp9"]).call(a,this.store.codec)){var y;const X=d.degradationPreference||(T_(y=e._hints).call(y,US.CUSTOM_TRACK)?aa("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(J,_n,_r,ya,_l,_d){if(M8(J,_r),_l(_n),ya!=="balanced"&&ya!=="maintain-framerate"&&ya!=="maintain-resolution")return;let tu=-1;Rrt(J,_n);const _g=window.setInterval(()=>{const O_=P8.get(J);if(!aa("ENABLE_AG_ADAPTATION")||!O_)return M8(J,_r),void _l(_n);const N_=_d();if(N_.sendPackets>0&&N_.OutgoingAvailableBandwidth>0){if(tu===-1)return void(tu=Date.now());if(Date.now()-tu<1e3)return;const iS=N_.sendFrameRate,oS=N_.OutgoingAvailableBandwidth,[jS,gT]=Jpt(J,iS,oS,O_.adaptationConfig,_n,ya);gT&&(_r.qualityLimitationReason=gT),jS&&O_.adaptationConfig.scale!==jS.scale&&(F.debug("[".concat(J,"] applyAdaptation: ").concat(_r.qualityLimitationReason,`
           sendFps `).concat(iS,", bwe ").concat(oS,", switch from ").concat(O_.adaptationConfig.scale," to ").concat(jS.scale," ")),O_.adaptationConfig=g9(g9({},O_.adaptationConfig),jS),_l(jS))}},aa("CHECK_LOCAL_STATS_INTERVAL")),l_=g9({},_n);P8.set(J,{timer:_g,adaptationConfig:l_,originConfig:_n,adaptationFunc:_l}),F.debug("[".concat(J,"] start adaptation, originConfig: ").concat(JSON.stringify(_n),", degradationPreference: ").concat(ya))})(this.id+m.mid,_,this,X,J=>{n&&this.updateAdaptation(n,J)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var T;const{bitrateMax:X,frameRate:J,scaleResolutionDownBy:_n}=e._encoderConfig;X&&(f.maxBitrate=1e3*X),(T_(T=e._hints).call(T,US.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(J&&(f.maxFramerate=w0(J)),_n&&_n>=1&&(f.scaleResolutionDownBy=_n))}const{maxFramerate:w}=aa("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(f.maxFramerate=f.maxFramerate?Math.min(f.maxFramerate,w):w),aa("DSCP_TYPE")&&hL()){var L;const X=aa("DSCP_TYPE");T_(L=["very-low","low","medium","high"]).call(L,X)&&(f.networkPriority=X)}const B=n.getParameters(),Q=(s=B.encodings)===null||s===void 0?void 0:s[0];rT()&&!Q&&(d.encodings=[f]),Q&&Object.assign(Q,f),Object.assign(B,d),F.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(B.encodings))),await n.setParameters(B),await async function(X,J,_n){try{var _r;if(!pS().supportSetRtpSenderParameters||!function(_g){return _g==="vp9"||_g==="av1"}(X)||!aa("ENABLE_SVC"))return;const ya={},_l={},_d=J.getParameters(),tu=(_r=_d.encodings)===null||_r===void 0?void 0:_r[0];_l.scalabilityMode=R8(_n),tu&&Object.assign(tu,_l),Object.assign(_d,ya),await J.setParameters(_d),F.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_d.encodings)))}catch(ya){F.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ya)}}(this.store.codec,n,aa("SVC_MODE"))}async updateAdaptation(e,n){var a,s;if(!e)return F.debug("[updateAdaptation] no rtpSender found");if(!pS().supportSetRtpSenderParameters)return F.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:f,frameRate:m,scaleResolutionDownBy:_}=n;f&&(d.maxBitrate=1e3*f),m&&(d.maxFramerate=w0(m)),_&&_>=1&&T_(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=_);const y=e.getParameters(),T=(s=y.encodings)===null||s===void 0?void 0:s[0];T&&Object.assign(T,d),Object.assign(y,{});try{await e.setParameters(y),F.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(w){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?F.debug("[updateAdaptation] peerConnection not connected}"):F.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):F.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!pS().supportSetRtpSenderParameters||e.length!==n.length)return;for(let a=0;a<e.length;a++){const s=e[a],d=n[a];d instanceof zS&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,s.sender)}}catch{F.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,a){const s=p0(e);return n.forEach((d,f)=>{const m=a[f],_=s.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(p3(_,d),Knt(_,d,this.store.codec))}),DP(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,a)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,e,n,a)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let _=0;_<e.length;_++){var a,s,d,f,m;const y=e[_],T=n[_];if(T instanceof zS&&!T_(a=T._hints).call(a,US.LOW_STREAM)&&(s=T._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((d=T._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(f=T._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},L={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:L.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:L.high}];const B=y.sender.getParameters();await y.sender.setParameters(Object.assign(B,w))}}}async applySimulcastEncodings(e,n){if(!rT()&&e.length===n.length)for(let a=0;a<e.length;a++){const s=n[a];if(s instanceof zS&&this.isVP8Simulcast(s)){const d=e[a],f={},m={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=d.sender.getParameters();await d.sender.setParameters(Object.assign(_,f))}}}isVP8Simulcast(e){var n,a,s,d,f;return!!(e instanceof zS&&aa("SIMULCAST")&&this.store.codec==="vp8"&&!T_(n=e._hints).call(n,US.LOW_STREAM)&&(a=e._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((s=e._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(d=e._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((f=e._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(e,n,a,s){if(aa("SDP_LOGGING"))return F.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(n," SDP during P2PConnection.").concat(s,`
`),e),n==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(pS().supportPCSetConfiguration){const n=HM.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},U_(cS.prototype,"updateRemoteRTPCapabilities",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"updateRemoteRTPCapabilities"),cS.prototype),U_(cS.prototype,"connect",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"connect"),cS.prototype),U_(cS.prototype,"updateRemoteConnect",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"updateRemoteConnect"),cS.prototype),U_(cS.prototype,"createDataChannels",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"createDataChannels"),cS.prototype),U_(cS.prototype,"receive",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"receive"),cS.prototype),U_(cS.prototype,"batchReceive",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"batchReceive"),cS.prototype),U_(cS.prototype,"stopReceiving",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"stopReceiving"),cS.prototype),U_(cS.prototype,"muteRemote",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"muteRemote"),cS.prototype),U_(cS.prototype,"unmuteRemote",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"unmuteRemote"),cS.prototype),U_(cS.prototype,"muteLocal",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"muteLocal"),cS.prototype),U_(cS.prototype,"unmuteLocal",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"unmuteLocal"),cS.prototype),U_(cS.prototype,"close",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"close"),cS.prototype),U_(cS.prototype,"updateEncoderConfig",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"updateEncoderConfig"),cS.prototype),U_(cS.prototype,"updateSendParameters",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"updateSendParameters"),cS.prototype),U_(cS.prototype,"replaceTrack",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"replaceTrack"),cS.prototype),U_(cS.prototype,"updateAdaptation",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"updateAdaptation"),cS.prototype),U_(cS.prototype,"getRemoteSSRC",[XR],Object.getOwnPropertyDescriptor(cS.prototype,"getRemoteSSRC"),cS.prototype),cS);function XR(t,e,n){const a=t[e];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,d=await s.lock("From P2PConnection.".concat(e));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await a.apply(this,m)}finally{d()}},n}function b9(t,e){let n=document.createElement("video"),a=document.createElement("canvas");n.setAttribute("style","display:none"),a.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),a.width=w0(e.width),a.height=w0(e.height);const s=w0(e.framerate||15);document.body.append(n),document.body.append(a);let d=t._mediaStreamTrack;n.srcObject=new MediaStream([d]),n.play();const f=a.getContext("2d");if(!f)throw new _E(_i.UNEXPECTED_ERROR,"can not get canvas context");const m=pS(),_=a.captureStream(m.supportRequestFrame?0:s).getVideoTracks()[0];_.canvas||(_.canvas=a),a.startCapture=()=>{if(!n)return a.stopCapture&&a.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const T=n.videoWidth,w=n.videoHeight/T,L=a.width*w;Math.abs(L-a.height)>=2&&(F.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(L)),a.height=L)}f.drawImage(n,0,0,a.width,a.height),_.requestFrame&&_.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,n.srcObject=new MediaStream([d]))},a.stopCapture=k7(()=>a.startCapture&&a.startCapture(),s);const y=_.stop;return _.stop=()=>{y.call(_),n&&(n.remove(),n.srcObject=null,n=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),F.debug("clean low stream renderer")},_}var U8=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(U8||{}),RT=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(RT||{}),wM=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(wM||{}),AT=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(AT||{}),IM=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(IM||{}),Irt=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(Irt||{}),ON=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(ON||{}),JR=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(JR||{}),Nrt=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(Nrt||{}),ZR=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(ZR||{}),j8=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(j8||{});const NM=1e3,DM=6,V8=3,tft=Math.max(DM,V8);function Y_(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function Drt(t){const e={[ZR.CONN_TYPE]:0,[ZR.RTT]:t.rtt,[ZR.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[ZR.CONN_TYPE]=1),n==="tcp"&&(e[ZR.CONN_TYPE]=3),n==="tls"&&(e[ZR.CONN_TYPE]=4);break}case"srflx":e[ZR.CONN_TYPE]=2;break;case"unknown":e[ZR.CONN_TYPE]=5;break;default:e[ZR.CONN_TYPE]=0}return e}function krt(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class Lrt extends eT{constructor(e){super(),_t(this,"store",void 0),_t(this,"uploadWRTCStatsTimer",void 0),_t(this,"uploadOutboundDenoiserStatsTimer",void 0),_t(this,"uploadExtStatsTimer",void 0),_t(this,"uploadExtUsageStatsTimer",void 0),_t(this,"uploadInboundExtStatsTimer",void 0),_t(this,"requestStats",void 0),_t(this,"requestTransportStats",void 0),_t(this,"requestLocalMedia",void 0),_t(this,"requestRemoteMedia",void 0),_t(this,"requestAllTracks",void 0),_t(this,"requestVideoIsReady",void 0),_t(this,"requestUploadStats",void 0),_t(this,"requestUpload",void 0),_t(this,"uploadOutboundStarted",!1),_t(this,"uploadInboundStarted",!1),_t(this,"uploadTransportStarted",!1),_t(this,"uploadBaseStatsStarted",!1),_t(this,"uploadExtensionUsageStarted",!1),_t(this,"lastRecvStats",void 0),_t(this,"lastSendStats",void 0),_t(this,"lastRefRecvStats",void 0),_t(this,"lastRefSendStats",void 0),_t(this,"lastFullRecvStats",void 0),_t(this,"lastFullSendStats",void 0),_t(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%V8==0,a=e%DM==0;let s,d;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),s||d){var f;const m={};if(this.uploadTransportStarted&&s){const y=this.getTransportStats(s,d,n);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&s){const y=this.getOutboundStats(s,a?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,a);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&d){const y=this.getInboundStats(d,a?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,a);y&&(m.inbound=y)}const _=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[j8.RTC_PEER_CONNECTION_STATE]=g7[_]):m.misc=[{addition:{[j8.RTC_PEER_CONNECTION_STATE]:g7[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=d,this.lastSendStats=s,a&&(this.lastFullRecvStats=d,this.lastFullSendStats=s),n&&(this.lastRefRecvStats=d,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,a;const s=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(s&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[j8.RTC_PEER_CONNECTION_STATE]:g7[s.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===tft+1&&(e=1)},NM)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,a){if(!this.requestStats)return;if(!a)return e.rtt==null?void 0:{addition:{[ZR.RTT]:e.rtt,[ZR.CONN_TYPE]:void 0,[ZR.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const s=Drt(e);if(this.store.useP2P){if(n){const d=Drt(n);s[ZR.CONN_TYPE]+=d[ZR.CONN_TYPE]<<3}s[ZR.CONN_TYPE]+=110}else s[ZR.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(e,n,a,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||d.length===0)return;let f,m,_;return d.forEach(y=>{let[T,{track:w,ssrcs:L}]=y;switch(T){case u_.LocalVideoLowTrack:case u_.LocalVideoTrack:if(T===u_.LocalVideoTrack){const B=function(J,_n,_r,ya,_l,_d){const tu=_n.videoSend.find(N_=>N_.ssrc===J);if(!tu)return;const _g={},{sentFrame:l_,inputFrame:O_}=tu;if(_d&&(Y_(_g,RT.QP_SUM,tu.qpSumPerFrame),O_&&l_)){const N_=O_.frameRate,iS=l_.frameRate;_g[RT.FREEZE]=function(oS,jS){let gT=!0;return gT=!(oS<=5)&&(oS<=10?jS<3:oS<=20?jS<4:jS<5),gT}(N_,iS)?1:0}if(_l){switch(l_&&(Y_(_g,RT.HEIGHT,l_.height),Y_(_g,RT.WIDTH,l_.width),Y_(_g,RT.FRAME_RATE,l_.frameRate)),_g[RT.DISABLED]=ya._originMediaStreamTrack&&!ya._originMediaStreamTrack.enabled||ya._mediaStreamTrack&&!ya._mediaStreamTrack.enabled?1:0,tu.adaptionChangeReason){case"none":_g[RT.ADAPTATION]=0;break;case"cpu":_g[RT.ADAPTATION]=1;break;case"bandwidth":_g[RT.ADAPTATION]=2;break;case"other":_g[RT.ADAPTATION]=3}let N_=0;tu.adaptionChangeReason&&(N_+=krt(tu.adaptionChangeReason)),_n.qualityLimitationReason&&(N_+=krt(_n.qualityLimitationReason)<<3),_g[RT.ADAPTATION]=N_,_g[RT.PLAYER_STATUS]=N7[ya._player?ya._player.videoElementStatus:"uninit"],Y_(_g,RT.NACKS,tu.nacksCount),Y_(_g,RT.PLIS,tu.plisCount),Y_(_g,RT.FIRS,tu.firsCount),Y_(_g,RT.AVG_ENCODE,tu.avgEncodeMs),Y_(_g,RT.HUGE_FRAME_SENT,tu.hugeFramesSent),Y_(_g,RT.BYTES_RETRANSMIT,tu.retransmittedBytesSent),Y_(_g,RT.PACKAGES_RETRANSMIT,tu.retransmittedPacketsSent),Y_(_g,RT.KEY_FRAMES_ENCODED,tu.keyFramesEncoded);const iS=_r&&_r.videoSend.find(oS=>oS.ssrc===J);if(iS){let oS=_l?NM:NM*DM;iS.timestamp&&tu.timestamp&&(oS=tu.timestamp-iS.timestamp),iS.packets!=null&&tu.packets!=null&&Y_(_g,RT.PACKAGE_RATE,1e3*(tu.packets-iS.packets)/oS),tu.packetsLost!=null&&iS.packetsLost!=null&&Y_(_g,RT.PACKAGE_LOST,tu.packetsLost-iS.packetsLost),iS.bytes!=null&&tu.bytes!=null&&Y_(_g,RT.BITRATE,8*(tu.bytes-iS.bytes)/oS)}}return _g}(L[0].ssrcId,e,n,w,a,s),Q=w&&function(J,_n,_r,ya){const _l=_n.videoSend.find(tu=>tu.ssrc===J);if(!_l)return null;const _d={};if(ya){const tu=_l.inputFrame,_g=tu&&tu.height||_r.videoHeight||0,l_=tu&&tu.width||_r.videoWidth||0,O_=tu&&tu.frameRate||0;Y_(_d,U8.HEIGHT,_g),Y_(_d,U8.WIDTH,l_),Y_(_d,U8.FRAME_RATE,O_)}return _d}(L[0].ssrcId,e,w,a),X=function(J,_n){const _r={};return _n&&(Y_(_r,RT.RETRANSMIT,J.bitrate.retransmit),Y_(_r,RT.TARGET_ENCODED,J.bitrate.targetEncoded),Y_(_r,RT.ACTUAL_ENCODED,J.bitrate.actualEncoded),Y_(_r,RT.TRANSMIT,J.bitrate.transmit),Y_(_r,RT.BANDWIDTH,J.sendBandwidth)),_r}(e,a);m=Object.assign({},B,Q,X)}else _=function(B,Q,X,J){const _n=Q.videoSend.find(ya=>ya.ssrc===B);if(!_n)return;const _r={};if(J){const ya=_n.sentFrame;if(ya&&(Y_(_r,wM.HEIGHT,ya.height),Y_(_r,wM.WIDTH,ya.width),Y_(_r,wM.FRAME_RATE,ya.frameRate)),X){const _l=X.videoSend.find(_d=>_d.ssrc===B);if(_l){let _d=NM*DM;_l.timestamp&&_n.timestamp&&(_d=_n.timestamp-_l.timestamp),_l.packets!=null&&_n.packets!=null&&Y_(_r,wM.PACKAGE_RATE,1e3*(_n.packets-_l.packets)/_d),_n.packetsLost!=null&&_l.packetsLost!=null&&Y_(_r,wM.PACKAGE_LOST,_n.packetsLost-_l.packetsLost),_l.bytes!=null&&_n.bytes!=null&&Y_(_r,wM.BITRATE,8*(_n.bytes-_l.bytes)/_d)}}}return _r}(L[0].ssrcId,e,n,a);break;case u_.LocalAudioTrack:f=w&&function(B,Q,X,J,_n){const _r=Q.audioSend.find(_l=>_l.ssrc===B);if(!_r)return;const ya={};if(_n){ya[ON.DISABLED]=J._originMediaStreamTrack&&!J._originMediaStreamTrack.enabled||J._mediaStreamTrack&&!J._mediaStreamTrack.enabled?1:0;const _l=100*J._source.getAccurateVolumeLevel(),_d=_r.inputLevel;if(_d!=null){const _g=Math.ceil(50*Math.log10(100*_d+1));Y_(ya,ON.LEVEL,_g)}Y_(ya,Irt.PCM_LEVEL,_l),Y_(ya,ON.AEC_RETURN_LOSS,_r.aecReturnLoss),Y_(ya,ON.AEC_RETURN_LOSS_ENH,_r.aecReturnLossEnhancement),Y_(ya,ON.BYTES_RETRANSMIT,_r.retransmittedBytesSent),Y_(ya,ON.PACKAGES_RETRANSMIT,_r.retransmittedPacketsSent),ya[ON.FREEZE]=0;const tu=X&&X.audioSend.find(_g=>_g.ssrc===B);if(tu){let _g=NM*DM;tu.timestamp&&_r.timestamp&&(_g=_r.timestamp-tu.timestamp),tu.bytes!=null&&_r.bytes!=null&&Y_(ya,ON.BITRATE,8*(_r.bytes-tu.bytes)/_g),tu.packets!=null&&_r.packets!=null&&Y_(ya,ON.PACKAGE_RATE,1e3*(_r.packets-tu.packets)/_g)}}return ya}(L[0].ssrcId,e,n,w,a)}}),{high:m,low:_,audio:f}}getInboundStats(e,n,a,s){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],f=[];return d.forEach(m=>{let[_,y]=m;const T={peer:_.uid};if(y.has(k_.VIDEO)&&_.videoTrack){const w=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,L=_.videoTrack?function(B,Q,X,J,_n,_r,ya,_l){const _d=Q.videoRecv.find(oS=>oS.ssrc===B);if(!_d)return;const tu={},{receivedFrame:_g,outputFrame:l_,decodeFrameRate:O_}=_d,N_=X&&X.videoRecv.find(oS=>oS.ssrc===B);if(Y_(tu,IM.FRAME_RATE_DECODE,O_),_d.framesRateFirefox&&Y_(tu,AT.FRAME_RATE,_d.framesRateFirefox),_g&&Y_(tu,AT.FRAME_RATE,_g.frameRate),Y_(tu,AT.FRAMES_DROPPED,_d.framesDroppedCount),Y_(tu,AT.BYTES_RETRANSMIT,_d.retransmittedBytesReceived),Y_(tu,AT.PACKAGES_RETRANSMIT,_d.retransmittedPacketsReceived),Y_(tu,AT.PACKAGES_DISCARDED,_d.packetsDiscarded),Y_(tu,AT.AVG_DECODE,_d.avgDecodeMs),Y_(tu,AT.AVG_PROCESSING_DELAY,_d.avgProcessingDelayMs),Y_(tu,AT.AVG_ASSEMBLY_TIME,_d.avgFramesAssembledFromMultiplePacketsMs),Y_(tu,AT.AVG_INTER_FRAME_DELAY,_d.avgInterFrameDelayMs),Y_(tu,AT.KEY_FRAMES_DECODED,_d.keyFramesDecoded),N_){const oS=Q.timestamp-X.timestamp||NM*(_l?DM:ya?V8:1);_d.packetsLost!=null&&N_.packetsLost!=null&&Y_(tu,AT.PACKAGE_LOST,_d.packetsLost-N_.packetsLost),N_.bytes!=null&&_d.bytes!=null&&Y_(tu,AT.BITRATE,8*(_d.bytes-N_.bytes)/oS),N_.packets!=null&&_d.packets!=null&&Y_(tu,AT.PACKAGE_RATE,1e3*(_d.packets-N_.packets)/oS)}if(_l&&(Y_(tu,AT.QP_SUM,_d.qpSumPerFrame),tu[AT.FREEZE]=_n&&Q2.isRemoteVideoFreeze(J,_d,N_)?1:0),ya){var iS;_g?(Y_(tu,AT.HEIGHT,_g.height),Y_(tu,AT.WIDTH,_g.width)):J&&(Y_(tu,AT.HEIGHT,J._videoHeight||0),Y_(tu,AT.WIDTH,J._videoWidth||0)),l_&&Y_(tu,IM.FRAME_RATE_OUTPUT,l_.frameRate);const oS=(iS=J._player)===null||iS===void 0?void 0:iS.rendFrameRate.toFixed(0);if(oS&&Y_(tu,IM.FRAME_RATE_RENDER,+oS),Y_(tu,AT.JITTER_BUFFER,_d.jitterBufferMs),Y_(tu,AT.CURRENT_DELAY,_d.currentDelayMs),Y_(tu,AT.FIRS,_d.firsCount),Y_(tu,AT.NACKS,_d.nacksCount),Y_(tu,AT.PLIS,_d.plisCount),J){tu[AT.DISABLED]=J._originMediaStreamTrack.enabled&&J._mediaStreamTrack.enabled?0:1;const jS=J._player;if(jS){const{freezeTimeCounterList:gT,renderFreezeAccTime:lT,videoElementStatus:$R}=jS;if(gT&&gT.length>0&&Y_(tu,IM.FREEZE_TIME,gT.splice(0,1)[0]),_r&&mL.visibility==="visible"&&$R===IR.PLAYING&&pS().supportRequestVideoFrameCallback){const i_=Math.min(6e3,lT);jS.renderFreezeAccTime=Math.max(0,lT-i_),Y_(tu,IM.FREEZE_TIME_RENDER,i_)}if(typeof _d.totalFreezesDuration=="number"){const i_=N_&&N_.totalFreezesDuration?_d.totalFreezesDuration-N_.totalFreezesDuration:_d.totalFreezesDuration;Y_(tu,IM.FREEZE_DURATION,1e3*i_)}}}if(tu[AT.PLAYER_STATUS]=N7[J._player?J._player.videoElementStatus:"uninit"],N_&&_d.totalInterFrameDelay!==void 0&&_d.totalSquaredInterFrameDelay!==void 0&&N_.totalInterFrameDelay!==void 0&&N_.totalSquaredInterFrameDelay!==void 0){const jS=_d.totalInterFrameDelay-N_.totalInterFrameDelay,gT=_d.totalSquaredInterFrameDelay-N_.totalSquaredInterFrameDelay,lT=_d.framesDecodeCount-N_.framesDecodeCount,$R=jS/lT*1e3,i_=Math.round(1e3*Math.sqrt((gT-Math.pow(jS,2)/lT)/lT));!isNaN(i_)&&$R+i_>Math.max(3*$R,$R+150)&&(tu[AT.I_FRAME_DELAY]=i_)}}return tu}(_._videoSSRC,e,n,_.videoTrack,w===!0,this.needUploadRenderFreezeTime,a,s):void 0;L&&(T.video=L)}if(y.has(k_.AUDIO)&&_.audioTrack){const w=_.audioTrack?function(L,B,Q,X,J,_n){const _r=B.audioRecv.find(tu=>tu.ssrc===L);if(!_r)return;const ya={},_l=Q&&Q.audioRecv.find(tu=>tu.ssrc===L);if(Y_(ya,JR.JITTER,_r.jitterMs),Y_(ya,JR.BYTES_RETRANSMIT,_r.retransmittedBytesReceived),Y_(ya,JR.PACKAGES_RETRANSMIT,_r.retransmittedPacketsReceived),Y_(ya,JR.PACKAGES_DISCARDED,_r.packetsDiscarded),Y_(ya,JR.AVG_PROCESSING_DELAY,_r.avgProcessingDelayMs),_l){const tu=B.timestamp-Q.timestamp||NM*(_n?DM:J?V8:1);_r.packets!=null&&_l.packets!=null&&Y_(ya,JR.PACKAGE_RATE,1e3*(_r.packets-_l.packets)/tu),J&&_l.bytes!=null&&_r.bytes!=null&&Y_(ya,JR.BITRATE,8*(_r.bytes-_l.bytes)/tu),_r.packetsLost!=null&&_l.packetsLost!=null&&Y_(ya,JR.PACKAGE_LOST,_r.packetsLost-_l.packetsLost)}if(_n){const{receivedFrames:tu,droppedFrames:_g}=_r;tu!=null&&_g!=null&&(ya[JR.FREEZE]=(_d=tu)===0||100*_g/_d>20?1:0)}var _d;if(J){const tu=100*X._source.getAccurateVolumeLevel(),_g=_r.outputLevel;if(_g!=null){const l_=Math.ceil(50*Math.log10(100*_g+1));Y_(ya,Nrt.LEVEL,l_)}if(Y_(ya,JR.PCM_LEVEL,tu),X&&(ya[JR.DISABLED]=X._originMediaStreamTrack.enabled&&X._mediaStreamTrack.enabled?0:1),Y_(ya,JR.JITTER_BUFFER,_r.jitterBufferMs),Y_(ya,JR.CURRENT_DELAY,_r.jitterBufferMs),ya[JR.PLAYER_STATUS]=N7[YR.getPlayerState(X.getTrackId())],_l){const l_=_r.concealedSamples-_l.concealedSamples;l_>0&&Y_(ya,JR.CONCEALED_SAMPLES,l_);const O_=_r.totalSamplesReceived-_l.totalSamplesReceived;O_>0&&Y_(ya,JR.TOTAL_SAMPLES_RECEIVED,O_)}}return ya}(_._audioSSRC,e,n,_.audioTrack,a,s):void 0;w&&(T.audio=w)}(T.video||T.audio)&&f.push(T)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,f}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof c8);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(G2.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,a]=e;a.has(k_.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}),a.has(k_.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),a={connectionInterval:aa("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let s=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of d)!y.muted&&y.enabled&&(s=s.concat(await y.getProcessorUsage()));const f=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,T]of f)T.has(k_.VIDEO)&&y.videoTrack&&(s=s.concat(await y.videoTrack.getProcessorUsage())),T.has(k_.AUDIO)&&y.audioTrack&&(s=s.concat(await y.audioTrack.getProcessorUsage()));if(s.length===0)return;a.details=function(y,T){const w={};for(const{id:X,value:J,level:_n,direction:_r}of y){var L;const ya=(L=T.get(X))!==null&&L!==void 0?L:0,_l=J===2?ya+aa("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ya;var B,Q;T.set(X,_l),w[X]?(J===2&&(w[X].value=J),_n>w[X].level&&(w[X].level=_n),_r==="remote"&&(w[X].remoteUidCount+=1),w[X].totalTs=(B=T.get(X))!==null&&B!==void 0?B:0):w[X]={value:J,level:_n,remoteUidCount:_r==="local"?0:1,totalTs:(Q=T.get(X))!==null&&Q!==void 0?Q:0}}return Object.keys(w).map(X=>{const{level:J,value:_n,totalTs:_r}=w[X];return{id:X,level:J,value:_n,totalTs:_r}})}(s,e);const m=Date.now(),_=m>n?m:n+1;this.requestUpload&&this.requestUpload(G2.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:_})},aa("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const eft=aa("ICE_RESTART_INTERVAL");let B8=new Map,_3=new Map,VP=[gR.UDP_TCP_RELAY,gR.TCP_RELAY,gR.RELAY],S9=aa("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&pS().supportPCSetConfiguration;function Prt(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=B8.get(t.id);n&&(window.clearTimeout(n),B8.delete(t.id));const a=_3.get(t.id);e&&a&&a.index===VP.length-1&&(F.debug("[".concat(t.id,"] reset ICE restart policy")),_3.delete(t.id))}function Mrt(t,e,n){if(B8.size===0&&_3.size===0&&(Array.isArray(aa("RESTART_SEQUENCE"))&&aa("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const T=m[y];if(m.filter(w=>w===T).length!==_.filter(w=>w===T).length)return!1}return!0}(VP,aa("RESTART_SEQUENCE"))&&(VP=aa("RESTART_SEQUENCE").filter(m=>{var _;if(T_(_=Object.values(gR)).call(_,m))return!0}),F.debug("use reconnection policy from config distribution, queues: ".concat(VP.join(" => ")))),S9=aa("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&pS().supportPCSetConfiguration),VP.length===0)return void n();let a,{index:s=0,type:d}=_3.get(t.id)||{};if(S9&&d===gR.RELAY)return void n();let f=d&&s>=VP.length-1;if(S9)d=gR.RELAY;else{if(f)return void n();d?(s++,d=VP[s]):(d=VP[0],s=0)}F.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(s)),e(d),_3.set(t.id,{index:s,type:d}),a=window.setTimeout(()=>Mrt(t,e,n),eft),B8.set(t.id,a)}var Bb;function xrt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function wN(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?xrt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xrt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}function Urt(t){var e,n,a,s=2;for(typeof Symbol<"u"&&(n=KY,a=Symbol.iterator);s--;){if(n&&(e=t[n])!=null)return e.call(t);if(a&&(e=t[a])!=null)return new F8(e.call(t));n="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function F8(t){function e(n){if(Object(n)!==n)return A_.reject(new TypeError(n+" is not an object."));var a=n.done;return A_.resolve(n.value).then(function(s){return{value:s,done:a}})}return F8=function(n){this.s=n,this.n=n.next},F8.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var a=this.s.return;return a===void 0?A_.resolve({value:n,done:!0}):e(a.apply(this.s,arguments))},throw:function(n){var a=this.s.return;return a===void 0?A_.reject(n):e(a.apply(this.s,arguments))}},new F8(t)}let t6=(Bb=class extends eT{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(H_.StateChange,e,this._state)}constructor(t,e){super(),_t(this,"isPlanB",void 0),_t(this,"store",void 0),_t(this,"statsUploader",void 0),_t(this,"connection",void 0),_t(this,"localTrackMap",new Map),_t(this,"remoteUserMap",new Map),_t(this,"localDataChannels",[]),_t(this,"remoteDataChannelMap",new Map),_t(this,"pendingLocalTracks",[]),_t(this,"pendingRemoteTracks",[]),_t(this,"pendingLocalDataChannels",[]),_t(this,"pendingRemoteDataChannels",[]),_t(this,"statsCollector",void 0),_t(this,"shouldForwardP2PCreation",void 0),_t(this,"iceFailedCount",0),_t(this,"dtlsFailedCount",0),_t(this,"mutex",void 0),_t(this,"_state",yS.Disconnected),_t(this,"_pcStatsUploadType",aa("NEW_ICE_RESTART")?vL.FIRST_CONNECTION:vL.OLD_FIRST_CONNECTION),_t(this,"_isStartRestartIce",!1),_t(this,"_restartTimer",void 0),_t(this,"_isTryConnecting",!1),_t(this,"_iceError",null),_t(this,"_forceTurn",!1),_t(this,"_isWaitPcToRePub",!1),_t(this,"handleMuteLocalTrack",async(n,a,s)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==yS.Connected)return void s(new t_(_i.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const f=this.filterTobeMutedTracks(n);if(f.length===0)return void a();const m=f.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(f.map(y=>{let[,{id:T}]=y;return T}));const _=this.createMuteMessage(f);await MS(this,H_.RequestMuteLocal,_),a()}catch(f){s(f)}finally{d()}}),_t(this,"handleUnmuteLocalTrack",async(n,a,s)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==yS.Connected)return void s(new t_(_i.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const f=this.filterTobeUnmutedTracks(n);if(f.length===0)return void a();const m=f.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!aa("DISABLE_DUAL_STREAM_USE_ENCODING")&&pS().supportDualStreamEncoding){const T=n._mediaStreamTrack.clone();y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}else{const T=b9(n,M2(this,H_.RequestLowStreamParameter));y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}await new A_((T,w)=>{this.handleReplaceTrack(y.track,T,w,!0)})}await this.connection.unmuteLocal(f.map(y=>{let[,{id:T}]=y;return T}));const _=this.createUnmuteMessage(f);await MS(this,H_.RequestUnmuteLocal,_),a()}catch(f){s(f)}finally{d()}}),_t(this,"handleUpdateVideoEncoder",async(n,a,s,d)=>{let f;d||(f=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(u_.LocalVideoTrack);if(!this.connection||!_||_.track!==n||this.state!==yS.Connected)return void a();const{id:y,track:T}=_;await this.connection.updateSendParameters(y,T),await this.connection.updateEncoderConfig(y,T),this.emit(H_.UpdateVideoEncoder,T),a()}catch(_){s(_)}finally{var m;(m=f)===null||m===void 0||m()}}),_t(this,"handleUpdateVideoSendParameters",async(n,a,s)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(u_.LocalVideoTrack);if(!this.connection||!f||f.track!==n||this.state!==yS.Connected)return void a();const{id:m,track:_}=f;await this.connection.updateSendParameters(m,_),a()}catch(f){s(f)}finally{d()}}),_t(this,"handleReplaceMixingTrack",async(n,a,s,d)=>{if(!this.connection||this.state!==yS.Connected)return void a();const f=v9([n]);let m;F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(f.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,f),a()}catch(y){s(y)}finally{var _;(_=m)===null||_===void 0||_()}}),_t(this,"handleReplaceTrack",async(n,a,s,d)=>{let f;F.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof d=="boolean"&&d||(f=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:w}]=T;return n===w});if(!this.connection||!y||this.state!==yS.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(n,y[1].id)),this.isPlanB){const T=y[1];T.id=n._mediaStreamTrack.id,this.localTrackMap.set(y[0],T)}if(y[0]===u_.LocalVideoTrack&&!aa("DISABLE_DUAL_STREAM_USE_ENCODING")&&pS().supportDualStreamEncoding){const T=this.localTrackMap.get(u_.LocalVideoLowTrack);if(T){const w=n._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=w,T.track._originMediaStreamTrack=w,await new A_((L,B)=>{this.handleReplaceTrack(T.track,L,B,!0)})}}a()}catch(y){s(y)}finally{var _;(_=f)===null||_===void 0||_()}}),_t(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),_t(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),_t(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),_t(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),_t(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new Lrt(this.store),this.bindStatsUploaderEvents(),this.mutex=new mR("P2PChannel-mutex",this.store.clientId),this.isPlanB=!pS().supportUnifiedPlan||aa("CHROME_FORCE_PLAN_B")&&hL(),this.shouldForwardP2PCreation=aa("FORWARD_P2P_CREATION")&&pS().supportPCSetConfiguration&&i7(),this.shouldForwardP2PCreation&&(this.connection=x8(this.store),this.emit(H_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=yS.New,this._forceTurn=Ort(t),F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(F.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=x8(this.store,t),this.emit(H_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new t_(_i.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=aa("NEW_ICE_RESTART")?vL.FIRST_CONNECTION:vL.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new t_(_i.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");aa("ENABLE_PREALLOC_PC")&&this.state===yS.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=yS.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(s=>{var d;let[f]=s;return T_(d=[u_.LocalVideoLowTrack,u_.LocalVideoTrack]).call(d,f)}),n=e.map(s=>{let[,{id:d}]=s;return d}),a=e.map(s=>{let[d]=s;return d});if(this.connection instanceof CN){if(V_.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!T_(t).call(t,this.store.codec)){const s=["vp9","vp8","h264"].find(d=>T_(t).call(t,d));s&&(this.store.codec=s,F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(s,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof CN&&this.connection.peerConnectionState!=="closed"&&T_(t=[yS.New,yS.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==yS.Connected){if(this.state===yS.Disconnected)throw new t_(_i.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var a;T_(a=this.pendingLocalDataChannels).call(a,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const a=Date.now();this.store.publish(n.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const a=Date.now();this.store.publish(n.id+"","datachannel",void 0,a)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var a=this;return oO(function*(){const s=yield uS(a.mutex.lock("From P2PChannel.publish"));try{var d;const f=a.connection&&T_(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==yS.Connected||f){if(a.state===yS.Disconnected)throw new t_(_i.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const _=t.filter(y=>a.pendingLocalTracks.indexOf(y)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(_),void(f&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,_R.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,e,n);if(m.length===0)return void(yield uS(a.tryToUnmuteAudio(t)));yield*xH(Urt(a.doPublish(a.connection,m)))}finally{s()}})()}doPublish(t,e){var n=this;return oO(function*(){e.forEach(L=>{let{track:B,type:Q}=L;const X=Date.now();n.store.publish(B.getTrackId(),Q===u_.LocalAudioTrack?"audio":"video",X)}),n.bindLocalTrackEvents(e);const a=e.map(L=>{let{track:B}=L;return B}),s=yield uS(t.send(a,n.store.codec,n.store.audioCodec)),d=(yield uS(s.next())).value,f=n.createGatewayPublishMessage(e,d);let m;try{m=yield f}catch(L){throw s.throw(L),(L==null?void 0:L.code)===_i.WS_ABORT&&e.forEach(B=>{let{track:Q}=B;n.pendingLocalTracks.indexOf(Q)===-1&&n.pendingLocalTracks.push(Q)}),n.unbindLocalTrackEvents(e),L}const _=n.mapPubResToRemoteConfig(f,m,a),y=(yield uS(s.next(_))).value;if(n.state===yS.Disconnected)throw new t_(_i.UNEXPECTED_ERROR,"PeerConnection already disconnected.");aa("ENABLE_VIDEO_SEI");const T=aa("ENABLE_ENCODED_TRANSFORM"),w=aa("ENABLE_AUDIO_METADATA");a.forEach(async L=>{const B=L.getRTCRtpTransceiver();if(!B||!T)return;const{interceptLocalVideoFrame:Q,interceptLocalAudioFrame:X}=I8();L.trackMediaType===k_.VIDEO?await Q(B.sender,L):L.trackMediaType===k_.AUDIO&&await X(B.sender,{metadata:w?()=>{const J=L.metadata.shift();return J&&J.value}:void 0})}),e.forEach(L=>{let{type:B}=L;n.statsCollector.addLocalStats(B)}),n.assignLocalTracks(e,y),n.statsUploader.startUploadOutboundStats(),e.forEach(L=>{let{track:B,type:Q}=L;const X=Date.now();n.store.publish(B.getTrackId(),Q===u_.LocalAudioTrack?"audio":"video",void 0,X)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof zS))return F.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=n,s=function(d,f){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=r9(d,f)),m.maxFramerate=d.framerate?w0(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m}(t,a);if(a._encoderConfig||(a._encoderConfig={}),e!==u_.LocalVideoLowTrack||!aa("DISABLE_DUAL_STREAM_USE_ENCODING")&&pS().supportDualStreamEncoding)s.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return F.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(f,m){const _=f.canvas;m.width&&(_.width=w0(m.width)),m.height&&(_.height=w0(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=k7(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},w0(m.framerate)))})(d,t)}s.maxBitrate!=null&&(a._encoderConfig.bitrateMax=s.maxBitrate/1e3),s.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=s.maxFramerate:a._encoderConfig.frameRate={max:s.maxFramerate}),F.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var e=this;return oO(function*(){if(!e.connection||e.state!==yS.Connected)return;const n=yield uS(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const s=e.localTrackMap.get(u_.LocalVideoTrack);if(!s)throw new t_(_i.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(u_.LocalVideoLowTrack))throw new t_(_i.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:e.getLowVideoTrack(s.track,t),type:u_.LocalVideoLowTrack}];if(yield*xH(Urt(e.doPublish(e.connection,d))),s.track.muted||!s.track.enabled){var a;const f=(a=e.localTrackMap.get(u_.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;f!==void 0&&(yield uS(e.connection.muteLocal([f])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(F.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await cR(this,H_.RequestRePublish,this.pendingLocalTracks),this.emit(H_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(F.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await cR(this,H_.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:a}=this.pendingRemoteTracks[e];(a!==k_.AUDIO||n._audio_added_&&n._audioSSRC)&&(a!==k_.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await cR(this,H_.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===k_.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(H_.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==yS.Connected)return void t.forEach(a=>{const s=this.pendingLocalTracks.indexOf(a);s!==-1&&this.pendingLocalTracks.splice(s,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(a=>a[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==yS.Connected)return void t.forEach(n=>{const a=this.pendingLocalDataChannels.indexOf(n);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const a=this.localDataChannels.indexOf(n);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==yS.Connected)return;const t=this.localTrackMap.get(u_.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[u_.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(a=>{let[,{id:s}]=a;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(a=>{let[s,{track:d}]=a;return{type:s,track:d}})),e.forEach(a=>{let[s]=a;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==yS.Connected)throw new t_(_i.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(a=>{var s;return!((s=this.remoteDataChannelMap.get(t))!==null&&s!==void 0&&s.get(a.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(a=>{var s;this.remoteDataChannelMap.has(t)?(s=this.remoteDataChannelMap.get(t))===null||s===void 0||s.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex(f=>{let{user:m,id:_}=f;return m.uid===t.uid&&_===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),n.map(a=>a.id)}async subscribe(t,e,n,a,s){var d;if(!this.connection||this.state!==yS.Connected)throw new t_(_i.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(e))return;let f,m,_;const y=this.connection.getPreMedia(n);if(y)F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),_=y.transceiver,f=y.track,m=y.id;else if(s){const L=s.find(Q=>{let{stream_type:X}=Q;return X===e});if(!L)throw new t_(_i.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const B=await this.connection.receive(e,L.ssrcs,String(t._uintid),L.attributes);this.connection instanceof CN&&(_=B.transceiver),f=B.track,m=B.id}else{const L=await this.connection.receive(e,[{ssrcId:n,rtx:a}],String(t._uintid),void 0);this.connection instanceof CN&&(_=L.transceiver),f=L.track,m=L.id}if(e===k_.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(f):(t._audioTrack=new o3(f,t.uid,t._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),_&&t._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(f):(t._videoTrack=new i3(f,t.uid,t._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),_&&t._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(t,t._videoTrack)),_&&aa("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:L,interceptRemoteAudioFrame:B}=I8();e==k_.VIDEO?await L(_.receiver,{onSei:aa("ENABLE_VIDEO_SEI")&&(Q=>{var X;return(X=t._videoTrack)===null||X===void 0?void 0:X._onSei(Q)})}):e==k_.AUDIO&&await B(_.receiver,{enableTopn:!!aa("ENABLE_AUDIO_TOPN"),enableMetadata:!!aa("ENABLE_AUDIO_METADATA"),onMetadata:Q=>{this.safeEmit(H_.AudioMetadata,Q)}})}const T=this.remoteUserMap.get(t);T?T.set(e,m):this.remoteUserMap.set(t,new Map([[e,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(L=>{let{user:B,kind:Q}=L;return B.uid===t.uid&&e===Q});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(H_.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==yS.Connected)throw new t_(_i.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(s=>{var d;let{user:f,mediaType:m}=s;return!((d=this.remoteUserMap.get(f))!==null&&d!==void 0&&d.has(m))});const e=[],n=new Map;t.forEach(s=>{if(!this.connection)return;const d=this.connection.getPreMedia(s.ssrcId);d?n.set(s.ssrcId,d):e.push(s)});const a=await this.connection.batchReceive(e.map(s=>{let{user:d,mediaType:f,ssrcId:m,rtxSsrcId:_}=s;return{kind:f,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(d._uintid)}}));e.forEach((s,d)=>{n.set(s.ssrcId,a[d])});for(const{user:s,mediaType:d,ssrcId:f}of t){const m=n.get(f);if(!m)return void F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(d,", ").concat(f));const{track:_,id:y,transceiver:T}=m;if(T&&aa("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:B,interceptRemoteAudioFrame:Q}=I8();d==k_.VIDEO?await B(T.receiver,{onSei:aa("ENABLE_VIDEO_SEI")&&(X=>{var J;return(J=s._videoTrack)===null||J===void 0?void 0:J._onSei(X)})}):d==k_.AUDIO&&await Q(T.receiver,{enableTopn:!!aa("ENABLE_AUDIO_TOPN"),enableMetadata:!!aa("ENABLE_AUDIO_METADATA"),onMetadata:X=>{this.safeEmit(H_.AudioMetadata,X)}})}if(d===k_.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(_):(s._audioTrack=new o3(_,s.uid,s._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),T&&s._audioTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(_):(s._videoTrack=new i3(_,s.uid,s._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),T&&s._videoTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(s,s._videoTrack)),aa("ENABLE_VIDEO_SEI")&&T){const{interceptRemoteVideoFrame:B,interceptRemoteAudioFrame:Q}=I8();d==k_.VIDEO?await B(T.receiver,{onSei:X=>{var J;(J=s._videoTrack)===null||J===void 0||J._onSei(X)}}):d==k_.AUDIO&&await Q(T.receiver)}const w=this.remoteUserMap.get(s);w?w.set(d,y):this.remoteUserMap.set(s,new Map([[d,y]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const L=this.pendingRemoteTracks.findIndex(B=>{let{user:Q,kind:X}=B;return Q.uid===s.uid&&d===X});L!==-1&&(this.pendingRemoteTracks.splice(L,1),this.emit(H_.MediaReconnectEnd,s.uid))}}async unsubscribe(t,e,n){const a=this.pendingRemoteTracks.filter(f=>{let{user:m,kind:_}=f;return e!==void 0?m.uid===t.uid&&e===_:m.uid===t.uid});if(a.forEach(f=>{const m=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===yS.Connected||n||a.forEach(f=>{let{kind:m}=f;var _;if(m===k_.AUDIO)(_=t._audioTrack)===null||_===void 0||_._destroy(),t._audioTrack=void 0;else if(m===k_.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==yS.Connected)return;const s=this.filterTobeUnSubscribedTracks(t,e);if(s.length===0)return;await this.connection.stopReceiving(s.map(f=>{let[,{id:m}]=f;return m}));const d=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(f=>{let[m,{kind:_}]=f;var y,T;if(_===k_.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===k_.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),n||((T=m._videoTrack)===null||T===void 0||T._destroy(),m._videoTrack=void 0);else if(_===k_.AUDIO){var w;this.unbindRemoteTrackEvents(m._audioTrack),!n&&((w=m._audioTrack)===null||w===void 0||w._destroy(),m._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,e){if(e.forEach(s=>{const d=this.pendingRemoteDataChannels.findIndex(f=>f.id===s.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(s=>{s._close()});const a=this.remoteDataChannelMap.get(t);return n.forEach(s=>{a&&a.delete(s.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(s=>s.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:s,mediaType:d}of t){const f=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return d!==void 0?_.uid===s.uid&&d===y:_.uid===s.uid});f.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),e=e.concat(f)}if(!this.connection||this.state!==yS.Connected)return void e.forEach(s=>{let{user:d,kind:f}=s;var m;if(f===k_.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(f===k_.VIDEO){var _;(_=d._videoTrack)===null||_===void 0||_._destroy(),d._videoTrack=void 0}});const n=LR(t).call(t,(s,d)=>{let{user:f,mediaType:m}=d;const _=this.filterTobeUnSubscribedTracks(f,m);return s.concat(_)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(s=>{let[,{id:d}]=s;return d}));const a=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(s=>{let[d,{kind:f}]=s;var m,_;if(f===k_.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),f===k_.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(_=d._videoTrack)===null||_===void 0||_._destroy(),d._videoTrack=void 0;else if(f===k_.AUDIO){var y;this.unbindRemoteTrackEvents(d._audioTrack),(y=d._audioTrack)===null||y===void 0||y._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(t){return!this.connection||this.state!==yS.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void F.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const a=e===k_.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||F.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(u_.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(u_.LocalAudioTrack);if((e==null?void 0:e.track)instanceof kT){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[s]=a;return s!==u_.LocalAudioTrack}).filter(a=>{let[s]=a;return!(t&&s===u_.LocalVideoLowTrack)}).map(a=>{let[,{track:s}]=a;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[a]=n;return!(t&&a===u_.LocalVideoLowTrack)}).map(n=>{let[,{track:a}]=n;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,a,s){if(t){const f=this.localTrackMap.get(u_.LocalAudioTrack),m=a?this.localTrackMap.get(u_.LocalVideoLowTrack):this.localTrackMap.get(u_.LocalVideoTrack);V_.publish(this.store.sessionId,{eventElapse:_R.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(US.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var d;n||(n=[]);const f=n.find(_=>_ instanceof uT),m=a?(d=this.localTrackMap.get(u_.LocalVideoTrack))===null||d===void 0?void 0:d.track:n.find(_=>_ instanceof zS);V_.publish(this.store.sessionId,{eventElapse:_R.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:f==null?void 0:f.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(US.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(t,e,n,a){const s=a===k_.VIDEO?n._videoSSRC:n._audioSSRC;s&&V_.subscribe(this.store.sessionId,{succ:t,ec:e,video:a===k_.VIDEO,audio:a===k_.AUDIO,peerid:n.uid,subscribeRequestid:s,p2pid:this.store.p2pId,eventElapse:_R.measureFromSubscribeStart(this.store.clientId,s),preSsrc:this.isPreSubScribe(s)})}reset(){F.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new mR("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=x8(this.store),this.emit(H_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(u_.LocalAudioTrack);if((t==null?void 0:t.track)instanceof kT){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=yS.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(u_.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(u_.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof zS||e&&e.track instanceof uT?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(V0(e=this.remoteUserMap).call(e)).find(a=>a.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[a]=n;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(u_.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=_2(t).call(t,(n,a)=>n.level-a.level),t}async disconnectForReconnect(){this.connection&&(F.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=yS.Reconnecting,aa("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=x8(this.store),this.emit(H_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:a}]=t;switch(n){case u_.LocalVideoTrack:T_(e=a._hints).call(e,US.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case u_.LocalAudioTrack:a instanceof kT?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case u_.LocalVideoLowTrack:}}),this.emit(H_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(V0(n).call(n)).forEach(a=>{this.setPendingRemoteMedia(e,a)}),this.emit(H_.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(V0(n).call(n)).forEach(a=>{this.setPendingRemoteDataChannel(e,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),F.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:a,id:s}=n;if((t instanceof jP?t.uid:t)===a.uid&&s===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:a,kind:s}=n;if((t instanceof jP?t.uid:t)===a.uid&&e===s)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return oO(function*(){if(!e.connection||e.state!==yS.Connected)return;const n=yield uS(e.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield uS(e.connection.restartICE(t));const d=yield uS(a.next());if(d.done)return;const f=d.value,m=yield f;switch(y9(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case gR.UDP_TCP_RELAY:e._pcStatsUploadType=vL.UDP_TCP_RESTART;break;case gR.TCP_RELAY:e._pcStatsUploadType=vL.TCP_RESTART;break;case gR.RELAY:e._pcStatsUploadType=vL.RELAY_RESTART;break;default:e._pcStatsUploadType=vL.OLD_RESTART}e._isTryConnecting=!0,a.next(m)}catch(d){var s;(s=a)===null||s===void 0||s.throw(d)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(u_.LocalVideoTrack),n=this.localTrackMap.get(u_.LocalAudioTrack),a=t.videoSend.find(B=>B.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),s=t.audioSend.find(B=>B.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!a||!s)return 1;const d=U0(this,H_.NeedSignalRTT),f=a?a.rttMs:void 0,m=s?s.rttMs:void 0,_=f&&m?(f+m)/2:f||m,y=(_&&d?(_+d)/2:_||d)||0,T=100*t.sendPacketLossRate*.7/50+.3*y/1500,w=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,L=e==null?void 0:e.track;if(L&&L._encoderConfig&&L._hints.indexOf(US.SCREEN_TRACK)===-1){const B=L._encoderConfig.bitrateMax,Q=t.bitrate.actualEncoded;if(B&&Q){const X=(1e3*B-Q)/(1e3*B);return gnt[X<.15?0:X<.3?1:X<.45?2:X<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[a]=n;const s=a._audioSSRC,d=a._videoSSRC,f=t.audioRecv.find(Q=>Q.ssrc===s),m=t.videoRecv.find(Q=>Q.ssrc===d);if(!f&&!m)return void(e+=1);const _=U0(this,H_.NeedSignalRTT),y=t.rtt,T=(y&&_?(y+_)/2:y||_)||0,w=f?f.jitterMs:void 0,L=t.recvPacketLossRate;let B=.7*L*100/50+.3*T/1500;w&&(B=.6*L*100/50+.2*T/1500+.2*w/400),e+=B<.1?1:B<.17?2:B<.36?3:B<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new A_((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(F.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==yS.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:f}]=d;return t===f});if(!a)return;const s=a[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:s}]),this.bindLocalTrackEvents([{track:e,type:s}]),a[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,a[1].id)),this.isPlanB){const d=a[1];d.id=e._mediaStreamTrack.id,this.localTrackMap.set(s,d)}if(s===u_.LocalVideoTrack&&!aa("DISABLE_DUAL_STREAM_USE_ENCODING")&&pS().supportDualStreamEncoding){const d=this.localTrackMap.get(u_.LocalVideoLowTrack);if(d){const f=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=f,d.track._originMediaStreamTrack=f,await new A_((m,_)=>{this.handleReplaceTrack(d.track,m,_,!0)})}}}filterTobePublishedTracks(t,e,n){const a=[],s=this.getAllTracks();t=KV(t=t.filter(_=>s.indexOf(_)===-1));let d,f=!1;const m=this.localTrackMap.get(u_.LocalAudioTrack);for(const _ of t){if(_ instanceof zS&&(this.localTrackMap.has(u_.LocalVideoTrack)||f?new t_(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:_,type:u_.LocalVideoTrack}),f=!0),e)){const y=this.getLowVideoTrack(_,n);a.push({track:y,type:u_.LocalVideoLowTrack})}if(_ instanceof uT)if(m){const y=m.track;if(y instanceof kT)_9([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const T=v9([y,_]);F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(T.getTrackId(),"]")),this.replaceTrack(y,T)}}else d instanceof kT?(_9([_]),d.addAudioTrack(_)):d||!_._useAudioElement&&pS().webAudioMediaStreamDest&&!_._bypassWebAudio?d=v9(d?[_,d]:[_]):d=_}return d&&(F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:u_.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=KV(t=t.filter(a=>n.indexOf(a)!==-1));for(const a of t){if(a instanceof uT){const s=this.localTrackMap.get(u_.LocalAudioTrack);if(!s)continue;s.track instanceof kT?(s.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),s.track.trackList.length===0&&(e.push([u_.LocalAudioTrack,s]),s.track.close())):e.push([u_.LocalAudioTrack,s])}if(a instanceof zS){const s=this.localTrackMap.get(u_.LocalVideoTrack);if(!s)continue;e.push([u_.LocalVideoTrack,s]);const d=this.localTrackMap.get(u_.LocalVideoLowTrack);d&&e.push([u_.LocalVideoLowTrack,d])}}return e}filterTobePublishedDataChannels(t){return t=(t=KV(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=KV(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:a}=e;switch(a){case u_.LocalVideoTrack:n.addListener(M_.GET_STATS,this.handleGetLocalVideoStats),n.addListener(M_.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(M_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(M_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case u_.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case u_.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof kT?t.trackList.forEach(n=>{n.addListener(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(M_.GET_STATS,this.handleGetLocalAudioStats),n.addListener(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(M_.GET_STATS,this.handleGetLocalAudioStats),t.addListener(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(M_.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:a}]=e;return{track:a,type:n}})),t.forEach(e=>{let{track:n,type:a}=e;switch(a){case u_.LocalVideoTrack:n.off(M_.GET_STATS,this.handleGetLocalVideoStats),n.off(M_.GET_RTC_STATS,this.handleGetRTCStats),n.off(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(M_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(M_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case u_.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case u_.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof kT?t.trackList.forEach(e=>{e.off(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(M_.GET_STATS,this.handleGetLocalAudioStats),e.off(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(M_.GET_STATS,this.handleGetLocalAudioStats),t.off(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(M_.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof i3&&e.addListener(M_.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof o3&&e.addListener(M_.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(M_.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(k_.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(k_.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,a)=>{var s;let d,f,{track:m,type:_}=n;switch(_){case u_.LocalAudioTrack:d=bS.Audio,f={dtx:m instanceof c8&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case u_.LocalVideoTrack:d=T_(s=m._hints).call(s,US.SCREEN_TRACK)?bS.Screen:bS.High,f=wN(wN({},Mnt(m)),{},{codec:this.store.codec,svc_mode:R8()});break;case u_.LocalVideoLowTrack:d=bS.Low,f=wN(wN({},Mnt(m)),{},{codec:this.store.codec,svc_mode:R8()})}return{stream_type:d,attributes:f,ssrcs:e[a]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let a,[s,{track:d,ssrcs:f,id:m}]=e;switch(s){case u_.LocalVideoTrack:a=T_(n=d._hints).call(n,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalAudioTrack:a=bS.Audio;break;case u_.LocalVideoLowTrack:a=bS.Low}return{stream_type:a,ssrcs:f,mid:m}})}assignLocalTracks(t,e){t.forEach((n,a)=>{let{track:s,type:d}=n;this.localTrackMap.set(d,{track:s,id:e[a].id,ssrcs:e[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(H_.PeerConnectionStateChange,e),e==="connecting"&&t instanceof CN&&!rT()&&aa("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},aa("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof CN&&Prt(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=vL.DISCONNECTED_OR_FAILED,U0(this,H_.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(s=>s.getTrackId()),a=this.pendingLocalDataChannels.map(s=>"dc_".concat(s.id));V_.reportApiInvoke(this.store.sessionId,{name:OT.REPUB_AFTER_PC_CONNECTED,options:n.concat(a),tag:oT.TRACER}).onSuccess(),this.republish()}if(aa("NEW_ICE_RESTART")&&t instanceof CN&&!rT()&&!this._forceTurn){if(T_(wnt).call(wnt,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=s=>{y9(t)&&(F.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(s)),U0(this,H_.QueryClientConnectionState)==="CONNECTED"&&this.emit(H_.RequestRestartICE,s))},a=()=>{y9(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),F.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(H_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{Mrt(t,n,a)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&aa("ICE_RESTART")&&U0(this,H_.QueryClientConnectionState)==="CONNECTED"&&this.emit(H_.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(H_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(H_.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),V_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:oT.TRACER}).onSuccess(),this.emit(H_.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const a=Array.from(V0(n=this.remoteUserMap).call(n)).find(d=>d._audioSSRC===e);var s;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(s=a.audioTrack)===null||s===void 0||s.emit(_B.FIRST_FRAME_DECODED),V_.firstRemoteFrame(this.store.sessionId,VT.FIRST_AUDIO_DECODE,JS.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const a=Array.from(V0(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);a&&V_.firstRemoteFrame(this.store.sessionId,VT.FIRST_AUDIO_RECEIVED,JS.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,a)=>{this.reportVideoFirstFrameDecoded(e,n,a)},t.onFirstVideoReceived=e=>{var n;const a=Array.from(V0(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===e);a&&V_.firstRemoteFrame(this.store.sessionId,VT.FIRST_VIDEO_RECEIVED,JS.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const a=e.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&a===s||this.emit(H_.ConnectionTypeChange,a),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(MP(n))," -> ").concat(JSON.stringify(MP(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(MP(n))," -> ").concat(JSON.stringify(MP(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return wN(wN({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof CN&&function(e){_3.delete(e.id),Prt(e)}(t),t.close(),this.emit(H_.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(u_.LocalAudioTrack);if(t instanceof uT&&(n==null?void 0:n.track)instanceof kT)return n.track.isActive||e.push([u_.LocalAudioTrack,n]),e;const a=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:d}]=s;return t===d});if(a&&(e.push(a),a[0]===u_.LocalVideoTrack)){const s=this.localTrackMap.get(u_.LocalVideoLowTrack);s&&e.push([u_.LocalVideoLowTrack,s])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(u_.LocalAudioTrack);if(t instanceof uT&&(n==null?void 0:n.track)instanceof kT)return n.track.isActive&&e.push([u_.LocalAudioTrack,n]),e;const a=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:d}]=s;return t===d});if(a)if(a[0]===u_.LocalVideoTrack){e.push(a);const s=this.localTrackMap.get(u_.LocalVideoLowTrack);s&&e.push([u_.LocalVideoLowTrack,s])}else e.push(a);return e}createMuteMessage(t){return t.map(e=>{var n;let a,[s,{track:d,ssrcs:f,id:m}]=e;switch(s){case u_.LocalAudioTrack:a=bS.Audio;break;case u_.LocalVideoTrack:a=T_(n=d._hints).call(n,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalVideoLowTrack:a=bS.Low}return{stream_type:a,ssrcs:f,mid:m}})}createUnmuteMessage(t){return t.map(e=>{var n;let a,[s,{track:d,ssrcs:f,id:m}]=e;switch(s){case u_.LocalAudioTrack:a=bS.Audio;break;case u_.LocalVideoTrack:a=T_(n=d._hints).call(n,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalVideoLowTrack:a=bS.Low}return{stream_type:a,ssrcs:f,mid:m}})}filterTobeUnSubscribedTracks(t,e){const n=[],a=this.remoteUserMap.get(t);if(!a)return n;if(e){const s=a.get(e);if(!s)return n;n.push([t,{kind:e,id:s}])}else Array.from(a.entries()).forEach(s=>{let[d,f]=s;n.push([t,{kind:d,id:f}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(a=>{var s;(s=this.remoteDataChannelMap.get(t))!==null&&s!==void 0&&s.has(a.id)&&n.push(a)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[a,{kind:s,id:d}]=n;switch(s){case k_.VIDEO:return void(a._videoSSRC&&e.push({stream_type:k_.VIDEO,ssrcId:a._videoSSRC}));case k_.AUDIO:return void(a._audioSSRC&&e.push({stream_type:k_.AUDIO,ssrcId:a._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[a,{kind:s}]=n;if(e.has(a)){let d=e.get(a);s===k_.VIDEO?d|=BT.Video:d|=BT.Audio,e.set(a,d)}else s===k_.VIDEO?e.set(a,BT.Video):e.set(a,BT.Audio)}),{users:Array.from(e.entries()).map(n=>{let[a,s]=n;return{stream_id:a.uid,stream_type:s}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:a}]=e;const s=this.remoteUserMap.get(n);s&&(s.delete(a),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(u_.LocalVideoTrack),n=this.localTrackMap.get(u_.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new A_((a,s)=>{this.handleUpdateVideoEncoder(e.track,a,s,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new A_((a,s)=>{this.handleUpdateVideoEncoder(n.track,a,s,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((a,s)=>{var d;let{stream_type:f}=a;const m=(d=e.find(_=>{let{stream_type:y}=_;return f===y}))===null||d===void 0?void 0:d.attributes;if(m&&aa("DISABLE_SCREEN_SHARE_REMB")){const _=n[s]._hints;(T_(_).call(_,US.SCREEN_TRACK)||T_(_).call(_,US.SCREEN_LOW_TRACK))&&(m.remb=!1,F.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof uT){var e;const a=this.filterTobeUnmutedTracks(t[n]);if(a.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(a.map(d=>{let[,{id:f}]=d;return f})));const s=this.createUnmuteMessage(a);return void await MS(this,H_.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(H_.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(H_.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await QT(h7(this.dtlsFailedCount,wT)),this.emit(H_.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await cR(this,H_.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(H_.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(u_.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof zS)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof zS).length>1)throw new t_(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof uT).length>1&&(t.some(e=>e instanceof uT&&e._bypassWebAudio)||!pS().webAudioMediaStreamDest))throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof zS&&this.pendingLocalTracks.some(n=>n instanceof zS))throw new t_(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof uT&&this.pendingLocalTracks.some(n=>n instanceof uT)&&(!pS().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof uT&&n._bypassWebAudio)))throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const a=!aa("DISABLE_DUAL_STREAM_USE_ENCODING")&&pS().supportDualStreamEncoding,s=wN(wN({},{width:160,height:120,framerate:15,bitrate:50}),e);let d;d=a?t._mediaStreamTrack.clone():b9(t,s);const f=xS(8,"track-low-"),m=new zS(d,wN(wN({},a&&{scaleResolutionDownBy:r9(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,f);return m.on(vM.TRANSCEIVER_UPDATED,_=>{t._updateRtpTransceiver(_,QV.LOW_STREAM)}),m._hints.push(US.LOW_STREAM),T_(n=t._hints).call(n,US.SCREEN_TRACK)&&m._hints.push(US.SCREEN_LOW_TRACK),t.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),t.addListener(M_.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof CN){var s,d,f,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:T,peerConnectionState:w}=this.connection,{local:L,remote:B}=await this.connection.getSelectedCandidatePair();V_.pcStats(this.store.sessionId,{startTime:_,eventElapse:t-_||0,iceconnectionsate:y,dtlsstate:T,connectionstate:w,intSucc:e?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(s=L==null?void 0:L.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(d=L.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(L.address,":").concat(L.port),selectedRemoteCandidateProtocol:(f=B.protocol)!==null&&f!==void 0?f:"",selectedRemoteCandidateType:(m=B.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(B.address,":").concat(B.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,a){var s;const d=Array.from(V0(s=this.remoteUserMap).call(s)).find(f=>f._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,m=f.subscribe.find(_=>_.userId===d.uid&&_.type==="video");V_.firstRemoteVideoDecode(this.store.sessionId,VT.FIRST_VIDEO_DECODE,JS.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:e,videoheight:n,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const s=a.get(e);if(!s)return!1;const d=await this.connection.getRemoteSSRC(s);return d!==void 0&&d!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===u_.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,QV.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},U_(Bb.prototype,"startP2PConnection",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"startP2PConnection"),Bb.prototype),U_(Bb.prototype,"connect",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"connect"),Bb.prototype),U_(Bb.prototype,"updateRemoteRTPCapabilities",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"updateRemoteRTPCapabilities"),Bb.prototype),U_(Bb.prototype,"publishDataChannel",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"publishDataChannel"),Bb.prototype),U_(Bb.prototype,"unpublish",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"unpublish"),Bb.prototype),U_(Bb.prototype,"unpublishDataChannel",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"unpublishDataChannel"),Bb.prototype),U_(Bb.prototype,"unpublishLowStream",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"unpublishLowStream"),Bb.prototype),U_(Bb.prototype,"subscribeDataChannel",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"subscribeDataChannel"),Bb.prototype),U_(Bb.prototype,"subscribe",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"subscribe"),Bb.prototype),U_(Bb.prototype,"massSubscribe",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"massSubscribe"),Bb.prototype),U_(Bb.prototype,"unsubscribe",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"unsubscribe"),Bb.prototype),U_(Bb.prototype,"unsubscribeDataChannel",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"unsubscribeDataChannel"),Bb.prototype),U_(Bb.prototype,"massUnsubscribe",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"massUnsubscribe"),Bb.prototype),U_(Bb.prototype,"muteRemote",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"muteRemote"),Bb.prototype),U_(Bb.prototype,"unmuteRemote",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"unmuteRemote"),Bb.prototype),U_(Bb.prototype,"hasRemoteMediaWithLock",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"hasRemoteMediaWithLock"),Bb.prototype),U_(Bb.prototype,"disconnectForReconnect",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"disconnectForReconnect"),Bb.prototype),U_(Bb.prototype,"updateBitrateLimit",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"updateBitrateLimit"),Bb.prototype),U_(Bb.prototype,"remoteMediaSsrcChanged",[DR],Object.getOwnPropertyDescriptor(Bb.prototype,"remoteMediaSsrcChanged"),Bb.prototype),Bb);function DR(t,e,n){const a=t[e];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,d=await s.lock("From P2PChannel.".concat(e));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await a.apply(this,m)}finally{d()}},n}function jrt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function Vrt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jrt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jrt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}const nft=Date.now(),rft=20,T9=new Map,G8=new Map;async function Brt(t){const e=T9.get(t),n=Array.isArray(e)&&e[e.length-1],a=G8.get(t);if(!n)return void(a.isSyncing=!1);const s={uid:n.uid,payload:n.payload};a.firstRecvTs===0&&(a.firstRecvTs=n.recvTs,a.firstSendTs=n.sendTs);const d=n.sendTs-a.firstSendTs,f=d-(Date.now()-a.firstRecvTs);f>0&&(a.firstRecvTs=Date.now()-d);let m=n.mediaDelay+f;m<=0?(e.pop(),Frt(n.context,s),m=0):m=Math.min(m,rft),setTimeout(()=>e.length&&Brt(t),m)}function Frt(t,e){t.safeEmit(eS.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function ift(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return Frt(n,{uid:t.uid,payload:t.payload});const a="".concat(n.id,"-").concat(t.uid),s=T9.get(a)||[],d=s.findIndex(y=>t.sendTs>=y.sendTs),f=Vrt(Vrt({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});d===-1?s.push(f):s.splice(d,0,f),T9.set(a,s);let m=!1;var _;G8.has(a)?m=!((_=G8.get(a))===null||_===void 0||!_.isSyncing):G8.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||Brt(a)}const oft=lS().name;function Grt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function Hrt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Grt(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Grt(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}const v3="websdk_ng_cache_parameter",aft=aa("MAX_PRELOAD_ASYNC_LENGTH"),sft=1e4,kM=new Map,LM=[];let R9=null,A9=0,C9=0;const H8=new Map,cft=function(t,e){const n=[];let a=0;const s=async()=>{const d=n.shift();d&&await d(),n.length>0&&a<e?s():a--};return async function(){for(var d=arguments.length,f=new Array(d),m=0;m<d;m++)f[m]=arguments[m];return new A_(async(_,y)=>{n.push(async()=>{try{const T=await t(...f);_(T)}catch(T){y(T)}}),a<e&&(a++,s())})}}(qrt,aft),O9=WR.CancelToken.source();async function qrt(t,e,n,a,s,d){try{if(!aa("ENABLE_PRELOAD"))return;if(!pS().supportWebCrypto)return void IP(()=>{F.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new t_(_i.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ZT(n,"token",1,2047),ZT(t,"appid",1,2047),v8(e),a&&y8(a);const f=gM();F.debug("preload channel ".concat(e,", uid is ").concat(a));const m={appId:t,cname:e,token:n||t,uid:typeof a!="string"?a:null,sid:f,proxyServer:s};let _,y;typeof a=="string"?(m.stringUid=a,[y,_]=await A_.all([qpt(a,{sid:f,appId:t},O9.token),hrt(Hrt(Hrt({},m),{},{token:n||t,uid:0}),O9.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),_=await hrt(m,O9.token));const T={sid:f,appId:t,cname:e,token:n||t,uid:m.stringUid||a,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(w){let L;try{w.uid&&Krt({appId:w.appId,cname:w.cname,token:w.token,uid:w.uid,stringUid:w.stringUid});const B=Jrt(w),Q=await async function(J,_n){try{const _r=await window.crypto.subtle.importKey("raw",P$(_n),"AES-GCM",!1,["encrypt"]),ya=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},_r,EM(window.btoa(JSON.stringify(J))));return NP(new Uint8Array(ya))}catch{return}}(w,w.token||w.appId);if(!Q)return;L=Xrt(v3);const X=L?JSON.parse(L):[];X.push({[B]:Q}),X.length>aa("AP_CACHE_NUM")&&X.shift(),q8(v3,JSON.stringify(X))}catch(B){F.warn("Error caching server parameters:",B.message),q8(v3,"")}}(T),A9++}catch(f){throw C9++,function(m){R9||(R9=window.setTimeout(()=>{let y="";H8.forEach((T,w)=>{y+="".concat(w,": ").concat(T," ;")}),V_.reportApiInvoke(null,{name:OT.PRELOAD,options:{success:A9,failed:C9,err:y}}).onError(m),A9=0,C9=0,H8.clear(),R9=null},sft));const _=H8.get(m.code)||0;H8.set(m.code,_+1)}(f),f}}async function zrt(t){try{if(aa("AP_REQUEST_DETAIL")||aa("ENABLE_ROLE_SELECT_EDGE"))return;const e=Krt(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(a,s){try{const d=await window.crypto.subtle.importKey("raw",P$(s),"AES-GCM",!1,["decrypt"]),f=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,EM(a));return JSON.parse(window.atob(NP(new Uint8Array(f))))}catch{return}}(e,t.token||t.appId);if(!n||!function(a,s){return a.cname===s.cname&&a.appId===s.appId&&a.token===s.token?s.stringUid?a.stringUid===s.stringUid:typeof s.uid=="number"?a.uid===s.uid:a.uid==s.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<aa("AP_CACHE_LIFETIME"))return n}catch(e){F.warn("Error get preloadInfo",e.message)}}function Krt(t){let e;try{if(e=Xrt(v3),!e)return;const n=JSON.parse(e),a=Jrt(t),s=function(f,m){for(let _=f.length-1;_>=0;_--)if(m(f[_]))return _;return-1}(n,f=>a in f);if(s===-1)return;const d=n.splice(s,1)[0];return q8(v3,JSON.stringify(n)),d[a]}catch(n){F.warn("Error delete preload info: ".concat(e),n.message),q8(v3,"")}}function w9(t){if(t){let e=kM.get(t);e&&(window.clearTimeout(e),e=null,kM.delete(t)),T_(LM).call(LM,t)||t.cloudProxyServer!=="disabled"||LM.push(t)}if(kM.size<aa("AP_CACHE_NUM")&&LM.length>0){const e=LM.shift();kM.set(e,window.setTimeout(async()=>{const{appId:n,cname:a,token:s,stringUid:d,uid:f,proxyServer:m}=e;try{await cft(n,a,s,f,m,d),kM.has(e)&&w9(e)}catch(_){F.warn("update preload failed",_.message),Wrt(e)}},aa("AP_UPDATE_INTERVAL")))}}function Wrt(t){const e=LM.indexOf(t);e!==-1&&LM.splice(e,1);let n=kM.get(t);n&&(window.clearTimeout(n),n=null,kM.delete(t),w9())}function Yrt(t,e){const n=t.sua,a=t.ap;e&&n&&V_.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),V_.reportResourceTiming(t.ap.url,t.sid),V_.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(s=>s.ip).join(","),eventType:"disabled",unilbsServerIds:[TT.CHOOSE_SERVER,TT.CLOUD_PROXY_FALLBACK].toString()}),V_.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(s=>s.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[TT.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function Xrt(t){return window.atob(window.localStorage.getItem(t)||"")}function q8(t,e){window.localStorage.setItem(t,window.btoa(e))}function Jrt(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),F$(e)}function uft(t){let e=function(){const n=hft.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,a){let s=n.appId;s!==void 0&&(CT(a,10),BP(a,s));let d=n.cid;d!==void 0&&(CT(a,16),CT(a,d));let f=n.cname;f!==void 0&&(CT(a,26),BP(a,f));let m=n.deviceId;m!==void 0&&(CT(a,34),BP(a,m));let _=n.elapse;_!==void 0&&(CT(a,40),FP(a,_));let y=n.fileSize;y!==void 0&&(CT(a,48),FP(a,y3(y)));let T=n.height;T!==void 0&&(CT(a,56),FP(a,y3(T)));let w=n.jpg;w!==void 0&&(CT(a,66),CT(a,w.length),Qrt(a,w));let L=n.networkType;L!==void 0&&(CT(a,72),FP(a,y3(L)));let B=n.osType;B!==void 0&&(CT(a,80),FP(a,y3(B)));let Q=n.requestId;Q!==void 0&&(CT(a,90),BP(a,Q));let X=n.sdkVersion;X!==void 0&&(CT(a,98),BP(a,X));let J=n.sequence;J!==void 0&&(CT(a,104),FP(a,y3(J)));let _n=n.sid;_n!==void 0&&(CT(a,114),BP(a,_n));let _r=n.timestamp;_r!==void 0&&(CT(a,120),FP(a,_r));let ya=n.uid;ya!==void 0&&(CT(a,128),CT(a,ya));let _l=n.vid;_l!==void 0&&(CT(a,136),CT(a,_l));let _d=n.width;_d!==void 0&&(CT(a,144),FP(a,y3(_d)));let tu=n.service;tu!==void 0&&(CT(a,152),CT(a,tu));let _g=n.callbackData;_g!==void 0&&(CT(a,162),CT(a,_g.length),Qrt(a,_g));let l_=n.ticket;l_!==void 0&&(CT(a,170),BP(a,l_));let O_=n.vendorConfigs;O_!==void 0&&(CT(a,178),BP(a,O_))}(t,e),function(n){let a=n.bytes,s=n.limit;return a.length===s?a:a.subarray(0,s)}(e)}function lft(t){return function(n){let a={};t:for(;!pft(n);){let s=e6(n);switch(s>>>3){case 0:break t;case 1:a.code=e6(n);break;case 2:a.msg=$rt(n,e6(n));break;case 3:a.requestId=$rt(n,e6(n));break;case 4:a.timestamp=fft(n,!1);break;default:dft(n,7&s)}}return a}({bytes:e=t,offset:0,limit:e.length});var e}function dft(t,e){switch(e){case 0:for(;128&GO(t););break;case 2:I9(t,e6(t));break;case 5:I9(t,4);break;case 1:I9(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function y3(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let hft=[];function I9(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function pft(t){return t.offset>=t.limit}function z8(t,e){let n=t.bytes,a=t.offset,s=t.limit,d=a+e;if(d>n.length){let f=new Uint8Array(2*d);f.set(n),t.bytes=f}return t.offset=d,d>s&&(t.limit=d),a}function Zrt(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function Qrt(t,e){let n=z8(t,e.length);t.bytes.set(e,n)}function $rt(t,e){let n=Zrt(t,e),a=String.fromCharCode,s=t.bytes,d="�",f="";for(let m=0;m<e;m++){let _,y,T,w,L=s[m+n];(128&L)==0?f+=a(L):(224&L)==192?m+1>=e?f+=d:(_=s[m+n+1],(192&_)!=128?f+=d:(w=(31&L)<<6|63&_,w<128?f+=d:(f+=a(w),m++))):(240&L)==224?m+2>=e?f+=d:(_=s[m+n+1],y=s[m+n+2],(49344&(_|y<<8))!=32896?f+=d:(w=(15&L)<<12|(63&_)<<6|63&y,w<2048||w>=55296&&w<=57343?f+=d:(f+=a(w),m+=2))):(248&L)==240?m+3>=e?f+=d:(_=s[m+n+1],y=s[m+n+2],T=s[m+n+3],(12632256&(_|y<<8|T<<16))!=8421504?f+=d:(w=(7&L)<<18|(63&_)<<12|(63&y)<<6|63&T,w<65536||w>1114111?f+=d:(w-=65536,f+=a(55296+(w>>10),56320+(1023&w)),m+=3))):f+=d}return f}function BP(t,e){let n=e.length,a=0;for(let f=0;f<n;f++){let m=e.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+e.charCodeAt(++f)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}CT(t,a);let s=z8(t,a),d=t.bytes;for(let f=0;f<n;f++){let m=e.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+e.charCodeAt(++f)-56613888),m<128?d[s++]=m:(m<2048?d[s++]=m>>6&31|192:(m<65536?d[s++]=m>>12&15|224:(d[s++]=m>>18&7|240,d[s++]=m>>12&63|128),d[s++]=m>>6&63|128),d[s++]=63&m|128)}}function GO(t){return t.bytes[Zrt(t,1)]}function tit(t,e){let n=z8(t,1);t.bytes[n]=e}function e6(t){let e,n=0,a=0;do e=GO(t),n<32&&(a|=(127&e)<<n),n+=7;while(128&e);return a}function CT(t,e){for(e>>>=0;e>=128;)tit(t,127&e|128),e>>>=7;tit(t,e)}function fft(t,e){let n,a=0,s=0,d=0;return n=GO(t),a=127&n,128&n&&(n=GO(t),a|=(127&n)<<7,128&n&&(n=GO(t),a|=(127&n)<<14,128&n&&(n=GO(t),a|=(127&n)<<21,128&n&&(n=GO(t),s=127&n,128&n&&(n=GO(t),s|=(127&n)<<7,128&n&&(n=GO(t),s|=(127&n)<<14,128&n&&(n=GO(t),s|=(127&n)<<21,128&n&&(n=GO(t),d=127&n,128&n&&(n=GO(t),d|=(127&n)<<7))))))))),{low:a|s<<28,high:s>>>4|d<<24,unsigned:e}}function FP(t,e){let n=e.low>>>0,a=(e.low>>>28|e.high<<4)>>>0,s=e.high>>>24,d=s===0?a===0?n<16384?n<128?1:2:n<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:s<128?9:10,f=z8(t,d),m=t.bytes;switch(d){case 10:m[f+9]=s>>>7&1;case 9:m[f+8]=d!==9?128|s:127&s;case 8:m[f+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[f+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[f+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[f+4]=d!==5?128|a:127&a;case 4:m[f+3]=d!==4?n>>>21|128:n>>>21&127;case 3:m[f+2]=d!==3?n>>>14|128:n>>>14&127;case 2:m[f+1]=d!==2?n>>>7|128:n>>>7&127;case 1:m[f]=d!==1?128|n:127&n}}const eit={},nit={},K8=4294967296,mft=K8*K8,Eft=mft/2;iit(0,!0);const rit=iit(0),gft=n6(0,-2147483648,!1),_ft=n6(-1,2147483647,!1);function iit(t,e){let n,a,s;return e?(s=0<=(t>>>=0)&&t<256)&&(a=nit[t],a)?a:(n=n6(t,0,!0),s&&(nit[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(a=eit[t],a)?a:(n=n6(t,t<0?-1:0,!1),s&&(eit[t]=n),n)}function n6(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function oit(t,e){if(isNaN(t))return rit;{if(t<=-9223372036854776e3)return gft;if(t+1>=Eft)return _ft}return t<0?rit:n6(t%K8|0,t/K8|0,e)}function ait(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}class N9 extends eT{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(wI.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),_t(this,"name","AgoraRTCImageModeration"),_t(this,"_connectionState",uO.CONNECTING),_t(this,"_sequence",0),_t(this,"_moderationStartTime",void 0),_t(this,"_workerConnection",void 0),_t(this,"_workerMessageLengthLimit",void 0),_t(this,"_qualityRatio",void 0),_t(this,"_connectInfo",void 0),_t(this,"_cancelTokenSource",WR.CancelToken.source()),_t(this,"_retryConfig",void 0),_t(this,"_moderationInterval",void 0),_t(this,"_moderationTimer",null),_t(this,"_moderationMode",1),_t(this,"_quality",1),_t(this,"_qualityTimer",null),_t(this,"_ticket",void 0),_t(this,"_moderationIntervalMinimum",void 0),_t(this,"_uploadFailedNum",0),_t(this,"_uploadNum",0),_t(this,"_uploadTimer",null),_t(this,"_extraInfo",void 0),_t(this,"_vendor",""),_t(this,"_encoder",new TextEncoder),_t(this,"_moderationId",void 0),_t(this,"inspectImage",()=>{if(this.connectionState!==uO.CONNECTED)throw new _E(_i.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===uO.CONNECTED?this.requestToInspectImage():F.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=xS(5,"image-moderation-"),this._workerMessageLengthLimit=aa("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=aa("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=aa("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new z2("worker-"+this._moderationId,wT),this.on(wI.STATE_CHANGE,(a,s)=>{F.debug("[".concat(this._moderationId,"] Moderation operation :").concat(u3[a]," ").concat(s||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(wI.STATE_CHANGE,u3.CONNECT_AP),this._connectInfo=e;const a=this._cancelTokenSource.token;return this._retryConfig=n,new A_((s,d)=>{this.on(wI.CONNECTION_STATE_CHANGE,(f,m)=>{f===uO.CONNECTED&&s()}),this.requestAP(e,a,n).then(f=>{this.connectWorker(f)}).catch(f=>{d(f)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),F.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===uO.CONNECTED&&this.inspectImage()}async requestAP(e,n,a){const s=aa("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),d=await function(_,y,T,w){let{appId:L,areaCode:B,cname:Q,sid:X,token:J,uid:_n}=y;m3++;const _r="moderation_plugin",ya={service_name:_r,json_body:JSON.stringify({appId:L,areaCode:B,cname:Q,command:"allocateEdge",requestId:m3,seq:m3,sid:X,appToken:J,ts:Date.now(),uid:_n+""})};let _l,_d,tu=_[0];return RI(async()=>{_l=Date.now();const _g=await II(tu,{data:ya,cancelToken:T,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_d=Date.now()-_l,_g.code!==0){const N_=new _E(_i.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+_g.code,{retry:!0,responseTime:_d});throw F.error(N_.toString()),N_}const l_=JSON.parse(_g.json_body);if(l_.code!==200){const N_=new _E(_i.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(l_.code,", reason: ").concat(l_.reason),{code:l_.code,responseTime:_d});throw F.error(N_.toString()),N_}if(!l_.servers||!Array.isArray(l_.servers)||l_.servers.length===0){const N_=new _E(_i.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:l_.code,responseTime:_d});throw F.error(N_.toString()),N_}if(!l_.servers.some(N_=>!!N_.wss)){const N_=new _E(_i.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:l_.code,responseTime:_d});throw F.error(N_.toString()),N_}const O_=aa("IMAGE_MODERATION_WORKER_HOST");return{addressList:l_.servers.map(N_=>{let{address:iS,wss:oS}=N_;if(iS&&oS)return"wss://".concat(iS.replace(/\./g,"-"),".").concat(O_,":").concat(oS,"/moderation")}).filter(N_=>!!N_),workerToken:l_.workerToken,vid:l_.vid,ticket:l_.appTicket,responseTime:_d}},(_g,l_)=>(V_.apworkerEvent(X,{success:!0,sc:200,serviceName:_r,responseDetail:JSON.stringify(_g.addressList),firstSuccess:l_===0,responseTime:_d,serverIp:_[l_%_.length]}),!1),(_g,l_)=>(V_.apworkerEvent(X,{success:!1,sc:_g.data&&_g.data.code||200,serviceName:_r,responseTime:_d,serverIp:_[l_%_.length]}),!!(_g.code!==_i.OPERATION_ABORTED&&_g.code!==_i.UNEXPECTED_RESPONSE||_g.data&&_g.data.retry)&&(tu=_[(l_+1)%_.length],!0)),w)}(s,e,n,a);this.emit(wI.STATE_CHANGE,u3.AP_CONNECTED);const{addressList:f,ticket:m}=d;return this._ticket=m,f}async connectWorker(e){this.emit(wI.STATE_CHANGE,u3.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(kv.CONNECTED,async()=>{this.emit(wI.STATE_CHANGE,u3.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=uO.CONNECTED}),this._workerConnection.on(kv.CLOSED,()=>{this.connectionState=uO.CLOSED}),this._workerConnection.on(kv.FAILED,()=>{this.connectionState=uO.CLOSED}),this._workerConnection.on(kv.RECONNECTING,()=>{this.connectionState=this.connectionState===uO.CONNECTED?uO.RECONNECTING:uO.CONNECTING}),this._workerConnection.on(kv.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=lft(new Uint8Array(e.data));aa("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&F.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,F.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{V_.reportApiInvoke(this._connectInfo.sid||null,{name:OT.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:oT.TRACER}).onError(new _E(_i.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},aa("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else F.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(kv.WILL_RECONNECT,(e,n,a)=>{e==="recover"&&a(e),a("tryNext")}),this._workerConnection.on(kv.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=U0(this,wI.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(aa("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&F.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(e,n);this._workerConnection.sendMessage(a,!0,!0)}else aa("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&F.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:a,cname:s,cid:d,vid:f,sid:m,uid:_}=n;const y=Date.now(),T=await e.getCurrentFrameImage("image/jpeg",this.quality),w=await Ntt(T,a,s),L=this._sequence+"-"+d+"-"+_+"-"+y+"-"+xS(12,""),B={appId:a,cid:d,cname:s,deviceId:"",elapse:N9.intToLong(Number(y-this._moderationStartTime)),fileSize:T.buffer.byteLength,height:T.height,width:T.width,jpg:w,networkType:6,osType:7,requestId:L,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:oit(y),uid:_,vid:f,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete B.callbackData;const Q=uft(B);if(Q.byteLength<this._workerMessageLengthLimit){if(aa("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const X=function(J){for(var _n=1;_n<arguments.length;_n++){var _r=arguments[_n]!=null?arguments[_n]:{};_n%2?ait(Object(_r),!0).forEach(function(ya){_t(J,ya,_r[ya])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(_r)):ait(Object(_r)).forEach(function(ya){Object.defineProperty(J,ya,Object.getOwnPropertyDescriptor(_r,ya))})}return J}({},B);delete X.jpg,F.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(X))}return Q}{const X=this.quality*this._qualityRatio;return this.quality=X,await this.generateRequestData(e,{appId:a,cname:s,cid:d,vid:f,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=WR.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=uO.CLOSED,this.emit(wI.STATE_CHANGE,u3.CLOSED)}}function sit(t){if(IS(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new _E(_i.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new _E(_i.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const vft={name:"ImageModeration",create:function(t){let{config:e}=t;return sit(e),new N9(e)}};var cit,uit,lit,dit,hit,pit,fit,mit,Eit,git,_it,vit,yit,bit,Sit,Tit,Rit,Ait,Cit,Oit,wit,Iit,Nit,Dit,kit,Lit,Pit,Mit,xit,Uit,jit,Vit,Bit,Fit,Git,Hit,qit,zit,Kit,Wit,Yit,I_;function Xit(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function HO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Xit(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xit(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}mR.setLogger(F);let yft=(cit=K_(),uit=K_({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof e3))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),lit=K_({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==t3.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),dit=K_({argsMap:(t,e,n,a)=>[typeof e=="object"?e.uid:e,n,a]}),hit=K_({argsMap:(t,e,n)=>[e,n]}),pit=K_({argsMap:(t,e)=>e.map(n=>{let{user:a,mediaType:s}=n;return[a==null?void 0:a.uid,s]})}),fit=K_({argsMap:(t,e,n,a)=>[typeof e=="object"?e.uid:e,n,a]}),mit=K_({argsMap:(t,e)=>e.map(n=>{let{user:a,mediaType:s}=n;return{uid:a==null?void 0:a.uid,mediaType:s}})}),Eit=K_(),git=K_(),_it=K_(),vit=K_(),yit=K_(),bit=K_(),Sit=K_(),Tit=K_(),Rit=K_(),Ait=K_(),Cit=K_(),Oit=K_(),wit=K_(),Iit=K_(),Nit=K_(),Dit=K_({argsMap:(t,e)=>[e]}),kit=K_(),Lit=K_(),Pit=K_(),Mit=K_(),xit=K_(),Uit=K_(),jit=K_(),Vit=K_(),Bit=K_({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),Fit=K_(),Git=K_(),Hit=K_(),qit=K_(),zit=K_(),Kit=K_(),Wit=K_({reportResult:!0}),Yit=K_(),I_=class extends eT{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),_t(this,"store",void 0),_t(this,"_uid",void 0),_t(this,"_channelName",void 0),_t(this,"_uintUid",void 0),_t(this,"_users",[]),_t(this,"_config",void 0),_t(this,"_clientId",void 0),_t(this,"_appId",void 0),_t(this,"_sessionId",null),_t(this,"_key",void 0),_t(this,"_rtmConfig",{}),_t(this,"_joinInfo",void 0),_t(this,"_gateway",void 0),_t(this,"_statsCollector",void 0),_t(this,"_configDistribute",void 0),_t(this,"_leaveMutex",void 0),_t(this,"_publishMutex",void 0),_t(this,"_renewTokenMutex",void 0),_t(this,"_subscribeMutex",void 0),_t(this,"_encryptionMode","none"),_t(this,"_encryptionSecret",null),_t(this,"_encryptionSalt",null),_t(this,"_encryptDataStream",!1),_t(this,"_encryptDataStreamKey",null),_t(this,"_encryptDataStreamIv",null),_t(this,"_proxyServer",void 0),_t(this,"_turnServer",{servers:[],mode:"auto"}),_t(this,"_cloudProxyServerMode","disabled"),_t(this,"_isDualStreamEnabled",!1),_t(this,"_defaultStreamFallbackType",void 0),_t(this,"_lowStreamParameter",void 0),_t(this,"_streamFallbackTypeCacheMap",new Map),_t(this,"_remoteStreamTypeCacheMap",new Map),_t(this,"_axiosCancelSource",WR.CancelToken.source()),_t(this,"_audioVolumeIndicationInterval",void 0),_t(this,"_networkQualityInterval",void 0),_t(this,"_userOfflineTimeout",void 0),_t(this,"_streamRemovedTimeout",void 0),_t(this,"_liveTranscodeStreamingClient",void 0),_t(this,"_liveRawStreamingClient",void 0),_t(this,"_channelMediaRelayClient",void 0),_t(this,"_networkQualitySensitivity","normal"),_t(this,"_p2pChannel",void 0),_t(this,"_useLocalAccessPoint",!1),_t(this,"_setLocalAPVersion",void 0),_t(this,"_joinAndNotLeaveYet",!1),_t(this,"_numberOfJoinCount",0),_t(this,"_remoteDefaultVideoStreamType",void 0),_t(this,"_inspect",void 0),_t(this,"_moderation",void 0),_t(this,"_license",void 0),_t(this,"_pendingPublishedUsers",[]),_t(this,"ntpAlignErrorCount",0),_t(this,"remoteInboundOffset",0),_t(this,"_peerConnectionState",void 0),_t(this,"_handleLocalTrackEnable",(s,d,f)=>{this.publish(s,!1).then(d).catch(f)}),_t(this,"_handleLocalTrackDisable",(s,d,f)=>{this.unpublish(s).then(d).catch(f)}),_t(this,"_handleUserOnline",s=>{if(aa("BLOCK_LOCAL_CLIENT")&&AM(s.uid,this.channelName))return void F.debug("[".concat(s.uid,"] will be ignored in local"));this.isStringUID&&typeof s.uid!="string"&&F.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(f=>f.uid===s.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(eS.USER_JOINED,d));else{const f=new jP(s.uid,s.uint_id||s.uid);this._users.push(f),F.debug("[".concat(this._clientId,"] user online"),s.uid),this.safeEmit(eS.USER_JOINED,f)}}),_t(this,"_handleUserOffline",s=>{if(aa("BLOCK_LOCAL_CLIENT")&&AM(s.uid,this.channelName))return;const d=this._users.find(f=>f.uid===s.uid);d&&(this._handleRemoveStream(s),this._handleRemoveDataChannels(s),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:XH(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),F.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.safeEmit(eS.USER_LEAVED,d,s.reason))}),_t(this,"_handleAddAudioOrVideoStream",(s,d,f,m,_,y,T)=>{if(aa("BLOCK_LOCAL_CLIENT")&&AM(d,this.channelName))return;const w=this._users.find(B=>B.uid===d);if(!w)return void F.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));F.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(s)),this.store.subscribe(w.uid,s,void 0,void 0,void 0,Date.now());const L=s==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=_||d),s==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,s==="audio"?(w._audio_added_=!0,f!==void 0&&(w._audioSSRC=f),m!==void 0&&(w._cname=m),y&&(w._audioOrtc=y)):(w._video_added_=!0,f!==void 0&&(w._videoSSRC=f),m!==void 0&&(w._cname=m),T!==void 0&&(w._rtxSsrcId=T),y&&(w._videoOrtc=y)),(s==="audio"?w.hasAudio:w.hasVideo)&&!L&&(F.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(s)),this.safeEmit(eS.USER_PUBLISHED,w,s)),s==="video"?V_.onGatewayStream(this._sessionId,VT.ON_ADD_VIDEO_STREAM,JS.ON_ADD_VIDEO_STREAM,{peer:_||d,ssrc:w._videoSSRC}):V_.onGatewayStream(this._sessionId,VT.ON_ADD_AUDIO_STREAM,JS.ON_ADD_AUDIO_STREAM,{peer:_||d,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,s,f).then(B=>{if(B&&(F.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof t6))return this._p2pChannel.unsubscribe(w,s,!0).then(()=>this._subscribe(w,s,!0).catch(Q=>{F.error("[".concat(this._clientId,"] resubscribe error"),Q.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,s)&&(F.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,s,!0).catch(B=>{F.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}))}),_t(this,"_handleRemoveStream",s=>{if(aa("BLOCK_LOCAL_CLIENT")&&AM(s.uid,this.channelName))return;const d=this._users.find(m=>m.uid===s.uid);if(!d)return void F.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));F.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let f=()=>{};d.hasAudio&&d.hasVideo?f=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(eS.USER_UNPUBLISHED,d,"audio"),F.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(eS.USER_UNPUBLISHED,d,"video")}:d.hasVideo?f=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(eS.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(f=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(eS.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof t6&&this._p2pChannel.unsubscribe(d).then(m=>{if(m)return this._gateway.unsubscribe(m,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),V_.onGatewayStream(this._sessionId,VT.ON_REMOVE_STREAM,JS.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),f()}),_t(this,"_handleSetStreamLocalEnable",(s,d,f)=>{if(aa("BLOCK_LOCAL_CLIENT")&&AM(d,this.channelName))return;const m=this._users.find(T=>T.uid===d);if(!m)return void F.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));F.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(f?"enabled":"disabled"," with uid ").concat(d));const _=s==="audio"?m.hasAudio:m.hasVideo;if(s==="audio"){m._trust_audio_enabled_state_=!0;const T=m._audio_enabled_;if(m._audio_enabled_=f,m._audio_enabled_===T)return;{const w=m._audio_enabled_?"enable-local-audio":"disable-local-audio";F.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(w)),this.safeEmit(eS.USER_INFO_UPDATED,d,w)}}else{m._trust_video_enabled_state_=!0;const T=m._video_enabled_;if(m._video_enabled_=f,m._video_enabled_===T)return;{const w=m._video_enabled_?"enable-local-video":"disable-local-video";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(w)),this.safeEmit(eS.USER_INFO_UPDATED,d,w)}}const y=s==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(F.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(s)),void this.safeEmit(eS.USER_PUBLISHED,m,s)):(s==="video"&&m._videoTrack&&m._videoTrack._destroy(),s==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,s),F.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(s)),void this.safeEmit(eS.USER_UNPUBLISHED,m,s)):void 0}),_t(this,"_handleMuteStream",(s,d,f)=>{if(aa("BLOCK_LOCAL_CLIENT")&&AM(s,this.channelName))return;F.debug("[".concat(this._clientId,"] receive mute message"),s,d,f);const m=this._users.find(T=>T.uid===s);if(!m)return void F.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const _=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const T=m._audio_muted_;if(m._audio_muted_=f,m._audio_muted_===T)return;{const w=m._audio_muted_?"mute-audio":"unmute-audio";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(w)),this.safeEmit(eS.USER_INFO_UPDATED,s,w)}}else{m._trust_video_mute_state_=!0;const T=m._video_muted_;if(m._video_muted_=f,m._video_muted_===T)return;{const w=m._video_muted_?"mute-video":"unmute-video";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(w)),this.safeEmit(eS.USER_INFO_UPDATED,s,w)}}const y=d==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(F.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(d)),void this.safeEmit(eS.USER_PUBLISHED,m,d)):void F.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),F.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(d)),this.safeEmit(eS.USER_UNPUBLISHED,m,d)}}),_t(this,"_handleP2PLost",async s=>{F.debug("[".concat(this._clientId,"] receive p2p lost"),s),parseInt(s.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():F.warning("[".concat(this._clientId,"] P2PLost stream not found"),s)}),_t(this,"_handleTokenWillExpire",()=>{F.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(eS.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),_t(this,"_handleBeforeUnload",s=>{s.type==="beforeunload"&&s.returnValue!==void 0&&s.returnValue!==""||(this.leave(),F.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),_t(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(eS.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(eS.NETWORK_QUALITY,s)}),_t(this,"_handleP2PAddAudioOrVideoStream",(s,d,f,m)=>{const _=this._users.find(T=>T.uid===d);if(!_)return void F.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));F.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(s)),this.store.subscribe(_.uid,s,void 0,void 0,void 0,Date.now());const y=s==="audio"?_.hasAudio:_.hasVideo;s==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,s==="audio"?(_._audio_added_=!0,f!==void 0&&(_._audioSSRC=f),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,f!==void 0&&(_._videoSSRC=f),m!==void 0&&(_._videoMid=m)),(s==="audio"?_.hasAudio:_.hasVideo)&&!y&&(F.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(s)),this.safeEmit(eS.USER_PUBLISHED,_,s)),this._p2pChannel.hasPendingRemoteMedia(_,s)&&(F.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,s,!0).catch(T=>{F.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._config=t,this._clientId=e||xS(5,"client-"),this.store=new class{constructor(s,d,f,m){$_(this,"state",void 0),this.state={codec:s,audioCodec:d,mode:f,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:_M.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(s){this.state=function(d,f){switch(f.type){case nS.SET_SESSION_ID:return D_(D_({},d),{},{sessionId:f.sessionId});case nS.SET_P2P_ID:return D_(D_({},d),{},{p2pId:f.p2pId});case nS.SET_UID:return D_(D_({},d),{},{uid:f.uid});case nS.SET_INT_UID:return D_(D_({},d),{},{intUid:f.intUid});case nS.SET_PUB_ID:return D_(D_({},d),{},{pubId:f.pubId});case nS.KEY_METRIC_CLIENT_CREATED:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{clientCreated:f.metric})});case nS.KEY_METRIC_JOIN_START:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{joinStart:f.metric})});case nS.AVOID_JOIN_START:return D_(D_({},d),{},{avoidJoinStart:f.avoidJoinStart});case nS.KEY_METRIC_JOIN_END:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{joinEnd:f.metric})});case nS.KEY_METRIC_REQUEST_AP_START:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{requestAPStart:f.metric})});case nS.KEY_METRIC_REQUEST_AP_END:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{requestAPEnd:f.metric})});case nS.KEY_METRIC_JOIN_GATEWAY_START:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{joinGatewayStart:f.metric})});case nS.KEY_METRIC_JOIN_GATEWAY_END:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{joinGatewayEnd:f.metric})});case nS.KEY_METRIC_PEER_CONNECTION_START:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{peerConnectionStart:f.metric})});case nS.KEY_METRIC_PEER_CONNECTION_END:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{peerConnectionEnd:f.metric})});case nS.KEY_METRIC_DESCRIPTION_START:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{descriptionStart:f.metric})});case nS.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{signalChannelOpen:f.metric})});case nS.KEY_METRIC_ICE_CONNECTION_END:return D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{iceConnectionEnd:f.metric})});case nS.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,_=m.findIndex(y=>y.trackId===f.metric.trackId);return _!==-1?(m[_]=D_(D_({},m[_]),f.metric),D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{publish:[...m]})})):D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,f.metric]})})}case nS.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===f.metric.userId&&y.type===f.metric.type);return _!==-1?(m[_]=D_(D_({},m[_]),f.metric),D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{subscribe:[...m]})})):D_(D_({},d),{},{keyMetrics:D_(D_({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,f.metric]})})}case nS.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=f.mode,d;case nS.RECORD_JOIN_CHANNEL_SERVICE:return typeof f.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,f.record]:(d.joinChannelServiceRecords[f.index]=D_(D_({},d.joinChannelServiceRecords[f.index]),f.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case nS.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case nS.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[]},d;case nS.SET_USE_P2P:return D_(D_({},d),{},{useP2P:f.val});case nS.SET_TRANSPORT_TYPE:return D_(D_({},d),{},{p2pTransport:f.val});default:return d}}(this.state,s)}set sessionId(s){this.dispatch({type:nS.SET_SESSION_ID,sessionId:s})}get sessionId(){return this.state.sessionId}set cid(s){this.state.cid=s}get cid(){return this.state.cid}set codec(s){this.state.codec=s}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(s){this.dispatch({type:nS.SET_P2P_ID,p2pId:s})}get p2pId(){return this.state.p2pId}set dcId(s){this.dispatch({type:nS.SET_DC_ID,dcId:s})}get dcId(){return this.state.dcId}set uid(s){this.dispatch({type:nS.SET_UID,uid:s})}get uid(){return this.state.uid}set intUid(s){this.dispatch({type:nS.SET_INT_UID,intUid:s})}get intUid(){return this.state.intUid}set pubId(s){this.dispatch({type:nS.SET_PUB_ID,pubId:s})}get pubId(){return this.state.pubId}set cloudProxyServerMode(s){this.dispatch({type:nS.SET_CLOUD_PROXY_SERVER_MODE,mode:s})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(s){this.dispatch({type:nS.SET_USE_P2P,val:s})}get useP2P(){return this.state.useP2P}set p2pTransport(s){this.dispatch({type:nS.SET_TRANSPORT_TYPE,val:s})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(s){this.state.hasStartJoinChannel=s}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(s){this.state.isABTestSuccess=s}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:nS.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:nS.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:nS.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:nS.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:nS.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:nS.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:nS.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:nS.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:nS.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:nS.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:nS.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:nS.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(s,d,f,m){this.dispatch({type:nS.KEY_METRIC_PUBLISH,metric:D_(D_({trackId:s,type:d},f&&{publishStart:f}),m&&{publishEnd:m})})}subscribe(s,d,f,m,_,y,T){this.dispatch({type:nS.KEY_METRIC_SUBSCRIBE,metric:D_(D_(D_(D_(D_({userId:s,type:d},f&&{subscribeStart:f}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),T&&{firstDecoded:T})})}massSubscribe(s,d,f,m){s.forEach(_=>{this.dispatch({type:nS.KEY_METRIC_SUBSCRIBE,metric:D_(D_(D_({userId:_.userId,type:_.type},d&&{subscribeStart:d}),f&&{subscribeEnd:f}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(s,d){s.service==="gateway"&&Array.isArray(s.urls)&&(s.urls=s.urls.map(f=>f.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:nS.RECORD_JOIN_CHANNEL_SERVICE,record:D_(D_({},s),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:nS.RECORD_JOIN_CHANNEL_SERVICE,record:s,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:nS.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:nS.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(s){this.dispatch({type:nS.AVOID_JOIN_START,avoidJoinStart:s})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new mR("client-leave",this._clientId),this._publishMutex=new mR("client-publish",this._clientId),this._renewTokenMutex=new mR("client-renewtoken",this._clientId),this._subscribeMutex=new mR("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),F.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(aO," build: ").concat(S7,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{u7(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(s){F.warning("[".concat(this._clientId,"] ").concat(s.toString()))}var a;this._statsCollector=new Q2(this.store),this._statsCollector.onStatsException=(s,d,f)=>{F.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(d,", uid: ").concat(f)),this.safeEmit(eS.EXCEPTION,{code:s,msg:d,uid:f})},this._statsCollector.onUploadPublishDuration=(s,d,f,m)=>{const _=this._users.find(y=>y.uid===s);_&&V_.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:f,peer:_._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new jpt(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||wT,httpRetryConfig:t.httpRetryConfig||wT,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new Ypt(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},yL("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new t6(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,a,s){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],f=arguments.length>6&&arguments[6]!==void 0&&arguments[6];RS("JOIN_GATEWAY_USE_443PORT_ONLY",d),RS("JOIN_GATEWAY_USE_DUAL_DOMAIN",f);const m=this._gateway.signal.websocket;return m instanceof e9&&(m.use443PortOnly=d,m.tryDoubleDomain=f),async function(_,y,T){qH.get(_)||qH.set(_,[]),zH.get(_)||zH.set(_,y),_N.get(_)||_N.set(_,0);const w=qH.get(_),L=zH.get(_);if(!w||!L)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(_N.get(_)===L){const _n=I2();w.push(_n),await _n.promise}_N.set(_,_N.get(_)+1);for(var B=arguments.length,Q=new Array(B>3?B-3:0),X=3;X<B;X++)Q[X-3]=arguments[X];const J=await T(...Q);return _N.set(_,_N.get(_)-1),_N.get(_)===L-1&&w.length>0&&(w[0].resolve(),w.shift()),_N.get(_)===0&&(qH.set(_,[]),zH.set(_,0),_N.set(_,0)),J}("client.join",aa("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,a,s)}async join(t,e,n,a,s){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const f=(QH||QH||(QH=(window.location.protocol.split(":")[0]||"").toUpperCase(),QH))==="HTTPS",m=q$()?window.isSecureContext:"Browser Not Support";(!q$()&&!f||!window.isSecureContext)&&F.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),F.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),V_.setAppId(t);try{if(!n&&n!==null)throw new _E(_i.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ZT(n,"token",1,2047),ZT(t,"appid",1,2047),v8(e),a&&y8(a),s&&ZT(s,"optionalInfo",1,2047)}catch(X){throw V_.reportApiInvoke(gM(),{name:OT.JOIN,options:[t,e,n,a],states:{isHttps:f,isSecureContext:m},tag:oT.TRACER}).onError(X),X}if(this._leaveMutex.isLocked&&(F.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),F.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const X=new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw V_.reportApiInvoke(gM(),{name:OT.JOIN,options:[t,e,n,a],states:{isHttps:f,isSecureContext:m},tag:oT.TRACER}).onError(X),X}this._gateway.state="CONNECTING";const _=await zrt({appId:t,cname:e,uid:a,stringUid:typeof a=="string"?a:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||gM();F.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(d)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const T=V_.reportApiInvoke(y,{id:this._clientId,name:OT.JOIN,options:[t,e,n,a],states:{isHttps:f,isSecureContext:m},tag:oT.TRACER}),w=HO(HO(HO({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:s,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:aa("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(w.stringUid=a,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async X=>{const J=function(_l){const _d=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),tu=new Uint8Array(new ArrayBuffer(_d.length));for(let _g=0;_g<_d.length;_g+=1)tu[_g]=_d.charCodeAt(_g);return tu}(),_n=await window.crypto.subtle.importKey("spki",J,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),_r=s7(X),ya=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},_n,_r);return function(_l){let _d="";for(let tu=0;tu<_l.length;tu+=1)_d+=String.fromCharCode(_l[tu]);return window.btoa(_d)}(new Uint8Array(ya))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const X=new TextEncoder,J=aa("USE_PURE_ENCRYPTION_MASTER_KEY")?X.encode(w.appId+this._encryptionSecret+this._encryptionSecret):X.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(_n,_r,ya){const _l=await window.crypto.subtle.importKey("raw",_r,"PBKDF2",!1,["deriveBits","deriveKey"]),_d=_n==="aes-128-gcm2"?128:256,tu=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:ttt,hash:"SHA-256",salt:ya},_l,_d+fht);return new Uint8Array(tu).subarray(_d/8)}(this._encryptionMode,J,EM(this._encryptionSalt)),this._encryptDataStreamKey=await async function(_n,_r,ya){const _l=await window.crypto.subtle.importKey("raw",_r,"PBKDF2",!1,["deriveBits","deriveKey"]),_d=_n==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:ttt,hash:"SHA-256",salt:ya},_l,{name:"AES-GCM",length:_d},!0,["encrypt","decrypt"])}(this._encryptionMode,J,EM(this._encryptionSalt))}else m?F.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):F.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,F.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:w.stringUid});const L=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&L===this._sessionId&&V_.joinChannelTimeout(this._sessionId,5)},5e3);try{var B;let X;const J=w.cloudProxyServer;if(T_(B=["proxy3","proxy4","proxy5"]).call(B,J)){const _d=aa("PROXY_SERVER_TYPE3");Array.isArray(_d)?w.proxyServer=_d[0]:w.proxyServer=_d}if(V_.setProxyServer(w.proxyServer),F.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(F.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),X={gatewayInfo:_.ap.gatewayInfo},aa("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)F.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const _d=(await Unt(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(tu=>({turnServerURL:tu.address,tcpport:tu.tcpport||uR.tcpport,udpport:tu.udpport||uR.udpport,username:tu.username||uR.username,password:tu.password||uR.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:_d}}Yrt(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let _d;[_d,X]=await A_.all([drt(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||wT,this.store),lrt(w,this._axiosCancelSource.token,this._config.httpRetryConfig||wT,!0,this.store)]),F.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(_d)),w.uid=_d,X.gatewayInfo.uid=_d,X.gatewayInfo.res.uid=_d}else X=await lrt(w,this._axiosCancelSource.token,this._config.httpRetryConfig||wT,!0,this.store);if(!this._joinAndNotLeaveYet)throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(H2.UPDATE_BITRATE_LIMIT,_d=>{this._p2pChannel.updateBitrateLimit(_d)}),this._configDistribute.on(H2.UPDATE_CLIENT_ROLE_OPTIONS,_d=>{this._setClientRoleOptions(_d)})},0),this._key=n||t;const _n=X.gatewayInfo,_r=w.uid?w.uid:_n.uid;this._joinInfo=HO(HO({},w),{},{cid:_n.cid,uid:_r,vid:_n.vid,apResponse:_n.res,apGatewayAddress:_n.apGatewayAddress,uni_lbs_ip:_n.uni_lbs_ip,gatewayAddrs:_n.gatewayAddrs}),this.store.intUid=_r,this.store.cid=_n.cid;const ya=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));T.onSuccess(ya),this._appId=t,this._channelName=w.cname,this._uid=ya,this.store.uid=ya,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(aR()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _l=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return F.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(_l)),setTimeout(()=>{F.startUpload()},5e3),this.store.joinEnd(),Q=this,T_(RM).call(RM,Q)||RM.push(Q),this._cloudProxyServerMode==="disabled"&&pS().supportWebCrypto&&aa("ENABLE_PRELOAD")&&w9(this._joinInfo),ya}catch(X){const J=Array.isArray(X)?X[0]:X;throw J&&J.code===_i.OPERATION_ABORTED?F.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),J):F.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),J),J.code!==_i.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),T.onError(J),J}var Q}_joinGateway(){if(!this._joinInfo||!this._key)throw new _E(_i.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!aa("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){F.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(aR()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=RM.indexOf(e);n!==-1&&RM.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return F.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",vS.LEAVE),F.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof e3))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new _E(_i.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new _E(_i.INVALID_OPERATION,"audience can not publish stream");for(const s of n){if(!(s instanceof e3))throw new _E(_i.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&e)throw new _E(_i.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}F.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(s=>{const d=this._configDistribute.getBitrateLimit();s instanceof zS&&d&&s.setBitrateLimit(d.uplink)});try{await this._publishHighStream(n),F.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(s=>"".concat(s.getTrackId()," "))))}catch(s){throw F.error("[".concat(this._clientId,"] publish error"),s.toString()),s}finally{a()}}async _publishDataChannel(t){IS(t.id,"id",0,65535,!0),pL(t.ordered,"ordered"),ZT(t.metadata,"metadata",0,512),F.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===t.id)!==-1)throw new _E(_i.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new _E(_i.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&aa("FORCE_TURN")&&!aa("TURN_ENABLE_TCP")&&!aa("TURN_ENABLE_UDP"))throw new _E(_i.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(s){return ert(s,!1)}(t),a=await this._p2pChannel.publishDataChannel([n]);if(a.length>0){if(typeof n._originDataChannelId!="number")throw F.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new _E(_i.CREATE_DATACHANNEL_ERROR);try{await A_.all(a.map(s=>this._uid&&this._gateway.publishDataChannel(this._uid,s,!0))),await n._waitTillOpen()}catch(s){if(s.code!==_i.DISCONNECT_P2P)throw s}}return F.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw F.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new _E(_i.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof e3))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);F.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(a=>"".concat(a.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(e);a&&await this._gateway.sendExtensionMessage(ET.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(e);a&&await this._gateway.unpublish(a,this._uid),F.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(s=>"".concat(s.getTrackId()))))}}catch(a){throw F.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),F.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),F.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(a=>"".concat(a.id))))}catch(n){throw F.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof jP)){const a=this.remoteUsers.find(s=>s.uid===t);if(!a)throw new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");t=a}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(MT(e,"mediaType",["audio","video"]),this.store.useP2P)throw new _E(_i.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===k_.AUDIO,a=e===k_.VIDEO,s=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:f,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(t,e,!0);if(d==null)throw new _E(_i.UNEXPECTED_RESPONSE,"no ssrc id");let T=this._users.find(L=>L.uid===t);T||(T=new jP(t,y||t),T._is_pre_created=!0,this._users.push(T)),_&&(T._cname=_),T._uintid||(T._uintid=y||t),n&&(T._audioSSRC=d,T._audio_pre_subscribed=!0,f&&(T._audioOrtc=f)),a&&(T._videoSSRC=d,T._video_pre_subscribed=!0,f&&(T._videoOrtc=f),m!=null&&(T._rtxSsrcId=m)),F.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(T,e,d,m,f);const w=n?T._audioTrack:T._videoTrack;if(!w)throw new _E(_i.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(T._trust_audio_stream_added_state_=!0,T._audio_added_=!0),a&&(T._trust_video_stream_added_state_=!0,T._video_added_=!0),w}catch(d){throw F.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{s()}}async _subscribeDataChannel(t,e){var n;if(IS(e,"channelId",0,65535,!0),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new _E(_i.INVALID_REMOTE_USER,"user is not published");const s=(n=t._dataChannels)===null||n===void 0?void 0:n.find(m=>m.id===e);if(!s)throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new _E(_i.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[s]);if(m&&T_(m).call(m,s.id))try{var f;if(typeof s._originDataChannelId!="number")throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new _E(_i.CREATE_DATACHANNEL_ERROR);const _={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(f=s.metadata)!==null&&f!==void 0?f:""};await this._gateway.subscribeDataChannel(t.uid,_,!0),await s._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==_i.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[s]),_;await this._p2pChannel.unsubscribeDataChannel(t,[s]),this._p2pChannel.setPendingRemoteDataChannel(t,s.id)}return F.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),s}finally{d()}}async _p2pSubscribe(t,e,n){if(MT(e,"mediaType",["audio","video"]),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new _E(_i.INVALID_REMOTE_USER,"user is not published");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const d=new _E(_i.REMOTE_USER_IS_NOT_PUBLISHED);throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),d}const s=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const f=e==="audio"?t._audioSSRC:t._videoSSRC,m=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,f,m)}catch(f){throw f}F.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(f=>{F.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const d=e==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new _E(_i.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw F.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{s()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(MT(e,"mediaType",["audio","video"]),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===t)){const y=new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),y}if(!t.hasAudio&&!t.hasVideo){const y=new _E(_i.INVALID_REMOTE_USER,"user is not published");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),y}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const y=new _E(_i.REMOTE_USER_IS_NOT_PUBLISHED);throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),y}let s=e==="audio"?t._audioSSRC:t._videoSSRC,d=e==="audio"?t._audioOrtc:t._videoOrtc,f=e==="video"?t._rtxSsrcId:void 0,m={stream_type:e==="audio"?k_.AUDIO:k_.VIDEO,ssrcId:s};const _=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const T=e==="audio"?t._audioSSRC:t._videoSSRC;T!==void 0&&T!==s&&(s=T,d=e==="audio"?t._audioOrtc:t._videoOrtc,f=e==="video"?t._rtxSsrcId:void 0,m={stream_type:e==="audio"?k_.AUDIO:k_.VIDEO,ssrcId:s}),_R.markSubscribeStart(this.store.clientId,s),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,s,f,d);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(t.uid,m,!0)}catch(w){if((w==null?void 0:w.code)!==_i.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),w;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(T){throw this._p2pChannel.reportSubscribeEvent(!1,T==null?void 0:T.code,t,e),T}F.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(T=>{F.warning("[".concat(this._clientId,"] auto set fallback failed"),T)});const y=e==="audio"?t._audioTrack:t._videoTrack;if(!y)throw new _E(_i.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw F.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),y),y}finally{_()}}async massSubscribe(t){if(fL(t,"subscribeList"),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,a=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const s=(t=[...t]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),d=await this._p2pChannel.globalLock();try{var f;for(let _=t.length-1;_>=0;_--){const y=t[_],{user:T,mediaType:w}=y;if(MT(w,"mediaType",["audio","video"]),!T){const X=new _E(_i.INVALID_PARAMS,"user property does not exist in subscribeList item");throw F.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),X}if(!this._users.find(X=>X===T)){const X=new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");F.error("[".concat(this._clientId,"] can not massSubscribe ").concat(T.uid,", this user is not in the channel")),s[_].error=X,t.splice(_,1);continue}if(w==="audio"&&(!T.hasAudio||T._audioSSRC===void 0)||w==="video"&&(!T.hasVideo||T._videoSSRC===void 0)){const X=new _E(_i.REMOTE_USER_IS_NOT_PUBLISHED);F.error("[".concat(this._clientId,"] can not subscribe ").concat(T.uid," with mediaType ").concat(w,", remote user is not published")),s[_].error=X,t.splice(_,1);continue}const B=BT.Video|BT.LwoVideo,Q=n.get(T);if(Q){if(w==="video"?Q&B:Q&BT.Audio){t.splice(_,1),F.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(T.uid,", mediaType:").concat(w," twice"));continue}n.set(T,Q|(w==="video"?B:BT.Audio))}else n.set(T,w==="video"?B:BT.Audio)}for(let _=t.length-1;_>=0;_--){const y=t[_],{user:T,mediaType:w}=y,L=BT.Video|BT.LwoVideo;if(this._p2pChannel.hasRemoteMedia(T,w)){await this._p2pChannel.unmuteRemoteNoLock(T,w);const B=n.get(T);n.set(T,w==="video"?B^L:B^BT.Audio),t.splice(_,1)}}this.store.massSubscribe(t.map(_=>({userId:_.user.uid,type:_.mediaType})),e);let m=LR(f=Array.from(n.entries())).call(f,(_,y)=>{let[T,w]=y;if(w===0)return _;const L={stream_id:T.uid,stream_type:w};return w&BT.Audio&&(L.audio_ssrc=T._audioSSRC),w&BT.Video&&(L.video_ssrc=T._videoSSRC),_.push(L),_},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(y=>{let{user:T,mediaType:w}=y;return{user:T,mediaType:w,ssrcId:w===k_.VIDEO?T._videoSSRC:T._audioSSRC,rtxSsrcId:w===k_.VIDEO?T._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(T=>{let{stream_id:w,video_error_code:L,audio_error_code:B,error_code:Q}=T;(L||B||Q)&&_.set(w,{video_error_code:L,audio_error_code:B,error_code:Q})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(T=>{let[w,L]=T;const B=this.remoteUsers.find(Q=>Q.uid===w);if(B){let Q;L.error_code||L.video_error_code&&L.audio_error_code?Q=void 0:L.video_error_code?Q=k_.VIDEO:L.audio_error_code&&(Q=k_.AUDIO),y.push({user:B,mediaType:Q})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of s){const T=_.get(y.user.uid);if(T){const w=T.error_code||y.mediaType==="audio"&&T.audio_error_code||y.mediaType==="video"&&T.video_error_code;if(w){const L=q2(w);F.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(L.desc)),y.error=new _E(_i.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(L.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(s.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),s.forEach(y=>{var T;V_.subscribe(this.store.sessionId,{succ:!!y.error,ec:((T=y.error)===null||T===void 0?void 0:T.code)||null,video:y.mediaType===k_.VIDEO,audio:y.mediaType===k_.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===k_.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),F.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(y=>{let{user:T,mediaType:w}=y;return"user: ".concat(T==null?void 0:T.uid,", mediaType: ").concat(w)}).join("; "))),s}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(t),_}}finally{d(),a()}}async unsubscribe(t,e,n){if(!(t instanceof jP)){const d=this.remoteUsers.find(f=>f.uid===t);if(!d)throw new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&MT(e,"mediaType",["audio","video"]),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}F.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const s=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const d=await this._p2pChannel.unsubscribe(t,e);d&&await this._gateway.unsubscribe(d,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&XH(this._users,t),F.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(d){if(d.code===_i.DISCONNECT_P2P)return void F.warning("disconnecting p2p, abort unsubscribe request.");throw F.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{s()}}async _unsubscribeDataChannel(t,e){if(e&&IS(e,"id",0,65535,!0),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new _E(_i.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}let a;if(typeof e=="number"){const s=t._dataChannels.find(d=>d.id===e);s&&(a=[s])}else a=t._dataChannels;if(a===void 0){const s=new _E(_i.REMOTE_USER_IS_NOT_PUBLISHED);throw F.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),s}F.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(t,a);s&&await this._gateway.unsubscribeDataChannel(s,t.uid),F.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===_i.DISCONNECT_P2P)return void F.warning("disconnecting p2p, abort unsubscribe request.");throw F.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}}async massUnsubscribe(t){if(fL(t,"unsubscribeList"),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");F.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:a,mediaType:s}=n;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(s,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:a,mediaType:s}=t[n];if(!a){const m=new _E(_i.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw F.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(MT(s,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===a)){F.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(n,1);continue}const f=BT.Video|BT.LwoVideo;if(e.has(a)){const m=e.get(a);let _;switch(s){case"video":_=m&f;break;case"audio":_=m&BT.Audio;break;default:_=m&(BT.Audio|f)}if(_){F.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(s," twice.")),t.splice(n,1);continue}s?s==="audio"?e.set(a,m|BT.Audio):s==="video"&&e.set(a,m|f):e.set(a,m|BT.Audio|f)}else s?s==="audio"?e.set(a,BT.Audio):s==="video"&&e.set(a,f):e.set(a,BT.Audio|f)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),F.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(a=>{let{user:s,mediaType:d}=a;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(d,";")}).join()))}catch(n){if(n.code===_i.DISCONNECT_P2P)return void F.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw F.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new t_(_i.INVALID_PARAMS);iT(n.width)||o7(n.width,"streamParameter.width"),iT(n.height)||o7(n.height,"streamParameter.height"),iT(n.framerate)||o7(n.framerate,"streamParameter.framerate"),iT(n.bitrate)||IS(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&F.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),F.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,u_.LocalVideoLowTrack)}async enableDualStream(){if(!pS().supportDualStream)throw V_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new _E(_i.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new _E(_i.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw V_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,V_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),F.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(u_.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw V_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,V_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),F.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(a){MT(a,"role",["audience","host"])}(t),e&&u7(e),this.mode==="rtc"||this.mode==="p2p")throw F.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new _E(_i.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new _E(_i.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new _E(_i.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&aa("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",sR.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),F.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&u7(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{F.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(ZT(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new _E(_i.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _E(_i.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,V_.setProxyServer(this._proxyServer),F.setProxyServer(this._proxyServer),F.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new _E(_i.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _E(_i.INVALID_OPERATION,"You have already set the proxy")}if(P2(t))return this._turnServer={servers:t,mode:"original-manual"},void F.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>k$(n)),this._turnServer={servers:t,mode:"manual"},F.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new _E(_i.INVALID_OPERATION,"you should set license before join channel");if(ZT(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new _E(_i.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,F.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new _E(_i.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new _E(_i.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new _E(_i.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new _E(_i.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,F.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new _E(_i.INVALID_OPERATION,"Stop proxy server after leave channel");V_.setProxyServer(),F.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",F.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new _E(_i.INVALID_PARAMS,"accessPoints is required.");fL(t.accessPoints.serverList,"accessPoints.serverList"),ZT(t.accessPoints.domain,"accessPoints.domain");const e=(L,B)=>{IS(L,B,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _E(_i.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");aa("CLOSE_AFB_FOR_LOCAL_AP")&&(RS("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),RS("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=t.accessPoints.domain,d=t.accessPoints.serverList.map(L=>a.test(L)?"".concat(L.replace(/\./g,"-"),".").concat(s):L),f=d.map(L=>"".concat(L,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,RS("WEBCS_DOMAIN",f),RS("WEBCS_DOMAIN_BACKUP_LIST",f),RS("GATEWAY_DOMAINS",[s]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(fL(t.report.hostname,"report.hostname"),RS("EVENT_REPORT_DOMAIN",t.report.hostname[0]),RS("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(RS("EVENT_REPORT_DOMAIN",d[0]),RS("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),m=t.report.port),RS("STATS_COLLECTOR_PORT",m),t.report?RS("ENABLE_EVENT_REPORT",!0):RS("ENABLE_EVENT_REPORT",!1);let _="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(fL(t.log.hostname,"log.hostname"),_=t.log.hostname[0]):_=d[0];let y=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),y=t.log.port),RS("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let T=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(fL(t.cds.hostname,"cds.hostname"),T=t.cds.hostname):T=d;let w=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),w=t.cds.port),RS("CDS_AP",T.map(L=>"".concat(L,":").concat(w))),t.cds?RS("ENABLE_CONFIG_DISTRIBUTE",!0):RS("ENABLE_CONFIG_DISTRIBUTE",!1),F.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(fL(t,"serverList"),ZT(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _E(_i.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(a=>n.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(e):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,RS("WEBCS_DOMAIN",t),RS("WEBCS_DOMAIN_BACKUP_LIST",t),RS("GATEWAY_DOMAINS",[e]),RS("EVENT_REPORT_DOMAIN",t[0]),RS("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),RS("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),F.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(MT(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw F.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else F.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){MT(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(a=>a.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw F.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}F.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){MT(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw F.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}F.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,a){(function(d){MT(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ZT(e,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(T_(s).call(s,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new _E(_i.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new _E(_i.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(pL(a,"encryptDataStream"),!T_(s).call(s,t))throw new _E(_i.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||F.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=NP(n))}async renewToken(t){if(ZT(t,"token",1,2047),!this._key||!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(aa("USE_NEW_TOKEN")){F.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await Wpt(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wT);F.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else F.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});F.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=e,this._joinInfo.token=e,F.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?F.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(eS.VOLUME_INDICATOR,t)},aa("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new _E(_i.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new _E(_i.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new _E(_i.LIVE_STREAMING_TASK_CONFLICT);const n=e?gL.TRANSCODE:gL.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(gL.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new _E(_i.INVALID_PARAMS,"can not find live streaming url to stop");await A_.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){_rt(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){_rt(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof t6&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const s=new TextEncoder;t.payload=s.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&T_(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(a=!0,t.payload=await async function(s,d,f){var m;const _=LR(m=Array.from(f)).call(m,(X,J)=>X+J,0),y={serverTs:0,seq:mht++,length:f.length,checkSum:_},T=new Uint8Array(B$(_,2)),w=new ArrayBuffer(XV),L=new DataView(w);L.setUint32(0,y.serverTs),L.setUint16(4,y.seq),L.setUint16(6,y.length),L.setUint16(8,y.checkSum);const B=16-f.length%16;f=M$(f,new Uint8Array(B));const Q=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:$$,additionalData:T},d,f);return M$(new Uint8Array(w),new Uint8Array(Q))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new _E(_i.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(X_.DATA_STREAM,{payload:NP(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-nft},!n)}sendMetadata(t){if(!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new _E(_i.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(X_.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:NP(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Rht),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"can not send custom report, not joined");await V_.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){MT(e.spatialLayer,"spatialLayer",[0,1,2,3]),MT(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw F.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(pL(e,"apRTM"),IS(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,F.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(F.debug("[".concat(this._clientId,"] reset client")),function(t){const e=s3.indexOf(t);e!==-1&&s3.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=WR.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Wrt(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&V_.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new mR("client-publish",this._clientId),this._subscribeMutex=new mR("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const a=t||gM();t?F.debug("[".concat(this._clientId,"] new Session ").concat(a)):F.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const s=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,V_.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:this.role==="audience"?2:1};V_.sessionInit(this._sessionId,HO({cname:e.channel,appid:e.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new _E(_i.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&aa("FORCE_TURN")&&!aa("TURN_ENABLE_TCP")&&!aa("TURN_ENABLE_UDP"))throw new _E(_i.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");F.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await n.next()).value;if(a){try{await this._gateway.sendExtensionMessage(ET.PUBLISH,a,!0)}catch(s){throw n.throw(s),s}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await n.next()).value;if(a){var e;let s;try{s=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==_i.DISCONNECT_P2P)throw n.throw(d),d}await n.next(((e=s)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const s of t)s instanceof zS&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig).catch(d=>{F.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===_i.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new _E(_i.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _E(_i.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));F.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await n.next()).value;if(a){var e;let s;try{s=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==_i.DISCONNECT_P2P)throw n.throw(d),d}n.next(((e=s)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===_i.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new _E(_i.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},yL("LiveStreaming").create(a));var a;return n.onLiveStreamError=(s,d)=>{V_.reportApiInvoke(this._sessionId,{name:OT.ON_LIVE_STREAM_ERROR,options:[s,d],tag:oT.TRACER}).onSuccess(),this.safeEmit(eS.LIVE_STREAMING_ERROR,s,d)},n.onLiveStreamWarning=(s,d)=>{V_.reportApiInvoke(this._sessionId,{name:OT.ON_LIVE_STREAM_WARNING,options:[s,d],tag:oT.TRACER}).onSuccess(),this.safeEmit(eS.LIVE_STREAMING_WARNING,s,d)},n.on($7.REQUEST_WORKER_MANAGER_LIST,(s,d,f)=>{if(!this._joinInfo)return f(new _E(_i.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,T){const w=aa("UAP_AP").slice(0,aa("AJAX_REQUEST_CONCURRENT")).map(L=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(L+"/api/v1?action=uap"):"https://".concat(L,"/api/v1?action=uap"));return await Fpt(w,m,_,y,T)})(s,this._joinInfo,this._axiosCancelSource.token,wT).then(d).catch(f)}),n};return t===gL.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new _E(_i.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},yL("ChannelMediaRelay").create(t));a.on("state",s=>{s===f0.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(eS.CHANNEL_MEDIA_RELAY_STATE,s)}),a.on("event",s=>{this.safeEmit(eS.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(s,d)=>{var f;s==="resolution"&&((f=this._channelMediaRelayClient)===null||f===void 0||f.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:a}=t,s=[];if(e){const d=[];this._users.forEach(f=>{f._dataChannels.forEach(m=>{n.every(_=>_.uid!==f._uintid||_.stream_id!==m.id)&&d.push({uid:f._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(n)&&n.length>0&&n.forEach(d=>{const{uid:f,stream_id:m,ordered:_,max_retrans_times:y,metadata:T}=d,w=this._users.find(L=>L._uintid===f);if(!w)return void F.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(F.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(f)),T_(s).call(s,w)||s.push(w),w._uintid||(w._uintid=f),w._dataChannels.findIndex(L=>L.id===d.stream_id)===-1){const L={id:m,ordered:!!_,maxRetransmits:y,metadata:T},B=function(Q){return ert(Q,!0)}(L);w._dataChannels.push(B),F.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),e||this.safeEmit(eS.USER_PUBLISHED,w,"datachannel",L)}this._p2pChannel.hasPendingRemoteDataChannel(w,d.stream_id)&&(F.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,d.stream_id).catch(L=>{F.error("[".concat(this._clientId,"] resubscribe datachannel error"),L.toString())}))}),e&&(this.safeEmit(eS.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:f,stream_id:m}=d,_=this._users.find(T=>T._uintid===f);if(!_)return void F.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(T=>T.id===d.stream_id);y&&(F.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(f)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(T=>{if(_._dataChannels=_._dataChannels.filter(w=>w!==y),T)return this._gateway.unsubscribeDataChannel(T,_.uid)}),F.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(eS.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){F.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(a=>{this.safeEmit(eS.USER_UNPUBLISHED,e,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,e.uid)}),n()}}else F.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(zT.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void F.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(a=>{const{value:s,type:d,expires:f}=e[a];f&&f<=n||d||K7()||!Object.prototype.hasOwnProperty.call(t8,a)||(AI[a]=s,qS[a]=s,F.debug("Update gateway parameters from config distribute",a,s))})}catch(e){F.error("Error update config from local cache",e.message)}})()}),this._gateway.on(zT.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(zT.CONNECTION_STATE_CHANGE,(t,e,n)=>{var a;if(n===vS.FALLBACK)return;const s=()=>{this.safeEmit(eS.CONNECTION_STATE_CHANGE,t,e,n)};if(V_.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:OT.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:oT.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),F.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void s();if(t==="RECONNECTING")this._users.forEach(f=>{f._trust_in_room_=!1,f._trust_audio_enabled_state_=!1,f._trust_video_enabled_state_=!1,f._trust_audio_mute_state_=!1,f._trust_video_mute_state_=!1,f._trust_audio_stream_added_state_=!1,f._trust_video_stream_added_state_=!1,f._is_pre_created||(f._audio_pre_subscribed||(f._audioSSRC=void 0,f._audioOrtc=void 0),f._video_pre_subscribed||(f._videoSSRC=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0),f._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((f,m)=>{this._gateway.setStreamFallbackOption(m,f).catch(_=>{F.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((f,m)=>{this._gateway.setRemoteVideoStreamType(m,f).catch(_=>{F.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{F.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(f=>{F.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(f))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(f=>!f._trust_in_room_).forEach(f=>{F.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(f.uid)),this._handleUserOffline({uid:f.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(f=>{f._trust_audio_mute_state_||(F.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,k_.AUDIO,!1)),f._trust_video_mute_state_||(F.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(f.uid)),this._handleMuteStream(f.uid,k_.VIDEO,!1)),f._trust_audio_enabled_state_||(F.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(f.uid)),this._handleSetStreamLocalEnable("audio",f.uid,!0)),f._trust_video_enabled_state_||(F.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(f.uid)),this._handleSetStreamLocalEnable("video",f.uid,!0)),f._trust_video_stream_added_state_||(F.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(f.uid)),this._handleResetAddStream(f,"video")),f._trust_audio_stream_added_state_||(F.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(f.uid)),this._handleResetAddStream(f,"audio")),f._video_added_||f._audio_added_||(F.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(f.uid)),this._handleRemoveStream({uid:f.uid,uint_id:f._uintid}))}))},1e3))}s()}),this._gateway.on(zT.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new _E(_i.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const a=await zrt(HO(HO({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(n=a.ap,Yrt(a),this._joinInfo.preload=!0):(n=await m9(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wT,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const s=[];n.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:f}=d;const[m,_]=f.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):s.push({host:m,port:_})}),t(s)}catch(n){e(n)}}),this._gateway.on(zT.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(eS.NETWORK_QUALITY,t)}),this._gateway.on(zT.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(eS.STREAM_TYPE_CHANGED,t,e),V_.reportApiInvoke(this._sessionId,{name:OT.STREAM_TYPE_CHANGE,options:[t,e],tag:oT.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(zT.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(zT.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let a=await this._p2pChannel.getEstablishParams();aa("ENABLE_PREALLOC_PC")&&a||(a=await this._p2pChannel.startP2PConnection(t)),e(a)}catch(a){n(a)}}),this._gateway.on(zT.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:F.debug("no attributes in joinResponse");const a=Hnt(t.ortc,e,n);this._p2pChannel.connect(a)}),this._gateway.on(zT.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var a;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:s,cid:d}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(d,"_").concat(s),icePwd:"".concat(d,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=aa("FINGERPRINT"))!==null&&a!==void 0?a:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(rS.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(rS.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(rS.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(rS.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(rS.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(rS.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(rS.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(rS.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(rS.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,k_.AUDIO,!0)),this._gateway.signal.on(rS.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,k_.AUDIO,!1)),this._gateway.signal.on(rS.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,k_.VIDEO,!0)),this._gateway.signal.on(rS.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,k_.VIDEO,!1)),this._gateway.signal.on(rS.RECEIVE_METADATA,t=>{const e=EM(t.metadata);this.safeEmit(eS.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(rS.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=EM(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&T_(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<XV)throw new _E(_i.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(XV));n=await async function(d,f,m){const _=m.subarray(0,XV),y=_.slice(8,XV),T=(y[0]<<8)+y[1],w=(_[6]<<8)+_[7],L=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:$$,additionalData:new Uint8Array(B$(T,2))},f,m.subarray(XV));return new Uint8Array(L).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let a=0;if(t.ordered||t.syncWithAudio){const s=this._p2pChannel.getStats(),d=this.remoteUsers.find(m=>m.uid===t.uid),f=s==null?void 0:s.audioRecv.find(m=>m.ssrc===(d==null?void 0:d._audioSSRC));a=f==null?void 0:f.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),ift(HO(HO({},t),{},{payload:n}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(rS.ON_CRYPT_ERROR,()=>{IP(()=>{F.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(eS.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(rS.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(rS.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{F.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,vS.TOKEN_EXPIRE),this.safeEmit(eS.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(rS.ON_STREAM_FALLBACK_UPDATE,t=>{F.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(eS.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(rS.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),F.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(rS.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(rS.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Q_.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case X_.PUBLISH:{if(!e)return;const s=e.ortc;if(s){var n,a;const d=s.some(_=>{let{stream_type:y}=_;return y===bS.Audio}),f=s.some(_=>{let{stream_type:y}=_;return y!==bS.Audio}),m=s.some(_=>{let{stream_type:y}=_;return y===bS.Screen||y===bS.ScreenLow});e.state==="offer"&&V_.publish(this._joinInfo.sid,{eventElapse:_R.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:_i.TIMEOUT,audio:d,video:f,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(n=s.find(_=>{let{stream_type:y}=_;return y===bS.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:f?(a=s.find(_=>{let{stream_type:y}=_;return y!==bS.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case X_.SUBSCRIBE:e&&V_.subscribe(this._joinInfo.sid,{succ:!1,ec:_i.TIMEOUT,audio:e.stream_type===k_.AUDIO,video:e.stream_type===k_.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:_R.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(rS.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(rS.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;aa("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(a=>!AM(a.string_id||a.stream_id,this.channelName)));const e=[],n=[];for(const a of t.users){let s=this._users.find(T=>T._uintid===a.stream_id);s?s._trust_in_room_=!0:(s=new jP(a.string_id||a.stream_id,a.stream_id),this._users.push(s),this.getListeners(eS.PUBLISHED_USER_LIST).length===0&&(F.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(eS.USER_JOINED,s)));const d=BT.Audio&a.stream_type,f=(BT.Video|BT.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,_=d&&s.hasAudio,y=f&&s.hasVideo;f&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=a.video_ssrc,s._rtxSsrcId=a.video_rtx),d&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=a.audio_ssrc),d&&!_&&this.getListeners(eS.PUBLISHED_USER_LIST).length===0&&(F.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.safeEmit(eS.USER_PUBLISHED,s,"audio")),f&&!y&&this.getListeners(eS.PUBLISHED_USER_LIST).length===0&&(F.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.safeEmit(eS.USER_PUBLISHED,s,"video")),(d&&!_||f&&!y||m)&&e.push(s),f&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&n.push({user:s,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&n.push({user:s,mediaType:"audio"})}n.length>0&&(F.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(a=>{F.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(eS.PUBLISHED_USER_LIST).length>0?aa("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(F.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(a=>a.uid).join(", "))),this.safeEmit(eS.PUBLISHED_USER_LIST,e)):F.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(rS.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof t6&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var a;return T_(a=Object.keys(e8)).call(a,n)}))})}_handleP2PEvents(){this._gateway.signal.on(rS.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ET.PUBLISH,(t,e,n)=>{const{uid:a}=t;t.forEach(s=>{const{kind:d,ssrcs:f,mid:m,isMuted:_}=s;this._handleP2PAddAudioOrVideoStream(d,a,f[0].ssrcId,m);const y=this._users.find(T=>T.uid===a);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,d,f[0].ssrcId,m).then(()=>{e()}).catch(n):e(),this._handleMuteStream(a,d,!!_)})}),this._gateway.signal.on(ET.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var a;e(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(s){n(s)}}),this._gateway.signal.on(Q_.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(ET.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:a,uid:s}=t,d=this._users.find(f=>f.uid===s);if(!d)return F.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void e();try{a.forEach(async f=>{let{stream_type:m}=f;const _=m===bS.Audio?k_.AUDIO:k_.VIDEO;await this._p2pChannel.unsubscribe(d,_),this._handleMuteStream(s,_,!0)}),e()}catch(f){n(f)}}}),this._gateway.signal.on(ET.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case LP.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,k_.VIDEO,!0);break;case LP.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,k_.AUDIO,!0);break;case LP.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,k_.VIDEO,!1);break;case LP.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,k_.AUDIO,!1)}}),this._gateway.signal.on(ET.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:s}=t;a!==jR.SEND_ONLY||s?e(await this._p2pChannel.restartICE(a,s)):(this._p2pChannel.handleDisconnect(a),e())}catch(a){n(a)}}),this._gateway.signal.on(ET.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(H_.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:a}=t;e(await this._gateway.sendExtensionMessage(ET.RESTART_ICE,t,a===jR.SEND_ONLY))}catch(a){n(a)}}),this._p2pChannel.on(H_.LocalCandidate,t=>{this._gateway.sendExtensionMessage(ET.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(H_.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(ET.CONTROL,t,!0),e()}catch(a){n(a)}}),this._p2pChannel.on(H_.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(a){a.code===_i.DISCONNECT_P2P?e():n(a)}else e()}),this._p2pChannel.on(H_.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(a){a.code===_i.DISCONNECT_P2P?e():n(a)}else e()}),this._p2pChannel.on(H_.StateChange,(t,e)=>{e===yS.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(H_.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(eS.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(H_.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(a){a.code===_i.DISCONNECT_P2P?e():n(a)}else e()}),this._p2pChannel.on(H_.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(a){a.code===_i.DISCONNECT_P2P?e():n(a)}else e()}),this._p2pChannel.on(H_.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(H_.RequestRePublishDataChannel,(t,e,n)=>{A_.all(t.map(async a=>{const s=await this._p2pChannel.publishDataChannel([a]);try{s.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==_i.DISCONNECT_P2P)throw d}})).then(e).catch(n)}),this._p2pChannel.on(H_.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:a,kind:s}of t)s===k_.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");e()}catch(a){n(a)}}),this._p2pChannel.on(H_.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(H_.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(H_.MediaReconnectStart,t=>{this.safeEmit(eS.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(H_.MediaReconnectEnd,t=>{this.safeEmit(eS.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(H_.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(H_.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const a=n.value;let s;try{s=await this._gateway.restartICE({iceParameters:a})}catch(f){return void e.throw(f)}const{iceParameters:d}=function(f){const m=f.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(s);await e.next({remoteIceParameters:d})}),this._p2pChannel.on(H_.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(H_.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:s,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:a}),f=Hnt(s,d);await this._p2pChannel.connect(f),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(H_.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(H_.P2PLost,()=>{this.safeEmit(eS.P2P_LOST,this.store.uid)}),this._p2pChannel.on(H_.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(H_.ConnectionTypeChange,t=>{this.safeEmit(eS.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(H_.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(H_.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(H_.AudioMetadata,t=>{this.safeEmit(eS.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},yL("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:a,cname:s,sid:d,token:f,uid:m,cid:_,vid:y}=this._joinInfo;await n.init({appId:a,areaCode:"",cname:s,sid:d,token:f,uid:m,cid:_,vid:y?Number(y):0},wT)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(KT.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(eS.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===VO.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(eS.CONTENT_INSPECT_ERROR,new _E(_i.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(KT.INSPECT_RESULT,(e,n)=>{var a;if((n==null?void 0:n.code)===_i.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return F.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(eS.CONTENT_INSPECT_RESULT,e,n)}),t.on(KT.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(pL(t,"enabled"),t){if(!e)throw new _E(_i.INVALID_PARAMS,"config is required");if(sit(e),!this._joinInfo)throw new _E(_i.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const a=(n={config:e},yL("ImageModeration").create(n));this._moderation=a,this.handleImageModerationEvents(a);const{appId:s,cname:d,sid:f,token:m,uid:_,cid:y,vid:T}=this._joinInfo;await a.init({appId:s,areaCode:"",cname:d,sid:f,token:m,uid:_,cid:y,vid:T?Number(T):0},wT)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var n;if(!this._moderation)throw new _E(_i.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(wI.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(eS.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===uO.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new _E(_i.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(wI.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){MT(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new _E(_i.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,F.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return F.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){pL(t,"enabled"),RS("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},U_(I_.prototype,"leave",[cit],Object.getOwnPropertyDescriptor(I_.prototype,"leave"),I_.prototype),U_(I_.prototype,"publish",[uit],Object.getOwnPropertyDescriptor(I_.prototype,"publish"),I_.prototype),U_(I_.prototype,"unpublish",[lit],Object.getOwnPropertyDescriptor(I_.prototype,"unpublish"),I_.prototype),U_(I_.prototype,"subscribe",[dit],Object.getOwnPropertyDescriptor(I_.prototype,"subscribe"),I_.prototype),U_(I_.prototype,"presubscribe",[hit],Object.getOwnPropertyDescriptor(I_.prototype,"presubscribe"),I_.prototype),U_(I_.prototype,"massSubscribe",[pit],Object.getOwnPropertyDescriptor(I_.prototype,"massSubscribe"),I_.prototype),U_(I_.prototype,"unsubscribe",[fit],Object.getOwnPropertyDescriptor(I_.prototype,"unsubscribe"),I_.prototype),U_(I_.prototype,"massUnsubscribe",[mit],Object.getOwnPropertyDescriptor(I_.prototype,"massUnsubscribe"),I_.prototype),U_(I_.prototype,"setLowStreamParameter",[Eit],Object.getOwnPropertyDescriptor(I_.prototype,"setLowStreamParameter"),I_.prototype),U_(I_.prototype,"enableDualStream",[git],Object.getOwnPropertyDescriptor(I_.prototype,"enableDualStream"),I_.prototype),U_(I_.prototype,"disableDualStream",[_it],Object.getOwnPropertyDescriptor(I_.prototype,"disableDualStream"),I_.prototype),U_(I_.prototype,"setClientRole",[vit],Object.getOwnPropertyDescriptor(I_.prototype,"setClientRole"),I_.prototype),U_(I_.prototype,"_setClientRoleOptions",[yit],Object.getOwnPropertyDescriptor(I_.prototype,"_setClientRoleOptions"),I_.prototype),U_(I_.prototype,"setProxyServer",[bit],Object.getOwnPropertyDescriptor(I_.prototype,"setProxyServer"),I_.prototype),U_(I_.prototype,"setTurnServer",[Sit],Object.getOwnPropertyDescriptor(I_.prototype,"setTurnServer"),I_.prototype),U_(I_.prototype,"setLicense",[Tit],Object.getOwnPropertyDescriptor(I_.prototype,"setLicense"),I_.prototype),U_(I_.prototype,"startProxyServer",[Rit],Object.getOwnPropertyDescriptor(I_.prototype,"startProxyServer"),I_.prototype),U_(I_.prototype,"stopProxyServer",[Ait],Object.getOwnPropertyDescriptor(I_.prototype,"stopProxyServer"),I_.prototype),U_(I_.prototype,"setLocalAccessPointsV2",[Cit],Object.getOwnPropertyDescriptor(I_.prototype,"setLocalAccessPointsV2"),I_.prototype),U_(I_.prototype,"setLocalAccessPoints",[Oit],Object.getOwnPropertyDescriptor(I_.prototype,"setLocalAccessPoints"),I_.prototype),U_(I_.prototype,"setRemoteDefaultVideoStreamType",[wit],Object.getOwnPropertyDescriptor(I_.prototype,"setRemoteDefaultVideoStreamType"),I_.prototype),U_(I_.prototype,"setRemoteVideoStreamType",[Iit],Object.getOwnPropertyDescriptor(I_.prototype,"setRemoteVideoStreamType"),I_.prototype),U_(I_.prototype,"setStreamFallbackOption",[Nit],Object.getOwnPropertyDescriptor(I_.prototype,"setStreamFallbackOption"),I_.prototype),U_(I_.prototype,"setEncryptionConfig",[Dit],Object.getOwnPropertyDescriptor(I_.prototype,"setEncryptionConfig"),I_.prototype),U_(I_.prototype,"renewToken",[kit],Object.getOwnPropertyDescriptor(I_.prototype,"renewToken"),I_.prototype),U_(I_.prototype,"enableAudioVolumeIndicator",[Lit],Object.getOwnPropertyDescriptor(I_.prototype,"enableAudioVolumeIndicator"),I_.prototype),U_(I_.prototype,"startLiveStreaming",[Pit],Object.getOwnPropertyDescriptor(I_.prototype,"startLiveStreaming"),I_.prototype),U_(I_.prototype,"setLiveTranscoding",[Mit],Object.getOwnPropertyDescriptor(I_.prototype,"setLiveTranscoding"),I_.prototype),U_(I_.prototype,"stopLiveStreaming",[xit],Object.getOwnPropertyDescriptor(I_.prototype,"stopLiveStreaming"),I_.prototype),U_(I_.prototype,"startChannelMediaRelay",[Uit],Object.getOwnPropertyDescriptor(I_.prototype,"startChannelMediaRelay"),I_.prototype),U_(I_.prototype,"updateChannelMediaRelay",[jit],Object.getOwnPropertyDescriptor(I_.prototype,"updateChannelMediaRelay"),I_.prototype),U_(I_.prototype,"stopChannelMediaRelay",[Vit],Object.getOwnPropertyDescriptor(I_.prototype,"stopChannelMediaRelay"),I_.prototype),U_(I_.prototype,"sendCustomReportMessage",[Bit],Object.getOwnPropertyDescriptor(I_.prototype,"sendCustomReportMessage"),I_.prototype),U_(I_.prototype,"pickSVCLayer",[Fit],Object.getOwnPropertyDescriptor(I_.prototype,"pickSVCLayer"),I_.prototype),U_(I_.prototype,"setRTMConfig",[Git],Object.getOwnPropertyDescriptor(I_.prototype,"setRTMConfig"),I_.prototype),U_(I_.prototype,"enableContentInspect",[Hit],Object.getOwnPropertyDescriptor(I_.prototype,"enableContentInspect"),I_.prototype),U_(I_.prototype,"disableContentInspect",[qit],Object.getOwnPropertyDescriptor(I_.prototype,"disableContentInspect"),I_.prototype),U_(I_.prototype,"setImageModeration",[zit],Object.getOwnPropertyDescriptor(I_.prototype,"setImageModeration"),I_.prototype),U_(I_.prototype,"setP2PTransport",[Kit],Object.getOwnPropertyDescriptor(I_.prototype,"setP2PTransport"),I_.prototype),U_(I_.prototype,"getJoinChannelServiceRecords",[Wit],Object.getOwnPropertyDescriptor(I_.prototype,"getJoinChannelServiceRecords"),I_.prototype),U_(I_.prototype,"setPublishAudioFilterEnabled",[Yit],Object.getOwnPropertyDescriptor(I_.prototype,"setPublishAudioFilterEnabled"),I_.prototype),I_);class r6{constructor(e,n){_t(this,"id",0),_t(this,"element",void 0),_t(this,"peerPair",void 0),_t(this,"context",void 0),_t(this,"audioPlayerElement",void 0),_t(this,"audioTrack",void 0),r6.count+=1,this.id=r6.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(a,s)=>{const d=s==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new A_(f=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&f(a.localDescription)}})},n=async(a,s)=>await a.setRemoteDescription(s);try{const a=await e(this.peerPair[0],"offer");await n(this.peerPair[1],a);const s=await e(this.peerPair[1],"answer");await n(this.peerPair[0],s)}catch(a){throw new _E(_i.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(s){throw new _E(_i.LOCAL_AEC_ERROR,s.toString()).print()}if(!n)throw new _E(_i.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=n.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){F.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Jit,W8;_t(r6,"count",0);const bft=window.AudioContext||window.webkitAudioContext,Sft=new(Jit=K_({report:V_}),U_((W8=class{constructor(){_t(this,"units",[]),_t(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return F.debug("the system does not need to process local aec"),-1;this.context||(this.context=new bft);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new r6(t,this.context),this.units.push(e)),e.startEchoCancellation(),F.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return lS().name!==mS.SAFARI}}).prototype,"processExternalMediaAEC",[Jit],Object.getOwnPropertyDescriptor(W8.prototype,"processExternalMediaAEC"),W8.prototype),W8);function Zit(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function Qit(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Zit(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zit(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}const D9=window||document;function $it(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!D9)return;const n=IT._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const a=s=>{if(!(s&&s.blockedURI&&(IT.onSecurityPolicyViolation||IT.getListeners(RN.SECURITY_POLICY_VIOLATION).length>0)))return;const d=s.blockedURI;aa("CSP_DETECTED_HOSTNAME_LIST").some(f=>T_(d).call(d,f))&&(IT.onSecurityPolicyViolation&&typeof IT.onSecurityPolicyViolation=="function"&&IT.onSecurityPolicyViolation(s),IT.getListeners(RN.SECURITY_POLICY_VIOLATION).length>0&&IT.safeEmit(RN.SECURITY_POLICY_VIOLATION,s))};n&&D9.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||IT.getListeners(RN.SECURITY_POLICY_VIOLATION).length>0)&&D9.addEventListener("securitypolicyviolation",a),IT._cspEventHandlerPointer=a}var Tft=$,Rft=PQ,tot=RegExp.prototype,Aft=function(t){return t===tot||Tft(tot,t)?Rft(t):t.flags},kR=h(Aft);function b3(t){let e=t.length;for(;--e>=0;)t[e]=0}const k9=256,eot=286,i6=30,o6=15,L9=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Y8=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Cft=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),not=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),TL=new Array(576);b3(TL);const a6=new Array(60);b3(a6);const s6=new Array(512);b3(s6);const c6=new Array(256);b3(c6);const P9=new Array(29);b3(P9);const X8=new Array(i6);function M9(t,e,n,a,s){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=a,this.max_length=s,this.has_stree=t&&t.length}let rot,iot,oot;function x9(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}b3(X8);const aot=t=>t<256?s6[t]:s6[256+(t>>>7)],u6=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},W0=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,u6(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},IN=(t,e,n)=>{W0(t,n[2*e],n[2*e+1])},sot=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},cot=(t,e,n)=>{const a=new Array(16);let s,d,f=0;for(s=1;s<=o6;s++)f=f+n[s-1]<<1,a[s]=f;for(d=0;d<=e;d++){let m=t[2*d+1];m!==0&&(t[2*d]=sot(a[m]++,m))}},uot=t=>{let e;for(e=0;e<eot;e++)t.dyn_ltree[2*e]=0;for(e=0;e<i6;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},lot=t=>{t.bi_valid>8?u6(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},dot=(t,e,n,a)=>{const s=2*e,d=2*n;return t[s]<t[d]||t[s]===t[d]&&a[e]<=a[n]},U9=(t,e,n)=>{const a=t.heap[n];let s=n<<1;for(;s<=t.heap_len&&(s<t.heap_len&&dot(e,t.heap[s+1],t.heap[s],t.depth)&&s++,!dot(e,a,t.heap[s],t.depth));)t.heap[n]=t.heap[s],n=s,s<<=1;t.heap[n]=a},hot=(t,e,n)=>{let a,s,d,f,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,s=t.pending_buf[t.sym_buf+m++],a===0?IN(t,s,e):(d=c6[s],IN(t,d+k9+1,e),f=L9[d],f!==0&&(s-=P9[d],W0(t,s,f)),a--,d=aot(a),IN(t,d,n),f=Y8[d],f!==0&&(a-=X8[d],W0(t,a,f)));while(m<t.sym_next);IN(t,256,e)},j9=(t,e)=>{const n=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,d=e.stat_desc.elems;let f,m,_,y=-1;for(t.heap_len=0,t.heap_max=573,f=0;f<d;f++)n[2*f]!==0?(t.heap[++t.heap_len]=y=f,t.depth[f]=0):n[2*f+1]=0;for(;t.heap_len<2;)_=t.heap[++t.heap_len]=y<2?++y:0,n[2*_]=1,t.depth[_]=0,t.opt_len--,s&&(t.static_len-=a[2*_+1]);for(e.max_code=y,f=t.heap_len>>1;f>=1;f--)U9(t,n,f);_=d;do f=t.heap[1],t.heap[1]=t.heap[t.heap_len--],U9(t,n,1),m=t.heap[1],t.heap[--t.heap_max]=f,t.heap[--t.heap_max]=m,n[2*_]=n[2*f]+n[2*m],t.depth[_]=(t.depth[f]>=t.depth[m]?t.depth[f]:t.depth[m])+1,n[2*f+1]=n[2*m+1]=_,t.heap[1]=_++,U9(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((T,w)=>{const L=w.dyn_tree,B=w.max_code,Q=w.stat_desc.static_tree,X=w.stat_desc.has_stree,J=w.stat_desc.extra_bits,_n=w.stat_desc.extra_base,_r=w.stat_desc.max_length;let ya,_l,_d,tu,_g,l_,O_=0;for(tu=0;tu<=o6;tu++)T.bl_count[tu]=0;for(L[2*T.heap[T.heap_max]+1]=0,ya=T.heap_max+1;ya<573;ya++)_l=T.heap[ya],tu=L[2*L[2*_l+1]+1]+1,tu>_r&&(tu=_r,O_++),L[2*_l+1]=tu,_l>B||(T.bl_count[tu]++,_g=0,_l>=_n&&(_g=J[_l-_n]),l_=L[2*_l],T.opt_len+=l_*(tu+_g),X&&(T.static_len+=l_*(Q[2*_l+1]+_g)));if(O_!==0){do{for(tu=_r-1;T.bl_count[tu]===0;)tu--;T.bl_count[tu]--,T.bl_count[tu+1]+=2,T.bl_count[_r]--,O_-=2}while(O_>0);for(tu=_r;tu!==0;tu--)for(_l=T.bl_count[tu];_l!==0;)_d=T.heap[--ya],_d>B||(L[2*_d+1]!==tu&&(T.opt_len+=(tu-L[2*_d+1])*L[2*_d],L[2*_d+1]=tu),_l--)}})(t,e),cot(n,y,t.bl_count)},pot=(t,e,n)=>{let a,s,d=-1,f=e[1],m=0,_=7,y=4;for(f===0&&(_=138,y=3),e[2*(n+1)+1]=65535,a=0;a<=n;a++)s=f,f=e[2*(a+1)+1],++m<_&&s===f||(m<y?t.bl_tree[2*s]+=m:s!==0?(s!==d&&t.bl_tree[2*s]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=s,f===0?(_=138,y=3):s===f?(_=6,y=3):(_=7,y=4))},fot=(t,e,n)=>{let a,s,d=-1,f=e[1],m=0,_=7,y=4;for(f===0&&(_=138,y=3),a=0;a<=n;a++)if(s=f,f=e[2*(a+1)+1],!(++m<_&&s===f)){if(m<y)do IN(t,s,t.bl_tree);while(--m!=0);else s!==0?(s!==d&&(IN(t,s,t.bl_tree),m--),IN(t,16,t.bl_tree),W0(t,m-3,2)):m<=10?(IN(t,17,t.bl_tree),W0(t,m-3,3)):(IN(t,18,t.bl_tree),W0(t,m-11,7));m=0,d=s,f===0?(_=138,y=3):s===f?(_=6,y=3):(_=7,y=4)}};let mot=!1;const Eot=(t,e,n,a)=>{W0(t,0+(a?1:0),3),lot(t),u6(t,n),u6(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var Oft=t=>{mot||((()=>{let e,n,a,s,d;const f=new Array(16);for(a=0,s=0;s<28;s++)for(P9[s]=a,e=0;e<1<<L9[s];e++)c6[a++]=s;for(c6[a-1]=s,d=0,s=0;s<16;s++)for(X8[s]=d,e=0;e<1<<Y8[s];e++)s6[d++]=s;for(d>>=7;s<i6;s++)for(X8[s]=d<<7,e=0;e<1<<Y8[s]-7;e++)s6[256+d++]=s;for(n=0;n<=o6;n++)f[n]=0;for(e=0;e<=143;)TL[2*e+1]=8,e++,f[8]++;for(;e<=255;)TL[2*e+1]=9,e++,f[9]++;for(;e<=279;)TL[2*e+1]=7,e++,f[7]++;for(;e<=287;)TL[2*e+1]=8,e++,f[8]++;for(cot(TL,287,f),e=0;e<i6;e++)a6[2*e+1]=5,a6[2*e]=sot(e,5);rot=new M9(TL,L9,257,eot,o6),iot=new M9(a6,Y8,0,i6,o6),oot=new M9(new Array(0),Cft,0,19,7)})(),mot=!0),t.l_desc=new x9(t.dyn_ltree,rot),t.d_desc=new x9(t.dyn_dtree,iot),t.bl_desc=new x9(t.bl_tree,oot),t.bi_buf=0,t.bi_valid=0,uot(t)},wft=(t,e,n,a)=>{let s,d,f=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<k9;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(t)),j9(t,t.l_desc),j9(t,t.d_desc),f=(m=>{let _;for(pot(m,m.dyn_ltree,m.l_desc.max_code),pot(m,m.dyn_dtree,m.d_desc.max_code),j9(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*not[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(t),s=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=s&&(s=d)):s=d=n+5,n+4<=s&&e!==-1?Eot(t,e,n,a):t.strategy===4||d===s?(W0(t,2+(a?1:0),3),hot(t,TL,a6)):(W0(t,4+(a?1:0),3),((m,_,y,T)=>{let w;for(W0(m,_-257,5),W0(m,y-1,5),W0(m,T-4,4),w=0;w<T;w++)W0(m,m.bl_tree[2*not[w]+1],3);fot(m,m.dyn_ltree,_-1),fot(m,m.dyn_dtree,y-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,f+1),hot(t,t.dyn_ltree,t.dyn_dtree)),uot(t),a&&lot(t)},Ift=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(c6[n]+k9+1)]++,t.dyn_dtree[2*aot(e)]++),t.sym_next===t.sym_end),Nft=t=>{W0(t,2,3),IN(t,256,TL),(e=>{e.bi_valid===16?(u6(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},Dft={_tr_init:Oft,_tr_stored_block:Eot,_tr_flush_block:wft,_tr_tally:Ift,_tr_align:Nft},l6=(t,e,n,a)=>{let s=65535&t|0,d=t>>>16&65535|0,f=0;for(;n!==0;){f=n>2e3?2e3:n,n-=f;do s=s+e[a++]|0,d=d+s|0;while(--f);s%=65521,d%=65521}return s|d<<16|0};const kft=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var BR=(t,e,n,a)=>{const s=kft,d=a+n;t^=-1;for(let f=a;f<d;f++)t=t>>>8^s[255&(t^e[f])];return-1^t},PM={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},J8={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Lft,_tr_stored_block:V9,_tr_flush_block:Pft,_tr_tally:GP,_tr_align:Mft}=Dft,{Z_NO_FLUSH:HP,Z_PARTIAL_FLUSH:xft,Z_FULL_FLUSH:Uft,Z_FINISH:qO,Z_BLOCK:got,Z_OK:QR,Z_STREAM_END:_ot,Z_STREAM_ERROR:NN,Z_DATA_ERROR:jft,Z_BUF_ERROR:B9,Z_DEFAULT_COMPRESSION:Vft,Z_FILTERED:Bft,Z_HUFFMAN_ONLY:Z8,Z_RLE:Fft,Z_FIXED:Gft,Z_DEFAULT_STRATEGY:Hft,Z_UNKNOWN:qft,Z_DEFLATED:Q8}=J8,F9=286,zft=30,Kft=19,Wft=2*F9+1,Yft=15,MM=258,DN=262,S3=42,xM=113,d6=666,UM=(t,e)=>(t.msg=PM[e],e),vot=t=>2*t-(t>4?9:0),qP=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Xft=t=>{let e,n,a,s=t.w_size;e=t.hash_size,a=e;do n=t.head[--a],t.head[a]=n>=s?n-s:0;while(--e);e=s,a=e;do n=t.prev[--a],t.prev[a]=n>=s?n-s:0;while(--e)};let zP=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const dO=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},hO=(t,e)=>{Pft(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,dO(t.strm)},dT=(t,e)=>{t.pending_buf[t.pending++]=e},h6=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},G9=(t,e,n,a)=>{let s=t.avail_in;return s>a&&(s=a),s===0?0:(t.avail_in-=s,e.set(t.input.subarray(t.next_in,t.next_in+s),n),t.state.wrap===1?t.adler=l6(t.adler,e,s,n):t.state.wrap===2&&(t.adler=BR(t.adler,e,s,n)),t.next_in+=s,t.total_in+=s,s)},yot=(t,e)=>{let n,a,s=t.max_chain_length,d=t.strstart,f=t.prev_length,m=t.nice_match;const _=t.strstart>t.w_size-DN?t.strstart-(t.w_size-DN):0,y=t.window,T=t.w_mask,w=t.prev,L=t.strstart+MM;let B=y[d+f-1],Q=y[d+f];t.prev_length>=t.good_match&&(s>>=2),m>t.lookahead&&(m=t.lookahead);do if(n=e,y[n+f]===Q&&y[n+f-1]===B&&y[n]===y[d]&&y[++n]===y[d+1]){d+=2,n++;do;while(y[++d]===y[++n]&&y[++d]===y[++n]&&y[++d]===y[++n]&&y[++d]===y[++n]&&y[++d]===y[++n]&&y[++d]===y[++n]&&y[++d]===y[++n]&&y[++d]===y[++n]&&d<L);if(a=MM-(L-d),d=L-MM,a>f){if(t.match_start=e,f=a,a>=m)break;B=y[d+f-1],Q=y[d+f]}}while((e=w[e&T])>_&&--s!=0);return f<=t.lookahead?f:t.lookahead},T3=t=>{const e=t.w_size;let n,a,s;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-DN)&&(t.window.set(t.window.subarray(e,e+e-a),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Xft(t),a+=e),t.strm.avail_in===0)break;if(n=G9(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=n,t.lookahead+t.insert>=3)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=zP(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=zP(t,t.ins_h,t.window[s+3-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<DN&&t.strm.avail_in!==0)},bot=(t,e)=>{let n,a,s,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,f=0,m=t.strm.avail_in;do{if(n=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,a=t.strstart-t.block_start,n>a+t.strm.avail_in&&(n=a+t.strm.avail_in),n>s&&(n=s),n<d&&(n===0&&e!==qO||e===HP||n!==a+t.strm.avail_in)))break;f=e===qO&&n===a+t.strm.avail_in?1:0,V9(t,0,0,f),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,dO(t.strm),a&&(a>n&&(a=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,n-=a),n&&(G9(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(f===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),f?4:e!==HP&&e!==qO&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(G9(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,d=s>t.w_size?t.w_size:s,a=t.strstart-t.block_start,(a>=d||(a||e===qO)&&e!==HP&&t.strm.avail_in===0&&a<=s)&&(n=a>s?s:a,f=e===qO&&t.strm.avail_in===0&&n===a?1:0,V9(t,t.block_start,n,f),t.block_start+=n,dO(t.strm)),f?3:1)},H9=(t,e)=>{let n,a;for(;;){if(t.lookahead<DN){if(T3(t),t.lookahead<DN&&e===HP)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=zP(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-DN&&(t.match_length=yot(t,n)),t.match_length>=3)if(a=GP(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=zP(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=zP(t,t.ins_h,t.window[t.strstart+1]);else a=GP(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(hO(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===qO?(hO(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(hO(t,!1),t.strm.avail_out===0)?1:2},R3=(t,e)=>{let n,a,s;for(;;){if(t.lookahead<DN){if(T3(t),t.lookahead<DN&&e===HP)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=zP(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-DN&&(t.match_length=yot(t,n),t.match_length<=5&&(t.strategy===Bft||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-3,a=GP(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=zP(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(hO(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=GP(t,0,t.window[t.strstart-1]),a&&hO(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=GP(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===qO?(hO(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(hO(t,!1),t.strm.avail_out===0)?1:2};function kN(t,e,n,a,s){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=a,this.func=s}const p6=[new kN(0,0,0,0,bot),new kN(4,4,8,4,H9),new kN(4,5,16,8,H9),new kN(4,6,32,32,H9),new kN(4,4,16,16,R3),new kN(8,16,32,32,R3),new kN(8,16,128,128,R3),new kN(8,32,128,256,R3),new kN(32,128,258,1024,R3),new kN(32,258,258,4096,R3)];function Jft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Wft),this.dyn_dtree=new Uint16Array(2*(2*zft+1)),this.bl_tree=new Uint16Array(2*(2*Kft+1)),qP(this.dyn_ltree),qP(this.dyn_dtree),qP(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Yft+1),this.heap=new Uint16Array(2*F9+1),qP(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*F9+1),qP(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const f6=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==S3&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==xM&&e.status!==d6?1:0},Sot=t=>{if(f6(t))return UM(t,NN);t.total_in=t.total_out=0,t.data_type=qft;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?S3:xM,t.adler=e.wrap===2?0:1,e.last_flush=-2,Lft(e),QR},Tot=t=>{const e=Sot(t);return e===QR&&(n=>{n.window_size=2*n.w_size,qP(n.head),n.max_lazy_match=p6[n.level].max_lazy,n.good_match=p6[n.level].good_length,n.nice_match=p6[n.level].nice_length,n.max_chain_length=p6[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},Rot=(t,e,n,a,s,d)=>{if(!t)return NN;let f=1;if(e===Vft&&(e=6),a<0?(f=0,a=-a):a>15&&(f=2,a-=16),s<1||s>9||n!==Q8||a<8||a>15||e<0||e>9||d<0||d>Gft||a===8&&f!==1)return UM(t,NN);a===8&&(a=9);const m=new Jft;return t.state=m,m.strm=t,m.status=S3,m.wrap=f,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=s+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<s+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=e,m.strategy=d,m.method=n,Tot(t)};var Zft=(t,e)=>{if(f6(t)||e>got||e<0)return t?UM(t,NN):NN;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===d6&&e!==qO)return UM(t,t.avail_out===0?B9:NN);const a=n.last_flush;if(n.last_flush=e,n.pending!==0){if(dO(t),t.avail_out===0)return n.last_flush=-1,QR}else if(t.avail_in===0&&vot(e)<=vot(a)&&e!==qO)return UM(t,B9);if(n.status===d6&&t.avail_in!==0)return UM(t,B9);if(n.status===S3&&n.wrap===0&&(n.status=xM),n.status===S3){let s=Q8+(n.w_bits-8<<4)<<8,d=-1;if(d=n.strategy>=Z8||n.level<2?0:n.level<6?1:n.level===6?2:3,s|=d<<6,n.strstart!==0&&(s|=32),s+=31-s%31,h6(n,s),n.strstart!==0&&(h6(n,t.adler>>>16),h6(n,65535&t.adler)),t.adler=1,n.status=xM,dO(t),n.pending!==0)return n.last_flush=-1,QR}if(n.status===57){if(t.adler=0,dT(n,31),dT(n,139),dT(n,8),n.gzhead)dT(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),dT(n,255&n.gzhead.time),dT(n,n.gzhead.time>>8&255),dT(n,n.gzhead.time>>16&255),dT(n,n.gzhead.time>>24&255),dT(n,n.level===9?2:n.strategy>=Z8||n.level<2?4:0),dT(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(dT(n,255&n.gzhead.extra.length),dT(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=BR(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(dT(n,0),dT(n,0),dT(n,0),dT(n,0),dT(n,0),dT(n,n.level===9?2:n.strategy>=Z8||n.level<2?4:0),dT(n,3),n.status=xM,dO(t),n.pending!==0)return n.last_flush=-1,QR}if(n.status===69){if(n.gzhead.extra){let s=n.pending,d=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+d>n.pending_buf_size;){let m=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+m),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(t.adler=BR(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=m,dO(t),n.pending!==0)return n.last_flush=-1,QR;s=0,d-=m}let f=new Uint8Array(n.gzhead.extra);n.pending_buf.set(f.subarray(n.gzindex,n.gzindex+d),n.pending),n.pending+=d,n.gzhead.hcrc&&n.pending>s&&(t.adler=BR(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let s,d=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>d&&(t.adler=BR(t.adler,n.pending_buf,n.pending-d,d)),dO(t),n.pending!==0)return n.last_flush=-1,QR;d=0}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,dT(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>d&&(t.adler=BR(t.adler,n.pending_buf,n.pending-d,d)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let s,d=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>d&&(t.adler=BR(t.adler,n.pending_buf,n.pending-d,d)),dO(t),n.pending!==0)return n.last_flush=-1,QR;d=0}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,dT(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>d&&(t.adler=BR(t.adler,n.pending_buf,n.pending-d,d))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(dO(t),n.pending!==0))return n.last_flush=-1,QR;dT(n,255&t.adler),dT(n,t.adler>>8&255),t.adler=0}if(n.status=xM,dO(t),n.pending!==0)return n.last_flush=-1,QR}if(t.avail_in!==0||n.lookahead!==0||e!==HP&&n.status!==d6){let s=n.level===0?bot(n,e):n.strategy===Z8?((d,f)=>{let m;for(;;){if(d.lookahead===0&&(T3(d),d.lookahead===0)){if(f===HP)return 1;break}if(d.match_length=0,m=GP(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(hO(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,f===qO?(hO(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(hO(d,!1),d.strm.avail_out===0)?1:2})(n,e):n.strategy===Fft?((d,f)=>{let m,_,y,T;const w=d.window;for(;;){if(d.lookahead<=MM){if(T3(d),d.lookahead<=MM&&f===HP)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(y=d.strstart-1,_=w[y],_===w[++y]&&_===w[++y]&&_===w[++y])){T=d.strstart+MM;do;while(_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&y<T);d.match_length=MM-(T-y),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=GP(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=GP(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(hO(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,f===qO?(hO(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(hO(d,!1),d.strm.avail_out===0)?1:2})(n,e):p6[n.level].func(n,e);if(s!==3&&s!==4||(n.status=d6),s===1||s===3)return t.avail_out===0&&(n.last_flush=-1),QR;if(s===2&&(e===xft?Mft(n):e!==got&&(V9(n,0,0,!1),e===Uft&&(qP(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),dO(t),t.avail_out===0))return n.last_flush=-1,QR}return e!==qO?QR:n.wrap<=0?_ot:(n.wrap===2?(dT(n,255&t.adler),dT(n,t.adler>>8&255),dT(n,t.adler>>16&255),dT(n,t.adler>>24&255),dT(n,255&t.total_in),dT(n,t.total_in>>8&255),dT(n,t.total_in>>16&255),dT(n,t.total_in>>24&255)):(h6(n,t.adler>>>16),h6(n,65535&t.adler)),dO(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?QR:_ot)},Qft=(t,e)=>{let n=e.length;if(f6(t))return NN;const a=t.state,s=a.wrap;if(s===2||s===1&&a.status!==S3||a.lookahead)return NN;if(s===1&&(t.adler=l6(t.adler,e,n,0)),a.wrap=0,n>=a.w_size){s===0&&(qP(a.head),a.strstart=0,a.block_start=0,a.insert=0);let _=new Uint8Array(a.w_size);_.set(e.subarray(n-a.w_size,n),0),e=_,n=a.w_size}const d=t.avail_in,f=t.next_in,m=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,T3(a);a.lookahead>=3;){let _=a.strstart,y=a.lookahead-2;do a.ins_h=zP(a,a.ins_h,a.window[_+3-1]),a.prev[_&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=_,_++;while(--y);a.strstart=_,a.lookahead=2,T3(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=f,t.input=m,t.avail_in=d,a.wrap=s,QR},m6={deflateInit:(t,e)=>Rot(t,e,Q8,15,8,Hft),deflateInit2:Rot,deflateReset:Tot,deflateResetKeep:Sot,deflateSetHeader:(t,e)=>f6(t)||t.state.wrap!==2?NN:(t.state.gzhead=e,QR),deflate:Zft,deflateEnd:t=>{if(f6(t))return NN;const e=t.state.status;return t.state=null,e===xM?UM(t,jft):QR},deflateSetDictionary:Qft,deflateInfo:"pako deflate (from Nodeca project)"};const $ft=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var $8={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const a in n)$ft(n,a)&&(t[a]=n[a])}}return t},flattenChunks:t=>{let e=0;for(let a=0,s=t.length;a<s;a++)e+=t[a].length;const n=new Uint8Array(e);for(let a=0,s=0,d=t.length;a<d;a++){let f=t[a];n.set(f,s),s+=f.length}return n}};let Aot=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Aot=!1}const E6=new Uint8Array(256);for(let t=0;t<256;t++)E6[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;E6[254]=E6[254]=1;var g6={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,a,s,d,f=t.length,m=0;for(s=0;s<f;s++)n=t.charCodeAt(s),(64512&n)==55296&&s+1<f&&(a=t.charCodeAt(s+1),(64512&a)==56320&&(n=65536+(n-55296<<10)+(a-56320),s++)),m+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(m),d=0,s=0;d<m;s++)n=t.charCodeAt(s),(64512&n)==55296&&s+1<f&&(a=t.charCodeAt(s+1),(64512&a)==56320&&(n=65536+(n-55296<<10)+(a-56320),s++)),n<128?e[d++]=n:n<2048?(e[d++]=192|n>>>6,e[d++]=128|63&n):n<65536?(e[d++]=224|n>>>12,e[d++]=128|n>>>6&63,e[d++]=128|63&n):(e[d++]=240|n>>>18,e[d++]=128|n>>>12&63,e[d++]=128|n>>>6&63,e[d++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let a,s;const d=new Array(2*n);for(s=0,a=0;a<n;){let f=t[a++];if(f<128){d[s++]=f;continue}let m=E6[f];if(m>4)d[s++]=65533,a+=m-1;else{for(f&=m===2?31:m===3?15:7;m>1&&a<n;)f=f<<6|63&t[a++],m--;m>1?d[s++]=65533:f<65536?d[s++]=f:(f-=65536,d[s++]=55296|f>>10&1023,d[s++]=56320|1023&f)}}return((f,m)=>{if(m<65534&&f.subarray&&Aot)return String.fromCharCode.apply(null,f.length===m?f:f.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(f[y]);return _})(d,s)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+E6[t[n]]>e?n:e}},Cot=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Oot=Object.prototype.toString,{Z_NO_FLUSH:tmt,Z_SYNC_FLUSH:emt,Z_FULL_FLUSH:nmt,Z_FINISH:rmt,Z_OK:_z,Z_STREAM_END:imt,Z_DEFAULT_COMPRESSION:omt,Z_DEFAULT_STRATEGY:amt,Z_DEFLATED:smt}=J8;function tK(t){this.options=$8.assign({level:omt,method:smt,chunkSize:16384,windowBits:15,memLevel:8,strategy:amt},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cot,this.strm.avail_out=0;let n=m6.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==_z)throw new Error(PM[n]);if(e.header&&m6.deflateSetHeader(this.strm,e.header),e.dictionary){let a;if(a=typeof e.dictionary=="string"?g6.string2buf(e.dictionary):Oot.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=m6.deflateSetDictionary(this.strm,a),n!==_z)throw new Error(PM[n]);this._dict_set=!0}}function cmt(t,e){const n=new tK(e);if(n.push(t,!0),n.err)throw n.msg||PM[n.err];return n.result}tK.prototype.push=function(t,e){const n=this.strm,a=this.options.chunkSize;let s,d;if(this.ended)return!1;for(d=e===~~e?e:e===!0?rmt:tmt,typeof t=="string"?n.input=g6.string2buf(t):Oot.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),(d===emt||d===nmt)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=m6.deflate(n,d),s===imt)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=m6.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===_z;if(n.avail_out!==0){if(d>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},tK.prototype.onData=function(t){this.chunks.push(t)},tK.prototype.onEnd=function(t){t===_z&&(this.result=$8.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var umt={deflate:cmt};const eK=16209;var lmt=function(t,e){let n,a,s,d,f,m,_,y,T,w,L,B,Q,X,J,_n,_r,ya,_l,_d,tu,_g,l_,O_;const N_=t.state;n=t.next_in,l_=t.input,a=n+(t.avail_in-5),s=t.next_out,O_=t.output,d=s-(e-t.avail_out),f=s+(t.avail_out-257),m=N_.dmax,_=N_.wsize,y=N_.whave,T=N_.wnext,w=N_.window,L=N_.hold,B=N_.bits,Q=N_.lencode,X=N_.distcode,J=(1<<N_.lenbits)-1,_n=(1<<N_.distbits)-1;t:do{B<15&&(L+=l_[n++]<<B,B+=8,L+=l_[n++]<<B,B+=8),_r=Q[L&J];e:for(;;){if(ya=_r>>>24,L>>>=ya,B-=ya,ya=_r>>>16&255,ya===0)O_[s++]=65535&_r;else{if(!(16&ya)){if((64&ya)==0){_r=Q[(65535&_r)+(L&(1<<ya)-1)];continue e}if(32&ya){N_.mode=16191;break t}t.msg="invalid literal/length code",N_.mode=eK;break t}_l=65535&_r,ya&=15,ya&&(B<ya&&(L+=l_[n++]<<B,B+=8),_l+=L&(1<<ya)-1,L>>>=ya,B-=ya),B<15&&(L+=l_[n++]<<B,B+=8,L+=l_[n++]<<B,B+=8),_r=X[L&_n];n:for(;;){if(ya=_r>>>24,L>>>=ya,B-=ya,ya=_r>>>16&255,!(16&ya)){if((64&ya)==0){_r=X[(65535&_r)+(L&(1<<ya)-1)];continue n}t.msg="invalid distance code",N_.mode=eK;break t}if(_d=65535&_r,ya&=15,B<ya&&(L+=l_[n++]<<B,B+=8,B<ya&&(L+=l_[n++]<<B,B+=8)),_d+=L&(1<<ya)-1,_d>m){t.msg="invalid distance too far back",N_.mode=eK;break t}if(L>>>=ya,B-=ya,ya=s-d,_d>ya){if(ya=_d-ya,ya>y&&N_.sane){t.msg="invalid distance too far back",N_.mode=eK;break t}if(tu=0,_g=w,T===0){if(tu+=_-ya,ya<_l){_l-=ya;do O_[s++]=w[tu++];while(--ya);tu=s-_d,_g=O_}}else if(T<ya){if(tu+=_+T-ya,ya-=T,ya<_l){_l-=ya;do O_[s++]=w[tu++];while(--ya);if(tu=0,T<_l){ya=T,_l-=ya;do O_[s++]=w[tu++];while(--ya);tu=s-_d,_g=O_}}}else if(tu+=T-ya,ya<_l){_l-=ya;do O_[s++]=w[tu++];while(--ya);tu=s-_d,_g=O_}for(;_l>2;)O_[s++]=_g[tu++],O_[s++]=_g[tu++],O_[s++]=_g[tu++],_l-=3;_l&&(O_[s++]=_g[tu++],_l>1&&(O_[s++]=_g[tu++]))}else{tu=s-_d;do O_[s++]=O_[tu++],O_[s++]=O_[tu++],O_[s++]=O_[tu++],_l-=3;while(_l>2);_l&&(O_[s++]=O_[tu++],_l>1&&(O_[s++]=O_[tu++]))}break}}break}}while(n<a&&s<f);_l=B>>3,n-=_l,B-=_l<<3,L&=(1<<B)-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?a-n+5:5-(n-a),t.avail_out=s<f?f-s+257:257-(s-f),N_.hold=L,N_.bits=B};const nK=15,dmt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hmt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),pmt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),fmt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _6=(t,e,n,a,s,d,f,m)=>{const _=m.bits;let y,T,w,L,B,Q,X=0,J=0,_n=0,_r=0,ya=0,_l=0,_d=0,tu=0,_g=0,l_=0,O_=null;const N_=new Uint16Array(16),iS=new Uint16Array(16);let oS,jS,gT,lT=null;for(X=0;X<=nK;X++)N_[X]=0;for(J=0;J<a;J++)N_[e[n+J]]++;for(ya=_,_r=nK;_r>=1&&N_[_r]===0;_r--);if(ya>_r&&(ya=_r),_r===0)return s[d++]=20971520,s[d++]=20971520,m.bits=1,0;for(_n=1;_n<_r&&N_[_n]===0;_n++);for(ya<_n&&(ya=_n),tu=1,X=1;X<=nK;X++)if(tu<<=1,tu-=N_[X],tu<0)return-1;if(tu>0&&(t===0||_r!==1))return-1;for(iS[1]=0,X=1;X<nK;X++)iS[X+1]=iS[X]+N_[X];for(J=0;J<a;J++)e[n+J]!==0&&(f[iS[e[n+J]]++]=J);if(t===0?(O_=lT=f,Q=20):t===1?(O_=dmt,lT=hmt,Q=257):(O_=pmt,lT=fmt,Q=0),l_=0,J=0,X=_n,B=d,_l=ya,_d=0,w=-1,_g=1<<ya,L=_g-1,t===1&&_g>852||t===2&&_g>592)return 1;for(;;){oS=X-_d,f[J]+1<Q?(jS=0,gT=f[J]):f[J]>=Q?(jS=lT[f[J]-Q],gT=O_[f[J]-Q]):(jS=96,gT=0),y=1<<X-_d,T=1<<_l,_n=T;do T-=y,s[B+(l_>>_d)+T]=oS<<24|jS<<16|gT|0;while(T!==0);for(y=1<<X-1;l_&y;)y>>=1;if(y!==0?(l_&=y-1,l_+=y):l_=0,J++,--N_[X]==0){if(X===_r)break;X=e[n+f[J]]}if(X>ya&&(l_&L)!==w){for(_d===0&&(_d=ya),B+=_n,_l=X-_d,tu=1<<_l;_l+_d<_r&&(tu-=N_[_l+_d],!(tu<=0));)_l++,tu<<=1;if(_g+=1<<_l,t===1&&_g>852||t===2&&_g>592)return 1;w=l_&L,s[w]=ya<<24|_l<<16|B-d|0}}return l_!==0&&(s[B+l_]=X-_d<<24|64<<16|0),m.bits=ya,0};const{Z_FINISH:wot,Z_BLOCK:mmt,Z_TREES:rK,Z_OK:jM,Z_STREAM_END:Emt,Z_NEED_DICT:gmt,Z_STREAM_ERROR:zO,Z_DATA_ERROR:Iot,Z_MEM_ERROR:Not,Z_BUF_ERROR:_mt,Z_DEFLATED:Dot}=J8,iK=16180,oK=16190,RL=16191,q9=16192,z9=16194,aK=16199,sK=16200,K9=16206,WT=16209,kot=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function vmt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const VM=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<iK||e.mode>16211?1:0},Lot=t=>{if(VM(t))return zO;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=iK,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,jM},Pot=t=>{if(VM(t))return zO;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Lot(t)},Mot=(t,e)=>{let n;if(VM(t))return zO;const a=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?zO:(a.window!==null&&a.wbits!==e&&(a.window=null),a.wrap=n,a.wbits=e,Pot(t))},xot=(t,e)=>{if(!t)return zO;const n=new vmt;t.state=n,n.strm=t,n.window=null,n.mode=iK;const a=Mot(t,e);return a!==jM&&(t.state=null),a};let W9,Y9,Uot=!0;const ymt=t=>{if(Uot){W9=new Int32Array(512),Y9=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(_6(1,t.lens,0,288,W9,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;_6(2,t.lens,0,32,Y9,0,t.work,{bits:5}),Uot=!1}t.lencode=W9,t.lenbits=9,t.distcode=Y9,t.distbits=5},jot=(t,e,n,a)=>{let s;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(e.subarray(n-d.wsize,n),0),d.wnext=0,d.whave=d.wsize):(s=d.wsize-d.wnext,s>a&&(s=a),d.window.set(e.subarray(n-a,n-a+s),d.wnext),(a-=s)?(d.window.set(e.subarray(n-a,n),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=s,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=s))),0};var bmt=(t,e)=>{let n,a,s,d,f,m,_,y,T,w,L,B,Q,X,J,_n,_r,ya,_l,_d,tu,_g,l_=0;const O_=new Uint8Array(4);let N_,iS;const oS=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(VM(t)||!t.output||!t.input&&t.avail_in!==0)return zO;n=t.state,n.mode===RL&&(n.mode=q9),f=t.next_out,s=t.output,_=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,y=n.hold,T=n.bits,w=m,L=_,_g=jM;t:for(;;)switch(n.mode){case iK:if(n.wrap===0){n.mode=q9;break}for(;T<16;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(2&n.wrap&&y===35615){n.wbits===0&&(n.wbits=15),n.check=0,O_[0]=255&y,O_[1]=y>>>8&255,n.check=BR(n.check,O_,2,0),y=0,T=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",n.mode=WT;break}if((15&y)!==Dot){t.msg="unknown compression method",n.mode=WT;break}if(y>>>=4,T-=4,tu=8+(15&y),n.wbits===0&&(n.wbits=tu),tu>15||tu>n.wbits){t.msg="invalid window size",n.mode=WT;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&y?16189:RL,y=0,T=0;break;case 16181:for(;T<16;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(n.flags=y,(255&kR(n))!==Dot){t.msg="unknown compression method",n.mode=WT;break}if(57344&kR(n)){t.msg="unknown header flags set",n.mode=WT;break}n.head&&(n.head.text=y>>8&1),512&kR(n)&&4&n.wrap&&(O_[0]=255&y,O_[1]=y>>>8&255,n.check=BR(n.check,O_,2,0)),y=0,T=0,n.mode=16182;case 16182:for(;T<32;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}n.head&&(n.head.time=y),512&kR(n)&&4&n.wrap&&(O_[0]=255&y,O_[1]=y>>>8&255,O_[2]=y>>>16&255,O_[3]=y>>>24&255,n.check=BR(n.check,O_,4,0)),y=0,T=0,n.mode=16183;case 16183:for(;T<16;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}n.head&&(n.head.xflags=255&y,n.head.os=y>>8),512&kR(n)&&4&n.wrap&&(O_[0]=255&y,O_[1]=y>>>8&255,n.check=BR(n.check,O_,2,0)),y=0,T=0,n.mode=16184;case 16184:if(1024&kR(n)){for(;T<16;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}n.length=y,n.head&&(n.head.extra_len=y),512&kR(n)&&4&n.wrap&&(O_[0]=255&y,O_[1]=y>>>8&255,n.check=BR(n.check,O_,2,0)),y=0,T=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&kR(n)&&(B=n.length,B>m&&(B=m),B&&(n.head&&(tu=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(a.subarray(d,d+B),tu)),512&kR(n)&&4&n.wrap&&(n.check=BR(n.check,a,B,d)),m-=B,d+=B,n.length-=B),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&kR(n)){if(m===0)break t;B=0;do tu=a[d+B++],n.head&&tu&&n.length<65536&&(n.head.name+=String.fromCharCode(tu));while(tu&&B<m);if(512&kR(n)&&4&n.wrap&&(n.check=BR(n.check,a,B,d)),m-=B,d+=B,tu)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&kR(n)){if(m===0)break t;B=0;do tu=a[d+B++],n.head&&tu&&n.length<65536&&(n.head.comment+=String.fromCharCode(tu));while(tu&&B<m);if(512&kR(n)&&4&n.wrap&&(n.check=BR(n.check,a,B,d)),m-=B,d+=B,tu)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&kR(n)){for(;T<16;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(4&n.wrap&&y!==(65535&n.check)){t.msg="header crc mismatch",n.mode=WT;break}y=0,T=0}n.head&&(n.head.hcrc=kR(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=RL;break;case 16189:for(;T<32;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}t.adler=n.check=kot(y),y=0,T=0,n.mode=oK;case oK:if(n.havedict===0)return t.next_out=f,t.avail_out=_,t.next_in=d,t.avail_in=m,n.hold=y,n.bits=T,gmt;t.adler=n.check=1,n.mode=RL;case RL:if(e===mmt||e===rK)break t;case q9:if(n.last){y>>>=7&T,T-=7&T,n.mode=K9;break}for(;T<3;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}switch(n.last=1&y,y>>>=1,T-=1,3&y){case 0:n.mode=16193;break;case 1:if(ymt(n),n.mode=aK,e===rK){y>>>=2,T-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=WT}y>>>=2,T-=2;break;case 16193:for(y>>>=7&T,T-=7&T;T<32;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",n.mode=WT;break}if(n.length=65535&y,y=0,T=0,n.mode=z9,e===rK)break t;case z9:n.mode=16195;case 16195:if(B=n.length,B){if(B>m&&(B=m),B>_&&(B=_),B===0)break t;s.set(a.subarray(d,d+B),f),m-=B,d+=B,_-=B,f+=B,n.length-=B;break}n.mode=RL;break;case 16196:for(;T<14;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(n.nlen=257+(31&y),y>>>=5,T-=5,n.ndist=1+(31&y),y>>>=5,T-=5,n.ncode=4+(15&y),y>>>=4,T-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=WT;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;T<3;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}n.lens[oS[n.have++]]=7&y,y>>>=3,T-=3}for(;n.have<19;)n.lens[oS[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,N_={bits:n.lenbits},_g=_6(0,n.lens,0,19,n.lencode,0,n.work,N_),n.lenbits=N_.bits,_g){t.msg="invalid code lengths set",n.mode=WT;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;l_=n.lencode[y&(1<<n.lenbits)-1],J=l_>>>24,_n=l_>>>16&255,_r=65535&l_,!(J<=T);){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(_r<16)y>>>=J,T-=J,n.lens[n.have++]=_r;else{if(_r===16){for(iS=J+2;T<iS;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(y>>>=J,T-=J,n.have===0){t.msg="invalid bit length repeat",n.mode=WT;break}tu=n.lens[n.have-1],B=3+(3&y),y>>>=2,T-=2}else if(_r===17){for(iS=J+3;T<iS;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}y>>>=J,T-=J,tu=0,B=3+(7&y),y>>>=3,T-=3}else{for(iS=J+7;T<iS;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}y>>>=J,T-=J,tu=0,B=11+(127&y),y>>>=7,T-=7}if(n.have+B>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=WT;break}for(;B--;)n.lens[n.have++]=tu}}if(n.mode===WT)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=WT;break}if(n.lenbits=9,N_={bits:n.lenbits},_g=_6(1,n.lens,0,n.nlen,n.lencode,0,n.work,N_),n.lenbits=N_.bits,_g){t.msg="invalid literal/lengths set",n.mode=WT;break}if(n.distbits=6,n.distcode=n.distdyn,N_={bits:n.distbits},_g=_6(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,N_),n.distbits=N_.bits,_g){t.msg="invalid distances set",n.mode=WT;break}if(n.mode=aK,e===rK)break t;case aK:n.mode=sK;case sK:if(m>=6&&_>=258){t.next_out=f,t.avail_out=_,t.next_in=d,t.avail_in=m,n.hold=y,n.bits=T,lmt(t,L),f=t.next_out,s=t.output,_=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,y=n.hold,T=n.bits,n.mode===RL&&(n.back=-1);break}for(n.back=0;l_=n.lencode[y&(1<<n.lenbits)-1],J=l_>>>24,_n=l_>>>16&255,_r=65535&l_,!(J<=T);){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(_n&&(240&_n)==0){for(ya=J,_l=_n,_d=_r;l_=n.lencode[_d+((y&(1<<ya+_l)-1)>>ya)],J=l_>>>24,_n=l_>>>16&255,_r=65535&l_,!(ya+J<=T);){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}y>>>=ya,T-=ya,n.back+=ya}if(y>>>=J,T-=J,n.back+=J,n.length=_r,_n===0){n.mode=16205;break}if(32&_n){n.back=-1,n.mode=RL;break}if(64&_n){t.msg="invalid literal/length code",n.mode=WT;break}n.extra=15&_n,n.mode=16201;case 16201:if(n.extra){for(iS=n.extra;T<iS;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}n.length+=y&(1<<n.extra)-1,y>>>=n.extra,T-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;l_=n.distcode[y&(1<<n.distbits)-1],J=l_>>>24,_n=l_>>>16&255,_r=65535&l_,!(J<=T);){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if((240&_n)==0){for(ya=J,_l=_n,_d=_r;l_=n.distcode[_d+((y&(1<<ya+_l)-1)>>ya)],J=l_>>>24,_n=l_>>>16&255,_r=65535&l_,!(ya+J<=T);){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}y>>>=ya,T-=ya,n.back+=ya}if(y>>>=J,T-=J,n.back+=J,64&_n){t.msg="invalid distance code",n.mode=WT;break}n.offset=_r,n.extra=15&_n,n.mode=16203;case 16203:if(n.extra){for(iS=n.extra;T<iS;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}n.offset+=y&(1<<n.extra)-1,y>>>=n.extra,T-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=WT;break}n.mode=16204;case 16204:if(_===0)break t;if(B=L-_,n.offset>B){if(B=n.offset-B,B>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=WT;break}B>n.wnext?(B-=n.wnext,Q=n.wsize-B):Q=n.wnext-B,B>n.length&&(B=n.length),X=n.window}else X=s,Q=f-n.offset,B=n.length;B>_&&(B=_),_-=B,n.length-=B;do s[f++]=X[Q++];while(--B);n.length===0&&(n.mode=sK);break;case 16205:if(_===0)break t;s[f++]=n.length,_--,n.mode=sK;break;case K9:if(n.wrap){for(;T<32;){if(m===0)break t;m--,y|=a[d++]<<T,T+=8}if(L-=_,t.total_out+=L,n.total+=L,4&n.wrap&&L&&(t.adler=n.check=kR(n)?BR(n.check,s,L,f-L):l6(n.check,s,L,f-L)),L=_,4&n.wrap&&(kR(n)?y:kot(y))!==n.check){t.msg="incorrect data check",n.mode=WT;break}y=0,T=0}n.mode=16207;case 16207:if(n.wrap&&kR(n)){for(;T<32;){if(m===0)break t;m--,y+=a[d++]<<T,T+=8}if(4&n.wrap&&y!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=WT;break}y=0,T=0}n.mode=16208;case 16208:_g=Emt;break t;case WT:_g=Iot;break t;case 16210:return Not;default:return zO}return t.next_out=f,t.avail_out=_,t.next_in=d,t.avail_in=m,n.hold=y,n.bits=T,(n.wsize||L!==t.avail_out&&n.mode<WT&&(n.mode<K9||e!==wot))&&jot(t,t.output,t.next_out,L-t.avail_out),w-=t.avail_in,L-=t.avail_out,t.total_in+=w,t.total_out+=L,n.total+=L,4&n.wrap&&L&&(t.adler=n.check=kR(n)?BR(n.check,s,L,t.next_out-L):l6(n.check,s,L,t.next_out-L)),t.data_type=n.bits+(n.last?64:0)+(n.mode===RL?128:0)+(n.mode===aK||n.mode===z9?256:0),(w===0&&L===0||e===wot)&&_g===jM&&(_g=_mt),_g},AL={inflateReset:Pot,inflateReset2:Mot,inflateResetKeep:Lot,inflateInit:t=>xot(t,15),inflateInit2:xot,inflate:bmt,inflateEnd:t=>{if(VM(t))return zO;let e=t.state;return e.window&&(e.window=null),t.state=null,jM},inflateGetHeader:(t,e)=>{if(VM(t))return zO;const n=t.state;return(2&n.wrap)==0?zO:(n.head=e,e.done=!1,jM)},inflateSetDictionary:(t,e)=>{const n=e.length;let a,s,d;return VM(t)?zO:(a=t.state,a.wrap!==0&&a.mode!==oK?zO:a.mode===oK&&(s=1,s=l6(s,e,n,0),s!==a.check)?Iot:(d=jot(t,e,n,n),d?(a.mode=16210,Not):(a.havedict=1,jM)))},inflateInfo:"pako inflate (from Nodeca project)"},Smt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Vot=Object.prototype.toString,{Z_NO_FLUSH:Tmt,Z_FINISH:Rmt,Z_OK:v6,Z_STREAM_END:X9,Z_NEED_DICT:J9,Z_STREAM_ERROR:Amt,Z_DATA_ERROR:Bot,Z_MEM_ERROR:Cmt}=J8;function cK(t){this.options=$8.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Cot,this.strm.avail_out=0;let n=AL.inflateInit2(this.strm,e.windowBits);if(n!==v6)throw new Error(PM[n]);if(this.header=new Smt,AL.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=g6.string2buf(e.dictionary):Vot.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=AL.inflateSetDictionary(this.strm,e.dictionary),n!==v6)))throw new Error(PM[n])}function Omt(t,e){const n=new cK(e);if(n.push(t),n.err)throw n.msg||PM[n.err];return n.result}cK.prototype.push=function(t,e){const n=this.strm,a=this.options.chunkSize,s=this.options.dictionary;let d,f,m;if(this.ended)return!1;for(f=e===~~e?e:e===!0?Rmt:Tmt,Vot.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),d=AL.inflate(n,f),d===J9&&s&&(d=AL.inflateSetDictionary(n,s),d===v6?d=AL.inflate(n,f):d===Bot&&(d=J9));n.avail_in>0&&d===X9&&n.state.wrap>0&&t[n.next_in]!==0;)AL.inflateReset(n),d=AL.inflate(n,f);switch(d){case Amt:case Bot:case J9:case Cmt:return this.onEnd(d),this.ended=!0,!1}if(m=n.avail_out,n.next_out&&(n.avail_out===0||d===X9))if(this.options.to==="string"){let _=g6.utf8border(n.output,n.next_out),y=n.next_out-_,T=g6.buf2string(n.output,_);n.next_out=y,n.avail_out=a-y,y&&n.output.set(n.output.subarray(_,_+y),0),this.onData(T)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(d!==v6||m!==0){if(d===X9)return d=AL.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},cK.prototype.onData=function(t){this.chunks.push(t)},cK.prototype.onEnd=function(t){t===v6&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=$8.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var wmt={inflate:Omt};const{deflate:Imt}=umt,{inflate:Nmt}=wmt;var Dmt=Imt,kmt=Nmt,Fot=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(Fot||{});class Lmt{constructor(){_t(this,"_sequence",0),_t(this,"_startTime",Date.now()),_t(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};n.commonPacketHeader.extension=1,n.extension=y,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;aa("SHOW_DATASTREAM2_LOG")&&F.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const a=new ArrayBuffer(n.commonPacketHeader.length),s=new Uint8Array(a),d=new DataView(a);let f=0;if(d.setUint16(f,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),f+=2,d.setUint32(f,n.commonPacketHeader.sequence,!0),f+=4,d.setUint16(f,n.commonStreamHeader,!0),f+=2,n.extension){const m=this.serializeExtension(n.extension);s.set(new Uint8Array(m),f),f+=m.byteLength}if(s.set(new Uint8Array(n.payload),f),f+=n.payload.byteLength,f!==n.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let a=0;const s=n.getUint16(a,!0);a+=2;const d={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:n.getUint16(a+2,!0)<<16|n.getUint16(a,!0)};let f,m;if(a+=4,aa("SHOW_DATASTREAM2_LOG")&&F.debug("receive data header: ".concat(JSON.stringify(d))),n.getUint16(a,!0),a+=2,d.extension){m=this.deserializeExtension(e.slice(a)),a+=2+m.length,f=e.slice(a);let _=!1;if(m.datas.length>0){const y=m.datas.find(T=>T.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}f=_?this.decompress(f):f}else f=e.slice(8);return f}serializeExtension(e){const{profile:n,length:a,datas:s}=e,d=new ArrayBuffer(a+2),f=new Uint8Array(d),m=new DataView(d);let _=0;if(m.setUint8(_++,n),m.setUint8(_++,a),s.forEach(y=>{n?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),f.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),f.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==a+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(a+2));return d}deserializeExtension(e){const n=new DataView(e);let a=0;const s=n.getUint8(a);a++;const d=n.getUint8(a);a++;const f=s===Fot.TWO_BYTE,m=[],_=new DataView(e,2);let y=0;for(;y<d;){let T=0,w=0,L=new ArrayBuffer(0);f?(T=_.getUint8(y),y++,w=_.getUint8(y),y++):(T=15&_.getUint8(y),w=_.getUint8(y)>>4,y++),w>0&&(L=_.buffer.slice(y+2,y+2+w),y+=L.byteLength),m.push({id:T,length:w,data:L})}if(y!==d)throw Error("parse error");return{profile:s,length:d,datas:m}}decompress(e){return kmt(new Uint8Array(e))}compress(e){return Dmt(new Uint8Array(e))}}const Pmt={name:"DataStream",create:(t,e)=>{const n=e?new Fht(t):new Ght(t);return n.useDataStream(new Lmt),n}};class Mmt extends eT{constructor(e,n,a){super(),_t(this,"ws",void 0),_t(this,"requestId",1),_t(this,"heartBeatTimer",void 0),_t(this,"joinInfo",void 0),_t(this,"clientId",void 0),_t(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),_t(this,"onClose",s=>{this.emit("close"),this.dispose()}),_t(this,"onMessage",s=>{const d=JSON.parse(s.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=e,this.clientId=n,this.ws=new z2("cross-channel-".concat(this.clientId),a),this.ws.on(kv.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(kv.CONNECTED,this.onOpen),this.ws.on(kv.ON_MESSAGE,this.onMessage),this.ws.on(kv.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new A_((n,a)=>{const s=window.setTimeout(()=>{a(new _E(_i.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,d=>{window.clearTimeout(s),d.state&&d.state!==0?a(new _E(_i.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),a(new _E(_i.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new _E(_i.WS_DISCONNECT);const n=()=>new A_((f,m)=>{this.ws.once(kv.CLOSED,()=>m(new _E(_i.WS_ABORT))),this.ws.once(kv.CONNECTED,f)});this.ws.state!=="connected"&&await n();const a=this.sendMessage(e),s=new A_((f,m)=>{const _=()=>{m(new _E(_i.WS_ABORT))};this.ws.once(kv.RECONNECTING,_),this.ws.once(kv.CLOSED,_),this.once("req_".concat(a),f),QT(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(kv.RECONNECTING,_),this.ws.off(kv.CLOSED,_),m(new _E(_i.TIMEOUT,"cross channel ws request timeout"))})}),d=await s;if(!d||d.code!==200)throw new _E(_i.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(e){this.ws.removeAllListeners(kv.REQUEST_NEW_URLS),this.ws.on(kv.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class xmt extends eT{set state(e){e!==this._state&&(e!==f0.RELAY_STATE_FAILURE&&(this.errorCode=c3.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,a,s,d){super(),_t(this,"joinInfo",void 0),_t(this,"sid",void 0),_t(this,"clientId",void 0),_t(this,"cancelToken",WR.CancelToken.source()),_t(this,"workerToken",void 0),_t(this,"requestId",0),_t(this,"signal",void 0),_t(this,"prevChannelMediaConfig",void 0),_t(this,"httpRetryConfig",void 0),_t(this,"_resolution",void 0),_t(this,"_state",f0.RELAY_STATE_IDLE),_t(this,"errorCode",c3.RELAY_OK),_t(this,"onStatus",f=>{F.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(f))),f&&f.command&&(f.command==="onAudioPacketReceived"&&this.emit("event",_L.PACKET_RECEIVED_AUDIO_FROM_SRC),f.command==="onVideoPacketReceived"&&this.emit("event",_L.PACKET_RECEIVED_VIDEO_FROM_SRC),f.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=c3.SRC_TOKEN_EXPIRED,this.state=f0.RELAY_STATE_FAILURE),f.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=c3.DEST_TOKEN_EXPIRED,this.state=f0.RELAY_STATE_FAILURE))}),_t(this,"onReconnect",async()=>{F.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",_L.NETWORK_DISCONNECTED),this.state=f0.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(f=>{this.state!==f0.RELAY_STATE_IDLE&&(F.error("auto restart channel media relay failed",f.toString()),this.errorCode=c3.SERVER_CONNECTION_LOST,this.state=f0.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=gM(),this.signal=new Mmt(this.joinInfo,this.clientId,a),this.httpRetryConfig=s,this._resolution=d}async startChannelMediaRelay(e){if(this.state!==f0.RELAY_STATE_IDLE)throw new _E(_i.INVALID_OPERATION);this.state=f0.RELAY_STATE_CONNECTING,await this.connect(),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new _E(_i.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new _E(_i.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new _E(_i.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==f0.RELAY_STATE_RUNNING)throw new _E(_i.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==f0.RELAY_STATE_RUNNING)throw new _E(_i.INVALID_OPERATION);const n=this.genMessage(VR.SetVideoProfile);await this.signal.request(n),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),F.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=f0.RELAY_STATE_IDLE,this.dispose()}dispose(){F.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=WR.CancelToken.source(),this.state=f0.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await Kpt(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",_L.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(VR.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(VR.SetSdkProfile,e);await this.signal.request(a),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(VR.SetSourceChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",_L.PACKET_JOINED_SRC_CHANNEL),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(VR.SetSourceUserId,e);await this.signal.request(d),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const f=this.genMessage(VR.SetDestChannel,e);await this.signal.request(f),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",_L.PACKET_JOINED_DEST_CHANNEL),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(VR.StartPacketTransfer,e);await this.signal.request(m),this.emit("event",_L.PACKET_SENT_TO_DEST_CHANNEL),this.state=f0.RELAY_STATE_RUNNING,F.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(VR.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",_L.PACKET_UPDATE_DEST_CHANNEL),F.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(VR.StopPacketTransfer);await this.signal.request(e),F.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const a=[],s=[],d=[];this.requestId+=1;const f={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:aO,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};f.sdkVersion==="4.23.2"&&(f.sdkVersion="0.0.1");let m=null,_=null;switch(e){case VR.SetSdkProfile:return f.clientRequest={command:"SetSdkProfile",type:"multi_channel"},f;case VR.SetSourceChannel:if(_=n&&n.getSrcChannelMediaInfo(),!_)throw new _E(_i.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},f;case VR.SetSourceUserId:if(_=n&&n.getSrcChannelMediaInfo(),!_)throw new _E(_i.UNEXPECTED_ERROR,"can not find source config");return f.clientRequest={command:"SetSourceUserId",uid:_.uid+""},f;case VR.SetDestChannel:if(m=n&&n.getDestChannelMediaInfo(),!m)throw new _E(_i.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{a.push(y.channelName),s.push(y.uid+""),d.push(y.token||this.joinInfo.appId)}),f.clientRequest={command:"SetDestChannel",channelName:a,uid:s,token:d},f;case VR.StartPacketTransfer:return f.clientRequest={command:"StartPacketTransfer"},f;case VR.Reconnect:return f.clientRequest={command:"Reconnect"},f;case VR.StopPacketTransfer:return f.clientRequest={command:"StopPacketTransfer"},f;case VR.UpdateDestChannel:if(m=n&&n.getDestChannelMediaInfo(),!m)throw new _E(_i.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{a.push(y.channelName),s.push(y.uid+""),d.push(y.token||this.joinInfo.appId)}),f.clientRequest={command:"UpdateDestChannel",channelName:a,uid:s,token:d},f;case VR.SetVideoProfile:f.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return f}}const Umt={name:"ChannelMediaRelay",create:function(t){return new xmt(t.joinInfo,t.clientId,t.websocketRetryConfig||wT,t.httpRetryConfig||wT,t.resolution)}};function Got(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function y6(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Got(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Got(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}class jmt extends eT{constructor(e,n,a,s){super(),_t(this,"spec",void 0),_t(this,"token",void 0),_t(this,"websocket",void 0),_t(this,"pingpongTimer",void 0),_t(this,"reconnectMode","retry"),_t(this,"serviceMode",void 0),_t(this,"reqId",0),_t(this,"commandReqId",0),_t(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),_t(this,"handleWebSocketMessage",d=>{if(!d.data)return;const f=JSON.parse(d.data);f.requestId?this.emit("@".concat(f.requestId,"-").concat(f.sid),f):(V_.workerEvent(this.spec.sid,{actionType:"status",serverCode:f.code,workerType:this.serviceMode===gL.TRANSCODE?1:2}),this.emit(kP.PUBLISH_STREAM_STATUS,f))}),this.spec=n,this.token=e,this.serviceMode=s,this.websocket=new z2("live-streaming",a),this.websocket.on(kv.CONNECTED,this.handleWebSocketOpen),this.websocket.on(kv.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(kv.REQUEST_NEW_URLS,(d,f)=>{cR(this,kP.REQUEST_NEW_ADDRESS).then(d).catch(f)}),this.websocket.on(kv.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,a,s){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const d=this.commandReqId,f=this.reqId;if(!f||!this.websocket)throw new _E(_i.UNEXPECTED_ERROR);const m=y6({command:e,sdkVersion:aO==="4.23.2"?"0.0.1":aO,seq:f,requestId:f,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new _E(_i.WS_DISCONNECT);const _=()=>new A_((L,B)=>{this.websocket.once(kv.CLOSED,()=>B(new _E(_i.WS_ABORT))),this.websocket.once(kv.CONNECTED,L)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new A_((L,B)=>{const Q=()=>{B(new _E(_i.WS_ABORT))};this.websocket.once(kv.RECONNECTING,Q),this.websocket.once(kv.CLOSED,Q),this.once("@".concat(f,"-").concat(this.spec.sid),X=>{L(X)})});s&&V_.workerEvent(this.spec.sid,y6(y6({},s),{},{requestId:d,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const T=Date.now();this.websocket.sendMessage(m);let w=null;try{w=await y}catch(L){if(this.websocket.state==="closed")throw L;return await _(),await this.request(e,n,a)}return s&&V_.workerEvent(this.spec.sid,y6(y6({},s),{},{requestId:d,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-T})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=aO==="4.23.2"?"0.0.1":aO;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case LT.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void F.warning("live stream response already exists stream");case LT.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case LT.LIVE_STREAM_RESPONSE_BAD_STREAM:case LT.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new _E(_i.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case LT.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case LT.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new _E(_i.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case LT.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new _E(_i.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(kP.WARNING,n,e.serverResponse.url)}case LT.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new _E(_i.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(kP.WARNING,n,e.serverResponse.url)}case LT.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case LT.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new _E(_i.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case LT.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new _E(_i.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(kP.WARNING,n,e.serverResponse.url)}case LT.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case LT.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case LT.LIVE_STREAM_RESPONSE_WORKER_LOST:case LT.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case LT.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case LT.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case LT.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case LT.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case LT.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new _E(_i.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(ZH)},6e3)}}function Hot(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function m0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Hot(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Hot(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}class Vmt extends eT{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wT,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wT;super(),_t(this,"onLiveStreamWarning",void 0),_t(this,"onLiveStreamError",void 0),_t(this,"spec",void 0),_t(this,"retryTimeout",1e4),_t(this,"connection",void 0),_t(this,"httpRetryConfig",void 0),_t(this,"wsRetryConfig",void 0),_t(this,"streamingTasks",new Map),_t(this,"isStartingStreamingTask",!1),_t(this,"taskMutex",new mR("live-streaming")),_t(this,"cancelToken",WR.CancelToken.source()),_t(this,"transcodingConfig",void 0),_t(this,"uapResponse",void 0),_t(this,"lastTaskId",1),_t(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=a,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=m0(m0({},Apt),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(F.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(f=>m0(m0(m0({},Rpt),f),{},{zOrder:f.zOrder?f.zOrder+1:1}))),function(f){iT(f.width)||IS(f.width,"config.width",0,1e4),iT(f.height)||IS(f.height,"config.height",0,1e4),iT(f.videoBitrate)||IS(f.videoBitrate,"config.videoBitrate",1,1e6),iT(f.videoFrameRate)||IS(f.videoFrameRate,"config.videoFrameRate"),iT(f.lowLatency)||pL(f.lowLatency,"config.lowLatency"),iT(f.audioSampleRate)||MT(f.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),iT(f.audioBitrate)||IS(f.audioBitrate,"config.audioBitrate",1,128),iT(f.audioChannels)||MT(f.audioChannels,"config.audioChannels",[1,2,3,4,5]),iT(f.videoGop)||IS(f.videoGop,"config.videoGop"),iT(f.videoCodecProfile)||MT(f.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),iT(f.userCount)||IS(f.userCount,"config.userCount",0,17),iT(f.backgroundColor)||IS(f.backgroundColor,"config.backgroundColor",0,16777215),iT(f.userConfigExtraInfo)||ZT(f.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),f.transcodingUsers&&!iT(f.transcodingUsers)&&(fL(f.transcodingUsers,"config.transcodingUsers"),f.transcodingUsers.forEach((m,_)=>{y8(m.uid),iT(m.x)||IS(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),iT(m.y)||IS(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),iT(m.width)||IS(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),iT(m.height)||IS(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),iT(m.zOrder)||IS(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),iT(m.alpha)||IS(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),iT(f.watermark)||Q7(f.watermark,"watermark"),iT(f.backgroundImage)||Q7(f.backgroundImage,"backgroundImage"),f.images&&!iT(f.images)&&(fL(f.images,"config.images"),f.images.forEach((m,_)=>{Q7(m,"images[".concat(_,"]"))}))}(n);const a=[];n.images&&a.push(...n.images.map(f=>m0(m0(m0({},Z7),f),{},{zOrder:255}))),n.backgroundImage&&(a.push(m0(m0(m0({},Z7),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(a.push(m0(m0(m0({},Z7),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=a,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(f=>m0({},f)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const s=(n.userConfigs||[]).map(f=>typeof f.uid=="number"?A_.resolve(f.uid):drt(f.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await A_.all(s)).forEach((f,m)=>{n.userConfigs&&n.userConfigs[m]&&(n.userConfigs[m].uid=f)}),this.transcodingConfig=n,this.connection)try{var d;const f=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(l0(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});F.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(f.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(f){if(!f.data||!f.data.retry)throw f;f.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{F.warning("[".concat(this.spec.clientId,"] live streaming receive error"),f.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,f).then(()=>{F.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{F.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(e,n,a){if(!this.transcodingConfig&&n===gL.TRANSCODE)throw new _E(_i.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const s={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};F.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(e)&&!a)return d(),new _E(_i.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(m){throw d(),m}switch(n){case gL.TRANSCODE:s.transcodingConfig=m0({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(s.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const f=this.lastTaskId++;try{const m=new A_((y,T)=>{QT(this.retryTimeout).then(()=>{if(a)return T(a);const w=this.statusError.get(e);return w?(this.statusError.delete(e),T(w)):void 0})}),_=await A_.race([this.connection.request("request",{clientRequest:s},!0,{url:e,command:"PublishStream",workerType:n===gL.TRANSCODE?1:2,requestByUser:!a,tid:f.toString()}),m]);this.isStartingStreamingTask=!1,F.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(e,{clientRequest:s,mode:n,url:e,taskId:f}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,m)):await this.startLiveStreamingTask(e,n,m)}}stopLiveStreamingTask(e){return new A_((n,a)=>{const s=this.streamingTasks.get(e);if(!s||!this.connection)return new _E(_i.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=s.mode;s.abortTask=()=>{F.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:s.url}},!1,{url:e,command:"UnPublishStream",workerType:d===gL.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(f=>{F.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(f.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(a)})}resetAllTask(){var e;const n=Array.from(l0(e=this.streamingTasks).call(e));this.terminate();for(const a of n)this.startLiveStreamingTask(a.url,a.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=WR.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new _E(_i.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await cR(this,$7.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new jmt(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(kP.WARNING,(a,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,a)),this.connection.on(kP.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(kP.REQUEST_NEW_ADDRESS,(a,s)=>{if(!this.connection)return s(new _E(_i.UNEXPECTED_ERROR,"can not get new live streaming address list"));cR(this,$7.REQUEST_WORKER_MANAGER_LIST,e).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(s)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",a=this.streamingTasks.get(n),s=e.reason;switch(e.code){case LT.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case LT.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case LT.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case LT.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const f=new _E(_i.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(a)return F.error(f.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,f);if(!this.isStartingStreamingTask)return;this.statusError.set(n,f)}case LT.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const f=new _E(_i.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,f)}case LT.LIVE_STREAM_RESPONSE_WORKER_LOST:case LT.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const f=Array.from(l0(d=this.streamingTasks).call(d));for(const m of f)m.abortTask?m.abortTask():(F.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new _E(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{F.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{F.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const Bmt={name:"LiveStreaming",create:function(t){return new Vmt(t.joinInfo,t.websocketRetryConfig||wT,t.httpRetryConfig||wT)}};function Fmt(t){let e=Kot();return function(n,a){let s=n.appId;s!==void 0&&(TS(a,10),LN(a,s));let d=n.cid;d!==void 0&&(TS(a,16),TS(a,d));let f=n.cname;f!==void 0&&(TS(a,26),LN(a,f));let m=n.deviceId;m!==void 0&&(TS(a,34),LN(a,m));let _=n.elapse;_!==void 0&&(TS(a,40),KP(a,_));let y=n.fileSize;y!==void 0&&(TS(a,48),KP(a,A3(y)));let T=n.height;T!==void 0&&(TS(a,56),KP(a,A3(T)));let w=n.jpg;w!==void 0&&(TS(a,66),TS(a,w.length),function($R,i_){let __=C3($R,i_.length);$R.bytes.set(i_,__)}(a,w));let L=n.networkType;L!==void 0&&(TS(a,72),KP(a,A3(L)));let B=n.osType;B!==void 0&&(TS(a,80),KP(a,A3(B)));let Q=n.requestId;Q!==void 0&&(TS(a,90),LN(a,Q));let X=n.sdkVersion;X!==void 0&&(TS(a,98),LN(a,X));let J=n.sequence;J!==void 0&&(TS(a,104),KP(a,A3(J)));let _n=n.sid;_n!==void 0&&(TS(a,114),LN(a,_n));let _r=n.timestamp;_r!==void 0&&(TS(a,120),KP(a,_r));let ya=n.uid;ya!==void 0&&(TS(a,128),TS(a,ya));let _l=n.vid;_l!==void 0&&(TS(a,136),TS(a,_l));let _d=n.width;_d!==void 0&&(TS(a,144),KP(a,A3(_d)));let tu=n.service;tu!==void 0&&(TS(a,152),TS(a,tu));let _g=n.callbackData;_g!==void 0&&(TS(a,162),LN(a,_g));let l_=n.jpgEncryption;l_!==void 0&&(TS(a,168),TS(a,l_));let O_=n.requestType;O_!==void 0&&(TS(a,176),TS(a,O_));let N_=n.scorePorn;N_!==void 0&&(TS(a,185),eX(a,N_));let iS=n.scoreSexy;iS!==void 0&&(TS(a,193),eX(a,iS));let oS=n.scoreNeutral;oS!==void 0&&(TS(a,201),eX(a,oS));let jS=n.scene;jS!==void 0&&(TS(a,208),TS(a,jS));let gT=n.ossFilePrefix;gT!==void 0&&(TS(a,218),LN(a,gT));let lT=n.serviceVendor;if(lT!==void 0)for(let $R of lT){TS(a,226);let i_=Kot();qmt($R,i_),TS(a,i_.limit),Ymt(a,i_),Wmt(i_)}}(t,e),function(n){let a=n.bytes,s=n.limit;return a.length===s?a:a.subarray(0,s)}(e)}function Gmt(t){return function(n){let a={};t:for(;!Wot(n);){let s=PN(n);switch(s>>>3){case 0:break t;case 1:a.code=PN(n);break;case 2:a.msg=Yot(n,PN(n));break;case 3:{let d=zmt(n);a.data=Hmt(n),n.limit=d;break}default:qot(n,7&s)}}return a}({bytes:e=t,offset:0,limit:e.length});var e}function Hmt(t){let e={};t:for(;!Wot(t);){let n=PN(t);switch(n>>>3){case 0:break t;case 1:e.requestId=Yot(t,PN(t));break;case 2:e.requestType=PN(t)>>>0;break;case 3:e.scorePorn=tX(t);break;case 4:e.scoreSexy=tX(t);break;case 5:e.scoreNeutral=tX(t);break;case 6:e.requestScene=PN(t)>>>0;break;case 7:e.scene=PN(t)>>>0;break;default:qot(t,7&n)}}return e}function qmt(t,e){let n=t.service;n!==void 0&&(TS(e,8),TS(e,n));let a=t.vendor;a!==void 0&&(TS(e,16),TS(e,a));let s=t.token;s!==void 0&&(TS(e,26),LN(e,s));let d=t.callbackUrl;d!==void 0&&(TS(e,34),LN(e,d))}function zmt(t){let e=PN(t),n=t.limit;return t.limit=t.offset+e,n}function qot(t,e){switch(e){case 0:for(;128&Xot(t););break;case 2:Q9(t,PN(t));break;case 5:Q9(t,4);break;case 1:Q9(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let Kmt=new Float32Array(1);new Uint8Array(Kmt.buffer);let Z9=new Float64Array(1),E0=new Uint8Array(Z9.buffer);function A3(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let zot=[];function Kot(){const t=zot.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function Wmt(t){zot.push(t)}function Q9(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function Wot(t){return t.offset>=t.limit}function C3(t,e){let n=t.bytes,a=t.offset,s=t.limit,d=a+e;if(d>n.length){let f=new Uint8Array(2*d);f.set(n),t.bytes=f}return t.offset=d,d>s&&(t.limit=d),a}function $9(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function Yot(t,e){let n=$9(t,e),a=String.fromCharCode,s=t.bytes,d="�",f="";for(let m=0;m<e;m++){let _,y,T,w,L=s[m+n];(128&L)==0?f+=a(L):(224&L)==192?m+1>=e?f+=d:(_=s[m+n+1],(192&_)!=128?f+=d:(w=(31&L)<<6|63&_,w<128?f+=d:(f+=a(w),m++))):(240&L)==224?m+2>=e?f+=d:(_=s[m+n+1],y=s[m+n+2],(49344&(_|y<<8))!=32896?f+=d:(w=(15&L)<<12|(63&_)<<6|63&y,w<2048||w>=55296&&w<=57343?f+=d:(f+=a(w),m+=2))):(248&L)==240?m+3>=e?f+=d:(_=s[m+n+1],y=s[m+n+2],T=s[m+n+3],(12632256&(_|y<<8|T<<16))!=8421504?f+=d:(w=(7&L)<<18|(63&_)<<12|(63&y)<<6|63&T,w<65536||w>1114111?f+=d:(w-=65536,f+=a(55296+(w>>10),56320+(1023&w)),m+=3))):f+=d}return f}function LN(t,e){let n=e.length,a=0;for(let f=0;f<n;f++){let m=e.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+e.charCodeAt(++f)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}TS(t,a);let s=C3(t,a),d=t.bytes;for(let f=0;f<n;f++){let m=e.charCodeAt(f);m>=55296&&m<=56319&&f+1<n&&(m=(m<<10)+e.charCodeAt(++f)-56613888),m<128?d[s++]=m:(m<2048?d[s++]=m>>6&31|192:(m<65536?d[s++]=m>>12&15|224:(d[s++]=m>>18&7|240,d[s++]=m>>12&63|128),d[s++]=m>>6&63|128),d[s++]=63&m|128)}}function Ymt(t,e){let n=C3(t,e.limit),a=t.bytes,s=e.bytes;for(let d=0,f=e.limit;d<f;d++)a[d+n]=s[d]}function Xot(t){return t.bytes[$9(t,1)]}function Jot(t,e){let n=C3(t,1);t.bytes[n]=e}function tX(t){let e=$9(t,8),n=t.bytes;return E0[0]=n[e++],E0[1]=n[e++],E0[2]=n[e++],E0[3]=n[e++],E0[4]=n[e++],E0[5]=n[e++],E0[6]=n[e++],E0[7]=n[e++],Z9[0]}function eX(t,e){let n=C3(t,8),a=t.bytes;Z9[0]=e,a[n++]=E0[0],a[n++]=E0[1],a[n++]=E0[2],a[n++]=E0[3],a[n++]=E0[4],a[n++]=E0[5],a[n++]=E0[6],a[n++]=E0[7]}function PN(t){let e,n=0,a=0;do e=Xot(t),n<32&&(a|=(127&e)<<n),n+=7;while(128&e);return a}function TS(t,e){for(e>>>=0;e>=128;)Jot(t,127&e|128),e>>>=7;Jot(t,e)}function KP(t,e){let n=e.low>>>0,a=(e.low>>>28|e.high<<4)>>>0,s=e.high>>>24,d=s===0?a===0?n<16384?n<128?1:2:n<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:s<128?9:10,f=C3(t,d),m=t.bytes;switch(d){case 10:m[f+9]=s>>>7&1;case 9:m[f+8]=d!==9?128|s:127&s;case 8:m[f+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[f+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[f+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[f+4]=d!==5?128|a:127&a;case 4:m[f+3]=d!==4?n>>>21|128:n>>>21&127;case 3:m[f+2]=d!==3?n>>>14|128:n>>>14&127;case 2:m[f+1]=d!==2?n>>>7|128:n>>>7&127;case 1:m[f]=d!==1?128|n:127&n}}function Zot(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}const Xmt=new Map([["moderation",1],["supervise",2]]);class Jmt extends eT{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(KT.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=LR(n=e.map(a=>Xmt.get(a)||0)).call(n,(a,s)=>a+s),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),_t(this,"name","AgoraRTCVideoContentInspect"),_t(this,"_connectionState",VO.CONNECTING),_t(this,"_innerConnectionState",void 0),_t(this,"sequence",0),_t(this,"inspectStartTime",void 0),_t(this,"workerManagerConnection",void 0),_t(this,"workerConnection",void 0),_t(this,"workerMessageLengthLimit",void 0),_t(this,"inspectIntervalMinimum",void 0),_t(this,"qualityRatio",void 0),_t(this,"_connectInfo",void 0),_t(this,"_cancelTokenSource",WR.CancelToken.source()),_t(this,"_retryConfig",void 0),_t(this,"wmSequence",0),_t(this,"inspectInterval",void 0),_t(this,"inspectTimer",null),_t(this,"ossFilePrefix",void 0),_t(this,"extraInfo",void 0),_t(this,"_inspectType",void 0),_t(this,"_inspectMode",void 0),_t(this,"_quality",1),_t(this,"qualityTimer",null),_t(this,"_inspectId",void 0),_t(this,"_needWorkUrlOnly",!1),_t(this,"inspectImage",()=>{if(this.connectionState!==VO.CONNECTED)throw new _E(_i.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===VO.CONNECTED?this.requestToInspectImage():F.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=xS(5,"inspect-"),this.workerMessageLengthLimit=aa("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=aa("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=aa("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new z2("worker-manager-"+this._inspectId,wT),this.on(KT.STATE_CHANGE,(n,a)=>{this._innerConnectionState=n,F.debug("[".concat(this._inspectId,"] Inspect operation :").concat(BO[n]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new z2("worker-"+this._inspectId,wT),this.handleWorkerEvents()}async init(e,n){this.emit(KT.STATE_CHANGE,BO.CONNECT_AP),this._connectInfo=e;const a=this._cancelTokenSource.token;return this._retryConfig=n,new A_((s,d)=>{this.on(KT.CONNECTION_STATE_CHANGE,(f,m)=>{m===VO.CONNECTED&&s()}),this.requestAP(e,a,n).then(f=>{this.connectWorkerManager(f)}).catch(f=>{d(f)})})}async requestAP(e,n,a){const s=aa("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,_,y,T){let{appId:w,areaCode:L,cname:B,sid:Q,token:X,uid:J}=_;m3++;const _n="image_moderation_api",_r={service_name:_n,json_body:JSON.stringify({appId:w,areaCode:L,cname:B,command:"allocateEdge",requestId:m3,seq:m3,sid:Q,token:X,ts:Date.now(),uid:J+""})};let ya,_l,_d=m[0];return RI(async()=>{ya=Date.now();const tu=await II(_d,{data:_r,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_l=Date.now()-ya,tu.code!==0){const N_=new _E(_i.UNEXPECTED_RESPONSE,"image inspect ap error, code"+tu.code,{retry:!0,responseTime:_l});throw F.error(N_.toString()),N_}const _g=JSON.parse(tu.json_body);if(_g.code!==200){const N_=new _E(_i.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(_g.code,", reason: ").concat(_g.reason),{code:_g.code,responseTime:_l});throw F.error(N_.toString()),N_}if(!_g.servers||!Array.isArray(_g.servers)||_g.servers.length===0){const N_=new _E(_i.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:_g.code,responseTime:_l});throw F.error(N_.toString()),N_}const l_=aa("VIDEO_INSPECT_WORKER_MANAGER_HOST"),O_=aa("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:_g.servers.map(N_=>{let{address:iS,wss:oS}=N_;if(iS&&oS)return"wss://".concat(iS.replace(/\./g,"-"),".").concat(l_,":").concat(O_||oS)}).filter(N_=>!!N_),workerToken:_g.workerToken,vid:_g.vid,responseTime:_l}},(tu,_g)=>(V_.apworkerEvent(Q,{success:!0,sc:200,serviceName:_n,responseDetail:JSON.stringify(tu.addressList),firstSuccess:_g===0,responseTime:_l,serverIp:m[_g%m.length]}),!1),(tu,_g)=>(V_.apworkerEvent(Q,{success:!1,sc:tu.data&&tu.data.code||200,serviceName:_n,responseTime:_l,serverIp:m[_g%m.length]}),!!(tu.code!==_i.OPERATION_ABORTED&&tu.code!==_i.UNEXPECTED_RESPONSE||tu.data&&tu.data.retry)&&(_d=m[(_g+1)%m.length],!0)),T)}(s,e,n,a);this.emit(KT.STATE_CHANGE,BO.AP_CONNECTED);const{addressList:f}=d;return this.wmSequence++,f}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(KT.STATE_CHANGE,BO.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(kv.CONNECTED,async()=>{this.emit(KT.STATE_CHANGE,BO.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(kv.CLOSED,()=>{this._innerConnectionState<BO.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(kv.FAILED,()=>{this._innerConnectionState<BO.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(kv.RECONNECTING,()=>{this._innerConnectionState<BO.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(kv.ON_MESSAGE,async e=>{this.emit(KT.STATE_CHANGE,BO.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(e.data);if(a.code!==200)throw F.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new _E(_i.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&n))throw F.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new _E(_i.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const s=aa("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=n.replace(/:\d+\/?$/,":".concat(s));this.emit(KT.STATE_CHANGE,BO.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(KT.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(kv.WILL_RECONNECT,(e,n,a)=>{a(e)}),this.workerManagerConnection.on(kv.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(kv.CONNECTED,async()=>{this.emit(KT.STATE_CHANGE,BO.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=VO.CONNECTED}),this.workerConnection.on(kv.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const a=Gmt(new Uint8Array(e.data));if(aa("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&F.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(KT.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var n;const s={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=LR(n=Object.keys(s)).call(n,(m,_)=>s[m]>s[_]?m:_,"porn"),f=Object.keys(s).find(m=>m===d);this.emit(KT.INSPECT_RESULT,f)}else this.emit(KT.INSPECT_RESULT,void 0,new _E(_i.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(KT.INSPECT_RESULT,void 0,new _E(_i.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else F.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(KT.INSPECT_RESULT,void 0,new _E(_i.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(kv.CLOSED,()=>{this.connectionState=VO.CLOSED}),this.workerConnection.on(kv.FAILED,()=>{this.connectionState=VO.CLOSED}),this.workerConnection.on(kv.RECONNECTING,()=>{this.connectionState=this.connectionState===VO.CONNECTED?VO.RECONNECTING:VO.CONNECTING}),this.workerConnection.on(kv.WILL_RECONNECT,(e,n,a)=>{e==="recover"&&a(e),a("tryNext")}),this.workerConnection.on(kv.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(KT.REQUEST_NEW_WORKER_URL,a=>{e([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{n(a)})})}async requestToInspectImage(){this.sequence++;const e=U0(this,KT.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(KT.INSPECT_RESULT,void 0,new _E(_i.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(e,n);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(KT.INSPECT_RESULT,void 0,new _E(_i.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:a,cname:s,cid:d,vid:f,sid:m,uid:_}=n;const y=Date.now(),T=await e.getCurrentFrameImage("image/jpeg",this.quality),w=await Ntt(T,a,s),L=this.sequence+"-"+d+"-"+_+"-"+y+"-"+xS(12,""),B={appId:a,cid:d,cname:s,deviceId:"",elapse:(Q=Number(y-this.inspectStartTime),{low:Q|=0,high:Q>>31,unsigned:Q>=0}),fileSize:w.byteLength,jpgEncryption:2,height:T.height,width:T.width,jpg:w,networkType:6,osType:7,requestId:L,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:oit(y),uid:_,vid:f,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var Q;this.extraInfo===void 0&&delete B.callbackData,this.ossFilePrefix===void 0&&delete B.ossFilePrefix;const X=Fmt(B);if(X.byteLength<this.workerMessageLengthLimit){if(aa("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const J=function(_n){for(var _r=1;_r<arguments.length;_r++){var ya=arguments[_r]!=null?arguments[_r]:{};_r%2?Zot(Object(ya),!0).forEach(function(_l){_t(_n,_l,ya[_l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_n,Object.getOwnPropertyDescriptors(ya)):Zot(Object(ya)).forEach(function(_l){Object.defineProperty(_n,_l,Object.getOwnPropertyDescriptor(ya,_l))})}return _n}({},B);delete J.jpg,F.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(J))}return X}{const J=this.quality*this.qualityRatio;return this.quality=J,await this.generateRequestData(e,{appId:a,cname:s,cid:d,vid:f,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=WR.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=VO.CLOSED,this.emit(KT.STATE_CHANGE,BO.CLOSED)}}const Zmt={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new _E(_i.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new _E(_i.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(n.inspectType)];a.forEach(s=>{var d;if(!T_(d=["supervise","moderation"]).call(d,s))throw new _E(_i.INVALID_PARAMS,"".concat(s," is not a valid inspect type."))}),n.inspectType=a}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new _E(_i.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new Jmt(e)}};var Qot=h(v0.Object.getOwnPropertySymbols),Qmt=SS,$mt=HN.indexOf,tEt=zR,nX=o_([].indexOf),$ot=!!nX&&1/nX([1],1,-0)<0;Qmt({target:"Array",proto:!0,forced:$ot||!tEt("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return $ot?nX(this,t,e)||0:$mt(this,t,e)}});var eEt=HR("Array").indexOf,nEt=$,rEt=eEt,rX=Array.prototype,iEt=function(t){var e=t.indexOf;return t===rX||nEt(rX,t)&&e===rX.indexOf?rEt:e},tat=h(iEt);function oEt(t,e){if(t==null)return{};var n,a,s=function(f,m){if(f==null)return{};var _,y,T={},w=ynt(f);for(y=0;y<w.length;y++)_=w[y],tat(m).call(m,_)>=0||(T[_]=f[_]);return T}(t,e);if(Qot){var d=Qot(t);for(a=0;a<d.length;a++)n=d[a],tat(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}let eat=class{get localCapabilities(){return aT(this._localCapabilities)}get rtpCapabilities(){return aT(this._rtpCapabilities)}get candidates(){return aT(this._candidates)}get iceParameters(){return aT(this._iceParameters)}get dtlsParameters(){return aT(this._dtlsParameters)}constructor(t){_t(this,"sessionDesc",void 0),_t(this,"_localCapabilities",void 0),_t(this,"_rtpCapabilities",void 0),_t(this,"_candidates",void 0),_t(this,"_iceParameters",void 0),_t(this,"_dtlsParameters",void 0),_t(this,"setup",void 0),_t(this,"currentMidIndex",void 0),_t(this,"cname","o/i14u9pJrxRKAsu"),_t(this,"firefoxSsrcMidMap",new Map),t=aT(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:a,remoteRTPCapabilities:s,localCapabilities:d,direction:f,setup:m,videoCodec:_,audioCodec:y}=t;let T;this.setup=m,T=f===jR.RECEIVE_ONLY?p0(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):p0(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=a,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=d;const w=f===jR.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,L=f===jR.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,B=f===jR.RECEIVE_ONLY?s.send.videoCodecs:Y2(k_.VIDEO,w,L,_),Q=f===jR.RECEIVE_ONLY?s.send.audioCodecs:Y2(k_.AUDIO,w,L,y);for(const X of T.mediaDescriptions)X.attributes.iceUfrag=e.iceUfrag,X.attributes.icePwd=e.icePwd,X.attributes.fingerprints=n.fingerprints,X.attributes.candidates=a,X.attributes.setup=this.setup,X.media.mediaType==="application"&&(X.attributes.sctpPort="5000"),X.media.mediaType==="video"&&(X.media.fmts=B.map(J=>J.payloadType.toString(10)),X.attributes.payloads=B,X.attributes.extmaps=w.videoExtensions),X.media.mediaType==="audio"&&(X.media.fmts=Q.map(J=>J.payloadType.toString(10)),X.attributes.payloads=Q,X.attributes.extmaps=w.audioExtensions,f3(X));this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return DP(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,a,s){n=n.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:f}=CM(e,this.cname,aa("SYNC_GROUP")?n:void 0),m=this.findPreloadMediaDesc(d);if(m){if(rT()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),s&&(s.twcc||s.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,s),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(t,d,a);let y;return _===-1?(y=this.createOrRecycleSendMedia(t,d,f,"sendonly",a,s),this.updateBundleMids()):(y=aT(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=d,y.attributes.ssrcGroups=f,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,s)),rT()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const a=[];return t.forEach(s=>{const d=s._mediaStreamTrack.kind,f=this.findAvailableRecvMediaIndex(d);let m,_=!1;f===-1?(_=!0,m=this.createOrRecycleRecvMedia(s,[],"recvonly",e,n),this.updateBundleMids()):(m=aT(this.sessionDesc.mediaDescriptions[f]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:_})}),a}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:a,port:s,type:d,relatedAddress:f,relatedPort:m,priority:_}=new RTCIceCandidate(t),y={foundation:e??"",componentId:"1",transport:n??"",priority:_?_+"":"",connectionAddress:a??"",port:s?s+"":"",type:d?d+"":"",relAddr:f??"",relPort:m?m+"":"",extension:{}};this.candidates.some(T=>T.priority===y.priority&&T.connectionAddress===y.connectionAddress&&T.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,a,s){const d=t._mediaStreamTrack.kind,f=this.rtpCapabilities.recv,m=Y2(d,f,this.localCapabilities.send,d===k_.AUDIO?s:a),_=d===k_.VIDEO?f.videoExtensions:f.audioExtensions,y="".concat(++this.currentMidIndex);let T={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(L=>L.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};T=this.mungRecvMediaDsec(T,t);const w=this.findFirstClosedMedia(d);if(w){const L=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[L]=T}else this.sessionDesc.mediaDescriptions.push(T);return T}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>T_(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>T_(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const s=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(rT()){if(s){const d=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return s&&a.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=aT(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,a,s,d){const f=this.rtpCapabilities.send,m=t===k_.VIDEO?f.videoCodecs:f.audioCodecs,_=t===k_.VIDEO?f.videoExtensions:f.audioExtensions;rT()&&(s="".concat(++this.currentMidIndex));let y={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:s}};y=this.mungSendMediaDesc(y,d);const T=this.findFirstClosedMedia(t);if(T){const w=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[w]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(t,e,n){const a=aT(t);return i9(a),p3(a,e),o9(a,e),znt(a),O8(a,n,this.localCapabilities.send),a}mungSendMediaDesc(t,e){const n=aT(t);return O8(n,e,this.localCapabilities.recv),f3(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(n!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>rT()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const aEt=["sdp"];var BS;function nat(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function WP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nat(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nat(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}let rat=(BS=class O3 extends Cnt{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,a){super(e,n),_t(this,"direction",void 0),_t(this,"name",void 0),_t(this,"store",void 0),_t(this,"spec",void 0),_t(this,"peerConnection",void 0),_t(this,"initialOffer",void 0),_t(this,"transport",void 0),_t(this,"statsFilter",void 0),_t(this,"localCandidateCount",0),_t(this,"_isInRestartIce",!1),_t(this,"mutex",void 0),_t(this,"onLocalCandidate",void 0),_t(this,"remoteSDP",void 0),_t(this,"pendingCandidates",[]),_t(this,"localCapabilities",void 0),_t(this,"isReady",!1),_t(this,"restartCnt",0),_t(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new mR("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(O3.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??jR.SEND_ONLY,this.name=this.direction===jR.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=_7(this.peerConnection,aa("STATS_UPDATE_INTERVAL"),void 0,rT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await Wnt();if(this.localCapabilities=w8(n),e){const{sdp:a}=e,s=oEt(e,aEt),d=function(){const T={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=W2(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),L={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Q={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(FO(w,T,"videoExtensions",L,B,Q),FO(w,T,"videoCodecs",L,B,Q),FO(w,T,"audioExtensions",L,B,Q),FO(w,T,"audioCodecs",L,B,Q),aa("RAISE_H264_BASELINE_PRIORITY")){const X=Q.videoCodecs.findIndex(J=>J.rtpMap&&J.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&J.fmtp&&J.fmtp.parameters["profile-level-id"]==="42001f");if(X!==-1){const J=Q.videoCodecs.findIndex(_n=>_n.rtpMap&&_n.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(J<X){F.debug("raising H264 baseline profile priority");const _n=Q.videoCodecs[X];Q.videoCodecs.splice(X,1),Q.videoCodecs.splice(J,0,_n)}J!==-1&&aa("FILTER_SEND_H264_BASELINE")&&(L.videoCodecs=L.videoCodecs.filter(_n=>!(_n.rtpMap&&_n.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&_n.fmtp&&_n.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:L,recv:B,sendrecv:Q}}({},{},a);this.remoteSDP=new eat({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const f=await this.peerConnection.createAnswer();if(!f.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=xP(f.sdp);await this.peerConnection.setLocalDescription(f);const _=await Ynt({},{},f.sdp);this.localCapabilities=w8(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),WP(WP({},m),{},{sdp:f.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=xP(a.sdp);return this.initialOffer=a,WP(WP({},s),{},{sdp:a.sdp})}}catch(n){throw new t_(_i.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:a,dtlsParameters:s}=e,d=await Ynt({},{},n);this.remoteSDP=new eat({remoteIceParameters:a,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const f=this.peerConnection.getTransceivers()[0];f!=null&&f.sender&&f.sender.transport&&this.tryBindTransportEvents(f.sender.transport)}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new t_(_i.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,a){var s=this;return oO(function*(){const d=yield uS(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=[],m=s.remoteSDP.receive(e,n,a);e.forEach((J,_n)=>{if(m[_n].needCreateTransceiver){const _r=s.peerConnection.addTransceiver(J._mediaStreamTrack,{direction:"sendonly"});f.push(_r),J._updateRtpTransceiver(_r)}else{const _r=s.peerConnection.getTransceivers().find(ya=>ya.mid===m[_n].mid);if(!_r)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[_n].mid));f.push(_r),J._updateRtpTransceiver(_r)}}),rT()&&aa("SIMULCAST")===!0&&(yield uS(s.applySimulcastForFirefox(f,e)));const _=m.map(J=>J.mid),y=yield uS(s.peerConnection.createOffer()),T=s.mungSendOfferSDP(y.sdp,e,_),w=p0(T),L=_.map(J=>{const _n=w.mediaDescriptions.find(_r=>_r.attributes.mid===J);if(!_n)throw new Error("Cannot extract ssrc from mediaDescription.");return Gnt(_n,aa("USE_PUB_RTX"))}),B=f.map((J,_n)=>{const _r=_[_n];return{localSSRC:L[_n],id:_r}});yield uS(s.peerConnection.setLocalDescription({type:"offer",sdp:T}));try{yield B}catch(J){const _n=s.remoteSDP.toString();throw yield uS(s.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield uS(s.peerConnection.setRemoteDescription({type:"answer",sdp:_n})),yield uS(s.stopSending(_,!0)),J}yield uS(s.applySimulcastEncodings(f,e)),yield uS(s.applySendEncodings(f,e));const Q=s.remoteSDP.toString(),X=s.logSDPExchange(T,"offer","local","send");return X==null||X(Q),yield uS(s.setRemoteDescription({type:"answer",sdp:Q})),f.map((J,_n)=>{const _r=_[_n];return{localSSRC:L[_n],id:_r}})}catch(f){throw f instanceof t_?f:new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{d()}})()}async stopSending(e,n){const a=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(_=>e.indexOf(_.mid)!==-1);if(s.length!==e.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));s.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const d=await this.peerConnection.createOffer(),f=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(e);const m=this.remoteSDP.toString();f==null||f(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(s){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{a&&a()}}async receive(e,n,a,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:d,needExchangeSDP:f}=this.remoteSDP.send(e,n,a,s);if(f){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const T=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(T.sdp,d,e);y==null||y(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===d);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(e,n,a,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:d,needExchangeSDP:f}=this.remoteSDP.send(e,n,a,s);if(f){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),T=this.mungReceiveAnswerSDP(y.sdp,d,e);_==null||_(T||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:T}),F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(d){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),a=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();a==null||a(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===_M.Auto&&(this.store.p2pTransport=_M.SdRtn,pS().supportPCSetConfiguration&&this.peerConnection.setConfiguration(O3.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,pS().supportPCSetConfiguration&&this.peerConnection.setConfiguration(O3.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=xP(n.sdp);return this.store.descriptionStart(),this.direction===jR.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===jR.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=xP(n.sdp);return await this.peerConnection.setLocalDescription(n),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(a.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const d=this.remoteSDP.toString(),f=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),f==null||f(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new t_(_i.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(e,n){const a=this.peerConnection.getTransceivers().filter(s=>s.mid===e);a.length===1&&(this.isVP8Simulcast(n)?rT()||await this.applySimulcastEncodings(a,[n]):await this.applySendEncodings(a,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const a=this.peerConnection.getTransceivers().find(s=>s.mid===n);a&&await a.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:a,remote:s}=n.getSelectedCandidatePair();return{local:WP(WP({},yN),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:WP(WP({},yN),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;T_(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s={iceServers:[]};var d;return e.iceServers?s.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(P2(e.turnServer.servers)?s.iceServers=e.turnServer.servers:(s.iceServers&&s.iceServers.push(...O3.turnServerConfigToIceServers(e.turnServer.servers,n,a)),aa("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&e.turnServer.serversFromGateway&&s.iceServers.push(...O3.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,a)),T_(d=[_M.Relay,_M.SdRtn]).call(d,n)&&(s.iceTransportPolicy="relay"),aa("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(f=>{f.forceturn&&(s.iceTransportPolicy="relay")}))),aa("ENABLE_ENCODED_TRANSFORM")&&pS().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),F.debug("P2PConnection p2pTransport is ".concat(n)),s}static turnServerConfigToIceServers(e,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=[],d=e.filter(m=>m.tcpport);F.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const f=d.length>a?d[a]:d[0];switch(n){case _M.SdRtn:const m=e.filter(y=>{var T;return T_(T=y.username).call(T,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>a?m[a]:m[0];_&&(s.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(PP(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),s.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(PP(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case _M.Relay:f&&(s.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),s.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(PP(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}));break;default:f&&(s.push({username:f.username,credential:f.password,credentialType:"password",urls:"turn:".concat(f.turnServerURL,":").concat(f.tcpport,"?transport=udp")}),s.push({username:f.username,credential:f.password,credentialType:"password",urls:"turns:".concat(PP(f.turnServerURL),":").concat(f.tcpport,"?transport=tcp")}),s.push({username:f.username,credential:f.password,credentialType:"password",urls:"stun:".concat(f.turnServerURL,":").concat(f.tcpport)}))}return s}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var a;e!=null&&e.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,e.state))},e.onerror=a=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in a?a.error:a)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const a=e==null?void 0:e.iceTransport.state;var s;a&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,a))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:a,remote:s}=n.getSelectedCandidatePair();F.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var a;if(n||(n=this.peerConnection.getSenders().find(T=>T.track===e._mediaStreamTrack)),!n)return F.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return F.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!pS().supportSetRtpSenderParameters)return F.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},d={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(e._encoderConfig){var f;const{bitrateMax:T,frameRate:w,scaleResolutionDownBy:L}=e._encoderConfig;T&&(d.maxBitrate=1e3*T),T_(f=e._hints).call(f,US.LOW_STREAM)&&(w&&(d.maxFramerate=w0(w)),L&&L>=1&&(d.scaleResolutionDownBy=L))}if(aa("DSCP_TYPE")&&hL()){var m;const T=aa("DSCP_TYPE");T_(m=["very-low","low","medium","high"]).call(m,T)&&(d.networkPriority=T)}const _=n.getParameters(),y=(a=_.encodings)===null||a===void 0?void 0:a[0];rT()&&!y&&(s.encodings=[d]),y&&Object.assign(y,d),Object.assign(_,s),F.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await n.setParameters(_)}async applySendEncodings(e,n){try{if(!pS().supportSetRtpSenderParameters||e.length!==n.length)return;for(let a=0;a<e.length;a++){const s=e[a],d=n[a];d instanceof zS&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,s.sender)}}catch{F.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,a){const s=p0(e);return n.forEach((d,f)=>{const m=a[f],_=s.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(p3(_,d),Knt(_,d,this.store.codec))}),DP(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,a)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,e,n,a)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let _=0;_<e.length;_++){var a,s,d,f,m;const y=e[_],T=n[_];if(T instanceof zS&&!T_(a=T._hints).call(a,US.LOW_STREAM)&&(s=T._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((d=T._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(f=T._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},L={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:L.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:L.high}];const B=y.sender.getParameters();await y.sender.setParameters(Object.assign(B,w))}}}async applySimulcastEncodings(e,n){if(!rT()&&e.length===n.length)for(let a=0;a<e.length;a++){const s=n[a];if(s instanceof zS&&this.isVP8Simulcast(s)){const d=e[a],f={},m={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=d.sender.getParameters();await d.sender.setParameters(Object.assign(_,f))}}}isVP8Simulcast(e){var n,a,s,d,f;return!!(e instanceof zS&&aa("SIMULCAST")&&this.store.codec==="vp8"&&!T_(n=e._hints).call(n,US.LOW_STREAM)&&(a=e._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((s=e._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(d=e._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((f=e._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1)}logSDPExchange(e,n,a,s){if(aa("SDP_LOGGING"))return F.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(n," SDP during P2PConnection.").concat(s,`
`),e),n==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",s)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&e.indexOf(f.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(f=>{f.direction="inactive"});const a=await this.peerConnection.createOffer(),s=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(e);const d=this.remoteSDP.toString();s==null||s(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(f=>f.mid&&e.indexOf(f.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async f=>{f.direction="sendonly"});const a=await this.peerConnection.createOffer(),s=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(e);const d=this.remoteSDP.toString();s==null||s(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var a,s;if(n=(a=n)!==null&&a!==void 0?a:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var d;const f=(d=p0(n).mediaDescriptions.find(m=>m.attributes.mid===e))===null||d===void 0?void 0:d.attributes.ssrcs;return f==null?void 0:f[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),T_(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,a){const s=p0(e),d=s.mediaDescriptions.find(f=>f.attributes.mid===n);return d&&a===k_.AUDIO&&d.media.mediaType==="audio"&&f3(d),DP(s)}},U_(BS.prototype,"establish",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"establish"),BS.prototype),U_(BS.prototype,"connect",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"connect"),BS.prototype),U_(BS.prototype,"receive",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"receive"),BS.prototype),U_(BS.prototype,"mockReceive",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"mockReceive"),BS.prototype),U_(BS.prototype,"stopReceiving",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"stopReceiving"),BS.prototype),U_(BS.prototype,"restartICE",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"restartICE"),BS.prototype),U_(BS.prototype,"close",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"close"),BS.prototype),U_(BS.prototype,"updateEncoderConfig",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"updateEncoderConfig"),BS.prototype),U_(BS.prototype,"updateSendParameters",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"updateSendParameters"),BS.prototype),U_(BS.prototype,"replaceTrack",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"replaceTrack"),BS.prototype),U_(BS.prototype,"muteLocal",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"muteLocal"),BS.prototype),U_(BS.prototype,"unmuteLocal",[KO],Object.getOwnPropertyDescriptor(BS.prototype,"unmuteLocal"),BS.prototype),BS);function KO(t,e,n){const a=t[e];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,d=await s.lock("From P2PConnection.".concat(e));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await a.apply(this,m)}finally{d()}},n}let DI=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var iat,oat,aat,sat,cat,uat,lat,dat,hat,pat,fat,QS;function mat(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function uK(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mat(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mat(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}let sEt=(iat=kI(DI.SEND_ONLY),oat=kI(DI.SEND_ONLY),aat=kI(),sat=kI(DI.RECEIVE_ONLY),cat=kI(DI.RECEIVE_ONLY),uat=kI(DI.RECEIVE_ONLY),lat=kI(DI.RECEIVE_ONLY),dat=kI(DI.RECEIVE_ONLY),hat=kI(DI.RECEIVE_ONLY),pat=kI(),fat=kI(DI.RECEIVE_ONLY),QS=class extends eT{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(H_.StateChange,e,this._state)}constructor(t,e){super(),_t(this,"isPlanB",!1),_t(this,"store",void 0),_t(this,"statsUploader",void 0),_t(this,"sendConnection",void 0),_t(this,"recvConnection",void 0),_t(this,"localTrackMap",new Map),_t(this,"remoteUserMap",new Map),_t(this,"localDataChannels",[]),_t(this,"pendingLocalTracks",[]),_t(this,"pendingRemoteTracks",[]),_t(this,"statsCollector",void 0),_t(this,"dtlsFailedCount",0),_t(this,"sendMutex",void 0),_t(this,"recvMutex",void 0),_t(this,"_state",yS.Disconnected),_t(this,"_restartStates",["disconnected","failed"]),_t(this,"reconnectInterval",void 0),_t(this,"uploadUnplinkStarted",!1),_t(this,"uploadDownlinkStarted",!1),_t(this,"uplinkStateUploadInterval",void 0),_t(this,"downlinkStatsUploadInterval",void 0),_t(this,"handleMuteLocalTrack",async(n,a,s)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==yS.Connected)return void s(new t_(_i.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(n);if(_.length===0)return void a();const y=_.find(B=>B[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(B=>{let[,{id:Q}]=B;return Q}));let T=!1;var f,m;n.trackMediaType==="video"?T=!((f=this.localTrackMap.get(u_.LocalAudioTrack))===null||f===void 0||!f.track._muted):T=((m=this.localTrackMap.get(u_.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const w=this.createMuteMessage(_);await MS(this,H_.RequestMuteLocal,w);const L=n.trackMediaType==="video"?LP.MUTE_LOCAL_VIDEO:LP.MUTE_LOCAL_AUDIO;await MS(this,H_.RequestP2PMuteLocal,{action:L,message:w,isMuteAll:T}),a()}catch(_){s(_)}finally{d()}}),_t(this,"handleUnmuteLocalTrack",async(n,a,s)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==yS.Connected)return void s(new t_(_i.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const f=this.filterTobeUnmutedTracks(n);if(f.length===0)return void a();await this.sendConnection.unmuteLocal(f.map(y=>{let[,{id:T}]=y;return T}));const m=this.createUnmuteMessage(f),_=n.trackMediaType==="video"?LP.UNMUTE_LOCAL_VIDEO:LP.UNMUTE_LOCAL_AUDIO;await MS(this,H_.RequestP2PMuteLocal,{action:_,message:m}),a()}catch(f){s(f)}finally{d()}}),_t(this,"handleUpdateVideoEncoder",async(n,a,s,d)=>{let f;typeof d=="boolean"&&d||(f=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(u_.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==n||this.state!==yS.Connected)return void a();const{id:y,track:T}=_;y&&(await this.sendConnection.updateSendParameters(y,T),await this.sendConnection.updateEncoderConfig(y,T),this.emit(H_.UpdateVideoEncoder,T)),a()}catch(_){s(_)}finally{var m;(m=f)===null||m===void 0||m()}}),_t(this,"handleUpdateVideoSendParameters",async(n,a,s)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const f=this.localTrackMap.get(u_.LocalVideoTrack);if(!this.sendConnection||!f||f.track!==n||this.state!==yS.Connected)return void a();const{id:m,track:_}=f;m&&await this.sendConnection.updateSendParameters(m,_),a()}catch(f){s(f)}finally{d()}}),_t(this,"handleReplaceTrack",async(n,a,s,d)=>{let f;F.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof d=="boolean"&&d||(f=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:w}]=T;return n===w});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==yS.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(n,y[1].id)),y[0]===u_.LocalVideoTrack&&pS().supportDualStreamEncoding){const T=this.localTrackMap.get(u_.LocalVideoLowTrack);if(T){const w=n._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=w,T.track._originMediaStreamTrack=w,await new A_((L,B)=>{this.handleReplaceTrack(T.track,L,B,!0)})}}a()}catch(y){s(y)}finally{var _;(_=f)===null||_===void 0||_()}}),_t(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),_t(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),_t(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),_t(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new Lrt(t),this.bindStatsUploaderEvents(),this.sendMutex=new mR("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new mR("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},aa("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(F.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new rat(t,this.store,jR.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(e);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=yS.New,this.sendConnection&&(F.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new rat(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new t_(_i.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=yS.Connected}async addRemoteCandidate(t,e){if(e===jR.RECEIVE_ONLY){if(!this.sendConnection)throw new t_(_i.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new t_(_i.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var a=this;return oO(function*(){const s=yield uS(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==yS.Connected){a.throwIfTrackTypeNotMatch(t);const y=t.filter(T=>a.pendingLocalTracks.indexOf(T)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(y))}a.store.pubId=a.store.pubId+1,_R.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(t,e,n);if(d.length===0)return void(yield uS(a.tryToUnmuteAudio(t)));d.forEach(y=>{let{track:T,type:w}=y;const L=Date.now();a.store.publish(T.getTrackId(),w===u_.LocalAudioTrack?"audio":"video",L)}),a.bindLocalTrackEvents(d);const f=yield uS(a.sendConnection.send(d.map(y=>{let{track:T}=y;return T}),a.store.codec,a.store.audioCodec)),m=(yield uS(f.next())).value,_=a.createGatewayPublishMessage(d,m);try{yield _}catch(y){throw f.throw(y),(y==null?void 0:y.code)===_i.WS_ABORT&&d.forEach(T=>{let{track:w}=T;a.pendingLocalTracks.indexOf(w)===-1&&a.pendingLocalTracks.push(w)}),a.unbindLocalTrackEvents(d),y}yield uS(f.next()),d.forEach(y=>{let{type:T}=y;a.statsCollector.addLocalStats(T)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,m),d.forEach(y=>{let{track:T,type:w}=y;const L=Date.now();a.store.publish(T.getTrackId(),w===u_.LocalAudioTrack?"audio":"video",void 0,L)}),a.startUploadUplinkState()}finally{s()}})()}async unpublish(t){if(!this.sendConnection||this.state!==yS.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(s=>!T_(t).call(t,s)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(s=>s[0]==="videoLowTrack");n&&n[1].track.close();const a=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(s=>{let[,{id:d}]=s;return d})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(s=>{let[d,{track:f}]=s;return{type:d,track:f}})),e.forEach(s=>{let[d]=s;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===yS.Connected)return n&&n[1].track.close(),a;t.forEach(s=>{const d=this.pendingLocalTracks.indexOf(s);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[s,{track:d,ssrcs:f}]=a;const m={stream_type:Qpt(d,s),ssrcs:f};d._muted||!d._enabled?e.push(m):n.push(m)}),e.length>0&&e.forEach(a=>{MS(this,H_.RequestMuteLocal,[a])}),n.length>0&&n.forEach(a=>{MS(this,H_.RequestUnmuteLocal,[a])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return oO(function*(){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(F.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await cR(this,H_.RequestRePublish,this.pendingLocalTracks),this.emit(H_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,a){var s;if(!this.recvConnection)throw new t_(_i.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;const{track:d,mid:f,transceiver:m}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),a);e===k_.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new o3(d,t.uid,t._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new i3(d,t.uid,t._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const _=this.remoteUserMap.get(t);_?_.set(e,f):this.remoteUserMap.set(t,new Map([[e,f]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(T=>{let{user:w,kind:L}=T;return w.uid===t.uid&&e===L});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(H_.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,a){if(!this.recvConnection)throw new t_(_i.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),a)}async unsubscribe(t,e,n){const a=this.pendingRemoteTracks.filter(d=>{let{user:f,kind:m}=d;return e!==void 0?f.uid===t.uid&&e===m:f.uid===t.uid});if(a.forEach(d=>{const f=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(f,1)}),this.recvConnection||n||a.forEach(d=>{let{kind:f}=d;var m;if(f===k_.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(f===k_.VIDEO){var _;(_=t._videoTrack)===null||_===void 0||_._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const s=this.filterTobeUnSubscribedTracks(t,e);s.length!==0&&(await this.recvConnection.stopReceiving(s.map(d=>{let[,{id:f}]=d;return f})),this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach(d=>{let[f,{kind:m}]=d;var _,y;if(m===k_.VIDEO&&f._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),m===k_.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),n||((y=f._videoTrack)===null||y===void 0||y._destroy(),f._videoTrack=void 0);else if(m===k_.AUDIO){var T;this.unbindRemoteTrackEvents(f._audioTrack),!n&&((T=f._audioTrack)===null||T===void 0||T._destroy(),f._audioTrack=void 0)}}),s.forEach(d=>{let[,{kind:f}]=d;MS(this,H_.RequestP2PMuteRemote,f)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[k_.VIDEO,k_.AUDIO].forEach(a=>{n.has(a)?MS(this,H_.RequestP2PUnmuteRemote,a):MS(this,H_.RequestP2PMuteRemote,a)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new t_(_i.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void F.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const a=e===k_.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||F.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(u_.LocalAudioTrack);if((e==null?void 0:e.track)instanceof kT){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[s]=a;return s!==u_.LocalAudioTrack}).filter(a=>{let[s]=a;return!(t&&s===u_.LocalVideoLowTrack)}).map(a=>{let[,{track:s}]=a;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[a]=n;return!(t&&a===u_.LocalVideoLowTrack)}).map(n=>{let[,{track:a}]=n;return a})}reportPublishEvent(t,e,n,a,s){if(t){const f=this.localTrackMap.get(u_.LocalAudioTrack),m=a?this.localTrackMap.get(u_.LocalVideoLowTrack):this.localTrackMap.get(u_.LocalVideoTrack);V_.publish(this.store.sessionId,{eventElapse:_R.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:f==null?void 0:f.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(US.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var d;n||(n=[]);const f=n.find(_=>_ instanceof uT),m=a?(d=this.localTrackMap.get(u_.LocalVideoTrack))===null||d===void 0?void 0:d.track:n.find(_=>_ instanceof zS);V_.publish(this.store.sessionId,{eventElapse:_R.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:f==null?void 0:f.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(US.SCREEN_TRACK))!==-1,audio:!!f,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(t,e,n,a){const s=a===k_.VIDEO?n._videoSSRC:n._audioSSRC;s&&V_.subscribe(this.store.sessionId,{succ:t,ec:e,video:a===k_.VIDEO,audio:a===k_.AUDIO,peerid:n.uid,subscribeRequestid:a===k_.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:_R.measureFromSubscribeStart(this.store.clientId,s)})}reset(){F.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new mR("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new mR("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(u_.LocalAudioTrack);if((t==null?void 0:t.track)instanceof kT){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=yS.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(u_.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(u_.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof zS||e&&e.track instanceof uT?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(V0(e=this.remoteUserMap).call(e)).find(a=>a.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[a]=n;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(u_.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=_2(t).call(t,(n,a)=>n.level-a.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(F.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=yS.Reconnecting,aa("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:a}]=t;switch(n){case u_.LocalVideoTrack:T_(e=a._hints).call(e,US.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case u_.LocalAudioTrack:a instanceof kT?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case u_.LocalVideoLowTrack:}}),this.emit(H_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(V0(n).call(n)).forEach(a=>{this.setPendingRemoteMedia(e,a)}),this.emit(H_.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),F.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:a,kind:s}=n;if((t instanceof jP?t.uid:t)===a.uid&&e===s)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,a;if(t===jR.SEND_ONLY){if(!this.sendConnection)throw new t_(_i.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new t_(_i.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(e){const s=await a.restartICE(e);return a.isInRestartIce=!1,s}{const s=await a.restartICE();if(s){const d=await cR(this,H_.RequestP2PRestartICE,{direction:jR.RECEIVE_ONLY,iceParameter:s});await a.restartICE(d),a.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(u_.LocalVideoTrack),n=this.localTrackMap.get(u_.LocalAudioTrack),a=t.videoSend.find(B=>{var Q;return B.ssrc===(e==null||(Q=e.ssrcs)===null||Q===void 0?void 0:Q[0].ssrcId)}),s=t.audioSend.find(B=>{var Q;return B.ssrc===(n==null||(Q=n.ssrcs)===null||Q===void 0?void 0:Q[0].ssrcId)});if(!a||!s)return 1;const d=U0(this,H_.NeedSignalRTT),f=a?a.rttMs:void 0,m=s?s.rttMs:void 0,_=f&&m?(f+m)/2:f||m,y=(_&&d?(_+d)/2:_||d)||0,T=100*t.sendPacketLossRate*.7/50+.3*y/1500,w=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,L=e==null?void 0:e.track;if(L&&L._encoderConfig&&L._hints.indexOf(US.SCREEN_TRACK)===-1){const B=L._encoderConfig.bitrateMax,Q=t.bitrate.actualEncoded;if(B&&Q){const X=(1e3*B-Q)/(1e3*B);return gnt[X<.15?0:X<.3?1:X<.45?2:X<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[a]=n;const s=a._audioSSRC,d=a._videoSSRC,f=t.audioRecv.find(Q=>Q.ssrc===s),m=t.videoRecv.find(Q=>Q.ssrc===d);if(!f&&!m)return void(e+=1);const _=U0(this,H_.NeedSignalRTT),y=t.rtt,T=(y&&_?(y+_)/2:y||_)||0,w=f?f.jitterMs:void 0,L=t.recvPacketLossRate;let B=.7*L*100/50+.3*T/1500;w&&(B=.6*L*100/50+.2*T/1500+.2*w/400),e+=B<.1?1:B<.17?2:B<.36?3:B<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new A_((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const a=[],s=pS(),d=this.getAllTracks();t=KV(t=t.filter(_=>d.indexOf(_)===-1));let f=!1,m=!1;for(const _ of t){if(_ instanceof zS&&(this.localTrackMap.has(u_.LocalVideoTrack)||f?new t_(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:_,type:u_.LocalVideoTrack}),f=!0),e)){const y=this.getLowVideoTrack(_,n);a.push({track:y,type:u_.LocalVideoLowTrack})}if(_ instanceof uT){const y=this.localTrackMap.get(u_.LocalAudioTrack);if(y){if(!(y.track instanceof kT))throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const T=a.find(w=>{let{type:L}=w;return L===u_.LocalAudioTrack});if(!(T.track instanceof kT))throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");T.track.addAudioTrack(_)}else{if(!s.webAudioMediaStreamDest||_ instanceof kT||_._bypassWebAudio)a.push({track:_,type:u_.LocalAudioTrack});else{const T=new kT;T.addAudioTrack(_),a.push({track:T,type:u_.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=KV(t=t.filter(a=>n.indexOf(a)!==-1));for(const a of t){if(a instanceof uT){const s=this.localTrackMap.get(u_.LocalAudioTrack);if(!s)continue;s.track instanceof kT?(s.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),s.track.trackList.length===0&&(e.push([u_.LocalAudioTrack,s]),s.track.close())):e.push([u_.LocalAudioTrack,s])}if(a instanceof zS){const s=this.localTrackMap.get(u_.LocalVideoTrack);if(!s)continue;e.push([u_.LocalVideoTrack,s]);const d=this.localTrackMap.get(u_.LocalVideoLowTrack);d&&e.push([u_.LocalVideoLowTrack,d])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:a}=e;switch(a){case u_.LocalVideoTrack:n.addListener(M_.GET_STATS,this.handleGetLocalVideoStats),n.addListener(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(M_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(M_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case u_.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case u_.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof kT?t.trackList.forEach(n=>{n.addListener(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(M_.GET_STATS,this.handleGetLocalAudioStats),n.addListener(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(M_.GET_STATS,this.handleGetLocalAudioStats),t.addListener(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:a}]=e;return{track:a,type:n}})),t.forEach(e=>{let{track:n,type:a}=e;switch(a){case u_.LocalVideoTrack:n.off(M_.GET_STATS,this.handleGetLocalVideoStats),n.off(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(M_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(M_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case u_.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case u_.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof kT?t.trackList.forEach(e=>{e.off(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(M_.GET_STATS,this.handleGetLocalAudioStats),e.off(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(M_.GET_STATS,this.handleGetLocalAudioStats),t.off(M_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(M_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(M_.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(M_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(M_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof i3&&e.addListener(M_.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof o3&&e.addListener(M_.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(M_.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(k_.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(k_.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,a)=>{var s;let d,{track:f,type:m}=n;switch(m){case u_.LocalAudioTrack:d=bS.Audio;break;case u_.LocalVideoTrack:d=T_(s=f._hints).call(s,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalVideoLowTrack:d=bS.Low}return{kind:m===u_.LocalAudioTrack?k_.AUDIO:k_.VIDEO,stream_type:d,mid:e[a].id,ssrcs:e[a].localSSRC,isMuted:f.muted||!f.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let a,[s,{track:d,ssrcs:f,id:m}]=e;switch(s){case u_.LocalVideoTrack:a=T_(n=d._hints).call(n,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalAudioTrack:a=bS.Audio;break;case u_.LocalVideoLowTrack:a=bS.Low}return{stream_type:a,ssrcs:f,mid:m}})}assignLocalTracks(t,e){t.forEach((n,a)=>{let{track:s,type:d}=n;this.localTrackMap.set(d,{track:s,id:e[a].id,ssrcs:e[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(H_.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),T_(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await QT(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),V_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:oT.TRACER}).onSuccess(),this.emit(H_.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const a=Array.from(V0(n=this.remoteUserMap).call(n)).find(d=>d._audioSSRC===e);var s;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(s=a.audioTrack)===null||s===void 0||s.emit(_B.FIRST_FRAME_DECODED),V_.firstRemoteFrame(this.store.sessionId,VT.FIRST_AUDIO_DECODE,JS.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const a=Array.from(V0(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);a&&V_.firstRemoteFrame(this.store.sessionId,VT.FIRST_AUDIO_RECEIVED,JS.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,a)=>{this.reportVideoFirstFrameDecoded(e,n,a)},t.onFirstVideoReceived=e=>{var n;const a=Array.from(V0(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===e);a&&V_.firstRemoteFrame(this.store.sessionId,VT.FIRST_VIDEO_RECEIVED,JS.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const a=e.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&a===s||this.emit(H_.ConnectionTypeChange,a),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(MP(n))," -> ").concat(JSON.stringify(MP(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(MP(n))," -> ").concat(JSON.stringify(MP(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(H_.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===jR.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,F.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===jR.SEND_ONLY?this.restartICE(t):cR(this,H_.RequestP2PRestartICE,{direction:jR.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(u_.LocalAudioTrack);if(t instanceof uT&&(n==null?void 0:n.track)instanceof kT)return n.track.isActive||e.push([u_.LocalAudioTrack,n]),e;const a=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:d}]=s;return t===d});if(a&&(e.push(a),a[0]===u_.LocalVideoTrack)){const s=this.localTrackMap.get(u_.LocalVideoLowTrack);s&&e.push([u_.LocalVideoLowTrack,s])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(u_.LocalAudioTrack);if(t instanceof uT&&(n==null?void 0:n.track)instanceof kT)return n.track.isActive&&e.push([u_.LocalAudioTrack,n]),e;const a=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:d}]=s;return t===d});if(a)if(a[0]===u_.LocalVideoTrack){e.push(a);const s=this.localTrackMap.get(u_.LocalVideoLowTrack);s&&e.push([u_.LocalVideoLowTrack,s])}else e.push(a);return e}createMuteMessage(t){return t.map(e=>{var n;let a,[s,{track:d,ssrcs:f,id:m}]=e;switch(s){case u_.LocalAudioTrack:a=bS.Audio;break;case u_.LocalVideoTrack:a=T_(n=d._hints).call(n,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalVideoLowTrack:a=bS.Low}return{stream_type:a,ssrcs:f,mid:m}})}createUnmuteMessage(t){return t.map(e=>{var n;let a,[s,{track:d,ssrcs:f,id:m}]=e;switch(s){case u_.LocalAudioTrack:a=bS.Audio;break;case u_.LocalVideoTrack:a=T_(n=d._hints).call(n,US.SCREEN_TRACK)?bS.Screen:bS.High;break;case u_.LocalVideoLowTrack:a=bS.Low}return{stream_type:a,ssrcs:f,mid:m}})}filterTobeUnSubscribedTracks(t,e){const n=[],a=this.remoteUserMap.get(t);if(!a)return n;if(e){const s=a.get(e);if(!s)return n;n.push([t,{kind:e,id:s}])}else Array.from(a.entries()).forEach(s=>{let[d,f]=s;n.push([t,{kind:d,id:f}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[a,{kind:s,id:d}]=n;switch(s){case k_.VIDEO:return void(a._videoSSRC&&e.push({stream_type:k_.VIDEO,ssrcId:a._videoSSRC}));case k_.AUDIO:return void(a._audioSSRC&&e.push({stream_type:k_.AUDIO,ssrcId:a._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:a}]=e;const s=this.remoteUserMap.get(n);s&&(s.delete(a),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(u_.LocalVideoTrack),n=this.localTrackMap.get(u_.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new A_((a,s)=>{this.handleUpdateVideoEncoder(e.track,a,s,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new A_((a,s)=>{this.handleUpdateVideoEncoder(n.track,a,s,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof uT){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const a=this.createUnmuteMessage(n);return void await MS(this,H_.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(H_.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(H_.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await QT(h7(this.dtlsFailedCount,wT)),this.emit(H_.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(u_.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof zS)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof zS).length>1)throw new t_(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof uT).length>1&&(t.some(e=>e instanceof uT&&e._bypassWebAudio)||!pS().webAudioMediaStreamDest))throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof zS&&this.pendingLocalTracks.some(n=>n instanceof zS))throw new t_(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof uT&&this.pendingLocalTracks.some(n=>n instanceof uT)&&(!pS().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof uT&&n._bypassWebAudio)))throw new t_(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!aa("DISABLE_DUAL_STREAM_USE_ENCODING")&&pS().supportDualStreamEncoding,a=uK(uK({},{width:160,height:120,framerate:15,bitrate:50}),e);let s;s=n?t._mediaStreamTrack.clone():b9(t,a);const d=xS(8,"track-low-"),f=new zS(s,uK(uK({},n&&{scaleResolutionDownBy:r9(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return f.on(vM.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,QV.LOW_STREAM)}),f._hints.push(US.LOW_STREAM),t.addListener(M_.NEED_CLOSE,()=>{f.close()}),f}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,a){var s;const d=Array.from(V0(s=this.remoteUserMap).call(s)).find(f=>f._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const f=this.store.keyMetrics,m=f.subscribe.find(_=>_.userId===d.uid&&_.type==="video");V_.firstRemoteVideoDecode(this.store.sessionId,VT.FIRST_VIDEO_DECODE,JS.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:e,videoheight:n,subscribeElapse:_R.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:f.requestAPEnd||0,apStart:f.requestAPStart||0,joinGwEnd:f.joinGatewayEnd||0,joinGwStart:f.joinGatewayStart||0,pcEnd:f.peerConnectionEnd||0,pcStart:f.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const s=a.get(e);if(!s)return!1;const d=await this.recvConnection.getRemoteSSRC(s);return d!==void 0&&d!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new t_(_i.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new t_(_i.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new t_(_i.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new t_(_i.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new t_(_i.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new t_(_i.NOT_SUPPORTED)}async preConnect(t){throw new t_(_i.NOT_SUPPORTED)}getEstablishParams(){throw new t_(_i.NOT_SUPPORTED)}async reSubscribe(t){throw new t_(_i.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new t_(_i.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===u_.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,QV.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},U_(QS.prototype,"p2pConnect",[iat],Object.getOwnPropertyDescriptor(QS.prototype,"p2pConnect"),QS.prototype),U_(QS.prototype,"unpublish",[oat],Object.getOwnPropertyDescriptor(QS.prototype,"unpublish"),QS.prototype),U_(QS.prototype,"unpublishLowStream",[aat],Object.getOwnPropertyDescriptor(QS.prototype,"unpublishLowStream"),QS.prototype),U_(QS.prototype,"subscribe",[sat],Object.getOwnPropertyDescriptor(QS.prototype,"subscribe"),QS.prototype),U_(QS.prototype,"mockSubscribe",[cat],Object.getOwnPropertyDescriptor(QS.prototype,"mockSubscribe"),QS.prototype),U_(QS.prototype,"unsubscribe",[uat],Object.getOwnPropertyDescriptor(QS.prototype,"unsubscribe"),QS.prototype),U_(QS.prototype,"muteRemote",[lat],Object.getOwnPropertyDescriptor(QS.prototype,"muteRemote"),QS.prototype),U_(QS.prototype,"unmuteRemote",[dat],Object.getOwnPropertyDescriptor(QS.prototype,"unmuteRemote"),QS.prototype),U_(QS.prototype,"hasRemoteMediaWithLock",[hat],Object.getOwnPropertyDescriptor(QS.prototype,"hasRemoteMediaWithLock"),QS.prototype),U_(QS.prototype,"disconnectForReconnect",[pat],Object.getOwnPropertyDescriptor(QS.prototype,"disconnectForReconnect"),QS.prototype),U_(QS.prototype,"remoteMediaSsrcChanged",[fat],Object.getOwnPropertyDescriptor(QS.prototype,"remoteMediaSsrcChanged"),QS.prototype),QS);function kI(t){return function(e,n,a){const s=e[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,f=new Array(d),m=0;m<d;m++)f[m]=arguments[m];switch(t){case DI.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,f)}finally{_()}}case DI.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,f)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(n)),y=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,f)}finally{_(),y()}}}},a}}class BM extends eT{constructor(e,n){super(),_t(this,"signal",void 0),_t(this,"token",void 0),_t(this,"tokenTimeout",void 0),_t(this,"tokenInterval",void 0),_t(this,"_sequence",0),_t(this,"userMap",new Map),_t(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const a=()=>{this.signal.connectionState===VS.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*aa("P2P_TOKEN_INTERVAL"))};a()}async send(e,n,a,s,d){var f,m,_;if(this.userMap.size===0)return;const y=Array.from(l0(f=this.userMap).call(f))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),s=(m=s)!==null&&m!==void 0?m:xS(6,""),d=(_=d)!==null&&_!==void 0?_:this._sequence++;const T={_id:s,_type:e,_seq:d,_message:n,token:"".concat(this.token,"_").concat(y)};aa("SHOW_P2P_LOG")&&F.debug("send message",T,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(T)).forEach(L=>{this.signal.request(X_.DATA_STREAM,{payload:NP(this.encoder.encode(L))})});const w=new A_((L,B)=>{const Q=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),X),this.off("res-@".concat(s),_n),this.off(l3.ABORT,J),F.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(s)),this.userMap.size===0?B(new t_(_i.INVALID_REMOTE_USER)):B(new t_(_i.TIMEOUT))},aa("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),X=()=>{Q&&window.clearTimeout(Q),this.off(l3.ABORT,J),a&&L()},J=()=>{Q&&window.clearTimeout(Q),this.off("res-@".concat(s,"_ack"),X),this.off("res-@".concat(s),_n),B(new t_(_i.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(s)))};this.once(l3.ABORT,J),this.once("res-@".concat(s,"_ack"),X);const _n=(ya,_l)=>{_r=!0,Q&&window.clearTimeout(Q),this.off("res-@".concat(s,"_ack"),X),this.off(l3.ABORT,J),ya==="success"?L(_l):B(new t_(_i.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(s)))};let _r=!1;a||(this.once("res-@".concat(s),_n),QT(aa("SIGNAL_REQUEST_TIMEOUT")).then(()=>{_r||F.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(s,", ").concat(T))}))});try{return await w}catch(L){if(L.code===_i.TIMEOUT)return await this.send(e,n,a,s,d);throw L}}onMessage(e){var n;const{_uid:a}=e;let s,d=this.userMap.get(a);if(d)s=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==ET.CHECK)return;const{token:y}=e;s=new Map,d={uid:a,isStart:!0,token:y,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(rS.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in e&&"total"in e){var f;const{id:y,total:T}=e,w=(f=s.get(y))!==null&&f!==void 0?f:[];if(w.push(e),s.has(y)||s.set(y,w),w.length!==T)return;{const L=_2(w).call(w,(B,Q)=>B.index-Q.index).map(B=>B.payload).join("");s.delete(y),(e=JSON.parse(L))._uid=a}}const{_type:m,token:_}=e;if(T_(n=[ET.ACK,ET.CHECK]).call(n,m))return m===ET.CHECK&&this.handleCheckToken(d,_),void this.receiveMessage(e);_==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(e):F.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(d.token,"_").concat(this.token),e)}check(){const e={_id:xS(6,""),token:this.token,_type:ET.CHECK};aa("SHOW_P2P_LOG")&&F.debug("send message",e),this.signal.request(X_.DATA_STREAM,{payload:NP(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:ET.ACK,token:this.token};aa("SHOW_P2P_LOG")&&F.debug("send message",n),this.signal.request(X_.DATA_STREAM,{payload:NP(this.encoder.encode(JSON.stringify(n)))})}response(e,n,a){this.send(ET.RESPONSE,JSON.stringify({success:!a,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:T,nextExpectedSequenceNumber:w}=y;for(;T.has(w);){const L=T.get(w);T.delete(w),this.receiveMessage(L),y.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:a,_seq:s}=e,d=this.userMap.get(a),{receivedMessagesMap:f,isStart:m,nextExpectedSequenceNumber:_}=d;if(s<_)return this.ack(e._id),void F.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(e._message));f.set(s,e),m&&s===_&&(this.receiveMessage(e),f.delete(_),d.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:a,_message:s,_uid:d}=e;if(aa("SHOW_P2P_LOG")&&F.debug("receive message",e),n){let f;switch(e._type!==ET.ACK&&(s&&(f=JSON.parse(s)),this.ack(e._id)),e._type){case ET.CANDIDATE:case ET.CONTROL:this.signal.emit(a,f,d);break;case ET.PUBLISH:case ET.UNPUBLISH:case ET.RESTART_ICE:case ET.CALL:f.uid=d,cR(this.signal,a,f).then(m=>{this.response(e._id,m)}).catch(()=>{this.response(e._id,void 0,!0)});break;case ET.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case ET.RESPONSE:{const{success:m,message:_}=f;this.emit("res-@".concat(n),m?"success":"failed",_);break}}}}splitMessage(e){if(e.length<BM.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:a}=JSON.parse(e),s=xS(6,"");let d=0,f=800;const m=Math.ceil(e.length/f);for(;e.length>0;){d++;const _={id:s,index:d,total:m,payload:e.slice(0,f),token:"".concat(this.token,"_").concat(a)};JSON.stringify(_).length>BM.MAX_MESSAGE_SIZE?f-=50:(n.push(_),e=e.slice(f))}return n.map(_=>JSON.stringify(_))}handleCheckToken(e,n){return e.token!==n?(F.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{F.debug("token timeout, ".concat(n)),this.reset(e.uid)},aa("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await cR(this.signal,ET.CALL,void 0),n=await this.send(ET.CALL,e);this.signal.emit(Q_.P2P_CONNECTION,n,!0)}async reset(e,n){const a=this.userMap.get(e);a&&(this.emit(l3.ABORT),this.signal.emit(rS.ON_USER_OFFLINE,{uid:a.uid,reason:Cpt.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(F.debug("change local token from ".concat(n," to ").concat(n)),this.token=xS(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(l3.ABORT)}}_t(BM,"MAX_SIZE",1),_t(BM,"MAX_MESSAGE_SIZE",1024);class cEt extends eT{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===VS.CONNECTED?this.emit(Q_.WS_CONNECTED):e===VS.RECONNECTING?this.emit(Q_.WS_RECONNECTING,this._websocketReconnectReason):e===VS.CLOSED&&this.emit(Q_.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),_t(this,"_disconnectedReason",void 0),_t(this,"_websocketReconnectReason",void 0),_t(this,"_connectionState",VS.CLOSED),_t(this,"reconnectToken",void 0),_t(this,"p2pToken",void 0),_t(this,"websocket",void 0),_t(this,"openConnectionTime",void 0),_t(this,"clientId",void 0),_t(this,"lastMsgTime",Date.now()),_t(this,"uploadCache",[]),_t(this,"uploadCacheInterval",void 0),_t(this,"rttRolling",new H$(5)),_t(this,"pingpongTimer",void 0),_t(this,"pingpongTimeoutCount",0),_t(this,"joinResponse",void 0),_t(this,"multiIpOption",void 0),_t(this,"initError",void 0),_t(this,"spec",void 0),_t(this,"store",void 0),_t(this,"_external_signal",void 0),_t(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Q_.ON_BINARY_DATA,a.data);const s=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const d="res-@".concat(s._id);this.emit(d,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case rS.ON_DATA_STREAM:return void this.handleDataStream(s._message);case rS.MUTE_AUDIO:case rS.MUTE_VIDEO:case rS.ON_P2P_LOST:case rS.ON_USER_ONLINE:return;case rS.ON_USER_OFFLINE:const{uid:d}=s._message;return F.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(s._type,s._message),s._type===rS.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===rS.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(vS.UID_BANNED);break;case 15:this.close(vS.IP_BANNED);break;case 16:this.close(vS.CHANNEL_BANNED)}if(s._type===rS.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case z_.ERR_LICENSE_MISSING:this.close(vS.LICENSE_MISSING);break;case z_.ERR_LICENSE_EXPIRED:this.close(vS.LICENSE_EXPIRED);break;case z_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(vS.LICENSE_MINUTES_EXCEEDED);break;case z_.ERR_LICENSE_PERIOD_INVALID:this.close(vS.LICENSE_PERIOD_INVALID);break;case z_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(vS.LICENSE_MULTIPLE_SDK_SERVICE);break;case z_.ERR_LICENSE_ILLEGAL:this.close(vS.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new e9("gateway-".concat(this.clientId),this.spec.retryConfig,!0,aa("JOIN_GATEWAY_USE_DUAL_DOMAIN"),aa("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===VS.CONNECTED&&this.reconnect("retry",sR.OFFLINE)}),this.p2pToken=xS(6,""),this._external_signal=new BM(this,this.p2pToken)}async request(e,n,a,s){const d=xS(6,""),f={_id:d,_type:e,_message:n},m=this.websocket.connectionID,_=()=>new A_((Q,X)=>{if(this.connectionState===VS.CONNECTED)return Q();const J=()=>{this.off(Q_.WS_CLOSED,_n),Q()},_n=()=>{this.off(Q_.WS_CONNECTED,J),X(new t_(_i.WS_ABORT))};this.once(Q_.WS_CONNECTED,J),this.once(Q_.WS_CLOSED,_n)});if(this.connectionState!==VS.CONNECTING&&this.connectionState!==VS.RECONNECTING||e===X_.JOIN||e===X_.REJOIN||await _(),this.websocket.sendMessage(f,!0),s)return;const y=new A_((Q,X)=>{let J=!1;const _n=(ya,_l)=>{J=!0,Q({isSuccess:ya==="success",message:_l||{}}),this.off(Q_.WS_CLOSED,_r),this.off(Q_.WS_RECONNECTING,_r),this.emit(Q_.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(d),_n);const _r=()=>{X(new t_(_i.WS_ABORT,"type: ".concat(e))),this.off(Q_.WS_CLOSED,_r),this.off(Q_.WS_RECONNECTING,_r),this.off("res-@".concat(d),_n)};this.once(Q_.WS_CLOSED,_r),this.once(Q_.WS_RECONNECTING,_r),QT(aa("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||J||(F.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Q_.REQUEST_TIMEOUT,e,n))})});let T=null;try{T=await y}catch(Q){if(this.connectionState===VS.CLOSED||e===X_.LEAVE)throw new t_(_i.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?Q.throw():e===X_.JOIN||e===X_.REJOIN?null:(await _(),await this.request(e,n))}if(T.isSuccess)return T.message;const w=Number(T.message.error_code||T.message.code),L=q2(w),B=new t_(_i.UNEXPECTED_RESPONSE,"".concat(L.desc,": ").concat(T.message.error_str),{code:w,data:T.message,desc:L.desc});return L.action==="success"?T.message:(F.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(w,", message: ").concat(L.desc,", action: ").concat(L.action)),w===z_.ERR_TOO_MANY_BROADCASTERS?((e===X_.JOIN||e===X_.REJOIN)&&(this.initError=B,this.close()),B.throw()):L.action==="failed"?B.throw():L.action==="quit"?(this.initError=B,this.close(),B.throw()):(w===z_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,F.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sR.MULTI_IP)):this.reconnect(L.action,sR.SERVER_ERROR),e===X_.JOIN||e===X_.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new A_(a=>{const s=d=>{(!n||n(d))&&(this.off(e,s),a(d))};this.on(e,s)})}uploadWRTCStats(e){if(!this.store.sessionId)return void F.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(G2.WRTC_STATS,n)}upload(e,n){const a={_type:e,_message:n};try{this.websocket.sendMessage(a)}catch{const d=aa("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==VS.CONNECTED)return;const f=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(f._type,f._message)},aa("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const a={_type:e,_message:n};this.websocket.sendMessage(a)}async sendExtensionMessage(e,n,a){return await this._external_signal.send(e,n,a)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new A_((n,a)=>{this.once(Q_.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Q_.WS_CLOSED,()=>a(this.initError||new t_(_i.WS_ABORT))),this.connectionState=VS.CONNECTING,this.websocket.init(e).catch(a)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||vS.LEAVE,this.connectionState=VS.CLOSED,F.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=xS(6,""),this._external_signal.clear(),this._external_signal=new BM(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Q_.ABORT_P2P_EXECUTION);const e=await cR(this,Q_.REQUEST_JOIN_INFO),n=await this.request(X_.JOIN,e);if(!n)return this.emit(Q_.REPORT_JOIN_GATEWAY,_i.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Q_.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=VS.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const a=EM(e.payload),s=new TextDecoder().decode(a),d=JSON.parse(s);"total"in d&&"id"in d||T_(n=Object.values(ET)).call(n,d._type)?(d._uid=e.uid,this._external_signal.onMessage(d)):this.emit(rS.ON_DATA_STREAM,e)}catch{this.emit(rS.ON_DATA_STREAM,e)}}handleNotification(e){F.debug("[".concat(this.clientId,"] receive notification: "),e);const n=q2(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(vS.UID_BANNED),void this.close()):void this.reconnect(n.action,sR.SERVER_ERROR);F.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=aa("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(F.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>aa("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sR.TIMEOUT):this.request(X_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-n;this.rttRolling.add(a),aa("REPORT_STATS")&&this.send(X_.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(kv.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Q_.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(kv.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(kv.CLOSED,()=>{this.connectionState=VS.CLOSED}),this.websocket.on(kv.FAILED,()=>{this._disconnectedReason=vS.NETWORK_ERROR,this.connectionState=VS.CLOSED}),this.websocket.on(kv.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===VS.CONNECTED?this.connectionState=VS.RECONNECTING:this.connectionState=VS.CONNECTING}),this.websocket.on(kv.WILL_RECONNECT,(e,n,a)=>{e!=="retry"?(F.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):F.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(e)}),this.websocket.on(kv.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(Q_.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof t_&&e.code===_i.UNEXPECTED_RESPONSE&&e.data.code===z_.ERR_NO_AUTHORIZED)return F.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",sR.SERVER_ERROR);F.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sR.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(kv.REQUEST_NEW_URLS,(e,n)=>{cR(this,Q_.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(kv.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(rS.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const uEt={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new sEt(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new cEt(n,e)}};function Eat(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function gat(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Eat(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Eat(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}class lEt{constructor(e){_t(this,"sessionDesc",void 0),_t(this,"localCapabilities",void 0),_t(this,"rtpCapabilities",void 0),_t(this,"candidates",void 0),_t(this,"_originCandidates",void 0),_t(this,"iceParameters",void 0),_t(this,"dtlsParameters",void 0),_t(this,"setup",void 0),_t(this,"currentMidIndex",void 0),_t(this,"cname",void 0),e=aT(e);const{iceParameters:n,dtlsParameters:a,candidates:s,rtpCapabilities:d,setup:f,localCapabilities:m,sdkCodec:_,cname:y}=e,T=p0(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=s,this._originCandidates=aT(s),this.iceParameters=n,this.dtlsParameters=a,this.setup=f,this.localCapabilities=m,this.cname=y;for(let w=0;w<T.mediaDescriptions.length;w++){const L=T.mediaDescriptions[w];if(L.attributes.iceUfrag=n.iceUfrag,L.attributes.icePwd=n.icePwd,L.attributes.fingerprints=a.fingerprints,L.attributes.candidates=s,L.attributes.setup=f,L.media.mediaType==="video"){L.media.fmts=d.videoCodecs.map(Q=>Q.payloadType.toString(10));let B=d.videoCodecs.filter(Q=>{var X,J;return(X=Q.rtpMap)===null||X===void 0?void 0:T_(J=X.encodingName.toLowerCase()).call(J,_)});B.length===0&&(B=d.videoCodecs),L.attributes.payloads=B,L.attributes.extmaps=d.videoExtensions}L.media.mediaType==="audio"&&(L.media.fmts=d.audioCodecs.map(B=>B.payloadType.toString(10)),L.attributes.payloads=d.audioCodecs,L.attributes.extmaps=d.audioExtensions),T.mediaDescriptions[w]=this.mungMediaDesc(L)}this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return DP(this.sessionDesc)}send(e,n,a){const{ssrcs:s,ssrcGroups:d}=CM(n,this.cname),f=this.sessionDesc.mediaDescriptions.find(y=>e===k_.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=s[0].attributes.label,_=s[0].attributes.mslabel;return f.attributes.ssrcs=f.attributes.ssrcs.concat(s),f.attributes.ssrcGroups=f.attributes.ssrcGroups.concat(d),{id:m,mslabel:_}}batchSend(e){return e.map(n=>{let{kind:a,ssrcMsg:s}=n;return this.send(a,s,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const a=[],s=[],d=[];n.attributes.ssrcs.forEach(f=>{T_(e).call(e,f.attributes.label||"")?d.push(f):a.push(f)}),n.attributes.ssrcGroups.forEach(f=>{var m;T_(m=d.map(_=>_.ssrcId)).call(m,f.ssrcIds[0])||s.push(f)}),n.attributes.ssrcs=a,n.attributes.ssrcGroups=s})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,a){e.forEach((s,d)=>{const f=s._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===f.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],s);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(s=>s.transport==="udp"),a=[];if(n.forEach(s=>{a.push(gat(gat({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),n.length!==0){switch(e){case gR.TCP_RELAY:this.candidates=a;break;case gR.UDP_TCP_RELAY:case gR.RELAY:this.candidates=[...n,...a];break;default:this.candidates=n}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(e){e=aT(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let a=0;a<e;a++)n.push((this.currentMidIndex+a+1).toString(10));return n}mungRecvMediaDsec(e,n){const a=aT(e);return p3(a,n),o9(a,n),a}updateRecvMedia(e,n){const a=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===e);if(a!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],n);this.sessionDesc.mediaDescriptions[a]=s}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,a){const s=this.sessionDesc.mediaDescriptions.find(f=>e===k_.VIDEO?f.attributes.mid==="video":f.attributes.mid==="audio");if(s){const f=s.attributes.ssrcs.find(m=>m.attributes.label===n);var d;f&&(f.attributes.label=a,(d=f.attributes.msid)===null||d===void 0||d.replace(n,a))}}mungMediaDesc(e){const n=aT(e);return i9(n),function(a){const s=a.attributes.extmaps.find(d=>C8(d.extensionName));s&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(s),1),a.attributes.payloads.forEach(d=>{const f=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");f!==-1&&d.rtcpFeedbacks.splice(f,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const a of n.attributes.ssrcs)if(a.attributes.label===e)return[a]}}var DS;function _at(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,a)}return n}function lK(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_at(Object(n),!0).forEach(function(a){_t(t,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_at(Object(n)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(n,a))})}return t}let dEt=(DS=class S6 extends Ont{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return T_(n=Object.keys(e8)).call(n,e)}))]}constructor(e,n){super(e,n),_t(this,"store",void 0),_t(this,"peerConnection",void 0),_t(this,"remoteSDP",void 0),_t(this,"initialOffer",void 0),_t(this,"statsFilter",void 0),_t(this,"useRTX",!1),_t(this,"localCapabilities",void 0),_t(this,"localCandidateCount",0),_t(this,"allCandidatesReceived",!1),_t(this,"establishPromise",void 0),_t(this,"mutex",void 0),this.store=n,this.mutex=new mR("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(S6.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=_7(this.peerConnection,aa("STATS_UPDATE_INTERVAL"),void 0,rT()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=xP(e.sdp),a=W2(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:aa("FILTER_VIDEO_FEC"),filterAudioFec:aa("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=e,lK(lK({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:e.sdp})}catch(e){throw new t_(_i.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new lEt(lK(lK({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new t_(_i.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var a=this;return oO(function*(){const s=yield uS(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=e.map(L=>a.peerConnection.addTrack(L._mediaStreamTrack)),f=yield uS(a.peerConnection.createOffer()),m=p0(f.sdp),_=e.map(L=>{const B=L._mediaStreamTrack,Q=m.mediaDescriptions.find(X=>X.attributes.mid===B.kind);if(!Q)throw new Error("Cannot extract ssrc from mediaDescription.");return function(X,J,_n){const _r=X.attributes.ssrcs.filter(_l=>_l.attributes.label===J),ya=X.attributes.ssrcGroups;if(_r.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ya&&_r.length>1){const _l=ya.find(_d=>_d.ssrcIds.indexOf(_r[0].ssrcId)!==-1);return _l?[{ssrcId:_l.ssrcIds[0],rtx:_n?_l.ssrcIds[1]:void 0}]:[{ssrcId:_r[0].ssrcId}]}return[{ssrcId:_r[0].ssrcId}]}(Q,B.id,a.useRTX)});let y;try{y=yield _}catch(L){throw d.forEach(B=>{aR()&&B.replaceTrack(null),a.peerConnection.removeTrack(B)}),L}const T=a.mungSendOfferSDP(f.sdp,e);a.remoteSDP.receive(e,n,y);const w=a.remoteSDP.toString();return yield uS(a.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield uS(a.applySendEncodings(d,e)),yield uS(a.peerConnection.setRemoteDescription({type:"answer",sdp:w})),e.map((L,B)=>{const Q=L._mediaStreamTrack.id;return{localSSRC:_[B],id:Q}})}catch(d){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{s()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(d=>{var f;return e.indexOf(((f=d.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(d=>{aR()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(e);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,a,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:d,mslabel:f}=this.remoteSDP.send(e,n,s),m=new A_((T,w)=>{const L=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(d)))},1e4),B=Q=>{const X=lS();if((X.name==="Safari"&&Number(X.version)===11||MR())&&Q.track.id!==d&&Q.streams[0].id===f){var J;const _n=Q.streams[0].getTracks()[0];return(J=this.remoteSDP)===null||J===void 0||J.updateTrackLabel(e,d,Q.track.id),this.peerConnection.removeEventListener("track",B),clearTimeout(L),void T(_n)}if(Q.track.id===d)return this.peerConnection.removeEventListener("track",B),clearTimeout(L),void T(Q.track)};this.peerConnection.addEventListener("track",B)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:d}}catch(d){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var s;return e.indexOf(((s=a.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(a=>{if(aR()&&a.track)a.track.enabled=!1;else{const s=a.getParameters();s.encodings.forEach(d=>d.active=!1),a.setParameters(s)}})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(d=>{var f;return e.indexOf(((f=d.track)===null||f===void 0?void 0:f.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async d=>{if(aR()&&d.track)d.track.enabled=!0;else{const f=d.getParameters();f.encodings.forEach(m=>m.active=!0),await d.setParameters(f)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return oO(function*(){const a=yield uS(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=pS().supportPCSetConfiguration;if(e===gR.RELAY&&!s)return;if(s){const y=n.peerConnection.getConfiguration(),T=e===gR.RELAY?"relay":"all";y.iceTransportPolicy!==T&&(F.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(T,"]")),y.iceTransportPolicy=T,n.peerConnection.setConfiguration(y))}e!==gR.RELAY&&n.remoteSDP.updateCandidates(e);const d=yield uS(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=xP(d.sdp),{remoteIceParameters:m}=yield f.iceParameters;n.remoteSDP.restartICE(m);const _=n.remoteSDP.toString();yield uS(n.peerConnection.setLocalDescription(d)),yield uS(n.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(s){F.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{a()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(a.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new t_(_i.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(e,n){const a=this.peerConnection.getSenders().filter(s=>{var d;return((d=s.track)===null||d===void 0?void 0:d.id)===e});a.length===1&&await this.applySendEncodings(a,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const a=this.peerConnection.getSenders().find(s=>{var d;return((d=s.track)===null||d===void 0?void 0:d.id)===n});a&&await a.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new t_(_i.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new t_(_i.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},aa("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(P2(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...S6.turnServerConfigToIceServers(e.turnServer.servers)),aa("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...S6.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(a=>{a.security?a.tcpport&&n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&n.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var a;if(n||(n=this.peerConnection.getSenders().find(y=>{var T;return((T=y.track)===null||T===void 0?void 0:T.id)===e._mediaStreamTrack.id})),!n)return F.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!pS().supportSetRtpSenderParameters)return F.warn("Browser not support set rtp-sender parameters");const s={},d={};if(e instanceof zS)switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(aa("DSCP_TYPE")&&hL()){var f;const y=aa("DSCP_TYPE");T_(f=["very-low","low","medium","high"]).call(f,y)&&(d.networkPriority=y)}const m=n.getParameters(),_=(a=m.encodings)===null||a===void 0?void 0:a[0];_&&Object.assign(_,d),Object.assign(m,s),F.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await n.setParameters(m)}async applySendEncodings(e,n){try{if(!pS().supportSetRtpSenderParameters||e.length!==n.length)return;for(let a=0;a<e.length;a++){const s=e[a],d=n[a];s&&d&&await this.updateRtpSenderEncodings(d,s)}}catch{F.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const a=p0(e);return n.forEach((s,d)=>{const f=s._mediaStreamTrack,m=a.mediaDescriptions.find(_=>_.attributes.mid===f.kind);m&&p3(m,s)}),DP(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,a)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,e,n,a)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((d,f)=>{let{id:m,mslabel:_}=d;const{kind:y}=e[f];return new A_((T,w)=>{const L=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(m)))},1e4),B=Q=>{const X=lS();if(X.name==="Safari"&&Number(X.version)===11&&Q.track.id!==m&&Q.streams[0].id===_){var J;const _n=Q.streams[0].getTracks()[0];return(J=this.remoteSDP)===null||J===void 0||J.updateTrackLabel(y,m,Q.track.id),this.peerConnection.removeEventListener("track",B),clearTimeout(L),void T({track:_n,id:m})}if(Q.track.id===m)return this.peerConnection.removeEventListener("track",B),clearTimeout(L),void T({track:Q.track,id:m})};this.peerConnection.addEventListener("track",B)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await A_.all(n)}catch(n){throw new t_(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(pS().supportPCSetConfiguration){const n=S6.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},U_(DS.prototype,"connect",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"connect"),DS.prototype),U_(DS.prototype,"stopSending",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"stopSending"),DS.prototype),U_(DS.prototype,"receive",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"receive"),DS.prototype),U_(DS.prototype,"stopReceiving",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"stopReceiving"),DS.prototype),U_(DS.prototype,"muteRemote",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"muteRemote"),DS.prototype),U_(DS.prototype,"unmuteRemote",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"unmuteRemote"),DS.prototype),U_(DS.prototype,"muteLocal",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"muteLocal"),DS.prototype),U_(DS.prototype,"unmuteLocal",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"unmuteLocal"),DS.prototype),U_(DS.prototype,"close",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"close"),DS.prototype),U_(DS.prototype,"updateEncoderConfig",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"updateEncoderConfig"),DS.prototype),U_(DS.prototype,"updateSendParameters",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"updateSendParameters"),DS.prototype),U_(DS.prototype,"replaceTrack",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"replaceTrack"),DS.prototype),U_(DS.prototype,"getRemoteSSRC",[pO],Object.getOwnPropertyDescriptor(DS.prototype,"getRemoteSSRC"),DS.prototype),DS);function pO(t,e,n){const a=t[e];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,d=await s.lock("Locking from P2PConnection.".concat(e));try{for(var f=arguments.length,m=new Array(f),_=0;_<f;_++)m[_]=arguments[_];return await a.apply(this,m)}finally{d()}},n}const hEt={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new dEt(n,e)}},pEt={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!pS().supportWebRTCEncodedTransform)return void F.warning("browser not support audio encoded transform");if(l8.has(t)||!t.track)return;const n={track:t.track};if(dL()){if(!t.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");let s=null;try{s=t.createEncodedStreams()}catch(f){return void F.error("create audio-encoded-streams error",f&&f.message)}const d=new TransformStream({transform(f,m){n.controller||(n.controller=m),t.track&&t.track.id!==n.track.id&&(F.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a));const _=e.metadata&&e.metadata();_?function(y,T){const{chunk:w,controller:L}=T,B=aa("ENABLE_AUDIO_PTS_METADATA")?EL.AUDIO_64_BIT_PTS:EL.METADATA;w.data=function(Q,X,J){const _n=J.byteLength,_r=_n+G7+dnt,ya=B7+F7+_r,_l=new ArrayBuffer(Q.byteLength+ya),_d=new DataView(_l);_d.setUint8(0,lnt),_d.setUint16(1,_r),_d.setUint8(3,X),_d.setUint16(4,_n);for(let _g=0;_g<_n;_g++)_d.setUint8(6+_g,J[_g]);const tu=new Uint8Array(_d.buffer);return tu.set(new Uint8Array(Q),ya),tu.buffer}(w.data,B,y),L.enqueue(w)}(_,{chunk:f,controller:m}):m.enqueue(f)}});s.readable.pipeThrough(d).pipeTo(s.writable)}else if(aR()){if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=u8(),d=new MessageChannel;await new A_(m=>s.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(s,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=f,await new A_(m=>s.onmessage=_=>{_.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var _;if(m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==n.track.id)F.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a);else if(m.data.getMetadata){const y=e.metadata&&e.metadata();y&&d.port1.postMessage({metadata:y})}},n.worker=s}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const s=l8.get(t);if(s){l8.delete(t);try{var d,f;(d=s.controller)===null||d===void 0||d.terminate(),(f=s.worker)===null||f===void 0||f.terminate()}catch(m){F.warning(m&&m.message)}}}l8.set(t,n),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!pS().supportWebRTCEncodedTransform)return void F.warning("browser not support audio encoded transform");if(E8.has(t))return;const n={track:t.track,onMetadata:e.onMetadata};if(dL()){if(!t.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");t7(mS.CHROME,87,116)||(e.enableTopn=!1);let s=null;try{s=t.createEncodedStreams()}catch(f){return void F.error("create audio-encoded-streams error",f&&f.message)}const d=new TransformStream({transform(f,m){n.controller||(n.controller=m),t.track&&t.track.id!==n.track.id&&(F.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a)),e.enableTopn?function(_,y,T){var w;const L=hnt(new DataView(y.data));if(!L)return T.enqueue(y);const B=_.track.id;Wht.set(B,_.track);const Q=(w=L.tlv.find(_l=>_l.tag===EL.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let X=0;typeof Q=="number"&&(X=127-Q);const J=Math.round(Math.pow(10,X/60)-1),{selected:_n,speaker:_r}=function(_l,_d){let tu=a3.get(_l);if(tu||(tu=function(_g){const l_=new fnt;return a3.set(_g,l_),CI||(CI=new zht(aa("TOPN_SILENCE_THRESHOLD")||500),CI.on("ActiveSpeakerChanged",O_=>{O_!=null&&(p8=O_)})),CI.addSpeakers([l_]),l_}(_l)),a3.size<=mnt)return{selected:!0,speaker:tu};if(!CI)throw new Error("no active speaker detector");return CI.levelChanged(tu.id,_d),TM=CI.loudest.map(_g=>_g.id),p8&&!T_(TM).call(TM,p8)&&TM.length>=mnt&&TM.pop(),{selected:T_(TM).call(TM,tu.id)||tu.id===p8,speaker:tu}}(_,J),ya=function(_l,_d,tu){const _g=OI.get(_l)||new Kht(_l,_d);return _g.score=tu,OI.set(_l,_g),function(l_){if(f8.set(l_,!0),!m8)return void(m8=Date.now());const O_=Date.now();O_-m8>1e3&&(f8.get(l_)?f8.set(l_,!1):(Ent(l_),f8.delete(l_)),m8=O_)}(_l),_g}(B,_.track,_r.energyScore);ya.addSample(_n),ya.active&&(y.data=L.frame.buffer,T.enqueue(y))}(t,f,m):e.enableMetadata?function(_,y,T){const w=hnt(new DataView(_.data));if(!w)return y.enqueue(_);const L=w.tlv.find(B=>B.tag===EL.METADATA||B.tag===EL.AUDIO_64_BIT_PTS);L&&T&&L.value instanceof Uint8Array&&T(L.value),_.data=w.frame.buffer,y.enqueue(_)}(f,m,e.onMetadata):m.enqueue(f)}});s.readable.pipeThrough(d).pipeTo(s.writable)}else if(aR()){if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=u8(),d=new MessageChannel;await new A_(m=>s.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(s,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=f,await new A_(m=>s.onmessage=_=>{_.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==n.track.id?(F.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a)):m.data.metadata&&n.onMetadata&&n.onMetadata(m.data.metadata)},n.worker=s}function a(){t.track.removeEventListener("ended",a),function(s){const d=E8.get(s);if(d){(function(_){const y=a3.get(_);y&&(a3.delete(_),CI&&(CI.removeSpeakers([y]),a3.size===0&&(CI.destroy(),CI=null)))})(s),Ent(s.track.id),E8.delete(s);try{var f,m;(f=d.controller)===null||f===void 0||f.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(_){F.warning(_&&_.message)}}}(t)}E8.set(t,n),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,e){if(!pS().supportWebRTCEncodedTransform)return void F.warning("browser not support video encoded transform");if(g8.has(t)||!t.track)return;const n={track:t.track};if(dL()){if(!t.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");let s=null;try{s=t.createEncodedStreams()}catch(m){return void F.error("create video-encoded-streams error",m&&m.message)}const d=[];e.on("sei-to-send",m=>{d.push(m)});const f=new TransformStream({transform(m,_){n.controller||(n.controller=_),t.track&&t.track.id!==n.track.id&&(F.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a));const y=d.shift();y&&(m.data=function(T,w){const L=function(_r){const ya=_r.length;let _l=[],_d=0;for(;_d<ya;)_d+2<ya&&_r[_d]===0&&_r[_d+1]===0&&(_r[_d+2]===0||_r[_d+2]===1||_r[_d+2]===2||_r[_d+2]===3)?(_l.push(_r[_d],_r[_d+1],3,_r[_d+2]),_d+=3):(_l.push(_r[_d]),_d++);return new Uint8Array(_l)}(w),B=L.length,Q=Math.floor(B/255),X=B%255,J=new Uint8Array(6+Q+1+B+T.byteLength);J[0]=0,J[1]=0,J[2]=0,J[3]=1,J[4]=6,J[5]=101;let _n=0;for(;_n<Q;)J[6+_n]=255,_n++;return J[6+_n]=X,_n++,J.set(L,6+_n),J.set(new Uint8Array(T),6+_n+B),J.buffer}(m.data,y)),_.enqueue(m)}});s.readable.pipeThrough(f).pipeTo(s.writable)}else{if(!aR())return;{if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=u8(),d=new MessageChannel;await new A_(m=>s.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(s,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=f,await new A_(m=>s.onmessage=_=>{_.data==="started"&&m(void 0)}),e.on("sei-to-send",m=>{d.port1.postMessage({sei:m})}),d.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==n.track.id&&(F.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a))},n.worker=s}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const s=g8.get(t);if(s){g8.delete(t);try{var d,f;(d=s.controller)===null||d===void 0||d.terminate(),(f=s.worker)===null||f===void 0||f.terminate()}catch(m){F.warning(m&&m.message)}}}g8.set(t,n),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!pS().supportWebRTCEncodedTransform)return void F.warning("browser not support video encoded transform");if(!t.track)return;if(F2.has(t)){const s=F2.get(t);return void(s&&(s.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(dL()){if(!t.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");let s=null;try{s=t.createEncodedStreams()}catch(f){return void F.error("create video-encoded-streams error",f&&f.message)}const d=new TransformStream({transform(f,m){n.controller||(n.controller=m),t.track&&t.track.id!==n.track.id&&(F.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a));const _=function(y){const T=new DataView(y.data);let w=0;for(;w+4<y.data.byteLength;){if(T.getUint8(w+0)===0&&T.getUint8(w+1)===0&&T.getUint8(w+2)===0&&T.getUint8(w+3)===1&&T.getUint8(w+4)===6){let L=w+6,B=0,Q=0;for(;(Q=T.getUint8(L++))===255;)B+=255;B+=Q;const X=Yht(y.data,L,B);return new Uint8Array(X)}w++}return null}(f);_&&n.onSei&&n.onSei(_),m.enqueue(f)}});s.readable.pipeThrough(d).pipeTo(s.writable)}else if(aR()){if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=u8(),d=new MessageChannel;await new A_(m=>s.onmessage=_=>{_.data==="registered"&&m(void 0)});const f=new RTCRtpScriptTransform(s,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=f,await new A_(m=>s.onmessage=_=>{_.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==n.track.id?(F.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",a),n.track=t.track,n.track.addEventListener("ended",a)):m.data.sei&&n.onSei&&n.onSei(m.data.sei)},n.worker=s}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(s){const d=F2.get(s);if(d){F2.delete(s);try{var f,m;(f=d.controller)===null||f===void 0||f.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(_){F.warning(_&&_.message)}}})(t)}F2.set(t,n),t.track.addEventListener("ended",a)}},fEt={name:"InterceptFrame",create:()=>pEt};v7(),RS("PROCESS_ID","process-".concat(xS(8,""),"-").concat(xS(4,""),"-").concat(xS(4,""),"-").concat(xS(4,""),"-").concat(xS(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void F.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();F.debug("Loading global parameters from cache",e),Object.keys(e).forEach(a=>{if(Object.prototype.hasOwnProperty.call(qS,a)){const{value:s,expires:d}=e[a];if(d&&d<=n)return;AI[a]=s,qS[a]=s}})}catch(e){F.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(AI.AREAS)&&AI.AREAS.length>0&&l9(AI.AREAS,!0);const vat=(t,e,n)=>{F.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),RS(t,e,n)};UP(Umt,!1),UP(Bmt,!1),UP(vft,!1),UP(Zmt,!1),UP(Pmt,!1),UP(uEt,!1),UP(hEt,!1),UP(fEt,!1);const IT=function(t){const e=new eT,n=t,a={getListeners:e.getListeners.bind(e),on:(s,d)=>(function(f,m){f===RN.SECURITY_POLICY_VIOLATION&&$it(m,!0)}(s,d),e.on.bind(e)(s,d)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return Qit(Qit({},n),a)}({__TRACK_LIST__:ZV,VERSION:aO,BUILD:S7,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:vat,getParameter:aa,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(a){let s;return pS().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),s=(await a.createOffer()).sdp):s=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s}(e);if(!n)return t;e.close(),e=null,t=function(a){const s={video:[],audio:[]};return a.match(/ VP8/i)&&s.video.push("VP8"),a.match(/ VP9/i)&&s.video.push("VP9"),a.match(/ AV1/i)&&s.video.push("AV1"),a.match(/ H264/i)&&s.video.push("H264"),a.match(/ H265/i)&&s.video.push("H265"),a.match(/ opus/i)&&s.audio.push("OPUS"),a.match(/ PCMU/i)&&s.audio.push("PCMU"),a.match(/ PCMA/i)&&s.audio.push("PCMA"),a.match(/ G722/i)&&s.audio.push("G722"),s}(n)}catch(e){throw new _E(_i.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=V_.reportApiInvoke(null,{name:OT.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:oT.TRACER});let e=!1;try{const d=window.RTCPeerConnection,f=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;e=!!(d&&f&&m),e&&i7()&&_$(75)&&new d().close()}catch(d){return F.error("check system requirement failed: ",d),!1}let n=!1;const a=lS();a.name===mS.CHROME&&Number(a.version)>=58&&(TI.engine.name!=="WebKit"||function(){const d=lS();if(WH()){if(d.os===jT.MAC_OS)return!0;if(d.os===jT.IOS){const f=TI.os.version&&TI.os.version.split(".");if(f&&Number(f[0])===14&&f[1]&&Number(f[1])>=3||f&&Number(f[0])>14)return!0}}return!1}())&&(n=!0),(a.name===mS.FIREFOX&&Number(a.version)>=56||a.name===mS.OPERA&&Number(a.version)>=45||a.name===mS.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(MR()||MO())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||R$()||lS().name===mS.QQ)&&(n=!0),F.debug("checkSystemRequirements, api:",e,"browser",n);const s=e&&n;return t.onSuccess(s),s},getDevices:function(t){return q0.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return q0.getRecordingDevices(t)},getCameras:function(t){return q0.getCamerasDevices(t)},getElectronScreenSources:_tt,getPlaybackDevices:function(t){return q0.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=xS(5,"client-"),a=V_.reportApiInvoke(null,{id:n,name:OT.CREATE_CLIENT,options:[e],tag:oT.TRACER});try{(function(s){MT(s.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),MT(s.mode,"config.mode",["rtc","live","p2p"]),s.audioCodec!==void 0&&MT(s.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),s.proxyServer!==void 0&&ZT(s.proxyServer,"config.proxyServer",1,1e4),s.turnServer!==void 0&&k$(s.turnServer),s.httpRetryConfig!==void 0&&D$(s.httpRetryConfig),s.websocketRetryConfig!==void 0&&D$(s.websocketRetryConfig)})(e)}catch(s){throw a.onError(s),s}return(y$(16,0)||b$(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",F.debug("browser not support vp9, force use vp8")),RS("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),a.onSuccess(),new yft(HO(HO({forceWaitGatewayResponse:!0},e),{},{role:T_(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=aa("CAMERA_CAPTURE_CONFIG"),n=xS(8,"track-cam-"),a=V_.reportApiInvoke(null,{id:n,tag:oT.TRACER,name:OT.CREATE_CAM_VIDEO_TRACK,options:[ZS({},t),e]});e&&(t.encoderConfig=e);const s=s8(t);let d=null;F.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{d=(await H0({video:s},n)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!d){const m=new t_(_i.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(F)}t.optimizationMode&&V7(n,d,t,bN(t.encoderConfig));const f=new j7(d,t,s,t.scalabiltyMode?r8(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return a.onSuccess(f.getTrackId()),F.info("create camera video success, trackId:",n),f},createCustomVideoTrack:function(t){const e=xS(8,"track-cus-"),n=V_.reportApiInvoke(null,{id:e,tag:oT.TRACER,name:OT.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),a=new zS(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?r8(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[US.CUSTOM_TRACK]);return n.onSuccess(a.getTrackId()),F.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(L){return wtt(L)}(e):void 0;n&&(e="auto");const a=xS(8,"track-scr-v-"),s=V_.reportApiInvoke(null,{id:a,tag:oT.TRACER,name:OT.CREATE_SCREEN_VIDEO_TRACK,options:[ZS({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(L){const B={};L.screenSourceType&&(B.mediaSource=L.screenSourceType),L.extensionId&&dL()&&(B.extensionId=L.extensionId);const{displaySurface:Q,selfBrowserSurface:X,surfaceSwitching:J,systemAudio:_n,preferCurrentTab:_r}=L;(N2(107)||e7(107)||n7(93))&&(Q&&(MT(Q,"displaySurface",["browser","window","monitor"]),B.displaySurface=Q),X?(MT(X,"selfBrowserSurface",["exclude","include"]),B.selfBrowserSurface=X):B.selfBrowserSurface="include",J&&(MT(J,"surfaceSwitching",["exclude","include"]),B.surfaceSwitching=J)),(N2(105)||e7(105)||n7(91))&&_n&&(MT(_n,"systemAudio",["exclude","include"]),B.systemAudio=_n),(N2(94)||e7(94)||n7(80))&&_r&&(B.preferCurrentTab=!0),L.electronScreenSourceId&&(B.sourceId=L.electronScreenSourceId);const ya=L.encoderConfig?O7(L.encoderConfig):null;return B.mandatory={chromeMediaSource:"desktop",maxWidth:ya?ya.width:void 0,maxHeight:ya?ya.height:void 0},ya&&(ya.frameRate&&(typeof ya.frameRate=="number"?(B.mandatory.maxFrameRate=ya.frameRate,B.mandatory.minFrameRate=ya.frameRate):(B.mandatory.maxFrameRate=ya.frameRate.max||ya.frameRate.ideal||ya.frameRate.exact||void 0,B.mandatory.minFrameRate=ya.frameRate.min||ya.frameRate.ideal||ya.frameRate.exact||void 0),B.frameRate=ya.frameRate),ya.width&&(B.width=ya.width),ya.height&&(B.height=ya.height)),B}(t);let f=null,m=null;const _=pS();if(!_.supportShareAudio&&e==="enable"){const L=new t_(_i.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(L),L.throw(F)}F.info("start create screen video track with config",t,"withAudio",e,"trackId",a);const y=_.supportShareAudio&&e!=="disable";try{const L=await H0({screen:d,screenAudio:y?n||!0:void 0},a);f=L.getVideoTracks()[0]||null,m=L.getAudioTracks()[0]||null}catch(L){throw s.onError(L),L}if(!f){const L=new t_(_i.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(L),L.throw(F)}if(!m&&e==="enable"){f&&f.stop();const L=new t_(_i.SHARE_AUDIO_NOT_ALLOWED);return s.onError(L),L.throw(F)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(V7(a,f,t,t.encoderConfig&&O7(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const T=new zS(f,t.encoderConfig?O7(t.encoderConfig):{},t.scalabiltyMode?r8(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[US.SCREEN_TRACK]);if(!m)return s.onSuccess(T.getTrackId()),F.info("create screen video track success","video:",T.getTrackId()),T;const w=new uT(m,void 0,xS(8,"track-scr-a-"),!1);return s.onSuccess([T.getTrackId(),w.getTrackId()]),F.info("create screen video track success","video:",T.getTrackId(),"audio:",w.getTrackId()),[T,w]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=aa("CAMERA_CAPTURE_CONFIG"),a=xS(8,"track-mic-"),s=xS(8,"track-cam-"),d=V_.reportApiInvoke(null,{id:"".concat(a,"-").concat(s),tag:oT.TRACER,name:OT.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const f=s8(e),m=Itt(t);let _=null,y=null;F.info("start create camera video track(".concat(s,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const L=await H0({audio:m,video:f},"".concat(a,"-").concat(s));_=L.getAudioTracks()[0],y=L.getVideoTracks()[0]}catch(L){throw d.onError(L),L}if(!_||!y){const L=new t_(_i.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(L),L.throw(F)}e.optimizationMode&&V7(s,y,e,bN(e.encoderConfig));const T=new c8(_,t,m,a),w=new j7(y,e,f,e.scalabiltyMode?r8(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return d.onSuccess([T.getTrackId(),w.getTrackId()]),F.info("create camera video track(".concat(s,") and microphone audio track(").concat(a,") success")),[T,w]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=xS(8,"track-mic-"),n=V_.reportApiInvoke(null,{id:e,tag:oT.TRACER,name:OT.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=Itt(t);let s=null;F.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{s=(await H0({audio:a},e)).getAudioTracks()[0]||null}catch(f){throw n.onError(f),f}if(!s){const f=new t_(_i.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(f),f.throw(F)}const d=new c8(s,t,a,e);return n.onSuccess(d.getTrackId()),F.info("create microphone audio track success, trackId:",e),d},createCustomAudioTrack:function(t){const e=xS(8,"track-cus-"),n=V_.reportApiInvoke(null,{id:e,tag:oT.TRACER,name:OT.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new uT(t.mediaStreamTrack,t.encoderConfig?i8(t.encoderConfig):{},e,!1);return F.info("create custom audio track success with config",t,"trackId",a.getTrackId()),n.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:a}=t;let{source:s}=t;const d={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":s,cacheOnlineFile:n,encoderConfig:a},f=xS(8,"track-buf-"),m=V_.reportApiInvoke(null,{id:f,tag:oT.TRACER,name:OT.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(aa("DISABLE_WEBAUDIO"))throw new t_(_i.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");F.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",f);const _=s;if(!(s instanceof AudioBuffer))try{s=await async function(w,L){let B=null;if(typeof w=="string"){const X=Eet.get(w);if(X)return F.debug("use cached audio resource: ",w),X;try{B=(await RI(()=>WR.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(J){throw new t_(_i.FETCH_AUDIO_FILE_FAILED,J.toString())}}else B=await new A_((J,_n)=>{const _r=new FileReader;_r.onload=ya=>{ya.target?J(ya.target.result):_n(new t_(_i.READ_LOCAL_AUDIO_FILE_ERROR))},_r.onerror=()=>{_n(new t_(_i.READ_LOCAL_AUDIO_FILE_ERROR))},_r.readAsArrayBuffer(w)});const Q=await function(X){const J=n3();return new A_((_n,_r)=>{J.decodeAudioData(X,ya=>{_n(ya)},ya=>{_r(new t_(_i.DECODE_AUDIO_FILE_FAILED,ya.toString()))})})}(B);return typeof w=="string"&&L&&Eet.set(w,Q),Q}(s,n)}catch(w){return m.onError(w),w.throw(F)}const y=new Bht(s),T=new Vht(_,y,a?i8(a):{},f);return F.info("create buffer source audio track success, trackId:",f),m.onSuccess(T.getTrackId()),T},setAppType:function(t){if(F.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw F.debug("Invalid appType"),new _E(_i.INVALID_PARAMS,"invalid app type",t);RS("APP_TYPE",Math.floor(t))},setLogLevel:function(t){F.setLogLevel(t)},enableLogUpload:function(){aa("USE_NEW_LOG")?RS("UPLOAD_LOG",!0):F.enableLogUpload()},disableLogUpload:function(){aa("USE_NEW_LOG")?RS("UPLOAD_LOG",!1):F.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new grt},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=V_.reportApiInvoke(null,{tag:oT.TRACER,name:OT.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof uT||t instanceof o3)){const _=new _E(_i.INVALID_TRACK,"the parameter is not a audio track");return n.onError(_),_.throw()}e&&e<1e3&&(e=1e3);const a=t instanceof uT?t.getTrackLabel():"remote_track",s=t.getVolumeLevel();let d=s,f=s;const m=Date.now();return new A_(_=>{const y=setInterval(()=>{const T=t.getVolumeLevel();d=T>d?T:d,f=T<f?T:f;const w=d-f>1e-4,L=Date.now()-m;if(w||L>e){clearInterval(y);const B=w,Q={duration:L,deviceLabel:a,maxVolumeLevel:d,result:B};F.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(Q))),n.onSuccess(Q),_(B)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=V_.reportApiInvoke(null,{tag:oT.TRACER,name:OT.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof zS||t instanceof i3)){const w=new _E(_i.INVALID_TRACK,"the parameter is not a video track");return n.onError(w),w.throw()}e&&e<1e3&&(e=1e3);const a=t instanceof zS?t.getTrackLabel():"remote_track",s=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(aR()||WH())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([s]),d.play();const f=document.createElement("canvas");f.width=160,f.height=120;let m=0,_=0;try{const w=Date.now();m=await function(L,B,Q,X){let J,_n=0,_r=null;return new A_((ya,_l)=>{function _d(){_n>X&&J&&(J(),ya(_n));const tu=Q.getContext("2d");if(!tu){const O_=new _E(_i.UNEXPECTED_ERROR,"can not get canvas 2d context.");return F.error(O_.toString()),void _l(O_)}tu.drawImage(L,0,0,160,120);const _g=tu.getImageData(0,0,Q.width,Q.height),l_=Math.floor(_g.data.length/3);if(_r){for(let O_=0;O_<l_;O_+=3)if(_g.data[O_]!==_r[O_])return _n+=1,void(_r=_g.data);_r=_g.data}else _r=_g.data}setTimeout(()=>{J&&(J(),ya(_n))},B),J=k7(()=>{_d()},30)})}(d,e,f,4),_=Date.now()-w}catch(w){throw n.onError(w),w}oft===mS.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const y=m>4,T={duration:_,changedPicNum:m,deviceLabel:a,result:y};return F.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(T))),n.onSuccess(T),y},setArea:l9,audioElementPlayCenter:YR,resumeAudioContext:function(){YR.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){Sft.processExternalMediaAEC(t)},registerExtensions:function(t){const e=aa("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!T_(e).call(e,n.name)&&e.push(n.name);const a=n;a.__registered__=!0,a.logger.hookLog=F.extLog,a.reporter.hookApiInvoke=V_.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(s=>{a.parameters[s]=aa(s)})}),vat("PLUGIN_INFO",e)},ChannelMediaRelayError:c3,ChannelMediaRelayEvent:_L,ChannelMediaRelayState:f0,RemoteStreamFallbackType:kht,RemoteStreamType:Dht,ConnectionDisconnectedReason:vS,AudienceLatencyLevelType:cht,AREAS:ES,preload:async function(t,e,n,a){return qrt(t,e,n,a)}});return Object.defineProperties(IT,{onAudioAutoplayFailed:{get:()=>z0.onAudioAutoplayFailed,set:t=>{z0.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>z0.onAutoplayFailed,set:t=>{z0.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>IT._onSecurityPolicyViolation,set(t){IT._onSecurityPolicyViolation=t,$it(t)}},__CLIENT_LIST__:{get:()=>aa("SHOW_GLOBAL_CLIENT_LIST")?RM:[]}}),q0.on(yM.CAMERA_DEVICE_CHANGED,t=>{F.info("camera device changed",JSON.stringify(t)),IT.onCameraChanged&&IT.onCameraChanged(t),IT.safeEmit(RN.CAMERA_CHANGED,t)}),q0.on(yM.RECORDING_DEVICE_CHANGED,t=>{F.info("microphone device changed",JSON.stringify(t)),IT.onMicrophoneChanged&&IT.onMicrophoneChanged(t),IT.safeEmit(RN.MICROPHONE_CHANGED,t)}),q0.on(yM.PLAYOUT_DEVICE_CHANGED,t=>{F.debug("playout device changed",JSON.stringify(t)),IT.onPlaybackDeviceChanged&&IT.onPlaybackDeviceChanged(t),IT.safeEmit(RN.PLAYBACK_DEVICE_CHANGED,t)}),YR.onAutoplayFailed=()=>{F.info("detect audio element autoplay failed"),z0.onAudioAutoplayFailed&&z0.onAudioAutoplayFailed()},AS.on("autoplay-failed",()=>{F.info("detect webaudio autoplay failed"),z0.onAudioAutoplayFailed&&z0.onAudioAutoplayFailed(),IT.safeEmit(RN.AUTOPLAY_FAILED)}),AS.on(tR.STATE_CHANGE,(t,e)=>{F.info("audio context state changed: ".concat(e," => ").concat(t)),IT.onAudioContextStateChanged&&IT.onAudioContextStateChanged(t,e),IT.safeEmit(RN.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),ST.on(zV.NETWORK_STATE_CHANGE,(t,e)=>{F.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=IT),IT})}(AgoraRTC_NProduction$1)),AgoraRTC_NProduction$1.exports}var AgoraRTC_NProductionExports=requireAgoraRTC_NProduction();const AgoraRTC=getDefaultExportFromCjs(AgoraRTC_NProductionExports),AudioCall=()=>{const[i,r]=reactExports.useState(!1),[o,u]=reactExports.useState(null),[h,E]=reactExports.useState(0),[v,O]=reactExports.useState(null),[C,k]=reactExports.useState(!0),[j,K]=reactExports.useState(!1),[$,_e]=reactExports.useState(!1),[na,_c]=reactExports.useState(!1),[_a,_s]=reactExports.useState(!1),[_h,_f]=reactExports.useState(!1),[E_,y_]=reactExports.useState(""),F_=new URLSearchParams(location.search),w_=F_.get("chanel"),W_=F_.get("username");F_.get("callId"),F_.get("userType");const _S=F_.get("callType"),o_=F_.get("notificationId"),b_=reactExports.useRef(null),h_=reactExports.useRef(null),B_=reactExports.useRef(null),e_=reactExports.useRef(null),r_=reactExports.useRef(null),_p="740baf604340463486afea8a267cc8e8",c_=w_,v_=null,q_=async()=>{var Z_;if(i){console.log("Already joined the call.");return}_S==="receiver"&&((Z_=window.ReactNativeWebView)==null||Z_.postMessage(JSON.stringify({type:"TOGGLE_RINGTONE"})));try{h_.current=AgoraRTC.createClient({mode:"rtc",codec:"h264"}),h_.current.on("user-published",_u),h_.current.on("user-left",S_),h_.current.on("network-quality",P_),await h_.current.join(_p,c_,v_,null);const $S=await AgoraRTC.createMicrophoneAudioTrack({encoderConfig:{bitrate:128,sampleRate:48e3,stereo:!1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}});b_.current=$S,await h_.current.publish([$S]),r(!0)}catch($S){console.error("Error joining the channel:",$S)}};reactExports.useEffect(()=>{},[]),reactExports.useEffect(()=>{o&&O(new Date)},[o]);const _u=async(Z_,$S)=>{$S==="audio"&&(await h_.current.subscribe(Z_,"audio"),Z_.audioTrack.play(),u(Z_),_s(!0),O(new Date),console.log("Remote user joined:",Z_),r_.current&&(r_.current.pause(),r_.current.currentTime=0))},S_=async Z_=>{_s(!1),o&&o.uid===Z_.uid&&u(null),b_.current&&(b_.current.stop(),b_.current.close()),h_.current&&await h_.current.leave(),window.location.href="myapp://endcall"},P_=Z_=>{console.log("Network Quality:",Z_)},G_=async()=>{window.location.href="myapp://endcall",u(null),_s(!1),b_.current&&(b_.current.stop(),b_.current.close()),h_.current&&await h_.current.leave(),r(!1),E(0),O(null),K(!1)};reactExports.useEffect(()=>{let Z_;return v&&(Z_=setInterval(()=>{E(Math.floor((new Date-v)/1e3))},1e3)),()=>clearInterval(Z_)},[v]),reactExports.useEffect(()=>()=>{h_.current&&(h_.current.off("user-published",_u),h_.current.off("user-left",S_),h_.current.off("network-quality",P_))},[]),reactExports.useEffect(()=>{$&&(window.location.href="myapp://endcall")},[$]);const lb=Z_=>{const $S=Math.floor(Z_/60),FS=Z_%60;return`${$S}m ${FS}s`};reactExports.useEffect(()=>{const Z_=setTimeout(()=>{_a||G_()},3e4);return()=>clearTimeout(Z_)},[_a]),reactExports.useEffect(()=>((async()=>{var $S;try{if(h_.current=AgoraRTC.createClient({mode:"rtc",codec:"h264"}),h_.current.on("user-published",_u),h_.current.on("user-left",kS),await h_.current.join(_p,c_,v_,null),_S==="caller"){const WO=await AgoraRTC.createMicrophoneAudioTrack({encoderConfig:{bitrate:128,sampleRate:48e3,stereo:!1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}});await WO.setEnabled(!1),b_.current=WO,await h_.current.publish([WO]),_S==="caller"&&(($S=r_.current)==null||$S.play().catch(YO=>console.warn("Autoplay failed:",YO)))}const FS=agoraRtmSdkExports.createInstance(_p);await FS.login({uid:`${W_}-${Math.floor(Math.random()*1e4)}`});const t0=await FS.createChannel(c_);await t0.join(),t0.on("ChannelMessage",({text:WO})=>{WO==="call-ended"&&_e(!0)}),B_.current=FS,e_.current=t0}catch(FS){console.error("Agora Init Failed:",FS)}})(),()=>{var $S,FS;($S=h_.current)==null||$S.off("user-published",_u),(FS=h_.current)==null||FS.off("user-left",kS)}),[]);const kS=async()=>{_s(!1),window.location.href="myapp://endcall",u(null),b_.current&&(b_.current.stop(),b_.current.close()),h_.current&&await h_.current.leave(),r(!1),E(0),O(null),K(!1)};return reactExports.useEffect(()=>{const Z_=document.getElementById("call-status");let $S=0;setInterval(()=>{$S=($S+1)%4,Z_.innerText="Connecting"+".".repeat($S)},500)},[]),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{class:"call-screen",children:[jsxRuntimeExports.jsxs("div",{class:"caller-info",children:[jsxRuntimeExports.jsx("div",{class:"caller-name",children:W_}),i?jsxRuntimeExports.jsx("div",{children:lb(h)}):jsxRuntimeExports.jsx("div",{class:"call-status",id:"call-status",children:"Connecting"})]}),jsxRuntimeExports.jsx("div",{class:"logo",children:jsxRuntimeExports.jsx("img",{src:"https://rich143.com/images/newfavicon.svg",class:"profile-img",alt:"Profilesdfsdfs"})}),jsxRuntimeExports.jsx("div",{class:"control-buttons",children:!i&&(o_==="false"||o_==="null")?jsxRuntimeExports.jsx("button",{class:"btn btn-success",onClick:q_,children:jsxRuntimeExports.jsx("i",{class:"fas fa-phone"})}):jsxRuntimeExports.jsx("button",{class:"btn btn-danger",onClick:G_,children:jsxRuntimeExports.jsx("i",{class:"fas fa-phone-slash"})})})]})})},testing=()=>jsxRuntimeExports.jsx("div",{children:"testing"}),RenderPage=()=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/main",element:jsxRuntimeExports.jsx(AudioCall,{})}),jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(testing,{})})]})})});ReactDOM.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(RenderPage,{})}));
