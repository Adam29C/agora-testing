(function(){const A=document.createElement("link").relList;if(A&&A.supports&&A.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))b(P);new MutationObserver(P=>{for(const x of P)if(x.type==="childList")for(const H of x.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&b(H)}).observe(document,{childList:!0,subtree:!0});function w(P){const x={};return P.integrity&&(x.integrity=P.integrity),P.referrerPolicy&&(x.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?x.credentials="include":P.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function b(P){if(P.ep)return;P.ep=!0;const x=w(P);fetch(P.href,x)}})();var fw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mw(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var mw={exports:{}},Ge={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sV;function _8(){if(sV)return Ge;sV=1;var S=Symbol.for("react.transitional.element"),A=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),H=Symbol.for("react.context"),Q=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),G=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),st=Symbol.iterator;function mt(tt){return tt===null||typeof tt!="object"?null:(tt=st&&tt[st]||tt["@@iterator"],typeof tt=="function"?tt:null)}var Vt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},it=Object.assign,xt={};function yt(tt,Ut,Zt){this.props=tt,this.context=Ut,this.refs=xt,this.updater=Zt||Vt}yt.prototype.isReactComponent={},yt.prototype.setState=function(tt,Ut){if(typeof tt!="object"&&typeof tt!="function"&&tt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,tt,Ut,"setState")},yt.prototype.forceUpdate=function(tt){this.updater.enqueueForceUpdate(this,tt,"forceUpdate")};function Pt(){}Pt.prototype=yt.prototype;function Gt(tt,Ut,Zt){this.props=tt,this.context=Ut,this.refs=xt,this.updater=Zt||Vt}var Ft=Gt.prototype=new Pt;Ft.constructor=Gt,it(Ft,yt.prototype),Ft.isPureReactComponent=!0;var ye=Array.isArray,te={H:null,A:null,T:null,S:null,V:null},fn=Object.prototype.hasOwnProperty;function Ne(tt,Ut,Zt,qt,ne,Ze){return Zt=Ze.ref,{$$typeof:S,type:tt,key:Ut,ref:Zt!==void 0?Zt:null,props:Ze}}function Cn(tt,Ut){return Ne(tt.type,Ut,void 0,void 0,void 0,tt.props)}function An(tt){return typeof tt=="object"&&tt!==null&&tt.$$typeof===S}function hi(tt){var Ut={"=":"=0",":":"=2"};return"$"+tt.replace(/[=:]/g,function(Zt){return Ut[Zt]})}var Je=/\/+/g;function Yn(tt,Ut){return typeof tt=="object"&&tt!==null&&tt.key!=null?hi(""+tt.key):Ut.toString(36)}function lr(){}function mn(tt){switch(tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason;default:switch(typeof tt.status=="string"?tt.then(lr,lr):(tt.status="pending",tt.then(function(Ut){tt.status==="pending"&&(tt.status="fulfilled",tt.value=Ut)},function(Ut){tt.status==="pending"&&(tt.status="rejected",tt.reason=Ut)})),tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason}}throw tt}function Ri(tt,Ut,Zt,qt,ne){var Ze=typeof tt;(Ze==="undefined"||Ze==="boolean")&&(tt=null);var pe=!1;if(tt===null)pe=!0;else switch(Ze){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(tt.$$typeof){case S:case A:pe=!0;break;case Z:return pe=tt._init,Ri(pe(tt._payload),Ut,Zt,qt,ne)}}if(pe)return ne=ne(tt),pe=qt===""?"."+Yn(tt,0):qt,ye(ne)?(Zt="",pe!=null&&(Zt=pe.replace(Je,"$&/")+"/"),Ri(ne,Ut,Zt,"",function(Ka){return Ka})):ne!=null&&(An(ne)&&(ne=Cn(ne,Zt+(ne.key==null||tt&&tt.key===ne.key?"":(""+ne.key).replace(Je,"$&/")+"/")+pe)),Ut.push(ne)),1;pe=0;var Hr=qt===""?".":qt+":";if(ye(tt))for(var Jn=0;Jn<tt.length;Jn++)qt=tt[Jn],Ze=Hr+Yn(qt,Jn),pe+=Ri(qt,Ut,Zt,Ze,ne);else if(Jn=mt(tt),typeof Jn=="function")for(tt=Jn.call(tt),Jn=0;!(qt=tt.next()).done;)qt=qt.value,Ze=Hr+Yn(qt,Jn++),pe+=Ri(qt,Ut,Zt,Ze,ne);else if(Ze==="object"){if(typeof tt.then=="function")return Ri(mn(tt),Ut,Zt,qt,ne);throw Ut=String(tt),Error("Objects are not valid as a React child (found: "+(Ut==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":Ut)+"). If you meant to render a collection of children, use an array instead.")}return pe}function Rt(tt,Ut,Zt){if(tt==null)return tt;var qt=[],ne=0;return Ri(tt,qt,"","",function(Ze){return Ut.call(Zt,Ze,ne++)}),qt}function Jt(tt){if(tt._status===-1){var Ut=tt._result;Ut=Ut(),Ut.then(function(Zt){(tt._status===0||tt._status===-1)&&(tt._status=1,tt._result=Zt)},function(Zt){(tt._status===0||tt._status===-1)&&(tt._status=2,tt._result=Zt)}),tt._status===-1&&(tt._status=0,tt._result=Ut)}if(tt._status===1)return tt._result.default;throw tt._result}var de=typeof reportError=="function"?reportError:function(tt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ut=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof tt=="object"&&tt!==null&&typeof tt.message=="string"?String(tt.message):String(tt),error:tt});if(!window.dispatchEvent(Ut))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",tt);return}console.error(tt)};function Re(){}return Ge.Children={map:Rt,forEach:function(tt,Ut,Zt){Rt(tt,function(){Ut.apply(this,arguments)},Zt)},count:function(tt){var Ut=0;return Rt(tt,function(){Ut++}),Ut},toArray:function(tt){return Rt(tt,function(Ut){return Ut})||[]},only:function(tt){if(!An(tt))throw Error("React.Children.only expected to receive a single React element child.");return tt}},Ge.Component=yt,Ge.Fragment=w,Ge.Profiler=P,Ge.PureComponent=Gt,Ge.StrictMode=b,Ge.Suspense=X,Ge.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=te,Ge.__COMPILER_RUNTIME={__proto__:null,c:function(tt){return te.H.useMemoCache(tt)}},Ge.cache=function(tt){return function(){return tt.apply(null,arguments)}},Ge.cloneElement=function(tt,Ut,Zt){if(tt==null)throw Error("The argument must be a React element, but you passed "+tt+".");var qt=it({},tt.props),ne=tt.key,Ze=void 0;if(Ut!=null)for(pe in Ut.ref!==void 0&&(Ze=void 0),Ut.key!==void 0&&(ne=""+Ut.key),Ut)!fn.call(Ut,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&Ut.ref===void 0||(qt[pe]=Ut[pe]);var pe=arguments.length-2;if(pe===1)qt.children=Zt;else if(1<pe){for(var Hr=Array(pe),Jn=0;Jn<pe;Jn++)Hr[Jn]=arguments[Jn+2];qt.children=Hr}return Ne(tt.type,ne,void 0,void 0,Ze,qt)},Ge.createContext=function(tt){return tt={$$typeof:H,_currentValue:tt,_currentValue2:tt,_threadCount:0,Provider:null,Consumer:null},tt.Provider=tt,tt.Consumer={$$typeof:x,_context:tt},tt},Ge.createElement=function(tt,Ut,Zt){var qt,ne={},Ze=null;if(Ut!=null)for(qt in Ut.key!==void 0&&(Ze=""+Ut.key),Ut)fn.call(Ut,qt)&&qt!=="key"&&qt!=="__self"&&qt!=="__source"&&(ne[qt]=Ut[qt]);var pe=arguments.length-2;if(pe===1)ne.children=Zt;else if(1<pe){for(var Hr=Array(pe),Jn=0;Jn<pe;Jn++)Hr[Jn]=arguments[Jn+2];ne.children=Hr}if(tt&&tt.defaultProps)for(qt in pe=tt.defaultProps,pe)ne[qt]===void 0&&(ne[qt]=pe[qt]);return Ne(tt,Ze,void 0,void 0,null,ne)},Ge.createRef=function(){return{current:null}},Ge.forwardRef=function(tt){return{$$typeof:Q,render:tt}},Ge.isValidElement=An,Ge.lazy=function(tt){return{$$typeof:Z,_payload:{_status:-1,_result:tt},_init:Jt}},Ge.memo=function(tt,Ut){return{$$typeof:G,type:tt,compare:Ut===void 0?null:Ut}},Ge.startTransition=function(tt){var Ut=te.T,Zt={};te.T=Zt;try{var qt=tt(),ne=te.S;ne!==null&&ne(Zt,qt),typeof qt=="object"&&qt!==null&&typeof qt.then=="function"&&qt.then(Re,de)}catch(Ze){de(Ze)}finally{te.T=Ut}},Ge.unstable_useCacheRefresh=function(){return te.H.useCacheRefresh()},Ge.use=function(tt){return te.H.use(tt)},Ge.useActionState=function(tt,Ut,Zt){return te.H.useActionState(tt,Ut,Zt)},Ge.useCallback=function(tt,Ut){return te.H.useCallback(tt,Ut)},Ge.useContext=function(tt){return te.H.useContext(tt)},Ge.useDebugValue=function(){},Ge.useDeferredValue=function(tt,Ut){return te.H.useDeferredValue(tt,Ut)},Ge.useEffect=function(tt,Ut,Zt){var qt=te.H;if(typeof Zt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return qt.useEffect(tt,Ut)},Ge.useId=function(){return te.H.useId()},Ge.useImperativeHandle=function(tt,Ut,Zt){return te.H.useImperativeHandle(tt,Ut,Zt)},Ge.useInsertionEffect=function(tt,Ut){return te.H.useInsertionEffect(tt,Ut)},Ge.useLayoutEffect=function(tt,Ut){return te.H.useLayoutEffect(tt,Ut)},Ge.useMemo=function(tt,Ut){return te.H.useMemo(tt,Ut)},Ge.useOptimistic=function(tt,Ut){return te.H.useOptimistic(tt,Ut)},Ge.useReducer=function(tt,Ut,Zt){return te.H.useReducer(tt,Ut,Zt)},Ge.useRef=function(tt){return te.H.useRef(tt)},Ge.useState=function(tt){return te.H.useState(tt)},Ge.useSyncExternalStore=function(tt,Ut,Zt){return te.H.useSyncExternalStore(tt,Ut,Zt)},Ge.useTransition=function(){return te.H.useTransition()},Ge.version="19.1.0",Ge}var oV;function Uw(){return oV||(oV=1,mw.exports=_8()),mw.exports}var wt=Uw();const si=Mw(wt);var tS={},cV;function g8(){if(cV)return tS;cV=1,Object.defineProperty(tS,"__esModule",{value:!0}),tS.parse=H,tS.serialize=G;const S=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,A=/^[\u0021-\u003A\u003C-\u007E]*$/,w=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,b=/^[\u0020-\u003A\u003D-\u007E]*$/,P=Object.prototype.toString,x=(()=>{const mt=function(){};return mt.prototype=Object.create(null),mt})();function H(mt,Vt){const it=new x,xt=mt.length;if(xt<2)return it;const yt=(Vt==null?void 0:Vt.decode)||Z;let Pt=0;do{const Gt=mt.indexOf("=",Pt);if(Gt===-1)break;const Ft=mt.indexOf(";",Pt),ye=Ft===-1?xt:Ft;if(Gt>ye){Pt=mt.lastIndexOf(";",Gt-1)+1;continue}const te=Q(mt,Pt,Gt),fn=X(mt,Gt,te),Ne=mt.slice(te,fn);if(it[Ne]===void 0){let Cn=Q(mt,Gt+1,ye),An=X(mt,ye,Cn);const hi=yt(mt.slice(Cn,An));it[Ne]=hi}Pt=ye+1}while(Pt<xt);return it}function Q(mt,Vt,it){do{const xt=mt.charCodeAt(Vt);if(xt!==32&&xt!==9)return Vt}while(++Vt<it);return it}function X(mt,Vt,it){for(;Vt>it;){const xt=mt.charCodeAt(--Vt);if(xt!==32&&xt!==9)return Vt+1}return it}function G(mt,Vt,it){const xt=(it==null?void 0:it.encode)||encodeURIComponent;if(!S.test(mt))throw new TypeError(`argument name is invalid: ${mt}`);const yt=xt(Vt);if(!A.test(yt))throw new TypeError(`argument val is invalid: ${Vt}`);let Pt=mt+"="+yt;if(!it)return Pt;if(it.maxAge!==void 0){if(!Number.isInteger(it.maxAge))throw new TypeError(`option maxAge is invalid: ${it.maxAge}`);Pt+="; Max-Age="+it.maxAge}if(it.domain){if(!w.test(it.domain))throw new TypeError(`option domain is invalid: ${it.domain}`);Pt+="; Domain="+it.domain}if(it.path){if(!b.test(it.path))throw new TypeError(`option path is invalid: ${it.path}`);Pt+="; Path="+it.path}if(it.expires){if(!st(it.expires)||!Number.isFinite(it.expires.valueOf()))throw new TypeError(`option expires is invalid: ${it.expires}`);Pt+="; Expires="+it.expires.toUTCString()}if(it.httpOnly&&(Pt+="; HttpOnly"),it.secure&&(Pt+="; Secure"),it.partitioned&&(Pt+="; Partitioned"),it.priority)switch(typeof it.priority=="string"?it.priority.toLowerCase():void 0){case"low":Pt+="; Priority=Low";break;case"medium":Pt+="; Priority=Medium";break;case"high":Pt+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${it.priority}`)}if(it.sameSite)switch(typeof it.sameSite=="string"?it.sameSite.toLowerCase():it.sameSite){case!0:case"strict":Pt+="; SameSite=Strict";break;case"lax":Pt+="; SameSite=Lax";break;case"none":Pt+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${it.sameSite}`)}return Pt}function Z(mt){if(mt.indexOf("%")===-1)return mt;try{return decodeURIComponent(mt)}catch{return mt}}function st(mt){return P.call(mt)==="[object Date]"}return tS}g8();var lV="popstate";function S8(S={}){function A(b,P){let{pathname:x,search:H,hash:Q}=b.location;return bw("",{pathname:x,search:H,hash:Q},P.state&&P.state.usr||null,P.state&&P.state.key||"default")}function w(b,P){return typeof P=="string"?P:aS(P)}return R8(A,w,null,S)}function Ti(S,A){if(S===!1||S===null||typeof S>"u")throw new Error(A)}function mc(S,A){if(!S){typeof console<"u"&&console.warn(A);try{throw new Error(A)}catch{}}}function T8(){return Math.random().toString(36).substring(2,10)}function uV(S,A){return{usr:S.state,key:S.key,idx:A}}function bw(S,A,w=null,b){return{pathname:typeof S=="string"?S:S.pathname,search:"",hash:"",...typeof A=="string"?Cm(A):A,state:w,key:A&&A.key||b||T8()}}function aS({pathname:S="/",search:A="",hash:w=""}){return A&&A!=="?"&&(S+=A.charAt(0)==="?"?A:"?"+A),w&&w!=="#"&&(S+=w.charAt(0)==="#"?w:"#"+w),S}function Cm(S){let A={};if(S){let w=S.indexOf("#");w>=0&&(A.hash=S.substring(w),S=S.substring(0,w));let b=S.indexOf("?");b>=0&&(A.search=S.substring(b),S=S.substring(0,b)),S&&(A.pathname=S)}return A}function R8(S,A,w,b={}){let{window:P=document.defaultView,v5Compat:x=!1}=b,H=P.history,Q="POP",X=null,G=Z();G==null&&(G=0,H.replaceState({...H.state,idx:G},""));function Z(){return(H.state||{idx:null}).idx}function st(){Q="POP";let yt=Z(),Pt=yt==null?null:yt-G;G=yt,X&&X({action:Q,location:xt.location,delta:Pt})}function mt(yt,Pt){Q="PUSH";let Gt=bw(xt.location,yt,Pt);G=Z()+1;let Ft=uV(Gt,G),ye=xt.createHref(Gt);try{H.pushState(Ft,"",ye)}catch(te){if(te instanceof DOMException&&te.name==="DataCloneError")throw te;P.location.assign(ye)}x&&X&&X({action:Q,location:xt.location,delta:1})}function Vt(yt,Pt){Q="REPLACE";let Gt=bw(xt.location,yt,Pt);G=Z();let Ft=uV(Gt,G),ye=xt.createHref(Gt);H.replaceState(Ft,"",ye),x&&X&&X({action:Q,location:xt.location,delta:0})}function it(yt){let Pt=P.location.origin!=="null"?P.location.origin:P.location.href,Gt=typeof yt=="string"?yt:aS(yt);return Gt=Gt.replace(/ $/,"%20"),Ti(Pt,`No window.location.(origin|href) available to create URL for href: ${Gt}`),new URL(Gt,Pt)}let xt={get action(){return Q},get location(){return S(P,H)},listen(yt){if(X)throw new Error("A history only accepts one active listener");return P.addEventListener(lV,st),X=yt,()=>{P.removeEventListener(lV,st),X=null}},createHref(yt){return A(P,yt)},createURL:it,encodeLocation(yt){let Pt=it(yt);return{pathname:Pt.pathname,search:Pt.search,hash:Pt.hash}},push:mt,replace:Vt,go(yt){return H.go(yt)}};return xt}function MV(S,A,w="/"){return v8(S,A,w,!1)}function v8(S,A,w,b){let P=typeof A=="string"?Cm(A):A,x=hl(P.pathname||"/",w);if(x==null)return null;let H=UV(S);y8(H);let Q=null;for(let X=0;Q==null&&X<H.length;++X){let G=k8(x);Q=L8(H[X],G,b)}return Q}function UV(S,A=[],w=[],b=""){let P=(x,H,Q)=>{let X={relativePath:Q===void 0?x.path||"":Q,caseSensitive:x.caseSensitive===!0,childrenIndex:H,route:x};X.relativePath.startsWith("/")&&(Ti(X.relativePath.startsWith(b),`Absolute route path "${X.relativePath}" nested under path "${b}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),X.relativePath=X.relativePath.slice(b.length));let G=dl([b,X.relativePath]),Z=w.concat(X);x.children&&x.children.length>0&&(Ti(x.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${G}".`),UV(x.children,A,Z,G)),!(x.path==null&&!x.index)&&A.push({path:G,score:N8(G,x.index),routesMeta:Z})};return S.forEach((x,H)=>{var Q;if(x.path===""||!((Q=x.path)!=null&&Q.includes("?")))P(x,H);else for(let X of xV(x.path))P(x,H,X)}),A}function xV(S){let A=S.split("/");if(A.length===0)return[];let[w,...b]=A,P=w.endsWith("?"),x=w.replace(/\?$/,"");if(b.length===0)return P?[x,""]:[x];let H=xV(b.join("/")),Q=[];return Q.push(...H.map(X=>X===""?x:[x,X].join("/"))),P&&Q.push(...H),Q.map(X=>S.startsWith("/")&&X===""?"/":X)}function y8(S){S.sort((A,w)=>A.score!==w.score?w.score-A.score:D8(A.routesMeta.map(b=>b.childrenIndex),w.routesMeta.map(b=>b.childrenIndex)))}var C8=/^:[\w-]+$/,A8=3,b8=2,I8=1,O8=10,w8=-2,dV=S=>S==="*";function N8(S,A){let w=S.split("/"),b=w.length;return w.some(dV)&&(b+=w8),A&&(b+=b8),w.filter(P=>!dV(P)).reduce((P,x)=>P+(C8.test(x)?A8:x===""?I8:O8),b)}function D8(S,A){return S.length===A.length&&S.slice(0,-1).every((b,P)=>b===A[P])?S[S.length-1]-A[A.length-1]:0}function L8(S,A,w=!1){let{routesMeta:b}=S,P={},x="/",H=[];for(let Q=0;Q<b.length;++Q){let X=b[Q],G=Q===b.length-1,Z=x==="/"?A:A.slice(x.length)||"/",st=dC({path:X.relativePath,caseSensitive:X.caseSensitive,end:G},Z),mt=X.route;if(!st&&G&&w&&!b[b.length-1].route.index&&(st=dC({path:X.relativePath,caseSensitive:X.caseSensitive,end:!1},Z)),!st)return null;Object.assign(P,st.params),H.push({params:P,pathname:dl([x,st.pathname]),pathnameBase:V8(dl([x,st.pathnameBase])),route:mt}),st.pathnameBase!=="/"&&(x=dl([x,st.pathnameBase]))}return H}function dC(S,A){typeof S=="string"&&(S={path:S,caseSensitive:!1,end:!0});let[w,b]=P8(S.path,S.caseSensitive,S.end),P=A.match(w);if(!P)return null;let x=P[0],H=x.replace(/(.)\/+$/,"$1"),Q=P.slice(1);return{params:b.reduce((G,{paramName:Z,isOptional:st},mt)=>{if(Z==="*"){let it=Q[mt]||"";H=x.slice(0,x.length-it.length).replace(/(.)\/+$/,"$1")}const Vt=Q[mt];return st&&!Vt?G[Z]=void 0:G[Z]=(Vt||"").replace(/%2F/g,"/"),G},{}),pathname:x,pathnameBase:H,pattern:S}}function P8(S,A=!1,w=!0){mc(S==="*"||!S.endsWith("*")||S.endsWith("/*"),`Route path "${S}" will be treated as if it were "${S.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${S.replace(/\*$/,"/*")}".`);let b=[],P="^"+S.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(H,Q,X)=>(b.push({paramName:Q,isOptional:X!=null}),X?"/?([^\\/]+)?":"/([^\\/]+)"));return S.endsWith("*")?(b.push({paramName:"*"}),P+=S==="*"||S==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):w?P+="\\/*$":S!==""&&S!=="/"&&(P+="(?:(?=\\/|$))"),[new RegExp(P,A?void 0:"i"),b]}function k8(S){try{return S.split("/").map(A=>decodeURIComponent(A).replace(/\//g,"%2F")).join("/")}catch(A){return mc(!1,`The URL path "${S}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${A}).`),S}}function hl(S,A){if(A==="/")return S;if(!S.toLowerCase().startsWith(A.toLowerCase()))return null;let w=A.endsWith("/")?A.length-1:A.length,b=S.charAt(w);return b&&b!=="/"?null:S.slice(w)||"/"}function M8(S,A="/"){let{pathname:w,search:b="",hash:P=""}=typeof S=="string"?Cm(S):S;return{pathname:w?w.startsWith("/")?w:U8(w,A):A,search:B8(b),hash:F8(P)}}function U8(S,A){let w=A.replace(/\/+$/,"").split("/");return S.split("/").forEach(P=>{P===".."?w.length>1&&w.pop():P!=="."&&w.push(P)}),w.length>1?w.join("/"):"/"}function Ew(S,A,w,b){return`Cannot include a '${S}' character in a manually specified \`to.${A}\` field [${JSON.stringify(b)}].  Please separate it out to the \`to.${w}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function x8(S){return S.filter((A,w)=>w===0||A.route.path&&A.route.path.length>0)}function VV(S){let A=x8(S);return A.map((w,b)=>b===A.length-1?w.pathname:w.pathnameBase)}function BV(S,A,w,b=!1){let P;typeof S=="string"?P=Cm(S):(P={...S},Ti(!P.pathname||!P.pathname.includes("?"),Ew("?","pathname","search",P)),Ti(!P.pathname||!P.pathname.includes("#"),Ew("#","pathname","hash",P)),Ti(!P.search||!P.search.includes("#"),Ew("#","search","hash",P)));let x=S===""||P.pathname==="",H=x?"/":P.pathname,Q;if(H==null)Q=w;else{let st=A.length-1;if(!b&&H.startsWith("..")){let mt=H.split("/");for(;mt[0]==="..";)mt.shift(),st-=1;P.pathname=mt.join("/")}Q=st>=0?A[st]:"/"}let X=M8(P,Q),G=H&&H!=="/"&&H.endsWith("/"),Z=(x||H===".")&&w.endsWith("/");return!X.pathname.endsWith("/")&&(G||Z)&&(X.pathname+="/"),X}var dl=S=>S.join("/").replace(/\/\/+/g,"/"),V8=S=>S.replace(/\/+$/,"").replace(/^\/*/,"/"),B8=S=>!S||S==="?"?"":S.startsWith("?")?S:"?"+S,F8=S=>!S||S==="#"?"":S.startsWith("#")?S:"#"+S;function j8(S){return S!=null&&typeof S.status=="number"&&typeof S.statusText=="string"&&typeof S.internal=="boolean"&&"data"in S}var FV=["POST","PUT","PATCH","DELETE"];new Set(FV);var G8=["GET",...FV];new Set(G8);var Am=wt.createContext(null);Am.displayName="DataRouter";var fC=wt.createContext(null);fC.displayName="DataRouterState";var jV=wt.createContext({isTransitioning:!1});jV.displayName="ViewTransition";var H8=wt.createContext(new Map);H8.displayName="Fetchers";var W8=wt.createContext(null);W8.displayName="Await";var Ec=wt.createContext(null);Ec.displayName="Navigation";var oS=wt.createContext(null);oS.displayName="Location";var pl=wt.createContext({outlet:null,matches:[],isDataRoute:!1});pl.displayName="Route";var xw=wt.createContext(null);xw.displayName="RouteError";function K8(S,{relative:A}={}){Ti(cS(),"useHref() may be used only in the context of a <Router> component.");let{basename:w,navigator:b}=wt.useContext(Ec),{hash:P,pathname:x,search:H}=lS(S,{relative:A}),Q=x;return w!=="/"&&(Q=x==="/"?w:dl([w,x])),b.createHref({pathname:Q,search:H,hash:P})}function cS(){return wt.useContext(oS)!=null}function xu(){return Ti(cS(),"useLocation() may be used only in the context of a <Router> component."),wt.useContext(oS).location}var GV="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function HV(S){wt.useContext(Ec).static||wt.useLayoutEffect(S)}function Y8(){let{isDataRoute:S}=wt.useContext(pl);return S?aK():z8()}function z8(){Ti(cS(),"useNavigate() may be used only in the context of a <Router> component.");let S=wt.useContext(Am),{basename:A,navigator:w}=wt.useContext(Ec),{matches:b}=wt.useContext(pl),{pathname:P}=xu(),x=JSON.stringify(VV(b)),H=wt.useRef(!1);return HV(()=>{H.current=!0}),wt.useCallback((X,G={})=>{if(mc(H.current,GV),!H.current)return;if(typeof X=="number"){w.go(X);return}let Z=BV(X,JSON.parse(x),P,G.relative==="path");S==null&&A!=="/"&&(Z.pathname=Z.pathname==="/"?A:dl([A,Z.pathname])),(G.replace?w.replace:w.push)(Z,G.state,G)},[A,w,x,P,S])}wt.createContext(null);function lS(S,{relative:A}={}){let{matches:w}=wt.useContext(pl),{pathname:b}=xu(),P=JSON.stringify(VV(w));return wt.useMemo(()=>BV(S,JSON.parse(P),b,A==="path"),[S,P,b,A])}function q8(S,A){return WV(S,A)}function WV(S,A,w,b){var Gt;Ti(cS(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:P,static:x}=wt.useContext(Ec),{matches:H}=wt.useContext(pl),Q=H[H.length-1],X=Q?Q.params:{},G=Q?Q.pathname:"/",Z=Q?Q.pathnameBase:"/",st=Q&&Q.route;{let Ft=st&&st.path||"";KV(G,!st||Ft.endsWith("*")||Ft.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${G}" (under <Route path="${Ft}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ft}"> to <Route path="${Ft==="/"?"*":`${Ft}/*`}">.`)}let mt=xu(),Vt;if(A){let Ft=typeof A=="string"?Cm(A):A;Ti(Z==="/"||((Gt=Ft.pathname)==null?void 0:Gt.startsWith(Z)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${Z}" but pathname "${Ft.pathname}" was given in the \`location\` prop.`),Vt=Ft}else Vt=mt;let it=Vt.pathname||"/",xt=it;if(Z!=="/"){let Ft=Z.replace(/^\//,"").split("/");xt="/"+it.replace(/^\//,"").split("/").slice(Ft.length).join("/")}let yt=!x&&w&&w.matches&&w.matches.length>0?w.matches:MV(S,{pathname:xt});mc(st||yt!=null,`No routes matched location "${Vt.pathname}${Vt.search}${Vt.hash}" `),mc(yt==null||yt[yt.length-1].route.element!==void 0||yt[yt.length-1].route.Component!==void 0||yt[yt.length-1].route.lazy!==void 0,`Matched leaf route at location "${Vt.pathname}${Vt.search}${Vt.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Pt=$8(yt&&yt.map(Ft=>Object.assign({},Ft,{params:Object.assign({},X,Ft.params),pathname:dl([Z,P.encodeLocation?P.encodeLocation(Ft.pathname).pathname:Ft.pathname]),pathnameBase:Ft.pathnameBase==="/"?Z:dl([Z,P.encodeLocation?P.encodeLocation(Ft.pathnameBase).pathname:Ft.pathnameBase])})),H,w,b);return A&&Pt?wt.createElement(oS.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Vt},navigationType:"POP"}},Pt):Pt}function X8(){let S=rK(),A=j8(S)?`${S.status} ${S.statusText}`:S instanceof Error?S.message:JSON.stringify(S),w=S instanceof Error?S.stack:null,b="rgba(200,200,200, 0.5)",P={padding:"0.5rem",backgroundColor:b},x={padding:"2px 4px",backgroundColor:b},H=null;return console.error("Error handled by React Router default ErrorBoundary:",S),H=wt.createElement(wt.Fragment,null,wt.createElement("p",null,"💿 Hey developer 👋"),wt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",wt.createElement("code",{style:x},"ErrorBoundary")," or"," ",wt.createElement("code",{style:x},"errorElement")," prop on your route.")),wt.createElement(wt.Fragment,null,wt.createElement("h2",null,"Unexpected Application Error!"),wt.createElement("h3",{style:{fontStyle:"italic"}},A),w?wt.createElement("pre",{style:P},w):null,H)}var J8=wt.createElement(X8,null),Q8=class extends wt.Component{constructor(S){super(S),this.state={location:S.location,revalidation:S.revalidation,error:S.error}}static getDerivedStateFromError(S){return{error:S}}static getDerivedStateFromProps(S,A){return A.location!==S.location||A.revalidation!=="idle"&&S.revalidation==="idle"?{error:S.error,location:S.location,revalidation:S.revalidation}:{error:S.error!==void 0?S.error:A.error,location:A.location,revalidation:S.revalidation||A.revalidation}}componentDidCatch(S,A){console.error("React Router caught the following error during render",S,A)}render(){return this.state.error!==void 0?wt.createElement(pl.Provider,{value:this.props.routeContext},wt.createElement(xw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Z8({routeContext:S,match:A,children:w}){let b=wt.useContext(Am);return b&&b.static&&b.staticContext&&(A.route.errorElement||A.route.ErrorBoundary)&&(b.staticContext._deepestRenderedBoundaryId=A.route.id),wt.createElement(pl.Provider,{value:S},w)}function $8(S,A=[],w=null,b=null){if(S==null){if(!w)return null;if(w.errors)S=w.matches;else if(A.length===0&&!w.initialized&&w.matches.length>0)S=w.matches;else return null}let P=S,x=w==null?void 0:w.errors;if(x!=null){let X=P.findIndex(G=>G.route.id&&(x==null?void 0:x[G.route.id])!==void 0);Ti(X>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(x).join(",")}`),P=P.slice(0,Math.min(P.length,X+1))}let H=!1,Q=-1;if(w)for(let X=0;X<P.length;X++){let G=P[X];if((G.route.HydrateFallback||G.route.hydrateFallbackElement)&&(Q=X),G.route.id){let{loaderData:Z,errors:st}=w,mt=G.route.loader&&!Z.hasOwnProperty(G.route.id)&&(!st||st[G.route.id]===void 0);if(G.route.lazy||mt){H=!0,Q>=0?P=P.slice(0,Q+1):P=[P[0]];break}}}return P.reduceRight((X,G,Z)=>{let st,mt=!1,Vt=null,it=null;w&&(st=x&&G.route.id?x[G.route.id]:void 0,Vt=G.route.errorElement||J8,H&&(Q<0&&Z===0?(KV("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),mt=!0,it=null):Q===Z&&(mt=!0,it=G.route.hydrateFallbackElement||null)));let xt=A.concat(P.slice(0,Z+1)),yt=()=>{let Pt;return st?Pt=Vt:mt?Pt=it:G.route.Component?Pt=wt.createElement(G.route.Component,null):G.route.element?Pt=G.route.element:Pt=X,wt.createElement(Z8,{match:G,routeContext:{outlet:X,matches:xt,isDataRoute:w!=null},children:Pt})};return w&&(G.route.ErrorBoundary||G.route.errorElement||Z===0)?wt.createElement(Q8,{location:w.location,revalidation:w.revalidation,component:Vt,error:st,children:yt(),routeContext:{outlet:null,matches:xt,isDataRoute:!0}}):yt()},null)}function Vw(S){return`${S} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function tK(S){let A=wt.useContext(Am);return Ti(A,Vw(S)),A}function eK(S){let A=wt.useContext(fC);return Ti(A,Vw(S)),A}function nK(S){let A=wt.useContext(pl);return Ti(A,Vw(S)),A}function Bw(S){let A=nK(S),w=A.matches[A.matches.length-1];return Ti(w.route.id,`${S} can only be used on routes that contain a unique "id"`),w.route.id}function iK(){return Bw("useRouteId")}function rK(){var b;let S=wt.useContext(xw),A=eK("useRouteError"),w=Bw("useRouteError");return S!==void 0?S:(b=A.errors)==null?void 0:b[w]}function aK(){let{router:S}=tK("useNavigate"),A=Bw("useNavigate"),w=wt.useRef(!1);return HV(()=>{w.current=!0}),wt.useCallback(async(P,x={})=>{mc(w.current,GV),w.current&&(typeof P=="number"?S.navigate(P):await S.navigate(P,{fromRouteId:A,...x}))},[S,A])}var hV={};function KV(S,A,w){!A&&!hV[S]&&(hV[S]=!0,mc(!1,w))}wt.memo(sK);function sK({routes:S,future:A,state:w}){return WV(S,void 0,w,A)}function Iw(S){Ti(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function oK({basename:S="/",children:A=null,location:w,navigationType:b="POP",navigator:P,static:x=!1}){Ti(!cS(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let H=S.replace(/^\/*/,"/"),Q=wt.useMemo(()=>({basename:H,navigator:P,static:x,future:{}}),[H,P,x]);typeof w=="string"&&(w=Cm(w));let{pathname:X="/",search:G="",hash:Z="",state:st=null,key:mt="default"}=w,Vt=wt.useMemo(()=>{let it=hl(X,H);return it==null?null:{location:{pathname:it,search:G,hash:Z,state:st,key:mt},navigationType:b}},[H,X,G,Z,st,mt,b]);return mc(Vt!=null,`<Router basename="${H}"> is not able to match the URL "${X}${G}${Z}" because it does not start with the basename, so the <Router> won't render anything.`),Vt==null?null:wt.createElement(Ec.Provider,{value:Q},wt.createElement(oS.Provider,{children:A,value:Vt}))}function cK({children:S,location:A}){return q8(Ow(S),A)}function Ow(S,A=[]){let w=[];return wt.Children.forEach(S,(b,P)=>{if(!wt.isValidElement(b))return;let x=[...A,P];if(b.type===wt.Fragment){w.push.apply(w,Ow(b.props.children,x));return}Ti(b.type===Iw,`[${typeof b.type=="string"?b.type:b.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ti(!b.props.index||!b.props.children,"An index route cannot have child routes.");let H={id:b.props.id||x.join("-"),caseSensitive:b.props.caseSensitive,element:b.props.element,Component:b.props.Component,index:b.props.index,path:b.props.path,loader:b.props.loader,action:b.props.action,hydrateFallbackElement:b.props.hydrateFallbackElement,HydrateFallback:b.props.HydrateFallback,errorElement:b.props.errorElement,ErrorBoundary:b.props.ErrorBoundary,hasErrorBoundary:b.props.hasErrorBoundary===!0||b.props.ErrorBoundary!=null||b.props.errorElement!=null,shouldRevalidate:b.props.shouldRevalidate,handle:b.props.handle,lazy:b.props.lazy};b.props.children&&(H.children=Ow(b.props.children,x)),w.push(H)}),w}var aC="get",sC="application/x-www-form-urlencoded";function mC(S){return S!=null&&typeof S.tagName=="string"}function lK(S){return mC(S)&&S.tagName.toLowerCase()==="button"}function uK(S){return mC(S)&&S.tagName.toLowerCase()==="form"}function dK(S){return mC(S)&&S.tagName.toLowerCase()==="input"}function hK(S){return!!(S.metaKey||S.altKey||S.ctrlKey||S.shiftKey)}function pK(S,A){return S.button===0&&(!A||A==="_self")&&!hK(S)}var rC=null;function fK(){if(rC===null)try{new FormData(document.createElement("form"),0),rC=!1}catch{rC=!0}return rC}var mK=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _w(S){return S!=null&&!mK.has(S)?(mc(!1,`"${S}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${sC}"`),null):S}function EK(S,A){let w,b,P,x,H;if(uK(S)){let Q=S.getAttribute("action");b=Q?hl(Q,A):null,w=S.getAttribute("method")||aC,P=_w(S.getAttribute("enctype"))||sC,x=new FormData(S)}else if(lK(S)||dK(S)&&(S.type==="submit"||S.type==="image")){let Q=S.form;if(Q==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let X=S.getAttribute("formaction")||Q.getAttribute("action");if(b=X?hl(X,A):null,w=S.getAttribute("formmethod")||Q.getAttribute("method")||aC,P=_w(S.getAttribute("formenctype"))||_w(Q.getAttribute("enctype"))||sC,x=new FormData(Q,S),!fK()){let{name:G,type:Z,value:st}=S;if(Z==="image"){let mt=G?`${G}.`:"";x.append(`${mt}x`,"0"),x.append(`${mt}y`,"0")}else G&&x.append(G,st)}}else{if(mC(S))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');w=aC,b=null,P=sC,H=S}return x&&P==="text/plain"&&(H=x,x=void 0),{action:b,method:w.toLowerCase(),encType:P,formData:x,body:H}}function Fw(S,A){if(S===!1||S===null||typeof S>"u")throw new Error(A)}async function _K(S,A){if(S.id in A)return A[S.id];try{let w=await import(S.module);return A[S.id]=w,w}catch(w){return console.error(`Error loading route module \`${S.module}\`, reloading page...`),console.error(w),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function gK(S){return S==null?!1:S.href==null?S.rel==="preload"&&typeof S.imageSrcSet=="string"&&typeof S.imageSizes=="string":typeof S.rel=="string"&&typeof S.href=="string"}async function SK(S,A,w){let b=await Promise.all(S.map(async P=>{let x=A.routes[P.route.id];if(x){let H=await _K(x,w);return H.links?H.links():[]}return[]}));return yK(b.flat(1).filter(gK).filter(P=>P.rel==="stylesheet"||P.rel==="preload").map(P=>P.rel==="stylesheet"?{...P,rel:"prefetch",as:"style"}:{...P,rel:"prefetch"}))}function pV(S,A,w,b,P,x){let H=(X,G)=>w[G]?X.route.id!==w[G].route.id:!0,Q=(X,G)=>{var Z;return w[G].pathname!==X.pathname||((Z=w[G].route.path)==null?void 0:Z.endsWith("*"))&&w[G].params["*"]!==X.params["*"]};return x==="assets"?A.filter((X,G)=>H(X,G)||Q(X,G)):x==="data"?A.filter((X,G)=>{var st;let Z=b.routes[X.route.id];if(!Z||!Z.hasLoader)return!1;if(H(X,G)||Q(X,G))return!0;if(X.route.shouldRevalidate){let mt=X.route.shouldRevalidate({currentUrl:new URL(P.pathname+P.search+P.hash,window.origin),currentParams:((st=w[0])==null?void 0:st.params)||{},nextUrl:new URL(S,window.origin),nextParams:X.params,defaultShouldRevalidate:!0});if(typeof mt=="boolean")return mt}return!0}):[]}function TK(S,A,{includeHydrateFallback:w}={}){return RK(S.map(b=>{let P=A.routes[b.route.id];if(!P)return[];let x=[P.module];return P.clientActionModule&&(x=x.concat(P.clientActionModule)),P.clientLoaderModule&&(x=x.concat(P.clientLoaderModule)),w&&P.hydrateFallbackModule&&(x=x.concat(P.hydrateFallbackModule)),P.imports&&(x=x.concat(P.imports)),x}).flat(1))}function RK(S){return[...new Set(S)]}function vK(S){let A={},w=Object.keys(S).sort();for(let b of w)A[b]=S[b];return A}function yK(S,A){let w=new Set;return new Set(A),S.reduce((b,P)=>{let x=JSON.stringify(vK(P));return w.has(x)||(w.add(x),b.push({key:x,link:P})),b},[])}var CK=new Set([100,101,204,205]);function AK(S,A){let w=typeof S=="string"?new URL(S,typeof window>"u"?"server://singlefetch/":window.location.origin):S;return w.pathname==="/"?w.pathname="_root.data":A&&hl(w.pathname,A)==="/"?w.pathname=`${A.replace(/\/$/,"")}/_root.data`:w.pathname=`${w.pathname.replace(/\/$/,"")}.data`,w}function YV(){let S=wt.useContext(Am);return Fw(S,"You must render this element inside a <DataRouterContext.Provider> element"),S}function bK(){let S=wt.useContext(fC);return Fw(S,"You must render this element inside a <DataRouterStateContext.Provider> element"),S}var jw=wt.createContext(void 0);jw.displayName="FrameworkContext";function zV(){let S=wt.useContext(jw);return Fw(S,"You must render this element inside a <HydratedRouter> element"),S}function IK(S,A){let w=wt.useContext(jw),[b,P]=wt.useState(!1),[x,H]=wt.useState(!1),{onFocus:Q,onBlur:X,onMouseEnter:G,onMouseLeave:Z,onTouchStart:st}=A,mt=wt.useRef(null);wt.useEffect(()=>{if(S==="render"&&H(!0),S==="viewport"){let xt=Pt=>{Pt.forEach(Gt=>{H(Gt.isIntersecting)})},yt=new IntersectionObserver(xt,{threshold:.5});return mt.current&&yt.observe(mt.current),()=>{yt.disconnect()}}},[S]),wt.useEffect(()=>{if(b){let xt=setTimeout(()=>{H(!0)},100);return()=>{clearTimeout(xt)}}},[b]);let Vt=()=>{P(!0)},it=()=>{P(!1),H(!1)};return w?S!=="intent"?[x,mt,{}]:[x,mt,{onFocus:eS(Q,Vt),onBlur:eS(X,it),onMouseEnter:eS(G,Vt),onMouseLeave:eS(Z,it),onTouchStart:eS(st,Vt)}]:[!1,mt,{}]}function eS(S,A){return w=>{S&&S(w),w.defaultPrevented||A(w)}}function OK({page:S,...A}){let{router:w}=YV(),b=wt.useMemo(()=>MV(w.routes,S,w.basename),[w.routes,S,w.basename]);return b?wt.createElement(NK,{page:S,matches:b,...A}):null}function wK(S){let{manifest:A,routeModules:w}=zV(),[b,P]=wt.useState([]);return wt.useEffect(()=>{let x=!1;return SK(S,A,w).then(H=>{x||P(H)}),()=>{x=!0}},[S,A,w]),b}function NK({page:S,matches:A,...w}){let b=xu(),{manifest:P,routeModules:x}=zV(),{basename:H}=YV(),{loaderData:Q,matches:X}=bK(),G=wt.useMemo(()=>pV(S,A,X,P,b,"data"),[S,A,X,P,b]),Z=wt.useMemo(()=>pV(S,A,X,P,b,"assets"),[S,A,X,P,b]),st=wt.useMemo(()=>{if(S===b.pathname+b.search+b.hash)return[];let it=new Set,xt=!1;if(A.forEach(Pt=>{var Ft;let Gt=P.routes[Pt.route.id];!Gt||!Gt.hasLoader||(!G.some(ye=>ye.route.id===Pt.route.id)&&Pt.route.id in Q&&((Ft=x[Pt.route.id])!=null&&Ft.shouldRevalidate)||Gt.hasClientLoader?xt=!0:it.add(Pt.route.id))}),it.size===0)return[];let yt=AK(S,H);return xt&&it.size>0&&yt.searchParams.set("_routes",A.filter(Pt=>it.has(Pt.route.id)).map(Pt=>Pt.route.id).join(",")),[yt.pathname+yt.search]},[H,Q,b,P,G,A,S,x]),mt=wt.useMemo(()=>TK(Z,P),[Z,P]),Vt=wK(Z);return wt.createElement(wt.Fragment,null,st.map(it=>wt.createElement("link",{key:it,rel:"prefetch",as:"fetch",href:it,...w})),mt.map(it=>wt.createElement("link",{key:it,rel:"modulepreload",href:it,...w})),Vt.map(({key:it,link:xt})=>wt.createElement("link",{key:it,...xt})))}function DK(...S){return A=>{S.forEach(w=>{typeof w=="function"?w(A):w!=null&&(w.current=A)})}}var qV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{qV&&(window.__reactRouterVersion="7.5.2")}catch{}function LK({basename:S,children:A,window:w}){let b=wt.useRef();b.current==null&&(b.current=S8({window:w,v5Compat:!0}));let P=b.current,[x,H]=wt.useState({action:P.action,location:P.location}),Q=wt.useCallback(X=>{wt.startTransition(()=>H(X))},[H]);return wt.useLayoutEffect(()=>P.listen(Q),[P,Q]),wt.createElement(oK,{basename:S,children:A,location:x.location,navigationType:x.action,navigator:P})}var XV=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,JV=wt.forwardRef(function({onClick:A,discover:w="render",prefetch:b="none",relative:P,reloadDocument:x,replace:H,state:Q,target:X,to:G,preventScrollReset:Z,viewTransition:st,...mt},Vt){let{basename:it}=wt.useContext(Ec),xt=typeof G=="string"&&XV.test(G),yt,Pt=!1;if(typeof G=="string"&&xt&&(yt=G,qV))try{let An=new URL(window.location.href),hi=G.startsWith("//")?new URL(An.protocol+G):new URL(G),Je=hl(hi.pathname,it);hi.origin===An.origin&&Je!=null?G=Je+hi.search+hi.hash:Pt=!0}catch{mc(!1,`<Link to="${G}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Gt=K8(G,{relative:P}),[Ft,ye,te]=IK(b,mt),fn=UK(G,{replace:H,state:Q,target:X,preventScrollReset:Z,relative:P,viewTransition:st});function Ne(An){A&&A(An),An.defaultPrevented||fn(An)}let Cn=wt.createElement("a",{...mt,...te,href:yt||Gt,onClick:Pt||x?A:Ne,ref:DK(Vt,ye),target:X,"data-discover":!xt&&w==="render"?"true":void 0});return Ft&&!xt?wt.createElement(wt.Fragment,null,Cn,wt.createElement(OK,{page:Gt})):Cn});JV.displayName="Link";var PK=wt.forwardRef(function({"aria-current":A="page",caseSensitive:w=!1,className:b="",end:P=!1,style:x,to:H,viewTransition:Q,children:X,...G},Z){let st=lS(H,{relative:G.relative}),mt=xu(),Vt=wt.useContext(fC),{navigator:it,basename:xt}=wt.useContext(Ec),yt=Vt!=null&&jK(st)&&Q===!0,Pt=it.encodeLocation?it.encodeLocation(st).pathname:st.pathname,Gt=mt.pathname,Ft=Vt&&Vt.navigation&&Vt.navigation.location?Vt.navigation.location.pathname:null;w||(Gt=Gt.toLowerCase(),Ft=Ft?Ft.toLowerCase():null,Pt=Pt.toLowerCase()),Ft&&xt&&(Ft=hl(Ft,xt)||Ft);const ye=Pt!=="/"&&Pt.endsWith("/")?Pt.length-1:Pt.length;let te=Gt===Pt||!P&&Gt.startsWith(Pt)&&Gt.charAt(ye)==="/",fn=Ft!=null&&(Ft===Pt||!P&&Ft.startsWith(Pt)&&Ft.charAt(Pt.length)==="/"),Ne={isActive:te,isPending:fn,isTransitioning:yt},Cn=te?A:void 0,An;typeof b=="function"?An=b(Ne):An=[b,te?"active":null,fn?"pending":null,yt?"transitioning":null].filter(Boolean).join(" ");let hi=typeof x=="function"?x(Ne):x;return wt.createElement(JV,{...G,"aria-current":Cn,className:An,ref:Z,style:hi,to:H,viewTransition:Q},typeof X=="function"?X(Ne):X)});PK.displayName="NavLink";var kK=wt.forwardRef(({discover:S="render",fetcherKey:A,navigate:w,reloadDocument:b,replace:P,state:x,method:H=aC,action:Q,onSubmit:X,relative:G,preventScrollReset:Z,viewTransition:st,...mt},Vt)=>{let it=BK(),xt=FK(Q,{relative:G}),yt=H.toLowerCase()==="get"?"get":"post",Pt=typeof Q=="string"&&XV.test(Q),Gt=Ft=>{if(X&&X(Ft),Ft.defaultPrevented)return;Ft.preventDefault();let ye=Ft.nativeEvent.submitter,te=(ye==null?void 0:ye.getAttribute("formmethod"))||H;it(ye||Ft.currentTarget,{fetcherKey:A,method:te,navigate:w,replace:P,state:x,relative:G,preventScrollReset:Z,viewTransition:st})};return wt.createElement("form",{ref:Vt,method:yt,action:xt,onSubmit:b?X:Gt,...mt,"data-discover":!Pt&&S==="render"?"true":void 0})});kK.displayName="Form";function MK(S){return`${S} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function QV(S){let A=wt.useContext(Am);return Ti(A,MK(S)),A}function UK(S,{target:A,replace:w,state:b,preventScrollReset:P,relative:x,viewTransition:H}={}){let Q=Y8(),X=xu(),G=lS(S,{relative:x});return wt.useCallback(Z=>{if(pK(Z,A)){Z.preventDefault();let st=w!==void 0?w:aS(X)===aS(G);Q(S,{replace:st,state:b,preventScrollReset:P,relative:x,viewTransition:H})}},[X,Q,G,w,b,A,S,P,x,H])}var xK=0,VK=()=>`__${String(++xK)}__`;function BK(){let{router:S}=QV("useSubmit"),{basename:A}=wt.useContext(Ec),w=iK();return wt.useCallback(async(b,P={})=>{let{action:x,method:H,encType:Q,formData:X,body:G}=EK(b,A);if(P.navigate===!1){let Z=P.fetcherKey||VK();await S.fetch(Z,w,P.action||x,{preventScrollReset:P.preventScrollReset,formData:X,body:G,formMethod:P.method||H,formEncType:P.encType||Q,flushSync:P.flushSync})}else await S.navigate(P.action||x,{preventScrollReset:P.preventScrollReset,formData:X,body:G,formMethod:P.method||H,formEncType:P.encType||Q,replace:P.replace,state:P.state,fromRouteId:w,flushSync:P.flushSync,viewTransition:P.viewTransition})},[S,A,w])}function FK(S,{relative:A}={}){let{basename:w}=wt.useContext(Ec),b=wt.useContext(pl);Ti(b,"useFormAction must be used inside a RouteContext");let[P]=b.matches.slice(-1),x={...lS(S||".",{relative:A})},H=xu();if(S==null){x.search=H.search;let Q=new URLSearchParams(x.search),X=Q.getAll("index");if(X.some(Z=>Z==="")){Q.delete("index"),X.filter(st=>st).forEach(st=>Q.append("index",st));let Z=Q.toString();x.search=Z?`?${Z}`:""}}return(!S||S===".")&&P.route.index&&(x.search=x.search?x.search.replace(/^\?/,"?index&"):"?index"),w!=="/"&&(x.pathname=x.pathname==="/"?w:dl([w,x.pathname])),aS(x)}function jK(S,A={}){let w=wt.useContext(jV);Ti(w!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:b}=QV("useViewTransitionState"),P=lS(S,{relative:A.relative});if(!w.isTransitioning)return!1;let x=hl(w.currentLocation.pathname,b)||w.currentLocation.pathname,H=hl(w.nextLocation.pathname,b)||w.nextLocation.pathname;return dC(P.pathname,H)!=null||dC(P.pathname,x)!=null}new TextEncoder;[...CK];var gw={exports:{}},jr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fV;function GK(){if(fV)return jr;fV=1;var S=Uw();function A(X){var G="https://react.dev/errors/"+X;if(1<arguments.length){G+="?args[]="+encodeURIComponent(arguments[1]);for(var Z=2;Z<arguments.length;Z++)G+="&args[]="+encodeURIComponent(arguments[Z])}return"Minified React error #"+X+"; visit "+G+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function w(){}var b={d:{f:w,r:function(){throw Error(A(522))},D:w,C:w,L:w,m:w,X:w,S:w,M:w},p:0,findDOMNode:null},P=Symbol.for("react.portal");function x(X,G,Z){var st=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:st==null?null:""+st,children:X,containerInfo:G,implementation:Z}}var H=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Q(X,G){if(X==="font")return"";if(typeof G=="string")return G==="use-credentials"?G:""}return jr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=b,jr.createPortal=function(X,G){var Z=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!G||G.nodeType!==1&&G.nodeType!==9&&G.nodeType!==11)throw Error(A(299));return x(X,G,null,Z)},jr.flushSync=function(X){var G=H.T,Z=b.p;try{if(H.T=null,b.p=2,X)return X()}finally{H.T=G,b.p=Z,b.d.f()}},jr.preconnect=function(X,G){typeof X=="string"&&(G?(G=G.crossOrigin,G=typeof G=="string"?G==="use-credentials"?G:"":void 0):G=null,b.d.C(X,G))},jr.prefetchDNS=function(X){typeof X=="string"&&b.d.D(X)},jr.preinit=function(X,G){if(typeof X=="string"&&G&&typeof G.as=="string"){var Z=G.as,st=Q(Z,G.crossOrigin),mt=typeof G.integrity=="string"?G.integrity:void 0,Vt=typeof G.fetchPriority=="string"?G.fetchPriority:void 0;Z==="style"?b.d.S(X,typeof G.precedence=="string"?G.precedence:void 0,{crossOrigin:st,integrity:mt,fetchPriority:Vt}):Z==="script"&&b.d.X(X,{crossOrigin:st,integrity:mt,fetchPriority:Vt,nonce:typeof G.nonce=="string"?G.nonce:void 0})}},jr.preinitModule=function(X,G){if(typeof X=="string")if(typeof G=="object"&&G!==null){if(G.as==null||G.as==="script"){var Z=Q(G.as,G.crossOrigin);b.d.M(X,{crossOrigin:Z,integrity:typeof G.integrity=="string"?G.integrity:void 0,nonce:typeof G.nonce=="string"?G.nonce:void 0})}}else G==null&&b.d.M(X)},jr.preload=function(X,G){if(typeof X=="string"&&typeof G=="object"&&G!==null&&typeof G.as=="string"){var Z=G.as,st=Q(Z,G.crossOrigin);b.d.L(X,Z,{crossOrigin:st,integrity:typeof G.integrity=="string"?G.integrity:void 0,nonce:typeof G.nonce=="string"?G.nonce:void 0,type:typeof G.type=="string"?G.type:void 0,fetchPriority:typeof G.fetchPriority=="string"?G.fetchPriority:void 0,referrerPolicy:typeof G.referrerPolicy=="string"?G.referrerPolicy:void 0,imageSrcSet:typeof G.imageSrcSet=="string"?G.imageSrcSet:void 0,imageSizes:typeof G.imageSizes=="string"?G.imageSizes:void 0,media:typeof G.media=="string"?G.media:void 0})}},jr.preloadModule=function(X,G){if(typeof X=="string")if(G){var Z=Q(G.as,G.crossOrigin);b.d.m(X,{as:typeof G.as=="string"&&G.as!=="script"?G.as:void 0,crossOrigin:Z,integrity:typeof G.integrity=="string"?G.integrity:void 0})}else b.d.m(X)},jr.requestFormReset=function(X){b.d.r(X)},jr.unstable_batchedUpdates=function(X,G){return X(G)},jr.useFormState=function(X,G,Z){return H.H.useFormState(X,G,Z)},jr.useFormStatus=function(){return H.H.useHostTransitionStatus()},jr.version="19.1.0",jr}var mV;function HK(){if(mV)return gw.exports;mV=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(A){console.error(A)}}return S(),gw.exports=GK(),gw.exports}var Sw={exports:{}},nS={},Tw={exports:{}},Rw={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EV;function WK(){return EV||(EV=1,function(S){function A(Rt,Jt){var de=Rt.length;Rt.push(Jt);t:for(;0<de;){var Re=de-1>>>1,tt=Rt[Re];if(0<P(tt,Jt))Rt[Re]=Jt,Rt[de]=tt,de=Re;else break t}}function w(Rt){return Rt.length===0?null:Rt[0]}function b(Rt){if(Rt.length===0)return null;var Jt=Rt[0],de=Rt.pop();if(de!==Jt){Rt[0]=de;t:for(var Re=0,tt=Rt.length,Ut=tt>>>1;Re<Ut;){var Zt=2*(Re+1)-1,qt=Rt[Zt],ne=Zt+1,Ze=Rt[ne];if(0>P(qt,de))ne<tt&&0>P(Ze,qt)?(Rt[Re]=Ze,Rt[ne]=de,Re=ne):(Rt[Re]=qt,Rt[Zt]=de,Re=Zt);else if(ne<tt&&0>P(Ze,de))Rt[Re]=Ze,Rt[ne]=de,Re=ne;else break t}}return Jt}function P(Rt,Jt){var de=Rt.sortIndex-Jt.sortIndex;return de!==0?de:Rt.id-Jt.id}if(S.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var x=performance;S.unstable_now=function(){return x.now()}}else{var H=Date,Q=H.now();S.unstable_now=function(){return H.now()-Q}}var X=[],G=[],Z=1,st=null,mt=3,Vt=!1,it=!1,xt=!1,yt=!1,Pt=typeof setTimeout=="function"?setTimeout:null,Gt=typeof clearTimeout=="function"?clearTimeout:null,Ft=typeof setImmediate<"u"?setImmediate:null;function ye(Rt){for(var Jt=w(G);Jt!==null;){if(Jt.callback===null)b(G);else if(Jt.startTime<=Rt)b(G),Jt.sortIndex=Jt.expirationTime,A(X,Jt);else break;Jt=w(G)}}function te(Rt){if(xt=!1,ye(Rt),!it)if(w(X)!==null)it=!0,fn||(fn=!0,Yn());else{var Jt=w(G);Jt!==null&&Ri(te,Jt.startTime-Rt)}}var fn=!1,Ne=-1,Cn=5,An=-1;function hi(){return yt?!0:!(S.unstable_now()-An<Cn)}function Je(){if(yt=!1,fn){var Rt=S.unstable_now();An=Rt;var Jt=!0;try{t:{it=!1,xt&&(xt=!1,Gt(Ne),Ne=-1),Vt=!0;var de=mt;try{e:{for(ye(Rt),st=w(X);st!==null&&!(st.expirationTime>Rt&&hi());){var Re=st.callback;if(typeof Re=="function"){st.callback=null,mt=st.priorityLevel;var tt=Re(st.expirationTime<=Rt);if(Rt=S.unstable_now(),typeof tt=="function"){st.callback=tt,ye(Rt),Jt=!0;break e}st===w(X)&&b(X),ye(Rt)}else b(X);st=w(X)}if(st!==null)Jt=!0;else{var Ut=w(G);Ut!==null&&Ri(te,Ut.startTime-Rt),Jt=!1}}break t}finally{st=null,mt=de,Vt=!1}Jt=void 0}}finally{Jt?Yn():fn=!1}}}var Yn;if(typeof Ft=="function")Yn=function(){Ft(Je)};else if(typeof MessageChannel<"u"){var lr=new MessageChannel,mn=lr.port2;lr.port1.onmessage=Je,Yn=function(){mn.postMessage(null)}}else Yn=function(){Pt(Je,0)};function Ri(Rt,Jt){Ne=Pt(function(){Rt(S.unstable_now())},Jt)}S.unstable_IdlePriority=5,S.unstable_ImmediatePriority=1,S.unstable_LowPriority=4,S.unstable_NormalPriority=3,S.unstable_Profiling=null,S.unstable_UserBlockingPriority=2,S.unstable_cancelCallback=function(Rt){Rt.callback=null},S.unstable_forceFrameRate=function(Rt){0>Rt||125<Rt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Cn=0<Rt?Math.floor(1e3/Rt):5},S.unstable_getCurrentPriorityLevel=function(){return mt},S.unstable_next=function(Rt){switch(mt){case 1:case 2:case 3:var Jt=3;break;default:Jt=mt}var de=mt;mt=Jt;try{return Rt()}finally{mt=de}},S.unstable_requestPaint=function(){yt=!0},S.unstable_runWithPriority=function(Rt,Jt){switch(Rt){case 1:case 2:case 3:case 4:case 5:break;default:Rt=3}var de=mt;mt=Rt;try{return Jt()}finally{mt=de}},S.unstable_scheduleCallback=function(Rt,Jt,de){var Re=S.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?Re+de:Re):de=Re,Rt){case 1:var tt=-1;break;case 2:tt=250;break;case 5:tt=1073741823;break;case 4:tt=1e4;break;default:tt=5e3}return tt=de+tt,Rt={id:Z++,callback:Jt,priorityLevel:Rt,startTime:de,expirationTime:tt,sortIndex:-1},de>Re?(Rt.sortIndex=de,A(G,Rt),w(X)===null&&Rt===w(G)&&(xt?(Gt(Ne),Ne=-1):xt=!0,Ri(te,de-Re))):(Rt.sortIndex=tt,A(X,Rt),it||Vt||(it=!0,fn||(fn=!0,Yn()))),Rt},S.unstable_shouldYield=hi,S.unstable_wrapCallback=function(Rt){var Jt=mt;return function(){var de=mt;mt=Jt;try{return Rt.apply(this,arguments)}finally{mt=de}}}}(Rw)),Rw}var _V;function KK(){return _V||(_V=1,Tw.exports=WK()),Tw.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gV;function YK(){if(gV)return nS;gV=1;var S=KK(),A=Uw(),w=HK();function b(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function P(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function x(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function H(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function Q(a){if(x(a)!==a)throw Error(b(188))}function X(a){var o=a.alternate;if(!o){if(o=x(a),o===null)throw Error(b(188));return o!==a?null:a}for(var u=a,f=o;;){var _=u.return;if(_===null)break;var R=_.alternate;if(R===null){if(f=_.return,f!==null){u=f;continue}break}if(_.child===R.child){for(R=_.child;R;){if(R===u)return Q(_),a;if(R===f)return Q(_),o;R=R.sibling}throw Error(b(188))}if(u.return!==f.return)u=_,f=R;else{for(var k=!1,B=_.child;B;){if(B===u){k=!0,u=_,f=R;break}if(B===f){k=!0,f=_,u=R;break}B=B.sibling}if(!k){for(B=R.child;B;){if(B===u){k=!0,u=R,f=_;break}if(B===f){k=!0,f=R,u=_;break}B=B.sibling}if(!k)throw Error(b(189))}}if(u.alternate!==f)throw Error(b(190))}if(u.tag!==3)throw Error(b(188));return u.stateNode.current===u?a:o}function G(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=G(a),o!==null)return o;a=a.sibling}return null}var Z=Object.assign,st=Symbol.for("react.element"),mt=Symbol.for("react.transitional.element"),Vt=Symbol.for("react.portal"),it=Symbol.for("react.fragment"),xt=Symbol.for("react.strict_mode"),yt=Symbol.for("react.profiler"),Pt=Symbol.for("react.provider"),Gt=Symbol.for("react.consumer"),Ft=Symbol.for("react.context"),ye=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),fn=Symbol.for("react.suspense_list"),Ne=Symbol.for("react.memo"),Cn=Symbol.for("react.lazy"),An=Symbol.for("react.activity"),hi=Symbol.for("react.memo_cache_sentinel"),Je=Symbol.iterator;function Yn(a){return a===null||typeof a!="object"?null:(a=Je&&a[Je]||a["@@iterator"],typeof a=="function"?a:null)}var lr=Symbol.for("react.client.reference");function mn(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===lr?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case it:return"Fragment";case yt:return"Profiler";case xt:return"StrictMode";case te:return"Suspense";case fn:return"SuspenseList";case An:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case Vt:return"Portal";case Ft:return(a.displayName||"Context")+".Provider";case Gt:return(a._context.displayName||"Context")+".Consumer";case ye:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Ne:return o=a.displayName||null,o!==null?o:mn(a.type)||"Memo";case Cn:o=a._payload,a=a._init;try{return mn(a(o))}catch{}}return null}var Ri=Array.isArray,Rt=A.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Jt=w.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},Re=[],tt=-1;function Ut(a){return{current:a}}function Zt(a){0>tt||(a.current=Re[tt],Re[tt]=null,tt--)}function qt(a,o){tt++,Re[tt]=a.current,a.current=o}var ne=Ut(null),Ze=Ut(null),pe=Ut(null),Hr=Ut(null);function Jn(a,o){switch(qt(pe,o),qt(Ze,a),qt(ne,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?TR(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=TR(o),a=RR(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Zt(ne),qt(ne,a)}function Ka(){Zt(ne),Zt(Ze),Zt(pe)}function Om(a){a.memoizedState!==null&&qt(Hr,a);var o=ne.current,u=RR(o,a.type);o!==u&&(qt(Ze,a),qt(ne,u))}function _c(a){Ze.current===a&&(Zt(ne),Zt(Ze)),Hr.current===a&&(Zt(Hr),cu._currentValue=de)}var ho=Object.prototype.hasOwnProperty,wm=S.unstable_scheduleCallback,Nm=S.unstable_cancelCallback,fl=S.unstable_shouldYield,yC=S.unstable_requestPaint,Ya=S.unstable_now,po=S.unstable_getCurrentPriorityLevel,Dm=S.unstable_ImmediatePriority,hS=S.unstable_UserBlockingPriority,Wi=S.unstable_NormalPriority,Wr=S.unstable_LowPriority,Mh=S.unstable_IdlePriority,Lm=S.log,CC=S.unstable_setDisableYieldValue,ml=null,kn=null;function ur(a){if(typeof Lm=="function"&&CC(a),kn&&typeof kn.setStrictMode=="function")try{kn.setStrictMode(ml,a)}catch{}}var yr=Math.clz32?Math.clz32:fS,Pm=Math.log,pS=Math.LN2;function fS(a){return a>>>=0,a===0?32:31-(Pm(a)/pS|0)|0}var Vu=256,Bu=4194304;function Kr(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Fu(a,o,u){var f=a.pendingLanes;if(f===0)return 0;var _=0,R=a.suspendedLanes,k=a.pingedLanes;a=a.warmLanes;var B=f&134217727;return B!==0?(f=B&~R,f!==0?_=Kr(f):(k&=B,k!==0?_=Kr(k):u||(u=B&~a,u!==0&&(_=Kr(u))))):(B=f&~R,B!==0?_=Kr(B):k!==0?_=Kr(k):u||(u=f&~a,u!==0&&(_=Kr(u)))),_===0?0:o!==0&&o!==_&&(o&R)===0&&(R=_&-_,u=o&-o,R>=u||R===32&&(u&4194048)!==0)?o:_}function ju(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function AC(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gc(){var a=Vu;return Vu<<=1,(Vu&4194048)===0&&(Vu=256),a}function km(){var a=Bu;return Bu<<=1,(Bu&62914560)===0&&(Bu=4194304),a}function Mm(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Gu(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function bC(a,o,u,f,_,R){var k=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var B=a.entanglements,q=a.expirationTimes,ut=a.hiddenUpdates;for(u=k&~u;0<u;){var _t=31-yr(u),Dt=1<<_t;B[_t]=0,q[_t]=-1;var ht=ut[_t];if(ht!==null)for(ut[_t]=null,_t=0;_t<ht.length;_t++){var pt=ht[_t];pt!==null&&(pt.lane&=-536870913)}u&=~Dt}f!==0&&mS(a,f,0),R!==0&&_===0&&a.tag!==0&&(a.suspendedLanes|=R&~(k&~o))}function mS(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var f=31-yr(o);a.entangledLanes|=o,a.entanglements[f]=a.entanglements[f]|1073741824|u&4194090}function El(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var f=31-yr(u),_=1<<f;_&o|a[f]&o&&(a[f]|=o),u&=~_}}function Um(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function fo(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function ES(){var a=Jt.p;return a!==0?a:(a=window.event,a===void 0?32:jR(a.type))}function IC(a,o){var u=Jt.p;try{return Jt.p=a,o()}finally{Jt.p=u}}var mo=Math.random().toString(36).slice(2),In="__reactFiber$"+mo,Cr="__reactProps$"+mo,_l="__reactContainer$"+mo,gl="__reactEvents$"+mo,_S="__reactListeners$"+mo,gS="__reactHandles$"+mo,xm="__reactResources$"+mo,Hu="__reactMarker$"+mo;function Uh(a){delete a[In],delete a[Cr],delete a[gl],delete a[_S],delete a[gS]}function Sc(a){var o=a[In];if(o)return o;for(var u=a.parentNode;u;){if(o=u[_l]||u[In]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=CR(a);a!==null;){if(u=a[In])return u;a=CR(a)}return o}a=u,u=a.parentNode}return null}function Sl(a){if(a=a[In]||a[_l]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function Wu(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(b(33))}function Tc(a){var o=a[xm];return o||(o=a[xm]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function vi(a){a[Hu]=!0}var Vm=new Set,Rc={};function vc(a,o){Tl(a,o),Tl(a+"Capture",o)}function Tl(a,o){for(Rc[a]=o,a=0;a<o.length;a++)Vm.add(o[a])}var za=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),SS={},TS={};function pi(a){return ho.call(TS,a)?!0:ho.call(SS,a)?!1:za.test(a)?TS[a]=!0:(SS[a]=!0,!1)}function xh(a,o,u){if(pi(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function Vh(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function Cs(a,o,u,f){if(f===null)a.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+f)}}var Bm,Bh;function Rl(a){if(Bm===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Bm=o&&o[1]||"",Bh=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Bm+a+Bh}var Fh=!1;function Fm(a,o){if(!a||Fh)return"";Fh=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var Dt=function(){throw Error()};if(Object.defineProperty(Dt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Dt,[])}catch(pt){var ht=pt}Reflect.construct(a,[],Dt)}else{try{Dt.call()}catch(pt){ht=pt}a.call(Dt.prototype)}}else{try{throw Error()}catch(pt){ht=pt}(Dt=a())&&typeof Dt.catch=="function"&&Dt.catch(function(){})}}catch(pt){if(pt&&ht&&typeof pt.stack=="string")return[pt.stack,ht.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=f.DetermineComponentFrameRoot(),k=R[0],B=R[1];if(k&&B){var q=k.split(`
`),ut=B.split(`
`);for(_=f=0;f<q.length&&!q[f].includes("DetermineComponentFrameRoot");)f++;for(;_<ut.length&&!ut[_].includes("DetermineComponentFrameRoot");)_++;if(f===q.length||_===ut.length)for(f=q.length-1,_=ut.length-1;1<=f&&0<=_&&q[f]!==ut[_];)_--;for(;1<=f&&0<=_;f--,_--)if(q[f]!==ut[_]){if(f!==1||_!==1)do if(f--,_--,0>_||q[f]!==ut[_]){var _t=`
`+q[f].replace(" at new "," at ");return a.displayName&&_t.includes("<anonymous>")&&(_t=_t.replace("<anonymous>",a.displayName)),_t}while(1<=f&&0<=_);break}}}finally{Fh=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?Rl(u):""}function OC(a){switch(a.tag){case 26:case 27:case 5:return Rl(a.type);case 16:return Rl("Lazy");case 13:return Rl("Suspense");case 19:return Rl("SuspenseList");case 0:case 15:return Fm(a.type,!1);case 11:return Fm(a.type.render,!1);case 1:return Fm(a.type,!0);case 31:return Rl("Activity");default:return""}}function RS(a){try{var o="";do o+=OC(a),a=a.return;while(a);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Ki(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function jh(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function wC(a){var o=jh(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var _=u.get,R=u.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return _.call(this)},set:function(k){f=""+k,R.call(this,k)}}),Object.defineProperty(a,o,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(k){f=""+k},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function dn(a){a._valueTracker||(a._valueTracker=wC(a))}function vS(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),f="";return a&&(f=jh(a)?a.checked?"true":"false":a.value),a=f,a!==u?(o.setValue(a),!0):!1}function Ku(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var yS=/[\n"\\]/g;function ea(a){return a.replace(yS,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function jm(a,o,u,f,_,R,k,B){a.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?a.type=k:a.removeAttribute("type"),o!=null?k==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+Ki(o)):a.value!==""+Ki(o)&&(a.value=""+Ki(o)):k!=="submit"&&k!=="reset"||a.removeAttribute("value"),o!=null?Gm(a,k,Ki(o)):u!=null?Gm(a,k,Ki(u)):f!=null&&a.removeAttribute("value"),_==null&&R!=null&&(a.defaultChecked=!!R),_!=null&&(a.checked=_&&typeof _!="function"&&typeof _!="symbol"),B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?a.name=""+Ki(B):a.removeAttribute("name")}function CS(a,o,u,f,_,R,k,B){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.type=R),o!=null||u!=null){if(!(R!=="submit"&&R!=="reset"||o!=null))return;u=u!=null?""+Ki(u):"",o=o!=null?""+Ki(o):u,B||o===a.value||(a.value=o),a.defaultValue=o}f=f??_,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=B?a.checked:!!f,a.defaultChecked=!!f,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(a.name=k)}function Gm(a,o,u){o==="number"&&Ku(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function vl(a,o,u,f){if(a=a.options,o){o={};for(var _=0;_<u.length;_++)o["$"+u[_]]=!0;for(u=0;u<a.length;u++)_=o.hasOwnProperty("$"+a[u].value),a[u].selected!==_&&(a[u].selected=_),_&&f&&(a[u].defaultSelected=!0)}else{for(u=""+Ki(u),o=null,_=0;_<a.length;_++){if(a[_].value===u){a[_].selected=!0,f&&(a[_].defaultSelected=!0);return}o!==null||a[_].disabled||(o=a[_])}o!==null&&(o.selected=!0)}}function AS(a,o,u){if(o!=null&&(o=""+Ki(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+Ki(u):""}function Yu(a,o,u,f){if(o==null){if(f!=null){if(u!=null)throw Error(b(92));if(Ri(f)){if(1<f.length)throw Error(b(93));f=f[0]}u=f}u==null&&(u=""),o=u}u=Ki(o),a.defaultValue=u,f=a.textContent,f===u&&f!==""&&f!==null&&(a.value=f)}function yc(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var Hm=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bS(a,o,u){var f=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":f?a.setProperty(o,u):typeof u!="number"||u===0||Hm.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function Gh(a,o,u){if(o!=null&&typeof o!="object")throw Error(b(62));if(a=a.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var _ in o)f=o[_],o.hasOwnProperty(_)&&u[_]!==f&&bS(a,_,f)}else for(var R in o)o.hasOwnProperty(R)&&bS(a,R,o[R])}function Wm(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var IS=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),NC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Hh(a){return NC.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Km=null;function Ym(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var yl=null,Cl=null;function OS(a){var o=Sl(a);if(o&&(a=o.stateNode)){var u=a[Cr]||null;t:switch(a=o.stateNode,o.type){case"input":if(jm(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ea(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var f=u[o];if(f!==a&&f.form===a.form){var _=f[Cr]||null;if(!_)throw Error(b(90));jm(f,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(o=0;o<u.length;o++)f=u[o],f.form===a.form&&vS(f)}break t;case"textarea":AS(a,u.value,u.defaultValue);break t;case"select":o=u.value,o!=null&&vl(a,!!u.multiple,o,!1)}}}var zm=!1;function qm(a,o,u){if(zm)return a(o,u);zm=!0;try{var f=a(o);return f}finally{if(zm=!1,(yl!==null||Cl!==null)&&(Zp(),yl&&(o=yl,a=Cl,Cl=yl=null,OS(o),a)))for(o=0;o<a.length;o++)OS(a[o])}}function zu(a,o){var u=a.stateNode;if(u===null)return null;var f=u[Cr]||null;if(f===null)return null;u=f[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break t;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(b(231,o,typeof u));return u}var As=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xm=!1;if(As)try{var bs={};Object.defineProperty(bs,"passive",{get:function(){Xm=!0}}),window.addEventListener("test",bs,bs),window.removeEventListener("test",bs,bs)}catch{Xm=!1}var Eo=null,Jm=null,Wh=null;function wS(){if(Wh)return Wh;var a,o=Jm,u=o.length,f,_="value"in Eo?Eo.value:Eo.textContent,R=_.length;for(a=0;a<u&&o[a]===_[a];a++);var k=u-a;for(f=1;f<=k&&o[u-f]===_[R-f];f++);return Wh=_.slice(a,1<f?1-f:void 0)}function qu(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Kh(){return!0}function NS(){return!1}function Ar(a){function o(u,f,_,R,k){this._reactName=u,this._targetInst=_,this.type=f,this.nativeEvent=R,this.target=k,this.currentTarget=null;for(var B in a)a.hasOwnProperty(B)&&(u=a[B],this[B]=u?u(R):R[B]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?Kh:NS,this.isPropagationStopped=NS,this}return Z(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Kh)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Kh)},persist:function(){},isPersistent:Kh}),o}var br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dr=Ar(br),Al=Z({},br,{view:0,detail:0}),DC=Ar(Al),Qm,Zm,yi,Yh=Z({},Al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:rE,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==yi&&(yi&&a.type==="mousemove"?(Qm=a.screenX-yi.screenX,Zm=a.screenY-yi.screenY):Zm=Qm=0,yi=a),Qm)},movementY:function(a){return"movementY"in a?a.movementY:Zm}}),DS=Ar(Yh),LC=Z({},Yh,{dataTransfer:0}),zh=Ar(LC),LS=Z({},Al,{relatedTarget:0}),$m=Ar(LS),tE=Z({},br,{animationName:0,elapsedTime:0,pseudoElement:0}),PC=Ar(tE),eE=Z({},br,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),nE=Ar(eE),iE=Z({},br,{data:0}),PS=Ar(iE),kC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_o={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MC(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=qh[a])?!!o[a]:!1}function rE(){return MC}var UC=Z({},Al,{key:function(a){if(a.key){var o=kC[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=qu(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?_o[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:rE,charCode:function(a){return a.type==="keypress"?qu(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?qu(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),xC=Ar(UC),VC=Z({},Yh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cc=Ar(VC),BC=Z({},Al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:rE}),bl=Ar(BC),kS=Z({},br,{propertyName:0,elapsedTime:0,pseudoElement:0}),FC=Ar(kS),De=Z({},Yh,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),jC=Ar(De),GC=Z({},br,{newState:0,oldState:0}),HC=Ar(GC),WC=[9,13,27,32],Xu=As&&"CompositionEvent"in window,Ju=null;As&&"documentMode"in document&&(Ju=document.documentMode);var KC=As&&"TextEvent"in window&&!Ju,MS=As&&(!Xu||Ju&&8<Ju&&11>=Ju),Xh=" ",US=!1;function xS(a,o){switch(a){case"keyup":return WC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function aE(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Il=!1;function Is(a,o){switch(a){case"compositionend":return aE(o);case"keypress":return o.which!==32?null:(US=!0,Xh);case"textInput":return a=o.data,a===Xh&&US?null:a;default:return null}}function YC(a,o){if(Il)return a==="compositionend"||!Xu&&xS(a,o)?(a=wS(),Wh=Jm=Eo=null,Il=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return MS&&o.locale!=="ko"?null:o.data;default:return null}}var zC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function VS(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!zC[a.type]:o==="textarea"}function sE(a,o,u,f){yl?Cl?Cl.push(f):Cl=[f]:yl=f,o=hf(o,"onChange"),0<o.length&&(u=new dr("onChange","change",null,u,f),a.push({event:u,listeners:o}))}var Ac=null,Qu=null;function qC(a){ER(a,0)}function hr(a){var o=Wu(a);if(vS(o))return a}function BS(a,o){if(a==="change")return o}var FS=!1;if(As){var oE;if(As){var cE="oninput"in document;if(!cE){var lE=document.createElement("div");lE.setAttribute("oninput","return;"),cE=typeof lE.oninput=="function"}oE=cE}else oE=!1;FS=oE&&(!document.documentMode||9<document.documentMode)}function jS(){Ac&&(Ac.detachEvent("onpropertychange",GS),Qu=Ac=null)}function GS(a){if(a.propertyName==="value"&&hr(Qu)){var o=[];sE(o,Qu,a,Ym(a)),qm(qC,o)}}function HS(a,o,u){a==="focusin"?(jS(),Ac=o,Qu=u,Ac.attachEvent("onpropertychange",GS)):a==="focusout"&&jS()}function uE(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return hr(Qu)}function XC(a,o){if(a==="click")return hr(o)}function JC(a,o){if(a==="input"||a==="change")return hr(o)}function Jh(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Yr=typeof Object.is=="function"?Object.is:Jh;function Zu(a,o){if(Yr(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),f=Object.keys(o);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var _=u[f];if(!ho.call(o,_)||!Yr(a[_],o[_]))return!1}return!0}function WS(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Ra(a,o){var u=WS(a);a=0;for(var f;u;){if(u.nodeType===3){if(f=a+u.textContent.length,a<=o&&f>=o)return{node:u,offset:o-a};a=f}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=WS(u)}}function KS(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?KS(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function YS(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Ku(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Ku(a.document)}return o}function pr(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var QC=As&&"documentMode"in document&&11>=document.documentMode,Ol=null,dE=null,$u=null,Qh=!1;function zS(a,o,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Qh||Ol==null||Ol!==Ku(f)||(f=Ol,"selectionStart"in f&&pr(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),$u&&Zu($u,f)||($u=f,f=hf(dE,"onSelect"),0<f.length&&(o=new dr("onSelect","select",null,o,u),a.push({event:o,listeners:f}),o.target=Ol)))}function bc(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var wl={animationend:bc("Animation","AnimationEnd"),animationiteration:bc("Animation","AnimationIteration"),animationstart:bc("Animation","AnimationStart"),transitionrun:bc("Transition","TransitionRun"),transitionstart:bc("Transition","TransitionStart"),transitioncancel:bc("Transition","TransitionCancel"),transitionend:bc("Transition","TransitionEnd")},Zh={},qS={};As&&(qS=document.createElement("div").style,"AnimationEvent"in window||(delete wl.animationend.animation,delete wl.animationiteration.animation,delete wl.animationstart.animation),"TransitionEvent"in window||delete wl.transitionend.transition);function Ic(a){if(Zh[a])return Zh[a];if(!wl[a])return a;var o=wl[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in qS)return Zh[a]=o[u];return a}var $h=Ic("animationend"),tp=Ic("animationiteration"),XS=Ic("animationstart"),Et=Ic("transitionrun"),ZC=Ic("transitionstart"),$C=Ic("transitioncancel"),JS=Ic("transitionend"),QS=new Map,hE="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");hE.push("scrollEnd");function va(a,o){QS.set(a,o),vc(o,[a])}var ZS=new WeakMap;function na(a,o){if(typeof a=="object"&&a!==null){var u=ZS.get(a);return u!==void 0?u:(o={value:a,source:o,stack:RS(o)},ZS.set(a,o),o)}return{value:a,source:o,stack:RS(o)}}var fr=[],ya=0,pE=0;function ep(){for(var a=ya,o=pE=ya=0;o<a;){var u=fr[o];fr[o++]=null;var f=fr[o];fr[o++]=null;var _=fr[o];fr[o++]=null;var R=fr[o];if(fr[o++]=null,f!==null&&_!==null){var k=f.pending;k===null?_.next=_:(_.next=k.next,k.next=_),f.pending=_}R!==0&&$S(u,_,R)}}function np(a,o,u,f){fr[ya++]=a,fr[ya++]=o,fr[ya++]=u,fr[ya++]=f,pE|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function fE(a,o,u,f){return np(a,o,u,f),td(a)}function go(a,o){return np(a,null,null,o),td(a)}function $S(a,o,u){a.lanes|=u;var f=a.alternate;f!==null&&(f.lanes|=u);for(var _=!1,R=a.return;R!==null;)R.childLanes|=u,f=R.alternate,f!==null&&(f.childLanes|=u),R.tag===22&&(a=R.stateNode,a===null||a._visibility&1||(_=!0)),a=R,R=R.return;return a.tag===3?(R=a.stateNode,_&&o!==null&&(_=31-yr(u),a=R.hiddenUpdates,f=a[_],f===null?a[_]=[o]:f.push(o),o.lane=u|536870912),R):null}function td(a){if(50<is)throw is=0,Hs=null,Error(b(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var er={};function tA(a,o,u,f){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yi(a,o,u,f){return new tA(a,o,u,f)}function mE(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Os(a,o){var u=a.alternate;return u===null?(u=Yi(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function tT(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function ed(a,o,u,f,_,R){var k=0;if(f=a,typeof a=="function")mE(a)&&(k=1);else if(typeof a=="string")k=kA(a,u,ne.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case An:return a=Yi(31,u,o,_),a.elementType=An,a.lanes=R,a;case it:return Oc(u.children,_,R,o);case xt:k=8,_|=24;break;case yt:return a=Yi(12,u,o,_|2),a.elementType=yt,a.lanes=R,a;case te:return a=Yi(13,u,o,_),a.elementType=te,a.lanes=R,a;case fn:return a=Yi(19,u,o,_),a.elementType=fn,a.lanes=R,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Pt:case Ft:k=10;break t;case Gt:k=9;break t;case ye:k=11;break t;case Ne:k=14;break t;case Cn:k=16,f=null;break t}k=29,u=Error(b(130,a===null?"null":typeof a,"")),f=null}return o=Yi(k,u,o,_),o.elementType=a,o.type=f,o.lanes=R,o}function Oc(a,o,u,f){return a=Yi(7,a,f,o),a.lanes=u,a}function EE(a,o,u){return a=Yi(6,a,null,o),a.lanes=u,a}function _E(a,o,u){return o=Yi(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var So=[],Nl=0,nd=null,id=0,ia=[],zr=0,qa=null,ws=1,Ns="";function wc(a,o){So[Nl++]=id,So[Nl++]=nd,nd=a,id=o}function eT(a,o,u){ia[zr++]=ws,ia[zr++]=Ns,ia[zr++]=qa,qa=a;var f=ws;a=Ns;var _=32-yr(f)-1;f&=~(1<<_),u+=1;var R=32-yr(o)+_;if(30<R){var k=_-_%5;R=(f&(1<<k)-1).toString(32),f>>=k,_-=k,ws=1<<32-yr(o)+_|u<<_|f,Ns=R+a}else ws=1<<R|u<<_|f,Ns=a}function gE(a){a.return!==null&&(wc(a,1),eT(a,1,0))}function ip(a){for(;a===nd;)nd=So[--Nl],So[Nl]=null,id=So[--Nl],So[Nl]=null;for(;a===qa;)qa=ia[--zr],ia[zr]=null,Ns=ia[--zr],ia[zr]=null,ws=ia[--zr],ia[zr]=null}var zi=null,oi=null,on=!1,Nc=null,Xa=!1,SE=Error(b(519));function Dc(a){var o=Error(b(418,""));throw To(na(o,a)),SE}function nT(a){var o=a.stateNode,u=a.type,f=a.memoizedProps;switch(o[In]=a,o[Cr]=f,u){case"dialog":He("cancel",o),He("close",o);break;case"iframe":case"object":case"embed":He("load",o);break;case"video":case"audio":for(u=0;u<nu.length;u++)He(nu[u],o);break;case"source":He("error",o);break;case"img":case"image":case"link":He("error",o),He("load",o);break;case"details":He("toggle",o);break;case"input":He("invalid",o),CS(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),dn(o);break;case"select":He("invalid",o);break;case"textarea":He("invalid",o),Yu(o,f.value,f.defaultValue,f.children),dn(o)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||f.suppressHydrationWarning===!0||SR(o.textContent,u)?(f.popover!=null&&(He("beforetoggle",o),He("toggle",o)),f.onScroll!=null&&He("scroll",o),f.onScrollEnd!=null&&He("scrollend",o),f.onClick!=null&&(o.onclick=ff),o=!0):o=!1,o||Dc(a)}function iT(a){for(zi=a.return;zi;)switch(zi.tag){case 5:case 13:Xa=!1;return;case 27:case 3:Xa=!0;return;default:zi=zi.return}}function rd(a){if(a!==zi)return!1;if(!on)return iT(a),on=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||O_(a.type,a.memoizedProps)),u=!u),u&&oi&&Dc(a),iT(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(b(317));t:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(o===0){oi=La(a.nextSibling);break t}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;a=a.nextSibling}oi=null}}else o===27?(o=oi,Ho(a.type)?(a=P_,P_=null,oi=a):oi=o):oi=zi?La(a.stateNode.nextSibling):null;return!0}function ad(){oi=zi=null,on=!1}function rT(){var a=Nc;return a!==null&&(Nr===null?Nr=a:Nr.push.apply(Nr,a),Nc=null),a}function To(a){Nc===null?Nc=[a]:Nc.push(a)}var Dl=Ut(null),Ds=null,Ls=null;function Ro(a,o,u){qt(Dl,o._currentValue),o._currentValue=u}function Ps(a){a._currentValue=Dl.current,Zt(Dl)}function rp(a,o,u){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===u)break;a=a.return}}function ap(a,o,u,f){var _=a.child;for(_!==null&&(_.return=a);_!==null;){var R=_.dependencies;if(R!==null){var k=_.child;R=R.firstContext;t:for(;R!==null;){var B=R;R=_;for(var q=0;q<o.length;q++)if(B.context===o[q]){R.lanes|=u,B=R.alternate,B!==null&&(B.lanes|=u),rp(R.return,u,a),f||(k=null);break t}R=B.next}}else if(_.tag===18){if(k=_.return,k===null)throw Error(b(341));k.lanes|=u,R=k.alternate,R!==null&&(R.lanes|=u),rp(k,u,a),k=null}else k=_.child;if(k!==null)k.return=_;else for(k=_;k!==null;){if(k===a){k=null;break}if(_=k.sibling,_!==null){_.return=k.return,k=_;break}k=k.return}_=k}}function Lc(a,o,u,f){a=null;for(var _=o,R=!1;_!==null;){if(!R){if((_.flags&524288)!==0)R=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var k=_.alternate;if(k===null)throw Error(b(387));if(k=k.memoizedProps,k!==null){var B=_.type;Yr(_.pendingProps.value,k.value)||(a!==null?a.push(B):a=[B])}}else if(_===Hr.current){if(k=_.alternate,k===null)throw Error(b(387));k.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(a!==null?a.push(cu):a=[cu])}_=_.return}a!==null&&ap(o,a,u,f),o.flags|=262144}function sp(a){for(a=a.firstContext;a!==null;){if(!Yr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Pc(a){Ds=a,Ls=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Ci(a){return aT(Ds,a)}function op(a,o){return Ds===null&&Pc(a),aT(a,o)}function aT(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},Ls===null){if(a===null)throw Error(b(308));Ls=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else Ls=Ls.next=o;return u}var eA=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,f){a.push(f)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},nA=S.unstable_scheduleCallback,iA=S.unstable_NormalPriority,Li={$$typeof:Ft,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function cp(){return{controller:new eA,data:new Map,refCount:0}}function sd(a){a.refCount--,a.refCount===0&&nA(iA,function(){a.controller.abort()})}var od=null,TE=0,vo=0,Ll=null;function rA(a,o){if(od===null){var u=od=[];TE=0,vo=xd(),Ll={status:"pending",value:void 0,then:function(f){u.push(f)}}}return TE++,o.then(cd,cd),o}function cd(){if(--TE===0&&od!==null){Ll!==null&&(Ll.status="fulfilled");var a=od;od=null,vo=0,Ll=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function aA(a,o){var u=[],f={status:"pending",value:null,reason:null,then:function(_){u.push(_)}};return a.then(function(){f.status="fulfilled",f.value=o;for(var _=0;_<u.length;_++)(0,u[_])(o)},function(_){for(f.status="rejected",f.reason=_,_=0;_<u.length;_++)(0,u[_])(void 0)}),f}var sT=Rt.S;Rt.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&rA(a,o),sT!==null&&sT(a,o)};var kc=Ut(null);function RE(){var a=kc.current;return a!==null?a:Mn.pooledCache}function lp(a,o){o===null?qt(kc,kc.current):qt(kc,o.pool)}function oT(){var a=RE();return a===null?null:{parent:Li._currentValue,pool:a}}var yo=Error(b(460)),vE=Error(b(474)),up=Error(b(542)),yE={then:function(){}};function CE(a){return a=a.status,a==="fulfilled"||a==="rejected"}function dp(){}function cT(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(dp,dp),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,pp(a),a;default:if(typeof o.status=="string")o.then(dp,dp);else{if(a=Mn,a!==null&&100<a.shellSuspendCounter)throw Error(b(482));a=o,a.status="pending",a.then(function(f){if(o.status==="pending"){var _=o;_.status="fulfilled",_.value=f}},function(f){if(o.status==="pending"){var _=o;_.status="rejected",_.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,pp(a),a}throw ld=o,yo}}var ld=null;function hp(){if(ld===null)throw Error(b(459));var a=ld;return ld=null,a}function pp(a){if(a===yo||a===up)throw Error(b(483))}var ks=!1;function ud(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fp(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Ms(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ca(a,o,u){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,(Rn&2)!==0){var _=f.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),f.pending=o,o=td(a),$S(a,null,u),o}return np(a,f,o,u),td(a)}function Us(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,El(a,u)}}function AE(a,o){var u=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var _=null,R=null;if(u=u.firstBaseUpdate,u!==null){do{var k={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};R===null?_=R=k:R=R.next=k,u=u.next}while(u!==null);R===null?_=R=o:R=R.next=o}else _=R=o;u={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:R,shared:f.shared,callbacks:f.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var bE=!1;function Pl(){if(bE){var a=Ll;if(a!==null)throw a}}function dd(a,o,u,f){bE=!1;var _=a.updateQueue;ks=!1;var R=_.firstBaseUpdate,k=_.lastBaseUpdate,B=_.shared.pending;if(B!==null){_.shared.pending=null;var q=B,ut=q.next;q.next=null,k===null?R=ut:k.next=ut,k=q;var _t=a.alternate;_t!==null&&(_t=_t.updateQueue,B=_t.lastBaseUpdate,B!==k&&(B===null?_t.firstBaseUpdate=ut:B.next=ut,_t.lastBaseUpdate=q))}if(R!==null){var Dt=_.baseState;k=0,_t=ut=q=null,B=R;do{var ht=B.lane&-536870913,pt=ht!==B.lane;if(pt?($e&ht)===ht:(f&ht)===ht){ht!==0&&ht===vo&&(bE=!0),_t!==null&&(_t=_t.next={lane:0,tag:B.tag,payload:B.payload,callback:null,next:null});t:{var ve=a,ae=B;ht=o;var wn=u;switch(ae.tag){case 1:if(ve=ae.payload,typeof ve=="function"){Dt=ve.call(wn,Dt,ht);break t}Dt=ve;break t;case 3:ve.flags=ve.flags&-65537|128;case 0:if(ve=ae.payload,ht=typeof ve=="function"?ve.call(wn,Dt,ht):ve,ht==null)break t;Dt=Z({},Dt,ht);break t;case 2:ks=!0}}ht=B.callback,ht!==null&&(a.flags|=64,pt&&(a.flags|=8192),pt=_.callbacks,pt===null?_.callbacks=[ht]:pt.push(ht))}else pt={lane:ht,tag:B.tag,payload:B.payload,callback:B.callback,next:null},_t===null?(ut=_t=pt,q=Dt):_t=_t.next=pt,k|=ht;if(B=B.next,B===null){if(B=_.shared.pending,B===null)break;pt=B,B=pt.next,pt.next=null,_.lastBaseUpdate=pt,_.shared.pending=null}}while(!0);_t===null&&(q=Dt),_.baseState=q,_.firstBaseUpdate=ut,_.lastBaseUpdate=_t,R===null&&(_.shared.lanes=0),xo|=k,a.lanes=k,a.memoizedState=Dt}}function lT(a,o){if(typeof a!="function")throw Error(b(191,a));a.call(o)}function IE(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)lT(u[a],o)}var kl=Ut(null),mp=Ut(0);function uT(a,o){a=ns,qt(mp,a),qt(kl,o),ns=a|o.baseLanes}function OE(){qt(mp,ns),qt(kl,kl.current)}function wE(){ns=mp.current,Zt(kl),Zt(mp)}var Co=0,Me=null,rn=null,Ai=null,Ep=!1,Ml=!1,Ao=!1,_p=0,Ul=0,xl=null,sA=0;function fi(){throw Error(b(321))}function Vl(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!Yr(a[u],o[u]))return!1;return!0}function NE(a,o,u,f,_,R){return Co=R,Me=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Rt.H=a===null||a.memoizedState===null?XE:bT,Ao=!1,R=u(f,_),Ao=!1,Ml&&(R=hT(o,u,f,_)),dT(a),R}function dT(a){Rt.H=gd;var o=rn!==null&&rn.next!==null;if(Co=0,Ai=rn=Me=null,Ep=!1,Ul=0,xl=null,o)throw Error(b(300));a===null||ki||(a=a.dependencies,a!==null&&sp(a)&&(ki=!0))}function hT(a,o,u,f){Me=a;var _=0;do{if(Ml&&(xl=null),Ul=0,Ml=!1,25<=_)throw Error(b(301));if(_+=1,Ai=rn=null,a.updateQueue!=null){var R=a.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}Rt.H=bo,R=o(u,f)}while(Ml);return R}function oA(){var a=Rt.H,o=a.useState()[0];return o=typeof o.then=="function"?Bl(o):o,a=a.useState()[0],(rn!==null?rn.memoizedState:null)!==a&&(Me.flags|=1024),o}function DE(){var a=_p!==0;return _p=0,a}function LE(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function hd(a){if(Ep){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Ep=!1}Co=0,Ai=rn=Me=null,Ml=!1,Ul=_p=0,xl=null}function Ir(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ai===null?Me.memoizedState=Ai=a:Ai=Ai.next=a,Ai}function mi(){if(rn===null){var a=Me.alternate;a=a!==null?a.memoizedState:null}else a=rn.next;var o=Ai===null?Me.memoizedState:Ai.next;if(o!==null)Ai=o,rn=a;else{if(a===null)throw Me.alternate===null?Error(b(467)):Error(b(310));rn=a,a={memoizedState:rn.memoizedState,baseState:rn.baseState,baseQueue:rn.baseQueue,queue:rn.queue,next:null},Ai===null?Me.memoizedState=Ai=a:Ai=Ai.next=a}return Ai}function PE(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Bl(a){var o=Ul;return Ul+=1,xl===null&&(xl=[]),a=cT(xl,a,o),o=Me,(Ai===null?o.memoizedState:Ai.next)===null&&(o=o.alternate,Rt.H=o===null||o.memoizedState===null?XE:bT),a}function gp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Bl(a);if(a.$$typeof===Ft)return Ci(a)}throw Error(b(438,String(a)))}function kE(a){var o=null,u=Me.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var f=Me.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(_){return _.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=PE(),Me.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),f=0;f<a;f++)u[f]=hi;return o.index++,u}function xs(a,o){return typeof o=="function"?o(a):o}function Sp(a){var o=mi();return ME(o,rn,a)}function ME(a,o,u){var f=a.queue;if(f===null)throw Error(b(311));f.lastRenderedReducer=u;var _=a.baseQueue,R=f.pending;if(R!==null){if(_!==null){var k=_.next;_.next=R.next,R.next=k}o.baseQueue=_=R,f.pending=null}if(R=a.baseState,_===null)a.memoizedState=R;else{o=_.next;var B=k=null,q=null,ut=o,_t=!1;do{var Dt=ut.lane&-536870913;if(Dt!==ut.lane?($e&Dt)===Dt:(Co&Dt)===Dt){var ht=ut.revertLane;if(ht===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),Dt===vo&&(_t=!0);else if((Co&ht)===ht){ut=ut.next,ht===vo&&(_t=!0);continue}else Dt={lane:0,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},q===null?(B=q=Dt,k=R):q=q.next=Dt,Me.lanes|=ht,xo|=ht;Dt=ut.action,Ao&&u(R,Dt),R=ut.hasEagerState?ut.eagerState:u(R,Dt)}else ht={lane:Dt,revertLane:ut.revertLane,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null},q===null?(B=q=ht,k=R):q=q.next=ht,Me.lanes|=Dt,xo|=Dt;ut=ut.next}while(ut!==null&&ut!==o);if(q===null?k=R:q.next=B,!Yr(R,a.memoizedState)&&(ki=!0,_t&&(u=Ll,u!==null)))throw u;a.memoizedState=R,a.baseState=k,a.baseQueue=q,f.lastRenderedState=R}return _===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function UE(a){var o=mi(),u=o.queue;if(u===null)throw Error(b(311));u.lastRenderedReducer=a;var f=u.dispatch,_=u.pending,R=o.memoizedState;if(_!==null){u.pending=null;var k=_=_.next;do R=a(R,k.action),k=k.next;while(k!==_);Yr(R,o.memoizedState)||(ki=!0),o.memoizedState=R,o.baseQueue===null&&(o.baseState=R),u.lastRenderedState=R}return[R,f]}function xE(a,o,u){var f=Me,_=mi(),R=on;if(R){if(u===void 0)throw Error(b(407));u=u()}else u=o();var k=!Yr((rn||_).memoizedState,u);k&&(_.memoizedState=u,ki=!0),_=_.queue;var B=VE.bind(null,f,_,a);if(Ja(2048,8,B,[a]),_.getSnapshot!==o||k||Ai!==null&&Ai.memoizedState.tag&1){if(f.flags|=2048,Gl(9,yp(),fT.bind(null,f,_,u,o),null),Mn===null)throw Error(b(349));R||(Co&124)!==0||pT(f,o,u)}return u}function pT(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=Me.updateQueue,o===null?(o=PE(),Me.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function fT(a,o,u,f){o.value=u,o.getSnapshot=f,mT(o)&&pd(a)}function VE(a,o,u){return u(function(){mT(o)&&pd(a)})}function mT(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!Yr(a,u)}catch{return!0}}function pd(a){var o=go(a,2);o!==null&&Jr(o,a,2)}function Tp(a){var o=Ir();if(typeof a=="function"){var u=a;if(a=u(),Ao){ur(!0);try{u()}finally{ur(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:a},o}function Fl(a,o,u,f){return a.baseState=u,ME(a,rn,typeof f=="function"?f:xs)}function cA(a,o,u,f,_){if(wp(a))throw Error(b(485));if(a=o.action,a!==null){var R={payload:_,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){R.listeners.push(k)}};Rt.T!==null?u(!0):R.isTransition=!1,f(R),u=o.pending,u===null?(R.next=o.pending=R,ET(o,R)):(R.next=u.next,o.pending=u.next=R)}}function ET(a,o){var u=o.action,f=o.payload,_=a.state;if(o.isTransition){var R=Rt.T,k={};Rt.T=k;try{var B=u(_,f),q=Rt.S;q!==null&&q(k,B),_T(a,o,B)}catch(ut){jl(a,o,ut)}finally{Rt.T=R}}else try{R=u(_,f),_T(a,o,R)}catch(ut){jl(a,o,ut)}}function _T(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){gT(a,o,f)},function(f){return jl(a,o,f)}):gT(a,o,u)}function gT(a,o,u){o.status="fulfilled",o.value=u,ST(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,ET(a,u)))}function jl(a,o,u){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=u,ST(o),o=o.next;while(o!==f)}a.action=null}function ST(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function BE(a,o){return o}function Rp(a,o){if(on){var u=Mn.formState;if(u!==null){t:{var f=Me;if(on){if(oi){e:{for(var _=oi,R=Xa;_.nodeType!==8;){if(!R){_=null;break e}if(_=La(_.nextSibling),_===null){_=null;break e}}R=_.data,_=R==="F!"||R==="F"?_:null}if(_){oi=La(_.nextSibling),f=_.data==="F!";break t}}Dc(f)}f=!1}f&&(o=u[0])}}return u=Ir(),u.memoizedState=u.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:BE,lastRenderedState:o},u.queue=f,u=zE.bind(null,Me,f),f.dispatch=u,f=Tp(!1),R=_d.bind(null,Me,!1,f.queue),f=Ir(),_={state:o,dispatch:null,action:a,pending:null},f.queue=_,u=cA.bind(null,Me,_,R,u),_.dispatch=u,f.memoizedState=a,[o,u,!1]}function vp(a){var o=mi();return TT(o,rn,a)}function TT(a,o,u){if(o=ME(a,o,BE)[0],a=Sp(xs)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Bl(o)}catch(k){throw k===yo?up:k}else f=o;o=mi();var _=o.queue,R=_.dispatch;return u!==o.memoizedState&&(Me.flags|=2048,Gl(9,yp(),lA.bind(null,_,u),null)),[f,R,a]}function lA(a,o){a.action=o}function RT(a){var o=mi(),u=rn;if(u!==null)return TT(o,u,a);mi(),o=o.memoizedState,u=mi();var f=u.queue.dispatch;return u.memoizedState=a,[o,f,!1]}function Gl(a,o,u,f){return a={tag:a,create:u,deps:f,inst:o,next:null},o=Me.updateQueue,o===null&&(o=PE(),Me.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(f=u.next,u.next=a,a.next=f,o.lastEffect=a),a}function yp(){return{destroy:void 0,resource:void 0}}function fd(){return mi().memoizedState}function Cp(a,o,u,f){var _=Ir();f=f===void 0?null:f,Me.flags|=a,_.memoizedState=Gl(1|o,yp(),u,f)}function Ja(a,o,u,f){var _=mi();f=f===void 0?null:f;var R=_.memoizedState.inst;rn!==null&&f!==null&&Vl(f,rn.memoizedState.deps)?_.memoizedState=Gl(o,R,u,f):(Me.flags|=a,_.memoizedState=Gl(1|o,R,u,f))}function Ap(a,o){Cp(8390656,8,a,o)}function md(a,o){Ja(2048,8,a,o)}function Hl(a,o){return Ja(4,2,a,o)}function Ed(a,o){return Ja(4,4,a,o)}function vT(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function FE(a,o,u){u=u!=null?u.concat([a]):null,Ja(4,4,vT.bind(null,o,a),u)}function jE(){}function GE(a,o){var u=mi();o=o===void 0?null:o;var f=u.memoizedState;return o!==null&&Vl(o,f[1])?f[0]:(u.memoizedState=[a,o],a)}function yT(a,o){var u=mi();o=o===void 0?null:o;var f=u.memoizedState;if(o!==null&&Vl(o,f[1]))return f[0];if(f=a(),Ao){ur(!0);try{a()}finally{ur(!1)}}return u.memoizedState=[f,o],f}function HE(a,o,u){return u===void 0||(Co&1073741824)!==0?a.memoizedState=o:(a.memoizedState=u,a=tR(),Me.lanes|=a,xo|=a,u)}function bp(a,o,u,f){return Yr(u,o)?u:kl.current!==null?(a=HE(a,u,f),Yr(a,o)||(ki=!0),a):(Co&42)===0?(ki=!0,a.memoizedState=u):(a=tR(),Me.lanes|=a,xo|=a,o)}function Ip(a,o,u,f,_){var R=Jt.p;Jt.p=R!==0&&8>R?R:8;var k=Rt.T,B={};Rt.T=B,_d(a,!1,o,u);try{var q=_(),ut=Rt.S;if(ut!==null&&ut(B,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var _t=aA(q,f);ba(a,o,_t,Dr(a))}else ba(a,o,f,Dr(a))}catch(Dt){ba(a,o,{then:function(){},status:"rejected",reason:Dt},Dr())}finally{Jt.p=R,Rt.T=k}}function uA(){}function WE(a,o,u,f){if(a.tag!==5)throw Error(b(476));var _=KE(a).queue;Ip(a,_,o,de,u===null?uA:function(){return Op(a),u(f)})}function KE(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:de},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function Op(a){var o=KE(a).next.queue;ba(a,o,{},Dr())}function YE(){return Ci(cu)}function Aa(){return mi().memoizedState}function Mc(){return mi().memoizedState}function Uc(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=Dr();a=Ms(u);var f=Ca(o,a,u);f!==null&&(Jr(f,o,u),Us(f,o,u)),o={cache:cp()},a.payload=o;return}o=o.return}}function CT(a,o,u){var f=Dr();u={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},wp(a)?qE(o,u):(u=fE(a,o,u,f),u!==null&&(Jr(u,a,f),AT(u,o,f)))}function zE(a,o,u){var f=Dr();ba(a,o,u,f)}function ba(a,o,u,f){var _={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(wp(a))qE(o,_);else{var R=a.alternate;if(a.lanes===0&&(R===null||R.lanes===0)&&(R=o.lastRenderedReducer,R!==null))try{var k=o.lastRenderedState,B=R(k,u);if(_.hasEagerState=!0,_.eagerState=B,Yr(B,k))return np(a,o,_,0),Mn===null&&ep(),!1}catch{}finally{}if(u=fE(a,o,_,f),u!==null)return Jr(u,a,f),AT(u,o,f),!0}return!1}function _d(a,o,u,f){if(f={lane:2,revertLane:xd(),action:f,hasEagerState:!1,eagerState:null,next:null},wp(a)){if(o)throw Error(b(479))}else o=fE(a,u,f,2),o!==null&&Jr(o,a,2)}function wp(a){var o=a.alternate;return a===Me||o!==null&&o===Me}function qE(a,o){Ml=Ep=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function AT(a,o,u){if((u&4194048)!==0){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,El(a,u)}}var gd={readContext:Ci,use:gp,useCallback:fi,useContext:fi,useEffect:fi,useImperativeHandle:fi,useLayoutEffect:fi,useInsertionEffect:fi,useMemo:fi,useReducer:fi,useRef:fi,useState:fi,useDebugValue:fi,useDeferredValue:fi,useTransition:fi,useSyncExternalStore:fi,useId:fi,useHostTransitionStatus:fi,useFormState:fi,useActionState:fi,useOptimistic:fi,useMemoCache:fi,useCacheRefresh:fi},XE={readContext:Ci,use:gp,useCallback:function(a,o){return Ir().memoizedState=[a,o===void 0?null:o],a},useContext:Ci,useEffect:Ap,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,Cp(4194308,4,vT.bind(null,o,a),u)},useLayoutEffect:function(a,o){return Cp(4194308,4,a,o)},useInsertionEffect:function(a,o){Cp(4,2,a,o)},useMemo:function(a,o){var u=Ir();o=o===void 0?null:o;var f=a();if(Ao){ur(!0);try{a()}finally{ur(!1)}}return u.memoizedState=[f,o],f},useReducer:function(a,o,u){var f=Ir();if(u!==void 0){var _=u(o);if(Ao){ur(!0);try{u(o)}finally{ur(!1)}}}else _=o;return f.memoizedState=f.baseState=_,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:_},f.queue=a,a=a.dispatch=CT.bind(null,Me,a),[f.memoizedState,a]},useRef:function(a){var o=Ir();return a={current:a},o.memoizedState=a},useState:function(a){a=Tp(a);var o=a.queue,u=zE.bind(null,Me,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:jE,useDeferredValue:function(a,o){var u=Ir();return HE(u,a,o)},useTransition:function(){var a=Tp(!1);return a=Ip.bind(null,Me,a.queue,!0,!1),Ir().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var f=Me,_=Ir();if(on){if(u===void 0)throw Error(b(407));u=u()}else{if(u=o(),Mn===null)throw Error(b(349));($e&124)!==0||pT(f,o,u)}_.memoizedState=u;var R={value:u,getSnapshot:o};return _.queue=R,Ap(VE.bind(null,f,R,a),[a]),f.flags|=2048,Gl(9,yp(),fT.bind(null,f,R,u,o),null),u},useId:function(){var a=Ir(),o=Mn.identifierPrefix;if(on){var u=Ns,f=ws;u=(f&~(1<<32-yr(f)-1)).toString(32)+u,o="«"+o+"R"+u,u=_p++,0<u&&(o+="H"+u.toString(32)),o+="»"}else u=sA++,o="«"+o+"r"+u.toString(32)+"»";return a.memoizedState=o},useHostTransitionStatus:YE,useFormState:Rp,useActionState:Rp,useOptimistic:function(a){var o=Ir();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=_d.bind(null,Me,!0,u),u.dispatch=o,[a,o]},useMemoCache:kE,useCacheRefresh:function(){return Ir().memoizedState=Uc.bind(null,Me)}},bT={readContext:Ci,use:gp,useCallback:GE,useContext:Ci,useEffect:md,useImperativeHandle:FE,useInsertionEffect:Hl,useLayoutEffect:Ed,useMemo:yT,useReducer:Sp,useRef:fd,useState:function(){return Sp(xs)},useDebugValue:jE,useDeferredValue:function(a,o){var u=mi();return bp(u,rn.memoizedState,a,o)},useTransition:function(){var a=Sp(xs)[0],o=mi().memoizedState;return[typeof a=="boolean"?a:Bl(a),o]},useSyncExternalStore:xE,useId:Aa,useHostTransitionStatus:YE,useFormState:vp,useActionState:vp,useOptimistic:function(a,o){var u=mi();return Fl(u,rn,a,o)},useMemoCache:kE,useCacheRefresh:Mc},bo={readContext:Ci,use:gp,useCallback:GE,useContext:Ci,useEffect:md,useImperativeHandle:FE,useInsertionEffect:Hl,useLayoutEffect:Ed,useMemo:yT,useReducer:UE,useRef:fd,useState:function(){return UE(xs)},useDebugValue:jE,useDeferredValue:function(a,o){var u=mi();return rn===null?HE(u,a,o):bp(u,rn.memoizedState,a,o)},useTransition:function(){var a=UE(xs)[0],o=mi().memoizedState;return[typeof a=="boolean"?a:Bl(a),o]},useSyncExternalStore:xE,useId:Aa,useHostTransitionStatus:YE,useFormState:RT,useActionState:RT,useOptimistic:function(a,o){var u=mi();return rn!==null?Fl(u,rn,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:kE,useCacheRefresh:Mc},Wl=null,Sd=0;function Np(a){var o=Sd;return Sd+=1,Wl===null&&(Wl=[]),cT(Wl,a,o)}function Td(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Rd(a,o){throw o.$$typeof===st?Error(b(525)):(a=Object.prototype.toString.call(o),Error(b(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function IT(a){var o=a._init;return o(a._payload)}function Dp(a){function o(rt,et){if(a){var lt=rt.deletions;lt===null?(rt.deletions=[et],rt.flags|=16):lt.push(et)}}function u(rt,et){if(!a)return null;for(;et!==null;)o(rt,et),et=et.sibling;return null}function f(rt){for(var et=new Map;rt!==null;)rt.key!==null?et.set(rt.key,rt):et.set(rt.index,rt),rt=rt.sibling;return et}function _(rt,et){return rt=Os(rt,et),rt.index=0,rt.sibling=null,rt}function R(rt,et,lt){return rt.index=lt,a?(lt=rt.alternate,lt!==null?(lt=lt.index,lt<et?(rt.flags|=67108866,et):lt):(rt.flags|=67108866,et)):(rt.flags|=1048576,et)}function k(rt){return a&&rt.alternate===null&&(rt.flags|=67108866),rt}function B(rt,et,lt,Ot){return et===null||et.tag!==6?(et=EE(lt,rt.mode,Ot),et.return=rt,et):(et=_(et,lt),et.return=rt,et)}function q(rt,et,lt,Ot){var Yt=lt.type;return Yt===it?_t(rt,et,lt.props.children,Ot,lt.key):et!==null&&(et.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===Cn&&IT(Yt)===et.type)?(et=_(et,lt.props),Td(et,lt),et.return=rt,et):(et=ed(lt.type,lt.key,lt.props,null,rt.mode,Ot),Td(et,lt),et.return=rt,et)}function ut(rt,et,lt,Ot){return et===null||et.tag!==4||et.stateNode.containerInfo!==lt.containerInfo||et.stateNode.implementation!==lt.implementation?(et=_E(lt,rt.mode,Ot),et.return=rt,et):(et=_(et,lt.children||[]),et.return=rt,et)}function _t(rt,et,lt,Ot,Yt){return et===null||et.tag!==7?(et=Oc(lt,rt.mode,Ot,Yt),et.return=rt,et):(et=_(et,lt),et.return=rt,et)}function Dt(rt,et,lt){if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return et=EE(""+et,rt.mode,lt),et.return=rt,et;if(typeof et=="object"&&et!==null){switch(et.$$typeof){case mt:return lt=ed(et.type,et.key,et.props,null,rt.mode,lt),Td(lt,et),lt.return=rt,lt;case Vt:return et=_E(et,rt.mode,lt),et.return=rt,et;case Cn:var Ot=et._init;return et=Ot(et._payload),Dt(rt,et,lt)}if(Ri(et)||Yn(et))return et=Oc(et,rt.mode,lt,null),et.return=rt,et;if(typeof et.then=="function")return Dt(rt,Np(et),lt);if(et.$$typeof===Ft)return Dt(rt,op(rt,et),lt);Rd(rt,et)}return null}function ht(rt,et,lt,Ot){var Yt=et!==null?et.key:null;if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return Yt!==null?null:B(rt,et,""+lt,Ot);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case mt:return lt.key===Yt?q(rt,et,lt,Ot):null;case Vt:return lt.key===Yt?ut(rt,et,lt,Ot):null;case Cn:return Yt=lt._init,lt=Yt(lt._payload),ht(rt,et,lt,Ot)}if(Ri(lt)||Yn(lt))return Yt!==null?null:_t(rt,et,lt,Ot,null);if(typeof lt.then=="function")return ht(rt,et,Np(lt),Ot);if(lt.$$typeof===Ft)return ht(rt,et,op(rt,lt),Ot);Rd(rt,lt)}return null}function pt(rt,et,lt,Ot,Yt){if(typeof Ot=="string"&&Ot!==""||typeof Ot=="number"||typeof Ot=="bigint")return rt=rt.get(lt)||null,B(et,rt,""+Ot,Yt);if(typeof Ot=="object"&&Ot!==null){switch(Ot.$$typeof){case mt:return rt=rt.get(Ot.key===null?lt:Ot.key)||null,q(et,rt,Ot,Yt);case Vt:return rt=rt.get(Ot.key===null?lt:Ot.key)||null,ut(et,rt,Ot,Yt);case Cn:var We=Ot._init;return Ot=We(Ot._payload),pt(rt,et,lt,Ot,Yt)}if(Ri(Ot)||Yn(Ot))return rt=rt.get(lt)||null,_t(et,rt,Ot,Yt,null);if(typeof Ot.then=="function")return pt(rt,et,lt,Np(Ot),Yt);if(Ot.$$typeof===Ft)return pt(rt,et,lt,op(et,Ot),Yt);Rd(et,Ot)}return null}function ve(rt,et,lt,Ot){for(var Yt=null,We=null,ie=et,he=et=0,Mi=null;ie!==null&&he<lt.length;he++){ie.index>he?(Mi=ie,ie=null):Mi=ie.sibling;var tn=ht(rt,ie,lt[he],Ot);if(tn===null){ie===null&&(ie=Mi);break}a&&ie&&tn.alternate===null&&o(rt,ie),et=R(tn,et,he),We===null?Yt=tn:We.sibling=tn,We=tn,ie=Mi}if(he===lt.length)return u(rt,ie),on&&wc(rt,he),Yt;if(ie===null){for(;he<lt.length;he++)ie=Dt(rt,lt[he],Ot),ie!==null&&(et=R(ie,et,he),We===null?Yt=ie:We.sibling=ie,We=ie);return on&&wc(rt,he),Yt}for(ie=f(ie);he<lt.length;he++)Mi=pt(ie,rt,he,lt[he],Ot),Mi!==null&&(a&&Mi.alternate!==null&&ie.delete(Mi.key===null?he:Mi.key),et=R(Mi,et,he),We===null?Yt=Mi:We.sibling=Mi,We=Mi);return a&&ie.forEach(function(sa){return o(rt,sa)}),on&&wc(rt,he),Yt}function ae(rt,et,lt,Ot){if(lt==null)throw Error(b(151));for(var Yt=null,We=null,ie=et,he=et=0,Mi=null,tn=lt.next();ie!==null&&!tn.done;he++,tn=lt.next()){ie.index>he?(Mi=ie,ie=null):Mi=ie.sibling;var sa=ht(rt,ie,tn.value,Ot);if(sa===null){ie===null&&(ie=Mi);break}a&&ie&&sa.alternate===null&&o(rt,ie),et=R(sa,et,he),We===null?Yt=sa:We.sibling=sa,We=sa,ie=Mi}if(tn.done)return u(rt,ie),on&&wc(rt,he),Yt;if(ie===null){for(;!tn.done;he++,tn=lt.next())tn=Dt(rt,tn.value,Ot),tn!==null&&(et=R(tn,et,he),We===null?Yt=tn:We.sibling=tn,We=tn);return on&&wc(rt,he),Yt}for(ie=f(ie);!tn.done;he++,tn=lt.next())tn=pt(ie,rt,he,tn.value,Ot),tn!==null&&(a&&tn.alternate!==null&&ie.delete(tn.key===null?he:tn.key),et=R(tn,et,he),We===null?Yt=tn:We.sibling=tn,We=tn);return a&&ie.forEach(function(W_){return o(rt,W_)}),on&&wc(rt,he),Yt}function wn(rt,et,lt,Ot){if(typeof lt=="object"&&lt!==null&&lt.type===it&&lt.key===null&&(lt=lt.props.children),typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case mt:t:{for(var Yt=lt.key;et!==null;){if(et.key===Yt){if(Yt=lt.type,Yt===it){if(et.tag===7){u(rt,et.sibling),Ot=_(et,lt.props.children),Ot.return=rt,rt=Ot;break t}}else if(et.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===Cn&&IT(Yt)===et.type){u(rt,et.sibling),Ot=_(et,lt.props),Td(Ot,lt),Ot.return=rt,rt=Ot;break t}u(rt,et);break}else o(rt,et);et=et.sibling}lt.type===it?(Ot=Oc(lt.props.children,rt.mode,Ot,lt.key),Ot.return=rt,rt=Ot):(Ot=ed(lt.type,lt.key,lt.props,null,rt.mode,Ot),Td(Ot,lt),Ot.return=rt,rt=Ot)}return k(rt);case Vt:t:{for(Yt=lt.key;et!==null;){if(et.key===Yt)if(et.tag===4&&et.stateNode.containerInfo===lt.containerInfo&&et.stateNode.implementation===lt.implementation){u(rt,et.sibling),Ot=_(et,lt.children||[]),Ot.return=rt,rt=Ot;break t}else{u(rt,et);break}else o(rt,et);et=et.sibling}Ot=_E(lt,rt.mode,Ot),Ot.return=rt,rt=Ot}return k(rt);case Cn:return Yt=lt._init,lt=Yt(lt._payload),wn(rt,et,lt,Ot)}if(Ri(lt))return ve(rt,et,lt,Ot);if(Yn(lt)){if(Yt=Yn(lt),typeof Yt!="function")throw Error(b(150));return lt=Yt.call(lt),ae(rt,et,lt,Ot)}if(typeof lt.then=="function")return wn(rt,et,Np(lt),Ot);if(lt.$$typeof===Ft)return wn(rt,et,op(rt,lt),Ot);Rd(rt,lt)}return typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint"?(lt=""+lt,et!==null&&et.tag===6?(u(rt,et.sibling),Ot=_(et,lt),Ot.return=rt,rt=Ot):(u(rt,et),Ot=EE(lt,rt.mode,Ot),Ot.return=rt,rt=Ot),k(rt)):u(rt,et)}return function(rt,et,lt,Ot){try{Sd=0;var Yt=wn(rt,et,lt,Ot);return Wl=null,Yt}catch(ie){if(ie===yo||ie===up)throw ie;var We=Yi(29,ie,null,rt.mode);return We.lanes=Ot,We.return=rt,We}finally{}}}var xc=Dp(!0),OT=Dp(!1),qr=Ut(null),Qa=null;function Io(a){var o=a.alternate;qt(Pi,Pi.current&1),qt(qr,a),Qa===null&&(o===null||kl.current!==null||o.memoizedState!==null)&&(Qa=a)}function wT(a){if(a.tag===22){if(qt(Pi,Pi.current),qt(qr,a),Qa===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(Qa=a)}}else Oo()}function Oo(){qt(Pi,Pi.current),qt(qr,qr.current)}function Vs(a){Zt(qr),Qa===a&&(Qa=null),Zt(Pi)}var Pi=Ut(0);function Lp(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||L_(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Pp(a,o,u,f){o=a.memoizedState,u=u(f,o),u=u==null?o:Z({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Za={enqueueSetState:function(a,o,u){a=a._reactInternals;var f=Dr(),_=Ms(f);_.payload=o,u!=null&&(_.callback=u),o=Ca(a,_,f),o!==null&&(Jr(o,a,f),Us(o,a,f))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var f=Dr(),_=Ms(f);_.tag=1,_.payload=o,u!=null&&(_.callback=u),o=Ca(a,_,f),o!==null&&(Jr(o,a,f),Us(o,a,f))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=Dr(),f=Ms(u);f.tag=2,o!=null&&(f.callback=o),o=Ca(a,f,u),o!==null&&(Jr(o,a,u),Us(o,a,u))}};function NT(a,o,u,f,_,R,k){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,R,k):o.prototype&&o.prototype.isPureReactComponent?!Zu(u,f)||!Zu(_,R):!0}function DT(a,o,u,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,f),o.state!==a&&Za.enqueueReplaceState(o,o.state,null)}function Vc(a,o){var u=o;if("ref"in o){u={};for(var f in o)f!=="ref"&&(u[f]=o[f])}if(a=a.defaultProps){u===o&&(u=Z({},u));for(var _ in a)u[_]===void 0&&(u[_]=a[_])}return u}var kp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function LT(a){kp(a)}function PT(a){console.error(a)}function Mp(a){kp(a)}function Up(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function kT(a,o,u){try{var f=a.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function JE(a,o,u){return u=Ms(u),u.tag=3,u.payload={element:null},u.callback=function(){Up(a,o)},u}function MT(a){return a=Ms(a),a.tag=3,a}function UT(a,o,u,f){var _=u.type.getDerivedStateFromError;if(typeof _=="function"){var R=f.value;a.payload=function(){return _(R)},a.callback=function(){kT(o,u,f)}}var k=u.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(a.callback=function(){kT(o,u,f),typeof _!="function"&&(Gs===null?Gs=new Set([this]):Gs.add(this));var B=f.stack;this.componentDidCatch(f.value,{componentStack:B!==null?B:""})})}function dA(a,o,u,f,_){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=u.alternate,o!==null&&Lc(o,u,_,!0),u=qr.current,u!==null){switch(u.tag){case 13:return Qa===null?tf():u.alternate===null&&ci===0&&(ci=3),u.flags&=-257,u.flags|=65536,u.lanes=_,f===yE?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([f]):o.add(f),S_(a,f,_)),!1;case 22:return u.flags|=65536,f===yE?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([f]):u.add(f)),S_(a,f,_)),!1}throw Error(b(435,u.tag))}return S_(a,f,_),tf(),!1}if(on)return o=qr.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=_,f!==SE&&(a=Error(b(422),{cause:f}),To(na(a,u)))):(f!==SE&&(o=Error(b(423),{cause:f}),To(na(o,u))),a=a.current.alternate,a.flags|=65536,_&=-_,a.lanes|=_,f=na(f,u),_=JE(a.stateNode,f,_),AE(a,_),ci!==4&&(ci=2)),!1;var R=Error(b(520),{cause:f});if(R=na(R,u),wd===null?wd=[R]:wd.push(R),ci!==4&&(ci=2),o===null)return!0;f=na(f,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=_&-_,u.lanes|=a,a=JE(u.stateNode,f,a),AE(u,a),!1;case 1:if(o=u.type,R=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(Gs===null||!Gs.has(R))))return u.flags|=65536,_&=-_,u.lanes|=_,_=MT(_),UT(_,a,u,f),AE(u,_),!1}u=u.return}while(u!==null);return!1}var QE=Error(b(461)),ki=!1;function qi(a,o,u,f){o.child=a===null?OT(o,null,u,f):xc(o,a.child,u,f)}function xT(a,o,u,f,_){u=u.render;var R=o.ref;if("ref"in f){var k={};for(var B in f)B!=="ref"&&(k[B]=f[B])}else k=f;return Pc(o),f=NE(a,o,u,k,R,_),B=DE(),a!==null&&!ki?(LE(a,o,_),Bs(a,o,_)):(on&&B&&gE(o),o.flags|=1,qi(a,o,f,_),o.child)}function vd(a,o,u,f,_){if(a===null){var R=u.type;return typeof R=="function"&&!mE(R)&&R.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=R,xp(a,o,R,f,_)):(a=ed(u.type,null,f,o,o.mode,_),a.ref=o.ref,a.return=o,o.child=a)}if(R=a.child,!r_(a,_)){var k=R.memoizedProps;if(u=u.compare,u=u!==null?u:Zu,u(k,f)&&a.ref===o.ref)return Bs(a,o,_)}return o.flags|=1,a=Os(R,f),a.ref=o.ref,a.return=o,o.child=a}function xp(a,o,u,f,_){if(a!==null){var R=a.memoizedProps;if(Zu(R,f)&&a.ref===o.ref)if(ki=!1,o.pendingProps=f=R,r_(a,_))(a.flags&131072)!==0&&(ki=!0);else return o.lanes=a.lanes,Bs(a,o,_)}return $E(a,o,u,f,_)}function ZE(a,o,u){var f=o.pendingProps,_=f.children,R=a!==null?a.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=R!==null?R.baseLanes|u:u,a!==null){for(_=o.child=a.child,R=0;_!==null;)R=R|_.lanes|_.childLanes,_=_.sibling;o.childLanes=R&~f}else o.childLanes=0,o.child=null;return yd(a,o,f,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&lp(o,R!==null?R.cachePool:null),R!==null?uT(o,R):OE(),wT(o);else return o.lanes=o.childLanes=536870912,yd(a,o,R!==null?R.baseLanes|u:u,u)}else R!==null?(lp(o,R.cachePool),uT(o,R),Oo(),o.memoizedState=null):(a!==null&&lp(o,null),OE(),Oo());return qi(a,o,_,u),o.child}function yd(a,o,u,f){var _=RE();return _=_===null?null:{parent:Li._currentValue,pool:_},o.memoizedState={baseLanes:u,cachePool:_},a!==null&&lp(o,null),OE(),wT(o),a!==null&&Lc(a,o,f,!0),null}function Cd(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(b(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function $E(a,o,u,f,_){return Pc(o),u=NE(a,o,u,f,void 0,_),f=DE(),a!==null&&!ki?(LE(a,o,_),Bs(a,o,_)):(on&&f&&gE(o),o.flags|=1,qi(a,o,u,_),o.child)}function t_(a,o,u,f,_,R){return Pc(o),o.updateQueue=null,u=hT(o,f,u,_),dT(a),f=DE(),a!==null&&!ki?(LE(a,o,R),Bs(a,o,R)):(on&&f&&gE(o),o.flags|=1,qi(a,o,u,R),o.child)}function Vp(a,o,u,f,_){if(Pc(o),o.stateNode===null){var R=er,k=u.contextType;typeof k=="object"&&k!==null&&(R=Ci(k)),R=new u(f,R),o.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=Za,o.stateNode=R,R._reactInternals=o,R=o.stateNode,R.props=f,R.state=o.memoizedState,R.refs={},ud(o),k=u.contextType,R.context=typeof k=="object"&&k!==null?Ci(k):er,R.state=o.memoizedState,k=u.getDerivedStateFromProps,typeof k=="function"&&(Pp(o,u,k,f),R.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(k=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),k!==R.state&&Za.enqueueReplaceState(R,R.state,null),dd(o,f,R,_),Pl(),R.state=o.memoizedState),typeof R.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(a===null){R=o.stateNode;var B=o.memoizedProps,q=Vc(u,B);R.props=q;var ut=R.context,_t=u.contextType;k=er,typeof _t=="object"&&_t!==null&&(k=Ci(_t));var Dt=u.getDerivedStateFromProps;_t=typeof Dt=="function"||typeof R.getSnapshotBeforeUpdate=="function",B=o.pendingProps!==B,_t||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(B||ut!==k)&&DT(o,R,f,k),ks=!1;var ht=o.memoizedState;R.state=ht,dd(o,f,R,_),Pl(),ut=o.memoizedState,B||ht!==ut||ks?(typeof Dt=="function"&&(Pp(o,u,Dt,f),ut=o.memoizedState),(q=ks||NT(o,u,q,f,ht,ut,k))?(_t||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(o.flags|=4194308)):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=ut),R.props=f,R.state=ut,R.context=k,f=q):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{R=o.stateNode,fp(a,o),k=o.memoizedProps,_t=Vc(u,k),R.props=_t,Dt=o.pendingProps,ht=R.context,ut=u.contextType,q=er,typeof ut=="object"&&ut!==null&&(q=Ci(ut)),B=u.getDerivedStateFromProps,(ut=typeof B=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(k!==Dt||ht!==q)&&DT(o,R,f,q),ks=!1,ht=o.memoizedState,R.state=ht,dd(o,f,R,_),Pl();var pt=o.memoizedState;k!==Dt||ht!==pt||ks||a!==null&&a.dependencies!==null&&sp(a.dependencies)?(typeof B=="function"&&(Pp(o,u,B,f),pt=o.memoizedState),(_t=ks||NT(o,u,_t,f,ht,pt,q)||a!==null&&a.dependencies!==null&&sp(a.dependencies))?(ut||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(f,pt,q),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(f,pt,q)),typeof R.componentDidUpdate=="function"&&(o.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof R.componentDidUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=pt),R.props=f,R.state=pt,R.context=q,f=_t):(typeof R.componentDidUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||k===a.memoizedProps&&ht===a.memoizedState||(o.flags|=1024),f=!1)}return R=f,Cd(a,o),f=(o.flags&128)!==0,R||f?(R=o.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:R.render(),o.flags|=1,a!==null&&f?(o.child=xc(o,a.child,null,_),o.child=xc(o,null,u,_)):qi(a,o,u,_),o.memoizedState=R.state,a=o.child):a=Bs(a,o,_),a}function VT(a,o,u,f){return ad(),o.flags|=256,qi(a,o,u,f),o.child}var Bp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Fp(a){return{baseLanes:a,cachePool:oT()}}function e_(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=ra),a}function n_(a,o,u){var f=o.pendingProps,_=!1,R=(o.flags&128)!==0,k;if((k=R)||(k=a!==null&&a.memoizedState===null?!1:(Pi.current&2)!==0),k&&(_=!0,o.flags&=-129),k=(o.flags&32)!==0,o.flags&=-33,a===null){if(on){if(_?Io(o):Oo(),on){var B=oi,q;if(q=B){t:{for(q=B,B=Xa;q.nodeType!==8;){if(!B){B=null;break t}if(q=La(q.nextSibling),q===null){B=null;break t}}B=q}B!==null?(o.memoizedState={dehydrated:B,treeContext:qa!==null?{id:ws,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},q=Yi(18,null,null,0),q.stateNode=B,q.return=o,o.child=q,zi=o,oi=null,q=!0):q=!1}q||Dc(o)}if(B=o.memoizedState,B!==null&&(B=B.dehydrated,B!==null))return L_(B)?o.lanes=32:o.lanes=536870912,null;Vs(o)}return B=f.children,f=f.fallback,_?(Oo(),_=o.mode,B=Gp({mode:"hidden",children:B},_),f=Oc(f,_,u,null),B.return=o,f.return=o,B.sibling=f,o.child=B,_=o.child,_.memoizedState=Fp(u),_.childLanes=e_(a,k,u),o.memoizedState=Bp,f):(Io(o),jp(o,B))}if(q=a.memoizedState,q!==null&&(B=q.dehydrated,B!==null)){if(R)o.flags&256?(Io(o),o.flags&=-257,o=i_(a,o,u)):o.memoizedState!==null?(Oo(),o.child=a.child,o.flags|=128,o=null):(Oo(),_=f.fallback,B=o.mode,f=Gp({mode:"visible",children:f.children},B),_=Oc(_,B,u,null),_.flags|=2,f.return=o,_.return=o,f.sibling=_,o.child=f,xc(o,a.child,null,u),f=o.child,f.memoizedState=Fp(u),f.childLanes=e_(a,k,u),o.memoizedState=Bp,o=_);else if(Io(o),L_(B)){if(k=B.nextSibling&&B.nextSibling.dataset,k)var ut=k.dgst;k=ut,f=Error(b(419)),f.stack="",f.digest=k,To({value:f,source:null,stack:null}),o=i_(a,o,u)}else if(ki||Lc(a,o,u,!1),k=(u&a.childLanes)!==0,ki||k){if(k=Mn,k!==null&&(f=u&-u,f=(f&42)!==0?1:Um(f),f=(f&(k.suspendedLanes|u))!==0?0:f,f!==0&&f!==q.retryLane))throw q.retryLane=f,go(a,f),Jr(k,a,f),QE;B.data==="$?"||tf(),o=i_(a,o,u)}else B.data==="$?"?(o.flags|=192,o.child=a.child,o=null):(a=q.treeContext,oi=La(B.nextSibling),zi=o,on=!0,Nc=null,Xa=!1,a!==null&&(ia[zr++]=ws,ia[zr++]=Ns,ia[zr++]=qa,ws=a.id,Ns=a.overflow,qa=o),o=jp(o,f.children),o.flags|=4096);return o}return _?(Oo(),_=f.fallback,B=o.mode,q=a.child,ut=q.sibling,f=Os(q,{mode:"hidden",children:f.children}),f.subtreeFlags=q.subtreeFlags&65011712,ut!==null?_=Os(ut,_):(_=Oc(_,B,u,null),_.flags|=2),_.return=o,f.return=o,f.sibling=_,o.child=f,f=_,_=o.child,B=a.child.memoizedState,B===null?B=Fp(u):(q=B.cachePool,q!==null?(ut=Li._currentValue,q=q.parent!==ut?{parent:ut,pool:ut}:q):q=oT(),B={baseLanes:B.baseLanes|u,cachePool:q}),_.memoizedState=B,_.childLanes=e_(a,k,u),o.memoizedState=Bp,f):(Io(o),u=a.child,a=u.sibling,u=Os(u,{mode:"visible",children:f.children}),u.return=o,u.sibling=null,a!==null&&(k=o.deletions,k===null?(o.deletions=[a],o.flags|=16):k.push(a)),o.child=u,o.memoizedState=null,u)}function jp(a,o){return o=Gp({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Gp(a,o){return a=Yi(22,a,null,o),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function i_(a,o,u){return xc(o,a.child,null,u),a=jp(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function BT(a,o,u){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),rp(a.return,o,u)}function Kl(a,o,u,f,_){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:_}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=f,R.tail=u,R.tailMode=_)}function FT(a,o,u){var f=o.pendingProps,_=f.revealOrder,R=f.tail;if(qi(a,o,f.children,u),f=Pi.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)t:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&BT(a,u,o);else if(a.tag===19)BT(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break t;for(;a.sibling===null;){if(a.return===null||a.return===o)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}switch(qt(Pi,f),_){case"forwards":for(u=o.child,_=null;u!==null;)a=u.alternate,a!==null&&Lp(a)===null&&(_=u),u=u.sibling;u=_,u===null?(_=o.child,o.child=null):(_=u.sibling,u.sibling=null),Kl(o,!1,_,u,R);break;case"backwards":for(u=null,_=o.child,o.child=null;_!==null;){if(a=_.alternate,a!==null&&Lp(a)===null){o.child=_;break}a=_.sibling,_.sibling=u,u=_,_=a}Kl(o,!0,u,null,R);break;case"together":Kl(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Bs(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),xo|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(Lc(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(b(153));if(o.child!==null){for(a=o.child,u=Os(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=Os(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function r_(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&sp(a)))}function jT(a,o,u){switch(o.tag){case 3:Jn(o,o.stateNode.containerInfo),Ro(o,Li,a.memoizedState.cache),ad();break;case 27:case 5:Om(o);break;case 4:Jn(o,o.stateNode.containerInfo);break;case 10:Ro(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(Io(o),o.flags|=128,null):(u&o.child.childLanes)!==0?n_(a,o,u):(Io(o),a=Bs(a,o,u),a!==null?a.sibling:null);Io(o);break;case 19:var _=(a.flags&128)!==0;if(f=(u&o.childLanes)!==0,f||(Lc(a,o,u,!1),f=(u&o.childLanes)!==0),_){if(f)return FT(a,o,u);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),qt(Pi,Pi.current),f)break;return null;case 22:case 23:return o.lanes=0,ZE(a,o,u);case 24:Ro(o,Li,a.memoizedState.cache)}return Bs(a,o,u)}function GT(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)ki=!0;else{if(!r_(a,u)&&(o.flags&128)===0)return ki=!1,jT(a,o,u);ki=(a.flags&131072)!==0}else ki=!1,on&&(o.flags&1048576)!==0&&eT(o,id,o.index);switch(o.lanes=0,o.tag){case 16:t:{a=o.pendingProps;var f=o.elementType,_=f._init;if(f=_(f._payload),o.type=f,typeof f=="function")mE(f)?(a=Vc(f,a),o.tag=1,o=Vp(null,o,f,a,u)):(o.tag=0,o=$E(null,o,f,a,u));else{if(f!=null){if(_=f.$$typeof,_===ye){o.tag=11,o=xT(null,o,f,a,u);break t}else if(_===Ne){o.tag=14,o=vd(null,o,f,a,u);break t}}throw o=mn(f)||f,Error(b(306,o,""))}}return o;case 0:return $E(a,o,o.type,o.pendingProps,u);case 1:return f=o.type,_=Vc(f,o.pendingProps),Vp(a,o,f,_,u);case 3:t:{if(Jn(o,o.stateNode.containerInfo),a===null)throw Error(b(387));f=o.pendingProps;var R=o.memoizedState;_=R.element,fp(a,o),dd(o,f,null,u);var k=o.memoizedState;if(f=k.cache,Ro(o,Li,f),f!==R.cache&&ap(o,[Li],u,!0),Pl(),f=k.element,R.isDehydrated)if(R={element:f,isDehydrated:!1,cache:k.cache},o.updateQueue.baseState=R,o.memoizedState=R,o.flags&256){o=VT(a,o,f,u);break t}else if(f!==_){_=na(Error(b(424)),o),To(_),o=VT(a,o,f,u);break t}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(oi=La(a.firstChild),zi=o,on=!0,Nc=null,Xa=!0,u=OT(o,null,f,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(ad(),f===_){o=Bs(a,o,u);break t}qi(a,o,f,u)}o=o.child}return o;case 26:return Cd(a,o),a===null?(u=wR(o.type,null,o.pendingProps,null))?o.memoizedState=u:on||(u=o.type,a=o.pendingProps,f=mf(pe.current).createElement(u),f[In]=o,f[Cr]=a,Xi(f,u,a),vi(f),o.stateNode=f):o.memoizedState=wR(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return Om(o),a===null&&on&&(f=o.stateNode=AR(o.type,o.pendingProps,pe.current),zi=o,Xa=!0,_=oi,Ho(o.type)?(P_=_,oi=La(f.firstChild)):oi=_),qi(a,o,o.pendingProps.children,u),Cd(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&on&&((_=f=oi)&&(f=AA(f,o.type,o.pendingProps,Xa),f!==null?(o.stateNode=f,zi=o,oi=La(f.firstChild),Xa=!1,_=!0):_=!1),_||Dc(o)),Om(o),_=o.type,R=o.pendingProps,k=a!==null?a.memoizedProps:null,f=R.children,O_(_,R)?f=null:k!==null&&O_(_,k)&&(o.flags|=32),o.memoizedState!==null&&(_=NE(a,o,oA,null,null,u),cu._currentValue=_),Cd(a,o),qi(a,o,f,u),o.child;case 6:return a===null&&on&&((a=u=oi)&&(u=bA(u,o.pendingProps,Xa),u!==null?(o.stateNode=u,zi=o,oi=null,a=!0):a=!1),a||Dc(o)),null;case 13:return n_(a,o,u);case 4:return Jn(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=xc(o,null,f,u):qi(a,o,f,u),o.child;case 11:return xT(a,o,o.type,o.pendingProps,u);case 7:return qi(a,o,o.pendingProps,u),o.child;case 8:return qi(a,o,o.pendingProps.children,u),o.child;case 12:return qi(a,o,o.pendingProps.children,u),o.child;case 10:return f=o.pendingProps,Ro(o,o.type,f.value),qi(a,o,f.children,u),o.child;case 9:return _=o.type._context,f=o.pendingProps.children,Pc(o),_=Ci(_),f=f(_),o.flags|=1,qi(a,o,f,u),o.child;case 14:return vd(a,o,o.type,o.pendingProps,u);case 15:return xp(a,o,o.type,o.pendingProps,u);case 19:return FT(a,o,u);case 31:return f=o.pendingProps,u=o.mode,f={mode:f.mode,children:f.children},a===null?(u=Gp(f,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=Os(a.child,f),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return ZE(a,o,u);case 24:return Pc(o),f=Ci(Li),a===null?(_=RE(),_===null&&(_=Mn,R=cp(),_.pooledCache=R,R.refCount++,R!==null&&(_.pooledCacheLanes|=u),_=R),o.memoizedState={parent:f,cache:_},ud(o),Ro(o,Li,_)):((a.lanes&u)!==0&&(fp(a,o),dd(o,null,null,u),Pl()),_=a.memoizedState,R=o.memoizedState,_.parent!==f?(_={parent:f,cache:f},o.memoizedState=_,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=_),Ro(o,Li,f)):(f=R.cache,Ro(o,Li,f),f!==_.cache&&ap(o,[Li],u,!0))),qi(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(b(156,o.tag))}function Fs(a){a.flags|=4}function Hp(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!MR(o)){if(o=qr.current,o!==null&&(($e&4194048)===$e?Qa!==null:($e&62914560)!==$e&&($e&536870912)===0||o!==Qa))throw ld=yE,vE;a.flags|=8192}}function Wp(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?km():536870912,a.lanes|=o,Vo|=o)}function Bc(a,o){if(!on)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function $n(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,f=0;if(o)for(var _=a.child;_!==null;)u|=_.lanes|_.childLanes,f|=_.subtreeFlags&65011712,f|=_.flags&65011712,_.return=a,_=_.sibling;else for(_=a.child;_!==null;)u|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=a,_=_.sibling;return a.subtreeFlags|=f,a.childLanes=u,o}function HT(a,o,u){var f=o.pendingProps;switch(ip(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $n(o),null;case 1:return $n(o),null;case 3:return u=o.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Ps(Li),Ka(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(rd(o)?Fs(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,rT())),$n(o),null;case 26:return u=o.memoizedState,a===null?(Fs(o),u!==null?($n(o),Hp(o,u)):($n(o),o.flags&=-16777217)):u?u!==a.memoizedState?(Fs(o),$n(o),Hp(o,u)):($n(o),o.flags&=-16777217):(a.memoizedProps!==f&&Fs(o),$n(o),o.flags&=-16777217),null;case 27:_c(o),u=pe.current;var _=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Fs(o);else{if(!f){if(o.stateNode===null)throw Error(b(166));return $n(o),null}a=ne.current,rd(o)?nT(o):(a=AR(_,f,u),o.stateNode=a,Fs(o))}return $n(o),null;case 5:if(_c(o),u=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Fs(o);else{if(!f){if(o.stateNode===null)throw Error(b(166));return $n(o),null}if(a=ne.current,rd(o))nT(o);else{switch(_=mf(pe.current),a){case 1:a=_.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=_.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=_.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=_.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=_.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof f.is=="string"?_.createElement("select",{is:f.is}):_.createElement("select"),f.multiple?a.multiple=!0:f.size&&(a.size=f.size);break;default:a=typeof f.is=="string"?_.createElement(u,{is:f.is}):_.createElement(u)}}a[In]=o,a[Cr]=f;t:for(_=o.child;_!==null;){if(_.tag===5||_.tag===6)a.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===o)break t;for(;_.sibling===null;){if(_.return===null||_.return===o)break t;_=_.return}_.sibling.return=_.return,_=_.sibling}o.stateNode=a;t:switch(Xi(a,u,f),u){case"button":case"input":case"select":case"textarea":a=!!f.autoFocus;break t;case"img":a=!0;break t;default:a=!1}a&&Fs(o)}}return $n(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==f&&Fs(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(b(166));if(a=pe.current,rd(o)){if(a=o.stateNode,u=o.memoizedProps,f=null,_=zi,_!==null)switch(_.tag){case 27:case 5:f=_.memoizedProps}a[In]=o,a=!!(a.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||SR(a.nodeValue,u)),a||Dc(o)}else a=mf(a).createTextNode(f),a[In]=o,o.stateNode=a}return $n(o),null;case 13:if(f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(_=rd(o),f!==null&&f.dehydrated!==null){if(a===null){if(!_)throw Error(b(318));if(_=o.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(b(317));_[In]=o}else ad(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;$n(o),_=!1}else _=rT(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=_),_=!0;if(!_)return o.flags&256?(Vs(o),o):(Vs(o),null)}if(Vs(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=f!==null,a=a!==null&&a.memoizedState!==null,u){f=o.child,_=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(_=f.alternate.memoizedState.cachePool.pool);var R=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(R=f.memoizedState.cachePool.pool),R!==_&&(f.flags|=2048)}return u!==a&&u&&(o.child.flags|=8192),Wp(o,o.updateQueue),$n(o),null;case 4:return Ka(),a===null&&Go(o.stateNode.containerInfo),$n(o),null;case 10:return Ps(o.type),$n(o),null;case 19:if(Zt(Pi),_=o.memoizedState,_===null)return $n(o),null;if(f=(o.flags&128)!==0,R=_.rendering,R===null)if(f)Bc(_,!1);else{if(ci!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(R=Lp(a),R!==null){for(o.flags|=128,Bc(_,!1),a=R.updateQueue,o.updateQueue=a,Wp(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)tT(u,a),u=u.sibling;return qt(Pi,Pi.current&1|2),o.child}a=a.sibling}_.tail!==null&&Ya()>Xl&&(o.flags|=128,f=!0,Bc(_,!1),o.lanes=4194304)}else{if(!f)if(a=Lp(R),a!==null){if(o.flags|=128,f=!0,a=a.updateQueue,o.updateQueue=a,Wp(o,a),Bc(_,!0),_.tail===null&&_.tailMode==="hidden"&&!R.alternate&&!on)return $n(o),null}else 2*Ya()-_.renderingStartTime>Xl&&u!==536870912&&(o.flags|=128,f=!0,Bc(_,!1),o.lanes=4194304);_.isBackwards?(R.sibling=o.child,o.child=R):(a=_.last,a!==null?a.sibling=R:o.child=R,_.last=R)}return _.tail!==null?(o=_.tail,_.rendering=o,_.tail=o.sibling,_.renderingStartTime=Ya(),o.sibling=null,a=Pi.current,qt(Pi,f?a&1|2:a&1),o):($n(o),null);case 22:case 23:return Vs(o),wE(),f=o.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(u&536870912)!==0&&(o.flags&128)===0&&($n(o),o.subtreeFlags&6&&(o.flags|=8192)):$n(o),u=o.updateQueue,u!==null&&Wp(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==u&&(o.flags|=2048),a!==null&&Zt(kc),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),Ps(Li),$n(o),null;case 25:return null;case 30:return null}throw Error(b(156,o.tag))}function hA(a,o){switch(ip(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return Ps(Li),Ka(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return _c(o),null;case 13:if(Vs(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(b(340));ad()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Zt(Pi),null;case 4:return Ka(),null;case 10:return Ps(o.type),null;case 22:case 23:return Vs(o),wE(),a!==null&&Zt(kc),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return Ps(Li),null;case 25:return null;default:return null}}function WT(a,o){switch(ip(o),o.tag){case 3:Ps(Li),Ka();break;case 26:case 27:case 5:_c(o);break;case 4:Ka();break;case 13:Vs(o);break;case 19:Zt(Pi);break;case 10:Ps(o.type);break;case 22:case 23:Vs(o),wE(),a!==null&&Zt(kc);break;case 24:Ps(Li)}}function Yl(a,o){try{var u=o.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var _=f.next;u=_;do{if((u.tag&a)===a){f=void 0;var R=u.create,k=u.inst;f=R(),k.destroy=f}u=u.next}while(u!==_)}}catch(B){Un(o,o.return,B)}}function wo(a,o,u){try{var f=o.updateQueue,_=f!==null?f.lastEffect:null;if(_!==null){var R=_.next;f=R;do{if((f.tag&a)===a){var k=f.inst,B=k.destroy;if(B!==void 0){k.destroy=void 0,_=o;var q=u,ut=B;try{ut()}catch(_t){Un(_,q,_t)}}}f=f.next}while(f!==R)}}catch(_t){Un(o,o.return,_t)}}function KT(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{IE(o,u)}catch(f){Un(a,a.return,f)}}}function a_(a,o,u){u.props=Vc(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(f){Un(a,o,f)}}function Ad(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var f=a.stateNode;break;case 30:f=a.stateNode;break;default:f=a.stateNode}typeof u=="function"?a.refCleanup=u(f):u.current=f}}catch(_){Un(a,o,_)}}function Ia(a,o){var u=a.ref,f=a.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(_){Un(a,o,_)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(_){Un(a,o,_)}else u.current=null}function Kp(a){var o=a.type,u=a.memoizedProps,f=a.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break t;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(_){Un(a,a.return,_)}}function s_(a,o,u){try{var f=a.stateNode;TA(f,a.type,u,o),f[Cr]=o}catch(_){Un(a,a.return,_)}}function YT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ho(a.type)||a.tag===4}function Fc(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||YT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ho(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Yp(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=ff));else if(f!==4&&(f===27&&Ho(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(Yp(a,o,u),a=a.sibling;a!==null;)Yp(a,o,u),a=a.sibling}function No(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(f!==4&&(f===27&&Ho(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(No(a,o,u),a=a.sibling;a!==null;)No(a,o,u),a=a.sibling}function jc(a){var o=a.stateNode,u=a.memoizedProps;try{for(var f=a.type,_=o.attributes;_.length;)o.removeAttributeNode(_[0]);Xi(o,f,u),o[In]=a,o[Cr]=u}catch(R){Un(a,a.return,R)}}var $a=!1,ti=!1,zl=!1,zT=typeof WeakSet=="function"?WeakSet:Set,ji=null;function pA(a,o){if(a=a.containerInfo,b_=Tf,a=YS(a),pr(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else t:{u=(u=a.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var _=f.anchorOffset,R=f.focusNode;f=f.focusOffset;try{u.nodeType,R.nodeType}catch{u=null;break t}var k=0,B=-1,q=-1,ut=0,_t=0,Dt=a,ht=null;e:for(;;){for(var pt;Dt!==u||_!==0&&Dt.nodeType!==3||(B=k+_),Dt!==R||f!==0&&Dt.nodeType!==3||(q=k+f),Dt.nodeType===3&&(k+=Dt.nodeValue.length),(pt=Dt.firstChild)!==null;)ht=Dt,Dt=pt;for(;;){if(Dt===a)break e;if(ht===u&&++ut===_&&(B=k),ht===R&&++_t===f&&(q=k),(pt=Dt.nextSibling)!==null)break;Dt=ht,ht=Dt.parentNode}Dt=pt}u=B===-1||q===-1?null:{start:B,end:q}}else u=null}u=u||{start:0,end:0}}else u=null;for(I_={focusedElem:a,selectionRange:u},Tf=!1,ji=o;ji!==null;)if(o=ji,a=o.child,(o.subtreeFlags&1024)!==0&&a!==null)a.return=o,ji=a;else for(;ji!==null;){switch(o=ji,R=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&R!==null){a=void 0,u=o,_=R.memoizedProps,R=R.memoizedState,f=u.stateNode;try{var ve=Vc(u.type,_,u.elementType===u.type);a=f.getSnapshotBeforeUpdate(ve,R),f.__reactInternalSnapshotBeforeUpdate=a}catch(ae){Un(u,u.return,ae)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)D_(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":D_(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(b(163))}if(a=o.sibling,a!==null){a.return=o.return,ji=a;break}ji=o.return}}function o_(a,o,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:js(a,u),f&4&&Yl(5,u);break;case 1:if(js(a,u),f&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(k){Un(u,u.return,k)}else{var _=Vc(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(_,o,a.__reactInternalSnapshotBeforeUpdate)}catch(k){Un(u,u.return,k)}}f&64&&KT(u),f&512&&Ad(u,u.return);break;case 3:if(js(a,u),f&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{IE(a,o)}catch(k){Un(u,u.return,k)}}break;case 27:o===null&&f&4&&jc(u);case 26:case 5:js(a,u),o===null&&f&4&&Kp(u),f&512&&Ad(u,u.return);break;case 12:js(a,u);break;case 13:js(a,u),f&4&&XT(a,u),f&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=R_.bind(null,u),IA(a,u))));break;case 22:if(f=u.memoizedState!==null||$a,!f){o=o!==null&&o.memoizedState!==null||ti,_=$a;var R=ti;$a=f,(ti=o)&&!R?Lo(a,u,(u.subtreeFlags&8772)!==0):js(a,u),$a=_,ti=R}break;case 30:break;default:js(a,u)}}function qT(a){var o=a.alternate;o!==null&&(a.alternate=null,qT(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Uh(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Qn=null,Or=!1;function Oa(a,o,u){for(u=u.child;u!==null;)bd(a,o,u),u=u.sibling}function bd(a,o,u){if(kn&&typeof kn.onCommitFiberUnmount=="function")try{kn.onCommitFiberUnmount(ml,u)}catch{}switch(u.tag){case 26:ti||Ia(u,o),Oa(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ti||Ia(u,o);var f=Qn,_=Or;Ho(u.type)&&(Qn=u.stateNode,Or=!1),Oa(a,o,u),Vd(u.stateNode),Qn=f,Or=_;break;case 5:ti||Ia(u,o);case 6:if(f=Qn,_=Or,Qn=null,Oa(a,o,u),Qn=f,Or=_,Qn!==null)if(Or)try{(Qn.nodeType===9?Qn.body:Qn.nodeName==="HTML"?Qn.ownerDocument.body:Qn).removeChild(u.stateNode)}catch(R){Un(u,o,R)}else try{Qn.removeChild(u.stateNode)}catch(R){Un(u,o,R)}break;case 18:Qn!==null&&(Or?(a=Qn,yR(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),Pr(a)):yR(Qn,u.stateNode));break;case 4:f=Qn,_=Or,Qn=u.stateNode.containerInfo,Or=!0,Oa(a,o,u),Qn=f,Or=_;break;case 0:case 11:case 14:case 15:ti||wo(2,u,o),ti||wo(4,u,o),Oa(a,o,u);break;case 1:ti||(Ia(u,o),f=u.stateNode,typeof f.componentWillUnmount=="function"&&a_(u,o,f)),Oa(a,o,u);break;case 21:Oa(a,o,u);break;case 22:ti=(f=ti)||u.memoizedState!==null,Oa(a,o,u),ti=f;break;default:Oa(a,o,u)}}function XT(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Pr(a)}catch(u){Un(o,o.return,u)}}function ql(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new zT),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new zT),o;default:throw Error(b(435,a.tag))}}function zp(a,o){var u=ql(a);o.forEach(function(f){var _=EA.bind(null,a,f);u.has(f)||(u.add(f),f.then(_,_))})}function zn(a,o){var u=o.deletions;if(u!==null)for(var f=0;f<u.length;f++){var _=u[f],R=a,k=o,B=k;t:for(;B!==null;){switch(B.tag){case 27:if(Ho(B.type)){Qn=B.stateNode,Or=!1;break t}break;case 5:Qn=B.stateNode,Or=!1;break t;case 3:case 4:Qn=B.stateNode.containerInfo,Or=!0;break t}B=B.return}if(Qn===null)throw Error(b(160));bd(R,k,_),Qn=null,Or=!1,R=_.alternate,R!==null&&(R.return=null),_.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)JT(o,a),o=o.sibling}var wa=null;function JT(a,o){var u=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:zn(o,a),wr(a),f&4&&(wo(3,a,a.return),Yl(3,a),wo(5,a,a.return));break;case 1:zn(o,a),wr(a),f&512&&(ti||u===null||Ia(u,u.return)),f&64&&$a&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var _=wa;if(zn(o,a),wr(a),f&512&&(ti||u===null||Ia(u,u.return)),f&4){var R=u!==null?u.memoizedState:null;if(f=a.memoizedState,u===null)if(f===null)if(a.stateNode===null){t:{f=a.type,u=a.memoizedProps,_=_.ownerDocument||_;e:switch(f){case"title":R=_.getElementsByTagName("title")[0],(!R||R[Hu]||R[In]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=_.createElement(f),_.head.insertBefore(R,_.querySelector("head > title"))),Xi(R,f,u),R[In]=a,vi(R),f=R;break t;case"link":var k=PR("link","href",_).get(f+(u.href||""));if(k){for(var B=0;B<k.length;B++)if(R=k[B],R.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&R.getAttribute("rel")===(u.rel==null?null:u.rel)&&R.getAttribute("title")===(u.title==null?null:u.title)&&R.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){k.splice(B,1);break e}}R=_.createElement(f),Xi(R,f,u),_.head.appendChild(R);break;case"meta":if(k=PR("meta","content",_).get(f+(u.content||""))){for(B=0;B<k.length;B++)if(R=k[B],R.getAttribute("content")===(u.content==null?null:""+u.content)&&R.getAttribute("name")===(u.name==null?null:u.name)&&R.getAttribute("property")===(u.property==null?null:u.property)&&R.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&R.getAttribute("charset")===(u.charSet==null?null:u.charSet)){k.splice(B,1);break e}}R=_.createElement(f),Xi(R,f,u),_.head.appendChild(R);break;default:throw Error(b(468,f))}R[In]=a,vi(R),f=R}a.stateNode=f}else kR(_,a.type,a.stateNode);else a.stateNode=LR(_,f,a.memoizedProps);else R!==f?(R===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):R.count--,f===null?kR(_,a.type,a.stateNode):LR(_,f,a.memoizedProps)):f===null&&a.stateNode!==null&&s_(a,a.memoizedProps,u.memoizedProps)}break;case 27:zn(o,a),wr(a),f&512&&(ti||u===null||Ia(u,u.return)),u!==null&&f&4&&s_(a,a.memoizedProps,u.memoizedProps);break;case 5:if(zn(o,a),wr(a),f&512&&(ti||u===null||Ia(u,u.return)),a.flags&32){_=a.stateNode;try{yc(_,"")}catch(pt){Un(a,a.return,pt)}}f&4&&a.stateNode!=null&&(_=a.memoizedProps,s_(a,_,u!==null?u.memoizedProps:_)),f&1024&&(zl=!0);break;case 6:if(zn(o,a),wr(a),f&4){if(a.stateNode===null)throw Error(b(162));f=a.memoizedProps,u=a.stateNode;try{u.nodeValue=f}catch(pt){Un(a,a.return,pt)}}break;case 3:if(jd=null,_=wa,wa=Ef(o.containerInfo),zn(o,a),wa=_,wr(a),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Pr(o.containerInfo)}catch(pt){Un(a,a.return,pt)}zl&&(zl=!1,QT(a));break;case 4:f=wa,wa=Ef(a.stateNode.containerInfo),zn(o,a),wr(a),wa=f;break;case 12:zn(o,a),wr(a);break;case 13:zn(o,a),wr(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(f_=Ya()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,zp(a,f)));break;case 22:_=a.memoizedState!==null;var q=u!==null&&u.memoizedState!==null,ut=$a,_t=ti;if($a=ut||_,ti=_t||q,zn(o,a),ti=_t,$a=ut,wr(a),f&8192)t:for(o=a.stateNode,o._visibility=_?o._visibility&-2:o._visibility|1,_&&(u===null||q||$a||ti||Do(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){q=u=o;try{if(R=q.stateNode,_)k=R.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{B=q.stateNode;var Dt=q.memoizedProps.style,ht=Dt!=null&&Dt.hasOwnProperty("display")?Dt.display:null;B.style.display=ht==null||typeof ht=="boolean"?"":(""+ht).trim()}}catch(pt){Un(q,q.return,pt)}}}else if(o.tag===6){if(u===null){q=o;try{q.stateNode.nodeValue=_?"":q.memoizedProps}catch(pt){Un(q,q.return,pt)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break t;for(;o.sibling===null;){if(o.return===null||o.return===a)break t;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=a.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,zp(a,u))));break;case 19:zn(o,a),wr(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,zp(a,f)));break;case 30:break;case 21:break;default:zn(o,a),wr(a)}}function wr(a){var o=a.flags;if(o&2){try{for(var u,f=a.return;f!==null;){if(YT(f)){u=f;break}f=f.return}if(u==null)throw Error(b(160));switch(u.tag){case 27:var _=u.stateNode,R=Fc(a);No(a,R,_);break;case 5:var k=u.stateNode;u.flags&32&&(yc(k,""),u.flags&=-33);var B=Fc(a);No(a,B,k);break;case 3:case 4:var q=u.stateNode.containerInfo,ut=Fc(a);Yp(a,ut,q);break;default:throw Error(b(161))}}catch(_t){Un(a,a.return,_t)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function QT(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;QT(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function js(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)o_(a,o.alternate,o),o=o.sibling}function Do(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:wo(4,o,o.return),Do(o);break;case 1:Ia(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&a_(o,o.return,u),Do(o);break;case 27:Vd(o.stateNode);case 26:case 5:Ia(o,o.return),Do(o);break;case 22:o.memoizedState===null&&Do(o);break;case 30:Do(o);break;default:Do(o)}a=a.sibling}}function Lo(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,_=a,R=o,k=R.flags;switch(R.tag){case 0:case 11:case 15:Lo(_,R,u),Yl(4,R);break;case 1:if(Lo(_,R,u),f=R,_=f.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(ut){Un(f,f.return,ut)}if(f=R,_=f.updateQueue,_!==null){var B=f.stateNode;try{var q=_.shared.hiddenCallbacks;if(q!==null)for(_.shared.hiddenCallbacks=null,_=0;_<q.length;_++)lT(q[_],B)}catch(ut){Un(f,f.return,ut)}}u&&k&64&&KT(R),Ad(R,R.return);break;case 27:jc(R);case 26:case 5:Lo(_,R,u),u&&f===null&&k&4&&Kp(R),Ad(R,R.return);break;case 12:Lo(_,R,u);break;case 13:Lo(_,R,u),u&&k&4&&XT(_,R);break;case 22:R.memoizedState===null&&Lo(_,R,u),Ad(R,R.return);break;case 30:break;default:Lo(_,R,u)}o=o.sibling}}function qp(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&sd(u))}function c_(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&sd(a))}function ts(a,o,u,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)ZT(a,o,u,f),o=o.sibling}function ZT(a,o,u,f){var _=o.flags;switch(o.tag){case 0:case 11:case 15:ts(a,o,u,f),_&2048&&Yl(9,o);break;case 1:ts(a,o,u,f);break;case 3:ts(a,o,u,f),_&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&sd(a)));break;case 12:if(_&2048){ts(a,o,u,f),a=o.stateNode;try{var R=o.memoizedProps,k=R.id,B=R.onPostCommit;typeof B=="function"&&B(k,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(q){Un(o,o.return,q)}}else ts(a,o,u,f);break;case 13:ts(a,o,u,f);break;case 23:break;case 22:R=o.stateNode,k=o.alternate,o.memoizedState!==null?R._visibility&2?ts(a,o,u,f):Gc(a,o):R._visibility&2?ts(a,o,u,f):(R._visibility|=2,Po(a,o,u,f,(o.subtreeFlags&10256)!==0)),_&2048&&qp(k,o);break;case 24:ts(a,o,u,f),_&2048&&c_(o.alternate,o);break;default:ts(a,o,u,f)}}function Po(a,o,u,f,_){for(_=_&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var R=a,k=o,B=u,q=f,ut=k.flags;switch(k.tag){case 0:case 11:case 15:Po(R,k,B,q,_),Yl(8,k);break;case 23:break;case 22:var _t=k.stateNode;k.memoizedState!==null?_t._visibility&2?Po(R,k,B,q,_):Gc(R,k):(_t._visibility|=2,Po(R,k,B,q,_)),_&&ut&2048&&qp(k.alternate,k);break;case 24:Po(R,k,B,q,_),_&&ut&2048&&c_(k.alternate,k);break;default:Po(R,k,B,q,_)}o=o.sibling}}function Gc(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,f=o,_=f.flags;switch(f.tag){case 22:Gc(u,f),_&2048&&qp(f.alternate,f);break;case 24:Gc(u,f),_&2048&&c_(f.alternate,f);break;default:Gc(u,f)}o=o.sibling}}var Id=8192;function ko(a){if(a.subtreeFlags&Id)for(a=a.child;a!==null;)$T(a),a=a.sibling}function $T(a){switch(a.tag){case 26:ko(a),a.flags&Id&&a.memoizedState!==null&&UA(wa,a.memoizedState,a.memoizedProps);break;case 5:ko(a);break;case 3:case 4:var o=wa;wa=Ef(a.stateNode.containerInfo),ko(a),wa=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=Id,Id=16777216,ko(a),Id=o):ko(a));break;default:ko(a)}}function l_(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Od(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];ji=f,u_(f,a)}l_(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Xp(a),a=a.sibling}function Xp(a){switch(a.tag){case 0:case 11:case 15:Od(a),a.flags&2048&&wo(9,a,a.return);break;case 3:Od(a);break;case 12:Od(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,Mo(a)):Od(a);break;default:Od(a)}}function Mo(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];ji=f,u_(f,a)}l_(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:wo(8,o,o.return),Mo(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Mo(o));break;default:Mo(o)}a=a.sibling}}function u_(a,o){for(;ji!==null;){var u=ji;switch(u.tag){case 0:case 11:case 15:wo(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:sd(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,ji=f;else t:for(u=a;ji!==null;){f=ji;var _=f.sibling,R=f.return;if(qT(f),f===u){ji=null;break t}if(_!==null){_.return=R,ji=_;break t}ji=R}}}var d_={getCacheForType:function(a){var o=Ci(Li),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u}},h_=typeof WeakMap=="function"?WeakMap:Map,Rn=0,Mn=null,Ue=null,$e=0,an=0,mr=null,es=!1,Uo=!1,Jp=!1,ns=0,ci=0,xo=0,Xr=0,Qp=0,ra=0,Vo=0,wd=null,Nr=null,p_=!1,f_=0,Xl=1/0,Nd=null,Gs=null,Gi=0,Na=null,Hc=null,Bo=0,Jl=0,Ql=null,m_=null,is=0,Hs=null;function Dr(){if((Rn&2)!==0&&$e!==0)return $e&-$e;if(Rt.T!==null){var a=vo;return a!==0?a:xd()}return ES()}function tR(){ra===0&&(ra=($e&536870912)===0||on?gc():536870912);var a=qr.current;return a!==null&&(a.flags|=32),ra}function Jr(a,o,u){(a===Mn&&(an===2||an===9)||a.cancelPendingCommit!==null)&&($l(a,0),Fo(a,$e,ra,!1)),Gu(a,u),((Rn&2)===0||a!==Mn)&&(a===Mn&&((Rn&2)===0&&(Xr|=u),ci===4&&Fo(a,$e,ra,!1)),Da(a))}function Zl(a,o,u){if((Rn&6)!==0)throw Error(b(327));var f=!u&&(o&124)===0&&(o&a.expiredLanes)===0||ju(a,o),_=f?rs(a,o):g_(a,o,!0),R=f;do{if(_===0){Uo&&!f&&Fo(a,o,0,!1);break}else{if(u=a.current.alternate,R&&!fA(u)){_=g_(a,o,!1),R=!1;continue}if(_===2){if(R=o,a.errorRecoveryDisabledLanes&R)var k=0;else k=a.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){o=k;t:{var B=a;_=wd;var q=B.current.memoizedState.isDehydrated;if(q&&($l(B,k).flags|=256),k=g_(B,k,!1),k!==2){if(Jp&&!q){B.errorRecoveryDisabledLanes|=R,Xr|=R,_=4;break t}R=Nr,Nr=_,R!==null&&(Nr===null?Nr=R:Nr.push.apply(Nr,R))}_=k}if(R=!1,_!==2)continue}}if(_===1){$l(a,0),Fo(a,o,0,!0);break}t:{switch(f=a,R=_,R){case 0:case 1:throw Error(b(345));case 4:if((o&4194048)!==o)break;case 6:Fo(f,o,ra,!es);break t;case 2:Nr=null;break;case 3:case 5:break;default:throw Error(b(329))}if((o&62914560)===o&&(_=f_+300-Ya(),10<_)){if(Fo(f,o,ra,!es),Fu(f,0,!0)!==0)break t;f.timeoutHandle=vR(eR.bind(null,f,u,Nr,Nd,p_,o,ra,Xr,Vo,es,R,2,-0,0),_);break t}eR(f,u,Nr,Nd,p_,o,ra,Xr,Vo,es,R,0,-0,0)}}break}while(!0);Da(a)}function eR(a,o,u,f,_,R,k,B,q,ut,_t,Dt,ht,pt){if(a.timeoutHandle=-1,Dt=o.subtreeFlags,(Dt&8192||(Dt&16785408)===16785408)&&(Gd={stylesheets:null,count:0,unsuspend:MA},$T(o),Dt=UR(),Dt!==null)){a.cancelPendingCommit=Dt(Pd.bind(null,a,o,R,u,f,_,k,B,q,_t,1,ht,pt)),Fo(a,R,k,!ut);return}Pd(a,o,R,u,f,_,k,B,q)}function fA(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var _=u[f],R=_.getSnapshot;_=_.value;try{if(!Yr(R(),_))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Fo(a,o,u,f){o&=~Qp,o&=~Xr,a.suspendedLanes|=o,a.pingedLanes&=~o,f&&(a.warmLanes|=o),f=a.expirationTimes;for(var _=o;0<_;){var R=31-yr(_),k=1<<R;f[R]=-1,_&=~k}u!==0&&mS(a,u,o)}function Zp(){return(Rn&6)===0?(Ud(0),!1):!0}function E_(){if(Ue!==null){if(an===0)var a=Ue.return;else a=Ue,Ls=Ds=null,hd(a),Wl=null,Sd=0,a=Ue;for(;a!==null;)WT(a.alternate,a),a=a.return;Ue=null}}function $l(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,vA(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),E_(),Mn=a,Ue=u=Os(a.current,null),$e=o,an=0,mr=null,es=!1,Uo=ju(a,o),Jp=!1,Vo=ra=Qp=Xr=xo=ci=0,Nr=wd=null,p_=!1,(o&8)!==0&&(o|=o&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=o;0<f;){var _=31-yr(f),R=1<<_;o|=a[_],f&=~R}return ns=o,ep(),u}function $p(a,o){Me=null,Rt.H=gd,o===yo||o===up?(o=hp(),an=3):o===vE?(o=hp(),an=4):an=o===QE?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,mr=o,Ue===null&&(ci=1,Up(a,na(o,a.current)))}function __(){var a=Rt.H;return Rt.H=gd,a===null?gd:a}function nR(){var a=Rt.A;return Rt.A=d_,a}function tf(){ci=4,es||($e&4194048)!==$e&&qr.current!==null||(Uo=!0),(xo&134217727)===0&&(Xr&134217727)===0||Mn===null||Fo(Mn,$e,ra,!1)}function g_(a,o,u){var f=Rn;Rn|=2;var _=__(),R=nR();(Mn!==a||$e!==o)&&(Nd=null,$l(a,o)),o=!1;var k=ci;t:do try{if(an!==0&&Ue!==null){var B=Ue,q=mr;switch(an){case 8:E_(),k=6;break t;case 3:case 2:case 9:case 6:qr.current===null&&(o=!0);var ut=an;if(an=0,mr=null,jo(a,B,q,ut),u&&Uo){k=0;break t}break;default:ut=an,an=0,mr=null,jo(a,B,q,ut)}}Dd(),k=ci;break}catch(_t){$p(a,_t)}while(!0);return o&&a.shellSuspendCounter++,Ls=Ds=null,Rn=f,Rt.H=_,Rt.A=R,Ue===null&&(Mn=null,$e=0,ep()),k}function Dd(){for(;Ue!==null;)rR(Ue)}function rs(a,o){var u=Rn;Rn|=2;var f=__(),_=nR();Mn!==a||$e!==o?(Nd=null,Xl=Ya()+500,$l(a,o)):Uo=ju(a,o);t:do try{if(an!==0&&Ue!==null){o=Ue;var R=mr;e:switch(an){case 1:an=0,mr=null,jo(a,o,R,1);break;case 2:case 9:if(CE(R)){an=0,mr=null,aR(o);break}o=function(){an!==2&&an!==9||Mn!==a||(an=7),Da(a)},R.then(o,o);break t;case 3:an=7;break t;case 4:an=5;break t;case 7:CE(R)?(an=0,mr=null,aR(o)):(an=0,mr=null,jo(a,o,R,7));break;case 5:var k=null;switch(Ue.tag){case 26:k=Ue.memoizedState;case 5:case 27:var B=Ue;if(!k||MR(k)){an=0,mr=null;var q=B.sibling;if(q!==null)Ue=q;else{var ut=B.return;ut!==null?(Ue=ut,Ld(ut)):Ue=null}break e}}an=0,mr=null,jo(a,o,R,5);break;case 6:an=0,mr=null,jo(a,o,R,6);break;case 8:E_(),ci=6;break t;default:throw Error(b(462))}}iR();break}catch(_t){$p(a,_t)}while(!0);return Ls=Ds=null,Rt.H=f,Rt.A=_,Rn=u,Ue!==null?0:(Mn=null,$e=0,ep(),ci)}function iR(){for(;Ue!==null&&!fl();)rR(Ue)}function rR(a){var o=GT(a.alternate,a,ns);a.memoizedProps=a.pendingProps,o===null?Ld(a):Ue=o}function aR(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=t_(u,o,o.pendingProps,o.type,void 0,$e);break;case 11:o=t_(u,o,o.pendingProps,o.type.render,o.ref,$e);break;case 5:hd(o);default:WT(u,o),o=Ue=tT(o,ns),o=GT(u,o,ns)}a.memoizedProps=a.pendingProps,o===null?Ld(a):Ue=o}function jo(a,o,u,f){Ls=Ds=null,hd(o),Wl=null,Sd=0;var _=o.return;try{if(dA(a,_,o,u,$e)){ci=1,Up(a,na(u,a.current)),Ue=null;return}}catch(R){if(_!==null)throw Ue=_,R;ci=1,Up(a,na(u,a.current)),Ue=null;return}o.flags&32768?(on||f===1?a=!0:Uo||($e&536870912)!==0?a=!1:(es=a=!0,(f===2||f===9||f===3||f===6)&&(f=qr.current,f!==null&&f.tag===13&&(f.flags|=16384))),sR(o,a)):Ld(o)}function Ld(a){var o=a;do{if((o.flags&32768)!==0){sR(o,es);return}a=o.return;var u=HT(o.alternate,o,ns);if(u!==null){Ue=u;return}if(o=o.sibling,o!==null){Ue=o;return}Ue=o=a}while(o!==null);ci===0&&(ci=5)}function sR(a,o){do{var u=hA(a.alternate,a);if(u!==null){u.flags&=32767,Ue=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){Ue=a;return}Ue=a=u}while(a!==null);ci=6,Ue=null}function Pd(a,o,u,f,_,R,k,B,q){a.cancelPendingCommit=null;do ef();while(Gi!==0);if((Rn&6)!==0)throw Error(b(327));if(o!==null){if(o===a.current)throw Error(b(177));if(R=o.lanes|o.childLanes,R|=pE,bC(a,u,R,k,B,q),a===Mn&&(Ue=Mn=null,$e=0),Hc=o,Na=a,Bo=u,Jl=R,Ql=_,m_=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,_A(Wi,function(){return lR(),null})):(a.callbackNode=null,a.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=Rt.T,Rt.T=null,_=Jt.p,Jt.p=2,k=Rn,Rn|=4;try{pA(a,o,u)}finally{Rn=k,Jt.p=_,Rt.T=f}}Gi=1,Ws(),tu(),oR()}}function Ws(){if(Gi===1){Gi=0;var a=Na,o=Hc,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=Rt.T,Rt.T=null;var f=Jt.p;Jt.p=2;var _=Rn;Rn|=4;try{JT(o,a);var R=I_,k=YS(a.containerInfo),B=R.focusedElem,q=R.selectionRange;if(k!==B&&B&&B.ownerDocument&&KS(B.ownerDocument.documentElement,B)){if(q!==null&&pr(B)){var ut=q.start,_t=q.end;if(_t===void 0&&(_t=ut),"selectionStart"in B)B.selectionStart=ut,B.selectionEnd=Math.min(_t,B.value.length);else{var Dt=B.ownerDocument||document,ht=Dt&&Dt.defaultView||window;if(ht.getSelection){var pt=ht.getSelection(),ve=B.textContent.length,ae=Math.min(q.start,ve),wn=q.end===void 0?ae:Math.min(q.end,ve);!pt.extend&&ae>wn&&(k=wn,wn=ae,ae=k);var rt=Ra(B,ae),et=Ra(B,wn);if(rt&&et&&(pt.rangeCount!==1||pt.anchorNode!==rt.node||pt.anchorOffset!==rt.offset||pt.focusNode!==et.node||pt.focusOffset!==et.offset)){var lt=Dt.createRange();lt.setStart(rt.node,rt.offset),pt.removeAllRanges(),ae>wn?(pt.addRange(lt),pt.extend(et.node,et.offset)):(lt.setEnd(et.node,et.offset),pt.addRange(lt))}}}}for(Dt=[],pt=B;pt=pt.parentNode;)pt.nodeType===1&&Dt.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof B.focus=="function"&&B.focus(),B=0;B<Dt.length;B++){var Ot=Dt[B];Ot.element.scrollLeft=Ot.left,Ot.element.scrollTop=Ot.top}}Tf=!!b_,I_=b_=null}finally{Rn=_,Jt.p=f,Rt.T=u}}a.current=o,Gi=2}}function tu(){if(Gi===2){Gi=0;var a=Na,o=Hc,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=Rt.T,Rt.T=null;var f=Jt.p;Jt.p=2;var _=Rn;Rn|=4;try{o_(a,o.alternate,o)}finally{Rn=_,Jt.p=f,Rt.T=u}}Gi=3}}function oR(){if(Gi===4||Gi===3){Gi=0,yC();var a=Na,o=Hc,u=Bo,f=m_;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Gi=5:(Gi=0,Hc=Na=null,cR(a,a.pendingLanes));var _=a.pendingLanes;if(_===0&&(Gs=null),fo(u),o=o.stateNode,kn&&typeof kn.onCommitFiberRoot=="function")try{kn.onCommitFiberRoot(ml,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=Rt.T,_=Jt.p,Jt.p=2,Rt.T=null;try{for(var R=a.onRecoverableError,k=0;k<f.length;k++){var B=f[k];R(B.value,{componentStack:B.stack})}}finally{Rt.T=o,Jt.p=_}}(Bo&3)!==0&&ef(),Da(a),_=a.pendingLanes,(u&4194090)!==0&&(_&42)!==0?a===Hs?is++:(is=0,Hs=a):is=0,Ud(0)}}function cR(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,sd(o)))}function ef(a){return Ws(),tu(),oR(),lR()}function lR(){if(Gi!==5)return!1;var a=Na,o=Jl;Jl=0;var u=fo(Bo),f=Rt.T,_=Jt.p;try{Jt.p=32>u?32:u,Rt.T=null,u=Ql,Ql=null;var R=Na,k=Bo;if(Gi=0,Hc=Na=null,Bo=0,(Rn&6)!==0)throw Error(b(331));var B=Rn;if(Rn|=4,Xp(R.current),ZT(R,R.current,k,u),Rn=B,Ud(0,!1),kn&&typeof kn.onPostCommitFiberRoot=="function")try{kn.onPostCommitFiberRoot(ml,R)}catch{}return!0}finally{Jt.p=_,Rt.T=f,cR(a,o)}}function nf(a,o,u){o=na(u,o),o=JE(a.stateNode,o,2),a=Ca(a,o,2),a!==null&&(Gu(a,2),Da(a))}function Un(a,o,u){if(a.tag===3)nf(a,a,u);else for(;o!==null;){if(o.tag===3){nf(o,a,u);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Gs===null||!Gs.has(f))){a=na(u,a),u=MT(2),f=Ca(o,u,2),f!==null&&(UT(u,f,o,a),Gu(f,2),Da(f));break}}o=o.return}}function S_(a,o,u){var f=a.pingCache;if(f===null){f=a.pingCache=new h_;var _=new Set;f.set(o,_)}else _=f.get(o),_===void 0&&(_=new Set,f.set(o,_));_.has(u)||(Jp=!0,_.add(u),a=mA.bind(null,a,o,u),o.then(a,a))}function mA(a,o,u){var f=a.pingCache;f!==null&&f.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,Mn===a&&($e&u)===u&&(ci===4||ci===3&&($e&62914560)===$e&&300>Ya()-f_?(Rn&2)===0&&$l(a,0):Qp|=u,Vo===$e&&(Vo=0)),Da(a)}function T_(a,o){o===0&&(o=km()),a=go(a,o),a!==null&&(Gu(a,o),Da(a))}function R_(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),T_(a,u)}function EA(a,o){var u=0;switch(a.tag){case 13:var f=a.stateNode,_=a.memoizedState;_!==null&&(u=_.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(b(314))}f!==null&&f.delete(o),T_(a,u)}function _A(a,o){return wm(a,o)}var rf=null,Wc=null,kd=!1,Md=!1,af=!1,as=0;function Da(a){a!==Wc&&a.next===null&&(Wc===null?rf=Wc=a:Wc=Wc.next=a),Md=!0,kd||(kd=!0,hR())}function Ud(a,o){if(!af&&Md){af=!0;do for(var u=!1,f=rf;f!==null;){if(a!==0){var _=f.pendingLanes;if(_===0)var R=0;else{var k=f.suspendedLanes,B=f.pingedLanes;R=(1<<31-yr(42|a)+1)-1,R&=_&~(k&~B),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(u=!0,sf(f,R))}else R=$e,R=Fu(f,f===Mn?R:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(R&3)===0||ju(f,R)||(u=!0,sf(f,R));f=f.next}while(u);af=!1}}function v_(){uR()}function uR(){Md=kd=!1;var a=0;as!==0&&(RA()&&(a=as),as=0);for(var o=Ya(),u=null,f=rf;f!==null;){var _=f.next,R=dR(f,o);R===0?(f.next=null,u===null?rf=_:u.next=_,_===null&&(Wc=u)):(u=f,(a!==0||(R&3)!==0)&&(Md=!0)),f=_}Ud(a)}function dR(a,o){for(var u=a.suspendedLanes,f=a.pingedLanes,_=a.expirationTimes,R=a.pendingLanes&-62914561;0<R;){var k=31-yr(R),B=1<<k,q=_[k];q===-1?((B&u)===0||(B&f)!==0)&&(_[k]=AC(B,o)):q<=o&&(a.expiredLanes|=B),R&=~B}if(o=Mn,u=$e,u=Fu(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f=a.callbackNode,u===0||a===o&&(an===2||an===9)||a.cancelPendingCommit!==null)return f!==null&&f!==null&&Nm(f),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||ju(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(f!==null&&Nm(f),fo(u)){case 2:case 8:u=hS;break;case 32:u=Wi;break;case 268435456:u=Mh;break;default:u=Wi}return f=eu.bind(null,a),u=wm(u,f),a.callbackPriority=o,a.callbackNode=u,o}return f!==null&&f!==null&&Nm(f),a.callbackPriority=2,a.callbackNode=null,2}function eu(a,o){if(Gi!==0&&Gi!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(ef()&&a.callbackNode!==u)return null;var f=$e;return f=Fu(a,a===Mn?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f===0?null:(Zl(a,f,o),dR(a,Ya()),a.callbackNode!=null&&a.callbackNode===u?eu.bind(null,a):null)}function sf(a,o){if(ef())return null;Zl(a,o,!0)}function hR(){yA(function(){(Rn&6)!==0?wm(Dm,v_):uR()})}function xd(){return as===0&&(as=gc()),as}function of(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Hh(""+a)}function cf(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function gA(a,o,u,f,_){if(o==="submit"&&u&&u.stateNode===_){var R=of((_[Cr]||null).action),k=f.submitter;k&&(o=(o=k[Cr]||null)?of(o.formAction):k.getAttribute("formAction"),o!==null&&(R=o,k=null));var B=new dr("action","action",null,f,_);a.push({event:B,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(as!==0){var q=k?cf(_,k):new FormData(_);WE(u,{pending:!0,data:q,method:_.method,action:R},null,q)}}else typeof R=="function"&&(B.preventDefault(),q=k?cf(_,k):new FormData(_),WE(u,{pending:!0,data:q,method:_.method,action:R},R,q))},currentTarget:_}]})}}for(var y_=0;y_<hE.length;y_++){var lf=hE[y_],pR=lf.toLowerCase(),fR=lf[0].toUpperCase()+lf.slice(1);va(pR,"on"+fR)}va($h,"onAnimationEnd"),va(tp,"onAnimationIteration"),va(XS,"onAnimationStart"),va("dblclick","onDoubleClick"),va("focusin","onFocus"),va("focusout","onBlur"),va(Et,"onTransitionRun"),va(ZC,"onTransitionStart"),va($C,"onTransitionCancel"),va(JS,"onTransitionEnd"),Tl("onMouseEnter",["mouseout","mouseover"]),Tl("onMouseLeave",["mouseout","mouseover"]),Tl("onPointerEnter",["pointerout","pointerover"]),Tl("onPointerLeave",["pointerout","pointerover"]),vc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vc("onBeforeInput",["compositionend","keypress","textInput","paste"]),vc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mR=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(nu));function ER(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var f=a[u],_=f.event;f=f.listeners;t:{var R=void 0;if(o)for(var k=f.length-1;0<=k;k--){var B=f[k],q=B.instance,ut=B.currentTarget;if(B=B.listener,q!==R&&_.isPropagationStopped())break t;R=B,_.currentTarget=ut;try{R(_)}catch(_t){kp(_t)}_.currentTarget=null,R=q}else for(k=0;k<f.length;k++){if(B=f[k],q=B.instance,ut=B.currentTarget,B=B.listener,q!==R&&_.isPropagationStopped())break t;R=B,_.currentTarget=ut;try{R(_)}catch(_t){kp(_t)}_.currentTarget=null,R=q}}}}function He(a,o){var u=o[gl];u===void 0&&(u=o[gl]=new Set);var f=a+"__bubble";u.has(f)||(uf(o,a,2,!1),u.add(f))}function C_(a,o,u){var f=0;o&&(f|=4),uf(u,a,f,o)}var Ks="_reactListening"+Math.random().toString(36).slice(2);function Go(a){if(!a[Ks]){a[Ks]=!0,Vm.forEach(function(u){u!=="selectionchange"&&(mR.has(u)||C_(u,!1,a),C_(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Ks]||(o[Ks]=!0,C_("selectionchange",!1,o))}}function uf(a,o,u,f){switch(jR(o)){case 2:var _=xA;break;case 8:_=Lr;break;default:_=B_}u=_.bind(null,o,u,a),_=void 0,!Xm||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),f?_!==void 0?a.addEventListener(o,u,{capture:!0,passive:_}):a.addEventListener(o,u,!0):_!==void 0?a.addEventListener(o,u,{passive:_}):a.addEventListener(o,u,!1)}function df(a,o,u,f,_){var R=f;if((o&1)===0&&(o&2)===0&&f!==null)t:for(;;){if(f===null)return;var k=f.tag;if(k===3||k===4){var B=f.stateNode.containerInfo;if(B===_)break;if(k===4)for(k=f.return;k!==null;){var q=k.tag;if((q===3||q===4)&&k.stateNode.containerInfo===_)return;k=k.return}for(;B!==null;){if(k=Sc(B),k===null)return;if(q=k.tag,q===5||q===6||q===26||q===27){f=R=k;continue t}B=B.parentNode}}f=f.return}qm(function(){var ut=R,_t=Ym(u),Dt=[];t:{var ht=QS.get(a);if(ht!==void 0){var pt=dr,ve=a;switch(a){case"keypress":if(qu(u)===0)break t;case"keydown":case"keyup":pt=xC;break;case"focusin":ve="focus",pt=$m;break;case"focusout":ve="blur",pt=$m;break;case"beforeblur":case"afterblur":pt=$m;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=DS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=zh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=bl;break;case $h:case tp:case XS:pt=PC;break;case JS:pt=FC;break;case"scroll":case"scrollend":pt=DC;break;case"wheel":pt=jC;break;case"copy":case"cut":case"paste":pt=nE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=Cc;break;case"toggle":case"beforetoggle":pt=HC}var ae=(o&4)!==0,wn=!ae&&(a==="scroll"||a==="scrollend"),rt=ae?ht!==null?ht+"Capture":null:ht;ae=[];for(var et=ut,lt;et!==null;){var Ot=et;if(lt=Ot.stateNode,Ot=Ot.tag,Ot!==5&&Ot!==26&&Ot!==27||lt===null||rt===null||(Ot=zu(et,rt),Ot!=null&&ae.push(iu(et,Ot,lt))),wn)break;et=et.return}0<ae.length&&(ht=new pt(ht,ve,null,u,_t),Dt.push({event:ht,listeners:ae}))}}if((o&7)===0){t:{if(ht=a==="mouseover"||a==="pointerover",pt=a==="mouseout"||a==="pointerout",ht&&u!==Km&&(ve=u.relatedTarget||u.fromElement)&&(Sc(ve)||ve[_l]))break t;if((pt||ht)&&(ht=_t.window===_t?_t:(ht=_t.ownerDocument)?ht.defaultView||ht.parentWindow:window,pt?(ve=u.relatedTarget||u.toElement,pt=ut,ve=ve?Sc(ve):null,ve!==null&&(wn=x(ve),ae=ve.tag,ve!==wn||ae!==5&&ae!==27&&ae!==6)&&(ve=null)):(pt=null,ve=ut),pt!==ve)){if(ae=DS,Ot="onMouseLeave",rt="onMouseEnter",et="mouse",(a==="pointerout"||a==="pointerover")&&(ae=Cc,Ot="onPointerLeave",rt="onPointerEnter",et="pointer"),wn=pt==null?ht:Wu(pt),lt=ve==null?ht:Wu(ve),ht=new ae(Ot,et+"leave",pt,u,_t),ht.target=wn,ht.relatedTarget=lt,Ot=null,Sc(_t)===ut&&(ae=new ae(rt,et+"enter",ve,u,_t),ae.target=lt,ae.relatedTarget=wn,Ot=ae),wn=Ot,pt&&ve)e:{for(ae=pt,rt=ve,et=0,lt=ae;lt;lt=Kc(lt))et++;for(lt=0,Ot=rt;Ot;Ot=Kc(Ot))lt++;for(;0<et-lt;)ae=Kc(ae),et--;for(;0<lt-et;)rt=Kc(rt),lt--;for(;et--;){if(ae===rt||rt!==null&&ae===rt.alternate)break e;ae=Kc(ae),rt=Kc(rt)}ae=null}else ae=null;pt!==null&&_R(Dt,ht,pt,ae,!1),ve!==null&&wn!==null&&_R(Dt,wn,ve,ae,!0)}}t:{if(ht=ut?Wu(ut):window,pt=ht.nodeName&&ht.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ht.type==="file")var Yt=BS;else if(VS(ht))if(FS)Yt=JC;else{Yt=uE;var We=HS}else pt=ht.nodeName,!pt||pt.toLowerCase()!=="input"||ht.type!=="checkbox"&&ht.type!=="radio"?ut&&Wm(ut.elementType)&&(Yt=BS):Yt=XC;if(Yt&&(Yt=Yt(a,ut))){sE(Dt,Yt,u,_t);break t}We&&We(a,ht,ut),a==="focusout"&&ut&&ht.type==="number"&&ut.memoizedProps.value!=null&&Gm(ht,"number",ht.value)}switch(We=ut?Wu(ut):window,a){case"focusin":(VS(We)||We.contentEditable==="true")&&(Ol=We,dE=ut,$u=null);break;case"focusout":$u=dE=Ol=null;break;case"mousedown":Qh=!0;break;case"contextmenu":case"mouseup":case"dragend":Qh=!1,zS(Dt,u,_t);break;case"selectionchange":if(QC)break;case"keydown":case"keyup":zS(Dt,u,_t)}var ie;if(Xu)t:{switch(a){case"compositionstart":var he="onCompositionStart";break t;case"compositionend":he="onCompositionEnd";break t;case"compositionupdate":he="onCompositionUpdate";break t}he=void 0}else Il?xS(a,u)&&(he="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(he="onCompositionStart");he&&(MS&&u.locale!=="ko"&&(Il||he!=="onCompositionStart"?he==="onCompositionEnd"&&Il&&(ie=wS()):(Eo=_t,Jm="value"in Eo?Eo.value:Eo.textContent,Il=!0)),We=hf(ut,he),0<We.length&&(he=new PS(he,a,null,u,_t),Dt.push({event:he,listeners:We}),ie?he.data=ie:(ie=aE(u),ie!==null&&(he.data=ie)))),(ie=KC?Is(a,u):YC(a,u))&&(he=hf(ut,"onBeforeInput"),0<he.length&&(We=new PS("onBeforeInput","beforeinput",null,u,_t),Dt.push({event:We,listeners:he}),We.data=ie)),gA(Dt,a,ut,u,_t)}ER(Dt,o)})}function iu(a,o,u){return{instance:a,listener:o,currentTarget:u}}function hf(a,o){for(var u=o+"Capture",f=[];a!==null;){var _=a,R=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||R===null||(_=zu(a,u),_!=null&&f.unshift(iu(a,_,R)),_=zu(a,o),_!=null&&f.push(iu(a,_,R))),a.tag===3)return f;a=a.return}return[]}function Kc(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function _R(a,o,u,f,_){for(var R=o._reactName,k=[];u!==null&&u!==f;){var B=u,q=B.alternate,ut=B.stateNode;if(B=B.tag,q!==null&&q===f)break;B!==5&&B!==26&&B!==27||ut===null||(q=ut,_?(ut=zu(u,R),ut!=null&&k.unshift(iu(u,ut,q))):_||(ut=zu(u,R),ut!=null&&k.push(iu(u,ut,q)))),u=u.return}k.length!==0&&a.push({event:o,listeners:k})}var SA=/\r\n?/g,pf=/\u0000|\uFFFD/g;function gR(a){return(typeof a=="string"?a:""+a).replace(SA,`
`).replace(pf,"")}function SR(a,o){return o=gR(o),gR(a)===o}function ff(){}function On(a,o,u,f,_,R){switch(u){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||yc(a,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&yc(a,""+f);break;case"className":Vh(a,"class",f);break;case"tabIndex":Vh(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Vh(a,u,f);break;case"style":Gh(a,f,R);break;case"data":if(o!=="object"){Vh(a,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=Hh(""+f),a.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(u==="formAction"?(o!=="input"&&On(a,o,"name",_.name,_,null),On(a,o,"formEncType",_.formEncType,_,null),On(a,o,"formMethod",_.formMethod,_,null),On(a,o,"formTarget",_.formTarget,_,null)):(On(a,o,"encType",_.encType,_,null),On(a,o,"method",_.method,_,null),On(a,o,"target",_.target,_,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=Hh(""+f),a.setAttribute(u,f);break;case"onClick":f!=null&&(a.onclick=ff);break;case"onScroll":f!=null&&He("scroll",a);break;case"onScrollEnd":f!=null&&He("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(b(61));if(u=f.__html,u!=null){if(_.children!=null)throw Error(b(60));a.innerHTML=u}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}u=Hh(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""+f):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":f===!0?a.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,f):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(u,f):a.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(u):a.setAttribute(u,f);break;case"popover":He("beforetoggle",a),He("toggle",a),xh(a,"popover",f);break;case"xlinkActuate":Cs(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Cs(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Cs(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Cs(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Cs(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Cs(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":xh(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=IS.get(u)||u,xh(a,u,f))}}function A_(a,o,u,f,_,R){switch(u){case"style":Gh(a,f,R);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(b(61));if(u=f.__html,u!=null){if(_.children!=null)throw Error(b(60));a.innerHTML=u}}break;case"children":typeof f=="string"?yc(a,f):(typeof f=="number"||typeof f=="bigint")&&yc(a,""+f);break;case"onScroll":f!=null&&He("scroll",a);break;case"onScrollEnd":f!=null&&He("scrollend",a);break;case"onClick":f!=null&&(a.onclick=ff);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Rc.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(_=u.endsWith("Capture"),o=u.slice(2,_?u.length-7:void 0),R=a[Cr]||null,R=R!=null?R[u]:null,typeof R=="function"&&a.removeEventListener(o,R,_),typeof f=="function")){typeof R!="function"&&R!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,f,_);break t}u in a?a[u]=f:f===!0?a.setAttribute(u,""):xh(a,u,f)}}}function Xi(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":He("error",a),He("load",a);var f=!1,_=!1,R;for(R in u)if(u.hasOwnProperty(R)){var k=u[R];if(k!=null)switch(R){case"src":f=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(b(137,o));default:On(a,o,R,k,u,null)}}_&&On(a,o,"srcSet",u.srcSet,u,null),f&&On(a,o,"src",u.src,u,null);return;case"input":He("invalid",a);var B=R=k=_=null,q=null,ut=null;for(f in u)if(u.hasOwnProperty(f)){var _t=u[f];if(_t!=null)switch(f){case"name":_=_t;break;case"type":k=_t;break;case"checked":q=_t;break;case"defaultChecked":ut=_t;break;case"value":R=_t;break;case"defaultValue":B=_t;break;case"children":case"dangerouslySetInnerHTML":if(_t!=null)throw Error(b(137,o));break;default:On(a,o,f,_t,u,null)}}CS(a,R,B,q,ut,k,_,!1),dn(a);return;case"select":He("invalid",a),f=k=R=null;for(_ in u)if(u.hasOwnProperty(_)&&(B=u[_],B!=null))switch(_){case"value":R=B;break;case"defaultValue":k=B;break;case"multiple":f=B;default:On(a,o,_,B,u,null)}o=R,u=k,a.multiple=!!f,o!=null?vl(a,!!f,o,!1):u!=null&&vl(a,!!f,u,!0);return;case"textarea":He("invalid",a),R=_=f=null;for(k in u)if(u.hasOwnProperty(k)&&(B=u[k],B!=null))switch(k){case"value":f=B;break;case"defaultValue":_=B;break;case"children":R=B;break;case"dangerouslySetInnerHTML":if(B!=null)throw Error(b(91));break;default:On(a,o,k,B,u,null)}Yu(a,f,_,R),dn(a);return;case"option":for(q in u)if(u.hasOwnProperty(q)&&(f=u[q],f!=null))switch(q){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:On(a,o,q,f,u,null)}return;case"dialog":He("beforetoggle",a),He("toggle",a),He("cancel",a),He("close",a);break;case"iframe":case"object":He("load",a);break;case"video":case"audio":for(f=0;f<nu.length;f++)He(nu[f],a);break;case"image":He("error",a),He("load",a);break;case"details":He("toggle",a);break;case"embed":case"source":case"link":He("error",a),He("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ut in u)if(u.hasOwnProperty(ut)&&(f=u[ut],f!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":throw Error(b(137,o));default:On(a,o,ut,f,u,null)}return;default:if(Wm(o)){for(_t in u)u.hasOwnProperty(_t)&&(f=u[_t],f!==void 0&&A_(a,o,_t,f,u,void 0));return}}for(B in u)u.hasOwnProperty(B)&&(f=u[B],f!=null&&On(a,o,B,f,u,null))}function TA(a,o,u,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,R=null,k=null,B=null,q=null,ut=null,_t=null;for(pt in u){var Dt=u[pt];if(u.hasOwnProperty(pt)&&Dt!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":q=Dt;default:f.hasOwnProperty(pt)||On(a,o,pt,null,f,Dt)}}for(var ht in f){var pt=f[ht];if(Dt=u[ht],f.hasOwnProperty(ht)&&(pt!=null||Dt!=null))switch(ht){case"type":R=pt;break;case"name":_=pt;break;case"checked":ut=pt;break;case"defaultChecked":_t=pt;break;case"value":k=pt;break;case"defaultValue":B=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(b(137,o));break;default:pt!==Dt&&On(a,o,ht,pt,f,Dt)}}jm(a,k,B,q,ut,_t,R,_);return;case"select":pt=k=B=ht=null;for(R in u)if(q=u[R],u.hasOwnProperty(R)&&q!=null)switch(R){case"value":break;case"multiple":pt=q;default:f.hasOwnProperty(R)||On(a,o,R,null,f,q)}for(_ in f)if(R=f[_],q=u[_],f.hasOwnProperty(_)&&(R!=null||q!=null))switch(_){case"value":ht=R;break;case"defaultValue":B=R;break;case"multiple":k=R;default:R!==q&&On(a,o,_,R,f,q)}o=B,u=k,f=pt,ht!=null?vl(a,!!u,ht,!1):!!f!=!!u&&(o!=null?vl(a,!!u,o,!0):vl(a,!!u,u?[]:"",!1));return;case"textarea":pt=ht=null;for(B in u)if(_=u[B],u.hasOwnProperty(B)&&_!=null&&!f.hasOwnProperty(B))switch(B){case"value":break;case"children":break;default:On(a,o,B,null,f,_)}for(k in f)if(_=f[k],R=u[k],f.hasOwnProperty(k)&&(_!=null||R!=null))switch(k){case"value":ht=_;break;case"defaultValue":pt=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(b(91));break;default:_!==R&&On(a,o,k,_,f,R)}AS(a,ht,pt);return;case"option":for(var ve in u)if(ht=u[ve],u.hasOwnProperty(ve)&&ht!=null&&!f.hasOwnProperty(ve))switch(ve){case"selected":a.selected=!1;break;default:On(a,o,ve,null,f,ht)}for(q in f)if(ht=f[q],pt=u[q],f.hasOwnProperty(q)&&ht!==pt&&(ht!=null||pt!=null))switch(q){case"selected":a.selected=ht&&typeof ht!="function"&&typeof ht!="symbol";break;default:On(a,o,q,ht,f,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ae in u)ht=u[ae],u.hasOwnProperty(ae)&&ht!=null&&!f.hasOwnProperty(ae)&&On(a,o,ae,null,f,ht);for(ut in f)if(ht=f[ut],pt=u[ut],f.hasOwnProperty(ut)&&ht!==pt&&(ht!=null||pt!=null))switch(ut){case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(b(137,o));break;default:On(a,o,ut,ht,f,pt)}return;default:if(Wm(o)){for(var wn in u)ht=u[wn],u.hasOwnProperty(wn)&&ht!==void 0&&!f.hasOwnProperty(wn)&&A_(a,o,wn,void 0,f,ht);for(_t in f)ht=f[_t],pt=u[_t],!f.hasOwnProperty(_t)||ht===pt||ht===void 0&&pt===void 0||A_(a,o,_t,ht,f,pt);return}}for(var rt in u)ht=u[rt],u.hasOwnProperty(rt)&&ht!=null&&!f.hasOwnProperty(rt)&&On(a,o,rt,null,f,ht);for(Dt in f)ht=f[Dt],pt=u[Dt],!f.hasOwnProperty(Dt)||ht===pt||ht==null&&pt==null||On(a,o,Dt,ht,f,pt)}var b_=null,I_=null;function mf(a){return a.nodeType===9?a:a.ownerDocument}function TR(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function RR(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function O_(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var w_=null;function RA(){var a=window.event;return a&&a.type==="popstate"?a===w_?!1:(w_=a,!0):(w_=null,!1)}var vR=typeof setTimeout=="function"?setTimeout:void 0,vA=typeof clearTimeout=="function"?clearTimeout:void 0,N_=typeof Promise=="function"?Promise:void 0,yA=typeof queueMicrotask=="function"?queueMicrotask:typeof N_<"u"?function(a){return N_.resolve(null).then(a).catch(CA)}:vR;function CA(a){setTimeout(function(){throw a})}function Ho(a){return a==="head"}function yR(a,o){var u=o,f=0,_=0;do{var R=u.nextSibling;if(a.removeChild(u),R&&R.nodeType===8)if(u=R.data,u==="/$"){if(0<f&&8>f){u=f;var k=a.ownerDocument;if(u&1&&Vd(k.documentElement),u&2&&Vd(k.body),u&4)for(u=k.head,Vd(u),k=u.firstChild;k;){var B=k.nextSibling,q=k.nodeName;k[Hu]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&k.rel.toLowerCase()==="stylesheet"||u.removeChild(k),k=B}}if(_===0){a.removeChild(R),Pr(o);return}_--}else u==="$"||u==="$?"||u==="$!"?_++:f=u.charCodeAt(0)-48;else f=0;u=R}while(u);Pr(o)}function D_(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":D_(u),Uh(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function AA(a,o,u,f){for(;a.nodeType===1;){var _=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[Hu])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(R=a.getAttribute("rel"),R==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(R!==_.rel||a.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||a.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||a.getAttribute("title")!==(_.title==null?null:_.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(R=a.getAttribute("src"),(R!==(_.src==null?null:_.src)||a.getAttribute("type")!==(_.type==null?null:_.type)||a.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&R&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var R=_.name==null?null:""+_.name;if(_.type==="hidden"&&a.getAttribute("name")===R)return a}else return a;if(a=La(a.nextSibling),a===null)break}return null}function bA(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=La(a.nextSibling),a===null))return null;return a}function L_(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function IA(a,o){var u=a.ownerDocument;if(a.data!=="$?"||u.readyState==="complete")o();else{var f=function(){o(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),a._reactRetry=f}}function La(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}var P_=null;function CR(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return a;o--}else u==="/$"&&o++}a=a.previousSibling}return null}function AR(a,o,u){switch(o=mf(u),a){case"html":if(a=o.documentElement,!a)throw Error(b(452));return a;case"head":if(a=o.head,!a)throw Error(b(453));return a;case"body":if(a=o.body,!a)throw Error(b(454));return a;default:throw Error(b(451))}}function Vd(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Uh(a)}var aa=new Map,bR=new Set;function Ef(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var ss=Jt.d;Jt.d={f:OA,r:k_,D:wA,C:NA,L:OR,m:DA,X:LA,S:M_,M:PA};function OA(){var a=ss.f(),o=Zp();return a||o}function k_(a){var o=Sl(a);o!==null&&o.tag===5&&o.type==="form"?Op(o):ss.r(a)}var ru=typeof document>"u"?null:document;function IR(a,o,u){var f=ru;if(f&&typeof o=="string"&&o){var _=ea(o);_='link[rel="'+a+'"][href="'+_+'"]',typeof u=="string"&&(_+='[crossorigin="'+u+'"]'),bR.has(_)||(bR.add(_),a={rel:a,crossOrigin:u,href:o},f.querySelector(_)===null&&(o=f.createElement("link"),Xi(o,"link",a),vi(o),f.head.appendChild(o)))}}function wA(a){ss.D(a),IR("dns-prefetch",a,null)}function NA(a,o){ss.C(a,o),IR("preconnect",a,o)}function OR(a,o,u){ss.L(a,o,u);var f=ru;if(f&&a&&o){var _='link[rel="preload"][as="'+ea(o)+'"]';o==="image"&&u&&u.imageSrcSet?(_+='[imagesrcset="'+ea(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(_+='[imagesizes="'+ea(u.imageSizes)+'"]')):_+='[href="'+ea(a)+'"]';var R=_;switch(o){case"style":R=au(a);break;case"script":R=Wo(a)}aa.has(R)||(a=Z({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),aa.set(R,a),f.querySelector(_)!==null||o==="style"&&f.querySelector(su(R))||o==="script"&&f.querySelector(Bd(R))||(o=f.createElement("link"),Xi(o,"link",a),vi(o),f.head.appendChild(o)))}}function DA(a,o){ss.m(a,o);var u=ru;if(u&&a){var f=o&&typeof o.as=="string"?o.as:"script",_='link[rel="modulepreload"][as="'+ea(f)+'"][href="'+ea(a)+'"]',R=_;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=Wo(a)}if(!aa.has(R)&&(a=Z({rel:"modulepreload",href:a},o),aa.set(R,a),u.querySelector(_)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Bd(R)))return}f=u.createElement("link"),Xi(f,"link",a),vi(f),u.head.appendChild(f)}}}function M_(a,o,u){ss.S(a,o,u);var f=ru;if(f&&a){var _=Tc(f).hoistableStyles,R=au(a);o=o||"default";var k=_.get(R);if(!k){var B={loading:0,preload:null};if(k=f.querySelector(su(R)))B.loading=5;else{a=Z({rel:"stylesheet",href:a,"data-precedence":o},u),(u=aa.get(R))&&U_(a,u);var q=k=f.createElement("link");vi(q),Xi(q,"link",a),q._p=new Promise(function(ut,_t){q.onload=ut,q.onerror=_t}),q.addEventListener("load",function(){B.loading|=1}),q.addEventListener("error",function(){B.loading|=2}),B.loading|=4,Fd(k,o,f)}k={type:"stylesheet",instance:k,count:1,state:B},_.set(R,k)}}}function LA(a,o){ss.X(a,o);var u=ru;if(u&&a){var f=Tc(u).hoistableScripts,_=Wo(a),R=f.get(_);R||(R=u.querySelector(Bd(_)),R||(a=Z({src:a,async:!0},o),(o=aa.get(_))&&_f(a,o),R=u.createElement("script"),vi(R),Xi(R,"link",a),u.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},f.set(_,R))}}function PA(a,o){ss.M(a,o);var u=ru;if(u&&a){var f=Tc(u).hoistableScripts,_=Wo(a),R=f.get(_);R||(R=u.querySelector(Bd(_)),R||(a=Z({src:a,async:!0,type:"module"},o),(o=aa.get(_))&&_f(a,o),R=u.createElement("script"),vi(R),Xi(R,"link",a),u.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},f.set(_,R))}}function wR(a,o,u,f){var _=(_=pe.current)?Ef(_):null;if(!_)throw Error(b(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=au(u.href),u=Tc(_).hoistableStyles,f=u.get(o),f||(f={type:"style",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=au(u.href);var R=Tc(_).hoistableStyles,k=R.get(a);if(k||(_=_.ownerDocument||_,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(a,k),(R=_.querySelector(su(a)))&&!R._p&&(k.instance=R,k.state.loading=5),aa.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},aa.set(a,u),R||DR(_,a,u,k.state))),o&&f===null)throw Error(b(528,""));return k}if(o&&f!==null)throw Error(b(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Wo(u),u=Tc(_).hoistableScripts,f=u.get(o),f||(f={type:"script",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(b(444,a))}}function au(a){return'href="'+ea(a)+'"'}function su(a){return'link[rel="stylesheet"]['+a+"]"}function NR(a){return Z({},a,{"data-precedence":a.precedence,precedence:null})}function DR(a,o,u,f){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=a.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Xi(o,"link",u),vi(o),a.head.appendChild(o))}function Wo(a){return'[src="'+ea(a)+'"]'}function Bd(a){return"script[async]"+a}function LR(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var f=a.querySelector('style[data-href~="'+ea(u.href)+'"]');if(f)return o.instance=f,vi(f),f;var _=Z({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),vi(f),Xi(f,"style",_),Fd(f,u.precedence,a),o.instance=f;case"stylesheet":_=au(u.href);var R=a.querySelector(su(_));if(R)return o.state.loading|=4,o.instance=R,vi(R),R;f=NR(u),(_=aa.get(_))&&U_(f,_),R=(a.ownerDocument||a).createElement("link"),vi(R);var k=R;return k._p=new Promise(function(B,q){k.onload=B,k.onerror=q}),Xi(R,"link",f),o.state.loading|=4,Fd(R,u.precedence,a),o.instance=R;case"script":return R=Wo(u.src),(_=a.querySelector(Bd(R)))?(o.instance=_,vi(_),_):(f=u,(_=aa.get(R))&&(f=Z({},u),_f(f,_)),a=a.ownerDocument||a,_=a.createElement("script"),vi(_),Xi(_,"link",f),a.head.appendChild(_),o.instance=_);case"void":return null;default:throw Error(b(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,Fd(f,u.precedence,a));return o.instance}function Fd(a,o,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=f.length?f[f.length-1]:null,R=_,k=0;k<f.length;k++){var B=f[k];if(B.dataset.precedence===o)R=B;else if(R!==_)break}R?R.parentNode.insertBefore(a,R.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function U_(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function _f(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var jd=null;function PR(a,o,u){if(jd===null){var f=new Map,_=jd=new Map;_.set(u,f)}else _=jd,f=_.get(u),f||(f=new Map,_.set(u,f));if(f.has(a))return f;for(f.set(a,null),u=u.getElementsByTagName(a),_=0;_<u.length;_++){var R=u[_];if(!(R[Hu]||R[In]||a==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var k=R.getAttribute(o)||"";k=a+k;var B=f.get(k);B?B.push(R):f.set(k,[R])}}return f}function kR(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function kA(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function MR(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Gd=null;function MA(){}function UA(a,o,u){if(Gd===null)throw Error(b(475));var f=Gd;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var _=au(u.href),R=a.querySelector(su(_));if(R){a=R._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(f.count++,f=Hd.bind(f),a.then(f,f)),o.state.loading|=4,o.instance=R,vi(R);return}R=a.ownerDocument||a,u=NR(u),(_=aa.get(_))&&U_(u,_),R=R.createElement("link"),vi(R);var k=R;k._p=new Promise(function(B,q){k.onload=B,k.onerror=q}),Xi(R,"link",u),o.instance=R}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Hd.bind(f),a.addEventListener("load",o),a.addEventListener("error",o))}}function UR(){if(Gd===null)throw Error(b(475));var a=Gd;return a.stylesheets&&a.count===0&&gf(a,a.stylesheets),0<a.count?function(o){var u=setTimeout(function(){if(a.stylesheets&&gf(a,a.stylesheets),a.unsuspend){var f=a.unsuspend;a.unsuspend=null,f()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(u)}}:null}function Hd(){if(this.count--,this.count===0){if(this.stylesheets)gf(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var ou=null;function gf(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,ou=new Map,o.forEach(x_,a),ou=null,Hd.call(a))}function x_(a,o){if(!(o.state.loading&4)){var u=ou.get(a);if(u)var f=u.get(null);else{u=new Map,ou.set(a,u);for(var _=a.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<_.length;R++){var k=_[R];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(u.set(k.dataset.precedence,k),f=k)}f&&u.set(null,f)}_=o.instance,k=_.getAttribute("data-precedence"),R=u.get(k)||f,R===f&&u.set(null,_),u.set(k,_),this.count++,f=Hd.bind(this),_.addEventListener("load",f),_.addEventListener("error",f),R?R.parentNode.insertBefore(_,R.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(_,a.firstChild)),o.state.loading|=4}}var cu={$$typeof:Ft,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function St(a,o,u,f,_,R,k,B){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Mm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Mm(0),this.hiddenUpdates=Mm(null),this.identifierPrefix=f,this.onUncaughtError=_,this.onCaughtError=R,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function xR(a,o,u,f,_,R,k,B,q,ut,_t,Dt){return a=new St(a,o,u,k,B,q,ut,Dt),o=1,R===!0&&(o|=24),R=Yi(3,null,null,o),a.current=R,R.stateNode=a,o=cp(),o.refCount++,a.pooledCache=o,o.refCount++,R.memoizedState={element:f,isDehydrated:u,cache:o},ud(R),a}function VR(a){return a?(a=er,a):er}function BR(a,o,u,f,_,R){_=VR(_),f.context===null?f.context=_:f.pendingContext=_,f=Ms(o),f.payload={element:u},R=R===void 0?null:R,R!==null&&(f.callback=R),u=Ca(a,f,o),u!==null&&(Jr(u,a,o),Us(u,a,o))}function FR(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function V_(a,o){FR(a,o),(a=a.alternate)&&FR(a,o)}function Sf(a){if(a.tag===13){var o=go(a,67108864);o!==null&&Jr(o,a,67108864),V_(a,67108864)}}var Tf=!0;function xA(a,o,u,f){var _=Rt.T;Rt.T=null;var R=Jt.p;try{Jt.p=2,B_(a,o,u,f)}finally{Jt.p=R,Rt.T=_}}function Lr(a,o,u,f){var _=Rt.T;Rt.T=null;var R=Jt.p;try{Jt.p=8,B_(a,o,u,f)}finally{Jt.p=R,Rt.T=_}}function B_(a,o,u,f){if(Tf){var _=F_(f);if(_===null)df(a,o,f,lu,u),Rf(a,f);else if(BA(_,a,o,u,f))f.stopPropagation();else if(Rf(a,f),o&4&&-1<VA.indexOf(a)){for(;_!==null;){var R=Sl(_);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var k=Kr(R.pendingLanes);if(k!==0){var B=R;for(B.pendingLanes|=2,B.entangledLanes|=2;k;){var q=1<<31-yr(k);B.entanglements[1]|=q,k&=~q}Da(R),(Rn&6)===0&&(Xl=Ya()+500,Ud(0))}}break;case 13:B=go(R,2),B!==null&&Jr(B,R,2),Zp(),V_(R,2)}if(R=F_(f),R===null&&df(a,o,f,lu,u),R===_)break;_=R}_!==null&&f.stopPropagation()}else df(a,o,f,null,u)}}function F_(a){return a=Ym(a),j_(a)}var lu=null;function j_(a){if(lu=null,a=Sc(a),a!==null){var o=x(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=H(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return lu=a,null}function jR(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(po()){case Dm:return 2;case hS:return 8;case Wi:case Wr:return 32;case Mh:return 268435456;default:return 32}default:return 32}}var G_=!1,Ko=null,Pa=null,Ys=null,Wd=new Map,Kd=new Map,Yo=[],VA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rf(a,o){switch(a){case"focusin":case"focusout":Ko=null;break;case"dragenter":case"dragleave":Pa=null;break;case"mouseover":case"mouseout":Ys=null;break;case"pointerover":case"pointerout":Wd.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kd.delete(o.pointerId)}}function uu(a,o,u,f,_,R){return a===null||a.nativeEvent!==R?(a={blockedOn:o,domEventName:u,eventSystemFlags:f,nativeEvent:R,targetContainers:[_]},o!==null&&(o=Sl(o),o!==null&&Sf(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),a)}function BA(a,o,u,f,_){switch(o){case"focusin":return Ko=uu(Ko,a,o,u,f,_),!0;case"dragenter":return Pa=uu(Pa,a,o,u,f,_),!0;case"mouseover":return Ys=uu(Ys,a,o,u,f,_),!0;case"pointerover":var R=_.pointerId;return Wd.set(R,uu(Wd.get(R)||null,a,o,u,f,_)),!0;case"gotpointercapture":return R=_.pointerId,Kd.set(R,uu(Kd.get(R)||null,a,o,u,f,_)),!0}return!1}function vf(a){var o=Sc(a.target);if(o!==null){var u=x(o);if(u!==null){if(o=u.tag,o===13){if(o=H(u),o!==null){a.blockedOn=o,IC(a.priority,function(){if(u.tag===13){var f=Dr();f=Um(f);var _=go(u,f);_!==null&&Jr(_,u,f),V_(u,f)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function yf(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=F_(a.nativeEvent);if(u===null){u=a.nativeEvent;var f=new u.constructor(u.type,u);Km=f,u.target.dispatchEvent(f),Km=null}else return o=Sl(u),o!==null&&Sf(o),a.blockedOn=u,!1;o.shift()}return!0}function GR(a,o,u){yf(a)&&u.delete(o)}function HR(){G_=!1,Ko!==null&&yf(Ko)&&(Ko=null),Pa!==null&&yf(Pa)&&(Pa=null),Ys!==null&&yf(Ys)&&(Ys=null),Wd.forEach(GR),Kd.forEach(GR)}function du(a,o){a.blockedOn===o&&(a.blockedOn=null,G_||(G_=!0,S.unstable_scheduleCallback(S.unstable_NormalPriority,HR)))}var zs=null;function Yd(a){zs!==a&&(zs=a,S.unstable_scheduleCallback(S.unstable_NormalPriority,function(){zs===a&&(zs=null);for(var o=0;o<a.length;o+=3){var u=a[o],f=a[o+1],_=a[o+2];if(typeof f!="function"){if(j_(f||u)===null)continue;break}var R=Sl(u);R!==null&&(a.splice(o,3),o-=3,WE(R,{pending:!0,data:_,method:u.method,action:f},f,_))}}))}function Pr(a){function o(q){return du(q,a)}Ko!==null&&du(Ko,a),Pa!==null&&du(Pa,a),Ys!==null&&du(Ys,a),Wd.forEach(o),Kd.forEach(o);for(var u=0;u<Yo.length;u++){var f=Yo[u];f.blockedOn===a&&(f.blockedOn=null)}for(;0<Yo.length&&(u=Yo[0],u.blockedOn===null);)vf(u),u.blockedOn===null&&Yo.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var _=u[f],R=u[f+1],k=_[Cr]||null;if(typeof R=="function")k||Yd(u);else if(k){var B=null;if(R&&R.hasAttribute("formAction")){if(_=R,k=R[Cr]||null)B=k.formAction;else if(j_(_)!==null)continue}else B=k.action;typeof B=="function"?u[f+1]=B:(u.splice(f,3),f-=3),Yd(u)}}}function zo(a){this._internalRoot=a}zd.prototype.render=zo.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(b(409));var u=o.current,f=Dr();BR(u,f,a,o,null,null)},zd.prototype.unmount=zo.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;BR(a.current,2,null,a,null,null),Zp(),o[_l]=null}};function zd(a){this._internalRoot=a}zd.prototype.unstable_scheduleHydration=function(a){if(a){var o=ES();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Yo.length&&o!==0&&o<Yo[u].priority;u++);Yo.splice(u,0,a),u===0&&vf(a)}};var H_=A.version;if(H_!=="19.1.0")throw Error(b(527,H_,"19.1.0"));Jt.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(b(188)):(a=Object.keys(a).join(","),Error(b(268,a)));return a=X(o),a=a!==null?G(a):null,a=a===null?null:a.stateNode,a};var FA={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Rt,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cf.isDisabled&&Cf.supportsFiber)try{ml=Cf.inject(FA),kn=Cf}catch{}}return nS.createRoot=function(a,o){if(!P(a))throw Error(b(299));var u=!1,f="",_=LT,R=PT,k=Mp,B=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(_=o.onUncaughtError),o.onCaughtError!==void 0&&(R=o.onCaughtError),o.onRecoverableError!==void 0&&(k=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(B=o.unstable_transitionCallbacks)),o=xR(a,1,!1,null,null,u,f,_,R,k,B,null),a[_l]=o.current,Go(a),new zo(o)},nS.hydrateRoot=function(a,o,u){if(!P(a))throw Error(b(299));var f=!1,_="",R=LT,k=PT,B=Mp,q=null,ut=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(_=u.identifierPrefix),u.onUncaughtError!==void 0&&(R=u.onUncaughtError),u.onCaughtError!==void 0&&(k=u.onCaughtError),u.onRecoverableError!==void 0&&(B=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(q=u.unstable_transitionCallbacks),u.formState!==void 0&&(ut=u.formState)),o=xR(a,1,!0,o,u??null,f,_,R,k,B,q,ut),o.context=VR(null),u=o.current,f=Dr(),f=Um(f),_=Ms(f),_.callback=null,Ca(u,_,f),u=f,o.current.lanes=u,Gu(o,u),Da(o),a[_l]=o.current,Go(a),new zd(o)},nS.version="19.1.0",nS}var SV;function zK(){if(SV)return Sw.exports;SV=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(A){console.error(A)}}return S(),Sw.exports=YK(),Sw.exports}var qK=zK();const XK=Mw(qK);var oC={exports:{}},JK=oC.exports,TV;function QK(){return TV||(TV=1,function(S,A){(function(w,b){S.exports=b()})(JK,function(){function w(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof fw<"u"?fw:typeof self<"u"?self:{};function P(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var x=function(t){try{return!!t()}catch{return!0}},H=!x(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),Q=H,X=Function.prototype,G=X.call,Z=Q&&X.bind.bind(G,G),st=Q?Z:function(t){return function(){return G.apply(t,arguments)}},mt=st({}.isPrototypeOf),Vt=function(t){return t&&t.Math==Math&&t},it=Vt(typeof globalThis=="object"&&globalThis)||Vt(typeof window=="object"&&window)||Vt(typeof self=="object"&&self)||Vt(typeof b=="object"&&b)||function(){return this}()||b||Function("return this")(),xt=H,yt=Function.prototype,Pt=yt.apply,Gt=yt.call,Ft=typeof Reflect=="object"&&Reflect.apply||(xt?Gt.bind(Pt):function(){return Gt.apply(Pt,arguments)}),ye=st,te=ye({}.toString),fn=ye("".slice),Ne=function(t){return fn(te(t),8,-1)},Cn=Ne,An=st,hi=function(t){if(Cn(t)==="Function")return An(t)},Je=typeof document=="object"&&document.all,Yn={all:Je,IS_HTMLDDA:Je===void 0&&Je!==void 0},lr=Yn.all,mn=Yn.IS_HTMLDDA?function(t){return typeof t=="function"||t===lr}:function(t){return typeof t=="function"},Ri={},Rt=!x(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Jt=H,de=Function.prototype.call,Re=Jt?de.bind(de):function(){return de.apply(de,arguments)},tt={},Ut={}.propertyIsEnumerable,Zt=Object.getOwnPropertyDescriptor,qt=Zt&&!Ut.call({1:2},1);tt.f=qt?function(t){var e=Zt(this,t);return!!e&&e.enumerable}:Ut;var ne,Ze,pe=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Hr=x,Jn=Ne,Ka=Object,Om=st("".split),_c=Hr(function(){return!Ka("z").propertyIsEnumerable(0)})?function(t){return Jn(t)=="String"?Om(t,""):Ka(t)}:Ka,ho=function(t){return t==null},wm=ho,Nm=TypeError,fl=function(t){if(wm(t))throw Nm("Can't call method on "+t);return t},yC=_c,Ya=fl,po=function(t){return yC(Ya(t))},Dm=mn,hS=Yn.all,Wi=Yn.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Dm(t)||t===hS}:function(t){return typeof t=="object"?t!==null:Dm(t)},Wr={},Mh=Wr,Lm=it,CC=mn,ml=function(t){return CC(t)?t:void 0},kn=function(t,e){return arguments.length<2?ml(Mh[t])||ml(Lm[t]):Mh[t]&&Mh[t][e]||Lm[t]&&Lm[t][e]},ur=typeof navigator<"u"&&String(navigator.userAgent)||"",yr=it,Pm=ur,pS=yr.process,fS=yr.Deno,Vu=pS&&pS.versions||fS&&fS.version,Bu=Vu&&Vu.v8;Bu&&(Ze=(ne=Bu.split("."))[0]>0&&ne[0]<4?1:+(ne[0]+ne[1])),!Ze&&Pm&&(!(ne=Pm.match(/Edge\/(\d+)/))||ne[1]>=74)&&(ne=Pm.match(/Chrome\/(\d+)/))&&(Ze=+ne[1]);var Kr=Ze,Fu=Kr,ju=x,AC=it.String,gc=!!Object.getOwnPropertySymbols&&!ju(function(){var t=Symbol();return!AC(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Fu&&Fu<41}),km=gc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Mm=kn,Gu=mn,bC=mt,mS=Object,El=km?function(t){return typeof t=="symbol"}:function(t){var e=Mm("Symbol");return Gu(e)&&bC(e.prototype,mS(t))},Um=String,fo=function(t){try{return Um(t)}catch{return"Object"}},ES=mn,IC=fo,mo=TypeError,In=function(t){if(ES(t))return t;throw mo(IC(t)+" is not a function")},Cr=In,_l=ho,gl=function(t,e){var n=t[e];return _l(n)?void 0:Cr(n)},_S=Re,gS=mn,xm=Wi,Hu=TypeError,Uh={exports:{}},Sc=it,Sl=Object.defineProperty,Wu=function(t,e){try{Sl(Sc,t,{value:e,configurable:!0,writable:!0})}catch{Sc[t]=e}return e},Tc="__core-js_shared__",vi=it[Tc]||Wu(Tc,{}),Vm=vi;(Uh.exports=function(t,e){return Vm[t]||(Vm[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Rc=Uh.exports,vc=fl,Tl=Object,za=function(t){return Tl(vc(t))},SS=za,TS=st({}.hasOwnProperty),pi=Object.hasOwn||function(t,e){return TS(SS(t),e)},xh=st,Vh=0,Cs=Math.random(),Bm=xh(1 .toString),Bh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Bm(++Vh+Cs,36)},Rl=Rc,Fh=pi,Fm=Bh,OC=gc,RS=km,Ki=it.Symbol,jh=Rl("wks"),wC=RS?Ki.for||Ki:Ki&&Ki.withoutSetter||Fm,dn=function(t){return Fh(jh,t)||(jh[t]=OC&&Fh(Ki,t)?Ki[t]:wC("Symbol."+t)),jh[t]},vS=Re,Ku=Wi,yS=El,ea=gl,jm=function(t,e){var n,i;if(gS(n=t.toString)&&!xm(i=_S(n,t))||gS(n=t.valueOf)&&!xm(i=_S(n,t)))return i;throw Hu("Can't convert object to primitive value")},CS=TypeError,Gm=dn("toPrimitive"),vl=function(t,e){if(!Ku(t)||yS(t))return t;var n,i=ea(t,Gm);if(i){if(n=vS(i,t,e),!Ku(n)||yS(n))return n;throw CS("Can't convert object to primitive value")}return jm(t)},AS=El,Yu=function(t){var e=vl(t,"string");return AS(e)?e:e+""},yc=Wi,Hm=it.document,bS=yc(Hm)&&yc(Hm.createElement),Gh=function(t){return bS?Hm.createElement(t):{}},Wm=Gh,IS=!Rt&&!x(function(){return Object.defineProperty(Wm("div"),"a",{get:function(){return 7}}).a!=7}),NC=Rt,Hh=Re,Km=tt,Ym=pe,yl=po,Cl=Yu,OS=pi,zm=IS,qm=Object.getOwnPropertyDescriptor;Ri.f=NC?qm:function(t,e){if(t=yl(t),e=Cl(e),zm)try{return qm(t,e)}catch{}if(OS(t,e))return Ym(!Hh(Km.f,t,e),t[e])};var zu=x,As=mn,Xm=/#|\.prototype\./,bs=function(t,e){var n=Jm[Eo(t)];return n==wS||n!=Wh&&(As(e)?zu(e):!!e)},Eo=bs.normalize=function(t){return String(t).replace(Xm,".").toLowerCase()},Jm=bs.data={},Wh=bs.NATIVE="N",wS=bs.POLYFILL="P",qu=bs,Kh=In,NS=H,Ar=hi(hi.bind),br=function(t,e){return Kh(t),e===void 0?t:NS?Ar(t,e):function(){return t.apply(e,arguments)}},dr={},Al=Rt&&x(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),DC=Wi,Qm=String,Zm=TypeError,yi=function(t){if(DC(t))return t;throw Zm(Qm(t)+" is not an object")},Yh=Rt,DS=IS,LC=Al,zh=yi,LS=Yu,$m=TypeError,tE=Object.defineProperty,PC=Object.getOwnPropertyDescriptor,eE="enumerable",nE="configurable",iE="writable";dr.f=Yh?LC?function(t,e,n){if(zh(t),e=LS(e),zh(n),typeof t=="function"&&e==="prototype"&&"value"in n&&iE in n&&!n[iE]){var i=PC(t,e);i&&i[iE]&&(t[e]=n.value,n={configurable:nE in n?n[nE]:i[nE],enumerable:eE in n?n[eE]:i[eE],writable:!1})}return tE(t,e,n)}:tE:function(t,e,n){if(zh(t),e=LS(e),zh(n),DS)try{return tE(t,e,n)}catch{}if("get"in n||"set"in n)throw $m("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var PS=dr,kC=pe,_o=Rt?function(t,e,n){return PS.f(t,e,kC(1,n))}:function(t,e,n){return t[e]=n,t},qh=it,MC=Ft,rE=hi,UC=mn,xC=Ri.f,VC=qu,Cc=Wr,BC=br,bl=_o,kS=pi,FC=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return MC(t,this,arguments)};return e.prototype=t.prototype,e},De=function(t,e){var n,i,r,s,c,l,d,h,p,m=t.target,E=t.global,g=t.stat,I=t.proto,y=E?qh:g?qh[m]:(qh[m]||{}).prototype,C=E?Cc:Cc[m]||bl(Cc,m,{})[m],N=C.prototype;for(s in e)i=!(n=VC(E?s:m+(g?".":"#")+s,t.forced))&&y&&kS(y,s),l=C[s],i&&(d=t.dontCallGetSet?(p=xC(y,s))&&p.value:y[s]),c=i&&d?d:e[s],i&&typeof l==typeof c||(h=t.bind&&i?BC(c,qh):t.wrap&&i?FC(c):I&&UC(c)?rE(c):c,(t.sham||c&&c.sham||l&&l.sham)&&bl(h,"sham",!0),bl(C,s,h),I&&(kS(Cc,r=m+"Prototype")||bl(Cc,r,{}),bl(Cc[r],s,c),t.real&&N&&(n||!N[s])&&bl(N,s,c)))},jC=Math.ceil,GC=Math.floor,HC=Math.trunc||function(t){var e=+t;return(e>0?GC:jC)(e)},WC=HC,Xu=function(t){var e=+t;return e!=e||e===0?0:WC(e)},Ju=Xu,KC=Math.max,MS=Math.min,Xh=function(t,e){var n=Ju(t);return n<0?KC(n+e,0):MS(n,e)},US=Xu,xS=Math.min,aE=function(t){return t>0?xS(US(t),9007199254740991):0},Il=aE,Is=function(t){return Il(t.length)},YC=po,zC=Xh,VS=Is,sE=function(t){return function(e,n,i){var r,s=YC(e),c=VS(s),l=zC(i,c);if(t&&n!=n){for(;c>l;)if((r=s[l++])!=r)return!0}else for(;c>l;l++)if((t||l in s)&&s[l]===n)return t||l||0;return!t&&-1}},Ac={includes:sE(!0),indexOf:sE(!1)},Qu=Ac.includes;De({target:"Array",proto:!0,forced:x(function(){return!Array(1).includes()})},{includes:function(t){return Qu(this,t,arguments.length>1?arguments[1]:void 0)}});var qC=Wr,hr=function(t){return qC[t+"Prototype"]},BS=hr("Array").includes,FS=Wi,oE=Ne,cE=dn("match"),lE=function(t){var e;return FS(t)&&((e=t[cE])!==void 0?!!e:oE(t)=="RegExp")},jS=lE,GS=TypeError,HS={};HS[dn("toStringTag")]="z";var uE=String(HS)==="[object z]",XC=uE,JC=mn,Jh=Ne,Yr=dn("toStringTag"),Zu=Object,WS=Jh(function(){return arguments}())=="Arguments",Ra=XC?Jh:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,s){try{return r[s]}catch{}}(e=Zu(t),Yr))=="string"?n:WS?Jh(e):(i=Jh(e))=="Object"&&JC(e.callee)?"Arguments":i},KS=Ra,YS=String,pr=function(t){if(KS(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return YS(t)},QC=dn("match"),Ol=De,dE=function(t){if(jS(t))throw GS("The method doesn't accept regular expressions");return t},$u=fl,Qh=pr,zS=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[QC]=!1,"/./"[t](e)}catch{}}return!1},bc=st("".indexOf);Ol({target:"String",proto:!0,forced:!zS("includes")},{includes:function(t){return!!~bc(Qh($u(this)),Qh(dE(t)),arguments.length>1?arguments[1]:void 0)}});var wl=hr("String").includes,Zh=mt,qS=BS,Ic=wl,$h=Array.prototype,tp=String.prototype,XS=function(t){var e=t.includes;return t===$h||Zh($h,t)&&e===$h.includes?qS:typeof t=="string"||t===tp||Zh(tp,t)&&e===tp.includes?Ic:e},Et=P(XS),ZC=In,$C=za,JS=_c,QS=Is,hE=TypeError,va=function(t){return function(e,n,i,r){ZC(n);var s=$C(e),c=JS(s),l=QS(s),d=t?l-1:0,h=t?-1:1;if(i<2)for(;;){if(d in c){r=c[d],d+=h;break}if(d+=h,t?d<0:l<=d)throw hE("Reduce of empty array with no initial value")}for(;t?d>=0:l>d;d+=h)d in c&&(r=n(r,c[d],d,s));return r}},ZS={left:va(!1)},na=x,fr=function(t,e){var n=[][t];return!!n&&na(function(){n.call(null,e||function(){return 1},1)})},ya=typeof process<"u"&&Ne(process)=="process",pE=ZS.left;De({target:"Array",proto:!0,forced:!ya&&Kr>79&&Kr<83||!fr("reduce")},{reduce:function(t){var e=arguments.length;return pE(this,t,e,e>1?arguments[1]:void 0)}});var ep=hr("Array").reduce,np=mt,fE=ep,go=Array.prototype,$S=function(t){var e=t.reduce;return t===go||np(go,t)&&e===go.reduce?fE:e},td=$S,er=P(td),tA=Ne,Yi=Array.isArray||function(t){return tA(t)=="Array"},mE=De,Os=Yi,tT=st([].reverse),ed=[1,2];mE({target:"Array",proto:!0,forced:String(ed)===String(ed.reverse())},{reverse:function(){return Os(this)&&(this.length=this.length),tT(this)}});var Oc=hr("Array").reverse,EE=mt,_E=Oc,So=Array.prototype,Nl=function(t){var e=t.reverse;return t===So||EE(So,t)&&e===So.reverse?_E:e},nd=Nl,id=P(nd),ia=Bh,zr=Rc("keys"),qa=function(t){return zr[t]||(zr[t]=ia(t))},ws=!x(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Ns=pi,wc=mn,eT=za,gE=ws,ip=qa("IE_PROTO"),zi=Object,oi=zi.prototype,on=gE?zi.getPrototypeOf:function(t){var e=eT(t);if(Ns(e,ip))return e[ip];var n=e.constructor;return wc(n)&&e instanceof n?n.prototype:e instanceof zi?oi:null},Nc=st,Xa=In,SE=mn,Dc=String,nT=TypeError,iT=function(t,e,n){try{return Nc(Xa(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},rd=yi,ad=function(t){if(typeof t=="object"||SE(t))return t;throw nT("Can't set "+Dc(t)+" as a prototype")},rT=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=iT(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return rd(i),ad(r),e?t(i,r):i.__proto__=r,i}}():void 0),To={},Dl={},Ds=pi,Ls=po,Ro=Ac.indexOf,Ps=Dl,rp=st([].push),ap=function(t,e){var n,i=Ls(t),r=0,s=[];for(n in i)!Ds(Ps,n)&&Ds(i,n)&&rp(s,n);for(;e.length>r;)Ds(i,n=e[r++])&&(~Ro(s,n)||rp(s,n));return s},Lc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],sp=ap,Pc=Lc.concat("length","prototype");To.f=Object.getOwnPropertyNames||function(t){return sp(t,Pc)};var Ci={};Ci.f=Object.getOwnPropertySymbols;var op=kn,aT=To,eA=Ci,nA=yi,iA=st([].concat),Li=op("Reflect","ownKeys")||function(t){var e=aT.f(nA(t)),n=eA.f;return n?iA(e,n(t)):e},cp=pi,sd=Li,od=Ri,TE=dr,vo={},Ll=ap,rA=Lc,cd=Object.keys||function(t){return Ll(t,rA)},aA=Rt,sT=Al,kc=dr,RE=yi,lp=po,oT=cd;vo.f=aA&&!sT?Object.defineProperties:function(t,e){RE(t);for(var n,i=lp(e),r=oT(e),s=r.length,c=0;s>c;)kc.f(t,n=r[c++],i[n]);return t};var yo,vE=kn("document","documentElement"),up=yi,yE=vo,CE=Lc,dp=Dl,cT=vE,ld=Gh,hp="prototype",pp="script",ks=qa("IE_PROTO"),ud=function(){},fp=function(t){return"<"+pp+">"+t+"</"+pp+">"},Ms=function(t){t.write(fp("")),t.close();var e=t.parentWindow.Object;return t=null,e},Ca=function(){try{yo=new ActiveXObject("htmlfile")}catch{}var t,e,n;Ca=typeof document<"u"?document.domain&&yo?Ms(yo):(e=ld("iframe"),n="java"+pp+":",e.style.display="none",cT.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(fp("document.F=Object")),t.close(),t.F):Ms(yo);for(var i=CE.length;i--;)delete Ca[hp][CE[i]];return Ca()};dp[ks]=!0;var Us=Object.create||function(t,e){var n;return t!==null?(ud[hp]=up(t),n=new ud,ud[hp]=null,n[ks]=t):n=Ca(),e===void 0?n:yE.f(n,e)},AE=Wi,bE=_o,Pl=Error,dd=st("".replace),lT=String(Pl("zxcasd").stack),IE=/\n\s*at [^:]*:[^\n]*/,kl=IE.test(lT),mp=pe,uT=!x(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",mp(1,7)),t.stack!==7)}),OE=_o,wE=function(t,e){if(kl&&typeof t=="string"&&!Pl.prepareStackTrace)for(;e--;)t=dd(t,IE,"");return t},Co=uT,Me=Error.captureStackTrace,rn={},Ai=rn,Ep=dn("iterator"),Ml=Array.prototype,Ao=function(t){return t!==void 0&&(Ai.Array===t||Ml[Ep]===t)},_p=Ra,Ul=gl,xl=ho,sA=rn,fi=dn("iterator"),Vl=function(t){if(!xl(t))return Ul(t,fi)||Ul(t,"@@iterator")||sA[_p(t)]},NE=Re,dT=In,hT=yi,oA=fo,DE=Vl,LE=TypeError,hd=function(t,e){var n=arguments.length<2?DE(t):e;if(dT(n))return hT(NE(n,t));throw LE(oA(t)+" is not iterable")},Ir=Re,mi=yi,PE=gl,Bl=function(t,e,n){var i,r;mi(t);try{if(!(i=PE(t,"return"))){if(e==="throw")throw n;return n}i=Ir(i,t)}catch(s){r=!0,i=s}if(e==="throw")throw n;if(r)throw i;return mi(i),n},gp=br,kE=Re,xs=yi,Sp=fo,ME=Ao,UE=Is,xE=mt,pT=hd,fT=Vl,VE=Bl,mT=TypeError,pd=function(t,e){this.stopped=t,this.result=e},Tp=pd.prototype,Fl=function(t,e,n){var i,r,s,c,l,d,h,p=n&&n.that,m=!(!n||!n.AS_ENTRIES),E=!(!n||!n.IS_RECORD),g=!(!n||!n.IS_ITERATOR),I=!(!n||!n.INTERRUPTED),y=gp(e,p),C=function(D){return i&&VE(i,"normal",D),new pd(!0,D)},N=function(D){return m?(xs(D),I?y(D[0],D[1],C):y(D[0],D[1])):I?y(D,C):y(D)};if(E)i=t.iterator;else if(g)i=t;else{if(!(r=fT(t)))throw mT(Sp(t)+" is not iterable");if(ME(r)){for(s=0,c=UE(t);c>s;s++)if((l=N(t[s]))&&xE(Tp,l))return l;return new pd(!1)}i=pT(t,r)}for(d=E?t.next:i.next;!(h=kE(d,i)).done;){try{l=N(h.value)}catch(D){VE(i,"throw",D)}if(typeof l=="object"&&l&&xE(Tp,l))return l}return new pd(!1)},cA=pr,ET=De,_T=mt,gT=on,jl=rT,ST=function(t,e,n){for(var i=sd(e),r=TE.f,s=od.f,c=0;c<i.length;c++){var l=i[c];cp(t,l)||n&&cp(n,l)||r(t,l,s(e,l))}},BE=Us,Rp=_o,vp=pe,TT=function(t,e){AE(e)&&"cause"in e&&bE(t,"cause",e.cause)},lA=function(t,e,n,i){Co&&(Me?Me(t,e):OE(t,"stack",wE(n,i)))},RT=Fl,Gl=function(t,e){return t===void 0?arguments.length<2?"":e:cA(t)},yp=dn("toStringTag"),fd=Error,Cp=[].push,Ja=function(t,e){var n,i=_T(Ap,this);jl?n=jl(fd(),i?gT(this):Ap):(n=i?this:BE(Ap),Rp(n,yp,"Error")),e!==void 0&&Rp(n,"message",Gl(e)),lA(n,Ja,n.stack,1),arguments.length>2&&TT(n,arguments[2]);var r=[];return RT(t,Cp,{that:r}),Rp(n,"errors",r),n};jl?jl(Ja,fd):ST(Ja,fd,{name:!0});var Ap=Ja.prototype=BE(fd.prototype,{constructor:vp(1,Ja),message:vp(1,""),name:vp(1,"AggregateError")});ET({global:!0},{AggregateError:Ja});var md,Hl,Ed,vT=mn,FE=it.WeakMap,jE=vT(FE)&&/native code/.test(String(FE)),GE=it,yT=Wi,HE=_o,bp=pi,Ip=vi,uA=qa,WE=Dl,KE="Object already initialized",Op=GE.TypeError,YE=GE.WeakMap;if(jE||Ip.state){var Aa=Ip.state||(Ip.state=new YE);Aa.get=Aa.get,Aa.has=Aa.has,Aa.set=Aa.set,md=function(t,e){if(Aa.has(t))throw Op(KE);return e.facade=t,Aa.set(t,e),e},Hl=function(t){return Aa.get(t)||{}},Ed=function(t){return Aa.has(t)}}else{var Mc=uA("state");WE[Mc]=!0,md=function(t,e){if(bp(t,Mc))throw Op(KE);return e.facade=t,HE(t,Mc,e),e},Hl=function(t){return bp(t,Mc)?t[Mc]:{}},Ed=function(t){return bp(t,Mc)}}var Uc,CT,zE,ba={set:md,get:Hl,has:Ed,enforce:function(t){return Ed(t)?Hl(t):md(t,{})},getterFor:function(t){return function(e){var n;if(!yT(e)||(n=Hl(e)).type!==t)throw Op("Incompatible receiver, "+t+" required");return n}}},_d=Rt,wp=pi,qE=Function.prototype,AT=_d&&Object.getOwnPropertyDescriptor,gd=wp(qE,"name"),XE={PROPER:gd&&(function(){}).name==="something",CONFIGURABLE:gd&&(!_d||_d&&AT(qE,"name").configurable)},bT=_o,bo=function(t,e,n,i){return i&&i.enumerable?t[e]=n:bT(t,e,n),t},Wl=x,Sd=mn,Np=Wi,Td=Us,Rd=on,IT=bo,Dp=dn("iterator"),xc=!1;[].keys&&("next"in(zE=[].keys())?(CT=Rd(Rd(zE)))!==Object.prototype&&(Uc=CT):xc=!0);var OT=!Np(Uc)||Wl(function(){var t={};return Uc[Dp].call(t)!==t});Sd((Uc=OT?{}:Td(Uc))[Dp])||IT(Uc,Dp,function(){return this});var qr={IteratorPrototype:Uc,BUGGY_SAFARI_ITERATORS:xc},Qa=Ra,Io=uE?{}.toString:function(){return"[object "+Qa(this)+"]"},wT=uE,Oo=dr.f,Vs=_o,Pi=pi,Lp=Io,Pp=dn("toStringTag"),Za=function(t,e,n,i){if(t){var r=n?t:t.prototype;Pi(r,Pp)||Oo(r,Pp,{configurable:!0,value:e}),i&&!wT&&Vs(r,"toString",Lp)}},NT=qr.IteratorPrototype,DT=Us,Vc=pe,kp=Za,LT=rn,PT=function(){return this},Mp=function(t,e,n,i){var r=e+" Iterator";return t.prototype=DT(NT,{next:Vc(+!i,n)}),kp(t,r,!1,!0),LT[r]=PT,t},Up=De,kT=Re,JE=XE,MT=Mp,UT=on,dA=Za,QE=bo,ki=rn,qi=qr,xT=JE.PROPER,vd=qi.BUGGY_SAFARI_ITERATORS,xp=dn("iterator"),ZE="keys",yd="values",Cd="entries",$E=function(){return this},t_=function(t,e,n,i,r,s,c){MT(n,e,i);var l,d,h,p=function(N){if(N===r&&y)return y;if(!vd&&N in g)return g[N];switch(N){case ZE:case yd:case Cd:return function(){return new n(this,N)}}return function(){return new n(this)}},m=e+" Iterator",E=!1,g=t.prototype,I=g[xp]||g["@@iterator"]||r&&g[r],y=!vd&&I||p(r),C=e=="Array"&&g.entries||I;if(C&&(l=UT(C.call(new t)))!==Object.prototype&&l.next&&(dA(l,m,!0,!0),ki[m]=$E),xT&&r==yd&&I&&I.name!==yd&&(E=!0,y=function(){return kT(I,this)}),r)if(d={values:p(yd),keys:s?y:p(ZE),entries:p(Cd)},c)for(h in d)(vd||E||!(h in g))&&QE(g,h,d[h]);else Up({target:e,proto:!0,forced:vd||E},d);return c&&g[xp]!==y&&QE(g,xp,y,{}),ki[e]=y,d},Vp=function(t,e){return{value:t,done:e}},VT=po,Bp=rn,Fp=ba;dr.f;var e_=t_,n_=Vp,jp="Array Iterator",Gp=Fp.set,i_=Fp.getterFor(jp);e_(Array,"Array",function(t,e){Gp(this,{type:jp,target:VT(t),index:0,kind:e})},function(){var t=i_(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,n_(void 0,!0)):n_(n=="keys"?i:n=="values"?e[i]:[i,e[i]],!1)},"values"),Bp.Arguments=Bp.Array;var BT=dr,Kl=function(t,e,n){return BT.f(t,e,n)},FT=kn,Bs=Kl,r_=Rt,jT=dn("species"),GT=mt,Fs=TypeError,Hp=function(t,e){if(GT(e,t))return t;throw Fs("Incorrect invocation")},Wp=mn,Bc=vi,$n=st(Function.toString);Wp(Bc.inspectSource)||(Bc.inspectSource=function(t){return $n(t)});var HT=Bc.inspectSource,hA=st,WT=x,Yl=mn,wo=Ra,KT=HT,a_=function(){},Ad=[],Ia=kn("Reflect","construct"),Kp=/^\s*(?:class|function)\b/,s_=hA(Kp.exec),YT=!Kp.exec(a_),Fc=function(t){if(!Yl(t))return!1;try{return Ia(a_,Ad,t),!0}catch{return!1}},Yp=function(t){if(!Yl(t))return!1;switch(wo(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return YT||!!s_(Kp,KT(t))}catch{return!0}};Yp.sham=!0;var No,jc,$a,ti,zl=!Ia||WT(function(){var t;return Fc(Fc.call)||!Fc(Object)||!Fc(function(){t=!0})||t})?Yp:Fc,zT=zl,ji=fo,pA=TypeError,o_=yi,qT=function(t){if(zT(t))return t;throw pA(ji(t)+" is not a constructor")},Qn=ho,Or=dn("species"),Oa=function(t,e){var n,i=o_(t).constructor;return i===void 0||Qn(n=o_(i)[Or])?e:qT(n)},bd=st([].slice),XT=TypeError,ql=function(t,e){if(t<e)throw XT("Not enough arguments");return t},zp=/(?:ipad|iphone|ipod).*applewebkit/i.test(ur),zn=it,wa=Ft,JT=br,wr=mn,QT=pi,js=x,Do=vE,Lo=bd,qp=Gh,c_=ql,ts=zp,ZT=ya,Po=zn.setImmediate,Gc=zn.clearImmediate,Id=zn.process,ko=zn.Dispatch,$T=zn.Function,l_=zn.MessageChannel,Od=zn.String,Xp=0,Mo={},u_="onreadystatechange";js(function(){No=zn.location});var d_=function(t){if(QT(Mo,t)){var e=Mo[t];delete Mo[t],e()}},h_=function(t){return function(){d_(t)}},Rn=function(t){d_(t.data)},Mn=function(t){zn.postMessage(Od(t),No.protocol+"//"+No.host)};Po&&Gc||(Po=function(t){c_(arguments.length,1);var e=wr(t)?t:$T(t),n=Lo(arguments,1);return Mo[++Xp]=function(){wa(e,void 0,n)},jc(Xp),Xp},Gc=function(t){delete Mo[t]},ZT?jc=function(t){Id.nextTick(h_(t))}:ko&&ko.now?jc=function(t){ko.now(h_(t))}:l_&&!ts?(ti=($a=new l_).port2,$a.port1.onmessage=Rn,jc=JT(ti.postMessage,ti)):zn.addEventListener&&wr(zn.postMessage)&&!zn.importScripts&&No&&No.protocol!=="file:"&&!js(Mn)?(jc=Mn,zn.addEventListener("message",Rn,!1)):jc=u_ in qp("script")?function(t){Do.appendChild(qp("script"))[u_]=function(){Do.removeChild(this),d_(t)}}:function(t){setTimeout(h_(t),0)});var Ue={set:Po,clear:Gc},$e=function(){this.head=null,this.tail=null};$e.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var an,mr,es,Uo,Jp,ns=$e,ci=/ipad|iphone|ipod/i.test(ur)&&typeof Pebble<"u",xo=/web0s(?!.*chrome)/i.test(ur),Xr=it,Qp=br,ra=Ri.f,Vo=Ue.set,wd=ns,Nr=zp,p_=ci,f_=xo,Xl=ya,Nd=Xr.MutationObserver||Xr.WebKitMutationObserver,Gs=Xr.document,Gi=Xr.process,Na=Xr.Promise,Hc=ra(Xr,"queueMicrotask"),Bo=Hc&&Hc.value;if(!Bo){var Jl=new wd,Ql=function(){var t,e;for(Xl&&(t=Gi.domain)&&t.exit();e=Jl.get();)try{e()}catch(n){throw Jl.head&&an(),n}t&&t.enter()};Nr||Xl||f_||!Nd||!Gs?!p_&&Na&&Na.resolve?((Uo=Na.resolve(void 0)).constructor=Na,Jp=Qp(Uo.then,Uo),an=function(){Jp(Ql)}):Xl?an=function(){Gi.nextTick(Ql)}:(Vo=Qp(Vo,Xr),an=function(){Vo(Ql)}):(mr=!0,es=Gs.createTextNode(""),new Nd(Ql).observe(es,{characterData:!0}),an=function(){es.data=mr=!mr}),Bo=function(t){Jl.head||an(),Jl.add(t)}}var m_=Bo,is=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},Hs=it.Promise,Dr=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",tR=!Dr&&!ya&&typeof window=="object"&&typeof document=="object",Jr=it,Zl=Hs,eR=mn,fA=qu,Fo=HT,Zp=dn,E_=tR,$l=Dr,$p=Kr,__=Zl&&Zl.prototype,nR=Zp("species"),tf=eR(Jr.PromiseRejectionEvent),g_=fA("Promise",function(){var t=Fo(Zl),e=t!==String(Zl);if(!e&&$p===66||!__.catch||!__.finally)return!0;if(!$p||$p<51||!/native code/.test(t)){var n=new Zl(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[nR]=i,!(n.then(function(){})instanceof i))return!0}return!e&&(E_||$l)&&!tf}),Dd={CONSTRUCTOR:g_,REJECTION_EVENT:tf},rs={},iR=In,rR=TypeError,aR=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw rR("Bad Promise constructor");e=i,n=r}),this.resolve=iR(e),this.reject=iR(n)};rs.f=function(t){return new aR(t)};var jo,Ld,sR=De,Pd=ya,Ws=it,tu=Re,oR=bo,cR=Za,ef=function(t){var e=FT(t);r_&&e&&!e[jT]&&Bs(e,jT,{configurable:!0,get:function(){return this}})},lR=In,nf=mn,Un=Wi,S_=Hp,mA=Oa,T_=Ue.set,R_=m_,EA=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},_A=is,rf=ns,Wc=ba,kd=Hs,Md=Dd,af=rs,as="Promise",Da=Md.CONSTRUCTOR,Ud=Md.REJECTION_EVENT,v_=Wc.getterFor(as),uR=Wc.set,dR=kd&&kd.prototype,eu=kd,sf=dR,hR=Ws.TypeError,xd=Ws.document,of=Ws.process,cf=af.f,gA=cf,y_=!!(xd&&xd.createEvent&&Ws.dispatchEvent),lf="unhandledrejection",pR=function(t){var e;return!(!Un(t)||!nf(e=t.then))&&e},fR=function(t,e){var n,i,r,s=e.value,c=e.state==1,l=c?t.ok:t.fail,d=t.resolve,h=t.reject,p=t.domain;try{l?(c||(e.rejection===2&&C_(e),e.rejection=1),l===!0?n=s:(p&&p.enter(),n=l(s),p&&(p.exit(),r=!0)),n===t.promise?h(hR("Promise-chain cycle")):(i=pR(n))?tu(i,n,d,h):d(n)):h(s)}catch(m){p&&!r&&p.exit(),h(m)}},nu=function(t,e){t.notified||(t.notified=!0,R_(function(){for(var n,i=t.reactions;n=i.get();)fR(n,t);t.notified=!1,e&&!t.rejection&&ER(t)}))},mR=function(t,e,n){var i,r;y_?((i=xd.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),Ws.dispatchEvent(i)):i={promise:e,reason:n},!Ud&&(r=Ws["on"+t])?r(i):t===lf&&EA("Unhandled promise rejection",n)},ER=function(t){tu(T_,Ws,function(){var e,n=t.facade,i=t.value;if(He(t)&&(e=_A(function(){Pd?of.emit("unhandledRejection",i,n):mR(lf,n,i)}),t.rejection=Pd||He(t)?2:1,e.error))throw e.value})},He=function(t){return t.rejection!==1&&!t.parent},C_=function(t){tu(T_,Ws,function(){var e=t.facade;Pd?of.emit("rejectionHandled",e):mR("rejectionhandled",e,t.value)})},Ks=function(t,e,n){return function(i){t(e,i,n)}},Go=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,nu(t,!0))},uf=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw hR("Promise can't be resolved itself");var i=pR(e);i?R_(function(){var r={done:!1};try{tu(i,e,Ks(uf,r,t),Ks(Go,r,t))}catch(s){Go(r,s,t)}}):(t.value=e,t.state=1,nu(t,!1))}catch(r){Go({done:!1},r,t)}}};Da&&(sf=(eu=function(t){S_(this,sf),lR(t),tu(jo,this);var e=v_(this);try{t(Ks(uf,e),Ks(Go,e))}catch(n){Go(e,n)}}).prototype,(jo=function(t){uR(this,{type:as,done:!1,notified:!1,parent:!1,reactions:new rf,rejection:!1,state:0,value:void 0})}).prototype=oR(sf,"then",function(t,e){var n=v_(this),i=cf(mA(this,eu));return n.parent=!0,i.ok=!nf(t)||t,i.fail=nf(e)&&e,i.domain=Pd?of.domain:void 0,n.state==0?n.reactions.add(i):R_(function(){fR(i,n)}),i.promise}),Ld=function(){var t=new jo,e=v_(t);this.promise=t,this.resolve=Ks(uf,e),this.reject=Ks(Go,e)},af.f=cf=function(t){return t===eu||t===void 0?new Ld(t):gA(t)}),sR({global:!0,wrap:!0,forced:Da},{Promise:eu}),cR(eu,as,!1,!0),ef(as);var df=dn("iterator"),iu=!1;try{var hf=0,Kc={next:function(){return{done:!!hf++}},return:function(){iu=!0}};Kc[df]=function(){return this},Array.from(Kc,function(){throw 2})}catch{}var _R=Hs,SA=function(t,e){if(!iu)return!1;var n=!1;try{var i={};i[df]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},pf=Dd.CONSTRUCTOR||!SA(function(t){_R.all(t).then(void 0,function(){})}),gR=Re,SR=In,ff=rs,On=is,A_=Fl;De({target:"Promise",stat:!0,forced:pf},{all:function(t){var e=this,n=ff.f(e),i=n.resolve,r=n.reject,s=On(function(){var c=SR(e.resolve),l=[],d=0,h=1;A_(t,function(p){var m=d++,E=!1;h++,gR(c,e,p).then(function(g){E||(E=!0,l[m]=g,--h||i(l))},r)}),--h||i(l)});return s.error&&r(s.value),n.promise}});var Xi=De,TA=Dd.CONSTRUCTOR;Hs&&Hs.prototype,Xi({target:"Promise",proto:!0,forced:TA,real:!0},{catch:function(t){return this.then(void 0,t)}});var b_=Re,I_=In,mf=rs,TR=is,RR=Fl;De({target:"Promise",stat:!0,forced:pf},{race:function(t){var e=this,n=mf.f(e),i=n.reject,r=TR(function(){var s=I_(e.resolve);RR(t,function(c){b_(s,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var O_=Re,w_=rs;De({target:"Promise",stat:!0,forced:Dd.CONSTRUCTOR},{reject:function(t){var e=w_.f(this);return O_(e.reject,void 0,t),e.promise}});var RA=yi,vR=Wi,vA=rs,N_=function(t,e){if(RA(t),vR(e)&&e.constructor===t)return e;var n=vA.f(t);return(0,n.resolve)(e),n.promise},yA=De,CA=Hs,Ho=Dd.CONSTRUCTOR,yR=N_,D_=kn("Promise"),AA=!Ho;yA({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return yR(AA&&this===D_?CA:this,t)}});var bA=Re,L_=In,IA=rs,La=is,P_=Fl;De({target:"Promise",stat:!0,forced:pf},{allSettled:function(t){var e=this,n=IA.f(e),i=n.resolve,r=n.reject,s=La(function(){var c=L_(e.resolve),l=[],d=0,h=1;P_(t,function(p){var m=d++,E=!1;h++,bA(c,e,p).then(function(g){E||(E=!0,l[m]={status:"fulfilled",value:g},--h||i(l))},function(g){E||(E=!0,l[m]={status:"rejected",reason:g},--h||i(l))})}),--h||i(l)});return s.error&&r(s.value),n.promise}});var CR=Re,AR=In,Vd=kn,aa=rs,bR=is,Ef=Fl,ss="No one promise resolved";De({target:"Promise",stat:!0,forced:pf},{any:function(t){var e=this,n=Vd("AggregateError"),i=aa.f(e),r=i.resolve,s=i.reject,c=bR(function(){var l=AR(e.resolve),d=[],h=0,p=1,m=!1;Ef(t,function(E){var g=h++,I=!1;p++,CR(l,e,E).then(function(y){I||m||(m=!0,r(y))},function(y){I||m||(I=!0,d[g]=y,--p||s(new n(d,ss)))})}),--p||s(new n(d,ss))});return c.error&&s(c.value),i.promise}});var OA=De,k_=Hs,ru=x,IR=kn,wA=mn,NA=Oa,OR=N_,DA=k_&&k_.prototype;OA({target:"Promise",proto:!0,real:!0,forced:!!k_&&ru(function(){DA.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=NA(this,IR("Promise")),n=wA(t);return this.then(n?function(i){return OR(e,t()).then(function(){return i})}:t,n?function(i){return OR(e,t()).then(function(){throw i})}:t)}});var M_=st,LA=Xu,PA=pr,wR=fl,au=M_("".charAt),su=M_("".charCodeAt),NR=M_("".slice),DR=function(t){return function(e,n){var i,r,s=PA(wR(e)),c=LA(n),l=s.length;return c<0||c>=l?t?"":void 0:(i=su(s,c))<55296||i>56319||c+1===l||(r=su(s,c+1))<56320||r>57343?t?au(s,c):i:t?NR(s,c,c+2):r-56320+(i-55296<<10)+65536}},Wo={codeAt:DR(!1),charAt:DR(!0)},Bd=Wo.charAt,LR=pr,Fd=ba,U_=t_,_f=Vp,jd="String Iterator",PR=Fd.set,kR=Fd.getterFor(jd);U_(String,"String",function(t){PR(this,{type:jd,string:LR(t),index:0})},function(){var t,e=kR(this),n=e.string,i=e.index;return i>=n.length?_f(void 0,!0):(t=Bd(n,i),e.index+=t.length,_f(t,!1))});var kA=Wr.Promise,MR={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Gd=it,MA=Ra,UA=_o,UR=rn,Hd=dn("toStringTag");for(var ou in MR){var gf=Gd[ou],x_=gf&&gf.prototype;x_&&MA(x_)!==Hd&&UA(x_,Hd,ou),UR[ou]=UR.Array}var cu=kA,St=P(cu),xR=hr("Array").values,VR=Ra,BR=pi,FR=mt,V_=xR,Sf=Array.prototype,Tf={DOMTokenList:!0,NodeList:!0},xA=function(t){var e=t.values;return t===Sf||FR(Sf,t)&&e===Sf.values||BR(Tf,VR(t))?V_:e},Lr=P(xA),B_=x,F_=dn("iterator"),lu=!B_(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),i="";return t.pathname="c%20d",e.forEach(function(r,s){e.delete("b"),i+=s+r}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[F_]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("http://x",void 0).host!=="x"}),j_=bo,jR=Yu,G_=dr,Ko=pe,Pa=function(t,e,n){var i=jR(e);i in t?G_.f(t,i,Ko(0,n)):t[i]=n},Ys=Xh,Wd=Is,Kd=Pa,Yo=Array,VA=Math.max,Rf=function(t,e,n){for(var i=Wd(t),r=Ys(e,i),s=Ys(n===void 0?i:n,i),c=Yo(VA(s-r,0)),l=0;r<s;r++,l++)Kd(c,l,t[r]);return c.length=l,c},uu=Rf,BA=Math.floor,vf=function(t,e){var n=t.length,i=BA(n/2);return n<8?yf(t,e):GR(t,vf(uu(t,0,i),e),vf(uu(t,i),e),e)},yf=function(t,e){for(var n,i,r=t.length,s=1;s<r;){for(i=s,n=t[s];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==s++&&(t[i]=n)}return t},GR=function(t,e,n,i){for(var r=e.length,s=n.length,c=0,l=0;c<r||l<s;)t[c+l]=c<r&&l<s?i(e[c],n[l])<=0?e[c++]:n[l++]:c<r?e[c++]:n[l++];return t},HR=vf,du=De,zs=it,Yd=Re,Pr=st,zo=Rt,zd=lu,H_=bo,FA=Kl,Cf=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:j_(t,i,e[i],n);return t},a=Za,o=Mp,u=ba,f=Hp,_=mn,R=pi,k=br,B=Ra,q=yi,ut=Wi,_t=pr,Dt=Us,ht=pe,pt=hd,ve=Vl,ae=ql,wn=HR,rt=dn("iterator"),et="URLSearchParams",lt=et+"Iterator",Ot=u.set,Yt=u.getterFor(et),We=u.getterFor(lt),ie=Object.getOwnPropertyDescriptor,he=function(t){if(!zo)return zs[t];var e=ie(zs,t);return e&&e.value},Mi=he("fetch"),tn=he("Request"),sa=he("Headers"),W_=tn&&tn.prototype,Kw=sa&&sa.prototype,AB=zs.RegExp,bB=zs.TypeError,Yw=zs.decodeURIComponent,IB=zs.encodeURIComponent,OB=Pr("".charAt),zw=Pr([].join),qd=Pr([].push),jA=Pr("".replace),wB=Pr([].shift),qw=Pr([].splice),Xw=Pr("".split),NB=Pr("".slice),DB=/\+/g,Jw=Array(4),LB=function(t){return Jw[t-1]||(Jw[t-1]=AB("((?:%[\\da-f]{2}){"+t+"})","gi"))},PB=function(t){try{return Yw(t)}catch{return t}},Qw=function(t){var e=jA(t,DB," "),n=4;try{return Yw(e)}catch{for(;n;)e=jA(e,LB(n--),PB);return e}},kB=/[!'()~]|%20/g,MB={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},UB=function(t){return MB[t]},Zw=function(t){return jA(IB(t),kB,UB)},GA=o(function(t,e){Ot(this,{type:lt,iterator:pt(Yt(t).entries),kind:e})},"Iterator",function(){var t=We(this),e=t.kind,n=t.iterator.next(),i=n.value;return n.done||(n.value=e==="keys"?i.key:e==="values"?i.value:[i.key,i.value]),n},!0),$w=function(t){this.entries=[],this.url=null,t!==void 0&&(ut(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?OB(t,0)==="?"?NB(t,1):t:_t(t)))};$w.prototype={type:et,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,s,c,l,d=ve(t);if(d)for(n=(e=pt(t,d)).next;!(i=Yd(n,e)).done;){if(s=(r=pt(q(i.value))).next,(c=Yd(s,r)).done||(l=Yd(s,r)).done||!Yd(s,r).done)throw bB("Expected sequence with length 2");qd(this.entries,{key:_t(c.value),value:_t(l.value)})}else for(var h in t)R(t,h)&&qd(this.entries,{key:h,value:_t(t[h])})},parseQuery:function(t){if(t)for(var e,n,i=Xw(t,"&"),r=0;r<i.length;)(e=i[r++]).length&&(n=Xw(e,"="),qd(this.entries,{key:Qw(wB(n)),value:Qw(zw(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],qd(n,Zw(t.key)+"="+Zw(t.value));return zw(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var WR=function(){f(this,Af);var t=Ot(this,new $w(arguments.length>0?arguments[0]:void 0));zo||(this.size=t.entries.length)},Af=WR.prototype;if(Cf(Af,{append:function(t,e){var n=Yt(this);ae(arguments.length,2),qd(n.entries,{key:_t(t),value:_t(e)}),zo||this.length++,n.updateURL()},delete:function(t){for(var e=Yt(this),n=ae(arguments.length,1),i=e.entries,r=_t(t),s=n<2?void 0:arguments[1],c=s===void 0?s:_t(s),l=0;l<i.length;){var d=i[l];if(d.key!==r||c!==void 0&&d.value!==c)l++;else if(qw(i,l,1),c!==void 0)break}zo||(this.size=i.length),e.updateURL()},get:function(t){var e=Yt(this).entries;ae(arguments.length,1);for(var n=_t(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=Yt(this).entries;ae(arguments.length,1);for(var n=_t(t),i=[],r=0;r<e.length;r++)e[r].key===n&&qd(i,e[r].value);return i},has:function(t){for(var e=Yt(this).entries,n=ae(arguments.length,1),i=_t(t),r=n<2?void 0:arguments[1],s=r===void 0?r:_t(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(s===void 0||l.value===s))return!0}return!1},set:function(t,e){var n=Yt(this);ae(arguments.length,1);for(var i,r=n.entries,s=!1,c=_t(t),l=_t(e),d=0;d<r.length;d++)(i=r[d]).key===c&&(s?qw(r,d--,1):(s=!0,i.value=l));s||qd(r,{key:c,value:l}),zo||(this.size=r.length),n.updateURL()},sort:function(){var t=Yt(this);wn(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=Yt(this).entries,i=k(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new GA(this,"keys")},values:function(){return new GA(this,"values")},entries:function(){return new GA(this,"entries")}},{enumerable:!0}),H_(Af,rt,Af.entries,{}),H_(Af,"toString",function(){return Yt(this).serialize()},{enumerable:!0}),zo&&FA(Af,"size",{get:function(){return Yt(this).entries.length},configurable:!0,enumerable:!0}),a(WR,et),du({global:!0,forced:!zd},{URLSearchParams:WR}),!zd&&_(sa)){var xB=Pr(Kw.has),VB=Pr(Kw.set),t0=function(t){if(ut(t)){var e,n=t.body;if(B(n)===et)return e=t.headers?new sa(t.headers):new sa,xB(e,"content-type")||VB(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Dt(t,{body:ht(0,_t(n)),headers:ht(0,e)})}return t};if(_(Mi)&&du({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return Mi(t,arguments.length>1?t0(arguments[1]):{})}}),_(tn)){var HA=function(t){return f(this,W_),new tn(t,arguments.length>1?t0(arguments[1]):{})};W_.constructor=HA,HA.prototype=W_,du({global:!0,dontCallGetSet:!0,forced:!0},{Request:HA})}}var os,BB={URLSearchParams:WR,getState:Yt},FB=Wr.URLSearchParams,e0=Rt,jB=st,GB=Re,HB=x,WA=cd,WB=Ci,KB=tt,YB=za,zB=_c,bf=Object.assign,n0=Object.defineProperty,qB=jB([].concat),XB=!bf||HB(function(){if(e0&&bf({b:1},bf(n0({},"a",{enumerable:!0,get:function(){n0(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),bf({},t)[n]!=7||WA(bf({},e)).join("")!=i})?function(t,e){for(var n=YB(t),i=arguments.length,r=1,s=WB.f,c=KB.f;i>r;)for(var l,d=zB(arguments[r++]),h=s?qB(WA(d),s(d)):WA(d),p=h.length,m=0;p>m;)l=h[m++],e0&&!GB(c,d,l)||(n[l]=d[l]);return n}:bf,JB=yi,QB=Bl,ZB=br,$B=Re,tF=za,eF=function(t,e,n,i){try{return i?e(JB(n)[0],n[1]):e(n)}catch(r){QB(t,"throw",r)}},nF=Ao,iF=zl,rF=Is,i0=Pa,aF=hd,sF=Vl,r0=Array,Xd=st,KA=2147483647,oF=/[^\0-\u007E]/,a0=/[.\u3002\uFF0E\uFF61]/g,s0="Overflow: input needs wider integers to process",o0=RangeError,cF=Xd(a0.exec),If=Math.floor,YA=String.fromCharCode,c0=Xd("".charCodeAt),l0=Xd([].join),hu=Xd([].push),lF=Xd("".replace),uF=Xd("".split),dF=Xd("".toLowerCase),u0=function(t){return t+22+75*(t<26)},hF=function(t,e,n){var i=0;for(t=n?If(t/700):t>>1,t+=If(t/e);t>455;)t=If(t/35),i+=36;return If(i+36*t/(t+38))},pF=function(t){var e=[];t=function(N){for(var D=[],V=0,W=N.length;V<W;){var K=c0(N,V++);if(K>=55296&&K<=56319&&V<W){var j=c0(N,V++);(64512&j)==56320?hu(D,((1023&K)<<10)+(1023&j)+65536):(hu(D,K),V--)}else hu(D,K)}return D}(t);var n,i,r=t.length,s=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&hu(e,YA(i));var d=e.length,h=d;for(d&&hu(e,"-");h<r;){var p=KA;for(n=0;n<t.length;n++)(i=t[n])>=s&&i<p&&(p=i);var m=h+1;if(p-s>If((KA-c)/m))throw o0(s0);for(c+=(p-s)*m,s=p,n=0;n<t.length;n++){if((i=t[n])<s&&++c>KA)throw o0(s0);if(i==s){for(var E=c,g=36;;){var I=g<=l?1:g>=l+26?26:g-l;if(E<I)break;var y=E-I,C=36-I;hu(e,YA(u0(I+y%C))),E=If(y/C),g+=36}hu(e,YA(u0(E))),l=hF(c,m,h==d),c=0,h++}}c++,s++}return l0(e,"")},fF=De,zA=Rt,mF=lu,qA=it,d0=br,cs=st,KR=bo,ls=Kl,EF=Hp,XA=pi,JA=XB,Of=function(t){var e=tF(t),n=iF(this),i=arguments.length,r=i>1?arguments[1]:void 0,s=r!==void 0;s&&(r=ZB(r,i>2?arguments[2]:void 0));var c,l,d,h,p,m,E=sF(e),g=0;if(!E||this===r0&&nF(E))for(c=rF(e),l=n?new this(c):r0(c);c>g;g++)m=s?r(e[g],g):e[g],i0(l,g,m);else for(p=(h=aF(e,E)).next,l=n?new this:[];!(d=$B(p,h)).done;g++)m=s?eF(h,r,[d.value,g],!0):d.value,i0(l,g,m);return l.length=g,l},qs=Rf,_F=Wo.codeAt,gF=function(t){var e,n,i=[],r=uF(lF(dF(t),a0,"."),".");for(e=0;e<r.length;e++)n=r[e],hu(i,cF(oF,n)?"xn--"+pF(n):n);return l0(i,".")},Yc=pr,SF=Za,TF=ql,h0=BB,p0=ba,RF=p0.set,YR=p0.getterFor("URL"),vF=h0.URLSearchParams,yF=h0.getState,K_=qA.URL,QA=qA.TypeError,zR=qA.parseInt,CF=Math.floor,f0=Math.pow,us=cs("".charAt),Xs=cs(/./.exec),Y_=cs([].join),AF=cs(1 .toString),bF=cs([].pop),wf=cs([].push),ZA=cs("".replace),IF=cs([].shift),OF=cs("".split),z_=cs("".slice),qR=cs("".toLowerCase),wF=cs([].unshift),$A="Invalid scheme",Jd="Invalid host",m0="Invalid port",E0=/[a-z]/i,NF=/[\d+-.a-z]/i,tb=/\d/,DF=/^0x/i,LF=/^[0-7]+$/,PF=/^\d+$/,_0=/^[\da-f]+$/i,kF=/[\0\t\n\r #%/:<>?@[\\\]^|]/,MF=/[\0\t\n\r #/:<>?@[\\\]^|]/,UF=/^[\u0000-\u0020]+/,xF=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,VF=/[\t\n\r]/g,q_=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)wF(e,t%256),t=CF(t/256);return Y_(e,".")}if(typeof t=="object"){for(e="",i=function(s){for(var c=null,l=1,d=null,h=0,p=0;p<8;p++)s[p]!==0?(h>l&&(c=d,l=h),d=null,h=0):(d===null&&(d=p),++h);return h>l&&(c=d,l=h),c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=AF(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},XR={},g0=JA({},XR,{" ":1,'"':1,"<":1,">":1,"`":1}),S0=JA({},g0,{"#":1,"?":1,"{":1,"}":1}),eb=JA({},S0,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),pu=function(t,e){var n=_F(t,0);return n>32&&n<127&&!XA(e,t)?t:encodeURIComponent(t)},JR={ftp:21,file:null,http:80,https:443,ws:80,wss:443},X_=function(t,e){var n;return t.length==2&&Xs(E0,us(t,0))&&((n=us(t,1))==":"||!e&&n=="|")},T0=function(t){var e;return t.length>1&&X_(z_(t,0,2))&&(t.length==2||(e=us(t,2))==="/"||e==="\\"||e==="?"||e==="#")},BF=function(t){return t==="."||qR(t)==="%2e"},nb={},R0={},ib={},v0={},y0={},rb={},C0={},A0={},QR={},ZR={},ab={},sb={},ob={},cb={},b0={},lb={},Nf={},qo={},I0={},Qd={},zc={},ub=function(t,e,n){var i,r,s,c=Yc(t);if(e){if(r=this.parse(c))throw QA(r);this.searchParams=null}else{if(n!==void 0&&(i=new ub(n,!0)),r=this.parse(c,null,i))throw QA(r);(s=yF(new vF)).bindURL(this),this.searchParams=s}};ub.prototype={type:"URL",parse:function(t,e,n){var i,r,s,c,l,d=this,h=e||nb,p=0,m="",E=!1,g=!1,I=!1;for(t=Yc(t),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,t=ZA(t,UF,""),t=ZA(t,xF,"$1")),t=ZA(t,VF,""),i=Of(t);p<=i.length;){switch(r=i[p],h){case nb:if(!r||!Xs(E0,r)){if(e)return $A;h=ib;continue}m+=qR(r),h=R0;break;case R0:if(r&&(Xs(NF,r)||r=="+"||r=="-"||r=="."))m+=qR(r);else{if(r!=":"){if(e)return $A;m="",h=ib,p=0;continue}if(e&&(d.isSpecial()!=XA(JR,m)||m=="file"&&(d.includesCredentials()||d.port!==null)||d.scheme=="file"&&!d.host))return;if(d.scheme=m,e)return void(d.isSpecial()&&JR[d.scheme]==d.port&&(d.port=null));m="",d.scheme=="file"?h=cb:d.isSpecial()&&n&&n.scheme==d.scheme?h=v0:d.isSpecial()?h=A0:i[p+1]=="/"?(h=y0,p++):(d.cannotBeABaseURL=!0,wf(d.path,""),h=I0)}break;case ib:if(!n||n.cannotBeABaseURL&&r!="#")return $A;if(n.cannotBeABaseURL&&r=="#"){d.scheme=n.scheme,d.path=qs(n.path),d.query=n.query,d.fragment="",d.cannotBeABaseURL=!0,h=zc;break}h=n.scheme=="file"?cb:rb;continue;case v0:if(r!="/"||i[p+1]!="/"){h=rb;continue}h=QR,p++;break;case y0:if(r=="/"){h=ZR;break}h=qo;continue;case rb:if(d.scheme=n.scheme,r==os)d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.query=n.query;else if(r=="/"||r=="\\"&&d.isSpecial())h=C0;else if(r=="?")d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.query="",h=Qd;else{if(r!="#"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.path.length--,h=qo;continue}d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=qs(n.path),d.query=n.query,d.fragment="",h=zc}break;case C0:if(!d.isSpecial()||r!="/"&&r!="\\"){if(r!="/"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,h=qo;continue}h=ZR}else h=QR;break;case A0:if(h=QR,r!="/"||us(m,p+1)!="/")continue;p++;break;case QR:if(r!="/"&&r!="\\"){h=ZR;continue}break;case ZR:if(r=="@"){E&&(m="%40"+m),E=!0,s=Of(m);for(var y=0;y<s.length;y++){var C=s[y];if(C!=":"||I){var N=pu(C,eb);I?d.password+=N:d.username+=N}else I=!0}m=""}else if(r==os||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()){if(E&&m=="")return"Invalid authority";p-=Of(m).length+1,m="",h=ab}else m+=r;break;case ab:case sb:if(e&&d.scheme=="file"){h=lb;continue}if(r!=":"||g){if(r==os||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()){if(d.isSpecial()&&m=="")return Jd;if(e&&m==""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(m))return c;if(m="",h=Nf,e)return;continue}r=="["?g=!0:r=="]"&&(g=!1),m+=r}else{if(m=="")return Jd;if(c=d.parseHost(m))return c;if(m="",h=ob,e==sb)return}break;case ob:if(!Xs(tb,r)){if(r==os||r=="/"||r=="?"||r=="#"||r=="\\"&&d.isSpecial()||e){if(m!=""){var D=zR(m,10);if(D>65535)return m0;d.port=d.isSpecial()&&D===JR[d.scheme]?null:D,m=""}if(e)return;h=Nf;continue}return m0}m+=r;break;case cb:if(d.scheme="file",r=="/"||r=="\\")h=b0;else{if(!n||n.scheme!="file"){h=qo;continue}if(r==os)d.host=n.host,d.path=qs(n.path),d.query=n.query;else if(r=="?")d.host=n.host,d.path=qs(n.path),d.query="",h=Qd;else{if(r!="#"){T0(Y_(qs(i,p),""))||(d.host=n.host,d.path=qs(n.path),d.shortenPath()),h=qo;continue}d.host=n.host,d.path=qs(n.path),d.query=n.query,d.fragment="",h=zc}}break;case b0:if(r=="/"||r=="\\"){h=lb;break}n&&n.scheme=="file"&&!T0(Y_(qs(i,p),""))&&(X_(n.path[0],!0)?wf(d.path,n.path[0]):d.host=n.host),h=qo;continue;case lb:if(r==os||r=="/"||r=="\\"||r=="?"||r=="#"){if(!e&&X_(m))h=qo;else if(m==""){if(d.host="",e)return;h=Nf}else{if(c=d.parseHost(m))return c;if(d.host=="localhost"&&(d.host=""),e)return;m="",h=Nf}continue}m+=r;break;case Nf:if(d.isSpecial()){if(h=qo,r!="/"&&r!="\\")continue}else if(e||r!="?")if(e||r!="#"){if(r!=os&&(h=qo,r!="/"))continue}else d.fragment="",h=zc;else d.query="",h=Qd;break;case qo:if(r==os||r=="/"||r=="\\"&&d.isSpecial()||!e&&(r=="?"||r=="#")){if((l=qR(l=m))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),r=="/"||r=="\\"&&d.isSpecial()||wf(d.path,"")):BF(m)?r=="/"||r=="\\"&&d.isSpecial()||wf(d.path,""):(d.scheme=="file"&&!d.path.length&&X_(m)&&(d.host&&(d.host=""),m=us(m,0)+":"),wf(d.path,m)),m="",d.scheme=="file"&&(r==os||r=="?"||r=="#"))for(;d.path.length>1&&d.path[0]==="";)IF(d.path);r=="?"?(d.query="",h=Qd):r=="#"&&(d.fragment="",h=zc)}else m+=pu(r,S0);break;case I0:r=="?"?(d.query="",h=Qd):r=="#"?(d.fragment="",h=zc):r!=os&&(d.path[0]+=pu(r,XR));break;case Qd:e||r!="#"?r!=os&&(r=="'"&&d.isSpecial()?d.query+="%27":d.query+=r=="#"?"%23":pu(r,XR)):(d.fragment="",h=zc);break;case zc:r!=os&&(d.fragment+=pu(r,g0))}p++}},parseHost:function(t){var e,n,i;if(us(t,0)=="["){if(us(t,t.length-1)!="]"||(e=function(r){var s,c,l,d,h,p,m,E=[0,0,0,0,0,0,0,0],g=0,I=null,y=0,C=function(){return us(r,y)};if(C()==":"){if(us(r,1)!=":")return;y+=2,I=++g}for(;C();){if(g==8)return;if(C()!=":"){for(s=c=0;c<4&&Xs(_0,C());)s=16*s+zR(C(),16),y++,c++;if(C()=="."){if(c==0||(y-=c,g>6))return;for(l=0;C();){if(d=null,l>0){if(!(C()=="."&&l<4))return;y++}if(!Xs(tb,C()))return;for(;Xs(tb,C());){if(h=zR(C(),10),d===null)d=h;else{if(d==0)return;d=10*d+h}if(d>255)return;y++}E[g]=256*E[g]+d,++l!=2&&l!=4||g++}if(l!=4)return;break}if(C()==":"){if(y++,!C())return}else if(C())return;E[g++]=s}else{if(I!==null)return;y++,I=++g}}if(I!==null)for(p=g-I,g=7;g!=0&&p>0;)m=E[g],E[g--]=E[I+p-1],E[I+--p]=m;else if(g!=8)return;return E}(z_(t,1,-1)),!e))return Jd;this.host=e}else if(this.isSpecial()){if(t=gF(t),Xs(kF,t)||(e=function(r){var s,c,l,d,h,p,m,E=OF(r,".");if(E.length&&E[E.length-1]==""&&E.length--,(s=E.length)>4)return r;for(c=[],l=0;l<s;l++){if((d=E[l])=="")return r;if(h=10,d.length>1&&us(d,0)=="0"&&(h=Xs(DF,d)?16:8,d=z_(d,h==8?1:2)),d==="")p=0;else{if(!Xs(h==10?PF:h==8?LF:_0,d))return r;p=zR(d,h)}wf(c,p)}for(l=0;l<s;l++)if(p=c[l],l==s-1){if(p>=f0(256,5-s))return null}else if(p>255)return null;for(m=bF(c),l=0;l<c.length;l++)m+=c[l]*f0(256,3-l);return m}(t),e===null))return Jd;this.host=e}else{if(Xs(MF,t))return Jd;for(e="",n=Of(t),i=0;i<n.length;i++)e+=pu(n[i],XR);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return XA(JR,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&X_(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,s=t.port,c=t.path,l=t.query,d=t.fragment,h=e+":";return r!==null?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=q_(r),s!==null&&(h+=":"+s)):e=="file"&&(h+="//"),h+=t.cannotBeABaseURL?c[0]:c.length?"/"+Y_(c,"/"):"",l!==null&&(h+="?"+l),d!==null&&(h+="#"+d),h},setHref:function(t){var e=this.parse(t);if(e)throw QA(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new Df(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+q_(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Yc(t)+":",nb)},getUsername:function(){return this.username},setUsername:function(t){var e=Of(Yc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=pu(e[n],eb)}},getPassword:function(){return this.password},setPassword:function(t){var e=Of(Yc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=pu(e[n],eb)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?q_(t):q_(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,ab)},getHostname:function(){var t=this.host;return t===null?"":q_(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,sb)},getPort:function(){var t=this.port;return t===null?"":Yc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Yc(t))==""?this.port=null:this.parse(t,ob))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Y_(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Nf))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Yc(t))==""?this.query=null:(us(t,0)=="?"&&(t=z_(t,1)),this.query="",this.parse(t,Qd)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Yc(t))!=""?(us(t,0)=="#"&&(t=z_(t,1)),this.fragment="",this.parse(t,zc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Df=function(t){var e=EF(this,Qr),n=TF(arguments.length,1)>1?arguments[1]:void 0,i=RF(e,new ub(t,!1,n));zA||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Qr=Df.prototype,ds=function(t,e){return{get:function(){return YR(this)[t]()},set:e&&function(n){return YR(this)[e](n)},configurable:!0,enumerable:!0}};if(zA&&(ls(Qr,"href",ds("serialize","setHref")),ls(Qr,"origin",ds("getOrigin")),ls(Qr,"protocol",ds("getProtocol","setProtocol")),ls(Qr,"username",ds("getUsername","setUsername")),ls(Qr,"password",ds("getPassword","setPassword")),ls(Qr,"host",ds("getHost","setHost")),ls(Qr,"hostname",ds("getHostname","setHostname")),ls(Qr,"port",ds("getPort","setPort")),ls(Qr,"pathname",ds("getPathname","setPathname")),ls(Qr,"search",ds("getSearch","setSearch")),ls(Qr,"searchParams",ds("getSearchParams")),ls(Qr,"hash",ds("getHash","setHash"))),KR(Qr,"toJSON",function(){return YR(this).serialize()},{enumerable:!0}),KR(Qr,"toString",function(){return YR(this).serialize()},{enumerable:!0}),K_){var O0=K_.createObjectURL,w0=K_.revokeObjectURL;O0&&KR(Df,"createObjectURL",d0(O0,K_)),w0&&KR(Df,"revokeObjectURL",d0(w0,K_))}SF(Df,"URL"),fF({global:!0,forced:!mF,sham:!zA},{URL:Df});var FF=De,jF=x,GF=ql,N0=pr,HF=lu,D0=kn("URL");FF({target:"URL",stat:!0,forced:!(HF&&jF(function(){D0.canParse()}))},{canParse:function(t){var e=GF(arguments.length,1),n=N0(t),i=e<2||arguments[1]===void 0?void 0:N0(arguments[1]);try{return!!new D0(n,i)}catch{return!1}}});var $R=P(Wr.URL);let L0=!0,P0=!0;function tv(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function Zd(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const d=h=>{const p=n(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),r.apply(this,[c,d])};const s=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function WF(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(L0=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function KF(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(P0=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function k0(){if(typeof window=="object"){if(L0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function db(t,e){P0&&console.warn(t+" is deprecated, please use "+e+" instead.")}function M0(t){return Object.prototype.toString.call(t)==="[object Object]"}function U0(t){var e;return M0(t)?er(e=Object.keys(t)).call(e,function(n,i){const r=M0(t[i]),s=r?U0(t[i]):t[i],c=r&&!Object.keys(s).length;return s===void 0||c?n:Object.assign(n,{[i]:s})},{}):t}function hb(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?hb(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{hb(t,t.get(r),n)})}))}function x0(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&hb(t,l,r)})}),r}const V0=k0;function B0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const h=typeof c[d]=="object"?c[d]:{ideal:c[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(m,E){return m?m+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(h.ideal!==void 0){l.optional=l.optional||[];let m={};typeof h.ideal=="number"?(m[p("min",d)]=h.ideal,l.optional.push(m),m={},m[p("max",d)]=h.ideal,l.optional.push(m)):(m[p("",d)]=h.ideal,l.optional.push(m))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",d)]=h.exact):["min","max"].forEach(m=>{h[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(m,d)]=h[m])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const d=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const h=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(m=>{let E=(m=m.filter(g=>g.kind==="videoinput")).find(g=>p.some(I=>{var y;return Et(y=g.label.toLowerCase()).call(y,I)}));return!E&&m.length&&Et(p).call(p,"back")&&(E=m[m.length-1]),E&&(c.video.deviceId=d.exact?{exact:E.deviceId}:{ideal:E.deviceId}),c.video=i(c.video),V0("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return V0("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,d){r(c,h=>{n.webkitGetUserMedia(h,l,p=>{d&&d(s(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>St.reject(s(h))))}}}function F0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function j0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Zd(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function G0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{const c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function H0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const s=function(l){const d={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(m=>{p[m]=h.stat(m)}),d[p.id]=p}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){const l=function(d){i(c(s(d)))};return e.apply(this,[l,n])}return new St((l,d)=>{e.apply(this,[function(h){l(c(s(h)))},d])}).then(i,r)}}function W0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>x0(s,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),Zd(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>x0(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,s;return this.getSenders().forEach(c=>{c.track===n&&(i?s=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?s=!0:r=c),c.track===n)),s||i&&r?St.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():St.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function K0(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function Y0(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return K0(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;function s(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const E=d._reverseStreams[m],g=d._streams[E.id];p=p.replace(new RegExp(g.id,"g"),E.id)}),new RTCSessionDescription({type:h.type,sdp:p})}t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const E=this._streams[h.id];if(E)E.addTrack(d),St.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([d]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===d)},["createOffer","createAnswer"].forEach(function(d){const h=t.RTCPeerConnection.prototype[d],p={[d](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[E=>{const g=s(this,E);m[0].apply(null,[g])},E=>{m[1]&&m[1].apply(null,E)},arguments[2]]):h.apply(this,arguments).then(E=>s(this,E))}};t.RTCPeerConnection.prototype[d]=p[d]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{const E=d._reverseStreams[m],g=d._streams[E.id];p=p.replace(new RegExp(E.id,"g"),g.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=l.get.apply(this);return d.type===""?d:s(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>d.track===m)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function pb(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function z0(t,e){Zd(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var q0=Object.freeze({__proto__:null,fixNegotiationNeeded:z0,shimAddTrackRemoveTrack:Y0,shimAddTrackRemoveTrackWithNative:K0,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,s=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),s&&(n.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:G0,shimGetStats:H0,shimGetUserMedia:B0,shimMediaStream:F0,shimOnTrack:j0,shimPeerConnection:pb,shimSenderReceiverGetStats:W0});function X0(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,c){db("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function J0(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fb(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,s,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!s)try{l.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(s,c)}}function Q0(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):St.resolve(new Map)}}function Z0(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Zd(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $0(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){db("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&Et(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function tN(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function eN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:s}=r,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function nN(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function iN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?St.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function rN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?St.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var aN=Object.freeze({__proto__:null,shimAddTransceiver:eN,shimCreateAnswer:rN,shimCreateOffer:iN,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,St.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:nN,shimGetUserMedia:X0,shimOnTrack:J0,shimPeerConnection:fb,shimRTCDataChannel:tN,shimReceiverGetStats:Z0,shimRemoveStream:$0,shimSenderGetStats:Q0});function sN(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),Et(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r&&r.forEach(c=>{var l;this._localStreams?Et(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{Et(i).call(i,r.track)&&this.removeTrack(r)})})}}function oN(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Et(s=this._remoteStreams).call(s,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,n.dispatchEvent(s)})}),e.apply(n,arguments)}}}function cN(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[p]);return h?(m.then(d,h),St.resolve()):m},e.createAnswer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[p]);return h?(m.then(d,h),St.resolve()):m};let l=function(d,h,p){const m=r.apply(this,[d]);return p?(m.then(h,p),St.resolve()):m};e.setLocalDescription=l,l=function(d,h,p){const m=s.apply(this,[d]);return p?(m.then(h,p),St.resolve()):m},e.setRemoteDescription=l,l=function(d,h,p){const m=c.apply(this,[d]);return p?(m.then(h,p),St.resolve()):m},e.addIceCandidate=l}function lN(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(uN(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function uN(t){return t&&t.video!==void 0?Object.assign({},t,{video:U0(t.video)}):t}function dN(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let s=0;s<n.iceServers.length;s++){let c=n.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(db("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[s])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function hN(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pN(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function fN(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var mN=Object.freeze({__proto__:null,shimAudioContext:fN,shimCallbacksAPI:cN,shimConstraints:uN,shimCreateOfferLegacy:pN,shimGetUserMedia:lN,shimLocalStreamsAPI:sN,shimRTCIceServerUrls:dN,shimRemoteStreamsAPI:oN,shimTrackEventTransceiver:hN}),EN=`	
\v\f\r                　\u2028\u2029\uFEFF`,YF=fl,zF=pr,mb=EN,_N=st("".replace),qF=RegExp("^["+mb+"]+"),XF=RegExp("(^|[^"+mb+"])["+mb+"]+$"),JF=function(t){return function(e){var n=zF(YF(e));return 1&t&&(n=_N(n,qF,"")),2&t&&(n=_N(n,XF,"$1")),n}},QF={trim:JF(3)},ZF=XE.PROPER,$F=x,gN=EN,tj=QF.trim;De({target:"String",proto:!0,forced:function(t){return $F(function(){return!!gN[t]()||"​᠎"[t]()!=="​᠎"||ZF&&gN[t].name!==t})}("trim")},{trim:function(){return tj(this)}});var ej=hr("String").trim,nj=mt,ij=ej,Eb=String.prototype,rj=function(t){var e=t.trim;return typeof t=="string"||t===Eb||nj(Eb,t)&&e===Eb.trim?ij:e},Ji=P(rj),SN={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)r=s[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?s.push(c+"="+n.parameters[c]):s.push(c)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],d=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(d){const h=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=p.length?e.parseFmtp(p[0]):{},h.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let s=0;return i.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(E=>e.parseSsrcMedia(E)).filter(E=>E.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(E=>E.substring(17).split(" ").map(g=>parseInt(g,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(h=p[0][1]),r.codecs.forEach(E=>{if(E.name.toUpperCase()==="RTX"&&E.parameters.apt){let g={ssrc:d,codecPayloadType:parseInt(E.parameters.apt,10)};d&&h&&(g.rtx={ssrc:h}),i.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},i.push(g))}}),i.length===0&&d&&i.push({ssrc:d});let m=e.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,i.forEach(E=>{E.maxBitrate=m})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(i=s[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const c=i!==void 0?i:2;return s=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(SN);var TN=SN.exports,Lf=P(TN),aj=w({__proto__:null,default:Lf},[TN]);function ev(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=Lf.parseCandidate(n.candidate),s=Object.assign(i,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Zd(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function _b(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Zd(t,"icecandidate",e=>{if(e.candidate){const n=Lf.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function nv(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const d=Lf.splitSections(l.sdp);return d.shift(),d.some(h=>{const p=Lf.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!=h?-1:h},r=function(l){let d=65536;return e.browser==="firefox"&&(d=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d},s=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=Lf.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),d=r(l),h=s(arguments[0],l);let p;p=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>p}),this._sctp=m}return c.apply(this,arguments)}}function iv(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Zd(t,"datachannel",i=>(e(i.channel,i.target),i))}function gb(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",r);s.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Sb(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(s=>Ji(s).call(s)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function rv(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?St.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),St.resolve())})}function av(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var sj=Object.freeze({__proto__:null,removeExtmapAllowMixed:Sb,shimAddIceCandidateNullOrEmpty:rv,shimConnectionState:gb,shimMaxMessageSize:nv,shimParameterlessSetLocalDescription:av,shimRTCIceCandidate:ev,shimRTCIceCandidateRelayProtocol:_b,shimSendThrowTypeError:iv});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=k0,i=function(s){const c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;const{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=tv(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=tv(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=tv(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:sj,extractVersion:tv,disableLog:WF,disableWarnings:KF,sdp:aj};switch(i.browser){case"chrome":if(!q0||!pb||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=q0,rv(t,i),av(t),B0(t,i),F0(t),pb(t,i),j0(t),Y0(t,i),G0(t),H0(t),W0(t),z0(t,i),ev(t),_b(t),gb(t),nv(t,i),iv(t),Sb(t,i);break;case"firefox":if(!aN||!fb||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=aN,rv(t,i),av(t),X0(t,i),fb(t,i),J0(t),$0(t),Q0(t),Z0(t),tN(t),eN(t),nN(t),iN(t),rN(t),ev(t),gb(t),nv(t,i),iv(t);break;case"safari":if(!mN||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=mN,rv(t,i),av(t),dN(t),pN(t),cN(t),sN(t),oN(t),hN(t),lN(t),fN(t),ev(t),_b(t),nv(t,i),iv(t),Sb(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var RN=fo,oj=TypeError,vN=ur.match(/firefox\/(\d+)/i),cj=!!vN&&+vN[1],lj=/MSIE|Trident/.test(ur),yN=ur.match(/AppleWebKit\/(\d+)\./),uj=!!yN&&+yN[1],dj=De,CN=st,hj=In,pj=za,AN=Is,fj=function(t,e){if(!delete t[e])throw oj("Cannot delete property "+RN(e)+" of "+RN(t))},bN=pr,Tb=x,mj=HR,Ej=fr,IN=cj,_j=lj,ON=Kr,wN=uj,fu=[],NN=CN(fu.sort),gj=CN(fu.push),Sj=Tb(function(){fu.sort(void 0)}),Tj=Tb(function(){fu.sort(null)}),Rj=Ej("sort"),DN=!Tb(function(){if(ON)return ON<70;if(!(IN&&IN>3)){if(_j)return!0;if(wN)return wN<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)fu.push({k:e+i,v:n})}for(fu.sort(function(s,c){return c.v-s.v}),i=0;i<fu.length;i++)e=fu[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});dj({target:"Array",proto:!0,forced:Sj||!Tj||!Rj||!DN},{sort:function(t){t!==void 0&&hj(t);var e=pj(this);if(DN)return t===void 0?NN(e):NN(e,t);var n,i,r=[],s=AN(e);for(i=0;i<s;i++)i in e&&gj(r,e[i]);for(mj(r,function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:bN(l)>bN(d)?1:-1}}(t)),n=AN(r),i=0;i<n;)e[i]=r[i++];for(;i<s;)fj(e,i++);return e}});var vj=hr("Array").sort,yj=mt,Cj=vj,Rb=Array.prototype,Aj=function(t){var e=t.sort;return t===Rb||yj(Rb,t)&&e===Rb.sort?Cj:e},J_=P(Aj),vb=it;De({global:!0,forced:vb.globalThis!==vb},{globalThis:vb});var LN=P(it),yb={exports:{}};(function(t,e){(function(n,i){var r="function",s="undefined",c="object",l="string",d="major",h="model",p="name",m="type",E="vendor",g="version",I="architecture",y="console",C="mobile",N="tablet",D="smarttv",V="wearable",W="embedded",K="Amazon",j="Apple",J="ASUS",ct="BlackBerry",vt="Browser",At="Chrome",le="Firefox",ue="Google",qe="Huawei",Ln="LG",yn="Microsoft",vr="Motorola",nt="Opera",ft="Samsung",kt="Sharp",at="Sony",v="Xiaomi",U="Zebra",F="Facebook",dt="Chromium OS",Qt="Mac OS",Be=function(Kn){for(var ai={},sn=0;sn<Kn.length;sn++)ai[Kn[sn].toUpperCase()]=Kn[sn];return ai},ri=function(Kn,ai){return typeof Kn===l&&Br(ai).indexOf(Br(Kn))!==-1},Br=function(Kn){return Kn.toLowerCase()},ul=function(Kn,ai){if(typeof Kn===l)return Kn=Kn.replace(/^\s\s*/,""),typeof ai===s?Kn:Kn.substring(0,350)},wh=function(Kn,ai){for(var sn,ta,pc,Pn,be,Fr,Uu=0;Uu<ai.length&&!be;){var lo=ai[Uu],aV=ai[Uu+1];for(sn=ta=0;sn<lo.length&&!be&&lo[sn];)if(be=lo[sn++].exec(Kn))for(pc=0;pc<aV.length;pc++)Fr=be[++ta],typeof(Pn=aV[pc])===c&&Pn.length>0?Pn.length===2?typeof Pn[1]==r?this[Pn[0]]=Pn[1].call(this,Fr):this[Pn[0]]=Pn[1]:Pn.length===3?typeof Pn[1]!==r||Pn[1].exec&&Pn[1].test?this[Pn[0]]=Fr?Fr.replace(Pn[1],Pn[2]):i:this[Pn[0]]=Fr?Pn[1].call(this,Fr,Pn[2]):i:Pn.length===4&&(this[Pn[0]]=Fr?Pn[3].call(this,Fr.replace(Pn[1],Pn[2])):i):this[Pn]=Fr||i;Uu+=2}},$g=function(Kn,ai){for(var sn in ai)if(typeof ai[sn]===c&&ai[sn].length>0){for(var ta=0;ta<ai[sn].length;ta++)if(ri(ai[sn][ta],Kn))return sn==="?"?i:sn}else if(ri(ai[sn],Kn))return sn==="?"?i:sn;return Kn},nC={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},iC={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,nt+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[p,nt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+vt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[g,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+vt],g],[/\bfocus\/([\w\.]+)/i],[g,[p,le+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,nt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,nt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI "+vt]],[/fxios\/([-\w\.]+)/i],[g,[p,le]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+vt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+vt],g],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,F],g],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,At+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,At+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+vt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,$g,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,le+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,g],[/(cobalt)\/([\w\.]+)/i],[p,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,Br]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",Br]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,Br]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[E,ft],[m,N]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[E,ft],[m,C]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[E,j],[m,C]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[E,j],[m,N]],[/(macintosh);/i],[h,[E,j]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[E,kt],[m,C]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[E,qe],[m,N]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[E,qe],[m,C]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[E,v],[m,C]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[E,v],[m,N]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[E,"OPPO"],[m,C]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[E,"Vivo"],[m,C]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[E,"Realme"],[m,C]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[E,vr],[m,C]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[E,vr],[m,N]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[E,Ln],[m,N]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[E,Ln],[m,C]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[E,"Lenovo"],[m,N]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[E,"Nokia"],[m,C]],[/(pixel c)\b/i],[h,[E,ue],[m,N]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[E,ue],[m,C]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[E,at],[m,C]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[E,at],[m,N]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[E,"OnePlus"],[m,C]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[E,K],[m,N]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[E,K],[m,C]],[/(playbook);[-\w\),; ]+(rim)/i],[h,E,[m,N]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[E,ct],[m,C]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[E,J],[m,N]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[E,J],[m,C]],[/(nexus 9)/i],[h,[E,"HTC"],[m,N]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[E,[h,/_/g," "],[m,C]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[E,"Acer"],[m,N]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[E,"Meizu"],[m,C]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[E,h,[m,C]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[E,h,[m,N]],[/(surface duo)/i],[h,[E,yn],[m,N]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[E,"Fairphone"],[m,C]],[/(u304aa)/i],[h,[E,"AT&T"],[m,C]],[/\bsie-(\w*)/i],[h,[E,"Siemens"],[m,C]],[/\b(rct\w+) b/i],[h,[E,"RCA"],[m,N]],[/\b(venue[\d ]{2,7}) b/i],[h,[E,"Dell"],[m,N]],[/\b(q(?:mv|ta)\w+) b/i],[h,[E,"Verizon"],[m,N]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[E,"Barnes & Noble"],[m,N]],[/\b(tm\d{3}\w+) b/i],[h,[E,"NuVision"],[m,N]],[/\b(k88) b/i],[h,[E,"ZTE"],[m,N]],[/\b(nx\d{3}j) b/i],[h,[E,"ZTE"],[m,C]],[/\b(gen\d{3}) b.+49h/i],[h,[E,"Swiss"],[m,C]],[/\b(zur\d{3}) b/i],[h,[E,"Swiss"],[m,N]],[/\b((zeki)?tb.*\b) b/i],[h,[E,"Zeki"],[m,N]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[E,"Dragon Touch"],h,[m,N]],[/\b(ns-?\w{0,9}) b/i],[h,[E,"Insignia"],[m,N]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[E,"NextBook"],[m,N]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[E,"Voice"],h,[m,C]],[/\b(lvtel\-)?(v1[12]) b/i],[[E,"LvTel"],h,[m,C]],[/\b(ph-1) /i],[h,[E,"Essential"],[m,C]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[E,"Envizen"],[m,N]],[/\b(trio[-\w\. ]+) b/i],[h,[E,"MachSpeed"],[m,N]],[/\btu_(1491) b/i],[h,[E,"Rotor"],[m,N]],[/(shield[\w ]+) b/i],[h,[E,"Nvidia"],[m,N]],[/(sprint) (\w+)/i],[E,h,[m,C]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[E,yn],[m,C]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[E,U],[m,N]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[E,U],[m,C]],[/smart-tv.+(samsung)/i],[E,[m,D]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[E,ft],[m,D]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[E,Ln],[m,D]],[/(apple) ?tv/i],[E,[h,j+" TV"],[m,D]],[/crkey/i],[[h,At+"cast"],[E,ue],[m,D]],[/droid.+aft(\w)( bui|\))/i],[h,[E,K],[m,D]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[E,kt],[m,D]],[/(bravia[\w ]+)( bui|\))/i],[h,[E,at],[m,D]],[/(mitv-\w{5}) bui/i],[h,[E,v],[m,D]],[/Hbbtv.*(technisat) (.*);/i],[E,h,[m,D]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[E,ul],[h,ul],[m,D]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,D]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[E,h,[m,y]],[/droid.+; (shield) bui/i],[h,[E,"Nvidia"],[m,y]],[/(playstation [345portablevi]+)/i],[h,[E,at],[m,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[E,yn],[m,y]],[/((pebble))app/i],[E,h,[m,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[E,j],[m,V]],[/droid.+; (glass) \d/i],[h,[E,ue],[m,V]],[/droid.+; (wt63?0{2,3})\)/i],[h,[E,U],[m,V]],[/(quest( 2| pro)?)/i],[h,[E,F],[m,V]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[E,[m,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[m,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[m,N]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,N]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,C]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[E,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[g,$g,nC]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[g,$g,nC]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Qt],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,g],[/\(bb(10);/i],[g,[p,ct]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,le+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[p,At+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,dt],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,g]]},Wa=function(Kn,ai){if(typeof Kn===c&&(ai=Kn,Kn=i),!(this instanceof Wa))return new Wa(Kn,ai).getResult();var sn=typeof n!==s&&n.navigator?n.navigator:i,ta=Kn||(sn&&sn.userAgent?sn.userAgent:""),pc=sn&&sn.userAgentData?sn.userAgentData:i,Pn=ai?function(be,Fr){var Uu={};for(var lo in be)Fr[lo]&&Fr[lo].length%2==0?Uu[lo]=Fr[lo].concat(be[lo]):Uu[lo]=be[lo];return Uu}(iC,ai):iC;return this.getBrowser=function(){var be={};return be[p]=i,be[g]=i,wh.call(be,ta,Pn.browser),be[d]=function(Fr){return typeof Fr===l?Fr.replace(/[^\d\.]/g,"").split(".")[0]:i}(be[g]),sn&&sn.brave&&typeof sn.brave.isBrave==r&&(be[p]="Brave"),be},this.getCPU=function(){var be={};return be[I]=i,wh.call(be,ta,Pn.cpu),be},this.getDevice=function(){var be={};return be[E]=i,be[h]=i,be[m]=i,wh.call(be,ta,Pn.device),!be[m]&&pc&&pc.mobile&&(be[m]=C),be[h]=="Macintosh"&&sn&&typeof sn.standalone!==s&&sn.maxTouchPoints&&sn.maxTouchPoints>2&&(be[h]="iPad",be[m]=N),be},this.getEngine=function(){var be={};return be[p]=i,be[g]=i,wh.call(be,ta,Pn.engine),be},this.getOS=function(){var be={};return be[p]=i,be[g]=i,wh.call(be,ta,Pn.os),!be[p]&&pc&&pc.platform!="Unknown"&&(be[p]=pc.platform.replace(/chrome os/i,dt).replace(/macos/i,Qt)),be},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ta},this.setUA=function(be){return ta=typeof be===l&&be.length>350?ul(be,350):be,this},this.setUA(ta),this};Wa.VERSION="0.7.34",Wa.BROWSER=Be([p,g,d]),Wa.CPU=Be([I]),Wa.DEVICE=Be([h,E,m,y,C,D,N,V,W]),Wa.ENGINE=Wa.OS=Be([p,g]),t.exports&&(e=t.exports=Wa),e.UAParser=Wa;var Mu=typeof n!==s&&(n.jQuery||n.Zepto);if(Mu&&!Mu.ua){var Nh=new Wa;Mu.ua=Nh.getResult(),Mu.ua.get=function(){return Nh.getUA()},Mu.ua.set=function(Kn){Nh.setUA(Kn);var ai=Nh.getResult();for(var sn in ai)Mu.ua[sn]=ai[sn]}}})(typeof window=="object"?window:b)})(yb,yb.exports);var bj=P(yb.exports),Ij=Ra,Oj=pi,wj=ho,Nj=rn,Dj=dn("iterator"),Lj=Object,Pj=function(t){if(wj(t))return!1;var e=Lj(t);return e[Dj]!==void 0||"@@iterator"in e||Oj(Nj,Ij(e))},kj=P(Pj),PN=Ue.clear;De({global:!0,bind:!0,forced:it.clearImmediate!==PN},{clearImmediate:PN});var Mj=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",kN=it,Uj=Ft,xj=mn,Vj=Mj,Bj=ur,Fj=bd,jj=ql,Gj=kN.Function,Hj=/MSIE .\./.test(Bj)||Vj&&function(){var t=kN.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Wj=De,MN=it,UN=Ue.set,Kj=function(t,e){var n=1;return Hj?function(i,r){var s=jj(arguments.length,1)>n,c=xj(i)?i:Gj(i),l=s?Fj(arguments,n):[],d=s?function(){Uj(c,this,l)}:c;return t(d)}:t},xN=MN.setImmediate?Kj(UN):UN;Wj({global:!0,bind:!0,forced:MN.setImmediate!==xN},{setImmediate:xN});var VN=P(Wr.setImmediate),Yj=De,zj=m_,qj=In,Xj=ql,Jj=ya,Qj=it.process;Yj({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){Xj(arguments.length,1),qj(t);var e=Jj&&Qj.domain;zj(e?e.bind(t):t)}});var BN=P(Wr.queueMicrotask);function FN(t,e){return function(){return t.apply(e,arguments)}}const{toString:Zj}=Object.prototype,{getPrototypeOf:Cb}=Object,sv=(Ab=Object.create(null),t=>{const e=Zj.call(t);return Ab[e]||(Ab[e]=e.slice(8,-1).toLowerCase())});var Ab;const Js=t=>(t=t.toLowerCase(),e=>sv(e)===t),ov=t=>e=>typeof e===t,{isArray:Pf}=Array,Q_=ov("undefined"),jN=Js("ArrayBuffer"),$j=ov("string"),ka=ov("function"),GN=ov("number"),cv=t=>t!==null&&typeof t=="object",lv=t=>{if(sv(t)!=="object")return!1;const e=Cb(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||kj(t))},t3=Js("Date"),e3=Js("File"),n3=Js("Blob"),i3=Js("FileList"),r3=Js("URLSearchParams"),[a3,s3,o3,c3]=["ReadableStream","Request","Response","Headers"].map(Js);function Z_(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Pf(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const s=r?Object.getOwnPropertyNames(t):Object.keys(t),c=s.length;let l;for(n=0;n<c;n++)l=s[n],e.call(null,t[l],l,t)}}function HN(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const $d=LN!==void 0?LN:typeof self<"u"?self:typeof window<"u"?window:fw,WN=t=>!Q_(t)&&t!==$d,l3=(bb=typeof Uint8Array<"u"&&Cb(Uint8Array),t=>bb&&t instanceof bb);var bb;const u3=Js("HTMLFormElement"),KN=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),d3=Js("RegExp"),YN=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};Z_(n,(r,s)=>{let c;(c=e(r,s,t))!==!1&&(i[s]=c||r)}),Object.defineProperties(t,i)},Ib="abcdefghijklmnopqrstuvwxyz",zN="0123456789",qN={DIGIT:zN,ALPHA:Ib,ALPHA_DIGIT:Ib+Ib.toUpperCase()+zN},h3=Js("AsyncFunction"),XN=(JN=typeof VN=="function",QN=ka($d.postMessage),JN?VN:QN?(Ob="axios@".concat(Math.random()),uv=[],$d.addEventListener("message",t=>{let{source:e,data:n}=t;e===$d&&n===Ob&&uv.length&&uv.shift()()},!1),t=>{uv.push(t),$d.postMessage(Ob,"*")}):t=>setTimeout(t));var JN,QN,Ob,uv;const p3=BN!==void 0?BN.bind($d):typeof process<"u"&&process.nextTick||XN;var Tt={isArray:Pf,isArrayBuffer:jN,isBuffer:function(t){return t!==null&&!Q_(t)&&t.constructor!==null&&!Q_(t.constructor)&&ka(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ka(t.append)&&((e=sv(t))==="formdata"||e==="object"&&ka(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&jN(t.buffer),e},isString:$j,isNumber:GN,isBoolean:t=>t===!0||t===!1,isObject:cv,isPlainObject:lv,isReadableStream:a3,isRequest:s3,isResponse:o3,isHeaders:c3,isUndefined:Q_,isDate:t3,isFile:e3,isBlob:n3,isRegExp:d3,isFunction:ka,isStream:t=>cv(t)&&ka(t.pipe),isURLSearchParams:r3,isTypedArray:l3,isFileList:i3,forEach:Z_,merge:function t(){const{caseless:e}=WN(this)&&this||{},n={},i=(r,s)=>{const c=e&&HN(n,s)||s;lv(n[c])&&lv(r)?n[c]=t(n[c],r):lv(r)?n[c]=t({},r):Pf(r)?n[c]=r.slice():n[c]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Z_(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Z_(e,(r,s)=>{n&&ka(r)?t[s]=FN(r,n):t[s]=r},{allOwnKeys:i}),t},trim:t=>Ji(t)?Ji(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,s,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)c=r[s],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&Cb(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:sv,kindOfTest:Js,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(Pf(t))return t;let e=t.length;if(!GN(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:u3,hasOwnProperty:KN,hasOwnProp:KN,reduceDescriptors:YN,freezeMethods:t=>{YN(t,(e,n)=>{if(ka(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];ka(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(s=>{n[s]=!0})};return Pf(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:HN,global:$d,isContextDefined:WN,ALPHABET:qN,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qN.ALPHA_DIGIT,n="";const{length:i}=e;for(;t--;)n+=e[Math.random()*i|0];return n},isSpecCompliantForm:function(t){return!!(t&&ka(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(cv(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=Pf(i)?[]:{};return Z_(i,(c,l)=>{const d=n(c,r+1);!Q_(d)&&(s[l]=d)}),e[r]=void 0,s}}return i};return n(t,0)},isAsyncFn:h3,isThenable:t=>t&&(cv(t)||ka(t))&&ka(t.then)&&ka(t.catch),setImmediate:XN,asap:p3};function xe(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}Tt.inherits(xe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Tt.toJSONObject(this.config),code:this.code,status:this.status}}});const ZN=xe.prototype,$N={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{$N[t]={value:t}}),Object.defineProperties(xe,$N),Object.defineProperty(ZN,"isAxiosError",{value:!0}),xe.from=(t,e,n,i,r,s)=>{const c=Object.create(ZN);return Tt.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),xe.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,s&&Object.assign(c,s),c};function wb(t){return Tt.isPlainObject(t)||Tt.isArray(t)}function tD(t){return Tt.endsWith(t,"[]")?t.slice(0,-2):t}function eD(t,e,n){return t?t.concat(e).map(function(i,r){return i=tD(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const f3=Tt.toFlatObject(Tt,{},null,function(t){return/^is[A-Z]/.test(t)});function dv(t,e,n){if(!Tt.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=Tt.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,g){return!Tt.isUndefined(g[E])})).metaTokens,r=n.visitor||h,s=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&Tt.isSpecCompliantForm(e);if(!Tt.isFunction(r))throw new TypeError("visitor must be a function");function d(E){if(E===null)return"";if(Tt.isDate(E))return E.toISOString();if(!l&&Tt.isBlob(E))throw new xe("Blob is not supported. Use a Buffer instead.");return Tt.isArrayBuffer(E)||Tt.isTypedArray(E)?l&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function h(E,g,I){let y=E;if(E&&!I&&typeof E=="object"){if(Tt.endsWith(g,"{}"))g=i?g:g.slice(0,-2),E=JSON.stringify(E);else if(Tt.isArray(E)&&function(C){return Tt.isArray(C)&&!C.some(wb)}(E)||(Tt.isFileList(E)||Tt.endsWith(g,"[]"))&&(y=Tt.toArray(E)))return g=tD(g),y.forEach(function(C,N){!Tt.isUndefined(C)&&C!==null&&e.append(c===!0?eD([g],N,s):c===null?g:g+"[]",d(C))}),!1}return!!wb(E)||(e.append(eD(I,g,s),d(E)),!1)}const p=[],m=Object.assign(f3,{defaultVisitor:h,convertValue:d,isVisitable:wb});if(!Tt.isObject(t))throw new TypeError("data must be an object");return function E(g,I){if(!Tt.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+I.join("."));p.push(g),Tt.forEach(g,function(y,C){(!(Tt.isUndefined(y)||y===null)&&r.call(e,y,Tt.isString(C)?Ji(C).call(C):C,I,m))===!0&&E(y,I?I.concat(C):[C])}),p.pop()}}(t),e}function nD(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Nb(t,e){this._pairs=[],t&&dv(t,this,e)}const iD=Nb.prototype;function m3(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function rD(t,e,n){if(!e)return t;const i=n&&n.encode||m3;Tt.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let s;if(s=r?r(e,n):Tt.isURLSearchParams(e)?e.toString():new Nb(e,n).toString(i),s){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}iD.append=function(t,e){this._pairs.push([t,e])},iD.toString=function(t){const e=t?function(n){return t.call(this,n,nD)}:nD;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var aD=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Tt.forEach(this.handlers,function(e){e!==null&&t(e)})}},sD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},oD={exports:{}},E3=De,_3=Rt,cD=dr.f;E3({target:"Object",stat:!0,forced:Object.defineProperty!==cD,sham:!_3},{defineProperty:cD});var lD=Wr.Object,g3=oD.exports=function(t,e,n){return lD.defineProperty(t,e,n)};lD.defineProperty.sham&&(g3.sham=!0);var uD=P(oD.exports),S3=TypeError,dD=Yi,T3=zl,R3=Wi,v3=dn("species"),hD=Array,y3=function(t){var e;return dD(t)&&(e=t.constructor,(T3(e)&&(e===hD||dD(e.prototype))||R3(e)&&(e=e[v3])===null)&&(e=void 0)),e===void 0?hD:e},pD=function(t,e){return new(y3(t))(e===0?0:e)},C3=x,A3=Kr,b3=dn("species"),fD=function(t){return A3>=51||!C3(function(){var e=[];return(e.constructor={})[b3]=function(){return{foo:1}},e[t](Boolean).foo!==1})},I3=De,O3=x,w3=Yi,N3=Wi,D3=za,L3=Is,mD=function(t){if(t>9007199254740991)throw S3("Maximum allowed index exceeded");return t},ED=Pa,P3=pD,k3=fD,M3=Kr,_D=dn("isConcatSpreadable"),U3=M3>=51||!O3(function(){var t=[];return t[_D]=!1,t.concat()[0]!==t}),x3=function(t){if(!N3(t))return!1;var e=t[_D];return e!==void 0?!!e:w3(t)};I3({target:"Array",proto:!0,forced:!U3||!k3("concat")},{concat:function(t){var e,n,i,r,s,c=D3(this),l=P3(c,0),d=0;for(e=-1,i=arguments.length;e<i;e++)if(x3(s=e===-1?c:arguments[e]))for(r=L3(s),mD(d+r),n=0;n<r;n++,d++)n in s&&ED(l,d,s[n]);else mD(d+1),ED(l,d++,s);return l.length=d,l}});var gD={},V3=Ne,B3=po,SD=To.f,F3=Rf,TD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];gD.f=function(t){return TD&&V3(t)=="Window"?function(e){try{return SD(e)}catch{return F3(TD)}}(t):SD(B3(t))};var kf={},j3=dn;kf.f=j3;var RD=Wr,G3=pi,H3=kf,W3=dr.f,bi=function(t){var e=RD.Symbol||(RD.Symbol={});G3(e,t)||W3(e,t,{value:H3.f(t)})},K3=Re,Y3=kn,z3=dn,q3=bo,vD=function(){var t=Y3("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=z3("toPrimitive");e&&!e[i]&&q3(e,i,function(r){return K3(n,this)},{})},X3=br,J3=_c,Q3=za,Z3=Is,$3=pD,yD=st([].push),tG=function(t){var e=t==1,n=t==2,i=t==3,r=t==4,s=t==6,c=t==7,l=t==5||s;return function(d,h,p,m){for(var E,g,I=Q3(d),y=J3(I),C=X3(h,p),N=Z3(y),D=0,V=m||$3,W=e?V(d,N):n||c?V(d,0):void 0;N>D;D++)if((l||D in y)&&(g=C(E=y[D],D,I),t))if(e)W[D]=g;else if(g)switch(t){case 3:return!0;case 5:return E;case 6:return D;case 2:yD(W,E)}else switch(t){case 4:return!1;case 7:yD(W,E)}return s?-1:i||r?r:W}},CD={forEach:tG(0)},hv=De,Db=it,Lb=Re,eG=st,Mf=Rt,Uf=gc,nG=x,nr=pi,iG=mt,Pb=yi,pv=po,kb=Yu,rG=pr,Mb=pe,$_=Us,AD=cd,aG=To,bD=gD,sG=Ci,ID=Ri,OD=dr,oG=vo,wD=tt,ND=bo,cG=Kl,Ub=Rc,DD=Dl,LD=Bh,lG=dn,uG=kf,dG=bi,hG=vD,pG=Za,PD=ba,fv=CD.forEach,oa=qa("hidden"),mv="Symbol",tg="prototype",fG=PD.set,kD=PD.getterFor(mv),Qs=Object[tg],th=Db.Symbol,Ev=th&&th[tg],mG=Db.TypeError,xb=Db.QObject,MD=ID.f,eh=OD.f,UD=bD.f,EG=wD.f,xD=eG([].push),qc=Ub("symbols"),eg=Ub("op-symbols"),_G=Ub("wks"),Vb=!xb||!xb[tg]||!xb[tg].findChild,Bb=Mf&&nG(function(){return $_(eh({},"a",{get:function(){return eh(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var i=MD(Qs,e);i&&delete Qs[e],eh(t,e,n),i&&t!==Qs&&eh(Qs,e,i)}:eh,Fb=function(t,e){var n=qc[t]=$_(Ev);return fG(n,{type:mv,tag:t,description:e}),Mf||(n.description=e),n},_v=function(t,e,n){t===Qs&&_v(eg,e,n),Pb(t);var i=kb(e);return Pb(n),nr(qc,i)?(n.enumerable?(nr(t,oa)&&t[oa][i]&&(t[oa][i]=!1),n=$_(n,{enumerable:Mb(0,!1)})):(nr(t,oa)||eh(t,oa,Mb(1,{})),t[oa][i]=!0),Bb(t,i,n)):eh(t,i,n)},jb=function(t,e){Pb(t);var n=pv(e),i=AD(n).concat(jD(n));return fv(i,function(r){Mf&&!Lb(VD,n,r)||_v(t,r,n[r])}),t},VD=function(t){var e=kb(t),n=Lb(EG,this,e);return!(this===Qs&&nr(qc,e)&&!nr(eg,e))&&(!(n||!nr(this,e)||!nr(qc,e)||nr(this,oa)&&this[oa][e])||n)},BD=function(t,e){var n=pv(t),i=kb(e);if(n!==Qs||!nr(qc,i)||nr(eg,i)){var r=MD(n,i);return!r||!nr(qc,i)||nr(n,oa)&&n[oa][i]||(r.enumerable=!0),r}},FD=function(t){var e=UD(pv(t)),n=[];return fv(e,function(i){nr(qc,i)||nr(DD,i)||xD(n,i)}),n},jD=function(t){var e=t===Qs,n=UD(e?eg:pv(t)),i=[];return fv(n,function(r){!nr(qc,r)||e&&!nr(Qs,r)||xD(i,qc[r])}),i};Uf||(th=function(){if(iG(Ev,this))throw mG("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?rG(arguments[0]):void 0,e=LD(t),n=function(i){this===Qs&&Lb(n,eg,i),nr(this,oa)&&nr(this[oa],e)&&(this[oa][e]=!1),Bb(this,e,Mb(1,i))};return Mf&&Vb&&Bb(Qs,e,{configurable:!0,set:n}),Fb(e,t)},ND(Ev=th[tg],"toString",function(){return kD(this).tag}),ND(th,"withoutSetter",function(t){return Fb(LD(t),t)}),wD.f=VD,OD.f=_v,oG.f=jb,ID.f=BD,aG.f=bD.f=FD,sG.f=jD,uG.f=function(t){return Fb(lG(t),t)},Mf&&cG(Ev,"description",{configurable:!0,get:function(){return kD(this).description}})),hv({global:!0,wrap:!0,forced:!Uf,sham:!Uf},{Symbol:th}),fv(AD(_G),function(t){dG(t)}),hv({target:mv,stat:!0,forced:!Uf},{useSetter:function(){Vb=!0},useSimple:function(){Vb=!1}}),hv({target:"Object",stat:!0,forced:!Uf,sham:!Mf},{create:function(t,e){return e===void 0?$_(t):jb($_(t),e)},defineProperty:_v,defineProperties:jb,getOwnPropertyDescriptor:BD}),hv({target:"Object",stat:!0,forced:!Uf},{getOwnPropertyNames:FD}),hG(),pG(th,mv),DD[oa]=!0;var GD=gc&&!!Symbol.for&&!!Symbol.keyFor,gG=De,SG=kn,TG=pi,RG=pr,HD=Rc,vG=GD,Gb=HD("string-to-symbol-registry"),yG=HD("symbol-to-string-registry");gG({target:"Symbol",stat:!0,forced:!vG},{for:function(t){var e=RG(t);if(TG(Gb,e))return Gb[e];var n=SG("Symbol")(e);return Gb[e]=n,yG[n]=e,n}});var CG=De,AG=pi,bG=El,IG=fo,OG=GD,WD=Rc("symbol-to-string-registry");CG({target:"Symbol",stat:!0,forced:!OG},{keyFor:function(t){if(!bG(t))throw TypeError(IG(t)+" is not a symbol");if(AG(WD,t))return WD[t]}});var KD=Yi,wG=mn,YD=Ne,NG=pr,zD=st([].push),DG=De,qD=kn,XD=Ft,LG=Re,ng=st,JD=x,QD=mn,ZD=El,$D=bd,PG=function(t){if(wG(t))return t;if(KD(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?zD(n,r):typeof r!="number"&&YD(r)!="Number"&&YD(r)!="String"||zD(n,NG(r))}var s=n.length,c=!0;return function(l,d){if(c)return c=!1,d;if(KD(this))return d;for(var h=0;h<s;h++)if(n[h]===l)return d}}},kG=gc,MG=String,mu=qD("JSON","stringify"),gv=ng(/./.exec),tL=ng("".charAt),UG=ng("".charCodeAt),xG=ng("".replace),VG=ng(1 .toString),BG=/[\uD800-\uDFFF]/g,eL=/^[\uD800-\uDBFF]$/,nL=/^[\uDC00-\uDFFF]$/,iL=!kG||JD(function(){var t=qD("Symbol")();return mu([t])!="[null]"||mu({a:t})!="{}"||mu(Object(t))!="{}"}),rL=JD(function(){return mu("\uDF06\uD834")!=='"\\udf06\\ud834"'||mu("\uDEAD")!=='"\\udead"'}),FG=function(t,e){var n=$D(arguments),i=PG(e);if(QD(i)||t!==void 0&&!ZD(t))return n[1]=function(r,s){if(QD(i)&&(s=LG(i,this,MG(r),s)),!ZD(s))return s},XD(mu,null,n)},jG=function(t,e,n){var i=tL(n,e-1),r=tL(n,e+1);return gv(eL,t)&&!gv(nL,r)||gv(nL,t)&&!gv(eL,i)?"\\u"+VG(UG(t,0),16):t};mu&&DG({target:"JSON",stat:!0,forced:iL||rL},{stringify:function(t,e,n){var i=$D(arguments),r=XD(iL?FG:mu,null,i);return rL&&typeof r=="string"?xG(r,BG,jG):r}});var aL=Ci,GG=za;De({target:"Object",stat:!0,forced:!gc||x(function(){aL.f(1)})},{getOwnPropertySymbols:function(t){var e=aL.f;return e?e(GG(t)):[]}}),bi("asyncIterator"),bi("hasInstance"),bi("isConcatSpreadable"),bi("iterator"),bi("match"),bi("matchAll"),bi("replace"),bi("search"),bi("species"),bi("split");var HG=vD;bi("toPrimitive"),HG();var WG=kn,KG=Za;bi("toStringTag"),KG(WG("Symbol"),"Symbol"),bi("unscopables"),Za(it.JSON,"JSON",!0);var YG=Wr.Symbol,zG=dn,qG=dr.f,sL=zG("metadata"),oL=Function.prototype;oL[sL]===void 0&&qG(oL,sL,{value:null}),bi("dispose"),bi("metadata");var XG=YG;bi("asyncDispose");var JG=st,Hb=kn("Symbol"),QG=Hb.keyFor,ZG=JG(Hb.prototype.valueOf),cL=Hb.isRegisteredSymbol||function(t){try{return QG(ZG(t))!==void 0}catch{return!1}};De({target:"Symbol",stat:!0},{isRegisteredSymbol:cL});for(var $G=Rc,lL=kn,t4=st,e4=El,n4=dn,Sv=lL("Symbol"),uL=Sv.isWellKnownSymbol,dL=lL("Object","getOwnPropertyNames"),i4=t4(Sv.prototype.valueOf),hL=$G("wks"),Wb=0,pL=dL(Sv),r4=pL.length;Wb<r4;Wb++)try{var fL=pL[Wb];e4(Sv[fL])&&n4(fL)}catch{}var mL=function(t){if(uL&&uL(t))return!0;try{for(var e=i4(t),n=0,i=dL(hL),r=i.length;n<r;n++)if(hL[i[n]]==e)return!0}catch{}return!1};De({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:mL}),bi("matcher"),bi("observable"),De({target:"Symbol",stat:!0},{isRegistered:cL}),De({target:"Symbol",stat:!0,forced:!0},{isWellKnown:mL}),bi("metadataKey"),bi("patternMatch"),bi("replaceAll");var xf=P(XG),EL=P(kf.f("iterator"));function ig(t){return ig=typeof xf=="function"&&typeof EL=="symbol"?function(e){return typeof e}:function(e){return e&&typeof xf=="function"&&e.constructor===xf&&e!==xf.prototype?"symbol":typeof e},ig(t)}var a4=P(kf.f("toPrimitive"));function s4(t){var e=function(n,i){if(ig(n)!=="object"||n===null)return n;var r=n[a4];if(r!==void 0){var s=r.call(n,i);if(ig(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return ig(e)==="symbol"?e:String(e)}function O(t,e,n){return(e=s4(e))in t?uD(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _L=P(FB),o4={isBrowser:!0,classes:{URLSearchParams:_L!==void 0?_L:Nb,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Kb=typeof window<"u"&&typeof document<"u",Yb=typeof navigator=="object"&&navigator||void 0,c4=Kb&&(!Yb||["ReactNative","NativeScript","NS"].indexOf(Yb.product)<0),l4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",u4=Kb&&window.location.href||"http://localhost";function gL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function SL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gL(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var kr=SL(SL({},Object.freeze({__proto__:null,hasBrowserEnv:Kb,hasStandardBrowserEnv:c4,hasStandardBrowserWebWorkerEnv:l4,navigator:Yb,origin:u4})),o4),d4=yi,h4=Re,p4=pi,f4=mt,m4=function(){var t=d4(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},TL=RegExp.prototype,RL=function(t){var e=t.flags;return e!==void 0||"flags"in TL||p4(t,"flags")||!f4(TL,t)?e:h4(m4,t)},E4=Wo.charAt,vL=Re,_4=yi,g4=mn,S4=Ne,T4=/./.exec,R4=TypeError,v4=De,yL=Re,CL=hi,y4=Mp,Tv=Vp,AL=fl,bL=aE,rg=pr,C4=yi,A4=ho,b4=Ne,I4=lE,IL=RL,O4=gl,w4=x,N4=Oa,D4=function(t,e,n){return e+(n?E4(t,e).length:1)},L4=function(t,e){var n=t.exec;if(g4(n)){var i=vL(n,t,e);return i!==null&&_4(i),i}if(S4(t)==="RegExp")return vL(T4,t,e);throw R4("RegExp#exec called on incompatible receiver")},OL=ba,P4=dn("matchAll"),wL="RegExp String",NL=wL+" Iterator",k4=OL.set,M4=OL.getterFor(NL),U4=TypeError,zb=CL("".indexOf),Rv=CL("".matchAll),qb=!!Rv&&!w4(function(){Rv("a",/./)}),x4=y4(function(t,e,n,i){k4(this,{type:NL,regexp:t,string:e,global:n,unicode:i,done:!1})},wL,function(){var t=M4(this);if(t.done)return Tv(void 0,!0);var e=t.regexp,n=t.string,i=L4(e,n);return i===null?(t.done=!0,Tv(void 0,!0)):t.global?(rg(i[0])===""&&(e.lastIndex=D4(n,bL(e.lastIndex),t.unicode)),Tv(i,!1)):(t.done=!0,Tv(i,!1))}),DL=function(t){var e,n,i,r=C4(this),s=rg(t),c=N4(r,RegExp),l=rg(IL(r));return e=new c(c===RegExp?r.source:r,l),n=!!~zb(l,"g"),i=!!~zb(l,"u"),e.lastIndex=bL(r.lastIndex),new x4(e,s,n,i)};v4({target:"String",proto:!0,forced:qb},{matchAll:function(t){var e,n,i,r,s=AL(this);if(A4(t)){if(qb)return Rv(s,t)}else{if(I4(t)&&(e=rg(AL(IL(t))),!~zb(e,"g")))throw U4("`.matchAll` does not allow non-global regexes");if(qb)return Rv(s,t);if((i=O4(t,P4))===void 0&&b4(t)=="RegExp"&&(i=DL),i)return yL(i,t,s)}return n=rg(s),r=new RegExp(t,"g"),yL(DL,r,n)}});var V4=hr("String").matchAll,B4=mt,F4=V4,Xb=String.prototype,j4=function(t){var e=t.matchAll;return typeof t=="string"||t===Xb||B4(Xb,t)&&e===Xb.matchAll?F4:e},G4=P(j4);function LL(t){function e(n,i,r,s){let c=n[s++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),d=s>=n.length;return c=!c&&Tt.isArray(r)?r.length:c,d?(Tt.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&Tt.isObject(r[c])||(r[c]=[]),e(n,i,r[c],s)&&Tt.isArray(r[c])&&(r[c]=function(h){const p={},m=Object.keys(h);let E;const g=m.length;let I;for(E=0;E<g;E++)I=m[E],p[I]=h[I];return p}(r[c])),!l)}if(Tt.isFormData(t)&&Tt.isFunction(t.entries)){const n={};return Tt.forEachEntry(t,(i,r)=>{e(function(s){return G4(Tt).call(Tt,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const Jb={transitional:sD,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=Tt.isObject(t);if(r&&Tt.isHTMLForm(t)&&(t=new FormData(t)),Tt.isFormData(t))return i?JSON.stringify(LL(t)):t;if(Tt.isArrayBuffer(t)||Tt.isBuffer(t)||Tt.isStream(t)||Tt.isFile(t)||Tt.isBlob(t)||Tt.isReadableStream(t))return t;if(Tt.isArrayBufferView(t))return t.buffer;if(Tt.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return dv(c,new kr.classes.URLSearchParams,Object.assign({visitor:function(d,h,p,m){return kr.isNode&&Tt.isBuffer(d)?(this.append(h,d.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((s=Tt.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return dv(s?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,d){if(Tt.isString(c))try{return(l||JSON.parse)(c),Ji(Tt).call(Tt,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||Jb.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(Tt.isResponse(t)||Tt.isReadableStream(t))return t;if(t&&Tt.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(s){if(r)throw s.name==="SyntaxError"?xe.from(s,xe.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kr.classes.FormData,Blob:kr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Tt.forEach(["delete","get","head","post","put","patch"],t=>{Jb.headers[t]={}});var Qb=Jb;const H4=Tt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),PL=Symbol("internals");function ag(t){var e;return t&&Ji(e=String(t)).call(e).toLowerCase()}function vv(t){return t===!1||t==null?t:Tt.isArray(t)?t.map(vv):String(t)}function Zb(t,e,n,i,r){return Tt.isFunction(i)?i.call(this,e,n):(r&&(e=n),Tt.isString(e)?Tt.isString(i)?e.indexOf(i)!==-1:Tt.isRegExp(i)?i.test(e):void 0:void 0)}class yv{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function s(d,h,p){const m=ag(h);if(!m)throw new Error("header name must be a non-empty string");const E=Tt.findKey(r,m);(!E||r[E]===void 0||p===!0||p===void 0&&r[E]!==!1)&&(r[E||h]=vv(d))}const c=(d,h)=>Tt.forEach(d,(p,m)=>s(p,m,h));if(Tt.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(Tt.isString(e)&&(e=Ji(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ji(l=e).call(l)))c((d=>{const h={};let p,m,E;return d&&d.split(`
`).forEach(function(g){var I,y;E=g.indexOf(":"),p=Ji(I=g.substring(0,E)).call(I).toLowerCase(),m=Ji(y=g.substring(E+1)).call(y),!p||h[p]&&H4[p]||(p==="set-cookie"?h[p]?h[p].push(m):h[p]=[m]:h[p]=h[p]?h[p]+", "+m:m)}),h})(e),n);else if(Tt.isHeaders(e))for(const[d,h]of e.entries())s(h,d,i);else e!=null&&s(n,e,i);var l;return this}get(e,n){if(e=ag(e)){const i=Tt.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(s){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=l.exec(s);)c[d[1]]=d[2];return c}(r);if(Tt.isFunction(n))return n.call(this,r,i);if(Tt.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=ag(e)){const i=Tt.findKey(this,e);return!(!i||this[i]===void 0||n&&!Zb(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function s(c){if(c=ag(c)){const l=Tt.findKey(i,c);!l||n&&!Zb(0,i[l],l,n)||(delete i[l],r=!0)}}return Tt.isArray(e)?e.forEach(s):s(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const s=n[i];e&&!Zb(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const n=this,i={};return Tt.forEach(this,(r,s)=>{var c;const l=Tt.findKey(i,s);if(l)return n[l]=vv(r),void delete n[s];const d=e?function(h){return Ji(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,m,E)=>m.toUpperCase()+E)}(s):Ji(c=String(s)).call(c);d!==s&&delete n[s],n[d]=vv(r),i[d]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return Tt.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&Tt.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[PL]=this[PL]={accessors:{}}).accessors,i=this.prototype;function r(s){const c=ag(s);n[c]||(function(l,d){const h=Tt.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(m,E,g){return this[p].call(this,d,m,E,g)},configurable:!0})})}(i,s),n[c]=!0)}return Tt.isArray(e)?e.forEach(r):r(e),this}}yv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Tt.reduceDescriptors(yv.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),Tt.freezeMethods(yv);var Zs=yv;function $b(t,e){const n=this||Qb,i=e||n,r=Zs.from(i.headers);let s=i.data;return Tt.forEach(t,function(c){s=c.call(n,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function kL(t){return!(!t||!t.__CANCEL__)}function Vf(t,e,n){xe.call(this,t??"canceled",xe.ERR_CANCELED,e,n),this.name="CanceledError"}function ML(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new xe("Request failed with status code "+n.status,[xe.ERR_BAD_REQUEST,xe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}Tt.inherits(Vf,xe,{__CANCEL__:!0});const Cv=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(s,c){s=s||10;const l=new Array(s),d=new Array(s);let h,p=0,m=0;return c=c!==void 0?c:1e3,function(E){const g=Date.now(),I=d[m];h||(h=g),l[p]=E,d[p]=g;let y=m,C=0;for(;y!==p;)C+=l[y++],y%=s;if(p=(p+1)%s,p===m&&(m=(m+1)%s),g-h<c)return;const N=I&&g-I;return N?Math.round(1e3*C/N):void 0}}(50,250);return function(s,c){let l,d,h=0,p=1e3/c;const m=function(E){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),s.apply(null,E)};return[function(){const E=Date.now(),g=E-h;for(var I=arguments.length,y=new Array(I),C=0;C<I;C++)y[C]=arguments[C];g>=p?m(y,E):(l=y,d||(d=setTimeout(()=>{d=null,m(l)},p-g)))},()=>l&&m(l)]}(s=>{const c=s.loaded,l=s.lengthComputable?s.total:void 0,d=c-i,h=r(d);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},UL=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},xL=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return Tt.asap(()=>t(...n))};var W4=kr.hasStandardBrowserEnv?((t,e)=>n=>(n=new $R(n,kr.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new $R(kr.origin),kr.navigator&&/(msie|trident)/i.test(kr.navigator.userAgent)):()=>!0,K4=kr.hasStandardBrowserEnv?{write(t,e,n,i,r,s){const c=[t+"="+encodeURIComponent(e)];Tt.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Tt.isString(i)&&c.push("path="+i),Tt.isString(r)&&c.push("domain="+r),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function VL(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,i){return i?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n}(t,e):e}function BL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const FL=t=>t instanceof Zs?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?BL(Object(i),!0).forEach(function(r){O(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BL(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function nh(t,e){e=e||{};const n={};function i(h,p,m,E){return Tt.isPlainObject(h)&&Tt.isPlainObject(p)?Tt.merge.call({caseless:E},h,p):Tt.isPlainObject(p)?Tt.merge({},p):Tt.isArray(p)?p.slice():p}function r(h,p,m,E){return Tt.isUndefined(p)?Tt.isUndefined(h)?void 0:i(void 0,h,0,E):i(h,p,0,E)}function s(h,p){if(!Tt.isUndefined(p))return i(void 0,p)}function c(h,p){return Tt.isUndefined(p)?Tt.isUndefined(h)?void 0:i(void 0,h):i(void 0,p)}function l(h,p,m){return m in e?i(h,p):m in t?i(void 0,h):void 0}const d={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,m)=>r(FL(h),FL(p),0,!0)};return Tt.forEach(Object.keys(Object.assign({},t,e)),function(h){const p=d[h]||r,m=p(t[h],e[h],h);Tt.isUndefined(m)&&p!==l||(n[h]=m)}),n}var jL=t=>{const e=nh({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:c,headers:l,auth:d}=e;if(e.headers=l=Zs.from(l),e.url=rD(VL(e.baseURL,e.url),t.params,t.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),Tt.isFormData(i)){if(kr.hasStandardBrowserEnv||kr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[h,...p]=n?n.split(";").map(m=>Ji(m).call(m)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(kr.hasStandardBrowserEnv&&(r&&Tt.isFunction(r)&&(r=r(e)),r||r!==!1&&W4(e.url))){const h=s&&c&&K4.read(c);h&&l.set(s,h)}return e},Y4=typeof XMLHttpRequest<"u"&&function(t){return new St(function(e,n){const i=jL(t);let r=i.data;const s=Zs.from(i.headers).normalize();let c,l,d,h,p,{responseType:m,onUploadProgress:E,onDownloadProgress:g}=i;function I(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let y=new XMLHttpRequest;function C(){if(!y)return;const D=Zs.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders());ML(function(V){e(V),I()},function(V){n(V),I()},{data:m&&m!=="text"&&m!=="json"?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:D,config:t,request:y}),y=null}y.open(i.method.toUpperCase(),i.url,!0),y.timeout=i.timeout,"onloadend"in y?y.onloadend=C:y.onreadystatechange=function(){y&&y.readyState===4&&(y.status!==0||y.responseURL&&y.responseURL.indexOf("file:")===0)&&setTimeout(C)},y.onabort=function(){y&&(n(new xe("Request aborted",xe.ECONNABORTED,t,y)),y=null)},y.onerror=function(){n(new xe("Network Error",xe.ERR_NETWORK,t,y)),y=null},y.ontimeout=function(){let D=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const V=i.transitional||sD;i.timeoutErrorMessage&&(D=i.timeoutErrorMessage),n(new xe(D,V.clarifyTimeoutError?xe.ETIMEDOUT:xe.ECONNABORTED,t,y)),y=null},r===void 0&&s.setContentType(null),"setRequestHeader"in y&&Tt.forEach(s.toJSON(),function(D,V){y.setRequestHeader(V,D)}),Tt.isUndefined(i.withCredentials)||(y.withCredentials=!!i.withCredentials),m&&m!=="json"&&(y.responseType=i.responseType),g&&([d,p]=Cv(g,!0),y.addEventListener("progress",d)),E&&y.upload&&([l,h]=Cv(E),y.upload.addEventListener("progress",l),y.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=D=>{y&&(n(!D||D.type?new Vf(null,t,y):D),y.abort(),y=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const N=function(D){const V=/^([-+\w]{1,25})(:?\/\/|:)/.exec(D);return V&&V[1]||""}(i.url);N&&kr.protocols.indexOf(N)===-1?n(new xe("Unsupported protocol "+N+":",xe.ERR_BAD_REQUEST,t)):y.send(r||null)})},z4=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const s=function(h){if(!i){i=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof xe?p:new Vf(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,s(new xe("timeout ".concat(e," of ms exceeded"),xe.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),t=null)};t.forEach(h=>h.addEventListener("abort",s));const{signal:d}=r;return d.unsubscribe=()=>Tt.asap(l),d}},q4=cu,X4=rs;De({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=X4.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var J4=rs,Q4=is;De({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=J4.f(this),n=Q4(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var tI=P(q4),GL=kf.f("asyncIterator"),Z4=P(GL);function eI(t,e){this.v=t,this.k=e}function sg(t){var e,n;function i(s,c){try{var l=t[s](c),d=l.value,h=d instanceof eI;tI.resolve(h?d.v:d).then(function(p){if(h){var m=s==="return"?"return":"next";if(!d.k||p.done)return i(m,p);p=t[m](p).value}r(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){r("throw",p)}}function r(s,c){switch(s){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(s,c){return new tI(function(l,d){var h={key:s,arg:c,resolve:l,reject:d,next:null};n?n=n.next=h:(e=n=h,i(s,c))})},typeof t.return!="function"&&(this.return=void 0)}function Ma(t){return function(){return new sg(t.apply(this,arguments))}}function Ee(t){return new eI(t,0)}function Av(t){var e={},n=!1;function i(r,s){return n=!0,{done:!1,value:new eI(s=new tI(function(c){c(t[r](s))}),1)}}return e[xf!==void 0&&EL||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}sg.prototype[typeof xf=="function"&&Z4||"@@asyncIterator"]=function(){return this},sg.prototype.next=function(t){return this._invoke("next",t)},sg.prototype.throw=function(t){return this._invoke("throw",t)},sg.prototype.return=function(t){return this._invoke("return",t)};var nI=P(GL);function iI(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=nI,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new bv(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function bv(t){function e(n){if(Object(n)!==n)return St.reject(new TypeError(n+" is not an object."));var i=n.done;return St.resolve(n.value).then(function(r){return{value:r,done:i}})}return bv=function(n){this.s=n,this.n=n.next},bv.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?St.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?St.reject(n):e(i.apply(this.s,arguments))}},new bv(t)}const $4=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},t5=function(){var t=Ma(function*(e,n){var i,r=!1,s=!1;try{for(var c,l=iI(e5(e));r=!(c=yield Ee(l.next())).done;r=!1){const d=c.value;yield*Av(iI($4(d,n)))}}catch(d){s=!0,i=d}finally{try{r&&l.return!=null&&(yield Ee(l.return()))}finally{if(s)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),e5=function(){var t=Ma(function*(e){if(e[nI])return void(yield*Av(iI(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield Ee(n.read());if(i)break;yield r}}finally{yield Ee(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),HL=(t,e,n,i)=>{const r=t5(t,e);let s,c=0,l=d=>{s||(s=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:h,value:p}=await r.next();if(h)return l(),void d.close();let m=p.byteLength;if(n){let E=c+=m;n(E)}d.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:d=>(l(d),r.return())},{highWaterMark:2})};function WL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function KL(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?WL(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):WL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Iv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",YL=Iv&&typeof ReadableStream=="function",n5=Iv&&(typeof TextEncoder=="function"?(zL=new TextEncoder,t=>zL.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var zL;const qL=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},i5=YL&&qL(()=>{let t=!1;const e=new Request(kr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),rI=YL&&qL(()=>Tt.isReadableStream(new Response("").body)),Ov={stream:rI&&(t=>t.body)};var XL;Iv&&(XL=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Ov[t]&&(Ov[t]=Tt.isFunction(XL[t])?e=>e[t]():(e,n)=>{throw new xe("Response type '".concat(t,"' is not supported"),xe.ERR_NOT_SUPPORT,n)})}));const r5=async(t,e)=>{const n=Tt.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:Tt.isBlob(i)?i.size:Tt.isSpecCompliantForm(i)?(await new Request(kr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:Tt.isArrayBufferView(i)||Tt.isArrayBuffer(i)?i.byteLength:(Tt.isURLSearchParams(i)&&(i+=""),Tt.isString(i)?(await n5(i)).byteLength:void 0))(e)};var a5=Iv&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:s,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:h,headers:p,withCredentials:m="same-origin",fetchOptions:E}=jL(t);h=h?(h+"").toLowerCase():"text";let g,I=z4([r,s&&s.toAbortSignal()],c);const y=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let C;try{if(d&&i5&&n!=="get"&&n!=="head"&&(C=await r5(p,i))!==0){let K,j=new Request(e,{method:"POST",body:i,duplex:"half"});if(Tt.isFormData(i)&&(K=j.headers.get("content-type"))&&p.setContentType(K),j.body){const[J,ct]=UL(C,Cv(xL(d)));i=HL(j.body,65536,J,ct)}}Tt.isString(m)||(m=m?"include":"omit");const N="credentials"in Request.prototype;g=new Request(e,KL(KL({},E),{},{signal:I,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:N?m:void 0}));let D=await fetch(g);const V=rI&&(h==="stream"||h==="response");if(rI&&(l||V&&y)){const K={};["status","statusText","headers"].forEach(vt=>{K[vt]=D[vt]});const j=Tt.toFiniteNumber(D.headers.get("content-length")),[J,ct]=l&&UL(j,Cv(xL(l),!0))||[];D=new Response(HL(D.body,65536,J,()=>{ct&&ct(),y&&y()}),K)}h=h||"text";let W=await Ov[Tt.findKey(Ov,h)||"text"](D,t);return!V&&y&&y(),await new St((K,j)=>{ML(K,j,{data:W,headers:Zs.from(D.headers),status:D.status,statusText:D.statusText,config:t,request:g})})}catch(N){throw y&&y(),N&&N.name==="TypeError"&&/fetch/i.test(N.message)?Object.assign(new xe("Network Error",xe.ERR_NETWORK,t,g),{cause:N.cause||N}):xe.from(N,N&&N.code,t,g)}});const aI={http:null,xhr:Y4,fetch:a5};Tt.forEach(aI,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const JL=t=>"- ".concat(t),s5=t=>Tt.isFunction(t)||t===null||t===!1;var QL={getAdapter:t=>{t=Tt.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let s=0;s<e;s++){let c;if(n=t[s],i=n,!s5(n)&&(i=aI[(c=String(n)).toLowerCase()],i===void 0))throw new xe("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+s]=i}if(!i){const s=Object.entries(r).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new xe("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(JL).join(`
`):" "+JL(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:aI};function sI(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Vf(null,t)}function ZL(t){return sI(t),t.headers=Zs.from(t.headers),t.data=$b.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),QL.getAdapter(t.adapter||Qb.adapter)(t).then(function(e){return sI(t),e.data=$b.call(t,t.transformResponse,e),e.headers=Zs.from(e.headers),e},function(e){return kL(e)||(sI(t),e&&e.response&&(e.response.data=$b.call(t,t.transformResponse,e.response),e.response.headers=Zs.from(e.response.headers))),St.reject(e)})}const $L="1.7.9",wv={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{wv[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const tP={};wv.transitional=function(t,e,n){function i(r,s){return"[Axios v"+$L+"] Transitional option '"+r+"'"+s+(n?". "+n:"")}return(r,s,c)=>{if(t===!1)throw new xe(i(s," has been removed"+(e?" in "+e:"")),xe.ERR_DEPRECATED);return e&&!tP[s]&&(tP[s]=!0,console.warn(i(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,s,c)}},wv.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var Nv={assertOptions:function(t,e,n){if(typeof t!="object")throw new xe("options must be an object",xe.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const s=i[r],c=e[s];if(c){const l=t[s],d=l===void 0||c(l,s,t);if(d!==!0)throw new xe("option "+s+" must be "+d,xe.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new xe("Unknown option "+s,xe.ERR_BAD_OPTION)}},validators:wv};const Xo=Nv.validators;let Dv=class{constructor(t){this.defaults=t,this.interceptors={request:new aD,response:new aD}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=nh(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&Nv.assertOptions(n,{silentJSONParsing:Xo.transitional(Xo.boolean),forcedJSONParsing:Xo.transitional(Xo.boolean),clarifyTimeoutError:Xo.transitional(Xo.boolean)},!1),i!=null&&(Tt.isFunction(i)?e.paramsSerializer={serialize:i}:Nv.assertOptions(i,{encode:Xo.function,serialize:Xo.function},!0)),Nv.assertOptions(e,{baseUrl:Xo.spelling("baseURL"),withXsrfToken:Xo.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=r&&Tt.merge(r.common,r[e.method]);r&&Tt.forEach(["delete","get","head","post","put","patch","common"],g=>{delete r[g]}),e.headers=Zs.concat(s,r);const c=[];let l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(l=l&&g.synchronous,c.unshift(g.fulfilled,g.rejected))});const d=[];let h;this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let p,m=0;if(!l){const g=[ZL.bind(this),void 0];for(g.unshift.apply(g,c),g.push.apply(g,d),p=g.length,h=St.resolve(e);m<p;)h=h.then(g[m++],g[m++]);return h}p=c.length;let E=e;for(m=0;m<p;){const g=c[m++],I=c[m++];try{E=g(E)}catch(y){I.call(this,y);break}}try{h=ZL.call(this,E)}catch(g){return St.reject(g)}for(m=0,p=d.length;m<p;)h=h.then(d[m++],d[m++]);return h}getUri(t){return rD(VL((t=nh(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};Tt.forEach(["delete","get","head","options"],function(t){Dv.prototype[t]=function(e,n){return this.request(nh(n||{},{method:t,url:e,data:(n||{}).data}))}}),Tt.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,s){return this.request(nh(s||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}Dv.prototype[t]=e(),Dv.prototype[t+"Form"]=e(!0)});var Lv=Dv;class oI{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new St(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const c=new St(l=>{i.subscribe(l),s=l}).then(r);return c.cancel=function(){i.unsubscribe(s)},c},e(function(r,s,c){i.reason||(i.reason=new Vf(r,s,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new oI(function(i){e=i}),cancel:e}}}var o5=oI;const cI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(cI).forEach(t=>{let[e,n]=t;cI[n]=e});var c5=cI;const Hi=function t(e){const n=new Lv(e),i=FN(Lv.prototype.request,n);return Tt.extend(i,Lv.prototype,n,{allOwnKeys:!0}),Tt.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(nh(e,r))},i}(Qb);Hi.Axios=Lv,Hi.CanceledError=Vf,Hi.CancelToken=o5,Hi.isCancel=kL,Hi.VERSION=$L,Hi.toFormData=dv,Hi.AxiosError=xe,Hi.Cancel=Hi.CanceledError,Hi.all=function(t){return St.all(t)},Hi.spread=function(t){return function(e){return t.apply(null,e)}},Hi.isAxiosError=function(t){return Tt.isObject(t)&&t.isAxiosError===!0},Hi.mergeConfig=nh,Hi.AxiosHeaders=Zs,Hi.formToJSON=t=>LL(Tt.isHTMLForm(t)?new FormData(t):t),Hi.getAdapter=QL.getAdapter,Hi.HttpStatusCode=c5,Hi.default=Hi;var Er=Hi;const l5=()=>{};function og(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:l5};return t.promise=new St((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const Pv=new Map,kv=new Map,Jo=new Map;let ei=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ce=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const eP=new bj;let $s=eP.getResult(),lI=null;function _e(t){if(!lI){$s=eP.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return Ce.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ce.CHROME;case"Safari":case"Mobile Safari":return Ce.SAFARI;case"Edge":return Ce.EDGE;case"Firefox":return Ce.FIREFOX;case"QQ":case"QQBrowser":return Ce.QQ;case"Opera":return Ce.OPERA;case"WeChat":return Ce.WECHAT;default:return l.browser.name||""}}($s),n=nP($s),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}($s),r=$s.os.version,s=nP($s,!1),c=$s.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c};lI={name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c}}return lI}function nP(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function Mv(){return _e().os}function iP(){const t=_e();return"".concat(t.os," ").concat(t.osVersion)}function Uv(){const t=_e();return!!($s.engine.name==="WebKit"&&t.os===ei.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ce.SAFARI||ir()&&t.name!==Ce.SAFARI)}function Xc(){return _e().name===Ce.CHROME}function Ii(){return _e().name===Ce.SAFARI}function rP(){return _e().name===Ce.EDGE}function En(){return _e().name===Ce.FIREFOX}function ir(){return _e().os===ei.IOS}function cg(t){const e=_e();return!(e.name!==Ce.CHROME||!e.osVersion)&&Number(e.version)>=t}function aP(t){const e=_e();return!(e.name!==Ce.CHROME||!e.osVersion)&&Number(e.version)<t}function uI(t,e,n){const i=_e();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function dI(t){const e=_e();return!(e.name!==Ce.EDGE||!e.osVersion)&&Number(e.version)>=t}function sP(t){const e=_e();return!(e.name!==Ce.SAFARI||!e.osVersion)&&Number(e.version)>=t}function oP(t,e,n){const i=_e();if(i.os!==ei.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function cP(t,e,n){const i=_e();if(i.name!==Ce.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function hI(t){const e=_e();return!(e.name!==Ce.OPERA||!e.osVersion)&&Number(e.version)>=t}function lP(){const t=_e();if(t.os!==ei.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Bf(){const t=_e();if(t.os!==ei.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function pI(){const t=_e();if(t.os!==ei.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function uP(){const t=_e();if(t.os!==ei.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function hs(){return Ii()&&navigator.maxTouchPoints>0}function dP(){return _e().name===Ce.WECHAT}function hP(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function fI(){const t=Mv();return function(){const{deviceType:e}=_e();return e==="mobile"||e==="tablet"}()||t===ei.ANDROID||t===ei.IOS||t===ei.HARMONY_OS}function Jc(){const t=_e();return t.name!==Ce.EDGE&&t.name!==Ce.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function xv(){return Mv()===ei.ANDROID}function lg(){const t=_e();return xv()&&(t.name===Ce.CHROME||t.name===Ce.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function pP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pP(Object(n),!0).forEach(function(i){Xt(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Xt(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let L=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),$=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),Xt(this,"code",void 0),Xt(this,"message",void 0),Xt(this,"data",void 0),Xt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Qc(t,e){if(typeof t!="boolean")throw new $(L.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Zn(t,e,n){if(!Et(n).call(n,t))throw new $(L.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function Ve(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new $(L.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function mI(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new $(L.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&Ve(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&Ve(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&Ve(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&Ve(t.ideal,"".concat(e,".ideal"),1,1/0)}else Ve(t,e,1,1/0)}function Ei(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new $(L.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!fP(t,n,i,r))throw new $(L.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function Zc(t,e){if(!Array.isArray(t))throw new $(L.INVALID_PARAMS,"".concat(e," should be an array"))}function _n(t){return t==null}function fP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let s=0;s<r.length;s+=1){const c=r.charCodeAt(s);if(c<0||c>255)return!1}return!0}(t))}var ug=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(ug||{}),EI=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(EI||{});const mP=new class{constructor(){Xt(this,"_clientSize",null),Xt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Xt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Xt(this,"getStyle",t=>window.getComputedStyle(t,null)),Xt(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:s,opacity:c,filter:l}=i;return(r==="none"||Et(e=["hidden","collapse"]).call(e,s)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(d=>{var h;const p=d.split("(")[0];return Et(h=["brightness","blur","opacity"]).call(h,p)}).map(d=>{const[h,p]=d.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{const[h,p]=d;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),Xt(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let s=t;for(;s&&i;)r(s)||(n=!1,i=!1),s=s.parentElement,s||(i=!1);return n}),Xt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Xt(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:s,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:s,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),Xt(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),Xt(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),Xt(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),Xt(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,s=e/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){const p=(n*l+(d===0?.1:d===4?(r*d*l-1e5)/l:r*d)*l)/l,m=(i*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:p,y:m})}return[...c]}),Xt(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),Xt(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),Xt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:s,clientMin:c}=this._clientSize;let l,d,h,p;if(t<0)l=0;else{if(!(t<s))return!1;l=t}if(e<0)return!1;if(d=e<s?e:s,n<0)h=0;else{if(!(n<r))return!1;h=n}if(i<0)return!1;p=i<r?i:r;const m=d-l,E=p-h;return this.checkSizeIsVisible(m,E,c)}),Xt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Xt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(ug.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(ug.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ug.SIZE)}}return this.returnHiddenResult(ug.STYLE)}return this.returnHiddenResult(EI.UNMOUNTED)}return this.returnHiddenResult(EI.INVALID_HTML_ELEMENT)}),Xt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function _I(t){return new TextEncoder().encode(t)}const EP=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},gI=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",_I(t)),16);let hn=class{constructor(){Xt(this,"_events",{}),Xt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(s=>s);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let s=0;s<e.length;s+=1){const c=e[s];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(t," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},dg=null;function _P(){if(dg)return dg;if(window.electron)return dg=window.electron;if(!window.require)return null;try{return dg=window.require("electron"),dg}catch{return null}}let Gn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),gn=function(t){return t.TRACER="tracer",t}({});function gP(t){return Ve(t.timeout,"config.timeout",0,1e5),Ve(t.timeoutFactor,"config.timeoutFactor",0,100,!1),Ve(t.maxRetryCount,"config.maxRetryConfig",0,1/0),Ve(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let u5=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Ie=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function hg(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function SP(t){return Ei(t.turnServerURL,"turnServerURL"),Ei(t.username,"username"),Ei(t.password,"password"),t.udpport&&Ve(t.udpport,"udpport",1,99999,!0),t.forceturn&&Qc(t.forceturn,"forceturn"),t.security&&Qc(t.security,"security"),t.tcpport&&Ve(t.tcpport,"tcpport",1,99999,!0),!0}function SI(t){return t.level!==void 0&&Zn(t.level,"level",[1,2,3]),t.delay!==void 0&&Ve(t.delay,"delay",0,3e3,!0),!0}let se=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Oi=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Zr=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Ff=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function wi(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?St.reject(new $(L.UNEXPECTED_ERROR,"can not emit promise")):new St((s,c)=>{t.emit(e,...i,s,c)})}function Ke(t,e){if(t.getListeners(e).length===0)return St.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return wi(t,e,...i)}function ca(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return pg(t,e,...i)}function pg(t,e){let n=null,i=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];if(t.emit(e,...s,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new $(L.UNEXPECTED_ERROR,"handler is not sync");return n}const xn=new class extends hn{set networkState(t){this.emit(Ff.NETWORK_STATE_CHANGE,t,this._networkState),t===Zr.ONLINE?this.emit(Ff.ONLINE):t===Zr.OFFLINE&&(this.onlineWaiter=new St(e=>{this.once(Ff.ONLINE,()=>{this.onlineWaiter=void 0,e(Zr.ONLINE)})}),this.emit(Ff.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Zr.ONLINE}constructor(){super(),Xt(this,"_moduleName","network-indicator"),Xt(this,"_networkState",Zr.ONLINE),Xt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Zr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Zr.OFFLINE})}};function Vv(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function jf(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function Bv(t){St!==void 0?St.resolve().then(t):setTimeout(t,0)}function Sn(t){return JSON.parse(JSON.stringify(t))}function ih(t){try{return Sn(t)}catch{return t}}const TP={};function Eu(t,e){TP[e]||(TP[e]=!0,t())}function rh(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function _u(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function RP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function vP(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=er(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let s=0;return e.forEach(c=>{r.set(c,s),s+=c.length}),r}function Qo(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function yP(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?Qo(n):n.size}),e+138}function d5(t){const e=new $(L.TIMEOUT,"timeout");return new St((n,i)=>{window.setTimeout(()=>i(e),t)})}function _i(t){return new St(e=>{window.setTimeout(e,t)})}function Ye(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+Ye(t-n.length,"")}function ah(){return Ye(32,"").toUpperCase()}const Fv=()=>{},CP=new class{constructor(){Xt(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,s=new Array(r>4?r-4:0),c=4;c<r;c++)s[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const d=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:d,args:s,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,bt(bt({},l),{},{fn:t,args:s,skipFn:i}))}else{const l=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:s,skipFn:i})}}},AP=CP.throttleByKey.bind(CP);function bP(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function TI(t,e){if(!bP(t)||!bP(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=TI(t[i],e[i]);return n}{const n=bt({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=TI(t[i],e[i]):n[i]=e[i]);return n}}function IP(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function RI(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function OP(t){const e="0123456789abcdef";function n(V){let W,K="";for(W=0;W<=3;W++)K+=e.charAt(V>>8*W+4&15)+e.charAt(V>>8*W&15);return K}function i(V,W){const K=(65535&V)+(65535&W);return(V>>16)+(W>>16)+(K>>16)<<16|65535&K}function r(V,W,K,j,J,ct){return i(function(vt,At){return vt<<At|vt>>>32-At}(i(i(W,V),i(j,ct)),J),K)}function s(V,W,K,j,J,ct,vt){return r(W&K|~W&j,V,W,J,ct,vt)}function c(V,W,K,j,J,ct,vt){return r(W&j|K&~j,V,W,J,ct,vt)}function l(V,W,K,j,J,ct,vt){return r(W^K^j,V,W,J,ct,vt)}function d(V,W,K,j,J,ct,vt){return r(K^(W|~j),V,W,J,ct,vt)}const h=function(V){let W;const K=1+(V.length+8>>6),j=new Array(16*K);for(W=0;W<16*K;W++)j[W]=0;for(W=0;W<V.length;W++)j[W>>2]|=V.charCodeAt(W)<<W%4*8;return j[W>>2]|=128<<W%4*8,j[16*K-2]=8*V.length,j}(t);let p,m,E,g,I,y=1732584193,C=-271733879,N=-1732584194,D=271733878;for(p=0;p<h.length;p+=16)m=y,E=C,g=N,I=D,y=s(y,C,N,D,h[p+0],7,-680876936),D=s(D,y,C,N,h[p+1],12,-389564586),N=s(N,D,y,C,h[p+2],17,606105819),C=s(C,N,D,y,h[p+3],22,-1044525330),y=s(y,C,N,D,h[p+4],7,-176418897),D=s(D,y,C,N,h[p+5],12,1200080426),N=s(N,D,y,C,h[p+6],17,-1473231341),C=s(C,N,D,y,h[p+7],22,-45705983),y=s(y,C,N,D,h[p+8],7,1770035416),D=s(D,y,C,N,h[p+9],12,-1958414417),N=s(N,D,y,C,h[p+10],17,-42063),C=s(C,N,D,y,h[p+11],22,-1990404162),y=s(y,C,N,D,h[p+12],7,1804603682),D=s(D,y,C,N,h[p+13],12,-40341101),N=s(N,D,y,C,h[p+14],17,-1502002290),C=s(C,N,D,y,h[p+15],22,1236535329),y=c(y,C,N,D,h[p+1],5,-165796510),D=c(D,y,C,N,h[p+6],9,-1069501632),N=c(N,D,y,C,h[p+11],14,643717713),C=c(C,N,D,y,h[p+0],20,-373897302),y=c(y,C,N,D,h[p+5],5,-701558691),D=c(D,y,C,N,h[p+10],9,38016083),N=c(N,D,y,C,h[p+15],14,-660478335),C=c(C,N,D,y,h[p+4],20,-405537848),y=c(y,C,N,D,h[p+9],5,568446438),D=c(D,y,C,N,h[p+14],9,-1019803690),N=c(N,D,y,C,h[p+3],14,-187363961),C=c(C,N,D,y,h[p+8],20,1163531501),y=c(y,C,N,D,h[p+13],5,-1444681467),D=c(D,y,C,N,h[p+2],9,-51403784),N=c(N,D,y,C,h[p+7],14,1735328473),C=c(C,N,D,y,h[p+12],20,-1926607734),y=l(y,C,N,D,h[p+5],4,-378558),D=l(D,y,C,N,h[p+8],11,-2022574463),N=l(N,D,y,C,h[p+11],16,1839030562),C=l(C,N,D,y,h[p+14],23,-35309556),y=l(y,C,N,D,h[p+1],4,-1530992060),D=l(D,y,C,N,h[p+4],11,1272893353),N=l(N,D,y,C,h[p+7],16,-155497632),C=l(C,N,D,y,h[p+10],23,-1094730640),y=l(y,C,N,D,h[p+13],4,681279174),D=l(D,y,C,N,h[p+0],11,-358537222),N=l(N,D,y,C,h[p+3],16,-722521979),C=l(C,N,D,y,h[p+6],23,76029189),y=l(y,C,N,D,h[p+9],4,-640364487),D=l(D,y,C,N,h[p+12],11,-421815835),N=l(N,D,y,C,h[p+15],16,530742520),C=l(C,N,D,y,h[p+2],23,-995338651),y=d(y,C,N,D,h[p+0],6,-198630844),D=d(D,y,C,N,h[p+7],10,1126891415),N=d(N,D,y,C,h[p+14],15,-1416354905),C=d(C,N,D,y,h[p+5],21,-57434055),y=d(y,C,N,D,h[p+12],6,1700485571),D=d(D,y,C,N,h[p+3],10,-1894986606),N=d(N,D,y,C,h[p+10],15,-1051523),C=d(C,N,D,y,h[p+1],21,-2054922799),y=d(y,C,N,D,h[p+8],6,1873313359),D=d(D,y,C,N,h[p+15],10,-30611744),N=d(N,D,y,C,h[p+6],15,-1560198380),C=d(C,N,D,y,h[p+13],21,1309151649),y=d(y,C,N,D,h[p+4],6,-145523070),D=d(D,y,C,N,h[p+11],10,-1120210379),N=d(N,D,y,C,h[p+2],15,718787259),C=d(C,N,D,y,h[p+9],21,-343485551),y=i(y,m),C=i(C,E),N=i(N,g),D=i(D,I);return n(y)+n(C)+n(N)+n(D)}let h5=1,wP=console,Ui=class{static setLogger(t){wP=t}constructor(t,e){Xt(this,"id",void 0),Xt(this,"lockingPromise",St.resolve()),Xt(this,"locks",0),Xt(this,"name",""),Xt(this,"lockId",void 0),this.lockId=h5++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");wP.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new St(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Gf(t,e){return function(n,i,r){const s=r.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{l()}},r}}const Hn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function vI(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function to(t,e,n,i){const r=Object.assign({},Hn,i);let s=r.timeout;const c=async()=>{await function(h){return new St(p=>{window.setTimeout(p,h)})}(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)};let l=!1;const d=new St(async(h,p)=>{e=e||(()=>!1),n=n||(()=>!0);for(let m=0;m<r.maxRetryCount;m+=1){if(l)return p(new $(L.OPERATION_ABORTED));try{const E=await t();if(!e(E,m)||m+1===r.maxRetryCount)return h(E);await c()}catch(E){if(!n(E,m)||m+1===r.maxRetryCount)return p(E);await c()}}});return d.cancel=()=>l=!0,d}let jv,NP=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:er(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},Gv=0,yI=0;function CI(t,e,n,i){return new St((r,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Gv+=Qo(e.data)):n&&(e.data.size?Gv+=e.data.size:e.data instanceof FormData?Gv+=yP(e.data):Gv+=Qo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Er.request(e).then(c=>{typeof c.data=="string"?yI+=Qo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?yI+=c.data.byteLength:yI+=Qo(JSON.stringify(c.data)),r(c.data)}).catch(c=>{Er.isCancel(c)?s(new $(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new $(L.NETWORK_TIMEOUT,c.message)):c.response?s(new $(L.NETWORK_RESPONSE_ERROR,c.response.status)):s(new $(L.NETWORK_ERROR,c.message))})})}async function p5(t,e){const n=new Blob([e.data],{type:"buffer"});return await CI(t,bt(bt({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const DP=()=>window.isSecureContext!==void 0;function ps(t){if(Array.isArray(t))return t.map(n=>n);if(!LP(t))return t;const e={};for(const n in t){const i=t[n];LP(i)||Array.isArray(i)?e[n]=ps(i):e[n]=i}return e}function LP(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let AI=class{constructor(t){Xt(this,"input",[]),Xt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Zo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},fg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Zo,remoteCandidate:Zo},updateInterval:0},PP={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},kP={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},MP={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},UP={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let bI=class{constructor(t,e){Xt(this,"onFirstVideoReceived",void 0),Xt(this,"onFirstVideoDecoded",void 0),Xt(this,"onFirstAudioReceived",void 0),Xt(this,"onFirstVideoDecodedTimeout",void 0),Xt(this,"onFirstAudioDecoded",void 0),Xt(this,"onSelectedLocalCandidateChanged",void 0),Xt(this,"onSelectedRemoteCandidateChanged",void 0),Xt(this,"videoIsReady",!1),Xt(this,"videoIsReady2",{}),Xt(this,"pc",void 0),Xt(this,"options",void 0),Xt(this,"intervalTimer",void 0),Xt(this,"stats",ps(fg)),Xt(this,"isFirstVideoReceived",{}),Xt(this,"isFirstVideoDecoded",{}),Xt(this,"isFirstAudioReceived",{}),Xt(this,"isFirstAudioDecoded",{}),Xt(this,"isFirstVideoDecodedTimeout",{}),Xt(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new St(t=>{t({local:bt({},Zo),remote:bt({},Zo)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,s=0,c=0;for(const l of n)t[l].forEach((d,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const p=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,m=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(i+=p,s+=m):(r+=p,c+=m),Number.isNaN(p)||Number.isNaN(p)?d.packetLostRate=0:d.packetLostRate=p<=0||m<=0?0:m/(p+m)});t.sendPacketLossRate=i<=0||s<=0?0:s/(i+s),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},f5=class extends bI{constructor(){super(...arguments),Xt(this,"_stats",fg),Xt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=ps(fg);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=Et(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=ps(kP);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=ps(PP),s=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),s){const c=s.stats,l=Date.now()-s.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<s.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:bt({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=ps(UP);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=ps(MP);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new St((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},mg=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),Hv=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),II=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),la=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Hf=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Hf||{});function Eg(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hf.kNone;if(!e)return;const s=Number(e[n]);if(typeof s!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?s/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const d=Number(t[i]);if(typeof d!="number")return;const h=c-d;return h?(s-l)/h*r:void 0}let xP=class extends bI{constructor(){super(...arguments),Xt(this,"_stats",fg),Xt(this,"report",void 0),Xt(this,"lastDecodeVideoReceiverStats",new Map),Xt(this,"lastVideoFramesRecv",new Map),Xt(this,"lastVideoFramesSent",new Map),Xt(this,"lastVideoFramesDecode",new Map),Xt(this,"lastVideoFramesOutput",new Map),Xt(this,"lastVideoJBDelay",new Map),Xt(this,"lastAudioJBDelay",new Map),Xt(this,"mediaBytesSent",new Map),Xt(this,"mediaBytesRetransmit",new Map),Xt(this,"mediaBytesTargetEncode",new Map),Xt(this,"lastDecodeAudioReceiverStats",new Map),Xt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ps(fg),this.report.forEach(t=>{switch(t.type){case la.OUTBOUND:case la.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===la.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===la.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case la.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case la.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:bt({},Zo),remote:bt({},Zo)};return t.forEach(n=>{let i;if(n.type===la.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===la.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const s=t.get(i.localCandidateId);s&&r(e.local,s)}if(i.remoteCandidateId){const s=t.get(i.remoteCandidateId);s&&r(e.remote,s)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===la.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===la.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===la.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(bt({},e),bt({},this.stats.selectedCandidatePair.localCandidate)),t.type===la.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(bt({},e),bt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=ps(UP),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=Eg(n,e,"totalProcessingDelay","jitterBufferEmittedCount",Hf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,bt({},e))}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=ps(PP),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),s=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=s-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=Eg(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=Eg(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",Hf.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=Eg(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",Hf.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=Eg(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",Hf.kMillisecondsFromSeconds),i&&s-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&s-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:bt({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=ps(kP),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new AI(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new AI(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new AI(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,s=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*s/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,la.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=ps(MP),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,la.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(Lr(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof d!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,p=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:t.frameHeight,m=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),m==null){const E=Date.now(),g=this.lastVideoFramesSent.get(n.ssrc);g&&E-g.lts>=800?(m=Math.round((d-g.count)/((E-g.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:E,rate:m})):g?m=g.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:E,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(t,e,n){var i,r,s,c,l;const d=e?this.report.get(e):void 0,h=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:t.framesReceived,p=(r=d==null?void 0:d.frameWidth)!==null&&r!==void 0?r:t.frameWidth,m=(s=d==null?void 0:d.frameHeight)!==null&&s!==void 0?s:t.frameHeight,E=(c=d==null?void 0:d.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,g=(l=d==null?void 0:d.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const I=this.lastVideoFramesRecv.get(n.ssrc),y=Date.now();n.framesReceivedCount=h;let C=0;I&&y-I.lts>=800?(C=Math.round((h-I.count)/((y-I.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:y,rate:C})):I?C=I.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:y,rate:0}),n.receivedFrame={width:p||0,height:m||0,frameRate:C||0},n.decodedFrame={width:p||0,height:m||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:m||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(E&&g){const I=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let y=I.jitterBufferMs;const C=g-I.jitterBufferEmittedCount;C>0&&(y=1e3*(E-I.jitterBufferDelay)/C),n.jitterBufferMs=y,n.currentDelayMs=Math.round(y),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:E,jitterBufferEmittedCount:g,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,h=(s=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,n){var i,r,s,c,l,d,h;const p=e?this.report.get(e):void 0,m=(i=p==null?void 0:p.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,E=(r=p==null?void 0:p.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,g=(s=p==null?void 0:p.jitterBufferDelay)!==null&&s!==void 0?s:t.jitterBufferDelay,I=(c=p==null?void 0:p.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,y=(l=p==null?void 0:p.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,C=(d=p==null?void 0:p.totalSamplesDuration)!==null&&d!==void 0?d:t==null?void 0:t.totalSamplesDuration,N=(h=p==null?void 0:p.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples;if(typeof E=="number"&&(n.totalSamplesReceived=E),m&&E&&(n.accelerateRate=m/E),g&&I){const V=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let W=V.jitterBufferMs;const K=I-V.jitterBufferEmittedCount;K>0&&(W=1e3*(g-V.jitterBufferDelay)/K),n.jitterBufferMs=Math.round(W),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:I,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=y;let D=1920;C&&E&&(D=E/C/50,n.receivedFrames=Math.round(E/D)),N&&(n.droppedFrames=Math.round(N/D))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},m5=class extends bI{updateStats(){return St.resolve()}};function OI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return s?s<76?new f5(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new xP(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof St||function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"}(l))}(t)?new xP(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new m5(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const VP="websdk_ng_install_id";function wI(){try{if(M("INSTALL_ID"))return M("INSTALL_ID");let t=window.localStorage.getItem(VP);return t||(t=ah(),window.localStorage.setItem(VP,t)),Pe("INSTALL_ID",t),t}catch{return}}const Ua=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.2"),NI=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let sh=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Ni=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const s=r.join(""),c={};return c[t]=i,c[e]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ni;const Wv={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},DI={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},LI="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",PI={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},en=bt(bt(bt({},PI),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:DI,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},Wv),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Pe(t,e,n){var i,r,s;Et(i=Object.keys(en)).call(i,t)&&(!n&&Et(r=Object.keys(eo)).call(r,t)||(en[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||e!==!0||(en.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(en.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,en.USE_NEW_NETWORK_CONFIG=s,s&&(en.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],en.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],en.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],en.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],en.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",en.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(en.ENABLE_INSTANT_VIDEO=!0,en.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(en.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(en.NEW_TURN_MODE||(en.NEW_TURN_MODE=4))))}function M(t){return en[t]}NI||(en.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],en.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],en.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],en.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],en.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],en.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],en.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",en.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",en.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",en.AREAS=["NORTH_AMERICA","OVERSEA"]);let BP=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const eo={};var oe=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(oe||{});let Kv=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const FP=128,E5=96,jP=1e3,Wf=10;let _5=0;var GP=(()=>{var t={8:(i,r,s)=>{s.r(r),s.d(r,{Parser:()=>vt,Printer:()=>Ln,parse:()=>ft,print:()=>kt});const c=`
`,l="".concat("\r").concat(c),d=" ";let h;function p(at){return at>="0"&&at<="9"}function m(at){return at>="!"&&at<="~"}function E(at){return m(at)||at>=""&&at<="ÿ"}function g(at){return at==="!"||at>="#"&&at<="'"||at>="*"&&at<="+"||at>="-"&&at<="."||at>="0"&&at<="9"||at>="A"&&at<="Z"||at>="^"&&at<="~"}function I(at){return at>="1"&&at<="9"}function y(at){return at>="A"&&at<="Z"||at>="a"&&at<="z"}function C(at){return at==="d"||at==="h"||at==="m"||at==="s"}function N(at){return at>""&&at<"	"||at>"\v"&&at<"\f"||at>""&&at<"ÿ"}function D(at){return y(at)||p(at)||at==="+"||at==="/"}function V(at){return p(at)||y(at)||at==="+"||at==="/"||at==="-"||at==="_"}function W(at){return y(at)||p(at)||at==="+"||at==="/"}function K(at,v){var U=Object.keys(at);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(at);v&&(F=F.filter(function(dt){return Object.getOwnPropertyDescriptor(at,dt).enumerable})),U.push.apply(U,F)}return U}function j(at){for(var v=1;v<arguments.length;v++){var U=arguments[v]!=null?arguments[v]:{};v%2?K(Object(U),!0).forEach(function(F){J(at,F,U[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(at,Object.getOwnPropertyDescriptors(U)):K(Object(U)).forEach(function(F){Object.defineProperty(at,F,Object.getOwnPropertyDescriptor(U,F))})}return at}function J(at,v,U){return v in at?Object.defineProperty(at,v,{value:U,enumerable:!0,configurable:!0,writable:!0}):at[v]=U,at}(function(at){at.VERSION="v",at.ORIGIN="o",at.SESSION_NAME="s",at.INFORMATION="i",at.URI="u",at.EMAIL="e",at.PHONE="p",at.CONNECTION="c",at.BANDWIDTH="b",at.TIME="t",at.REPEAT="r",at.ZONE_ADJUSTMENTS="z",at.KEY="k",at.ATTRIBUTE="a",at.MEDIA="m"})(h||(h={}));class ct{consumeText(v,U){let F=U;for(;F<v.length;){const dt=v[F];if(dt==="\0"||dt==="\r"||dt===c)break;F+=1}if(F-U==0)throw new Error("Invalid text, at ".concat(v));return F}consumeUnicastAddress(v,U,F){return this.consumeTill(v,U,d)}consumeOneOrMore(v,U,F){let dt=U;for(;F(v[dt]);)dt++;if(dt-U==0)throw new Error("Invalid rule at ".concat(U,"."));return dt}consumeSpace(v,U){if(v[U]===d)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(v,U){let F=U;for(let dt=0;dt<4;dt++)if(F=this.consumeDecimalUChar(v,F),dt!==3){if(v[F]!==".")throw new Error("Invalid IP4 address.");F++}return F}consumeDecimalUChar(v,U){let F=U;for(let Qt=0;Qt<3&&p(v[F]);Qt++,F++);if(F-U==0)throw new Error("Invalid decimal uchar.");const dt=parseInt(v.slice(U,F));if(dt>=0&&dt<=255)return F;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,U){let F=this.consumeHexpart(v,U);return v[F]===":"&&(F+=1,F=this.consumeIP4Address(v,F)),F}consumeHexpart(v,U){let F=U;if(v[F]===":"&&v[F+1]===":"){F+=2;try{F=this.consumeHexseq(v,F)}catch{}return F}if(F=this.consumeHexseq(v,F),v[F]===":"&&v[F+1]===":"){F+=2;try{F=this.consumeHexseq(v,F)}catch{}return F}return F}consumeHexseq(v,U){let F=U;for(;F=this.consumeHex4(v,F),v[F]===":"&&v[F+1]!==":";)F+=1;return F}consumeHex4(v,U){let F=0;for(;F<4;F++)if(!((dt=v[U+F])>="0"&&dt<="9"||dt>="a"&&dt<="f"||dt>="A"&&dt<="F")){if(F===0)throw new Error("Invalid hex 4");break}var dt;return U+F}consumeFQDN(v,U){let F=U;for(;p(v[F])||y(v[F])||v[F]==="-"||v[F]===".";)F+=1;if(F-U<4)throw new Error("Invalid FQDN");return F}consumeExtnAddr(v,U){return this.consumeOneOrMore(v,U,E)}consumeMulticastAddress(v,U,F){switch(F){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,U);default:try{return this.consumeFQDN(v,U)}catch{return this.consumeExtnAddr(v,U)}}}consumeIP6MulticastAddress(v,U){const F=this.consumeHexpart(v,U);return v[F]==="/"?this.consumeInteger(v,F+1):F}consumeIP4MulticastAddress(v,U){let F=U+3;const dt=v.slice(U,F),Qt=parseInt(dt);if(Qt<224||Qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Be=0;Be<3;Be++){if(v[F]!==".")throw new Error("Invalid IP4 multicast address.");F+=1,F=this.consumeDecimalUChar(v,F)}return v[F]==="/"&&(F+=1),F=this.consumeTTL(v,F),v[F]==="/"&&(F=this.consumeInteger(v,F)),F}consumeInteger(v,U){if(!I(v[U]))throw new Error("Invalid integer.");for(U+=1;p(v[U]);)U+=1;return U}consumeTTL(v,U){if(v[U]==="0")return U+1;if(!I(v[U]))throw new Error("Invalid TTL.");U+=1;for(let F=0;F<2&&p(v[U]);F++)U+=1;return U}consumeToken(v,U){return this.consumeOneOrMore(v,U,g)}consumeTime(v,U){let F=U;if(v[F]==="0")return F+1;for(I(v[F])&&(F+=1);p(v[F]);)F++;if(F-U<10)throw new Error("Invalid time");return F}consumeAddress(v,U){return this.consumeTill(v,U,d)}consumeTypedTime(v,U){let F=U;return F=this.consumeOneOrMore(v,F,p),C(v[F])?F+1:F}consumeRepeatInterval(v,U){if(!I(v[U]))throw new Error("Invalid repeat interval");for(U+=1;p(v[U]);)U+=1;return C(v[U])&&(U+=1),U}consumePort(v,U){return this.consumeOneOrMore(v,U,p)}consume(v,U,F){for(let dt=0;dt<F.length;dt++){if(U+dt>=v.length)throw new Error("consume exceeding value length");if(v[U+dt]!==F[dt])throw new Error("consume ".concat(F," failed at ").concat(dt))}return U+F.length}consumeTill(v,U,F){let dt=U;for(;dt<v.length&&(typeof F!="string"||v[dt]!==F)&&(typeof F!="function"||!F(v[dt]));)dt++;return dt}}class vt extends ct{constructor(){super(),J(this,"records",[]),J(this,"currentLine",0)}parse(v){const U=this.probeEOL(v);this.records=v.split(U).filter(Nh=>!!Ji(Nh).call(Nh)).map(this.parseLine),this.currentLine=0;const F=this.parseVersion(),dt=this.parseOrigin(),Qt=this.parseSessionName(),Be=this.parseInformation(),ri=this.parseUri(),Br=this.parseEmail(),ul=this.parsePhone(),wh=this.parseConnection(),$g=this.parseBandWidth(),nC=this.parseTimeFields(),iC=this.parseKey(),Wa=this.parseSessionAttribute(),Mu=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:F,origin:dt,sessionName:Qt,information:Be,uri:ri,emails:Br,phones:ul,connection:wh,bandwidths:$g,timeFields:nC,key:iC,attributes:Wa,mediaDescriptions:Mu}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let U=0;U<v.length;U++)if(v[U]===c)return v[U-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(v,U){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const F=v[0];if(v[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:F,value:v.slice(2),line:U,cur:0}}parseSessionAttribute(){const v=new le;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==h.ATTRIBUTE)break;const F={attField:this.extractOneOrMore(U,dt=>g(dt)&&dt!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,F.attValue=this.extractOneOrMore(U,N)),v.parse(F),this.currentLine++}return v.digest()}parseMediaAttributes(v){const U=new ue(v);for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==h.ATTRIBUTE)break;const dt={attField:this.extractOneOrMore(F,Qt=>g(Qt)&&Qt!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,dt.attValue=this.extractOneOrMore(F,N)),U.parse(dt),this.currentLine++}return U.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===h.KEY){if(v.value==="prompt"||v.value==="clear:"||v.value==="base64:"||v.value==="uri:")return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===h.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const F=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let dt=!1;v.value[v.cur]==="-"&&(dt=!0,v.cur+=1);const Qt=this.extract(v,this.consumeTypedTime);U.push({time:F,typedTime:Qt,back:dt})}catch{break}if(U.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const v=[];for(;;){const U=this.getCurrentRecord();if(U.type!==h.REPEAT)break;{const F=this.extract(U,this.consumeRepeatInterval),dt=this.parseTypedTime(U);v.push({repeatInterval:F,typedTimes:dt}),this.currentLine++}}return v}parseTypedTime(v){const U=[];for(;;)try{this.consumeSpaceForRecord(v),U.push(this.extract(v,this.consumeTypedTime))}catch{break}if(U.length===0)throw new Error("Invalid typed time.");return U}parseTime(){const v=this.getCurrentRecord(),U=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const F=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:F}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==h.BANDWIDTH)break;{const F=this.extractOneOrMore(U,g);if(U.value[U.cur]!==":")throw new Error("Invalid bandwidth field.");U.cur++;const dt=this.extractOneOrMore(U,p);v.push({bwtype:F,bandwidth:dt}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==h.VERSION)throw new Error("first sdp record must be version");const U=v.value.slice(0,this.consumeOneOrMore(v.value,0,p));if(U.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,U}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(v,E);this.consumeSpaceForRecord(v);const F=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const dt=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const Qt=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const Be=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const ri=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:F,sessVersion:dt,nettype:Qt,addrtype:Be,unicastAddress:ri}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===h.SESSION_NAME){const U=this.extract(v,this.consumeText);return this.currentLine++,U}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==h.INFORMATION)return;const U=this.extract(v,this.consumeText);return this.currentLine++,U}parseUri(){const v=this.getCurrentRecord();if(v.type===h.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const U=this.getCurrentRecord();if(U.type!==h.EMAIL)break;v.push(U.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const U=this.getCurrentRecord();if(U.type!==h.PHONE)break;v.push(U.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===h.CONNECTION){const U=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const F=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const dt=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:F,address:dt}}}parseMedia(){const v=this.getCurrentRecord(),U=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let F=this.extract(v,this.consumePort);v.value[v.cur]==="/"&&(v.cur+=1,F+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const dt=[];for(dt.push(this.extract(v,this.consumeToken));v.value[v.cur]==="/";)v.cur+=1,dt.push(this.extract(v,this.consumeToken));if(dt.length===0)throw new Error("Invalid proto");const Qt=this.parseFmt(v);return this.currentLine++,{mediaType:U,port:F,protos:dt,fmts:Qt}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===h.TIME;){const U=this.parseTime(),F=this.parseRepeat(),dt=this.parseZone();v.push({time:U,repeats:F,zones:dt})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const U=this.parseMedia(),F=this.parseInformation(),dt=this.parseConnections(),Qt=this.parseBandWidth(),Be=this.parseKey(),ri=this.parseMediaAttributes(U);v.push({media:U,information:F,connections:dt,bandwidths:Qt,key:Be,attributes:ri})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const U=[];for(;;)try{this.consumeSpaceForRecord(v),U.push(this.extract(v,this.consumeToken))}catch{break}if(U.length===0)throw new Error("Invalid fmts");return U}extract(v,U){for(var F=arguments.length,dt=new Array(F>2?F-2:0),Qt=2;Qt<F;Qt++)dt[Qt-2]=arguments[Qt];const Be=U.call(this,v.value,v.cur,...dt),ri=v.value.slice(v.cur,Be);return v.cur=Be,ri}extractOneOrMore(v,U){const F=this.consumeOneOrMore(v.value,v.cur,U),dt=v.value.slice(v.cur,F);return v.cur=F,dt}consumeSpaceForRecord(v){if(v.value[v.cur]!==d)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class At extends ct{constructor(){super(...arguments),J(this,"attributes",void 0),J(this,"digested",!1)}extractOneOrMore(v,U,F){const dt=this.consumeOneOrMore(v.attValue,v._cur,U),Qt=v.attValue.slice(v._cur,dt),[Be,ri]=F||[];if(typeof Be=="number"&&Qt.length<Be)throw new Error("error in length, should be more or equal than ".concat(Be," characters."));if(typeof ri=="number"&&Qt.length>ri)throw new Error("error in length, should be less or equal than ".concat(ri," characters."));return v._cur=dt,Qt}consumeAttributeSpace(v){if(v.attValue[v._cur]!==d)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,U){if(!v.attValue)throw new Error("Nothing to extract from attValue.");for(var F=arguments.length,dt=new Array(F>2?F-2:0),Qt=2;Qt<F;Qt++)dt[Qt-2]=arguments[Qt];const Be=U.call(this,v.attValue,v._cur,...dt),ri=v.attValue.slice(v._cur,Be);return v._cur=Be,ri}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,U){if(!v.attValue)throw new Error;for(let F=0;F<U.length;F++)if(U[F]!==v.attValue[v._cur+F])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,D,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,D,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(v);){U.push(this.extractOneOrMore(v,D));try{this.consumeAttributeSpace(v)}catch(F){if(this.atEnd(v))break;throw F}}this.attributes.iceOptions=U}parseFingerprint(v){const U=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:F})}parseExtmap(v){const U=this.extractOneOrMore(v,p);let F;this.peekChar(v)==="/"&&(this.extract(v,this.consume,"/"),F=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeTill,d),Qt=j(j({entry:parseInt(U,10)},F&&{direction:F}),{},{extensionName:dt});this.peekChar(v)===d&&(this.consumeAttributeSpace(v),Qt.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(Qt)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(v,this.consumeTill);if(U!=="active"&&U!=="passive"&&U!=="actpass"&&U!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class le extends At{constructor(){super(...arguments),J(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(U){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),U}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const U=this.extract(v,this.consumeToken),F=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;)this.consumeAttributeSpace(v),F.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:F})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,V)}parseIdentity(v){const U=this.extractOneOrMore(v,W),F=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;){this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const Qt=this.extractOneOrMore(v,Be=>Be!==d&&N(Be));F.push({name:dt,value:Qt})}this.attributes.identities.push({assertionValue:U,extensions:F})}parseMsidSemantic(v){this.peekChar(v)===d&&this.consumeAttributeSpace(v);const U={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if(this.peekChar(v)==="*"){this.extract(v,this.consume,"*"),U.applyForAll=!0;break}{const F=this.extract(v,this.consumeTill,d);U.identifierList.push(F)}}this.attributes.msidSemantic=U}}class ue extends At{constructor(v){super(),J(this,"attributes",void 0),v.protos.indexOf("RTP")!==-1||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(U){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),U}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const U=this.extractOneOrMore(v,D,[1,32]);this.consumeAttributeSpace(v);const F=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const Qt=this.extractOneOrMore(v,p,[1,10]);this.consumeAttributeSpace(v);const Be=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const ri=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const Br={foundation:U,componentId:F,transport:dt,priority:Qt,connectionAddress:Be,port:ri,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),Br.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),Br.relPort=this.extract(v,this.consumePort));this.peekChar(v)===d;){this.consumeAttributeSpace(v);const ul=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),Br.extension[ul]=this.extractOneOrMore(v,m)}this.attributes.candidates.push(Br)}parseRemoteCandidate(v){const U=[];for(;;){const F=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Qt=this.extract(v,this.consumePort);U.push({componentId:F,connectionAddress:dt,port:Qt});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const U=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const dt={encodingName:F,clockRate:this.extractOneOrMore(v,p)};this.atEnd(v)||this.peekChar(v)!=="/"||(this.extract(v,this.consume,"/"),dt.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const Qt=this.attributes.payloads.find(Be=>Be.payloadType===parseInt(U,10));Qt?Qt.rtpMap=dt:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:dt,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const U=this.extractOneOrMore(v,p);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill,":");let dt;this.peekChar(v)===":"&&(this.extract(v,this.consume,":"),dt=this.extract(v,this.consumeTill));const Qt=this.attributes.ssrcs.find(Be=>Be.ssrcId===parseInt(U,10));Qt?Qt.attributes[F]=dt:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[F]:dt}})}parseFmtp(v){const U=this.extract(v,this.consumeTill,d);this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill),dt={};F.split(";").forEach(Be=>{let[ri,Br]=Be.split("=");ri=Ji(ri).call(ri);const ul=typeof Br=="string"?Ji(Br).call(Br):null;typeof ri=="string"&&ri.length>0&&(dt[ri]=ul)});const Qt=this.attributes.payloads.find(Be=>Be.payloadType===parseInt(U,10));Qt?Qt.fmtp={parameters:dt}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:dt}})}parseFmtParameters(v){const U={},F=this.extract(v,this.consumeTill,"=");v._cur++;const dt=this.extract(v,this.consumeTill,";");for(U[F]=dt;v.attValue[v._cur]===";";){const Qt=this.extract(v,this.consumeTill,"=");v._cur++;const Be=this.extract(v,this.consumeTill,";");U[Qt]=Be}return U}parseRtcpFb(v){let U="";U=this.peekChar(v)==="*"?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,d),this.consumeAttributeSpace(v);const F=this.extract(v,this.consumeTill,d);let dt;if(F==="trr-int")dt={type:F,interval:this.extract(v,this.consumeTill)};else{const Qt={type:F};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),Qt.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===d&&(Qt.additional=this.extract(v,this.consumeTill))),dt=Qt}if(U==="*")this.attributes.rtcpFeedbackWildcards.push(dt);else{const Qt=this.attributes.payloads.find(Be=>Be.payloadType===parseInt(U,10));Qt?Qt.rtcpFeedbacks.push(dt):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[dt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(v,this.consumePort)};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),U.netType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),U.addressType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),U.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(v){const U={id:this.extractOneOrMore(v,g,[1,64])};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),U.appdata=this.extractOneOrMore(v,g,[1,64])),this.attributes.msids.push(U)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const U=this.extractOneOrMore(v,dt=>y(dt)||p(dt)||dt==="_"||dt==="-");this.consumeAttributeSpace(v);const F={id:U,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===d){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const dt=[];for(;;){const Qt=this.extract(v,this.consumeToken);dt.push(Qt);try{this.extract(v,this.consume,",")}catch{break}}F.payloads=dt,this.peekChar(v)===d&&this.extract(v,this.consume,d)}for(;;){const dt=this.extract(v,this.consumeToken);switch(dt){case"depend":{const Qt={type:dt,rids:this.extract(v,this.consume,"=").split(",")};F.params.push(Qt);break}default:{const Qt={type:dt};this.peekChar(v)==="="&&(this.extract(v,this.consume,"="),Qt.val=this.extract(v,this.consumeTill,";")),F.params.push(Qt)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(F)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,p,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const U=this.extract(v,this.consumeToken),F=[];for(;;)try{this.consumeAttributeSpace(v);const dt=this.extract(v,this.consumeInteger);F.push(parseInt(dt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:F})}}function qe(at,v,U){return v in at?Object.defineProperty(at,v,{value:U,enumerable:!0,configurable:!0,writable:!0}):at[v]=U,at}class Ln{constructor(){qe(this,"eol",l)}print(v,U){let F="";return U&&(this.eol=U),F+=this.printVersion(v.version),F+=this.printOrigin(v.origin),F+=this.printSessionName(v.sessionName),F+=this.printInformation(v.information),F+=this.printUri(v.uri),F+=this.printEmail(v.emails),F+=this.printPhone(v.phones),F+=this.printConnection(v.connection),F+=this.printBandwidth(v.bandwidths),F+=this.printTimeFields(v.timeFields),F+=this.printKey(v.key),F+=this.printSessionAttributes(v.attributes),F+=this.printMediaDescription(v.mediaDescriptions),F}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let U="";for(const F of v)U+="e=".concat(F).concat(this.eol);return U}printPhone(v){let U="";for(const F of v)U+="e=".concat(F).concat(this.eol);return U}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let U="";for(const F of v)U+="b=".concat(F.bwtype,":").concat(F.bandwidth).concat(this.eol);return U}printTimeFields(v){let U="";for(const F of v){U+="t=".concat(F.time.startTime," ").concat(F.time.startTime).concat(this.eol);for(const dt of F.repeats)U+="r=".concat(dt.repeatInterval," ").concat(dt.typedTimes.join(" ")).concat(this.eol);F.zoneAdjustments&&(U+="z=",U+="z=".concat(F.zoneAdjustments.map(dt=>"".concat(dt.time," ").concat(dt.back?"-":""," ").concat(dt.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let U="";for(const F of v)U+="a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol);return U}printMediaDescription(v){let U="";for(const F of v)U+=this.printMedia(F.media),U+=this.printInformation(F.information),U+=this.printConnections(F.connections),U+=this.printBandwidth(F.bandwidths),U+=this.printKey(F.key),U+=this.printMediaAttributes(F);return U}printConnections(v){let U="";for(const F of v)U+=this.printConnection(F);return U}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new vr(this.eol).print(v)}printMediaAttributes(v){return new nt(this.eol).print(v)}}class yn{constructor(v){qe(this,"eol",void 0),this.eol=v}printIceUfrag(v){return v===void 0?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return v===void 0?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return v===void 0?"":"a=ice-options:".concat(v.join(d)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(d).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v){return v.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(d).concat(U.extensionName).concat(U.extensionAttributes?"".concat(d).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v){return v===void 0?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class vr extends yn{print(v){let U="";return U+=this.printGroups(v.groups),U+=this.printMsidSemantic(v.msidSemantic),U+=this.printIceLite(v.iceLite),U+=this.printIceUfrag(v.iceUfrag),U+=this.printIcePwd(v.icePwd),U+=this.printIceOptions(v.iceOptions),U+=this.printFingerprints(v.fingerprints),U+=this.printSetup(v.setup),U+=this.printTlsId(v.tlsId),U+=this.printIdentity(v.identities),U+=this.printExtmap(v.extmaps),U+=this.printUnrecognized(v.unrecognized),U}printGroups(v){let U="";return v.length>0&&(U+=v.map(F=>"a=group:".concat(F.semantic).concat(F.identificationTag.map(dt=>"".concat(d).concat(dt)).join("")).concat(this.eol)).join("")),U}printIceLite(v){return v===void 0?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return v.length===0?"":v.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(F=>"".concat(d).concat(F.name).concat(F.value?"=".concat(F.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let U="a=msid-semantic:".concat(v.semantic);return v.applyForAll?U+="".concat(d,"*"):v.identifierList.length>0&&(U+=v.identifierList.map(F=>"".concat(d).concat(F))),U+this.eol}}class nt extends yn{print(v){const U=v.attributes;let F="";return F+=this.printRTCP(U.rtcp),F+=this.printIceUfrag(U.iceUfrag),F+=this.printIcePwd(U.icePwd),F+=this.printIceOptions(U.iceOptions),F+=this.printCandidates(U.candidates),F+=this.printRemoteCandidatesList(U.remoteCandidatesList),F+=this.printEndOfCandidates(U.endOfCandidates),F+=this.printFingerprints(U.fingerprints),F+=this.printSetup(U.setup),F+=this.printMid(U.mid),F+=this.printExtmap(U.extmaps),F+=this.printRTPRelated(U),F+=this.printPtime(U.ptime),F+=this.printMaxPtime(U.maxPtime),F+=this.printDirection(U.direction),F+=this.printSSRCGroups(U.ssrcGroups),F+=this.printSSRC(U.ssrcs),F+=this.printRTCPMux(U.rtcpMux),F+=this.printRTCPMuxOnly(U.rtcpMuxOnly),F+=this.printRTCPRsize(U.rtcpRsize),F+=this.printMSId(U.msids),F+=this.printImageattr(U.imageattr),F+=this.printRid(U.rids),F+=this.printSimulcast(U.simulcast),F+=this.printSCTPPort(U.sctpPort),F+=this.printMaxMessageSize(U.maxMessageSize),F+=this.printUnrecognized(U.unrecognized),F}printCandidates(v){return v.map(U=>"a=candidate:".concat(U.foundation).concat(d).concat(U.componentId).concat(d).concat(U.transport).concat(d).concat(U.priority).concat(d).concat(U.connectionAddress).concat(d).concat(U.port).concat(d,"typ").concat(d).concat(U.type).concat(U.relAddr?"".concat(d,"raddr").concat(d).concat(U.relAddr):"").concat(U.relPort?"".concat(d,"rport").concat(d).concat(U.relPort):"").concat(Object.keys(U.extension).map(F=>"".concat(d).concat(F).concat(d).concat(U.extension[F])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v){return v.map(U=>"a=remote-candidates:".concat(U.join(d)).concat(this.eol)).join("")}printEndOfCandidates(v){return v===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const U=v.payloads;let F="";F+=v.rtcpFeedbackWildcards.map(dt=>this.printRTCPFeedback("*",dt)).join("");for(const dt of U)F+=this.printRtpMap(dt.payloadType,dt.rtpMap),F+=this.printFmtp(dt.payloadType,dt.fmtp),F+=dt.rtcpFeedbacks.map(Qt=>this.printRTCPFeedback(dt.payloadType,Qt)).join("");return F}printFmtp(v,U){if(!U)return"";const F=Object.keys(U.parameters);return F.length===1&&U.parameters[F[0]]===null?"a=fmtp:".concat(v).concat(d).concat(F[0]).concat(this.eol):"a=fmtp:".concat(v).concat(d).concat(Object.keys(U.parameters).map(dt=>"".concat(dt,"=").concat(U.parameters[dt])).join(";")).concat(this.eol)}printRtpMap(v,U){return U?"a=rtpmap:".concat(v).concat(d).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,U){let F="a=rtcp-fb:".concat(v).concat(d),dt=U;return dt.type==="trr-int"?F+="ttr-int".concat(d).concat(dt.interval):(F+="".concat(dt.type),dt.parameter&&(F+="".concat(d).concat(dt.parameter),dt.additional&&(F+="".concat(d).concat(dt.additional)))),F+this.eol}printPtime(v){return v===void 0?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return v===void 0?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return v===void 0?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map(U=>Object.keys(U.attributes).map(F=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(d).concat(F).concat(U.attributes[F]?":".concat(U.attributes[F]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v){return v===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return v===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return v===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(v===void 0)return"";let U="a=rtcp:".concat(v.port);return v.netType&&(U+="".concat(d).concat(v.netType)),v.addressType&&(U+="".concat(d).concat(v.addressType)),v.address&&(U+="".concat(d).concat(v.address)),U+this.eol}printMSId(v){return v.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(d).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(v){return v.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(v){return v.map(U=>{let F="a=rid:".concat(U.id).concat(d).concat(U.direction);return U.payloads&&(F+="".concat(d,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(F+="".concat(d).concat(U.params.map(dt=>dt.type==="depend"?"depend=".concat(dt.rids.join(",")):"".concat(dt.type,"=").concat(dt.val)).join(";"))),F+this.eol}).join("")}printSimulcast(v){return v===void 0?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return v===void 0?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return v===void 0?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return v===void 0?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(F=>"".concat(d).concat(F.toString(10))).join("")).concat(this.eol)).join("")}}function ft(at){return new vt().parse(at)}function kt(at,v){return new Ln().print(at,v)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var s in r)n.o(r,s)&&!n.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:r[s]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Mr(t){return GP.parse(t)}function gu(t,e){return GP.print(t,e)}var g5=hr("Array").keys,S5=Ra,T5=pi,R5=mt,v5=g5,kI=Array.prototype,y5={DOMTokenList:!0,NodeList:!0},C5=function(t){var e=t.keys;return t===kI||R5(kI,t)&&e===kI.keys||T5(y5,S5(t))?v5:e},ua=P(C5);function HP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ee(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?HP(Object(n),!0).forEach(function(i){Tn(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):HP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Tn(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const WP=new class extends hn{constructor(){super(...arguments),Tn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class A5{constructor(e){Tn(this,"logger",void 0),Tn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function MI(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function KP(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const xa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Yv=Date.now(),_g=t=>{for(const e in xa)if(Object.prototype.hasOwnProperty.call(xa,e)&&xa[e]===t)return e;return"DEFAULT"},T=new class{constructor(){Tn(this,"proxyServerURL",void 0),Tn(this,"logLevel",xa.DEBUG),Tn(this,"uploadState","collecting"),Tn(this,"uploadLogWaitingList",[]),Tn(this,"uploadLogUploadingList",[]),Tn(this,"uploadErrorCount",0),Tn(this,"currentLogID",0),Tn(this,"url",void 0),Tn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[xa.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Pe("UPLOAD_LOG",!0)}disableLogUpload(){Pe("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new A5(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-Yv<100)return void setTimeout(()=>{this.log(...e)},Date.now()-Yv);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=MI()+" Agora-SDK [".concat(_g(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=MI()+" %cAgora-SDK [".concat(_g(i),"]:");let s=[];if(!M("USE_NEW_LOG"))switch(i){case xa.DEBUG:s=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case xa.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case xa.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case xa.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-Yv<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-Yv);const i=Math.max(0,Math.min(4,e[0]));e[0]=MI()+" Agora-SDK [".concat(_g(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!M("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=KP()+" Agora-SDK [".concat(_g(t),"]:"):n[0]=KP()+" Agora-SDK [".concat(_g(t),"]:");let r="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),r+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:Ua,process_id:M("PROCESS_ID"),payload:JSON.stringify(t)};return to(async()=>{const n=await Er.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(M("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(M("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),WP.reportLogUploadError(i),!0},{timeout:M("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:M("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,M("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var YP;function b5(t){return Ei(t.reportId,"params.reportId",0,100,!1),Ei(t.category,"params.category",0,100,!1),Ei(t.event,"params.event",0,100,!1),Ei(t.label,"params.label",0,100,!1),Ve(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(YP={}).FREE="free",YP.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const I5={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ni=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),cn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let O5=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Ht(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const s=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];let p=d;if(t.argsMap)try{p=t.argsMap(this,...d)}catch(E){T.warning(E),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const m=(t.report||Mt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:gn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const E=r.apply(this,d);return E instanceof St?E.then(g=>(m.onSuccess(t.reportResult&&g),g)).catch(g=>{throw m.onError(g),g}):(m.onSuccess(t.reportResult&&E),E)}catch(E){throw m.onError(E),E}}}return i}}const Mt=new class{constructor(){Tn(this,"baseInfoMap",new Map),Tn(this,"proxyServer",void 0),Tn(this,"eventUploadTimer",void 0),Tn(this,"setSessionIdTimer",void 0),Tn(this,"url",void 0),Tn(this,"sids",new Set),Tn(this,"backupUrl",void 0),Tn(this,"_appId",void 0),Tn(this,"_aid",0),Tn(this,"keyEventUploadPendingItems",[]),Tn(this,"normalEventUploadPendingItems",[]),Tn(this,"apiInvokeUploadPendingItems",[]),Tn(this,"apiInvokeCount",0),Tn(this,"apiInvokeLoggedCount",0),Tn(this,"ltsList",[]),Tn(this,"lastSendNormalEventTime",Date.now()),Tn(this,"customReportCounterTimer",void 0),Tn(this,"customReportCount",0),Tn(this,"extApiInvoke",async t=>{for(const e of t){const n=ee(ee({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:gn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),M("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),M("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,s=!!M("SHOW_REPORT_INVOKER_LOG"),c=!!M("SHOW_REPORT_USER_INVOKER_LOG"),l=s||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function h(g,I){if(l){let y="[apiInvoke-".concat(d,"]");e.id&&(y+="[".concat(e.id,"]")),e.name&&(y+="[".concat(e.name,"]")),T.info("".concat(y," ").concat(g),g==="start"?e.options:I||"")}}const p=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});h("start");let m=!1;_i(e.timeout).then(()=>{m||(this.sendApiInvoke(ee(ee({},p()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const E=new $(L.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:g=>{const I=()=>{if(m)throw E;return m=!0,this.sendApiInvoke(ee(ee({},p()),{},{success:!0},e.reportResult&&{result:g})),h("onSuccess"),g};return n?AP(I,e.name+"Success",n,()=>m=!0):I()},onError:g=>{const I=()=>{if(m)throw g;m=!0,this.sendApiInvoke(ee(ee({},p()),{},{success:!1,error:g})),h("onFailure",g.toString())};return n?AP(I,e.name+"Error",n,()=>m=!0):I()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:M("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:NI?"global":"oversea",areas:M("AREAS")&&M("AREAS").join(",")},e.extend),{stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientRole:p}=e,m=Date.now(),E=ee(ee({},i),{},{eventType:ni.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:LI,lts:m,elapse:m-n,extend:JSON.stringify(r),mode:e.mode,process:M("PROCESS_ID"),appType:M("APP_TYPE"),success:!0,version:Ua,stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientType:Et(g=window.navigator.userAgent).call(g,"AgoraWebView")?42:20,clientRole:p,serviceId:M("PROCESS_ID"),extensionID:M("PLUGIN_INFO").join(",")||""});var g;this.send({type:cn.SESSION,data:E},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{role:e.role,eventType:ni.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:cn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ni.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:cn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:s,avoidJoinStartTime:c,addr:l,isProxy:d}=e,h=r-(s&&c?c:n.startTime),p=ee(ee({},i),{},{eventType:ni.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:h,eventElapse:r-e.lts,firstSuccess:s,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:wI(),isABTestSuccess:e.isABTestSuccess?1:0}),m=p.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),s)this.send({type:cn.JOIN_GATEWAY,data:p},!0);else{let E;if(l)if(d){const I=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),y=l.match(/p=[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:I&&I.length?I[0].split("=")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split("=")[1]:"",isProxy:d?1:0}}else{const I=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),y=l.match(/(:|p=)[0-9]{1,6}/g);E={isSuccess:m,gatewayIp:I&&I.length?I[0].split("//")[1].replace(/-/g,"."):"",port:y&&y.length?y[0].split(/:|p=/g)[1]:"",isProxy:d?1:0}}else E={isSuccess:m,gatewayIp:"",port:"",isProxy:d?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const g=Object.assign({},p,E,{eventType:ni.REJOIN_GATEWAY});this.send({type:cn.RE_JOIN_GATEWAY,data:g},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=ee(ee({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:cn.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ni.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:cn.PUBLISH,data:s},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,s=Date.now(),c=ee(ee({},r),{},{eventType:ni.SUBSCRIBE,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:cn.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...ua(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee({},s),{},{eventType:ni.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:cn.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee(ee({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee(ee({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:ni.AB_TEST,lts:r});this.send({type:cn.AB_TEST,data:s},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:ni.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:cn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:ni.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:cn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=ee(ee(ee({},s),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ni.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:cn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ni.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:cn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{eventType:ni.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:cn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(t){this.proxyServer=t,t?T.debug("reportProxyServerurl: ".concat(t)):T.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:cn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(s,c,l){const d=s[c];if(!d||typeof d!="string")return[s];s[c]="";const h=Qo(JSON.stringify(s));let p=0;const m=[];let E=0;for(let g=0;g<d.length;g++)E+=d.charCodeAt(g)<=127?1:3,E<=l-h||(m[m.length]=bt(bt({},s),{},{[c]:d.substring(p,g)}),p=g,E=d.charCodeAt(g)<=127?1:3);return p!==d.length-1&&(m[m.length]=bt(bt({},s),{},{[c]:d.substring(p)})),m})(ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:cn.WORKER_EVENT,data:s},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:cn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:cn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ee(ee(ee({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:cn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>M("CUSTOM_REPORT_LIMIT"))throw new $(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:cn.USER_ANALYTICS,data:ee(ee({sid:t},r),{},{lts:n})}));try{M("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw T.error("send custom report message failed",r.toString()),new $(L.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=M("NOT_REPORT_EVENT");if(t.tag&&Et(e)&&Et(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:s}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof $){const{code:d,message:h}=t.error;c=d||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:s,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:cn.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const s=t.shift();n.length<20?n.push(s):i.push(s)}t.push(...i);for(const s of[...n]){var r;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),J_(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),M("ENABLE_EVENT_REPORT")&&n.length&&(M("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>c=>{M("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-M("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){xn.networkState===Zr.OFFLINE&&await St.race([xn.onlineWaiter,_i(2*Hn.maxRetryTimeout)]);const e=r=>{let s=new Uint8Array;return r.forEach(c=>{const l=_I(JSON.stringify(c.data)),d=new ArrayBuffer(5),h=(m=>{let E=0;return Object.entries(cn).forEach(g=>{let[I,y]=g;y===m.type&&(E=O5[I])}),E})(c),p=new DataView(d);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=EP(s,new Uint8Array(d)),s=EP(s,l)}),s},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await CI(i,{timeout:1e4,data:e(t),headers:ee(ee({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(r===1)throw s;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};xn.networkState===Zr.OFFLINE&&await St.race([xn.onlineWaiter,_i(2*Hn.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(M("EVENT_REPORT_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(M("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(s)));try{e?await p5(c,{timeout:1e4,data:r}):await CI(c,{timeout:1e4,data:r})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(t,e){const n=Object.assign({},I5);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:gn.TRACER}).onSuccess()}};WP.on("REPORT_LOG_UPLOAD",t=>{t.networkState=xn.networkState,Mt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:gn.TRACER}).onSuccess("logUploadError")});class z extends ${constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Tn(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,T)}throw(){super.throw(T)}}const gi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Te(){return gi}function zP(){return"setSinkId"in HTMLAudioElement.prototype&&(!M("RESTRICTION_SET_PLAYBACK_DEVICE")||(Xc()||rP())&&!fI())}function qP(){return!gi.supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Jc()}let Si=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Kf(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function ge(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function fs(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function UI(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const w5={"90p":ge(160,90),"90p_1":ge(160,90),"120p":ge(160,120,15,30,65),"120p_1":ge(160,120,15,30,65),"120p_3":ge(120,120,15,30,50),"120p_4":ge(212,120),"180p":ge(320,180,15,30,140),"180p_1":ge(320,180,15,30,140),"180p_3":ge(180,180,15,30,100),"180p_4":ge(240,180,15,30,120),"240p":ge(320,240,15,40,200),"240p_1":ge(320,240,15,40,200),"240p_3":ge(240,240,15,40,140),"240p_4":ge(424,240,15,40,220),"360p":ge(640,360,15,80,400),"360p_1":ge(640,360,15,80,400),"360p_3":ge(360,360,15,80,260),"360p_4":ge(640,360,30,80,600),"360p_6":ge(360,360,30,80,400),"360p_7":ge(480,360,15,80,320),"360p_8":ge(480,360,30,80,490),"360p_9":ge(640,360,15,80,800),"360p_10":ge(640,360,24,80,800),"360p_11":ge(640,360,24,80,1e3),"480p":ge(640,480,15,100,500),"480p_1":ge(640,480,15,100,500),"480p_2":ge(640,480,30,100,1e3),"480p_3":ge(480,480,15,100,400),"480p_4":ge(640,480,30,100,750),"480p_6":ge(480,480,30,100,600),"480p_8":ge(848,480,15,100,610),"480p_9":ge(848,480,30,100,930),"480p_10":ge(640,480,10,100,400),"720p":ge(1280,720,15,120,1130),"720p_auto":ge(1280,720,30,900,3e3),"720p_1":ge(1280,720,15,120,1130),"720p_2":ge(1280,720,30,120,2e3),"720p_3":ge(1280,720,30,120,1710),"720p_5":ge(960,720,15,120,910),"720p_6":ge(960,720,30,120,1380),"1080p":ge(1920,1080,15,120,2080),"1080p_1":ge(1920,1080,15,120,2080),"1080p_2":ge(1920,1080,30,120,3e3),"1080p_3":ge(1920,1080,30,120,3150),"1080p_5":ge(1920,1080,60,120,4780),"1440p":ge(2560,1440,30,120,4850),"1440p_1":ge(2560,1440,30,120,4850),"1440p_2":ge(2560,1440,60,120,7350),"4k":ge(3840,2160,30,120,8910),"4k_1":ge(3840,2160,30,120,8910),"4k_3":ge(3840,2160,60,120,13500)},N5={"480p":fs(640,480,5),"480p_1":fs(640,480,5),"480p_2":fs(640,480,30),"480p_3":fs(640,480,15),"720p":fs(1280,720,5),"720p_auto":ge(1280,720,30,900,3e3),"720p_1":fs(1280,720,5),"720p_2":fs(1280,720,30),"720p_3":fs(1280,720,15),"1080p":fs(1920,1080,5),"1080p_1":fs(1920,1080,5),"1080p_2":fs(1920,1080,30),"1080p_3":fs(1920,1080,15)},D5={"1SL1TL":UI(1,1),"3SL3TL":UI(3,3),"2SL3TL":UI(2,3)};function $o(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},w5[t]):t}function xI(t){return typeof t=="string"?Object.assign({},N5[t]):t}function zv(t){return typeof t=="string"?Object.assign({},D5[t]):t}const L5={speech_low_quality:Kf(16e3,!1),speech_standard:Kf(32e3,!1,18),music_standard:Kf(48e3,!1),standard_stereo:Kf(48e3,!0,56),high_quality:Kf(48e3,!1,128),high_quality_stereo:Kf(48e3,!0,192)};function qv(t){return typeof t=="string"?Object.assign({},L5[t]):t}const Yf=[];function XP(t){return Zn(t,"mediaSource",["screen","window","application"]),!0}let Nt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),ze=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),zf=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),P5=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),k5=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),oh=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),qf=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Xf=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Jf=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),da=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const VI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},BI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},JP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},M5={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let rr=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),ha=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),gg=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),ch=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Qi=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),tc=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const FI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Xv=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function ZP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ln(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ZP(Object(n),!0).forEach(function(i){Y(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ZP(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Y(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||s===null)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:String(r)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Se(t,e,n,i,r){var s,c,l={};return Object.keys(i).forEach(function(d){l[d]=i[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=er(s=id(c=n.slice()).call(c)).call(s,function(d,h){return h(t,e,d)||d},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(t,e,l),l=null),l}class $P extends hn{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(oh.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),Y(this,"trackMediaType",void 0),Y(this,"_ID",void 0),Y(this,"_rtpTransceiver",void 0),Y(this,"_lowRtpTransceiver",void 0),Y(this,"_hints",[]),Y(this,"_isClosed",!1),Y(this,"_originMediaStreamTrack",void 0),Y(this,"mediaStreamTrack",void 0),Y(this,"_external",{}),this._ID=n||Ye(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){Et(Yf).call(Yf,i)||Yf.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Eu(()=>{var n;Mt.reportApiInvoke(null,{name:Gn.GET_MEDIA_STREAM_TRACK,options:[],tag:gn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===zf.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=Yf.indexOf(e);n!==-1&&Yf.splice(n,1)}(this),this.emit(qf.CLOSED),this.removeAllListeners(oh.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===zf.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(oh.TRANSCEIVER_UPDATED,e,n)}}class Qf extends $P{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),Y(this,"_enabled",!0),Y(this,"_muted",!1),Y(this,"_isExternalTrack",!1),Y(this,"_isClosed",!1),Y(this,"_enabledMutex",void 0),Y(this,"processor",void 0),Y(this,"_processorContext",void 0),Y(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ui("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(Nt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qf.TRACK_ENDED)}stateCheck(e,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Qc(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new $(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new $(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():St.resolve([])}}const tk=window.AudioContext||window.webkitAudioContext;let pa=null;const ke=new class extends hn{constructor(){super(...arguments),Y(this,"prevState",void 0),Y(this,"curState",void 0),Y(this,"currentTime",void 0),Y(this,"currentTimeStuckAt",void 0),Y(this,"interruptDetectorTrack",void 0),Y(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(Si.IOS_15_16_INTERRUPTION_START)}),Y(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(pa&&await pa.suspend(),this.emit(Si.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){T.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){T.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Zf(){if(!pa){if(function(){if(!tk)return void T.error("your browser is not support web audio");T.info("create audio context");const t=ln({},M("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(t)),pa=new tk(t),ke.curState=pa.state,pa.onstatechange=()=>{ke.prevState=ke.curState,ke.curState=pa?pa.state:void 0;const{prevState:e,curState:n}=ke,i=n==="running",r=n==="interrupted",s=e==="running",c=e==="suspended",l=e==="interrupted",d=_e().osVersion;(ir()||hs())&&s&&r&&(T.info("ios".concat(d,"-interruption-start")),ke.emit(Si.IOS_INTERRUPTION_START)),(ir()||hs())&&(c||l)&&i&&(T.info("ios".concat(d,"-interruption-end")),ke.emit(Si.IOS_INTERRUPTION_END)),e!==n&&ke.emit(Si.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=pa)===null||e===void 0?void 0:e.currentTime;ke.currentTime!==n?(ke.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),ke.currentTimeStuckAt=void 0),ke.currentTime=n):(n!==ke.currentTimeStuckAt&&(Mt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:gn.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),ke.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,s=!1,c=!1;function l(y){e.state==="running"?d(!1):ir()||hs()?e.state==="suspended"&&(d(!0),y&&e.resume().then(h,h)):e.state!=="closed"&&(d(!0),y&&e.resume().then(h,h))}function d(y){if(r!==y){r=y;for(let C=0,N=n;C<N.length;C+=1){const D=N[C];y?window.addEventListener(D,p,{capture:!0,passive:!0}):window.removeEventListener(D,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function m(y){if(!c)if(i.paused)if(y){let C;E(!1),c=!0;try{C=i.play(),C?C.then(g,g):(i.addEventListener("playing",g),i.addEventListener("abort",g),i.addEventListener("error",g))}catch{g()}}else E(!0);else E(!1)}function E(y){if(s!==y){s=y;for(let C=0,N=n;C<N.length;C++){const D=N[C];y?window.addEventListener(D,I,{capture:!0,passive:!0}):window.removeEventListener(D,I,{capture:!0,passive:!0})}}}function g(){i.removeEventListener("playing",g),i.removeEventListener("abort",g),i.removeEventListener("error",g),c=!1,m(!1)}function I(){m(!0)}if(ir()){const y=e.createMediaStreamDestination(),C=document.createElement("div");C.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=C.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=y.stream,m(!0)}ke.on(Si.STATE_CHANGE,function(){l(!0)}),l(!1)}(pa)}(),!pa)throw new $(L.NOT_SUPPORTED,"can not create audio context");return pa}return pa}function lh(t){if(function(){if(jI!==null)return jI;const i=Zf(),r=i.createBufferSource(),s=i.createGain(),c=i.createGain();r.connect(s),r.connect(c),r.disconnect(s);let l=!1;try{r.disconnect(s)}catch{l=!0}return r.disconnect(),jI=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,s)=>{var c;return t._inputNodes||(t._inputNodes=[]),Et(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,s)):e.call(t,i,r)),t},t.disconnect=(i,r,s)=>{n.call(t),i?Vv(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let jI=null;function GI(t,e){let n=!1;const i=1/e;if(M("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=Zf();let s=r.createGain();s.gain.value=0,s.connect(r.destination);const c=()=>{if(n)return void(s=null);const l=r.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class ek{constructor(){Y(this,"context",void 0),Y(this,"analyserNode",void 0),Y(this,"sourceNode",void 0),this.context=Zf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ir()||hs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=er(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class nk extends hn{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Y(this,"outputNode",void 0),Y(this,"outputTrack",void 0),Y(this,"isPlayed",!1),Y(this,"sourceNode",void 0),Y(this,"context",void 0),Y(this,"audioBufferNode",void 0),Y(this,"destNode",void 0),Y(this,"audioOutputLevel",0),Y(this,"volumeLevelAnalyser",void 0),Y(this,"_processedNode",void 0),Y(this,"playNode",void 0),Y(this,"isDestroyed",!1),Y(this,"onNoAudioInput",void 0),Y(this,"isNoAudioInput",!1),Y(this,"_noAudioInputCount",0),this.context=Zf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),lh(this.outputNode),this.volumeLevelAnalyser=new ek}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(da.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const s=i.outputBuffer.getChannelData(r);for(let c=0;c<s.length;c+=1)s[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Te().webAudioMediaStreamDest)throw new $(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Bv(()=>{ke.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ir()||hs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let s=0;s<i.length;s++)i[s]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await _i(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ik extends nk{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),Y(this,"sourceNode",void 0),Y(this,"track",void 0),Y(this,"clonedTrack",void 0),Y(this,"audioElement",void 0),Y(this,"isCurrentTrackCloned",!1),Y(this,"isRemoteTrack",!1),Y(this,"originVolumeLevelAnalyser",void 0),Y(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),lh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),lh(this.outputNode),this.emit(da.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new $(L.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),lh(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,T.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([l]));lh(d),this.originVolumeLevelAnalyser=new ek,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const c=_e();n&&c.os===ei.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(ke.on(Si.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),lh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(da.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),ke.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));lh(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function rk(t,e,n){const i=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function U5(t,e){const n=await ak(t.mediaSource),{sourceId:i,audio:r}=await function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new St((l,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const g=document.createElement("div");g.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(N);const D=new Error("NotAllowedError");D.name="NotAllowedError",d(D)};let y=c;const C=document.createElement("div");if(c){const D=document.createElement("input");D.setAttribute("type","checkbox");const V=document.createElement("span");D.setAttribute("style","margin-right: 6px;"),V.innerText="Share audio",D.checked=y,D.onchange=()=>{y=D.checked},C.appendChild(D),C.appendChild(V)}g.appendChild(C),g.appendChild(I),p.appendChild(m),p.appendChild(E),p.appendChild(g);const N=document.createElement("div");N.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),N.appendChild(h),N.appendChild(p),document.body.appendChild(N),s.map(D=>{if(D.id){const V=document.createElement("div");V.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let W=D.thumbnail;try{const{width:K}=W.getSize();K>1920&&(W=W.resize({width:1920}))}catch(K){throw K&&K.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),K}V.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+W.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+D.name.replace(/[\u00A0-\u9999<>\&]/g,function(K){return"&#"+K.charCodeAt(0)+";"})+"</span>",V.onclick=()=>{document.body.removeChild(N),l({sourceId:D.id,audio:y})},E.appendChild(V)}})})}(n,e);return await rk(i,t,r)}async function ak(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=_P();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new $(L.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new St((s,c)=>{n.desktopCapturer.getSources({types:e},(l,d)=>{l?c(l):s(d)})}));try{return await i}catch(s){throw new $(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const HI=new Ui("safari");let sk=!1,ok=!1;async function fa(t,e){let n=0,i=null;for(;n<2;)try{i=await x5(t,e,n>0);break}catch(r){if(r instanceof $)throw T.error("[".concat(e,"] ").concat(r.toString())),r;const s=Jv(r.name||r.code||r,r.message);if(s.code===L.MEDIA_OPTION_INVALID){T.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await _i(500);continue}throw T.error("[".concat(e,"] ").concat(s.toString())),s}if(!i)throw new $(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function x5(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new $(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=Te(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return T.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(_P())t.screen.sourceId?$f(r,await rk(t.screen.sourceId,t.screen,!!t.screenAudio)):$f(r,await U5(t.screen,!!t.screenAudio));else if(Xc()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new $(L.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const E=await(c=t.screen.extensionId,l=e,new St((g,I)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},y=>{if(!y||!y.streamId)return T.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),y),void I(new $(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));g(y.streamId)})}catch(y){T.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),y.toString()),I(new $(L.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=E,$f(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var s;t.screen.mediaSource&&XP(t.screen.mediaSource);const E={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(s=t.screen.displaySurface)!==null&&s!==void 0?s:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:g,surfaceSwitching:I,systemAudio:y,preferCurrentTab:C}=t.screen,N={selfBrowserSurface:g,surfaceSwitching:I,systemAudio:y,preferCurrentTab:C};!g&&delete N.selfBrowserSurface,!I&&delete N.surfaceSwitching,!y&&delete N.systemAudio,!C&&delete N.preferCurrentTab,T.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:E,audio:t.screenAudio,controls:N})),$f(r,await navigator.mediaDevices.getDisplayMedia(ln({video:E,audio:t.screenAudio},N)))}else{if(!En())throw T.error("[".concat(e,"] This browser does not support screenSharing")),new $(L.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&XP(t.screen.mediaSource);const E={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};T.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(E))),$f(r,await navigator.mediaDevices.getUserMedia(E))}}var c,l;if(!t.video&&!t.audio)return r;let d={video:t.video,audio:t.audio},h=M("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=TI(d,h)}catch{}T.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),_e();let p,m=null;(Ii()||ir()||Uv())&&(m=await HI.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(E){throw m&&m(),E}return d.audio&&(sk=!0),d.video&&(ok=!0),$f(r,p),m&&m(),r}function Jv(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new $(L.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new $(L.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new $(L.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new $(L.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new $(L.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new $(L.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return T.error("getUserMedia unexpected error",t),new $(L.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function $f(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(i&&t.removeTrack(i),t.addTrack(s)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const ma=new class extends hn{get state(){return this._state}set state(t){t!==this._state&&(this.emit(ch.STATE_CHANGE,t),this._state=t)}constructor(){super(),Y(this,"_state",gg.IDLE),Y(this,"isAccessMicrophonePermission",!1),Y(this,"isAccessCameraPermission",!1),Y(this,"lastAccessMicrophonePermission",!1),Y(this,"lastAccessCameraPermission",!1),Y(this,"checkdeviceMatched",!1),Y(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(M("ENUMERATE_DEVICES_INTERVAL")||(xv()||Mv()===ei.HARMONY_OS)&&Jc())&&this.updateDevicesInfo()},M("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>T.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new $(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let s=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(s=!1),r.video&&(c=!1);let l=null,d=null,h=null;if(!n&&(s||c)){if(HI.isLocked&&(T.debug("[device manager] wait GUM lock"),(await HI.lock())(),T.debug("[device manager] GUM unlock")),sk&&(s=!1,this.isAccessMicrophonePermission=!0),ok&&(c=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",t,e,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const m=Jv(p.name||p.code||p,p.message);if(m.code===L.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(p){const m=Jv(p.name||p.code||p,p.message);if(m.code===L.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){const m=Jv(p.name||p.code||p,p.message);if(m.code===L.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",t,"cam permission",e)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,p}catch(p){return l&&l.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),l=null,d=null,h=null,new $(L.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new $(L.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=gg.INITING;try{await this.updateDevicesInfo(),this.state=gg.INITEND}catch(t){throw T.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=gg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new $(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&s?s.groupId===r.groupId?T.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is the same group")):T.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is not the same group")):T.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const s=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((r,s)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==gg.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ch.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ch.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ch.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let WI=!1;const Ea=new class extends hn{constructor(){super(...arguments),Y(this,"onAutoplayFailed",void 0),Y(this,"onAudioAutoplayFailed",void 0)}};function ck(){if(_e(),!WI){const t=e=>{e.preventDefault(),WI=!1,lg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};WI=!0,lg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ea.onAutoplayFailed?Ea.onAutoplayFailed():Ea.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ea.emit("autoplay-failed")}}function lk(t,e,n,i){if(!t)return;const r=Mt.getBaseInfoBySessionId(t);if(!r)return;const s=r.info,c=Date.now(),l=ln(ln({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-r.startTime,cbRegistered:Ea.onAutoplayFailed||Ea.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});Mt.send({type:cn.AUTOPLAY_FAILED,data:l},!0)}const V5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],_r=new class{constructor(){Y(this,"onAutoplayFailed",void 0),Y(this,"elementMap",new Map),Y(this,"elementStateMap",new Map),Y(this,"elementsNeedToResume",[]),Y(this,"sinkIdMap",new Map),Y(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),s=i.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(T.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(ke.curState==="running")return Bf()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),Y(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),ke.on(Si.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.on(Si.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ke.on(Si.STATE_CHANGE,()=>{ir()&&ke.prevState==="suspended"&&ke.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new $(L.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,Qi.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{r.setSinkId(s).catch(l=>{T.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){T.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&lk(i,"audio",l.message,e),T.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),Bv(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ck()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){V5.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),s=i.type==="pause"?"paused":i.type;if(T.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(s)),i.type==="error"){const c=e==null?void 0:e.error;c&&T.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,s)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new St(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{lg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Nn(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new $(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];const l=i.apply(this,s);return l instanceof St?new St((d,h)=>{l.then(d).catch(h)}):l}),n}}class uk extends hn{constructor(e){super(),Y(this,"name","VideoProcessorDestination"),Y(this,"ID","0"),Y(this,"_source",void 0),Y(this,"videoContext",void 0),Y(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new $(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new $(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(rr.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(rr.ON_TRACK,void 0)}}class dk extends hn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),Y(this,"constraintsMap",new Map),Y(this,"statsRegistry",[]),Y(this,"usageRegistry",[]),Y(this,"trackId",void 0),Y(this,"direction",void 0),Y(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await wi(this,ha.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return T.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new $(L.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof St&&(i=await i),e.push(ln(ln({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class hk extends hn{constructor(e){super(),Y(this,"name","AudioProcessorDestination"),Y(this,"ID","0"),Y(this,"inputTrack",void 0),Y(this,"inputNode",void 0),Y(this,"audioProcessorContext",void 0),Y(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new $(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new $(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(rr.ON_TRACK,void 0),this.emit(rr.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(rr.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(rr.ON_NODE,this.inputNode))}}class pk extends hn{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),Y(this,"constraintsMap",new Map),Y(this,"statsRegistry",[]),Y(this,"audioContext",void 0),Y(this,"trackId",void 0),Y(this,"direction",void 0),Y(this,"usageRegistry",[]),Y(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return wi(this,ha.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Ke(this,ha.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lr(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){T.error(new $(L.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof St&&(i=await i),e.push(ln(ln({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class KI extends hn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Y(this,"context",void 0),Y(this,"processSourceNode",void 0),Y(this,"outputTrack",void 0),Y(this,"processedNode",void 0),Y(this,"clonedTrack",void 0),Y(this,"outputNode",void 0),this.outputNode=new B5}setVolume(){}createOutputTrack(){throw new $(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class B5{disconnect(){}connect(){}}function fk(t){return new St((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const s=ir()?"canplay":"playing";r.addEventListener(s,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&En()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(Fv),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function Qv(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=$o(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!hP()&&n.frameRate&&(e.frameRate=n.frameRate),rP()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),En()&&(e.frameRate={ideal:30,max:30}),e}function mk(t){const e={};return hP()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Xc()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function Ek(t){const e=mk(t);if(t.encoderConfig){const n=qv(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),xv()&&(e.sampleRate=void 0),e}const F5=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:s=n,width:c=i,height:l=r}=e;if(!s||!c||!l)return;c=RI(c),l=RI(l),s=RI(s);const{max:d,min:h}=function(g,I,y){const C=200*Math.pow(y/15,.6)*Math.pow(g*I/640/360,.75);return{min:Math.floor(C),max:Math.floor(4*C)}}(c,l,s),{bitrateMax:p,bitrateMin:m}=e||{};p||T.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]"));const{maxFramerate:E}=M("ENCODER_CONFIG_LIMIT");return E&&typeof E=="number"&&(s=Math.min(s,E)),{frameRate:s,bitrateMax:p||d,bitrateMin:m||h,scaleResolutionDownBy:1,scale:0}},_k=async(t,e,n)=>await(async(i,r,s)=>{const c=function(h){const p=[];for(let m=0;m<h.length;m+=2)p.push(parseInt(h.slice(m,m+2),16));return Uint8Array.from(p)}(OP(""+r+s)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,i))})(t.buffer,e,n),YI=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new St((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const s=await gk(r);n({buffer:s,width:e.width,height:e.height})}else i(new $(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},gk=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var Sk,Tk,Rk,vk,yk,Ck,Ak,bk,Ik,Ok,wk,Nk,Dk,Lk,Pk,kk,Mk,Uk,pn,xk,Vk,Bk,Fk,jk,Gk,ec,Hk,Wk,Kk,Yk,zk,qk,Xk,Jk,Qk,Zk,$k,tM,eM,Di;let vn=(Sk=Ht({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Tk=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),Rk=Nn(),vk=Gf("LocalAudioTrack","_enabledMutex"),yk=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),Ck=Nn(),Ak=Gf("LocalAudioTrack","_enabledMutex"),bk=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),Ik=Nn(),Ok=Nn(),wk=Nn(),Nk=Ht({argsMap:t=>[t.getTrackId()]}),Dk=Nn(),Lk=Ht({argsMap:t=>[t.getTrackId()]}),Pk=Nn(),kk=Ht({argsMap:t=>[t.getTrackId()]}),Mk=Ht({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Uk=Ht({argsMap:t=>[t.getTrackId()]}),Se((pn=class extends Qf{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?_r.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),Y(this,"trackMediaType",Jf.AUDIO),Y(this,"_encoderConfig",void 0),Y(this,"_trackSource",void 0),Y(this,"metadata",[]),Y(this,"_enabled",!0),Y(this,"_volume",100),Y(this,"_useAudioElement",!0),Y(this,"_bypassWebAudio",!1),Y(this,"processor",void 0),Y(this,"_processorContext",void 0),Y(this,"_processorDestination",void 0),Y(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new KI,M("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),M("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ii()&&!pa?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){Ve(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&_r.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Ke(this,Nt.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!zP())throw new $(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await _r.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Ke(this,Nt.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Ke(this,Nt.NEED_MUTE_TRACK,this):await Ke(this,Nt.NEED_UNMUTE_TRACK,this))}getStats(){return Eu(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},VI)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(da.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(da.ON_AUDIO_BUFFER),this._source.on(da.ON_AUDIO_BUFFER,n=>t(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),_r.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?_r.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&_r.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return St.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new $(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(rr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Ke(this,Nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this))}),t.on(rr.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(rr.ON_TRACK),t.removeAllListeners(rr.ON_NODE)}bindProcessorContextEvents(t){t.on(ha.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(ha.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof KI&&(this._trackSource=new ik(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new pk(this._source.context,this.getTrackId(),"local"),e=new hk(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(da.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(_r.stop(this.getTrackId()),this._source.play()),Ke(this,Nt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[Sk],Object.getOwnPropertyDescriptor(pn.prototype,"setVolume"),pn.prototype),Se(pn.prototype,"setPlaybackDevice",[Tk,Rk],Object.getOwnPropertyDescriptor(pn.prototype,"setPlaybackDevice"),pn.prototype),Se(pn.prototype,"setEnabled",[vk,yk,Ck],Object.getOwnPropertyDescriptor(pn.prototype,"setEnabled"),pn.prototype),Se(pn.prototype,"setMuted",[Ak,bk,Ik],Object.getOwnPropertyDescriptor(pn.prototype,"setMuted"),pn.prototype),Se(pn.prototype,"getStats",[Ok],Object.getOwnPropertyDescriptor(pn.prototype,"getStats"),pn.prototype),Se(pn.prototype,"setAudioFrameCallback",[wk],Object.getOwnPropertyDescriptor(pn.prototype,"setAudioFrameCallback"),pn.prototype),Se(pn.prototype,"play",[Nk,Dk],Object.getOwnPropertyDescriptor(pn.prototype,"play"),pn.prototype),Se(pn.prototype,"stop",[Lk,Pk],Object.getOwnPropertyDescriptor(pn.prototype,"stop"),pn.prototype),Se(pn.prototype,"close",[kk],Object.getOwnPropertyDescriptor(pn.prototype,"close"),pn.prototype),Se(pn.prototype,"pipe",[Mk],Object.getOwnPropertyDescriptor(pn.prototype,"pipe"),pn.prototype),Se(pn.prototype,"unpipe",[Uk],Object.getOwnPropertyDescriptor(pn.prototype,"unpipe"),pn.prototype),pn),Zv=(xk=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),Vk=Nn(),Bk=Gf("MicrophoneAudioTrack","_enabledMutex"),Fk=Ht({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),jk=Nn(),Gk=Ht({argsMap:t=>[t.getTrackId()]}),Se((ec=class extends vn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?qv(e.encoderConfig):{},i,M("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Y(this,"_config",void 0),Y(this,"_deviceName","default"),Y(this,"_constraints",void 0),Y(this,"_originalConstraints",void 0),Y(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Bf()||pI())&&ke.bindInterruptDetectorTrack(this)}async setDevice(t){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await ma.getDeviceById(t),n={};n.audio=ln({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await fa(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await fa({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await ma.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}T.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),M("AUTO_RESET_AUDIO_ROUTE")&&(ir()||hs())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(c){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=ln({},this._constraints),s=ma.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{n||(this._enabled=!0);const c=await fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Ke(this,Nt.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Bf()||pI())&&ke.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ir()||hs())&&this._enabled&&!this._isClosed&&ke.duringInterruption){const t=async()=>{ke.off(Si.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ke.on(Si.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qf.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=ma.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await fa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(ha.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(ha.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[xk,Vk],Object.getOwnPropertyDescriptor(ec.prototype,"setDevice"),ec.prototype),Se(ec.prototype,"setEnabled",[Bk,Fk,jk],Object.getOwnPropertyDescriptor(ec.prototype,"setEnabled"),ec.prototype),Se(ec.prototype,"close",[Gk],Object.getOwnPropertyDescriptor(ec.prototype,"close"),ec.prototype),ec),j5=(Hk=Ht({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),Wk=Nn(),Kk=Ht({argsMap:t=>[t.getTrackId()]}),Yk=Nn(),zk=Ht({argsMap:t=>[t.getTrackId()]}),qk=Nn(),Xk=Ht({argsMap:t=>[t.getTrackId()]}),Jk=Nn(),Qk=Ht({argsMap:t=>[t.getTrackId()]}),Zk=Nn(),$k=Ht({argsMap:t=>[t.getTrackId()]}),tM=Ht({argsMap:t=>[t.getTrackId()]}),eM=Nn(),Se((Di=class extends vn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),Y(this,"source",void 0),Y(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(da.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(qf.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Ve(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[Hk,Wk],Object.getOwnPropertyDescriptor(Di.prototype,"startProcessAudioBuffer"),Di.prototype),Se(Di.prototype,"pauseProcessAudioBuffer",[Kk,Yk],Object.getOwnPropertyDescriptor(Di.prototype,"pauseProcessAudioBuffer"),Di.prototype),Se(Di.prototype,"seekAudioBuffer",[zk,qk],Object.getOwnPropertyDescriptor(Di.prototype,"seekAudioBuffer"),Di.prototype),Se(Di.prototype,"resumeProcessAudioBuffer",[Xk,Jk],Object.getOwnPropertyDescriptor(Di.prototype,"resumeProcessAudioBuffer"),Di.prototype),Se(Di.prototype,"stopProcessAudioBuffer",[Qk,Zk],Object.getOwnPropertyDescriptor(Di.prototype,"stopProcessAudioBuffer"),Di.prototype),Se(Di.prototype,"close",[$k],Object.getOwnPropertyDescriptor(Di.prototype,"close"),Di.prototype),Se(Di.prototype,"setAudioBufferPlaybackSpeed",[tM,eM],Object.getOwnPropertyDescriptor(Di.prototype,"setAudioBufferPlaybackSpeed"),Di.prototype),Di);class qn extends vn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Zf().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Ye(8,"track-mix-")),Y(this,"trackList",void 0),Y(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(T.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):T.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){T.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}Vv(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof qn?n.emit(oh.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class G5 extends nk{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(da.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Y(this,"audioBuffer",void 0),Y(this,"sourceNode",void 0),Y(this,"startPlayTime",0),Y(this,"startPlayOffset",0),Y(this,"pausePlayTime",0),Y(this,"options",void 0),Y(this,"currentLoopCount",0),Y(this,"currentPlaybackSpeed",100),Y(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const nM=new Map;class zI{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){Y(this,"trackId",void 0),Y(this,"config",void 0),Y(this,"onFirstVideoFrameDecoded",void 0),Y(this,"onVideoStateChanged",void 0),Y(this,"freezeTimeCounterList",[]),Y(this,"renderFreezeAccTime",0),Y(this,"isKeepLastFrame",!1),Y(this,"timeUpdatedCount",0),Y(this,"freezeTime",0),Y(this,"playbackTime",0),Y(this,"lastTimeUpdatedTime",0),Y(this,"autoplayFailed",!1),Y(this,"videoTrack",void 0),Y(this,"videoElement",void 0),Y(this,"cacheVideoElement",void 0),Y(this,"renderStats",void 0),Y(this,"_videoState",tc.VideoStateStopped),Y(this,"videoElementCheckInterval",void 0),Y(this,"videoElementFreezeTimeout",void 0),Y(this,"_videoElementStatus",Qi.NONE),Y(this,"isGettingVideoDimensions",!1),Y(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),Y(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ke.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(iP())),uP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Y(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Qi.PLAYING;break;case"loadeddata":if(this.videoState=tc.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Qi.CANPLAY;break;case"stalled":this.videoElementStatus=Qi.STALLED;break;case"suspend":this.videoElementStatus=Qi.SUSPEND;break;case"pause":this.videoElementStatus=Qi.PAUSED,ir()||hs()||Ii()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Qi.WAITING;break;case"abort":this.videoElementStatus=Qi.ABORT;break;case"ended":this.videoElementStatus=Qi.ENDED;break;case"emptied":this.videoElementStatus=Qi.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Qi.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,$c.lastVisibleTime<$c.lastHiddenTime||s<$c.lastHiddenTime||s<$c.lastVisibleTime)return;for(r>M("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Y(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(iP())),uP()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),ke.on(Si.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.on(Si.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&lk(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),r)});const i=_e();if((i.name==="Safari"&&Number(i.version)===15||Bf())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new St((s,c)=>{i.toBlob(async l=>{if(i.remove(),l){const d=await gk(l);s({buffer:d,width:i.width,height:i.height})}else c(new $(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await YI(e)}destroy(){this.renderStats=void 0,ke.off(Si.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ke.off(Si.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=tc.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Qi.INIT,!this.videoElementCheckInterval&&(iM.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=Qi.DESTROYED)},1e3),M("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let s;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,M("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===tc.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=tc.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(h,p)=>{if(this.videoElementStatus===Qi.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=p.mediaTime):this.renderStats={lastTs:p.mediaTime,curTs:p.mediaTime,lastRenderNum:0,renderNum:0},s){const g=p.presentationTime-s.presentationTime;this.videoState===tc.VideoStateStarting&&(this.videoState=tc.VideoStateDecoding),this.videoState===tc.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,M("VIDEO_FREEZE_DURATION"))),g<M("VIDEO_FREEZE_DURATION")&&this.videoState===tc.VideoStateFrozen&&(this.videoState=tc.VideoStateDecoding),g>M("VIDEO_FREEZE_DURATION")&&$c.lastVisibleTime>=$c.lastHiddenTime&&s.timestamp>$c.lastVisibleTime&&s.timestamp>$c.lastHiddenTime&&(this.renderFreezeAccTime+=g)}s=ln(ln({},p),{},{timestamp:h})}var m,E;M("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(E=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(E,d))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),xv()&&!M("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=_e();i.name==="Safari"&&Number(i.version)===15||Bf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,En()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,En()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(s=>{T.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){iM.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Qi.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{T.error(i)}),this.autoplayFailed=!1,lg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};lg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),ck()}}const iM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class rM extends zI{constructor(e){super(e),Y(this,"container",void 0),Y(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await YI(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",M("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var aM,sM,oM,cM,lM,uM,dM,hM,pM,fM,mM,EM,_M,gM,SM,TM,RM,vM,yM,CM,AM,bM,IM,OM,fe,wM,NM,DM,LM,PM,kM,MM,UM,_a;let nn=(aM=Ht({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),sM=Nn(),oM=Ht({argsMap:t=>[t.getTrackId()]}),cM=Gf("LocalVideoTrack","_enabledMutex"),lM=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),uM=Nn(),dM=Gf("LocalVideoTrack","_enabledMutex"),hM=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),pM=Nn(),fM=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),mM=Nn(),EM=Nn(),_M=Ht({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),gM=Nn(),SM=Nn(),TM=Nn(),RM=Nn(),vM=Nn(),yM=Nn(),CM=Nn(),AM=Ht({argsMap:(t,e)=>[t.getTrackId(),e.name]}),bM=Ht({argsMap:t=>[t.getTrackId()]}),IM=Ht({argsMap:t=>[t.getTrackId()]}),OM=Ht({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),fe=class ZV extends Qf{get videoHeight(){if(Ii()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ii()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,s,c){if(super(e,s),Y(this,"trackMediaType",Jf.VIDEO),Y(this,"_player",void 0),Y(this,"isUseScaleResolutionDownBy",!1),Y(this,"_videoVisibleTimer",null),Y(this,"_previousVideoVisibleStatus",void 0),Y(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Y(this,"_encoderConfig",void 0),Y(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Y(this,"_optimizationMode",void 0),Y(this,"_videoHeight",void 0),Y(this,"_videoWidth",void 0),Y(this,"_forceBitrateLimit",void 0),Y(this,"_enabled",!0),Y(this,"_processorDestination",void 0),Y(this,"_processorContext",void 0),Ii()){const{width:l,height:d}=e.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],this._hints.indexOf(ze.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(uI(Ce.CHROME,115)&&Mv().indexOf("Windows")!==-1){const l=function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&Te().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(d),m=new MediaStreamTrackGenerator({kind:"video"});let E,g,I=Date.now();const y=()=>{C&&(clearInterval(C),C=void 0),E&&(E.close(),E=void 0),d.stop(),g=void 0,m.removeEventListener("ended",y)};let C=window.setInterval(()=>{if(g&&E&&Date.now()-I>1e3)try{m.readyState==="live"?g.enqueue(E.clone()):y()}catch{y()}},1e3);const N=new TransformStream({transform:(D,V)=>{m.readyState==="live"?(g=V,I=Date.now(),E===void 0?(E=D,V.enqueue(D.clone())):(V.enqueue(E),E=D)):D.close()}});return m.addEventListener("ended",y),p.readable.pipeThrough(N).pipeTo(m.writable),m}}(e);l&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(ze.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new dk(this.getTrackId(),"local"),this._processorDestination=new uk(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=ln(ln(ln({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new zI(i):this._player=new rM(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(qf.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Ke(this,Nt.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ke(this,Nt.NEED_MUTE_TRACK,this):await Ke(this,Nt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=$o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=Qv({encoderConfig:e});(Ii()||ir()||hs())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const s=new $(L.UNEXPECTED_ERROR,r.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ke(this,Nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(T)}}getStats(){return Eu(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},BI)}async setBeautyEffect(e){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await YI(e)}async setBitrateLimit(e){T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void T.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Ke(this,Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return T.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){fk(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(Fv)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=$o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ke(this,Nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:s}=this._encoderConfig;if(s==null||r==null){const{max:c,min:l}=function(d,h,p,m,E){const g=M("BITRATE_ADAPTER_TYPE");if(g==="DEFAULT_BITRATE")return{min:m,max:E};if(E===void 0){var I;const C=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*h/640/360,.75));E=g==="STANDARD_BITRATE"?4*C:2*C,m=(I=m)!==null&&I!==void 0?I:C}else{var y;m=(y=m)!==null&&y!==void 0?y:Math.floor(E/10)}return{min:m,max:E}}(e,n,i,s,r);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:s,slot:c}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=mP.checkOneElementVisible(s),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const h=Mt.reportApiInvoke(null,{tag:gn.TRACER,name:Gn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(i){throw new $(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ln(ln({},i),$o(e))),i=ih(i);const r=Ye(8,"track-video-cloned-"),s=new ZV(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,ih(this._scalabilityMode),this._optimizationMode,r,ih(this._hints));return e&&i&&s.setEncoderConfiguration(i),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new $(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new $(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Eu(()=>{Mt.reportApiInvoke(null,{name:Gn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:gn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!M("ENABLE_VIDEO_SEI")||!M("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new $(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):T.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(rr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ke(this,Nt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(rr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ha.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ha.REQUEST_CONSTRAINTS)}},Se(fe.prototype,"play",[aM,sM],Object.getOwnPropertyDescriptor(fe.prototype,"play"),fe.prototype),Se(fe.prototype,"stop",[oM],Object.getOwnPropertyDescriptor(fe.prototype,"stop"),fe.prototype),Se(fe.prototype,"setEnabled",[cM,lM,uM],Object.getOwnPropertyDescriptor(fe.prototype,"setEnabled"),fe.prototype),Se(fe.prototype,"setMuted",[dM,hM,pM],Object.getOwnPropertyDescriptor(fe.prototype,"setMuted"),fe.prototype),Se(fe.prototype,"setEncoderConfiguration",[fM,mM],Object.getOwnPropertyDescriptor(fe.prototype,"setEncoderConfiguration"),fe.prototype),Se(fe.prototype,"getStats",[EM],Object.getOwnPropertyDescriptor(fe.prototype,"getStats"),fe.prototype),Se(fe.prototype,"setBeautyEffect",[_M,gM],Object.getOwnPropertyDescriptor(fe.prototype,"setBeautyEffect"),fe.prototype),Se(fe.prototype,"getCurrentFrameData",[SM],Object.getOwnPropertyDescriptor(fe.prototype,"getCurrentFrameData"),fe.prototype),Se(fe.prototype,"getCurrentFrameImage",[TM],Object.getOwnPropertyDescriptor(fe.prototype,"getCurrentFrameImage"),fe.prototype),Se(fe.prototype,"setBitrateLimit",[RM],Object.getOwnPropertyDescriptor(fe.prototype,"setBitrateLimit"),fe.prototype),Se(fe.prototype,"setOptimizationMode",[vM],Object.getOwnPropertyDescriptor(fe.prototype,"setOptimizationMode"),fe.prototype),Se(fe.prototype,"setScalabiltyMode",[yM],Object.getOwnPropertyDescriptor(fe.prototype,"setScalabiltyMode"),fe.prototype),Se(fe.prototype,"updateMediaStreamTrackResolution",[CM],Object.getOwnPropertyDescriptor(fe.prototype,"updateMediaStreamTrackResolution"),fe.prototype),Se(fe.prototype,"pipe",[AM],Object.getOwnPropertyDescriptor(fe.prototype,"pipe"),fe.prototype),Se(fe.prototype,"unpipe",[bM],Object.getOwnPropertyDescriptor(fe.prototype,"unpipe"),fe.prototype),Se(fe.prototype,"close",[IM],Object.getOwnPropertyDescriptor(fe.prototype,"close"),fe.prototype),Se(fe.prototype,"replaceTrack",[OM],Object.getOwnPropertyDescriptor(fe.prototype,"replaceTrack"),fe.prototype),fe),qI=(wM=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),NM=Nn(),DM=Gf("CameraVideoTrack","_enabledMutex"),LM=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),PM=Nn(),kM=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),MM=Nn(),UM=Ht({argsMap:t=>[t.getTrackId()]}),_a=class $V extends nn{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,s,c){super(e,$o(n.encoderConfig),r,s,c),Y(this,"_config",void 0),Y(this,"_originalConstraints",void 0),Y(this,"_constraints",void 0),Y(this,"_enabled",!0),Y(this,"_deviceName","default"),Y(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Bf()||pI())&&!function(){const l=_e();if(l.os!==ei.IOS||!l.osVersion)return!1;const d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&dP()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=$o(this._config.encoderConfig),ke.on(Si.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ke.on(Si.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await ma.getDeviceById(e),i={};i.video=ln({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await fa(i,this.getTrackId())}catch(s){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await ma.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:ln(ln({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await fa(n,this.getTrackId())}catch(r){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await fa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=ln({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await fa({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Ke(this,Nt.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Ke(this,Nt.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new $(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=$o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=Sn(this._config);i.encoderConfig=e;const r=Qv(i);(Ii()||ir()||hs())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){const c=new $(L.UNEXPECTED_ERROR,s.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(ze.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ke(this,Nt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(T)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ir()||hs())&&this._enabled&&!this._isClosed&&ke.duringInterruption){const e=async()=>{ke.off(Si.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ke.on(Si.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(qf.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=ma.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await fa({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ke.off(Si.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ke.off(Si.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=ln(ln({},i),$o(e))),i=ih(i);const r=Ye(8,"track-cam-cloned-"),s=new $V(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,ih(ln(ln({},this._config),{},{encoderConfig:i})),ih(this._constraints),ih(this._scalabilityMode),this._optimizationMode,r);return e&&i&&s.setEncoderConfiguration(i),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(ha.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(ha.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Se(_a.prototype,"setDevice",[wM,NM],Object.getOwnPropertyDescriptor(_a.prototype,"setDevice"),_a.prototype),Se(_a.prototype,"setEnabled",[DM,LM,PM],Object.getOwnPropertyDescriptor(_a.prototype,"setEnabled"),_a.prototype),Se(_a.prototype,"setEncoderConfiguration",[kM,MM],Object.getOwnPropertyDescriptor(_a.prototype,"setEncoderConfiguration"),_a.prototype),Se(_a.prototype,"close",[UM],Object.getOwnPropertyDescriptor(_a.prototype,"close"),_a.prototype),_a);function XI(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=ln(ln({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?T.debug("[".concat(t,"] set content hint to"),n.optimizationMode):T.debug("[".concat(t,"] set content hint failed")))):T.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var xM,VM,BM,FM,Va,jM,GM,HM,WM,KM,YM,Zi;class zM extends $P{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(Ye(5,""))),Y(this,"_userId",void 0),Y(this,"_uintId",void 0),Y(this,"_isDestroyed",!1),Y(this,"store",void 0),Y(this,"processor",void 0),Y(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let tm=(xM=Ht({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),VM=Ht({argsMap:t=>[t.getTrackId()]}),BM=Ht({argsMap:(t,e)=>[t.getTrackId(),e.name]}),FM=Ht({argsMap:t=>[t.getTrackId()]}),Se((Va=class extends zM{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Qi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),Y(this,"_videoVisibleTimer",null),Y(this,"_previousVideoVisibleStatus",void 0),Y(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Y(this,"trackMediaType",Jf.VIDEO),Y(this,"_videoWidth",void 0),Y(this,"_videoHeight",void 0),Y(this,"_player",void 0),Y(this,"processorDestination",void 0),Y(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new dk(this.getTrackId(),"remote"),this.processorDestination=new uk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Eu(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},QP)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=ln(ln({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new zI(n):this._player=new rM(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Xf.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(Xf.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Xf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){fk(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(Fv)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const c=mP.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const d=Mt.reportApiInvoke(null,{tag:gn.TRACER,name:Gn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new $(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(rr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(rr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(oh.SEI_RECEIVED,t)}}).prototype,"play",[xM],Object.getOwnPropertyDescriptor(Va.prototype,"play"),Va.prototype),Se(Va.prototype,"stop",[VM],Object.getOwnPropertyDescriptor(Va.prototype,"stop"),Va.prototype),Se(Va.prototype,"pipe",[BM],Object.getOwnPropertyDescriptor(Va.prototype,"pipe"),Va.prototype),Se(Va.prototype,"unpipe",[FM],Object.getOwnPropertyDescriptor(Va.prototype,"unpipe"),Va.prototype),Va),em=(jM=Ht({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),GM=Ht({argsMap:(t,e)=>[t.getTrackId(),e]}),HM=Ht({argsMap:t=>[t.getTrackId()]}),WM=Ht({argsMap:t=>[t.getTrackId()]}),KM=Ht({argsMap:(t,e)=>[t.getTrackId(),e.name]}),YM=Ht({argsMap:t=>[t.getTrackId()]}),Se((Zi=class extends zM{get isPlaying(){return this._useAudioElement?_r.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),Y(this,"trackMediaType",Jf.AUDIO),Y(this,"_source",void 0),Y(this,"_useAudioElement",!0),Y(this,"_volume",100),Y(this,"processorContext",void 0),Y(this,"processorDestination",void 0),Y(this,"_played",!1),Y(this,"_bypassWebAudio",!1),M("DISABLE_WEBAUDIO")?(this._source=new KI,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ik(t,!0),M("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(da.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Xf.FIRST_FRAME_DECODED)}),this.processorContext=new pk(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new hk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(da.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(da.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(da.ON_AUDIO_BUFFER),this._source.on(da.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?_r.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!zP())throw new $(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await _r.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Eu(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ca(this,Nt.GET_STATS)||ln({},JP)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),_r.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?_r.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&_r.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new $(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(rr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(rr.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(rr.ON_TRACK),this.processorDestination.removeAllListeners(rr.ON_NODE)}}).prototype,"setVolume",[jM],Object.getOwnPropertyDescriptor(Zi.prototype,"setVolume"),Zi.prototype),Se(Zi.prototype,"setPlaybackDevice",[GM],Object.getOwnPropertyDescriptor(Zi.prototype,"setPlaybackDevice"),Zi.prototype),Se(Zi.prototype,"play",[HM],Object.getOwnPropertyDescriptor(Zi.prototype,"play"),Zi.prototype),Se(Zi.prototype,"stop",[WM],Object.getOwnPropertyDescriptor(Zi.prototype,"stop"),Zi.prototype),Se(Zi.prototype,"pipe",[KM],Object.getOwnPropertyDescriptor(Zi.prototype,"pipe"),Zi.prototype),Se(Zi.prototype,"unpipe",[YM],Object.getOwnPropertyDescriptor(Zi.prototype,"unpipe"),Zi.prototype),Zi);const $c=new class extends hn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Y(this,"_lastHiddenTime",0),Y(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class qM extends hn{constructor(e,n){super(),Y(this,"trackMediaType",Jf.DATA),Y(this,"_version",1),Y(this,"_type",3),Y(this,"_config",void 0),Y(this,"_originDataChannel",void 0),Y(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Y(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),Y(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return M("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new St((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new $(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new $(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new $(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Xv.OPEN,Xv.CLOSE,Xv.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class H5 extends qM{constructor(e){super(e),Y(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(M("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(Xv.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class W5 extends qM{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function $v(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>$R.revokeObjectURL(t),0),new Worker($R.createObjectURL(t))}const XM=71,JI=1,QI=2,ZI=1,JM=2;var tl=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(tl||{});function QM(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==XM)return;const i=t.getUint16(1),r=JI+QI+i,s=new Uint8Array(t.byteLength-r);s.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:s};let l=JI+QI;for(;l<r;){const d=t.getUint8(l),h=t.getUint16(l+ZI),p=ZI+JM;if(d===tl.AUDIO_LEVEL){let m=t.getUint8(l+p);for(let E=1;E<h;E++)m=m<<8|t.getUint8(l+p+E);c.tlv.push({tag:d,length:h,value:e?127^m>>1:127&m})}else if(d===tl.METADATA||d===tl.AUDIO_64_BIT_PTS){const m=new Uint8Array(h);for(let E=0;E<h;E++)m[E]=t.getUint8(l+p+E);c.tlv.push({tag:d,length:h,value:m})}l+=p+h}return c}const ty=new Map,ey=127,uh=1e-10,$I=139/13,ny=new Map;function tO(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return ny.has(i)?r=ny.get(i):(r=Math.log(function(c,l){const d=c-l;l<d&&(l=d);let h=1;for(let p=c,m=1;p>l;p--,m++)h=h*p/m;return h}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,ny.set(i,r)),r<uh&&(r=uh),r}function ZM(t,e,n){const i=e.length,r=t.length/i;let s=!1;for(let c=0,l=0;c<i;c++){let d=0;for(let h=l+r;l<h;l++)t[l]>n&&d++;e[c]!==d&&(e[c]=d,s=!0)}return s}window.cache=ny;let K5=0;class $M{constructor(e){Y(this,"id",void 0),Y(this,"immediates",[]),Y(this,"lastNonSilence",-1),Y(this,"immediateSpeechActivityScore",uh),Y(this,"lastLevelChangedTime",Date.now()),Y(this,"levels",[]),Y(this,"longs",[]),Y(this,"longSpeechActivityScore",uh),Y(this,"mediums",[]),Y(this,"mediumSpeechActivityScore",uh),Y(this,"minLevel",0),Y(this,"nextMinLevel",0),Y(this,"nextMinLevelWindowLength",0),Y(this,"energyScore",0),this.id=e||"".concat(K5++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+$I;let r=!1;for(let s=0;s<e.length;++s){let c=n[s];c<i&&(c=0);const l=Math.floor(c/$I);e[s]!==l&&(e[s]=l,r=!0)}return r}computeLongs(){return ZM(this.mediums,this.longs,4)}computeMediums(){return ZM(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=tO(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=tO(this.longs[0],10,47),this.longSpeechActivityScore>uh&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=tO(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(id(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>ey&&(i=ey),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+$I?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>ey&&(n=ey),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Y5{constructor(e){Y(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class eO{constructor(e,n,i){Y(this,"isDominant",void 0),Y(this,"energyRanking",void 0),Y(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class z5 extends hn{constructor(e){super(),Y(this,"dominantId",null),Y(this,"lastDecisionTime",0),Y(this,"lastLevelChangedTime",0),Y(this,"lastLevelIdleTime",0),Y(this,"relativeSpeechActivities",[]),Y(this,"speakers",new Map),Y(this,"enableSilence",!1),Y(this,"timeoutToSilenceInterval",0),Y(this,"decisionMaker",null),Y(this,"loudest",[]),Y(this,"numLoudestToTrack",3),Y(this,"energyExpireTimeMs",250),Y(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const s=r.levelChanged(n,i);return this.updateLoudestList(r,s,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new $M(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new eO(r,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new eO(r,0,e.energyScore);const s=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const d=this.loudest[c];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new eO(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Y5(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let s=null;if(r===0)s=null;else if(r===1){var c;const l=Lr(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(s=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],l=p.value[1])}else s=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const d=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[m,E]=p;if(E===l)continue;E.evaluateSpeechActivityScores(e);for(let C=0;C<d.length;++C){const N=l==null?uh:l.getSpeechActivityScore(C);d[C]=Math.log(E.getSpeechActivityScore(C)/N)}const g=d[0],I=d[1],y=d[2];g>3&&I>2&&y>0&&I>h&&(h=I,s=m)}this.enableSilence&&l!=null&&s===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of Lr(i=this.speakers).call(i)){var i;const s=e-r.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<s&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const nm=new Map;let no=null,iy=null;const t1=3;let dh=[];const io=new Map,ry=new Map;class q5{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){Y(this,"id",void 0),Y(this,"track",void 0),Y(this,"score",0),Y(this,"active",!0),Y(this,"muted",!1),Y(this,"timer",0),Y(this,"actives",0),Y(this,"inactives",0),this.id=e,this.track=n,this.setActive(io.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],s=[];return Array.from(Lr(io).call(io)).forEach(c=>{c.active?r.push(c):s.push(c)}),{actives:r,inactives:s}}();if(n.length>3){let r;n.forEach(s=>{(!r||r.score>s.score)&&(r=s)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(s=>{(!r||r.score<s.score)&&s.id!==this.id&&(r=s)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(Lr(io).call(io)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(Lr(io).call(io)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let ay;function e1(t){const e=io.get(t);e&&(io.delete(t),e.clearTimer())}const sy=new Map,X5=new Map;function J5(t,e,n){let i=new Uint8Array(t,e,n),r=[],s=0;for(;r.length<n;)s+3<n&&i[s]===0&&i[s+1]===0&&i[s+2]===3&&(i[s+3]===0||i[s+3]===1||i[s+3]===2||i[s+3]===3)?(r.push(i[s],i[s+1],i[s+3]),s+=4):(r.push(i[s]),s++);return new Uint8Array(r)}const oy=new Map,Sg=new Map;(function(){const t=_e();gi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gi.getStreamFromExtension=t.name===Ce.CHROME&&Number(t.version)>34,gi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),gi.supportMinBitrate=t.name===Ce.CHROME||t.name===Ce.EDGE,gi.supportSetRtpSenderParameters=function(){const e=_e();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Jc()||!(!Ii()&&!Uv())||e.name===Ce.FIREFOX&&Number(e.version)>=64)}(),t.name===Ce.SAFARI&&(Number(t.version)>=14?gi.supportDualStream=!0:gi.supportDualStream=!1),gi.webAudioMediaStreamDest=function(){const e=_e();return!(e.name===Ce.SAFARI&&Number(e.version)<12)}(),gi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",gi.supportWebGL=typeof WebGLRenderingContext<"u",gi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Jc()||(gi.webAudioWithAEC=!0),gi.supportShareAudio=function(){const e=_e();return(e.os===ei.WIN_10||e.os===ei.WIN_81||e.os===ei.WIN_7||e.os===ei.LINUX||e.os===ei.MAC_OS||e.os===ei.CHROMIUM_OS)&&e.name===Ce.CHROME&&Number(e.version)>=74}(),gi.supportDataChannel=!!(cg(76)||function(e){const n=_e();return!(n.name!==Ce.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||sP(14)),gi.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!En()&&!!e&&e.prototype.setConfiguration instanceof Function}(),gi.supportWebRTCEncodedTransform=function(){const e=_e();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),gi.supportWebRTCInsertableStream=function(){const e=_e();return(e.name===Ce.CHROME||e.name===Ce.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Bv(()=>{gi.supportDualStreamEncoding=function(){const e=_e();return!!M("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&M("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",t),T.info("browser compatibility: ",gi)})})();const Q5=["CHINA","GLOBAL"],n1=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],hh=[],im=[];function ph(t,e){return!!e&&hh.some(n=>n.uid===t&&n.channelName===e)}function nO(){return im.length>0}var Z5=CD.forEach,i1=fr("forEach")?[].forEach:function(t){return Z5(this,t,arguments.length>1?arguments[1]:void 0)};De({target:"Array",proto:!0,forced:[].forEach!=i1},{forEach:i1});var $5=hr("Array").forEach,tH=Ra,eH=pi,nH=mt,iH=$5,iO=Array.prototype,rH={DOMTokenList:!0,NodeList:!0},aH=function(t){var e=t.forEach;return t===iO||nH(iO,t)&&e===iO.forEach||eH(rH,tH(t))?iH:e},sH=P(aH),oH=za,r1=cd;De({target:"Object",stat:!0,forced:x(function(){r1(1)})},{keys:function(t){return r1(oH(t))}});var a1=P(Wr.Object.keys),cH=P(td),lH=P(nd),uH=De,s1=Yi,dH=zl,hH=Wi,o1=Xh,pH=Is,fH=po,mH=Pa,EH=dn,_H=bd,gH=fD("slice"),SH=EH("species"),rO=Array,TH=Math.max;uH({target:"Array",proto:!0,forced:!gH},{slice:function(t,e){var n,i,r,s=fH(this),c=pH(s),l=o1(t,c),d=o1(e===void 0?c:e,c);if(s1(s)&&(n=s.constructor,(dH(n)&&(n===rO||s1(n.prototype))||hH(n)&&(n=n[SH])===null)&&(n=void 0),n===rO||n===void 0))return _H(s,l,d);for(i=new(n===void 0?rO:n)(TH(d-l,0)),r=0;l<d;l++,r++)l in s&&mH(i,r,s[l]);return i.length=r,i}});var RH=hr("Array").slice,vH=mt,yH=RH,aO=Array.prototype,CH=function(t){var e=t.slice;return t===aO||vH(aO,t)&&e===aO.slice?yH:e},AH=P(CH);function Lt(t,e,n,i,r){var s,c,l,d={};return sH(s=a1(i)).call(s,function(h){d[h]=i[h]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=cH(c=lH(l=AH(n).call(n)).call(l)).call(c,function(h,p){return p(t,e,h)||h},d),r&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(r):void 0,d.initializer=void 0),d.initializer===void 0&&(uD(t,e,d),d=null),d}let cy=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),sO=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ms=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),ar=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),jt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Xe=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),zt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Kt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),Tg=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),ce=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),sr=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),$t=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function ly(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw T.error("Invalid Channel Name ".concat(t)),new z(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function uy(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||fP(t,1,255)))throw new z(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let el=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const bH={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},oO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function cO(t,e){Ei(t.url,"".concat(e,".url"),1,1e3,!1),_n(t.x)||Ve(t.x,"".concat(e,".x"),0,1e4),_n(t.y)||Ve(t.y,"".concat(e,".y"),0,1e4),_n(t.width)||Ve(t.width,"".concat(e,".width"),0,1e4),_n(t.height)||Ve(t.height,"".concat(e,".height"),0,1e4),_n(t.zOrder)||Ve(t.zOrder,"".concat(e,".zOrder"),0,255),_n(t.alpha)||Ve(t.alpha,"".concat(e,".alpha"),0,1,!1)}const IH={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Su=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),lO=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Xn=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function c1(t){if(!t.channelName)throw new z(L.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new z(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ei(t.token,"info.token",1,2047),uy(t.uid),ly(t.channelName),!0}let or=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),nl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ur=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),rm=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),we=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),li=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),dy=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),ii=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Ae=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const l1=[Ae.AFRICA,Ae.ASIA,Ae.CHINA,Ae.EUROPE,Ae.GLOBAL,Ae.INDIA,Ae.JAPAN,Ae.NORTH_AMERICA,Ae.OCEANIA,Ae.OVERSEA,Ae.SOUTH_AMERICA];let xi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const hy={CHINA:{},ASIA:{CODE:xi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:xi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:xi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:xi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:xi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:xi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:xi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:xi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:xi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:xi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:xi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:xi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:xi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};NI&&(hy.CHINA={CODE:xi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Rg=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function u1(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class d1 extends hn{constructor(e,n){super(),O(this,"onICEConnectionStateChange",void 0),O(this,"onConnectionStateChange",void 0),O(this,"onDTLSTransportStateChange",void 0),O(this,"onDTLSTransportError",void 0),O(this,"onICETransportStateChange",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoReceived",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"onICECandidateError",void 0),O(this,"getLocalVideoStats",void 0)}}class h1 extends d1{constructor(e,n){super(e,n),O(this,"establishPromise",void 0)}}let It=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Vi=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),il=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const p1=["disconnected","failed"];let ot=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Oe=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Bt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Es=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),_s=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ui=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),f1=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),nc=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Ba=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),ro=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),am=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Dn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),sm=function(t){return t.ABORT="abort",t}({}),Tu=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),OH=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const wH={[cy.ACCESS_POINT]:{[ar.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ar.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ar.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ar.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ar.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ar.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ar.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[cy.UNILBS]:{[ms.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ms.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ms.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ms.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ms.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ms.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ms.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ms.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ms.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ms.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ms.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ms.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[cy.STRING_UID_ALLOCATOR]:{[sO.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[sO.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[sO.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function om(t){const e=wH[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===cy.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const NH={[jt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[jt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[jt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[jt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[jt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[jt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[jt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[jt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[jt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[jt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[jt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[jt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[jt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[jt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[jt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[jt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[jt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[jt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[jt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[jt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[jt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[jt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[jt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[jt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[jt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[jt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[jt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[jt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[jt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[jt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[jt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[jt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[jt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[jt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[jt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[jt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[jt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[jt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[jt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[jt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[jt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[jt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[jt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[jt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[jt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[jt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[jt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[jt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[jt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[jt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[jt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[jt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[jt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[jt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[jt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[jt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[jt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[jt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[jt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[jt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function vg(t){return NH[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function m1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function uO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?m1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function E1(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const s=M("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(s,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const DH=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,LH=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,PH=/wss:\/\/(.+):([0-9]+)\/?/,kH=/wss:\/\/(.[^\/]+)\/?/;let MH=0;class UH{constructor(e,n){O(this,"id",0),O(this,"store",void 0),O(this,"recordIndex",void 0),O(this,"websockets",[]),O(this,"try443PortDuration",2e3),O(this,"forceCloseWSDuration",5e3),O(this,"try443PortTimeout",null),O(this,"forceCloseTimeout",null),O(this,"isTry443PortFailed",!1),O(this,"isNormalPortFailed",!1),O(this,"useDoubleDomain",!1),O(this,"useProxy",!1),O(this,"startTime",Date.now()),this.id=++MH,this.try443PortDuration=M("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];T.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=M("GATEWAY_DOMAINS"),s=Date.now(),c=[],l=r.find(E=>{var g;return Et(g=e.host).call(g,E)});l||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)r.forEach(E=>{d.push(E1(uO(uO({},e),{},{host:e.host.replace(l,E)}),n))});else{const E=uO({},e);if(n&&l){const g=r.find(I=>I!==l);g&&(E.host=E.host.replace(l,g))}d.push(E1(E,n))}try{d.forEach(E=>{const g=new WebSocket(E);g.binaryType="arraybuffer",c.push(g),this.logger("ws is connecting:",g.url)})}catch(E){if(this.logger("ws create failed"),c.forEach(g=>g.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new z(L.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const h=og();this.store&&this.store.recordJoinChannelService({urls:c.map(E=>E.url),service:"gateway"},this.recordIndex),c.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(g=>{g!==E&&(g.onopen=null,g.onclose=null,g.onmessage=null,g.close(),this.logger("close backup websocket: ".concat(g.url)))}),this.websockets.length=0,h.resolve(E)},E.onclose=g=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(E.readyState));const I=c.every(y=>y.readyState===WebSocket.CLOSED||y.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(I)),I&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(g.reason)),h.reject({code:g.code,reason:dy.A_ROUND_WS_FAILED})):!n&&I&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),m()),n?this.isTry443PortFailed=I:this.isNormalPortFailed=I},E.onmessage=g=>this.logger("".concat(E.url," onmessage: ").concat(g.data))}),this.websockets.push(...c);const p=()=>{this.websockets.forEach(E=>E.readyState!==WebSocket.OPEN&&E.close())},m=()=>{if(h.isResolved)return p();_e().os===ei.MAC_OS&&En()&&p(),this.createWebSocket(e,!0,!0).then(E=>{h.resolve(E)}).catch(E=>{this.isNormalPortFailed&&h.reject(E),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,m()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(s){let c,l,d;return[,c,l,d]=s.match(DH)||[],c||([,l,d]=s.match(LH)||[]),l&&d||([,l,d]=s.match(PH)||[]),l&&d||([,l]=s.match(kH)||[]),l||T.warning("un-destructible url: ",s),{proxy:c,host:l,port:d||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function _1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class g1 extends hn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;Et(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit($t.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit($t.CONNECTED):this._state==="closed"?this.emit($t.CLOSED):this._state==="failed"&&this.emit($t.FAILED))}resetReconnectCount(e){T.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"urls",[]),O(this,"_reconnectMode","tryNext"),O(this,"reconnectReason",void 0),O(this,"_initMutex",void 0),O(this,"name",void 0),O(this,"_state","closed"),O(this,"reconnectInterrupter",void 0),O(this,"websocket",void 0),O(this,"retryConfig",void 0),O(this,"reconnectCount",0),O(this,"forceCloseTimeout",5e3),O(this,"onlineReconnectListener",void 0),O(this,"useCompress",void 0),O(this,"tryDoubleDomain",!1),O(this,"use443PortOnly",!1),O(this,"wsInflateLength",0),O(this,"wsDeflateLength",0),O(this,"closeEstablishingWs",()=>{}),O(this,"store",void 0),O(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(m){for(var E=1;E<arguments.length;E++){var g=arguments[E]!=null?arguments[E]:{};E%2?_1(Object(g),!0).forEach(function(I){O(m,I,g[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(g)):_1(Object(g)).forEach(function(I){Object.defineProperty(m,I,Object.getOwnPropertyDescriptor(g,I))})}return m}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=s,this._initMutex=new Ui("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:d}=n,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*d)/10);Zr.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),xn.on(Ff.NETWORK_STATE_CHANGE,(m,E)=>{m!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(m)),m===Zr.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=og(),s=this.urls[this.currentURLIndex];M("ENABLE_PREALLOC_PC")&&this.emit(f1.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(r.resolve).catch(r.reject),this.once($t.CLOSED,()=>{r.reject(new $(L.WS_DISCONNECT))}),this.once($t.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new $(L.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new $(L.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=og();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=p=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},s=async p=>{var m;if(T.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new $(L.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const E=ca(this,$t.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,g=await this.reconnectWithAction(E);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!g)return i.reject(new $(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);i.resolve()}},c=p=>{this.emit($t.ON_MESSAGE,p)},l=p=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),M("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=M("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),e);const d=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;const p=await this.chooseBestWebsocketConnection(e);this.websocket=p,r&&r(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){const m=this.state==="closed",E=p instanceof $,g=E&&p.code===L.WS_ABORT,I=E&&p.code===L.WS_ERR,y=E?p.message:p&&(p.reason||p.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(y)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:g?"aborted":"error",errors:[p]},d),m||I?(i.reject(m?new $(L.WS_DISCONNECT,"websocket is closed: ".concat(y)):new $(L.WS_ERR,"init websocket failed: ".concat(y))),I&&T.error("[".concat(this.name,"] init websocket failed: ").concat(y))):s&&s(p)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||xn.isOnline||!xn.onlineWaiter||(this.onlineReconnectListener=xn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=vI(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await St.race([_i(c),this.onlineReconnectListener||new St(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit($t.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await wi(this,$t.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var s;T.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(s=c.data)===null||s===void 0?void 0:s.desc;return Array.isArray(l)&&Et(l).call(l,"dynamic key expired")?(this.emit($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class dO extends g1{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=og(),r=function(c,l){return new UH(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new $(L.WS_ABORT,"choose best websocket aborted"))};const s=M("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class yg extends g1{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new St((i,r)=>{let s=!1;const c=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),c.forEach(I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()}),r(new $(L.WS_ABORT,"choose best websocket aborted"))};const l=M("GATEWAY_DOMAINS");let d;const h=e.indexOf("?h="),p=l.find(I=>h!==-1?Et(e).call(e,I,h):Et(e).call(e,I));T.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let m=!this.tryDoubleDomain||!p;if(!m&&p){var E;const I=Date.now();try{l.forEach(y=>{const C=h===-1?e.replace(p,y):e.substr(0,h)+e.substr(h).replace(p,y),N=new WebSocket(C);N.binaryType="arraybuffer",c.push(N),T.debug("[choose-best-ws] ws is connecting:",N.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(C=>C.close());c.length;)c.pop();m=!0}(E=this.store)===null||E===void 0||E.recordJoinChannelService({urls:c.map(y=>y.url),service:"gateway"},n),c.forEach(y=>{y.onopen=()=>{if(s)return;const C=Date.now()-I;T.debug("[choose-best-ws] ws open cost ".concat(C,"ms")),c.filter(N=>N!==y).forEach(N=>{T.debug("[choose-best-ws]close backup websocket: ".concat(N.url)),N.close()}),s=!0,i(y)},y.onclose=C=>{d=C,!s&&(c.find(N=>!(N.readyState===WebSocket.CLOSED||N.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),s=!0,r(d)))},y.onmessage=C=>{T.debug("[choose-best-ws]".concat(y.url," onmessage: ").concat(C.data))}}),_i(this.forceCloseTimeout).then(()=>{c.forEach(y=>{y.readyState!==WebSocket.OPEN&&y.close()})})}if(m){var g;let I;T.debug("[choose-best-ws] use single url: ",e),(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:[e],service:"gateway"},n);try{I=new WebSocket(e),c.push(I),I.binaryType="arraybuffer"}catch(y){const C=new $(L.WS_ERR,"init websocket failed! Error: ".concat(y.toString()));return T.error("[".concat(this.name,"]").concat(C)),void r(C)}I.onopen=()=>{i(I)},I.onclose=y=>{r(y)},I.onmessage=y=>{T.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(y.data))},_i(this.forceCloseTimeout).then(()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class xH extends hn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Xe.CONNECTED?this.emit(zt.WS_CONNECTED):e===Xe.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):e===Xe.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Xe.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new NP(5)),O(this,"pingpongTimer",void 0),O(this,"wsInflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===ce.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===ce.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Ie.UID_BANNED);break;case 15:this.close(Ie.IP_BANNED);break;case 16:this.close(Ie.CHANNEL_BANNED)}if(r._type===ce.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Ie.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Ie.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ie.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Ie.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ie.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Ie.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new dO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Xe.CONNECTED&&this.reconnect("retry",Oi.OFFLINE)})}async request(e,n,i,r){const s=Ye(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new St((I,y)=>{if(this.connectionState===Xe.CONNECTED)return I();const C=()=>{this.off(zt.WS_CLOSED,N),I()},N=()=>{this.off(zt.WS_CONNECTED,C),y(new z(L.WS_ABORT))};this.once(zt.WS_CONNECTED,C),this.once(zt.WS_CLOSED,N),e!==Kt.PUBLISH&&e!==Kt.PUBLISH_DATASTREAM&&e!==Kt.SUBSCRIBE&&e!==Kt.SUBSCRIBE_DATASTREAM&&e!==Kt.UNSUBSCRIBE&&e!==Kt.UNSUBSCRIBE_DATASTREAM&&e!==Kt.UNPUBLISH&&e!==Kt.UNPUBLISH_DATASTREAM&&e!==Kt.CONTROL&&e!==Kt.RESTART_ICE||this.once(zt.DISCONNECT_P2P,()=>{y(new z(L.DISCONNECT_P2P))}),e!==Kt.PUBLISH&&e!==Kt.RESTART_ICE||this.once(zt.ABORT_P2P_EXECUTION,()=>{y(new z(L.DISCONNECT_P2P))})});if(this.connectionState!==Xe.CONNECTING&&this.connectionState!==Xe.RECONNECTING||e===Kt.JOIN||e===Kt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new St((I,y)=>{let C=!1;const N=(V,W)=>{C=!0,I({isSuccess:V==="success",message:W||{}}),this.off(zt.WS_CLOSED,D),this.off(zt.WS_RECONNECTING,D),this.emit(zt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),N);const D=()=>{y(new z(L.WS_ABORT,"type: ".concat(e))),this.off(zt.WS_CLOSED,D),this.off(zt.WS_RECONNECTING,D),this.off("res-@".concat(s),N)};this.once(zt.WS_CLOSED,D),this.once(zt.WS_RECONNECTING,D),_i(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||C||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(zt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(I){if(this.connectionState===Xe.CLOSED||e===Kt.LEAVE)throw new z(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():e===Kt.JOIN||e===Kt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),E=vg(m),g=new z(L.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:E.desc});return E.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===jt.ERR_TOO_MANY_BROADCASTERS?((e===Kt.JOIN||e===Kt.REJOIN)&&(this.initError=g,this.close()),g.throw()):E.action==="failed"?g.throw():E.action==="quit"?(this.initError=g,this.close(),g.throw()):(m===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Oi.MULTI_IP)):this.reconnect(E.action,Oi.SERVER_ERROR),e===Kt.JOIN||e===Kt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new St(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Tg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Xe.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new St((n,i)=>{this.once(zt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(zt.WS_CLOSED,r=>i(this.initError||new z(L.WS_ABORT,r))),this.connectionState=Xe.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Ie.LEAVE,this.connectionState=Xe.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const e=await wi(this,zt.REQUEST_JOIN_INFO),n=await this.request(Kt.JOIN,e);if(!n)return this.emit(zt.REPORT_JOIN_GATEWAY,dy.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Xe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new z(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=pg(this,zt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(Kt.REJOIN,e);return!!n&&(this.connectionState=Xe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(ce.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(ce.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(ce.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(ce.MUTE_AUDIO,{uid:i.uid}):this.emit(ce.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(ce.MUTE_VIDEO,{uid:i.uid}):this.emit(ce.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(ce.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(ce.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(ce.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(ce.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(ce.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=vg(e.code);if(e.code===28&&"detail"in e&&(T.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(zt.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ie.UID_BANNED),void this.close()):void this.reconnect(n.action,Oi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Oi.TIMEOUT):this.request(Kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),M("REPORT_STATS")&&this.send(Kt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Tg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on($t.RECONNECT_CREATE_CONNECTION,e=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on($t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on($t.CLOSED,()=>{this.connectionState=Xe.CLOSED}),this.websocket.on($t.FAILED,()=>{this._disconnectedReason=Ie.NETWORK_ERROR,this.connectionState=Xe.CLOSED}),this.websocket.on($t.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Xe.CONNECTED?this.connectionState=Xe.RECONNECTING:this.connectionState=Xe.CONNECTING}),this.websocket.on($t.WILL_RECONNECT,(e,n,i)=>{const r=pg(this,zt.IS_P2P_DISCONNECTED),s=r||e!=="retry";r&&e==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=dy.P2P_DISCONNECTED),s&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(zt.REPORT_JOIN_GATEWAY,n||dy.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(zt.DISCONNECT_P2P)),i(e)}),this.websocket.on($t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Oi.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof z){if(e.code===L.UNEXPECTED_RESPONSE&&e.data.code===jt.ERR_NO_AUTHORIZED)return this.initError=new z(L.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ie.TOKEN_EXPIRE);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Oi.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on($t.REQUEST_NEW_URLS,(e,n)=>{wi(this,zt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(f1.PRE_CONNECT_PC,()=>{this.emit(zt.PRE_CONNECT_PC)})}}let VH=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Vn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function S1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function py(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?S1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ru(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(M("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function hO(t,e){t.addresses||(t.addresses=[]);const n=function(l,d){if(M("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(m=>{let{ip:E,port:g}=m;return{address:"".concat(E,":").concat(g)}});const h=M("GATEWAY_DOMAINS");let p=h[1]&&Et(d).call(d,h[1])?1:0;return l.map(m=>{let{domain_prefix:E,port:g,ip:I}=m;if(E)return{address:"".concat(E,".").concat(h[p++%h.length],":").concat(g)};const y=/^[\.\:\d]+$/.test(I),C=y?"".concat(I.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(g):"".concat(I,":").concat(g);return y||T.debug("Cannot recognized as ip address: ".concat(I,", use as host")),{ip:I,port:g,address:C}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let d=0;d<l.length;d++){var r;const h=Ji(r=l[d]).call(r);n[d]&&h&&(n[d].ip6=h)}}const s=t.detail&&t.detail.candidate;let c;if(s){const[l,d]=s.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function $r(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function T1(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat($r(e.width),"x").concat($r(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function R1(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Cg(t,e){let n,i,r;switch(e){case Vn.CHOOSE_SERVER:i=4096,r="choose server";break;case Vn.CLOUD_PROXY:i=1048576,r="proxy";break;case Vn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case Vn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new z(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(s=>{s.buffer&&s.buffer.flag===i&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>py(py({},c),{},{ticket:s.buffer.cert})),server_ts:t.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:py(py({},s.buffer.detail),t.detail),flag:s.buffer.flag,opid:t.opid,cert:s.buffer.cert})}),!n)throw new z(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function v1(t,e){return await St.all(t.addresses.map(async n=>({address:M("USE_TURN_IP")?n.ip:Ru(n.ip),tcpport:n.port,udpport:n.port,username:e&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Ni.username,password:e&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await gI(e.toString()):Ni.password})))}function pO(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min($r(t.height),$r(t.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function vu(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:s,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const d=r.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=s}return l}function fy(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:M("SVC_MODE");if(M("ENABLE_SVC"))return function(e){return e in Hv}(t)?t:Hv.L1T3}const y1={[It.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[It.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function my(t,e,n){e.forEach(i=>{var r;const s=y1[t].find(l=>{var d;let{key:h}=l;return Et(d=i.extensionName).call(d,h)});if(!s)return;const c=n.find(l=>{let{extensionName:d}=l;return Et(d).call(d,s.key)});c&&Et(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function cm(t,e){e.forEach(n=>{var i;const r=y1[t].find(s=>{var c;let{key:l}=s;return Et(c=n.extensionName).call(c,l)});Et(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function C1(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Et(t).call(t,"abs-send-time")}function Ey(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Et(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function A1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function b1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?A1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ag(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d}=e,{useXR:h}=n;let p=[],m=[],E=[],g=[],I=!1,y=!1;if(Mr(t).mediaDescriptions.forEach(N=>{i&&i!==N.attributes.direction||(N.media.mediaType!=="video"||I||(m=N.attributes.payloads,g=N.attributes.extmaps,I=!0),N.media.mediaType!=="audio"||y||(p=N.attributes.payloads,E=N.attributes.extmaps,y=!0))}),!g||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!E||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(m.forEach(N=>{var D;(D=N.rtpMap)!==null&&D!==void 0&&D.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),h&&N.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(N=>{var D;(D=N.rtpMap)!==null&&D!==void 0&&D.clockRate&&(N.rtpMap.clockRate=parseInt(N.rtpMap.clockRate)),h&&N.rtcpFeedbacks.push({type:"rrtr"})}),r&&(p=p.filter(N=>{var D;return((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"}),m=m.filter(N=>{var D;return((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())!=="rtx"})),s&&(m=m.filter(N=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),c&&(p=p.filter(N=>{var D;return!/(red)|(ulpfec)|(flexfec)/i.test(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(N=>{var D;return Et(l).call(l,((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0){const N=m.filter(D=>{var V;return Et(d).call(d,((V=D.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"")});m=N.concat(r?[]:EO(N,m))}const C=M("UNSUPPORTED_VIDEO_CODEC");return C&&C.length>0&&(m=m.filter(N=>!(N.rtpMap&&Et(C).call(C,N.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:m,audioExtensions:E,videoExtensions:g}}function yu(t){const e=Mr(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const s=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:c}}if(!i){const s=r.attributes.fingerprints;s.length>0&&(i={fingerprints:s})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function I1(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const d=(l=i.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?d:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function O1(t,e,n){const{cname:i}=t;let r=[];e&&(r=w1(e)),r.length===0&&(r=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),T.debug("Using candidates from gateway."));const s={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const d=gy(t.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:It.VIDEO,ssrcId:p.v,rtx:p.v_rtx,mslabel:"".concat(p.v,"_").concat(p.a)},{kind:It.AUDIO,ssrcId:p.a,mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:c,candidates:r,rtpCapabilities:d,setup:l,cname:i,preSSRCs:h}}function w1(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function fh(t,e,n){const i=[],r=[];return t.forEach(s=>{let{ssrcId:c,rtx:l}=s;const d=Ye(8,"track-"),h={ssrcId:c,attributes:b1({label:d,mslabel:n=n||Ye(10,""),msid:"".concat(n," ").concat(d)},e&&{cname:e})};if(i.push(h),l!==void 0){const p={ssrcId:l,attributes:b1({label:d,mslabel:n,msid:"".concat(n," ").concat(d)},e&&{cname:e})};i.push(p),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:i,ssrcGroups:r}}function lm(t,e){e instanceof vn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=e._encoderConfig;s&&r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(s.bitrate&&!En()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function fO(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function mO(t,e){var n;if(!(e instanceof nn&&e._encoderConfig&&e._hints.indexOf(ze.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;Te().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var s,c;Et(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Te().supportMinBitrate&&!Et(n=e._hints).call(n,ze.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var s,c;Et(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(M("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function N1(t){if(t.media.mediaType!=="video")return;const e=_e();if(e.name!==Ce.SAFARI&&e.os!==ei.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function _y(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const s=i.find(c=>Ey(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>Ey(d.extensionName))||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(E=>E.type==="transport-cc")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const s=t.attributes.extmaps.findIndex(c=>Ey(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const s=i.find(c=>C1(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>d.extensionName===c)||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(E=>E.type==="goog-remb")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const s=t.attributes.extmaps.findIndex(c=>C1(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function D1(t,e,n){if(En()||t.media.mediaType!=="video"||!(e instanceof nn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!M("SIMULCAST")||n==="vp9"&&M("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:Sn(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:Sn(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,s.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function L1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:s,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=Ag(h,l,d,"sendonly"),m=Ag(h,l,d,"recvonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(gs(p,m,"videoExtensions",E,g,I),gs(p,m,"videoCodecs",E,g,I),gs(p,m,"audioExtensions",E,g,I),gs(p,m,"audioCodecs",E,g,I),M("RAISE_H264_BASELINE_PRIORITY")){const y=[],C=[];I.videoCodecs.forEach((N,D)=>{var V;if(((V=N.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){var W,K;const j=I.videoCodecs[D+1],J=j&&x1(N,j),ct=(W=N.fmtp)===null||W===void 0?void 0:W.parameters["profile-level-id"],vt=(K=N.fmtp)===null||K===void 0?void 0:K.parameters["packetization-mode"];!ct||ct!==M("FIRST_H264_PROFILE_LEVEL_ID")||M("FIRST_PACKETIZATION_MODE")&&vt!==M("FIRST_PACKETIZATION_MODE")?J?C.push([N,j]):C.push([N]):J?y.push([N,j]):y.push([N])}}),y.length>0&&C.length>0&&(T.debug("raising H264 baseline profile priority"),I.videoCodecs.forEach((N,D)=>{var V;if(((V=N.rtpMap)===null||V===void 0?void 0:V.encodingName.toLocaleLowerCase())==="h264"){const W=x1(N,I.videoCodecs[D+1]),K=y.shift()||C.shift()||[];K.length>0&&(W?I.videoCodecs.splice(D,2,...K):I.videoCodecs.splice(D,1,...K))}}),g.videoCodecs=g.videoCodecs.filter(N=>{var D,V;return!(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=N.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID"))}),M("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(N=>{var D,V;return!(((D=N.rtpMap)===null||D===void 0?void 0:D.encodingName.toLocaleLowerCase())==="h264"&&((V=N.fmtp)===null||V===void 0?void 0:V.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:E,recv:g,sendrecv:I}}(t,e,i);try{n.close()}catch{}return{send:r,recv:s,sendrecv:c}}function P1(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=Ag(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(gs(t,e,"videoExtensions",n,i,r),gs(t,e,"videoCodecs",n,i,r),gs(t,e,"audioExtensions",n,i,r),gs(t,e,"audioCodecs",n,i,r),M("RAISE_H264_BASELINE_PRIORITY")){const s=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){T.debug("raising H264 baseline profile priority");const l=r.videoCodecs[s];r.videoCodecs.splice(s,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function gs(t,e,n,i,r,s){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}}function gy(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,s;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...i.audioCodecs],s.videoCodecs=[...n.videoCodecs,...i.videoCodecs],s.audioExtensions=[...n.audioExtensions,...i.audioExtensions],s.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):s=i,{send:r,recv:s}}function um(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function bg(t,e,n,i){let r=[];if(t===It.VIDEO){if(M("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(s=>{var c;return Et(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===M("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let s=[];const c=[],l=[],d=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";Et(p).call(p,i)?s.push(h):Et(p).call(p,"vp9")?c.push(h):Et(p).call(p,"vp8")?l.push(h):Et(p).call(p,"h264")&&d.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):d.length!==0&&(s=d,h="h264"),T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(r=e.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),M("USE_PUB_RTX")||M("USE_SUB_RTX")){const s=EO(r,e.videoCodecs);r=[...r,...s]}}else r=e.audioCodecs.filter(s=>{var c;return Et(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)}),r.length===0&&(T.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(s=>{var c;return Et(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")}));return r}function EO(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Et(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function Ig(t,e,n){const i=e.toString(),r=M1(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const s=await t.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=k1(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function k1(t,e,n){const i=Mr(t),{useXR:r}=e;return i.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(n)&&!Et(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&um(s),r&&Et(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),gu(i)}function M1(t,e,n,i){if(M("SDP_LOGGING"))return T.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{M1(r,"answer",n==="local"?"remote":"local",i)}:void 0}function U1(t){const e=M("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>Et(t).call(t,n))}function x1(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function V1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Fa(t,e){return typeof M(t)===e?M(t):void 0}function BH(){try{const t=M("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?V1(Object(i),!0).forEach(function(r){O(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):V1(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return T.debug("handle gateway attributes failed: ",t),{}}}const B1={};function Cu(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&T.debug("install service ".concat(t.name)),B1[t.name]=t}function rl(t){const e=B1[t];if(!e)throw new $(L.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function F1(t,e){return rl("DataStream").create(t,e)}function Sy(){return rl("InterceptFrame").create()}function j1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function al(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?j1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const _O=new Map;class FH extends hn{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(li.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(li.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,s;super(),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"key",void 0),O(this,"ntpOffset",0),O(this,"signal",void 0),O(this,"role",void 0),O(this,"inChannelInfo",{joinAt:null,duration:0}),O(this,"spec",void 0),O(this,"_state","DISCONNECTED"),O(this,"_statsCollector",void 0),O(this,"_disconnectedReason",void 0),O(this,"isSignalRecover",!1),O(this,"hasChangeBGPAddress",!1),O(this,"trafficStatsInterval",void 0),O(this,"networkQualityInterval",void 0),O(this,"_joinGatewayStartTime",0),O(this,"_signalTimeout",!1),O(this,"_clientRoleOptions",void 0),O(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:al(al({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(s=rl("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(s,i)):new xH(al(al({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let s=_O.get(e.cname);if(s||(s=new Map,_O.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const h=new z(L.UID_CONFLICT);throw Mt.joinGateway(e.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),h}s.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{T.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const h=e.gatewayAddrs.map(p=>{let{address:m}=p;const[E,g]=m.split(":"),I={host:E,port:g};return e.proxyServer&&(I.proxy=e.proxyServer),I});c=(await this.signal.init(h)).uid,T.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw T.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),Mt.joinGateway(e.sid,{lts:r,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:e.preload}),s.delete(e.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(li.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(li.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(li.NETWORK_QUALITY,{uplinkNetworkQuality:R1(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:R1(this._statsCollector.trafficStats.B_dnq)}):this.emit(li.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ie.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Xe.CONNECTED||await function(i,r){return r===1/0?i:St.race([i,d5(r)])}(this.signal.request(Kt.LEAVE,void 0,!0),3e3)}catch(i){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ie.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:M("PUB_EXTEND"),twcc:!!M("PUBLISH_TWCC"),rtx:!!M("USE_PUB_RTX")};try{return(await this.signal.request(Kt.PUBLISH,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw s}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Kt.PUBLISH_DATASTREAM,s,!0)}catch(c){if(i&&c.data&&c.data.code===jt.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Kt.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await St.all(e.map(n=>this.signal.request(Kt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX")||void 0,extend:M("SUB_EXTEND"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return await this.signal.request(Kt.PRE_SUBSCRIBE,r,!0)}catch(s){if(i&&s.data&&s.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,n,!1);throw s}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX"),extend:M("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return(await this.signal.request(Kt.SUBSCRIBE,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw s}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Kt.SUBSCRIBE_DATASTREAM,r,!0)}catch(s){if(i&&s.data&&s.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw s}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!M("USE_SUB_RTX"),twcc:!!M("SUBSCRIBE_TWCC"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return await this.signal.request(Kt.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===jt.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,s=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:s,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(Kt.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(Kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await St.all(e.map(i=>this.signal.request(Kt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){T.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(Kt.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Kt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Kt.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Kt.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS")),T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(Kt.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(Kt.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Kt.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(Kt.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(Kt.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Kt.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),al({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=_O.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Ni.username,password:Ni.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(al(al({},Ni),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(Kt.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Bv(()=>{this.emit(li.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new z(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=M("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}var r;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(li.UPDATE_GATEWAY_CONFIG),r=this.store.clientId,Et(im).call(im,r)||im.push(r);const s=!(En()||aP(87)||qP())&&typeof M("ENABLE_PRE_SUB")=="boolean"&&M("ENABLE_PRE_SUB"),c=!qP()&&Fa("ENABLE_PREALLOC_PC","boolean"),l=BH(),d=cg(87)||function(){const p=_e();if(p.name!==Ce.SAFARI||!p.browserVersion)return!1;const m=p.browserVersion.split(".");return Number(m[0])>15||Number(m[0])===15&&Number(m[1])>=4}(),h=al({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ua,browser:navigator.userAgent,process_id:M("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:M("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:al({enableEncodedTransform:!!M("ENABLE_AUDIO_METADATA")&&d||!!M("ENABLE_AUDIO_TOPN")&&uI(Ce.CHROME,87,116)||void 0,enableAudioMetadata:!!M("ENABLE_AUDIO_METADATA")&&d,enableAudioPts:!!M("ENABLE_AUDIO_PTS_METADATA")&&d,topnSmoothLevel:M("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:M("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:M("TOPN_SWITCH_HOLD_MS"),topnAudioGain:M("TOPN_AUDIO_GAIN"),enablePublishedUserList:M("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:M("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Fa("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Fa("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Fa("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:M("USE_PUB_RTX")===!0||M("USE_SUB_RTX")===!0||void 0,disableFEC:M("DISABLE_FEC"),enableNTPReport:!!M("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!M("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!M("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Fa("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!M("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!M("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Fa("USE_XR","boolean"),enableLossbasedBwe:Fa("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!M("ENABLE_AUT_CC")||void 0,enableCCFallback:Fa("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:c,preSubNum:s?Fa("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Fa("PUBLISH_TWCC","boolean"),enableSubTWCC:Fa("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Fa("USE_PUB_RTX","boolean"),enableSubRTX:Fa("USE_SUB_RTX","boolean"),enableSubSVC:M("ENABLE_SVC")?M("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0,enableSvcExtended:M("ENABLE_SVC")&&Array.isArray(M("SVC_EXTENDED"))&&M("SVC_EXTENDED").length!==0?M("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,M("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new z(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(zt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(zt.WS_RECONNECTING,e=>{this.joinInfo&&Mt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Oi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Mt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(zt.WS_CLOSED,e=>{let n;switch(e){case Ie.LEAVE:n=Oi.LEAVE;break;case Ie.UID_BANNED:case Ie.IP_BANNED:case Ie.CHANNEL_BANNED:case Ie.SERVER_ERROR:n=Oi.SERVER_ERROR;break;case Ie.FALLBACK:n=Oi.FALLBACK;break;case Ie.LICENSE_MISSING:case Ie.LICENSE_EXPIRED:case Ie.LICENSE_MINUTES_EXCEEDED:case Ie.LICENSE_PERIOD_INVALID:case Ie.LICENSE_MULTIPLE_SDK_SERVICE:case Ie.LICENSE_ILLEGAL:case Ie.TOKEN_EXPIRE:n=e;break;default:n=Oi.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Oi.NETWORK_ERROR)),this.joinInfo&&Mt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Ie.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==Ie.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(zt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=M("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(Mt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Pe("EVENT_REPORT_DOMAIN",e[1]),Pe("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Pe("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(ce.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(zt.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new z(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,wi(this,li.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(zt.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const s=Sn((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(M("NEW_TURN_MODE")&&s){let h=s.servers,p=s.serversFromGateway;const m=this.signal.currentURLIndex;h.length>0&&(h=[h[m%h.length]],s.servers=h),Array.isArray(p)&&p.length>0&&(p=[p[0]],s.serversFromGateway=p),T.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(m))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await wi(this,li.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:s});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(h){n(h)}}),this.signal.on(zt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(zt.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var s;e instanceof z?(i=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,r=e.message):i=e,Mt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(zt.IS_P2P_DISCONNECTED,e=>{e(pg(this,li.IS_P2P_DISCONNECTED))}),this.signal.on(zt.DISCONNECT_P2P,()=>{this.emit(li.DISCONNECT_P2P)}),this.signal.on(zt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(zt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(zt.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(li.JOIN_RESPONSE,e,n)}),this.signal.on(zt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=M("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=w1(e);this.emit(li.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(zt.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof M("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(M("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(Kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(Kt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw T.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(Kt.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(Kt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw T.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(Kt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===we.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Kt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===we.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(Kt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===It.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Kt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===It.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Kt.CONTROL,i,!0,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Kt.RESTART_ICE,n,!0)}catch(i){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||Oi.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!M("GATEWAY_WSS_ADDRESS"))return M("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Kt.SET_PARAMETER,{enablePublishAudioFilter:e})}}let Ty=0,gO=0;function ao(t,e,n,i){return new St((r,s)=>{e.timeout=e.timeout||M("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Ty+=Qo(e.data)):n&&(e.data.size?Ty+=e.data.size:e.data instanceof FormData?Ty+=yP(e.data):Ty+=Qo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Er.request(e).then(c=>{typeof c.data=="string"?gO+=Qo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?gO+=c.data.byteLength:gO+=Qo(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{Er.isCancel(c)?s(new z(L.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new z(L.NETWORK_TIMEOUT,c.message)):c.response?s(new z(L.NETWORK_RESPONSE_ERROR,c.response.status)):s(new z(L.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(nt){var ft=0;return function(){return ft<nt.length?{done:!1,value:nt[ft++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(nt,ft,kt){return nt==Array.prototype||nt==Object.prototype||(nt[ft]=kt.value),nt},i,r=function(nt){nt=[typeof globalThis=="object"&&globalThis,nt,typeof window=="object"&&window,typeof self=="object"&&self,typeof b=="object"&&b];for(var ft=0;ft<nt.length;++ft){var kt=nt[ft];if(kt&&kt.Math==Math)return kt}throw Error("Cannot find global object")}(this);function s(nt,ft){if(ft)t:{var kt=r;nt=nt.split(".");for(var at=0;at<nt.length-1;at++){var v=nt[at];if(!(v in kt))break t;kt=kt[v]}(ft=ft(at=kt[nt=nt[nt.length-1]]))!=at&&ft!=null&&n(kt,nt,{configurable:!0,writable:!0,value:ft})}}function c(nt){return(nt={next:nt})[Symbol.iterator]=function(){return this},nt}function l(nt){var ft=typeof Symbol<"u"&&Symbol.iterator&&nt[Symbol.iterator];return ft?ft.call(nt):{next:e(nt)}}if(s("Symbol",function(nt){function ft(v,U){this.A=v,n(this,"description",{configurable:!0,writable:!0,value:U})}if(nt)return nt;ft.prototype.toString=function(){return this.A};var kt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",at=0;return function v(U){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new ft(kt+(U||"")+"_"+at++,U)}}),s("Symbol.iterator",function(nt){if(nt)return nt;nt=Symbol("Symbol.iterator");for(var ft="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),kt=0;kt<ft.length;kt++){var at=r[ft[kt]];typeof at=="function"&&typeof at.prototype[nt]!="function"&&n(at.prototype,nt,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return nt}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var d;t:{var h={};try{h.__proto__={a:!0},d=h.a;break t}catch{}d=!1}i=d?function(nt,ft){if(nt.__proto__=ft,nt.__proto__!==ft)throw new TypeError(nt+" is not extensible");return nt}:null}var p=i;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function E(nt){if(nt.m)throw new TypeError("Generator is already running");nt.m=!0}function g(nt,ft){return nt.h=3,{value:ft}}function I(nt){this.g=new m,this.G=nt}function y(nt,ft,kt,at){try{var v=ft.call(nt.g.j,kt);if(!(v instanceof Object))throw new TypeError("Iterator result "+v+" is not an object");if(!v.done)return nt.g.m=!1,v;var U=v.value}catch(F){return nt.g.j=null,nt.g.s(F),C(nt)}return nt.g.j=null,at.call(nt.g,U),C(nt)}function C(nt){for(;nt.g.h;)try{var ft=nt.G(nt.g);if(ft)return nt.g.m=!1,{value:ft.value,done:!1}}catch(kt){nt.g.v=void 0,nt.g.s(kt)}if(nt.g.m=!1,nt.g.l){if(ft=nt.g.l,nt.g.l=null,ft.F)throw ft.D;return{value:ft.return,done:!0}}return{value:void 0,done:!0}}function N(nt){this.next=function(ft){return nt.o(ft)},this.throw=function(ft){return nt.s(ft)},this.return=function(ft){return function(kt,at){E(kt.g);var v=kt.g.j;return v?y(kt,"return"in v?v.return:function(U){return{value:U,done:!0}},at,kt.g.return):(kt.g.return(at),C(kt))}(nt,ft)},this[Symbol.iterator]=function(){return this}}function D(nt,ft){return ft=new N(new I(ft)),p&&nt.prototype&&p(ft,nt.prototype),ft}if(m.prototype.o=function(nt){this.v=nt},m.prototype.s=function(nt){this.l={D:nt,F:!0},this.h=this.C||this.u},m.prototype.return=function(nt){this.l={return:nt},this.h=this.u},I.prototype.o=function(nt){return E(this.g),this.g.j?y(this,this.g.j.next,nt,this.g.o):(this.g.o(nt),C(this))},I.prototype.s=function(nt){return E(this.g),this.g.j?y(this,this.g.j.throw,nt,this.g.o):(this.g.s(nt),C(this))},s("Array.prototype.entries",function(nt){return nt||function(){return function(ft,kt){ft instanceof String&&(ft+="");var at=0,v=!1,U={next:function(){if(!v&&at<ft.length){var F=at++;return{value:kt(F,ft[F]),done:!1}}return v=!0,{done:!0,value:void 0}}};return U[Symbol.iterator]=function(){return U},U}(this,function(ft,kt){return[ft,kt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var V=function(nt,ft){for(var kt=0;kt<nt.length;kt++)ft(nt[kt])},W=function(nt){return nt.replace(/\r?\n|\r/g,`\r
`)},K=function(nt,ft,kt){return ft instanceof Blob?(kt=kt!==void 0?kt+"":typeof ft.name=="string"?ft.name:"blob",ft.name===kt&&Object.prototype.toString.call(ft)!=="[object Blob]"||(ft=new File([ft],kt)),[String(nt),ft]):[String(nt),String(ft)]},j=function(nt,ft){if(nt.length<ft)throw new TypeError(ft+" argument required, but only "+nt.length+" present.")},J=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ct=J.FormData,vt=J.XMLHttpRequest&&J.XMLHttpRequest.prototype.send,At=J.Request&&J.fetch,le=J.navigator&&J.navigator.sendBeacon,ue=J.Element&&J.Element.prototype,qe=J.Symbol&&Symbol.toStringTag;qe&&(Blob.prototype[qe]||(Blob.prototype[qe]="Blob"),"File"in J&&!File.prototype[qe]&&(File.prototype[qe]="File"));try{new File([],"")}catch{J.File=function(ft,kt,at){return ft=new Blob(ft,at||{}),Object.defineProperties(ft,{name:{value:kt},lastModified:{value:+(at&&at.lastModified!==void 0?new Date(at.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),qe&&Object.defineProperty(ft,qe,{value:"File"}),ft}}var Ln=function(nt){return nt.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},yn=function(nt){this.i=[];var ft=this;nt&&V(nt.elements,function(kt){if(kt.name&&!kt.disabled&&kt.type!=="submit"&&kt.type!=="button"&&!kt.matches("form fieldset[disabled] *"))if(kt.type==="file"){var at=kt.files&&kt.files.length?kt.files:[new File([],"",{type:"application/octet-stream"})];V(at,function(v){ft.append(kt.name,v)})}else kt.type==="select-multiple"||kt.type==="select-one"?V(kt.options,function(v){!v.disabled&&v.selected&&ft.append(kt.name,v.value)}):kt.type==="checkbox"||kt.type==="radio"?kt.checked&&ft.append(kt.name,kt.value):(at=kt.type==="textarea"?W(kt.value):kt.value,ft.append(kt.name,at))})};if((t=yn.prototype).append=function(nt,ft,kt){j(arguments,2),this.i.push(K(nt,ft,kt))},t.delete=function(nt){j(arguments,1);var ft=[];nt=String(nt),V(this.i,function(kt){kt[0]!==nt&&ft.push(kt)}),this.i=ft},t.entries=function nt(){var ft,kt=this;return D(nt,function(at){if(at.h==1&&(ft=0),at.h!=3)return ft<kt.i.length?at=g(at,kt.i[ft]):(at.h=0,at=void 0),at;ft++,at.h=2})},t.forEach=function(nt,ft){j(arguments,1);for(var kt=l(this),at=kt.next();!at.done;at=kt.next()){var v=l(at.value);at=v.next().value,v=v.next().value,nt.call(ft,v,at,this)}},t.get=function(nt){j(arguments,1);var ft=this.i;nt=String(nt);for(var kt=0;kt<ft.length;kt++)if(ft[kt][0]===nt)return ft[kt][1];return null},t.getAll=function(nt){j(arguments,1);var ft=[];return nt=String(nt),V(this.i,function(kt){kt[0]===nt&&ft.push(kt[1])}),ft},t.has=function(nt){j(arguments,1),nt=String(nt);for(var ft=0;ft<this.i.length;ft++)if(this.i[ft][0]===nt)return!0;return!1},t.keys=function nt(){var ft,kt,at,v,U=this;return D(nt,function(F){if(F.h==1&&(ft=l(U),kt=ft.next()),F.h!=3)return kt.done?void(F.h=0):(at=kt.value,v=l(at),g(F,v.next().value));kt=ft.next(),F.h=2})},t.set=function(nt,ft,kt){j(arguments,2),nt=String(nt);var at=[],v=K(nt,ft,kt),U=!0;V(this.i,function(F){F[0]===nt?U&&(U=!at.push(v)):at.push(F)}),U&&at.push(v),this.i=at},t.values=function nt(){var ft,kt,at,v,U=this;return D(nt,function(F){if(F.h==1&&(ft=l(U),kt=ft.next()),F.h!=3)return kt.done?void(F.h=0):(at=kt.value,(v=l(at)).next(),g(F,v.next().value));kt=ft.next(),F.h=2})},yn.prototype._asNative=function(){for(var nt=new ct,ft=l(this),kt=ft.next();!kt.done;kt=ft.next()){var at=l(kt.value);kt=at.next().value,at=at.next().value,nt.append(kt,at)}return nt},yn.prototype._blob=function(){var nt="----formdata-polyfill-"+Math.random(),ft=[],kt="--"+nt+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(at,v){return typeof at=="string"?ft.push(kt+Ln(W(v))+`"\r
\r
`+W(at)+`\r
`):ft.push(kt+Ln(W(v))+'"; filename="'+Ln(at.name)+`"\r
Content-Type: `+(at.type||"application/octet-stream")+`\r
\r
`,at,`\r
`)}),ft.push("--"+nt+"--"),new Blob(ft,{type:"multipart/form-data; boundary="+nt})},yn.prototype[Symbol.iterator]=function(){return this.entries()},yn.prototype.toString=function(){return"[object FormData]"},ue&&!ue.matches&&(ue.matches=ue.matchesSelector||ue.mozMatchesSelector||ue.msMatchesSelector||ue.oMatchesSelector||ue.webkitMatchesSelector||function(nt){for(var ft=(nt=(this.document||this.ownerDocument).querySelectorAll(nt)).length;0<=--ft&&nt.item(ft)!==this;);return-1<ft}),qe&&(yn.prototype[qe]="FormData"),vt){var vr=J.XMLHttpRequest.prototype.setRequestHeader;J.XMLHttpRequest.prototype.setRequestHeader=function(nt,ft){vr.call(this,nt,ft),nt.toLowerCase()==="content-type"&&(this.B=!0)},J.XMLHttpRequest.prototype.send=function(nt){nt instanceof yn?(nt=nt._blob(),this.B||this.setRequestHeader("Content-Type",nt.type),vt.call(this,nt)):vt.call(this,nt)}}At&&(J.fetch=function(nt,ft){return ft&&ft.body&&ft.body instanceof yn&&(ft.body=ft.body._blob()),At.call(this,nt,ft)}),le&&(J.navigator.sendBeacon=function(nt,ft){return ft instanceof yn&&(ft=ft._asNative()),le.call(this,nt,ft)}),J.FormData=yn}})();const Og=()=>{const t=M("AREAS");return t.length===0&&t.push(Ae.GLOBAL),er(t).call(t,(e,n,i)=>{const r=G1(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},G1=t=>t===Ae.OVERSEA?"".concat(xi.ASIA,",").concat(xi.EUROPE,",").concat(xi.AFRICA,",").concat(xi.NORTH_AMERICA,",").concat(xi.SOUTH_AMERICA,",").concat(xi.OCEANIA):xi[t],jH=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=hy[n],r=Object.keys(i);r&&r.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(i[s]))})}),e},Ry={GLOBAL:{ASIA:[Ae.CHINA,Ae.JAPAN,Ae.INDIA,Ae.KOREA,Ae.HKMC],EUROPE:[],NORTH_AMERICA:[Ae.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},vy=Object.keys(Ry[Ae.GLOBAL]),SO=[Ae.CHINA,Ae.NORTH_AMERICA,Ae.EUROPE,Ae.ASIA,Ae.JAPAN,Ae.INDIA,Ae.OCEANIA,Ae.SOUTH_AMERICA,Ae.AFRICA,Ae.KOREA,Ae.HKMC,Ae.US],GH=function(t,e){let n=[];if(Et(t).call(t,Ae.GLOBAL)){const s=[Ae.GLOBAL,Ae.OVERSEA],c=Object.keys(hy);if(e===Ae.GLOBAL)throw new z(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Ae.CHINA)n=[Ae.OVERSEA];else if(r=e,Et(vy).call(vy,r)){const l=(i=e,Ry[Ae.GLOBAL][i]||[]),d=[...s,e,...l];n=c.filter(h=>!Et(d).call(d,h))}else if(function(l){let d=!1;return vy.forEach(h=>{var p;Et(p=Ry[Ae.GLOBAL][h]).call(p,l)&&(d=!0)}),d}(e)){const l=function(h){let p;return vy.forEach(m=>{var E;Et(E=Ry[Ae.GLOBAL][m]).call(E,h)&&(p=m)}),p}(e),d=[...s,l,e];n=c.filter(h=>!Et(d).call(d,h))}else n=t;n=function(l){const d=[];return SO.forEach(h=>{Et(l).call(l,h)&&d.push(h)}),d.concat(l.filter(h=>!Et(SO).call(SO,h)))}(n)}else n=t;var i,r;return n};function H1(t){var e,n;if(!t&&Et(e=M("AREAS")).call(e,Ae.EXTENSIONS))return T.debug("update area from ap : reset"),void TO(Q5,!0);if(!Et(n=M("AREAS")).call(n,Ae.GLOBAL)||!t)return;let i=hy.EXTENSIONS;i&&(i={CODE:G1(Ae.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},T.debug("update area from ap success: ".concat(t,",config is "),i),Pe("AREAS",[Ae.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Pe(r,i[r][0]):Pe(r,i[r])}))}function TO(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Mt.reportApiInvoke(null,{name:Gn.SET_AREA,options:t,tag:gn.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(s=>{if(!Et(l1).call(l1,s))throw new z(L.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:s,excludedArea:c}=t;if(!s)throw new z(L.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),i=c?GH(l,c):l}if(!e){if(eo.AREAS){const s=new z(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void T.warning("setArea is prohibited because of config-distribute")}if(Et(i).call(i,Ae.GLOBAL)&&M("AREAS")===Ae.EXTENSIONS){const s=new z(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void T.warning("setArea is prohibited because of ap extensions")}}Pe("AREAS",i,e);const r=jH(i);Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Pe(s,r[s][0]):Pe(s,r[s])}),T.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function W1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ic(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?W1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):W1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let RO=1;function HH(t,e,n,i,r){RO+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:RO,requestId:RO,version:Ua,cname:n.cname},c={service_name:e,json_body:JSON.stringify(s)};let l,d,h=t[0];return to(async()=>{l=Date.now();const p=await ao(h,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,p.code!==0){const g=new z(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw T.error(g.toString()),g}const m=JSON.parse(p.json_body);if(m.code!==200){const g=new z(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:d});throw T.error(g.toString()),g}if(!m.servers||m.servers.length===0){const g=new z(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:d});throw T.error(g.toString()),g}const E=function(g,I){return{addressList:g.servers.map(y=>"wss://".concat(y.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(y.wss,"?serviceName=").concat(encodeURIComponent(I))),workerToken:g.workerToken,vid:g.vid}}(m,e);return M("LIVE_STREAMING_ADDRESS")&&(E.addressList=M("LIVE_STREAMING_ADDRESS")instanceof Array?M("LIVE_STREAMING_ADDRESS"):[M("LIVE_STREAMING_ADDRESS")]),ic(ic({},E),{},{responseTime:d})},(p,m)=>(Mt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:m===0,responseTime:d,serverIp:t[m%t.length]}),!1),(p,m)=>(Mt.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:d,serverIp:t[m%t.length]}),!!(p.code!==L.OPERATION_ABORTED&&p.code!==L.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=t[(m+1)%t.length],!0)),r)}let vO=1;function K1(t,e,n,i){let{url:r,areaCode:s}=t;const{clientId:c,sid:l}=e,d=Date.now();let h;const p=e.role,[m,E]=CO(e,s,[Vn.CHOOSE_SERVER]);let g=xn.networkState;return to(async()=>{g&&xn.networkState===Zr.OFFLINE&&xn.onlineWaiter&&await St.race([xn.onlineWaiter,_i(i&&i.maxRetryTimeout||Hn.maxRetryTimeout)]),g=xn.networkState;const{data:I,headers:y}=await ao(r,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=y.http3==="1"?1:-1,Mt.reportResourceTiming(r,l),z1(I,r,e,d,[Vn.CHOOSE_SERVER],h);const C=Cg(I,Vn.CHOOSE_SERVER);return yO(C),hO(C,r)},I=>(I&&Mt.joinChooseServer(l,{role:p,lts:d,succ:!0,csAddr:r,opid:E,serverList:I.gatewayAddrs.map(y=>y.address),ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:I.res.detail&&I.res.detail[38]}),!1),I=>I.code!==L.OPERATION_ABORTED&&(I.code===L.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(Mt.joinChooseServer(l,{role:p,lts:d,succ:!1,csAddr:r,serverList:null,opid:E,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:g}),isHttp3:h,corssRegionTagReq:e.apRequestDetail}),T.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),I),!0)),i)}function Y1(t,e,n,i){let r,{url:s,areaCode:c,serviceIds:l}=t;const d=Date.now(),h=e.role,[p,m]=CO(e,c,l);let E;return to(async()=>{E&&xn.networkState===Zr.OFFLINE&&xn.onlineWaiter&&await St.race([xn.onlineWaiter,_i(i&&i.maxRetryTimeout||Hn.maxRetryTimeout)]),E=xn.networkState;const{data:g,headers:I}=await ao(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=I.http3==="1"?1:-1,Mt.reportResourceTiming(s,e.sid),z1(g,s,e,d,l,r);const y=Cg(g,Vn.CHOOSE_SERVER),C=Cg(g,e.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK);return yO(y),{gatewayInfo:hO(y,s),proxyInfo:C,url:s}},g=>(g.gatewayInfo&&Mt.joinChooseServer(e.sid,{role:h,lts:d,succ:!0,csAddr:s,serverList:g.gatewayInfo.gatewayAddrs.map(I=>I.address),ec:null,opid:m,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:g.gatewayInfo.res.detail&&g.gatewayInfo.res.detail[38]}),g.proxyInfo&&Mt.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:g.proxyInfo.addresses.map(I=>I.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),g=>g.code!==L.OPERATION_ABORTED&&(g.code===L.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Mt.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:g.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:E})}),T.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const z1=(t,e,n,i,r,s)=>{const{sid:c,clientId:l,cloudProxyServer:d}=n,h=[],p=m=>{m.flag===4096?Mt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||Mt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:m.error.code,eventType:d,unilbsServerIds:r.toString()})};if(t.response_body.forEach(m=>{const E=m.buffer.code;if(m.uri===23&&E===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const g={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:m.buffer.flag};h.push(g),p(g)}if(E!==0){const g=om(E),I={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:t.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?T.warning(I.error.toString()):h.push(I),p(I)}}),h.length)throw T.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new z(L.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:t.detail[502],desc:[...new Set(h.map(m=>{var E;return m==null||(E=m.error)===null||E===void 0||(E=E.data)===null||E===void 0?void 0:E.desc}).filter(m=>!!m))]})},yO=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new z(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(M("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?H1(t.detail[23].toLowerCase()):H1()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let d=0;d<l.length;d++){var s;const h=Ji(s=l[d]).call(s);t.addresses[d]&&l&&(t.addresses[d].fingerprint=h)}}if(M("GATEWAY_ADDRESS")&&M("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",M("GATEWAY_ADDRESS"));const c=M("GATEWAY_ADDRESS").map(l=>{var d,h;const p=(d=(h=t.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:p}});t.addresses=c}},WH=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=om(n.buffer.code);throw new z(L.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",e),new z(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},CO=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:ic(ic(ic({6:t.stringUid,11:e,12:M("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};s.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]},KH=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let dm=0;function hm(t){return St.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const wg=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:s}=t,c=0;const l=e;let d,h=0;const p=async()=>{const m=(()=>{const E=c*l,g=E+l;return n.slice(E,g).map(i)})();s&&s.push(...m);try{d=await hm(m)}catch(E){if(h+=l,c++,!(h>=n.length))return void await p();r(E)}m.forEach(E=>E.cancel())};return await p(),d},q1=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let s=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(d){if(s++,s>=r||i!=null&&i(d))throw d;return c()}};return c()};async function AO(t,e,n,i){return{gatewayInfo:await async function(s,c,l,d){let h=null;const p=[],m=async()=>{const g=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(C=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(C+"/api/v2/transpond/webrtc?v=2"):"https://".concat(C,"/api/v2/transpond/webrtc?v=2"),areaCode:Og()})),I=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(s.clientId,"] Connect to choose_server:"),C.url),K1(C,s,c,l)),allFailedhandler:C=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y},E=async()=>{if(await _i(1e3),h!==null)return h;const g=M("WEBCS_DOMAIN_BACKUP_LIST").map(C=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(C+"/api/v2/transpond/webrtc?v=2"):"https://".concat(C,"/api/v2/transpond/webrtc?v=2"),areaCode:Og()})),I=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),C.url),K1(C,s,c,l)),allFailedhandler:C=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y};try{return h=await hm([m(),E()]),p.length&&p.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),h}catch(g){throw g[0]}}(t,e,n,i)}}async function X1(t,e,n,i,r){const s=t.cloudProxyServer;if(s==="disabled"){if(t.useLocalAccessPoint)return await AO(t,e,n,r);if(M("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:E,proxyInfo:g}=await Z1(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:E};const I=g.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||Ni.tcpport,udpport:y.udpport||Ni.udpport,username:y.username||Ni.username,password:y.password||Ni.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const y=(c=t.uid)!==null&&c!==void 0?c:E.uid,C="glb:".concat(y.toString()),N=await gI(C),D=g.map(V=>({turnServerURL:V.address,tcpport:V.tcpport||Ni.tcpport,udpport:V.udpport||Ni.udpport,username:C,password:N,forceturn:!1,security:!0}));I.push(...D)}return t.turnServer={mode:"manual",servers:I},{gatewayInfo:E}}return await AO(t,e,n,r)}const{proxyInfo:l,gatewayInfo:d}=await Z1(t,e,n,r),h={gatewayInfo:d},p=l.map(E=>({turnServerURL:E.address,tcpport:s==="proxy3"?void 0:E.tcpport?E.tcpport:Ni.tcpport,udpport:s==="proxy4"?void 0:E.udpport?E.udpport:Ni.udpport,username:E.username||Ni.username,password:E.password||Ni.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(r.useP2P){var m;const E=(m=t.uid)!==null&&m!==void 0?m:d.uid,g="glb:".concat(E.toString()),I=await gI(g),y=l.map(C=>({turnServerURL:C.address,tcpport:s==="proxy3"?void 0:C.tcpport||Ni.tcpport,udpport:s==="proxy4"?void 0:C.udpport||Ni.udpport,username:g,password:I,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...y)}return t.turnServer={mode:"manual",servers:p},T.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),h}async function J1(t,e,n,i,r){const s=M("ACCOUNT_REGISTER").slice(0,M("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?s.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const d=await async function(h,p,m,E,g){const I=Date.now(),y={sid:m.sid,opid:10,appid:m.appId,string_uid:p};let C=h[0];const N=await to(()=>ao(C+"".concat(C.indexOf("?")===-1?"?":"&","action=stringuid"),{data:y,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(D,V)=>{if(D.code===0){if(D.uid<=0||D.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(p," => ").concat(D.uid),D),Mt.reqUserAccount(y.sid,{lts:I,success:!1,serverAddr:C,stringUid:y.string_uid,uid:D.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:y}),new z(L.INVALID_UINT_UID_FROM_STRING_UID);return Mt.reqUserAccount(y.sid,{lts:I,success:!0,serverAddr:C,stringUid:y.string_uid,uid:D.uid,errorCode:null,extend:y}),!1}const W=om(D.code);return W.retry&&(C=h[(V+1)%h.length]),Mt.reqUserAccount(y.sid,{lts:I,success:!1,serverAddr:C,stringUid:y.string_uid,uid:D.uid,errorCode:W.desc,extend:y}),W.retry},(D,V)=>D.code!==L.OPERATION_ABORTED&&(Mt.reqUserAccount(y.sid,{lts:I,success:!1,serverAddr:C,stringUid:y.string_uid,uid:null,errorCode:D.code,extend:y}),C=h[(V+1)%h.length],!0),g);if(N.code!==0){const D=om(N.code);throw new z(L.UNEXPECTED_RESPONSE,D.desc)}return N}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function YH(t,e,n){const i=M("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):i.map(s=>"https://".concat(s,"/api/v1"));try{return await q1({referenceList:r,asyncMapHandler:c=>async function(l,d,h,p){const m=Date.now(),E={sid:h.sid,opid:10,appid:h.appId,string_uid:d};try{const g=await ao(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){const I=om(g.code);throw new z(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(I.desc),I)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new z(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:m,url:l,req:E,uid:g.uid,elapse:Date.now()-m}}catch(g){throw g}}(c,t,e,n),closeFn:c=>c.code===L.OPERATION_ABORTED||c.code===L.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(s){throw s}}async function zH(t,e,n){const i=M("CDS_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),r=i.map(d=>function(h,p,m,E){const g=_e(),I={flag:64,cipher_method:0,features:ic(ic(ic(ic(ic({install_id:wI(),device:g.name,system:g.os,system_general:navigator.userAgent,vendor:p.appId,version:Ua,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:VH.WEB_RTC,browser_name:g.name,browser_version:g.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),g.os&&{os_name:g.os}),g.osVersion&&{os_version:g.osVersion}),{},{detail:""})};return to(()=>ao(h,{data:I,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,y=>y.code!==L.OPERATION_ABORTED,E)}(d,t,e,n));let s=null,c=null,l={};try{s=await hm(r)}catch(d){if(d.code===L.OPERATION_ABORTED)throw d;c=d}if(r.forEach(d=>d.cancel()),Mt.reportApiInvoke(t.sid,{name:Gn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=function(d){if(!d.test_tags)return{};const h=d.test_tags,p=Object.keys(h),m={};return p.forEach(E=>{var g;const I=Ji(g=E.slice(4)).call(g),y=JSON.parse(h[E]),C=y[1];m[I]={tag:y[0]||"",value:C}}),m}(s)}catch{}return l}async function Q1(t,e){const n=M("WEBCS_DOMAIN").concat(M("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:Og(),serviceIds:[Vn.CHOOSE_SERVER,Vn.CLOUD_PROXY_FALLBACK]}));try{return await q1({referenceList:n,asyncMapHandler:r=>async function(s,c,l){let d,{url:h,areaCode:p,serviceIds:m}=s;const E=Date.now(),[g,I]=CO(c,p,m);let y=xn.networkState;try{y&&xn.networkState===Zr.OFFLINE&&xn.onlineWaiter&&await St.race([xn.onlineWaiter,_i(Hn.maxRetryTimeout)]),y=xn.networkState;const{data:C,headers:N}=await ao(h,{data:g,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=N.http3==="1"?1:-1,(K=>{const j=[];if(K.response_body.forEach(J=>{const ct=J.buffer.code;if(J.uri===23&&ct===0&&!J.buffer.edges_services)if(J.buffer.flag===4194310)J.buffer.edges_services=[];else{const vt={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:K.detail[502]}),flag:J.buffer.flag};j.push(vt)}if(ct!==0){const vt=om(ct),At={error:new z(L.CAN_NOT_GET_GATEWAY_SERVER,vt.desc,{desc:vt.desc,retry:vt.retry,csIp:K.detail[502]}),flag:J.buffer.flag};J.buffer.flag===4194310?T.warning(At.error.toString()):j.push(At)}}),j.length)throw new z(L.CAN_NOT_GET_GATEWAY_SERVER,j.map(J=>"flag: ".concat(J.flag,", message: ").concat(J.error.message)).join(" | "),{retry:!!j.find(J=>J.error.data.retry),csIp:K.detail[502],desc:[...new Set(j.map(J=>{var ct;return J==null||(ct=J.error)===null||ct===void 0||(ct=ct.data)===null||ct===void 0?void 0:ct.desc}).filter(J=>!!J))]})})(C);const V=Cg(C,Vn.CHOOSE_SERVER),W=Cg(C,Vn.CLOUD_PROXY_FALLBACK);return yO(V),{gatewayInfo:hO(V,h),proxyInfo:W,opid:I,requestTime:E,url:h,isHttp3:d,elapse:Date.now()-E}}catch(C){throw C}}(r,t,e),closeFn:r=>r.code===L.OPERATION_ABORTED||r.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function Z1(t,e,n,i){const r=M("PROXY_SERVER_TYPE3"),s=(g,I,y)=>{let C=y||r;return Array.isArray(C)&&(C=I%2==0?r[1]:r[0]),"https://".concat(C,"/ap/?url=").concat(g)};let c=null;const l=[],d=async()=>{const g=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map((C,N)=>{let D;return D=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(C,"/api/v2/transpond/webrtc?v=2"):s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N),{url:D,areaCode:Og(),serviceIds:[Vn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(t.clientId,"] Connect to choose_server:"),C.url),Y1(C,t,e,n)),allFailedhandler:C=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y},h=async()=>{if(await _i(1e3),c!==null)return c;const g=M("WEBCS_DOMAIN_BACKUP_LIST").map((C,N)=>{let D;return D=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(C,"/api/v2/transpond/webrtc?v=2"):s("".concat(C,"/api/v2/transpond/webrtc?v=2"),N),{url:D,areaCode:Og(),serviceIds:[Vn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Vn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Vn.CLOUD_PROXY:Vn.CLOUD_PROXY_FALLBACK]}}),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(C=>C.url)}),y=await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:C=>(T.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),C.url),Y1(C,t,e,n)),allFailedhandler:C=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:C},I),C[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),y};let p,m,E;try{({gatewayInfo:p,proxyInfo:m,url:E}=await hm([d(),h()]))}catch(g){throw g[0]}if(l.length&&l.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),!p||!m)throw new z(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=E,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&E){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(E)[1];Et(r).call(r,g)&&(t.proxyServer=g,T.setProxyServer(g),Mt.setProxyServer(g))}return c={gatewayInfo:p,proxyInfo:await v1(m,p.uid)},c}async function qH(t,e,n){const i=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(s=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),r=i.map(s=>function(c,l,d,h){const p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:Ua,cname:l.cname,uid:l.uid.toString(),requestId:vO,seq:vO};vO+=1;const m={service_name:"tele_channel",json_body:JSON.stringify(p)};return to(async()=>{const E=await ao(c,{data:m,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const I=new z(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw T.error(I.toString()),I}const g=JSON.parse(E.json_body);if(g.code!==200){const I=new z(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw T.error(I.toString()),I}if(!g.servers||g.servers.length===0){const I=new z(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(I.toString()),I}return{vid:g.vid,workerToken:g.workerToken,addressList:(M("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(I.wss))}},void 0,E=>!!(E.code!==L.OPERATION_ABORTED&&E.code!==L.UNEXPECTED_RESPONSE||E.data&&E.data.retry),h)}(s,t,e,n));try{const s=await hm(r);return r.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function XH(t,e,n){let i=null;const r=[],s=async c=>{const l=M(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await _i(1e3),i!==null)?i:await wg({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(T.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),function(h,p,m,E){const[g]=KH(p,[Vn.CHOOSE_SERVER]);let I=xn.networkState;return to(async()=>{I&&xn.networkState===Zr.OFFLINE&&xn.onlineWaiter&&await St.race([xn.onlineWaiter,_i(E&&E.maxRetryTimeout||Hn.maxRetryTimeout)]),I=xn.networkState;const y=await ao(h,{data:g,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return WH(y,h)},()=>!1,y=>y.code!==L.OPERATION_ABORTED&&(y.code===L.UPDATE_TICKET_FAILED?y.data.retry:(T.warning("[".concat(p.clientId,"] update ticket network error, retry"),y),!0)),E)}(d,t,e,n)),allFailedhandler:d=>{throw d[0]},promisesCollector:r})};try{return i=await hm([s(!1),s(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function $1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function bO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$1(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class JH extends hn{get isSuccess(){return!!this.configs}constructor(e,n){super(),O(this,"configs",void 0),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"cancelToken",void 0),O(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O(this,"interval",void 0),O(this,"mutex",void 0),O(this,"mutableParamsRead",!1),O(this,"configCache",{}),O(this,"limit_bitrate",void 0),this.mutex=new Ui("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),M("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},M("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Mt.reportApiInvoke(null,{options:void 0,name:Gn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:gn.TRACER}).onSuccess(JSON.stringify(eo))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await zH(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var s;const c=J_(s=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const m=c[p],E=r[m].value;if(typeof E.__priority=="number"){const g=E.__priority,I=c[p-1],y=r[I].value;if(typeof y.__priority=="number"){if(!(g>y.__priority))continue;{const C=m;c[p]=c[p-1],c[p-1]=C}}else{const C=m;c[p]=c[p-1],c[p-1]=C}}}const l=Date.now();let d={};return c.forEach(h=>{const p=r[h].value.__expires;p&&p<=l||(d[h]=r[h])}),d}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new z(L.NETWORK_RESPONSE_ERROR,i);T.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){u1(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(Rg.UPDATE_BITRATE_LIMIT,e):this.emit(Rg.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&bO({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(s=>{const c=e[s].value;n[s]=c;const l=c.__id;if(l&&this.configCache[s]&&this.configCache[s].__id===l)return;const d=c.__type,h=e[s].value,p=e[s].tag;let m=0;d?d===BP.REALTIME&&(m=1):Object.keys(h).some(E=>Object.prototype.hasOwnProperty.call(PI,E)||!nO()&&Object.prototype.hasOwnProperty.call(Wv,E)?(m=1,!0):void 0),r.push({tag:p,isApplied:m,feature:s,params:JSON.stringify(c)})}),r.forEach(s=>{let{tag:c,feature:l,params:d,isApplied:h}=s;this.store.sessionId&&Mt.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){T.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const s={};return Object.keys(r).forEach(c=>{const l=r[c].value,d=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=bO(bO({value:l[p]},d&&{expires:d}),h&&{type:h}))})}),s}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&u1(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const d=Date.now();Object.keys(l).forEach(h=>{const{value:p,type:m,expires:E}=l[h];E&&E<=d||((m===BP.REALTIME||Object.prototype.hasOwnProperty.call(PI,h))&&(eo[h]=p,en[h]=p,T.debug("Update realtime parameters from config distribute",h,p)),m||nO()||!Object.prototype.hasOwnProperty.call(Wv,h)||(eo[h]=p,en[h]=p,T.debug("Update gateway parameters from config distribute",h,p)))})}catch(d){T.error("Error update config immediately: ".concat(l),d.message)}}(n);const s=JSON.stringify(n),c=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",c),T.debug("Caching global parameters ".concat(s))}catch(r){T.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(en,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(en[i],r)||(eo[i]=r,en[i]=r,this.emit(Rg.UPDATE_CLIENT_ROLE_OPTIONS,r),T.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){T.error("Error handling global parameter config:",n.message)}}}class QH extends hn{constructor(){super(...arguments),O(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(M("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var s;const c=Et(s=r.result).call(s,!0);r.isPrevNormal&&!c&&this.emit("exception",tU[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",tU[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof qn&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=$r(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof qn&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const tU={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Bi=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function eU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function mh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class Ng{constructor(e){O(this,"store",void 0),O(this,"onStatsException",void 0),O(this,"onUploadPublishDuration",void 0),O(this,"onStatsChanged",void 0),O(this,"localStats",new Map),O(this,"remoteStats",new Map),O(this,"updateStatsInterval",void 0),O(this,"trafficStats",void 0),O(this,"trafficStatsPeerList",[]),O(this,"uplinkStats",void 0),O(this,"exceptionMonitor",void 0),O(this,"p2pChannel",void 0),O(this,"scalabilityMode",Hv.L1T1),O(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new QH,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ot.LocalAudioTrack)||mh({},VI)}getLocalVideoTrackStats(){return this.localStats.get(ot.LocalVideoTrack)||mh({},BI)}getRemoteAudioTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{networkStats:c}]=r;c&&(n[s]=c)});return n}getRemoteVideoTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const s=this.localStats.get(ot.LocalAudioTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const c=this.localStats.get(ot.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(ot.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:m}=h;p&&(i+=p.receiveBytes,r+=p.receiveBitrate),m&&(i+=m.receiveBytes,r+=m.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),s=r!=null&&r.videoSSRC?Bi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?Bi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,s=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case ot.LocalVideoTrack:case ot.LocalVideoLowTrack:{const c=r,l=mh({},BI),d=e.getStats(),h=e.getLocalMedia(i);if(d){const p=d.videoSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){const m=e.getLocalVideoSize(),E=e.getEncoderConfig(ot.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):m&&(l.captureResolutionWidth=m.width,l.captureResolutionHeight=m.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):m&&(l.sendResolutionWidth=m.width,l.sendResolutionHeight=m.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),E&&E.bitrateMax&&(l.targetSendBitrate=1e3*E.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(i,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&h&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,h.track,l);break}case ot.LocalAudioTrack:{const c=r,l=mh({},VI),d=e.getStats(),h=e.getLocalMedia(i);if(d){const p=d.audioSend.find(m=>m.ssrc===(h==null?void 0:h.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const m=e.getLocalAudioVolume();m&&(l.sendVolumeLevel=Math.round(32767*m))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendJitterMs=p.jitterMs,l.sendRttMs=p.rttMs,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ot.LocalAudioTrack,l),l&&h&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,h.track,l);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[s,{videoStats:c,audioStats:l,videoPcStats:d}]=n;const h=l,p=c,m=d,E=mh({},JP),g=mh({},QP),I=mh({},M5),{audioTrack:y,videoTrack:C,audioSSRC:N,videoSSRC:D}=e.getRemoteMedia(s);let V;V=this.store.useP2P?e.getStats(!0):e.getStats();const W=(i=V)===null||i===void 0?void 0:i.audioRecv.find(ct=>ct.ssrc===N),K=(r=V)===null||r===void 0?void 0:r.videoRecv.find(ct=>ct.ssrc===D),j=this.trafficStats&&this.trafficStats.peer_delay.find(ct=>ct.peer_uid===s);if(W&&(W.codec!=="opus"&&W.codec!=="aac"&&W.codec!=="PCMU"&&W.codec!=="PCMA"&&W.codec!=="G722"||(E.codecType=W.codec),W.outputLevel?E.receiveLevel=Math.round(32767*W.outputLevel):y&&(E.receiveLevel=Math.round(32767*y.getVolumeLevel())),E.receiveBytes=W.bytes,E.receivePackets=W.packets,E.receivePacketsLost=W.packetsLost,E.receivePacketsDiscarded=W.packetsDiscarded,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=h?8*Math.max(0,E.receiveBytes-h.receiveBytes):0,E.totalDuration=h?h.totalDuration+1:1,E.totalFreezeTime=h?h.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=W.jitterBufferMs,E.totalDuration>10&&Ng.isRemoteAudioFreeze(y)&&(E.totalFreezeTime+=1)),K){var J;K.codec!=="H264"&&K.codec!=="H265"&&K.codec!=="VP8"&&K.codec!=="VP9"&&K.codec!=="AV1X"&&K.codec!=="AV1"||(g.codecType=K.codec),g.receiveBytes=K.bytes,g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.decodeFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,g.renderFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,K.outputFrame&&(g.renderFrameRate=K.outputFrame.frameRate),K.receivedFrame?(g.receiveFrameRate=K.receivedFrame.frameRate,g.receiveResolutionHeight=K.receivedFrame.height,g.receiveResolutionWidth=K.receivedFrame.width):C&&(g.receiveResolutionHeight=C._videoHeight||0,g.receiveResolutionWidth=C._videoWidth||0),K.framesRateFirefox!==void 0&&(g.receiveFrameRate=Math.round(K.framesRateFirefox)),g.receivePackets=K.packets,g.receivePacketsLost=K.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost);const ct=p?p.totalFreezeTime:0,vt=p?p.totalDuration:0;g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=(J=K.totalFreezesDuration)!==null&&J!==void 0?J:ct||0,g.receiveDelay=K.jitterBufferMs||0;const At=!!D&&e.getRemoteVideoIsReady(D);K.totalFreezesDuration===void 0&&C&&At&&Ng.isRemoteVideoFreeze(C,K,m)&&(g.totalFreezeTime+=1),g.freezeRate=Math.max(0,Math.min((g.totalFreezeTime-ct)/(g.totalDuration-vt),1))}j&&(E.end2EndDelay=j.B_ad,g.end2EndDelay=j.B_vd,E.transportDelay=j.B_ed,g.transportDelay=j.B_ed,E.currentPacketLossRate=j.B_ealr4/100,g.currentPacketLossRate=j.B_evlr4/100,I.uplinkNetworkQuality=j.B_punq?j.B_punq:0,I.downlinkNetworkQuality=j.B_pdnq?j.B_pdnq:0),this.remoteStats.set(s,{audioStats:E,videoStats:g,videoPcStats:K,networkStats:I}),y&&this.exceptionMonitor.setRemoteAudioStats(y,E),C&&this.exceptionMonitor.setRemoteVideoStats(C,g)})}}class nU{constructor(){O(this,"destChannelMediaInfos",new Map),O(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){c1(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){c1(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){ly(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function iU(t){if(!(t instanceof nU))return new z(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new z(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new z(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Au{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){O(this,"uid",void 0),O(this,"_uintid",void 0),O(this,"_trust_in_room_",!0),O(this,"_trust_audio_enabled_state_",!0),O(this,"_trust_video_enabled_state_",!0),O(this,"_trust_audio_mute_state_",!0),O(this,"_trust_video_mute_state_",!0),O(this,"_audio_muted_",!1),O(this,"_video_muted_",!1),O(this,"_audio_enabled_",!0),O(this,"_video_enabled_",!0),O(this,"_audio_added_",!1),O(this,"_video_added_",!1),O(this,"_is_pre_created",!1),O(this,"_video_pre_subscribed",!1),O(this,"_audio_pre_subscribed",!1),O(this,"_trust_video_stream_added_state_",!0),O(this,"_trust_audio_stream_added_state_",!0),O(this,"_audioTrack",void 0),O(this,"_videoTrack",void 0),O(this,"_dataChannels",[]),O(this,"_audioSSRC",void 0),O(this,"_videoSSRC",void 0),O(this,"_audioOrtc",void 0),O(this,"_videoOrtc",void 0),O(this,"_cname",void 0),O(this,"_rtxSsrcId",void 0),O(this,"_videoMid",void 0),O(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function rU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function aU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Dg="9",sU=4e4;function oU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?oU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var pm=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(pm||{});const yy=new Map;function cU(t,e,n,i){let{scale:r}=t;if(r===0&&i===pm.UP||r>=e.length-1&&i===pm.DOWN)return t;let s=sl(sl({},t),{},{scale:i===pm.DOWN?++r:--r});switch(n){case"maintain-framerate":s=sl(sl({},s),e[r].motion);break;case"maintain-resolution":s=sl(sl({},s),e[r].detail);break;case"balanced":s=sl(sl({},s),e[r].balanced)}return s}function lU(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:uU(e)};yy.set(t,n)}else yy.delete(t)}function uU(t){const e=sl({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:s}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:E,PERF_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:y,BALANCE_FRAMERATE_FACTOR:C,BALANCE_RESOLUTION_FACTOR:N,MOTION_RESOLUTION_FACTOR:D,MOTION_BITRATE_FACTOR:V,DETAIL_FRAMERATE_FACTOR:W,DETAIL_BITRATE_FACTOR:K}=DI,j=Math.min(e.frameRate,l),J=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(E,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(g,1)*j),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s}}];for(let ct=1;ct<=d;ct++){const vt={bwe_up:Math.round(Math.pow(m,ct)*n),bwe_down:Math.round(Math.pow(E,ct+1)*n),fps_up:Math.round(Math.pow(I,ct)*j),fps_down:Math.round(Math.pow(g,ct+1)*j)},At={scaleResolutionDownBy:r/Math.pow(N,ct),frameRate:Math.max(Math.round(Math.pow(C,ct)*i),c),bitrateMax:Math.max(Math.round(Math.pow(y,ct)*n),p),bitrateMin:Math.max(Math.round(Math.pow(y,ct)*s),h)},le={scaleResolutionDownBy:r/Math.pow(D,ct),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(V,ct)*n),p),bitrateMin:Math.max(Math.round(Math.pow(V,ct)*s),h)},ue={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(W,ct)*i),c),bitrateMax:Math.max(Math.round(Math.pow(K,ct)*n),p),bitrateMin:Math.max(Math.round(Math.pow(K,ct)*s),h)};J.push({scale:ct,threshold:vt,balanced:At,motion:le,detail:ue})}return J}function ZH(t,e,n,i,r,s){const c=yy.get(t)||{overUse:0,underUse:0,adaptationList:uU(r)},{adaptationList:l}=c;yy.set(t,c);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=DI,{scale:p}=i;let m,E;return typeof e=="number"&&e>0&&function(g,I,y,C){if(I>=y.length)return!1;let{threshold:{fps_down:N}}=y[I];return M("FORCE_AG_HIGH_FRAMERATE")&&C==="maintain-framerate"&&(N=y[0].threshold.fps_down),g<N}(e,p,l,s)&&(c.overUse++,E=mg.CPU,c.overUse>d)||typeof n=="number"&&n>0&&function(g,I,y){if(I>=y.length)return!1;const{threshold:{bwe_down:C}}=y[I];return g<C}(n,p,l)&&(c.overUse++,E=mg.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,m=cU(i,l,s,pm.DOWN),[m,E]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(g,I,y,C){if(I===0)return;let{threshold:{fps_up:N}}=y[I];return M("FORCE_AG_HIGH_FRAMERATE")&&C==="maintain-framerate"&&(N=y[1].threshold.fps_up),g>N}(e,p,l,s)&&function(g,I,y){if(I===0)return;const{threshold:{bwe_up:C}}=y[I];return g>C}(n,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,m=cU(i,l,s,pm.UP),m.scale===0&&(E=mg.NONE))),[m,E])}function dU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function IO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?dU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function $H(t){var e;return!!M("ENABLE_AG_ADAPTATION")&&!!(t instanceof qI||Et(e=t._hints).call(e,ze.CUSTOM_TRACK))&&(!!M("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=_e();if(i.os!==ei.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&oP(17,4)||sP(14)&&cP(17,4,!0)))}const Cy=new Map;function Ay(t,e){const n=Cy.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),Cy.delete(t)}e.qualityLimitationReason=mg.NONE,lU(t)}function t6(t,e){var n;let i;switch(e){case ot.LocalAudioTrack:i=we.Audio;break;case ot.LocalVideoTrack:i=Et(n=t._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalVideoLowTrack:i=we.Low}return i}function OO(t){const e=Te();if(t.some(n=>n._bypassWebAudio))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function wO(t,e){OO(t);const n=new qn;return t.forEach(i=>n.addAudioTrack(i)),n}const e6=!Te().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Jc();function by(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return e6?(n={spec:e,store:t},rl("PlanBConnection").create(n)):new rc(e,t)}function NO(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function hU(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(hg(t.turnServer.servers))return!1;if(M("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var me;function pU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function so(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let rc=(me=class Dh extends h1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Et(n=Object.keys(Kv)).call(n,e)}))]}constructor(e,n){super(e,n),O(this,"id",Ye(5,"connection-")),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"forceTurn",!1),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:M("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"preSSRCMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"supportAV1RtpSpec",!1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",mg.NONE),O(this,"isFirstConnected",!1),this.store=n,this.forceTurn=hU(e),this.mutex=new Ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Dh.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=OI(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,En()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=yu(i.sdp),s=await L1({filterRTX:!M("USE_PUB_RTX")&&!M("USE_SUB_RTX"),filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterVideoCodec:M("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=gy(s),this.initialOffer=i,M("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Hv.L1T3}]});const h=await d.createOffer();if(!h.sdp)return void d.close();const p=Mr(h.sdp).mediaDescriptions[0];if(!p)return;const m=p.attributes.extmaps.find(E=>E.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),m}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=s.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&U1(i.sdp)&&(c=Sn(s),(n=c).send&&(cm(It.VIDEO,n.send.videoExtensions),cm(It.AUDIO,n.send.audioExtensions)),n.recv&&(cm(It.VIDEO,n.recv.videoExtensions),cm(It.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(cm(It.VIDEO,n.sendrecv.videoExtensions),cm(It.AUDIO,n.sendrecv.audioExtensions))),so(so({},r),{},{rtpCapabilities:c||s,offerSDP:i.sdp})}catch(i){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&U1(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(my(It.VIDEO,n.send.videoExtensions,i.send.videoExtensions),my(It.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(my(It.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),my(It.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Sn(this._localCapabilities)}get rtpCapabilities(){return Sn(this._rtpCapabilities)}get candidates(){return Sn(this._candidates)}get iceParameters(){return Sn(this._iceParameters)}get dtlsParameters(){return Sn(this._dtlsParameters)}constructor(h){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_originCandidates",void 0),O(this,"_iceParameters",void 0),O(this,"_isUseExtmapAllowMixed",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),O(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,h=Sn(h);const{iceParameters:m,dtlsParameters:E,candidates:g,rtpCapabilities:I,setup:y,localCapabilities:C,cname:N}=h;this._rtpCapabilities=I,this._candidates=g,this._originCandidates=Sn(g),this._iceParameters=m,this._dtlsParameters=E,this._localCapabilities=C,this.setup=y,this.cname=N,this.sessionDesc=this.updateRemoteRTPCapabilities(I),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(h){const p=this.candidates,m=this.dtlsParameters,E=this.iceParameters,g=this.rtpCapabilities.send;let I=this.sessionDesc.mediaDescriptions.length-1;for(let y=1;y<h;y++){const C=2*y+2e4,N=2*y+sU,{ssrcs:D,ssrcGroups:V}=fh([{ssrcId:C}],this.cname),{ssrcs:W,ssrcGroups:K}=fh([{ssrcId:N,rtx:M("USE_SUB_RTX")?N+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.videoCodecs.map(j=>j.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:E.iceUfrag,icePwd:E.icePwd,unrecognized:[],candidates:p,extmaps:g.videoExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:W,ssrcGroups:K,rtcpFeedbackWildcards:[],payloads:g.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++I)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.audioCodecs.map(j=>j.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:E.iceUfrag,icePwd:E.icePwd,unrecognized:[],candidates:p,extmaps:g.audioExtensions,fingerprints:m.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:D,ssrcGroups:V,rtcpFeedbackWildcards:[],payloads:g.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++I)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return gu(this.sessionDesc)}send(h,p,m,E){const{ssrcs:g,ssrcGroups:I}=fh(p,this.cname,M("SYNC_GROUP")?m:void 0),y=this.findPreloadMediaDesc(g);if(y){if(En()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,y.attributes.mid),E&&(E.twcc||E.remb)){const C=this.sessionDesc.mediaDescriptions.indexOf(y);return this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(y,E),{mid:y.attributes.mid,needExchangeSDP:!0}}return{mid:y.attributes.mid,needExchangeSDP:!1}}{const C=this.findAvailableMediaIndex(h,g);let N;return C===-1||C===1&&(Ii()||function(){const D=_e();return!(D.name!==Ce.CHROME||!D.osVersion)&&Number(D.version)<=90}()||M("ENABLE_ENCODED_TRANSFORM")&&Xc())||C===0&&M("USE_SUB_RTX")||lP()?(N=this.createOrRecycleSendMedia(h,g,I,"sendonly",E),this.updateBundleMids()):(N=Sn(this.sessionDesc.mediaDescriptions[C]),N.attributes.direction="sendonly",N.attributes.ssrcs=g,N.attributes.ssrcGroups=I,this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(N,E)),En()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,N.attributes.mid),{mid:N.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:p}}batchSend(h){const p=h.map(g=>{let{kind:I,ssrcMsg:y,mslabel:C}=g;return this.send(I,y,C)}),m=[];let E=!1;return p.forEach(g=>{let{mid:I,needExchangeSDP:y}=g;y&&(E=!0),m.push(I)}),{mids:m,needExchangeSDP:E}}stopSending(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(m=>{m.attributes.mid==="0"||En()||lP()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")}),this.updateBundleMids()}mute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>Et(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="inactive"})}unmuteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>Et(h).call(h,m.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(m=>{m.attributes.direction="recvonly"})}receive(h,p,m,E){h.forEach((g,I)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",p,m,E[I])}),this.updateBundleMids()}stopReceiving(h){const p=this.sessionDesc.mediaDescriptions.filter(m=>h.indexOf(m.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(m=>{m.media.port="0",m.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const p=this.sessionDesc||Mr((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=h;const E=this.rtpCapabilities.send,g=this.localCapabilities.send;for(const I of p.mediaDescriptions){if(I.attributes.iceUfrag=this._iceParameters.iceUfrag,I.attributes.icePwd=this._iceParameters.icePwd,I.attributes.fingerprints=this._dtlsParameters.fingerprints,I.attributes.candidates=this._candidates,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"){if(E.videoCodecs.length===0){const y=g.videoCodecs.filter(C=>{var N,D;return(N=C.rtpMap)===null||N===void 0?void 0:Et(D=N.encodingName.toLowerCase()).call(D,"vp8")})||[g.videoCodecs[0]];I.media.fmts=y.map(C=>C.payloadType.toString(10)),I.attributes.payloads=y,I.attributes.extmaps=[]}else if(I.media.fmts=E.videoCodecs.map(y=>y.payloadType.toString(10)),I.attributes.payloads=E.videoCodecs,I.attributes.extmaps=E.videoExtensions,M("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:y,ssrcGroups:C}=fh([{ssrcId:sU,rtx:M("USE_SUB_RTX")?40001:void 0}],this.cname);I.attributes.ssrcs=y,I.attributes.ssrcGroups=C}}if(I.media.mediaType==="audio"){if(E.audioCodecs.length===0){const y=g.audioCodecs.filter(C=>{var N,D;return(N=C.rtpMap)===null||N===void 0?void 0:Et(D=N.encodingName.toLowerCase()).call(D,"opus")})||[g.audioCodecs[0]];I.media.fmts=y.map(C=>C.payloadType.toString(10)),I.attributes.payloads=y,I.attributes.extmaps=[]}else if(I.media.fmts=E.audioCodecs.map(y=>y.payloadType.toString(10)),I.attributes.payloads=E.audioCodecs,I.attributes.extmaps=E.audioExtensions,um(I),M("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:y,ssrcGroups:C}=fh([{ssrcId:2e4}],this.cname);I.attributes.ssrcs=y,I.attributes.ssrcGroups=C}}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(h){const p=this._originCandidates.filter(E=>E.transport==="udp"),m=[];if(p.forEach(E=>{m.push(aU(aU({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}),p.length!==0){switch(h){case Vi.TCP_RELAY:this._candidates=m;break;case Vi.UDP_TCP_RELAY:case Vi.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}}restartICE(h){h=Sn(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let m=0;m<h;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(h,p){return this.sessionDesc.mediaDescriptions.findIndex(m=>{const E=m.media.mediaType===h&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(En()){if(E){const g=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(g||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!g||g!==m.attributes.mid)}return!1}return E})}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:Dg,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,p,m,E,g,I){const y=h._mediaStreamTrack.kind,C=this.rtpCapabilities.recv,N=bg(y,C,this.localCapabilities.send,y===It.VIDEO?E:g),D=y===It.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;const V="".concat(this.currentMidIndex);let W={media:{mediaType:y,port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.map(j=>j.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:D,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:N,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(V)}};W=this.mungRecvMediaDsec(W,h,I);const K=this.findFirstClosedMedia(y);if(K){const j=this.sessionDesc.mediaDescriptions.indexOf(K);this.sessionDesc.mediaDescriptions[j]=W}else this.sessionDesc.mediaDescriptions.push(W);return W}updateRemoteCodec(h,p,m){const E=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"").filter(W=>{var K;return Et(K=Object.keys(Kv)).call(K,W)}))],g=new Set(p);if(E.every(W=>g.has(W)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const I=this._rtpCapabilities.recv.videoCodecs.filter(W=>p.some(K=>{var j;return Et(j=W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||"").call(j,K)}));if(I.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(E," codecs: ").concat(p)),!1;const y=[...new Set(I.map(W=>W.rtpMap&&W.rtpMap.encodingName.toLowerCase()||""))];let C;if(T.debug("updateRemoteCodec, from ".concat(E," to ").concat(y)),h.length===0)C=this.sessionDesc.mediaDescriptions.filter(W=>W.media.mediaType==="video"&&W.attributes.direction==="recvonly");else if(C=this.sessionDesc.mediaDescriptions.filter(W=>W.attributes.mid&&Et(h).call(h,W.attributes.mid)&&W.attributes.direction==="recvonly"),C.length!==h.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(p)),!1;if(M("USE_PUB_RTX")||M("USE_SUB_RTX")){const W=EO(I,this.rtpCapabilities.recv.videoCodecs);I.push(...W)}this._rtpCapabilities.recv.videoCodecs=I;const N=this.localCapabilities.send,D=this.rtpCapabilities.recv,V=bg(It.VIDEO,D,N,m);return C.forEach(W=>{const K=V.map(j=>j.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(W.attributes.mid,", from"),W.attributes.payloads,"to",V),W.attributes.payloads=V,W.media.fmts=K}),!0}createOrRecycleSendMedia(h,p,m,E,g){const I=this.rtpCapabilities.send,y=h===It.VIDEO?I.videoCodecs:I.audioCodecs,C=h===It.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const N="".concat(this.currentMidIndex);let D={media:{mediaType:h,port:Dg,protos:["UDP","TLS","RTP","SAVPF"],fmts:y.map(W=>W.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(N)}};D=this.mungSendMediaDesc(D,g);const V=this.findFirstClosedMedia(h);if(V){const W=this.sessionDesc.mediaDescriptions.indexOf(V);this.sessionDesc.mediaDescriptions[W]=D}else this.sessionDesc.mediaDescriptions.push(D);return D}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,p,m){const E=Sn(h);return fO(E),lm(E,p),mO(E,p),N1(E),_y(E,m,this.localCapabilities.send),E}mungSendMediaDesc(h,p){const m=Sn(h);return _y(m,p,this.localCapabilities.recv),um(m),m}updateRecvMedia(h,p){const m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h);if(m!==-1){const E=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=E}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(p=>En()?p.media.port==="0"&&p.media.mediaType===h:p.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===h[0].ssrcId})}getSSRC(h){var p;return(p=this.sessionDesc.mediaDescriptions.find(m=>m.attributes.mid===h))===null||p===void 0?void 0:p.attributes.ssrcs}}(so(so({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),s=k1(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),M("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(M("PRELOAD_MEDIA_COUNT"));const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}const{preSSRCs:d}=e;if(Array.isArray(d)&&d.length>0){const{mids:h}=this.remoteSDP.batchSend(d.map(p=>({kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,m)=>{this.preSSRCMap.set(d[m].ssrcId,p)}),await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));r.forEach((s,c)=>{this.preSSRCMap.set(i[c].ssrcId,s)})}await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Ma(function*(){const s=yield Ee(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=fy();e.forEach(C=>{const N=r.peerConnection.addTransceiver(C._mediaStreamTrack,so({direction:"sendonly"},C.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(N),C._updateRtpTransceiver(N)}),En()&&M("SIMULCAST")===!0&&(yield Ee(r.applySimulcastForFirefox(c,e)));const d=yield Ee(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(e.length),p=r.mungSendOfferSDP(d.sdp,e,h),m=Mr(p),E=h.map(C=>{const N=m.mediaDescriptions.find(D=>D.attributes.mid===C);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return I1(N,M("USE_PUB_RTX"))});let g;try{g=yield E}catch(C){g=[],r.remoteSDP.receive(e,n,i,g);const N=r.remoteSDP.toString();throw yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield Ee(r.stopSending(h,!0)),C}r.remoteSDP.receive(e,n,i,g);const I=r.remoteSDP.toString(),y=r.logSDPExchange(p,"offer","local","send");return yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(r.applySimulcastEncodings(c,e)),yield Ee(r.applySendEncodings(c,e)),y==null||y(I),yield Ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:I})),c.map((C,N)=>{const D=h[N];return{localSSRC:E[N],id:D,transceiver:C}})}catch(c){throw c instanceof $?c:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:M("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(s=>{s._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof $?i:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof $?n:new $(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{var h;Ay(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await Ig(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const s=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:r,transceiver:s}})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,d]=c;if(d===s)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Ma(function*(){const i=yield Ee(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Te().supportPCSetConfiguration,s=M("FORCE_TURN_TCP")||n.forceTurn;if(e===Vi.RELAY&&!r)return;if(r&&!s){const m=e===Vi.RELAY?"relay":"all",E=n.peerConnection.getConfiguration();E.iceTransportPolicy!==m&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(m,"]")),E.iceTransportPolicy=m,n.peerConnection.setConfiguration(E))}n.remoteSDP.updateCandidates(e);const c=yield Ee(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=yu(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),p=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ee(n.peerConnection.setLocalDescription(c)),p==null||p(h),yield Ee(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Vi.TCP_RELAY),await Ig(this.peerConnection,this.remoteSDP,this.extension)}catch(n){T.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{Ay(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return so(so({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?En()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:so(so({},Zo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:so(so({},Zo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(hg(e.turnServer.servers)?n.iceServers=e.turnServer.servers:M("NEW_TURN_MODE")&&n.iceServers?(M("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...Dh.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...Dh.newTurnServerConfigToIceServers(e.turnServer.servers)),M("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...Dh.turnServerConfigToIceServers(e.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Dh.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),M("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&Te().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ru(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!M("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const r=M("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ru(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Ru(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:s}=i.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(C=>C.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Te().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},c={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const l=function(y,C){return y.getTransceivers().find(N=>N.sender.track===C||N.receiver.track===C)}(this.peerConnection,e._mediaStreamTrack),d=F5(e);if($H(e)&&l&&n&&d&&this.getLocalVideoStats&&Et(i=["vp8","vp9"]).call(i,this.store.codec)){var h;const y=s.degradationPreference||(Et(h=e._hints).call(h,ze.CUSTOM_TRACK)?M("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(C,N,D,V,W,K){if(Ay(C,D),W(N),V!=="balanced"&&V!=="maintain-framerate"&&V!=="maintain-resolution")return;let j=-1;lU(C,N);const J=window.setInterval(()=>{const vt=Cy.get(C);if(!M("ENABLE_AG_ADAPTATION")||!vt)return Ay(C,D),void W(N);const At=K();if(At.sendPackets>0&&At.OutgoingAvailableBandwidth>0){if(j===-1)return void(j=Date.now());if(Date.now()-j<1e3)return;const le=At.sendFrameRate,ue=At.OutgoingAvailableBandwidth,[qe,Ln]=ZH(C,le,ue,vt.adaptationConfig,N,V);Ln&&(D.qualityLimitationReason=Ln),qe&&vt.adaptationConfig.scale!==qe.scale&&(T.debug("[".concat(C,"] applyAdaptation: ").concat(D.qualityLimitationReason,`
           sendFps `).concat(le,", bwe ").concat(ue,", switch from ").concat(vt.adaptationConfig.scale," to ").concat(qe.scale," ")),vt.adaptationConfig=IO(IO({},vt.adaptationConfig),qe),W(qe))}},M("CHECK_LOCAL_STATS_INTERVAL")),ct=IO({},N);Cy.set(C,{timer:J,adaptationConfig:ct,originConfig:N,adaptationFunc:W}),T.debug("[".concat(C,"] start adaptation, originConfig: ").concat(JSON.stringify(N),", degradationPreference: ").concat(V))})(this.id+l.mid,d,this,y,C=>{n&&this.updateAdaptation(n,C)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;const{bitrateMax:y,frameRate:C,scaleResolutionDownBy:N}=e._encoderConfig;y&&(c.maxBitrate=1e3*y),(Et(p=e._hints).call(p,ze.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(C&&(c.maxFramerate=$r(C)),N&&N>=1&&(c.scaleResolutionDownBy=N))}const{maxFramerate:m}=M("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,m):m),M("DSCP_TYPE")&&Jc()){var E;const y=M("DSCP_TYPE");Et(E=["very-low","low","medium","high"]).call(E,y)&&(c.networkPriority=y)}const g=n.getParameters(),I=(r=g.encodings)===null||r===void 0?void 0:r[0];En()&&!I&&(s.encodings=[c]),I&&Object.assign(I,c),Object.assign(g,s),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await async function(y,C,N){try{var D;if(!Te().supportSetRtpSenderParameters||!function(J){return J==="vp9"||J==="av1"}(y)||!M("ENABLE_SVC"))return;const V={},W={},K=C.getParameters(),j=(D=K.encodings)===null||D===void 0?void 0:D[0];W.scalabilityMode=fy(N),j&&Object.assign(j,W),Object.assign(K,V),await C.setParameters(K),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(K.encodings)))}catch(V){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",V)}}(this.store.codec,n,M("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return T.debug("[updateAdaptation] no rtpSender found");if(!Te().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=n;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=$r(l)),d&&d>=1&&Et(i=["vp8","vp9"]).call(i,this.store.codec)&&(s.scaleResolutionDownBy=d);const h=e.getParameters(),p=(r=h.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,s),Object.assign(h,{});try{await e.setParameters(h),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(m){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):T.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!Te().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof nn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Mr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(lm(d,s),D1(d,s,this.store.codec))}),gu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof nn&&!Et(i=p._hints).call(i,ze.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,m))}}}async applySimulcastEncodings(e,n){if(!En()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof nn&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof nn&&M("SIMULCAST")&&this.store.codec==="vp8"&&!Et(n=e._hints).call(n,ze.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(M("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(Te().supportPCSetConfiguration){const n=Dh.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Lt(me.prototype,"updateRemoteRTPCapabilities",[gr],Object.getOwnPropertyDescriptor(me.prototype,"updateRemoteRTPCapabilities"),me.prototype),Lt(me.prototype,"connect",[gr],Object.getOwnPropertyDescriptor(me.prototype,"connect"),me.prototype),Lt(me.prototype,"updateRemoteConnect",[gr],Object.getOwnPropertyDescriptor(me.prototype,"updateRemoteConnect"),me.prototype),Lt(me.prototype,"createDataChannels",[gr],Object.getOwnPropertyDescriptor(me.prototype,"createDataChannels"),me.prototype),Lt(me.prototype,"receive",[gr],Object.getOwnPropertyDescriptor(me.prototype,"receive"),me.prototype),Lt(me.prototype,"batchReceive",[gr],Object.getOwnPropertyDescriptor(me.prototype,"batchReceive"),me.prototype),Lt(me.prototype,"stopReceiving",[gr],Object.getOwnPropertyDescriptor(me.prototype,"stopReceiving"),me.prototype),Lt(me.prototype,"muteRemote",[gr],Object.getOwnPropertyDescriptor(me.prototype,"muteRemote"),me.prototype),Lt(me.prototype,"unmuteRemote",[gr],Object.getOwnPropertyDescriptor(me.prototype,"unmuteRemote"),me.prototype),Lt(me.prototype,"muteLocal",[gr],Object.getOwnPropertyDescriptor(me.prototype,"muteLocal"),me.prototype),Lt(me.prototype,"unmuteLocal",[gr],Object.getOwnPropertyDescriptor(me.prototype,"unmuteLocal"),me.prototype),Lt(me.prototype,"close",[gr],Object.getOwnPropertyDescriptor(me.prototype,"close"),me.prototype),Lt(me.prototype,"updateEncoderConfig",[gr],Object.getOwnPropertyDescriptor(me.prototype,"updateEncoderConfig"),me.prototype),Lt(me.prototype,"updateSendParameters",[gr],Object.getOwnPropertyDescriptor(me.prototype,"updateSendParameters"),me.prototype),Lt(me.prototype,"replaceTrack",[gr],Object.getOwnPropertyDescriptor(me.prototype,"replaceTrack"),me.prototype),Lt(me.prototype,"updateAdaptation",[gr],Object.getOwnPropertyDescriptor(me.prototype,"updateAdaptation"),me.prototype),Lt(me.prototype,"getRemoteSSRC",[gr],Object.getOwnPropertyDescriptor(me.prototype,"getRemoteSSRC"),me.prototype),me);function gr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function DO(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=$r(e.width),i.height=$r(e.height);const r=$r(e.framerate||15);document.body.append(n),document.body.append(i);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const c=i.getContext("2d");if(!c)throw new z(L.UNEXPECTED_ERROR,"can not get canvas context");const l=Te(),d=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];d.canvas||(d.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,m=n.videoHeight/p,E=i.width*m;Math.abs(E-i.height)>=2&&(T.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(E)),i.height=E)}c.drawImage(n,0,0,i.width,i.height),d.requestFrame&&d.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},i.stopCapture=GI(()=>i.startCapture&&i.startCapture(),r);const h=d.stop;return d.stop=()=>{h.call(d),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),T.debug("clean low stream renderer")},d}var Iy=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(Iy||{}),Bn=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(Bn||{}),Eh=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(Eh||{}),Fn=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Fn||{}),_h=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(_h||{}),fU=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(fU||{}),ac=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(ac||{}),Sr=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(Sr||{}),mU=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(mU||{}),Tr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Tr||{}),Oy=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(Oy||{});const gh=1e3,Sh=6,wy=3,n6=Math.max(Sh,wy);function Wt(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function EU(t){const e={[Tr.CONN_TYPE]:0,[Tr.RTT]:t.rtt,[Tr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[Tr.CONN_TYPE]=1),n==="tcp"&&(e[Tr.CONN_TYPE]=3),n==="tls"&&(e[Tr.CONN_TYPE]=4);break}case"srflx":e[Tr.CONN_TYPE]=2;break;case"unknown":e[Tr.CONN_TYPE]=5;break;default:e[Tr.CONN_TYPE]=0}return e}function _U(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class gU extends hn{constructor(e){super(),O(this,"store",void 0),O(this,"uploadWRTCStatsTimer",void 0),O(this,"uploadOutboundDenoiserStatsTimer",void 0),O(this,"uploadExtStatsTimer",void 0),O(this,"uploadExtUsageStatsTimer",void 0),O(this,"uploadInboundExtStatsTimer",void 0),O(this,"requestStats",void 0),O(this,"requestTransportStats",void 0),O(this,"requestLocalMedia",void 0),O(this,"requestRemoteMedia",void 0),O(this,"requestAllTracks",void 0),O(this,"requestVideoIsReady",void 0),O(this,"requestUploadStats",void 0),O(this,"requestUpload",void 0),O(this,"uploadOutboundStarted",!1),O(this,"uploadInboundStarted",!1),O(this,"uploadTransportStarted",!1),O(this,"uploadBaseStatsStarted",!1),O(this,"uploadExtensionUsageStarted",!1),O(this,"lastRecvStats",void 0),O(this,"lastSendStats",void 0),O(this,"lastRefRecvStats",void 0),O(this,"lastRefSendStats",void 0),O(this,"lastFullRecvStats",void 0),O(this,"lastFullSendStats",void 0),O(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%wy==0,i=e%Sh==0;let r,s;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(s=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!s&&this.uploadInboundStarted&&(s=this.requestStats(!0)),r||s){var c;const l={};if(this.uploadTransportStarted&&r){const h=this.getTransportStats(r,s,n);h&&(l.misc=[h])}if(this.uploadOutboundStarted&&r){const h=this.getOutboundStats(r,i?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,i);h&&(l.outbound=[h])}if(this.uploadInboundStarted&&s){const h=this.getInboundStats(s,i?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,i);h&&(l.inbound=h)}const d=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;d&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Oy.RTC_PEER_CONNECTION_STATE]=II[d]):l.misc=[{addition:{[Oy.RTC_PEER_CONNECTION_STATE]:II[d]}}]),this.requestUploadStats(l)}this.lastRecvStats=s,this.lastSendStats=r,i&&(this.lastFullRecvStats=s,this.lastFullSendStats=r),n&&(this.lastRefRecvStats=s,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[Oy.RTC_PEER_CONNECTION_STATE]:II[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===n6+1&&(e=1)},gh)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[Tr.RTT]:e.rtt,[Tr.CONN_TYPE]:void 0,[Tr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=EU(e);if(this.store.useP2P){if(n){const s=EU(n);r[Tr.CONN_TYPE]+=s[Tr.CONN_TYPE]<<3}r[Tr.CONN_TYPE]+=110}else r[Tr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const s=this.requestLocalMedia();if(!s||s.length===0)return;let c,l,d;return s.forEach(h=>{let[p,{track:m,ssrcs:E}]=h;switch(p){case ot.LocalVideoLowTrack:case ot.LocalVideoTrack:if(p===ot.LocalVideoTrack){const g=function(C,N,D,V,W,K){const j=N.videoSend.find(At=>At.ssrc===C);if(!j)return;const J={},{sentFrame:ct,inputFrame:vt}=j;if(K&&(Wt(J,Bn.QP_SUM,j.qpSumPerFrame),vt&&ct)){const At=vt.frameRate,le=ct.frameRate;J[Bn.FREEZE]=function(ue,qe){let Ln=!0;return Ln=!(ue<=5)&&(ue<=10?qe<3:ue<=20?qe<4:qe<5),Ln}(At,le)?1:0}if(W){switch(ct&&(Wt(J,Bn.HEIGHT,ct.height),Wt(J,Bn.WIDTH,ct.width),Wt(J,Bn.FRAME_RATE,ct.frameRate)),J[Bn.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0,j.adaptionChangeReason){case"none":J[Bn.ADAPTATION]=0;break;case"cpu":J[Bn.ADAPTATION]=1;break;case"bandwidth":J[Bn.ADAPTATION]=2;break;case"other":J[Bn.ADAPTATION]=3}let At=0;j.adaptionChangeReason&&(At+=_U(j.adaptionChangeReason)),N.qualityLimitationReason&&(At+=_U(N.qualityLimitationReason)<<3),J[Bn.ADAPTATION]=At,J[Bn.PLAYER_STATUS]=FI[V._player?V._player.videoElementStatus:"uninit"],Wt(J,Bn.NACKS,j.nacksCount),Wt(J,Bn.PLIS,j.plisCount),Wt(J,Bn.FIRS,j.firsCount),Wt(J,Bn.AVG_ENCODE,j.avgEncodeMs),Wt(J,Bn.HUGE_FRAME_SENT,j.hugeFramesSent),Wt(J,Bn.BYTES_RETRANSMIT,j.retransmittedBytesSent),Wt(J,Bn.PACKAGES_RETRANSMIT,j.retransmittedPacketsSent),Wt(J,Bn.KEY_FRAMES_ENCODED,j.keyFramesEncoded);const le=D&&D.videoSend.find(ue=>ue.ssrc===C);if(le){let ue=W?gh:gh*Sh;le.timestamp&&j.timestamp&&(ue=j.timestamp-le.timestamp),le.packets!=null&&j.packets!=null&&Wt(J,Bn.PACKAGE_RATE,1e3*(j.packets-le.packets)/ue),j.packetsLost!=null&&le.packetsLost!=null&&Wt(J,Bn.PACKAGE_LOST,j.packetsLost-le.packetsLost),le.bytes!=null&&j.bytes!=null&&Wt(J,Bn.BITRATE,8*(j.bytes-le.bytes)/ue)}}return J}(E[0].ssrcId,e,n,m,i,r),I=m&&function(C,N,D,V){const W=N.videoSend.find(j=>j.ssrc===C);if(!W)return null;const K={};if(V){const j=W.inputFrame,J=j&&j.height||D.videoHeight||0,ct=j&&j.width||D.videoWidth||0,vt=j&&j.frameRate||0;Wt(K,Iy.HEIGHT,J),Wt(K,Iy.WIDTH,ct),Wt(K,Iy.FRAME_RATE,vt)}return K}(E[0].ssrcId,e,m,i),y=function(C,N){const D={};return N&&(Wt(D,Bn.RETRANSMIT,C.bitrate.retransmit),Wt(D,Bn.TARGET_ENCODED,C.bitrate.targetEncoded),Wt(D,Bn.ACTUAL_ENCODED,C.bitrate.actualEncoded),Wt(D,Bn.TRANSMIT,C.bitrate.transmit),Wt(D,Bn.BANDWIDTH,C.sendBandwidth)),D}(e,i);l=Object.assign({},g,I,y)}else d=function(g,I,y,C){const N=I.videoSend.find(V=>V.ssrc===g);if(!N)return;const D={};if(C){const V=N.sentFrame;if(V&&(Wt(D,Eh.HEIGHT,V.height),Wt(D,Eh.WIDTH,V.width),Wt(D,Eh.FRAME_RATE,V.frameRate)),y){const W=y.videoSend.find(K=>K.ssrc===g);if(W){let K=gh*Sh;W.timestamp&&N.timestamp&&(K=N.timestamp-W.timestamp),W.packets!=null&&N.packets!=null&&Wt(D,Eh.PACKAGE_RATE,1e3*(N.packets-W.packets)/K),N.packetsLost!=null&&W.packetsLost!=null&&Wt(D,Eh.PACKAGE_LOST,N.packetsLost-W.packetsLost),W.bytes!=null&&N.bytes!=null&&Wt(D,Eh.BITRATE,8*(N.bytes-W.bytes)/K)}}}return D}(E[0].ssrcId,e,n,i);break;case ot.LocalAudioTrack:c=m&&function(g,I,y,C,N){const D=I.audioSend.find(W=>W.ssrc===g);if(!D)return;const V={};if(N){V[ac.DISABLED]=C._originMediaStreamTrack&&!C._originMediaStreamTrack.enabled||C._mediaStreamTrack&&!C._mediaStreamTrack.enabled?1:0;const W=100*C._source.getAccurateVolumeLevel(),K=D.inputLevel;if(K!=null){const J=Math.ceil(50*Math.log10(100*K+1));Wt(V,ac.LEVEL,J)}Wt(V,fU.PCM_LEVEL,W),Wt(V,ac.AEC_RETURN_LOSS,D.aecReturnLoss),Wt(V,ac.AEC_RETURN_LOSS_ENH,D.aecReturnLossEnhancement),Wt(V,ac.BYTES_RETRANSMIT,D.retransmittedBytesSent),Wt(V,ac.PACKAGES_RETRANSMIT,D.retransmittedPacketsSent),V[ac.FREEZE]=0;const j=y&&y.audioSend.find(J=>J.ssrc===g);if(j){let J=gh*Sh;j.timestamp&&D.timestamp&&(J=D.timestamp-j.timestamp),j.bytes!=null&&D.bytes!=null&&Wt(V,ac.BITRATE,8*(D.bytes-j.bytes)/J),j.packets!=null&&D.packets!=null&&Wt(V,ac.PACKAGE_RATE,1e3*(D.packets-j.packets)/J)}}return V}(E[0].ssrcId,e,n,m,i)}}),{high:l,low:d,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[d,h]=l;const p={peer:d.uid};if(h.has(It.VIDEO)&&d.videoTrack){const m=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,E=d.videoTrack?function(g,I,y,C,N,D,V,W){const K=I.videoRecv.find(ue=>ue.ssrc===g);if(!K)return;const j={},{receivedFrame:J,outputFrame:ct,decodeFrameRate:vt}=K,At=y&&y.videoRecv.find(ue=>ue.ssrc===g);if(Wt(j,_h.FRAME_RATE_DECODE,vt),K.framesRateFirefox&&Wt(j,Fn.FRAME_RATE,K.framesRateFirefox),J&&Wt(j,Fn.FRAME_RATE,J.frameRate),Wt(j,Fn.FRAMES_DROPPED,K.framesDroppedCount),Wt(j,Fn.BYTES_RETRANSMIT,K.retransmittedBytesReceived),Wt(j,Fn.PACKAGES_RETRANSMIT,K.retransmittedPacketsReceived),Wt(j,Fn.PACKAGES_DISCARDED,K.packetsDiscarded),Wt(j,Fn.AVG_DECODE,K.avgDecodeMs),Wt(j,Fn.AVG_PROCESSING_DELAY,K.avgProcessingDelayMs),Wt(j,Fn.AVG_ASSEMBLY_TIME,K.avgFramesAssembledFromMultiplePacketsMs),Wt(j,Fn.AVG_INTER_FRAME_DELAY,K.avgInterFrameDelayMs),Wt(j,Fn.KEY_FRAMES_DECODED,K.keyFramesDecoded),At){const ue=I.timestamp-y.timestamp||gh*(W?Sh:V?wy:1);K.packetsLost!=null&&At.packetsLost!=null&&Wt(j,Fn.PACKAGE_LOST,K.packetsLost-At.packetsLost),At.bytes!=null&&K.bytes!=null&&Wt(j,Fn.BITRATE,8*(K.bytes-At.bytes)/ue),At.packets!=null&&K.packets!=null&&Wt(j,Fn.PACKAGE_RATE,1e3*(K.packets-At.packets)/ue)}if(W&&(Wt(j,Fn.QP_SUM,K.qpSumPerFrame),j[Fn.FREEZE]=N&&Ng.isRemoteVideoFreeze(C,K,At)?1:0),V){var le;J?(Wt(j,Fn.HEIGHT,J.height),Wt(j,Fn.WIDTH,J.width)):C&&(Wt(j,Fn.HEIGHT,C._videoHeight||0),Wt(j,Fn.WIDTH,C._videoWidth||0)),ct&&Wt(j,_h.FRAME_RATE_OUTPUT,ct.frameRate);const ue=(le=C._player)===null||le===void 0?void 0:le.rendFrameRate.toFixed(0);if(ue&&Wt(j,_h.FRAME_RATE_RENDER,+ue),Wt(j,Fn.JITTER_BUFFER,K.jitterBufferMs),Wt(j,Fn.CURRENT_DELAY,K.currentDelayMs),Wt(j,Fn.FIRS,K.firsCount),Wt(j,Fn.NACKS,K.nacksCount),Wt(j,Fn.PLIS,K.plisCount),C){j[Fn.DISABLED]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1;const qe=C._player;if(qe){const{freezeTimeCounterList:Ln,renderFreezeAccTime:yn,videoElementStatus:vr}=qe;if(Ln&&Ln.length>0&&Wt(j,_h.FREEZE_TIME,Ln.splice(0,1)[0]),D&&$c.visibility==="visible"&&vr===Qi.PLAYING&&Te().supportRequestVideoFrameCallback){const nt=Math.min(6e3,yn);qe.renderFreezeAccTime=Math.max(0,yn-nt),Wt(j,_h.FREEZE_TIME_RENDER,nt)}if(typeof K.totalFreezesDuration=="number"){const nt=At&&At.totalFreezesDuration?K.totalFreezesDuration-At.totalFreezesDuration:K.totalFreezesDuration;Wt(j,_h.FREEZE_DURATION,1e3*nt)}}}if(j[Fn.PLAYER_STATUS]=FI[C._player?C._player.videoElementStatus:"uninit"],At&&K.totalInterFrameDelay!==void 0&&K.totalSquaredInterFrameDelay!==void 0&&At.totalInterFrameDelay!==void 0&&At.totalSquaredInterFrameDelay!==void 0){const qe=K.totalInterFrameDelay-At.totalInterFrameDelay,Ln=K.totalSquaredInterFrameDelay-At.totalSquaredInterFrameDelay,yn=K.framesDecodeCount-At.framesDecodeCount,vr=qe/yn*1e3,nt=Math.round(1e3*Math.sqrt((Ln-Math.pow(qe,2)/yn)/yn));!isNaN(nt)&&vr+nt>Math.max(3*vr,vr+150)&&(j[Fn.I_FRAME_DELAY]=nt)}}return j}(d._videoSSRC,e,n,d.videoTrack,m===!0,this.needUploadRenderFreezeTime,i,r):void 0;E&&(p.video=E)}if(h.has(It.AUDIO)&&d.audioTrack){const m=d.audioTrack?function(E,g,I,y,C,N){const D=g.audioRecv.find(j=>j.ssrc===E);if(!D)return;const V={},W=I&&I.audioRecv.find(j=>j.ssrc===E);if(Wt(V,Sr.JITTER,D.jitterMs),Wt(V,Sr.BYTES_RETRANSMIT,D.retransmittedBytesReceived),Wt(V,Sr.PACKAGES_RETRANSMIT,D.retransmittedPacketsReceived),Wt(V,Sr.PACKAGES_DISCARDED,D.packetsDiscarded),Wt(V,Sr.AVG_PROCESSING_DELAY,D.avgProcessingDelayMs),W){const j=g.timestamp-I.timestamp||gh*(N?Sh:C?wy:1);D.packets!=null&&W.packets!=null&&Wt(V,Sr.PACKAGE_RATE,1e3*(D.packets-W.packets)/j),C&&W.bytes!=null&&D.bytes!=null&&Wt(V,Sr.BITRATE,8*(D.bytes-W.bytes)/j),D.packetsLost!=null&&W.packetsLost!=null&&Wt(V,Sr.PACKAGE_LOST,D.packetsLost-W.packetsLost)}if(N){const{receivedFrames:j,droppedFrames:J}=D;j!=null&&J!=null&&(V[Sr.FREEZE]=(K=j)===0||100*J/K>20?1:0)}var K;if(C){const j=100*y._source.getAccurateVolumeLevel(),J=D.outputLevel;if(J!=null){const ct=Math.ceil(50*Math.log10(100*J+1));Wt(V,mU.LEVEL,ct)}if(Wt(V,Sr.PCM_LEVEL,j),y&&(V[Sr.DISABLED]=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?0:1),Wt(V,Sr.JITTER_BUFFER,D.jitterBufferMs),Wt(V,Sr.CURRENT_DELAY,D.jitterBufferMs),V[Sr.PLAYER_STATUS]=FI[_r.getPlayerState(y.getTrackId())],W){const ct=D.concealedSamples-W.concealedSamples;ct>0&&Wt(V,Sr.CONCEALED_SAMPLES,ct);const vt=D.totalSamplesReceived-W.totalSamplesReceived;vt>0&&Wt(V,Sr.TOTAL_SAMPLES_RECEIVED,vt)}}return V}(d._audioSSRC,e,n,d.audioTrack,i,r):void 0;m&&(p.audio=m)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof Zv);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Tg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(It.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(It.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of c)p.has(It.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),p.has(It.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(h,p){const m={};for(const{id:y,value:C,level:N,direction:D}of h){var E;const V=(E=p.get(y))!==null&&E!==void 0?E:0,W=C===2?V+M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:V;var g,I;p.set(y,W),m[y]?(C===2&&(m[y].value=C),N>m[y].level&&(m[y].level=N),D==="remote"&&(m[y].remoteUidCount+=1),m[y].totalTs=(g=p.get(y))!==null&&g!==void 0?g:0):m[y]={value:C,level:N,remoteUidCount:D==="local"?0:1,totalTs:(I=p.get(y))!==null&&I!==void 0?I:0}}return Object.keys(m).map(y=>{const{level:C,value:N,totalTs:D}=m[y];return{id:y,level:C,value:N,totalTs:D}})}(r,e);const l=Date.now(),d=l>n?l:n+1;this.requestUpload&&this.requestUpload(Tg.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:d})},M("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const i6=M("ICE_RESTART_INTERVAL");let Ny=new Map,fm=new Map,bu=[Vi.UDP_TCP_RELAY,Vi.TCP_RELAY,Vi.RELAY],LO=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Te().supportPCSetConfiguration;function SU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Ny.get(t.id);n&&(window.clearTimeout(n),Ny.delete(t.id));const i=fm.get(t.id);e&&i&&i.index===bu.length-1&&(T.debug("[".concat(t.id,"] reset ICE restart policy")),fm.delete(t.id))}function TU(t,e,n){if(Ny.size===0&&fm.size===0&&(Array.isArray(M("RESTART_SEQUENCE"))&&M("RESTART_SEQUENCE").length>0&&!function(l,d){if(l.length!==d.length)return!1;for(let h=0;h<l.length;h+=1){const p=l[h];if(l.filter(m=>m===p).length!==d.filter(m=>m===p).length)return!1}return!0}(bu,M("RESTART_SEQUENCE"))&&(bu=M("RESTART_SEQUENCE").filter(l=>{var d;if(Et(d=Object.values(Vi)).call(d,l))return!0}),T.debug("use reconnection policy from config distribution, queues: ".concat(bu.join(" => ")))),LO=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Te().supportPCSetConfiguration),bu.length===0)return void n();let i,{index:r=0,type:s}=fm.get(t.id)||{};if(LO&&s===Vi.RELAY)return void n();let c=s&&r>=bu.length-1;if(LO)s=Vi.RELAY;else{if(c)return void n();s?(r++,s=bu[r]):(s=bu[0],r=0)}T.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(r)),e(s),fm.set(t.id,{index:r,type:s}),i=window.setTimeout(()=>TU(t,e,n),i6),Ny.set(t.id,i)}var re;function RU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function sc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?RU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):RU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function vU(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=nI,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new Dy(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Dy(t){function e(n){if(Object(n)!==n)return St.reject(new TypeError(n+" is not an object."));var i=n.done;return St.resolve(n.value).then(function(r){return{value:r,done:i}})}return Dy=function(n){this.s=n,this.n=n.next},Dy.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?St.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?St.reject(n):e(i.apply(this.s,arguments))}},new Dy(t)}let Lg=(re=class extends hn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Bt.StateChange,e,this._state)}constructor(t,e){super(),O(this,"isPlanB",void 0),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"connection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"remoteDataChannelMap",new Map),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"pendingLocalDataChannels",[]),O(this,"pendingRemoteDataChannels",[]),O(this,"statsCollector",void 0),O(this,"shouldForwardP2PCreation",void 0),O(this,"iceFailedCount",0),O(this,"dtlsFailedCount",0),O(this,"mutex",void 0),O(this,"_state",Oe.Disconnected),O(this,"_pcStatsUploadType",M("NEW_ICE_RESTART")?il.FIRST_CONNECTION:il.OLD_FIRST_CONNECTION),O(this,"_isStartRestartIce",!1),O(this,"_restartTimer",void 0),O(this,"_isTryConnecting",!1),O(this,"_iceError",null),O(this,"_forceTurn",!1),O(this,"_isWaitPcToRePub",!1),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createMuteMessage(c);await Ke(this,Bt.RequestMuteLocal,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Te().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=DO(n,pg(this,Bt.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new St((p,m)=>{this.handleReplaceTrack(h.track,p,m,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createUnmuteMessage(c);await Ke(this,Bt.RequestUnmuteLocal,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;s||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Oe.Connected)return void i();const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Bt.UpdateVideoEncoder,p),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Oe.Connected)return void i();const{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleReplaceMixingTrack",async(n,i,r,s)=>{if(!this.connection||this.state!==Oe.Connected)return void i();const c=wO([n]);let l;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(h){r(h)}finally{var d;(d=l)===null||d===void 0||d()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.connection||!h||this.state!==Oe.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===ot.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Te().supportDualStreamEncoding){const p=this.localTrackMap.get(ot.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new St((E,g)=>{this.handleReplaceTrack(p.track,E,g,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),O(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new gU(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ui("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Te().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Jc(),this.shouldForwardP2PCreation=M("FORWARD_P2P_CREATION")&&Te().supportPCSetConfiguration&&fI(),this.shouldForwardP2PCreation&&(this.connection=by(this.store),this.emit(Bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=Oe.New,this._forceTurn=hU(t),T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=by(this.store,t),this.emit(Bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=M("NEW_ICE_RESTART")?il.FIRST_CONNECTION:il.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");M("ENABLE_PREALLOC_PC")&&this.state===Oe.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Oe.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var s;let[c]=r;return Et(s=[ot.LocalVideoLowTrack,ot.LocalVideoTrack]).call(s,c)}),n=e.map(r=>{let[,{id:s}]=r;return s}),i=e.map(r=>{let[s]=r;return s});if(this.connection instanceof rc){if(Mt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Et(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(s=>Et(t).call(t,s));r&&(this.store.codec=r,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof rc&&this.connection.peerConnectionState!=="closed"&&Et(t=[Oe.New,Oe.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Oe.Connected){if(this.state===Oe.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;Et(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return Ma(function*(){const r=yield Ee(i.mutex.lock("From P2PChannel.publish"));try{var s;const c=i.connection&&Et(s=["disconnected","failed"]).call(s,i.connection.peerConnectionState);if(!i.connection||i.state!==Oe.Connected||c){if(i.state===Oe.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const d=t.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(d),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,Bi.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield Ee(i.tryToUnmuteAudio(t)));yield*Av(vU(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return Ma(function*(){e.forEach(E=>{let{track:g,type:I}=E;const y=Date.now();n.store.publish(g.getTrackId(),I===ot.LocalAudioTrack?"audio":"video",y)}),n.bindLocalTrackEvents(e);const i=e.map(E=>{let{track:g}=E;return g}),r=yield Ee(t.send(i,n.store.codec,n.store.audioCodec)),s=(yield Ee(r.next())).value,c=n.createGatewayPublishMessage(e,s);let l;try{l=yield c}catch(E){throw r.throw(E),(E==null?void 0:E.code)===L.WS_ABORT&&e.forEach(g=>{let{track:I}=g;n.pendingLocalTracks.indexOf(I)===-1&&n.pendingLocalTracks.push(I)}),n.unbindLocalTrackEvents(e),E}const d=n.mapPubResToRemoteConfig(c,l,i),h=(yield Ee(r.next(d))).value;if(n.state===Oe.Disconnected)throw new $(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");M("ENABLE_VIDEO_SEI");const p=M("ENABLE_ENCODED_TRANSFORM"),m=M("ENABLE_AUDIO_METADATA");i.forEach(async E=>{const g=E.getRTCRtpTransceiver();if(!g||!p)return;const{interceptLocalVideoFrame:I,interceptLocalAudioFrame:y}=Sy();E.trackMediaType===It.VIDEO?await I(g.sender,E):E.trackMediaType===It.AUDIO&&await y(g.sender,{metadata:m?()=>{const C=E.metadata.shift();return C&&C.value}:void 0})}),e.forEach(E=>{let{type:g}=E;n.statsCollector.addLocalStats(g)}),n.assignLocalTracks(e,h),n.statsUploader.startUploadOutboundStats(),e.forEach(E=>{let{track:g,type:I}=E;const y=Date.now();n.store.publish(g.getTrackId(),I===ot.LocalAudioTrack?"audio":"video",void 0,y)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof nn))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(s,c){const l={};return s.height&&s.width&&(l.scaleResolutionDownBy=pO(s,c)),l.maxFramerate=s.framerate?$r(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==ot.LocalVideoLowTrack||!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Te().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const s=i._originMediaStreamTrack;if(!s.canvas)return T.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const d=c.canvas;l.width&&(d.width=$r(l.width)),l.height&&(d.height=$r(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=GI(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},$r(l.framerate)))})(s,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),T.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return Ma(function*(){if(!e.connection||e.state!==Oe.Connected)return;const n=yield Ee(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(ot.LocalVideoTrack);if(!r)throw new $(L.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(ot.LocalVideoLowTrack))throw new $(L.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(r.track,t),type:ot.LocalVideoLowTrack}];if(yield*Av(vU(e.doPublish(e.connection,s))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(ot.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Ee(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await wi(this,Bt.RequestRePublish,this.pendingLocalTracks),this.emit(Bt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await wi(this,Bt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==It.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==It.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await wi(this,Bt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===It.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(Bt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Oe.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Oe.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Oe.Connected)return;const t=this.localTrackMap.get(ot.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[ot.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:s}]=i;return{type:r,track:s}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Oe.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===t.uid&&d===i.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var s;if(!this.connection||this.state!==Oe.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;let c,l,d;const h=this.connection.getPreMedia(n);if(h)T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),d=h.transceiver,c=h.track,l=h.id;else if(r){const E=r.find(I=>{let{stream_type:y}=I;return y===e});if(!E)throw new $(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const g=await this.connection.receive(e,E.ssrcs,String(t._uintid),E.attributes);this.connection instanceof rc&&(d=g.transceiver),c=g.track,l=g.id}else{const E=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof rc&&(d=E.transceiver),c=E.track,l=E.id}if(e===It.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new em(c,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),d&&t._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new tm(c,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),d&&t._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._videoTrack)),d&&M("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:E,interceptRemoteAudioFrame:g}=Sy();e==It.VIDEO?await E(d.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(I=>{var y;return(y=t._videoTrack)===null||y===void 0?void 0:y._onSei(I)})}):e==It.AUDIO&&await g(d.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),onMetadata:I=>{this.safeEmit(Bt.AudioMetadata,I)}})}const p=this.remoteUserMap.get(t);p?p.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex(E=>{let{user:g,kind:I}=E;return g.uid===t.uid&&e===I});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Bt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Oe.Connected)throw new $(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var s;let{user:c,mediaType:l}=r;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const s=this.connection.getPreMedia(r.ssrcId);s?n.set(r.ssrcId,s):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:d}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(s._uintid)}}));e.forEach((r,s)=>{n.set(r.ssrcId,i[s])});for(const{user:r,mediaType:s,ssrcId:c}of t){const l=n.get(c);if(!l)return void T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(s,", ").concat(c));const{track:d,id:h,transceiver:p}=l;if(p&&M("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:I}=Sy();s==It.VIDEO?await g(p.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(y=>{var C;return(C=r._videoTrack)===null||C===void 0?void 0:C._onSei(y)})}):s==It.AUDIO&&await I(p.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),onMetadata:y=>{this.safeEmit(Bt.AudioMetadata,y)}})}if(s===It.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(d):(r._audioTrack=new em(d,r.uid,r._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),p&&r._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(d):(r._videoTrack=new tm(d,r.uid,r._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),p&&r._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._videoTrack)),M("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:I}=Sy();s==It.VIDEO?await g(p.receiver,{onSei:y=>{var C;(C=r._videoTrack)===null||C===void 0||C._onSei(y)}}):s==It.AUDIO&&await I(p.receiver)}const m=this.remoteUserMap.get(r);m?m.set(s,h):this.remoteUserMap.set(r,new Map([[s,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const E=this.pendingRemoteTracks.findIndex(g=>{let{user:I,kind:y}=g;return I.uid===r.uid&&s===y});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Bt.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return e!==void 0?l.uid===t.uid&&e===d:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Oe.Connected||n||i.forEach(c=>{let{kind:l}=c;var d;if(l===It.AUDIO)(d=t._audioTrack)===null||d===void 0||d._destroy(),t._audioTrack=void 0;else if(l===It.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Oe.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var h,p;if(d===It.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===It.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(d===It.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const s=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:s}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return s!==void 0?d.uid===r.uid&&s===h:d.uid===r.uid});c.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(c)}if(!this.connection||this.state!==Oe.Connected)return void e.forEach(r=>{let{user:s,kind:c}=r;var l;if(c===It.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===It.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}});const n=er(t).call(t,(r,s)=>{let{user:c,mediaType:l}=s;const d=this.filterTobeUnSubscribedTracks(c,l);return r.concat(d)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:s}]=r;return s}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[s,{kind:c}]=r;var l,d;if(c===It.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===It.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(c===It.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==Oe.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===It.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(ot.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(ot.LocalAudioTrack);if((e==null?void 0:e.track)instanceof qn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ot.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===ot.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===ot.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(ot.LocalAudioTrack),l=i?this.localTrackMap.get(ot.LocalVideoLowTrack):this.localTrackMap.get(ot.LocalVideoTrack);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof vn),l=i?(s=this.localTrackMap.get(ot.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof nn);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===It.VIDEO?n._videoSSRC:n._audioSSRC;r&&Mt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===It.VIDEO,audio:i===It.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:Bi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ui("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=by(this.store),this.emit(Bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(ot.LocalAudioTrack);if((t==null?void 0:t.track)instanceof qn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Oe.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(ot.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(ot.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof nn||e&&e.track instanceof vn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ua(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(ot.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=J_(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Oe.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=by(this.store),this.emit(Bt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case ot.LocalVideoTrack:Et(e=i._hints).call(e,ze.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ot.LocalAudioTrack:i instanceof qn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ot.LocalVideoLowTrack:}}),this.emit(Bt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ua(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Bt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ua(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof Au?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Au?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Ma(function*(){if(!e.connection||e.state!==Oe.Connected)return;const n=yield Ee(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Ee(e.connection.restartICE(t));const s=yield Ee(i.next());if(s.done)return;const c=s.value,l=yield c;switch(NO(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case Vi.UDP_TCP_RELAY:e._pcStatsUploadType=il.UDP_TCP_RESTART;break;case Vi.TCP_RELAY:e._pcStatsUploadType=il.TCP_RESTART;break;case Vi.RELAY:e._pcStatsUploadType=il.RELAY_RESTART;break;default:e._pcStatsUploadType=il.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(s){var r;(r=i)===null||r===void 0||r.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalAudioTrack),i=t.videoSend.find(g=>g.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(g=>g.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const s=ca(this,Bt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,E=e==null?void 0:e.track;if(E&&E._encoderConfig&&E._hints.indexOf(ze.SCREEN_TRACK)===-1){const g=E._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(g&&I){const y=(1e3*g-I)/(1e3*g);return n1[y<.15?0:y<.3?1:y<.45?2:y<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===s);if(!c&&!l)return void(e+=1);const d=ca(this,Bt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,E=t.recvPacketLossRate;let g=.7*E*100/50+.3*p/1500;m&&(g=.6*E*100/50+.2*p/1500+.2*m/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new St((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Oe.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const s=i[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,s)}if(r===ot.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Te().supportDualStreamEncoding){const s=this.localTrackMap.get(ot.LocalVideoLowTrack);if(s){const c=t._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new St((l,d)=>{this.handleReplaceTrack(s.track,l,d,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=jf(t=t.filter(d=>r.indexOf(d)===-1));let s,c=!1;const l=this.localTrackMap.get(ot.LocalAudioTrack);for(const d of t){if(d instanceof nn&&(this.localTrackMap.has(ot.LocalVideoTrack)||c?new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:ot.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:ot.LocalVideoLowTrack})}if(d instanceof vn)if(l){const h=l.track;if(h instanceof qn)OO([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const p=wO([h,d]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof qn?(OO([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&Te().webAudioMediaStreamDest&&!d._bypassWebAudio?s=wO(s?[d,s]:[d]):s=d}return s&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),i.push({track:s,type:ot.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=jf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof vn){const r=this.localTrackMap.get(ot.LocalAudioTrack);if(!r)continue;r.track instanceof qn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([ot.LocalAudioTrack,r]),r.track.close())):e.push([ot.LocalAudioTrack,r])}if(i instanceof nn){const r=this.localTrackMap.get(ot.LocalVideoTrack);if(!r)continue;e.push([ot.LocalVideoTrack,r]);const s=this.localTrackMap.get(ot.LocalVideoLowTrack);s&&e.push([ot.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(t){return t=(t=jf(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=jf(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.addListener(Nt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Nt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof qn?t.trackList.forEach(n=>{n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.off(Nt.GET_STATS,this.handleGetLocalVideoStats),n.off(Nt.GET_RTC_STATS,this.handleGetRTCStats),n.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof qn?t.trackList.forEach(e=>{e.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Nt.GET_STATS,this.handleGetLocalAudioStats),e.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Nt.GET_STATS,this.handleGetLocalAudioStats),t.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Nt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof tm&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof em&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(It.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(It.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,c,{track:l,type:d}=n;switch(d){case ot.LocalAudioTrack:s=we.Audio,c={dtx:l instanceof Zv&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ot.LocalVideoTrack:s=Et(r=l._hints).call(r,ze.SCREEN_TRACK)?we.Screen:we.High,c=sc(sc({},T1(l)),{},{codec:this.store.codec,svc_mode:fy()});break;case ot.LocalVideoLowTrack:s=we.Low,c=sc(sc({},T1(l)),{},{codec:this.store.codec,svc_mode:fy()})}return{stream_type:s,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalVideoTrack:i=Et(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalAudioTrack:i=we.Audio;break;case ot.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Bt.PeerConnectionStateChange,e),e==="connecting"&&t instanceof rc&&!En()&&M("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},M("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof rc&&SU(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=il.DISCONNECTED_OR_FAILED,ca(this,Bt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));Mt.reportApiInvoke(this.store.sessionId,{name:Gn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:gn.TRACER}).onSuccess(),this.republish()}if(M("NEW_ICE_RESTART")&&t instanceof rc&&!En()&&!this._forceTurn){if(Et(p1).call(p1,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{NO(t)&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),ca(this,Bt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Bt.RequestRestartICE,r))},i=()=>{NO(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Bt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{TU(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&M("ICE_RESTART")&&ca(this,Bt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Bt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Bt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Bt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Mt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:gn.TRACER}).onSuccess(),this.emit(Bt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Xf.FIRST_FRAME_DECODED),Mt.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_DECODE,cn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_RECEIVED,cn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ni.FIRST_VIDEO_RECEIVED,cn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Bt.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return sc(sc({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof rc&&function(e){fm.delete(e.id),SU(e)}(t),t.close(),this.emit(Bt.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive||e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===ot.LocalVideoTrack)){const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive&&e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===ot.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=we.Audio;break;case ot.LocalVideoTrack:i=Et(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=we.Audio;break;case ot.LocalVideoTrack:i=Et(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case It.VIDEO:return void(i._videoSSRC&&e.push({stream_type:It.VIDEO,ssrcId:i._videoSSRC}));case It.AUDIO:return void(i._audioSSRC&&e.push({stream_type:It.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let s=e.get(i);r===It.VIDEO?s|=ii.Video:s|=ii.Audio,e.set(i,s)}else r===It.VIDEO?e.set(i,ii.Video):e.set(i,ii.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new St((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new St((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var s;let{stream_type:c}=i;const l=(s=e.find(d=>{let{stream_type:h}=d;return c===h}))===null||s===void 0?void 0:s.attributes;if(l&&M("DISABLE_SCREEN_SHARE_REMB")){const d=n[r]._hints;(Et(d).call(d,ze.SCREEN_TRACK)||Et(d).call(d,ze.SCREEN_LOW_TRACK))&&(l.remb=!1,T.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof vn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(s=>{let[,{id:c}]=s;return c})));const r=this.createUnmuteMessage(i);return void await Ke(this,Bt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Bt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Bt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _i(vI(this.dtlsFailedCount,Hn)),this.emit(Bt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await wi(this,Bt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Bt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ot.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof nn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof nn).length>1)throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof vn).length>1&&(t.some(e=>e instanceof vn&&e._bypassWebAudio)||!Te().webAudioMediaStreamDest))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof nn&&this.pendingLocalTracks.some(n=>n instanceof nn))throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof vn&&this.pendingLocalTracks.some(n=>n instanceof vn)&&(!Te().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof vn&&n._bypassWebAudio)))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Te().supportDualStreamEncoding,r=sc(sc({},{width:160,height:120,framerate:15,bitrate:50}),e);let s;s=i?t._mediaStreamTrack.clone():DO(t,r);const c=Ye(8,"track-low-"),l=new nn(s,sc(sc({},i&&{scaleResolutionDownBy:pO(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(oh.TRANSCEIVER_UPDATED,d=>{t._updateRtpTransceiver(d,zf.LOW_STREAM)}),l._hints.push(ze.LOW_STREAM),Et(n=t._hints).call(n,ze.SCREEN_TRACK)&&l._hints.push(ze.SCREEN_LOW_TRACK),t.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),t.addListener(Nt.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof rc){var r,s,c,l;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:m}=this.connection,{local:E,remote:g}=await this.connection.getSelectedCandidatePair();Mt.pcStats(this.store.sessionId,{startTime:d,eventElapse:t-d||0,iceconnectionsate:h,dtlsstate:p,connectionstate:m,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=E==null?void 0:E.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(s=E.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(E.address,":").concat(E.port),selectedRemoteCandidateProtocol:(c=g.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=g.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ua(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Mt.firstRemoteVideoDecode(this.store.sessionId,ni.FIRST_VIDEO_DECODE,cn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.connection.getRemoteSSRC(r);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===ot.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,zf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Lt(re.prototype,"startP2PConnection",[$i],Object.getOwnPropertyDescriptor(re.prototype,"startP2PConnection"),re.prototype),Lt(re.prototype,"connect",[$i],Object.getOwnPropertyDescriptor(re.prototype,"connect"),re.prototype),Lt(re.prototype,"updateRemoteRTPCapabilities",[$i],Object.getOwnPropertyDescriptor(re.prototype,"updateRemoteRTPCapabilities"),re.prototype),Lt(re.prototype,"publishDataChannel",[$i],Object.getOwnPropertyDescriptor(re.prototype,"publishDataChannel"),re.prototype),Lt(re.prototype,"unpublish",[$i],Object.getOwnPropertyDescriptor(re.prototype,"unpublish"),re.prototype),Lt(re.prototype,"unpublishDataChannel",[$i],Object.getOwnPropertyDescriptor(re.prototype,"unpublishDataChannel"),re.prototype),Lt(re.prototype,"unpublishLowStream",[$i],Object.getOwnPropertyDescriptor(re.prototype,"unpublishLowStream"),re.prototype),Lt(re.prototype,"subscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(re.prototype,"subscribeDataChannel"),re.prototype),Lt(re.prototype,"subscribe",[$i],Object.getOwnPropertyDescriptor(re.prototype,"subscribe"),re.prototype),Lt(re.prototype,"massSubscribe",[$i],Object.getOwnPropertyDescriptor(re.prototype,"massSubscribe"),re.prototype),Lt(re.prototype,"unsubscribe",[$i],Object.getOwnPropertyDescriptor(re.prototype,"unsubscribe"),re.prototype),Lt(re.prototype,"unsubscribeDataChannel",[$i],Object.getOwnPropertyDescriptor(re.prototype,"unsubscribeDataChannel"),re.prototype),Lt(re.prototype,"massUnsubscribe",[$i],Object.getOwnPropertyDescriptor(re.prototype,"massUnsubscribe"),re.prototype),Lt(re.prototype,"muteRemote",[$i],Object.getOwnPropertyDescriptor(re.prototype,"muteRemote"),re.prototype),Lt(re.prototype,"unmuteRemote",[$i],Object.getOwnPropertyDescriptor(re.prototype,"unmuteRemote"),re.prototype),Lt(re.prototype,"hasRemoteMediaWithLock",[$i],Object.getOwnPropertyDescriptor(re.prototype,"hasRemoteMediaWithLock"),re.prototype),Lt(re.prototype,"disconnectForReconnect",[$i],Object.getOwnPropertyDescriptor(re.prototype,"disconnectForReconnect"),re.prototype),Lt(re.prototype,"updateBitrateLimit",[$i],Object.getOwnPropertyDescriptor(re.prototype,"updateBitrateLimit"),re.prototype),Lt(re.prototype,"remoteMediaSsrcChanged",[$i],Object.getOwnPropertyDescriptor(re.prototype,"remoteMediaSsrcChanged"),re.prototype),re);function $i(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function yU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function CU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const r6=Date.now(),a6=20,PO=new Map,Ly=new Map;async function AU(t){const e=PO.get(t),n=Array.isArray(e)&&e[e.length-1],i=Ly.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const s=n.sendTs-i.firstSendTs,c=s-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-s);let l=n.mediaDelay+c;l<=0?(e.pop(),bU(n.context,r),l=0):l=Math.min(l,a6),setTimeout(()=>e.length&&AU(t),l)}function bU(t,e){t.safeEmit(se.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function s6(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return bU(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=PO.get(i)||[],s=r.findIndex(h=>t.sendTs>=h.sendTs),c=CU(CU({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});s===-1?r.push(c):r.splice(s,0,c),PO.set(i,r);let l=!1;var d;Ly.has(i)?l=!((d=Ly.get(i))===null||d===void 0||!d.isSyncing):Ly.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||AU(i)}const o6=_e().name;function IU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function OU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?IU(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const mm="websdk_ng_cache_parameter",c6=M("MAX_PRELOAD_ASYNC_LENGTH"),l6=1e4,Th=new Map,Rh=[];let kO=null,MO=0,UO=0;const Py=new Map,u6=function(t,e){const n=[];let i=0;const r=async()=>{const s=n.shift();s&&await s(),n.length>0&&i<e?r():i--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new St(async(d,h)=>{n.push(async()=>{try{const p=await t(...c);d(p)}catch(p){h(p)}}),i<e&&(i++,r())})}}(wU,c6),xO=Er.CancelToken.source();async function wU(t,e,n,i,r,s){try{if(!M("ENABLE_PRELOAD"))return;if(!Te().supportWebCrypto)return void Eu(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new $(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ei(n,"token",1,2047),Ei(t,"appid",1,2047),ly(e),i&&uy(i);const c=ah();T.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let d,h;typeof i=="string"?(l.stringUid=i,[h,d]=await St.all([YH(i,{sid:c,appId:t},xO.token),Q1(OU(OU({},l),{},{token:n||t,uid:0}),xO.token)]),l.uid=h.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),d=await Q1(l,xO.token));const p={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:d};await async function(m){let E;try{m.uid&&DU({appId:m.appId,cname:m.cname,token:m.token,uid:m.uid,stringUid:m.stringUid});const g=MU(m),I=await async function(C,N){try{const D=await window.crypto.subtle.importKey("raw",RP(N),"AES-GCM",!1,["encrypt"]),V=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},D,rh(window.btoa(JSON.stringify(C))));return _u(new Uint8Array(V))}catch{return}}(m,m.token||m.appId);if(!I)return;E=kU(mm);const y=E?JSON.parse(E):[];y.push({[g]:I}),y.length>M("AP_CACHE_NUM")&&y.shift(),ky(mm,JSON.stringify(y))}catch(g){T.warn("Error caching server parameters:",g.message),ky(mm,"")}}(p),MO++}catch(c){throw UO++,function(l){kO||(kO=window.setTimeout(()=>{let h="";Py.forEach((p,m)=>{h+="".concat(m,": ").concat(p," ;")}),Mt.reportApiInvoke(null,{name:Gn.PRELOAD,options:{success:MO,failed:UO,err:h}}).onError(l),MO=0,UO=0,Py.clear(),kO=null},l6));const d=Py.get(l.code)||0;Py.set(l.code,d+1)}(c),c}}async function NU(t){try{if(M("AP_REQUEST_DETAIL")||M("ENABLE_ROLE_SELECT_EDGE"))return;const e=DU(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const s=await window.crypto.subtle.importKey("raw",RP(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,rh(i));return JSON.parse(window.atob(_u(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<M("AP_CACHE_LIFETIME"))return n}catch(e){T.warn("Error get preloadInfo",e.message)}}function DU(t){let e;try{if(e=kU(mm),!e)return;const n=JSON.parse(e),i=MU(t),r=function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1}(n,c=>i in c);if(r===-1)return;const s=n.splice(r,1)[0];return ky(mm,JSON.stringify(n)),s[i]}catch(n){T.warn("Error delete preload info: ".concat(e),n.message),ky(mm,"")}}function VO(t){if(t){let e=Th.get(t);e&&(window.clearTimeout(e),e=null,Th.delete(t)),Et(Rh).call(Rh,t)||t.cloudProxyServer!=="disabled"||Rh.push(t)}if(Th.size<M("AP_CACHE_NUM")&&Rh.length>0){const e=Rh.shift();Th.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:s,uid:c,proxyServer:l}=e;try{await u6(n,i,r,c,l,s),Th.has(e)&&VO(e)}catch(d){T.warn("update preload failed",d.message),LU(e)}},M("AP_UPDATE_INTERVAL")))}}function LU(t){const e=Rh.indexOf(t);e!==-1&&Rh.splice(e,1);let n=Th.get(t);n&&(window.clearTimeout(n),n=null,Th.delete(t),VO())}function PU(t,e){const n=t.sua,i=t.ap;e&&n&&Mt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),Mt.reportResourceTiming(t.ap.url,t.sid),Mt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[Vn.CHOOSE_SERVER,Vn.CLOUD_PROXY_FALLBACK].toString()}),Mt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Vn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function kU(t){return window.atob(window.localStorage.getItem(t)||"")}function ky(t,e){window.localStorage.setItem(t,window.btoa(e))}function MU(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),OP(e)}function d6(t){let e=function(){const n=f6.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(jn(i,10),Iu(i,r));let s=n.cid;s!==void 0&&(jn(i,16),jn(i,s));let c=n.cname;c!==void 0&&(jn(i,26),Iu(i,c));let l=n.deviceId;l!==void 0&&(jn(i,34),Iu(i,l));let d=n.elapse;d!==void 0&&(jn(i,40),Ou(i,d));let h=n.fileSize;h!==void 0&&(jn(i,48),Ou(i,Em(h)));let p=n.height;p!==void 0&&(jn(i,56),Ou(i,Em(p)));let m=n.jpg;m!==void 0&&(jn(i,66),jn(i,m.length),xU(i,m));let E=n.networkType;E!==void 0&&(jn(i,72),Ou(i,Em(E)));let g=n.osType;g!==void 0&&(jn(i,80),Ou(i,Em(g)));let I=n.requestId;I!==void 0&&(jn(i,90),Iu(i,I));let y=n.sdkVersion;y!==void 0&&(jn(i,98),Iu(i,y));let C=n.sequence;C!==void 0&&(jn(i,104),Ou(i,Em(C)));let N=n.sid;N!==void 0&&(jn(i,114),Iu(i,N));let D=n.timestamp;D!==void 0&&(jn(i,120),Ou(i,D));let V=n.uid;V!==void 0&&(jn(i,128),jn(i,V));let W=n.vid;W!==void 0&&(jn(i,136),jn(i,W));let K=n.width;K!==void 0&&(jn(i,144),Ou(i,Em(K)));let j=n.service;j!==void 0&&(jn(i,152),jn(i,j));let J=n.callbackData;J!==void 0&&(jn(i,162),jn(i,J.length),xU(i,J));let ct=n.ticket;ct!==void 0&&(jn(i,170),Iu(i,ct));let vt=n.vendorConfigs;vt!==void 0&&(jn(i,178),Iu(i,vt))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function h6(t){return function(n){let i={};t:for(;!m6(n);){let r=Pg(n);switch(r>>>3){case 0:break t;case 1:i.code=Pg(n);break;case 2:i.msg=VU(n,Pg(n));break;case 3:i.requestId=VU(n,Pg(n));break;case 4:i.timestamp=E6(n,!1);break;default:p6(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function p6(t,e){switch(e){case 0:for(;128&Ss(t););break;case 2:BO(t,Pg(t));break;case 5:BO(t,4);break;case 1:BO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function Em(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let f6=[];function BO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function m6(t){return t.offset>=t.limit}function My(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function UU(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function xU(t,e){let n=My(t,e.length);t.bytes.set(e,n)}function VU(t,e){let n=UU(t,e),i=String.fromCharCode,r=t.bytes,s="�",c="";for(let l=0;l<e;l++){let d,h,p,m,E=r[l+n];(128&E)==0?c+=i(E):(224&E)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(m=(31&E)<<6|63&d,m<128?c+=s:(c+=i(m),l++))):(240&E)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(m=(15&E)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=s:(c+=i(m),l+=2))):(248&E)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(m=(7&E)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=s:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=s}return c}function Iu(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}jn(t,i);let r=My(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function Ss(t){return t.bytes[UU(t,1)]}function BU(t,e){let n=My(t,1);t.bytes[n]=e}function Pg(t){let e,n=0,i=0;do e=Ss(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function jn(t,e){for(e>>>=0;e>=128;)BU(t,127&e|128),e>>>=7;BU(t,e)}function E6(t,e){let n,i=0,r=0,s=0;return n=Ss(t),i=127&n,128&n&&(n=Ss(t),i|=(127&n)<<7,128&n&&(n=Ss(t),i|=(127&n)<<14,128&n&&(n=Ss(t),i|=(127&n)<<21,128&n&&(n=Ss(t),r=127&n,128&n&&(n=Ss(t),r|=(127&n)<<7,128&n&&(n=Ss(t),r|=(127&n)<<14,128&n&&(n=Ss(t),r|=(127&n)<<21,128&n&&(n=Ss(t),s=127&n,128&n&&(n=Ss(t),s|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|s<<24,unsigned:e}}function Ou(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=My(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}const FU={},jU={},Uy=4294967296,_6=Uy*Uy,g6=_6/2;HU(0,!0);const GU=HU(0),S6=kg(0,-2147483648,!1),T6=kg(-1,2147483647,!1);function HU(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=jU[t],i)?i:(n=kg(t,0,!0),r&&(jU[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=FU[t],i)?i:(n=kg(t,t<0?-1:0,!1),r&&(FU[t]=n),n)}function kg(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function WU(t,e){if(isNaN(t))return GU;{if(t<=-9223372036854776e3)return S6;if(t+1>=g6)return T6}return t<0?GU:kg(t%Uy|0,t/Uy|0,e)}function KU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class FO extends hn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(ro.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),O(this,"name","AgoraRTCImageModeration"),O(this,"_connectionState",Ba.CONNECTING),O(this,"_sequence",0),O(this,"_moderationStartTime",void 0),O(this,"_workerConnection",void 0),O(this,"_workerMessageLengthLimit",void 0),O(this,"_qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Er.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"_moderationInterval",void 0),O(this,"_moderationTimer",null),O(this,"_moderationMode",1),O(this,"_quality",1),O(this,"_qualityTimer",null),O(this,"_ticket",void 0),O(this,"_moderationIntervalMinimum",void 0),O(this,"_uploadFailedNum",0),O(this,"_uploadNum",0),O(this,"_uploadTimer",null),O(this,"_extraInfo",void 0),O(this,"_vendor",""),O(this,"_encoder",new TextEncoder),O(this,"_moderationId",void 0),O(this,"inspectImage",()=>{if(this.connectionState!==Ba.CONNECTED)throw new z(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ba.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ye(5,"image-moderation-"),this._workerMessageLengthLimit=M("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=M("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=M("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new yg("worker-"+this._moderationId,Hn),this.on(ro.STATE_CHANGE,(i,r)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(am[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(ro.STATE_CHANGE,am.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new St((r,s)=>{this.on(ro.CONNECTION_STATE_CHANGE,(c,l)=>{c===Ba.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Ba.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=M("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await function(d,h,p,m){let{appId:E,areaCode:g,cname:I,sid:y,token:C,uid:N}=h;dm++;const D="moderation_plugin",V={service_name:D,json_body:JSON.stringify({appId:E,areaCode:g,cname:I,command:"allocateEdge",requestId:dm,seq:dm,sid:y,appToken:C,ts:Date.now(),uid:N+""})};let W,K,j=d[0];return to(async()=>{W=Date.now();const J=await ao(j,{data:V,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-W,J.code!==0){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+J.code,{retry:!0,responseTime:K});throw T.error(At.toString()),At}const ct=JSON.parse(J.json_body);if(ct.code!==200){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ct.code,", reason: ").concat(ct.reason),{code:ct.code,responseTime:K});throw T.error(At.toString()),At}if(!ct.servers||!Array.isArray(ct.servers)||ct.servers.length===0){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ct.code,responseTime:K});throw T.error(At.toString()),At}if(!ct.servers.some(At=>!!At.wss)){const At=new z(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ct.code,responseTime:K});throw T.error(At.toString()),At}const vt=M("IMAGE_MODERATION_WORKER_HOST");return{addressList:ct.servers.map(At=>{let{address:le,wss:ue}=At;if(le&&ue)return"wss://".concat(le.replace(/\./g,"-"),".").concat(vt,":").concat(ue,"/moderation")}).filter(At=>!!At),workerToken:ct.workerToken,vid:ct.vid,ticket:ct.appTicket,responseTime:K}},(J,ct)=>(Mt.apworkerEvent(y,{success:!0,sc:200,serviceName:D,responseDetail:JSON.stringify(J.addressList),firstSuccess:ct===0,responseTime:K,serverIp:d[ct%d.length]}),!1),(J,ct)=>(Mt.apworkerEvent(y,{success:!1,sc:J.data&&J.data.code||200,serviceName:D,responseTime:K,serverIp:d[ct%d.length]}),!!(J.code!==L.OPERATION_ABORTED&&J.code!==L.UNEXPECTED_RESPONSE||J.data&&J.data.retry)&&(j=d[(ct+1)%d.length],!0)),m)}(r,e,n,i);this.emit(ro.STATE_CHANGE,am.AP_CONNECTED);const{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(e){this.emit(ro.STATE_CHANGE,am.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on($t.CONNECTED,async()=>{this.emit(ro.STATE_CHANGE,am.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ba.CONNECTED}),this._workerConnection.on($t.CLOSED,()=>{this.connectionState=Ba.CLOSED}),this._workerConnection.on($t.FAILED,()=>{this.connectionState=Ba.CLOSED}),this._workerConnection.on($t.RECONNECTING,()=>{this.connectionState=this.connectionState===Ba.CONNECTED?Ba.RECONNECTING:Ba.CONNECTING}),this._workerConnection.on($t.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=h6(new Uint8Array(e.data));M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Mt.reportApiInvoke(this._connectInfo.sid||null,{name:Gn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:gn.TRACER}).onError(new z(L.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},M("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on($t.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on($t.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=ca(this,ro.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await _k(p,i,r),E=this._sequence+"-"+s+"-"+d+"-"+h+"-"+Ye(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:FO.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:E,sdkVersion:"4.23.2",sequence:this._sequence,sid:l,timestamp:WU(h),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete g.callbackData;const I=d6(g);if(I.byteLength<this._workerMessageLengthLimit){if(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const y=function(C){for(var N=1;N<arguments.length;N++){var D=arguments[N]!=null?arguments[N]:{};N%2?KU(Object(D),!0).forEach(function(V){O(C,V,D[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(D)):KU(Object(D)).forEach(function(V){Object.defineProperty(C,V,Object.getOwnPropertyDescriptor(D,V))})}return C}({},g);delete y.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(y))}return I}{const y=this.quality*this._qualityRatio;return this.quality=y,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Er.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ba.CLOSED,this.emit(ro.STATE_CHANGE,am.CLOSED)}}function YU(t){if(Ve(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new z(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new z(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const R6={name:"ImageModeration",create:function(t){let{config:e}=t;return YU(e),new FO(e)}};var zU,qU,XU,JU,QU,ZU,$U,t2,e2,n2,i2,r2,a2,s2,o2,c2,l2,u2,d2,h2,p2,f2,m2,E2,_2,g2,S2,T2,R2,v2,y2,C2,A2,b2,I2,O2,w2,N2,D2,L2,P2,Ct;function k2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ts(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?k2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}Ui.setLogger(T);let v6=(zU=Ht(),qU=Ht({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Qf))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),XU=Ht({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Jf.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),JU=Ht({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),QU=Ht({argsMap:(t,e,n)=>[e,n]}),ZU=Ht({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),$U=Ht({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),t2=Ht({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),e2=Ht(),n2=Ht(),i2=Ht(),r2=Ht(),a2=Ht(),s2=Ht(),o2=Ht(),c2=Ht(),l2=Ht(),u2=Ht(),d2=Ht(),h2=Ht(),p2=Ht(),f2=Ht(),m2=Ht(),E2=Ht({argsMap:(t,e)=>[e]}),_2=Ht(),g2=Ht(),S2=Ht(),T2=Ht(),R2=Ht(),v2=Ht(),y2=Ht(),C2=Ht(),A2=Ht({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),b2=Ht(),I2=Ht(),O2=Ht(),w2=Ht(),N2=Ht(),D2=Ht(),L2=Ht({reportResult:!0}),P2=Ht(),Ct=class extends hn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),O(this,"store",void 0),O(this,"_uid",void 0),O(this,"_channelName",void 0),O(this,"_uintUid",void 0),O(this,"_users",[]),O(this,"_config",void 0),O(this,"_clientId",void 0),O(this,"_appId",void 0),O(this,"_sessionId",null),O(this,"_key",void 0),O(this,"_rtmConfig",{}),O(this,"_joinInfo",void 0),O(this,"_gateway",void 0),O(this,"_statsCollector",void 0),O(this,"_configDistribute",void 0),O(this,"_leaveMutex",void 0),O(this,"_publishMutex",void 0),O(this,"_renewTokenMutex",void 0),O(this,"_subscribeMutex",void 0),O(this,"_encryptionMode","none"),O(this,"_encryptionSecret",null),O(this,"_encryptionSalt",null),O(this,"_encryptDataStream",!1),O(this,"_encryptDataStreamKey",null),O(this,"_encryptDataStreamIv",null),O(this,"_proxyServer",void 0),O(this,"_turnServer",{servers:[],mode:"auto"}),O(this,"_cloudProxyServerMode","disabled"),O(this,"_isDualStreamEnabled",!1),O(this,"_defaultStreamFallbackType",void 0),O(this,"_lowStreamParameter",void 0),O(this,"_streamFallbackTypeCacheMap",new Map),O(this,"_remoteStreamTypeCacheMap",new Map),O(this,"_axiosCancelSource",Er.CancelToken.source()),O(this,"_audioVolumeIndicationInterval",void 0),O(this,"_networkQualityInterval",void 0),O(this,"_userOfflineTimeout",void 0),O(this,"_streamRemovedTimeout",void 0),O(this,"_liveTranscodeStreamingClient",void 0),O(this,"_liveRawStreamingClient",void 0),O(this,"_channelMediaRelayClient",void 0),O(this,"_networkQualitySensitivity","normal"),O(this,"_p2pChannel",void 0),O(this,"_useLocalAccessPoint",!1),O(this,"_setLocalAPVersion",void 0),O(this,"_joinAndNotLeaveYet",!1),O(this,"_numberOfJoinCount",0),O(this,"_remoteDefaultVideoStreamType",void 0),O(this,"_inspect",void 0),O(this,"_moderation",void 0),O(this,"_license",void 0),O(this,"_pendingPublishedUsers",[]),O(this,"ntpAlignErrorCount",0),O(this,"remoteInboundOffset",0),O(this,"_peerConnectionState",void 0),O(this,"_handleLocalTrackEnable",(r,s,c)=>{this.publish(r,!1).then(s).catch(c)}),O(this,"_handleLocalTrackDisable",(r,s,c)=>{this.unpublish(r).then(s).catch(c)}),O(this,"_handleUserOnline",r=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return void T.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(c=>c.uid===r.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(se.USER_JOINED,s));else{const c=new Au(r.uid,r.uint_id||r.uid);this._users.push(c),T.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(se.USER_JOINED,c)}}),O(this,"_handleUserOffline",r=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return;const s=this._users.find(c=>c.uid===r.uid);s&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:Vv(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),T.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(se.USER_LEAVED,s,r.reason))}),O(this,"_handleAddAudioOrVideoStream",(r,s,c,l,d,h,p)=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(s,this.channelName))return;const m=this._users.find(g=>g.uid===s);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(m.uid,r,void 0,void 0,void 0,Date.now());const E=r==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=d||s),r==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,r==="audio"?(m._audio_added_=!0,c!==void 0&&(m._audioSSRC=c),l!==void 0&&(m._cname=l),h&&(m._audioOrtc=h)):(m._video_added_=!0,c!==void 0&&(m._videoSSRC=c),l!==void 0&&(m._cname=l),p!==void 0&&(m._rtxSsrcId=p),h&&(m._videoOrtc=h)),(r==="audio"?m.hasAudio:m.hasVideo)&&!E&&(T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(r)),this.safeEmit(se.USER_PUBLISHED,m,r)),r==="video"?Mt.onGatewayStream(this._sessionId,ni.ON_ADD_VIDEO_STREAM,cn.ON_ADD_VIDEO_STREAM,{peer:d||s,ssrc:m._videoSSRC}):Mt.onGatewayStream(this._sessionId,ni.ON_ADD_AUDIO_STREAM,cn.ON_ADD_AUDIO_STREAM,{peer:d||s,ssrc:m._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(m,r,c).then(g=>{if(g&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Lg))return this._p2pChannel.unsubscribe(m,r,!0).then(()=>this._subscribe(m,r,!0).catch(I=>{T.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,r,!0).catch(g=>{T.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),O(this,"_handleRemoveStream",r=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r.uid,this.channelName))return;const s=this._users.find(l=>l.uid===r.uid);if(!s)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};s.hasAudio&&s.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(se.USER_UNPUBLISHED,s,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(se.USER_UNPUBLISHED,s,"video")}:s.hasVideo?c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(se.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(c=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(se.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof Lg&&this._p2pChannel.unsubscribe(s).then(l=>{if(l)return this._gateway.unsubscribe(l,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Mt.onGatewayStream(this._sessionId,ni.ON_REMOVE_STREAM,cn.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),O(this,"_handleSetStreamLocalEnable",(r,s,c)=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(s,this.channelName))return;const l=this._users.find(p=>p.uid===s);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(s));const d=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{const m=l._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(se.USER_INFO_UPDATED,s,m)}}else{l._trust_video_enabled_state_=!0;const p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{const m=l._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(se.USER_INFO_UPDATED,s,m)}}const h=r==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(T.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(r)),void this.safeEmit(se.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),T.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(r)),void this.safeEmit(se.USER_UNPUBLISHED,l,r)):void 0}),O(this,"_handleMuteStream",(r,s,c)=>{if(M("BLOCK_LOCAL_CLIENT")&&ph(r,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),r,s,c);const l=this._users.find(p=>p.uid===r);if(!l)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const d=s==="audio"?l.hasAudio:l.hasVideo;if(s==="audio"){l._trust_audio_mute_state_=!0;const p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{const m=l._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(se.USER_INFO_UPDATED,r,m)}}else{l._trust_video_mute_state_=!0;const p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{const m=l._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(se.USER_INFO_UPDATED,r,m)}}const h=s==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(s==="audio"?l._audioSSRC:l._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(s)),void this.safeEmit(se.USER_PUBLISHED,l,s)):void T.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),s==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,s),T.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(s)),this.safeEmit(se.USER_UNPUBLISHED,l,s)}}),O(this,"_handleP2PLost",async r=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),O(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(se.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),O(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),O(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(se.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(se.NETWORK_QUALITY,r)}),O(this,"_handleP2PAddAudioOrVideoStream",(r,s,c,l)=>{const d=this._users.find(p=>p.uid===s);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());const h=r==="audio"?d.hasAudio:d.hasVideo;r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(r==="audio"?d.hasAudio:d.hasVideo)&&!h&&(T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(se.USER_PUBLISHED,d,r)),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(p=>{T.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=t,this._clientId=e||Ye(5,"client-"),this.store=new class{constructor(r,s,c,l){Xt(this,"state",void 0),this.state={codec:r,audioCodec:s,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:sh.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(r){this.state=function(s,c){switch(c.type){case oe.SET_SESSION_ID:return bt(bt({},s),{},{sessionId:c.sessionId});case oe.SET_P2P_ID:return bt(bt({},s),{},{p2pId:c.p2pId});case oe.SET_UID:return bt(bt({},s),{},{uid:c.uid});case oe.SET_INT_UID:return bt(bt({},s),{},{intUid:c.intUid});case oe.SET_PUB_ID:return bt(bt({},s),{},{pubId:c.pubId});case oe.KEY_METRIC_CLIENT_CREATED:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{clientCreated:c.metric})});case oe.KEY_METRIC_JOIN_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinStart:c.metric})});case oe.AVOID_JOIN_START:return bt(bt({},s),{},{avoidJoinStart:c.avoidJoinStart});case oe.KEY_METRIC_JOIN_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinEnd:c.metric})});case oe.KEY_METRIC_REQUEST_AP_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{requestAPStart:c.metric})});case oe.KEY_METRIC_REQUEST_AP_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{requestAPEnd:c.metric})});case oe.KEY_METRIC_JOIN_GATEWAY_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinGatewayStart:c.metric})});case oe.KEY_METRIC_JOIN_GATEWAY_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{joinGatewayEnd:c.metric})});case oe.KEY_METRIC_PEER_CONNECTION_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{peerConnectionStart:c.metric})});case oe.KEY_METRIC_PEER_CONNECTION_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{peerConnectionEnd:c.metric})});case oe.KEY_METRIC_DESCRIPTION_START:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{descriptionStart:c.metric})});case oe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{signalChannelOpen:c.metric})});case oe.KEY_METRIC_ICE_CONNECTION_END:return bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{iceConnectionEnd:c.metric})});case oe.KEY_METRIC_PUBLISH:{const l=s.keyMetrics.publish,d=l.findIndex(h=>h.trackId===c.metric.trackId);return d!==-1?(l[d]=bt(bt({},l[d]),c.metric),bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{publish:[...l]})})):bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,c.metric]})})}case oe.KEY_METRIC_SUBSCRIBE:{const l=s.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return d!==-1?(l[d]=bt(bt({},l[d]),c.metric),bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{subscribe:[...l]})})):bt(bt({},s),{},{keyMetrics:bt(bt({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,c.metric]})})}case oe.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=c.mode,s;case oe.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,c.record]:(s.joinChannelServiceRecords[c.index]=bt(bt({},s.joinChannelServiceRecords[c.index]),c.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case oe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case oe.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[]},s;case oe.SET_USE_P2P:return bt(bt({},s),{},{useP2P:c.val});case oe.SET_TRANSPORT_TYPE:return bt(bt({},s),{},{p2pTransport:c.val});default:return s}}(this.state,r)}set sessionId(r){this.dispatch({type:oe.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:oe.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:oe.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:oe.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:oe.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:oe.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:oe.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:oe.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:oe.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:oe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:oe.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:oe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:oe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:oe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:oe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:oe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:oe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:oe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:oe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:oe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:oe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,s,c,l){this.dispatch({type:oe.KEY_METRIC_PUBLISH,metric:bt(bt({trackId:r,type:s},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,s,c,l,d,h,p){this.dispatch({type:oe.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt(bt(bt({userId:r,type:s},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,s,c,l){r.forEach(d=>{this.dispatch({type:oe.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt({userId:d.userId,type:d.type},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,s){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:oe.RECORD_JOIN_CHANNEL_SERVICE,record:bt(bt({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:oe.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:oe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:oe.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:oe.AVOID_JOIN_START,avoidJoinStart:r})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Ui("client-leave",this._clientId),this._publishMutex=new Ui("client-publish",this._clientId),this._renewTokenMutex=new Ui("client-renewtoken",this._clientId),this._subscribeMutex=new Ui("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ua," build: ").concat(LI,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{SI(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){T.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new Ng(this.store),this._statsCollector.onStatsException=(r,s,c)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(s,", uid: ").concat(c)),this.safeEmit(se.EXCEPTION,{code:r,msg:s,uid:c})},this._statsCollector.onUploadPublishDuration=(r,s,c,l)=>{const d=this._users.find(h=>h.uid===r);d&&Mt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:s,videoPublishDuration:c,peer:d._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new FH(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Hn,httpRetryConfig:t.httpRetryConfig||Hn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new JH(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},rl("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new Lg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Pe("JOIN_GATEWAY_USE_443PORT_ONLY",s),Pe("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof dO&&(l.use443PortOnly=s,l.tryDoubleDomain=c),async function(d,h,p){Pv.get(d)||Pv.set(d,[]),kv.get(d)||kv.set(d,h),Jo.get(d)||Jo.set(d,0);const m=Pv.get(d),E=kv.get(d);if(!m||!E)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Jo.get(d)===E){const N=og();m.push(N),await N.promise}Jo.set(d,Jo.get(d)+1);for(var g=arguments.length,I=new Array(g>3?g-3:0),y=3;y<g;y++)I[y-3]=arguments[y];const C=await p(...I);return Jo.set(d,Jo.get(d)-1),Jo.get(d)===E-1&&m.length>0&&(m[0].resolve(),m.shift()),Jo.get(d)===0&&(Pv.set(d,[]),kv.set(d,0),Jo.set(d,0)),C}("client.join",M("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const s=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(jv||jv||(jv=(window.location.protocol.split(":")[0]||"").toUpperCase(),jv))==="HTTPS",l=DP()?window.isSecureContext:"Browser Not Support";(!DP()&&!c||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Mt.setAppId(t);try{if(!n&&n!==null)throw new z(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ei(n,"token",1,2047),Ei(t,"appid",1,2047),ly(e),i&&uy(i),r&&Ei(r,"optionalInfo",1,2047)}catch(y){throw Mt.reportApiInvoke(ah(),{name:Gn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:gn.TRACER}).onError(y),y}if(this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const y=new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Mt.reportApiInvoke(ah(),{name:Gn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:gn.TRACER}).onError(y),y}this._gateway.state="CONNECTING";const d=await NU({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const h=(d==null?void 0:d.sid)||ah();T.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);const p=Mt.reportApiInvoke(h,{id:this._clientId,name:Gn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:gn.TRACER}),m=Ts(Ts(Ts({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:M("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(m.stringUid=i,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await(async y=>{const C=function(W){const K=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),j=new Uint8Array(new ArrayBuffer(K.length));for(let J=0;J<K.length;J+=1)j[J]=K.charCodeAt(J);return j}(),N=await window.crypto.subtle.importKey("spki",C,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),D=_I(y),V=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},N,D);return function(W){let K="";for(let j=0;j<W.length;j+=1)K+=String.fromCharCode(W[j]);return window.btoa(K)}(new Uint8Array(V))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const y=new TextEncoder,C=M("USE_PURE_ENCRYPTION_MASTER_KEY")?y.encode(m.appId+this._encryptionSecret+this._encryptionSecret):y.encode(m.appId+m.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(N,D,V){const W=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),K=N==="aes-128-gcm2"?128:256,j=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:jP,hash:"SHA-256",salt:V},W,K+E5);return new Uint8Array(j).subarray(K/8)}(this._encryptionMode,C,rh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(N,D,V){const W=await window.crypto.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits","deriveKey"]),K=N==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:jP,hash:"SHA-256",salt:V},W,{name:"AES-GCM",length:K},!0,["encrypt","decrypt"])}(this._encryptionMode,C,rh(this._encryptionSalt))}else l?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:m.stringUid});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&Mt.joinChannelTimeout(this._sessionId,5)},5e3);try{var g;let y;const C=m.cloudProxyServer;if(Et(g=["proxy3","proxy4","proxy5"]).call(g,C)){const K=M("PROXY_SERVER_TYPE3");Array.isArray(K)?m.proxyServer=K[0]:m.proxyServer=K}if(Mt.setProxyServer(m.proxyServer),T.setProxyServer(m.proxyServer),this.store.requestAPStart(),d){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(m.stringUid?", ".concat(m.stringUid," => ").concat(d.intUid):""," ")),m.stringUid&&!m.uid&&(m.uid=d.intUid),y={gatewayInfo:d.ap.gatewayInfo},M("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&m.turnServer.mode==="auto")if(d.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const K=(await v1(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Ni.tcpport,udpport:j.udpport||Ni.udpport,username:j.username||Ni.username,password:j.password||Ni.password,forceturn:!1,security:!0}));m.turnServer={mode:"manual",servers:K}}PU(d,m.stringUid)}else{if(m.stringUid&&!m.uid){let K;[K,y]=await St.all([J1(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||Hn,this.store),X1(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Hn,!0,this.store)]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat(K)),m.uid=K,y.gatewayInfo.uid=K,y.gatewayInfo.res.uid=K}else y=await X1(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Hn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(Rg.UPDATE_BITRATE_LIMIT,K=>{this._p2pChannel.updateBitrateLimit(K)}),this._configDistribute.on(Rg.UPDATE_CLIENT_ROLE_OPTIONS,K=>{this._setClientRoleOptions(K)})},0),this._key=n||t;const N=y.gatewayInfo,D=m.uid?m.uid:N.uid;this._joinInfo=Ts(Ts({},m),{},{cid:N.cid,uid:D,vid:N.vid,apResponse:N.res,apGatewayAddress:N.apGatewayAddress,uni_lbs_ip:N.uni_lbs_ip,gatewayAddrs:N.gatewayAddrs}),this.store.intUid=D,this.store.cid=N.cid;const V=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(V),this._appId=t,this._channelName=m.cname,this._uid=V,this.store.uid=V,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ii()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const W=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(W)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),I=this,Et(hh).call(hh,I)||hh.push(I),this._cloudProxyServerMode==="disabled"&&Te().supportWebCrypto&&M("ENABLE_PRELOAD")&&VO(this._joinInfo),V}catch(y){const C=Array.isArray(y)?y[0]:y;throw C&&C.code===L.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),C):T.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),C),C.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(C),C}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new z(L.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!M("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ii()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=hh.indexOf(e);n!==-1&&hh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Ie.LEAVE),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Qf))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new z(L.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new z(L.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof Qf))throw new z(L.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new z(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const s=this._configDistribute.getBitrateLimit();r instanceof nn&&s&&r.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),T.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw T.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){Ve(t.id,"id",0,65535,!0),Qc(t.ordered,"ordered"),Ei(t.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new z(L.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new z(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return F1(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new z(L.CREATE_DATACHANNEL_ERROR);try{await St.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==L.DISCONNECT_P2P)throw r}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Qf))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(Dn.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw T.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Au)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new z(L.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(Zn(e,"mediaType",["audio","video"]),this.store.useP2P)throw new z(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===It.AUDIO,i=e===It.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:c,rtxSsrcId:l,cname:d,uint_id:h}=await this._gateway.presubscribe(t,e,!0);if(s==null)throw new z(L.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(E=>E.uid===t);p||(p=new Au(t,h||t),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=h||t),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),i&&(p._videoSSRC=s,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,e,s,l,c);const m=n?p._audioTrack:p._videoTrack;if(!m)throw new z(L.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),i&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),m}catch(s){throw T.error("[".concat(this._clientId,"] presub user ").concat(t," error"),s),s}finally{r()}}async _subscribeDataChannel(t,e){var n;if(Ve(e,"channelId",0,65535,!0),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new z(L.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new z(L.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new z(L.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&Et(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new z(L.CREATE_DATACHANNEL_ERROR);const d={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,d,!0),await r._waitTillOpen()}catch(d){if((d==null?void 0:d.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),d;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{s()}}async _p2pSubscribe(t,e,n){if(Zn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===t)){const s=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),s}if(!t.hasAudio&&!t.hasVideo){const s=new z(L.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),s}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const s=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),s}const r=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const s=e==="audio"?t._audioTrack:t._videoTrack;if(!s)throw new z(L.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),s),s}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(Zn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===t)){const h=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),h}if(!t.hasAudio&&!t.hasVideo){const h=new z(L.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),h}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const h=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),h}let r=e==="audio"?t._audioSSRC:t._videoSSRC,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?It.AUDIO:It.VIDEO,ssrcId:r};const d=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const p=e==="audio"?t._audioSSRC:t._videoSSRC;p!==void 0&&p!==r&&(r=p,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?It.AUDIO:It.VIDEO,ssrcId:r}),Bi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,s);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(m){if((m==null?void 0:m.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),m;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,t,e),p}T.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=e==="audio"?t._audioTrack:t._videoTrack;if(!h)throw new z(L.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),h),h}finally{d()}}async massSubscribe(t){if(Zc(t,"subscribeList"),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:d,mediaType:h}=l;return{user:d,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h;if(Zn(m,"mediaType",["audio","video"]),!p){const y=new z(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),y}if(!this._users.find(y=>y===p)){const y=new z(L.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),r[d].error=y,t.splice(d,1);continue}if(m==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||m==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const y=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(m,", remote user is not published")),r[d].error=y,t.splice(d,1);continue}const g=ii.Video|ii.LwoVideo,I=n.get(p);if(I){if(m==="video"?I&g:I&ii.Audio){t.splice(d,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(m," twice"));continue}n.set(p,I|(m==="video"?g:ii.Audio))}else n.set(p,m==="video"?g:ii.Audio)}for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:m}=h,E=ii.Video|ii.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,m)){await this._p2pChannel.unmuteRemoteNoLock(p,m);const g=n.get(p);n.set(p,m==="video"?g^E:g^ii.Audio),t.splice(d,1)}}this.store.massSubscribe(t.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let l=er(c=Array.from(n.entries())).call(c,(d,h)=>{let[p,m]=h;if(m===0)return d;const E={stream_id:p.uid,stream_type:m};return m&ii.Audio&&(E.audio_ssrc=p._audioSSRC),m&ii.Video&&(E.video_ssrc=p._videoSSRC),d.push(E),d},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:p,mediaType:m}=h;return{user:p,mediaType:m,ssrcId:m===It.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:m===It.VIDEO?p._rtxSsrcId:void 0}}));const d=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:m,video_error_code:E,audio_error_code:g,error_code:I}=p;(E||g||I)&&d.set(m,{video_error_code:E,audio_error_code:g,error_code:I})})}if(Array.from(d.entries()).length>0){const h=[];Array.from(d.entries()).forEach(p=>{let[m,E]=p;const g=this.remoteUsers.find(I=>I.uid===m);if(g){let I;E.error_code||E.video_error_code&&E.audio_error_code?I=void 0:E.video_error_code?I=It.VIDEO:E.audio_error_code&&(I=It.AUDIO),h.push({user:g,mediaType:I})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const p=d.get(h.user.uid);if(p){const m=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(m){const E=vg(m);T.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(E.desc)),h.error=new z(L.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(E.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var p;Mt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===It.VIDEO,audio:h.mediaType===It.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===It.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:p,mediaType:m}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; "))),r}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(t),d}}finally{s(),i()}}async unsubscribe(t,e,n){if(!(t instanceof Au)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new z(L.INVALID_REMOTE_USER,"user is not in the channel");t=s}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Zn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const s=await this._p2pChannel.unsubscribe(t,e);s&&await this._gateway.unsubscribe(s,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&Vv(this._users,t),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(s){if(s.code===L.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&Ve(e,"id",0,65535,!0),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new z(L.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(s=>s.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new z(L.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===L.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(Zc(t,"unsubscribeList"),!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new z(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(Zn(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=ii.Video|ii.LwoVideo;if(e.has(i)){const l=e.get(i);let d;switch(r){case"video":d=l&c;break;case"audio":d=l&ii.Audio;break;default:d=l&(ii.Audio|c)}if(d){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|ii.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|ii.Audio|c)}else r?r==="audio"?e.set(i,ii.Audio):r==="video"&&e.set(i,c):e.set(i,ii.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:s}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===L.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new $(L.INVALID_PARAMS);_n(n.width)||mI(n.width,"streamParameter.width"),_n(n.height)||mI(n.height,"streamParameter.height"),_n(n.framerate)||mI(n.framerate,"streamParameter.framerate"),_n(n.bitrate)||Ve(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,ot.LocalVideoLowTrack)}async enableDualStream(){if(!Te().supportDualStream)throw Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new z(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new z(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ot.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Mt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Zn(i,"role",["audience","host"])}(t),e&&SI(e),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new z(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new z(L.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new z(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&M("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",Oi.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),T.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&SI(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{T.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Ei(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new z(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Mt.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new z(L.INVALID_OPERATION,"You have already set the proxy")}if(hg(t))return this._turnServer={servers:t,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>SP(n)),this._turnServer={servers:t,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"you should set license before join channel");if(Ei(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new z(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,T.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new z(L.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new z(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new z(L.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new z(L.INVALID_OPERATION,"Stop proxy server after leave channel");Mt.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new z(L.INVALID_PARAMS,"accessPoints is required.");Zc(t.accessPoints.serverList,"accessPoints.serverList"),Ei(t.accessPoints.domain,"accessPoints.domain");const e=(E,g)=>{Ve(E,g,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new z(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");M("CLOSE_AFB_FOR_LOCAL_AP")&&(Pe("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Pe("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,s=t.accessPoints.serverList.map(E=>i.test(E)?"".concat(E.replace(/\./g,"-"),".").concat(r):E),c=s.map(E=>"".concat(E,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Pe("WEBCS_DOMAIN",c),Pe("WEBCS_DOMAIN_BACKUP_LIST",c),Pe("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Zc(t.report.hostname,"report.hostname"),Pe("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Pe("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Pe("EVENT_REPORT_DOMAIN",s[0]),Pe("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),Pe("STATS_COLLECTOR_PORT",l),t.report?Pe("ENABLE_EVENT_REPORT",!0):Pe("ENABLE_EVENT_REPORT",!1);let d="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Zc(t.log.hostname,"log.hostname"),d=t.log.hostname[0]):d=s[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),Pe("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let p=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Zc(t.cds.hostname,"cds.hostname"),p=t.cds.hostname):p=s;let m=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),m=t.cds.port),Pe("CDS_AP",p.map(E=>"".concat(E,":").concat(m))),t.cds?Pe("ENABLE_CONFIG_DISTRIBUTE",!0):Pe("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Zc(t,"serverList"),Ei(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new z(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Pe("WEBCS_DOMAIN",t),Pe("WEBCS_DOMAIN_BACKUP_LIST",t),Pe("GATEWAY_DOMAINS",[e]),Pe("EVENT_REPORT_DOMAIN",t[0]),Pe("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Pe("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Zn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Zn(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Zn(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(s){Zn(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ei(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(Et(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new z(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new z(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Qc(i,"encryptDataStream"),!Et(r).call(r,t))throw new z(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=_u(n))}async renewToken(t){if(Ei(t,"token",1,2047),!this._key||!this._joinInfo)throw new z(L.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(M("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await XH(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Hn);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,T.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(se.VOLUME_INDICATOR,t)},M("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new z(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new z(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new z(L.LIVE_STREAMING_TASK_CONFLICT);const n=e?el.TRANSCODE:el.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(el.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new z(L.INVALID_PARAMS,"can not find live streaming url to stop");await St.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){iU(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){iU(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof Lg&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Et(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,s,c){var l;const d=er(l=Array.from(c)).call(l,(y,C)=>y+C,0),h={serverTs:0,seq:_5++,length:c.length,checkSum:d},p=new Uint8Array(IP(d,2)),m=new ArrayBuffer(Wf),E=new DataView(m);E.setUint32(0,h.serverTs),E.setUint16(4,h.seq),E.setUint16(6,h.length),E.setUint16(8,h.checkSum);const g=16-c.length%16;c=vP(c,new Uint8Array(g));const I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:FP,additionalData:p},s,c);return vP(new Uint8Array(m),new Uint8Array(I))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new z(L.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Kt.DATA_STREAM,{payload:_u(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-r6},!n)}sendMetadata(t){if(!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new z(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:_u(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(b5),!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not send custom report, not joined");await Mt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Zn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Zn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Qc(e,"apRTM"),Ve(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),function(t){const e=im.indexOf(t);e!==-1&&im.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Er.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&LU(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Mt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ui("client-publish",this._clientId),this._subscribeMutex=new Ui("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||ah();t?T.debug("[".concat(this._clientId,"] new Session ").concat(i)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,Mt.addSid(i);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};Mt.sessionInit(this._sessionId,Ts({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new z(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Dn.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof nn&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(s=>{T.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new z(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new z(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw n.throw(s),s}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new z(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},rl("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,s)=>{Mt.reportApiInvoke(this._sessionId,{name:Gn.ON_LIVE_STREAM_ERROR,options:[r,s],tag:gn.TRACER}).onSuccess(),this.safeEmit(se.LIVE_STREAMING_ERROR,r,s)},n.onLiveStreamWarning=(r,s)=>{Mt.reportApiInvoke(this._sessionId,{name:Gn.ON_LIVE_STREAM_WARNING,options:[r,s],tag:gn.TRACER}).onSuccess(),this.safeEmit(se.LIVE_STREAMING_WARNING,r,s)},n.on(lO.REQUEST_WORKER_MANAGER_LIST,(r,s,c)=>{if(!this._joinInfo)return c(new z(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,h,p){const m=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(E=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(E+"/api/v1?action=uap"):"https://".concat(E,"/api/v1?action=uap"));return await HH(m,l,d,h,p)})(r,this._joinInfo,this._axiosCancelSource.token,Hn).then(s).catch(c)}),n};return t===el.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new z(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},rl("ChannelMediaRelay").create(t));i.on("state",r=>{r===Ur.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(se.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(se.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,s)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:c,stream_id:l,ordered:d,max_retrans_times:h,metadata:p}=s,m=this._users.find(E=>E._uintid===c);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),Et(r).call(r,m)||r.push(m),m._uintid||(m._uintid=c),m._dataChannels.findIndex(E=>E.id===s.stream_id)===-1){const E={id:l,ordered:!!d,maxRetransmits:h,metadata:p},g=function(I){return F1(I,!0)}(E);m._dataChannels.push(g),T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),e||this.safeEmit(se.USER_PUBLISHED,m,"datachannel",E)}this._p2pChannel.hasPendingRemoteDataChannel(m,s.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,s.stream_id).catch(E=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),E.toString())}))}),e&&(this.safeEmit(se.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(s=>{const{uid:c,stream_id:l}=s,d=this._users.find(p=>p._uintid===c);if(!d)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=d._dataChannels.find(p=>p.id===s.stream_id);h&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then(p=>{if(d._dataChannels=d._dataChannels.filter(m=>m!==h),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(se.USER_UNPUBLISHED,d,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(se.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(li.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:s,expires:c}=e[i];c&&c<=n||s||nO()||!Object.prototype.hasOwnProperty.call(Wv,i)||(eo[i]=r,en[i]=r,T.debug("Update gateway parameters from config distribute",i,r))})}catch(e){T.error("Error update config from local cache",e.message)}})()}),this._gateway.on(li.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(li.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===Ie.FALLBACK)return;const r=()=>{this.safeEmit(se.CONNECTION_STATE_CHANGE,t,e,n)};if(Mt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Gn.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:gn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,It.AUDIO,!1)),c._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,It.VIDEO,!1)),c._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(li.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new z(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await NU(Ts(Ts({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,PU(i),this._joinInfo.preload=!0):(n=await AO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Hn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s;const[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):r.push({host:l,port:d})}),t(r)}catch(n){e(n)}}),this._gateway.on(li.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(se.NETWORK_QUALITY,t)}),this._gateway.on(li.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(se.STREAM_TYPE_CHANGED,t,e),Mt.reportApiInvoke(this._sessionId,{name:Gn.STREAM_TYPE_CHANGE,options:[t,e],tag:gn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(li.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(li.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();M("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(li.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const i=O1(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(li.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(r),icePwd:"".concat(s,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=M("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ce.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ce.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ce.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(ce.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(ce.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(ce.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ce.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ce.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ce.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,It.AUDIO,!0)),this._gateway.signal.on(ce.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,It.AUDIO,!1)),this._gateway.signal.on(ce.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,It.VIDEO,!0)),this._gateway.signal.on(ce.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,It.VIDEO,!1)),this._gateway.signal.on(ce.RECEIVE_METADATA,t=>{const e=rh(t.metadata);this.safeEmit(se.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(ce.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=rh(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Et(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<Wf)throw new z(L.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Wf));n=await async function(s,c,l){const d=l.subarray(0,Wf),h=d.slice(8,Wf),p=(h[0]<<8)+h[1],m=(d[6]<<8)+d[7],E=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:FP,additionalData:new Uint8Array(IP(p,2))},c,l.subarray(Wf));return new Uint8Array(E).subarray(0,m)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(s==null?void 0:s._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),s6(Ts(Ts({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ce.ON_CRYPT_ERROR,()=>{Eu(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(se.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ce.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ie.TOKEN_EXPIRE),this.safeEmit(se.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ce.ON_STREAM_FALLBACK_UPDATE,t=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(se.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ce.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(ce.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ce.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(zt.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case Kt.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const s=r.some(d=>{let{stream_type:h}=d;return h===we.Audio}),c=r.some(d=>{let{stream_type:h}=d;return h!==we.Audio}),l=r.some(d=>{let{stream_type:h}=d;return h===we.Screen||h===we.ScreenLow});e.state==="offer"&&Mt.publish(this._joinInfo.sid,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:s,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(n=r.find(d=>{let{stream_type:h}=d;return h===we.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(d=>{let{stream_type:h}=d;return h!==we.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Kt.SUBSCRIBE:e&&Mt.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:e.stream_type===It.AUDIO,video:e.stream_type===It.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Bi.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(ce.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(ce.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;M("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!ph(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(p=>p._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new Au(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(se.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(se.USER_JOINED,r)));const s=ii.Audio&i.stream_type,c=(ii.Video|ii.LwoVideo)&i.stream_type,l=(65280&i.stream_type)!=0,d=s&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),s&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),s&&!d&&this.getListeners(se.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(se.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(se.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(se.USER_PUBLISHED,r,"video")),(s&&!d||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(se.PUBLISHED_USER_LIST).length>0?M("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(se.PUBLISHED_USER_LIST,e)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(ce.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof Lg&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return Et(i=Object.keys(Kv)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(ce.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Dn.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:s,ssrcs:c,mid:l,isMuted:d}=r;this._handleP2PAddAudioOrVideoStream(s,i,c[0].ssrcId,l);const h=this._users.find(p=>p.uid===i);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,s,!!d)})}),this._gateway.signal.on(Dn.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(zt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Dn.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,s=this._users.find(c=>c.uid===r);if(!s)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const d=l===we.Audio?It.AUDIO:It.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(r,d,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(Dn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case Tu.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,It.VIDEO,!0);break;case Tu.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,It.AUDIO,!0);break;case Tu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,It.VIDEO,!1);break;case Tu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,It.AUDIO,!1)}}),this._gateway.signal.on(Dn.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==sr.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(Dn.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(Bt.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(Dn.RESTART_ICE,t,i===sr.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(Bt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Dn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Bt.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(Dn.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(Bt.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Bt.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Bt.StateChange,(t,e)=>{e===Oe.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Bt.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(se.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(Bt.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Bt.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===L.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(Bt.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(Bt.RequestRePublishDataChannel,(t,e,n)=>{St.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==L.DISCONNECT_P2P)throw s}})).then(e).catch(n)}),this._p2pChannel.on(Bt.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===It.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(Bt.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(Bt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Bt.MediaReconnectStart,t=>{this.safeEmit(se.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Bt.MediaReconnectEnd,t=>{this.safeEmit(se.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Bt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Bt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:s}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(Bt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Bt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=O1(r,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Bt.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(Bt.P2PLost,()=>{this.safeEmit(se.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Bt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Bt.ConnectionTypeChange,t=>{this.safeEmit(se.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Bt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Bt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Bt.AudioMetadata,t=>{this.safeEmit(se.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},rl("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:s,token:c,uid:l,cid:d,vid:h}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:s,token:c,uid:l,cid:d,vid:h?Number(h):0},Hn)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(ui.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(se.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===Es.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(se.CONTENT_INSPECT_ERROR,new z(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(ui.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(se.CONTENT_INSPECT_RESULT,e,n)}),t.on(ui.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Qc(t,"enabled"),t){if(!e)throw new z(L.INVALID_PARAMS,"config is required");if(YU(e),!this._joinInfo)throw new z(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},rl("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:s,sid:c,token:l,uid:d,cid:h,vid:p}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:s,sid:c,token:l,uid:d,cid:h,vid:p?Number(p):0},Hn)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new z(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(ro.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(se.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===Ba.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new z(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(ro.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Zn(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new z(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Qc(t,"enabled"),Pe("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Lt(Ct.prototype,"leave",[zU],Object.getOwnPropertyDescriptor(Ct.prototype,"leave"),Ct.prototype),Lt(Ct.prototype,"publish",[qU],Object.getOwnPropertyDescriptor(Ct.prototype,"publish"),Ct.prototype),Lt(Ct.prototype,"unpublish",[XU],Object.getOwnPropertyDescriptor(Ct.prototype,"unpublish"),Ct.prototype),Lt(Ct.prototype,"subscribe",[JU],Object.getOwnPropertyDescriptor(Ct.prototype,"subscribe"),Ct.prototype),Lt(Ct.prototype,"presubscribe",[QU],Object.getOwnPropertyDescriptor(Ct.prototype,"presubscribe"),Ct.prototype),Lt(Ct.prototype,"massSubscribe",[ZU],Object.getOwnPropertyDescriptor(Ct.prototype,"massSubscribe"),Ct.prototype),Lt(Ct.prototype,"unsubscribe",[$U],Object.getOwnPropertyDescriptor(Ct.prototype,"unsubscribe"),Ct.prototype),Lt(Ct.prototype,"massUnsubscribe",[t2],Object.getOwnPropertyDescriptor(Ct.prototype,"massUnsubscribe"),Ct.prototype),Lt(Ct.prototype,"setLowStreamParameter",[e2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLowStreamParameter"),Ct.prototype),Lt(Ct.prototype,"enableDualStream",[n2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableDualStream"),Ct.prototype),Lt(Ct.prototype,"disableDualStream",[i2],Object.getOwnPropertyDescriptor(Ct.prototype,"disableDualStream"),Ct.prototype),Lt(Ct.prototype,"setClientRole",[r2],Object.getOwnPropertyDescriptor(Ct.prototype,"setClientRole"),Ct.prototype),Lt(Ct.prototype,"_setClientRoleOptions",[a2],Object.getOwnPropertyDescriptor(Ct.prototype,"_setClientRoleOptions"),Ct.prototype),Lt(Ct.prototype,"setProxyServer",[s2],Object.getOwnPropertyDescriptor(Ct.prototype,"setProxyServer"),Ct.prototype),Lt(Ct.prototype,"setTurnServer",[o2],Object.getOwnPropertyDescriptor(Ct.prototype,"setTurnServer"),Ct.prototype),Lt(Ct.prototype,"setLicense",[c2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLicense"),Ct.prototype),Lt(Ct.prototype,"startProxyServer",[l2],Object.getOwnPropertyDescriptor(Ct.prototype,"startProxyServer"),Ct.prototype),Lt(Ct.prototype,"stopProxyServer",[u2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopProxyServer"),Ct.prototype),Lt(Ct.prototype,"setLocalAccessPointsV2",[d2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLocalAccessPointsV2"),Ct.prototype),Lt(Ct.prototype,"setLocalAccessPoints",[h2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLocalAccessPoints"),Ct.prototype),Lt(Ct.prototype,"setRemoteDefaultVideoStreamType",[p2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRemoteDefaultVideoStreamType"),Ct.prototype),Lt(Ct.prototype,"setRemoteVideoStreamType",[f2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRemoteVideoStreamType"),Ct.prototype),Lt(Ct.prototype,"setStreamFallbackOption",[m2],Object.getOwnPropertyDescriptor(Ct.prototype,"setStreamFallbackOption"),Ct.prototype),Lt(Ct.prototype,"setEncryptionConfig",[E2],Object.getOwnPropertyDescriptor(Ct.prototype,"setEncryptionConfig"),Ct.prototype),Lt(Ct.prototype,"renewToken",[_2],Object.getOwnPropertyDescriptor(Ct.prototype,"renewToken"),Ct.prototype),Lt(Ct.prototype,"enableAudioVolumeIndicator",[g2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableAudioVolumeIndicator"),Ct.prototype),Lt(Ct.prototype,"startLiveStreaming",[S2],Object.getOwnPropertyDescriptor(Ct.prototype,"startLiveStreaming"),Ct.prototype),Lt(Ct.prototype,"setLiveTranscoding",[T2],Object.getOwnPropertyDescriptor(Ct.prototype,"setLiveTranscoding"),Ct.prototype),Lt(Ct.prototype,"stopLiveStreaming",[R2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopLiveStreaming"),Ct.prototype),Lt(Ct.prototype,"startChannelMediaRelay",[v2],Object.getOwnPropertyDescriptor(Ct.prototype,"startChannelMediaRelay"),Ct.prototype),Lt(Ct.prototype,"updateChannelMediaRelay",[y2],Object.getOwnPropertyDescriptor(Ct.prototype,"updateChannelMediaRelay"),Ct.prototype),Lt(Ct.prototype,"stopChannelMediaRelay",[C2],Object.getOwnPropertyDescriptor(Ct.prototype,"stopChannelMediaRelay"),Ct.prototype),Lt(Ct.prototype,"sendCustomReportMessage",[A2],Object.getOwnPropertyDescriptor(Ct.prototype,"sendCustomReportMessage"),Ct.prototype),Lt(Ct.prototype,"pickSVCLayer",[b2],Object.getOwnPropertyDescriptor(Ct.prototype,"pickSVCLayer"),Ct.prototype),Lt(Ct.prototype,"setRTMConfig",[I2],Object.getOwnPropertyDescriptor(Ct.prototype,"setRTMConfig"),Ct.prototype),Lt(Ct.prototype,"enableContentInspect",[O2],Object.getOwnPropertyDescriptor(Ct.prototype,"enableContentInspect"),Ct.prototype),Lt(Ct.prototype,"disableContentInspect",[w2],Object.getOwnPropertyDescriptor(Ct.prototype,"disableContentInspect"),Ct.prototype),Lt(Ct.prototype,"setImageModeration",[N2],Object.getOwnPropertyDescriptor(Ct.prototype,"setImageModeration"),Ct.prototype),Lt(Ct.prototype,"setP2PTransport",[D2],Object.getOwnPropertyDescriptor(Ct.prototype,"setP2PTransport"),Ct.prototype),Lt(Ct.prototype,"getJoinChannelServiceRecords",[L2],Object.getOwnPropertyDescriptor(Ct.prototype,"getJoinChannelServiceRecords"),Ct.prototype),Lt(Ct.prototype,"setPublishAudioFilterEnabled",[P2],Object.getOwnPropertyDescriptor(Ct.prototype,"setPublishAudioFilterEnabled"),Ct.prototype),Ct);class Mg{constructor(e,n){O(this,"id",0),O(this,"element",void 0),O(this,"peerPair",void 0),O(this,"context",void 0),O(this,"audioPlayerElement",void 0),O(this,"audioTrack",void 0),Mg.count+=1,this.id=Mg.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const s=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(s),i.iceGatheringState==="complete"?i.localDescription:new St(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new z(L.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new z(L.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new z(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var M2,xy;O(Mg,"count",0);const y6=window.AudioContext||window.webkitAudioContext,C6=new(M2=Ht({report:Mt}),Lt((xy=class{constructor(){O(this,"units",[]),O(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new y6);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new Mg(t,this.context),this.units.push(e)),e.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return _e().name!==Ce.SAFARI}}).prototype,"processExternalMediaAEC",[M2],Object.getOwnPropertyDescriptor(xy.prototype,"processExternalMediaAEC"),xy.prototype),xy);function U2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function x2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?U2(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const jO=window||document;function V2(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!jO)return;const n=Wn._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(Wn.onSecurityPolicyViolation||Wn.getListeners(nc.SECURITY_POLICY_VIOLATION).length>0)))return;const s=r.blockedURI;M("CSP_DETECTED_HOSTNAME_LIST").some(c=>Et(s).call(s,c))&&(Wn.onSecurityPolicyViolation&&typeof Wn.onSecurityPolicyViolation=="function"&&Wn.onSecurityPolicyViolation(r),Wn.getListeners(nc.SECURITY_POLICY_VIOLATION).length>0&&Wn.safeEmit(nc.SECURITY_POLICY_VIOLATION,r))};n&&jO.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||Wn.getListeners(nc.SECURITY_POLICY_VIOLATION).length>0)&&jO.addEventListener("securitypolicyviolation",i),Wn._cspEventHandlerPointer=i}var A6=mt,b6=RL,B2=RegExp.prototype,I6=function(t){return t===B2||A6(B2,t)?b6(t):t.flags},tr=P(I6);function _m(t){let e=t.length;for(;--e>=0;)t[e]=0}const GO=256,F2=286,Ug=30,xg=15,HO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Vy=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),O6=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),j2=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ol=new Array(576);_m(ol);const Vg=new Array(60);_m(Vg);const Bg=new Array(512);_m(Bg);const Fg=new Array(256);_m(Fg);const WO=new Array(29);_m(WO);const By=new Array(Ug);function KO(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let G2,H2,W2;function YO(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}_m(By);const K2=t=>t<256?Bg[t]:Bg[256+(t>>>7)],jg=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},ga=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,jg(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},oc=(t,e,n)=>{ga(t,n[2*e],n[2*e+1])},Y2=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},z2=(t,e,n)=>{const i=new Array(16);let r,s,c=0;for(r=1;r<=xg;r++)c=c+n[r-1]<<1,i[r]=c;for(s=0;s<=e;s++){let l=t[2*s+1];l!==0&&(t[2*s]=Y2(i[l]++,l))}},q2=t=>{let e;for(e=0;e<F2;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Ug;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},X2=t=>{t.bi_valid>8?jg(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},J2=(t,e,n,i)=>{const r=2*e,s=2*n;return t[r]<t[s]||t[r]===t[s]&&i[e]<=i[n]},zO=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&J2(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!J2(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},Q2=(t,e,n)=>{let i,r,s,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?oc(t,r,e):(s=Fg[r],oc(t,s+GO+1,e),c=HO[s],c!==0&&(r-=WO[s],ga(t,r,c)),i--,s=K2(i),oc(t,s,n),c=Vy[s],c!==0&&(i-=By[s],ga(t,i,c)));while(l<t.sym_next);oc(t,256,e)},qO=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let c,l,d,h=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<s;c++)n[2*c]!==0?(t.heap[++t.heap_len]=h=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)d=t.heap[++t.heap_len]=h<2?++h:0,n[2*d]=1,t.depth[d]=0,t.opt_len--,r&&(t.static_len-=i[2*d+1]);for(e.max_code=h,c=t.heap_len>>1;c>=1;c--)zO(t,n,c);d=s;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],zO(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*d]=n[2*c]+n[2*l],t.depth[d]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=d,t.heap[1]=d++,zO(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((p,m)=>{const E=m.dyn_tree,g=m.max_code,I=m.stat_desc.static_tree,y=m.stat_desc.has_stree,C=m.stat_desc.extra_bits,N=m.stat_desc.extra_base,D=m.stat_desc.max_length;let V,W,K,j,J,ct,vt=0;for(j=0;j<=xg;j++)p.bl_count[j]=0;for(E[2*p.heap[p.heap_max]+1]=0,V=p.heap_max+1;V<573;V++)W=p.heap[V],j=E[2*E[2*W+1]+1]+1,j>D&&(j=D,vt++),E[2*W+1]=j,W>g||(p.bl_count[j]++,J=0,W>=N&&(J=C[W-N]),ct=E[2*W],p.opt_len+=ct*(j+J),y&&(p.static_len+=ct*(I[2*W+1]+J)));if(vt!==0){do{for(j=D-1;p.bl_count[j]===0;)j--;p.bl_count[j]--,p.bl_count[j+1]+=2,p.bl_count[D]--,vt-=2}while(vt>0);for(j=D;j!==0;j--)for(W=p.bl_count[j];W!==0;)K=p.heap[--V],K>g||(E[2*K+1]!==j&&(p.opt_len+=(j-E[2*K+1])*E[2*K],E[2*K+1]=j),W--)}})(t,e),z2(n,h,t.bl_count)},Z2=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<d&&r===c||(l<h?t.bl_tree[2*r]+=l:r!==0?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4))},$2=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<d&&r===c)){if(l<h)do oc(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==s&&(oc(t,r,t.bl_tree),l--),oc(t,16,t.bl_tree),ga(t,l-3,2)):l<=10?(oc(t,17,t.bl_tree),ga(t,l-3,3)):(oc(t,18,t.bl_tree),ga(t,l-11,7));l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4)}};let tx=!1;const ex=(t,e,n,i)=>{ga(t,0+(i?1:0),3),X2(t),jg(t,n),jg(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var w6=t=>{tx||((()=>{let e,n,i,r,s;const c=new Array(16);for(i=0,r=0;r<28;r++)for(WO[r]=i,e=0;e<1<<HO[r];e++)Fg[i++]=r;for(Fg[i-1]=r,s=0,r=0;r<16;r++)for(By[r]=s,e=0;e<1<<Vy[r];e++)Bg[s++]=r;for(s>>=7;r<Ug;r++)for(By[r]=s<<7,e=0;e<1<<Vy[r]-7;e++)Bg[256+s++]=r;for(n=0;n<=xg;n++)c[n]=0;for(e=0;e<=143;)ol[2*e+1]=8,e++,c[8]++;for(;e<=255;)ol[2*e+1]=9,e++,c[9]++;for(;e<=279;)ol[2*e+1]=7,e++,c[7]++;for(;e<=287;)ol[2*e+1]=8,e++,c[8]++;for(z2(ol,287,c),e=0;e<Ug;e++)Vg[2*e+1]=5,Vg[2*e]=Y2(e,5);G2=new KO(ol,HO,257,F2,xg),H2=new KO(Vg,Vy,0,Ug,xg),W2=new KO(new Array(0),O6,0,19,7)})(),tx=!0),t.l_desc=new YO(t.dyn_ltree,G2),t.d_desc=new YO(t.dyn_dtree,H2),t.bl_desc=new YO(t.bl_tree,W2),t.bi_buf=0,t.bi_valid=0,q2(t)},N6=(t,e,n,i)=>{let r,s,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<GO;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(t)),qO(t,t.l_desc),qO(t,t.d_desc),c=(l=>{let d;for(Z2(l,l.dyn_ltree,l.l_desc.max_code),Z2(l,l.dyn_dtree,l.d_desc.max_code),qO(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*j2[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&e!==-1?ex(t,e,n,i):t.strategy===4||s===r?(ga(t,2+(i?1:0),3),Q2(t,ol,Vg)):(ga(t,4+(i?1:0),3),((l,d,h,p)=>{let m;for(ga(l,d-257,5),ga(l,h-1,5),ga(l,p-4,4),m=0;m<p;m++)ga(l,l.bl_tree[2*j2[m]+1],3);$2(l,l.dyn_ltree,d-1),$2(l,l.dyn_dtree,h-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),Q2(t,t.dyn_ltree,t.dyn_dtree)),q2(t),i&&X2(t)},D6=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Fg[n]+GO+1)]++,t.dyn_dtree[2*K2(e)]++),t.sym_next===t.sym_end),L6=t=>{ga(t,2,3),oc(t,256,ol),(e=>{e.bi_valid===16?(jg(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},P6={_tr_init:w6,_tr_stored_block:ex,_tr_flush_block:N6,_tr_tally:D6,_tr_align:L6},Gg=(t,e,n,i)=>{let r=65535&t|0,s=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,s=s+r|0;while(--c);r%=65521,s%=65521}return r|s<<16|0};const k6=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var cr=(t,e,n,i)=>{const r=k6,s=i+n;t^=-1;for(let c=i;c<s;c++)t=t>>>8^r[255&(t^e[c])];return-1^t},vh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Fy={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:M6,_tr_stored_block:XO,_tr_flush_block:U6,_tr_tally:wu,_tr_align:x6}=P6,{Z_NO_FLUSH:Nu,Z_PARTIAL_FLUSH:V6,Z_FULL_FLUSH:B6,Z_FINISH:Rs,Z_BLOCK:nx,Z_OK:Rr,Z_STREAM_END:ix,Z_STREAM_ERROR:cc,Z_DATA_ERROR:F6,Z_BUF_ERROR:JO,Z_DEFAULT_COMPRESSION:j6,Z_FILTERED:G6,Z_HUFFMAN_ONLY:jy,Z_RLE:H6,Z_FIXED:W6,Z_DEFAULT_STRATEGY:K6,Z_UNKNOWN:Y6,Z_DEFLATED:Gy}=Fy,QO=286,z6=30,q6=19,X6=2*QO+1,J6=15,yh=258,lc=262,gm=42,Ch=113,Hg=666,Ah=(t,e)=>(t.msg=vh[e],e),rx=t=>2*t-(t>4?9:0),Du=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Q6=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let Lu=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const ja=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Ga=(t,e)=>{U6(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ja(t.strm)},bn=(t,e)=>{t.pending_buf[t.pending++]=e},Wg=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},ZO=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=Gg(t.adler,e,r,n):t.state.wrap===2&&(t.adler=cr(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},ax=(t,e)=>{let n,i,r=t.max_chain_length,s=t.strstart,c=t.prev_length,l=t.nice_match;const d=t.strstart>t.w_size-lc?t.strstart-(t.w_size-lc):0,h=t.window,p=t.w_mask,m=t.prev,E=t.strstart+yh;let g=h[s+c-1],I=h[s+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,h[n+c]===I&&h[n+c-1]===g&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<E);if(i=yh-(E-s),s=E-yh,i>c){if(t.match_start=e,c=i,i>=l)break;g=h[s+c-1],I=h[s+c]}}while((e=m[e&p])>d&&--r!=0);return c<=t.lookahead?c:t.lookahead},Sm=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-lc)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Q6(t),i+=e),t.strm.avail_in===0)break;if(n=ZO(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=Lu(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=Lu(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<lc&&t.strm.avail_in!==0)},sx=(t,e)=>{let n,i,r,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<s&&(n===0&&e!==Rs||e===Nu||n!==i+t.strm.avail_in)))break;c=e===Rs&&n===i+t.strm.avail_in?1:0,XO(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,ja(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(ZO(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==Nu&&e!==Rs&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(ZO(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,s=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=s||(i||e===Rs)&&e!==Nu&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===Rs&&t.strm.avail_in===0&&n===i?1:0,XO(t,t.block_start,n,c),t.block_start+=n,ja(t.strm)),c?3:1)},$O=(t,e)=>{let n,i;for(;;){if(t.lookahead<lc){if(Sm(t),t.lookahead<lc&&e===Nu)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-lc&&(t.match_length=ax(t,n)),t.match_length>=3)if(i=wu(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+1]);else i=wu(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(Ga(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Rs?(Ga(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ga(t,!1),t.strm.avail_out===0)?1:2},Tm=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<lc){if(Sm(t),t.lookahead<lc&&e===Nu)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-lc&&(t.match_length=ax(t,n),t.match_length<=5&&(t.strategy===G6||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=wu(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=Lu(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(Ga(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=wu(t,0,t.window[t.strstart-1]),i&&Ga(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=wu(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Rs?(Ga(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ga(t,!1),t.strm.avail_out===0)?1:2};function uc(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const Kg=[new uc(0,0,0,0,sx),new uc(4,4,8,4,$O),new uc(4,5,16,8,$O),new uc(4,6,32,32,$O),new uc(4,4,16,16,Tm),new uc(8,16,32,32,Tm),new uc(8,16,128,128,Tm),new uc(8,32,128,256,Tm),new uc(32,128,258,1024,Tm),new uc(32,258,258,4096,Tm)];function Z6(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gy,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*X6),this.dyn_dtree=new Uint16Array(2*(2*z6+1)),this.bl_tree=new Uint16Array(2*(2*q6+1)),Du(this.dyn_ltree),Du(this.dyn_dtree),Du(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(J6+1),this.heap=new Uint16Array(2*QO+1),Du(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*QO+1),Du(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Yg=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==gm&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Ch&&e.status!==Hg?1:0},ox=t=>{if(Yg(t))return Ah(t,cc);t.total_in=t.total_out=0,t.data_type=Y6;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?gm:Ch,t.adler=e.wrap===2?0:1,e.last_flush=-2,M6(e),Rr},cx=t=>{const e=ox(t);return e===Rr&&(n=>{n.window_size=2*n.w_size,Du(n.head),n.max_lazy_match=Kg[n.level].max_lazy,n.good_match=Kg[n.level].good_length,n.nice_match=Kg[n.level].nice_length,n.max_chain_length=Kg[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},lx=(t,e,n,i,r,s)=>{if(!t)return cc;let c=1;if(e===j6&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==Gy||i<8||i>15||e<0||e>9||s<0||s>W6||i===8&&c!==1)return Ah(t,cc);i===8&&(i=9);const l=new Z6;return t.state=l,l.strm=t,l.status=gm,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=s,l.method=n,cx(t)};var $6=(t,e)=>{if(Yg(t)||e>nx||e<0)return t?Ah(t,cc):cc;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Hg&&e!==Rs)return Ah(t,t.avail_out===0?JO:cc);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(ja(t),t.avail_out===0)return n.last_flush=-1,Rr}else if(t.avail_in===0&&rx(e)<=rx(i)&&e!==Rs)return Ah(t,JO);if(n.status===Hg&&t.avail_in!==0)return Ah(t,JO);if(n.status===gm&&n.wrap===0&&(n.status=Ch),n.status===gm){let r=Gy+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=jy||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=s<<6,n.strstart!==0&&(r|=32),r+=31-r%31,Wg(n,r),n.strstart!==0&&(Wg(n,t.adler>>>16),Wg(n,65535&t.adler)),t.adler=1,n.status=Ch,ja(t),n.pending!==0)return n.last_flush=-1,Rr}if(n.status===57){if(t.adler=0,bn(n,31),bn(n,139),bn(n,8),n.gzhead)bn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),bn(n,255&n.gzhead.time),bn(n,n.gzhead.time>>8&255),bn(n,n.gzhead.time>>16&255),bn(n,n.gzhead.time>>24&255),bn(n,n.level===9?2:n.strategy>=jy||n.level<2?4:0),bn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(bn(n,255&n.gzhead.extra.length),bn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=cr(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(bn(n,0),bn(n,0),bn(n,0),bn(n,0),bn(n,0),bn(n,n.level===9?2:n.strategy>=jy||n.level<2?4:0),bn(n,3),n.status=Ch,ja(t),n.pending!==0)return n.last_flush=-1,Rr}if(n.status===69){if(n.gzhead.extra){let r=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=cr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,ja(t),n.pending!==0)return n.last_flush=-1,Rr;r=0,s-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>r&&(t.adler=cr(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=cr(t.adler,n.pending_buf,n.pending-s,s)),ja(t),n.pending!==0)return n.last_flush=-1,Rr;s=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,bn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=cr(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=cr(t.adler,n.pending_buf,n.pending-s,s)),ja(t),n.pending!==0)return n.last_flush=-1,Rr;s=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,bn(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=cr(t.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ja(t),n.pending!==0))return n.last_flush=-1,Rr;bn(n,255&t.adler),bn(n,t.adler>>8&255),t.adler=0}if(n.status=Ch,ja(t),n.pending!==0)return n.last_flush=-1,Rr}if(t.avail_in!==0||n.lookahead!==0||e!==Nu&&n.status!==Hg){let r=n.level===0?sx(n,e):n.strategy===jy?((s,c)=>{let l;for(;;){if(s.lookahead===0&&(Sm(s),s.lookahead===0)){if(c===Nu)return 1;break}if(s.match_length=0,l=wu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(Ga(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Rs?(Ga(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ga(s,!1),s.strm.avail_out===0)?1:2})(n,e):n.strategy===H6?((s,c)=>{let l,d,h,p;const m=s.window;for(;;){if(s.lookahead<=yh){if(Sm(s),s.lookahead<=yh&&c===Nu)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,d=m[h],d===m[++h]&&d===m[++h]&&d===m[++h])){p=s.strstart+yh;do;while(d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&d===m[++h]&&h<p);s.match_length=yh-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=wu(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=wu(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(Ga(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Rs?(Ga(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(Ga(s,!1),s.strm.avail_out===0)?1:2})(n,e):Kg[n.level].func(n,e);if(r!==3&&r!==4||(n.status=Hg),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),Rr;if(r===2&&(e===V6?x6(n):e!==nx&&(XO(n,0,0,!1),e===B6&&(Du(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ja(t),t.avail_out===0))return n.last_flush=-1,Rr}return e!==Rs?Rr:n.wrap<=0?ix:(n.wrap===2?(bn(n,255&t.adler),bn(n,t.adler>>8&255),bn(n,t.adler>>16&255),bn(n,t.adler>>24&255),bn(n,255&t.total_in),bn(n,t.total_in>>8&255),bn(n,t.total_in>>16&255),bn(n,t.total_in>>24&255)):(Wg(n,t.adler>>>16),Wg(n,65535&t.adler)),ja(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Rr:ix)},tW=(t,e)=>{let n=e.length;if(Yg(t))return cc;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==gm||i.lookahead)return cc;if(r===1&&(t.adler=Gg(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(Du(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(e.subarray(n-i.w_size,n),0),e=d,n=i.w_size}const s=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Sm(i);i.lookahead>=3;){let d=i.strstart,h=i.lookahead-2;do i.ins_h=Lu(i,i.ins_h,i.window[d+3-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--h);i.strstart=d,i.lookahead=2,Sm(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=s,i.wrap=r,Rr},zg={deflateInit:(t,e)=>lx(t,e,Gy,15,8,K6),deflateInit2:lx,deflateReset:cx,deflateResetKeep:ox,deflateSetHeader:(t,e)=>Yg(t)||t.state.wrap!==2?cc:(t.state.gzhead=e,Rr),deflate:$6,deflateEnd:t=>{if(Yg(t))return cc;const e=t.state.status;return t.state=null,e===Ch?Ah(t,F6):Rr},deflateSetDictionary:tW,deflateInfo:"pako deflate (from Nodeca project)"};const eW=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Hy={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)eW(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,s=t.length;i<s;i++){let c=t[i];n.set(c,r),r+=c.length}return n}};let ux=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ux=!1}const qg=new Uint8Array(256);for(let t=0;t<256;t++)qg[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;qg[254]=qg[254]=1;var Xg={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,s,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),s=0,r=0;s<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){s[r++]=c;continue}let l=qg[c];if(l>4)s[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?s[r++]=65533:c<65536?s[r++]=c:(c-=65536,s[r++]=55296|c>>10&1023,s[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&ux)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let h=0;h<l;h++)d+=String.fromCharCode(c[h]);return d})(s,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+qg[t[n]]>e?n:e}},dx=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const hx=Object.prototype.toString,{Z_NO_FLUSH:nW,Z_SYNC_FLUSH:iW,Z_FULL_FLUSH:rW,Z_FINISH:aW,Z_OK:Wy,Z_STREAM_END:sW,Z_DEFAULT_COMPRESSION:oW,Z_DEFAULT_STRATEGY:cW,Z_DEFLATED:lW}=Fy;function Ky(t){this.options=Hy.assign({level:oW,method:lW,chunkSize:16384,windowBits:15,memLevel:8,strategy:cW},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dx,this.strm.avail_out=0;let n=zg.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Wy)throw new Error(vh[n]);if(e.header&&zg.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?Xg.string2buf(e.dictionary):hx.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=zg.deflateSetDictionary(this.strm,i),n!==Wy)throw new Error(vh[n]);this._dict_set=!0}}function uW(t,e){const n=new Ky(e);if(n.push(t,!0),n.err)throw n.msg||vh[n.err];return n.result}Ky.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?aW:nW,typeof t=="string"?n.input=Xg.string2buf(t):hx.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===iW||s===rW)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=zg.deflate(n,s),r===sW)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=zg.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Wy;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Ky.prototype.onData=function(t){this.chunks.push(t)},Ky.prototype.onEnd=function(t){t===Wy&&(this.result=Hy.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var dW={deflate:uW};const Yy=16209;var hW=function(t,e){let n,i,r,s,c,l,d,h,p,m,E,g,I,y,C,N,D,V,W,K,j,J,ct,vt;const At=t.state;n=t.next_in,ct=t.input,i=n+(t.avail_in-5),r=t.next_out,vt=t.output,s=r-(e-t.avail_out),c=r+(t.avail_out-257),l=At.dmax,d=At.wsize,h=At.whave,p=At.wnext,m=At.window,E=At.hold,g=At.bits,I=At.lencode,y=At.distcode,C=(1<<At.lenbits)-1,N=(1<<At.distbits)-1;t:do{g<15&&(E+=ct[n++]<<g,g+=8,E+=ct[n++]<<g,g+=8),D=I[E&C];e:for(;;){if(V=D>>>24,E>>>=V,g-=V,V=D>>>16&255,V===0)vt[r++]=65535&D;else{if(!(16&V)){if((64&V)==0){D=I[(65535&D)+(E&(1<<V)-1)];continue e}if(32&V){At.mode=16191;break t}t.msg="invalid literal/length code",At.mode=Yy;break t}W=65535&D,V&=15,V&&(g<V&&(E+=ct[n++]<<g,g+=8),W+=E&(1<<V)-1,E>>>=V,g-=V),g<15&&(E+=ct[n++]<<g,g+=8,E+=ct[n++]<<g,g+=8),D=y[E&N];n:for(;;){if(V=D>>>24,E>>>=V,g-=V,V=D>>>16&255,!(16&V)){if((64&V)==0){D=y[(65535&D)+(E&(1<<V)-1)];continue n}t.msg="invalid distance code",At.mode=Yy;break t}if(K=65535&D,V&=15,g<V&&(E+=ct[n++]<<g,g+=8,g<V&&(E+=ct[n++]<<g,g+=8)),K+=E&(1<<V)-1,K>l){t.msg="invalid distance too far back",At.mode=Yy;break t}if(E>>>=V,g-=V,V=r-s,K>V){if(V=K-V,V>h&&At.sane){t.msg="invalid distance too far back",At.mode=Yy;break t}if(j=0,J=m,p===0){if(j+=d-V,V<W){W-=V;do vt[r++]=m[j++];while(--V);j=r-K,J=vt}}else if(p<V){if(j+=d+p-V,V-=p,V<W){W-=V;do vt[r++]=m[j++];while(--V);if(j=0,p<W){V=p,W-=V;do vt[r++]=m[j++];while(--V);j=r-K,J=vt}}}else if(j+=p-V,V<W){W-=V;do vt[r++]=m[j++];while(--V);j=r-K,J=vt}for(;W>2;)vt[r++]=J[j++],vt[r++]=J[j++],vt[r++]=J[j++],W-=3;W&&(vt[r++]=J[j++],W>1&&(vt[r++]=J[j++]))}else{j=r-K;do vt[r++]=vt[j++],vt[r++]=vt[j++],vt[r++]=vt[j++],W-=3;while(W>2);W&&(vt[r++]=vt[j++],W>1&&(vt[r++]=vt[j++]))}break}}break}}while(n<i&&r<c);W=g>>3,n-=W,g-=W<<3,E&=(1<<g)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),At.hold=E,At.bits=g};const zy=15,pW=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),fW=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),mW=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),EW=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Jg=(t,e,n,i,r,s,c,l)=>{const d=l.bits;let h,p,m,E,g,I,y=0,C=0,N=0,D=0,V=0,W=0,K=0,j=0,J=0,ct=0,vt=null;const At=new Uint16Array(16),le=new Uint16Array(16);let ue,qe,Ln,yn=null;for(y=0;y<=zy;y++)At[y]=0;for(C=0;C<i;C++)At[e[n+C]]++;for(V=d,D=zy;D>=1&&At[D]===0;D--);if(V>D&&(V=D),D===0)return r[s++]=20971520,r[s++]=20971520,l.bits=1,0;for(N=1;N<D&&At[N]===0;N++);for(V<N&&(V=N),j=1,y=1;y<=zy;y++)if(j<<=1,j-=At[y],j<0)return-1;if(j>0&&(t===0||D!==1))return-1;for(le[1]=0,y=1;y<zy;y++)le[y+1]=le[y]+At[y];for(C=0;C<i;C++)e[n+C]!==0&&(c[le[e[n+C]]++]=C);if(t===0?(vt=yn=c,I=20):t===1?(vt=pW,yn=fW,I=257):(vt=mW,yn=EW,I=0),ct=0,C=0,y=N,g=s,W=V,K=0,m=-1,J=1<<V,E=J-1,t===1&&J>852||t===2&&J>592)return 1;for(;;){ue=y-K,c[C]+1<I?(qe=0,Ln=c[C]):c[C]>=I?(qe=yn[c[C]-I],Ln=vt[c[C]-I]):(qe=96,Ln=0),h=1<<y-K,p=1<<W,N=p;do p-=h,r[g+(ct>>K)+p]=ue<<24|qe<<16|Ln|0;while(p!==0);for(h=1<<y-1;ct&h;)h>>=1;if(h!==0?(ct&=h-1,ct+=h):ct=0,C++,--At[y]==0){if(y===D)break;y=e[n+c[C]]}if(y>V&&(ct&E)!==m){for(K===0&&(K=V),g+=N,W=y-K,j=1<<W;W+K<D&&(j-=At[W+K],!(j<=0));)W++,j<<=1;if(J+=1<<W,t===1&&J>852||t===2&&J>592)return 1;m=ct&E,r[m]=V<<24|W<<16|g-s|0}}return ct!==0&&(r[g+ct]=y-K<<24|64<<16|0),l.bits=V,0};const{Z_FINISH:px,Z_BLOCK:_W,Z_TREES:qy,Z_OK:bh,Z_STREAM_END:gW,Z_NEED_DICT:SW,Z_STREAM_ERROR:vs,Z_DATA_ERROR:fx,Z_MEM_ERROR:mx,Z_BUF_ERROR:TW,Z_DEFLATED:Ex}=Fy,Xy=16180,Jy=16190,cl=16191,tw=16192,ew=16194,Qy=16199,Zy=16200,nw=16206,di=16209,_x=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function RW(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ih=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Xy||e.mode>16211?1:0},gx=t=>{if(Ih(t))return vs;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Xy,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,bh},Sx=t=>{if(Ih(t))return vs;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,gx(t)},Tx=(t,e)=>{let n;if(Ih(t))return vs;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?vs:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,Sx(t))},Rx=(t,e)=>{if(!t)return vs;const n=new RW;t.state=n,n.strm=t,n.window=null,n.mode=Xy;const i=Tx(t,e);return i!==bh&&(t.state=null),i};let iw,rw,vx=!0;const vW=t=>{if(vx){iw=new Int32Array(512),rw=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Jg(1,t.lens,0,288,iw,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Jg(2,t.lens,0,32,rw,0,t.work,{bits:5}),vx=!1}t.lencode=iw,t.lenbits=9,t.distcode=rw,t.distbits=5},yx=(t,e,n,i)=>{let r;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(e.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(e.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var yW=(t,e)=>{let n,i,r,s,c,l,d,h,p,m,E,g,I,y,C,N,D,V,W,K,j,J,ct=0;const vt=new Uint8Array(4);let At,le;const ue=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ih(t)||!t.output||!t.input&&t.avail_in!==0)return vs;n=t.state,n.mode===cl&&(n.mode=tw),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,m=l,E=d,J=bh;t:for(;;)switch(n.mode){case Xy:if(n.wrap===0){n.mode=tw;break}for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,vt[0]=255&h,vt[1]=h>>>8&255,n.check=cr(n.check,vt,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=di;break}if((15&h)!==Ex){t.msg="unknown compression method",n.mode=di;break}if(h>>>=4,p-=4,j=8+(15&h),n.wbits===0&&(n.wbits=j),j>15||j>n.wbits){t.msg="invalid window size",n.mode=di;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:cl,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.flags=h,(255&tr(n))!==Ex){t.msg="unknown compression method",n.mode=di;break}if(57344&tr(n)){t.msg="unknown header flags set",n.mode=di;break}n.head&&(n.head.text=h>>8&1),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,n.check=cr(n.check,vt,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.time=h),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,vt[2]=h>>>16&255,vt[3]=h>>>24&255,n.check=cr(n.check,vt,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,n.check=cr(n.check,vt,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&tr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&tr(n)&&4&n.wrap&&(vt[0]=255&h,vt[1]=h>>>8&255,n.check=cr(n.check,vt,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&tr(n)&&(g=n.length,g>l&&(g=l),g&&(n.head&&(j=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+g),j)),512&tr(n)&&4&n.wrap&&(n.check=cr(n.check,i,g,s)),l-=g,s+=g,n.length-=g),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&tr(n)){if(l===0)break t;g=0;do j=i[s+g++],n.head&&j&&n.length<65536&&(n.head.name+=String.fromCharCode(j));while(j&&g<l);if(512&tr(n)&&4&n.wrap&&(n.check=cr(n.check,i,g,s)),l-=g,s+=g,j)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&tr(n)){if(l===0)break t;g=0;do j=i[s+g++],n.head&&j&&n.length<65536&&(n.head.comment+=String.fromCharCode(j));while(j&&g<l);if(512&tr(n)&&4&n.wrap&&(n.check=cr(n.check,i,g,s)),l-=g,s+=g,j)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&tr(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=di;break}h=0,p=0}n.head&&(n.head.hcrc=tr(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=cl;break;case 16189:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}t.adler=n.check=_x(h),h=0,p=0,n.mode=Jy;case Jy:if(n.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,SW;t.adler=n.check=1,n.mode=cl;case cl:if(e===_W||e===qy)break t;case tw:if(n.last){h>>>=7&p,p-=7&p,n.mode=nw;break}for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(vW(n),n.mode=Qy,e===qy){h>>>=2,p-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=di}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=di;break}if(n.length=65535&h,h=0,p=0,n.mode=ew,e===qy)break t;case ew:n.mode=16195;case 16195:if(g=n.length,g){if(g>l&&(g=l),g>d&&(g=d),g===0)break t;r.set(i.subarray(s,s+g),c),l-=g,s+=g,d-=g,c+=g,n.length-=g;break}n.mode=cl;break;case 16196:for(;p<14;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=di;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.lens[ue[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[ue[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,At={bits:n.lenbits},J=Jg(0,n.lens,0,19,n.lencode,0,n.work,At),n.lenbits=At.bits,J){t.msg="invalid code lengths set",n.mode=di;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;ct=n.lencode[h&(1<<n.lenbits)-1],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(D<16)h>>>=C,p-=C,n.lens[n.have++]=D;else{if(D===16){for(le=C+2;p<le;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(h>>>=C,p-=C,n.have===0){t.msg="invalid bit length repeat",n.mode=di;break}j=n.lens[n.have-1],g=3+(3&h),h>>>=2,p-=2}else if(D===17){for(le=C+3;p<le;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=C,p-=C,j=0,g=3+(7&h),h>>>=3,p-=3}else{for(le=C+7;p<le;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=C,p-=C,j=0,g=11+(127&h),h>>>=7,p-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=di;break}for(;g--;)n.lens[n.have++]=j}}if(n.mode===di)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=di;break}if(n.lenbits=9,At={bits:n.lenbits},J=Jg(1,n.lens,0,n.nlen,n.lencode,0,n.work,At),n.lenbits=At.bits,J){t.msg="invalid literal/lengths set",n.mode=di;break}if(n.distbits=6,n.distcode=n.distdyn,At={bits:n.distbits},J=Jg(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,At),n.distbits=At.bits,J){t.msg="invalid distances set",n.mode=di;break}if(n.mode=Qy,e===qy)break t;case Qy:n.mode=Zy;case Zy:if(l>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,hW(t,E),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,n.mode===cl&&(n.back=-1);break}for(n.back=0;ct=n.lencode[h&(1<<n.lenbits)-1],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(N&&(240&N)==0){for(V=C,W=N,K=D;ct=n.lencode[K+((h&(1<<V+W)-1)>>V)],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(V+C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=V,p-=V,n.back+=V}if(h>>>=C,p-=C,n.back+=C,n.length=D,N===0){n.mode=16205;break}if(32&N){n.back=-1,n.mode=cl;break}if(64&N){t.msg="invalid literal/length code",n.mode=di;break}n.extra=15&N,n.mode=16201;case 16201:if(n.extra){for(le=n.extra;p<le;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;ct=n.distcode[h&(1<<n.distbits)-1],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((240&N)==0){for(V=C,W=N,K=D;ct=n.distcode[K+((h&(1<<V+W)-1)>>V)],C=ct>>>24,N=ct>>>16&255,D=65535&ct,!(V+C<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=V,p-=V,n.back+=V}if(h>>>=C,p-=C,n.back+=C,64&N){t.msg="invalid distance code",n.mode=di;break}n.offset=D,n.extra=15&N,n.mode=16203;case 16203:if(n.extra){for(le=n.extra;p<le;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=di;break}n.mode=16204;case 16204:if(d===0)break t;if(g=E-d,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=di;break}g>n.wnext?(g-=n.wnext,I=n.wsize-g):I=n.wnext-g,g>n.length&&(g=n.length),y=n.window}else y=r,I=c-n.offset,g=n.length;g>d&&(g=d),d-=g,n.length-=g;do r[c++]=y[I++];while(--g);n.length===0&&(n.mode=Zy);break;case 16205:if(d===0)break t;r[c++]=n.length,d--,n.mode=Zy;break;case nw:if(n.wrap){for(;p<32;){if(l===0)break t;l--,h|=i[s++]<<p,p+=8}if(E-=d,t.total_out+=E,n.total+=E,4&n.wrap&&E&&(t.adler=n.check=tr(n)?cr(n.check,r,E,c-E):Gg(n.check,r,E,c-E)),E=d,4&n.wrap&&(tr(n)?h:_x(h))!==n.check){t.msg="incorrect data check",n.mode=di;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&tr(n)){for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=di;break}h=0,p=0}n.mode=16208;case 16208:J=gW;break t;case di:J=fx;break t;case 16210:return mx;default:return vs}return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,(n.wsize||E!==t.avail_out&&n.mode<di&&(n.mode<nw||e!==px))&&yx(t,t.output,t.next_out,E-t.avail_out),m-=t.avail_in,E-=t.avail_out,t.total_in+=m,t.total_out+=E,n.total+=E,4&n.wrap&&E&&(t.adler=n.check=tr(n)?cr(n.check,r,E,t.next_out-E):Gg(n.check,r,E,t.next_out-E)),t.data_type=n.bits+(n.last?64:0)+(n.mode===cl?128:0)+(n.mode===Qy||n.mode===ew?256:0),(m===0&&E===0||e===px)&&J===bh&&(J=TW),J},ll={inflateReset:Sx,inflateReset2:Tx,inflateResetKeep:gx,inflateInit:t=>Rx(t,15),inflateInit2:Rx,inflate:yW,inflateEnd:t=>{if(Ih(t))return vs;let e=t.state;return e.window&&(e.window=null),t.state=null,bh},inflateGetHeader:(t,e)=>{if(Ih(t))return vs;const n=t.state;return(2&n.wrap)==0?vs:(n.head=e,e.done=!1,bh)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,s;return Ih(t)?vs:(i=t.state,i.wrap!==0&&i.mode!==Jy?vs:i.mode===Jy&&(r=1,r=Gg(r,e,n,0),r!==i.check)?fx:(s=yx(t,e,n,n),s?(i.mode=16210,mx):(i.havedict=1,bh)))},inflateInfo:"pako inflate (from Nodeca project)"},CW=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Cx=Object.prototype.toString,{Z_NO_FLUSH:AW,Z_FINISH:bW,Z_OK:Qg,Z_STREAM_END:aw,Z_NEED_DICT:sw,Z_STREAM_ERROR:IW,Z_DATA_ERROR:Ax,Z_MEM_ERROR:OW}=Fy;function $y(t){this.options=Hy.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dx,this.strm.avail_out=0;let n=ll.inflateInit2(this.strm,e.windowBits);if(n!==Qg)throw new Error(vh[n]);if(this.header=new CW,ll.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Xg.string2buf(e.dictionary):Cx.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=ll.inflateSetDictionary(this.strm,e.dictionary),n!==Qg)))throw new Error(vh[n])}function wW(t,e){const n=new $y(e);if(n.push(t),n.err)throw n.msg||vh[n.err];return n.result}$y.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?bW:AW,Cx.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=ll.inflate(n,c),s===sw&&r&&(s=ll.inflateSetDictionary(n,r),s===Qg?s=ll.inflate(n,c):s===Ax&&(s=sw));n.avail_in>0&&s===aw&&n.state.wrap>0&&t[n.next_in]!==0;)ll.inflateReset(n),s=ll.inflate(n,c);switch(s){case IW:case Ax:case sw:case OW:return this.onEnd(s),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||s===aw))if(this.options.to==="string"){let d=Xg.utf8border(n.output,n.next_out),h=n.next_out-d,p=Xg.buf2string(n.output,d);n.next_out=h,n.avail_out=i-h,h&&n.output.set(n.output.subarray(d,d+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==Qg||l!==0){if(s===aw)return s=ll.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},$y.prototype.onData=function(t){this.chunks.push(t)},$y.prototype.onEnd=function(t){t===Qg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Hy.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var NW={inflate:wW};const{deflate:DW}=dW,{inflate:LW}=NW;var PW=DW,kW=LW,bx=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(bx||{});class MW{constructor(){O(this,"_sequence",0),O(this,"_startTime",Date.now()),O(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const d={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;M("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),s=new DataView(i);let c=0;if(s.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,s.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const s={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,M("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(i,!0),i+=2,s.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let d=!1;if(l.datas.length>0){const h=l.datas.find(p=>p.id===0);h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}c=d?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,s=new ArrayBuffer(i+2),c=new Uint8Array(s),l=new DataView(s);let d=0;if(l.setUint8(d++,n),l.setUint8(d++,i),r.forEach(h=>{n?(l.setUint8(d++,h.id),l.setUint8(d++,h.length),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(l.setUint8(d++,h.id|h.length<<4),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength)}),d!==i+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(i+2));return s}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const s=n.getUint8(i);i++;const c=r===bx.TWO_BYTE,l=[],d=new DataView(e,2);let h=0;for(;h<s;){let p=0,m=0,E=new ArrayBuffer(0);c?(p=d.getUint8(h),h++,m=d.getUint8(h),h++):(p=15&d.getUint8(h),m=d.getUint8(h)>>4,h++),m>0&&(E=d.buffer.slice(h+2,h+2+m),h+=E.byteLength),l.push({id:p,length:m,data:E})}if(h!==s)throw Error("parse error");return{profile:r,length:s,datas:l}}decompress(e){return kW(new Uint8Array(e))}compress(e){return PW(new Uint8Array(e))}}const UW={name:"DataStream",create:(t,e)=>{const n=e?new H5(t):new W5(t);return n.useDataStream(new MW),n}};class xW extends hn{constructor(e,n,i){super(),O(this,"ws",void 0),O(this,"requestId",1),O(this,"heartBeatTimer",void 0),O(this,"joinInfo",void 0),O(this,"clientId",void 0),O(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),O(this,"onClose",r=>{this.emit("close"),this.dispose()}),O(this,"onMessage",r=>{const s=JSON.parse(r.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=n,this.ws=new yg("cross-channel-".concat(this.clientId),i),this.ws.on($t.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on($t.CONNECTED,this.onOpen),this.ws.on($t.ON_MESSAGE,this.onMessage),this.ws.on($t.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new St((n,i)=>{const r=window.setTimeout(()=>{i(new z(L.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(r),s.state&&s.state!==0?i(new z(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new z(L.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new z(L.WS_DISCONNECT);const n=()=>new St((c,l)=>{this.ws.once($t.CLOSED,()=>l(new z(L.WS_ABORT))),this.ws.once($t.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new St((c,l)=>{const d=()=>{l(new z(L.WS_ABORT))};this.ws.once($t.RECONNECTING,d),this.ws.once($t.CLOSED,d),this.once("req_".concat(i),c),_i(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off($t.RECONNECTING,d),this.ws.off($t.CLOSED,d),l(new z(L.TIMEOUT,"cross channel ws request timeout"))})}),s=await r;if(!s||s.code!==200)throw new z(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners($t.REQUEST_NEW_URLS),this.ws.on($t.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class VW extends hn{set state(e){e!==this._state&&(e!==Ur.RELAY_STATE_FAILURE&&(this.errorCode=rm.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,s){super(),O(this,"joinInfo",void 0),O(this,"sid",void 0),O(this,"clientId",void 0),O(this,"cancelToken",Er.CancelToken.source()),O(this,"workerToken",void 0),O(this,"requestId",0),O(this,"signal",void 0),O(this,"prevChannelMediaConfig",void 0),O(this,"httpRetryConfig",void 0),O(this,"_resolution",void 0),O(this,"_state",Ur.RELAY_STATE_IDLE),O(this,"errorCode",rm.RELAY_OK),O(this,"onStatus",c=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",nl.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",nl.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=rm.SRC_TOKEN_EXPIRED,this.state=Ur.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=rm.DEST_TOKEN_EXPIRED,this.state=Ur.RELAY_STATE_FAILURE))}),O(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",nl.NETWORK_DISCONNECTED),this.state=Ur.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Ur.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",c.toString()),this.errorCode=rm.SERVER_CONNECTION_LOST,this.state=Ur.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=ah(),this.signal=new xW(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==Ur.RELAY_STATE_IDLE)throw new z(L.INVALID_OPERATION);this.state=Ur.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new z(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new z(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new z(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Ur.RELAY_STATE_RUNNING)throw new z(L.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Ur.RELAY_STATE_RUNNING)throw new z(L.INVALID_OPERATION);const n=this.genMessage(or.SetVideoProfile);await this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ur.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Er.CancelToken.source(),this.state=Ur.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await qH(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",nl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(or.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(or.SetSdkProfile,e);await this.signal.request(i),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(or.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",nl.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(or.SetSourceUserId,e);await this.signal.request(s),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(or.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",nl.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(or.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",nl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ur.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(or.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",nl.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(or.StopPacketTransfer);await this.signal.request(e),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],s=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ua,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.2"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(e){case or.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case or.SetSourceChannel:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new z(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case or.SetSourceUserId:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new z(L.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case or.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new z(L.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:s},c;case or.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case or.Reconnect:return c.clientRequest={command:"Reconnect"},c;case or.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case or.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new z(L.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:s},c;case or.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const BW={name:"ChannelMediaRelay",create:function(t){return new VW(t.joinInfo,t.clientId,t.websocketRetryConfig||Hn,t.httpRetryConfig||Hn,t.resolution)}};function Ix(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Zg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ix(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ix(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class FW extends hn{constructor(e,n,i,r){super(),O(this,"spec",void 0),O(this,"token",void 0),O(this,"websocket",void 0),O(this,"pingpongTimer",void 0),O(this,"reconnectMode","retry"),O(this,"serviceMode",void 0),O(this,"reqId",0),O(this,"commandReqId",0),O(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),O(this,"handleWebSocketMessage",s=>{if(!s.data)return;const c=JSON.parse(s.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(Mt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===el.TRANSCODE?1:2}),this.emit(Su.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new yg("live-streaming",i),this.websocket.on($t.CONNECTED,this.handleWebSocketOpen),this.websocket.on($t.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on($t.REQUEST_NEW_URLS,(s,c)=>{wi(this,Su.REQUEST_NEW_ADDRESS).then(s).catch(c)}),this.websocket.on($t.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const s=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new z(L.UNEXPECTED_ERROR);const l=Zg({command:e,sdkVersion:Ua==="4.23.2"?"0.0.1":Ua,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new z(L.WS_DISCONNECT);const d=()=>new St((E,g)=>{this.websocket.once($t.CLOSED,()=>g(new z(L.WS_ABORT))),this.websocket.once($t.CONNECTED,E)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const h=new St((E,g)=>{const I=()=>{g(new z(L.WS_ABORT))};this.websocket.once($t.RECONNECTING,I),this.websocket.once($t.CLOSED,I),this.once("@".concat(c,"-").concat(this.spec.sid),y=>{E(y)})});r&&Mt.workerEvent(this.spec.sid,Zg(Zg({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await h}catch(E){if(this.websocket.state==="closed")throw E;return await d(),await this.request(e,n,i)}return r&&Mt.workerEvent(this.spec.sid,Zg(Zg({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-p})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=Ua==="4.23.2"?"0.0.1":Ua;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Xn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case Xn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Xn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Xn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new z(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new z(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new z(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Su.WARNING,n,e.serverResponse.url)}case Xn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new z(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Su.WARNING,n,e.serverResponse.url)}case Xn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Xn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new z(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new z(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Su.WARNING,n,e.serverResponse.url)}case Xn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Xn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Xn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xn.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Xn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new z(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Fv)},6e3)}}function Ox(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function xr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ox(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ox(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class jW extends hn{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Hn;super(),O(this,"onLiveStreamWarning",void 0),O(this,"onLiveStreamError",void 0),O(this,"spec",void 0),O(this,"retryTimeout",1e4),O(this,"connection",void 0),O(this,"httpRetryConfig",void 0),O(this,"wsRetryConfig",void 0),O(this,"streamingTasks",new Map),O(this,"isStartingStreamingTask",!1),O(this,"taskMutex",new Ui("live-streaming")),O(this,"cancelToken",Er.CancelToken.source()),O(this,"transcodingConfig",void 0),O(this,"uapResponse",void 0),O(this,"lastTaskId",1),O(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=xr(xr({},IH),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>xr(xr(xr({},bH),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){_n(c.width)||Ve(c.width,"config.width",0,1e4),_n(c.height)||Ve(c.height,"config.height",0,1e4),_n(c.videoBitrate)||Ve(c.videoBitrate,"config.videoBitrate",1,1e6),_n(c.videoFrameRate)||Ve(c.videoFrameRate,"config.videoFrameRate"),_n(c.lowLatency)||Qc(c.lowLatency,"config.lowLatency"),_n(c.audioSampleRate)||Zn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),_n(c.audioBitrate)||Ve(c.audioBitrate,"config.audioBitrate",1,128),_n(c.audioChannels)||Zn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),_n(c.videoGop)||Ve(c.videoGop,"config.videoGop"),_n(c.videoCodecProfile)||Zn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),_n(c.userCount)||Ve(c.userCount,"config.userCount",0,17),_n(c.backgroundColor)||Ve(c.backgroundColor,"config.backgroundColor",0,16777215),_n(c.userConfigExtraInfo)||Ei(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!_n(c.transcodingUsers)&&(Zc(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{uy(l.uid),_n(l.x)||Ve(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),_n(l.y)||Ve(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),_n(l.width)||Ve(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),_n(l.height)||Ve(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),_n(l.zOrder)||Ve(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),_n(l.alpha)||Ve(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),_n(c.watermark)||cO(c.watermark,"watermark"),_n(c.backgroundImage)||cO(c.backgroundImage,"backgroundImage"),c.images&&!_n(c.images)&&(Zc(c.images,"config.images"),c.images.forEach((l,d)=>{cO(l,"images[".concat(d,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>xr(xr(xr({},oO),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(xr(xr(xr({},oO),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(xr(xr(xr({},oO),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>xr({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?St.resolve(c.uid):J1(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await St.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var s;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Lr(s=this.streamingTasks).call(s)).map(l=>l.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===el.TRANSCODE)throw new z(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&i)return void s();if(this.streamingTasks.get(e)&&!i)return s(),new z(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw s(),l}switch(n){case el.TRANSCODE:r.transcodingConfig=xr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new St((h,p)=>{_i(this.retryTimeout).then(()=>{if(i)return p(i);const m=this.statusError.get(e);return m?(this.statusError.delete(e),p(m)):void 0})}),d=await St.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===el.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),s()}catch(l){if(s(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new St((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new z(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=r.mode;r.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:s===el.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(Lr(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Er.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new z(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await wi(this,lO.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new FW(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Su.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(Su.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Su.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new z(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));wi(this,lO.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,i(s.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case Xn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Xn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new z(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return T.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Xn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new z(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Xn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Xn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Lr(s=this.streamingTasks).call(s));for(const l of c)l.abortTask?l.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new z(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{T.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const GW={name:"LiveStreaming",create:function(t){return new jW(t.joinInfo,t.websocketRetryConfig||Hn,t.httpRetryConfig||Hn)}};function HW(t){let e=Dx();return function(n,i){let r=n.appId;r!==void 0&&(Le(i,10),dc(i,r));let s=n.cid;s!==void 0&&(Le(i,16),Le(i,s));let c=n.cname;c!==void 0&&(Le(i,26),dc(i,c));let l=n.deviceId;l!==void 0&&(Le(i,34),dc(i,l));let d=n.elapse;d!==void 0&&(Le(i,40),Pu(i,d));let h=n.fileSize;h!==void 0&&(Le(i,48),Pu(i,Rm(h)));let p=n.height;p!==void 0&&(Le(i,56),Pu(i,Rm(p)));let m=n.jpg;m!==void 0&&(Le(i,66),Le(i,m.length),function(vr,nt){let ft=vm(vr,nt.length);vr.bytes.set(nt,ft)}(i,m));let E=n.networkType;E!==void 0&&(Le(i,72),Pu(i,Rm(E)));let g=n.osType;g!==void 0&&(Le(i,80),Pu(i,Rm(g)));let I=n.requestId;I!==void 0&&(Le(i,90),dc(i,I));let y=n.sdkVersion;y!==void 0&&(Le(i,98),dc(i,y));let C=n.sequence;C!==void 0&&(Le(i,104),Pu(i,Rm(C)));let N=n.sid;N!==void 0&&(Le(i,114),dc(i,N));let D=n.timestamp;D!==void 0&&(Le(i,120),Pu(i,D));let V=n.uid;V!==void 0&&(Le(i,128),Le(i,V));let W=n.vid;W!==void 0&&(Le(i,136),Le(i,W));let K=n.width;K!==void 0&&(Le(i,144),Pu(i,Rm(K)));let j=n.service;j!==void 0&&(Le(i,152),Le(i,j));let J=n.callbackData;J!==void 0&&(Le(i,162),dc(i,J));let ct=n.jpgEncryption;ct!==void 0&&(Le(i,168),Le(i,ct));let vt=n.requestType;vt!==void 0&&(Le(i,176),Le(i,vt));let At=n.scorePorn;At!==void 0&&(Le(i,185),dw(i,At));let le=n.scoreSexy;le!==void 0&&(Le(i,193),dw(i,le));let ue=n.scoreNeutral;ue!==void 0&&(Le(i,201),dw(i,ue));let qe=n.scene;qe!==void 0&&(Le(i,208),Le(i,qe));let Ln=n.ossFilePrefix;Ln!==void 0&&(Le(i,218),dc(i,Ln));let yn=n.serviceVendor;if(yn!==void 0)for(let vr of yn){Le(i,226);let nt=Dx();YW(vr,nt),Le(i,nt.limit),JW(i,nt),XW(nt)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function WW(t){return function(n){let i={};t:for(;!Lx(n);){let r=hc(n);switch(r>>>3){case 0:break t;case 1:i.code=hc(n);break;case 2:i.msg=Px(n,hc(n));break;case 3:{let s=zW(n);i.data=KW(n),n.limit=s;break}default:wx(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function KW(t){let e={};t:for(;!Lx(t);){let n=hc(t);switch(n>>>3){case 0:break t;case 1:e.requestId=Px(t,hc(t));break;case 2:e.requestType=hc(t)>>>0;break;case 3:e.scorePorn=uw(t);break;case 4:e.scoreSexy=uw(t);break;case 5:e.scoreNeutral=uw(t);break;case 6:e.requestScene=hc(t)>>>0;break;case 7:e.scene=hc(t)>>>0;break;default:wx(t,7&n)}}return e}function YW(t,e){let n=t.service;n!==void 0&&(Le(e,8),Le(e,n));let i=t.vendor;i!==void 0&&(Le(e,16),Le(e,i));let r=t.token;r!==void 0&&(Le(e,26),dc(e,r));let s=t.callbackUrl;s!==void 0&&(Le(e,34),dc(e,s))}function zW(t){let e=hc(t),n=t.limit;return t.limit=t.offset+e,n}function wx(t,e){switch(e){case 0:for(;128&kx(t););break;case 2:cw(t,hc(t));break;case 5:cw(t,4);break;case 1:cw(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let qW=new Float32Array(1);new Uint8Array(qW.buffer);let ow=new Float64Array(1),Vr=new Uint8Array(ow.buffer);function Rm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Nx=[];function Dx(){const t=Nx.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function XW(t){Nx.push(t)}function cw(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function Lx(t){return t.offset>=t.limit}function vm(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function lw(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function Px(t,e){let n=lw(t,e),i=String.fromCharCode,r=t.bytes,s="�",c="";for(let l=0;l<e;l++){let d,h,p,m,E=r[l+n];(128&E)==0?c+=i(E):(224&E)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(m=(31&E)<<6|63&d,m<128?c+=s:(c+=i(m),l++))):(240&E)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(m=(15&E)<<12|(63&d)<<6|63&h,m<2048||m>=55296&&m<=57343?c+=s:(c+=i(m),l+=2))):(248&E)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(m=(7&E)<<18|(63&d)<<12|(63&h)<<6|63&p,m<65536||m>1114111?c+=s:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=s}return c}function dc(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}Le(t,i);let r=vm(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function JW(t,e){let n=vm(t,e.limit),i=t.bytes,r=e.bytes;for(let s=0,c=e.limit;s<c;s++)i[s+n]=r[s]}function kx(t){return t.bytes[lw(t,1)]}function Mx(t,e){let n=vm(t,1);t.bytes[n]=e}function uw(t){let e=lw(t,8),n=t.bytes;return Vr[0]=n[e++],Vr[1]=n[e++],Vr[2]=n[e++],Vr[3]=n[e++],Vr[4]=n[e++],Vr[5]=n[e++],Vr[6]=n[e++],Vr[7]=n[e++],ow[0]}function dw(t,e){let n=vm(t,8),i=t.bytes;ow[0]=e,i[n++]=Vr[0],i[n++]=Vr[1],i[n++]=Vr[2],i[n++]=Vr[3],i[n++]=Vr[4],i[n++]=Vr[5],i[n++]=Vr[6],i[n++]=Vr[7]}function hc(t){let e,n=0,i=0;do e=kx(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function Le(t,e){for(e>>>=0;e>=128;)Mx(t,127&e|128),e>>>=7;Mx(t,e)}function Pu(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=vm(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}function Ux(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const QW=new Map([["moderation",1],["supervise",2]]);class ZW extends hn{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(ui.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=er(n=e.map(i=>QW.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),O(this,"name","AgoraRTCVideoContentInspect"),O(this,"_connectionState",Es.CONNECTING),O(this,"_innerConnectionState",void 0),O(this,"sequence",0),O(this,"inspectStartTime",void 0),O(this,"workerManagerConnection",void 0),O(this,"workerConnection",void 0),O(this,"workerMessageLengthLimit",void 0),O(this,"inspectIntervalMinimum",void 0),O(this,"qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Er.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"wmSequence",0),O(this,"inspectInterval",void 0),O(this,"inspectTimer",null),O(this,"ossFilePrefix",void 0),O(this,"extraInfo",void 0),O(this,"_inspectType",void 0),O(this,"_inspectMode",void 0),O(this,"_quality",1),O(this,"qualityTimer",null),O(this,"_inspectId",void 0),O(this,"_needWorkUrlOnly",!1),O(this,"inspectImage",()=>{if(this.connectionState!==Es.CONNECTED)throw new z(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Es.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ye(5,"inspect-"),this.workerMessageLengthLimit=M("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=M("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=M("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new yg("worker-manager-"+this._inspectId,Hn),this.on(ui.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(_s[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new yg("worker-"+this._inspectId,Hn),this.handleWorkerEvents()}async init(e,n){this.emit(ui.STATE_CHANGE,_s.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new St((r,s)=>{this.on(ui.CONNECTION_STATE_CHANGE,(c,l)=>{l===Es.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{s(c)})})}async requestAP(e,n,i){const r=M("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,d,h,p){let{appId:m,areaCode:E,cname:g,sid:I,token:y,uid:C}=d;dm++;const N="image_moderation_api",D={service_name:N,json_body:JSON.stringify({appId:m,areaCode:E,cname:g,command:"allocateEdge",requestId:dm,seq:dm,sid:I,token:y,ts:Date.now(),uid:C+""})};let V,W,K=l[0];return to(async()=>{V=Date.now();const j=await ao(K,{data:D,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-V,j.code!==0){const At=new z(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+j.code,{retry:!0,responseTime:W});throw T.error(At.toString()),At}const J=JSON.parse(j.json_body);if(J.code!==200){const At=new z(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:W});throw T.error(At.toString()),At}if(!J.servers||!Array.isArray(J.servers)||J.servers.length===0){const At=new z(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:J.code,responseTime:W});throw T.error(At.toString()),At}const ct=M("VIDEO_INSPECT_WORKER_MANAGER_HOST"),vt=M("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:J.servers.map(At=>{let{address:le,wss:ue}=At;if(le&&ue)return"wss://".concat(le.replace(/\./g,"-"),".").concat(ct,":").concat(vt||ue)}).filter(At=>!!At),workerToken:J.workerToken,vid:J.vid,responseTime:W}},(j,J)=>(Mt.apworkerEvent(I,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(j.addressList),firstSuccess:J===0,responseTime:W,serverIp:l[J%l.length]}),!1),(j,J)=>(Mt.apworkerEvent(I,{success:!1,sc:j.data&&j.data.code||200,serviceName:N,responseTime:W,serverIp:l[J%l.length]}),!!(j.code!==L.OPERATION_ABORTED&&j.code!==L.UNEXPECTED_RESPONSE||j.data&&j.data.retry)&&(K=l[(J+1)%l.length],!0)),p)}(r,e,n,i);this.emit(ui.STATE_CHANGE,_s.AP_CONNECTED);const{addressList:c}=s;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(ui.STATE_CHANGE,_s.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on($t.CONNECTED,async()=>{this.emit(ui.STATE_CHANGE,_s.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on($t.CLOSED,()=>{this._innerConnectionState<_s.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on($t.FAILED,()=>{this._innerConnectionState<_s.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on($t.RECONNECTING,()=>{this._innerConnectionState<_s.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on($t.ON_MESSAGE,async e=>{this.emit(ui.STATE_CHANGE,_s.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new z(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new z(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=M("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(r));this.emit(ui.STATE_CHANGE,_s.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(ui.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on($t.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on($t.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on($t.CONNECTED,async()=>{this.emit(ui.STATE_CHANGE,_s.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Es.CONNECTED}),this.workerConnection.on($t.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=WW(new Uint8Array(e.data));if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ui.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},s=er(n=Object.keys(r)).call(n,(l,d)=>r[l]>r[d]?l:d,"porn"),c=Object.keys(r).find(l=>l===s);this.emit(ui.INSPECT_RESULT,c)}else this.emit(ui.INSPECT_RESULT,void 0,new z(L.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(ui.INSPECT_RESULT,void 0,new z(L.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ui.INSPECT_RESULT,void 0,new z(L.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on($t.CLOSED,()=>{this.connectionState=Es.CLOSED}),this.workerConnection.on($t.FAILED,()=>{this.connectionState=Es.CLOSED}),this.workerConnection.on($t.RECONNECTING,()=>{this.connectionState=this.connectionState===Es.CONNECTED?Es.RECONNECTING:Es.CONNECTING}),this.workerConnection.on($t.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on($t.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(ui.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=ca(this,ui.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(ui.INSPECT_RESULT,void 0,new z(L.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(ui.INSPECT_RESULT,void 0,new z(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await _k(p,i,r),E=this.sequence+"-"+s+"-"+d+"-"+h+"-"+Ye(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:(I=Number(h-this.inspectStartTime),{low:I|=0,high:I>>31,unsigned:I>=0}),fileSize:m.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:E,sdkVersion:"4.23.2",sequence:this.sequence,sid:l,timestamp:WU(h),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var I;this.extraInfo===void 0&&delete g.callbackData,this.ossFilePrefix===void 0&&delete g.ossFilePrefix;const y=HW(g);if(y.byteLength<this.workerMessageLengthLimit){if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const C=function(N){for(var D=1;D<arguments.length;D++){var V=arguments[D]!=null?arguments[D]:{};D%2?Ux(Object(V),!0).forEach(function(W){O(N,W,V[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(V)):Ux(Object(V)).forEach(function(W){Object.defineProperty(N,W,Object.getOwnPropertyDescriptor(V,W))})}return N}({},g);delete C.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(C))}return y}{const C=this.quality*this.qualityRatio;return this.quality=C,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Er.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Es.CLOSED,this.emit(ui.STATE_CHANGE,_s.CLOSED)}}const $W={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new z(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new z(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var s;if(!Et(s=["supervise","moderation"]).call(s,r))throw new z(L.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new z(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new ZW(e)}};var xx=P(Wr.Object.getOwnPropertySymbols),t8=De,e8=Ac.indexOf,n8=fr,hw=hi([].indexOf),Vx=!!hw&&1/hw([1],1,-0)<0;t8({target:"Array",proto:!0,forced:Vx||!n8("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return Vx?hw(this,t,e)||0:e8(this,t,e)}});var i8=hr("Array").indexOf,r8=mt,a8=i8,pw=Array.prototype,s8=function(t){var e=t.indexOf;return t===pw||r8(pw,t)&&e===pw.indexOf?a8:e},Bx=P(s8);function o8(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var d,h,p={},m=a1(c);for(h=0;h<m.length;h++)d=m[h],Bx(l).call(l,d)>=0||(p[d]=c[d]);return p}(t,e);if(xx){var s=xx(t);for(i=0;i<s.length;i++)n=s[i],Bx(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let Fx=class{get localCapabilities(){return Sn(this._localCapabilities)}get rtpCapabilities(){return Sn(this._rtpCapabilities)}get candidates(){return Sn(this._candidates)}get iceParameters(){return Sn(this._iceParameters)}get dtlsParameters(){return Sn(this._dtlsParameters)}constructor(t){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname","o/i14u9pJrxRKAsu"),O(this,"firefoxSsrcMidMap",new Map),t=Sn(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:s,direction:c,setup:l,videoCodec:d,audioCodec:h}=t;let p;this.setup=l,p=c===sr.RECEIVE_ONLY?Mr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Mr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=s;const m=c===sr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,E=c===sr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,g=c===sr.RECEIVE_ONLY?r.send.videoCodecs:bg(It.VIDEO,m,E,d),I=c===sr.RECEIVE_ONLY?r.send.audioCodecs:bg(It.AUDIO,m,E,h);for(const y of p.mediaDescriptions)y.attributes.iceUfrag=e.iceUfrag,y.attributes.icePwd=e.icePwd,y.attributes.fingerprints=n.fingerprints,y.attributes.candidates=i,y.attributes.setup=this.setup,y.media.mediaType==="application"&&(y.attributes.sctpPort="5000"),y.media.mediaType==="video"&&(y.media.fmts=g.map(C=>C.payloadType.toString(10)),y.attributes.payloads=g,y.attributes.extmaps=m.videoExtensions),y.media.mediaType==="audio"&&(y.media.fmts=I.map(C=>C.payloadType.toString(10)),y.attributes.payloads=I,y.attributes.extmaps=m.audioExtensions,um(y));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return gu(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:c}=fh(e,this.cname,M("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(s);if(l){if(En()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(t,s,i);let h;return d===-1?(h=this.createOrRecycleSendMedia(t,s,c,"sendonly",i,r),this.updateBundleMids()):(h=Sn(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,r)),En()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const s=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s);let l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=Sn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:d})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:s,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(t),h={foundation:e??"",componentId:"1",transport:n??"",priority:d?d+"":"",connectionAddress:i??"",port:r?r+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const s=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=bg(s,c,this.localCapabilities.send,s===It.AUDIO?r:i),d=s===It.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,t);const m=this.findFirstClosedMedia(s);if(m){const E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Et(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Et(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(En()){if(r){const s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!s||s!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=Sn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,s){const c=this.rtpCapabilities.send,l=t===It.VIDEO?c.videoCodecs:c.audioCodecs,d=t===It.VIDEO?c.videoExtensions:c.audioExtensions;En()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,s);const p=this.findFirstClosedMedia(t);if(p){const m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(t,e,n){const i=Sn(t);return fO(i),lm(i,e),mO(i,e),N1(i),_y(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Sn(t);return _y(n,e,this.localCapabilities.recv),um(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>En()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const c8=["sdp"];var Qe;function jx(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ku(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jx(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jx(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Gx=(Qe=class ym extends d1{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),O(this,"direction",void 0),O(this,"name",void 0),O(this,"store",void 0),O(this,"spec",void 0),O(this,"peerConnection",void 0),O(this,"initialOffer",void 0),O(this,"transport",void 0),O(this,"statsFilter",void 0),O(this,"localCandidateCount",0),O(this,"_isInRestartIce",!1),O(this,"mutex",void 0),O(this,"onLocalCandidate",void 0),O(this,"remoteSDP",void 0),O(this,"pendingCandidates",[]),O(this,"localCapabilities",void 0),O(this,"isReady",!1),O(this,"restartCnt",0),O(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new Ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(ym.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??sr.SEND_ONLY,this.name=this.direction===sr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=OI(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,En()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await L1();if(this.localCapabilities=gy(n),e){const{sdp:i}=e,r=o8(e,c8),s=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=Ag(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(gs(m,p,"videoExtensions",E,g,I),gs(m,p,"videoCodecs",E,g,I),gs(m,p,"audioExtensions",E,g,I),gs(m,p,"audioCodecs",E,g,I),M("RAISE_H264_BASELINE_PRIORITY")){const y=I.videoCodecs.findIndex(C=>C.rtpMap&&C.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&C.fmtp&&C.fmtp.parameters["profile-level-id"]==="42001f");if(y!==-1){const C=I.videoCodecs.findIndex(N=>N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(C<y){T.debug("raising H264 baseline profile priority");const N=I.videoCodecs[y];I.videoCodecs.splice(y,1),I.videoCodecs.splice(C,0,N)}C!==-1&&M("FILTER_SEND_H264_BASELINE")&&(E.videoCodecs=E.videoCodecs.filter(N=>!(N.rtpMap&&N.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&N.fmtp&&N.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:E,recv:g,sendrecv:I}}({},{},i);this.remoteSDP=new Fx({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=yu(c.sdp);await this.peerConnection.setLocalDescription(c);const d=await P1({},{},c.sdp);this.localCapabilities=gy(d);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),ku(ku({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=yu(i.sdp);return this.initialOffer=i,ku(ku({},r),{},{sdp:i.sdp})}}catch(n){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,s=await P1({},{},n);this.remoteSDP=new Fx({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new $(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Ma(function*(){const s=yield Ee(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((C,N)=>{if(l[N].needCreateTransceiver){const D=r.peerConnection.addTransceiver(C._mediaStreamTrack,{direction:"sendonly"});c.push(D),C._updateRtpTransceiver(D)}else{const D=r.peerConnection.getTransceivers().find(V=>V.mid===l[N].mid);if(!D)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[N].mid));c.push(D),C._updateRtpTransceiver(D)}}),En()&&M("SIMULCAST")===!0&&(yield Ee(r.applySimulcastForFirefox(c,e)));const d=l.map(C=>C.mid),h=yield Ee(r.peerConnection.createOffer()),p=r.mungSendOfferSDP(h.sdp,e,d),m=Mr(p),E=d.map(C=>{const N=m.mediaDescriptions.find(D=>D.attributes.mid===C);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return I1(N,M("USE_PUB_RTX"))}),g=c.map((C,N)=>{const D=d[N];return{localSSRC:E[N],id:D}});yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield g}catch(C){const N=r.remoteSDP.toString();throw yield Ee(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(r.peerConnection.setRemoteDescription({type:"answer",sdp:N})),yield Ee(r.stopSending(d,!0)),C}yield Ee(r.applySimulcastEncodings(c,e)),yield Ee(r.applySendEncodings(c,e));const I=r.remoteSDP.toString(),y=r.logSDPExchange(p,"offer","local","send");return y==null||y(I),yield Ee(r.setRemoteDescription({type:"answer",sdp:I})),c.map((C,N)=>{const D=d[N];return{localSSRC:E[N],id:D}})}catch(c){throw c instanceof $?c:new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,e);h==null||h(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,e);d==null||d(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===sh.Auto&&(this.store.p2pTransport=sh.SdRtn,Te().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ym.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Te().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ym.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=yu(n.sdp);return this.store.descriptionStart(),this.direction===sr.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===sr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=yu(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?En()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:ku(ku({},Zo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:ku(ku({},Zo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;Et(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var s;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(hg(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...ym.turnServerConfigToIceServers(e.turnServer.servers,n,i)),M("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...ym.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),Et(s=[sh.Relay,sh.SdRtn]).call(s,n)&&(r.iceTransportPolicy="relay"),M("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&Te().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],s=e.filter(l=>l.tcpport);T.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(i));const c=s.length>i?s[i]:s[0];switch(n){case sh.SdRtn:const l=e.filter(h=>{var p;return Et(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),d=l.length>i?l[i]:l[0];d&&(r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(Ru(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(Ru(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case sh.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Ru(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(Ru(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Te().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},s={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:p,frameRate:m,scaleResolutionDownBy:E}=e._encoderConfig;p&&(s.maxBitrate=1e3*p),Et(c=e._hints).call(c,ze.LOW_STREAM)&&(m&&(s.maxFramerate=$r(m)),E&&E>=1&&(s.scaleResolutionDownBy=E))}if(M("DSCP_TYPE")&&Jc()){var l;const p=M("DSCP_TYPE");Et(l=["very-low","low","medium","high"]).call(l,p)&&(s.networkPriority=p)}const d=n.getParameters(),h=(i=d.encodings)===null||i===void 0?void 0:i[0];En()&&!h&&(r.encodings=[s]),h&&Object.assign(h,s),Object.assign(d,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(e,n){try{if(!Te().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof nn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=Mr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(lm(d,s),D1(d,s,this.store.codec))}),gu(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof nn&&!Et(i=p._hints).call(i,ze.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},E={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,m))}}}async applySimulcastEncodings(e,n){if(!En()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof nn&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof nn&&M("SIMULCAST")&&this.store.codec==="vp8"&&!Et(n=e._hints).call(n,ze.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(M("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i,r;if(n=(i=n)!==null&&i!==void 0?i:(r=this.currentRemoteDescription)===null||r===void 0?void 0:r.sdp){var s;const c=(s=Mr(n).mediaDescriptions.find(l=>l.attributes.mid===e))===null||s===void 0?void 0:s.attributes.ssrcs;return c==null?void 0:c[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),Et(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=Mr(e),s=r.mediaDescriptions.find(c=>c.attributes.mid===n);return s&&i===It.AUDIO&&s.media.mediaType==="audio"&&um(s),gu(r)}},Lt(Qe.prototype,"establish",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"establish"),Qe.prototype),Lt(Qe.prototype,"connect",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"connect"),Qe.prototype),Lt(Qe.prototype,"receive",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"receive"),Qe.prototype),Lt(Qe.prototype,"mockReceive",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"mockReceive"),Qe.prototype),Lt(Qe.prototype,"stopReceiving",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"stopReceiving"),Qe.prototype),Lt(Qe.prototype,"restartICE",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"restartICE"),Qe.prototype),Lt(Qe.prototype,"close",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"close"),Qe.prototype),Lt(Qe.prototype,"updateEncoderConfig",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"updateEncoderConfig"),Qe.prototype),Lt(Qe.prototype,"updateSendParameters",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"updateSendParameters"),Qe.prototype),Lt(Qe.prototype,"replaceTrack",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"replaceTrack"),Qe.prototype),Lt(Qe.prototype,"muteLocal",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"muteLocal"),Qe.prototype),Lt(Qe.prototype,"unmuteLocal",[ys],Object.getOwnPropertyDescriptor(Qe.prototype,"unmuteLocal"),Qe.prototype),Qe);function ys(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}let oo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var Hx,Wx,Kx,Yx,zx,qx,Xx,Jx,Qx,Zx,$x,un;function tV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function tC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let l8=(Hx=co(oo.SEND_ONLY),Wx=co(oo.SEND_ONLY),Kx=co(),Yx=co(oo.RECEIVE_ONLY),zx=co(oo.RECEIVE_ONLY),qx=co(oo.RECEIVE_ONLY),Xx=co(oo.RECEIVE_ONLY),Jx=co(oo.RECEIVE_ONLY),Qx=co(oo.RECEIVE_ONLY),Zx=co(),$x=co(oo.RECEIVE_ONLY),un=class extends hn{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Bt.StateChange,e,this._state)}constructor(t,e){super(),O(this,"isPlanB",!1),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"sendConnection",void 0),O(this,"recvConnection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"statsCollector",void 0),O(this,"dtlsFailedCount",0),O(this,"sendMutex",void 0),O(this,"recvMutex",void 0),O(this,"_state",Oe.Disconnected),O(this,"_restartStates",["disconnected","failed"]),O(this,"reconnectInterval",void 0),O(this,"uploadUnplinkStarted",!1),O(this,"uploadDownlinkStarted",!1),O(this,"uplinkStateUploadInterval",void 0),O(this,"downlinkStatsUploadInterval",void 0),O(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(g=>g[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(g=>{let[,{id:I}]=g;return I}));let p=!1;var c,l;n.trackMediaType==="video"?p=!((c=this.localTrackMap.get(ot.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(ot.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const m=this.createMuteMessage(d);await Ke(this,Bt.RequestMuteLocal,m);const E=n.trackMediaType==="video"?Tu.MUTE_LOCAL_VIDEO:Tu.MUTE_LOCAL_AUDIO;await Ke(this,Bt.RequestP2PMuteLocal,{action:E,message:m,isMuteAll:p}),i()}catch(d){r(d)}finally{s()}}),O(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Oe.Connected)return void r(new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(c),d=n.trackMediaType==="video"?Tu.UNMUTE_LOCAL_VIDEO:Tu.UNMUTE_LOCAL_AUDIO;await Ke(this,Bt.RequestP2PMuteLocal,{action:d,message:l}),i()}catch(c){r(c)}finally{s()}}),O(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;typeof s=="boolean"&&s||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==Oe.Connected)return void i();const{id:h,track:p}=d;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(Bt.UpdateVideoEncoder,p)),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),O(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(ot.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==Oe.Connected)return void i();const{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),O(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return n===m});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==Oe.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),h[0]===ot.LocalVideoTrack&&Te().supportDualStreamEncoding){const p=this.localTrackMap.get(ot.LocalVideoLowTrack);if(p){const m=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new St((E,g)=>{this.handleReplaceTrack(p.track,E,g,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),O(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),O(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new gU(t),this.bindStatsUploaderEvents(),this.sendMutex=new Ui("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Ui("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},M("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new $(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Gx(t,this.store,sr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=Oe.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Gx(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Oe.Connected}async addRemoteCandidate(t,e){if(e===sr.RECEIVE_ONLY){if(!this.sendConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new $(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return Ma(function*(){const r=yield Ee(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Oe.Connected){i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(h))}i.store.pubId=i.store.pubId+1,Bi.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield Ee(i.tryToUnmuteAudio(t)));s.forEach(h=>{let{track:p,type:m}=h;const E=Date.now();i.store.publish(p.getTrackId(),m===ot.LocalAudioTrack?"audio":"video",E)}),i.bindLocalTrackEvents(s);const c=yield Ee(i.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),i.store.codec,i.store.audioCodec)),l=(yield Ee(c.next())).value,d=i.createGatewayPublishMessage(s,l);try{yield d}catch(h){throw c.throw(h),(h==null?void 0:h.code)===L.WS_ABORT&&s.forEach(p=>{let{track:m}=p;i.pendingLocalTracks.indexOf(m)===-1&&i.pendingLocalTracks.push(m)}),i.unbindLocalTrackEvents(s),h}yield Ee(c.next()),s.forEach(h=>{let{type:p}=h;i.statsCollector.addLocalStats(p)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(s,l),s.forEach(h=>{let{track:p,type:m}=h;const E=Date.now();i.store.publish(p.getTrackId(),m===ot.LocalAudioTrack?"audio":"video",void 0,E)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Oe.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!Et(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[s,{track:c}]=r;return{type:s,track:c}})),e.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Oe.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:s,ssrcs:c}]=i;const l={stream_type:t6(s,r),ssrcs:c};s._muted||!s._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{Ke(this,Bt.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Ke(this,Bt.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Ma(function*(){throw new $(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await wi(this,Bt.RequestRePublish,this.pendingLocalTracks),this.emit(Bt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new $(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===It.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new em(s,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new tm(s,t.uid,t._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const d=this.remoteUserMap.get(t);d?d.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:E}=p;return m.uid===t.uid&&e===E});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(Bt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(s=>{const c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(s=>{let{kind:c}=s;var l;if(c===It.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===It.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(s=>{let[c,{kind:l}]=s;var d,h;if(l===It.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===It.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===It.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),r.forEach(s=>{let[,{kind:c}]=s;Ke(this,Bt.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[It.VIDEO,It.AUDIO].forEach(i=>{n.has(i)?Ke(this,Bt.RequestP2PUnmuteRemote,i):Ke(this,Bt.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new $(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===It.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(ot.LocalAudioTrack);if((e==null?void 0:e.track)instanceof qn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==ot.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===ot.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===ot.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(ot.LocalAudioTrack),l=i?this.localTrackMap.get(ot.LocalVideoLowTrack):this.localTrackMap.get(ot.LocalVideoTrack);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof vn),l=i?(s=this.localTrackMap.get(ot.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof nn);Mt.publish(this.store.sessionId,{eventElapse:Bi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(ze.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===It.VIDEO?n._videoSSRC:n._audioSSRC;r&&Mt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===It.VIDEO,audio:i===It.AUDIO,peerid:n.uid,subscribeRequestid:i===It.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Bi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ui("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ui("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(ot.LocalAudioTrack);if((t==null?void 0:t.track)instanceof qn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Oe.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(ot.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(ot.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof nn||e&&e.track instanceof vn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ua(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(ot.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=J_(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Oe.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case ot.LocalVideoTrack:Et(e=i._hints).call(e,ze.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case ot.LocalAudioTrack:i instanceof qn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case ot.LocalVideoLowTrack:}}),this.emit(Bt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ua(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(Bt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Au?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===sr.SEND_ONLY){if(!this.sendConnection)throw new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new $(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const s=await wi(this,Bt.RequestP2PRestartICE,{direction:sr.RECEIVE_ONLY,iceParameter:r});await i.restartICE(s),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalAudioTrack),i=t.videoSend.find(g=>{var I;return g.ssrc===(e==null||(I=e.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),r=t.audioSend.find(g=>{var I;return g.ssrc===(n==null||(I=n.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!i||!r)return 1;const s=ca(this,Bt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,E=e==null?void 0:e.track;if(E&&E._encoderConfig&&E._hints.indexOf(ze.SCREEN_TRACK)===-1){const g=E._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(g&&I){const y=(1e3*g-I)/(1e3*g);return n1[y<.15?0:y<.3?1:y<.45?2:y<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(I=>I.ssrc===r),l=t.videoRecv.find(I=>I.ssrc===s);if(!c&&!l)return void(e+=1);const d=ca(this,Bt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,m=c?c.jitterMs:void 0,E=t.recvPacketLossRate;let g=.7*E*100/50+.3*p/1500;m&&(g=.6*E*100/50+.2*p/1500+.2*m/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new St((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=Te(),s=this.getAllTracks();t=jf(t=t.filter(d=>s.indexOf(d)===-1));let c=!1,l=!1;for(const d of t){if(d instanceof nn&&(this.localTrackMap.has(ot.LocalVideoTrack)||c?new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:ot.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:ot.LocalVideoLowTrack})}if(d instanceof vn){const h=this.localTrackMap.get(ot.LocalAudioTrack);if(h){if(!(h.track instanceof qn))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){const p=i.find(m=>{let{type:E}=m;return E===ot.LocalAudioTrack});if(!(p.track instanceof qn))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!r.webAudioMediaStreamDest||d instanceof qn||d._bypassWebAudio)i.push({track:d,type:ot.LocalAudioTrack});else{const p=new qn;p.addAudioTrack(d),i.push({track:p,type:ot.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=jf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof vn){const r=this.localTrackMap.get(ot.LocalAudioTrack);if(!r)continue;r.track instanceof qn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([ot.LocalAudioTrack,r]),r.track.close())):e.push([ot.LocalAudioTrack,r])}if(i instanceof nn){const r=this.localTrackMap.get(ot.LocalVideoTrack);if(!r)continue;e.push([ot.LocalVideoTrack,r]);const s=this.localTrackMap.get(ot.LocalVideoLowTrack);s&&e.push([ot.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.addListener(Nt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof qn?t.trackList.forEach(n=>{n.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Nt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case ot.LocalVideoTrack:n.off(Nt.GET_STATS,this.handleGetLocalVideoStats),n.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Nt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Nt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ot.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case ot.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof qn?t.trackList.forEach(e=>{e.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Nt.GET_STATS,this.handleGetLocalAudioStats),e.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Nt.GET_STATS,this.handleGetLocalAudioStats),t.off(Nt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Nt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Nt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Nt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof tm&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof em&&e.addListener(Nt.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Nt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(It.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(It.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,{track:c,type:l}=n;switch(l){case ot.LocalAudioTrack:s=we.Audio;break;case ot.LocalVideoTrack:s=Et(r=c._hints).call(r,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalVideoLowTrack:s=we.Low}return{kind:l===ot.LocalAudioTrack?It.AUDIO:It.VIDEO,stream_type:s,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalVideoTrack:i=Et(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalAudioTrack:i=we.Audio;break;case ot.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(Bt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),Et(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await _i(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Mt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:gn.TRACER}).onSuccess(),this.emit(Bt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(Xf.FIRST_FRAME_DECODED),Mt.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_DECODE,cn.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_RECEIVED,cn.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ua(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&Mt.firstRemoteFrame(this.store.sessionId,ni.FIRST_VIDEO_RECEIVED,cn.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(Bt.ConnectionTypeChange,i),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(vu(n))," -> ").concat(JSON.stringify(vu(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(Bt.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===sr.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===sr.SEND_ONLY?this.restartICE(t):wi(this,Bt.RequestP2PRestartICE,{direction:sr.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive||e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===ot.LocalVideoTrack)){const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(ot.LocalAudioTrack);if(t instanceof vn&&(n==null?void 0:n.track)instanceof qn)return n.track.isActive&&e.push([ot.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===ot.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(ot.LocalVideoLowTrack);r&&e.push([ot.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=we.Audio;break;case ot.LocalVideoTrack:i=Et(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case ot.LocalAudioTrack:i=we.Audio;break;case ot.LocalVideoTrack:i=Et(n=s._hints).call(n,ze.SCREEN_TRACK)?we.Screen:we.High;break;case ot.LocalVideoLowTrack:i=we.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case It.VIDEO:return void(i._videoSSRC&&e.push({stream_type:It.VIDEO,ssrcId:i._videoSSRC}));case It.AUDIO:return void(i._audioSSRC&&e.push({stream_type:It.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(ot.LocalVideoTrack),n=this.localTrackMap.get(ot.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new St((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new St((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof vn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Ke(this,Bt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Bt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Bt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _i(vI(this.dtlsFailedCount,Hn)),this.emit(Bt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ot.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof nn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof nn).length>1)throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof vn).length>1&&(t.some(e=>e instanceof vn&&e._bypassWebAudio)||!Te().webAudioMediaStreamDest))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof nn&&this.pendingLocalTracks.some(n=>n instanceof nn))throw new $(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof vn&&this.pendingLocalTracks.some(n=>n instanceof vn)&&(!Te().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof vn&&n._bypassWebAudio)))throw new $(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&Te().supportDualStreamEncoding,i=tC(tC({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():DO(t,i);const s=Ye(8,"track-low-"),c=new nn(r,tC(tC({},n&&{scaleResolutionDownBy:pO(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return c.on(oh.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,zf.LOW_STREAM)}),c._hints.push(ze.LOW_STREAM),t.addListener(Nt.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ua(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Mt.firstRemoteVideoDecode(this.store.sessionId,ni.FIRST_VIDEO_DECODE,cn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Bi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.recvConnection.getRemoteSSRC(r);return s!==void 0&&s!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new $(L.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new $(L.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new $(L.NOT_SUPPORTED)}async preConnect(t){throw new $(L.NOT_SUPPORTED)}getEstablishParams(){throw new $(L.NOT_SUPPORTED)}async reSubscribe(t){throw new $(L.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new $(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===ot.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,zf.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Lt(un.prototype,"p2pConnect",[Hx],Object.getOwnPropertyDescriptor(un.prototype,"p2pConnect"),un.prototype),Lt(un.prototype,"unpublish",[Wx],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),Lt(un.prototype,"unpublishLowStream",[Kx],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),Lt(un.prototype,"subscribe",[Yx],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),Lt(un.prototype,"mockSubscribe",[zx],Object.getOwnPropertyDescriptor(un.prototype,"mockSubscribe"),un.prototype),Lt(un.prototype,"unsubscribe",[qx],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),Lt(un.prototype,"muteRemote",[Xx],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),Lt(un.prototype,"unmuteRemote",[Jx],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),Lt(un.prototype,"hasRemoteMediaWithLock",[Qx],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),Lt(un.prototype,"disconnectForReconnect",[Zx],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),Lt(un.prototype,"remoteMediaSsrcChanged",[$x],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function co(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(t){case oo.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}case oo.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d(),h()}}}},i}}class Oh extends hn{constructor(e,n){super(),O(this,"signal",void 0),O(this,"token",void 0),O(this,"tokenTimeout",void 0),O(this,"tokenInterval",void 0),O(this,"_sequence",0),O(this,"userMap",new Map),O(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===Xe.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*M("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,s){var c,l,d;if(this.userMap.size===0)return;const h=Array.from(Lr(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=(l=r)!==null&&l!==void 0?l:Ye(6,""),s=(d=s)!==null&&d!==void 0?d:this._sequence++;const p={_id:r,_type:e,_seq:s,_message:n,token:"".concat(this.token,"_").concat(h)};M("SHOW_P2P_LOG")&&T.debug("send message",p,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(p)).forEach(E=>{this.signal.request(Kt.DATA_STREAM,{payload:_u(this.encoder.encode(E))})});const m=new St((E,g)=>{const I=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),y),this.off("res-@".concat(r),N),this.off(sm.ABORT,C),T.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?g(new $(L.INVALID_REMOTE_USER)):g(new $(L.TIMEOUT))},M("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{I&&window.clearTimeout(I),this.off(sm.ABORT,C),i&&E()},C=()=>{I&&window.clearTimeout(I),this.off("res-@".concat(r,"_ack"),y),this.off("res-@".concat(r),N),g(new $(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(sm.ABORT,C),this.once("res-@".concat(r,"_ack"),y);const N=(V,W)=>{D=!0,I&&window.clearTimeout(I),this.off("res-@".concat(r,"_ack"),y),this.off(sm.ABORT,C),V==="success"?E(W):g(new $(L.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let D=!1;i||(this.once("res-@".concat(r),N),_i(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{D||T.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(p))}))});try{return await m}catch(E){if(E.code===L.TIMEOUT)return await this.send(e,n,i,r,s);throw E}}onMessage(e){var n;const{_uid:i}=e;let r,s=this.userMap.get(i);if(s)r=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Dn.CHECK)return;const{token:h}=e;r=new Map,s={uid:i,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,s),this.signal.emit(ce.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:h,total:p}=e,m=(c=r.get(h))!==null&&c!==void 0?c:[];if(m.push(e),r.has(h)||r.set(h,m),m.length!==p)return;{const E=J_(m).call(m,(g,I)=>g.index-I.index).map(g=>g.payload).join("");r.delete(h),(e=JSON.parse(E))._uid=i}}const{_type:l,token:d}=e;if(Et(n=[Dn.ACK,Dn.CHECK]).call(n,l))return l===Dn.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(e);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):T.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:Ye(6,""),token:this.token,_type:Dn.CHECK};M("SHOW_P2P_LOG")&&T.debug("send message",e),this.signal.request(Kt.DATA_STREAM,{payload:_u(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:Dn.ACK,token:this.token};M("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(Kt.DATA_STREAM,{payload:_u(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(Dn.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:m}=h;for(;p.has(m);){const E=p.get(m);p.delete(m),this.receiveMessage(E),h.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,s=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=s;if(r<d)return this.ack(e._id),void T.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===d&&(this.receiveMessage(e),c.delete(d),s.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:s}=e;if(M("SHOW_P2P_LOG")&&T.debug("receive message",e),n){let c;switch(e._type!==Dn.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case Dn.CANDIDATE:case Dn.CONTROL:this.signal.emit(i,c,s);break;case Dn.PUBLISH:case Dn.UNPUBLISH:case Dn.RESTART_ICE:case Dn.CALL:c.uid=s,wi(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case Dn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Dn.RESPONSE:{const{success:l,message:d}=c;this.emit("res-@".concat(n),l?"success":"failed",d);break}}}}splitMessage(e){if(e.length<Oh.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=Ye(6,"");let s=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){s++;const d={id:r,index:s,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(d).length>Oh.MAX_MESSAGE_SIZE?c-=50:(n.push(d),e=e.slice(c))}return n.map(d=>JSON.stringify(d))}handleCheckToken(e,n){return e.token!==n?(T.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(e.uid)},M("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await wi(this.signal,Dn.CALL,void 0),n=await this.send(Dn.CALL,e);this.signal.emit(zt.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(sm.ABORT),this.signal.emit(ce.ON_USER_OFFLINE,{uid:i.uid,reason:OH.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=Ye(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(sm.ABORT)}}O(Oh,"MAX_SIZE",1),O(Oh,"MAX_MESSAGE_SIZE",1024);class u8 extends hn{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Xe.CONNECTED?this.emit(zt.WS_CONNECTED):e===Xe.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):e===Xe.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",Xe.CLOSED),O(this,"reconnectToken",void 0),O(this,"p2pToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new NP(5)),O(this,"pingpongTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"_external_signal",void 0),O(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case ce.ON_DATA_STREAM:return void this.handleDataStream(r._message);case ce.MUTE_AUDIO:case ce.MUTE_VIDEO:case ce.ON_P2P_LOST:case ce.ON_USER_ONLINE:return;case ce.ON_USER_OFFLINE:const{uid:s}=r._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(r._type,r._message),r._type===ce.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===ce.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Ie.UID_BANNED);break;case 15:this.close(Ie.IP_BANNED);break;case 16:this.close(Ie.CHANNEL_BANNED)}if(r._type===ce.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case jt.ERR_LICENSE_MISSING:this.close(Ie.LICENSE_MISSING);break;case jt.ERR_LICENSE_EXPIRED:this.close(Ie.LICENSE_EXPIRED);break;case jt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ie.LICENSE_MINUTES_EXCEEDED);break;case jt.ERR_LICENSE_PERIOD_INVALID:this.close(Ie.LICENSE_PERIOD_INVALID);break;case jt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ie.LICENSE_MULTIPLE_SDK_SERVICE);break;case jt.ERR_LICENSE_ILLEGAL:this.close(Ie.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new dO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Xe.CONNECTED&&this.reconnect("retry",Oi.OFFLINE)}),this.p2pToken=Ye(6,""),this._external_signal=new Oh(this,this.p2pToken)}async request(e,n,i,r){const s=Ye(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new St((I,y)=>{if(this.connectionState===Xe.CONNECTED)return I();const C=()=>{this.off(zt.WS_CLOSED,N),I()},N=()=>{this.off(zt.WS_CONNECTED,C),y(new $(L.WS_ABORT))};this.once(zt.WS_CONNECTED,C),this.once(zt.WS_CLOSED,N)});if(this.connectionState!==Xe.CONNECTING&&this.connectionState!==Xe.RECONNECTING||e===Kt.JOIN||e===Kt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new St((I,y)=>{let C=!1;const N=(V,W)=>{C=!0,I({isSuccess:V==="success",message:W||{}}),this.off(zt.WS_CLOSED,D),this.off(zt.WS_RECONNECTING,D),this.emit(zt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),N);const D=()=>{y(new $(L.WS_ABORT,"type: ".concat(e))),this.off(zt.WS_CLOSED,D),this.off(zt.WS_RECONNECTING,D),this.off("res-@".concat(s),N)};this.once(zt.WS_CLOSED,D),this.once(zt.WS_RECONNECTING,D),_i(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||C||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(zt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(I){if(this.connectionState===Xe.CLOSED||e===Kt.LEAVE)throw new $(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():e===Kt.JOIN||e===Kt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const m=Number(p.message.error_code||p.message.code),E=vg(m),g=new $(L.UNEXPECTED_RESPONSE,"".concat(E.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:E.desc});return E.action==="success"?p.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(E.desc,", action: ").concat(E.action)),m===jt.ERR_TOO_MANY_BROADCASTERS?((e===Kt.JOIN||e===Kt.REJOIN)&&(this.initError=g,this.close()),g.throw()):E.action==="failed"?g.throw():E.action==="quit"?(this.initError=g,this.close(),g.throw()):(m===jt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Oi.MULTI_IP)):this.reconnect(E.action,Oi.SERVER_ERROR),e===Kt.JOIN||e===Kt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new St(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Tg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Xe.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new St((n,i)=>{this.once(zt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(zt.WS_CLOSED,()=>i(this.initError||new $(L.WS_ABORT))),this.connectionState=Xe.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Ie.LEAVE,this.connectionState=Xe.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ye(6,""),this._external_signal.clear(),this._external_signal=new Oh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const e=await wi(this,zt.REQUEST_JOIN_INFO),n=await this.request(Kt.JOIN,e);if(!n)return this.emit(zt.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Xe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=rh(e.payload),r=new TextDecoder().decode(i),s=JSON.parse(r);"total"in s&&"id"in s||Et(n=Object.values(Dn)).call(n,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(ce.ON_DATA_STREAM,e)}catch{this.emit(ce.ON_DATA_STREAM,e)}}handleNotification(e){T.debug("[".concat(this.clientId,"] receive notification: "),e);const n=vg(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ie.UID_BANNED),void this.close()):void this.reconnect(n.action,Oi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Oi.TIMEOUT):this.request(Kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),M("REPORT_STATS")&&this.send(Kt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on($t.RECONNECT_CREATE_CONNECTION,e=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on($t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on($t.CLOSED,()=>{this.connectionState=Xe.CLOSED}),this.websocket.on($t.FAILED,()=>{this._disconnectedReason=Ie.NETWORK_ERROR,this.connectionState=Xe.CLOSED}),this.websocket.on($t.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Xe.CONNECTED?this.connectionState=Xe.RECONNECTING:this.connectionState=Xe.CONNECTING}),this.websocket.on($t.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on($t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof $&&e.code===L.UNEXPECTED_RESPONSE&&e.data.code===jt.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Oi.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Oi.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on($t.REQUEST_NEW_URLS,(e,n)=>{wi(this,zt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ce.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const d8={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new l8(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new u8(n,e)}};function eV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function nV(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?eV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class h8{constructor(e){O(this,"sessionDesc",void 0),O(this,"localCapabilities",void 0),O(this,"rtpCapabilities",void 0),O(this,"candidates",void 0),O(this,"_originCandidates",void 0),O(this,"iceParameters",void 0),O(this,"dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),e=Sn(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:d,cname:h}=e,p=Mr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=r,this._originCandidates=Sn(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=h;for(let m=0;m<p.mediaDescriptions.length;m++){const E=p.mediaDescriptions[m];if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=i.fingerprints,E.attributes.candidates=r,E.attributes.setup=c,E.media.mediaType==="video"){E.media.fmts=s.videoCodecs.map(I=>I.payloadType.toString(10));let g=s.videoCodecs.filter(I=>{var y,C;return(y=I.rtpMap)===null||y===void 0?void 0:Et(C=y.encodingName.toLowerCase()).call(C,d)});g.length===0&&(g=s.videoCodecs),E.attributes.payloads=g,E.attributes.extmaps=s.videoExtensions}E.media.mediaType==="audio"&&(E.media.fmts=s.audioCodecs.map(g=>g.payloadType.toString(10)),E.attributes.payloads=s.audioCodecs,E.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[m]=this.mungMediaDesc(E)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return gu(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:s}=fh(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>e===It.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,d=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:d}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],s=[];n.attributes.ssrcs.forEach(c=>{Et(e).call(e,c.attributes.label||"")?s.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;Et(l=s.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,s)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(nV(nV({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case Vi.TCP_RELAY:this.candidates=i;break;case Vi.UDP_TCP_RELAY:case Vi.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Sn(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=Sn(e);return lm(i,n),mO(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===It.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var s;c&&(c.attributes.label=i,(s=c.attributes.msid)===null||s===void 0||s.replace(n,i))}}mungMediaDesc(e){const n=Sn(e);return fO(n),function(i){const r=i.attributes.extmaps.find(s=>Ey(s.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(s=>{const c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var je;function iV(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function eC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iV(Object(n),!0).forEach(function(i){O(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iV(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let p8=(je=class rS extends h1{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Et(n=Object.keys(Kv)).call(n,e)}))]}constructor(e,n){super(e,n),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"statsFilter",void 0),O(this,"useRTX",!1),O(this,"localCapabilities",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"establishPromise",void 0),O(this,"mutex",void 0),this.store=n,this.mutex=new Ui("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(rS.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=OI(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,En()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=yu(e.sdp),i=Ag(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,eC(eC({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new $(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new h8(eC(eC({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new $(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return Ma(function*(){const r=yield Ee(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(E=>i.peerConnection.addTrack(E._mediaStreamTrack)),c=yield Ee(i.peerConnection.createOffer()),l=Mr(c.sdp),d=e.map(E=>{const g=E._mediaStreamTrack,I=l.mediaDescriptions.find(y=>y.attributes.mid===g.kind);if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return function(y,C,N){const D=y.attributes.ssrcs.filter(W=>W.attributes.label===C),V=y.attributes.ssrcGroups;if(D.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(V&&D.length>1){const W=V.find(K=>K.ssrcIds.indexOf(D[0].ssrcId)!==-1);return W?[{ssrcId:W.ssrcIds[0],rtx:N?W.ssrcIds[1]:void 0}]:[{ssrcId:D[0].ssrcId}]}return[{ssrcId:D[0].ssrcId}]}(I,g.id,i.useRTX)});let h;try{h=yield d}catch(E){throw s.forEach(g=>{Ii()&&g.replaceTrack(null),i.peerConnection.removeTrack(g)}),E}const p=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,h);const m=i.remoteSDP.toString();return yield Ee(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Ee(i.applySendEncodings(s,e)),yield Ee(i.peerConnection.setRemoteDescription({type:"answer",sdp:m})),e.map((E,g)=>{const I=E._mediaStreamTrack.id;return{localSSRC:d[g],id:I}})}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{Ii()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:c}=this.remoteSDP.send(e,n,r),l=new St((p,m)=>{const E=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(s)))},1e4),g=I=>{const y=_e();if((y.name==="Safari"&&Number(y.version)===11||ir())&&I.track.id!==s&&I.streams[0].id===c){var C;const N=I.streams[0].getTracks()[0];return(C=this.remoteSDP)===null||C===void 0||C.updateTrackLabel(e,s,I.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p(N)}if(I.track.id===s)return this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p(I.track)};this.peerConnection.addEventListener("track",g)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(Ii()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(s=>s.active=!1),i.setParameters(r)}})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(Ii()&&s.track)s.track.enabled=!0;else{const c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Ma(function*(){const i=yield Ee(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=Te().supportPCSetConfiguration;if(e===Vi.RELAY&&!r)return;if(r){const h=n.peerConnection.getConfiguration(),p=e===Vi.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}e!==Vi.RELAY&&n.remoteSDP.updateCandidates(e);const s=yield Ee(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=yu(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const d=n.remoteSDP.toString();yield Ee(n.peerConnection.setLocalDescription(s)),yield Ee(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new $(L.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new $(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new $(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(hg(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...rS.turnServerConfigToIceServers(e.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...rS.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!n)return T.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Te().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const r={},s={};if(e instanceof nn)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(M("DSCP_TYPE")&&Jc()){var c;const h=M("DSCP_TYPE");Et(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}const l=n.getParameters(),d=(i=l.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,s),Object.assign(l,r),T.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!Te().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];r&&s&&await this.updateRtpSenderEncodings(s,r)}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=Mr(e);return n.forEach((r,s)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&lm(l,r)}),gu(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((s,c)=>{let{id:l,mslabel:d}=s;const{kind:h}=e[c];return new St((p,m)=>{const E=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),g=I=>{const y=_e();if(y.name==="Safari"&&Number(y.version)===11&&I.track.id!==l&&I.streams[0].id===d){var C;const N=I.streams[0].getTracks()[0];return(C=this.remoteSDP)===null||C===void 0||C.updateTrackLabel(h,l,I.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p({track:N,id:l})}if(I.track.id===l)return this.peerConnection.removeEventListener("track",g),clearTimeout(E),void p({track:I.track,id:l})};this.peerConnection.addEventListener("track",g)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await St.all(n)}catch(n){throw new $(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(Te().supportPCSetConfiguration){const n=rS.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Lt(je.prototype,"connect",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"connect"),je.prototype),Lt(je.prototype,"stopSending",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"stopSending"),je.prototype),Lt(je.prototype,"receive",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"receive"),je.prototype),Lt(je.prototype,"stopReceiving",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"stopReceiving"),je.prototype),Lt(je.prototype,"muteRemote",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"muteRemote"),je.prototype),Lt(je.prototype,"unmuteRemote",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"unmuteRemote"),je.prototype),Lt(je.prototype,"muteLocal",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"muteLocal"),je.prototype),Lt(je.prototype,"unmuteLocal",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"unmuteLocal"),je.prototype),Lt(je.prototype,"close",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"close"),je.prototype),Lt(je.prototype,"updateEncoderConfig",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"updateEncoderConfig"),je.prototype),Lt(je.prototype,"updateSendParameters",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"updateSendParameters"),je.prototype),Lt(je.prototype,"replaceTrack",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"replaceTrack"),je.prototype),Lt(je.prototype,"getRemoteSSRC",[Ha],Object.getOwnPropertyDescriptor(je.prototype,"getRemoteSSRC"),je.prototype),je);function Ha(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}const f8={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new p8(n,e)}},m8={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Te().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(ty.has(t)||!t.track)return;const n={track:t.track};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=e.metadata&&e.metadata();d?function(h,p){const{chunk:m,controller:E}=p,g=M("ENABLE_AUDIO_PTS_METADATA")?tl.AUDIO_64_BIT_PTS:tl.METADATA;m.data=function(I,y,C){const N=C.byteLength,D=N+ZI+JM,V=JI+QI+D,W=new ArrayBuffer(I.byteLength+V),K=new DataView(W);K.setUint8(0,XM),K.setUint16(1,D),K.setUint8(3,y),K.setUint16(4,N);for(let J=0;J<N;J++)K.setUint8(6+J,C[J]);const j=new Uint8Array(K.buffer);return j.set(new Uint8Array(I),V),j.buffer}(m.data,g,h),E.enqueue(m)}(d,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Ii()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=$v(),s=new MessageChannel;await new St(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:s.port2},[s.port2]);t.transform=c,await new St(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;if(l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id)T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(l.data.getMetadata){const h=e.metadata&&e.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=ty.get(t);if(r){ty.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}ty.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Te().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(sy.has(t))return;const n={track:t.track,onMetadata:e.onMetadata};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");uI(Ce.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(d,h,p){var m;const E=QM(new DataView(h.data));if(!E)return p.enqueue(h);const g=d.track.id;X5.set(g,d.track);const I=(m=E.tlv.find(W=>W.tag===tl.AUDIO_LEVEL))===null||m===void 0?void 0:m.value;let y=0;typeof I=="number"&&(y=127-I);const C=Math.round(Math.pow(10,y/60)-1),{selected:N,speaker:D}=function(W,K){let j=nm.get(W);if(j||(j=function(J){const ct=new $M;return nm.set(J,ct),no||(no=new z5(M("TOPN_SILENCE_THRESHOLD")||500),no.on("ActiveSpeakerChanged",vt=>{vt!=null&&(iy=vt)})),no.addSpeakers([ct]),ct}(W)),nm.size<=t1)return{selected:!0,speaker:j};if(!no)throw new Error("no active speaker detector");return no.levelChanged(j.id,K),dh=no.loudest.map(J=>J.id),iy&&!Et(dh).call(dh,iy)&&dh.length>=t1&&dh.pop(),{selected:Et(dh).call(dh,j.id)||j.id===iy,speaker:j}}(d,C),V=function(W,K,j){const J=io.get(W)||new q5(W,K);return J.score=j,io.set(W,J),function(ct){if(ry.set(ct,!0),!ay)return void(ay=Date.now());const vt=Date.now();vt-ay>1e3&&(ry.get(ct)?ry.set(ct,!1):(e1(ct),ry.delete(ct)),ay=vt)}(W),J}(g,d.track,D.energyScore);V.addSample(N),V.active&&(h.data=E.frame.buffer,p.enqueue(h))}(t,c,l):e.enableMetadata?function(d,h,p){const m=QM(new DataView(d.data));if(!m)return h.enqueue(d);const E=m.tlv.find(g=>g.tag===tl.METADATA||g.tag===tl.AUDIO_64_BIT_PTS);E&&p&&E.value instanceof Uint8Array&&p(E.value),d.data=m.frame.buffer,h.enqueue(d)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Ii()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=$v(),s=new MessageChannel;await new St(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:s.port2},[s.port2]);t.transform=c,await new St(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(T.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.metadata&&n.onMetadata&&n.onMetadata(l.data.metadata)},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const s=sy.get(r);if(s){(function(d){const h=nm.get(d);h&&(nm.delete(d),no&&(no.removeSpeakers([h]),nm.size===0&&(no.destroy(),no=null)))})(r),e1(r.track.id),sy.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){T.warning(d&&d.message)}}}(t)}sy.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!Te().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(oy.has(t)||!t.track)return;const n={track:t.track};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void T.error("create video-encoded-streams error",l&&l.message)}const s=[];e.on("sei-to-send",l=>{s.push(l)});const c=new TransformStream({transform(l,d){n.controller||(n.controller=d),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=s.shift();h&&(l.data=function(p,m){const E=function(D){const V=D.length;let W=[],K=0;for(;K<V;)K+2<V&&D[K]===0&&D[K+1]===0&&(D[K+2]===0||D[K+2]===1||D[K+2]===2||D[K+2]===3)?(W.push(D[K],D[K+1],3,D[K+2]),K+=3):(W.push(D[K]),K++);return new Uint8Array(W)}(m),g=E.length,I=Math.floor(g/255),y=g%255,C=new Uint8Array(6+I+1+g+p.byteLength);C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=6,C[5]=101;let N=0;for(;N<I;)C[6+N]=255,N++;return C[6+N]=y,N++,C.set(E,6+N),C.set(new Uint8Array(p),6+N+g),C.buffer}(l.data,h)),d.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!Ii())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=$v(),s=new MessageChannel;await new St(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:s.port2},[s.port2]);t.transform=c,await new St(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=oy.get(t);if(r){oy.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){T.warning(l&&l.message)}}}oy.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Te().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!t.track)return;if(Sg.has(t)){const r=Sg.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(Xc()){if(!t.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void T.error("create video-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=function(h){const p=new DataView(h.data);let m=0;for(;m+4<h.data.byteLength;){if(p.getUint8(m+0)===0&&p.getUint8(m+1)===0&&p.getUint8(m+2)===0&&p.getUint8(m+3)===1&&p.getUint8(m+4)===6){let E=m+6,g=0,I=0;for(;(I=p.getUint8(E++))===255;)g+=255;g+=I;const y=J5(h.data,E,g);return new Uint8Array(y)}m++}return null}(c);d&&n.onSei&&n.onSei(d),l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(Ii()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const r=$v(),s=new MessageChannel;await new St(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:s.port2},[s.port2]);t.transform=c,await new St(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(T.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const s=Sg.get(r);if(s){Sg.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){T.warning(d&&d.message)}}})(t)}Sg.set(t,n),t.track.addEventListener("ended",i)}},E8={name:"InterceptFrame",create:()=>m8};wI(),Pe("PROCESS_ID","process-".concat(Ye(8,""),"-").concat(Ye(4,""),"-").concat(Ye(4,""),"-").concat(Ye(4,""),"-").concat(Ye(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void T.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();T.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(en,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;eo[i]=r,en[i]=r}})}catch(e){T.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(eo.AREAS)&&eo.AREAS.length>0&&TO(eo.AREAS,!0);const rV=(t,e,n)=>{T.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Pe(t,e,n)};Cu(BW,!1),Cu(GW,!1),Cu(R6,!1),Cu($W,!1),Cu(UW,!1),Cu(d8,!1),Cu(f8,!1),Cu(E8,!1);const Wn=function(t){const e=new hn,n=t,i={getListeners:e.getListeners.bind(e),on:(r,s)=>(function(c,l){c===nc.SECURITY_POLICY_VIOLATION&&V2(l,!0)}(r,s),e.on.bind(e)(r,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return x2(x2({},n),i)}({__TRACK_LIST__:Yf,VERSION:Ua,BUILD:LI,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:rV,getParameter:M,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return Te().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new z(L.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=Mt.reportApiInvoke(null,{name:Gn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:gn.TRACER});let e=!1;try{const s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(s&&c&&l),e&&fI()&&aP(75)&&new s().close()}catch(s){return T.error("check system requirement failed: ",s),!1}let n=!1;const i=_e();i.name===Ce.CHROME&&Number(i.version)>=58&&($s.engine.name!=="WebKit"||function(){const s=_e();if(Uv()){if(s.os===ei.MAC_OS)return!0;if(s.os===ei.IOS){const c=$s.os.version&&$s.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Ce.FIREFOX&&Number(i.version)>=56||i.name===Ce.OPERA&&Number(i.version)>=45||i.name===Ce.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(ir()||hs())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||dP()||_e().name===Ce.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return ma.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ma.getRecordingDevices(t)},getCameras:function(t){return ma.getCamerasDevices(t)},getElectronScreenSources:ak,getPlaybackDevices:function(t){return ma.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Ye(5,"client-"),i=Mt.reportApiInvoke(null,{id:n,name:Gn.CREATE_CLIENT,options:[e],tag:gn.TRACER});try{(function(r){Zn(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Zn(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Zn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ei(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&SP(r.turnServer),r.httpRetryConfig!==void 0&&gP(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&gP(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(oP(16,0)||cP(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",T.debug("browser not support vp9, force use vp8")),Pe("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new v6(Ts(Ts({forceWaitGatewayResponse:!0},e),{},{role:Et(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=M("CAMERA_CAPTURE_CONFIG"),n=Ye(8,"track-cam-"),i=Mt.reportApiInvoke(null,{id:n,tag:gn.TRACER,name:Gn.CREATE_CAM_VIDEO_TRACK,options:[ln({},t),e]});e&&(t.encoderConfig=e);const r=Qv(t);let s=null;T.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{s=(await fa({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!s){const l=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(T)}t.optimizationMode&&XI(n,s,t,$o(t.encoderConfig));const c=new qI(s,t,r,t.scalabiltyMode?zv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),T.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=Ye(8,"track-cus-"),n=Mt.reportApiInvoke(null,{id:e,tag:gn.TRACER,name:Gn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),i=new nn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?zv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[ze.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),T.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(E){return mk(E)}(e):void 0;n&&(e="auto");const i=Ye(8,"track-scr-v-"),r=Mt.reportApiInvoke(null,{id:i,tag:gn.TRACER,name:Gn.CREATE_SCREEN_VIDEO_TRACK,options:[ln({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const s=function(E){const g={};E.screenSourceType&&(g.mediaSource=E.screenSourceType),E.extensionId&&Xc()&&(g.extensionId=E.extensionId);const{displaySurface:I,selfBrowserSurface:y,surfaceSwitching:C,systemAudio:N,preferCurrentTab:D}=E;(cg(107)||dI(107)||hI(93))&&(I&&(Zn(I,"displaySurface",["browser","window","monitor"]),g.displaySurface=I),y?(Zn(y,"selfBrowserSurface",["exclude","include"]),g.selfBrowserSurface=y):g.selfBrowserSurface="include",C&&(Zn(C,"surfaceSwitching",["exclude","include"]),g.surfaceSwitching=C)),(cg(105)||dI(105)||hI(91))&&N&&(Zn(N,"systemAudio",["exclude","include"]),g.systemAudio=N),(cg(94)||dI(94)||hI(80))&&D&&(g.preferCurrentTab=!0),E.electronScreenSourceId&&(g.sourceId=E.electronScreenSourceId);const V=E.encoderConfig?xI(E.encoderConfig):null;return g.mandatory={chromeMediaSource:"desktop",maxWidth:V?V.width:void 0,maxHeight:V?V.height:void 0},V&&(V.frameRate&&(typeof V.frameRate=="number"?(g.mandatory.maxFrameRate=V.frameRate,g.mandatory.minFrameRate=V.frameRate):(g.mandatory.maxFrameRate=V.frameRate.max||V.frameRate.ideal||V.frameRate.exact||void 0,g.mandatory.minFrameRate=V.frameRate.min||V.frameRate.ideal||V.frameRate.exact||void 0),g.frameRate=V.frameRate),V.width&&(g.width=V.width),V.height&&(g.height=V.height)),g}(t);let c=null,l=null;const d=Te();if(!d.supportShareAudio&&e==="enable"){const E=new $(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(E),E.throw(T)}T.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const h=d.supportShareAudio&&e!=="disable";try{const E=await fa({screen:s,screenAudio:h?n||!0:void 0},i);c=E.getVideoTracks()[0]||null,l=E.getAudioTracks()[0]||null}catch(E){throw r.onError(E),E}if(!c){const E=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(E),E.throw(T)}if(!l&&e==="enable"){c&&c.stop();const E=new $(L.SHARE_AUDIO_NOT_ALLOWED);return r.onError(E),E.throw(T)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(XI(i,c,t,t.encoderConfig&&xI(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const p=new nn(c,t.encoderConfig?xI(t.encoderConfig):{},t.scalabiltyMode?zv(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[ze.SCREEN_TRACK]);if(!l)return r.onSuccess(p.getTrackId()),T.info("create screen video track success","video:",p.getTrackId()),p;const m=new vn(l,void 0,Ye(8,"track-scr-a-"),!1);return r.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=M("CAMERA_CAPTURE_CONFIG"),i=Ye(8,"track-mic-"),r=Ye(8,"track-cam-"),s=Mt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:gn.TRACER,name:Gn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=Qv(e),l=Ek(t);let d=null,h=null;T.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const E=await fa({audio:l,video:c},"".concat(i,"-").concat(r));d=E.getAudioTracks()[0],h=E.getVideoTracks()[0]}catch(E){throw s.onError(E),E}if(!d||!h){const E=new $(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(E),E.throw(T)}e.optimizationMode&&XI(r,h,e,$o(e.encoderConfig));const p=new Zv(d,t,l,i),m=new qI(h,e,c,e.scalabiltyMode?zv(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return s.onSuccess([p.getTrackId(),m.getTrackId()]),T.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[p,m]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Ye(8,"track-mic-"),n=Mt.reportApiInvoke(null,{id:e,tag:gn.TRACER,name:Gn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=Ek(t);let r=null;T.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await fa({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new $(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(T)}const s=new Zv(r,t,i,e);return n.onSuccess(s.getTrackId()),T.info("create microphone audio track success, trackId:",e),s},createCustomAudioTrack:function(t){const e=Ye(8,"track-cus-"),n=Mt.reportApiInvoke(null,{id:e,tag:gn.TRACER,name:Gn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new vn(t.mediaStreamTrack,t.encoderConfig?qv(t.encoderConfig):{},e,!1);return T.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=Ye(8,"track-buf-"),l=Mt.reportApiInvoke(null,{id:c,tag:gn.TRACER,name:Gn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(M("DISABLE_WEBAUDIO"))throw new $(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);const d=r;if(!(r instanceof AudioBuffer))try{r=await async function(m,E){let g=null;if(typeof m=="string"){const y=nM.get(m);if(y)return T.debug("use cached audio resource: ",m),y;try{g=(await to(()=>Er.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(C){throw new $(L.FETCH_AUDIO_FILE_FAILED,C.toString())}}else g=await new St((C,N)=>{const D=new FileReader;D.onload=V=>{V.target?C(V.target.result):N(new $(L.READ_LOCAL_AUDIO_FILE_ERROR))},D.onerror=()=>{N(new $(L.READ_LOCAL_AUDIO_FILE_ERROR))},D.readAsArrayBuffer(m)});const I=await function(y){const C=Zf();return new St((N,D)=>{C.decodeAudioData(y,V=>{N(V)},V=>{D(new $(L.DECODE_AUDIO_FILE_FAILED,V.toString()))})})}(g);return typeof m=="string"&&E&&nM.set(m,I),I}(r,n)}catch(m){return l.onError(m),m.throw(T)}const h=new G5(r),p=new j5(d,h,i?qv(i):{},c);return T.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(t){if(T.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw T.debug("Invalid appType"),new z(L.INVALID_PARAMS,"invalid app type",t);Pe("APP_TYPE",Math.floor(t))},setLogLevel:function(t){T.setLogLevel(t)},enableLogUpload:function(){M("USE_NEW_LOG")?Pe("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){M("USE_NEW_LOG")?Pe("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new nU},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Mt.reportApiInvoke(null,{tag:gn.TRACER,name:Gn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof vn||t instanceof em)){const d=new z(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(d),d.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof vn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let s=r,c=r;const l=Date.now();return new St(d=>{const h=setInterval(()=>{const p=t.getVolumeLevel();s=p>s?p:s,c=p<c?p:c;const m=s-c>1e-4,E=Date.now()-l;if(m||E>e){clearInterval(h);const g=m,I={duration:E,deviceLabel:i,maxVolumeLevel:s,result:g};T.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),n.onSuccess(I),d(g)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Mt.reportApiInvoke(null,{tag:gn.TRACER,name:Gn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof nn||t instanceof tm)){const m=new z(L.INVALID_TRACK,"the parameter is not a video track");return n.onError(m),m.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof nn?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Ii()||Uv())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{const m=Date.now();l=await function(E,g,I,y){let C,N=0,D=null;return new St((V,W)=>{function K(){N>y&&C&&(C(),V(N));const j=I.getContext("2d");if(!j){const vt=new z(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(vt.toString()),void W(vt)}j.drawImage(E,0,0,160,120);const J=j.getImageData(0,0,I.width,I.height),ct=Math.floor(J.data.length/3);if(D){for(let vt=0;vt<ct;vt+=3)if(J.data[vt]!==D[vt])return N+=1,void(D=J.data);D=J.data}else D=J.data}setTimeout(()=>{C&&(C(),V(N))},g),C=GI(()=>{K()},30)})}(s,e,c,4),d=Date.now()-m}catch(m){throw n.onError(m),m}o6===Ce.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=l>4,p={duration:d,changedPicNum:l,deviceLabel:i,result:h};return T.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:TO,audioElementPlayCenter:_r,resumeAudioContext:function(){_r.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){C6.processExternalMediaAEC(t)},registerExtensions:function(t){const e=M("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!Et(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=T.extLog,i.reporter.hookApiInvoke=Mt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=M(r)})}),rV("PLUGIN_INFO",e)},ChannelMediaRelayError:rm,ChannelMediaRelayEvent:nl,ChannelMediaRelayState:Ur,RemoteStreamFallbackType:k5,RemoteStreamType:P5,ConnectionDisconnectedReason:Ie,AudienceLatencyLevelType:u5,AREAS:Ae,preload:async function(t,e,n,i){return wU(t,e,n,i)}});return Object.defineProperties(Wn,{onAudioAutoplayFailed:{get:()=>Ea.onAudioAutoplayFailed,set:t=>{Ea.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Ea.onAutoplayFailed,set:t=>{Ea.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Wn._onSecurityPolicyViolation,set(t){Wn._onSecurityPolicyViolation=t,V2(t)}},__CLIENT_LIST__:{get:()=>M("SHOW_GLOBAL_CLIENT_LIST")?hh:[]}}),ma.on(ch.CAMERA_DEVICE_CHANGED,t=>{T.info("camera device changed",JSON.stringify(t)),Wn.onCameraChanged&&Wn.onCameraChanged(t),Wn.safeEmit(nc.CAMERA_CHANGED,t)}),ma.on(ch.RECORDING_DEVICE_CHANGED,t=>{T.info("microphone device changed",JSON.stringify(t)),Wn.onMicrophoneChanged&&Wn.onMicrophoneChanged(t),Wn.safeEmit(nc.MICROPHONE_CHANGED,t)}),ma.on(ch.PLAYOUT_DEVICE_CHANGED,t=>{T.debug("playout device changed",JSON.stringify(t)),Wn.onPlaybackDeviceChanged&&Wn.onPlaybackDeviceChanged(t),Wn.safeEmit(nc.PLAYBACK_DEVICE_CHANGED,t)}),_r.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),Ea.onAudioAutoplayFailed&&Ea.onAudioAutoplayFailed()},ke.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),Ea.onAudioAutoplayFailed&&Ea.onAudioAutoplayFailed(),Wn.safeEmit(nc.AUTOPLAY_FAILED)}),ke.on(Si.STATE_CHANGE,(t,e)=>{T.info("audio context state changed: ".concat(e," => ").concat(t)),Wn.onAudioContextStateChanged&&Wn.onAudioContextStateChanged(t,e),Wn.safeEmit(nc.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),xn.on(Ff.NETWORK_STATE_CHANGE,(t,e)=>{T.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=Wn),Wn})}(oC)),oC.exports}var ZK=QK();const RV=Mw(ZK);function tB(S,A){return function(){return S.apply(A,arguments)}}const{toString:$K}=Object.prototype,{getPrototypeOf:Gw}=Object,{iterator:EC,toStringTag:eB}=Symbol,_C=(S=>A=>{const w=$K.call(A);return S[w]||(S[w]=w.slice(8,-1).toLowerCase())})(Object.create(null)),uo=S=>(S=S.toLowerCase(),A=>_C(A)===S),gC=S=>A=>typeof A===S,{isArray:bm}=Array,sS=gC("undefined");function tY(S){return S!==null&&!sS(S)&&S.constructor!==null&&!sS(S.constructor)&&Sa(S.constructor.isBuffer)&&S.constructor.isBuffer(S)}const nB=uo("ArrayBuffer");function eY(S){let A;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?A=ArrayBuffer.isView(S):A=S&&S.buffer&&nB(S.buffer),A}const nY=gC("string"),Sa=gC("function"),iB=gC("number"),SC=S=>S!==null&&typeof S=="object",iY=S=>S===!0||S===!1,cC=S=>{if(_C(S)!=="object")return!1;const A=Gw(S);return(A===null||A===Object.prototype||Object.getPrototypeOf(A)===null)&&!(eB in S)&&!(EC in S)},rY=uo("Date"),aY=uo("File"),sY=uo("Blob"),oY=uo("FileList"),cY=S=>SC(S)&&Sa(S.pipe),lY=S=>{let A;return S&&(typeof FormData=="function"&&S instanceof FormData||Sa(S.append)&&((A=_C(S))==="formdata"||A==="object"&&Sa(S.toString)&&S.toString()==="[object FormData]"))},uY=uo("URLSearchParams"),[dY,hY,pY,fY]=["ReadableStream","Request","Response","Headers"].map(uo),mY=S=>S.trim?S.trim():S.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function uS(S,A,{allOwnKeys:w=!1}={}){if(S===null||typeof S>"u")return;let b,P;if(typeof S!="object"&&(S=[S]),bm(S))for(b=0,P=S.length;b<P;b++)A.call(null,S[b],b,S);else{const x=w?Object.getOwnPropertyNames(S):Object.keys(S),H=x.length;let Q;for(b=0;b<H;b++)Q=x[b],A.call(null,S[Q],Q,S)}}function rB(S,A){A=A.toLowerCase();const w=Object.keys(S);let b=w.length,P;for(;b-- >0;)if(P=w[b],A===P.toLowerCase())return P;return null}const Lh=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,aB=S=>!sS(S)&&S!==Lh;function ww(){const{caseless:S}=aB(this)&&this||{},A={},w=(b,P)=>{const x=S&&rB(A,P)||P;cC(A[x])&&cC(b)?A[x]=ww(A[x],b):cC(b)?A[x]=ww({},b):bm(b)?A[x]=b.slice():A[x]=b};for(let b=0,P=arguments.length;b<P;b++)arguments[b]&&uS(arguments[b],w);return A}const EY=(S,A,w,{allOwnKeys:b}={})=>(uS(A,(P,x)=>{w&&Sa(P)?S[x]=tB(P,w):S[x]=P},{allOwnKeys:b}),S),_Y=S=>(S.charCodeAt(0)===65279&&(S=S.slice(1)),S),gY=(S,A,w,b)=>{S.prototype=Object.create(A.prototype,b),S.prototype.constructor=S,Object.defineProperty(S,"super",{value:A.prototype}),w&&Object.assign(S.prototype,w)},SY=(S,A,w,b)=>{let P,x,H;const Q={};if(A=A||{},S==null)return A;do{for(P=Object.getOwnPropertyNames(S),x=P.length;x-- >0;)H=P[x],(!b||b(H,S,A))&&!Q[H]&&(A[H]=S[H],Q[H]=!0);S=w!==!1&&Gw(S)}while(S&&(!w||w(S,A))&&S!==Object.prototype);return A},TY=(S,A,w)=>{S=String(S),(w===void 0||w>S.length)&&(w=S.length),w-=A.length;const b=S.indexOf(A,w);return b!==-1&&b===w},RY=S=>{if(!S)return null;if(bm(S))return S;let A=S.length;if(!iB(A))return null;const w=new Array(A);for(;A-- >0;)w[A]=S[A];return w},vY=(S=>A=>S&&A instanceof S)(typeof Uint8Array<"u"&&Gw(Uint8Array)),yY=(S,A)=>{const b=(S&&S[EC]).call(S);let P;for(;(P=b.next())&&!P.done;){const x=P.value;A.call(S,x[0],x[1])}},CY=(S,A)=>{let w;const b=[];for(;(w=S.exec(A))!==null;)b.push(w);return b},AY=uo("HTMLFormElement"),bY=S=>S.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(w,b,P){return b.toUpperCase()+P}),vV=(({hasOwnProperty:S})=>(A,w)=>S.call(A,w))(Object.prototype),IY=uo("RegExp"),sB=(S,A)=>{const w=Object.getOwnPropertyDescriptors(S),b={};uS(w,(P,x)=>{let H;(H=A(P,x,S))!==!1&&(b[x]=H||P)}),Object.defineProperties(S,b)},OY=S=>{sB(S,(A,w)=>{if(Sa(S)&&["arguments","caller","callee"].indexOf(w)!==-1)return!1;const b=S[w];if(Sa(b)){if(A.enumerable=!1,"writable"in A){A.writable=!1;return}A.set||(A.set=()=>{throw Error("Can not rewrite read-only method '"+w+"'")})}})},wY=(S,A)=>{const w={},b=P=>{P.forEach(x=>{w[x]=!0})};return bm(S)?b(S):b(String(S).split(A)),w},NY=()=>{},DY=(S,A)=>S!=null&&Number.isFinite(S=+S)?S:A;function LY(S){return!!(S&&Sa(S.append)&&S[eB]==="FormData"&&S[EC])}const PY=S=>{const A=new Array(10),w=(b,P)=>{if(SC(b)){if(A.indexOf(b)>=0)return;if(!("toJSON"in b)){A[P]=b;const x=bm(b)?[]:{};return uS(b,(H,Q)=>{const X=w(H,P+1);!sS(X)&&(x[Q]=X)}),A[P]=void 0,x}}return b};return w(S,0)},kY=uo("AsyncFunction"),MY=S=>S&&(SC(S)||Sa(S))&&Sa(S.then)&&Sa(S.catch),oB=((S,A)=>S?setImmediate:A?((w,b)=>(Lh.addEventListener("message",({source:P,data:x})=>{P===Lh&&x===w&&b.length&&b.shift()()},!1),P=>{b.push(P),Lh.postMessage(w,"*")}))(`axios@${Math.random()}`,[]):w=>setTimeout(w))(typeof setImmediate=="function",Sa(Lh.postMessage)),UY=typeof queueMicrotask<"u"?queueMicrotask.bind(Lh):typeof process<"u"&&process.nextTick||oB,xY=S=>S!=null&&Sa(S[EC]),gt={isArray:bm,isArrayBuffer:nB,isBuffer:tY,isFormData:lY,isArrayBufferView:eY,isString:nY,isNumber:iB,isBoolean:iY,isObject:SC,isPlainObject:cC,isReadableStream:dY,isRequest:hY,isResponse:pY,isHeaders:fY,isUndefined:sS,isDate:rY,isFile:aY,isBlob:sY,isRegExp:IY,isFunction:Sa,isStream:cY,isURLSearchParams:uY,isTypedArray:vY,isFileList:oY,forEach:uS,merge:ww,extend:EY,trim:mY,stripBOM:_Y,inherits:gY,toFlatObject:SY,kindOf:_C,kindOfTest:uo,endsWith:TY,toArray:RY,forEachEntry:yY,matchAll:CY,isHTMLForm:AY,hasOwnProperty:vV,hasOwnProp:vV,reduceDescriptors:sB,freezeMethods:OY,toObjectSet:wY,toCamelCase:bY,noop:NY,toFiniteNumber:DY,findKey:rB,global:Lh,isContextDefined:aB,isSpecCompliantForm:LY,toJSONObject:PY,isAsyncFn:kY,isThenable:MY,setImmediate:oB,asap:UY,isIterable:xY};function Fe(S,A,w,b,P){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=S,this.name="AxiosError",A&&(this.code=A),w&&(this.config=w),b&&(this.request=b),P&&(this.response=P,this.status=P.status?P.status:null)}gt.inherits(Fe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:gt.toJSONObject(this.config),code:this.code,status:this.status}}});const cB=Fe.prototype,lB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(S=>{lB[S]={value:S}});Object.defineProperties(Fe,lB);Object.defineProperty(cB,"isAxiosError",{value:!0});Fe.from=(S,A,w,b,P,x)=>{const H=Object.create(cB);return gt.toFlatObject(S,H,function(X){return X!==Error.prototype},Q=>Q!=="isAxiosError"),Fe.call(H,S.message,A,w,b,P),H.cause=S,H.name=S.name,x&&Object.assign(H,x),H};const VY=null;function Nw(S){return gt.isPlainObject(S)||gt.isArray(S)}function uB(S){return gt.endsWith(S,"[]")?S.slice(0,-2):S}function yV(S,A,w){return S?S.concat(A).map(function(P,x){return P=uB(P),!w&&x?"["+P+"]":P}).join(w?".":""):A}function BY(S){return gt.isArray(S)&&!S.some(Nw)}const FY=gt.toFlatObject(gt,{},null,function(A){return/^is[A-Z]/.test(A)});function TC(S,A,w){if(!gt.isObject(S))throw new TypeError("target must be an object");A=A||new FormData,w=gt.toFlatObject(w,{metaTokens:!0,dots:!1,indexes:!1},!1,function(xt,yt){return!gt.isUndefined(yt[xt])});const b=w.metaTokens,P=w.visitor||Z,x=w.dots,H=w.indexes,X=(w.Blob||typeof Blob<"u"&&Blob)&&gt.isSpecCompliantForm(A);if(!gt.isFunction(P))throw new TypeError("visitor must be a function");function G(it){if(it===null)return"";if(gt.isDate(it))return it.toISOString();if(!X&&gt.isBlob(it))throw new Fe("Blob is not supported. Use a Buffer instead.");return gt.isArrayBuffer(it)||gt.isTypedArray(it)?X&&typeof Blob=="function"?new Blob([it]):Buffer.from(it):it}function Z(it,xt,yt){let Pt=it;if(it&&!yt&&typeof it=="object"){if(gt.endsWith(xt,"{}"))xt=b?xt:xt.slice(0,-2),it=JSON.stringify(it);else if(gt.isArray(it)&&BY(it)||(gt.isFileList(it)||gt.endsWith(xt,"[]"))&&(Pt=gt.toArray(it)))return xt=uB(xt),Pt.forEach(function(Ft,ye){!(gt.isUndefined(Ft)||Ft===null)&&A.append(H===!0?yV([xt],ye,x):H===null?xt:xt+"[]",G(Ft))}),!1}return Nw(it)?!0:(A.append(yV(yt,xt,x),G(it)),!1)}const st=[],mt=Object.assign(FY,{defaultVisitor:Z,convertValue:G,isVisitable:Nw});function Vt(it,xt){if(!gt.isUndefined(it)){if(st.indexOf(it)!==-1)throw Error("Circular reference detected in "+xt.join("."));st.push(it),gt.forEach(it,function(Pt,Gt){(!(gt.isUndefined(Pt)||Pt===null)&&P.call(A,Pt,gt.isString(Gt)?Gt.trim():Gt,xt,mt))===!0&&Vt(Pt,xt?xt.concat(Gt):[Gt])}),st.pop()}}if(!gt.isObject(S))throw new TypeError("data must be an object");return Vt(S),A}function CV(S){const A={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(S).replace(/[!'()~]|%20|%00/g,function(b){return A[b]})}function Hw(S,A){this._pairs=[],S&&TC(S,this,A)}const dB=Hw.prototype;dB.append=function(A,w){this._pairs.push([A,w])};dB.toString=function(A){const w=A?function(b){return A.call(this,b,CV)}:CV;return this._pairs.map(function(P){return w(P[0])+"="+w(P[1])},"").join("&")};function jY(S){return encodeURIComponent(S).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hB(S,A,w){if(!A)return S;const b=w&&w.encode||jY;gt.isFunction(w)&&(w={serialize:w});const P=w&&w.serialize;let x;if(P?x=P(A,w):x=gt.isURLSearchParams(A)?A.toString():new Hw(A,w).toString(b),x){const H=S.indexOf("#");H!==-1&&(S=S.slice(0,H)),S+=(S.indexOf("?")===-1?"?":"&")+x}return S}class AV{constructor(){this.handlers=[]}use(A,w,b){return this.handlers.push({fulfilled:A,rejected:w,synchronous:b?b.synchronous:!1,runWhen:b?b.runWhen:null}),this.handlers.length-1}eject(A){this.handlers[A]&&(this.handlers[A]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(A){gt.forEach(this.handlers,function(b){b!==null&&A(b)})}}const pB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},GY=typeof URLSearchParams<"u"?URLSearchParams:Hw,HY=typeof FormData<"u"?FormData:null,WY=typeof Blob<"u"?Blob:null,KY={isBrowser:!0,classes:{URLSearchParams:GY,FormData:HY,Blob:WY},protocols:["http","https","file","blob","url","data"]},Ww=typeof window<"u"&&typeof document<"u",Dw=typeof navigator=="object"&&navigator||void 0,YY=Ww&&(!Dw||["ReactNative","NativeScript","NS"].indexOf(Dw.product)<0),zY=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",qY=Ww&&window.location.href||"http://localhost",XY=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ww,hasStandardBrowserEnv:YY,hasStandardBrowserWebWorkerEnv:zY,navigator:Dw,origin:qY},Symbol.toStringTag,{value:"Module"})),Gr={...XY,...KY};function JY(S,A){return TC(S,new Gr.classes.URLSearchParams,Object.assign({visitor:function(w,b,P,x){return Gr.isNode&&gt.isBuffer(w)?(this.append(b,w.toString("base64")),!1):x.defaultVisitor.apply(this,arguments)}},A))}function QY(S){return gt.matchAll(/\w+|\[(\w*)]/g,S).map(A=>A[0]==="[]"?"":A[1]||A[0])}function ZY(S){const A={},w=Object.keys(S);let b;const P=w.length;let x;for(b=0;b<P;b++)x=w[b],A[x]=S[x];return A}function fB(S){function A(w,b,P,x){let H=w[x++];if(H==="__proto__")return!0;const Q=Number.isFinite(+H),X=x>=w.length;return H=!H&&gt.isArray(P)?P.length:H,X?(gt.hasOwnProp(P,H)?P[H]=[P[H],b]:P[H]=b,!Q):((!P[H]||!gt.isObject(P[H]))&&(P[H]=[]),A(w,b,P[H],x)&&gt.isArray(P[H])&&(P[H]=ZY(P[H])),!Q)}if(gt.isFormData(S)&&gt.isFunction(S.entries)){const w={};return gt.forEachEntry(S,(b,P)=>{A(QY(b),P,w,0)}),w}return null}function $Y(S,A,w){if(gt.isString(S))try{return(A||JSON.parse)(S),gt.trim(S)}catch(b){if(b.name!=="SyntaxError")throw b}return(w||JSON.stringify)(S)}const dS={transitional:pB,adapter:["xhr","http","fetch"],transformRequest:[function(A,w){const b=w.getContentType()||"",P=b.indexOf("application/json")>-1,x=gt.isObject(A);if(x&&gt.isHTMLForm(A)&&(A=new FormData(A)),gt.isFormData(A))return P?JSON.stringify(fB(A)):A;if(gt.isArrayBuffer(A)||gt.isBuffer(A)||gt.isStream(A)||gt.isFile(A)||gt.isBlob(A)||gt.isReadableStream(A))return A;if(gt.isArrayBufferView(A))return A.buffer;if(gt.isURLSearchParams(A))return w.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),A.toString();let Q;if(x){if(b.indexOf("application/x-www-form-urlencoded")>-1)return JY(A,this.formSerializer).toString();if((Q=gt.isFileList(A))||b.indexOf("multipart/form-data")>-1){const X=this.env&&this.env.FormData;return TC(Q?{"files[]":A}:A,X&&new X,this.formSerializer)}}return x||P?(w.setContentType("application/json",!1),$Y(A)):A}],transformResponse:[function(A){const w=this.transitional||dS.transitional,b=w&&w.forcedJSONParsing,P=this.responseType==="json";if(gt.isResponse(A)||gt.isReadableStream(A))return A;if(A&&gt.isString(A)&&(b&&!this.responseType||P)){const H=!(w&&w.silentJSONParsing)&&P;try{return JSON.parse(A)}catch(Q){if(H)throw Q.name==="SyntaxError"?Fe.from(Q,Fe.ERR_BAD_RESPONSE,this,null,this.response):Q}}return A}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Gr.classes.FormData,Blob:Gr.classes.Blob},validateStatus:function(A){return A>=200&&A<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};gt.forEach(["delete","get","head","post","put","patch"],S=>{dS.headers[S]={}});const tz=gt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ez=S=>{const A={};let w,b,P;return S&&S.split(`
`).forEach(function(H){P=H.indexOf(":"),w=H.substring(0,P).trim().toLowerCase(),b=H.substring(P+1).trim(),!(!w||A[w]&&tz[w])&&(w==="set-cookie"?A[w]?A[w].push(b):A[w]=[b]:A[w]=A[w]?A[w]+", "+b:b)}),A},bV=Symbol("internals");function iS(S){return S&&String(S).trim().toLowerCase()}function lC(S){return S===!1||S==null?S:gt.isArray(S)?S.map(lC):String(S)}function nz(S){const A=Object.create(null),w=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let b;for(;b=w.exec(S);)A[b[1]]=b[2];return A}const iz=S=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(S.trim());function vw(S,A,w,b,P){if(gt.isFunction(b))return b.call(this,A,w);if(P&&(A=w),!!gt.isString(A)){if(gt.isString(b))return A.indexOf(b)!==-1;if(gt.isRegExp(b))return b.test(A)}}function rz(S){return S.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(A,w,b)=>w.toUpperCase()+b)}function az(S,A){const w=gt.toCamelCase(" "+A);["get","set","has"].forEach(b=>{Object.defineProperty(S,b+w,{value:function(P,x,H){return this[b].call(this,A,P,x,H)},configurable:!0})})}let Ta=class{constructor(A){A&&this.set(A)}set(A,w,b){const P=this;function x(Q,X,G){const Z=iS(X);if(!Z)throw new Error("header name must be a non-empty string");const st=gt.findKey(P,Z);(!st||P[st]===void 0||G===!0||G===void 0&&P[st]!==!1)&&(P[st||X]=lC(Q))}const H=(Q,X)=>gt.forEach(Q,(G,Z)=>x(G,Z,X));if(gt.isPlainObject(A)||A instanceof this.constructor)H(A,w);else if(gt.isString(A)&&(A=A.trim())&&!iz(A))H(ez(A),w);else if(gt.isObject(A)&&gt.isIterable(A)){let Q={},X,G;for(const Z of A){if(!gt.isArray(Z))throw TypeError("Object iterator must return a key-value pair");Q[G=Z[0]]=(X=Q[G])?gt.isArray(X)?[...X,Z[1]]:[X,Z[1]]:Z[1]}H(Q,w)}else A!=null&&x(w,A,b);return this}get(A,w){if(A=iS(A),A){const b=gt.findKey(this,A);if(b){const P=this[b];if(!w)return P;if(w===!0)return nz(P);if(gt.isFunction(w))return w.call(this,P,b);if(gt.isRegExp(w))return w.exec(P);throw new TypeError("parser must be boolean|regexp|function")}}}has(A,w){if(A=iS(A),A){const b=gt.findKey(this,A);return!!(b&&this[b]!==void 0&&(!w||vw(this,this[b],b,w)))}return!1}delete(A,w){const b=this;let P=!1;function x(H){if(H=iS(H),H){const Q=gt.findKey(b,H);Q&&(!w||vw(b,b[Q],Q,w))&&(delete b[Q],P=!0)}}return gt.isArray(A)?A.forEach(x):x(A),P}clear(A){const w=Object.keys(this);let b=w.length,P=!1;for(;b--;){const x=w[b];(!A||vw(this,this[x],x,A,!0))&&(delete this[x],P=!0)}return P}normalize(A){const w=this,b={};return gt.forEach(this,(P,x)=>{const H=gt.findKey(b,x);if(H){w[H]=lC(P),delete w[x];return}const Q=A?rz(x):String(x).trim();Q!==x&&delete w[x],w[Q]=lC(P),b[Q]=!0}),this}concat(...A){return this.constructor.concat(this,...A)}toJSON(A){const w=Object.create(null);return gt.forEach(this,(b,P)=>{b!=null&&b!==!1&&(w[P]=A&&gt.isArray(b)?b.join(", "):b)}),w}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([A,w])=>A+": "+w).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(A){return A instanceof this?A:new this(A)}static concat(A,...w){const b=new this(A);return w.forEach(P=>b.set(P)),b}static accessor(A){const b=(this[bV]=this[bV]={accessors:{}}).accessors,P=this.prototype;function x(H){const Q=iS(H);b[Q]||(az(P,H),b[Q]=!0)}return gt.isArray(A)?A.forEach(x):x(A),this}};Ta.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);gt.reduceDescriptors(Ta.prototype,({value:S},A)=>{let w=A[0].toUpperCase()+A.slice(1);return{get:()=>S,set(b){this[w]=b}}});gt.freezeMethods(Ta);function yw(S,A){const w=this||dS,b=A||w,P=Ta.from(b.headers);let x=b.data;return gt.forEach(S,function(Q){x=Q.call(w,x,P.normalize(),A?A.status:void 0)}),P.normalize(),x}function mB(S){return!!(S&&S.__CANCEL__)}function Im(S,A,w){Fe.call(this,S??"canceled",Fe.ERR_CANCELED,A,w),this.name="CanceledError"}gt.inherits(Im,Fe,{__CANCEL__:!0});function EB(S,A,w){const b=w.config.validateStatus;!w.status||!b||b(w.status)?S(w):A(new Fe("Request failed with status code "+w.status,[Fe.ERR_BAD_REQUEST,Fe.ERR_BAD_RESPONSE][Math.floor(w.status/100)-4],w.config,w.request,w))}function sz(S){const A=/^([-+\w]{1,25})(:?\/\/|:)/.exec(S);return A&&A[1]||""}function oz(S,A){S=S||10;const w=new Array(S),b=new Array(S);let P=0,x=0,H;return A=A!==void 0?A:1e3,function(X){const G=Date.now(),Z=b[x];H||(H=G),w[P]=X,b[P]=G;let st=x,mt=0;for(;st!==P;)mt+=w[st++],st=st%S;if(P=(P+1)%S,P===x&&(x=(x+1)%S),G-H<A)return;const Vt=Z&&G-Z;return Vt?Math.round(mt*1e3/Vt):void 0}}function cz(S,A){let w=0,b=1e3/A,P,x;const H=(G,Z=Date.now())=>{w=Z,P=null,x&&(clearTimeout(x),x=null),S.apply(null,G)};return[(...G)=>{const Z=Date.now(),st=Z-w;st>=b?H(G,Z):(P=G,x||(x=setTimeout(()=>{x=null,H(P)},b-st)))},()=>P&&H(P)]}const hC=(S,A,w=3)=>{let b=0;const P=oz(50,250);return cz(x=>{const H=x.loaded,Q=x.lengthComputable?x.total:void 0,X=H-b,G=P(X),Z=H<=Q;b=H;const st={loaded:H,total:Q,progress:Q?H/Q:void 0,bytes:X,rate:G||void 0,estimated:G&&Q&&Z?(Q-H)/G:void 0,event:x,lengthComputable:Q!=null,[A?"download":"upload"]:!0};S(st)},w)},IV=(S,A)=>{const w=S!=null;return[b=>A[0]({lengthComputable:w,total:S,loaded:b}),A[1]]},OV=S=>(...A)=>gt.asap(()=>S(...A)),lz=Gr.hasStandardBrowserEnv?((S,A)=>w=>(w=new URL(w,Gr.origin),S.protocol===w.protocol&&S.host===w.host&&(A||S.port===w.port)))(new URL(Gr.origin),Gr.navigator&&/(msie|trident)/i.test(Gr.navigator.userAgent)):()=>!0,uz=Gr.hasStandardBrowserEnv?{write(S,A,w,b,P,x){const H=[S+"="+encodeURIComponent(A)];gt.isNumber(w)&&H.push("expires="+new Date(w).toGMTString()),gt.isString(b)&&H.push("path="+b),gt.isString(P)&&H.push("domain="+P),x===!0&&H.push("secure"),document.cookie=H.join("; ")},read(S){const A=document.cookie.match(new RegExp("(^|;\\s*)("+S+")=([^;]*)"));return A?decodeURIComponent(A[3]):null},remove(S){this.write(S,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function dz(S){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(S)}function hz(S,A){return A?S.replace(/\/?\/$/,"")+"/"+A.replace(/^\/+/,""):S}function _B(S,A,w){let b=!dz(A);return S&&(b||w==!1)?hz(S,A):A}const wV=S=>S instanceof Ta?{...S}:S;function kh(S,A){A=A||{};const w={};function b(G,Z,st,mt){return gt.isPlainObject(G)&&gt.isPlainObject(Z)?gt.merge.call({caseless:mt},G,Z):gt.isPlainObject(Z)?gt.merge({},Z):gt.isArray(Z)?Z.slice():Z}function P(G,Z,st,mt){if(gt.isUndefined(Z)){if(!gt.isUndefined(G))return b(void 0,G,st,mt)}else return b(G,Z,st,mt)}function x(G,Z){if(!gt.isUndefined(Z))return b(void 0,Z)}function H(G,Z){if(gt.isUndefined(Z)){if(!gt.isUndefined(G))return b(void 0,G)}else return b(void 0,Z)}function Q(G,Z,st){if(st in A)return b(G,Z);if(st in S)return b(void 0,G)}const X={url:x,method:x,data:x,baseURL:H,transformRequest:H,transformResponse:H,paramsSerializer:H,timeout:H,timeoutMessage:H,withCredentials:H,withXSRFToken:H,adapter:H,responseType:H,xsrfCookieName:H,xsrfHeaderName:H,onUploadProgress:H,onDownloadProgress:H,decompress:H,maxContentLength:H,maxBodyLength:H,beforeRedirect:H,transport:H,httpAgent:H,httpsAgent:H,cancelToken:H,socketPath:H,responseEncoding:H,validateStatus:Q,headers:(G,Z,st)=>P(wV(G),wV(Z),st,!0)};return gt.forEach(Object.keys(Object.assign({},S,A)),function(Z){const st=X[Z]||P,mt=st(S[Z],A[Z],Z);gt.isUndefined(mt)&&st!==Q||(w[Z]=mt)}),w}const gB=S=>{const A=kh({},S);let{data:w,withXSRFToken:b,xsrfHeaderName:P,xsrfCookieName:x,headers:H,auth:Q}=A;A.headers=H=Ta.from(H),A.url=hB(_B(A.baseURL,A.url,A.allowAbsoluteUrls),S.params,S.paramsSerializer),Q&&H.set("Authorization","Basic "+btoa((Q.username||"")+":"+(Q.password?unescape(encodeURIComponent(Q.password)):"")));let X;if(gt.isFormData(w)){if(Gr.hasStandardBrowserEnv||Gr.hasStandardBrowserWebWorkerEnv)H.setContentType(void 0);else if((X=H.getContentType())!==!1){const[G,...Z]=X?X.split(";").map(st=>st.trim()).filter(Boolean):[];H.setContentType([G||"multipart/form-data",...Z].join("; "))}}if(Gr.hasStandardBrowserEnv&&(b&&gt.isFunction(b)&&(b=b(A)),b||b!==!1&&lz(A.url))){const G=P&&x&&uz.read(x);G&&H.set(P,G)}return A},pz=typeof XMLHttpRequest<"u",fz=pz&&function(S){return new Promise(function(w,b){const P=gB(S);let x=P.data;const H=Ta.from(P.headers).normalize();let{responseType:Q,onUploadProgress:X,onDownloadProgress:G}=P,Z,st,mt,Vt,it;function xt(){Vt&&Vt(),it&&it(),P.cancelToken&&P.cancelToken.unsubscribe(Z),P.signal&&P.signal.removeEventListener("abort",Z)}let yt=new XMLHttpRequest;yt.open(P.method.toUpperCase(),P.url,!0),yt.timeout=P.timeout;function Pt(){if(!yt)return;const Ft=Ta.from("getAllResponseHeaders"in yt&&yt.getAllResponseHeaders()),te={data:!Q||Q==="text"||Q==="json"?yt.responseText:yt.response,status:yt.status,statusText:yt.statusText,headers:Ft,config:S,request:yt};EB(function(Ne){w(Ne),xt()},function(Ne){b(Ne),xt()},te),yt=null}"onloadend"in yt?yt.onloadend=Pt:yt.onreadystatechange=function(){!yt||yt.readyState!==4||yt.status===0&&!(yt.responseURL&&yt.responseURL.indexOf("file:")===0)||setTimeout(Pt)},yt.onabort=function(){yt&&(b(new Fe("Request aborted",Fe.ECONNABORTED,S,yt)),yt=null)},yt.onerror=function(){b(new Fe("Network Error",Fe.ERR_NETWORK,S,yt)),yt=null},yt.ontimeout=function(){let ye=P.timeout?"timeout of "+P.timeout+"ms exceeded":"timeout exceeded";const te=P.transitional||pB;P.timeoutErrorMessage&&(ye=P.timeoutErrorMessage),b(new Fe(ye,te.clarifyTimeoutError?Fe.ETIMEDOUT:Fe.ECONNABORTED,S,yt)),yt=null},x===void 0&&H.setContentType(null),"setRequestHeader"in yt&&gt.forEach(H.toJSON(),function(ye,te){yt.setRequestHeader(te,ye)}),gt.isUndefined(P.withCredentials)||(yt.withCredentials=!!P.withCredentials),Q&&Q!=="json"&&(yt.responseType=P.responseType),G&&([mt,it]=hC(G,!0),yt.addEventListener("progress",mt)),X&&yt.upload&&([st,Vt]=hC(X),yt.upload.addEventListener("progress",st),yt.upload.addEventListener("loadend",Vt)),(P.cancelToken||P.signal)&&(Z=Ft=>{yt&&(b(!Ft||Ft.type?new Im(null,S,yt):Ft),yt.abort(),yt=null)},P.cancelToken&&P.cancelToken.subscribe(Z),P.signal&&(P.signal.aborted?Z():P.signal.addEventListener("abort",Z)));const Gt=sz(P.url);if(Gt&&Gr.protocols.indexOf(Gt)===-1){b(new Fe("Unsupported protocol "+Gt+":",Fe.ERR_BAD_REQUEST,S));return}yt.send(x||null)})},mz=(S,A)=>{const{length:w}=S=S?S.filter(Boolean):[];if(A||w){let b=new AbortController,P;const x=function(G){if(!P){P=!0,Q();const Z=G instanceof Error?G:this.reason;b.abort(Z instanceof Fe?Z:new Im(Z instanceof Error?Z.message:Z))}};let H=A&&setTimeout(()=>{H=null,x(new Fe(`timeout ${A} of ms exceeded`,Fe.ETIMEDOUT))},A);const Q=()=>{S&&(H&&clearTimeout(H),H=null,S.forEach(G=>{G.unsubscribe?G.unsubscribe(x):G.removeEventListener("abort",x)}),S=null)};S.forEach(G=>G.addEventListener("abort",x));const{signal:X}=b;return X.unsubscribe=()=>gt.asap(Q),X}},Ez=function*(S,A){let w=S.byteLength;if(w<A){yield S;return}let b=0,P;for(;b<w;)P=b+A,yield S.slice(b,P),b=P},_z=async function*(S,A){for await(const w of gz(S))yield*Ez(w,A)},gz=async function*(S){if(S[Symbol.asyncIterator]){yield*S;return}const A=S.getReader();try{for(;;){const{done:w,value:b}=await A.read();if(w)break;yield b}}finally{await A.cancel()}},NV=(S,A,w,b)=>{const P=_z(S,A);let x=0,H,Q=X=>{H||(H=!0,b&&b(X))};return new ReadableStream({async pull(X){try{const{done:G,value:Z}=await P.next();if(G){Q(),X.close();return}let st=Z.byteLength;if(w){let mt=x+=st;w(mt)}X.enqueue(new Uint8Array(Z))}catch(G){throw Q(G),G}},cancel(X){return Q(X),P.return()}},{highWaterMark:2})},RC=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",SB=RC&&typeof ReadableStream=="function",Sz=RC&&(typeof TextEncoder=="function"?(S=>A=>S.encode(A))(new TextEncoder):async S=>new Uint8Array(await new Response(S).arrayBuffer())),TB=(S,...A)=>{try{return!!S(...A)}catch{return!1}},Tz=SB&&TB(()=>{let S=!1;const A=new Request(Gr.origin,{body:new ReadableStream,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!A}),DV=64*1024,Lw=SB&&TB(()=>gt.isReadableStream(new Response("").body)),pC={stream:Lw&&(S=>S.body)};RC&&(S=>{["text","arrayBuffer","blob","formData","stream"].forEach(A=>{!pC[A]&&(pC[A]=gt.isFunction(S[A])?w=>w[A]():(w,b)=>{throw new Fe(`Response type '${A}' is not supported`,Fe.ERR_NOT_SUPPORT,b)})})})(new Response);const Rz=async S=>{if(S==null)return 0;if(gt.isBlob(S))return S.size;if(gt.isSpecCompliantForm(S))return(await new Request(Gr.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(gt.isArrayBufferView(S)||gt.isArrayBuffer(S))return S.byteLength;if(gt.isURLSearchParams(S)&&(S=S+""),gt.isString(S))return(await Sz(S)).byteLength},vz=async(S,A)=>{const w=gt.toFiniteNumber(S.getContentLength());return w??Rz(A)},yz=RC&&(async S=>{let{url:A,method:w,data:b,signal:P,cancelToken:x,timeout:H,onDownloadProgress:Q,onUploadProgress:X,responseType:G,headers:Z,withCredentials:st="same-origin",fetchOptions:mt}=gB(S);G=G?(G+"").toLowerCase():"text";let Vt=mz([P,x&&x.toAbortSignal()],H),it;const xt=Vt&&Vt.unsubscribe&&(()=>{Vt.unsubscribe()});let yt;try{if(X&&Tz&&w!=="get"&&w!=="head"&&(yt=await vz(Z,b))!==0){let te=new Request(A,{method:"POST",body:b,duplex:"half"}),fn;if(gt.isFormData(b)&&(fn=te.headers.get("content-type"))&&Z.setContentType(fn),te.body){const[Ne,Cn]=IV(yt,hC(OV(X)));b=NV(te.body,DV,Ne,Cn)}}gt.isString(st)||(st=st?"include":"omit");const Pt="credentials"in Request.prototype;it=new Request(A,{...mt,signal:Vt,method:w.toUpperCase(),headers:Z.normalize().toJSON(),body:b,duplex:"half",credentials:Pt?st:void 0});let Gt=await fetch(it);const Ft=Lw&&(G==="stream"||G==="response");if(Lw&&(Q||Ft&&xt)){const te={};["status","statusText","headers"].forEach(An=>{te[An]=Gt[An]});const fn=gt.toFiniteNumber(Gt.headers.get("content-length")),[Ne,Cn]=Q&&IV(fn,hC(OV(Q),!0))||[];Gt=new Response(NV(Gt.body,DV,Ne,()=>{Cn&&Cn(),xt&&xt()}),te)}G=G||"text";let ye=await pC[gt.findKey(pC,G)||"text"](Gt,S);return!Ft&&xt&&xt(),await new Promise((te,fn)=>{EB(te,fn,{data:ye,headers:Ta.from(Gt.headers),status:Gt.status,statusText:Gt.statusText,config:S,request:it})})}catch(Pt){throw xt&&xt(),Pt&&Pt.name==="TypeError"&&/Load failed|fetch/i.test(Pt.message)?Object.assign(new Fe("Network Error",Fe.ERR_NETWORK,S,it),{cause:Pt.cause||Pt}):Fe.from(Pt,Pt&&Pt.code,S,it)}}),Pw={http:VY,xhr:fz,fetch:yz};gt.forEach(Pw,(S,A)=>{if(S){try{Object.defineProperty(S,"name",{value:A})}catch{}Object.defineProperty(S,"adapterName",{value:A})}});const LV=S=>`- ${S}`,Cz=S=>gt.isFunction(S)||S===null||S===!1,RB={getAdapter:S=>{S=gt.isArray(S)?S:[S];const{length:A}=S;let w,b;const P={};for(let x=0;x<A;x++){w=S[x];let H;if(b=w,!Cz(w)&&(b=Pw[(H=String(w)).toLowerCase()],b===void 0))throw new Fe(`Unknown adapter '${H}'`);if(b)break;P[H||"#"+x]=b}if(!b){const x=Object.entries(P).map(([Q,X])=>`adapter ${Q} `+(X===!1?"is not supported by the environment":"is not available in the build"));let H=A?x.length>1?`since :
`+x.map(LV).join(`
`):" "+LV(x[0]):"as no adapter specified";throw new Fe("There is no suitable adapter to dispatch the request "+H,"ERR_NOT_SUPPORT")}return b},adapters:Pw};function Cw(S){if(S.cancelToken&&S.cancelToken.throwIfRequested(),S.signal&&S.signal.aborted)throw new Im(null,S)}function PV(S){return Cw(S),S.headers=Ta.from(S.headers),S.data=yw.call(S,S.transformRequest),["post","put","patch"].indexOf(S.method)!==-1&&S.headers.setContentType("application/x-www-form-urlencoded",!1),RB.getAdapter(S.adapter||dS.adapter)(S).then(function(b){return Cw(S),b.data=yw.call(S,S.transformResponse,b),b.headers=Ta.from(b.headers),b},function(b){return mB(b)||(Cw(S),b&&b.response&&(b.response.data=yw.call(S,S.transformResponse,b.response),b.response.headers=Ta.from(b.response.headers))),Promise.reject(b)})}const vB="1.9.0",vC={};["object","boolean","number","function","string","symbol"].forEach((S,A)=>{vC[S]=function(b){return typeof b===S||"a"+(A<1?"n ":" ")+S}});const kV={};vC.transitional=function(A,w,b){function P(x,H){return"[Axios v"+vB+"] Transitional option '"+x+"'"+H+(b?". "+b:"")}return(x,H,Q)=>{if(A===!1)throw new Fe(P(H," has been removed"+(w?" in "+w:"")),Fe.ERR_DEPRECATED);return w&&!kV[H]&&(kV[H]=!0,console.warn(P(H," has been deprecated since v"+w+" and will be removed in the near future"))),A?A(x,H,Q):!0}};vC.spelling=function(A){return(w,b)=>(console.warn(`${b} is likely a misspelling of ${A}`),!0)};function Az(S,A,w){if(typeof S!="object")throw new Fe("options must be an object",Fe.ERR_BAD_OPTION_VALUE);const b=Object.keys(S);let P=b.length;for(;P-- >0;){const x=b[P],H=A[x];if(H){const Q=S[x],X=Q===void 0||H(Q,x,S);if(X!==!0)throw new Fe("option "+x+" must be "+X,Fe.ERR_BAD_OPTION_VALUE);continue}if(w!==!0)throw new Fe("Unknown option "+x,Fe.ERR_BAD_OPTION)}}const uC={assertOptions:Az,validators:vC},fc=uC.validators;let Ph=class{constructor(A){this.defaults=A||{},this.interceptors={request:new AV,response:new AV}}async request(A,w){try{return await this._request(A,w)}catch(b){if(b instanceof Error){let P={};Error.captureStackTrace?Error.captureStackTrace(P):P=new Error;const x=P.stack?P.stack.replace(/^.+\n/,""):"";try{b.stack?x&&!String(b.stack).endsWith(x.replace(/^.+\n.+\n/,""))&&(b.stack+=`
`+x):b.stack=x}catch{}}throw b}}_request(A,w){typeof A=="string"?(w=w||{},w.url=A):w=A||{},w=kh(this.defaults,w);const{transitional:b,paramsSerializer:P,headers:x}=w;b!==void 0&&uC.assertOptions(b,{silentJSONParsing:fc.transitional(fc.boolean),forcedJSONParsing:fc.transitional(fc.boolean),clarifyTimeoutError:fc.transitional(fc.boolean)},!1),P!=null&&(gt.isFunction(P)?w.paramsSerializer={serialize:P}:uC.assertOptions(P,{encode:fc.function,serialize:fc.function},!0)),w.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?w.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:w.allowAbsoluteUrls=!0),uC.assertOptions(w,{baseUrl:fc.spelling("baseURL"),withXsrfToken:fc.spelling("withXSRFToken")},!0),w.method=(w.method||this.defaults.method||"get").toLowerCase();let H=x&&gt.merge(x.common,x[w.method]);x&&gt.forEach(["delete","get","head","post","put","patch","common"],it=>{delete x[it]}),w.headers=Ta.concat(H,x);const Q=[];let X=!0;this.interceptors.request.forEach(function(xt){typeof xt.runWhen=="function"&&xt.runWhen(w)===!1||(X=X&&xt.synchronous,Q.unshift(xt.fulfilled,xt.rejected))});const G=[];this.interceptors.response.forEach(function(xt){G.push(xt.fulfilled,xt.rejected)});let Z,st=0,mt;if(!X){const it=[PV.bind(this),void 0];for(it.unshift.apply(it,Q),it.push.apply(it,G),mt=it.length,Z=Promise.resolve(w);st<mt;)Z=Z.then(it[st++],it[st++]);return Z}mt=Q.length;let Vt=w;for(st=0;st<mt;){const it=Q[st++],xt=Q[st++];try{Vt=it(Vt)}catch(yt){xt.call(this,yt);break}}try{Z=PV.call(this,Vt)}catch(it){return Promise.reject(it)}for(st=0,mt=G.length;st<mt;)Z=Z.then(G[st++],G[st++]);return Z}getUri(A){A=kh(this.defaults,A);const w=_B(A.baseURL,A.url,A.allowAbsoluteUrls);return hB(w,A.params,A.paramsSerializer)}};gt.forEach(["delete","get","head","options"],function(A){Ph.prototype[A]=function(w,b){return this.request(kh(b||{},{method:A,url:w,data:(b||{}).data}))}});gt.forEach(["post","put","patch"],function(A){function w(b){return function(x,H,Q){return this.request(kh(Q||{},{method:A,headers:b?{"Content-Type":"multipart/form-data"}:{},url:x,data:H}))}}Ph.prototype[A]=w(),Ph.prototype[A+"Form"]=w(!0)});let bz=class yB{constructor(A){if(typeof A!="function")throw new TypeError("executor must be a function.");let w;this.promise=new Promise(function(x){w=x});const b=this;this.promise.then(P=>{if(!b._listeners)return;let x=b._listeners.length;for(;x-- >0;)b._listeners[x](P);b._listeners=null}),this.promise.then=P=>{let x;const H=new Promise(Q=>{b.subscribe(Q),x=Q}).then(P);return H.cancel=function(){b.unsubscribe(x)},H},A(function(x,H,Q){b.reason||(b.reason=new Im(x,H,Q),w(b.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(A){if(this.reason){A(this.reason);return}this._listeners?this._listeners.push(A):this._listeners=[A]}unsubscribe(A){if(!this._listeners)return;const w=this._listeners.indexOf(A);w!==-1&&this._listeners.splice(w,1)}toAbortSignal(){const A=new AbortController,w=b=>{A.abort(b)};return this.subscribe(w),A.signal.unsubscribe=()=>this.unsubscribe(w),A.signal}static source(){let A;return{token:new yB(function(P){A=P}),cancel:A}}};function Iz(S){return function(w){return S.apply(null,w)}}function Oz(S){return gt.isObject(S)&&S.isAxiosError===!0}const kw={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(kw).forEach(([S,A])=>{kw[A]=S});function CB(S){const A=new Ph(S),w=tB(Ph.prototype.request,A);return gt.extend(w,Ph.prototype,A,{allOwnKeys:!0}),gt.extend(w,A,null,{allOwnKeys:!0}),w.create=function(P){return CB(kh(S,P))},w}const Fi=CB(dS);Fi.Axios=Ph;Fi.CanceledError=Im;Fi.CancelToken=bz;Fi.isCancel=mB;Fi.VERSION=vB;Fi.toFormData=TC;Fi.AxiosError=Fe;Fi.Cancel=Fi.CanceledError;Fi.all=function(A){return Promise.all(A)};Fi.spread=Iz;Fi.isAxiosError=Oz;Fi.mergeConfig=kh;Fi.AxiosHeaders=Ta;Fi.formToJSON=S=>fB(gt.isHTMLForm(S)?new FormData(S):S);Fi.getAdapter=RB.getAdapter;Fi.HttpStatusCode=kw;Fi.default=Fi;const{Axios:Mz,AxiosError:Uz,CanceledError:xz,isCancel:Vz,CancelToken:Bz,VERSION:Fz,all:jz,Cancel:Gz,isAxiosError:Hz,spread:Wz,toFormData:Kz,AxiosHeaders:Yz,HttpStatusCode:zz,formToJSON:qz,getAdapter:Xz,mergeConfig:Jz}=Fi,wz="https://zuba.minidog.club/",Aw=async(S,A)=>{var w,b;try{return(await Fi.post(`${wz}${S}`,A,{headers:{"Content-Type":"application/json"}})).data}catch(P){return{status:"error",data:((b=(w=P.response)==null?void 0:w.data)==null?void 0:b.message)||P.message||"Unknown error"}}},Nz=()=>{const S=xu(),A=new URLSearchParams(S.search),w=A.get("chanel"),b=A.get("username"),P=A.get("callId"),[x,H]=wt.useState(!1),[Q,X]=wt.useState([]),[G,Z]=wt.useState(0),[st,mt]=wt.useState(null),[Vt,it]=wt.useState(!1),[xt,yt]=wt.useState(!1),Pt=wt.useRef(null),Gt=wt.useRef(null),Ft="740baf604340463486afea8a267cc8e8",ye=null,te=async()=>{Gt.current=RV.createClient({mode:"rtc",codec:"h264"}),Gt.current.on("user-published",Ne),Gt.current.on("user-left",Cn),await Gt.current.join(Ft,w,ye,null);const Je=await RV.createMicrophoneAudioTrack({encoderConfig:{bitrate:128,sampleRate:48e3,stereo:!0,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});Pt.current=Je,await Gt.current.publish([Je]),H(!0),mt(new Date)},fn=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}),await te(),await Aw("call/accept",{callId:P})}catch(Je){console.error("Error joining call:",Je)}},Ne=async(Je,Yn)=>{Yn==="audio"&&(await Gt.current.subscribe(Je,"audio"),Je.audioTrack.play(),X(lr=>lr.some(mn=>mn.uid===Je.uid)?lr:[...lr,Je]))},Cn=async Je=>{yt(!0),Je.audioTrack&&(Je.audioTrack.stop(),Je.audioTrack.close()),await Gt.current.unsubscribe(Je,"audio"),X(Yn=>Yn.filter(lr=>lr.uid!==Je.uid)),await Aw("call/end",{callId:P})},An=async()=>{Pt.current&&(Pt.current.stop(),Pt.current.close()),Gt.current&&await Gt.current.leave(),await Aw("call/end",{callId:P}),window.location.href="myapp://endcall"};wt.useEffect(()=>{let Je;return st&&(Je=setInterval(()=>{Z(Math.floor((new Date-st)/1e3))},1e3)),()=>clearInterval(Je)},[st]),wt.useEffect(()=>{xt&&window.confirm("Do you want to end the call?")&&(window.location.href="myapp://endcall")},[xt]),wt.useEffect(()=>()=>{Gt.current&&(Gt.current.off("user-published",Ne),Gt.current.off("user-left",Cn))},[]);const hi=Je=>{const Yn=Math.floor(Je/60),lr=Je%60;return`${Yn}m ${lr}s`};return si.createElement(si.Fragment,null,si.createElement("div",{className:"header"},si.createElement("img",{src:"https://rich143.com/images/newfavicon.svg",className:"profile-img",alt:"Profile"}),si.createElement("div",null,si.createElement("div",{className:"username"},b),si.createElement("div",{className:"status"},"Online"))),si.createElement("div",{className:"logo"},si.createElement("img",{src:"https://rich143.com/static/media/updatedlogo.778bb66b8ac72949874f0c8180098037.svg",className:"img-fluid w-75",alt:"Logo"})),si.createElement("div",{className:"timer mt-5 text-bold username h1"},hi(G)),si.createElement("div",{className:"login-btn"},x?si.createElement("button",{className:"btn btn-danger btn-sm w-100 rounded-4 py-3",onClick:An},"End Call"):si.createElement("button",{className:"btn btn-success btn-sm w-100 py-3 rounded-3",onClick:fn},"Join Call")))},Dz=()=>si.createElement("div",null,"testing"),Lz=()=>si.createElement(si.Fragment,null,si.createElement(LK,null,si.createElement(cK,null,si.createElement(Iw,{path:"/main",element:si.createElement(Nz,null)}),si.createElement(Iw,{path:"/",element:si.createElement(Dz,null)}))));XK.createRoot(document.getElementById("root")).render(si.createElement(si.StrictMode,null,si.createElement(Lz,null)));
